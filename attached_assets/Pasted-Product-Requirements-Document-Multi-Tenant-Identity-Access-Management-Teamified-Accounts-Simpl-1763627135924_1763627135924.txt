Product Requirements Document: Multi-Tenant Identity & Access Management
Teamified Accounts - Simplified Final Specification

Version: 2.1 (Final - Simplified)
 Date: November 14, 2025
 Status: Ready for Implementation

1. Executive Summary
Transform Teamified Accounts into a multi-tenant identity platform where:
Candidates sign up quickly to apply for jobs
Client organizations create workspaces and manage teams
Users can belong to multiple organizations with different roles
Applications receive organization context via OAuth tokens

2. User Personas
Persona
Who
Need
Access
Jobseeker
Job applicants
Quick signup to apply
Candidate Portal, Team Connect (interviews)
Client Admin
Business owners, HR directors
Create workspace, manage team
Full access to their organization
Client Team
HR, recruiters, finance, employees
Collaborate within role
Role-based access to apps
Super Admin
Teamified internal staff
Platform management
Cross-tenant access to everything
Internal Staff
Teamified employees
Support clients
Cross-tenant operational access


3. Role Structure
3.1 Client Roles (Tenant-Scoped)
client_admin        - Organization owner, full control
client_hr           - HR operations and employee management
client_finance      - Payroll and financial operations
client_recruiter    - Hiring pipeline and recruitment
client_employee     - Employees (hired candidates)
3.2 Internal Teamified Roles (Global)
super_admin              - Cross-tenant platform administration
internal_hr              - Teamified HR operations across clients
internal_recruiter       - Teamified recruiting support
internal_account_manager - Client account management and support
internal_finance         - Teamified finance operations
internal_marketing       - Marketing and growth operations
3.3 Public Role (Global, No Organization)
candidate          - Job applicants, no organization needed
3.4 Access Control Matrix
Role
Candidate Portal
Team Connect
HRIS
ATS
Finance
Data Dashboard
super_admin
✅ All orgs
✅ All orgs
✅ All orgs
✅ All orgs
✅ All orgs
✅ All orgs
internal_hr
❌
✅ All orgs
✅ All orgs
❌
❌
✅ View all
internal_recruiter
✅ All orgs
✅ All orgs
❌
✅ All orgs
❌
✅ View all
internal_account_manager
❌
✅ All orgs
✅ All orgs
❌
❌
✅ View all
internal_finance
❌
✅ All orgs
✅ All orgs
❌
✅ All orgs
✅ View all
internal_marketing
❌
✅ All orgs
❌
❌
❌
✅ View all
client_admin
❌
✅ Own org
✅ Own org
✅ Own org
❌
❌
client_recruiter
❌
✅ Own org
❌
✅ Own org
❌
❌
client_hr
❌
✅ Own org
✅ Own org
❌
❌
❌
client_finance
❌
✅ Own org
✅ Limited
❌
❌
❌
client_employee 
❌
✅ Own org
✅ View only
❌
❌
❌
candidate
✅ Public
✅ Interviews
❌
❌
❌
❌

Important Note on Internal Users:
Internal users (super_admin, internal_hr, internal_recruiter, internal_account_manager, internal_finance, internal_marketing) are NOT members of client organizations
They belong exclusively to the "Teamified Internal" organization
Their cross-tenant access is achieved through elevated permissions, not organization membership
Client organizations' member lists will only show client_ users*
Internal users access client data invisibly—clients don't see them in their team rosters
This ensures proper separation between platform operators and tenant users

4. Database Schema
4.1 New Tables
organizations
id UUID PRIMARY KEY
name VARCHAR(255) NOT NULL
slug VARCHAR(100) UNIQUE NOT NULL
industry VARCHAR(100)
company_size VARCHAR(20)
logo_url TEXT
settings JSONB DEFAULT '{}'
subscription_tier VARCHAR(50) DEFAULT 'free'
subscription_status VARCHAR(50) DEFAULT 'active'
created_at TIMESTAMP
updated_at TIMESTAMP
organization_members
id UUID PRIMARY KEY
organization_id UUID REFERENCES organizations
user_id UUID REFERENCES users
status VARCHAR(20) DEFAULT 'active'
joined_at TIMESTAMP
invited_by UUID REFERENCES users
UNIQUE(organization_id, user_id)
Note: This table stores actual organization membership. Internal users (super_admin, internal_*) are NOT stored here for client organizations. They belong only to "Teamified Internal" organization. Their cross-tenant access is permission-based, not membership-based.
invitations
id UUID PRIMARY KEY
organization_id UUID REFERENCES organizations
invite_code VARCHAR(100) UNIQUE NOT NULL
invited_by UUID REFERENCES users
role_type VARCHAR(50) NOT NULL
status VARCHAR(20) DEFAULT 'pending'
expires_at TIMESTAMP DEFAULT NOW() + 7 days
max_uses INTEGER DEFAULT NULL
current_uses INTEGER DEFAULT 0
created_at TIMESTAMP
4.2 Updated Tables
user_roles (add new role types and tenant scoping)
-- Add to role_type constraint:
'client_admin', 'client_hr', 'client_finance', 
'client_recruiter', 'client_employee',
'super_admin', 'internal_hr', 'internal_recruiter', 
'internal_account_manager', 'internal_finance', 
'internal_marketing'

-- Update scope constraint:
'tenant', 'global' (instead of 'user', 'group', 'client', 'all')

-- scope_entity_id will store organization_id for tenant-scoped roles
4.3 Special Organizations
Public Tenant - Default for candidates (system-managed)
Teamified Internal - For super admins and internal staff
Test Tenant - For testing/development accounts

5. Core Features
5.1 Signup Flows
Candidate Signup (30 seconds)
1. Enter: Email, Password, Full Name
2. Auto-assign: candidate role (no org)
3. Redirect: Candidate Portal
Client Admin Signup (1-2 minutes)
1. Enter: Email, Password, Full Name
2. Choose: "Create Organization" or "Join via Invite"
3a. Create: Company Name, Industry, Company Size
    → Become client_admin of new org
3b. Join: Paste invite link
    → Join with assigned role
4. Redirect: Account Page
5.2 Invitation System
Shareable Invite Links:
Client admins generate links with embedded role
Can be single-use or multi-use
Expires after 7 days
Share via email, Slack, any channel
Flow:
1. Admin: Create invite → Specify role (client_hr, client_recruiter, etc.)
2. Admin: Copy link and share
3. User: Click link → Signup/Login → Auto-join org with role
5.3 Multi-Organization Support
Organization Switcher:
Dropdown showing all user's organizations
Switch with one click
Last-used org remembered for next login
Role and permissions update immediately
Organization Management (client_admin only):
View/edit organization settings
Invite team members with specific roles
Remove team members
Manage pending invitations
5.4 Candidate-to-Employee Conversion
ATS Integration Endpoint:
POST /api/v1/organizations/:orgId/convert-candidate-to-employee

Request:
{
  "candidate_email": "candidate@example.com",
  "hired_by": "recruiter-user-id",
  "start_date": "2025-01-15",
  "job_title": "Software Engineer"
}

Response:
{
  "success": true,
  "user": { ... },
  "organization_membership": {
    "organization_id": "org-uuid",
    "role": "client_employee"
  }
}
Logic:
Validate candidate exists
Add to organization_members
Assign client_employee role (scoped to org)
Send welcome email
Trigger HRIS onboarding

6. OAuth Token Enhancement
6.1 Enhanced Access Token
Current Token:
{
  "sub": "user-id",
  "email": "user@example.com",
  "iat": 1234567890,
  "exp": 1234571490
}
Enhanced Token:
{
  "sub": "user-id",
  "email": "user@example.com",
  "org_id": "organization-uuid",
  "org_slug": "acme-corp",
  "org_name": "Acme Corporation",
  "roles": ["client_admin", "client_hr"],
  "scope": "tenant",
  "iat": 1234567890,
  "exp": 1234571490
}
6.2 Validation Endpoint Update
GET /api/v1/sso/validate
Authorization: Bearer {token}

Response:
{
  "valid": true,
  "user": { "id": "...", "email": "...", "name": "..." },
  "organization": {
    "id": "org-uuid",
    "slug": "acme-corp",
    "name": "Acme Corporation"
  },
  "roles": ["client_admin"],
  "scope": "tenant"
}

7. Backend API Endpoints
Organizations
POST   /api/v1/organizations                          - Create org
GET    /api/v1/organizations/:id                      - Get org details
PATCH  /api/v1/organizations/:id                      - Update org (admin)
GET    /api/v1/organizations/:id/members              - List members
DELETE /api/v1/organizations/:id/members/:userId      - Remove member (admin)
User Organizations
GET    /api/v1/users/me/organizations                 - List user's orgs
POST   /api/v1/users/me/switch-organization           - Switch current org
GET    /api/v1/users/me/current-organization          - Get current org
Invitations
POST   /api/v1/organizations/:id/invitations          - Create invite (admin)
GET    /api/v1/organizations/:id/invitations          - List invites (admin)
DELETE /api/v1/invitations/:id                        - Cancel invite (admin)
POST   /api/v1/invitations/:code/accept               - Accept invite
GET    /api/v1/invitations/:code/preview              - Preview invite
Signup
POST   /api/v1/auth/signup/candidate                  - Candidate signup
POST   /api/v1/auth/signup/client-admin               - Client admin signup
ATS Integration
POST   /api/v1/organizations/:id/convert-candidate-to-employee

8. Frontend Routes
New Pages
/signup/candidate                  - Candidate signup
/signup/client-admin               - Client admin signup
/onboarding/create-org             - Organization creation
/onboarding/join-org               - Join via invite
/invitations/accept/:code          - Accept invitation
/organization/settings             - Org management (admin)
/organization/members              - Member management (admin)
/organization/invitations          - Invitation management (admin)
Updated Pages
/account                           - Add org switcher, member/invite mgmt
/login                             - Maintain org context

9. User Stories
Story 1: Candidate Signup
AS A jobseeker
I WANT to quickly create an account
SO THAT I can apply for jobs

✅ Form asks: email, password, name only
✅ Completes in <30 seconds
✅ Auto-redirects to Candidate Portal
✅ No organization required
Story 2: Client Organization Creation
AS A hiring manager
I WANT to create my company's workspace
SO THAT I can manage hiring and HR

✅ Signup asks: company name, industry, size
✅ Organization created with unique slug
✅ User becomes client_admin
✅ Can immediately invite team members
Story 3: Team Invitation
AS A client_admin
I WANT to invite team members with specific roles
SO THAT they can collaborate

✅ Generate shareable invite links
✅ Specify role (client_hr, client_recruiter, etc.)
✅ Copy link to clipboard
✅ Links expire after 7 days
✅ Can cancel pending invitations
Story 4: Multi-Organization User
AS A consultant working with multiple companies
I WANT to switch between organizations
SO THAT I can access different workspaces

✅ See all orgs in switcher dropdown
✅ Switch with one click
✅ Role updates immediately
✅ Last-used org remembered
Story 5: Candidate Conversion
AS AN ATS application
I WANT to convert hired candidates to employees
SO THAT they can access HRIS

✅ POST endpoint accepts candidate email
✅ Creates org membership
✅ Assigns client_employee role
✅ Sends welcome email
✅ Prevents duplicates

10. Security
Data Isolation
All queries filter by organization_id (except super_admin/internal_*)
Users only see data for their organizations
Database row-level security enforced
Internal User Visibility:
Internal users (super_admin, internal_hr, internal_recruiter, internal_account_manager, internal_finance, internal_marketing) access client data through elevated permissions, not membership
Client organizations CANNOT see internal users in their member lists
Organization member API endpoints (GET /api/v1/organizations/:id/members) filter out internal users
Only users with client_* roles appear in organization rosters
Internal users belong exclusively to "Teamified Internal" organization
This ensures clients see only their actual team members, not platform operators
Invitation Security
Cryptographically random invite codes
7-day expiration
Rate limiting: 10 invitations/hour per admin
Audit logging
Role Validation
Every request validates user's role for current org
Prevent privilege escalation
Super admin actions logged

11. Migration Strategy
Existing Users
-- Step 1: Create special organizations
INSERT INTO organizations (name, slug)
VALUES 
  ('Test Tenant', 'test-tenant'),
  ('Teamified Internal', 'teamified-internal');

-- Step 2: Identify internal users (users who will get super_admin or internal_* roles)
-- For this example, only user1@teamified.com will become super_admin
-- Adjust this list based on your actual internal team

-- Step 3: Move ONLY client users to Test Tenant (exclude internal users)
INSERT INTO organization_members (organization_id, user_id, status)
SELECT (SELECT id FROM organizations WHERE slug = 'test-tenant'), id, 'active'
FROM users
WHERE email NOT IN ('user1@teamified.com');  -- Exclude internal users

-- Step 4: Update roles to be tenant-scoped (only for client users)
UPDATE user_roles
SET scope = 'tenant',
    scope_entity_id = (SELECT id FROM organizations WHERE slug = 'test-tenant'),
    role_type = CASE
      WHEN role_type = 'admin' THEN 'client_admin'
      WHEN role_type = 'hr_manager_client' THEN 'client_hr'
      WHEN role_type = 'recruiter' THEN 'client_recruiter'
      WHEN role_type = 'eor' THEN 'client_employee'
      WHEN role_type = 'hr' THEN 'client_hr'
      ELSE role_type
    END
WHERE scope = 'all'
  AND user_id NOT IN (
    SELECT id FROM users WHERE email IN ('user1@teamified.com')  -- Exclude internal users
  );
Internal Users Bootstrap
-- Step 1: Create super admin role
INSERT INTO user_roles (user_id, role_type, scope)
SELECT id, 'super_admin', 'global'
FROM users WHERE email = 'user1@teamified.com';

-- Step 2: Add internal users to Teamified Internal org ONLY
INSERT INTO organization_members (organization_id, user_id, status)
SELECT (SELECT id FROM organizations WHERE slug = 'teamified-internal'), id, 'active'
FROM users WHERE email IN ('user1@teamified.com');

-- Step 3: CRITICAL - Remove internal users from Test Tenant if accidentally added
DELETE FROM organization_members
WHERE user_id IN (SELECT id FROM users WHERE email IN ('user1@teamified.com'))
  AND organization_id = (SELECT id FROM organizations WHERE slug = 'test-tenant');

-- Step 4: Verify internal users belong ONLY to Teamified Internal
-- This query should return 0 rows (internal users in client orgs = violation)
SELECT u.email, o.name as organization_name
FROM organization_members om
JOIN users u ON om.user_id = u.id
JOIN organizations o ON om.organization_id = o.id
JOIN user_roles ur ON u.id = ur.user_id
WHERE ur.role_type IN ('super_admin', 'internal_hr', 'internal_recruiter', 
                       'internal_account_manager', 'internal_finance', 
                       'internal_marketing')
  AND o.slug != 'teamified-internal';
-- Expected result: 0 rows (if any rows appear, internal users are incorrectly in client orgs)

12. Success Metrics
Organizations created: 50+ in first 3 months
Average team size: 5-10 members per org
Invitation acceptance rate: >80%
Candidate signup time: <30 seconds
Org creation time: <2 minutes

13. Out of Scope (v1)
❌ Organization billing & subscriptions
 ❌ Custom role creation
 ❌ Organization hierarchies
 ❌ SAML/Google Workspace SSO
 ❌ MFA enforcement
 ❌ IP whitelisting
 ❌ Custom domains per org

14. Final Design Decisions
Default Org: Remember last-used organization
Leaving Orgs: Only client_admin can remove members
Invitations: Shareable links only (admin distributes manually)
Candidate Conversion: ATS calls API endpoint
Super Admin: Manual SQL bootstrap, then invite-only

15. Implementation Phases
Phase 1: Database Foundation
Create organizations, organization_members, invitations tables
Create special tenants (Public, Teamified Internal, Test Tenant)
Add new role types to user_roles constraint
Migrate existing test accounts
Phase 2: Organization Management APIs
CRUD operations for organizations
Member management endpoints
Organization context tracking
Phase 3: Invitation System
Generate shareable invite links
Accept/validate invitations
Email notifications
Candidate-to-employee conversion endpoint
Phase 4: Enhanced Signup Flows
Split signup: Candidate vs Client Admin paths
Organization creation flow
Join via invitation flow
Phase 5: Account UI Enhancements
Organization switcher
Member management (admin view)
Invitation management
Multi-org support
Phase 6: OAuth Token Enhancement
Include org_id and roles in access tokens
Update /validate endpoint to return org context
Test with existing Team Connect client
