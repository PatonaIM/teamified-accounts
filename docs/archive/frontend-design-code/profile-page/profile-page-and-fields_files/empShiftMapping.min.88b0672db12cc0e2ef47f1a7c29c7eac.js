var shiftMapping={isCalView:!1,isHoursView:!1,showAssignShift:!1,userListStartIndex:0,isChangeInShiftColor:!1,hoursviewParam:void 0,calviewParam:void 0,listviewParam:void 0,appElementsIndex:[0,9],appElementsKey:["loc",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,"empType"],selEditRowIndex:-1,leaveTypes:void 0,isTDUpdated:!1,init:function(){shiftMapping.setShiftGlobalVariables(),isadmin&&(isManageAttendanceData=!0,isManageShiftMapping=!0);var page=landingPage;SingleUserShiftMapping.resetOtherTabValues();var filterDiv=Att_Common_Operations.getFilterDivId();0===page.find(".zpl_rgtcntinr").length?(page.find(".zpl_btnmnu").remove(),shiftMapping.constructshiftMappingPage(page)):(page.find("#"+filterDiv+"ZPAtt_userShiftList").is(":visible")?(shiftMapping.isCalView=!1,shiftMapping.isHoursView=!1,shiftMapping.isListView=!0):page.find("#"+filterDiv+"ZPAtt_userCalWeekView").is(":visible")?(shiftMapping.isCalView=!0,shiftMapping.isHoursView=!1,shiftMapping.isListView=!1):page.find("#"+filterDiv+"ZPAtt_userCalHrsView").is(":visible")&&(shiftMapping.isCalView=!0,shiftMapping.isHoursView=!0,shiftMapping.isListView=!1),shiftMapping.consPageView()),shiftMapping.isChangeInShiftColor&&shiftMapping.consPageView(),shiftMapping.hideShiftChangeDropDown(),page.addClass("zpl_shftpagnav"),Att_Common_Operations.closeFilterifOpen()},getFireScrollObj:function(){var viewId=shiftMapping.isListView?"List":shiftMapping.isHoursView?"Hour":"Calendar",fireScrollId=landingPageId+viewId,scrollableDivId="#"+Att_Common_Operations.getFilterDivId()+(shiftMapping.isCalView?shiftMapping.isHoursView?"ZPAtt_userCalHrsView":"ZPAtt_userCalWeekView":"ZPAtt_userShiftList");return settingsPage.fireScrollObj[fireScrollId]||new FireScrollBack(shiftMapping.onShiftMapScroll,scrollableDivId,fireScrollId),settingsPage.fireScrollObj[fireScrollId]},hideShiftChangeDropDown:function(){$("#"+Att_Common_Operations.getFilterDivId()+"SingleDayEdit").hide(),$(shiftMapping.shiftCalEditObj).removeClass("zpl_shfttdclk"),$(document).find("body").removeClass("zpl_shfbdyclk"),"undefined"!=typeof ActionList&&ActionList.Card.shiftEditObj&&$(ActionList.Card.shiftEditObj).removeClass("zpl_db")},isFromLeavePage:function(){return-1!=landingPageURL.indexOf("leavetracker")},setShiftGlobalVariables:function(){var attModule=ZPeople.Module.MODULE_DATA.attendance;isLeadForShift=attModule.isLeadForShift,isManageAttendanceData=attModule.isManageAttedance,isManageShiftMapping=attModule.isManageShiftMapping,isEmpChooseApp=attModule.isEmpChooseShiftApp,isShiftEditAllowed=attModule.isShiftEditAllowed,isShiftViewAllowed=attModule.isShiftViewAllowed,isSPOCShiftView=attModule.isSPOCShiftView,isSPOCShiftEdit=attModule.isSPOCShiftEdit,editPastShiftPermRepMan=attModule.editPastShiftPermRepMan,isShiftChangeReasonMandatory=attModule.isShiftChangeReasonMandatory,editPastShiftPermUser=attModule.editPastShiftPermUser,isShiftApprConfigured=attModule.isShiftApprConfigured,isAutoAssignShiftApprConfigured=attModule.isAutoAssignShiftApprConfigured,showDepShift=attModule.showDepShift,showRepShift=attModule.showRepShift,isCompleteShiftDataAdmin=attModule.isCompleteShiftDataAdmin},isAssignShiftPermAvailableForPage:function(){var isTeamDataPage=Att_Common_Operations.isTeamReqPage(),isSingleUserTeamPage=Att_Common_Operations.isSingleUserTeamPage(),manPermForEdit=1===isShiftEditAllowed||2==isShiftEditAllowed,isOprPage=Att_Common_Operations.isShiftAllUsersOperationsPage(),isModAdmin=void 0!=isSPOCShiftEdit&&null!=isSPOCShiftEdit&&isSPOCShiftEdit.length>0,isShiftReqPage=Att_Common_Operations.isShiftReqPage(),isDepData=isTeamDataPage&&!isShiftReqPage&&(!showRepShift||3==ZPeopleComponents.select(landingPage.find("#"+Att_Common_Operations.getFilterDivId()+"TopStatus")).getValue());return isCompleteShiftDataAdmin||isTeamDataPage&&!isDepData&&manPermForEdit||isSingleUserTeamPage&&manPermForEdit||isOprPage&&(isManageShiftMapping||isModAdmin||manPermForEdit)||Att_Common_Operations.isSelfReqPage()&&(2==isShiftEditAllowed||3==isShiftEditAllowed)},onShiftMapScroll:function(){shiftMapping.isListView&&shiftMapping.userListValue&&50===shiftMapping.userListValue.userList.length&&(shiftMapping.userListStartIndex+=50,shiftMapping.getUserListView(!1,!0)),shiftMapping.isCalView&&(shiftMapping.userCalValue&&50===shiftMapping.userCalValue.userList.length&&!shiftMapping.isHoursView&&(shiftMapping.userCalStartIndex+=50,shiftMapping.getUserCalView(!0)),shiftMapping.userHoursValue&&50===shiftMapping.userHoursValue.userList.length&&shiftMapping.isHoursView&&(shiftMapping.hoursListStartIndex+=50,shiftMapping.getHoursListView(!0)))},constructshiftMappingPage:function(page){shiftMapping.isCalView=!1,shiftMapping.isHoursView=!1,shiftMapping.isListView=void 0;var filterDivId=Att_Common_Operations.getFilterDivId(),html='<div class="zpl_btnmnu">';html+='<div class="zpl_lft"></div><div class="zpl_cntrdv"><div class="zpl_inav">',html+='<i class="PI_alft tooltip-js blu zpl_cp" title="'+ZPI18N.getString("zp.previous")+'" aria-label="'+ZPI18N.getString("zp.common.previous")+'" tabindex="0" onclick="shiftMapping.getNavigator(true)"></i>  <i class="PI_monthly" id="empShiftMapCalNav"></i><i class="PI_argt tooltip-js blu zpl_cp" title="'+ZPI18N.getString("zp.next")+'" aria-label="'+ZPI18N.getString("zp.common.next")+'" tabindex="0" onclick="shiftMapping.getNavigator(false)"></i></div><div elem="dateNavigator" id="listcalview_month"></div></div>',html+='<div class="actn_ovrly" id="editShiftTopBand"><div><button class="zlabel zlabel--blue zlabel--medium" onclick="shiftMapping.bulkEditShift()">'+ZPI18N.getString("zp.changeshift")+"</button></div>",html+='<i class="PI_cls" onclick="shiftMapping.closeEditShiftTopBand()"></i></div>',html+='<div class="zpl_rgt">',html+='<ul class="zpl_grpmnu" style="display: block;" id="calViewListViewTog">',html+='<li class="zpl_act" onclick="shiftMapping.shiftView(this);" id="weekly" tabindex="0" aria-label="'+ZPI18N.getString("zp.weekly")+'">'+ZPI18N.getString("zp.weekly")+"</li>",html+='<li onclick="shiftMapping.shiftView(this);" id="daily">'+ZPI18N.getString("zp.daily")+"</li></ul>",landingPageURL.includes("attendance")||(html+='<div class="grpbtn">',html+='<i class="PI_grid zpl_act" id="cal_view" onclick="shiftMapping.switchView(this);"></i>',html+='<i class="PI_drag" id="list_view" onclick="shiftMapping.switchView(this);"></i>',html+="</div>"),html+='<button class="zlabel zlabel--blue zlabel--medium" id="assignShiftButton" tabindex="0" aria-label="'+ZPI18N.getString("zp.assignshift")+'" onclick="shiftMapping.constructAssignShift();">'+ZPI18N.getString("zp.assignshift")+"</button>",html+='<i class="zpl_ibg PI_fltr" onclick ="Att_Common_Operations.changeFilterClass();" title='+ZPI18N.getString("zp.filter")+"></i>",html+=Att_Common_Operations.getMoreOptionHtml(),html+='</div></div><div id="dropdown"></div></div><div class="zpl_rgtcnt"><div class="zpl_rgtcntinr"></div>',html+="</div>",html+=Att_Common_Operations.getFilterHtml(),html+='<div><button id="addPolicy1" type="button" class="zlabel zlabel--blue zlabel--medium" onclick="shiftMapping.getToggleSearch();">'+ZPI18N.getString("zp.apply")+'</button> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Att_Common_Operations.resetFilterOptions()">'+ZPI18N.getString("zp.reset")+"</button></div>";var moreOpt=[{type:"import",name:ZPI18N.getString("zp.import"),callback:"shiftMapping.Import.construct"},{type:"export",name:ZPI18N.getString("zp.export"),callback:"Att_Common_Operations.Export.construct"},{type:"download",name:ZPI18N.getString("zp.downloadpdf"),callback:"Att_Common_Operations.ExportPDF.construct"},{type:"print",name:ZPI18N.getString("zp.print"),callback:"Att_Common_Operations.print"}];page.append(html),page.find("#empShiftMapCalNav").off().on("click",function(event){shiftMapping.setUpCalNav(event,this)}),Att_Common_Operations.appendTopStatusAndEmpFilter(),Att_Common_Operations.moreOptionMenu(moreOpt),Att_Common_Operations.constructFilterDropdown(page),AppExc.getApplicableIds(),shiftMapping.isCalView=!0,shiftMapping.isListView=!1;var layout=landingPage;shiftMapping.isHoursView?(shiftMapping.setDateProps(layout,!0),shiftMapping.userHoursValue=null):(shiftMapping.setDateProps(layout),shiftMapping.setDateValueForCalView(layout),shiftMapping.userCalValue=null),shiftMapping.isHoursView?($("#"+filterDivId+"MoreOptions").find("i.PI_print").closest("li").show(),layout.find("#"+filterDivId+"ZPAtt_userCalHrsView").show()):layout.find("#"+filterDivId+"ZPAtt_userCalWeekView").show(),shiftMapping.consPageView()},setUpCalNav:function(event,ele){let type="daily";(shiftMapping.isListView||shiftMapping.isCalView&&!shiftMapping.isHoursView)&&(type=landingPage.find("#"+Att_Common_Operations.getFilterDivId()+"FilterPeriod").attr("type")),"monthly"===type?Calendar.setUpCalendar(event,$(ele).parent().parent().find('[elem="dateNavigator"]'),2,void 0,shiftMapping.navigateBasedOnCal):"weekly"===type?Calendar.setUpCalendar(event,$(ele).parent().parent().find('[elem="dateNavigator"]'),void 0,void 0,shiftMapping.navigateBasedOnCal,void 0,{weekselection:!0,attendance:!0}):"daily"===type?Calendar.setUpCalendar(event,$(ele).parent().parent().find('[elem="dateNavigator"]'),0,void 0,shiftMapping.navigateBasedOnCal):Calendar.setUpDoubleCalendar(event,ele,0,void 0,shiftMapping.doubleCalendarSetup)},doubleCalendarSetup:function(dateVal,data){if("tocalendar"===data.calcontId?$("#tocalendar").data({date:CalendarView.formatDate(new Date(new Date(data.selectedYear,data.selectedMonth).setDate(data.selectedDay)))}):$("#fromcalendar").data({date:CalendarView.formatDate(new Date(new Date(data.selectedYear,data.selectedMonth).setDate(data.selectedDay)))}),void 0!==$("#fromcalendar").data().date&&void 0!==$("#tocalendar").data().date){data={isCustom:!0,fromDate:$("#fromcalendar").data().date,toDate:$("#tocalendar").data().date};shiftMapping.navigateBasedOnCal(void 0,void 0,data)}},navigateBasedOnCal:function(undefined,undefined,data){var fromDate,toDate,filterDivId=Att_Common_Operations.getFilterDivId();ZPeopleComponents.select(landingPage.find("#"+filterDivId+"FilterPeriod")).setValue("6"),data.weekselection?(fromDate=CalendarView.formatDate(data.fromDate),toDate=CalendarView.formatDate(data.toDate)):data.isCustom?(fromDate=data.fromDate,toDate=data.toDate):data.selectedDay?fromDate=CalendarView.formatDate(new Date(new Date(data.selectedYear,data.selectedMonth).setDate(data.selectedDay))):(fromDate=CalendarView.formatDate(new Date(data.selectedYear,data.selectedMonth)),toDate=CalendarView.formatDate(new Date(new Date(data.selectedYear,data.selectedMonth+1)-1))),shiftMapping.isListView||!shiftMapping.isHoursView?(ZPeopleComponents.datefield(landingPage.find("#"+filterDivId+"FromDate")).setValue(fromDate),ZPeopleComponents.datefield(landingPage.find("#"+filterDivId+"ToDate")).setValue(toDate)):ZPeopleComponents.datefield(landingPage.find("#"+filterDivId+"Date")).setValue(fromDate),shiftMapping.isListView?shiftMapping.getUserListView():shiftMapping.isHoursView?shiftMapping.getHoursListView():shiftMapping.getUserCalView(),landingPage.find("#empShiftMapCalNav").html("")},consUpdateOlderAttEntries:function(){var html='<div class="zpl_crd"><div class="zpl_crdcnt">';html+='<div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.updateoldershiftinentries")+"</h5><p>"+ZPI18N.getString("zp.datewithintendays")+"</p></div></div>",html+='<div class="zpl_secn w400"><div><label>'+ZPI18N.getString("zp.from")+"</label></div>",html+='<div><input id="ZPAtt_applyShiftFromDate"/><div><span id="fromDateErrMsg" class="ztextbox--error__label"></span></div></div></div>',html+='<div class="zpl_secn w400"><div><label>'+ZPI18N.getString("zp.to")+"</label></div>",html+='<div><input id="ZPAtt_applyShiftToDate"/><div><span id="toDateErrMsg" class="ztextbox--error__label"></span></div></div></div>';var modal=ModuleComp.Modal.setup({id:"ZPAtt_showApplySett",type:1,backdrop:!1,header:ZPI18N.getString("zp.editolderentries"),body:html,deleteOnHide:!0,isConfirm:!1,removeConfirmButtonClass:"zlabel--blue",confirmButtonClass:"zlabel--blue",buttonValue:ZPI18N.getString("zp.confirm"),modalClass:"zpl_mcenter",successCallback:shiftMapping.applyOlderShift,closeonEsc:!0}),dateOptions={calendarIcon:!0,calendarIconUIType:"button",showPickerOnFocus:!0,format:dateFmt,picker:!0,datestep:0,spinButtons:"none",clearButton:"none",width:"400px",change:shiftMapping.hideDateErr};ZPeopleComponents.datefield(modal.find("#ZPAtt_applyShiftFromDate"),dateOptions),ZPeopleComponents.datefield(modal.find("#ZPAtt_applyShiftToDate"),dateOptions)},hideDateErr:function(){var layout=settingsPage.container.find("#ZPAtt_showApplySett");layout.find("#fromDateErrMsg").hide(),layout.find("#toDateErrMsg").hide(),ZPeopleComponents.datefield(layout.find("#ZPAtt_applyShiftFromDate")).setAttributes({className:""}),ZPeopleComponents.datefield(layout.find("#ZPAtt_applyShiftToDate")).setAttributes({className:""})},applyOlderShift:function(){var param={mode:"applyOlderShift",conreqcsr:csrfToken},layout=settingsPage.container.find("#ZPAtt_showApplySett"),fromDate=ZPeopleComponents.datefield(layout.find("#ZPAtt_applyShiftFromDate")).getValue().dateString,toDate=ZPeopleComponents.datefield(layout.find("#ZPAtt_applyShiftToDate")).getValue().dateString;shiftMapping.hideDateErr();var isToDateEmpty=void 0===toDate||""===toDate;return void 0===fromDate||""===fromDate?(layout.find("#fromDateErrMsg").html(ZPI18N.getString("zp.enterfromdate")),layout.find("#fromDateErrMsg").show(),void ZPeopleComponents.datefield(layout.find("#ZPAtt_applyShiftFromDate")).setAttributes({className:"ztextbox__error"})):isToDateEmpty?(layout.find("#toDateErrMsg").html(ZPI18N.getString("zp.entertodate")),layout.find("#toDateErrMsg").show(),void ZPeopleComponents.datefield(layout.find("#ZPAtt_applyShiftToDate")).setAttributes({className:"ztextbox__error"})):(param.startDate=fromDate,param.endDate=toDate,layout.find(".zpl_mfoter #zp_modal_blubtn").prop("disabled",!0),void $.post("/AttendanceShiftAction.zp",param,function(rdata){layout.find(".zpl_mfoter #zp_modal_blubtn").prop("disabled",!1);var errorMsg=rdata.msg;"success"===errorMsg?(ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.applysettingupdating")),ModuleComp.Modal.hide("ZPAtt_showApplySett")):"payperioderrormsg"===errorMsg?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.payperioderrormsg",new Array(Att_Common_Operations.getShiftDepLocShiftList().freezeDate))):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp."+errorMsg))}))},constructEditShiftModal:function(){var html='<div class="zpl_crd"><div class="zpl_crdcnt">';html+='<div class="zpl_secn"><div><label for="shifts" tabindex="0" class="zpl_mtry">'+ZPI18N.getString("zp.shiftname")+"</label></div>",html+='<div><select id="shifts"></select>'+TimelySettings.returnErrHtml(ZPI18N.getString("zp.selectshift"),"shiftEmpty")+"</div></div>",html+='<div class="zpl_secn"><div><label for="shiftStartDate" tabindex="0" class="zpl_mtry">'+ZPI18N.getString("zp.from")+"</label>"+TimelySettings.returnErrHtml(ZPI18N.getString("zp.enterfromdate"),"fromEmpty")+"</div>",html+='<div><input id="shiftStartDate"/></div></div>',html+='<div class="zpl_secn"><div><label for="shiftEndDate" tabindex="0">'+ZPI18N.getString("zp.to")+"</label></div>",html+='<div><input id="shiftEndDate"/></div></div>',isEmpChooseApp&&(html+='<div class="zpl_secn w400" id="ZPAtt_shift_chooseAppr"><div><label for="ZPAtt_shift_approverId" tabindex="0">'+ZPI18N.getString("zp.selectapprover")+"</label></div>",html+='<div><select id="ZPAtt_shift_approverId"></select><span id="emptyErrMsg" class="ztextbox--error__label"></span></div>',html+="</div>"),html+='<div class="zpl_secn w400" id="ZPAtt_shift_reason"><div><label tabindex="0" for="ShiftChangeCalReason" ',isShiftChangeReasonMandatory&&(html+=' class="zpl_mtry"'),html+=">"+ZPI18N.getString("zp.reason")+"</label></div>",html+='<div><textarea class="ztextbox" id="ShiftChangeCalReason" placeholder = '+ZPI18N.getString("zp.reason")+"></textarea>",isShiftChangeReasonMandatory&&(html+=TimelySettings.returnErrHtml(ZPI18N.getString("zp.enterreasonforshiftchange"),"reasonEmpty")),html+=TimelySettings.returnErrHtml(ZPI18N.getString("zp.leave.cancell.error.reasonlength"),"reasonLen"),html+="</div>",html+="</div>";var modal=ModuleComp.Modal.setup({id:"shift",type:1,backdrop:!1,header:ZPI18N.getString("zp.changeshift"),body:html,deleteOnHide:!0,isConfirm:!1,removeConfirmButtonClass:"zlabel--blue",confirmButtonClass:"zlabel--blue",buttonValue:ZPI18N.getString("zp.save"),modalClass:"zpl_mcenter",successCallback:shiftMapping.addUserShiftMapping,customBodyAttr:{id:"editShift_cards"},closeonEsc:!0});var listHeight={height:"200px",wdith:$(ZPeopleComponents.select(modal.find("#shifts")).getElement()[0]).outerWidth(),appendTo:"#editShift_cards"};ZPeopleComponents.select(modal.find("#shifts")).setAttributes({options:[],showSearchField:!0}),ZPeopleComponents.select(modal.find("#shifts")).setAttribute("dropdownList",listHeight),modal.find("#editShift_cards").css("position","relative");var dateOptions={calendarIcon:!0,calendarIconUIType:"button",showPickerOnFocus:!0,format:dateFmt,picker:!0,datestep:0,spinButtons:"none",clearButton:"none",width:"210px",pickerOptions:{appendTo:"#editShift_cards"}};ZPeopleComponents.datefield(modal.find("#shiftStartDate"),dateOptions),ZPeopleComponents.datefield(modal.find("#shiftEndDate"),dateOptions),isEmpChooseApp&&(modal.find("#s2id_ZPAtt_shift_approverId")[0]||ModuleAdmin.consResetEmpSearch("ZPAtt_shift_approverId",modal,!0),ZPeopleComponents.select(modal.find("#ZPAtt_shift_approverId")).setAttribute("dropdownList",{appendTo:"#editShift_cards"})),modal.attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.shiftsig")]),tabindex:"0"}),modal.find("#zp_modal_blubtn").attr({"aria-label":ZPI18N.getString("zp.save"),tabindex:"0"}),modal.find("#zp_modal_whitebtn").attr({"aria-label":ZPI18N.getString("zp.cancel")+" "+ZPI18N.getString("zp.common.cancelpopup"),tabindex:"0"})},addUserShiftMapping:function(){var page=Att_Common_Operations.isMySpaceMyShiftPage()||Att_Common_Operations.isMySpaceActionListPage()||Att_Common_Operations.isUserSpaceShiftPage()?settingsPage.container:landingPage,editModal=settingsPage.container.find("#shift");editModal.find(".zpl_mfoter #zp_modal_blubtn").prop("disabled",!0);var shiftId=ZPeopleComponents.select(editModal.find("#shifts")).getValue(),from_date=ZPeopleComponents.datefield(editModal.find("#shiftStartDate")).getValue().dateString,to_date=ZPeopleComponents.datefield(editModal.find("#shiftEndDate")).getValue().dateString;editModal.find(".ztextbox--error__label").hide(),editModal.find(".ztextbox__error").removeClass("ztextbox__error");var isErrAvail=!1;shiftId&&""!==shiftId||(editModal.find("#shiftEmpty").show(),editModal.find("#shifts").next().addClass("ztextbox__error"),isErrAvail=!0),from_date&&""!==from_date||(editModal.find("#fromEmpty").show(),editModal.find("#shiftStartDate").next().addClass("ztextbox__error"),isErrAvail=!0);var desc=editModal.find("#ShiftChangeCalReason").val().trim();if(""!==desc&&desc.length>250&&(editModal.find("#reasonLen").show(),editModal.find("#ShiftChangeCalReason").addClass("ztextbox__error"),isErrAvail=!0),isShiftChangeReasonMandatory&&""===desc&&(editModal.find("#reasonEmpty").show(),editModal.find("#ShiftChangeCalReason").addClass("ztextbox__error"),isErrAvail=!0),isErrAvail)editModal.find(".zpl_mfoter #zp_modal_blubtn").prop("disabled",!1);else{var params={erecno:$(id).closest("tr").attr("id"),shiftid:shiftId,mode:"addUserShiftMapping",conreqcsr:csrfToken,fdate:from_date,update:!0,loadDataForCalView:!0,isHoursView:shiftMapping.isHoursView};if((Att_Common_Operations.isMySpaceMyShiftPage()||Att_Common_Operations.isMySpaceActionListPage())&&(params.erecno=erecno),Att_Common_Operations.isUserSpaceShiftPage()&&(params.erecno=settingsUrlProps.urlParamsArr.id),""!==desc&&(params.desc=desc),params.updateAttEntries=!1,Attendance.isSpiceJet()||(params.updateAttEntries=!0),""!==to_date&&(params.tdate=to_date),isEmpChooseApp){var appErecno=Att_Common_Operations.getEmpChosenApprErecno(editModal,"ZPAtt_shift_approverId");if(""===appErecno)return;params.empChoosenApprErecno=appErecno}$.post("/AttendanceShiftAction.zp",params,function(rdata){if(rdata.error)rdata.error===ZPI18N.getString("zp.cannoteditpastshift")?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.cannoteditpastshift")):"from date greater"===rdata.error?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")):"payPeriodExceed"===rdata.error?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.attendance.shiftChange.immutableinfo")):"Todate is mandatory when pattern mapped"===rdata.error&&ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.todatemandatorywhenpatternset"));else{if(isShiftApprConfigured?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.requestraisedsuccess")):ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.shiftmapeditsuccessmsg")),Att_Common_Operations.isMySpaceMyShiftPage()||Att_Common_Operations.isMySpaceActionListPage()||Att_Common_Operations.isUserSpaceShiftPage()||(shiftMapping.resetFilterInputsForReload(),shiftMapping.userListValue=null),Att_Common_Operations.isSelfReqPage())SingleUserShiftMapping.resetOtherTabValues(),shiftMapping.isCalView?CalendarView.constructBasicData(SingleUserShiftMapping.calObj):SingleUserShiftMapping.getWeeklyData();else if(Att_Common_Operations.isMySpaceActionListPage())AttActionList.Shift.updateChangedShift();else if(Att_Common_Operations.isMySpaceMyShiftPage()||Att_Common_Operations.isUserSpaceShiftPage())MySpaceShift.init(),$(MySpaceShift.shiftEditObj).parent().removeClass("zpl_hvrsw");else if(shiftMapping.isHoursView)shiftMapping.userHoursValue=null,shiftMapping.getHoursListView();else{var checkAvail=page.find("#bulkShiftChange")[0]?2:1,start=shiftMapping.userCalValue.dateArray.indexOf(params.fdate)+checkAvail,end=shiftMapping.userCalValue.dateArray.indexOf(params.tdate)+checkAvail,filterDivId=Att_Common_Operations.getFilterDivId();if(0==start&&0==end&&!(new Date(moment(page.find("#"+filterDivId+"FromDate").getValue().dateString,Att_Common_Operations.getShiftDepLocShiftList().dateFormat.toUpperCase())._d).getTime()>new Date(moment(params.fdate,Att_Common_Operations.getShiftDepLocShiftList().dateFormat.toUpperCase())._d).getTime()&&new Date(moment($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(),Att_Common_Operations.getShiftDepLocShiftList().dateFormat.toUpperCase())._d)<new Date(moment(params.tdate,Att_Common_Operations.getShiftDepLocShiftList().dateFormat.toUpperCase())._d).getTime()))return void ModuleComp.Modal.hide("shift");0==start&&(start=1),0==end&&(end=shiftMapping.userCalValue.dateArray.length);for(var i=start;i<=end;i++){var shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[rdata.userShiftList[0].shiftList[i-start].shiftId];$(id).closest("tr").find("td").eq(i).attr("title","");var shiftTitle=decodeHTML(shift.shiftName);rdata.userShiftList[0].shiftList[i-start].isWeekend?($(id).closest("tr").find("td").eq(i).attr("title","Weekend"),shiftTitle+=" ("+ZPI18N.getString("zp.weekend")+")"):rdata.userShiftList[0].shiftList[i-start].isHoliday&&($(id).closest("tr").find("td").eq(i).attr("title",holiday_disName),shiftTitle+=" ("+holiday_disName+")");const timeRange=`${Attendance.disTime(shift.fTime,!1,!0)} - ${Attendance.disTime(shift.tTime,!1,!0)}`;$(id).find(`div#${params.erecno}`).attr("class","zpl_shftdts jc"+shift.colorCode),$(id).find(`div#${params.erecno}`).find("span").html(shift.shiftName),$(id).find(`div#${params.erecno}`).find("span").attr("title",shiftTitle+" / "+timeRange),$(id).find(`div#${params.erecno}`).attr("id",params.erecno),$(id).find(`div#${params.erecno}`).find("em").html(timeRange);const modalShiftDiv=$(id).find(".caldprtmntmdl").find('div[class*="jc"]');modalShiftDiv&&(modalShiftDiv.attr("class","zpl_shftdts jc"+shift.colorCode),modalShiftDiv.find("span").html(shift.shiftName),modalShiftDiv.find("span").attr("title",shiftTitle+" / "+timeRange),modalShiftDiv.attr("id",params.erecno),modalShiftDiv.find("em").remove(),modalShiftDiv.append(`<em>${timeRange}</em>`))}}ModuleComp.Modal.hide("shift",!0)}})}},consConflictPage:function(isFromImport){var html='<div class="zpl_tblres">';html+='<table class="zpl_tbl"><thead><tr>',html+="<th>"+ZPI18N.getString("zp.users")+'</th><th width="230">'+ZPI18N.getString("zp.existingshift")+"</th>",html+='<th width="230">'+ZPI18N.getString("zp.changedshift")+"</th>",!isFromImport&&Att_Common_Operations.isSelfReqPage()||(html+='<th width="15%"></th>'),html+='</thead><tbody id="conflictBody"></tbody></table></div>';ModuleComp.Modal.setup({id:"conflictPage",type:1,header:ZPI18N.getString("zp.conflictfound"),body:html,backdrop:!1,deleteOnHide:!0,modalClass:"zpl_mmd",closeOnSubmit:!0,buttonValue:ZPI18N.getString("zp.submit"),successCallback:function(){isFromImport?shiftMapping.addShiftFromImport(shiftMapping.excludedImportData):shiftMapping.setUserBasedShift(!0)},hiddenCallback:function(){shiftMapping.conflictHidden()},closeonEsc:!0})},conflictHidden:function(){var shiftMapAddPopup=settingsPage.container.find("#shftmapping");if(shiftMapping.emptyLocList){for(var i in shiftMapping.emptyLocList)shiftMapAddPopup.find("#pickListComp #"+i).remove();shiftMapping.emptyLocList=null}},editShift:function(){var page=settingsPage.container;shiftMapping.hideShiftChangeDropDown(),shiftMapping.constructEditShiftModal();var shiftMapAddPopup=page.find("#shift");id=shiftMapping.shiftCalEditObj;var fromDate,toDate,shiftlist=shiftMapping.applicableShifts,shiftoption=[];for(var shiftId in shiftlist)if(-1!==shiftlist[shiftId].select){var value=shiftlist[shiftId],innerHtml=`<span class="zpl_ellipsis w400">\n\t\t\t\t\t\t\t\t\t\t<span title="${value.shiftName}">#label#</span>\n\t\t\t\t\t\t\t\t\t\t<span class="zpl_dots"></span>\n\t\t\t\t\t\t\t\t\t\t<em title="${value.startTime} - ${value.endTime}">${value.startTime} - ${value.endTime}</em>\n\t\t\t\t\t\t\t\t\t</span>`;shiftoption.push({label:decodeHTML(value.shiftName),value:shiftId,innerHTML:innerHtml})}if(ZPeopleComponents.select(shiftMapAddPopup.find("#shifts")).setAttributes({options:shiftoption,placeholder:ZPI18N.getString("zp.select"),contentType:"custom"}),ZPeopleComponents.select(shiftMapAddPopup.find("#shifts")).setValue($(id).attr("id")),Att_Common_Operations.isSelfReqPage()){var index=shiftMapping.isHoursView?$(id).closest("tr").closest("td").closest("tr").index()+1:Number($(id).prev().find("span").text())-1;fromDate=toDate=shiftMapping.isHoursView?SingleUserShiftMapping.hoursDateArray[index]:SingleUserShiftMapping.monthDateArray[index]}else if(Att_Common_Operations.isMySpaceActionListPage())fromDate=toDate=document.getElementById("changeShiftClickButtonId").parentElement.parentElement.getAttribute("date");else if(Att_Common_Operations.isMySpaceMyShiftPage()||Att_Common_Operations.isUserSpaceShiftPage())fromDate=toDate=document.getElementById("changeShiftClickButtonId").parentElement.parentElement.parentElement.getAttribute("date");else if(shiftMapping.isHoursView)fromDate=toDate=shiftMapping.userHoursValue.dateArray[0];else{var checkAvail=page.find("#bulkShiftChange")[0]?2:1;fromDate=shiftMapping.userCalValue.dateArray[$(id).index()-checkAvail],toDate=shiftMapping.userCalValue.dateArray[$(id).index()-checkAvail]}ZPeopleComponents.datefield(shiftMapAddPopup.find("#shiftEndDate")).setValue(toDate),ZPeopleComponents.datefield(shiftMapAddPopup.find("#shiftStartDate")).setValue(fromDate),ZPeopleComponents.select(shiftMapAddPopup.find("#shifts")).setFocus()},constructAssignShift:function(fromEdit){fromEdit||(shiftMapping.cacheErecArr=void 0,shiftMapping.cacheArr=void 0,shiftMapping.applicableShifts=void 0),html+=ModuleComp.ZPPickList.getHtml();var html='<div class="zpl_crd"><div class="zpl_crdcnt">';fromEdit?(html+='<div class="zpl_secn w450"><div><label for="shifts" tabindex="0">'+ZPI18N.getString("zp.shift")+"</label></div>",html+='<div><select id="shifts"></select></div>',html+="</div>"):(html+='<div class="zpl_secn w450"><div><label for="shifts" tabindex="0">'+ZPI18N.getString("zp.shiftname")+"</label></div>",html+='<div><select id="shifts"></select><span id="selectShiftErrMsg"  style="display: none;" class="ztextbox--error__label"></span>',html+="</div></div>"),html+='<div class="zpl_secn zpl_idivingrp w450"><div><div><label for="shiftStartDate" tabindex="0">'+ZPI18N.getString("zp.schdates")+'</label><label class="zpl_op0"></label></div></div>',html+='<div><div><input id="shiftStartDate"/>',html+='<input id="shiftEndDate"/></div></div><div><span id="fromDateErrMsg" class="ztextbox--error__label"></span></div></div>',isEmpChooseApp&&(html+='<div class="zpl_secn w450" id="ZPAtt_shift_chooseAppr"><div><label for="ZPAtt_shift_chooseAppr" tabindex="0">'+ZPI18N.getString("zp.selectapprover")+"</label></div>",html+='<div><select id="ZPAtt_shift_approverId"></select><span id="emptyErrMsg" class="ztextbox--error__label"></span></div>',html+="</div>"),html+='<div class="zpl_secn w450 Matry"><div><label for="ZPAtt_ShiftChangeReason" tabindex="0"',isShiftChangeReasonMandatory&&(html+=' class="zpl_mtry"'),html+=">"+ZPI18N.getString("zp.reason")+"</label></div><div>",html+='<textarea class="ztextbox" rows="2" placeholder='+ZPI18N.getString("zp.reason")+' id="ZPAtt_ShiftChangeReason"></textarea></div></div>',html+='<div class="zpl_secn" id="ZPAtt_updAttDivAssignShift" style="display: none;"><div>',html+='<div class="zpl_info"><h6>'+ZPI18N.getString("zp.updateattentries")+"</h6><div></div><div></div>",html+="<div>"+ZPI18N.getString("zp.updattmsgshiftassign")+"</div><div></div><div></div>",html+='<div class="zcheckbox"><input id="ZPAtt_updAttEntryOnShift" type="checkbox" name="check" value="" class="zcheckbox__helper">',html+='<label for="ZPAtt_updAttEntryOnShift" class="zcheckbox__label">'+ZPI18N.getString("zp.updateattentries")+"</label></div></div></div></div>",html+="</div></div>";var extradetails={};extradetails.fromEdit=fromEdit;var modal=ModuleComp.Modal.setup({id:"shftmapping",type:1,extraDetails:extradetails,header:ZPI18N.getString("zp.assignshift"),body:html,backdrop:!1,deleteOnHide:!0,buttonValue:ZPI18N.getString("zp.submit"),successCallback:function(){shiftMapping.setUserBasedShift()},customBodyAttr:{id:"moduleCards"},closeonEsc:!0});shiftMapping.isSpiceJetOrg()&&(isadmin||void 0!=isSPOCShiftEdit&&null!=isSPOCShiftEdit&&isSPOCShiftEdit.length>0)&&modal.find(".zpl_mhderrgt").append('<span class="zpl_lnk" onclick="shiftMapping.consUpdateOlderAttEntries()">Update older Attendance entries</span>'),isEmpChooseApp&&(modal.find("#s2id_ZPAtt_shift_approverId")[0]||ModuleAdmin.consResetEmpSearch("ZPAtt_shift_approverId",modal,!0),ZPeopleComponents.select(modal.find("#ZPAtt_shift_approverId")).setAttribute("dropdownList",{appendTo:"#moduleCards"})),ZPeopleComponents.select(modal.find("#shifts")).setAttributes({options:[],placeholder:ZPI18N.getString("zp.select"),showSearchField:!0,messages:{noResults:ZPI18N.getString("zp.noapplshiftsfound")}});let width=$(ZPeopleComponents.select(modal.find("#shifts")).getElement()[0]).outerWidth();var selectedErecno,enableCacheWithErecno;(ZPeopleComponents.select(modal.find("#shifts")).setAttribute("dropdownList",{height:"200px",appendTo:"#moduleCards",width:width}),fromEdit)||(Att_Common_Operations.isSelfReqPage()&&(selectedErecno=AttendanceTeam.getSelfReqPageErecno(),enableCacheWithErecno=!0),modal.find("#shifts").on("zselectbeforedropdownlistopen",function(){shiftMapping.getApplicableShifts(selectedErecno,void 0,void 0,void 0,enableCacheWithErecno)}));if(shiftMapping.appElementsIndex=AppExc.removeUnApplicableElements([0,9]),Att_Common_Operations.isTeamReqPage()||!fromEdit&&!Att_Common_Operations.isSelfReqPage()&&(isSPOCShiftEdit||isManageShiftMapping&&!isadmin&&!isCompleteShiftDataAdmin||(isadmin||isCompleteShiftDataAdmin)&&0==shiftMapping.appElementsIndex.length))modal.find(".zpl_crdcnt .zpl_secn").eq(0).before(AppExc.getEmpHtml()),AppExc.populateEmployeeSelect(void 0,"appToSec");else if(!isadmin&&!isCompleteShiftDataAdmin||fromEdit||Att_Common_Operations.isSelfReqPage()){if(fromEdit){html='<div class="zpl_secn w400"><div><label for="selectedUser" tabindex="0">'+ZPI18N.getString("zp.lms.settings.applicableto")+"</label></div>";html+='<div class="PT5" id="selectedUser"></div>',html+="</div>",modal.find(".zpl_crdcnt .zpl_secn").eq(0).before(html)}}else{AppExc.setAppIndex(shiftMapping.appElementsIndex,!0),modal.find(".zpl_crdcnt .zpl_secn").eq(0).before(AppExc.returnApplicableHtml("appToSec")),modal.find("#appToSec .zpl_mtry").after(TimelySettings.returnErrHtml(ZPI18N.getString("zp.selectonecri"),"appErr")),AppExc.showHideAddMoreEle(modal,AppExc.returnAppElementsIndex()),AppExc.addEmpConditionRow(void 0,"appToSec")}var dateOptions={calendarIcon:!0,calendarIconUIType:"button",showPickerOnFocus:!0,format:dateFmt,picker:!0,datestep:0,spinButtons:"none",clearButton:"none",pickerOptions:{appendTo:"#moduleCards"}};modal.find("#moduleCards").css("position","relative"),modal.attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.assignshift")])+" "+ZPI18N.getString("zp.common.cancelpopup"),tabindex:"0"}),modal.focus(),ZPeopleComponents.datefield(modal.find("#shiftEndDate"),dateOptions),dateOptions.pickerclose=shiftMapping.toggleUpdAttEntryCheckBox,ZPeopleComponents.datefield(modal.find("#shiftStartDate"),dateOptions),modal.find(".zpl_mfoter #zp_modal_blubtn").attr({"aria-label":ZPI18N.getString("zp.submit"),tabindex:"0"}),modal.find(".zpl_mfoter #zp_modal_whitebtn").attr({"aria-label":ZPI18N.getString("zp.cancel")+" "+ZPI18N.getString("zp.common.cancelpopup"),tabindex:"0"})},toggleUpdAttEntryCheckBox:function(){var layout=settingsPage.container.find("#shftmapping");layout.find("#ZPAtt_updAttEntryOnShift")[0].checked=!1,shiftMapping.dateLessThanOrEqualCurrDate(ZPeopleComponents.datefield(layout.find("#shiftStartDate")).getValue().dateString)&&!Attendance.isSpiceJet()?(layout.find("#ZPAtt_updAttDivAssignShift").show(),layout.find("#ZPAtt_updAttEntryOnShift")[0].checked=!0):layout.find("#ZPAtt_updAttDivAssignShift").hide()},locationAdminUsers:null,setUserList:function(ele){var userList;if(ZPPickList.loginUserNeed=!0,isSPOCShiftEdit||isManageShiftMapping&&!isadmin){var params={mode:"GET_MODULE_EMP_LIST",module:"Attendance_Data",conreqcsr:csrfToken};$.post("/commonAction.zp",params,function(rdata){userList=rdata.empList,shiftMapping.conUserList(ele,userList)})}else isManageShiftMapping||isadmin||!(isLeadForShift&&1===isShiftEditAllowed||2===isShiftEditAllowed||3===isShiftEditAllowed)?shiftMapping.conUserList(ele):(userList=FormsCommon.getPrimaryLookupValues(2==isShiftEditAllowed?2:3==isShiftEditAllowed?1:4),shiftMapping.conUserList(ele,userList))},getApplicableShifts:function(erecNo,isCalView,obj,shiftIdFromEditMap,enableCacheWithErecno){var cont,modal=settingsPage.container.find("#shftmapping"),locArr=[],empTypeArr=[],erecArr=[];if(modal.length&&!erecNo)if(Att_Common_Operations.isTeamReqPage()){var userVal=TimelyZComp.tokenField.getValues(modal.find("#empSel"));userVal.length>0?erecArr=userVal:(Att_Common_Operations.handleApplicableError(modal,!0),isErrorAvail=!0)}else{var appfor=AppExc.constructAppValues(modal,"#appToSec",shiftMapping.appElementsKey,!0);appfor.isNoValAvail?(Att_Common_Operations.handleApplicableError(modal,!0),isErrorAvail=!0):(erecArr=appfor.user,locArr=appfor.loc,empTypeArr=appfor.empType)}if(erecNo){if(cont=modal.find("#shifts"),erecArr=[erecNo+""],locArr=[],cont[0]&&ZPeopleComponents.select(cont).removeAllOptions(),enableCacheWithErecno&&shiftMapping.getApplicableShiftsCache(cont,[erecNo+""],locArr,empTypeArr))return}else{if(cont=modal.find("#shifts"),shiftMapping.getApplicableShiftsCache(cont,erecArr,locArr,empTypeArr))return;modal.find("#attShiftMiniLoader").show(),ZPeopleComponents.select(cont).removeAllOptions()}1==locArr.length&&"0"==locArr[0]&&Att_Common_Operations.getShiftDepLocShiftList()&&Att_Common_Operations.getShiftDepLocShiftList().locList&&(locArr=Object.keys(Att_Common_Operations.getShiftDepLocShiftList().locList)),1==empTypeArr.length&&"0"==empTypeArr[0]&&(empTypeArr=Object.keys(AppExc.appElements.empTypeList)),$.ajax({type:"POST",async:!0,url:"/AttendanceShiftAction.zp",data:{mode:"getApplicableShifts",erecno:JSON.stringify(erecArr),location:JSON.stringify(locArr),empType:JSON.stringify(empTypeArr),conreqcsr:csrfToken,needShiftTime:!0},success:function(rdata){var shiftList=rdata.applicableShifts;if(shiftMapping.applicableShifts=shiftList,erecNo&&isCalView)if(isShiftChangeReasonMandatory)shiftMapping.editShift();else{if(shiftMapping.dropDownShiftOption="",Object.keys(shiftList).length>0){var onclick=Att_Common_Operations.isMySpaceMyShiftPage()||Att_Common_Operations.isUserSpaceShiftPage()?"MySpaceShift.changeShift(this)":"shiftMapping.changeShiftCalView(this)";Att_Common_Operations.isMySpaceActionListPage()&&(onclick="AttActionList.Shift.changeShift(this)",$(obj).addClass("zpl_db")),$.each(shiftList,function(indx,value){-1!==value.select&&(shiftMapping.dropDownShiftOption+=`<div class="zpl_aprv_stus" onClick="${onclick}" id="${indx}">\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="zpl_ellipsis w400">\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span title="${value.shiftName}" aria-label="${value.shiftName}" tabindex="0">${value.shiftName}</span>\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="zpl_dots"></span>\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<em title="${value.startTime} - ${value.endTime}" aria-label="${value.startTime} - ${value.endTime}" tabindex="0">${value.startTime} - ${value.endTime}</em>\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t</div>`)})}var topfix,left,topAdjust=45,leftAdjust=230,dropPlacement=75,docHei=$(document).height(),id=Att_Common_Operations.getFilterDivId();Att_Common_Operations.isMySpaceActionListPage()||(leftAdjust+=30),Att_Common_Operations.isMySpaceMyShiftPage()&&(leftAdjust+=100);var shiftDropDown=$("#"+id+"SingleDayEdit");shiftDropDown.find(".zpl_aprvlst").empty(),shiftDropDown.find(".zpl_aprvlst").append(shiftMapping.dropDownShiftOption);var dropdownHei=shiftDropDown.find(".zpl_aprvlst").parent().outerHeight();if(Layout.Page.container.find("#weeklyView").is(":visible")||Layout.Page.container.find("#"+id+"ZPAtt_userCalHrsView").is(":visible")){var attrVal=shiftDropDown.css("top");topfix=parseInt(attrVal.substring(0,attrVal.lastIndexOf("px"))),attrVal=shiftDropDown.css("left"),left=parseInt(attrVal.substring(0,attrVal.lastIndexOf("px"))),topAdjust-=10,leftAdjust-=230,dropPlacement+=40}else{var elemPos=document.getElementById("changeShiftClickButtonId").getBoundingClientRect();topfix=elemPos.bottom,left=elemPos.right,Layout.Page.container.find("#monthlyView").is(":visible")?(leftAdjust+=20,dropPlacement+=25,topAdjust+=Att_Common_Operations.isOperationsShiftMappingPage()?110:40):Layout.Page.container.find("#"+id+"ZPAtt_userCalWeekView").is(":visible")&&(leftAdjust+=60,topAdjust+=Att_Common_Operations.isOperationsShiftMappingPage()?10:50);var isZohoOne=-1!=window.location.origin.indexOf("https://one");topAdjust+=$(document).find("#welcomebanner").is(":visible")?isZohoOne?-10:40:isZohoOne?-50:0}left-=leftAdjust,dropdownHei+(topfix-=topAdjust)+dropPlacement>=docHei?topfix-=dropdownHei+75:Att_Common_Operations.isMySpaceMyShiftPage()&&(topfix-=50),shiftDropDown.removeClass("top"),shiftDropDown.removeClass("bottom"),shiftDropDown.css({top:topfix+"px"}),shiftDropDown.css({left:left+"px"}),shiftDropDown.show(),shiftDropDown.focus(),shiftDropDown.removeClass("zpl_DNI"),$(document).find("body").one("click",shiftMapping.hideShiftChangeDropDown),Att_Common_Operations.isMySpaceMyShiftPage()||Att_Common_Operations.isMySpaceActionListPage()?Layout.Page.container.parent().one("scroll",shiftMapping.hideShiftChangeDropDown):Att_Common_Operations.isSelfReqPage()||shiftMapping.isHoursView?landingPage.one("scroll",shiftMapping.hideShiftChangeDropDown):Att_Common_Operations.isUserSpaceShiftPage()?settingsPage.container.closest(".zpl_container").one("scroll",shiftMapping.hideShiftChangeDropDown):($(shiftMapping.shiftCalEditObj).addClass("zpl_shfttdclk"),$(document).find("body").addClass("zpl_shfbdyclk"))}else{modal.find("#attShiftMiniLoader").hide();var shiftOption=[],isAvail=!1;for(var shiftId in shiftList){if(-1!==shiftList[shiftId].select){var value=shiftList[shiftId],innerHtml=`<span class="zpl_ellipsis w400">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span title="${value.shiftName}" aria-label="${value.shiftName}" tabindex="0">#label#</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="zpl_dots"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<em title="${value.startTime} - ${value.endTime}" aria-label="${value.startTime} - ${value.endTime}" tabindex="0">${value.startTime} - ${value.endTime}</em>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>`;shiftOption.push({label:decodeHTML(value.shiftName),value:shiftId,innerHTML:innerHtml})}erecNo&&!isCalView&&shiftIdFromEditMap&&shiftId===shiftIdFromEditMap&&(isAvail=!0)}ZPeopleComponents.select(cont).setAttributes({contentType:"custom"}),erecNo?isCalView||(ZPeopleComponents.select(cont).addOption(shiftOption,"append"),shiftIdFromEditMap&&(isAvail?ZPeopleComponents.select(cont).setValue(shiftIdFromEditMap):ZPeopleComponents.select(cont).setValue(""))):ZPeopleComponents.select(cont).addOption(shiftOption,"append")}$(obj).removeAttr("id")}})},changeShiftCalView:function(obj){Att_Common_Operations.getFilterDivId();shiftMapping.hideShiftChangeDropDown();let shiftId=$(obj).attr("id");if(curRow=shiftMapping.shiftCalEditObj,isEmpChooseApp||isShiftChangeReasonMandatory)shiftMapping.editShift();else{var fromDate,toDate;if(Att_Common_Operations.isSelfReqPage()){let calObj=SingleUserShiftMapping.calObj;if(shiftMapping.isCalView){let tempDate=new Date(calObj.curYear,calObj.curMonth);tempDate.setDate(parseInt($(curRow).siblings().find("span").text())),fromDate=toDate=CalendarView.formatDate(tempDate)}else fromDate=toDate=$(curRow).closest("tbody").attr("date")}else shiftMapping.isHoursView?(fromDate=toDate=shiftMapping.userHoursValue.dateArray[0],shiftMapping.userCalValue=null):(fromDate=shiftMapping.userCalValue.dateArray[$(curRow).index()-2],toDate=shiftMapping.userCalValue.dateArray[$(curRow).index()-2],shiftMapping.userHoursValue=null);var params={erecno:$(curRow).closest("tr").attr("id"),shiftid:shiftId,mode:"addUserShiftMapping",update:!0,conreqcsr:csrfToken,fdate:fromDate,tdate:toDate,loadDataForCalView:!0,isHoursView:shiftMapping.isHoursView,updateAttEntries:!1};Attendance.isSpiceJet()||(params.updateAttEntries=!0),$.post("/AttendanceShiftAction.zp",params,function(rdata){if(rdata.error)rdata.error===ZPI18N.getString("zp.cannoteditpastshift")?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.cannoteditpastshift")):"payPeriodExceed"===rdata.error?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.attendance.shiftChange.immutableinfo")):"Todate is mandatory when pattern mapped"===rdata.error&&ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.todatemandatorywhenpatternset"));else if(shiftMapping.userListValue=null,Attendance.Settings.generalSettings=null,Attendance.resetForLoadData(),shiftMapping.resetFilterInputsForReload(),isShiftApprConfigured?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.shiftchangerequestraisedsuccess")):ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.shiftmapeditsuccessmsg")),Att_Common_Operations.isSelfReqPage())shiftMapping.isCalView?CalendarView.constructBasicData(SingleUserShiftMapping.calObj):SingleUserShiftMapping.getWeeklyData();else if(shiftMapping.isHoursView)shiftMapping.editUserShift(rdata);else{var shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[rdata.userShiftList[0].shiftList[0].shiftId];$(curRow).attr("title","");var shiftTitle=decodeHTML(shift.shiftName);rdata.userShiftList[0].shiftList[0].isWeekend?($(curRow).attr("title","Weekend"),shiftTitle+=" ("+ZPI18N.getString("zp.weekend")+")"):rdata.userShiftList[0].shiftList[0].isHoliday&&($(curRow).attr("title",holiday_disName),shiftTitle+=" ("+holiday_disName+")");const timeRange=Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0);$(curRow).find(`div#${params.erecno}`).attr("class","zpl_shftdts jc"+shift.colorCode),$(curRow).find(`span#${params.erecno}`).html(shift.shiftName),$(curRow).find(`span#${params.erecno}`).attr("title",shiftTitle+" / "+timeRange),$(curRow).attr("id",params.erecno),$(curRow).find(`div#${params.erecno}`).find("em").html(timeRange);const modalShiftDiv=$(curRow).find(".caldprtmntmdl").find('div[class*="jc"]');modalShiftDiv&&(modalShiftDiv.attr("class","zpl_shftdts jc"+shift.colorCode),modalShiftDiv.find("span").html(shift.shiftName),modalShiftDiv.find("span").attr("title",shiftTitle+" / "+timeRange),modalShiftDiv.attr("id",params.erecno),modalShiftDiv.find("em").remove(),modalShiftDiv.append(`<em>${timeRange}</em>`))}})}},setUserBasedShift:function(isSend){var modal=settingsPage.container.find("#shftmapping"),isSingleUserEdit=modal.data("extraDetails").fromEdit;modal.find(".zpl_crdcnt #singleConflict").remove();var from_date=ZPeopleComponents.datefield(modal.find("#shiftStartDate")).getValue().dateString,to_date=ZPeopleComponents.datefield(modal.find("#shiftEndDate")).getValue().dateString,desc=modal.find("#ZPAtt_ShiftChangeReason").val().trim(),appfor={};if(Att_Common_Operations.isTeamReqPage()){var userVal=TimelyZComp.tokenField.getValues(modal.find("#empSel"));if(!(userVal.length>0))return void Att_Common_Operations.handleApplicableError(modal,!0);appfor.user=userVal,appfor.loc=[],appfor.empType=[]}else isSingleUserEdit||(appfor=AppExc.constructAppValues(modal,"#appToSec",shiftMapping.appElementsKey,!0));var locList,empTypeList,ereclist=isSend?shiftMapping.selectedUserPickList:appfor.user;if(!0===isSend&&(!ereclist||0===ereclist.toString().length))return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.excludedalluser"));let makeToDateMan=!1;if(isSingleUserEdit)ereclist=modal.find("#selectedUser").parent().attr("id");else if(Att_Common_Operations.isSelfReqPage())ereclist=AttendanceTeam.getSelfReqPageErecno();else{for(var i in 1==(locList=appfor.loc).length&&"0"==locList[0]&&(locList=Object.keys(AppExc.appElements.locationList)),shiftMapping.emptyLocList){var index=locList.indexOf(i);locList.splice(index,1)}for(var i in 1==(empTypeList=appfor.empType).length&&"0"==empTypeList[0]&&(empTypeList=Object.keys(AppExc.appElements.empTypeList)),shiftMapping.emptyEmpTypeList){index=empTypeList.indexOf(i);empTypeList.splice(index,1)}}if(shiftMapping.selectedUserPickList=ereclist,ereclist.includes(erecno)&&Att_Common_Operations.isShiftReqPage()&&(makeToDateMan=!0),modal.find("#appErr").hide(),!isSingleUserEdit&&!Att_Common_Operations.isSelfReqPage()&&appfor.isNoValAvail)return Att_Common_Operations.handleApplicableError(modal,!0),void shiftMapping.resetSingleUserParam();var shiftid=ZPeopleComponents.select(modal.find("#shifts")).getValue();if("0"===shiftid||""===shiftid)return modal.find("#selectShiftErrMsg").html(ZPI18N.getString("zp.selectshift")),modal.find("#selectShiftErrMsg").show(),Att_Common_Operations.addErrClassToZC(modal,"shifts"),void shiftMapping.resetSingleUserParam();if(modal.find("#selectShiftErrMsg").hide(),Att_Common_Operations.removeErrClassFromZC(modal,"shifts"),void 0===from_date)return modal.find("#fromDateErrMsg").html(ZPI18N.getString("zp.enterfromdate")),modal.find("#fromDateErrMsg").show(),ZPeopleComponents.datefield(modal.find("#shiftStartDate")).setAttributes({className:"ztextbox__error"}),void shiftMapping.resetSingleUserParam();if(modal.find("#fromDateErrMsg").hide(),ZPeopleComponents.datefield(modal.find("#shiftStartDate")).setAttributes({className:""}),makeToDateMan&&void 0===to_date)return modal.find("#fromDateErrMsg").html(ZPI18N.getString("zp.entertodate")),modal.find("#fromDateErrMsg").show(),ZPeopleComponents.datefield(modal.find("#shiftEndDate")).setAttributes({className:"ztextbox__error"}),void shiftMapping.resetSingleUserParam();if(modal.find("#fromDateErrMsg").hide(),ZPeopleComponents.datefield(modal.find("#shiftEndDate")).setAttributes({className:""}),null===shiftid)return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.changedeletedshift")),void shiftMapping.resetSingleUserParam();if(isSingleUserEdit){if(!(shiftMapping.singlePopUpFrom!==from_date||shiftMapping.singlePopUpShift!==shiftid||shiftMapping.singlePopUpDesc!==desc&&(isShiftChangeReasonMandatory||shiftMapping.singlePopUpDesc||""!==desc)||shiftMapping.singlePopUpTo!==to_date&&(shiftMapping.singlePopUpTo||""!==to_date)||modal.find("#ZPAtt_updAttEntryOnShift")[0].checked))return void ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.nochangesmade"));shiftMapping.singlePopUpEditFrom!==from_date||shiftMapping.singlePopUpEditTo!==to_date||shiftMapping.singlePopUpEditShift!==shiftid?(isSend=!1,shiftMapping.resetSingleUserParam()):isSend=!0,shiftMapping.singlePopUpEditFrom=from_date,shiftMapping.singlePopUpEditTo=to_date,shiftMapping.singlePopUpEditShift=shiftid}if(isShiftChangeReasonMandatory&&""===desc)return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.enterreasonforshiftchange")),void shiftMapping.resetSingleUserParam();modal.find("#shftmapping #zp_shared_sub_list_header button").off("click"),modal.find("#shftmapping #zp_shared_sub_list_header button").on("click",function(){modal.find("#shftmapping div.modal-footer div").remove()});var params={shiftid:shiftid,mode:"addUserShiftMapping",conreqcsr:csrfToken};if(isEmpChooseApp){var appErecno=Att_Common_Operations.getEmpChosenApprErecno(modal,"ZPAtt_shift_approverId");if(""===appErecno)return;params.empChoosenApprErecno=appErecno}if(ereclist&&0!==ereclist.length&&(params.erecno=ereclist.toString()),""!==from_date&&(params.fdate=from_date),""!==to_date&&(params.tdate=to_date),""!==desc){if(desc.length>250)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.leave.cancell.error.reasonlength"));params.desc=desc}if(!0===isSend){if(params.update=!0,!params.erecno)return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.excludedalluser"))}else(locList&&0!==locList.length||empTypeList&&0!==empTypeList.length)&&(locList&&0!==locList.length&&(params.locList=locList.toString()),empTypeList&&0!==empTypeList.length&&(params.empTypeList=empTypeList.toString()));params.updateAttEntries=!1,!0===modal.find("#ZPAtt_updAttEntryOnShift")[0].checked&&(params.updateAttEntries=!0),modal.find("#zp_modal_blubtn").prop("disabled",!0),$.post("/AttendanceShiftAction.zp",params,function(rdata){modal.find("#zp_modal_blubtn").prop("disabled",!1);var shiftMapAddPopup=modal.find("#shftmapping");if(shiftMapping.emptyLocList=[],shiftMapping.emptyEmpTypeList=[],rdata.error)rdata.error===ZPI18N.getString("zp.cannoteditpastshift")?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.cannoteditpastshift")):"from date greater"===rdata.error?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")):"payPeriodExceed"===rdata.error?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.attendance.shiftChange.immutableinfo")):"Todate is mandatory when pattern mapped"===rdata.error&&ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.todatemandatorywhenpatternset"));else if(rdata.emptyLocList||rdata.emptyEmpTypeList){rdata.emptyLocList&&(shiftMapping.consEmptyAppCont(rdata.emptyLocList,"emptyLocList",ZPI18N.getString("zp.noempinbelowloc")),shiftMapping.emptyLocList=rdata.emptyLocList),rdata.emptyEmpTypeList&&(shiftMapping.consEmptyAppCont(rdata.emptyEmpTypeList,"emptyEmpTypeList",ZPI18N.getString("zp.noempinbelowemptype")),shiftMapping.emptyEmpTypeList=rdata.emptyEmpTypeList);var secns=modal.find(".zpl_crdcnt .zpl_secn");secns.eq(secns.length-2)[0].scrollIntoView()}else{if(rdata.error||rdata.result.error)return"from date greater"===rdata.error&&ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")),void shiftMapAddPopup.find(".div.modal-footer div").hide();(!0===isSend||rdata.result.msg)&&(modal.remove(),Attendance.resetForLoadData(),Att_Common_Operations.isShiftReqPage()?shiftRequest.getShiftMapRequest(!1):Att_Common_Operations.isSelfReqPage()?(SingleUserShiftMapping.resetOtherTabValues(),shiftMapping.isCalView?CalendarView.constructBasicData(SingleUserShiftMapping.calObj):SingleUserShiftMapping.getWeeklyData()):shiftMapping.isListView?(shiftMapping.getUserListView(),shiftMapping.resetFilterInputsForReload(),shiftMapping.userCalValue=null,shiftMapping.userHoursValue=null):shiftMapping.isHoursView?(shiftMapping.userHoursValue=null,shiftMapping.getHoursListView(),shiftMapping.resetFilterInputsForReload(),shiftMapping.userListValue=null,shiftMapping.userCalValue=null):shiftMapping.isCalView&&(shiftMapping.userCalValue=null,shiftMapping.getUserCalView(),shiftMapping.resetFilterInputsForReload(),shiftMapping.userListValue=null,shiftMapping.userHoursValue=null),isShiftApprConfigured?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.shiftchangerequestraisedsuccess")):ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.shiftmapaddsuccessmsg"))),rdata.result.success||rdata.result.msg||0===Object.keys(rdata.result).length?modal.find("#ZPAtt_updAttEntryOnShift")[0].checked=!1:isSingleUserEdit?(modal.find("#ZPAtt_updAttDivAssignShift").hide(),shiftMapping.consConflictListSingleUser(rdata.result)):(rdata.erecArr&&!Att_Common_Operations.isSelfReqPage()&&(shiftMapping.selectedUserPickList=rdata.erecArr),shiftMapping.consConflictPage(),shiftMapping.consConflictList(rdata.result))}})},consEmptyAppCont:function(emptyList,id,msg){var modal=settingsPage.container.find("#shftmapping");modal.find("#"+id).remove();var html='<div id="'+id+'" class="zpl_secn"><div><div class="zpl_tblres"><table class="zpl_tbl zpl_tblcntr"><thead>';for(var i in html+='<tr><th width="160">'+msg+"</th></tr></thead>",html+="<tbody>",emptyList)html+="<tr><td>"+emptyList[i]+"</td></tr>";html+="</tr></tbody></table></div></div></div>";var secns=modal.find(".zpl_crdcnt .zpl_secn");secns.eq(secns.length-1).after(html),modal.find(".zpl_mfoter .zlabel--blue").html(ZPI18N.getString("zp.continue"))},consConflictList:function(rdata,isAppend,groupNo){var modal=settingsPage.container.find("#conflictPage");isAppend||modal.find("#confictBody").empty();var space="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";for(var erecno in rdata){var html='<tr><td><div class="zpl_em"><div class="zpl_emimg"><img src='+rdata[erecno].empPhoto+'></div><div class="zpl_emdts"><div><em>'+ZPeople.escapeHtml(rdata[erecno].empid)+" </em><b>"+ZPeople.escapeHtml(rdata[erecno].empname)+"</b></div></div></div> </td><td>";if($(AttendanceShift.LayoutId+" #ZPAtt_Shift_importView").hasClass("in")&&(html='<tr class="ZPLRow" id='+groupNo+'><td align="center"></td><td><img class="zpl_emimg" src='+rdata[erecno].empPhoto+'><div class="tltnam ML10 MT10 FL" id="empname_'+erecno+'"></div></td><td>'),rdata[erecno].conflictList)for(var loop=0;rdata[erecno].conflictList[loop];loop++){var dateRange="";void 0!==(shiftDetails=rdata[erecno].conflictList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);var shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftDetails.shiftId],rowClass="";shiftDetails.isModified||(rowClass="red"),rdata[erecno].conflictList.length>1&&rdata[erecno].conflictList.length,html+='<div class="dblerw"><div class="'+rowClass+'">'+shift.shiftName+"<span>("+Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0),html+=")</span></div><em>"+dateRange+"</em></div>"}else html+=ZPI18N.getString("zp.na");if(html+="</td><td>",rdata[erecno].newList)for(loop=0;rdata[erecno].newList[loop];loop++){var shiftDetails;dateRange="";void 0!==(shiftDetails=rdata[erecno].newList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftDetails.shiftId],rowClass="";shiftDetails.isAdded&&(rowClass="grn"),rdata[erecno].newList.length>1&&rdata[erecno].newList.length,html+='<div class="dblerw"><div class="'+rowClass+'">'+shift.shiftName+"<span>("+Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0),html+=")</span></div><em>"+dateRange+"</em></div>"}else html+=ZPI18N.getString("zp.na");html+="</td>",!$(Attendance.ImportNew.importContainer).hasClass("zpl_mopen")&&Att_Common_Operations.isSelfReqPage()||(html+='<td><div class="zpl_hvr"><button id='+erecno+' onClick="shiftMapping.Import.exclude(this);" class="zlabel zlabel--red zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.exclude")+"</button></div></td>"),html+="</tr>",modal.find("tbody").append(html)}},consConflictListSingleUser:function(rdata){var space="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",modal=settingsPage.container.find("#shftmapping"),html='<div class="zpl_secn" id="singleConflict"><div>';for(var erec in html+='<div class="ZPednote"><p class="notdesc">'+ZPI18N.getString("zp.shiftalreadymappedmsg",new Array(""))+"</p>",html+='<div class="zpl_tblres"><table class="zpl_tbl zpl_tblcntr wd100_per"><thead><tr><th>'+ZPI18N.getString("zp.existingshift")+"</th><th>"+ZPI18N.getString("zp.changedshift")+"</th></tr></thead><tbody>",rdata)if(rdata[erec].conflictList)for(var loop=0;rdata[erec].conflictList[loop];loop++){var dateRange="";void 0!==(shiftDetails=rdata[erec].conflictList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);var shiftInfo=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftDetails.shiftId],timings="("+Attendance.disTime(shiftInfo.fTime,!1,!0)+" - "+Attendance.disTime(shiftInfo.tTime,!1,!0)+")",rowClass="";shiftDetails.isModified||(rowClass="red"),html+='<tr><td><div class="dblerw"><div class="'+rowClass+'">'+shiftInfo.shiftName+"<span>"+timings+"</span></div><em>"+dateRange+"</em></div></td>"}else html+="<tr><td>N/A</td>";for(var erec in html+="</tbody></table></div></div></div>",modal.find(".zpl_crdcnt").append(html),rdata)if(rdata[erec].newList)for(loop=0;rdata[erec].newList[loop];loop++){var shiftDetails;dateRange="";void 0!==(shiftDetails=rdata[erec].newList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);rowClass="";shiftDetails.isAdded&&(rowClass="grn");shiftInfo=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftDetails.shiftId],timings="("+Attendance.disTime(shiftInfo.fTime,!1,!0)+" - "+Attendance.disTime(shiftInfo.tTime,!1,!0)+")",html='<td><div class="dblerw"><div class="'+rowClass+'">'+shiftInfo.shiftName+"<span>"+timings+"</span></div><em>"+dateRange+"</em></div></td>";1===modal.find(".zpl_crdcnt tbody tr").eq(loop).length?modal.find(".zpl_crdcnt tbody tr").eq(loop).append(html):modal.find(".zpl_crdcnt tbody").append("<tr><td></td>"+html+"</tr>")}else html=ZPI18N.getString("zp.na"),modal.find(".zpl_crdcnt tbody tr").append("<td>"+html+"</td>")},resetFilterInputsForReload:function(layoutId){var modal=void 0===layoutId?landingPage.find(".zpl_fltr"):layoutId;if(modal.find("[id^=shiftListFilter]").length>0){var filterDivId=Att_Common_Operations.getFilterDivId();ZPeopleComponents.tokenfield(modal.find("#"+filterDivId+"FilterDep")).removeAllTokens(),ZPeopleComponents.tokenfield(modal.find("#"+filterDivId+"FilterDesgn")).removeAllTokens(),ZPeopleComponents.tokenfield(modal.find("#"+filterDivId+"FilterLoc")).removeAllTokens(),ZPeopleComponents.tokenfield(modal.find("#"+filterDivId+"FilterShift")).removeAllTokens()}},deleteShiftMapping:function(extraDetails){var param={mode:"deleteShiftMapping",conreqcsr:csrfToken,usmid:extraDetails.id,erecno:extraDetails.erecno},modal=landingPage;$.post("/AttendanceShiftAction.zp",param,function(){if(shiftMapping.resetFilterInputsForReload(),shiftMapping.userCalValue=null,shiftMapping.userHoursValue=null,ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.shiftmapdeletesuccessmsg")),Attendance.resetForLoadData(),shiftMapping.isPatternConfigured)shiftMapping.getUserListView();else{var obj=modal.find("#"+extraDetails.id);0===$(obj).closest("tr").index()&&($(obj).closest("tr").siblings(":visible").length>0||$(obj).closest("tr").next().hasClass("DN"))?($(obj).closest("tr").nextAll().removeAttr("class"),$(obj).closest("tr").fadeOut("fast",function(){$(obj).closest("tr").hide()})):$(obj).closest("tr").index()>0&&$(obj).closest("tr").siblings(":visible").length>0?$(obj).closest("tr").fadeOut("fast",function(){$(obj).closest("tr").hide()}):$(obj).closest("tr.mapRow").fadeOut("fast",function(){if($(obj).closest("tr.mapRow").hide(),0===$(obj).closest("tbody#shiftLister").children(":visible").length){var rdata=[];rdata.userList=[],shiftMapping.userListValue.userList=[],shiftMapping.consUserListView(rdata)}})}})},getApplicableShiftsCache:function(cont,erecArr,locArr,empTypeArr){var cacheErecArr=shiftMapping.cacheErecArr,cacheLocArr=shiftMapping.cacheLocArr,cacheEmpTypeArr=shiftMapping.cacheEmpTypeArr;if(void 0!=cacheErecArr&&void 0!=cacheLocArr&&void 0!=cacheEmpTypeArr&&cacheErecArr.length===erecArr.length&&cacheLocArr.length===locArr.length&&cacheEmpTypeArr.length===empTypeArr.length){var isCacheNeed=!0;for(var i in erecArr){if(!isCacheNeed)break;var isEmpExist=!1;for(var j in cacheErecArr){if(isEmpExist)break;cacheErecArr[j]===erecArr[i]&&(isEmpExist=!0)}isCacheNeed&=isEmpExist}for(var i in locArr){if(!isCacheNeed)break;var isLocExist=!1;for(var j in cacheLocArr){if(isLocExist)break;cacheLocArr[j]===locArr[i]&&(isLocExist=!0)}isCacheNeed&=isLocExist}for(var i in empTypeArr){if(!isCacheNeed)break;var isEmpTypeExist=!1;for(var j in cacheEmpTypeArr){if(isEmpTypeExist)break;cacheEmpTypeArr[j]===empTypeArr[i]&&(isEmpTypeExist=!0)}isCacheNeed&=isEmpTypeExist}if(isCacheNeed){var shiftList=shiftMapping.applicableShifts,shiftOption=[];for(var shiftId in shiftList)if(-1!==shiftList[shiftId].select){var value=shiftList[shiftId],innerHtml=`<span class="zpl_ellipsis w400">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span title="${value.shiftName}" aria-label="${value.shiftName}" tabindex="0">#label#</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="zpl_dots"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<em title="${value.startTime} - ${value.endTime}" aria-label="${value.startTime} - ${value.endTime}" tabindex="0">${value.startTime} - ${value.endTime}</em>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>`;shiftOption.push({label:decodeHTML(value.shiftName),value:shiftId,innerHTML:innerHtml})}return ZPeopleComponents.select(cont).setAttributes({options:shiftOption,contentType:"custom"}),!0}}else shiftMapping.cacheErecArr=JSON.parse(JSON.stringify(erecArr)),shiftMapping.cacheLocArr=JSON.parse(JSON.stringify(locArr)),shiftMapping.cacheEmpTypeArr=JSON.parse(JSON.stringify(empTypeArr));return!1},conUserList:function(ele,userList){var key=[];if(key.push(ZPPickList.CONSTANTS.USERS),null!==userList&&void 0!==userList){var users=[];$.each(userList,function(index,data){var user={};data.Value?(user.name=data.Value,user.usererec=data.Id):(user.name=data.EMPNAME+", "+data.EMPID,user.usererec=data.ERECNO),users.push(user)}),$(ele).html(ZPPickList.initSingleComponentUser(key,!0,users))}else key.push(ZPPickList.CONSTANTS.LOCATIONS),$(ele).html(ZPPickList.initComponent(key,!0)),$(ele).find(".dropdown-menu").addClass("ZPSchPoP");$(ele).find("#pickListComp").attr("style","width:100%;")},consPageView:function(isFromToggle){var page=landingPage,filterDivId=Att_Common_Operations.getFilterDivId(),id=filterDivId+(shiftMapping.isCalView?shiftMapping.isHoursView?"ZPAtt_userCalHrsView":"ZPAtt_userCalWeekView":"ZPAtt_userShiftList");0==page.find(".zpl_rgtcntinr").find("#"+id).length&&(isFromToggle=void 0,shiftMapping.getCenterCont()),!isFromToggle&&Att_Common_Operations.isFilterOpen()&&Att_Common_Operations.changeFilterClass(),page.removeClass("zpl_tblfxd"),page.removeClass("zpl_tbllftfxd"),page.find("#"+filterDivId+"Date").closest(".zpl_secn").hide(),page.find("#"+filterDivId+"ZPAtt_userShiftList").is(":visible")?shiftMapping.userListValue?isFromToggle&&0==shiftMapping.userListValue.userList.length&&(page.find("#"+filterDivId+"ZPAtt_userShiftList").hide(),page.find(".zpl_rgtcntinr").find("#emptyDivCnt").show()):(ZPeopleComponents.select(page.find("#"+filterDivId+"FilterPeriod")).setValue("0"),ZPeopleComponents.datefield(page.find("#"+filterDivId+"FromDate")).setValue(Att_Common_Operations.getShiftDepLocShiftList().currDate.monthStartDate),ZPeopleComponents.datefield(page.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!0}),ZPeopleComponents.datefield(page.find("#"+filterDivId+"ToDate")).setValue(Att_Common_Operations.getShiftDepLocShiftList().currDate.monthEndDate),ZPeopleComponents.datefield(page.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!0}),page.find("#listcalview_month").html("<b>"+Att_Common_Operations.getShiftDepLocShiftList().dispDate+"</b>"),shiftMapping.getUserListView()):page.find("#"+filterDivId+"ZPAtt_userCalWeekView").is(":visible")?shiftMapping.userCalValue?isFromToggle&&0==shiftMapping.userCalValue.userList.length&&(page.find("#"+filterDivId+"ZPAtt_userCalWeekView").hide(),page.find(".zpl_rgtcntinr").find("#emptyDivCnt").show()):(shiftMapping.userCalValue=null,shiftMapping.getUserCalView()):page.find("#"+filterDivId+"ZPAtt_userCalHrsView").is(":visible")&&(page.find("#"+filterDivId+"Date").closest(".zpl_secn").show(),shiftMapping.userHoursValue?isFromToggle&&0==shiftMapping.userHoursValue.userList.length&&(page.find("#"+filterDivId+"ZPAtt_userCalHrsView").hide(),page.find(".zpl_rgtcntinr").find("#emptyDivCnt").show()):(shiftMapping.userHoursValue=null,shiftMapping.getHoursListView())),page.addClass("zpl_tblfxd"),page.addClass("zpl_tbllftfxd"),TimelySettings.constructTopFilter(),shiftMapping.isAssignShiftPermAvailableForPage()?page.find("#assignShiftButton").show():page.find("#assignShiftButton").hide()},editUserShift:function(rdata){var indexToEdit=shiftMapping.selEditRowIndex;let minStarttd=shiftMapping.userHoursValue.minStarttd,maxEndtd=shiftMapping.userHoursValue.maxEndtd;var shiftLister=landingPage.find("#hrs_shiftLister");rdata.userList=rdata.userShiftList,shiftMapping.setStartAndEndTdCount(rdata,minStarttd,maxEndtd);shiftMapping.userHoursValue.starttd,shiftMapping.userHoursValue.endtd;rows=shiftLister.find("> tr").eq(indexToEdit),rdata.shiftList=null;rdata.shiftList=rdata.userShiftList[0].shiftList,rdata.erecno=rdata.userShiftList[0].erecno,shiftLister.find("> tr").eq(indexToEdit).find("td:last-child").html(shiftMapping.getHoursViewSingleDayHtml(rdata,{}));var layout=landingPage;layout.find("#hrsViewDynamicHdr").empty(),layout.find("#hrsViewDynamicHdr").html(shiftMapping.getHrViewHeader(shiftMapping.userHoursValue.minStarttd,shiftMapping.userHoursValue.maxEndtd)),shiftMapping.isTDUpdated&&shiftMapping.reConstructHoursView()},hoursListStartIndex:0,getHoursListView:function(isScroll){var layout=landingPage;layout.removeClass("zpl_tblfxd"),layout.removeClass("zpl_tbllftfxd");var oldParam=shiftMapping.userHoursValue,param={mode:"getUserCalView",conreqcsr:csrfToken};layout.find("#editShiftTopBand").removeClass("opn"),param.isHoursView=!0,param.isFromLeave=shiftMapping.isFromLeavePage();var shiftFilter=layout.find(".zpl_fltr");shiftMapping.getShiftFilterValues(shiftFilter,param,!0),param.returned||(landingPageURL.includes("attendance")&&(param.isMyTeamData=!0),shiftMapping.isHoursAsc=null,Att_Common_Operations.getSortParams(param),isScroll?(oldParam.sdate===param.sdate&&oldParam.locId===param.locId&&oldParam.depId===param.depId&&oldParam.userId===param.userId||(param=shiftMapping.hoursviewParam),param.startIndex=shiftMapping.hoursListStartIndex+1):(layout.find(".zpl_rgtcntinr").find("#emptPage").is(":visible")&&layout.find(".zpl_rgtcntinr").find("#emptyDivCnt").hide(),TimelySettings.showHideLoadingPage(!0)),$.post("/AttendanceShiftAction.zp",param,function(rdata){if(layout.addClass("zpl_tblfxd"),layout.addClass("zpl_tbllftfxd"),rdata.error)return void("exceeded dates"===rdata.error?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.datewithinoneweek")):"from date greater"===rdata.error&&ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")));if(rdata.newSettingsPermDenied)return void TimelySettings.showHidePermissionDenied(!0);TimelySettings.showHideLoadingPage(!1),shiftMapping.hoursviewParam=param,shiftMapping.leaveTypes=rdata.leaveTypes;var filterDivId=Att_Common_Operations.getFilterDivId();let minStarttd,maxEndtd;shiftMapping.hoursviewParam.period=ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).getValue(),50===rdata.userList.length&&shiftMapping.getFireScrollObj().reset(),isScroll||(shiftMapping.hoursListStartIndex=0,null!==shiftMapping.userHoursValue&&(shiftMapping.userHoursValue.minStarttd=void 0,shiftMapping.userHoursValue.maxEndtd=void 0)),null!==shiftMapping.userHoursValue&&(minStarttd=shiftMapping.userHoursValue.minStarttd,maxEndtd=shiftMapping.userHoursValue.maxEndtd),shiftMapping.userHoursValue=null,layout.find(".zpl_btnmnu").find("#listcalview_month").html("<b>"+rdata.date_details.startdate+"<b>"),shiftMapping.userHoursValue=rdata,shiftMapping.setStartAndEndTdCount(rdata,minStarttd,maxEndtd),shiftMapping.consHoursViewList(rdata,isScroll)}))},consHoursViewList:function(rdata,isScroll){var layout=landingPage,filterDivId=Att_Common_Operations.getFilterDivId();if(0===rdata.userList.length&&!isScroll)return layout.find(".zpl_rgtcnt").find("#"+filterDivId+"ZPAtt_userCalHrsView").hide(),void(0===layout.find(".zpl_rgtcntinr").find("#emptPage").length?(layout.find(".zpl_rgtcntinr").append('<div id="emptyDivCnt"></div>'),Att_Common_Operations.noDataFoundImage(ZPI18N.getString("zp.nodatafound"))):layout.find(".zpl_rgtcntinr").find("#emptyDivCnt").show());layout.find("#emptyDivCnt").hide(),layout.find("#"+filterDivId+"ZPAtt_userCalHrsView").show();var isAllBulkShiftSelected=!1,showCheckBox=shiftMapping.isAssignShiftPermAvailableForPage();if(isScroll)showCheckBox&&(isAllBulkShiftSelected=layout.find("#bulkHrShiftChange")[0].checked);else{layout.find("#hrsViewHeader").empty(),layout.find("#hrs_shiftLister").empty();var sortClass="PI_sort tooltip-js";void 0!=shiftMapping.hoursviewParam.isEmpSortAsc&&(sortClass+=shiftMapping.hoursviewParam.isEmpSortAsc?" asc":" desc");var secTDCSS="",html="";showCheckBox&&(secTDCSS=' class="mw300" style="position: sticky;left: 40px;z-index: 2;"',html+='<th class="mw40" style="position: sticky;z-index: 2;"><div class="zcheckbox"><input id="bulkHrShiftChange" type="checkbox" class="zcheckbox__helper" onclick="shiftMapping.bulkShiftChangeSel(this)">',html+='<label for="bulkHrShiftChange" class="zcheckbox__label"></label></div></th>'),html+="<th"+secTDCSS+">"+ZPI18N.getString("zp.employee")+'<div class="zpl_icncnt"><i class="'+sortClass+'" id="shiftHrsEmpSort" data-menu-id="sortDropdown" title='+ZPI18N.getString("zp.sort")+'></i></div></th><th><table><thead><tr id="hrsViewDynamicHdr">',html+="</tr></thead></table></th>",layout.find("#hrsViewHeader").append(html)}Att_Common_Operations.addClickEventForSort(),layout.find("#hrsViewDynamicHdr").empty(),layout.find("#hrsViewDynamicHdr").html(shiftMapping.getHrViewHeader(shiftMapping.userHoursValue.minStarttd,shiftMapping.userHoursValue.maxEndtd)),shiftMapping.isTDUpdated&&shiftMapping.reConstructHoursView();for(var obj={},tbody="",i=0;rdata.userList[i];i++){var user=rdata.userList[i];tbody+="<tr>";secTDCSS="";if(showCheckBox){secTDCSS=' class="mw300" style="position: sticky;left: 40px;z-index: 1;"';let checkBxId="bulkHrShiftChange"+user.erecno;tbody+='<td class="mw40" style="position: sticky;z-index: 1;"><div class="zcheckbox"><input id="'+checkBxId+'" type="checkbox" class="zcheckbox__helper" onclick="shiftMapping.bulkShiftChangeSel(this)"',user.shiftList[1].isEdit||(tbody+=' disabled="disabled"'),tbody+='><label for="'+checkBxId+'" class="zcheckbox__label"></label></div></td>'}tbody+="<td"+secTDCSS+'><div class="zpl_em"><div class="zpl_emimg"><img src='+user.empPhoto+'></div> <div class="zpl_emdts"><div class="tooltip-js" data-title-position="bottom" title="'+user.empname+'"><em>'+user.empid+"- </em><b>"+user.empname+"</b></div></div></div></td>",tbody+="<td>"+shiftMapping.getHoursViewSingleDayHtml(user,obj)+"</td></tr>"}layout.find("#hrs_shiftLister").append(tbody),isAllBulkShiftSelected&&(layout.find("input[id*='bulkHrShiftChange']").prop("checked",!0),shiftMapping.showHideEditShiftTopBand())},setStartAndEndTdCount:function(rdata,minStarttd,maxEndtd){var starttd=23,endtd=0;shiftMapping.isTDUpdated=!1;for(var i=0;rdata.userList[i];i++){var userData=rdata.userList[i],shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[userData.shiftList[0].shiftId];let leaveTd=shiftMapping.getLeaveStartAndEnd(userData.shiftList);0!==shift.tTime&&(shift.tTime===shift.fTime||shift.tTime<shift.fTime)&&(starttd=0);var ftime=(shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[userData.shiftList[1].shiftId]).fTime/60,ttime=shift.tTime/60;ttime<ftime&&(ttime+=24),(ftime<starttd||0===ftime)&&(starttd=Math.floor(ftime)),ttime>endtd&&(endtd=Math.ceil(ttime)),0!==ttime&&ttime!==ftime||(endtd=24),leaveTd&&leaveTd.minLeaveStart<starttd&&(starttd=leaveTd.minLeaveStart),leaveTd&&leaveTd.maxLeaveEnd>endtd&&(endtd=leaveTd.maxLeaveEnd)}starttd--,++endtd>24&&(endtd=24),starttd<0&&(starttd=0),void 0===minStarttd||minStarttd>starttd?(shiftMapping.isTDUpdated=!0,shiftMapping.userHoursValue.minStarttd=starttd):void 0!==minStarttd&&(shiftMapping.userHoursValue.minStarttd=minStarttd),void 0===maxEndtd||maxEndtd<endtd?(shiftMapping.isTDUpdated=!0,shiftMapping.userHoursValue.maxEndtd=endtd):maxEndtd&&(shiftMapping.userHoursValue.maxEndtd=maxEndtd),shiftMapping.userHoursValue.starttd=starttd,shiftMapping.userHoursValue.endtd=endtd},getLeaveStartAndEnd:function(shiftList){if(shiftList[0].isLeave&&shiftList[1].isLeave&&shiftList[0].leaveInfo[0].isHourBased&&shiftList[1].leaveInfo[0].isHourBased){let prevDaySession=shiftList[0].leaveInfo[0].session.split("-"),currentDaySession=shiftList[1].leaveInfo[0].session.split("-"),minLeaveStart=Math.min(prevDaySession[0],currentDaySession[0]),maxLeaveEnd=Math.max(prevDaySession[1],currentDaySession[1]);return parseInt(prevDaySession[1])<parseInt(prevDaySession[0])&&(minLeaveStart=0),parseInt(currentDaySession[1])<parseInt(currentDaySession[0])&&(maxLeaveEnd=1380),{minLeaveStart:minLeaveStart/60,maxLeaveEnd:maxLeaveEnd/60}}if(shiftList[0].isLeave&&shiftList[0].leaveInfo[0].isHourBased){let currentDaySession=shiftList[0].leaveInfo[0].session.split("-"),minLeaveStart=currentDaySession[0]/60;return parseInt(currentDaySession[1])<parseInt(currentDaySession[0])&&(minLeaveStart=0),{minLeaveStart:minLeaveStart,maxLeaveEnd:currentDaySession[1]/60}}if(shiftList[1].isLeave&&shiftList[1].leaveInfo[0].isHourBased){let currentDaySession=shiftList[1].leaveInfo[0].session.split("-"),maxLeaveEnd=currentDaySession[1]/60;return parseInt(currentDaySession[1])<parseInt(currentDaySession[0])&&(maxLeaveEnd=23),{minLeaveStart:currentDaySession[0]/60,maxLeaveEnd:maxLeaveEnd}}},getHrViewHeader:function(starttd,endtd){void 0===starttd&&(starttd=0),void 0===endtd&&(endtd=24);for(var html="",k=starttd;k<endtd;k++){var mins=0+60*k;mins>=1440&&(mins-=1440);var time=Attendance.disTime(mins,!0);Attendance.timeFormatIs12hr&&(time=time.substr(0,time.length-2)+" "+time.substr(2,time.length)),html+="<th>"+time+"</th>"}return html},reConstructHoursView:function(){let minStarttd=shiftMapping.userHoursValue.minStarttd,maxEndtd=shiftMapping.userHoursValue.maxEndtd;for(var rows=landingPage.find("#hrs_shiftLister").find("> tr"),index=0;index<rows.length;index++){let curRow=rows.eq(index),curRowTds=$(curRow).find("table td"),starttdDiff=Number(curRow.find("table tr").attr("starttd"))-minStarttd,endtdDiff=maxEndtd-Number(curRow.find("table tr").attr("endtd"));0!==starttdDiff&&$(curRow).find("table tr").attr("starttd",minStarttd),0!==endtdDiff&&$(curRow).find("table tr").attr("endtd",maxEndtd);for(var className=curRow.find("table td").attr("class"),innerIndex=0;innerIndex<starttdDiff;innerIndex++)curRowTds.eq(0).before('<td class="'+className+'">');for(innerIndex=0;innerIndex<endtdDiff;innerIndex++)curRowTds.eq(curRowTds.length-1).after('<td class="'+className+'">');var perCal=60*(maxEndtd-minStarttd)+1,shiftStartMinus=60*minStarttd,multipleNightEntry=!1;curRowTds.find(".zpl_shftdts[class*='jc']:not(.caldprtmntmdl .zpl_shftdts)").length>1&&(multipleNightEntry=!0);for(innerIndex=0;innerIndex<curRowTds.length;innerIndex++){let curTd=curRowTds.eq(innerIndex);if(curTd.children()[0]){var eleToChange=$(curTd.find(".zpl_shftdts:not(.caldprtmntmdl .zpl_shftdts)")[0]);let fTime=Number(curTd.attr("fTime")),tTime=Number(curTd.attr("tTime")),leaveEleToChange=$(curTd.find(".zpl_shftdts:not(.caldprtmntmdl .zpl_shftdts)")[1]),moreElement=$(curTd.find(".calbrmre")),isLeaveAlignmentRequired=!0,isMoreAlignmentRequired=moreElement.length>0,style={};if(leaveEleToChange.length>0){let leaveFTime=Number(leaveEleToChange.attr("ftime")),leaveTTime=Number(leaveEleToChange.attr("ttime"));(fTime>0||tTime>0)&&leaveFTime>=0&&leaveTTime>0&&(isLeaveAlignmentRequired=!1,style=shiftMapping.computeLeaveStyle(leaveFTime,leaveTTime,perCal,minStarttd,maxEndtd),leaveEleToChange.attr("style",`width: ${style.width}%; left: ${style.left}%;`),isMoreAlignmentRequired&&(isMoreAlignmentRequired=!1,moreElement.attr("style",`width: ${style.width}%; left: ${style.left}%;`)))}if(tTime>fTime){let shiftContWidth=60*((tTime-fTime)/60);0!==shiftContWidth&&(style.width=shiftContWidth/perCal*100,style.left=(fTime-shiftStartMinus)/perCal*100)}else if(tTime<fTime||tTime===fTime){let shiftContWidth=60*(24-fTime/60);tTime/perCal!=0&&multipleNightEntry?(style.width=tTime/perCal*100,style.left=0,multipleNightEntry=!1):0===shiftContWidth||multipleNightEntry||(style.width=shiftContWidth/perCal*100,style.left=(fTime-shiftStartMinus)/perCal*100)}eleToChange.attr("style","width:"+style.width+"%; left:"+style.left+"%;"),leaveEleToChange.length>0&&isLeaveAlignmentRequired?(leaveEleToChange.attr("style","width:"+style.width+"%; left:"+style.left+"%;"),isMoreAlignmentRequired&&moreElement.attr("style",`width: ${style.width}%; left: ${style.left}%;`)):isMoreAlignmentRequired&&moreElement.attr("style",`width: ${style.width}%; left: ${style.left}%; top: 64px`)}}}},getHoursViewSingleDayHtml:function(userData,obj){var starttd=shiftMapping.userHoursValue.minStarttd,endtd=shiftMapping.userHoursValue.maxEndtd,perCal=60*(endtd-starttd)+1,shiftStartMinus=60*starttd,shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[userData.shiftList[0].shiftId];(shift.tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(obj[userData.erecno]=shift);var shiftContWidth=perCal;(shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[userData.shiftList[1].shiftId]).fTime,shift.tTime;shift.tTime>shift.fTime?shiftContWidth=60*((shift.tTime-shift.fTime)/60):(shift.tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(shiftContWidth=60*(24-shift.fTime/60));var day_tdata="",night_tdata="",addClass=userData.shiftList[1].isHoliday?"  Hday_bg":userData.shiftList[1].isWeekend?" wknd_bg":"",title=userData.shiftList[1].isHoliday?holiday_disName:userData.shiftList[1].isWeekend?ZPI18N.getString("zp.weekend"):"";title=""!==title?'title="'+title+'"':"";var html='<table id="hrsView_'+userData.erecno+'" class="zpl_lvdatashw"><tbody><tr starttd="'+starttd+'" endtd="'+endtd+'"id="'+userData.erecno+'">';let calClick="";var showCrSrCls="",editIcon="";if(userData.shiftList[1].isEdit&&(calClick+=" onclick=shiftMapping.appendShiftDropDown(this,event)",editIcon=shiftMapping.getEditIconHtml(),showCrSrCls=" zpl_cp"),obj[userData.erecno]&&null!==obj[userData.erecno]){var sDet=obj[userData.erecno],sTime=(sDet.tTime,Attendance.disTime(sDet.fTime,!1,!0)+" - "+Attendance.disTime(sDet.tTime,!1,!0));sDet.tTime/perCal*100!=0&&(night_tdata+=`<td class="${addClass}${showCrSrCls}" fTime="${sDet.fTime}" tTime="${sDet.tTime}" id="${userData.erecno}" ${title}> <div class="zpl_shftdts jc${sDet.colorCode}" style="width:${sDet.tTime/perCal*100}%; left:0%;" data-toggle="tooltip" data-placement="top" data-container="body" title="${sDet.shiftName} / ${sTime}"><div><div>${sDet.shiftName}</div><em>${sTime}</em></div></div>`),obj[userData.erecno]=null}var shiftTime=Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0);day_tdata=`<td class="${addClass}${showCrSrCls}" fTime="${shift.fTime}" tTime="${shift.tTime}" id="${userData.erecno}" ${title}><div class="zpl_shftdts jc${shift.colorCode}" style="width:${shiftContWidth/perCal*100}%; left:${(shift.fTime-shiftStartMinus)/perCal*100}%;" data-toggle="tooltip" data-placement="top" data-container="body" title="${shift.shiftName} / ${shiftTime}" ${calClick}>${editIcon}<div><div>${shift.shiftName}</div><em>${shiftTime}</em></div></div>`;var time=shift.fTime/60,ttime=shift.tTime/60;ttime<time&&(ttime+=24),day_tdata+=shiftMapping.getShiftLeaveInfo(shiftContWidth,shiftStartMinus,userData.shiftList[1],starttd,endtd,perCal),day_tdata+="</td>",(night_tdata+=shiftMapping.getShiftLeaveInfo(shiftContWidth,shiftStartMinus,userData.shiftList[0],starttd,endtd,perCal,!0))&&(night_tdata+="</td>");for(var k=starttd;k<endtd;k++){var isNightShift=!!night_tdata;isNightShift&&0==k&&(html+=night_tdata),time>=k&&time<k+1?html+=day_tdata:0==k&&isNightShift||(html+=time<k&&ttime>k?'<td class="'+addClass+showCrSrCls+'" '+title+"></td>":'<td class="'+addClass+'"'+title+"></td>")}return(shift.tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(obj[userData.erecno]=shift),html+="</tr></tbody></table>"},getShiftLeaveInfo:function(shiftContWidth,shiftStartMinus,shiftData,starttd,endtd,perCal,isNightShift,currentDate){if(!shiftData.isLeave)return"";let curDate,leaveStyle,leaveStyleInfo,leaveInfo=shiftData.leaveInfo;if(currentDate)curDate=currentDate;else{let filterDivId=Att_Common_Operations.getFilterDivId(),shiftFilter=landingPage.find(".zpl_fltr");curDate=ZPeopleComponents.datefield(shiftFilter.find("#"+filterDivId+"Date")).getValue().dateString}let currentShift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftData.shiftId];if(leaveInfo[0].days<1){if((leaveStyleInfo=shiftMapping.getLeaveStyle(leaveInfo,currentShift,perCal,starttd,endtd,isNightShift,shiftData.settingsInfo)).isNightShift=isNightShift,(leaveInfo.isSkipOD||leaveStyleInfo&&leaveStyleInfo.isDayNightTd)&&(leaveStyleInfo.top="64px"),leaveInfo.isSkipOD&&(leaveStyleInfo.width=isNightShift?currentShift.tTime/perCal*100:shiftContWidth/perCal*100,leaveStyleInfo.left=isNightShift?0:(currentShift.fTime-shiftStartMinus)/perCal*100),0==leaveStyleInfo.width&&0==leaveStyleInfo.left||1440==leaveStyleInfo.width&&1440==leaveStyleInfo.left)return"";leaveStyle=`style="width:${leaveStyleInfo.width}%; left:${leaveStyleInfo.left}%; ${leaveStyleInfo.top?`top: ${leaveStyleInfo.top};`:""}"`}else if(isNightShift){if(!(currentShift.tTime<=currentShift.fTime&&currentShift.fTime>0))return"";leaveStyle=`style="width:${currentShift.tTime/perCal*100}%; left:0%;"`}else leaveStyle='style="width:'+shiftContWidth/perCal*100+"%; left:"+(currentShift.fTime-shiftStartMinus)/perCal*100+'%;"';let leaveInfoHtml=shiftMapping.consLeaveInfo(currentShift,curDate,leaveInfo,leaveStyle,leaveStyleInfo);return leaveStyleInfo&&leaveStyleInfo.isDayNightTd&&(leaveInfoHtml="<td>"+leaveInfoHtml),leaveInfoHtml},consLeaveInfo:function(shift,curDate,leaveArr,style,leaveStyleInfo){const shiftDuration=Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0);let trow="";if(0==leaveArr.length)return trow;let leaveTypeColor=shiftMapping.getLeaveTypeColor(leaveArr[0]);if(leaveArr.length>1||leaveArr.isSkipOD){let leaveCount=leaveArr.length-1;leaveArr.isSkipOD&&(leaveCount+=1);const leaveStatus=shiftMapping.constructLeaveStatus(leaveArr[0]);if(!leaveArr.isSkipOD){let leaveDuration,attDate;if(leaveArr[0].isHourBased&&(leaveDuration=shiftMapping.getLeaveDuration(leaveArr[0],curDate),leaveTime=leaveArr[0].session.split("-"),leaveTime[0]>1440&&leaveTime[1]>1440&&(!leaveStyleInfo||!leaveStyleInfo.isNightShift))){let date=Calendar.parseDate(curDate,uidateFormat);date.setDate(date.getDate()+1),attDate=Calendar.formatDate(date)}trow+=`<div ftime=${shiftMapping.getLeaveTimeInfo(leaveStyleInfo,"ftime")} ttime=${shiftMapping.getLeaveTimeInfo(leaveStyleInfo,"ttime")} title="${leaveStatus}${leaveDuration?` / ${leaveDuration}${attDate?` (${attDate})`:""}`:""}" class="zpl_shftdts ${leaveTypeColor}" ${style||""}>\n\t\t\t\t\t\t\t\t\t<div class="zpl_ellipsis"><div class="zpl_ellipsis" >${leaveStatus}</div>${leaveDuration?`<em>${leaveDuration}${attDate?` (${attDate})`:""}</em>`:""}</div></div>`,style=style&&style.includes("top")?`style="width:${leaveStyleInfo.width}%; left:${leaveStyleInfo.left}%;"`:style}trow+=`<a class="calbrmre" ${style||""} date=${curDate} onclick="shiftMapping.showAllLeaveInfo(this);"> + ${leaveCount} more</a>\n\t\t\t\t\t\t\t\t<div class="caldprtmntmdl"><a class="IC-cls" onclick="shiftMapping.hideLeaveInfo(this);"></a><h2>${curDate}</h2><div class="caldprtmntmdl_lst">\t\t\t\t\n\t\t\t\t\t\t\t\t<div class="zpl_shftdts jc${shift.colorCode}" id="${shift.shiftId}">\n\t\t\t\t\t\t\t\t<span id="${shift.shiftId}" title="${shift.shiftName} / ${shiftDuration}"> \n\t\t\t\t\t\t\t\t\t\t\t\t${shift.shiftName}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<em>${shiftDuration}</em></div>`,leaveArr.isSkipOD&&delete leaveArr.isSkipOD,leaveArr.forEach(leave=>{const leaveStatus=shiftMapping.constructLeaveStatus(leave);let leaveDuration,attDate;if(leave.isHourBased&&(leaveDuration=shiftMapping.getLeaveDuration(leave,curDate),leaveTime=leave.session.split("-"),leaveTime[0]>1440&&leaveTime[1]>1440&&(!leaveStyleInfo||!leaveStyleInfo.isNightShift))){let date=Calendar.parseDate(curDate,uidateFormat);date.setDate(date.getDate()+1),attDate=Calendar.formatDate(date)}leaveTypeColor=shiftMapping.getLeaveTypeColor(leave),trow+=`<div class = "zpl_shftdts ${leaveTypeColor}" title="${leaveStatus}${leaveDuration?` / ${leaveDuration}${attDate?` (${attDate})`:""}`:""}">\n\t\t\t\t\t\t\t\t\t<div class="zpl_ellipsis"><div class="zpl_ellipsis">${leaveStatus}</div>${leaveDuration?`<em>${leaveDuration}${attDate?` (${attDate})`:""}</em>`:""}</div></div>`}),trow+="</div></div>"}else{const leaveStatus=shiftMapping.constructLeaveStatus(leaveArr[0]);let leaveDuration,attDate;if(leaveArr[0].isHourBased&&(leaveDuration=shiftMapping.getLeaveDuration(leaveArr[0],curDate),leaveTime=leaveArr[0].session.split("-"),leaveTime[0]>1440&&leaveTime[1]>1440&&(!leaveStyleInfo||!leaveStyleInfo.isNightShift))){let date=Calendar.parseDate(curDate,uidateFormat);date.setDate(date.getDate()+1),attDate=Calendar.formatDate(date)}trow+=`<div ftime=${shiftMapping.getLeaveTimeInfo(leaveStyleInfo,"ftime")} ttime=${shiftMapping.getLeaveTimeInfo(leaveStyleInfo,"ttime")} title="${leaveStatus}${leaveDuration?` / ${leaveDuration}${attDate?` (${attDate})`:""}`:""}" class = "zpl_shftdts ${leaveTypeColor}" ${style||""}>\n\t\t\t\t\t\t\t\t<div class="zpl_ellipsis"><div class="zpl_ellipsis">${leaveStatus}</div>${leaveDuration?`<em>${leaveDuration}${attDate?` (${attDate})`:""}</em>`:""}</div></div>`}return trow},getLeaveTimeInfo:function(leaveStyleInfo,key){return leaveStyleInfo?leaveStyleInfo[key]:0},getLeaveDuration:function(leave,curDate){let attendanceDate,[start,end]=leave.session.split("-").map(Number);return leave.isAttOnDuty&&(start>1440&&(start-=1440),end>1440&&(end-=1440),start>1440&&end>1440&&(attendanceDate=new Date(curDate)).setDate(attendanceDate.getDate()+1)),`${Attendance.disTime(start,!1,!0)} - ${Attendance.disTime(end,!1,!0)}`},getLeaveTypeColor:function(leaveInfo){let leave=shiftMapping.leaveTypes.find(leave=>leave.lName===leaveInfo.leaveName);return leave&&leave.lColorCode?leave.lColorCode:"lv_bgbdrs3"},constructLeaveStatus:function(leaveObj){let leaveStatus=leaveObj.leaveName;return leaveObj.daysInWords&&(leaveStatus+=`(${leaveObj.daysInWords})`),ZSEC.Encoder.encodeForHTML(leaveStatus)},getLeaveStyle:function(leaveInfo,shiftInfo,perCal,starttd,endtd,isNightShift,settingsInfo){let fTime=shiftInfo.fTime,tTime=shiftInfo.tTime,isDayNightTd=!1,isAttOnDuty=leaveInfo[0].isAttOnDuty,isFullDayShift=0==fTime&&0==tTime,totalShiftMins=tTime>=fTime?tTime-fTime:1440-fTime+tTime;fTime==tTime&&(totalShiftMins=1440);let leaveTime=[];if(leaveInfo[0].isHourBased){if((leaveTime=leaveInfo[0].session.split("-").map(Number))[1]<leaveTime[0]?isNightShift?(isDayNightTd=fTime<tTime||isFullDayShift,leaveTime[0]=0):leaveTime[1]=1440:isNightShift&&!isAttOnDuty&&(leaveTime[0]=0,leaveTime[1]=0),isAttOnDuty){leaveInfo.isSkipOD=!1;let leaveEndTime=fTime<tTime?leaveTime[1]:leaveTime[1]-1440;(leaveTime[0]<fTime||leaveEndTime>tTime)&&(!isNightShift||tTime<fTime)?leaveInfo.isSkipOD=!0:tTime<=fTime&&!isFullDayShift?isNightShift&&leaveTime[1]>1440?(leaveTime[0]=leaveTime[0]>1440?leaveTime[0]-1440:0,leaveTime[1]-=1440):leaveTime[0]<1440&&!isNightShift?leaveTime[1]=leaveTime[1]>1440?1440:leaveTime[1]:(leaveTime[1]<1440&&isNightShift||leaveTime[0]>1440&&!isNightShift)&&(leaveInfo.isSkipOD=!0):isNightShift&&fTime<=tTime&&(leaveTime[0]=0,leaveTime[1]=0)}}else{let sessionTaken=parseInt(leaveInfo[0].session,10),multiplier=.25==leaveInfo[0].days?totalShiftMins/4:totalShiftMins/2;if(isNightShift){let tempTime=fTime+(sessionTaken-1)*multiplier;tempTime=tempTime<1440?0:tempTime-1440,leaveTime[0]=tempTime,tempTime=(tempTime=fTime+sessionTaken*multiplier)<1440?0:tempTime-1440,leaveTime[1]=tempTime}else{let tempTime=fTime+(sessionTaken-1)*multiplier;tempTime=tempTime>1440?1440:tempTime,leaveTime[0]=tempTime,tempTime=(tempTime=fTime+sessionTaken*multiplier)>1440?1440:tempTime,leaveTime[1]=tempTime}}let styleInfo=shiftMapping.computeLeaveStyle(leaveTime[0],leaveTime[1],perCal,starttd,endtd);return styleInfo.isDayNightTd=isDayNightTd,styleInfo},computeLeaveStyle:function(leaveStartTime,leaveEndTime,perCal,starttd,endtd){let shiftStartMinus=60*starttd,shiftEnd=60*endtd;leaveStartTime=Math.max(leaveStartTime,shiftStartMinus),leaveEndTime=Math.min(leaveEndTime,shiftEnd);let leaveWidth=Math.max(leaveEndTime-leaveStartTime,0)/perCal*100,leaveLeft=0;return leaveWidth>0&&(leaveLeft=(leaveStartTime-shiftStartMinus)/perCal*100),{width:leaveWidth,left:leaveLeft,ftime:leaveStartTime,ttime:leaveEndTime}},getNavigator:function(isPre){var page=landingPage,filterLayout=page.find(".zpl_fltr"),filterDivId=Att_Common_Operations.getFilterDivId();if(page.find("#list_view").hasClass("zpl_act")||page.find("#"+filterDivId+"ZPAtt_userCalWeekView").is(":visible")){if(page.find("#"+filterDivId+"ZPAtt_userCalWeekView").is(":visible")){shiftMapping.userCalValue=null;var nav=1;isPre&&(nav=-1),shiftMapping.getUserCalView(!1,nav)}else{nav=1;isPre&&(nav=-1),shiftMapping.getUserListView(nav)}ZPeopleComponents.datefield(filterLayout.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!1}),ZPeopleComponents.datefield(filterLayout.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!1})}else{var add=1;isPre&&(add=-1);var dateFormat=Att_Common_Operations.getShiftDepLocShiftList().dateformat.toLocaleUpperCase(),fDate=moment(shiftMapping.userHoursValue.dateArray[0],dateFormat).add(add,"days").format(dateFormat);ZPeopleComponents.datefield(filterLayout.find("#"+filterDivId+"Date")).setValue(fDate),ZPeopleComponents.datefield(filterLayout.find("#"+filterDivId+"Date")).setAttributes({disabled:!1}),shiftMapping.hoursListStartIndex=0,shiftMapping.getHoursListView()}ZPeopleComponents.select(filterLayout.find("#"+filterDivId+"FilterPeriod")).setValue("6")},getCenterCont:function(){var html="",page=landingPage,filterDiv=Att_Common_Operations.getFilterDivId(),layout=page.find(".zpl_rgtcntinr");shiftMapping.isCalView?shiftMapping.isHoursView?0===page.find(".zpl_rgtcnt").find("#"+filterDiv+"ZPAtt_userCalHrsView").length&&(html='<div class="zpl_tblres"  id="'+filterDiv+'ZPAtt_userCalHrsView"><div class="_dayvw">',html+='<table class="zpl_tbl zpl_shftmap zpl_nocrsor"><thead><tr id="hrsViewHeader"></tr></thead><tbody id="hrs_shiftLister"></tbody></table></div></div>',layout.append(html)):0===page.find(".zpl_rgtcnt").find("#"+filterDiv+"ZPAtt_userCalWeekView").length&&(html='<div class="zpl_tblres"  id="'+filterDiv+'ZPAtt_userCalWeekView">',html+='<table class="zpl_tbl zpl_shftmap zpl_shftmschdl" rol="grid" tabindex="0"><thead><tr id="calViewHeader"></tr></thead><tbody id="cal_shiftLister"></tbody></table></div>',layout.append(html),$(shiftMapping.getShiftMapPopupHtml(!0)).insertAfter(page.closest(".zpl_iwrpr"))):0===page.find(".zpl_rgtcnt").find("#"+filterDiv+"ZPAtt_userShiftList").length&&(html='<div class="zpl_tblres"  id="'+filterDiv+'ZPAtt_userShiftList">',html+='<table class="zpl_tbl"><thead><tr>',html+='<th width="300px">'+ZPI18N.getString("zp.employee")+'<div class="zpl_icncnt"><i class="PI_sort tooltip-js" id="shiftListEmpSort" data-menu-id="sortDropdown"></i></div></th><th class="P0I"><table class="wd100_per"><thead><tr><th width="300px">'+ZPI18N.getString("zp.shift")+"</th>",html+='<th class = "mw300">'+ZPI18N.getString("zp.modifiedby")+"</th>",html+='<th width="300px">'+ZPI18N.getString("zp.modifiedon")+'</th><th class="w100"></th>',html+='</tr></thead></table></th></tr></thead><tbody id="shiftLister"></tbody></table></div>',layout.append(html),Att_Common_Operations.addClickEventForSort(),Att_Common_Operations.addClickEventAndCallBack(page.find(".CR-sort"),shiftMapping.sort))},userCalCurMon:0,userCalStartIndex:0,getUserCalView:function(isScroll,navigate){var oldParam=shiftMapping.calviewParam,layout=landingPage;layout.find("#editShiftTopBand").removeClass("opn");var param={mode:"getUserCalView",conreqcsr:csrfToken};param.isFromLeave=shiftMapping.isFromLeavePage(),navigate&&(param.navigate=navigate);var shiftFilter=layout.find(".zpl_fltr");if(shiftMapping.getShiftFilterValues(shiftFilter,param),!param.returned){landingPageURL.includes("attendance")&&(param.isMyTeamData=!0),shiftMapping.Asc=null,Att_Common_Operations.getSortParams(param),isScroll?(oldParam.sdate===param.sdate&&oldParam.edate===param.edate&&oldParam.locId===param.locId&&oldParam.depId===param.depId&&oldParam.userId===param.userId||(param=AttendanceShift.calviewParam),param.startIndex=shiftMapping.userCalStartIndex+1):(layout.find("#cal_shiftLister").hide(),layout.find("#cal_shiftLister").prev().hide(),TimelySettings.showHideLoadingPage(!0)),shiftMapping.calviewParam=param;var filterDivId=Att_Common_Operations.getFilterDivId();if(shiftMapping.calviewParam.period=ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).getValue(),param.isInValid)return layout.find("#cal_shiftLister").show(),void layout.find("#cal_shiftLister").prev().show();$.post("/AttendanceShiftAction.zp",param,function(rdata){if(TimelySettings.showHideLoadingPage(!1),rdata.error)return layout.find("#cal_shiftLister").show().prev().show(),void("exceeded dates"===rdata.error?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.datewithinonemonth")):"from date greater"===rdata.error&&ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")));if(rdata.newSettingsPermDenied)TimelySettings.showHidePermissionDenied(!0);else{shiftMapping.calviewParam.sdate=rdata.date_details.startdate,shiftMapping.calviewParam.edate=rdata.date_details.enddate,shiftMapping.leaveTypes=rdata.leaveTypes,50===rdata.userList.length&&shiftMapping.getFireScrollObj().reset(),isScroll||(shiftMapping.userCalStartIndex=0,layout.find(".zpl_rgtcntinr #"+filterDivId+"ZPAtt_userCalWeekView").scrollTop(0)),shiftMapping.userCalValue=null,ZPeopleComponents.datefield(shiftFilter.find("#"+filterDivId+"FromDate")).setValue(rdata.date_details.startdate),ZPeopleComponents.datefield(shiftFilter.find("#"+filterDivId+"ToDate")).setValue(rdata.date_details.enddate);var dateNav=layout.find(".zpl_btnmnu").find("#listcalview_month");if(rdata.dispMonth)dateNav.html("<b>"+rdata.dispMonth+"</b>"),layout.find("#calViewListViewTog").children().eq(0).html(ZPI18N.getString("zp.monthly"));else{var dateRange=Attendance.datesInHeader(rdata.date_details.startdate,rdata.date_details.enddate);dateNav.html("<b>"+dateRange+"</b>"),layout.find("#calViewListViewTog").children().eq(0).html(ZPI18N.getString("zp.weekly")),dateNav.attr({"aria-label":ZPI18N.getString("zp.common.period")+":"+dateRange,tabindex:"0"})}shiftMapping.fromNavigater&&(ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).setValue("6"),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!0}),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!0})),shiftMapping.userCalValue=rdata,shiftMapping.consUserCalList(rdata,isScroll)}})}},consUserCalList:function(rdata,isScroll){var filterDivId=Att_Common_Operations.getFilterDivId(),layout=landingPage.find(".zpl_rgtcntinr");if(0===rdata.userList.length&&!isScroll)return layout.find("#"+filterDivId+"ZPAtt_userCalWeekView").hide(),void(0===layout.find("#emptPage").length?(layout.append('<div id="emptyDivCnt"></div>'),Att_Common_Operations.noDataFoundImage(ZPI18N.getString("zp.nodatafound"))):layout.find("#emptyDivCnt").show());layout.find("#emptyDivCnt").hide(),layout.find("#"+filterDivId+"ZPAtt_userCalWeekView").show();var isAllBulkShiftSelected=!1,showCheckBox=shiftMapping.isAssignShiftPermAvailableForPage();if(isScroll)showCheckBox&&(isAllBulkShiftSelected=layout.find("#bulkShiftChange")[0].checked);else{layout.find("#calViewHeader").empty(),layout.find("#cal_shiftLister").empty();var sortClass="PI_sort tooltip-js";void 0!=shiftMapping.calviewParam.isEmpSortAsc&&(sortClass+=shiftMapping.calviewParam.isEmpSortAsc?" asc":" desc");var header="",secTDCSS="";showCheckBox&&(secTDCSS=' class="mw300" style="position: sticky;left: 40px;z-index: 1;"',header+='<th class="mw40"><div class="zcheckbox"><input id="bulkShiftChange" type="checkbox" class="zcheckbox__helper" onclick="shiftMapping.bulkShiftChangeSel(this)">',header+='<label for="bulkShiftChange" class="zcheckbox__label"></label></div></th>'),header+="<th"+secTDCSS+">"+ZPI18N.getString("zp.employee")+"</span><div class='zpl_icncnt'><i class='"+sortClass+"' id='shiftWeekEmpSort' data-menu-id='sortDropdown'></i></div></th>",layout.find("#calViewHeader").append(header);for(var i=0;rdata.statusHeader[i];i++){var status=shiftMapping.userCalValue.statusHeader[i],curDayClass="";Att_Common_Operations.getShiftDepLocShiftList().currDate.todayDate===rdata.dateArray[i]&&(curDayClass="Cl-today");var html="<th class='"+curDayClass+"'><div><small>"+days[status.split("-")[2]-1]+"</small><font>"+status.split("-")[0]+"</font></div></th>";layout.find("#calViewHeader").append(html)}}Att_Common_Operations.addClickEventForSort();shiftMapping.userCalStartIndex;var userList=rdata.userList;for(i=0;userList[i];i++){var user=userList[i],empId=user.empid,empName=user.empname,empErecno=user.erecno;html='<tr id="'+empErecno+'">',secTDCSS="";if(showCheckBox){secTDCSS=' class="mw300" style="position: sticky;left: 40px;z-index: 1;"';let checkBxId="bulkShiftChange"+empErecno;html+='<td class="mw40" style="position: sticky;z-index: 1;"><div class="zcheckbox"><input id="'+checkBxId+'" type="checkbox" class="zcheckbox__helper" onclick="shiftMapping.bulkShiftChangeSel(this)"',user.isEditFuture||(html+=' disabled="disabled"'),html+='><label for="'+checkBxId+'" class="zcheckbox__label"></label></div></td>'}html+="<td"+secTDCSS+'><div class="zpl_em"><div class="zpl_emimg"><img src='+user.empPhoto+"></div>",html+='<div class="zpl_emdts"><div><span class="ellipsis CP W200" data-toggle="tooltip" data-placement="top" data-container="body" title="'+empName+'"><em id="cal_shiftId">'+empId+' - </em><b id="cal_shiftName">'+empName+"</b></span></div></td>";for(var loop=0;user.shiftList[loop];loop++){var curDayDet=user.shiftList[loop],shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[curDayDet.shiftId],className="";let shiftClassName="zpl_shftdts jc"+shift.colorCode;var title="",shiftTitle=shift.shiftName;if(curDayDet.isWeekend){className+=" Cl-wked",title=ZPI18N.getString("zp.weekend");var endClose=curDayDet.isHoliday?"":")";shiftTitle+=" ("+ZPI18N.getString("zp.weekend")+endClose}if(curDayDet.isHoliday&&(className+=" Cl-hlday",title=holiday_disName,shiftTitle+=curDayDet.isWeekend?"/"+holiday_disName+")":" ("+holiday_disName+")"),trow=`<td title="${title}" class="${className}" id="${shift.shiftId}">`,curDayDet.isEdit){trow+=`<div class="${shiftClassName}" id="${empErecno}" ${"onclick=shiftMapping.appendShiftDropDown(this.parentElement)"}>`,trow+='<div class="zpl_shftedit"><i class="PI_edt"></i></div>'}else trow+=`<div class="${shiftClassName}" id="${empErecno}">`;let shiftDuration=`${Attendance.disTime(shift.fTime,!1,!0)} - ${Attendance.disTime(shift.tTime,!1,!0)}`;trow+=`<span id="${empErecno}" title="${shiftTitle} / ${shiftDuration}"> \n\t\t\t\t\t          ${shift.shiftName}</span>\n                              <em>${shiftDuration}</em>`,trow+="</div>",curDayDet.isLeave&&(trow+=shiftMapping.consLeaveInfo(shift,rdata.dateArray[loop],curDayDet.leaveInfo)),trow+="</td>",html+=trow}html+="</tr>",layout.find("#cal_shiftLister").append(html),0}if(isAllBulkShiftSelected&&(layout.find("input[id*='bulkShiftChange']").prop("checked",!0),shiftMapping.showHideEditShiftTopBand()),layout.find("#cal_shiftLister").show(),layout.find("#cal_shiftLister").prev().show(),!isScroll){var headerOff=layout.find("#calViewHeader").offset(),headerHei=layout.find("#calViewHeader").height();layout.find("#calViewHeader").attr("top",headerOff.top),layout.find("#calViewHeader").attr("height",headerHei)}},bulkShiftChangeSel:function(obj){var id=shiftMapping.getBulkShiftChangeId(),page=settingsPage.container;if("bulkShiftChange"===obj.id||"bulkHrShiftChange"===obj.id||"bulkShiftSelectSettings"===obj.id||"bulkShiftSelectOperations"===obj.id)page.find("input[id*='"+id+"']:enabled").prop("checked",obj.checked);else if(obj.checked){page.find("input[id*='"+id+"']:enabled").length-page.find("input[id*='"+id+"']:enabled:checked").length==1&&page.find("input[id*='"+id+"']:enabled").prop("checked",obj.checked)}else page.find("#"+id).prop("checked",!1);shiftMapping.showHideEditShiftTopBand(id)},showHideEditShiftTopBand:function(){var id=shiftMapping.getBulkShiftChangeId(),page=settingsPage.container;page.find("input[id*='"+id+"']:checked").length>0?page.find("#editShiftTopBand").addClass("opn"):page.find("#editShiftTopBand").removeClass("opn")},closeEditShiftTopBand:function(){var id=shiftMapping.getBulkShiftChangeId(),page=settingsPage.container;page.find("#editShiftTopBand").removeClass("opn"),page.find("input[id*='"+id+"']").prop("checked",!1)},bulkEditShift:function(){for(var id=shiftMapping.getBulkShiftChangeId(),page=settingsPage.container,selectedErecnos=[],selectedRows=page.find("input[id*='"+id+"']:checked"),index=0;index<selectedRows.length;index++)selectedRows.eq(index)[0].id!==""+id&&selectedErecnos.push(selectedRows.eq(index)[0].id.split(""+id)[1]);var values=AppExc.getEmpValues(selectedErecnos);shiftMapping.constructAssignShift(),TimelyZComp.tokenField.addValues(page.find("#shftmapping").find("#empSel"),values)},getBulkShiftChangeId:function(){return shiftMapping.isHoursView?"bulkHrShiftChange":"operations-shift-manageshifts"==Layout.Page.pageId?"bulkShiftSelectOperations":"settings-service-shift-manage"==Layout.Page.pageId?"bulkShiftSelectSettings":"bulkShiftChange"},constructshiftOption:function(params){var moreopt=params.more.options;if(moreopt.length>0){var mhtml='<div id="moreoptionmenu"><ul>';$.each(moreopt,function(indx,value){mhtml+='<li data-action="'+value.callback+'" id="'+value.id+'">'+value.name+"</li>"}),mhtml+="</ul></div>",settingsPage.container.append(mhtml),ZPeopleComponents.menu("#moreoptionmenu",{forElement:"#"})}},dateLessThanOrEqualCurrDate:function(date,isLessThan){var givenDate=new Date(moment(date,dateFmt.toUpperCase()).utcOffset(Att_Common_Operations.getShiftDepLocShiftList().currDate.offSet)._d).getTime(),currDate=new Date(moment().utcOffset(Att_Common_Operations.getShiftDepLocShiftList().currDate.offSet).startOf("day")._d).getTime();return isLessThan?givenDate<currDate:givenDate<=currDate},shiftView:function(id){var layout=landingPage,filterId=Att_Common_Operations.getFilterDivId();if($("#"+filterId+"MoreOptions").find("i.PI_print").closest("li").hide(),!$(id).hasClass("zpl_act")){var alterMode=$(id).attr("id");$(id).addClass("zpl_act"),"weekly"===alterMode?($(id).next().removeClass("zpl_act"),shiftMapping.setDateProps(layout),layout.find("#"+filterId+"ZPAtt_userCalHrsView").hide(),layout.find("#"+filterId+"ZPAtt_userCalWeekView").show(),shiftMapping.setDateValueForCalView(layout),void 0==shiftMapping.hoursviewParam||void 0==shiftMapping.calviewParam||shiftMapping.hoursviewParam.depId==shiftMapping.calviewParam.depId&&shiftMapping.hoursviewParam.locId==shiftMapping.calviewParam.locId&&shiftMapping.hoursviewParam.shiftId==shiftMapping.calviewParam.shiftId&&shiftMapping.hoursviewParam.userId==shiftMapping.calviewParam.userId||(shiftMapping.userCalValue=null),shiftMapping.isHoursView=!1,shiftMapping.consPageView(!0)):($(id).prev().removeClass("zpl_act"),0==$("#"+filterId+"MoreOptions").find("i.PI_print").closest("li").length?ZPeopleComponents.menu("#"+filterId+"MoreOptions").addMenuItem({label:ZPI18N.getString("zp.print"),iconClass:"PI_print",action:"Att_Common_Operations.print"}):$("#"+filterId+"MoreOptions").find("i.PI_print").closest("li").show(),shiftMapping.setDateProps(layout,!0),layout.find("#"+filterId+"ZPAtt_userCalWeekView").hide(),layout.find("#"+filterId+"ZPAtt_userCalHrsView").show(),void 0==shiftMapping.hoursviewParam||void 0==shiftMapping.calviewParam||shiftMapping.hoursviewParam.depId==shiftMapping.calviewParam.depId&&shiftMapping.hoursviewParam.locId==shiftMapping.calviewParam.locId&&shiftMapping.hoursviewParam.shiftId==shiftMapping.calviewParam.shiftId&&shiftMapping.hoursviewParam.userId==shiftMapping.calviewParam.userId||(shiftMapping.userHoursValue=null),shiftMapping.isHoursView=!0,shiftMapping.consPageView(!0))}},setDateProps:function(layout,isHoursView){var filterDivId=Att_Common_Operations.getFilterDivId();if(isHoursView){layout.find("#"+filterDivId+"Date").closest(".zpl_secn").show(),layout.find("#"+filterDivId+"FromDate").closest(".zpl_secn").hide(),layout.find("#"+filterDivId+"ToDate").closest(".zpl_secn").hide();options=["0","1","2","3"];ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).removeOption(options),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"Date")).setAttributes({disabled:!0}),void 0===shiftMapping.hoursviewParam?(ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).setValue("4"),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"Date")).setAttributes({placeholder:ZPI18N.getString("zp.date")}),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"Date")).setValue(Att_Common_Operations.getShiftDepLocShiftList().currDate.todayDate)):(ZPeopleComponents.datefield(layout.find("#"+filterDivId+"Date")).setValue(shiftMapping.hoursviewParam.sdate),layout.find(".zpl_btnmnu").find("#listcalview_month").html("<b>"+shiftMapping.hoursviewParam.sdate+"</b>"),ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).setValue(shiftMapping.hoursviewParam.period),"6"==shiftMapping.hoursviewParam.period&&ZPeopleComponents.datefield(layout.find("#"+filterDivId+"Date")).setAttributes({disabled:!1}))}else{layout.find("#"+filterDivId+"Date").closest(".zpl_secn").hide(),layout.find("#"+filterDivId+"FromDate").closest(".zpl_secn").show(),layout.find("#"+filterDivId+"ToDate").closest(".zpl_secn").show();var options=["4","5","6"];ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).removeOption(options),(options=[]).push({label:ZPI18N.getString("zp.today"),value:"4"}),options.push({label:ZPI18N.getString("zp.yesterday"),value:"5"}),options.push({label:ZPI18N.getString("zp.thisweek"),value:"2"}),options.push({label:ZPI18N.getString("zp.lastweek"),value:"3"}),options.push({label:ZPI18N.getString("zp.onlyparticularmonth"),value:"0"}),options.push({label:ZPI18N.getString("zp.lastmonth"),value:"1"}),options.push({label:ZPI18N.getString("zp.custom"),value:"6"}),ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).setAttributes({options:options,multiple:!1}),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!1,placeholder:ZPI18N.getString("zp.from")}),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!1,placeholder:ZPI18N.getString("zp.to")}),shiftMapping.isCalView?void 0!==shiftMapping.calviewParam&&(ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).setValue(shiftMapping.calviewParam.period),void 0!==shiftMapping.calviewParam&&"6"!=shiftMapping.calviewParam.period&&(ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!0}),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!0}))):void 0!==shiftMapping.listviewParam&&(ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).setValue(shiftMapping.listviewParam.period),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setValue(shiftMapping.listviewParam.sdate),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setValue(shiftMapping.listviewParam.edate),void 0!==shiftMapping.listviewParam&&"6"!=shiftMapping.listviewParam.period&&(ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!0}),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!0})))}},setDateValueForCalView:function(layout){var filterDivId=Att_Common_Operations.getFilterDivId();if(void 0!==shiftMapping.calviewParam){ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setValue(shiftMapping.calviewParam.sdate),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setValue(shiftMapping.calviewParam.edate);moment(shiftMapping.calviewParam.edate,dateFmt.toUpperCase()).diff(moment(shiftMapping.calviewParam.sdate,dateFmt.toUpperCase()),"days");var calView=shiftMapping.userCalValue;if(null!==calView){var dateDetails=calView.date_details,dateNav=layout.find(".zpl_btnmnu").find("#listcalview_month");calView.dispMonth?(dateNav.html("<b>"+calView.dispMonth+"</b>"),layout.find("#calViewListViewTog").children().eq(0).html(ZPI18N.getString("zp.monthly")+"</b>")):(dateNav.html("<b>"+Attendance.datesInHeader(dateDetails.startdate,dateDetails.enddate)),layout.find("#calViewListViewTog").children().eq(0).html(ZPI18N.getString("zp.weekly")))}}else{ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).setValue("2"),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!0}),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!0}),shiftMapping.fromNavigater=!1;var datFormat=dateFmt.toUpperCase(),toDay=moment(Att_Common_Operations.getShiftDepLocShiftList().currDate.todayDate,datFormat),weekStartDate=moment(toDay).startOf("week").add(weekstarts,"day"),weekEndDate=moment(toDay).startOf("week").add(weekstarts,"day").add(6,"day");ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setValue(weekStartDate.format(datFormat)),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!0}),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setValue(weekEndDate.format(datFormat)),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!0})}},shiftCalEditObj:null,appendShiftDropDown:function(obj){var id=Att_Common_Operations.getFilterDivId();$(obj).attr("id","changeShiftClickButtonId");var shiftDropDown=$("#"+id+"SingleDayEdit"),val=obj.closest("tr").parentElement.closest("tr");shiftMapping.selEditRowIndex=null!==val?val.rowIndex-1:-1,shiftDropDown.find(".zpl_aprvlst").empty();var elemOff=$(obj).offset(),elemHei=$(obj).height(),docHei=$(document).height(),elemBot=elemOff.top+elemHei;let header=Att_Common_Operations.isSelfReqPage()&&shiftMapping.isHoursView?landingPage.find("#weeklyViewHeader"):shiftMapping.isHoursView?landingPage.find("#hrsViewDynamicHdr"):landingPage.find("#calViewHeader");var rowBot=parseInt(header.offset().top)+parseInt(header.height());shiftMapping.shiftCalEditObj=obj;var dropdownHei=shiftDropDown.height(),posi="top",topfix=elemBot+elemHei+70,left=void 0!==event?event.clientX-170:elemOff.left-100;elemBot+dropdownHei>=docHei&&(topfix=elemBot-dropdownHei+50,posi="bottom"),topfix-=rowBot,shiftDropDown.addClass(" "+posi),shiftDropDown.css({top:topfix+"px"}),shiftDropDown.css({left:left+"px"}),shiftDropDown.hide(),shiftMapping.getApplicableShifts(obj.parentElement.id,!0,obj)},reInitFieldValue:function(isFromToggle){var layout=landingPage.find(".zpl_fltr"),filterDivId=Att_Common_Operations.getFilterDivId();if(layout.find("#"+filterDivId+"Date").closest(".zpl_secn").hide(),shiftMapping.isCalView||shiftMapping.userListValue){if(shiftMapping.isCalView){if(!shiftMapping.userCalValue&&!isFromToggle){ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).setValue("2");var datFormat=dateFmt.toUpperCase(),toDay=moment(Att_Common_Operations.getShiftDepLocShiftList().currDate.todayDate,datFormat),weekStartDate=moment(toDay).startOf("week").add(weekstarts,"day"),weekEndDate=moment(toDay).startOf("week").add(weekstarts,"day").add(6,"day");void 0!==ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).getValue().dateString&&(ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setValue(weekStartDate.format(datFormat)),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!0})),void 0!==ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).getValue().dateString&&(ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setValue(weekEndDate.format(datFormat)),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!0}))}shiftMapping.isHoursView&&!shiftMapping.userHoursValue&&(layout.find("#"+filterDivId+"Date").closest(".zpl_secn").show(),layout.find("#"+filterDivId+"FromDate").closest(".zpl_secn").hide(),layout.find("#"+filterDivId+"ToDate").closest(".zpl_secn").hide(),ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).setValue("4"),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"Date")).setValue(Att_Common_Operations.getShiftDepLocShiftList().currDate.todayDate),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"Date")).setAttributes({disabled:!0}))}}else ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setValue(Att_Common_Operations.getShiftDepLocShiftList().currDate.monthStartDate),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"FromDate")).setAttributes({disabled:!0}),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setValue(Att_Common_Operations.getShiftDepLocShiftList().currDate.monthEndDate),ZPeopleComponents.datefield(layout.find("#"+filterDivId+"ToDate")).setAttributes({disabled:!0})},getToggleSearch:function(){shiftMapping.isCalView&&!shiftMapping.isHoursView?(shiftMapping.userCalValue=null,shiftMapping.fromNavigater=!1,shiftMapping.userCalCurMon=0,shiftMapping.getUserCalView(!1)):shiftMapping.isCalView&&shiftMapping.isHoursView?(shiftMapping.userHoursValue=null,shiftMapping.getHoursListView()):(shiftMapping.userListCurMonth=0,shiftMapping.getUserListView()),TimelySettings.constructTopFilter(),Att_Common_Operations.closeFilterifOpen(),shiftMapping.isAssignShiftPermAvailableForPage()?landingPage.find("#assignShiftButton").show():landingPage.find("#assignShiftButton").hide()},getUserListView:function(navigate,isScroll){var oldParam=shiftMapping.listviewParam,layout=landingPage,filterDivId=Att_Common_Operations.getFilterDivId(),param={mode:"getUserListView",conreqcsr:csrfToken};navigate&&(param.navigate=navigate);var shiftFilter=layout.find(".zpl_fltr");shiftMapping.getShiftFilterValues(shiftFilter,param),param.returned||param.isInvalid||(landingPageURL.includes("attendance")&&(param.isMyTeamData=!0),isScroll&&(oldParam.sdate===param.sdate&&oldParam.edate===param.edate&&oldParam.locId===param.locId&&oldParam.depId===param.depId&&oldParam.userId===param.userId||(param=shiftMapping.listviewParam),param.startIndex=shiftMapping.userListStartIndex+1),Att_Common_Operations.getSortParams(param),isScroll||(layout.find("#"+filterDivId+"ZPAtt_userShiftList #shiftLister").hide(),TimelySettings.showHideLoadingPage(!0)),$.post("/AttendanceShiftAction.zp",param,function(rdata){if(shiftMapping.listviewParam=param,shiftMapping.isListView=!0,shiftMapping.isPatternConfigured=rdata.isPatternConfigured,TimelySettings.showHideLoadingPage(!1),rdata.error)return layout.find("#shiftLister").show(),void("exceeded dates"===rdata.error?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.datewithinonemonth")):"from date greater"===rdata.error&&ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")));shiftMapping.listviewParam=param,shiftMapping.listviewParam.sdate=rdata.date_details.startdate,shiftMapping.listviewParam.edate=rdata.date_details.enddate;var filterDivId=Att_Common_Operations.getFilterDivId();if(shiftMapping.listviewParam.period=ZPeopleComponents.select(layout.find("#"+filterDivId+"FilterPeriod")).getValue(),50===rdata.userList.length&&shiftMapping.getFireScrollObj().reset(),isScroll)for(var i in rdata.userList)shiftMapping.listViewUserList.push(rdata.userList[i]);else shiftMapping.userListStartIndex=0,layout.find("#ZPAtt_userShiftList .zpl_tblres").scrollTop(0),shiftMapping.listViewUserList=rdata.userList;shiftMapping.userListValue=rdata,ZPeopleComponents.datefield(shiftFilter.find("#"+filterDivId+"FromDate")).setValue(rdata.date_details.startdate),ZPeopleComponents.datefield(shiftFilter.find("#"+filterDivId+"ToDate")).setValue(rdata.date_details.enddate);var dateNav=layout.find(".zpl_btnmnu").find("#listcalview_month");rdata.dispMonth?dateNav.html("<b>"+rdata.dispMonth+"</b>"):dateNav.html("<b>"+Attendance.datesInHeader(rdata.date_details.startdate,rdata.date_details.enddate)+"</b>"),shiftMapping.consUserListView(rdata,isScroll)}))},consUserListView:function(rdata,isScroll){var layout=landingPage,filterDivId=Att_Common_Operations.getFilterDivId();if(0===rdata.userList.length&&!isScroll)return layout.find(".zpl_rgtcnt").find("#"+filterDivId+"ZPAtt_userShiftList").hide(),void(0===layout.find(".zpl_rgtcntinr").find("#emptPage").length?(layout.find(".zpl_rgtcntinr").append('<div id="emptyDivCnt"></div>'),Att_Common_Operations.noDataFoundImage(ZPI18N.getString("zp.shiftmapnodatamsg"))):layout.find(".zpl_rgtcntinr").find("#emptyDivCnt").show());layout.find("#emptyDivCnt").hide(),layout.find("#"+filterDivId+"ZPAtt_userShiftList").show(),isScroll||layout.find("#shiftLister").empty(),TimelySettings.constructTopFilter();var space="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",userList=rdata.userList;let modifiedByDetails=rdata.modifiedByDetails;for(var i=0;userList[i]&&userList[i].shiftList[0];i++){var userObj=userList[i],html='<tr class="mapRow" id='+userObj.erecno+'><td><div class="zpl_em"><div class="zpl_emimg"><img src='+userObj.empPhoto+'></div><div class="zpl_emdts"><div class="tooltip" data-title-position="bottom" title="'+ZSEC.Encoder.encodeForHTML(userObj.empname)+'"><em>'+$("<div/>").text(userObj.empid).html()+" - </em><b>"+$("<div/>").text(userObj.empname).html()+"</b></div></div></div>";html+='</td><td class="P0I"><table class="wd100_per"><tbody>';for(var loop=0;userObj.shiftList[loop];loop++){var shiftDet=userObj.shiftList[loop],shiftId=shiftDet.shiftId,extraDetails={};extraDetails.erecno=userObj.erecno,extraDetails.pageId="shiftMappingList",extraDetails.id=shiftDet.usmid;var shiftData=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftId],dateRange=(shiftDet.fromRangeInOrgFormat?shiftDet.fromRangeInOrgFormat:space+"-"+space)+" - "+(shiftDet.toRangeInOrgFormat?shiftDet.toRangeInOrgFormat:space+"-"+space),from=Attendance.disTime(shiftData.fTime,!1,!0),to=Attendance.disTime(shiftData.tTime,!1,!0),toEditView=!1,editClick="";userObj.isEditFuture&&(toEditView=!0,editClick='onclick="shiftMapping.editSingleUserList(this)"');var detCont='<div class="dblerw"><div><span>'+shiftData.shiftName+'</span><span class="dgry">('+from+" - "+to+")</span></div><em>"+dateRange+"</em></div>";let modifiedBy;1===userObj.shiftList.length&&0===loop?html+="<tr id="+shiftId+" iseditable="+toEditView+'><td width="300px" class="CP" '+editClick+">"+detCont+"</td>":html+=0===loop?"<tr id="+shiftId+" iseditable="+toEditView+'><td width="300px" class="CP" id='+i+">"+detCont+'<a class="DB VSLmore" onclick="shiftMapping.showAllListEntries(this);">More...</a></td>':'<tr class="DN" id='+shiftId+" iseditable="+toEditView+'><td width="300px" class="CP">'+detCont+"</td>",shiftDet.modifiedBy&&modifiedByDetails&&(modifiedBy=modifiedByDetails[shiftDet.modifiedBy]),html+=modifiedBy?'<td class = "mw300"><div class="zpl_em"><div class="zpl_emimg"><img src='+modifiedBy.empPhoto+'></div><div class="zpl_emdts"><div class="tooltip" data-title-position="bottom" title="'+ZSEC.Encoder.encodeForHTML(modifiedBy.empname)+'"><em>'+$("<div/>").text(modifiedBy.empid).html()+" - </em><b>"+$("<div/>").text(modifiedBy.empname).html()+"</b></div></div></div></td>":'<td class = "mw300"></td>';var lastModified=shiftDet.lastModifiedTime;lastModified&&(html+='<td width="300px"><span>'+lastModified+"</span></td>"),html+='<td class="w100"><div class="zpl_hvr">';!shiftDet.isPatternShift&&userObj.isAdminEdit&&(!0,html+="<i id="+shiftDet.usmid+' class="PI_delete tooltip-js" onclick="Att_Common_Operations.deleteConfirm(\''+ZPI18N.getString("zp.shiftmapdeletetitle")+"','"+ZPI18N.getString("zp.shiftmapdeletemsg")+"', '"+ZPI18N.getString("zp.confirm")+"','"+JSON.stringify(extraDetails).replace(/'/g,"&apos;").replace(/"/g,"&quot;")+"')\" title="+ZPI18N.getString("zp.icoDelete")+"></i>"),html+="</div>",html+="</td></tr>"}html+="</tbody></table></td></tr>",layout.find("#shiftLister").append(html)}layout.find("#shiftLister tr tbody tr:first-child td:first-child").on("click",function(){shiftMapping.showAllListEntries(this)}),layout.ztooltip(),layout.find("#shiftLister tr tbody tr:not(:first-child) td:first-child").on("click",function(){shiftMapping.editSingleUserList(this)}),layout.find("#"+filterDivId+"ZPAtt_userShiftList #shiftLister").show()},showAllListEntries:function(obj){$(obj).closest("tr").nextAll().removeAttr("class"),$(obj).closest("tr").find("a").hide(),$(obj).closest("tr").find("td").removeAttr("onclick"),$(obj).off("click").on("click",function(){shiftMapping.editSingleUserList(this)})},showAllLeaveInfo:function(obj){let left="0px";shiftMapping.isHoursView&&(left=$(obj).css("left")),$(obj).next(".caldprtmntmdl").attr("style",`top:0px; left:${left}`).addClass("active")},hideLeaveInfo:function(obj){$(obj).parent().closest(".caldprtmntmdl").removeClass("active")},resetSingleUserParam:function(){shiftMapping.singlePopUpEditFrom="",shiftMapping.singlePopUpEditTo="",shiftMapping.singlePopUpEditShift=""},editSingleUserList:function(obj){if("true"===$(obj).closest("tr")[0].getAttribute("iseditable")){shiftMapping.constructAssignShift(!0);var md=settingsPage.container.find("#shftmapping"),user=shiftMapping.listViewUserList[$(obj).closest(".mapRow").index()],userShift=user.shiftList[$(obj).closest("tr").index()],shiftId=$(obj).closest("tr").attr("id");shiftMapping.resetSingleUserParam();var from=userShift.fromRangeInOrgFormat,to=userShift.toRangeInOrgFormat,desc=userShift.desc,shiftInfo=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftId],shift_timings="("+Attendance.disTime(shiftInfo.fTime,!1,!0)+" - "+Attendance.disTime(shiftInfo.tTime,!1,!0)+")",sName=shiftInfo.shiftName;md.find("#zp_modal_header").html(sName+" "+shift_timings),ZPeopleComponents.datefield(md.find("#shiftStartDate")).setValue(from),ZPeopleComponents.datefield(md.find("#shiftEndDate")).setValue(to),md.find("#ZPAtt_ShiftChangeReason").val(desc),md.find("#selectedUser").text(user.empname).parent().attr("id",user.erecno),shiftMapping.getApplicableShifts(user.erecno,void 0,void 0,shiftId),shiftMapping.singlePopUpFrom=from,shiftMapping.singlePopUpTo=to,shiftMapping.singlePopUpShift=shiftId,shiftMapping.toggleUpdAttEntryCheckBox()}},getShiftFilterValues:function(shiftFilter,param,isHoursView,isFromExp){var filterDivId=Att_Common_Operations.getFilterDivId();if(isHoursView){var fromDate=ZPeopleComponents.datefield(shiftFilter.find("#"+filterDivId+"Date")).getValue().dateString;if(""!==fromDate){moment(fromDate,Att_Common_Operations.getShiftDepLocShiftList().dateformat.toUpperCase());isFromExp?(param+="&sdate="+fromDate,param+="&edate="+fromDate):param.sdate=fromDate}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.dateempty")),param.returned=!0}else{var startDate=ZPeopleComponents.datefield(shiftFilter.find("#"+filterDivId+"FromDate")).getValue().dateString,endDate=ZPeopleComponents.datefield(shiftFilter.find("#"+filterDivId+"ToDate")).getValue().dateString;if(startDate&&(isFromExp?param+="&sdate="+startDate:param.sdate=startDate),endDate&&(isFromExp?param+="&edate="+endDate:param.edate=endDate),!startDate||!endDate)return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.selectfromandto")),void(param.returned=!0);var dateDiff=moment(endDate,dateFmt.toUpperCase()).diff(moment(startDate,dateFmt.toUpperCase()),"days");dateDiff>31?(ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.datewithinonemonth")),param.isInValid=!1):dateDiff<0&&(ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")),param.isInValid=!1)}if(Att_Common_Operations.isSelfReqPage()){var erecArr=[];erecArr.push(AttendanceTeam.getSelfReqPageErecno()),isFromExp?param+="&userId="+JSON.stringify(erecArr):param.userId=JSON.stringify(erecArr)}else{var locObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterLoc")).getSelectedValuesId();locObj&&0!=locObj.length&&(isFromExp?param+="&locationId="+JSON.stringify(locObj):param.locId=JSON.stringify(locObj));var depObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterDep")).getSelectedValuesId();if(depObj&&0!=depObj.length&&(isFromExp?param+="&departmentId="+JSON.stringify(depObj):param.depId=JSON.stringify(depObj)),Attendance.organizationTag.isEnabled())(orgTagObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterOrgTag")).getSelectedValuesId())&&0!=orgTagObj.length&&(isFromExp?param+="&orgTagId="+JSON.stringify(orgTagObj):param.orgTagId=JSON.stringify(orgTagObj));var orgTagObj,userIdObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterEmployee")).getAllValues();if(userIdObj&&0!=userIdObj.length&&(isFromExp?param+="&userId="+JSON.stringify(Att_Common_Operations.getAllIdsFromValues(userIdObj)):param.userId=JSON.stringify(Att_Common_Operations.getAllIdsFromValues(userIdObj))),isOrgStructureEnabled){if(ZPeople.orgStructureTagMap.entity){var entityObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterEntity")).getSelectedValuesId();entityObj&&0!=entityObj.length&&(isFromExp?param+="&entityId="+JSON.stringify(entityObj):param.entityId=JSON.stringify(entityObj))}if(ZPeople.orgStructureTagMap.unit){var bUnitObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterBUnit")).getSelectedValuesId();bUnitObj&&0!=bUnitObj.length&&(isFromExp?param+="&bUnitId="+JSON.stringify(bUnitObj):param.bUnitId=JSON.stringify(bUnitObj))}if(ZPeople.orgStructureTagMap.division){var divisionObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterDivision")).getSelectedValuesId();divisionObj&&0!=divisionObj.length&&(isFromExp?param+="&divisionId="+JSON.stringify(divisionObj):param.divisionId=JSON.stringify(divisionObj))}}if(Attendance.organizationTag.isEnabled())(orgTagObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterOrgTag")).getSelectedValuesId())&&0!=orgTagObj.length&&(isFromExp?param+="&orgTagId="+JSON.stringify(orgTagObj):param.orgTagId=JSON.stringify(orgTagObj));var desgObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterDesgn")).getSelectedValuesId();desgObj&&0!=desgObj.length&&(isFromExp?param+="&desgId="+JSON.stringify(desgObj):param.desgId=JSON.stringify(desgObj)),landingPageURL.includes("operations")&&shiftFilter.find("#"+filterDivId+"FilterShowDirectRepTo")[0].checked&&(isFromExp?param+="&showDirectRepTo=true":param.showDirectRepTo=!0)}var shiftObj=ZPeopleComponents.tokenfield(shiftFilter.find("#"+filterDivId+"FilterShift")).getSelectedValuesId();if(shiftObj&&0!=shiftObj.length&&(isFromExp?param+="&shiftId="+JSON.stringify(shiftObj):param.shiftId=JSON.stringify(shiftObj)),!Att_Common_Operations.isSelfReqPage()&&landingPageURL.includes("team")&&(isFromExp?param+="&isMyTeamData=true":param.isMyTeamData=!0),!Att_Common_Operations.isSelfReqPage()&&!landingPageURL.includes("operation")){var paramName=void 0;shiftMapping.isTeamMembersShiftSchPage()?paramName="showDepData":1==ZPeopleComponents.select(landingPage.find("#"+filterDivId+"TopStatus")).getValue()&&(paramName="showDirectRepTo"),void 0!=paramName&&(isFromExp?param+="&"+paramName+"=true":param[paramName]=!0)}return param},isTeamMembersShiftSchPage:function(){if(Att_Common_Operations.isTeamReqPage()&&Att_Common_Operations.isEmpShiftMapPage()&&(!showRepShift||3==ZPeopleComponents.select(landingPage.find("#"+Att_Common_Operations.getFilterDivId()+"TopStatus")).getValue()))return!0},switchView:function(element){var layout=landingPage,view=element.id,filterId=Att_Common_Operations.getFilterDivId();shiftMapping.isCalView=!1,$(element).addClass("zpl_act");var isCalWeekView=!0;layout.find("#"+filterId+"ZPAtt_userCalHrsView").is(":visible")&&(isCalWeekView=!1),layout.find("#"+filterId+"ZPAtt_userShiftList").hide(),layout.find("#"+filterId+"ZPAtt_userCalWeekView").hide(),layout.find("#"+filterId+"ZPAtt_userCalHrsView").hide();filterId=Att_Common_Operations.getFilterDivId();if($("#"+filterId+"MoreOptions").find("i.PI_print").closest("li").hide(),"list_view"===view){shiftMapping.isListView=!0,layout.find("#"+filterId+"ZPAtt_userShiftList").show(),layout.find("#calViewListViewTog").hide(),layout.find("#cal_view").removeClass("zpl_act"),shiftMapping.setDateProps(layout);var dateNav=layout.find(".zpl_btnmnu").find("#listcalview_month");if(shiftMapping.userListValue){var date_details=shiftMapping.userListValue.date_details;shiftMapping.userListValue.dispMonth?dateNav.html("<b>"+shiftMapping.userListValue.dispMonth+"</b>"):dateNav.html("<b>"+Attendance.datesInHeader(date_details.startdate,date_details.enddate)+"</b>")}(!isCalWeekView||void 0==shiftMapping.calviewParam||void 0==shiftMapping.listviewParam||shiftMapping.calviewParam.depId==shiftMapping.listviewParam.depId&&shiftMapping.calviewParam.locId==shiftMapping.listviewParam.locId&&shiftMapping.calviewParam.shiftId==shiftMapping.listviewParam.shiftId&&shiftMapping.calviewParam.userId==shiftMapping.listviewParam.userId)&&(isCalWeekView||void 0==shiftMapping.hoursviewParam||void 0==shiftMapping.listviewParam||shiftMapping.hoursviewParam.depId==shiftMapping.listviewParam.depId&&shiftMapping.hoursviewParam.locId==shiftMapping.listviewParam.locId&&shiftMapping.hoursviewParam.shiftId==shiftMapping.listviewParam.shiftId&&shiftMapping.hoursviewParam.userId==shiftMapping.listviewParam.userId)||(shiftMapping.userListValue=null),shiftMapping.consPageView(!0)}else layout.find("#emptyDivCnt").hide(),shiftMapping.isCalView=!0,shiftMapping.isListView=!1,shiftMapping.isHoursView?(shiftMapping.setDateProps(layout,!0),void 0===shiftMapping.hoursviewParam||void 0==shiftMapping.listviewParam||shiftMapping.listviewParam.depId==shiftMapping.hoursviewParam.depId&&shiftMapping.listviewParam.locId==shiftMapping.hoursviewParam.locId&&shiftMapping.listviewParam.shiftId==shiftMapping.hoursviewParam.shiftId&&shiftMapping.listviewParam.userId==shiftMapping.hoursviewParam.userId||(shiftMapping.userHoursValue=null)):(shiftMapping.setDateProps(layout),shiftMapping.setDateValueForCalView(layout),void 0===shiftMapping.calviewParam||shiftMapping.listviewParam.depId==shiftMapping.calviewParam.depId&&shiftMapping.listviewParam.locId==shiftMapping.calviewParam.locId&&shiftMapping.listviewParam.shiftId==shiftMapping.calviewParam.shiftId&&shiftMapping.listviewParam.userId==shiftMapping.calviewParam.userId||(shiftMapping.userCalValue=null)),shiftMapping.isHoursView?($("#"+filterId+"MoreOptions").find("i.PI_print").closest("li").show(),layout.find("#"+filterId+"ZPAtt_userCalHrsView").show()):layout.find("#"+filterId+"ZPAtt_userCalWeekView").show(),shiftMapping.consPageView(!0),layout.find("#calViewListViewTog").show(),layout.find("#list_view").removeClass("zpl_act")},getShiftMapPopupHtml:function(needChangeShiftButton,id){void 0!=id&&null!=id&&""!=id||(id="SingleDayEdit");var dropdown='<div class="zpl_dfcrd zpl_aprvcrd zpl_shftchcrd zpl_cp" tabindex="0" id="'+Att_Common_Operations.getFilterDivId()+id+'"><div class="zpl_aprvlst w200"></div>';return needChangeShiftButton&&(dropdown+='<div class="zpl_idiv"><button class="zlabel zlabel--blue zlabel--medium" onClick="shiftMapping.editShift();" tabindex="0" aria-label="'+ZPI18N.getString("zp.changeshift")+'">'+ZPI18N.getString("zp.changeshift")+"</button></div>"),dropdown+="</div>"},Import:{construct:function(){$.post("/AttendanceShiftAction.zp",{mode:"getPendingShiftImportInfo",conreqcsr:csrfToken},function(rdata){"empty"!==rdata.tableInfo.tableHeaders&&Attendance.ImportNew.partialImportedDataShow(rdata.tableInfo)}),shiftMapping.Import.isConflict=!1,shiftMapping.Import.importParam=void 0,shiftMapping.Import.isUserShiftMapping=!1,Attendance.ImportNew.details={},Attendance.ImportNew.details.fileSlider=shiftMapping.Import.getImportSlider,Attendance.ImportNew.details.getMappingSliderHtml=shiftMapping.Import.getMappingSliderHtml,Attendance.ImportNew.details.getVerifySliderHtml=shiftMapping.Import.getVerifySliderHtml,Attendance.ImportNew.details.confirmSliderHtml=shiftMapping.Import.confirmSliderHtml,Attendance.ImportNew.details.conflictSliderHtml=shiftMapping.Import.conflictSliderHtml,Attendance.ImportNew.details.getImportSummaryHtml=shiftMapping.Import.getImportSummaryHtml,Attendance.ImportNew.details.autoMappingFields=shiftMapping.Import.autoMappingFields,Attendance.ImportNew.details.hideUnHideDateFmt=shiftMapping.Import.hideUnHideDateFmt,Attendance.ImportNew.details.submitMapping=shiftMapping.Import.submitShiftMapping,Attendance.ImportNew.details.checkAttEntryUpd=shiftMapping.Import.checkAttEntryUpd,Attendance.ImportNew.details.addShiftFromImport=shiftMapping.Import.addShiftFromImport,Attendance.ImportNew.details.inputFileVerify=shiftMapping.Import.inputFileVerify,Attendance.ImportNew.details.importParam=shiftMapping.Import.importParam,Attendance.ImportNew.details.module="BulkShiftMapping",Attendance.ImportNew.construct()},getImportSlider:function(){var content='<div class="zpl_crd" id="importCont"><div id="importFileDiv1" class="zpl_crdcnt">'+Attendance.ImportNew.getPendingImportHtmlSecn()+'<div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp"><div class="zpl_mdimprtimg"></div><h4>'+ZPI18N.getString("zp.fileimported")+"</h4><p>"+ZPI18N.getString("zp.formfomtsupportxlscsv")+'</p><div><input style="display:none" type="file" accept=".xls,.xlsx,.csv" elem="AttConfigImportFile"><button elem="AttConfigImportButton" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.importfile")+"</button></div><p>"+ZPI18N.getString("zp.maxfilesize")+'</p><p elem="filehelp"><a elem="downloadSampleTemplate" onclick="shiftMapping.Import.downloadSample();"><b>'+ZPI18N.getString("zp.shiftmapping.sampleFileImport")+"</b></a></p></div></div></div></div>";content+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.shiftmapping.importType")+"</label></div>",content+='<div><div class="zradiobutton zradiobutton--horizontal"><input type="radio" name="ZPAtt_Shift_Type" id="ZPAtt_Shift_ShiftWise" onchange="shiftMapping.Import.onShiftTypeChange(this)" class="zradiobutton__helper" checked>',content+='<label class="zradiobutton__label" for="ZPAtt_Shift_ShiftWise"><span class="zradiobutton__text">'+ZPI18N.getString("zp.shiftmapping.shiftwise")+"</span></label></div>",content+='<div class="zradiobutton zradiobutton--horizontal"><input type="radio" name="ZPAtt_Shift_Type" id="ZPAtt_Shift_UserWise" onchange="shiftMapping.Import.onShiftTypeChange(this)" class="zradiobutton__helper">',content+='<label class="zradiobutton__label" for="ZPAtt_Shift_UserWise"><span class="zradiobutton__text">'+ZPI18N.getString("zp.shiftmapping.userwise")+"</span></label></div>",content+="</div></div>",content+='<div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.supportedformats")+"</h5></div>",content+='<div class="zpl_tblres"><table class="zpl_tbl wd100_per zpl_act" id="ZPAtt_Shift_Shiftwise_Sample">',content+="<thead><tr><th></th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th>",content+="</tr></thead><tbody>";var shiftList=[],index=0;for(var shiftId in Att_Common_Operations.getShiftDepLocShiftList().shiftlist)if(-1!==Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftId].select&&(shiftList[index]=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftId].shiftName,5==++index))break;return shiftMapping.Import.isUserShiftMapping=!1,content+=shiftMapping.Import.consShiftwiseImportSample(shiftList),content+="</tbody></table>",content+='<table class="zpl_tbl wd100_per DN" id="ZPAtt_Shift_Userwise_Sample">',content+="<thead><tr><th></th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th></tr></thead><tbody>",content+=shiftMapping.Import.consUserWiseImportSample(shiftList),content+="</tbody></table></div></div>",content+='<div class="zpl_secn DN" id="ZPAtt_Shift_UserWiseImport_Note"><div>',content+='<div class="zpl_info">',content+="<h6><b>Note</b></h6>",content+="<p>"+ZPI18N.getString("zp.userwise.shiftimportnote1")+"</p>",content+="<p>"+ZPI18N.getString("zp.userwise.shiftimportnote2")+"</p>",content+="<p>"+ZPI18N.getString("zp.userwise.shiftimportnote3")+"</p>",content+="<p>"+ZPI18N.getString("zp.userwise.shiftimportnote4",[Att_Common_Operations.getShiftDepLocShiftList().dateformat])+"</p>",content+="</div></div></div></div>",content+='<div id="importFileDiv2" class="zpl_crdcnt DN">',content+='<div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp"><div class="zpl_mdimprtimg"></div><h4 elem="importFormConfigfileName"></h4><input style="display:none" type="file" accept=".xls,.xlsx,.csv" elem="AttConfigImportFile"><button elem="AttfileUploadedButton" class="zlabel zlabel--blue zlabel--medium"></button></div></div></div></div>',isShiftApprConfigured&&!isEmpChooseApp&&(content+='<div class="zpl_secn"><div class="zcheckbox zcheckbox--horizontal"><input id="approvalOn" type="checkbox" name="check" value="" class="zcheckbox__helper" checked><label for="approvalOn" class="zcheckbox__label">'+ZPI18N.getString("zp.sendforapproval")+'</label><span class="PI_info" title="'+ZPI18N.getString("zp.apprimportinfomsg")+'"></span></div></div>'),content+='</div></div><div class="DN" id="loadingImportDiv"></div>',content+='<div id="importFileDiv3" class="zpl_crdcnt DN"><div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp"><div class="zpl_mdimprtimg"></div><i class="IC-docs blu" style="font-size: 28px;"></i><h4 elem="importFormConfigfileName"></h4><input style="display:none" type="file" accept=".xls,.xlsx,.csv" elem="AttConfigImportFile"><button elem="AttfileUploadedButton" class="zlabel zlabel--blue zlabel--medium"></button></div></div></div></div></div></div><div class="DN" id="loadingImportDiv"></div>'},onShiftTypeChange:function(){var modal=Attendance.ImportNew.importfileUpContiner;modal.find("#ZPAtt_Shift_ShiftWise")[0].checked?(modal.find("#ZPAtt_Shift_Shiftwise_Sample").removeClass("DN"),modal.find("#ZPAtt_Shift_Userwise_Sample").addClass("DN"),modal.find("#ZPAtt_Shift_UserWiseImport_Note").addClass("DN"),shiftMapping.Import.isUserShiftMapping=!1):(modal.find("#ZPAtt_Shift_UserWiseImport_Note").removeClass("DN"),modal.find("#ZPAtt_Shift_Userwise_Sample").removeClass("DN"),modal.find("#ZPAtt_Shift_Shiftwise_Sample").addClass("DN"),shiftMapping.Import.isUserShiftMapping=!0)},consUserWiseImportSample:function(shiftList){var html_table="<tr><td>1</td>";html_table+="<td>"+ZPI18N.getString("zp.emailemployeeid")+"</td>";for(var i=1;i<=5;i++)html_table+="<td>"+moment([curyear,curmonth,i]).format(Att_Common_Operations.getShiftDepLocShiftList().dateformat.toUpperCase())+"</td>";html_table+="<td>"+ZPI18N.getString("zp.reason")+"</td>";var emplIDorEmail=ZPeople.CURR_USER.email;html_table+="</tr><tr><td>2</td>",html_table+="<td>"+emplIDorEmail+"</td>";var shiftindex=0;for(i=0;i<5;i++)html_table+="<td>"+shiftList[shiftindex]+"</td>",shiftindex=shiftList[shiftindex+1]?shiftindex+1:0;html_table+="<td>"+ZPI18N.getString("zp.clientpriority")+"</td>";var empIndex=0;locempArr.length>0?(empIndex=locempArr[empIndex].ERECNO==erecno?empIndex+1:empIndex,emplIDorEmail=locempArr[empIndex]?locempArr[empIndex].EMPID:locempArr[0].EMPID):emplIDorEmail="ZCON001",html_table+="</tr><tr><td>3</td>",html_table+="<td>"+emplIDorEmail+"</td>",shiftindex=0;for(i=0;i<5;i++)html_table+="<td>"+shiftList[shiftindex]+"</td>",shiftindex=shiftList[shiftindex+1]?shiftindex+1:0;html_table+="<td></td>",locempArr.length>0?(empIndex=locempArr[empIndex+1]?locempArr[empIndex+1].ERECNO==erecno?empIndex:empIndex+1:empIndex,emplIDorEmail=locempArr[empIndex]?locempArr[empIndex].EMPID:locempArr[0].EMPID):emplIDorEmail="ZCON002",html_table+="</tr><tr><td>4</td>",html_table+="<td>"+emplIDorEmail+"</td>",shiftindex=0;for(i=0;i<5;i++)html_table+="<td>"+shiftList[shiftindex]+"</td>",shiftindex=shiftList[shiftindex+1]?shiftindex+1:0;return html_table+="<td>"+ZPI18N.getString("zp.escalations")+"</td>",html_table+="</tr>"},consShiftwiseImportSample:function(shiftList){var html_table="<tr><td>1</td><td>"+ZPI18N.getString("zp.shiftname")+"</td><td>"+ZPI18N.getString("zp.from")+"</td><td>"+ZPI18N.getString("zp.to")+"</td><td>"+ZPI18N.getString("zp.emailemployeeid")+"</td><td>"+ZPI18N.getString("zp.reason")+"</td></tr>",shiftName=shiftList[0];html_table+="<tr><td>2</td><td>"+shiftName+"</td><td>"+(fdate=moment([curyear,curmonth,1]).format(Att_Common_Operations.getShiftDepLocShiftList().dateformat.toUpperCase()))+"</td><td>"+(tdate=moment([curyear,curmonth,10]).format(Att_Common_Operations.getShiftDepLocShiftList().dateformat.toUpperCase()))+"</td><td>"+ZPeople.CURR_USER.email+"</td><td>"+ZPI18N.getString("zp.assistsupportteam")+"</td></tr>";html_table+="<tr><td>3</td><td>"+shiftName+"</td><td>"+(fdate=moment([curyear,curmonth,5]).format(Att_Common_Operations.getShiftDepLocShiftList().dateformat.toUpperCase()))+"</td><td>"+(tdate=moment([curyear,curmonth,11]).format(Att_Common_Operations.getShiftDepLocShiftList().dateformat.toUpperCase()))+"</td><td>ZCON001</td><td></td></tr>";var fdate=moment([curyear,curmonth,10]).format(Att_Common_Operations.getShiftDepLocShiftList().dateformat.toUpperCase()),tdate=moment([curyear,curmonth,30]).format(Att_Common_Operations.getShiftDepLocShiftList().dateformat.toUpperCase());return html_table+="<tr><td>4</td><td>"+(shiftName=shiftList[2]?shiftList[2]:shiftName)+"</td><td>"+fdate+"</td><td>"+tdate+"</td><td>ZCON002</td><td>"+ZPI18N.getString("zp.escalations")+"</td></tr></tbody>"},getMappingSliderHtml:function(){var reasonCls="";return isShiftChangeReasonMandatory&&(reasonCls="zpl_mtry"),'<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li elem="mapUnMapDiv" class="zpl_act" value="All">All</li><li elem="mapUnMapDiv" value="Mapped">'+ZPI18N.getString("zp.mapping")+'<div id="mappedNo"><b></b></div></li><li elem="mapUnMapDiv" value="Unmapped">'+ZPI18N.getString("zp.unmapped")+' <div id="unMappedNo"><b></b></div></li></ul></div><div class="zpl_rgt"><button data-popup-open="import_Resetfields" class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="Att_Common_Operations.confirmpopUp(\'AttImportReset\', Attendance.ImportNew.resetFields,undefined,1);">Reset fields</button></div></div><div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd"><div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true"><div id="Attimport_mapping_collapseDiv"><div><div <h4="">Basic information</div> </div><div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry">'+ZPI18N.getString("zp.emailemployeeid")+'</label><select class="select-js" id="ZPAtt_Shift_importEmpId_map" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"><label>'+ZPI18N.getString("zp.to")+'</label><div class="d-flexcap a-itm-cntr"><select id="ZPAtt_Shift_importTo_map" class="select-js" style="display: none;"></select></div></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry">'+ZPI18N.getString("zp.from")+'</label><select id="ZPAtt_Shift_importFrom_map" class="select-js" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry">'+ZPI18N.getString("zp.shift")+'</label><div class="d-flexcap a-itm-cntr"><select id="ZPAtt_Shift_importShiftId_map" class="select-js" style="display: none;"></select></div></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class='+reasonCls+">"+ZPI18N.getString("zp.reason")+'</label><select id="ZPAtt_Shift_importReason_map" class="select-js" style="display: none;"></select></div></div><div id="date_fmtShiftMap"><div elem="mappingFieldDiv"><label class="zpl_mtry">'+ZPI18N.getString("zp.dateformat")+'</label><select id="ZPAtt_Shift_importDateFor_map" class="select-js" style="display: none;"></select></div></div></div></div></div></div></div></div>'},getVerifySliderHtml:function(){var reasonCls="";return isShiftChangeReasonMandatory&&(reasonCls="zpl_mtry"),'<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd"><div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true"><div id="Attimport_verify_collapseDiv"><div><div><h4="">Basic information</div></div><div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry">'+ZPI18N.getString("zp.emailemployeeid")+'</label><select class="select-js" id="ZPAtt_Shift_importEmpId" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"><label>'+ZPI18N.getString("zp.to")+'</label><div class="d-flexcap a-itm-cntr"><select id="ZPAtt_Shift_importTo" class="select-js" style="display: none;"></select></div></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry">'+ZPI18N.getString("zp.from")+'</label><select id="ZPAtt_Shift_importFrom" class="select-js" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry">'+ZPI18N.getString("zp.shift")+'</label><div class="d-flexcap a-itm-cntr"><select id="ZPAtt_Shift_importShiftId" class="select-js" style="display: none;"></select></div></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class='+reasonCls+">"+ZPI18N.getString("zp.reason")+'</label><select id="ZPAtt_Shift_importReason" class="select-js" style="display: none;"></select></div></div><div id="date_fmtShiftMap"><div elem="mappingFieldDiv"><label class="zpl_mtry">'+ZPI18N.getString("zp.dateformat")+'</label><select id="ZPAtt_Shift_importDateFor" class="select-js" style="display: none;"></select></div></div></div></div></div></div></div></div>'},confirmSliderHtml:function(){return'<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd"><div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true"><div id="Attimport_confirm_collapseDiv"><div class="zpl_secn"><div><p>'+ZPI18N.getString("zp.updateattentries")+"</p><p>"+ZPI18N.getString("zp.updattmsgshiftimp")+'</p></div></div><div class="zpl_secn"><div><div class="zcheckbox"><input id="ZPAtt_updAttEntryOnShiftImp" type="checkbox" name="check" value="" class="zcheckbox__helper" onchange="Att_Common_Operations.changeCheckBox(this, \'all\')"><label for="ZPAtt_updAttEntryOnShiftImp" class="zcheckbox__label">'+ZPI18N.getString("zp.updateattentries")+"</label></div></div></div></div></div></div></div>"},conflictSliderHtml:function(){return'<div class="zpl_crdwthful"><div class="zpl_crd"><div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true"><div id="Attimport_conflict_collapseDiv"><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr><th>'+ZPI18N.getString("zp.users")+"</th><th>"+ZPI18N.getString("zp.existingshift")+"</th><th>"+ZPI18N.getString("zp.changedshift")+'</th><th width="15%"></th></tr></thead><tbody id="conflictBody"></tbody></table></div></div></div></div></div>'},importSuccess:function(){Att_Common_Operations.isSelfReqPage()&&Att_Common_Operations.isEmpShiftMapPage()?SingleUserShiftMapping.init():shiftMapping.isListView?(shiftMapping.getUserListView(),shiftMapping.resetFilterInputsForReload(),shiftMapping.userCalValue=null,shiftMapping.userHoursValue=null):shiftMapping.isCalView&&!shiftMapping.isHoursView?(shiftMapping.userCalValue=null,shiftMapping.getUserCalView(),shiftMapping.resetFilterInputsForReload(),shiftMapping.userListValue=null,shiftMapping.userHoursValue=null):shiftMapping.isHoursView&&(shiftMapping.userHoursValue=null,shiftMapping.getHoursListView(),shiftMapping.resetFilterInputsForReload(),shiftMapping.userListValue=null,shiftMapping.userCalValue=null)},hideUnHideDateFmt:function(cont){cont.find("#date_fmtShiftMap").find("label").removeClass("zpl_mtry"),"csv"===Attendance.ImportNew.fileFormat&&cont.find("#date_fmtShiftMap").find("label").addClass("zpl_mtry")},getImportSummaryHtml:function(resultData){var html='<div class="zpl_imprtrecordvw"><div class="zpl_secn"><div><div class="zpl_imprtrecord"><div><i class="IC-task-chk grn"></i>The selected file has been imported successfully</div><button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="Att_Common_Operations.viewRecords()">View records</button></div></div></div></div><div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li>'+ZPI18N.getString("zp.noOfTot")+"<b>"+resultData.totalCount+"</b></li><li>"+ZPI18N.getString("zp.noOfAdd")+"<b>"+resultData.selectCnt+"</b></li><li>"+ZPI18N.getString("zp.noOfSkip")+"<b>"+(resultData.errorCount?resultData.errorCount:0)+"</b></li><li>"+ZPI18N.getString("zp.noOfErr")+"<b>"+(resultData.errorCount?resultData.errorCount:0)+"</b></li></ul></div></div>";if(shiftMapping.Import.importSuccess(),resultData.inValidUsers.length>0||resultData.emptyEmpIds.length>0||resultData.emptyShiftIds.length>0||resultData.inValidShifts.length>0){if(html+='<div class="zpl_rgtcnt"><div class="zpl_tblres wd100_per"> <table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.errorDetails")+"</th><th></th></tr></thead><tbody>",resultData.inValidUsers.length>0){var skipped="",length=resultData.inValidUsers.length;for(i=0;i<length;i++)skipped=""==skipped?resultData.inValidUsers[i]:skipped+","+resultData.inValidUsers[i];html+="<tr><td><span>"+ZPI18N.getString("zp.invalidempinfoforshiftimport")+"</td><td>"+skipped+"</span></td></tr>"}if(resultData.emptyEmpIds.length>0){skipped="",length=resultData.emptyEmpIds.length;for(i=0;i<length;i++)skipped=""==skipped?resultData.emptyEmpIds[i]:skipped+","+resultData.emptyEmpIds[i];html+="<tr><td><span>"+ZPI18N.getString("zp.emptyempidsforshiftimport")+"</td><td>"+skipped+"</span></td></tr>"}if(resultData.inValidShifts.length>0){skipped="",length=resultData.inValidShifts.length;for(i=0;i<length;i++)skipped=""==skipped?resultData.inValidShifts[i]:skipped+","+resultData.inValidShifts[i];html+="<tr><td><span>"+ZPI18N.getString("zp.invalidshiftinfo")+"</td><td>"+skipped+"</span></td></tr>"}if(resultData.emptyShiftIds.length>0){skipped="",length=resultData.emptyShiftIds.length;for(i=0;i<length;i++)skipped=""==skipped?resultData.emptyShiftIds[i]:skipped+","+resultData.emptyShiftIds[i];html+="<tr><td><span>"+ZPI18N.getString("zp.emptyshiftids")+"</td><td>"+skipped+"</span></td></tr>"}html+="</tbody></table></div></div>"}if(resultData.errorInfo&&resultData.errorInfo.length>0&&(html+='<div class="zpl_rgtcnt"><div class="zpl_tblres wd100_per"> <table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.rownoofquickimport")+"</th><th>"+ZPI18N.getString("zp.errorDetails")+"</th></tr></thead><tbody>",resultData.errorInfo.forEach(function(obj,index){for(html+="<tr><td>"+obj[0]+"</td><td>",i=1;i<obj.length;i++)html+=obj[i]+"<br>";html+="</td>"}),html+="</tbody></table></div></div>"),resultData.inValidReason&&resultData.inValidReason.length>0&&(html+='<div class="zpl_rgtcnt"><div class="zpl_tblres wd100_per"> <table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.rownoofquickimport")+"</th><th>"+ZPI18N.getString("zp.errorDetails")+"</th></tr></thead><tbody>",resultData.inValidReason.forEach(function(obj){html+="<tr><td>"+obj[0]+"</td><td>"+obj[1]+"</td>"}),html+="</tbody></table></div></div>"),resultData.userwiseerrorInfo&&resultData.userwiseerrorInfo.length>0&&(html+='<div class="zpl_rgtcnt"><div class="zpl_tblres wd100_per"> <table class="zpl_tbl"><thead><tr><th> Column </th><th>'+ZPI18N.getString("zp.errorDetails")+"</th></tr></thead><tbody>",resultData.userwiseerrorInfo.forEach(function(obj,index){for(html+="<tr><td>"+obj[0]+"</td><td>",i=1;i<obj.length;i++)html+=obj[i]+"<br>";html+="</td>"}),html+="</tbody></table></div></div>"),resultData.emptyShiftEmployee){var emptyShiftEmp=resultData.emptyShiftEmployee;if(Object.keys(emptyShiftEmp).length<0)return;for(var key in html+='<div class="zpl_rgtcnt"><div class="zpl_tblres wd100_per"> <table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.emptyshfitidsforEmp")+"</th></tr></thead><tbody></tbody></table></div></div>",html+='<div class="zpl_rgtcnt"><div class="zpl_tblres wd100_per"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.emailemployeeid")+"</th><th>"+ZPI18N.getString("zp.schdates")+"</th></tr></thead><tbody>",emptyShiftEmp){html+="<tr><td>"+key+"</td>";var dates="";for(i=0;i<emptyShiftEmp[key].length;i++)dates=dates+"  "+emptyShiftEmp[key][i];html+="<td>"+decodeHTML(dates)+"</td>"}html+="</tbody></table></div></div>"}return html},checkAttEntryUpd:function(obj){Attendance.ImportNew.importfileUpContiner;if(shiftMapping.Import.isUserShiftMapping){for(var importedDates=obj,dateLen=importedDates.length,isPastDateAvail=!1,index=1;index<dateLen;index++){var date=importedDates[index].trim().replace("]","");if(!isNaN(new Date(date).valueOf())&&shiftMapping.dateLessThanOrEqualCurrDate(date,!0)){isPastDateAvail=!0;break}}isPastDateAvail&&!Attendance.isSpiceJet()?(Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:nth-child(2)").find($("b")).html(Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:visible").length+1),Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:nth-child(1)").show(),Attendance.ImportNew.importContainer.find("#Attimport_confirm_card").addClass("zpl_act"),shiftMapping.Import.isConflict=!0):Attendance.ImportNew.importContainer.find("#fullModFooter").find("#nextButton").trigger("click")}else if(Attendance.isSpiceJet())Attendance.ImportNew.importContainer.find("#fullModFooter").find("#nextButton").trigger("click");else{var container=Attendance.ImportNew.importContainer.find("#Attimport_verify_card"),shiftId=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importShiftId")).getValue(),from=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importFrom")).getValue(),empId=(ZPeopleComponents.select(container.find("#ZPAtt_Shift_importTo")).getValue(),ZPeopleComponents.select(container.find("#ZPAtt_Shift_importEmpId")).getValue()),desc=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importReason")).getValue();if(!shiftMapping.Import.isUserShiftMapping&&("-1"===shiftId||"-1"===empId||"-1"===from||isShiftChangeReasonMandatory&&"-1"===desc))return void Attendance.ImportNew.showFailureMsgForImport();var shiftType=0;!Attendance.ImportNew.saveContainer.find("#ZPAtt_Shift_ShiftWise")[0].checked&&(shiftType=1);var param={mode:"getPastDateShiftUpd",from:from,conreqcsr:csrfToken,shiftType:shiftType};if(shiftMapping.Import.isUserShiftMapping||"-1"===ZPeopleComponents.select(container.find("#ZPAtt_Shift_importDateFor")).getValue()||(param.dateformat=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importDateFor")).getValue()),!shiftMapping.Import.isUserShiftMapping&&"csv"===Attendance.ImportNew.fileFormat&&!param.dateformat)return void Attendance.ImportNew.showFailureMsgForImport();$.post("/AttendanceShiftAction.zp",param,function(resultData){resultData&&resultData.pastDateAvail?(Attendance.ImportNew.confirm(),Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:nth-child(3)").show(),Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:nth-child(5)").find($("b")).html(Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:visible").length),shiftMapping.Import.isConflict=!0):Attendance.ImportNew.importContainer.find("#fullModFooter").find("#nextButton").trigger("click")})}},submitShiftMapping:function(){var employeeWise=!Attendance.ImportNew.saveContainer.find("#ZPAtt_Shift_ShiftWise")[0].checked,container=Attendance.ImportNew.importContainer.find("#Attimport_verify_card"),shiftId=-1,from=-1,to=-1,empId=-1,desc=-1;employeeWise||(shiftId=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importShiftId")).getValue(),from=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importFrom")).getValue(),to=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importTo")).getValue(),empId=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importEmpId")).getValue(),desc=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importReason")).getValue());var shiftType=0;employeeWise&&(shiftType=1);var param={mode:"shiftImportMapping",shiftId:shiftId,from:from,to:to,empId:empId,conreqcsr:csrfToken,shiftType:shiftType};if("-1"!==desc&&(param.desc=desc),!isEmpChooseApp&&isShiftApprConfigured&&(param.approvalOn=Attendance.ImportNew.saveContainer.find("#approvalOn")[0].checked),shiftMapping.Import.isUserShiftMapping||"-1"===ZPeopleComponents.select(container.find("#ZPAtt_Shift_importDateFor")).getValue()||(param.dateformat=ZPeopleComponents.select(container.find("#ZPAtt_Shift_importDateFor")).getValue()),shiftMapping.Import.importParam=param,shiftMapping.Import.isUserShiftMapping||"csv"!==Attendance.ImportNew.fileFormat||param.dateformat){if(param.updateAttEntries=!1,0!=Attendance.ImportNew.importContainer.find("#Attimport_confirm_card").children().length)!0===Attendance.ImportNew.importContainer.find("#Attimport_confirm_card").find("#ZPAtt_updAttEntryOnShiftImp")[0].checked&&(param.updateAttEntries=!0);Attendance.ImportNew.importContainer.find("#Attimport_summary_card").html(ZPeople.LOADING_HTML),$.post("/AttendanceShiftAction.zp",param,function(resultData){if(0===Object.keys(resultData.impDetails).length||resultData.impDetails.error)return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")),Attendance.ImportNew.importContainer.find("#fullModFooter").find("#nextButton").removeClass("DN").html("Next"),Attendance.ImportNew.importContainer.find("#fullModFooter").find("#saveButton").addClass("DN"),void Attendance.ImportNew.importObj.showTab(2);if(resultData.impDetails.msg||!resultData.impDetails.msg&&!resultData.impDetails.result)return Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li").removeClass("zpl_act"),Attendance.ImportNew.importContainer.find("#Attimport_summary").addClass("zpl_act"),Attendance.ImportNew.importContainer.find("#cardRightDiv").children().removeClass("zpl_act"),Attendance.ImportNew.importContainer.find("#Attimport_summary_card").addClass("zpl_act"),void Attendance.ImportNew.importSummary(resultData.impDetails);shiftMapping.Import.importDetails=resultData,shiftMapping.Import.excludeCnt=0,shiftMapping.Import.excludedImportData=[],Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:nth-child(4)").show(),Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:nth-child(4)").find($("b")).html(Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:visible").length-1),Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:nth-child(5)").find($("b")).html(Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:visible").length),Attendance.ImportNew.importContainer.find("#tabLeftUl").find("#Attimport_confirm").is(":visible")&&Attendance.ImportNew.importContainer.find("#tabLeftUl").find("#Attimport_confirm").addClass("disabled"),Attendance.ImportNew.importContainer.find("#Attimport_conflict_card").addClass("zpl_act"),Attendance.ImportNew.importContainer.find("#Attimport_summary_card").removeClass("zpl_act"),Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:nth-child(4)").addClass("zpl_act"),Attendance.ImportNew.importContainer.find("#tabLeftUl").find("li:nth-child(5)").removeClass("zpl_act"),Attendance.ImportNew.importContainer.find("#fullModFooter").find("#nextButton").html("Next"),Attendance.ImportNew.importContainer.find("#fullModFooter").find("#nextButton").removeClass("DN"),Attendance.ImportNew.importObj._currentTabIndex=4,Attendance.ImportNew.importObj.tabs[Attendance.ImportNew.importObj._currentTabIndex].callback=Attendance.ImportNew.details.addShiftFromImport;for(var isFirst=!0,loop=0;resultData.impDetails.result[loop];loop++)!0===isFirst?(shiftMapping.Import.consConflictBody(resultData.impDetails.result[loop],!1,loop),isFirst=!1):shiftMapping.Import.consConflictBody(resultData.impDetails.result[loop],!0,loop)})}else Attendance.ImportNew.showFailureMsgForImport()},addShiftFromImport:function(){shiftMapping.Import.importParam.excludeList=JSON.stringify(shiftMapping.Import.excludedImportData),$.post("/AttendanceShiftAction.zp",shiftMapping.Import.importParam,function(resultData){shiftMapping.Import.selectCnt=resultData.impDetails.selectCnt,Attendance.ImportNew.importSummary(resultData.impDetails)})},consConflictBody:function(rdata,isAppend,groupNo){var modal=Attendance.ImportNew.importContainer.find("#Attimport_conflict_card");isAppend||modal.find("#confictBody").empty();var space="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";for(var erecno in rdata){var html='<tr><td><div class="zpl_em"><div class="zpl_emimg"><img src='+rdata[erecno].empPhoto+'></div><div class="zpl_emdts"><div><em>'+ZPeople.escapeHtml(rdata[erecno].empid)+" </em><b>"+ZPeople.escapeHtml(rdata[erecno].empname)+"</b></div></div></div> </td><td>";if($(Attendance.ImportNew.importContainer).hasClass("zpl_mopen")&&(html="<tr id="+groupNo+'><td><div class="zpl_em"><div class="zpl_emimg"><img src='+rdata[erecno].empPhoto+'></div><div class="zpl_emdts"><div><em>'+ZPeople.escapeHtml(rdata[erecno].empid)+" </em><b>"+ZPeople.escapeHtml(rdata[erecno].empname)+"</b></div></div></div> </td><td>"),rdata[erecno].conflictList)for(var loop=0;rdata[erecno].conflictList[loop];loop++){var dateRange="";void 0!==(shiftDetails=rdata[erecno].conflictList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);var shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftDetails.shiftId];shiftDetails.isModified||"S13 red",rdata[erecno].conflictList.length>1&&rdata[erecno].conflictList.length,html+='<div class="dblerw"><div>'+shift.shiftName+"<span>("+Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0),html+=")</span></div><em>"+dateRange+"</em></div>"}else html+=ZPI18N.getString("zp.na");if(html+="</td><td>",rdata[erecno].newList)for(loop=0;rdata[erecno].newList[loop];loop++){var shiftDetails;dateRange="";void 0!==(shiftDetails=rdata[erecno].newList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftDetails.shiftId];shiftDetails.isAdded&&"S13 grn",rdata[erecno].newList.length>1&&rdata[erecno].newList.length,html+='<div class="dblerw"><div class="grn">'+shift.shiftName+"<span>("+Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0),html+=")</span></div><em>"+dateRange+"</em></div>"}else html+=ZPI18N.getString("zp.na");html+="</td>",html+='<td><div class="zpl_hvr"><button id='+erecno+' onClick="shiftMapping.Import.exclude(this);" class="zlabel zlabel--red zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.exclude")+"</button></div></td></tr>",modal.find("tbody").append(html)}},excludedImportData:[],excludeCnt:0,exclude:function(obj){if($(Attendance.ImportNew.importContainer).hasClass("zpl_mopen")){if(shiftMapping.Import.importDetails.impDetails.result[$(obj).closest("tr").attr("id")][$(obj).attr("id")].newList){for(var excludedetails={},newList=shiftMapping.Import.importDetails.impDetails.result[$(obj).closest("tr").attr("id")][$(obj).attr("id")].newList,loop=0;newList[loop];loop++)newList[loop].isActualInterval&&(excludedetails.shiftId=newList[loop].shiftId,newList[loop].fromRange&&(excludedetails.fromRange=newList[loop].fromRange),newList[loop].toRange&&(excludedetails.toRange=newList[loop].toRange));excludedetails.erecno=$(obj).attr("id"),shiftMapping.Import.excludeCnt++,shiftMapping.Import.excludedImportData.push(excludedetails)}}else{var index=shiftMapping.selectedUserPickList.indexOf($(obj).attr("id"));shiftMapping.selectedUserPickList.splice(index,1)}$(obj).parent().attr("class","text-right P0"),$(obj).parent().html('<span class="dgry">'+ZPI18N.getString("zp.excluded")+"</span>")},autoMappingFields:function(cont,rArray){if(!shiftMapping.Import.isUserShiftMapping)for(var i in rArray)-1!==rArray[i].toLowerCase().indexOf("from")?ZPeopleComponents.select(cont.find("#ZPAtt_Shift_importFrom_map")).setValue(i):-1!==rArray[i].toLowerCase().indexOf("to")?ZPeopleComponents.select(cont.find("#ZPAtt_Shift_importTo_map")).setValue(i):-1!==rArray[i].toLowerCase().indexOf("employee")||-1!==rArray[i].toLowerCase().indexOf("id")||-1!==rArray[i].toLowerCase().indexOf("user")?ZPeopleComponents.select(cont.find("#ZPAtt_Shift_importEmpId_map")).setValue(i):-1!==rArray[i].toLowerCase().indexOf("shift")?ZPeopleComponents.select(cont.find("#ZPAtt_Shift_importShiftId_map")).setValue(i):-1!==rArray[i].toLowerCase().indexOf("reason")&&ZPeopleComponents.select(cont.find("#ZPAtt_Shift_importReason_map")).setValue(i)},downloadSample:function(){var shiftType=0;!Attendance.ImportNew.saveContainer.find("#ZPAtt_Shift_ShiftWise")[0].checked&&(shiftType=1);var formObj=$("<form id='ZPLeave_exp_form' action='AttendanceShiftAction.zp?mode=import_template' method='post' target='exportresp1' style='display:none'/>").html("");formObj.append('<input type="hidden" value="'+csrfToken+'" name="conreqcsr"/>'),formObj.append('<input type="hidden" value="'+shiftType+'" name="shiftType"/>'),$("body").append(formObj),formObj.submit()}},getEditIconHtml:function(){return'<div class="zpl_shftedit" aria-label="'+ZPI18N.getString("zp.editshift")+'" tabindex="0" ><i class="PI_edt"></i></div>'},isSpiceJetOrg:function(){return"669143097"===_LOGGEDIN_ZSOID||"72277743"===_LOGGEDIN_ZSOID||"802713071"===_LOGGEDIN_ZSOID||"14513569"===_LOGGEDIN_ZSOID||"59429288"===_LOGGEDIN_ZSOID||"846640023"===_LOGGEDIN_ZSOID||"78479611"===_LOGGEDIN_ZSOID}},SingleUserShiftMapping={weeklyViewFromDate:null,weeklyViewFetchFromdate:null,weeklyViewToDate:null,init:function(){var page=settingsPage.container;shiftMapping.isCalView=!1,shiftMapping.isHoursView=!0,shiftMapping.isListView=!1,shiftMapping.setShiftGlobalVariables();Att_Common_Operations.getFilterDivId();if(isadmin&&(isManageAttendanceData=!0,isManageShiftMapping=!0),0===page.find(".zpl_rgtcnt").length){var html='<div class="zpl_btnmnu">';html+='<div class="zpl_lft"></div><div class="zpl_cntrdv"><div class="zpl_inav">',html+='<i class="PI_alft tooltip-js blu zpl_cp" title="'+ZPI18N.getString("zp.previous")+'" aria-label="'+ZPI18N.getString("zp.common.previous")+'" tabindex="0"></i> <i class="PI_monthly" id="calViewCalNav"></i><i class="PI_argt tooltip-js blu zpl_cp" title="'+ZPI18N.getString("zp.next")+'" aria-label="'+ZPI18N.getString("zp.common.next")+'" tabindex="0"></i></div>',html+='<div><b id="calViewNavVal"></b></div></div>',html+='<div class="zpl_rgt"><ul class="zpl_grpmnu"><li class="zpl_act" id="weekly" tabindex="0" aria-label="'+ZPI18N.getString("zp.weekly")+'" onclick="SingleUserShiftMapping.toggleViews(this)">'+ZPI18N.getString("zp.weekly")+"</li>",html+='<li id="monthly" onclick="SingleUserShiftMapping.toggleViews(this)">'+ZPI18N.getString("zp.monthly")+"</li></ul>",html+='<button class="zlabel zlabel--blue zlabel--medium" id="singleUserAssignShiftBtn" aria-label="'+ZPI18N.getString("zp.assignshift")+'" tabindex="0" onclick="shiftMapping.constructAssignShift(false)">',html+=ZPI18N.getString("zp.assignshift")+"</button>",html+=Att_Common_Operations.getMoreOptionHtml(),html+="</div></div>",page.append(html);var moreOpt=[{type:"import",name:ZPI18N.getString("zp.import"),callback:"shiftMapping.Import.construct"},{type:"export",name:ZPI18N.getString("zp.export"),callback:"Att_Common_Operations.Export.construct"},{type:"download",name:ZPI18N.getString("zp.downloadpdf"),callback:"Att_Common_Operations.ExportPDF.construct"},{type:"print",name:ZPI18N.getString("zp.print"),callback:"Att_Common_Operations.print"}];Att_Common_Operations.moreOptionMenu(moreOpt),$(shiftMapping.getShiftMapPopupHtml(!0)).insertAfter(page.closest(".cont-wrap")),Layout.Page.container.find("#calViewCalNav").off().on("click",function(event){var calSettingObj={attendance:!0,weekselection:!0};Calendar.setUpCalendar(event,$(this).parent().parent().find("#calViewNavVal"),void 0,void 0,SingleUserShiftMapping.weeklyViewCalNav,void 0,calSettingObj)}),SingleUserShiftMapping.constructWeeklyData(),SingleUserShiftMapping.setNavOnClick()}else page.find("#monthlyView").is(":visible")?(page.removeClass("zpl_tblfxd"),page.removeClass("zpl_tbllftfxd"),shiftMapping.isCalView=!0,shiftMapping.isHoursView=!1,CalendarView.constructBasicData(this.calObj)):(shiftMapping.isCalView=!1,shiftMapping.isHoursView=!0,SingleUserShiftMapping.getWeeklyData());shiftMapping.hideShiftChangeDropDown()},toggleViews:function(obj){var page=settingsPage.container;$(obj).addClass("zpl_act"),$(obj).siblings().removeClass("zpl_act"),"monthly"===obj.id?(page.removeClass("zpl_tblfxd"),page.removeClass("zpl_tbllftfxd"),shiftMapping.isCalView=!0,shiftMapping.isHoursView=!1,page.find("#monthlyView").show(),page.find("#weeklyView").hide(),void 0===page.find("#monthlyView")[0]?(this.calObj=new CalendarView.calObj(SingleUserShiftMapping.getMonthData),CalendarView.initCalendar(this.calObj)):CalendarView.constructBasicData(this.calObj),Layout.Page.container.find("#calViewCalNav").off().on("click",function(event){Calendar.setUpCalendar(event,$(this).parent().parent().find("#calViewNavVal"),2,void 0,SingleUserShiftMapping.monthViewCalNav)})):(shiftMapping.isCalView=!1,shiftMapping.isHoursView=!0,page.find("#monthlyView").hide(),SingleUserShiftMapping.constructWeeklyData(),page.find("#weeklyView").show(),SingleUserShiftMapping.setNavOnClick(),Layout.Page.container.find("#calViewCalNav").off().on("click",function(event){var calSettingObj={attendance:!0,weekselection:!0};Calendar.setUpCalendar(event,$(this).parent().parent().find("#calViewNavVal"),void 0,void 0,SingleUserShiftMapping.weeklyViewCalNav,void 0,calSettingObj)}))},monthViewCalNav:function(dateVal,obj,data){SingleUserShiftMapping.calObj.curMonth=data.selectedMonth,SingleUserShiftMapping.calObj.curYear=data.selectedYear,CalendarView.constructBasicData(SingleUserShiftMapping.calObj),settingsPage.container.find("#calViewCalNav").html("")},weeklyViewCalNav:function(dateVal,obj,data){SingleUserShiftMapping.weeklyViewFromDate=CalendarView.formatDate(data.fromDate),SingleUserShiftMapping.weeklyViewToDate=CalendarView.formatDate(data.toDate),SingleUserShiftMapping.weeklyViewFetchFromdate=moment(data.fromDate).add(-1,"day").format(dateFmt.toUpperCase()),SingleUserShiftMapping.getWeeklyData(),settingsPage.container.find("#calViewCalNav").html("")},setNavOnClick:function(){var page=settingsPage.container;page.find(".PI_alft").off("click"),page.find(".PI_argt").off("click"),page.find(".PI_alft").on("click",function(){SingleUserShiftMapping.previousWeek()}),page.find(".PI_argt").on("click",function(){SingleUserShiftMapping.nextWeek()})},previousWeek:function(){var tempDate=moment(SingleUserShiftMapping.weeklyViewFromDate,dateFmt.toUpperCase()).add(-7,"day");SingleUserShiftMapping.weeklyViewFromDate=tempDate.format(dateFmt.toUpperCase()),SingleUserShiftMapping.weeklyViewToDate=tempDate.add(6,"day").format(dateFmt.toUpperCase()),SingleUserShiftMapping.weeklyViewFetchFromdate=tempDate.add(-7,"day").format(dateFmt.toUpperCase()),SingleUserShiftMapping.getWeeklyData()},nextWeek:function(){var tempDate=moment(SingleUserShiftMapping.weeklyViewFromDate,dateFmt.toUpperCase()).add(7,"day");SingleUserShiftMapping.weeklyViewFromDate=tempDate.format(dateFmt.toUpperCase()),SingleUserShiftMapping.weeklyViewToDate=tempDate.add(6,"day").format(dateFmt.toUpperCase()),SingleUserShiftMapping.weeklyViewFetchFromdate=tempDate.add(-7,"day").format(dateFmt.toUpperCase()),SingleUserShiftMapping.getWeeklyData()},constructWeeklyData:function(){var page=settingsPage.container;if(void 0===page.find("#weeklyView")[0]){var toDay=moment(Att_Common_Operations.getShiftDepLocShiftList().currDate.todayDate,dateFmt.toUpperCase()),weekStartDate=moment(toDay).startOf("week").add(weekstarts,"day");toDay._d.getTime()<weekStartDate._d.getTime()&&(weekStartDate=weekStartDate.add(-1,"week")),SingleUserShiftMapping.weeklyViewFromDate=weekStartDate.format(dateFmt.toUpperCase()),SingleUserShiftMapping.weeklyViewToDate=weekStartDate.add(6,"day").format(dateFmt.toUpperCase()),SingleUserShiftMapping.weeklyViewFetchFromdate=weekStartDate.add(-7,"day").format(dateFmt.toUpperCase());var html='<div class="zpl_rgtcnt"><div class="_dayvw" id="weeklyView"><div class="zpl_tblres"><table class="zpl_tbl zpl_shftmap zpl_nocrsor">';html+='<thead><tr id="weeklyViewHeader"><th></th><th><table><thead><tr>',html+=shiftMapping.getHrViewHeader(),html+="</tr></thead></table></th></tr></thead>",html+='<tbody id="weeklyViewBody"></tbody></table></div></div></div>',page.append(html),page.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.shiftsig")]),tabindex:"0"})}SingleUserShiftMapping.getWeeklyData()},getWeeklyData:function(){var page=settingsPage.container;page.find("#weeklyViewBody").empty();var param={mode:"getUserCalView",conreqcsr:csrfToken};param.isFromLeave=shiftMapping.isFromLeavePage(),param.sdate=SingleUserShiftMapping.weeklyViewFetchFromdate,param.edate=SingleUserShiftMapping.weeklyViewToDate;var erecArr=[];erecArr.push(AttendanceTeam.getSelfReqPageErecno()),param.userId=JSON.stringify(erecArr),TimelySettings.showHideLoadingPage(!0),page.removeClass("zpl_tblfxd"),page.removeClass("zpl_tbllftfxd"),$.post("/AttendanceShiftAction.zp",param,function(rdata){if(shiftMapping.leaveTypes=rdata.leaveTypes,TimelySettings.showHideLoadingPage(!1),rdata.newSettingsPermDenied)return void TimelySettings.showHidePermissionDenied(!0);SingleUserShiftMapping.hoursDateArray=rdata.dateArray,rdata.userList[0].isEditFuture?page.find("#singleUserAssignShiftBtn").show():page.find("#singleUserAssignShiftBtn").hide(),page.addClass("zpl_tblfxd"),page.addClass("zpl_tbllftfxd");let shiftList=rdata.userList[0].shiftList;var weekStart=moment(SingleUserShiftMapping.weeklyViewFromDate,dateFmt.toUpperCase()),dayIndex=weekstarts,starttd=23,endtd=0;for(let index=1;index<=7;index++){((shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftList[index-1].shiftId]).tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(starttd=0);var shiftId=(curDet=shiftList[index]).shiftId,ftime=(shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftId]).fTime/60;(ttime=shift.tTime/60)<ftime&&(ttime+=24),(ftime<starttd||0===ftime)&&(starttd=Math.floor(ftime)),ttime>endtd&&(endtd=Math.floor(ttime)),0===ttime&&(endtd=24)}starttd--,++endtd>24&&(endtd=24),starttd<0&&(starttd=0);var perCal=60*(endtd-starttd)+1,shiftStartMinus=60*starttd;page.find("#weeklyViewHeader").empty(),page.find("#weeklyViewHeader").append("<th></th><th><table><thead><tr>"+shiftMapping.getHrViewHeader(starttd,endtd)+"</tr></thead></table></th>");for(let index=1;index<=7;index++){var shift,nightShift=null;((shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftList[index-1].shiftId]).tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(nightShift=shift);shiftId=(curDet=shiftList[index]).shiftId;var curDet,addClass=curDet.isHoliday?" Hday_bg ":curDet.isWeekend?" wknd_bg ":"",title=curDet.isHoliday?holiday_disName:curDet.isWeekend?ZPI18N.getString("zp.weekend"):"";title=""!==title?'title="'+title+'"':"";var curDate=rdata.dateArray[index],curDayClass="";curDate===Att_Common_Operations.getShiftDepLocShiftList().currDate.todayDate&&(curDayClass="Cl-today");var html='<tr class="'+curDayClass+'"><td class="mw80'+addClass+'" tabindex="0" aria-label="'+(curDet.isWeekend?ZPI18N.getString("zp.weekend"):ZPI18N.getString("zp.holiday"))+" "+days[dayIndex]+" "+weekStart.date()+'"><div class="d-flexclmcap d-flexclmcap5"><em>'+days[dayIndex]+"</em>";dayIndex=dayIndex>5?0:dayIndex+1,html+="<b>"+weekStart.date()+"</b></div></td>",html+='<td class="mw80"><table class="zpl_lvdatashw"><tbody date="'+curDate+'"><tr id="'+AttendanceTeam.getSelfReqPageErecno()+'">';var shiftContWidth=perCal;(shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftId]).fTime,shift.tTime;shift.tTime>shift.fTime?shiftContWidth=60*((shift.tTime-shift.fTime)/60):(shift.tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(shiftContWidth=perCal-shift.fTime);var day_tdata="",night_tdata="",calClick="",showCrsrCls="",editIcon="";if(curDet.isEdit&&(calClick=' onclick="shiftMapping.appendShiftDropDown(this.parentElement, event)"',editIcon=shiftMapping.getEditIconHtml(),showCrsrCls=" zpl_cp"),null!=nightShift){var sDet=nightShift,sTime=(sDet.tTime,Attendance.disTime(sDet.fTime,!1,!0).toUpperCase()+" - "+Attendance.disTime(sDet.tTime,!1,!0).toUpperCase());sDet.tTime/perCal*100!=0&&(night_tdata+='<td class="'+addClass+'"'+title+'><div class="zpl_shftdts jc'+sDet.colorCode+'"style="width:'+sDet.tTime/perCal*100+'%; left:0%" tabindex="0" aria-label ="'+sDet.shiftName+" / "+sTime+'" title="'+sDet.shiftName+" / "+sTime+'"><div><div>'+sDet.shiftName+" </div><em>"+sTime+"</em></div></div>"),nightShift=null}var shiftTime=Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0);day_tdata='<td class="'+addClass+showCrsrCls+'" '+title+'><div class="zpl_shftdts jc'+shift.colorCode+'" '+calClick+' style="width:'+shiftContWidth/perCal*100+"%; left:"+(shift.fTime-shiftStartMinus)/perCal*100+'%;" tabindex="0" aria-label="'+shift.shiftName+" / "+shiftTime+'" title="'+shift.shiftName+" / "+shiftTime+'">'+editIcon+"<div><div>"+shift.shiftName+" </div><em>"+shiftTime+"</em></div></div>";var ttime;ftime=shift.fTime/60;(ttime=shift.tTime/60)<ftime&&(ttime+=24),day_tdata+=shiftMapping.getShiftLeaveInfo(shiftContWidth,shiftStartMinus,curDet,starttd,endtd,perCal,!1,curDate),day_tdata+="</td>",(night_tdata+=shiftMapping.getShiftLeaveInfo(shiftContWidth,shiftStartMinus,shiftList[index-1],starttd,endtd,perCal,!0,curDate))&&(night_tdata+="</td>");for(var k=starttd;k<endtd;k++){var isNightShift=!!night_tdata;isNightShift&&0==k&&(html+=night_tdata),ftime>=k&&ftime<k+1?html+=day_tdata:0==k&&isNightShift||(html+=ftime<k&&ttime>k?'<td class="'+addClass+showCrsrCls+'"'+calClick+" "+title+"></td>":'<td class="'+addClass+'"'+title+"></td>")}html+="</tr></tbody></table></td></tr>",page.find("#weeklyViewBody").append(html),weekStart=weekStart.add(1,"day")}page.find("#calViewNavVal").text(SingleUserShiftMapping.weeklyViewFromDate+" - "+SingleUserShiftMapping.weeklyViewToDate),page.find("#calViewNavVal").attr({"aria-label":ZPI18N.getString("zp.common.period")+SingleUserShiftMapping.weeklyViewFromDate+" - "+SingleUserShiftMapping.weeklyViewToDate,tabindex:"0"})})},getMonthData:function(calObj){var page=settingsPage.container,param={mode:"getUserCalView",conreqcsr:csrfToken};param.isFromLeave=shiftMapping.isFromLeavePage(),param.sdate=calObj.fromDate,param.edate=calObj.toDate;var erecArr=[];erecArr.push(AttendanceTeam.getSelfReqPageErecno()),param.userId=JSON.stringify(erecArr),$.post("/AttendanceShiftAction.zp",param,function(rdata){if(TimelySettings.showHideLoadingPage(!1),rdata.newSettingsPermDenied)return void TimelySettings.showHidePermissionDenied(!0);SingleUserShiftMapping.monthDateArray=rdata.dateArray;let shiftList=rdata.userList[0].shiftList;rdata.userList[0].isEditFuture?page.find("#singleUserAssignShiftBtn").show():page.find("#singleUserAssignShiftBtn").hide();for(let index=0;index<shiftList.length;index++){var curEle=page.find("#calViewBody").find(".zpcaldays,.Cl-today").eq(index);curEle.append(SingleUserShiftMapping.getCurShiftHtml(shiftList[index],index));var curDayTitle=shiftList[index].isWeekend?ZPI18N.getString("zp.weekend"):"";shiftList[index].isHoliday&&(curEle.removeClass("Cl-wked").addClass("Cl-hlday"),curDayTitle=holiday_disName),curEle.attr("title",curDayTitle)}})},getCurShiftHtml:function(curDet,index){var shiftId=curDet.shiftId,onclick='"',editIcon="";curDet.isEdit&&(onclick=' zpl_cp" onclick="shiftMapping.appendShiftDropDown(this)"',editIcon=shiftMapping.getEditIconHtml());var shift=Att_Common_Operations.getShiftDepLocShiftList().shiftlist[shiftId],className="jc"+shift.colorCode,shiftTime=Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0),html='<div class="zpl_shftdts '+className+onclick+' title="'+shift.shiftName+" / "+shiftTime+'">'+editIcon+"<span>"+shift.shiftName+"</span>";return html+="<em>"+shiftTime+"</em></div>",curDet.isLeave&&(html+=shiftMapping.consLeaveInfo(shift,SingleUserShiftMapping.monthDateArray[index],curDet.leaveInfo)),html},resetOtherTabValues:function(){shiftMapping.userListValue=null,shiftMapping.userCalValue=null,shiftMapping.userHoursValue=null}},MySpaceShift={temp_tsecs:0,init:function(){if(ZPeople.Module.MODULE_DATA.attendance){shiftMapping.setShiftGlobalVariables();var page=Layout.Page.container;if(0===page.children().length){var html='<div class="zpl_msplst" aria-label="'+ZPI18N.getString("zp.thisweek")+'" tabindex="0"><div class="zpl_msp-hgroup"><div><b>'+ZPI18N.getString("zp.thisweek")+"</b></div></div></div>";html+='<div class="zpl_tblfxd zpl_sstbl"><div class="zpl_tbllftfxd"><div class="_dayvw"><div class="zpl_tblres"><table class="zpl_tbl zpl_shftmap zpl_nocrsor"><tbody id="myShiftBody">',html+="</tbody></table></div></div></div></div></div>",page.append(html),$(shiftMapping.getShiftMapPopupHtml()).insertAfter(page.closest(".main-wrp")),shiftMapping.hideShiftChangeDropDown(),$(shiftMapping.getShiftMapPopupHtml(void 0,"Rectify")).insertAfter(page.closest(".main-wrp")),$("#"+Att_Common_Operations.getFilterDivId()+"Rectify").hide()}page.find("#myShiftBody").empty();var param={mode:"getAttListForShift",conreqcsr:csrfToken,loadToday:!1,view:"week",preMonth:0};void 0!==weekstarts&&(param.weekStarts=weekstarts+1);var url=Layout.Page.hash.replace("#","");(isUserSpace=url.includes("home/user/shift"))?($(Layout.Page.container[0]).addClass("zpl_myprofcnt"),param.erecno=Layout.Page.urlparam.id,param.isNewVerUserSpace=!0):param.isNewVerMySpace=!0,$.post("/AttendanceViewAction.zp",param,function(rdata){var isAttendance=(attConfig=ZPeople.Module.MODULE_DATA.attendance).isAttendanceEnabled;isAttendance&&permission.loadPermissionDetails(void 0,AttendanceTeam.getSelfReqPageErecno());var showRectifyInCmn=isAttendance&&(attConfig.isRegConfigured||attConfig.isPermissionConfigured||attConfig.isOnDutyConfigured)||-1!==ZPTabs.ACTIVE_TABARR.toString().toLowerCase().indexOf("leavetracker")||rdata.allowBookCompoff,leaveTypes=rdata.leaveTypes;if(rdata.dayList){for(var isnextToCurDay=!1,index=0;index<7;index++){var currDayDet=rdata.dayList[index],shift=currDayDet.shift,day=days[(index+weekstarts)%7],date=currDayDet.attDate.split("-")[2],isCurrentDay=currDayDet.isToday,status=currDayDet.status,isWknd=status.includes("Weekend")&&!status.includes("0.5"),wkndOrHoliday=(status.includes("Holiday")||Att_Common_Operations.isRestrictedHoliday(status))&&!status.includes("0.5")?" Hday_bg":isWknd?" wknd_bg":"",currDayCls=isCurrentDay?' class="Cl-today"':"",totHrs="00:00"===currDayDet.tHrs?"":currDayDet.tHrs,editAllowed=rdata.isEditShift,attConfig=ZPeople.Module.MODULE_DATA.attendance,isRectify=!1;""!=currDayCls&&(isnextToCurDay=!0),filoDetails=currDayDet.filo;var filoDtls=(filoDetails.ftime?filoDetails.ftime:ZPI18N.getString("zp.noin"))+" - "+(filoDetails.ttime?filoDetails.ttime:ZPI18N.getString("zp.noout")),filoEntries='<div><span title="'+ZPI18N.getString("zp.fiandlo")+'" aria-label = "'+ZPI18N.getString("zp.fiandlo")+":"+filoDtls+'" tabindex="0">';filoEntries+=filoDtls+"</span>",(""!=totHrs||isCurrentDay&&filoDetails.ftime)&&(filoEntries+='<em class="zpl_dots sm"></em>',filoEntries+='<em aria-label="'+ZPI18N.getString("zp.totalhours")+":"+totHrs+'" tabindex="0" title="'+ZPI18N.getString("zp.totalhours")+'"',isCurrentDay&&(filoEntries+=' id="totHrsSpan"'),filoEntries+=">"+totHrs+"</em>"),filoEntries+="</div>",isnextToCurDay&&!status.includes("Absent")&&(!isCurrentDay||filoEntries.includes(ZPI18N.getString("zp.noin"))&&filoEntries.includes(ZPI18N.getString("zp.noout")))&&(filoEntries="");var dividedStat="<div>",splitStat=status.split(","),officeInDname=Att_Common_Operations.isModuleDataLoaded&&ZPeople.Module.MODULE_DATA.attendance.officeINdNameEncoded?ZPeople.Module.MODULE_DATA.attendance.officeINdNameEncoded:ZPI18N.getString("zp.officein"),remoteInDname=Att_Common_Operations.isModuleDataLoaded&&ZPeople.Module.MODULE_DATA.attendance.remoteINdNameEncoded?ZPeople.Module.MODULE_DATA.attendance.remoteINdNameEncoded:ZPI18N.getString("zp.remotein"),totalPre=0,localcurStat="";splitStat.forEach(function(val){var curStat="",isStatAdded=!1;if("<div>"!=dividedStat&&(curStat+='<em class="zpl_msp-splt"> | </em>'),curStat+='<span class="',isnextToCurDay&&""!=val)if(val.includes("0.5"))totalPre+=.5;else if(val.includes("0.25"))totalPre+=.25;else{var sesIndex=val.indexOf("#"),sesEndindex=val.lastIndexOf("#");(-1===sesIndex||sesEndindex-sesIndex!=6&&sesEndindex-sesIndex!=7&&sesEndindex-sesIndex!=8)&&(totalPre+=1)}if(val===officeInDname||val===remoteInDname)curStat+='grn">';else if(val.includes("Present"))curStat+='grn">';else if(val.includes("Absent"))curStat+='red">';else if(val.includes("Weekend"))curStat+='zpl_wkendclr">';else if(val.includes("Holiday")||Att_Common_Operations.isRestrictedHoliday(val))curStat+='zpl_holiclr">';else if(val.includes("Paid Leave")||val.includes("Unpaid Leave")||val.includes("On Duty")){var sessionTxt=void 0;if(val.includes("0.5")||val.includes("0.25")){sesIndex=val.indexOf("$");var session=void 0;(sesEndindex=val.lastIndexOf("$"))-sesIndex==2&&(session=val[sesIndex+1]),void 0!=session&&(val.includes("0.5")?sessionTxt="("+(1==session?ZPI18N.getString("zp.firsthalf"):ZPI18N.getString("zp.secondhalf"))+")":val.includes("0.25")&&(sessionTxt="(",1==session?sessionTxt+=ZPI18N.getString("zp.firstquarter"):2==session?sessionTxt+=ZPI18N.getString("zp.secondquarter"):3==session?sessionTxt+=ZPI18N.getString("zp.thirdquarter"):4==session&&(sessionTxt+=ZPI18N.getString("zp.fourthquarter")),sessionTxt+=")"))}var clrCls=val.includes("Paid Leave")?"lv_clr1":val.includes("Unpaid Leave")?"red":"lv_clr3";-1!==val.indexOf("Paid Leave")?val=(val=val.slice(val.indexOf("Paid Leave"),val.indexOf(",",val.indexOf("Paid Leave")))).replace("Paid Leave(",""):-1!==val.indexOf("Unpaid Leave")?val=(val=val.slice(val.indexOf("Unpaid Leave"),val.indexOf(",",val.indexOf("Unpaid Leave")))).replace("Unpaid Leave(",""):-1!==status.indexOf("On Duty")&&(val=(val=val.slice(val.indexOf("On Duty"),val.indexOf(",",val.indexOf("On Duty")))).replace("On Duty(","")),leaveTypes.forEach(function(curType){val.includes(curType.lName)&&(clrCls=curType.lColorCode)});sesIndex=val.indexOf("$");if((sesEndindex=val.lastIndexOf("$"))-sesIndex==2&&(val=val.slice(0,sesIndex)),sesIndex=val.indexOf("#"),(sesEndindex=val.lastIndexOf("#"))-sesIndex==6||sesEndindex-sesIndex==7||sesEndindex-sesIndex==8){var hrsMins=val.slice(val.indexOf("- ")+2).split(":"),leaveMins=60*Attendance.changeToMin(parseInt(hrsMins[0]),parseInt(hrsMins[1]));totalPre+=leaveMins/currDayDet.fullDayReq,val=(val=val.slice(0,sesIndex)+val.slice(sesEndindex+1,val.length)).replace(" - ","(")+" "+ZPI18N.getString("zp.leavetype.hour.plural")+")"}curStat+=clrCls+'">'}"Present"===val?(curStat+=ZPI18N.getString("zp.present"),isStatAdded=!0):val.includes("Absent")?isAttendance&&("Absent"===val?(curStat+=ZPI18N.getString("zp.absent"),isStatAdded=!0):(curStat+=val,isStatAdded=!0)):""!==val&&(curStat+=ZSEC.Encoder.encodeForHTML(val),void 0!=sessionTxt&&(curStat+=sessionTxt),isStatAdded=!0),curStat+="</span>",isStatAdded&&(dividedStat+=curStat),localcurStat+=ZSEC.Encoder.encodeForHTML(val)+","}),dividedStat+="</div>",showRectifyInCmn&&(!isnextToCurDay&&status.includes("Absent")||isnextToCurDay&&totalPre<1)&&(isRectify=!0);var shiftTime=Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0),tr="<tr "+currDayCls+' date="'+currDayDet.attDate+'">';if(tr+='<td class="'+wkndOrHoliday+' text-center w100"><div class="d-flexclmcap d-flexclmcap5" aria-label="'+day+":"+date+'" tabindex="0"><em>'+day+"</em><b>"+date+"</b></div></td>",tr+='<td class="'+wkndOrHoliday+' d-flexM"><div class="zpl_shftdts jc'+shift.colorCode+'" shiftid='+shift.shiftId,editAllowed&&(tr+=' onclick="MySpaceShift.onShiftEditClick(this)"'),tr+=">",editAllowed&&(tr+='<div class="zpl_shftedit" aria-label="'+ZPI18N.getString("zp.editshift")+'" tabindex="0" ><i class="PI_edt"></i></div>'),tr+='<span class="zpl_ellipsis" aria-label = "'+ZPI18N.getString("zp.shiftname")+":"+shift.shiftName+'" tabindex="0">'+shift.shiftName+'</span><em aria-label="'+ZPI18N.getString("zp.shifttime")+":"+shiftTime+'" tabindex="0">'+shiftTime+"</em></div></td>",tr+='<td class="'+wkndOrHoliday+' w300"><div class="zpl_shftprsnt" aria-label="'+localcurStat+'" tabindex ="0">',isAttendance&&(tr+=filoEntries),tr+=dividedStat+"</div></td>",isRectify?(tr+='<td class="'+wkndOrHoliday+' w200"><div class="zpl_hvr">',tr+='<button class="zlabel zlabel--blue zlabel--medium zlabel--outline" aria-label = "'+ZPI18N.getString("zp.rectify")+'" tabindex="0" onclick="MySpaceShift.rectify(this, '+rdata.allowBookCompoff+')">'+ZPI18N.getString("zp.rectify")+"</button></div></td>"):tr+="<td></td>",page.find("#myShiftBody").append(tr),isCurrentDay){var curDayEntries=rdata.entries[currDayDet.attDate],curDayLastEntry=curDayEntries.length-1;curDayLastEntry>=0&&curDayEntries[curDayLastEntry].tempRunSecs&&MySpaceShift.setRunningTimer(curDayEntries[curDayLastEntry].tempRunSecs,!0)}}page.attr({"aria-label":ZPI18N.getString("zp.common.myspacetab",[ZPI18N.getString("zp.attendance")]),tabindex:"0"}),page.focus()}})}else{var params={initmodule:JSON.stringify({modulePrefix:"attendance"})};ZPeople.Request.send("/gettabdetails/initpage",params,function(result){result.initmodule&&(ZPeople.Module.MODULE_DATA.attendance=result.initmodule,MySpaceShift.init())})}},rectify:function(obj,allowBookCompoff){Layout.Page.container.find("#rectifyButton").length>0&&Layout.Page.container.find("#rectifyButton").removeAttr("id"),$(obj).attr("id","rectifyButton");var rectifyEle=$("#mySpaceShiftRectify");rectifyEle.attr("tabindex","0"),rectifyEle.focus(),rectifyEle.find(".zpl_aprvlst").empty(),rectifyEle.parent().addClass("zpl_hvrsw");var attConfig=ZPeople.Module.MODULE_DATA.attendance,drpDwnOptns="";onclick="",Att_Common_Operations.initComponents();var topfix,left,curDate=$(obj).closest("tr").attr("date").split("-");attConfig.isAttendanceEnabled&&attConfig.isRegConfigured&&(drpDwnOptns+=`<div class="zpl_aprv_stus" onclick="regularization_operation.constructRequestReg(undefined, ${curDate[2]}, ${curDate[1]}, ${curDate[0]})">\n\t\t\t\t\t\t\t\t<span class="zpl_ellipsis w200">\n\t\t\t\t\t\t\t\t\t<span aria-label ="${ZPI18N.getString("zp.regatt")}" tabindex="0">${ZPI18N.getString("zp.regatt")}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>`),attConfig.isAttendanceEnabled&&attConfig.isPermissionConfigured&&(drpDwnOptns+=`<div class="zpl_aprv_stus" onclick="permission.initPermReqFromEntry(${curDate})">\n\t\t\t\t\t\t\t\t<span class="zpl_ellipsis w200">\n\t\t\t\t\t\t\t\t\t<span aria-label ="${ZPI18N.getString("zp.apphyperm")}" tabindex="0">${ZPI18N.getString("zp.apphyperm")}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>`),attConfig.isAttendanceEnabled&&attConfig.isOnDutyConfigured&&(drpDwnOptns+=`<div class="zpl_aprv_stus" onclick="onduty.initODReqFromEntry(${curDate})">\n\t\t\t\t\t\t\t\t<span class="zpl_ellipsis w200">\n\t\t\t\t\t\t\t\t\t<span aria-label ="${ZPI18N.getString("zp.appod")}" tabindex="0">${ZPI18N.getString("zp.appod")}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>`),-1!==ZPTabs.ACTIVE_TABARR.toString().toLowerCase().indexOf("leavetracker")&&(drpDwnOptns+=`<div class="zpl_aprv_stus" onclick="MySpaceShift.applyLeave(${curDate}, 1)">\n\t\t\t\t\t\t\t\t<span class="zpl_ellipsis w200">\n\t\t\t\t\t\t\t\t\t<span aria-label ="${ZPI18N.getString("zp.leave.apply")}" tabindex="0">${ZPI18N.getString("zp.leave.apply")}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>`),allowBookCompoff&&(drpDwnOptns+=`<div class="zpl_aprv_stus" onclick="MySpaceShift.applyLeave(${curDate},2)">\n\t\t\t\t\t\t\t\t<span class="zpl_ellipsis w200">\n\t\t\t\t\t\t\t\t\t<span aria-label ="${ZPI18N.getString("zp.appcompoff")}" tabindex="0">${ZPI18N.getString("zp.appcompoff")}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>`),rectifyEle.find(".zpl_aprvlst").append(drpDwnOptns);var topAdjust=45,docHei=$(document).height(),dropdownHei=rectifyEle.find(".zpl_aprvlst").parent().outerHeight(),elemPos=document.getElementById("rectifyButton").getBoundingClientRect();topfix=elemPos.bottom,left=elemPos.right;var isZohoOne=-1!=window.location.origin.indexOf("https://one");topfix-=topAdjust+=$(document).find("#welcomebanner").is(":visible")?isZohoOne?-10:40:isZohoOne?-50:0,left-=290,topfix-=dropdownHei+topfix+75>=docHei?dropdownHei+75:35,rectifyEle.removeClass("top"),rectifyEle.removeClass("bottom"),rectifyEle.css({top:topfix+"px"}),rectifyEle.css({left:left+"px"}),rectifyEle.show(),event.stopPropagation(),$(document).find("body").one("click",MySpaceShift.hideRectify)},applyLeave:function(lvYr,lvMon,lvDt,leaveType){var d=new Date;d.setFullYear(lvYr,lvMon>0?lvMon-1:0,lvDt);var selectedDate=Calendar.formatDate(d);new LeaveForm({initEmployee:erecno,initApplyLvDate:selectedDate,leaveTypeMode:leaveType}).add()},hideRectify:function(){var rectifyEle=$("#mySpaceShiftRectify");rectifyEle.hide(),rectifyEle.parent().removeClass("zpl_hvrsw"),Layout.Page.container.find("#rectifyButton").length>0&&Layout.Page.container.find("#rectifyButton").removeAttr("id")},setRunningTimer:function(addSecs,store){var page=Layout.Page.container,curTime=(new Date).getTime();if(store)MySpaceShift.temp_tsecs=addSecs;else{var diffSec=void 0!=MySpaceShift.prevCurTime?(curTime-MySpaceShift.prevCurTime)/1e3:0;MySpaceShift.temp_tsecs+=diffSec>1?diffSec-1+1:1}var sec=parseInt(MySpaceShift.temp_tsecs%60),min=parseInt((MySpaceShift.temp_tsecs-sec)/60%60),hrs=parseInt((MySpaceShift.temp_tsecs-min)/3600),time=Attendance.disTwoDigit(hrs)+":"+Attendance.disTwoDigit(min)+" "+ZPI18N.getString("zp.hrs");page.find(".Cl-today #totHrsSpan").html(time),MySpaceShift.prevCurTime=curTime},onShiftEditClick:function(obj){MySpaceShift.shiftEditObj&&$(MySpaceShift.shiftEditObj).parent().removeClass("zpl_hvrsw"),$(obj).parent().addClass("zpl_hvrsw"),$("#page-wrapper").one("click",function(event){$(event.target).closest("#"+Att_Common_Operations.getFilterDivId()+"SingleDayEdit").length<=0&&$(obj).parent().removeClass("zpl_hvrsw")}),event.stopPropagation(),$(obj).attr("id","changeShiftClickButtonId"),Layout.Page.hash.replace("#","").includes("home/user/shift")&&(erecno=Layout.Page.urlparam.id),shiftMapping.getApplicableShifts(erecno,!0,obj),MySpaceShift.shiftEditObj=obj},changeShift:function(obj){var params={erecno:erecno,shiftid:obj.id,mode:"addUserShiftMapping",update:!0,conreqcsr:csrfToken,fdate:$(MySpaceShift.shiftEditObj).closest("tr").attr("date"),tdate:$(MySpaceShift.shiftEditObj).closest("tr").attr("date"),updateAttEntries:!1};Attendance.isSpiceJet()||(params.updateAttEntries=!0),$.post("/AttendanceShiftAction.zp",params,function(rdata){rdata.error?rdata.error===ZPI18N.getString("zp.cannoteditpastshift")?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.cannoteditpastshift")):"payPeriodExceed"===rdata.error?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.attendance.shiftChange.immutableinfo")):"Todate is mandatory when pattern mapped"===rdata.error&&ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.todatemandatorywhenpatternset")):(shiftMapping.hideShiftChangeDropDown(),isShiftApprConfigured?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.shiftchangerequestraisedsuccess")):(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.shiftmapeditsuccessmsg")),MySpaceShift.init()),$(MySpaceShift.shiftEditObj).parent().removeClass("zpl_hvrsw"))})}},CalendarView={currrentDate:new Date,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],daysObj:{empty:"",weekend:"Cl-wked",day:"zpcaldays",today:"Cl-today",leave:"zpcalholi"},calObj:function(callBack){this.curYear=(new Date).getFullYear(),this.curMonth=(new Date).getMonth(),this.callBack=callBack},initCalendar:function(calObj){this.setMonthlyCalendarHtml(),this.constructBasicData(calObj)},setNavOnClick:function(calObj){var page=settingsPage.container;page.find(".PI_alft").off("click"),page.find(".PI_argt").off("click"),page.find(".PI_alft").on("click",function(){CalendarView.previousMonth(calObj)}),page.find(".PI_argt").on("click",function(){CalendarView.nextMonth(calObj)})},setMonthlyCalendarHtml:function(){var calHtml='<div class="zpl_calndrvw""><div class="ZPcalvw-cnt ZPcalvw-thtd" id="monthlyView">';calHtml+='<div class="ZPcalvw-month-hd ZPcalvw-row"><table class="zpl_nocrsor"><tbody><tr id="calViewHeader">';for(var day=weekstarts,dayCnt=0;dayCnt<days.length;dayCnt++)calHtml+="<td><small>"+days[day]+"</small></td>",day=day>5?0:day+1;calHtml+="</tr></tbody></table></div>",calHtml+='<div class="ZPcalvw-box ZPcalvw-month-view"><table><tbody class="ZPcalvw-box-body">',calHtml+='<tr><td class="ZPcalvw-box-tdbox"><div class="ZPcalvw-box-main"><div class="ZPcalvw-box-mainbox ZPcalvw-row"><table class="ZPcalvw-month-tb zpl_nocrsor" id="calViewBody"><tbody>';for(var j=0;j<6;j++){for(calHtml+='<tr id="'+AttendanceTeam.getSelfReqPageErecno()+'">',i=0;i<7;i++)calHtml+='<td id="'+AttendanceTeam.getSelfReqPageErecno()+'"></td>';calHtml+="</tr>"}calHtml+="</tbody></table></div></div></td></tr></tbody></table></div></div></div>",settingsPage.container.find(".zpl_rgtcnt").append(calHtml)},constructBasicData:function(calObj){var page=settingsPage.container;CalendarView.setNavOnClick(calObj),CalendarView.clearOldvalues();var startDate=CalendarView.formatDate(new Date(calObj.curYear,calObj.curMonth)),endDate=CalendarView.formatDate(new Date(new Date(calObj.curYear,calObj.curMonth+1)-1));calObj.fromDate=startDate,calObj.toDate=endDate,TimelySettings.showHideLoadingPage(!0);var param={mode:"GET_WEEKEND_DEFINITION",fromDate:startDate,toDate:endDate,userErecNo:AttendanceTeam.getSelfReqPageErecno(),userLocation:ZPeople.getUserDetailsById(AttendanceTeam.getSelfReqPageErecno()).locId,conreqcsr:csrfToken};$.post("/commonAction.zp",param,function(resultData){page.find("#calViewNavVal").text(months[calObj.curMonth]+" "+calObj.curYear);var fdayofmonth=CalendarView.getFirstDayofMonth(calObj.curYear,calObj.curMonth);(fdayofmonth-=Number(weekstarts))<0&&(fdayofmonth+=7);var ndayofmonth=Calendar.daysInMonth(calObj.curYear,calObj.curMonth),tdlist=page.find("#calViewBody").find("td"),startcal=!1,cal=1,i=0,row=1;for(i=0;i<tdlist.length;i++)if(i!=fdayofmonth||startcal||(startcal=!0),startcal&&cal<=ndayofmonth){row=i%7==0?i/7:row;calObj.curYear,calObj.curMonth;tdlist[i].innerHTML='<div class="ZPcalvw-month-day"><span>'+cal+"</span></div>",$(tdlist[i]).attr("date",calObj.curMonth+1+"-"+cal+"-"+calObj.curYear);var currentDate=calObj.curYear+"-"+Attendance.disTwoDigit(calObj.curMonth+1)+"-"+Attendance.disTwoDigit(cal);tdlist[i].ldata=cal,tdlist[i].mdata=calObj.curMonth,tdlist[i].ydata=calObj.curYear;var className="";cal+""==curdate+""&&curmonth+""==calObj.curMonth+""?className=className+" "+CalendarView.daysObj.today:$(tdlist[i]).hasClass("zpcaltotal")||(className=className+" "+CalendarView.daysObj.day),void 0!==resultData.weekendArray&&-1!==resultData.weekendArray.indexOf(currentDate)&&(className=className+" "+CalendarView.daysObj.weekend),tdlist[i].className=className,cal++,28==i&&$(page.find("#calViewBody").find("tbody").children().get(4)).show(),35==i&&$(page.find("#calViewBody").find("tbody").children().get(5)).show()}else tdlist[i].className="findday",28==i&&$(page.find("#calViewBody").find("tbody").children().get(4)).hide(),35==i&&$(page.find("#calViewBody").find("tbody").children().get(5)).hide();calObj.callBack&&"function"==typeof calObj.callBack&&calObj.callBack(calObj)})},clearOldvalues:function(){var tdlist=settingsPage.container.find("#calViewBody").find("td");$.each(tdlist,function(tdindex,data){$(tdlist[tdindex]).html("")})},nextMonth:function(calObj){var month=calObj.curMonth,year=calObj.curYear;11==month?(calObj.curMonth=0,calObj.curYear=year+1):calObj.curMonth=month+1,this.constructBasicData(calObj)},previousMonth:function(calObj){var month=calObj.curMonth,year=calObj.curYear;0==month?(calObj.curMonth=11,calObj.curYear=year-1):calObj.curMonth=month-1,this.constructBasicData(calObj)},daysInMonth:function(year,month){return void 0==year&&(year=this.currrentDate.getFullYear()),void 0==month&&(month=this.currrentDate.getMonth()),new Date(year,month+1,0).getDate()},getFirstDayofMonth:function(year,month){return void 0==year&&(year=this.currrentDate.getFullYear()),void 0==month&&(month=this.currrentDate.getMonth()),new Date(year,month,1).getDay()},formatDate:function(cdate){var test={},tmpDate=uidateFormat,udate=uidateFormat.match(/%./g),date=cdate.getDate(),month=cdate.getMonth(),fullyear=cdate.getFullYear(),year=cdate.getFullYear();year>2e3?year-=2e3:2e3===year?year="00":year-=1900,test["%b"]=CalendarView.months[month],date<10&&(date="0"+date),(month+=1)<10&&(month="0"+month),year>0&&year<10&&(year="0"+year),test["%d"]=date,test["%m"]=month,test["%Y"]=fullyear,test["%y"]=year;for(var i=0;i<udate.length;i++)tmpDate=tmpDate.replace(udate[i],test[udate[i]]);return tmpDate}};