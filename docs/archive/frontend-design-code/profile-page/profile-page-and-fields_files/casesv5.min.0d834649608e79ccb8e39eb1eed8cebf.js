var Cases={DEFAULT_MANAGER_CATEGORY:"3",CASES_ADMIN:{},AGENTTYPE_USER:"1",AGENTTYPE_DEPT:"2",AGENTTYPE_GROUPS:"3",AGENTTYPE_MULTIUSER:"4",CGY_LIST:{adminListing:[],userListing:[]},fetchAdminPerm:function(){var e=!1;ZPeople.Request.sendAsyncPost("/cases/admin/data",{method:"getUserCasesAdminData",conreqcsr:csrfToken},(function(t){e=t.isCasesAdmin,Cases.CASES_ADMIN.categoryAdmin=t.categoryAdmin})),Cases.CASES_ADMIN.isAdmin=e},isCaseAdmin:function(e){return $.isEmptyObject(Cases.CASES_ADMIN)&&Cases.fetchAdminPerm(),null!=e&&null!=Cases.CASES_ADMIN.categoryAdmin&&-1!=Cases.CASES_ADMIN.categoryAdmin.indexOf(e)||Cases.CASES_ADMIN.isAdmin},getCgyList:function(e){if(null!=Cases.CGY_LIST[e]&&Cases.CGY_LIST[e].length<=0){var t={method:"fetchCategoryList",conreqcsr:csrfToken,mode:e};ZPeople.Request.sendAsyncPost("/cases/category/list",t,(function(t){Cases.CGY_LIST[e]=t}))}return Cases.CGY_LIST[e]},fetchCgyFromList:function(e,t){var s={};return null!=t&&""!=t&&Cases.CGY_LIST[e].length>0&&$.each(Cases.CGY_LIST[e],(function(e,i){i.categoryId==t&&(s=i)})),s},validateUrl:function(){var e=!1;return $.each(ZPServices.SETTINGS_JSON,(function(t,s){"HRCase"==s.tabName&&s.isActive&&(e=!0)})),e}},casesSettings={categoryIntialCallback:function(){if(-1!=settingsUrlProps.niceUrl.indexOf("settings/service/hrcase/categorylist")&&(settingsPage.container.addClass("zpl_catgCs"),casesSettings.categoryCallback()),"settings/service/hrcase/categoryview"==settingsUrlProps.niceUrl){var e=settingsUrlProps.urlParamsArr.categoryid;casesSettings.Category.editCategory(e)}"settings/service/hrcase/agentnotifications"==settingsUrlProps.niceUrl&&casesSettings.Notifications.list(!0),"settings/service/hrcase/requesternotifications"==settingsUrlProps.niceUrl&&casesSettings.Notifications.list(!1)},categoryCallback:function(){if(settingsPage.container.find("div.zpl_rgtcnt").length<=0){var e=Cases.isCaseAdmin()?'<div class="zpl_rgt"><button onclick="casesSettings.Category.addCategory()" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.addcategory")+"</button></div>":"";settingsPage.container.html('<div class="zpl_btnmnu"><div>'+ZPI18N.getString("zp.categorylistinfo")+"</div>"+e+"</div>");var t={method:"fetchCategoryList",conreqcsr:csrfToken,mode:ADMIN_CGY_LISTING};ZPeople.Request.send("/cases/category/list",t,(function(e){casesSettings.categorySettingListing(e)}))}},categoryListRow:function(e){var t=!Cases.isCaseAdmin()&&-1!=Cases.CASES_ADMIN.categoryAdmin.indexOf(e.categoryId),s=e.isEnabled&&!t?'<i class="PI_drag"></i>':'<i class="PI_drag VH"></i>',i=e.isEnabled?"":"zpl_op5",a=e.isEnabled?'<span name="opnCases">'+e.count+" "+e.optionValue+"</span>":"",n="1"!=e.typeOthers?'<input id="enb_'+e.categoryId+'"></input>':"",l="0"!=e.typeOthers||t?'<i class="VH"></i>':'<i name="delCgy" class="PI_delete"></i>',o="2"==e.typeOthers?"<span>"+ZPI18N.getString("zp.services")+"</span>":"",c=$('<div class="zpl_catlst '+i+'" categoryid = "'+e.categoryId+'">'+s+'<span class=" icn '+ServiceIcons.getIconClass(e.categoryIcon)+'"></span><div class="zpl_flex-1"><h5>'+e.categoryName+" "+o+"</h5><p>"+e.categoryShortDescription+'</p></div><div name="opnCases" class="zpl_tg zpl_csts">'+a+'</div><div class="zpl_cttgbt">'+n+'</div><div class="zpl_hvr zpl_hvrshw">'+l+"</div></div>");return ZPeopleComponents.toggleswitch(c.find("#enb_"+e.categoryId),{on:e.isEnabled,change:function(e,t){e.stopPropagation(),e.preventDefault();var s=$(this).attr("id").split("_")[1],i=Cases.fetchCgyFromList("adminListing",s);null!=i&&(t.state?i.isEnabled||casesSettings.CategoryModal.enableCategory(s,this):i.isEnabled&&casesSettings.CategoryModal.disableCategory(s,this))}}),c.find("#enb_"+e.categoryId).siblings("div").on("click",(function(e,t){e.stopPropagation(),e.preventDefault()})),c.off("click").on("click",(function(e){var t=$(this).attr("categoryid");window.location.href="#settings/service/hrcase/categoryview-categoryid:"+t})),c.find("[name=delCgy]").off("click").on("click",(function(e){e.stopPropagation(),e.preventDefault();var t=$(this).closest("div[categoryid]").attr("categoryid");casesSettings.CategoryModal.deleteCategory(t)})),c.find("[name=opnCases]").off("click").on("click",(function(e){e.stopPropagation(),e.preventDefault();var t=$(this).closest("div.zpl_catlst[categoryid]").attr("categoryid");window.open(`#operations/hrcase/agent/allcases/list-categoryid:${t}/status:1`,"_blank")})),c},categorySettingListing:function(e){var t=settingsPage.container;if(0!=e.length){Cases.CGY_LIST.adminListing=e;for(var s=$("<div></div>"),i=$("<div></div>"),a=0;a<e.length;a++){var n=casesSettings.categoryListRow(e[a]);e[a].isEnabled?s.append(n):i.append(n)}t.append('<div class="zpl_rgtcnt"><div class="zpl_crdlst" id="admCgyList"></div></div>'),t.find("#admCgyList").append(s.children()).append(i.children()),ZPeopleComponents.sortable("div.zpl_crdlst",{handle:".PI_drag",items:"div.zpl_catlst[categoryid]",region:"parent",restrictExternalItem:!0,axis:"y",start:function(e,s){t.find("#admCgyList").parent("div.zpl_rgtcnt").css("position","relative")},change:function(){casesSettings.sortCategory()}})}},sortCategory:function(){var e=settingsPage.container,t=[];e.find("#admCgyList div[categoryid]").each((function(){var e=$(this).attr("categoryid");t.push(e)}));var s={method:"reorderCategoryList",conreqcsr:csrfToken,sequenceList:JSON.stringify(t)};ZPeople.Request.sendAsyncPost("/cases/category/reorder",s)}};casesSettings.Components={ZCTF:[],ZCSF:[],ZCTGLF:[],TEMP_ZCTF:[],destroy_zc_all:function(){casesSettings.Components.ZCTF.length>0&&($.each(casesSettings.Components.ZCTF,(function(e,t){ZPeopleComponents.tokenfield(t).destroy()})),casesSettings.Components.ZCTF=[]),casesSettings.Components.ZCSF.length>0&&($.each(casesSettings.Components.ZCSF,(function(e,t){ZPeopleComponents.select($(t)).destroy()})),casesSettings.Components.ZCSF=[]),casesSettings.Components.TEMP_ZCTF.length>0&&($.each(casesSettings.Components.TEMP_ZCTF,(function(e,t){ZPeopleComponents.tokenfield(t).destroy()})),casesSettings.Components.TEMP_ZCTF=[])},destroy_zctf:function(e){casesSettings.Components.ZCTF.length>0&&$.each(casesSettings.Components.ZCTF,(function(t,s){if(s.attr("id")==e)return null!=ZPeopleComponents.tokenfield(s)&&ZPeopleComponents.tokenfield(s).destroy(),casesSettings.Components.ZCTF.splice(t,1),!1}))},destroy_zcsf:function(e){casesSettings.Components.ZCSF.length>0&&$.each(casesSettings.Components.ZCSF,(function(t,s){if(s.attr("id")==e)return ZPeopleComponents.select(s).destroy(),casesSettings.Components.ZCSF.splice(t,1),!1}))},destroy_tempzctf:function(){casesSettings.Components.TEMP_ZCTF.length>0&&($.each(casesSettings.Components.TEMP_ZCTF,(function(e,t){ZPeopleComponents.tokenfield(t).destroy()})),casesSettings.Components.TEMP_ZCTF=[])},destroy_zctglf:function(){casesSettings.Components.ZCTGLF.length>0&&($.each(casesSettings.Components.ZCTGLF,(function(e,t){ZPeopleComponents.toggleswitch(t).destroy()})),casesSettings.Components.ZCTGLF=[])}},casesSettings.Common={returnCommaSeparatedString:function(e,t){var s="";return $.each(e,(function(e,i){s+=i[t]+","})),s=s.slice(0,-1)},emptyData:function(e,t,s,i,a){var n="";return null!=s&&""!=s&&(n='<font><button onclick ="'+i+'" class="zlabel zlabel--blue zlabel--medium ">'+s+"</button></font>"),'<div id="emptPage"><div class="zpl_Emptydata"><div><div class="zpl_emptimg '+(a=a||"zp_nd_record")+'"></div><h4>'+(e=null!=e?e:ZPI18N.getString("zp.norecfound"))+"</h4><p>"+(t=null!=t?t:"")+"</p>"+n+"</div></div></div>"},removeEmptyData:function(e){null!=e?e.find("div#emptPage").remove():$("div#emptPage").remove()}},casesSettings.CategoryModal={ADD_AGENT_MODAL:void 0,ADD_SUBCATEGORY_MODAL:void 0,ADD_REFERENCES_MODAL:void 0,ADD_FAQ_MODAL:void 0,ADD_SLA_MODAL:void 0,CURR_CGY_SERVICEID:"",CURR_CGY_TYPEOTHERS:"",CURR_CGY_DATA:{},DESC_EDITOR:{},FAQ_EDITOR:{},inputBoxHtml:function(e,t,s,i,a,n,l){return'<div class="zpl_secn"><div><label class="'+(n?"zpl_mtry":"")+'">'+e+"</label>"+(null!=l&&""!=l?'<i class="PI_info" title="'+l+'"></i>':"")+'</div><div><input id="'+t+'" autocomplete = "off" type="text" class="ztextbox '+(i?"disabled":"")+'" '+(a=null!=a?"maxlength = "+a:"")+' value="'+s+'" '+(i?'disabled = "disabled"':"")+"/></div></div>"},selectDivBoxHtml:function(e,t,s,i,a){return'<div class="zpl_secn"><div><label class="'+(i?"zpl_mtry":"")+'">'+e+"</label>"+(null!=a&&""!=a?'<i class="PI_info" title="'+a+'"></i>':"")+'</div><div id="'+t+'" class="'+(s=null!=s?s:"")+'"></div></div>'},editorDivHtml:function(e,t,s,i){return'<div class="zpl_secn"><div><label class="'+(i?"zpl_mtry":"")+'">'+e+'</label></div><div class="'+s+'">'+('<div class="zpl_feedCompsr zpl_edtrply tlbarTop"><div class="feedCompsr_area"><div id="'+t+'" class="feedCompsr_cont"></div></div></div>')+"</div></div>"},checkBoxHtml:function(e,t,s){return'<div class="zpl_secn '+(s=null!=s?s:"")+'"><div class="zpl_tgl"><input id="'+t+'"/>'+e+"</div></div>"},nchkboxHtml:function(e,t,s){return'<div class="zpl_secn '+s+'"><div class="zcheckbox"><input  id="'+t+'" type="checkbox" class="zcheckbox__helper"> <label for="'+t+'" class="zcheckbox__label">'+e+"</label> </div></div>"},textareaHtml:function(e,t,s){return'<div class="zpl_secn">'+(""!=e?"<div><label>"+e+"</label></div>":"")+'<div><textarea id="'+t+'" type="text" class="ztextbox" rows="4">'+s+"</textarea></div></div>"},iconHtml:function(e,t,s){return'<div class="zpl_secn zpl_tac"><div class="text-center"><i title="'+ZPI18N.getString("zp.selecticon")+'" id="'+e+'" class="'+t+'" iconvalue="'+s+'"></i><div id="ecgyIconMenu" class="zpl_svricclr zpl_drpdwn zpl_drpdwnic"></div></div></div>'},fileUploadHtml:function(e){var t=ZPeople.isChinaSetup?"":'/ <a class="zpl_lnk" onclick="CasesFilesCommon.getCloudPicker(this,\'AddFAQ\')" ><i class="PI_cloud"></i>'+ZPI18N.getString("zp.files.cloud")+"</a>",s="";return isWorkdriveAllowed&&(s='/ <a class="zpl_lnk" onclick="WorkDriveInt.showWorkDriveModal(\'AddFAQ\')"><i class="PI_workdrive zpl_icnobg"></i>'+ZPI18N.getString("zp.workdrive")+"</a> "),'<div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.attachments")+'</h5></div><div><div class="zpl_upld"><div class="zpl_fldrp"><h5><div class="zpl_flupld_img"></div>'+ZPI18N.getString("zp.widgetattach",new Array(""))+'<a class="zpl_lnk" onclick="CasesFilesCommon.getFileBoxOnUpload(this)"><i class="PI_desktop"></i>'+ZPI18N.getString("zp.files.desktop")+"</a>"+s+t+'</h5></div></div></div><input id="cgyfileUpd" type="file" class="DN" multiple/></div>'},fileListDivHtml:function(e){return'<div id="'+e+'" class="zpl_secn"><div id="afilesAttach" class="zpl_atchd"></div></div>'},faqTableRowsHtml:function(e,t){var s=$("<div></div>");new Array,new Array;return e.length>0&&(rows="",$.each(e,(function(e,t){s.append('<tr faqId="'+t.faqID+'"><td name="fname">'+t.query+'</td><td><div class="zpl_hvr"><i title = "Analytics" class="PI_chart"></i><i title = "'+ZPI18N.getString("zp.delete")+'" class="PI_delete"></i></div></td></tr>')})),s.find("tr[faqId]").off("click").on("click",(function(e){casesSettings.CategoryModal.addFAQ(e,$(this).attr("faqId"),t)})),s.find("i.PI_chart").off("click").on("click",(function(e){e.stopPropagation(),e.preventDefault(),casesSettings.CategoryModal.showLikeAnalyticsFAQ(e,$(this).closest("tr").attr("faqId"),t)})),s.find("i.PI_delete").off("click").on("click",(function(e){casesSettings.CategoryModal.deleteFAQ(e,$(this).closest("tr").attr("faqId"),t)}))),s.children()},tableHtml:function(e,t,s,i){var a='<div class="zpl_tblres"><table id="'+t+'" class="zpl_tbl wd100_per '+(s=null!=s?s:"")+'" role="grid">'+(i?"<thead>$TABLE_HEADER$</thead>":"")+"<tbody>$TABLE_ROWS$</tbody></table></div>";return'<div class="zpl_secn">'+(ZPUtil.Validation.isEmpty(e)?"":"<div><label>"+e+"</label></div>")+"<div>"+a+"</div></div>"},tablerowHtml:function(e,t,s,i,a,n){n=null==n?"":n;var l=a?'<i title = "'+ZPI18N.getString("zp.delete")+'" class="PI_delete" ></i>':"";return'<tr id="'+e+'" '+n+"><td>"+t+'</td><td><div class="zpl_em">'+(ZPUtil.Validation.isEmpty(s)?"":'<div class="zpl_emimg"><img src="'+s+'"></div>')+'<div class="zpl_emdts"><div><b>'+i+'</b></div></div></div></td><td><div class="zpl_hvr"><i class="PI_edt "></i>'+l+"</div></td></tr>"},showTabs:function(e){casesSettings.Components.destroy_zc_all(),casesSettings.CategoryModal.CURR_CGY_DATA=e,casesSettings.CategoryModal.MODAL=void 0;var t=e.categoryId,s=new Tab("Basics",(function(){$("#fullModFooter").find("#saveBtn").length<=0&&($("#cancelButton").closest("div").prepend('<button id="saveBtn" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+"</button>"),$("#saveBtn").prop("disabled",!0)),$("#fullModFooter").find("#saveBtn, #cancelButton").removeClass("zpl_DNI"),casesSettings.CategoryModal.showBasicSetting(casesSettings.CategoryModal.CURR_CGY_DATA)}),(function(e){if(casesSettings.CategoryModal.compareAndValidateExistingData(casesSettings.CategoryModal.CURR_CGY_DATA).changesAvailable){var t=new InfoAlertMessage(ZPI18N.getString("zp.popup.unchange.save"),ZPI18N.getString("zp.popup.unchange.desc"));t.callback=function(){casesSettings.CategoryModal.saveBasicSettings()||(e._isValidated=!0,e.showTab(e._stackCallTab))},t.yesButtonText=ZPI18N.getString("zp.popup.unchange.save"),t.cancelCallback=function(e){e.close(),e.remove()},t.show()}else e._isValidated=!0,e.showTab(e._stackCallTab)}));s.name=ZPI18N.getString("zp.setup");var i=new Tab("Agents",(function(){$("#fullModFooter").find("#saveBtn, #cancelButton").addClass("zpl_DNI"),casesSettings.CategoryModal.MODAL.madeChanges=!1,casesSettings.CategoryModal.showAgentsTab(casesSettings.CategoryModal.CURR_CGY_DATA)}));i.name=ZPI18N.getString("zp.agents");var a=new Tab("Subcategories",(function(){$("#fullModFooter").find("#saveBtn, #cancelButton").addClass("zpl_DNI"),casesSettings.CategoryModal.MODAL.madeChanges=!1,casesSettings.CategoryModal.showSubcategory(casesSettings.CategoryModal.CURR_CGY_DATA.subCategories)}));a.name=ZPI18N.getString("zp.subcategories");var n=new Tab("References",(function(){$("#fullModFooter").find("#saveBtn, #cancelButton").addClass("zpl_DNI"),casesSettings.CategoryModal.showReferences(casesSettings.CategoryModal.CURR_CGY_DATA.categoryReferences)}));n.name=ZPI18N.getString("zp.knowledgebase");var l=new Tab("FAQs",(function(){$("#fullModFooter").find("#saveBtn, #cancelButton").addClass("zpl_DNI"),casesSettings.CategoryModal.MODAL.madeChanges=!1,casesSettings.CategoryModal.showFAQs(t)}));l.name=ZPI18N.getString("zp.faqs");var o=new Tab("SLA",(function(){$("#fullModFooter").find("#saveBtn, #cancelButton").addClass("zpl_DNI"),casesSettings.CategoryModal.MODAL.madeChanges=!1,casesSettings.SLA.list(t)}));o.name=ZPI18N.getString("zp.sla"),e.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY?Cases.isCaseAdmin(t)||Cases.isCaseAdmin()?Cases.isCaseAdmin()?casesSettings.CategoryModal.MODAL=new fullPageModal("Edit Category",s,i,a,n,l,o):Cases.isCaseAdmin(t)&&(casesSettings.CategoryModal.MODAL=new fullPageModal("Edit Category",s,i,a,n,l)):casesSettings.CategoryModal.MODAL=new fullPageModal("Edit Category",l):casesSettings.CategoryModal.MODAL=new fullPageModal("Edit Category",s,i,n,l),casesSettings.CategoryModal.MODAL.save=ZPI18N.getString("zp.save"),casesSettings.CategoryModal.MODAL.cancel=ZPI18N.getString("zp.close"),casesSettings.CategoryModal.MODAL.next=ZPI18N.getString("zp.next"),casesSettings.CategoryModal.MODAL.previous=ZPI18N.getString("zp.previous"),casesSettings.CategoryModal.MODAL._previousToggle=!0,casesSettings.CategoryModal.MODAL._nextToggle=!0,casesSettings.CategoryModal.MODAL._saveToggle=!1,casesSettings.CategoryModal.MODAL.construct(0),ZPeopleComponents.tooltip("#cardRightDiv"),casesSettings.CategoryModal.MODAL.alertClass=new InfoAlertMessage(ZPI18N.getString("zp.popup.unchange.name"),ZPI18N.getString("zp.popup.unchange.desc")),casesSettings.CategoryModal.MODAL.alertClass.yesButtonText=ZPI18N.getString("zp.popup.unchange.save"),casesSettings.CategoryModal.MODAL.alertClass.cancelButtonText=ZPI18N.getString("zp.popup.unchange.cancel"),casesSettings.CategoryModal.MODAL.alertClass.handleESC=!0,casesSettings.CategoryModal.MODAL.alertClass.noCallbackOnClose=!0,casesSettings.CategoryModal.MODAL.alertClass.callback=function(){"tabBasics"==casesSettings.CategoryModal.MODAL.currentTab.id&&(casesSettings.CategoryModal.saveBasicSettings()||casesSettings.CategoryModal.MODAL.close())},casesSettings.CategoryModal.MODAL.alertClass.cancelCallback=function(e){casesSettings.CategoryModal.MODAL.close()},casesSettings.CategoryModal.MODAL.cancelCallBack=function(e){casesSettings.Components.destroy_zc_all(),null!=ZPeopleComponents.select($("#ecgyadmin"))&&ZPeopleComponents.select($("#ecgyadmin")).destroy(),-1!=window.location.hash.indexOf("hrcase/categoryview")?window.location.href="#settings/service/hrcase/categorylist":-1!=window.location.hash.indexOf("hrcase/category/view")&&(window.location.href="#operations/hrcase/category"),ZPeopleComponents.tooltip("#cardRightDiv").destroy(),e.remove()};t=e.categoryId;var c="",d="",r=e.allowDelete?'<button id="deletecgy" type="button" class="zlabel zlabel--red zlabel--outline zlabel--medium" onclick="casesSettings.CategoryModal.deleteCategory(\''+t+"')\">"+ZPI18N.getString("zp.delete")+"</button>":"",p=ZPI18N.getString("zp.disable"),g=ZPI18N.getString("zp.enable");(e.typeOthers!=DEFAULT_GENERAL_CATEGORY||e.hasOwnProperty("serviceId")&&!ZPUtil.Validation.isEmpty(e.serviceId))&&"undefined"==typeof hCLocAccess&&(d=e.isEnabled?Cases.isCaseAdmin()||Cases.isCaseAdmin(t)?'<button id="disableCgy" type="button" class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="casesSettings.CategoryModal.disableCategory(\''+t+"')\">"+p+"</button>":"":Cases.isCaseAdmin()||Cases.isCaseAdmin(t)?'<button id="enableCgy" type="button" class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="casesSettings.CategoryModal.enableCategory(\''+t+"')\">"+g+"</button>":""),c+=d+r,casesSettings.CategoryModal.MODAL.modalHeader.find("a#closeMark").before('<div class="zpl_mhderrgt">'+c+"</div>"),casesSettings.CategoryModal.MODAL.modalDiv.find(".zpl_mhder h4").html(ZPI18N.getString("zp.module.edit",new Array(e.categoryName))),$("#alertUnpublish").length<=0&&$('<div id="alertUnpublish" class="zpl_info zpl_DNI"><div><span class="d-flexM">'+ZPI18N.getString("zp.enablecgyforuser")+"</span></div></div>").insertAfter(casesSettings.CategoryModal.MODAL.modalDiv.find(".zpl_mhder")),casesSettings.CategoryModal.MODAL.open(),e.isEnabled||$("#alertUnpublish").removeClass("zpl_DNI")},showBasicSetting:function(e){var t="";if(null!=e){null!=ZPeopleComponents.select($("#ecgyadmin"))&&ZPeopleComponents.select($("#ecgyadmin")).destroy(),null!=ZPeopleComponents.menu($("#ecgyIconMenu"))&&(ZPeopleComponents.menu($("#ecgyIconMenu")).destroy(),$("#ecgyIconMenu").remove()),null!=ZPeopleComponents.toggleswitch($("#ecgymoderation"))&&ZPeopleComponents.toggleswitch($("#ecgymoderation")).destroy(),t+=casesSettings.CategoryModal.iconHtml("ecgyicon","zpl_ibg sze70 icn "+ServiceIcons.getIconClass(e.categoryIcon),e.categoryIcon),t+=casesSettings.CategoryModal.inputBoxHtml(ZPI18N.getString("zp.categoryname"),"ecgyname",e.categoryName,""!=e.serviceId&&null!=e.serviceId,250,!0),t+=casesSettings.CategoryModal.inputBoxHtml(ZPI18N.getString("zp.prefix"),"ecgyprefix",e.prefixCase,!1,"5",!1,ZPI18N.getString("zp.prefixinfo")),t+=casesSettings.CategoryModal.inputBoxHtml(ZPI18N.getString("zp.displaydescription"),"ecgysdesc",e.categoryShortDescription,""!=e.serviceId&&null!=e.serviceId,250,!0),t+=casesSettings.CategoryModal.editorDivHtml(ZPI18N.getString("zp.description"),"ecgydesc","zpl_msgedtr msgedtr_optnl"),e.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY&&(Cases.isCaseAdmin()?t+=casesSettings.CategoryModal.selectDivBoxHtml(ZPI18N.getString("zp.categoryadmin"),"ecgyadmin","",!1,ZPI18N.getString("zp.cgyadmininfo")):t+=casesSettings.CategoryModal.inputBoxHtml(ZPI18N.getString("zp.categoryadmin"),"ecgyadmin",e.categoryAdmin?e.categoryAdmin.owner:"",!0,500,!1,ZPI18N.getString("zp.cgyadmininfo")));var s="zpl_DNI";e.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY&&e.hasOwnProperty("categoryAdmin")&&""!=e.categoryAdmin.agentTypeId&&(s=""),t+='<div class="zpl_secn '+s+'"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" id="ecgymoderation"/>'+ZPI18N.getString("zp.mandatecaseassignment")+"</h5> <p>"+ZPI18N.getString("zp.casesunmanagedinfo")+"</p></div></div>",t+=casesSettings.CategoryModal.inputBoxHtml(ZPI18N.getString("zp.applicablelocations"),"ecgyapplloc",e.applicableLocations,!0),casesSettings.CategoryModal.CURR_CGY_SERVICEID=e.serviceId,casesSettings.CategoryModal.CURR_CGY_TYPEOTHERS=e.typeOthers}$("#cardBasics").html('<div class = "zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.setup")+'</h4></div><div></div></div><div class="zpl_crdcnt">'+t+"</div></div>"),$("#fullModFooter").find("#saveBtn").off().on("click",(function(e){casesSettings.CategoryModal.saveBasicSettings()}));var i={id:"ecgydesc",mode:"richtext",content:e.description,editorheight:300};if(casesSettings.CategoryModal.DESC_EDITOR=ZPUtil.initiateZEEditor(i,"HrCase"),casesSettings.CategoryModal.DESC_EDITOR.afterEditorLoad((function(){var e=$(casesSettings.CategoryModal.DESC_EDITOR.iframe.contentDocument.body);casesSettings.CategoryModal.CURR_CGY_DATA.description=$.trim(e.html()),setTimeout((function(){$("#ecgyname").trigger("focus")}),50),e.off("keyup blur").on("keyup blur",(function(e){casesSettings.CategoryModal.displaySaveBtn()}))})),(null==e.serviceId||ZPUtil.Validation.isEmpty(e.serviceId))&&casesSettings.Category.iconMenu("ecgyIconMenu","#ecgyicon",(function(e){casesSettings.CategoryModal.displaySaveBtn()})),$("#ecgyname, #ecgyprefix, #ecgysdesc").off("keyup blur").on("keyup blur",(function(e){casesSettings.CategoryModal.validateBasicDetails(this),casesSettings.CategoryModal.displaySaveBtn()})),Cases.isCaseAdmin()&&e.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY){EmployeeSearch.getEmpDeptGrpList("","HRCASES","HRCASES","FEEDS",!0);var a={showSearchField:!0};if(a.dataSource={search:function(e){return new Promise((function(t,s){t({delay:20,results:EmployeeSearch.getEmpDeptGrpList(e.query,"HRCASES","HRCASES","FEEDS",!0),more:!1})}))},paginated:!0},a.placeholder=ZPI18N.getString("zp.select"),a.serverSearch=!0,a.cacheData=!0,a.multiple=!1,a.isLabelHTMLEncoded=!0,a.dataMapping={value:"id",label:"value",image:"image",textIcon:"avatarText",informativeText:"email",optgroupLabel:"dataType"},a.contentType="image-text",a.dropdownList={contentType:"image-text-desc",height:300,isTextHTMLEncoded:!0},a.search={by:["value","email"]},a.clearButton=!0,ZPeopleComponents.select("#ecgyadmin",a),e.categoryAdmin&&""!=e.categoryAdmin.agentTypeId){var n={};if(n.id=e.categoryAdmin.agentValueId,n.agenttype=e.categoryAdmin.agentTypeId,n.dataType="1"==e.categoryAdmin.agentTypeId?ZPI18N.getString("zp.employee"):"2"==e.categoryAdmin.agentTypeId?ZPI18N.getString("zp.department"):ZPI18N.getString("zp.group"),n.value=e.categoryAdmin.owner,n.image="",n.avatarText=EmployeeSearch.getImageAltText(e.categoryAdmin.owner),"1"==e.categoryAdmin.agentTypeId){var l=ZPeople.getUserDetailsById(e.categoryAdmin.agentValueId);n.value=l.empid+" "+l.name,n.image=l.avatar,n.avatarText="",n.email=l.emailId,n.zuid=l.zuid}ZPeopleComponents.select($("#ecgyadmin")).setValue(n),ZPeopleComponents.select($("#ecgyadmin")).addOption([n]),$("#ecgyadmin").attr("agenttype",e.categoryAdmin.agentTypeId)}}e.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY&&(ZPeopleComponents.toggleswitch($("#ecgymoderation"),{on:e.enable_moderation,disabled:!Cases.isCaseAdmin(),change:function(e,t){casesSettings.CategoryModal.displaySaveBtn()}}),$("#ecgyadmin").on("zselectchange",(function(e,t){casesSettings.CategoryModal.displaySaveBtn(),null!=t.optionData&&$("#ecgyadmin").attr("agenttype",t.optionData.agenttype),""!=t.value?$("#ecgymoderation").closest("div.zpl_secn").removeClass("zpl_DNI"):$("#ecgymoderation").closest("div.zpl_secn").addClass("zpl_DNI")})))},displaySaveBtn:function(){casesSettings.CategoryModal.compareAndValidateExistingData(casesSettings.CategoryModal.CURR_CGY_DATA).changesAvailable&&$("#cardBasics").find("span.ztextbox--error__label").length<=0?($("#saveBtn").prop("disabled",!1),casesSettings.CategoryModal.MODAL.madeChanges=!0):($("#saveBtn").prop("disabled",!0),casesSettings.CategoryModal.MODAL.madeChanges=!1)},setErrorMsg:function(e,t){e.removeClass("ztextbox__error"),e.siblings("span").remove(),e.addClass("ztextbox__error"),e.after('<span class="ztextbox--error__label">'+t+"</span>")},validateCategoryName:function(e,t){var s=!1,i="";return ZPUtil.Validation.isEmpty(t)?(s=!0,i=ZPI18N.getString("zp.emptycategory")):t.length>50&&(s=!0,i=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.categoryname"),"50"))),s&&(s=!0,casesSettings.CategoryModal.setErrorMsg(e,i)),s},validateShortDescription:function(e,t){var s=!1,i="";return t.length>250?(s=!0,i=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.description"),"250"))):ZPUtil.Validation.isEmpty(t)&&(s=!0,i=ZPI18N.getString("zp.emptyshortdescription")),s&&(s=!0,casesSettings.CategoryModal.setErrorMsg(e,i)),s},validateBasicDetails(e){var t=!1;switch($(e).removeClass("ztextbox__error").siblings("span").remove(),$(e).attr("id")){case"ecgyname":t=casesSettings.CategoryModal.validateCategoryName($(e),$.trim($(e).val()));break;case"ecgysdesc":t=casesSettings.CategoryModal.validateShortDescription($(e),$.trim($(e).val()));break;case"ecgyprefix":$.trim($(e).val()).length>5&&(t=!0,errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.prefix"),"5")),$(e).addClass("ztextbox__error"),$(e).after('<span class="ztextbox--error__label">'+errorMsg+"</span>"))}return t},compareAndValidateExistingData:function(e){var t={changesAvailable:!1},s=["categoryIcon","categoryName","prefixCase","categoryShortDescription","description"];Cases.isCaseAdmin()&&(s.push("categoryAdminId"),s.push("enable_moderation"));var i={categoryId:e.categoryId};i.categoryName=$.trim($("#cardBasics").find("#ecgyname").val()),i.categoryShortDescription=$.trim($("#cardBasics").find("#ecgysdesc").val()),i.prefixCase=$.trim($("#cardBasics").find("#ecgyprefix").val()),i.categoryIcon=$("#ecgyicon").attr("iconvalue"),i.description=$.trim($(casesSettings.CategoryModal.DESC_EDITOR.iframe.contentDocument.body).html()),Cases.isCaseAdmin()&&(i.categoryAdminId=e.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY?ZPeopleComponents.select($("#ecgyadmin")).getValue():"",i.categoryAdminTypeId=e.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY?$("#ecgyadmin").attr("agenttype"):"",i.enable_moderation=ZPeopleComponents.toggleswitch($("#ecgymoderation")).getState()&&!$("#ecgymoderation").closest("zpl_secn").hasClass("zpl_DNI"));var a=!1;return $.each(s,(function(s,n){if("categoryAdminId"==n){var l=null==e.categoryAdmin?"":e.categoryAdmin.agentValueId,o=ZPUtil.Validation.isEmpty(l)&&ZPUtil.Validation.isEmpty(i[n]);a=o,t.changesAvailable=t.changesAvailable||!o&&l!=i[n]}else if("description"==n){var c=$(e[n]).text(),d=$(i[n]).text(),r=-1!=e[n].indexOf("<img"),p=-1!=i[n].indexOf("<img"),g=r||p?!$(e[n])[0].isEqualNode($(i[n])[0]):$.trim(c)!=$.trim(d);t.changesAvailable=t.changesAvailable||g}else if(a&&"enable_moderation"==n)t.changesAvailable=t.changesAvailable;else{var h="enable_moderation"==n?e[n]:decodeHTML(e[n]);t.changesAvailable=t.changesAvailable||h!=i[n]}})),t.changesAvailable&&(Cases.isCaseAdmin()&&i.hasOwnProperty("categoryAdminId")&&ZPUtil.Validation.isEmpty(i.categoryAdminId)&&(delete i.categoryAdminId,delete i.categoryAdminTypeId,delete i.enable_moderation),t.basicDetails=i),t},saveBasicSettings:function(){var e=!0,t={conreqcsr:csrfToken,method:"singleFieldCategoryEdit",mode:"basicDetails",categoryId:casesSettings.CategoryModal.CURR_CGY_DATA.categoryId};ZPUtil.Validation.isEmpty(casesSettings.CategoryModal.CURR_CGY_DATA.serviceId)||(t.serviceId=casesSettings.CategoryModal.CURR_CGY_DATA.serviceId);var s=casesSettings.CategoryModal.compareAndValidateExistingData(casesSettings.CategoryModal.CURR_CGY_DATA);return s.changesAvailable&&$("#cardBasics").find("span.ztextbox--error__label").length<=0&&(e=!1,s.basicDetails.categoryAdminId||(delete s.basicDetails.categoryAdminId,delete s.basicDetails.categoryAdminTypeId,delete s.basicDetails.enable_moderation),t.categoryDetails=JSON.stringify(s.basicDetails),ZPeople.Request.sendAsyncPost("/cases/category/edit",t,(function(t){"success"==t.status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.categoryupdatesuccess")),casesSettings.CategoryModal.MODAL.modalDiv.find(".zpl_mhder h4").text("Edit "+s.basicDetails.categoryName),casesSettings.CategoryModal.CURR_CGY_DATA=t.categoryDetails,casesSettings.CategoryModal.MODAL.madeChanges=!1,casesSettings.CategoryModal.updateListing()):(e=!0,t.hasOwnProperty("errormsg")&&"categoryName"==t.errormsg?($("#cardBasics").find("#ecgyname").addClass("ztextbox__error"),$("#cardBasics").find("#ecgyname").after('<span class="ztextbox--error__label">'+t.desc+"</span>")):ZPeople.Message.showFailureMsg(t.desc))}))),e},updateListing(){let e=casesSettings.CategoryModal.CURR_CGY_DATA,t=$("#settings-service-hrcase-categorylist").find(`[categoryid='${e.categoryId}']`);t.find("h5").html(e.categoryName),t.find("p").html(e.categoryShortDescription),$(t.find("span")[0]).attr("class",`icn ${ServiceIcons.getIconClass(e.categoryIcon)}`)},enableCategory:function(e,t){var s=new InfoAlertMessage(ZPI18N.getString("zp.enablecategory"),ZPI18N.getString("zp.enablecgymessage"));s.callback=function(){var s={conreqcsr:csrfToken,method:"enableCategory",categoryId:e};ZPeople.Request.sendAsyncPost("/cases/category/enable",s,(function(i){if("success"==i.status){ZPeople.Message.showSuccessMsg(i.desc);var a=Cases.fetchCgyFromList("adminListing",e);null!=a&&(a.isEnabled=!0);var n=$("[id=admCgyList]").find('div[categoryid="'+s.categoryId+'"]');if(null!=n&&(n.removeClass("zpl_op5"),Cases.isCaseAdmin()&&n.find("i.PI_drag").removeClass("VH"),null==t&&null!=ZPeopleComponents.toggleswitch(n.find("#enb_"+s.categoryId))&&ZPeopleComponents.toggleswitch(n.find("#enb_"+s.categoryId)).switch()),null==t){var l='<button id="disableCgy" class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="casesSettings.CategoryModal.disableCategory(\''+e+"')\">"+ZPI18N.getString("zp.disable")+"</button>";$("#enableCgy").replaceWith(l),$("#alertUnpublish").addClass("zpl_DNI"),casesSettings.CategoryModal.CURR_CGY_DATA.isEnabled=!0}}else ZPeople.Message.showFailureMsg(i.desc)}))},s.yesButtonText=ZPI18N.getString("zp.confirm"),s.cancelCallback=function(e){null!=t&&ZPeopleComponents.toggleswitch(t).switch(),e.close(),e.remove()},s.show()},disableCategory:function(e,t){var s=new InfoAlertMessage(ZPI18N.getString("zp.disablecategory"),ZPI18N.getString("zp.disablecgymessage"));s.callback=function(){var s={conreqcsr:csrfToken,method:"disableCategory",categoryId:e};ZPeople.Request.sendAsyncPost("/cases/category/disable",s,(function(i){if("success"==i.status){ZPeople.Message.showSuccessMsg(i.desc);var a=Cases.fetchCgyFromList("adminListing",e);null!=a&&(a.isEnabled=!1);var n=$("[id=admCgyList]").find('div[categoryid="'+s.categoryId+'"]');if(null!=n&&(n.addClass("zpl_op5"),n.find("i.PI_drag").addClass("VH"),n.find("div.zpl_tg").remove(),null==t&&null!=ZPeopleComponents.toggleswitch(n.find("#enb_"+s.categoryId))&&ZPeopleComponents.toggleswitch(n.find("#enb_"+s.categoryId)).switch()),null==t){var l='<button id="enableCgy" class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="casesSettings.CategoryModal.enableCategory(\''+e+"')\">"+ZPI18N.getString("zp.enable")+"</button>";$("#disableCgy").replaceWith(l),$("#alertUnpublish").removeClass("zpl_DNI"),casesSettings.CategoryModal.CURR_CGY_DATA.isEnabled=!1}}else ZPeople.Message.showFailureMsg(i.desc)}))},s.yesButtonText=ZPI18N.getString("zp.confirm"),s.cancelCallback=function(e){null!=t&&ZPeopleComponents.toggleswitch(t).switch(),e.close(),e.remove()},s.show()},deleteCategory:function(e){var t=new DeleteAlertMessage(ZPI18N.getString("zp.lms.settings.deleteCategory"),ZPI18N.getString("zp.deletecategorymessage"));t.isDoubleCnf=!0,t.callback=function(){var t={conreqcsr:csrfToken,method:"deleteCategory",categoryId:e};ZPeople.Request.sendAsyncPost("/cases/category/delete",t,(function(s){if("success"==s.status){ZPeople.Message.showSuccessMsg(s.desc),$("[id=admCgyList]").find('div[categoryid="'+t.categoryId+'"]').remove();var i=Cases.CGY_LIST.adminListing;$.each(i,(function(t,s){if(s.categoryId==e)return i.splice(t,1),!1})),-1!=window.location.href.indexOf("#settings/service/hrcase/categoryview")&&(window.location.href="#settings/service/hrcase/categorylist")}else ZPeople.Message.showFailureMsg(s.desc)}))},t.yesButtonText=ZPI18N.getString("zp.confirm"),t.cancelCallback=function(e){e.close(),e.remove()},t.show()},showSubcategory:function(e){null!=ZPeopleComponents.toggleswitch("#subMan")&&ZPeopleComponents.toggleswitch($("#subMan")).destroy();var t=casesSettings.CategoryModal.tableHtml("","subcgyTable","",!0),s=casesSettings.Common.emptyData(ZPI18N.getString("zp.nosubcategorieshead"),ZPI18N.getString("zp.nosubcategoriesdesc")+"<br/>"+ZPI18N.getString("zp.subcgyexample"),ZPI18N.getString("zp.addsubcategory"),"casesSettings.CategoryModal.addSubCategory()"),i="";e.length>0&&(s="",$.each(e,(function(e,t){i+=casesSettings.CategoryModal.getSubcategoryRow(t)}))),t=(t=t.replace("$TABLE_HEADER$",'<tr class="'+(""!=i?"":"DN")+'" tabIndex = "1"><th>'+ZPI18N.getString("zp.subcategoryname")+"</th><th>"+ZPI18N.getString("zp.agent")+'</th><th width="80"></th></tr>')).replace("$TABLE_ROWS$",i);var a='<div class = "zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.subcategories")+"</h4><p>"+ZPI18N.getString("zp.subcgyinfo")+'</p><div class="zpl_hdcnt"><div class="zpl_tgl"><input id="subMan" />'+ZPI18N.getString("zp.mandatesubcgycheck")+'</div></div></div><div><button id="subcgyTable_btn" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.addsubcategory")+'</button></div></div><div class="zpl_crdcnt">'+t+s+"</div></div>";$("#cardSubcategories").html(a),""!=s&&($("#cardSubcategories").find("#subMan").closest(".zpl_hdcnt").addClass("zpl_DNI"),$("#cardSubcategories").find("#subcgyTable_btn").addClass("DN")),$("#cardSubcategories").find("#subcgyTable_btn").off("click").on("click",(function(e){casesSettings.CategoryModal.addSubCategory()})),ZPeopleComponents.toggleswitch($("#subMan"),{on:casesSettings.CategoryModal.CURR_CGY_DATA.isSubCategoryMandatory,change:function(e,t){e.stopPropagation(),ZPeople.Request.send("/cases/subcategory/mandate",{method:"mandateSubcategory",isMandate:t.state,categoryId:casesSettings.CategoryModal.CURR_CGY_DATA.categoryId},(function(e){"success"==e.status&&(t.state?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.submandate")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.suboptional")),casesSettings.CategoryModal.CURR_CGY_DATA.isSubCategoryMandatory=t.state)}))}})},getSubcategoryRow:function(e){var t="",s="",i="";if(!ZPUtil.Validation.isEmpty(e.agentValueId)){var a=ZPeople.getUserDetailsById(e.agentValueId);s='<div class="zpl_emimg"><img src="'+a.avatar+'"/></div>',t=e.owner,i='<div class="zpl_em">'+s+'<div class="zpl_emdts"><div><em>'+a.empid+" - </em><b>"+t+"</b></div></div></div>"}return"<tr onclick=\"casesSettings.CategoryModal.addSubCategory('"+e.subCategoryId+'\')" id="'+e.subCategoryId+'"><td>'+e.subcategoryname+"</td><td>"+i+'</td><td><div class="zpl_hvr"><i title = "'+ZPI18N.getString("zp.delete")+'" class="PI_delete" onclick="casesSettings.CategoryModal.deleteSubCategory(\''+e.subCategoryId+"',event)\" ></i></div></td></tr>"},addSubCategory:function(e){var t=null!=e,s=t?"Edit Subcategory":ZPI18N.getString("zp.addsubcategory"),i={};if(t){var a=casesSettings.CategoryModal.CURR_CGY_DATA.subCategories;$.each(a,(function(t,s){if(s.subCategoryId==e)return i=s,!1}))}var n=new Tab("Add Subcategory",(function(){var s=casesSettings.CategoryModal.inputBoxHtml(ZPI18N.getString("zp.subcategoryname"),"asubcgyname",t?i.subcategoryname:"",!1,250,!0,ZPI18N.getString("zp.subcgyexample"));if(s+=casesSettings.CategoryModal.selectDivBoxHtml(ZPI18N.getString("zp.agent"),"asubcgyagent"),t){var a=0;ZPeople.Request.sendAsyncPost("/cases/subcategory/count",{conreqcsr:csrfToken,method:"fetchSubCategoryCasesCount",subCategoryId:e,categoryId:casesSettings.CategoryModal.CURR_CGY_DATA.categoryId},(function(e){"success"==e.status&&(a=e.count)})),a>0&&(s+=casesSettings.CategoryModal.checkBoxHtml(ZPI18N.getString("zp.editsubcategorycheckmessage",new Array(a,"$AGENT_NAME$")),"asubupd","zpl_DNI"))}$("#cardAddSubcategory").html('<div class="zpl_crd"><div class="zpl_crdcnt">'+s+"</div></div>");EmployeeSearch.getEmpList("","emp","HRCASES",[],{},!1,[],!1,!0);var n={showSearchField:!0};if(n.dataSource={search:function(e){return new Promise((function(t,s){t({delay:20,results:EmployeeSearch.getEmpList(e.query,"emp","HRCASES",[],{},!1,[],!1,!0),more:!1})}))},paginated:!0},n.isLabelHTMLEncoded=!0,n.placeholder=ZPI18N.getString("zp.select"),n.serverSearch=!0,n.cacheData=!0,n.dataMapping={value:"id",label:"value",image:"image"},n.contentType="image-text",n.dropdownList={contentType:"image-text",height:300,isTextHTMLEncoded:!0},n.search={by:["value","email"]},n.clearButton=!0,ZPeopleComponents.select($("#asubcgyagent"),n),t){if(""!=i.agentValueId){var l=ZPeople.getUserDetailsById(i.agentValueId),o={};o.value=l.empid+" "+l.name,o.image=l.avatar,o.id=i.agentValueId,o.emailId=l.emailId,o.zuid=l.zuid,ZPeopleComponents.select($("#asubcgyagent")).setValue(o)}$("#asubcgyagent").on("zselectchange",(function(e,t){t.value!=i.agentValueId?(""==t.value?$("#asubupd").closest("div.zpl_secn").replaceWith(casesSettings.CategoryModal.checkBoxHtml(ZPI18N.getString("zp.removeagentcheckmessage",new Array(a+"")),"asubupd","")):$("#asubupd").closest("div.zpl_secn").replaceWith(casesSettings.CategoryModal.checkBoxHtml(ZPI18N.getString("zp.editsubcategorycheckmessage",new Array(a,t.optionData.value)),"asubupd","")),ZPeopleComponents.toggleswitch("#asubupd",{on:!0})):$("#asubupd").closest("div.zpl_secn").addClass("zpl_DNI")}))}}),(function(){casesSettings.CategoryModal.saveSubCategory(e)}));casesSettings.CategoryModal.ADD_SUBCATEGORY_MODAL=new popupModal(s,n),casesSettings.CategoryModal.ADD_SUBCATEGORY_MODAL.setCloseCallback((function(){ZPeopleComponents.select($("#asubcgyagent")).destroy(),casesSettings.CategoryModal.ADD_SUBCATEGORY_MODAL.remove()})),casesSettings.CategoryModal.ADD_SUBCATEGORY_MODAL.construct()},saveSubCategory:function(e){var t=$("#asubcgyname").val(),s=ZPeopleComponents.select($("#asubcgyagent")).getValue(),i=!1;if($("#asubcgyname").removeClass("ztextbox__error").siblings("span").remove(),ZPUtil.Validation.isEmpty(t))casesSettings.CategoryModal.setErrorMsg($("#asubcgyname"),ZPI18N.getString("zp.entersubcategoryname"));else{t.length>50&&(i=!0,casesSettings.CategoryModal.setErrorMsg($("#asubcgyname"),ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.subcategory"),"50"))));var a={subcategoryname:t};ZPUtil.Validation.isEmpty(s)||(a.agentTypeId="1",a.agentValueId=s),null!=e&&(a.subCategoryId=e);var n={method:"savesubcategory",categoryId:casesSettings.CategoryModal.CURR_CGY_DATA.categoryId,subcategoryDetails:JSON.stringify(a)};null!=e&&$("#asubupd").length>0&&!$("#asubupd").closest("div.zpl_secn").hasClass("zpl_DNI")&&(n.updateCases=ZPeopleComponents.toggleswitch($("#asubupd")).getState()),i||ZPeople.Request.sendAsyncPost("/cases/subcategory/save",n,(function(t){if("success"==t.status){ZPeople.Message.showSuccessMsg(t.desc),$("#subcgyTable").find("tbody").find("tr").length<=0&&(casesSettings.Common.removeEmptyData(),$("#cardSubcategories").find("#subMan").closest(".zpl_hdcnt").removeClass("zpl_DNI"));var s=casesSettings.CategoryModal.CURR_CGY_DATA.subCategories;null!=e?($("#subcgyTable").find("tr[id="+e+"]").replaceWith(casesSettings.CategoryModal.getSubcategoryRow(t.subCategoryDetails)),$.each(s,(function(s,i){i.subCategoryId==e&&(i.agentTypeId=t.subCategoryDetails.agentTypeId,i.agentValueId=t.subCategoryDetails.agentValueId,i.owner=t.subCategoryDetails.owner,i.subcategoryname=t.subCategoryDetails.subcategoryname)}))):(s.push(t.subCategoryDetails),$("#cardSubcategories").find("#subcgyTable").find("thead").find("tr").removeClass("DN"),$("#cardSubcategories").find("#subcgyTable_btn").removeClass("DN"),$("#subcgyTable").find("tbody").append(casesSettings.CategoryModal.getSubcategoryRow(t.subCategoryDetails))),casesSettings.CategoryModal.ADD_SUBCATEGORY_MODAL.close(),casesSettings.CategoryModal.ADD_SUBCATEGORY_MODAL.remove(),casesSettings.CategoryModal.ADD_SUBCATEGORY_MODAL=void 0}else ZPeople.Message.showFailureMsg(t.desc)}),{},(function(e){var t=JSON.parse(e.responseText);ZPeople.Message.showFailureMsg(t.error)}))}},deleteSubCategory:function(e,t){t.stopPropagation(),t.preventDefault();var s=new DeleteAlertMessage(ZPI18N.getString("zp.deletesubcategory"),ZPI18N.getString("zp.deletesubcategorymessage"));s.callback=function(){var t={conreqcsr:csrfToken,method:"deleteSubCategory",subCategoryId:e,categoryId:casesSettings.CategoryModal.CURR_CGY_DATA.categoryId};ZPeople.Request.sendAsyncPost("/cases/subcategory/delete",t,(function(s){if("success"==s.status){ZPeople.Message.showSuccessMsg(s.desc),$("#cardSubcategories").find("#subcgyTable").find('tr[id="'+e+'"]').remove(),$("#cardSubcategories").find("#subcgyTable").find("tbody").find("tr").length<=0&&($("#cardSubcategories").find("#subMan").closest(".zpl_hdcnt").addClass("zpl_DNI"),$("#cardSubcategories").find("#subcgyTable").find("thead").find("tr").addClass("DN"),$("#cardSubcategories").find("#subcgyTable_btn").addClass("DN"),$("#cardSubcategories").find("div.zpl_crdcnt").append(casesSettings.Common.emptyData(ZPI18N.getString("zp.nosubcategorieshead"),ZPI18N.getString("zp.nosubcategoriesdesc")+"<br/>"+ZPI18N.getString("zp.subcgyexample"),ZPI18N.getString("zp.addsubcategory"),"casesSettings.CategoryModal.addSubCategory()")));var i=casesSettings.CategoryModal.CURR_CGY_DATA.subCategories;$.each(i,(function(e,s){if(s.subCategoryId==t.subCategoryId)return i.splice(e,1),!1}))}else ZPeople.Message.showFailureMsg(s.desc)}))},s.yesButtonText=ZPI18N.getString("zp.confirm"),s.cancelCallback=function(e){e.close(),e.remove()},s.show()},showAgentsTab:function(e){var t=casesSettings.CategoryModal.tableHtml("","agentTable","",!0),s=casesSettings.Common.emptyData(ZPI18N.getString("zp.noagentavailablehead"),ZPI18N.getString("zp.noagentavailabledesc"),ZPI18N.getString("zp.addagent"),"casesSettings.CategoryModal.addAgent()"),i=e.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY?'<button id="agentTable_btn" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.addagent")+"</button>":"",a="",n=e.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY?'<th width="80"></th>':"";e.hasOwnProperty("categoryAgents")&&e.categoryAgents.length>0&&(s="",e.categoryAgents.sort((function(e,t){var s=e.locationId,i=t.locationId;return e.isAllLoc?1:t.isAllLoc||s<i?-1:s>i?1:0})),$.each(e.categoryAgents,(function(t,s){a+=casesSettings.CategoryModal.getAgentDetailsRow(s,e.typeOthers,e.serviceId)})),$("#cardAgents").find("#agentTable_btn").removeClass("DN")),t=(t=t.replace("$TABLE_HEADER$",'<tr class="'+(""!=a?"":"DN")+'" tabIndex = "1"><th>'+ZPI18N.getString("zp.location")+"</th><th>"+ZPI18N.getString("zp.agent")+"</th>"+n+"</tr>")).replace("$TABLE_ROWS$",a);var l='<div class = "zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.agents")+"</h4><p>"+ZPI18N.getString("zp.agentinfo")+"</p></div><div>"+i+'</div></div><div class="zpl_crdcnt">'+t+s+"</div></div>";$("#cardAgents").html(l),$("#agentTable").find("tr").find("[grpDtl]").on("click",(function(e){e.stopPropagation(),e.preventDefault(),Group.editUsers($(this).attr("grpDtl"))})),""!=s&&$("#cardAgents").find("#agentTable_btn").addClass("DN"),$("#cardAgents").find("#agentTable_btn").off("click").on("click",(function(e){casesSettings.CategoryModal.addAgent()}))},getAgentDetailsRow:function(e,t,s){var i=!e.isAllLoc||ZPUtil.Validation.isEmpty(s)&&t!=DEFAULT_GENERAL_CATEGORY&&t!=Cases.DEFAULT_MANAGER_CATEGORY?'<i title = "'+ZPI18N.getString("zp.delete")+'" onclick="casesSettings.CategoryModal.deleteAgent(event,\''+e.cgyAgentId+'\')" class="PI_delete"></i>':"",a=t==Cases.DEFAULT_MANAGER_CATEGORY?"":'<td><div class="zpl_hvr">'+i+"</div></td>",n=e.isAllLoc?"0":e.locationId,l=e.isAllLoc?ZPI18N.getString("zp.alllocaction"):e.location,o="",c=t==Cases.DEFAULT_MANAGER_CATEGORY?'class="disabled"':"onclick=\"casesSettings.CategoryModal.addAgent('"+e.cgyAgentId+"')\"";if(e.hasOwnProperty("managerIds")){var d=ZPeople.getUserDetailsByIds(e.managerIds.split(","));o='<div class="zpl_tgrp">',$.each(d,(function(e,t){o+='<div class="zpl_tg"><div class="zpl_tgImg"><img src="'+t.avatar+'"/></div><span>'+t.empid+" "+t.name+"</span></div>"})),o+="</div>"}else{var r=e.employeeDetails?e.employeeDetails.name:e.owner,p=e.employeeDetails?'<div class="zpl_tgImg"><img src="'+e.employeeDetails.employeePhoto+'"/></div>':"",g="";e.agentTypeId==Cases.AGENTTYPE_GROUPS&&Cases.isCaseAdmin()&&(g='grpDtl="'+e.agentValueId+'"'),o='<div class="zpl_tgrp" '+g+'><div class="zpl_tg">'+p+"<span>"+r+"</span></div></div>"}return"<tr "+c+' id="'+e.cgyAgentId+'" locId = "'+n+'"><td>'+l+"</td><td>"+o+"</td>"+a+"</tr>"},addAgent:function(e){var t=!ZPUtil.Validation.isEmpty(e),s=new Tab("Add Agent",(function(){var s=casesSettings.CategoryModal.selectDivBoxHtml(ZPI18N.getString("zp.location"),"agntloc","",!0);s+=casesSettings.CategoryModal.selectDivBoxHtml(ZPI18N.getString("zp.agent"),"agentval","",!0),s+=casesSettings.CategoryModal.checkBoxHtml("Reassign cases in selected location to the selected agent ?","updNewCases","zpl_DNI"),s+=casesSettings.CategoryModal.checkBoxHtml("Reassign cases in current location to new agent?","updOldCases","zpl_DNI"),$("#cardAddAgent").html('<div class="zpl_crd"><div class="zpl_crdcnt">'+s+"</div></div>");var i=casesSettings.CategoryModal.fetchExistingLocations("agentTable","locid"),a=casesSettings.CategoryModal.fetchLocations(i);ZPeopleComponents.select("#agntloc",{options:a,disabled:casesSettings.CategoryModal.CURR_CGY_DATA.typeOthers==Cases.DEFAULT_MANAGER_CATEGORY,contentType:"text",dataMapping:{label:"location",value:"locationId"},dropdownList:{contentType:"text",height:300},placeholder:ZPI18N.getString("zp.select"),search:{by:["location"]}}),$("#agntloc").off("zselectoptionclick").on("zselectoptionclick",(function(t,s){casesSettings.CategoryModal.showCaseReassignment(e)}));var n={};if(casesSettings.CategoryModal.CURR_CGY_DATA.typeOthers==Cases.DEFAULT_MANAGER_CATEGORY){var l=[{id:"51",value:"Reporting manager"}];$.each(l,(function(e,t){t.image="",t.avatarText=EmployeeSearch.getImageAltText(t.value),t.email="",t.agenttype=t.id})),n.data=l}else{n.serverSearch=!0,n.cacheData=!0,n.dataSource={search:function(e){return new Promise((function(t,s){var i=null==e.query||""==e.query?"*":i;t({delay:20,results:EmployeeSearch.getEmpDeptGrpList(e.query,"HRCASES","HRCASES","FEEDS",!0),more:!1})}))},paginated:!0},n.multiple=!0}if(n.placeholder=ZPI18N.getString("zp.select"),n.showSearchField=!0,n.isLabelHTMLEncoded=!0,n.dataMapping={text:"value",value:"id",id:"id",email:"email",groupLabel:"dataType",agenttype:"agenttype",image:"image",textIcon:"avatarText"},n.contentType="image-text",n.dropdownList={contentType:"image-text-desc",height:300,isTextHTMLEncoded:!0,loseOnSelect:!1,checkedIcon:!0,width:500},n.search={by:["value","email"]},n.maxAllowedValues=10,ZPeopleComponents.tokenfield($("#agentval"),n),$("#agentval").off("ztokenfieldlistitemselect").on("ztokenfieldlistitemselect",(function(t,s){("2"==s.listItemData.agenttype||"3"==s.listItemData.agenttype||casesSettings.CategoryModal.CURR_CGY_DATA.typeOthers==Cases.DEFAULT_MANAGER_CATEGORY||"1"==s.listItemData.agenttype&&null!=$("#agentval").attr("agenttype")&&"1"!=$("#agentval").attr("agenttype")&&"4"!=$("#agentval").attr("agenttype"))&&ZPeopleComponents.tokenfield($("#agentval")).removeAllTokens(),$("#agentval").attr("agenttype",s.listItemData.agenttype),casesSettings.CategoryModal.CURR_CGY_DATA.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY&&casesSettings.CategoryModal.showCaseReassignment(e,s.listItemData)})),$("#agentval").off("ztokenfieldtokenremove").on("ztokenfieldtokenremove",(function(t,s){casesSettings.CategoryModal.CURR_CGY_DATA.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY&&casesSettings.CategoryModal.showCaseReassignment(e,s.listItemData)})),t){var o={},c=casesSettings.CategoryModal.CURR_CGY_DATA.categoryAgents;$.each(c,(function(t,s){s.cgyAgentId==e&&(o=s)}));var d=o.isAllLoc?{locationId:"0",location:ZPI18N.getString("zp.alllocaction")}:{locationId:o.locationId,location:o.location};ZPeopleComponents.select($("#agntloc")).addOption(d),ZPeopleComponents.select($("#agntloc")).setValue(d);var r=[];if("4"!=o.agentTypeId&&casesSettings.CategoryModal.CURR_CGY_DATA.typeOthers!=Cases.DEFAULT_MANAGER_CATEGORY)(p={}).id=o.agentValueId,p.agenttype=o.agentTypeId,p.dataType="1"==o.agentTypeId?ZPI18N.getString("zp.employee"):"2"==o.agentTypeId?ZPI18N.getString("zp.department"):ZPI18N.getString("zp.group"),p.value=o.owner,p.avatarText=EmployeeSearch.getImageAltText(o.owner),"1"==o.agentTypeId&&null!=o.employeeDetails&&(p.value=o.employeeDetails.name,p.image=o.employeeDetails.employeePhoto,p.avatarText="",p.email=o.employeeDetails.employeeEmailAlias,p.empid=o.employeeDetails.empid),r.push(p),ZPeopleComponents.tokenfield($("#agentval")).addToken(p),ZPeopleComponents.tokenfield($("#agentval")).setAttribute("values",r);else if("4"==o.agentTypeId){var p=[],g=ZPeople.getUserDetailsByIds(o.managerIds.split(","));$.each(g,(function(e,t){r.push({id:t.usererec,agenttype:"1",dataType:ZPI18N.getString("zp.employee"),value:t.empid+" "+t.name,image:t.avatar,email:t.email})})),ZPeopleComponents.tokenfield($("#agentval")).addTokens(r),ZPeopleComponents.tokenfield($("#agentval")).setAttribute("values",r)}else casesSettings.CategoryModal.CURR_CGY_DATA.typeOthers==Cases.DEFAULT_MANAGER_CATEGORY&&(o.agentTypeId="51",ZPeopleComponents.tokenfield($("#agentval")).destroy(),$("#agentval").append('<input class="ztextbox" type="text" disabled/>'),$("#agentval > input").attr("value",o.owner));$("#agentval").attr("agenttype",o.agentTypeId)}}),(function(){casesSettings.CategoryModal.saveAgent(e)}));casesSettings.CategoryModal.ADD_AGENT_MODAL=new popupModal(t?"Edit Agent":ZPI18N.getString("zp.addagent"),s),casesSettings.CategoryModal.ADD_AGENT_MODAL.closeCallback=function(){ZPeopleComponents.select($("#agntloc")).destroy(),ZPeopleComponents.tokenfield($("#agentval")).destroy(),casesSettings.CategoryModal.ADD_AGENT_MODAL.remove()},casesSettings.CategoryModal.ADD_AGENT_MODAL.save=t?ZPI18N.getString("zp.save"):ZPI18N.getString("zp.add"),casesSettings.CategoryModal.ADD_AGENT_MODAL.construct()},saveAgent:function(e){var t=casesSettings.CategoryModal.CURR_CGY_DATA.categoryId,s=casesSettings.CategoryModal.CURR_CGY_DATA.typeOthers==Cases.DEFAULT_MANAGER_CATEGORY;if(!s){var i=ZPeopleComponents.select($("#agntloc")).getValue(),a=ZPeopleComponents.tokenfield($("#agentval")).getAllValues(),n=a.length>1&&!s?"4":$("#agentval").attr("agenttype"),l="";s||(a.forEach((e=>{l+=e.id,l+=","})),l=l.slice(0,-1));$(ZPeopleComponents.tokenfield("#agentval").getElement())[0].outerText;var o={agentTypeId:n,agentValueId:l,locationId:i};null!=e&&(o.cgyAgentId=e);var c="",d=casesSettings.CategoryModal.CURR_CGY_DATA.categoryAgents;if(ZPUtil.Validation.isEmpty(e)||$.each(d,(function(t,s){s.cgyAgentId==e&&(oldAgentTypeId=s.agentTypeId,c=s.hasOwnProperty("managerIds")?s.managerIds:s.agentValueId,oldAgentValueIdsArr=c.split(","),oldLocationId=s.isAllLoc?"0":s.locationId,oldAgentName=s.owner),s.isAllLoc&&(hasAllLoc=!0)})),$("#agentval").siblings("div.zselectbox").removeClass("ztextbox__error").siblings("span").remove(),ZPUtil.Validation.isEmpty(l)&&!s)casesSettings.CategoryModal.setErrorMsg($("#agentval").siblings("div.zselectbox"),ZPI18N.getString("zp.selectagent"));else{var r={conreqcsr:csrfToken,method:"saveAgent",agentDetails:JSON.stringify(o),categoryId:t};$("#updateOldCases").length>0&&ZPeopleComponents.toggleswitch("#updateOldCases").getState()&&(r.updateOldCases=ZPeopleComponents.toggleswitch("#updateOldCases").getState()),$("#updateNewCases").length>0&&ZPeopleComponents.toggleswitch("#updateNewCases").getState()&&(r.updateNewCases=ZPeopleComponents.toggleswitch("#updateNewCases").getState()),ZPeople.Request.sendAsyncPost("/cases/agent/save",r,(function(t){if("success"==t.status){ZPeople.Message.showSuccessMsg(t.desc),$("#applLocDiv").html(t.applicableLocations);var s=casesSettings.CategoryModal.CURR_CGY_DATA.categoryAgents;null!=e?($("#agentTable").find("tr[id="+e+"]").replaceWith(casesSettings.CategoryModal.getAgentDetailsRow(t.agentDetails,casesSettings.CategoryModal.CURR_CGY_TYPEOTHERS,casesSettings.CategoryModal.CURR_CGY_SERVICEID)),$.each(s,(function(i,a){if(a.cgyAgentId==e)return s.splice(i,1,t.agentDetails),!1}))):(casesSettings.Common.removeEmptyData($("#cardAgents")),$("#agentTable").find("thead").find("tr").removeClass("DN"),$("#cardAgents").find("#agentTable_btn").removeClass("DN"),$("#agentTable").find("tbody").append(casesSettings.CategoryModal.getAgentDetailsRow(t.agentDetails,casesSettings.CategoryModal.CURR_CGY_TYPEOTHERS,casesSettings.CategoryModal.CURR_CGY_SERVICEID)),s.push(t.agentDetails)),$("#agentTable").find("tr").find("[grpDtl]").on("click",(function(e){e.stopPropagation(),e.preventDefault(),Group.editUsers($(this).attr("grpDtl"))})),casesSettings.CategoryModal.ADD_AGENT_MODAL.close(),casesSettings.CategoryModal.ADD_AGENT_MODAL=void 0}else ZPeople.Message.showFailureMsg(t.desc)}))}}},showCaseReassignment:function(e,t){$("#updateNewCases").closest("div.zpl_secn").remove(),$("#updateOldCases").closest("div.zpl_secn").remove();let s=ZPeopleComponents.tokenfield($("#agentval")).getAllValues(),i="";for(let e=0;e<s.length;e++)i=i+ZPeople.decodeTxt(s[e].value)+",";i=i.slice(0,-1);var a=casesSettings.CategoryModal.CURR_CGY_DATA.categoryId,n=ZPeopleComponents.select($("#agntloc")).getValue(),l=ZPeopleComponents.tokenfield($("#agentval")).getAllValues().map(((e,t)=>e.id));t&&l.push(t.id);l.length>1||$("#agentval").attr("agenttype");var o=l.join(",");if(t&&(i&&(i+=","),i+=ZPeople.decodeTxt(t.value)),l.length>0&&(ZPUtil.Validation.isEmpty(e)&&"0"==n||!ZPUtil.Validation.isEmpty(e))){var c=!1,d="",r="",p=casesSettings.CategoryModal.CURR_CGY_DATA.categoryAgents;ZPUtil.Validation.isEmpty(e)||$.each(p,(function(t,s){s.cgyAgentId==e&&(s.agentTypeId,d=s.hasOwnProperty("managerIds")?s.managerIds:s.agentValueId,d.split(","),r=s.isAllLoc?"0":s.locationId,s.owner),s.isAllLoc&&(c=!0)}));var g=0,h=0;if(!c||o==d&&n==r||(null==e&&"0"!=n?ZPeople.Request.sendAsyncPost("/cases/count/location",{conreqcsr:csrfToken,method:"fetchCasesCountForCategoryLocation",locationId:n,categoryId:a},(function(e){"success"==e.status&&(g=e.count)})):null!=e&&(r!=n&&"0"==r||ZPeople.Request.sendAsyncPost("/cases/count/location",{conreqcsr:csrfToken,method:"fetchCasesCountForCategoryLocation",locationId:r,categoryId:a},(function(e){"success"==e.status&&(g=e.count)})),"0"!=r&&"0"!=n&&r!=n&&ZPeople.Request.sendAsyncPost("/cases/count/location",{conreqcsr:csrfToken,method:"fetchCasesCountForCategoryLocation",locationId:n,categoryId:a},(function(e){"success"==e.status&&(h=e.count)})))),(g>0||h>0)&&c){if(g>0){var u=r!=n?ZPI18N.getString("zp.editagentcheckoldlocmessage",new Array(g+"",casesSettings.CategoryModal.fetchLocationName(r))):ZPI18N.getString("zp.editagentcheckmessage",new Array(g+"",ZSEC.Encoder.encodeForHTML(i)));$("#cardAddAgent").find("div.zpl_crdcnt").append(casesSettings.CategoryModal.checkBoxHtml(u,"updateOldCases","")),ZPeopleComponents.toggleswitch("#updateOldCases",{on:!0})}if(h>0){var m=ZPI18N.getString("zp.editagentchecknewlocmessage",new Array(h+"",casesSettings.CategoryModal.fetchLocationName(n),ZSEC.Encoder.encodeForHTML(i)));$("#cardAddAgent").find("div.zpl_crdcnt").append(casesSettings.CategoryModal.checkBoxHtml(m,"updateNewCases","")),ZPeopleComponents.toggleswitch("#updateNewCases",{on:!0})}}}},deleteAgent:function(e,t){e.stopPropagation(),e.preventDefault();var s=new DeleteAlertMessage(ZPI18N.getString("zp.deleteagent"),ZPI18N.getString("zp.deleteagentinfo")),i=!1,a=0,n={},l=casesSettings.CategoryModal.CURR_CGY_DATA.categoryAgents;$.each(l,(function(e,s){s.isAllLoc&&(i=!0),s.cgyAgentId==t&&(n=s)})),!n.isAllLoc&&i&&(ZPeople.Request.sendAsyncPost("/cases/count/location",{conreqcsr:csrfToken,method:"fetchCasesCountForCategoryLocation",locationId:n.locationId,categoryId:casesSettings.CategoryModal.CURR_CGY_DATA.categoryId},(function(e){"success"==e.status&&(a=e.count)})),a>0&&(s._centerDN="",s.centerHtml='<div class="zcheckbox"><input id="dagtupd" type="checkbox" checked="checked" class="zcheckbox__helper"><label for="dagtupd" class="zcheckbox__label"> '+ZPI18N.getString("zp.removeagentcheckmessage",new Array(a+""))+"</label></div>")),s.callback=function(e){var s={conreqcsr:csrfToken,method:"deleteAgent",cgyAgentId:t,categoryId:casesSettings.CategoryModal.CURR_CGY_DATA.categoryId};$("#dagtupd").length>0&&(s.updateCases=$("#dagtupd").is(":checked")),ZPeople.Request.sendAsyncPost("/cases/agent/delete",s,(function(e){if("success"==e.status){ZPeople.Message.showSuccessMsg(e.desc),$("#cardAgents").find("#agentTable").find('tr[id="'+t+'"]').remove(),$("#cardAgents").find("#agentTable").find("tbody").find("tr").length<=0&&($("#agentTable").find("thead").find("tr").addClass("DN"),$("#cardAgents").find("#agentTable_btn").addClass("DN"),$("#cardAgents").find("div.zpl_crdcnt").append(casesSettings.Common.emptyData(ZPI18N.getString("zp.noagentavailablehead"),ZPI18N.getString("zp.noagentavailabledesc"),ZPI18N.getString("zp.addagent"),"casesSettings.CategoryModal.addAgent()")));var s=casesSettings.CategoryModal.CURR_CGY_DATA.categoryAgents;$.each(s,(function(e,i){if(i.cgyAgentId==t)return s.splice(e,1),!1}))}else ZPeople.Message.showFailureMsg(e.desc)}))},s.cancelCallback=function(e){e.close(),e.remove()},s.yesButtonText=ZPI18N.getString("zp.confirm"),s.show()},fetchExistingLocations:function(e,t){var s=[];return $("#"+e).find("tr["+t+"]").each((function(e){s.push($(this).attr(t))})),s},fetchLocations:function(e){var t=[];for(var s in-1==$.inArray("0",e)&&t.push({locationId:"0",location:ZPI18N.getString("zp.alllocaction")}),$.isEmptyObject(ZPUtil.Location.ALL_LOCATION)&&ZPUtil.Location.load(!0),ZPUtil.Location.ALL_LOCATION)-1==$.inArray(s,e)&&t.push({locationId:s,location:ZPeople.decodeTxt(ZPUtil.Location.ALL_LOCATION[s])});return t},fetchLocationName:function(e){var t=e.split(","),s=[];return $.isEmptyObject(ZPUtil.Location.ALL_LOCATION)&&ZPUtil.Location.load(!0),$.each(t,(function(e,t){s.push(ZPeople.decodeTxt(ZPUtil.Location.ALL_LOCATION[t]))})),s.join(", ")},showReferences:function(e,t){var s=casesSettings.CategoryModal.getReferencesParentDiv();casesSettings.Components.destroy_zc_all();var i='<div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp"><h5><div class="zpl_flupld_img"></div>'+ZPI18N.getString("zp.widgetattach",new Array(""))+' <a class="zpl_lnk" onclick="casesSettings.CategoryModal.addRefFile()"><i class="PI_desktop"></i>'+ZPI18N.getString("zp.files.desktop")+'</a> / <a class="zpl_lnk" onclick="WorkDriveInt.showWorkDriveModal(\'AddCgyRef\')"><i class="PI_workdrive zpl_icnobg"></i>'+ZPI18N.getString("zp.workdrive")+'</a> / <a class="zpl_lnk" onclick="CasesFilesCommon.getCloudPicker(this,\'AddCgyRef\')"><i class="PI_cloud"></i>'+ZPI18N.getString("zp.files.cloud")+'</a> / <a class="zpl_lnk" onclick="casesSettings.CategoryModal.addReferences(\'URL\')"><i class="PI_link"></i>'+ZPI18N.getString("zp.associatedUrl")+"</a></h5></div></div></div></div>",a='<div class = "zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.knowledgebase")+'</h4></div></div><div name="refCntDiv" class="zpl_crdcnt">'+i+"</div></div>";s.html(a);var n=$('<div class="zpl_atchd atchful zpl_csRefWd"></div>'),l="";e.length>0?$.each(e,(function(e,t){n.append(casesSettings.CategoryModal.referenceRowsHtml(t))})):l=casesSettings.Common.emptyData(ZPI18N.getString("zp.noreferenceshead"),ZPI18N.getString("zp.nocgyrefdesc"));var o='<div id="refLstDiv" class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.addedreferences")+"</h5></div></div>",c=$(o);c.append(n),s.find("div[name=refCntDiv]").append(c),s.find("div[id=refLstDiv]").append(l)},referenceRowsHtml:function(e,t){var s=$("<div></div>"),i=casesSettings.CategoryModal.getCategoryId(),a=casesSettings.CategoryModal.fetchLocations(new Array),n=e.locationDtls.length>0?e.locationDtls:[{locationId:"0",location:ZPI18N.getString("zp.alllocaction")}];switch(e.formType){case"0":e.linkName=e.linkName.length>0?e.linkName:e.link;var l=t?'<input type="text" name="linkName" placeholder="'+ZPI18N.getString("zp.displayname")+'" value="'+e.linkName+'" class="ztextbox">':"<h4>"+e.linkName+"</h4>";s.append('<div linkid="'+e.linkId+'"><div class="zpl_atchimg"><i class="PI_link"></i></div><div class="zpl_atchdtl">'+l+"<p><span>"+e.link+'</span></p></div><div class="zpl_atlct"><textarea id="loc_'+e.linkId+'"></textarea></div><div class="zpl_atchicn"><i title = "'+ZPI18N.getString("zp.edit")+'" class="PI_edt" onclick="casesSettings.CategoryModal.editReferences(this, \'services\')"></i><i title = "'+ZPI18N.getString("zp.delete")+'" class="PI_delete" onclick="casesSettings.CategoryModal.deleteReferences(this, \'services\')"></i></div></div>');var o=e.link.match(/^http[s]*:\/\//),c=o?o+escape(e.link.split(/^http[s]*:\/\//)[1]):"https://"+escape(e.link);title=c,s.find("div[linkid]").prepend('<a rel="noopener noreferrer" class="zpl_DNI" href="'+unescape(c)+'" target="_blank"></a>'),s.find("div.zpl_atchdtl > h4").off("click").on("click",(function(e){e.stopPropagation(),e.preventDefault(),$(this).closest("div[linkid]").find("a").trigger("click")}));break;case"2":e.linkName=e.linkName.length>0?e.linkName:decodeURIComponent(e.link.substring(e.link.lastIndexOf("/")+1));l=t?'<input type="text" name="linkName" placeholder="'+ZPI18N.getString("zp.displayname")+'" value="'+e.linkName+'" class="ztextbox">':"<h4>"+e.linkName+"</h4>";var d=e.hasOwnProperty("filePath")?e.filePath.substring(e.filePath.lastIndexOf(".")+1):e.link.substring(e.link.lastIndexOf(".")+1),r=FilesCommon.getFileIcon(d),p=FilesCommon.getFileSize(e.fileSize);"1"==e.uploadSource&&(r="PI_workdrive",p=e.link),s.append('<div linkid="'+e.linkId+'"><div class="zpl_atchimg"><i class="'+r+'"></i></div><div class="zpl_atchdtl">'+l+"<p><span>"+p+'</span></p></div><div class="zpl_atlct"><textarea id="loc_'+e.linkId+'"></textarea></div><div class="zpl_atchicn"><i class="PI_edt" title = "'+ZPI18N.getString("zp.edit")+'" onclick="casesSettings.CategoryModal.editReferences(this, \'services\')"></i><i title = "'+ZPI18N.getString("zp.delete")+'" class="PI_delete" onclick="casesSettings.CategoryModal.deleteReferences(this, \'services\')"></i></div></div>'),e.link.indexOf(workDriveUrl)>-1||e.link.indexOf(writerUrl)>-1||e.link.indexOf(sheetUrl)>-1||e.link.indexOf(showUrl)>-1||"1"==e.uploadSource?(icon="workdrive",s.find("div.zpl_atchdtl > h4").attr("onclick",'window.open("'+e.link+'")')):s.find("div.zpl_atchdtl > h4").attr("onclick","CasesFilesCommon.getLightBoxPreview('"+e.linkId+"','"+i+"','"+HR_CATEGORY_ATTACHEMENTS+"','"+l+"','"+escape(d)+"','"+(e.hasOwnProperty("filePath")?"attachmentz"+e.link:"")+"')")}return t&&(s.find("div.zpl_atchicn").empty().append('<i title = "'+ZPI18N.getString("zp.save")+'" class="PI_tick"></i><i title = "'+ZPI18N.getString("zp.cancel")+'" class="PI_cls"></i>'),casesSettings.Components.destroy_zctf("loc_"+e.linkId)),ZPeopleComponents.tokenfield(s.find("#loc_"+e.linkId),{data:a,dataMapping:{text:"location",value:"locationId",id:"locationId"},dropdownList:{closeOnSelect:!1,height:300,checkedIcon:!0},values:n,randomDropdownListId:!0,disabled:!t}),s.find("#loc_"+e.linkId).off("ztokenfieldlistitemselect").on("ztokenfieldlistitemselect",(function(e,t){"0"!=t.listItemData.locationId?ZPeopleComponents.tokenfield($(this)).getValues(["0"]).length>0&&(ZPeopleComponents.tokenfield($(this)).removeTokens(["0"]),ZPeopleComponents.tokenfield($(this)).closeDropdownList()):(ZPeopleComponents.tokenfield($(this)).removeAllTokens(),ZPeopleComponents.tokenfield($(this)).closeDropdownList())})),s.find("div[linkid]").data(e),casesSettings.Components.ZCTF.push(s.find("#loc_"+e.linkId)),s.children()},addRefFile:function(){var e=casesSettings.CategoryModal.getReferencesParentDiv(),t=$('<div><input name="refFile" onclick="this.value=null" type="file"/></div>');t.find("input").trigger("click"),t.find("input").off("change").on("change",(function(t){var s=$(this)[0].files[0];void 0!==s&&s.size>0&&s.size<5242880?(casesSettings.Common.removeEmptyData(e),e.find("div.zpl_atchd").find("div[filepos]").remove(),CasesFilesCommon.getFileBoxProgressOnSelect(s,0,(function(t,s){ZPUtil.Validation.isEmpty(casesSettings.CategoryModal.MODAL)||(casesSettings.CategoryModal.MODAL.madeChanges=!0),e.find("div.zpl_atchd").prepend(t),CasesFilesCommon.uploadFileByXHR(s,{fieldName:"attachment",formTable:"P_HR_Catalog",callback:function(e){$(t).replaceWith(casesSettings.CategoryModal.referenceFileRowHtml(e,"localUpload"))},failureCallback:function(t){e.find("div.zpl_atchd").find("div[filepos]").remove(),e.find("div.zpl_atchd").find("div[name=fBox]").length<=0&&e.find("[id=refLstDiv]").append(casesSettings.Common.emptyData(ZPI18N.getString("zp.noreferenceshead"),ZPI18N.getString("zp.nocgyrefdesc")))}})}),!0)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.agreementfilesizelimit"))}))},referenceFileRowHtml:function(e,t){var s=casesSettings.CategoryModal.getReferencesParentDiv();"workDriveUpload"!=t&&"cloudUpload"!=t||s.find("div.zpl_atchd").find("div[filepos]").remove(),ZPUtil.Validation.isEmpty(casesSettings.CategoryModal.MODAL)||(casesSettings.CategoryModal.MODAL.madeChanges=!0);var i="",a=e.fileName,n=null!=e.fileSize?FilesCommon.getFileSize(e.fileSize):"";if("workDriveUpload"==t)i="PI_workdrive",n=e.permalink;else if("localUpload"==t)i=FilesCommon.getFileIcon(e.extension);else{var l=JSON.parse(e),o=l.docName.substring(l.docName.lastIndexOf(".")+1);a=decodeURIComponent(l.docName),i=FilesCommon.getFileIcon(o),n=l.hasOwnProperty("docType")?l.docType:l.hasOwnProperty("mimeType")?l.mimeType:""}var c=$("<div></div>"),d='<input type="text" id="aRefLinkName" name="linkName" placeholder="'+ZPI18N.getString("zp.displayname")+'" class="ztextbox">';c.append('<div name="fBox" filePos="0"><div class="zpl_atchimg"><i class="'+i+'"></i></div><div class="zpl_atchdtl">'+d+"<p><span>"+n+'</span></p></div><div class="zpl_atlct"><textarea id="loc_fBox"></textarea></div><div class="zpl_atchicn"><i title = "'+ZPI18N.getString("zp.save")+'" class="PI_tick"></i><i title = "'+ZPI18N.getString("zp.cancel")+'" class="PI_cls"></i></div></div>'),c.find("div[filePos]").data("uploadMode",t),c.find("div[filePos]").find("input[name=linkName]").val(a),"localUpload"==t?c.find("div[filePos]").data("uploadedFile",JSON.stringify({filePath:e.fileId+"",fileName:e.fileName,fileSize:e.fileSize})):c.find("div[filePos]").data("uploadedFile",e),casesSettings.Components.destroy_tempzctf();var r=casesSettings.CategoryModal.fetchLocations(new Array);return ZPeopleComponents.tokenfield(c.find("#loc_fBox"),{data:r,dataMapping:{text:"location",value:"locationId",id:"locationId"},dropdownList:{closeOnSelect:!1,height:300,checkedIcon:!0},randomDropdownListId:!0,values:[{locationId:"0",location:ZPI18N.getString("zp.alllocaction")}]}),c.find("#loc_fBox").off("ztokenfieldlistitemselect").on("ztokenfieldlistitemselect",(function(e,t){"0"!=t.listItemData.locationId?ZPeopleComponents.tokenfield($(this)).getValues(["0"]).length>0&&(ZPeopleComponents.tokenfield($(this)).removeTokens(["0"]),ZPeopleComponents.tokenfield($(this)).closeDropdownList()):(ZPeopleComponents.tokenfield($(this)).removeAllTokens(),ZPeopleComponents.tokenfield($(this)).closeDropdownList())})),casesSettings.Components.TEMP_ZCTF.push(c.find("#loc_fBox")),c.find("i.PI_tick").off("click").on("click",(function(e){e.stopPropagation(),e.preventDefault(),casesSettings.CategoryModal.saveReferences(t,$(this).closest("div[filePos]"))})),c.find("i.PI_cls").off("click").on("click",(function(e){e.stopPropagation(),e.preventDefault(),ZPeopleComponents.tokenfield($("#loc_fBox")).destroy(),$(this).closest("div[filePos]").remove(),s.find("div.zpl_atchd").find("div[name=fBox]").length<=0&&s.find("div.zpl_atchd").find("div[linkid]").length<=0&&s.find("[id=refLstDiv]").append(casesSettings.Common.emptyData(ZPI18N.getString("zp.noreferenceshead"),ZPI18N.getString("zp.nocgyrefdesc")))})),"localUpload"!=t&&s.find("div.zpl_atchd").prepend(c.children()),c.children()},editReferences:function(e,t){var s=casesSettings.CategoryModal.getReferencesParentDiv(),i=$(e).closest("div[linkid]").data(),a=casesSettings.CategoryModal.referenceRowsHtml(i,!0),n="/cases/references/update";a.find("i.PI_cls").off("click").on("click",(function(){casesSettings.Components.destroy_zctf("loc_"+i.linkId),(a=casesSettings.CategoryModal.referenceRowsHtml(i,!1)).data(i),s.find("[linkid = "+i.linkId+"]").replaceWith(a)})),a.find("i.PI_tick").off("click").on("click",(function(){var e=!1,a=$(this).closest("div[linkid]").find("input[name=linkName]").val(),l={contentId:i.linkId,contentType:i.formType,displayName:a},o=casesSettings.Common.returnCommaSeparatedString(ZPeopleComponents.tokenfield("#loc_"+i.linkId).getAllValues(),"locationId");if(s.find("#loc_"+i.linkId+"-input").closest("div").removeClass("ztextbox__error"),s.find("#loc_"+i.linkId+"-input").closest("div").siblings("span.ztextbox--error__label").remove(),ZPUtil.Validation.isEmpty(o)&&(e=!0,s.find("#loc_"+i.linkId+"-input").closest("div").addClass("ztextbox__error"),s.find("#loc_"+i.linkId+"-input").closest("div").after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.chooselocations")+"</span>")),!e){l.isAllLoc="0"==o,l.isAllLoc||(l.locationId=o),"null"!=i.locationGroupId&&(l.locationGroupId=i.locationGroupId);var c=casesSettings.CategoryModal.getCategoryId(),d={conreqcsr:csrfToken,method:"updateContentValue",categoryId:c,contentValues:JSON.stringify(l)};if("services"==t){n="/services/references/update";var r=window.location.hash.split("/")[2],p=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==r.toLowerCase()}));d.serviceName=p[0].tabName}ZPeople.Request.sendAsyncPost(n,d,(function(e){if("success"==e.status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.referencesupdatesuccess")),casesSettings.Components.destroy_zctf("loc_"+i.linkId),s.find('div[linkid="'+e.categoryReference.linkId+'"]').replaceWith(casesSettings.CategoryModal.referenceRowsHtml(e.categoryReference,!1));var t=casesSettings.CategoryModal.getReferencesDataObj();$.each(t,(function(t,s){s.linkId==l.contentId&&(s=e.categoryReference)}))}else ZPeople.Message.showFailureMsg(e.desc)}))}})),$(e).closest("div[linkid]").replaceWith(a)},deleteReferences:function(e,t){var s=casesSettings.CategoryModal.getReferencesParentDiv(),i=casesSettings.CategoryModal.getCategoryId(),a=$(e).closest("div[linkid]"),n=a.data(),l=new DeleteAlertMessage(ZPI18N.getString("zp.deletereference"),ZPI18N.getString("zp.deletereferencemsg"));l.isDoubleCnf=!0;var o="/cases/references/delete";l.callback=function(){var e={conreqcsr:csrfToken,method:"deleteContent",contentId:n.linkId,categoryId:i,contentType:n.formType};if("services"==t){o="/services/references/delete";var l=window.location.hash.split("/")[2],c=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==l.toLowerCase()}));e.serviceName=c[0].tabName}"null"!=n.locationGroupId&&(e.locationGroupId=n.locationGroupId),ZPeople.Request.sendAsyncPost(o,e,(function(t){if("success"==t.status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.referencesdeletesuccess")),a.remove();var i=casesSettings.CategoryModal.getReferencesDataObj();$.each(i,(function(t,s){if(s.linkId==e.contentId)return i.splice(t,1),!1})),s.find("div[linkid]").length<=0&&s.find("div[id=refLstDiv]").append(casesSettings.Common.emptyData(ZPI18N.getString("zp.noreferenceshead"),ZPI18N.getString("zp.nocgyrefdesc")))}else ZPeople.Message.showFailureMsg(t.desc)}))},l.yesButtonText=ZPI18N.getString("zp.confirm"),l.cancelCallback=function(e){e.close(),e.remove()},l.show()},getReferencesParentDiv:function(){return"UtilitiesRefDiv"==settingsPage.container.attr("name")&&settingsPage.container.hasClass("zpl_act")?settingsPage.container:$("#cardReferences")},getReferencesDataObj:function(){return"UtilitiesRefDiv"==settingsPage.container.attr("name")&&settingsPage.container.hasClass("zpl_act")?casesSettings.Utilities.CATEGORY_DATA.assoContents:casesSettings.CategoryModal.CURR_CGY_DATA.categoryReferences},getCategoryId:function(){return"UtilitiesRefDiv"==settingsPage.container.attr("name")&&settingsPage.container.hasClass("zpl_act")?casesSettings.Utilities.CATEGORY_ID:casesSettings.CategoryModal.CURR_CGY_DATA.categoryId},saveReferences:function(e,t){var s=casesSettings.CategoryModal.getReferencesParentDiv(),i=casesSettings.CategoryModal.getCategoryId(),a=!1,n=new FormData;if(n.append("conreqcsr",csrfToken),n.append("methodName","addAssociatedContent"),n.append("categoryId",i),window.location.hash.includes("resources")){searchTagUrl="/services/references/add";var l=window.location.hash.split("/")[2],o=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==l.toLowerCase()}));n.serviceName=o[0].tabName}var c="URL"==e?"#aRefLocDiv":"#loc_fBox",d="URL"==e?"#aRefDisName":"#aRefLinkName",r=casesSettings.Common.returnCommaSeparatedString(ZPeopleComponents.tokenfield($(c)).getAllValues(),"locationId");$(c+"-input").closest("div").removeClass("ztextbox__error"),$(c+"-input").closest("div").siblings("span.ztextbox--error__label").remove(),ZPUtil.Validation.isEmpty(r)&&(a=!0,$(c+"-input").closest("div").addClass("ztextbox__error"),$(c+"-input").closest("div").after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.chooselocations")+"</span>"));var p="0"==r,g=[],h=$(d).val();if("URL"==e){var u=$("#aRefURL").val();$("#aRefURL").removeClass("ztextbox__error"),$("#aRefURL").siblings("span").remove(),ZPUtil.Validation.isEmpty(u)&&(a=!0,$("#aRefURL").addClass("ztextbox__error"),$("#aRefURL").after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.lms.editor.enterValidUrl")+"</span>")),h=ZPUtil.Validation.isEmpty(h)?u:h,g.push({linkId:"",linkName:h,link:u,formId:"",formType:"0",file_count:0})}else if("localUpload"==e){var m=JSON.parse(s.find("div[filePos]").data("uploadedFile"));h=ZPUtil.Validation.isEmpty(h)?m.fileName:h,n.append("uploadMode_1","localUpload"),n.append("file_upload_1",s.find("div[filePos]").data("uploadedFile")),g.push({linkId:"",linkName:h,link:"",formId:"",formType:"2",file_count:1})}else"workDriveUpload"==e?(n.append("uploadMode_1","workDriveUpload"),n.append("WDUploadDoc_1",JSON.stringify(s.find("div[filePos]").data("uploadedFile"))),g.push({linkId:"",linkName:h,link:"",formId:"",formType:"2",file_count:1,uploadSource:1})):(n.append("uploadMode_1","cloudUpload"),n.append("cloudUploadDoc_1",s.find("div[filePos]").data("uploadedFile")),g.push({linkId:"",linkName:h,link:"",formId:"",formType:"2",file_count:1}));var v={isAllLoc:p,locationId:r,categoryReferences:g};n.append("categoryConfiguration",JSON.stringify(v)),a||$.ajax({url:"/cases/references/add",type:"POST",data:n,processData:!1,contentType:!1,async:!1,success:function(e){if(CommonTemplates.saveComplete("submitBtn"),ZPUtil.Validation.isEmpty(casesSettings.CategoryModal.MODAL)||(casesSettings.CategoryModal.MODAL.madeChanges=!1),"success"==e.status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.referenceaddedsuccess")),casesSettings.Common.removeEmptyData(),null!=t&&(ZPeopleComponents.tokenfield($("#loc_fBox")).destroy(),t.remove()),s.find("div.zpl_atchd").append(casesSettings.CategoryModal.referenceRowsHtml(e.categoryReference[0]));let a=s.find("#cardRightDiv"),n=s.find("#refLstDiv").height();0===a.length&&(a=s),a.scrollTop(n);var i=casesSettings.CategoryModal.getReferencesDataObj();null!=i&&i.push(e.categoryReference[0]),null!=casesSettings.CategoryModal.ADD_REF_MODAL&&(casesSettings.CategoryModal.ADD_REF_MODAL.close(),casesSettings.CategoryModal.ADD_REF_MODAL.remove(),casesSettings.CategoryModal.ADD_REF_MODAL=void 0)}else ZPUtil.Validation.isEmpty(casesSettings.CategoryModal.MODAL)||(casesSettings.CategoryModal.MODAL.madeChanges=!0),ZPeople.Message.showFailureMsg(e.desc)}})},addReferences:function(e){casesSettings.CategoryModal.getReferencesParentDiv();var t=new Tab("Add References",(function(){var t=casesSettings.CategoryModal.selectDivBoxHtml(ZPI18N.getString("zp.location"),"aRefLocDiv","",!0);t+=casesSettings.CategoryModal.inputBoxHtml(ZPI18N.getString("zp.displayname"),"aRefDisName",""),"URL"==e&&(t+=casesSettings.CategoryModal.inputBoxHtml(ZPI18N.getString("zp.associatedUrl"),"aRefURL","",!1,250,!0)),$("#cardAddReferences").html('<div class="zpl_crd"><div class="zpl_crdcnt">'+t+"</div></div>");var s=casesSettings.CategoryModal.fetchLocations(new Array);ZPeopleComponents.tokenfield("#aRefLocDiv",{data:s,dataMapping:{text:"location",value:"locationId",id:"locationId"},dropdownList:{closeOnSelect:!1,height:300,checkedIcon:!0},values:[{locationId:"0",location:ZPI18N.getString("zp.alllocaction")}]}),$("#aRefLocDiv").off("ztokenfieldlistitemselect").on("ztokenfieldlistitemselect",(function(e,t){"0"!=t.listItemData.locationId?ZPeopleComponents.tokenfield($(this)).getValues(["0"]).length>0&&(ZPeopleComponents.tokenfield($(this)).removeTokens(["0"]),ZPeopleComponents.tokenfield($(this)).closeDropdownList()):(ZPeopleComponents.tokenfield($(this)).removeAllTokens(),ZPeopleComponents.tokenfield($(this)).closeDropdownList())}))}),(function(){casesSettings.CategoryModal.saveReferences(e)}));casesSettings.CategoryModal.ADD_REF_MODAL=new popupModal(ZPI18N.getString("zp.addreferences"),t),casesSettings.CategoryModal.ADD_REF_MODAL.closeCallback=function(){ZPeopleComponents.tokenfield($("#aRefLocDiv")).destroy()},casesSettings.CategoryModal.ADD_REF_MODAL.construct()},getFAQParentDiv:function(){return"UtilitiesFAQDiv"==settingsPage.container.attr("name")&&settingsPage.container.hasClass("zpl_act")?settingsPage.container:$("#cardFAQs")},showFAQs:function(e,t){var s=casesSettings.CategoryModal.getFAQParentDiv();let i="/cases/category/faq",a={method:"fetchCategoryFAQs",categoryId:e};if(window.location.hash.includes("resources")){i="/services/faq/list",a={method:"faqList",mode:"faqList",index:0};var n=window.location.hash.split("/")[2],l=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==n.toLowerCase()}));a.serviceName=l[0].tabName}ZPeople.Request.sendAsyncPost(i,a,(function(i){var a;null!=i.faqList?a=i.faqList:null!=i.FAQ_LIST&&(a=i.FAQ_LIST);var n=null!=a&&a.length>0?"":casesSettings.Common.emptyData(ZPI18N.getString("zp.nofaqlisthead"),ZPI18N.getString("zp.nocgyfaqdesc"),ZPI18N.getString("zp.addfaqbtn"),"casesSettings.CategoryModal.addFAQ(event,undefined,'"+e+"')","zp_nd_faq"),l='<div class = "zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.faqAbbre")+'</h4></div><div><button id="faqTable_btn" class="zpl_DNI zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.addfaqbtn")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_tblres"><table class="zpl_tbl wd100_per" role="grid"><tbody id="faqListing"></tbody></table></div></div>'+n+"</div></div>";s.html(l),null!=a&&a.length>0&&(""==n?(s.find("#faqTable_btn").removeClass("zpl_DNI"),s.find("#faqListing").prepend(casesSettings.CategoryModal.faqTableRowsHtml(a,e,t))):s.find("#faqTable_btn").addClass("zpl_DNI"),s.find("#faqTable_btn").off("click").on("click",(function(t){casesSettings.CategoryModal.addFAQ(t,void 0,e)})))})),s.find("#faqTable_btn").off("click").on("click",(function(t){casesSettings.CategoryModal.addFAQ(t,void 0,e)}))},showHideFAQ:function(e){$(e).find("div[name=faqans]").toggleClass("DN"),$(e).find("div[name=faqans]").hasClass("DN")?$(e).find("i[name=faqIcn]").removeClass("PI_abtm").addClass("PI_atop"):$(e).find("i[name=faqIcn]").addClass("PI_abtm").removeClass("PI_atop")},showLikeAnalyticsFAQ:function(e,t,s){casesSettings.CategoryModal.getFAQParentDiv();e.stopPropagation(),e.preventDefault();var i=new Tab("LikeAnalytics",(function(){$("#tabLikeAnalytics").addClass("zpl_faqaly");var e="#3EE0BA",i="#FF7270";let a="/cases/faq/report";var n={method:"faqReport",faqId:t,categoryId:s};if(window.location.hash.includes("resources")){a="/services/faq/report";var l=window.location.hash.split("/")[2],o=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==l.toLowerCase()}));n.serviceName=o[0].tabName}ZPeople.Request.sendAsyncPost(a,n,(function(s){if(jQuery.isEmptyObject(s)||0==s.disLikeCount&&0==s.likeCount)$("#cardLikeAnalytics").html('<div class="zpl_crd"><div class="zpl_crdcnt">'+casesSettings.Common.emptyData("No responses received currently","","","","zp_nd_rprtilustr")+"</div></div>");else{var a=$('<div class="zpl_crd"><div class="zpl_dashcard"><div class ="zpl_dashbody"><div class ="zpl_dashcht"><div id="faqDonutChart" style="width: 180px; height: 180px; margin: 10px auto 5px; overflow: hidden;" class="pie-data"></div><div class="zpl_dashchtdes"><ul><li><div class="cod" style="background-color:'+e+'"></div>'+ZPI18N.getString("zp.liked")+" <b>"+s.likeCount+'</b></li><li><div class="cod" style="background-color:'+i+'"></div>'+ZPI18N.getString("zp.lms.content.Disliked")+" <b>"+s.disLikeCount+"</b></li></ul></div></div></div></div></div>"),n=$('<div class="zpl_crd"><div class="zpl_crdhdr"><div><div class="zpl_hdcnt nomrgn"><ul class="zpl_tabpane"><li class="zpl_act" name="likeFAQTab"><a onclick="casesSettings.CategoryModal.displayLikeDislikeUsers(\'likeFAQTab\')"><i class="PI_like grn"></i> <span>'+ZPI18N.getString("zp.liked")+'</span></a></li><li name="dislikeFAQTab"><a onclick="casesSettings.CategoryModal.displayLikeDislikeUsers(\'dislikeFAQTab\')"><i class="PI_unlike red"></i> <span>'+ZPI18N.getString("zp.lms.content.Disliked")+'</span></a></li></ul></div></div></div><div class="zpl_crdcnt"><div class="zpl_tabcnt"><div name="likeFAQTab">'+casesSettings.Common.emptyData("No Likes Received")+'</div><div name="dislikeFAQTab" class="zpl_DNI">'+casesSettings.Common.emptyData("No dislikes received")+"</div></div></div></div>");0!=s.disLikeCount&&n.find("div[name=dislikeFAQTab]").html(casesSettings.CategoryModal.showUserListFAQ(s.disLikeEmpCmtArr)),0!=s.likeCount&&n.find("div[name=likeFAQTab]").html(casesSettings.CategoryModal.showUserListFAQ(s.likeEmpArr)),$("#cardLikeAnalytics").empty().append(a).append(n).removeClass("zpl_faqaly");casesSettings.CategoryModal.constructFaqChart(s,t,"faqDonutChart",e,i)}}))}));casesSettings.CategoryModal.ADD_FAQ_MODAL=new sliderModal("Analytics",i),casesSettings.CategoryModal.ADD_FAQ_MODAL.setCloseCallback((function(){casesSettings.CategoryModal.ADD_FAQ_MODAL.remove()})),casesSettings.CategoryModal.ADD_FAQ_MODAL.construct(void 0,'<button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.close")+"</button>")},showUserListFAQ:function(e){var t=$('<div class="zp_secn"><ul class="zpl_lkstr"></ul></div>'),s="";return $.each(e,(function(e,i){s+='<li><div class="j-cnt-btwen"><div class="zpl_em"><div class="zpl_emimg"><img src="'+i.employeePhoto+'"></div><div class="zpl_emdts"><span>'+i.empid+" - </span><span>"+i.name+'</span></div></div><div><span class="gry">'+i.reactedTime+"</span></div></div>",i.hasOwnProperty("comment")&&(s+="<div><p>"+i.comment+"</p></div>"),s+="</div></li>",t.find("ul").append(s)})),t.children()},displayLikeDislikeUsers:function(e){$("li[name="+e+"]").addClass("zpl_act").siblings("li").removeClass("zpl_act"),$("div[name="+e+"]").removeClass("zpl_DNI").siblings("div").addClass("zpl_DNI")},constructFaqChart:function(e,t,s,i,a){new Highcharts.Chart({chart:{renderTo:s,margin:0,plotBorderWidth:0,plotShadow:!1,events:{load:function(e){e.target.reflow()}},type:"pie"},title:{verticalAlign:"middle",useHTML:!0,style:{fontSize:"12px"},x:.5*(this.chartWidth-(this.spacingLeft+this.spacingRight)),y:.5*(this.chartHeight-(this.spacingTop+this.spacingBottom)),floating:!0,text:ZPI18N.getString("zp.totalEmplyees")+'<br><span style="font-size:20px;color: #000000; display:block; text-align: center; font-weight: bold">'+(e.disLikeCount+e.likeCount)+"</span>"},credits:{enabled:!1},tooltip:{formatter:function(){return this.point.name+" : "+this.y}},plotOptions:{pie:{shadow:!1,center:["50%","50%"],size:"100%",allowPointSelect:!1,borderWidth:0,showInLegend:!1,states:{hover:{enabled:!0}}},series:{point:{events:{click:function(){if(this.y>0){var e=1==this.x?"likeFAQTab":"dislikeFAQTab";casesSettings.CategoryModal.displayLikeDislikeUsers(e)}}}}}},series:[{type:"pie",name:"Count",data:[{name:ZPI18N.getString("zp.liked"),x:1,y:e.likeCount,color:i},{name:ZPI18N.getString("zp.lms.content.Disliked"),x:2,y:e.disLikeCount,color:a}],innerSize:"90%",dataLabels:{enabled:!1}}],exporting:{enabled:!1,chartOptions:{title:{text:"Faq Report - "+t}},plotOptions:{series:{dataLabels:{enabled:!0}}},pie:{showInLegend:!0,dataLabels:{style:{cursor:"pointer"}}},buttons:{contextButton:{theme:{states:{hover:{stroke:"#000000",fill:null},select:{stroke:"#000000",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"Faq Report - "+t}})},deleteFAQ:function(e,t,s){var i=casesSettings.CategoryModal.getFAQParentDiv();e.stopPropagation(),e.preventDefault();var a=new DeleteAlertMessage("Delete FAQ?",ZPI18N.getString("zp.deletefaqmsg"));a.isDoubleCnf=!0,a.callback=function(){var e={mode:"deleteFaq",conreqcsr:csrfToken,faqId:t,categoryId:s},a="/cases/faq/delete";if(window.location.hash.includes("resources")){a="/services/faq/delete";var n=window.location.hash.split("/")[2],l=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==n.toLowerCase()}));e.serviceName=l[0].tabName}ZPeople.Request.send(a,e,(function(e){"success"==e.status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqdeletesuccessmsg")),i.find("#faqListing").find('tr[faqId="'+t+'"]').remove(),i.find("#faqListing").find("tr[faqId]").length<=0&&(i.find("#faqListing").empty(),i.find("#faqListing").closest("div.zpl_secn").append(casesSettings.Common.emptyData(ZPI18N.getString("zp.nofaqlisthead"),ZPI18N.getString("zp.nocgyfaqdesc"),ZPI18N.getString("zp.addfaqbtn"),"casesSettings.CategoryModal.addFAQ(event,undefined,'"+s+"')","zp_nd_faq")),i.find("#faqTable_btn").addClass("zpl_DNI"))):ZPeople.Message.showFailureMsg(e.desc)}))},a.yesButtonText=ZPI18N.getString("zp.confirm"),a.cancelCallback=function(e){e.close(),e.remove()},a.show()},addFAQ:function(e,t,s){e.stopPropagation(),e.preventDefault(),casesSettings.CategoryModal.FAQ_EDITOR={};var i=null!=t,a=i?"Edit FAQ":ZPI18N.getString("zp.addfaqbtn"),n=new Tab("Add FAQ",(function(){var e={},a="/cases/category/faqinfo";if(i){var n={mode:"fetchFaq",conreqcsr:csrfToken,faqId:t,categoryId:s};if(window.location.hash.includes("resources")){a="/services/faq/fetch";var l=window.location.hash.split("/")[2],o=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==l.toLowerCase()}));n.serviceName=o[0].tabName}ZPeople.Request.sendAsyncPost(a,n,(function(t){e=t}))}var c=casesSettings.CategoryModal.inputBoxHtml(ZPI18N.getString("zp.question"),"afaqquery",i?ZSEC.Encoder.encodeForHTML(e.question):"",!1,250,!0);c+=casesSettings.CategoryModal.editorDivHtml(ZPI18N.getString("zp.answer"),"afaqans","zpl_msgedtr msgedtr_optnl"),c+=casesSettings.CategoryModal.selectDivBoxHtml(ZPI18N.getString("zp.tags"),"afaqtag"),c+=casesSettings.CategoryModal.fileUploadHtml("afaqattach"),c+=casesSettings.CategoryModal.fileListDivHtml("afaqattachDiv"),$("#cardAddFAQ").html('<div class="zpl_crd"><div class="zpl_crdcnt">'+c+"</div></div>");var d={id:"afaqans",mode:"richtext",content:i?e.answer:"",editorheight:300};if(casesSettings.CategoryModal.FAQ_EDITOR=ZPUtil.initiateZEEditor(d,"HrCase"),casesSettings.CategoryModal.FAQ_EDITOR.afterEditorLoad((function(){setTimeout((function(){$("#afaqquery").trigger("focus")}),50)})),ZPeopleComponents.tokenfield("#afaqtag",{dataSource:{search:function(e){return new Promise((function(t,s){t({delay:20,results:CasesFAQ.searchTags(e.query),more:!1})}))},paginated:!0},acceptNewValues:!0,showDropDownListOnFocus:!0,dataMapping:{text:"value",value:"id",id:"id"},dropdownList:{closeOnSelect:!1,height:300,checkedIcon:!0}}),i){if(e.tagsArr.length>0){var r=[];$.each(e.tagsArr,(function(e,t){r.push({id:t.tagId,value:t.tagName})})),ZPeopleComponents.tokenfield("#afaqtag").setAttribute("values",r)}e.Files.length>0&&$.each(e.Files,(function(e,t){var s=CasesFilesCommon.viewFileBox(t);$("#afilesAttach").append(s)}))}}),(function(){casesSettings.CategoryModal.saveFAQ(t,s)}));casesSettings.CategoryModal.ADD_FAQ_MODAL=new sliderModal(a,n),casesSettings.CategoryModal.ADD_FAQ_MODAL.setCloseCallback((function(){casesSettings.CategoryModal.FAQ_EDITOR={},ZPeopleComponents.tokenfield($("#afaqtag")).destroy(),casesSettings.CategoryModal.ADD_FAQ_MODAL.remove()})),casesSettings.CategoryModal.ADD_FAQ_MODAL.save=ZPI18N.getString("zp.submit"),casesSettings.CategoryModal.ADD_FAQ_MODAL.construct(),$("#afaqquery").focus()},saveFAQ:function(e,t){var s=$("#afaqquery").val();$("#afaqquery").removeClass("ztextbox__error").siblings("span").remove();var i=$.trim($(casesSettings.CategoryModal.FAQ_EDITOR.iframe.contentDocument.body).html()),a=ZPeopleComponents.tokenfield($("#afaqtag")).getAllValues(),n="",l="",o=[];if($.each(a,(function(e,t){t.hasOwnProperty("newToken")&&t.newToken?l+=t.value+",":n+=t.id+","})),n=n.slice(0,-1),l=l.slice(0,-1),ZPUtil.Validation.isEmpty(s))casesSettings.CategoryModal.setErrorMsg($("#afaqquery"),ZPI18N.getString("zp.enterquery"));else{var c={categoryId:null!=t?t:casesSettings.CategoryModal.CURR_CGY_DATA.categoryId,answer:i,question:s};""!=n&&(c.tagsIds=n),""!=l&&(c.createTags=l),null!=e&&(c.faqId=e);var d=[];if($("#afilesAttach").find("div.zpl_DNI[name=fBox][fileid]").length>0&&$("#afilesAttach").find("div.zpl_DNI[name=fBox][fileid]").each((function(e,t){d.push($(this).attr("fileid"))})),c.deletedFileIds=d.join(","),$("#afilesAttach").find("div[name=fBox]:not(.zpl_DNI)").length>5)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxfileupload"));else if($("#afilesAttach").find("div[name=fBox]:not([fileid])").length>0){var r=new FormData;r.append("loginUserZUID",_ZUIDENRYPT),r.append("formId",0),r.append("tableName","P_HRCase_FAQ"),r.append("conreqcsr",csrfToken);var p=[],g=[],h=[];$("#afilesAttach").find("div[name=fBox]:not([fileid])").each((function(e){var t=$(this).data("uploadMode"),s=$(this).data("cloudUploadDoc"),i=$(this).data("WDUploadDoc"),a=$(this).data("caseFileUpload");"cloudUpload"==t?p.push(s):"localUpload"==t&&void 0!==a?h.push(a):"workDriveUpload"==t&&void 0!==i&&g.push(i)})),h.length>0&&(o=h,c.attachment=JSON.stringify(h)),p.length>0||g.length>0?(r.append("uploadFromCloud",JSON.stringify(p)),r.append("uploadFromWD",JSON.stringify(g)),r.append("attachment",JSON.stringify(h)),r.append("needJSONresponse",!0),$.ajax({url:"/fileUploadAction.zp",type:"POST",data:r,contentType:!1,processData:!1,cache:!1,error:function(e){var t=JSON.parse(e);ZPeople.Message.showFailureMsg(t.error)},success:function(s){var i=[];7e3==s.code&&$.each(s.message,(function(e,t){var s={filePath:t.filePath,fileName:t.fileName};null!=t.uploadSource?s.uploadSource=t.uploadSource:s.uploadSource=0,i.push(s)})),c.attachment=JSON.stringify($.merge(i,o)),casesSettings.CategoryModal.faqRequestCall(c,e,t)}})):casesSettings.CategoryModal.faqRequestCall(c,e,t)}else casesSettings.CategoryModal.faqRequestCall(c,e,t)}},faqRequestCall:function(e,t,s){var i=casesSettings.CategoryModal.getFAQParentDiv(),a=[];a.push(e);var n="/cases/faq/add",l={faqConf:JSON.stringify(a),mode:"addFaq"};if(window.location.hash.includes("resources")){n="/services/faq/add";var o=window.location.hash.split("/")[2],c=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==o.toLowerCase()}));l.serviceName=c[0].tabName}ZPeople.Request.send(n,l,(function(s){"success"==s.status?(i.find("#faqListing").children().length<=0&&(casesSettings.Common.removeEmptyData(i),i.find("#faqTable_btn").removeClass("zpl_DNI")),null!=t?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqeditsuccessmsg")),i.find('tr[faqId="'+t+'"]').find("td[name=fname]").html(ZSEC.Encoder.encodeForHTML(e.question))):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqsuccessmsg")),i.find("#faqListing").prepend(casesSettings.CategoryModal.faqTableRowsHtml(s.FAQLIST,e.categoryId))),casesSettings.CategoryModal.ADD_FAQ_MODAL.close(),casesSettings.CategoryModal.ADD_FAQ_MODAL.remove(),casesSettings.CategoryModal.ADD_FAQ_MODAL=void 0):ZPeople.Message.showFailureMsg(s.desc)}))}},casesSettings.Category={iconMenu:function(e,t,s){var i=[];$.each(ServiceIcons.ICONS_LIST,(function(e){"engagement"!=e&&i.push({iconClass:ServiceIcons.getIconClass(e)+" icn",itemValue:e,itemType:"default",customAttributes:{"data-iconName":e,"data-elemName":"serviceIcon"}})})),ZPeopleComponents.createMenu(e,i,{contentType:"icon-text",direction:"bottom",displayType:"callout",type:"list",columns:10,forElement:$(t),itemclick:e=>{$(e.detail.menuitem).addClass("zpl_sel").siblings().removeClass("zpl_sel"),e.detail.forElement.attr("class","sze70 zpl_ibg "+e.detail.iconClass).attr("iconValue",e.detail.itemValue),null!=s&&"function"==typeof s&&s(e.detail)},beforeshow:e=>{let t=e.detail.forElement.attr("iconValue"),s=e.detail.forElement.attr("initValue");null!=t&&""!=t.trim()||$(e.detail.element).find("[data-elemName=serviceIcon][data-iconName="+s+"]").addClass("zpl_sel").siblings().removeClass("zpl_sel")}}),$(t).off("click").on("click",(()=>{ZPeopleComponents.menu("#"+e).show()}))},addCategory:function(){var e='<div class="zpl_secn zpl_tac"><div class="text-center"><i title="'+ZPI18N.getString("zp.selecticon")+'" class="zpl_ibg PI_plus sze70" id="scgyIcon" keyname="icon" initvalue="star" iconvalue=""></i><div id="scgyIconMenu" class="zpl_svricclr zpl_drpdwn zpl_drpdwnic"></div></div></div>';e+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.categoryname")+'</label></div><div><input id="scgyname" autocomplete="off" type="text" class="ztextbox"></div>',e+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.description")+'</label></div><div><input type="text" autocomplete="off" id="scgydesc" class="ztextbox"></div></div>',e+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.applicablelocations")+'</label></div><select id="applLocDiv"></select></div>',e+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.agent")+'</label></div><select id="agentDiv"></select></div>';var t=new Tab("Add Category",(function(){$("#cardAddCategory").html('<div class="zpl_crd"><div class="zpl_crdcnt">'+e+"</div></div>");var t=casesSettings.CategoryModal.fetchLocations(new Array);ZPeopleComponents.tokenfield("#applLocDiv",{data:t,dataMapping:{text:"location",value:"locationId",id:"locationId"},dropdownList:{closeOnSelect:!1,height:300,checkedIcon:!0},values:[{locationId:"0",location:ZPI18N.getString("zp.alllocaction")}]}),$("#applLocDiv").off("ztokenfieldlistitemselect").on("ztokenfieldlistitemselect",(function(e,t){"0"!=t.listItemData.locationId?ZPeopleComponents.tokenfield($(this)).getValues(["0"]).length>0&&(ZPeopleComponents.tokenfield($(this)).removeTokens(["0"]),ZPeopleComponents.tokenfield($(this)).closeDropdownList()):(ZPeopleComponents.tokenfield($(this)).removeAllTokens(),ZPeopleComponents.tokenfield($(this)).closeDropdownList())})),casesSettings.Category.iconMenu("scgyIconMenu","#scgyIcon");var s={serverSearch:!0,cacheData:!0,isLabelHTMLEncoded:!0};s.dataSource={search:function(e){return new Promise((function(t,s){var i=null==e.query||""==e.query?"*":i;t({delay:20,results:EmployeeSearch.getEmpDeptGrpList(e.query,"HRCASES","HRCASES","FEEDS",!0),more:!1})}))},paginated:!0},s.placeholder=ZPI18N.getString("zp.select"),s.showSearchField=!0,s.dataMapping={text:"value",value:"id",id:"id",email:"email",groupLabel:"dataType",agenttype:"agenttype",image:"image",textIcon:"avatarText"},s.contentType="image-text",s.dropdownList={contentType:"image-text-desc",height:300,isTextHTMLEncoded:!0,loseOnSelect:!1,checkedIcon:!0,width:500},s.search={by:["value","email"]},s.maxAllowedValues=10,ZPeopleComponents.tokenfield($("#agentDiv"),s);var i={},a=ZPeople.getUserDetailsById(erecno);i.id=erecno,i.agenttype="1",i.dataType=ZPI18N.getString("zp.employee"),i.value=a.empid+" "+a.name,i.image=a.avatar,i.avatarText="",i.email=a.emailId,i.zuid=a.zuid;var n=[];n.push(i),ZPeopleComponents.tokenfield($("#agentDiv")).setAttribute("values",n),$("#agentDiv").attr("agenttype","1"),$("#agentDiv").off("ztokenfieldlistitemselect").on("ztokenfieldlistitemselect",(function(e,t){("2"==t.listItemData.agenttype||"3"==t.listItemData.agenttype||"1"==t.listItemData.agenttype&&null!=$("#agentDiv").attr("agenttype")&&"1"!=$("#agentDiv").attr("agenttype")&&"4"!=$("#agentDiv").attr("agenttype"))&&ZPeopleComponents.tokenfield($("#agentDiv")).removeAllTokens(),$("#agentDiv").attr("agenttype",t.listItemData.agenttype)}))}),(function(){casesSettings.Category.saveCategory()}));casesSettings.Permissions.POPUP_MODAL=new popupModal(ZPI18N.getString("zp.addcategory"),t),casesSettings.Permissions.POPUP_MODAL.setCloseCallback((function(e){ZPeopleComponents.tokenfield($("#applLocDiv")).destroy(),ZPeopleComponents.tokenfield($("#agentDiv")).destroy(),$("#scgyIconMenu").length>0&&(ZPeopleComponents.isComponent($("#scgyIconMenu"))&&ZPeopleComponents.menu("#scgyIconMenu").destroy(),$("#scgyIconMenu").remove()),e.remove()})),casesSettings.Permissions.POPUP_MODAL.save=ZPI18N.getString("zp.add"),casesSettings.Permissions.POPUP_MODAL.construct()},saveCategory:function(){var e=$("#scgyname").val(),t=$("#scgydesc").val(),s=casesSettings.Common.returnCommaSeparatedString(ZPeopleComponents.tokenfield($("#applLocDiv")).getAllValues(),"locationId"),i=ZPeopleComponents.tokenfield($("#agentDiv")).getAllValues(),a=i.length>1?"4":$("#agentDiv").attr("agenttype"),n="";i.forEach((e=>{n+=e.id,n+=","})),n=n.slice(0,-1);var l=!1;if($("#scgyname, #scgydesc").removeClass("ztextbox__error").siblings("span").remove(),$("#applLocDiv").siblings("div.ztokenfield").removeClass("ztextbox__error").siblings("span").remove(),$("#agentDiv").siblings("div.zselectbox").removeClass("ztextbox__error").siblings("span").remove(),l=casesSettings.CategoryModal.validateCategoryName($("#scgyname"),e)||l,l=casesSettings.CategoryModal.validateShortDescription($("#scgydesc"),t)||l,""==s&&(l=!0,casesSettings.CategoryModal.setErrorMsg($("#applLocDiv").siblings("div.ztokenfield"),ZPI18N.getString("zp.selectloc"))),""==n&&(l=!0,casesSettings.CategoryModal.setErrorMsg($("#agentDiv").siblings("div.zselectbox"),ZPI18N.getString("zp.selectagent"))),!l){var o={conreqcsr:csrfToken,methodName:"saveCatalog"},c={categoryName:e,categoryShortDescription:t,applicableLocations:s};c.categoryIcon=null!=$("#scgyIcon").attr("iconvalue")&&""!=$("#scgyIcon").attr("iconvalue")?$("#scgyIcon").attr("iconvalue"):$("#scgyIcon").attr("initvalue");var d={agentTypeId:a,agentValueId:n};c.agent=d,o.categoryParam=JSON.stringify(c),ZPeople.Request.sendAsyncPost("/cases/category/save",o,(function(e){if(CommonTemplates.saveComplete("saveCategory"),"success"==e.status){casesSettings.Permissions.POPUP_MODAL.close(),ZAlertBanner.show({message:ZPI18N.getString("zp.catalogsuccessmsg"),type:"success",hideDelay:3e3});var t={categoryIcon:c.categoryIcon,categoryId:e.categoryId,categoryName:ZSEC.Encoder.encodeForHTML(c.categoryName),categoryShortDescription:ZSEC.Encoder.encodeForHTML(c.categoryShortDescription),count:0,description:"",enable_moderation:!1,isEnabled:!1,isSubCategoryMandatory:!1,optionValue:Cases.CGY_LIST.adminListing[0].optionValue,prefixCase:"#",serviceId:"",subCategoryList:[],typeOthers:"0"};$("#admCgyList").append(casesSettings.categoryListRow(t)),Cases.CGY_LIST.adminListing.push(t),window.location.href="#settings/service/hrcase/categoryview-categoryid:"+e.categoryId}else e.hasOwnProperty("categoryName")?casesSettings.CategoryModal.setErrorMsg($("#scgyname"),e.desc):ZAlertBanner.show({message:e.desc,type:"error",hideDelay:3e3})}),{},(function(e,t){ZAlertBanner.show({message:ZPI18N.getString("zp.catalogunsuccessmsg"),type:"error",hideDelay:3e3})}))}},editCategory:function(e){var t=settingsPage.container;t.find("#editCgyModal").remove();var s={method:"fetchCategorySettings",categoryId:e,conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/cases/category/settings",s,(function(e){"failure"===e.status?t.find("#editCgyModal").find("[name=close]").trigger("click"):casesSettings.CategoryModal.showTabs(e)}))}},casesSettings.Utilities={CATEGORY_ID:"",CATEGORY_DATA:{},TEMP_ZCTF:[],TEMP_ZCSF:[],destroyZCAll:function(){casesSettings.Utilities.TEMP_ZCSF.length>0&&($.each(casesSettings.Utilities.TEMP_ZCSF,(function(e,t){ZPeopleComponents.select($(t)).destroy()})),casesSettings.Utilities.TEMP_ZCSF=[]),casesSettings.Utilities.TEMP_ZCTF.length>0&&($.each(casesSettings.Utilities.TEMP_ZCTF,(function(e,t){ZPeopleComponents.tokenfield(t).destroy()})),casesSettings.Utilities.TEMP_ZCTF=[])},init:function(){var e=window.location.hash.split("/")[2],t=$.grep(ZPServices.SERVICE_JSON,(function(t){return t.tabName.toLowerCase()==e.toLowerCase()}));(""==casesSettings.Utilities.CATEGORY_ID||""!=casesSettings.Utilities.CATEGORY_ID&&casesSettings.Utilities.CATEGORY_ID!=t[0].categoryid)&&(casesSettings.Utilities.CATEGORY_ID=t[0].categoryid,ZPeople.Request.sendAsyncPost("/services/resources/fetch",{serviceName:t[0].tabName},(function(e){casesSettings.Utilities.CATEGORY_DATA=e}))),-1!=window.location.href.indexOf("/hrhelpdesk")?casesSettings.Utilities.casesTab():-1!=window.location.href.indexOf("resources/knowledgebase")?casesSettings.Utilities.getReferencesPage(casesSettings.Utilities.CATEGORY_ID):-1!=window.location.href.indexOf("resources/faq")&&casesSettings.Utilities.getFAQPage(casesSettings.Utilities.CATEGORY_ID)},casesTab:function(){var e=settingsPage.container;casesSettings.Utilities.destroyZCAll(),e.find("#topSettMenu").remove();var t=$('<div class="zpl_rgtcnt"><div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.linkhelpdeskheader")+"</h4><p>"+ZPI18N.getString("zp.linkhelpdeskdesc")+'</p> <div class="zpl_hdcnt"><div class="zpl_tgl"><input id="enbCasesInp" />'+ZPI18N.getString("zp.includeascategory")+"</div></div></div></div></div></div>");t.find(".zpl_crd").append('<div class="zpl_crdcnt zpl_DNI" name="agntSec"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.agent")+'</h5></div><div id="selAgnt"></div><div><p><a onclick="casesSettings.Category.editCategory(\''+casesSettings.Utilities.CATEGORY_ID+"')\">"+ZPI18N.getString("zp.configurecategory")+"</a></p></div></div></div>"),t.find(".zpl_crdhdr").append('<div name="btnDiv" class="zpl_DNI"><button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="casesSettings.Utilities.enableDisableCases()">'+ZPI18N.getString("zp.save")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick = "casesSettings.Utilities.cancelChanges()">'+ZPI18N.getString("zp.cancel")+"</button></div>"),e.empty().append(t),casesSettings.Utilities.setUtilitiesPage(casesSettings.Utilities.CATEGORY_DATA)},setUtilitiesPage:function(e){var t=settingsPage.container,s=(EmployeeSearch.getEmpDeptGrpList("","HRCASES","HRCASES","FEEDS",!0),{showSearchField:!0});if(s.dataSource={search:function(e){return new Promise((function(t,s){t({delay:20,results:EmployeeSearch.getEmpDeptGrpList(e.query,"HRCASES","HRCASES","FEEDS",!0),more:!1})}))},paginated:!0},s.placeholder=ZPI18N.getString("zp.select"),s.isLabelHTMLEncoded=!0,s.serverSearch=!0,s.cacheData=!0,s.multiple=!1,s.dataMapping={value:"id",label:"value",image:"image",textIcon:"avatarText",informativeText:"email",optgroupLabel:"dataType"},s.contentType="image-text",s.dropdownList={contentType:"image-text-desc",height:300,isTextHTMLEncoded:!0},s.search={by:["value","email"]},s.clearButton=!0,s.width=300,s.change=function(e,s){""!=s.value?t.find("[name=btnDiv]").removeClass("zpl_DNI"):t.find("[name=btnDiv]").addClass("zpl_DNI")},ZPeopleComponents.select(t.find("#selAgnt"),s),t.find("#selAgnt").off("zselectoptionclick").on("zselectoptionclick",(function(e,s){t.find("#selAgnt").attr("agenttype",s.optionData.agenttype)})),e.hasOwnProperty("agentDetails")&&e.agentDetails.hasOwnProperty("agentValueId")){var i=e.agentDetails,a={};a.id=i.agentValueId,a.agenttype=i.agentTypeId,a.dataType="1"==i.agentTypeId?ZPI18N.getString("zp.employee"):"2"==i.agentTypeId?ZPI18N.getString("zp.department"):ZPI18N.getString("zp.group"),a.value=i.owner,"1"==i.agentTypeId&&null!=i.employeeDetails&&(a.image=i.employeeDetails.employeePhoto,a.imageAlt="",a.email=i.employeeDetails.employeeEmailAlias),ZPeopleComponents.select(t.find("#selAgnt")).setValue(a),$("#selAgnt").attr("agenttype",i.agentTypeId)}ZPeopleComponents.toggleswitch(t.find("#enbCasesInp"),{on:e.enable_hrcase,change:function(e,s){(e.stopPropagation(),s.state)?(t.find("[name=agntSec]").removeClass("zpl_DNI"),""!=ZPeopleComponents.select(t.find("#selAgnt")).getValue()?t.find("[name=btnDiv]").removeClass("zpl_DNI"):t.find("[name=btnDiv]").addClass("zpl_DNI")):(t.find("[name=agntSec]").addClass("zpl_DNI"),t.find("[name=btnDiv]").removeClass("zpl_DNI"))}}),e.enable_hrcase?(ZPeopleComponents.toggleswitch(t.find("#enbCasesInp")).switchOn(),t.find("[name=agntSec]").removeClass("zpl_DNI")):(ZPeopleComponents.toggleswitch(t.find("#enbCasesInp")).switchOff(),t.find("[name=agntSec]").addClass("zpl_DNI")),t.find("[name=btnDiv]").addClass("zpl_DNI"),casesSettings.Utilities.TEMP_ZCTF.push(t.find("#enbCasesInp")),casesSettings.Utilities.TEMP_ZCSF.push(t.find("#selAgnt"))},enableDisableCases:function(){var e=settingsPage.container,t=!1,s={categoryId:casesSettings.Utilities.CATEGORY_ID},i=ZPeopleComponents.toggleswitch(e.find("#enbCasesInp")).getState();if(s.enableHRCase=i,i){var a=ZPeopleComponents.select(e.find("#selAgnt")).getValue(),n=e.find("#selAgnt").attr("agenttype");""!=a?(e.find("#selAgnt").siblings("div.zselectbox").removeClass("ztextbox__error").siblings("span").remove(),s.categoryAgent=JSON.stringify({agentTypeId:n,agentValueId:a})):(t=!0,casesSettings.CategoryModal.setErrorMsg(e.find("#selAgnt").siblings("div.zselectbox"),ZPI18N.getString("zp.selectagent")))}t||ZPeople.Request.send("/cases/service/enable",s,(function(t){if("success"==t.status){if(e.find("[name=btnDiv]").addClass("zpl_DNI"),casesSettings.Utilities.CATEGORY_DATA.enable_hrcase=s.enableHRCase,s.enableHRCase){JSON.parse(s.categoryAgent);casesSettings.Utilities.CATEGORY_DATA.agentDetails=t.agentDetails}ZPeople.Message.showSuccessMsg(t.desc)}else ZPeople.Message.showFailureMsg(t.desc)}))},cancelChanges:function(){casesSettings.Utilities.setUtilitiesPage(casesSettings.Utilities.CATEGORY_DATA)},getReferencesPage:function(e){settingsPage.container.find("#topSettMenu").remove(),settingsPage.container.attr("name","UtilitiesRefDiv"),casesSettings.CategoryModal.showReferences(casesSettings.Utilities.CATEGORY_DATA.assoContents)},getFAQPage:function(e){settingsPage.container.find("#topSettMenu").remove(),settingsPage.container.attr("name","UtilitiesFAQDiv"),casesSettings.CategoryModal.showFAQs(e)}},casesSettings.Permissions={EXISTING_ADMIN:[],init:function(){settingsPage.container.find("div.zpl_rgtcnt").length<=0&&(settingsPage.container.html('<div class="zpl_btnmnu"><div>'+ZPI18N.getString("zp.hrhelpdeskadmintext")+'</div><div class="zpl_rgt"><button onclick="casesSettings.Permissions.addCasesAdmin()" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.addcasesadmin")+"</button></div></div>"),ZPeople.Request.send("/cases/admin/list",{conreqcsr:csrfToken,method:"fetchCasesAdminList"},(function(e){var t="";if(e.length>0){var s="";$.each(e,(function(e,t){casesSettings.Permissions.EXISTING_ADMIN.push(t.userId),s+=casesSettings.Permissions.casesAdminRow(t)})),t='<table class="zpl_tbl" role="grid"><thead><tr tabIndex = "1"><th>'+ZPI18N.getString("zp.name")+'</th><th width = "80"></th></tr></thead><tbody id="adminTableBody">'+s+"</tbody></table>"}var i='<div class="zpl_rgtcnt"><div class="zpl_tblres">'+t+"</div></div>";settingsPage.container.append(i)})))},casesAdminRow:function(e){var t=e.allowEditDelete?'<i title = "'+ZPI18N.getString("zp.delete")+'" onclick="casesSettings.Permissions.deleteAdmin(this)" class="PI_delete"></i>':"";return'<tr id="'+e.userId+'"><td><div class="zpl_em"><div class="zpl_emimg"><img src="'+e.userDetails.employeePhoto+'"></div><div class="zpl_emdts"><div><em>'+e.userDetails.empid+" - </em><b>"+e.userDetails.name+'</b></div></div></div></td><td><div><div class="zpl_hvr">'+t+"</div></div></td>"},addCasesAdmin:function(){var e=settingsPage.container,t=new Tab("Add Cases Admin",(function(){var e=casesSettings.CategoryModal.selectDivBoxHtml(ZPI18N.getString("zp.name"),"acasesadmin","",!0);$("#cardAddCasesAdmin").html('<div class="zpl_crd"><div class="zpl_crdcnt">'+e+"</div></div>");EmployeeSearch.getEmpList("*","emp","HRCASES_MODULEADMIN",casesSettings.Permissions.EXISTING_ADMIN,{},!1,[],!1,!0);var t={showSearchField:!0};t.dataSource={search:function(e){return new Promise((function(t,s){var i=null==e.query||""==e.query?"*":i;t({delay:20,results:EmployeeSearch.getEmpList(i,"emp","HRCASES_MODULEADMIN",casesSettings.Permissions.EXISTING_ADMIN,{},!1,[],!1,!0),more:!1})}))},paginated:!0},t.placeholder=ZPI18N.getString("zp.typeinaname"),t.isLabelHTMLEncoded=!0,t.serverSearch=!0,t.cacheData=!0,t.dataMapping={value:"id",label:"value",image:"image"},t.contentType="image-text",t.dropdownList={contentType:"image-text",height:300,isTextHTMLEncoded:!0},t.search={by:["value","email"]},ZPeopleComponents.select($("#acasesadmin"),t)}),(function(){var t=ZPeopleComponents.select($("#acasesadmin")).getValue();if(!ZPUtil.Validation.isEmpty(t)){var s={method:"saveCasesAdmin",conreqcsr:csrfToken,erecno:t};ZPeople.Request.send("/cases/admin/save",s,(function(s){if(s.hasOwnProperty("status")&&"success"==s.status){e.find("#adminTableBody").find(".ZPNdata").remove(),-1==casesSettings.Permissions.EXISTING_ADMIN.indexOf(t)&&casesSettings.Permissions.EXISTING_ADMIN.push(t);var i=t!=erecno,a=ZPeopleComponents.select("#acasesadmin")._selected[0].optData,n=a.label,l={userId:t,allowEditDelete:i,userDetails:{employeePhoto:a.image,empid:a.label.split(" ")[0],name:ZSEC.Encoder.encodeForHTML(n.substring(n.indexOf(" ")+1))}},o=casesSettings.Permissions.casesAdminRow(l);e.find('tr[id="'+t+'"]').length>0?e.find('tr[id="'+t+'"]').replaceWith(o):e.find("#adminTableBody").append(o),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.casesadminadded")),ZPeopleComponents.select($("#acasesadmin")).destroy(),casesSettings.Permissions.POPUP_MODAL.remove()}else ZPeople.Message.showFailureMsg(s.desc)}))}}));casesSettings.Permissions.POPUP_MODAL=new popupModal(ZPI18N.getString("zp.addcasesadmin"),t),casesSettings.Permissions.POPUP_MODAL.setCloseCallback((function(){ZPeopleComponents.select($("#acasesadmin")).destroy(),casesSettings.Permissions.POPUP_MODAL.remove()})),casesSettings.Permissions.POPUP_MODAL.construct()},deleteAdmin:function(e){var t=settingsPage.container,s=$(e).closest("tr").attr("id"),i=new DeleteAlertMessage(ZPI18N.getString("zp.removecasesadmin"),ZPI18N.getString("zp.hrhelpdeskadmindeltext"));i.callback=function(){ZPeople.Request.send("/cases/admin/delete",{conreqcsr:csrfToken,method:"deleteCasesAdmin",erecno:s},(function(e){"success"==e.status?(t.find("#adminTableBody").find('tr[id="'+s+'"]').remove(),$.each(casesSettings.Permissions.EXISTING_ADMIN,(function(e,t){t==s&&delete casesSettings.Permissions.EXISTING_ADMIN[e]})),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.casesadminremoved")),t.find("#adminTableBody").find("tr").length<=0&&t.find("#adminTableBody").html(CommonTemplates.noDataSVG("adminTableBody",!0,"No cases admins added"))):ZPeople.Message.showFailureMsg(e.desc)}))},i.yesButtonText=ZPI18N.getString("zp.confirm"),i.cancelCallback=function(e){e.close(),e.remove()},i.show()}},casesSettings.Restrictions={init:function(){var e=settingsPage.container;if(e.find("div.zpl_rgtcnt").length<=0){var t='<div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" id="isReopenCheck"/>'+ZPI18N.getString("zp.enablereopenheading")+"</h5> <p>"+ZPI18N.getString("zp.enablereopendesp")+"</p></div></div>";t+='<div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" id="isRestrictCmt"/>'+ZPI18N.getString("zp.restrictcasecmt")+"</h5> <p>"+ZPI18N.getString("zp.restrictcasecmtdesc")+"</p></div></div>",t+='<div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" id="isMandateDesc"/>'+ZPI18N.getString("zp.mandatecasesdesc")+"</h5> <p>"+ZPI18N.getString("zp.mandatecasesdescstt")+"</p></div></div>",e.append('<div class="zpl_rgtcnt"><div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.leavetype.v2.restrictions")+'</h4></div></div><div class="zpl_crdcnt">'+t+"</div></div></div>"),casesSettings.Components.destroy_zctglf(),ZPeople.Request.send("/cases/settings",{method:"fetchCasesSettings"},(function(t){$.each(t,(function(t,s){switch(s.settingName){case"RESTRICT_REOPEN":ZPeopleComponents.toggleswitch(e.find("#isReopenCheck"),{on:s.isEnabled,change:function(e,t){e.stopPropagation(),casesSettings.Restrictions.disableReopenConfirmationPopup(t.state)}}),casesSettings.Components.ZCTGLF.push(ZPeopleComponents.toggleswitch(e.find("#isReopenCheck")));break;case"RESTRICT_COMMENT_CLOSEDCASES":ZPeopleComponents.toggleswitch(e.find("#isRestrictCmt"),{on:s.isEnabled,change:function(e,t){e.stopPropagation(),casesSettings.Restrictions.restrictComments(t.state)}}),casesSettings.Components.ZCTGLF.push(ZPeopleComponents.toggleswitch(e.find("#isRestrictCmt")));break;case"MANDATE_DESCRIPTION":ZPeopleComponents.toggleswitch(e.find("#isMandateDesc"),{on:s.isEnabled,change:function(e,t){e.stopPropagation(),casesSettings.Restrictions.mandateDescription(t.state)}}),casesSettings.Components.ZCTGLF.push(ZPeopleComponents.toggleswitch(e.find("#isMandateDesc")))}}))}))}},disableReopenConfirmationPopup:function(e){ZPeople.Request.send("/cases/reopen/disable",{isDisable:e,method:"disableReopenStatusAction"},(function(t){if("failure"==t.status)ZAlertBanner.show({message:ZPI18N.getString("zp.reopenerror"),type:"error",hideDelay:3e3});else{var s=e?ZPI18N.getString("zp.enablesuccessful"):ZPI18N.getString("zp.disablesuccessful");ZAlertBanner.show({message:s,type:"success",hideDelay:3e3})}}))},restrictComments:function(e){ZPeople.Request.send("/cases/comment/restrict",{isEnabled:e,method:"restrictComments"},(function(t){if("failure"==t.status)ZAlertBanner.show({message:"Failed to update settings. Please try again later.",type:"error",hideDelay:3e3});else{var s=e?ZPI18N.getString("zp.enablesuccessful"):ZPI18N.getString("zp.disablesuccessful");ZAlertBanner.show({message:s,type:"success",hideDelay:3e3})}}))},mandateDescription:function(e){ZPeople.Request.send("/cases/description/mandate",{isEnabled:e,method:"mandateDescription"},(function(t){if("failure"==t.status)ZAlertBanner.show({message:"Failed to update settings. Please try again later.",type:"error",hideDelay:3e3});else{var s=e?ZPI18N.getString("zp.enablesuccessful"):ZPI18N.getString("zp.disablesuccessful");ZAlertBanner.show({message:s,type:"success",hideDelay:3e3})}}))}},casesSettings.CustomStatus={init:function(){-1!=settingsUrlProps.niceUrl.indexOf("settings/service/hrcase/customizestatus")&&casesSettings.CustomStatus.customizeStatus(),-1!=settingsUrlProps.niceUrl.indexOf("settings/service/hrcase/customizerequest")&&casesSettings.CustomStatus.customizeRequest()},showEdit:function(e,t){t.stopPropagation(),t.preventDefault();var s=$(e).closest("li"),i=s.find("span[name=optionVal]").text();s.find("span[name=optionVal]").addClass("DN"),s.find("input[name=optionVal]").val(i),s.find("input[name=optionVal]").removeClass("DN"),s.find("button.PI_edt").addClass("DN"),s.find("button.PI_tick, button.PI_cls").removeClass("DN");let a=$(e).closest("li").attr("id").split("-")[1];$('div[optionId="'+a+'"]').find("input").on("keydown",(function(t){13==t.which?e.getAttribute("onclick").toLowerCase().includes("status")?casesSettings.CustomStatus.saveEdit(e,t,"status"):casesSettings.CustomStatus.saveEdit(e,t,"source"):27==t.which&&casesSettings.CustomStatus.closeEdit(e,t)}))},closeEdit:function(e,t){t.stopPropagation(),t.preventDefault();var s=$(e).closest("li");s.find("input[name=optionVal]").addClass("DN"),s.find("span[name=optionVal]").removeClass("DN"),s.find("button.PI_edt").removeClass("DN"),s.find("button.PI_tick, button.PI_cls").addClass("DN")},saveEdit:function(e,t,s){t.stopPropagation(),t.preventDefault();var i=$(e).closest("li"),a="",n=i.find("div[optionid]").attr("optionid"),l=i.find("input[name=optionVal]").val(),o={recordId:n,text:l.trim()},c={};"source"==s?(c.method="editSource",c.customsourcejson=JSON.stringify(o),a="/cases/source/edit"):"status"==s&&(c.method="editStatus",c.customstatusjson=JSON.stringify(o),a="/cases/status/edit");var d=casesSettings.CustomStatus.validateText(l,n,s);""==d?ZPeople.Request.sendAsyncPost(a,c,(function(e){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),i.find("input[name=optionVal]").addClass("DN"),i.find("span[name=optionVal]").html(ZSEC.Encoder.encodeForHTML(l)).removeClass("DN"),i.find("button.PI_edt").removeClass("DN"),i.find("button.PI_tick, button.PI_cls").addClass("DN")})):ZPeople.Message.showFailureMsg(d)},validateText:function(e,t,s){var i=e.trim(),a="";if(""==i||i.length>15){if(a="source"==s?ZPI18N.getString("zp.casesourceempty"):ZPI18N.getString("zp.statusempty"),i.length>15){var n="source"==s?"zp.casesourcelength":"zp.casestatuslength";a=ZPI18N.getString(n,new Array("15"))}}else $("#"+("status"==s?"customStatus":"customSource")).find("li").each((function(){if($(this).find("div[optionid]").attr("optionid")!=t){var e=$(this).find("span[name=optionVal]").text();i==e&&(a="source"==s?ZPI18N.getString("zp.sourcereqavailable"):ZPI18N.getString("zp.statusavailable"))}}));return a},getListTemplate:function(e,t){return'<div class="zlistbox__content" optionId="'+e.optionId+'"><span class="zlistbox__text" name="optionVal">'+e.optionValue+'</span><input name="optionVal" autocomplete="off" class="ztextbox DN" value="'+e.optionValue+'"/></div><div class="zlistbox__actions"><button tabindex="-1" onclick="casesSettings.CustomStatus.showEdit(this,event)" title="Edit" class="zlistbox__action PI_edt "><i class="zlistbox__icon"></i></button><button tabindex="-1" title="'+ZPI18N.getString("zp.save")+'" class="zlistbox__action PI_tick DN" onclick="casesSettings.CustomStatus.saveEdit(this,event,\''+t+'\')"><i class="zlistbox__icon"></i></button><button tabindex="-1" title="'+ZPI18N.getString("zp.cancel")+'" class="zlistbox__action PI_cls DN" onclick="casesSettings.CustomStatus.closeEdit(this,event)"><i class="zlistbox__icon"></i></button></div>'},customizeStatus:function(){var e=settingsPage.container;e.find("div.zpl_rgtcnt").length<=0&&ZPeople.Request.send("/cases/status/details",{},(function(t){e.append('<div class="zpl_rgtcnt"><div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.casestatus")+'</h4></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.reordercasesstatus")+'</h5></div><div><div class="zpl_gbox"><div id="customStatus"></div></div></div></div></div></div></div>');var s={contentType:"custom",dropdownList:{contentType:"custom"},template:function(e){return casesSettings.CustomStatus.getListTemplate(e,"status")},items:t.statusList,width:350,dataMapping:{text:"optionValue",value:"optionId"},reorderable:!0};e.find("#customStatus").zlistbox(s),e.find("#customStatus").on("zsortablechange",(function(e,t){ZPeople.Request.sendAsyncPost("/cases/status/reorder",{statusOrderList:casesSettings.CustomStatus.fetchIdsinOrder("customStatus")},(function(e){"success"==e.status&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.statusrearrngesuc"))}))}))}))},customizeRequest:function(){var e=settingsPage.container;e.find("div.zpl_rgtcnt").length<=0&&ZPeople.Request.send("/cases/source/request",{},(function(t){e.append('<div class="zpl_rgtcnt"><div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.sourceofrequest")+'</h4></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.reordersourceofreq")+'</h5></div><div><div class="zpl_gbox"><div id="customSource"></div></div></div></div></div></div>'),listOptions={contentType:"custom",dropdownList:{contentType:"custom"},template:function(e){return casesSettings.CustomStatus.getListTemplate(e,"source")},items:t,width:350,dataMapping:{text:"optionValue",value:"optionId"},reorderable:!0},ZPeopleComponents.listbox("#customSource",listOptions),e.find("#customSource").on("zsortablechange",(function(e,t){ZPeople.Request.sendAsyncPost("/cases/source/reorder",{method:"reorderRequestSource",sourceOrderList:casesSettings.CustomStatus.fetchIdsinOrder("customSource")},(function(e){"success"==e.status&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.sourcerearrngesuc"))}))}))}))},fetchIdsinOrder:function(e){var t=settingsPage.container,s="";return t.find("#"+e).find("li").each((function(e){s+=$(this).attr("aria-value")+","})),s=s.slice(0,-1)}};var CasesOperationSettings={categoryDetailedView:function(){var e=settingsUrlProps.urlParamsArr.categoryid;"operations/hrcase/category/view"==settingsUrlProps.niceUrl&&(Cases.isCaseAdmin(e)||Cases.isCaseAdmin())?CasesOperationSettings.fetchCategoryDetails(e):CasesOperationSettings.fetchFaqDetails(e)},validateUrl:function(){return Cases.validateUrl()},fetchCategoryDetails:function(e){var t=settingsPage.container;t.find("#editCgyModal").remove();var s={method:"fetchCategorySettings",categoryId:e,conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/cases/category/settings",s,(function(e){"failure"===e.status?t.find("#editCgyModal").find("[name=close]").trigger("click"):casesSettings.CategoryModal.showTabs(e)}))},fetchFaqDetails:function(e){var t=new Tab("FAQs",(function(){$("#fullModFooter").find("#saveBtn, #cancelButton").addClass("zpl_DNI"),casesSettings.CategoryModal.MODAL.madeChanges=!1,casesSettings.CategoryModal.showFAQs(e)}));t.name=ZPI18N.getString("zp.faqs"),casesSettings.CategoryModal.MODAL=new fullPageModal("Edit Category",t),casesSettings.CategoryModal.MODAL.construct(0),casesSettings.CategoryModal.MODAL.modalDiv.find(".zpl_mhder h4").html(ZPI18N.getString("zp.editcat")),ZPeopleComponents.tooltip("#cardRightDiv"),casesSettings.CategoryModal.MODAL.cancelCallBack=function(e){casesSettings.Components.destroy_zc_all(),null!=ZPeopleComponents.select($("#ecgyadmin"))&&ZPeopleComponents.select($("#ecgyadmin")).destroy(),-1!=window.location.hash.indexOf("hrcase/categoryview")?window.location.href="#settings/service/hrcase/categorylist":-1!=window.location.hash.indexOf("hrcase/category/view")&&(window.location.href="#operations/hrcase/category"),ZPeopleComponents.tooltip("#cardRightDiv").destroy(),e.remove()},casesSettings.CategoryModal.MODAL.open()}},REQ_TYPE_IMPORT="caseimport";class CasesData{constructor(){this.STATUS={},this.PRIORITY={},this.ALLPRIORITY={},this.SOURCE={},this.CASETYPE={},this.ISCASEADMIN=void 0,this.CATEGORYADMINDATA={},this.caseFormId="",this.userCgyData=[],this.SUBCGY_LISTING="subCategoryListing",this.USER_CGY_LISTING="userListing",this.ADMIN_CGY_LISTING="adminListing",this.AGENT_CGY_LISTING="agentListing",this.CGYADMIN_AGENT_CGY_LISTING="categoryAdminAndAgentListing",this.CATEGORY_LIST=[],this.USERVIEW_CATEGORY_LIST=[],this.ADMINVIEW_CATEGORY_LIST=[],this.AGENTVIEW_CGY_LIST=[],this.CGYADMIN_AGENT_CGY_LIST=[],this.SUBCATEGORY_LIST={},this.agentCgyIds=[],this.AgentAddMode="AGENT",this.ManagerAddMode="MANAGER",this.myCaseObj=void 0,this.openCaseObj=void 0,this.escalationObj=void 0,this.unAssignedObj=void 0,this.myReqObj=void 0,this.allCaseObj=void 0,this.watchlistObj=void 0,this.unManagedObj=void 0,this.casesMySpaceObj=void 0,this.casesUserCgyObj=void 0,this.faqListObj=void 0,this.addCaseObj=void 0,this.caseViewObj=void 0,this.OPEN_SID="1",this.INPROGRESS_SID="2",this.AWAITING_SID="3",this.ONHOLD_SID="4",this.COMPLETED_SID="5",this.CANCELLED_SID="6",this.HIGH_SID="12",this.MEDIUM_SID="11",this.LOW_SID="10",this.WEB_SID="1",this.CHAT_SID="2",this.INPERSON_SID="3",this.EAMIL_SID="4",this.PHONE_SID="5",this.HIGH_SID="12",this.MEDIUM_SID="11",this.LOW_SID="10"}}var casesObj=new CasesData;class CasesListing{constructor(e,t,s){e.attr("scroll","enabled"),e.addClass("zpl_tblfxd"),this.$pageDiv=e,this.errorMsg=s,this.urlMode=t,this.isBulkSelect=!1,this.isBulkSelectDiv="",this.isAgentDivNeeded=!0,this.isAgentDiv='<th width="150">'+ZPI18N.getString("zp.assignedto")+"</th>",this.isDeleteButton=!1,this.delIconDiv="",this._clsBulkBton="",this._delBulkBton="",this._picBulkBton="",this.bulkSelect=void 0,this.deleteCase=void 0,this.moreBtn='<i name="moremnu" class="zpl_ibg PI_more" aria-label="More" role="button" aria-haspopup="menu" tabindex="0"></i>',this.importReq=!1,this.exportReq=!0,this.fltrBtn='<i id="fltrIc" role="button" aria-label="Filter" aria-haspopup=true tabindex="0" class="zpl_ibg PI_fltr"></i>',t!=REQ_TYPE_MYCASES&&t!=REQ_TYPE_UNASSIGNCASES&&t!=REQ_TYPE_ALLCASES||(this.isBulkSelect=!0,this.isBulkSelectDiv='<th width="w60"> <div class="zcheckbox"> <input type="checkbox" value="" class="zcheckbox__helper"> <label id="cseChkAll" class="zcheckbox__label"></label> </div> </th>',t!=REQ_TYPE_MYCASES&&t!=REQ_TYPE_ALLCASES||(this._clsBulkBton='<button name="close" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.close")+"</button>"),t==REQ_TYPE_UNASSIGNCASES&&(this._picBulkBton='<button name="pickup" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.pickupcase")+"</button>",this.fltrBtn="")),t!=REQ_TYPE_MYREQUEST&&t!=REQ_TYPE_MYCASES&&t!=REQ_TYPE_UNMANAGED&&t!=REQ_TYPE_IMPORT||(this.isAgentDiv="",this.isAgentDivNeeded=!1),casesObj.ISCASEADMIN&&t==REQ_TYPE_ALLCASES&&(this.isDeleteButton=!0,this.importReq=!0,this.delIconDiv='<th width="80"></th>',this._delBulkBton='<button name="delete" class="zlabel zlabel--red zlabel--medium">'+ZPI18N.getString("zp.delete")+"</button>"),this.caseListRows=""}setListData(e){this.listData=e}constructListingPageHeader(){return'<div id="btnMnu" class="zpl_btnmnu"><div class="zpl_rgt">'+this.moreBtn+this.fltrBtn+"</div></div>"+'<div id="fltrOpt" class="zpl_fltrvw DNI"><div><ul id="filterOptMne" class="zpl_fltrvwlst"></ul></div><div id="clearAllFilter" class="d-flexcap MLauto"><a class="red">Clear all</a></div></div>'}constructListHeader(){return'<thead> <tr tabIndex = "1">'+this.isBulkSelectDiv+"<th>"+ZPI18N.getString("zp.casedetails")+' </th> <th id="cgyHead">'+ZPI18N.getString("zp.category")+"</th> <th>"+ZPI18N.getString("zp.status")+"</th> "+this.isAgentDiv+this.delIconDiv+"</tr> </thead>"}constructListBody(){return'<tbody id="caseListBdy"></tbody>'}constructListingOuter(){return'<div id="casesRgt" class="zpl_rgtcnt"><div class="zpl_tblres"><table id="casesLstgTble" class="zpl_tbl" role="grid" aria-label="Proceeding to cases list">'+this.constructListHeader()+this.constructListBody()+"</table></div></div>"}construct(){this.checkConstructPage(),this.constructListing(this.listData.hrcaseList),this.triggerEventList()}checkConstructPage(){let e="";switch(this.$pageDiv.attr("id")){case"hrcase-myrequest-list":e="You have selected My Requests tab within Cases service";break;case"hrcase-watchlist-list":e="Here you can follow up on cases where you have been mentioned"}this.$pageDiv.attr("aria-label",e),this.$pageDiv.attr("role","tablist"),this.$pageDiv.attr("tabindex","0"),0==this.$pageDiv.find("#casesRgt").length&&0!=this.listData.hrcaseList.length&&(this.removeEmptyCasePage(),this.$pageDiv.children().removeClass("DNI"),this.$pageDiv.append(this.constructListingPageHeader()),this.moreMenuObj=new caseImportExport(this),this.moreMenuObj.constructMoreMenu(),this.$pageDiv.append(this.constructListingOuter()),this.$caseListbdyHead=this.$pageDiv.find("thead"),this.$btnMnuDiv=this.$pageDiv.find("#btnMnu"),this.$caselistBdy=this.$pageDiv.find("#caseListBdy"),this.statusHeadObj=new StatusHeader(this),this.statusHeadObj.constructStatus())}constructListing(e){if(0!=e.length){this.removeEmptyCasePage(),this.caseListRows="";let t=!1;for(let s=0;s<e.length;s++){let i=e[s],a=new caseListRow(i,this.urlMode).constructRow();this.caseListRows+=a,t&&(t=!1,a.find("#cgyDiv").attr("scope","row"),a.find("#statusDiv").attr("scope","row"))}this.$caselistBdy.append(this.caseListRows),this.$caselistBdy.find(".d-flexC > span:last-child").remove()}else this.showEmptyCasePage()}emptyListing(){this.$caselistBdy.empty()}triggerEventList(){this.deleteCase0=new DeleteCase(this),this.assignCase0=new AssignCase(this),this.bulkSelect0=new BulkSelect(this),this.showAttachment=new ShowAttatchments(this),this.showAttachment.constructAttachmentList(),this.assignCase0.listen(),this.bulkSelect0.listen(),this.deleteCase0.listen(),this.statusHeadObj.listen(),this.moreMenuObj.listen(),this.filterOptions.listen(),this.listen()}listen(){let e=this;this.$caselistBdy.on("click",'tr[name="caseRow"]',(function(t){e.listData.isFiltered?window.location.href=CommonMethod.getParentURL()+"/filter-caseid:"+$(this).attr("caseId"):window.location.href=CommonMethod.getParentURL()+"/view-caseid:"+$(this).attr("caseId")}))}showEmptyCasePage(){let e=0==this.$pageDiv.find("#casesRgt").length?this.$pageDiv:this.$pageDiv.find("#casesRgt"),t=ZPI18N.getString("zp.noallcases");1===this.filterOptions.status.length?t=ZPI18N.getString("zp.nofilteredcases"):this.urlMode===REQ_TYPE_MYREQUEST&&(t=ZPI18N.getString("zp.norequestedcases")),0==e.find("#emptPage").length&&(e.children().addClass("zpl_DNI"),e.append('<div id="emptPage" class="zpl_crd wd100_per"><div class="zpl_crdcnt"><div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_cases"></div><h4>'+t+"</h4><p></p></div></div></div></div>")),this.addEmptyPageListen()}addEmptyPageListen(){this.$pageDiv.find('a[name="nodataReq"]').off().on("click",(function(){window.location.href="#hrcase/home"}))}removeEmptyCasePage(){(0==this.$pageDiv.find("#casesRgt").length?this.$pageDiv:this.$pageDiv.find("#casesRgt")).children().removeClass("zpl_DNI"),this.$pageDiv.find("#emptPage").remove()}}class caseListRow{constructor(e,t){this.listRow=e,this.urlMode=t,this.SelectDiv="",t!=REQ_TYPE_MYCASES&&t!=REQ_TYPE_UNASSIGNCASES&&t!=REQ_TYPE_ALLCASES||(this.SelectDiv='<td> <div class="zcheckbox"> <input type="checkbox" class="zcheckbox__helper"> <label name="selChkBx" class="zcheckbox__label"></label> </div> </td>'),t!=REQ_TYPE_MYREQUEST&&t!=REQ_TYPE_MYCASES&&t!=REQ_TYPE_UNMANAGED&&t!=REQ_TYPE_IMPORT?e.hasOwnProperty("agent")&&null!=e.agent.name?this.isAgentDiv='<td> <div class="zpl_em"> <div class="zpl_emimg"> <img src="'+e.agent.employeePhoto+'"> </div> </div> </td>':e.hasOwnProperty("agent")?this.isAgentDiv='<td><div id="cseAssignTo" class="zpl_hvr zpl_hvrsw FL"><span class="PI_expentitle icn"></span></div><div id="assignToList" style="display: none;"></div></td>':this.isAgentDiv='<td><div class="zpl_hvr zpl_hvrsw FL"><span class="PI_Approval-pending icn"></span></div></td>':this.isAgentDiv="",casesObj.ISCASEADMIN&&t==REQ_TYPE_ALLCASES&&(this.delIconDiv='<td><div id="delCase" class="zpl_hvr"><i class="PI_delete"></i></div></td>'),this.requestorNameA="<a>"+e.requestor.name+'</a><span class="zpl_dots"></span>',this.reqPhotoDiv='<img src="'+e.requestor.employeePhoto+'">',t==REQ_TYPE_MYREQUEST&&(e.hasOwnProperty("agent")?e.agent.hasOwnProperty("name")?(this.reqPhotoDiv='<img src="'+e.agent.employeePhoto+'">',this.requestorNameA="<a>"+e.agent.name+'</a><span class="zpl_dots"></span>'):(this.reqPhotoDiv='<span class="zpl_pichr PC2">'+ZSEC.Encoder.encodeForHTML(CommonTemplates.getAltText(ZPeople.decodeTxt(e.agent.details)))+"</span>",this.requestorNameA="<a>"+e.agent.details+'</a><span class="zpl_dots"></span>'):(this.reqPhotoDiv='<span class="zpl_pichr PI_Approval-pending">',this.requestorNameA='<span class="ylw">'+ZPI18N.getString("zp.inreview")+'</span><span class="zpl_dots"></span>')),this.follwDiv="",t==REQ_TYPE_FOLLOWS&&e.hasOwnProperty("followerMode")&&(this.follwDiv='<span class="zpl_dots"></span><em>'+e.followerMode+"</em>"),this.attachMentI="",this.raiseTimeDiv=""}constructRow(){this.listRow.hasOwnProperty("hasAttachment")&&(this.attachMentI='<i id="caseAttchment" class="PI_attach"></i><span class="zpl_dots"></span>'),this.raiseTimeDiv="<em>"+this.listRow.requestedTime+"</em>";let e=this.getSlaTimeAndColor(this.listRow.SLA);this.slaDiv="",""!=e.text&&(this.slaDiv='<span class="zpl_dots"></span><em class="'+e.timerColor+'"><i class="PI_timer"></i> '+e.text+"</em>"),this.cgyDiv=`<td id="cgyDiv" categoryId="${this.listRow.categoryId}"><div><span>${this.listRow.categoryName}</span></div>${this.listRow?.subCategoryName?`<div><em>Sub-category: ${this.listRow?.subCategoryName}</em></div>`:""}</td>`,this.statusDiv='<td id="statusDiv" statusId="'+this.listRow.statusId+'"><span id="statusSpan" class="'+CommonMethod.getStatusColorClass(this.listRow.statusId)+'">'+this.listRow.status+"</span></td>";let t=null!=this.listRow.subCategoryName?"Sub Category : "+this.listRow.subCategoryName+", ":"",s="agent"in this.listRow?"handled by "+this.listRow.agent.details:"";return this.caseRw='<tr name="caseRow" caseId="'+this.listRow.recordId+'" aria-label = " '+this.listRow.subject+" , raised by "+this.listRow.requestor.name+", "+s+", Category: "+this.listRow.categoryName+",  "+t+" CurrentStatus : "+this.listRow.status+'" role="button" aria-haspopup=true tabindex ="0">'+this.SelectDiv+'<td><div class="zpl_em"><div class="zpl_emimg">'+this.reqPhotoDiv+'</div><div class="zpl_emdts"><div><em>'+this.listRow.caseId+" - </em><b>"+this.listRow.subject+'</b></div><div class="d-flexC">'+this.attachMentI+this.requestorNameA+this.raiseTimeDiv+this.follwDiv+this.slaDiv+"</div></div></div></td>"+this.cgyDiv+this.statusDiv+this.isAgentDiv+this.delIconDiv+"</tr>",this.caseRw}getSlaTimeAndColor(e){var t="",s="",i={};return null!=e&&null!=e.currentStatus&&(null==e.nextViolation?e.isViolated?(t=ZPI18N.getString("zp.escalated"),s="red"):e.currentStatus==SLA.TIMER_PAUSE?(t=ZPI18N.getString("zp.paused"),s=""):(t=ZPI18N.getString("zp.ontime"),s="grn"):(t=e.nextViolation,s=e.isViolated?"red":"grn")),i.color=s,i.text=t,i}}class HRCaseImport extends ImportV5Handler{constructor(e){super(e)}getTableName(){return"P_HR_Case"}getFormId(){return CommonMethod.getCaseFormId(),casesObj.caseFormId}downloadTemplate(){var e=$("<form id='zp_cases_export_form' action='cases/import/template' method='post' target='exportresp1' style='display:none'/>").html("");e.append('<input type="hidden" value="'+csrfToken+'" name="conreqcsr"/>'),e.append('<input type="hidden" value="sampleTemplateDownLoad" name="method"/>'),$("body").append(e),e.trigger("submit")}addedRecordsCallback(e){ZPeople.Request.send("/cases/import/list",{method:"importedCases",importId:ZP5Import.CURROBJ.importId},(function(e){var t=settingsPage.container,s=new CasesListing(t.find("#importSummaryRecordsDiv").find("div[acttype=ADDED]"),REQ_TYPE_IMPORT);t.find("#importSummaryRecordsDiv").find("div[acttype=ADDED]").empty().append(s.constructListingOuter()),s.$caselistBdy=t.find("#importSummaryRecordsDiv").find("div[acttype=ADDED]").find("#caseListBdy"),s.constructListing(e.hrcaseList)}))}}class CommonMethod{static casesHashValidation(){var e=!1;return ZPNewTabs.getTabJsonSubtabs("hrcase").length>0&&(e=!0),e}static async getStatusList(){return new Promise(((e,t)=>{if($.isEmptyObject(casesObj.STATUS)){let t={method:"getStatusList",conreqcsr:csrfToken};ZPeople.Request.send("/cases/status/list",t,(function(t){casesObj.STATUS=t,e()}))}else e()}))}static async getStatusName(e){var t="";CommonMethod.getStatusList().then((function(){return $.each(casesObj.STATUS,(function(s,i){if(i.systemValue==e)return t=i.optionValue,1})),t}))}static async getPriorityList(){return new Promise(((e,t)=>{if($.isEmptyObject(casesObj.PRIORITY)||$.isEmptyObject(casesObj.ALLPRIORITY)){let t={method:"getPriorityList",conreqcsr:csrfToken};ZPeople.Request.send("/cases/priority/list",t,(function(t){casesObj.ALLPRIORITY=t;for(let e=0;e<t.length;e++){let s=t[e];casesObj.PRIORITY[s.optionValue]=s.systemValue}e()}))}else e()}))}static async fetchAdminPerm(){return new Promise(((e,t)=>{null==casesObj.ISCASEADMIN&&ZPeople.Request.sendAsyncPost("/cases/admin/data",{method:"getUserCasesAdminData",conreqcsr:csrfToken},(function(t){casesObj.ISCASEADMIN=t.isCasesAdmin,casesObj.CATEGORYADMINDATA=t.categoryAdmin,e()})),e()}))}static async getSourceList(){return new Promise(((e,t)=>{if($.isEmptyObject(casesObj.SOURCE)){let t={method:"getSourceList",conreqcsr:csrfToken};ZPeople.Request.send("/cases/source/list",t,(function(t){casesObj.SOURCE=t,e()}))}else e()}))}static async getCaseTypeList(){return new Promise(((e,t)=>{if($.isEmptyObject(casesObj.CASETYPE)){let t={method:"getCaseTypeList",conreqcsr:csrfToken};ZPeople.Request.send("/cases/types/list",t,(function(t){casesObj.CASETYPE=t,e()}))}else e()}))}static async getCaseFormId(){return new Promise(((e,t)=>{if(""==casesObj.caseFormId){let t={method:"getCaseFormid",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/cases/formid/list",t,(function(t){casesObj.caseFormId=t.caseformid,e()}))}else e()}))}static async getCgyList(e){return new Promise(((t,s)=>{csrfToken;ZPeople.Request.send("/cases/category/list",params,(function(s){switch(e){case SUBMIT_CASE:HRCategory.CATEGORY_LIST=s;break;case USER_CGY_LISTING:HRCategory.USERVIEW_CATEGORY_LIST=s;break;case ADMIN_CGY_LISTING:HRCategory.ADMINVIEW_CATEGORY_LIST=s;break;case AGENT_CGY_LISTING:HRCategory.AGENTVIEW_CGY_LIST=s;break;case CGYADMIN_AGENT_CGY_LISTING:HRCategory.CGYADMIN_AGENT_CGY_LIST=s}for(let e in s)HRCategory.SUBCATEGORY_LIST[e.categoryId]=e.subCategories;t()}))}))}static async _getPreRequiste(){await CommonMethod.getStatusList(),await CommonMethod.getPriorityList(),await CommonMethod.getSourceList(),await CommonMethod.fetchAdminPerm()}static casesCloseCallback(){Layout.Page.hash.includes("hrcase")||$("body").removeClass("zpl_casesptch")}static async casesInit(){Layout.Page.parentContainer.attr("scroll","enabled"),$("body").addClass("zpl_casesptch"),await CommonMethod._getPreRequiste();let e=Layout.Page.hash;switch(!0){case e.includes("opencases"):casesObj.openCaseObj=new OpenCasesList,casesObj.openCaseObj.init();break;case e.includes("escalation"):casesObj.escalationObj=new EscalationList,casesObj.escalationObj.init();break;case e.includes("unassigned"):casesObj.unAssignedObj=new UnassignedList,casesObj.unAssignedObj.init();break;case e.includes("watchlist"):casesObj.watchlistObj=new WatchList,casesObj.watchlistObj.init();break;case e.includes("myrequest"):casesObj.myReqObj=new MyRequestList,casesObj.myReqObj.init();break;case e.includes("unmanaged"):casesObj.unManagedObj=new UnmanagedList,casesObj.unManagedObj.init();break;case e.includes("allcases"):casesObj.allCaseObj=new AllCasesList,casesObj.allCaseObj.init();break;default:casesObj.myCaseObj=new MyCasesList,casesObj.myCaseObj.init()}}static getParentURL(){return-1!==Layout.Page.hash.indexOf("#hrcase/myrequest")?"#hrcase/myrequest":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/list")?"#operations/hrcase/agent/list":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/allcases")?"#operations/hrcase/agent/allcases":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/unassigned")?"#operations/hrcase/agent/unassigned":-1!==Layout.Page.hash.indexOf("#hrcase/watchlist")?"#hrcase/watchlist":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/opencases")?"#operations/hrcase/agent/opencases":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/escalation")?"#operations/hrcase/agent/escalation":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/unmanaged")?"#operations/hrcase/agent/unmanaged":void 0}static casesViewInit(){$("body").addClass("zpl_casesptch"),$('[id="caseDtls"]').remove(),Layout.Page.container.closest(".cont-wrap").addClass("zpl_casesptch");let e=settingsUrlProps.urlParamsArr.caseid?settingsUrlProps.urlParamsArr.caseid:settingsUrlProps.urlParamsArr.filter-caseid;casesObj.caseViewObj=new CaseViewPage(e,Layout.Page.container),casesObj.caseViewObj.init()}static casesMySpaceInit(){$("body").addClass("zpl_casesptch"),null==casesObj.casesMySpaceObj&&(casesObj.casesMySpaceObj=new CasesMySpace,casesObj.casesMySpaceObj.init())}static casesFaq(){$("body").addClass("zpl_casesptch"),$("#faqDetView").remove(),null==casesObj.faqListObj&&(casesObj.faqListObj=new CasesFaqList,casesObj.faqListObj.init());var e=settingsUrlProps.urlParamsArr.faqId;ZPUtil.Validation.isEmpty(e)||new CasesFaqView(e).init()}static casesFaqView(){$("body").addClass("zpl_casesptch");var e=settingsUrlProps.urlParamsArr.faqId;new CasesFaqView(e).init()}static casesUserHome(){$("body").addClass("zpl_casesptch"),$("#askUsCase").remove(),null==casesObj.casesUserCgyObj&&(casesObj.casesUserCgyObj=new CasesUserCgy,casesObj.casesUserCgyObj.init()),-1!=window.location.hash.indexOf("hrcase/askus-")&&CommonMethod.casesAddCaseSlider()}static casesAddCaseSlider(){if(-1!==Layout.Page.hash.indexOf("#hrcase/askus")){var e=settingsUrlProps.urlParamsArr.categoryid;casesObj.casesUserCgyObj.redirectAddCases(e,"home")}}static casesFirescroll(){CommonMethod._getPreRequiste();let e=Layout.Page.hash;switch(!0){case e.includes("opencases"):casesObj.openCaseObj.fireScrollCallback();break;case e.includes("escalation"):casesObj.escalationObj.fireScrollCallback();break;case e.includes("unassigned"):casesObj.unAssignedObj.fireScrollCallback();break;case e.includes("watchlist"):casesObj.watchlistObj.fireScrollCallback();break;case e.includes("myrequest"):casesObj.myReqObj.fireScrollCallback();break;case e.includes("unmanaged"):casesObj.unManagedObj.fireScrollCallback();break;case e.includes("allcases"):casesObj.allCaseObj.fireScrollCallback();break;default:casesObj.myCaseObj.fireScrollCallback()}}static getStatusName(e){for(let t in casesObj.STATUS){let s=casesObj.STATUS[t];if(s?.systemValue===e)return s?.optionValue}}static getStatusColorClass(e){let t="blu";switch(e){case casesObj.OPEN_SID:t="blu";break;case casesObj.INPROGRESS_SID:t="grn";break;case casesObj.AWAITING_SID:t="ylw";break;case casesObj.ONHOLD_SID:t="ylw1";break;case casesObj.COMPLETED_SID:case casesObj.CANCELLED_SID:t="gry"}return t}static addSingleStatus(e,t,s){if(null!=t){let i=s.find('li[statusId="'+e+'"] #stsCnt');i.text(parseInt(i.text())+t)}}static minusSingleStatus(e,t,s){if(null!=t){let i=s.find('li[statusId="'+e+'"] #stsCnt');i.text(parseInt(i.text())-t)}}static updateStatus(e,t){for(let s in e)if(e.hasOwnProperty(s)){let i=t.find('li[statusId="'+s+'"] #stsCnt');i.text(parseInt(i.text())-e[s])}}static decodeValInList(e,t){$.each(e,(function(e,s){s.isDecoded||(s[t]=ZPeople.decodeTxt(s[t]),s.isDecoded=!0)}))}}class OpenCasesList extends CasesListing{constructor(){super(Layout.Page.container,REQ_TYPE_OPENCASE,ZPI18N.getString("zp.noongoingcases")),this.filterOptions=new FilterOptions(this),this.isNextAvailable=!0}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),await this.fetch(),this.pageLoading.remove(),this.construct()}fetch(){let e=this;return new Promise(((t,s)=>{let i={method:"openCases",myCasesJson:JSON.stringify(this.filterOptions.getFilterParams()),conreqcsr:csrfToken};ZPeople.Request.send("/cases/open/list",i,(s=>{e.setListData(s),e.isNextAvailable=s.isNextAvailable,e.isNextAvailable&&(ZPeople.FireScroll.getFireScrollPropertie(ZPeople.FireScroll.getCurrentMode()).triggered=!1),t()}))}))}async updateListing(){this.emptyListing(),this.listLoading=new LoadingClass(this.$pageDiv.find("#casesRgt")),this.listLoading.add(),await this.fetch(),this.listLoading.remove(),this.constructListing(this.listData.hrcaseList)}async fireScrollCallback(){this.isNextAvailable&&(this.filterOptions.index=this.$caselistBdy.find('[name="caseRow"]').length+1,await this.fetch(),this.constructListing(this.listData.hrcaseList))}}class EscalationList extends CasesListing{constructor(){super(Layout.Page.container,REQ_TYPE_ESCALATION,ZPI18N.getString("zp.noescalatedcases")),this.filterOptions=new FilterOptions(this),this.isNextAvailable=!0}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),await this.fetch(),this.pageLoading.remove(),this.construct()}async updateListing(){this.emptyListing(),this.listLoading=new LoadingClass(this.$pageDiv.find("#casesRgt")),this.listLoading.add(),await this.fetch(),this.listLoading.remove(),this.constructListing(this.listData.hrcaseList)}fetch(){let e=this;return new Promise(((t,s)=>{let i={method:"escalatedCases",myCasesJson:JSON.stringify(this.filterOptions.getFilterParams()),conreqcsr:csrfToken};ZPeople.Request.send("/cases/escalated/list",i,(s=>{e.setListData(s),e.isNextAvailable=s.isNextAvailable,e.isNextAvailable&&(ZPeople.FireScroll.getFireScrollPropertie(ZPeople.FireScroll.getCurrentMode()).triggered=!1),t()}))}))}async fireScrollCallback(){this.isNextAvailable&&(this.filterOptions.index=this.$caselistBdy.find('[name="caseRow"]').length+1,await this.fetch(),this.constructListing(this.listData.hrcaseList))}}class UnmanagedList extends CasesListing{constructor(){super(Layout.Page.container,REQ_TYPE_UNMANAGED,ZPI18N.getString("zp.nounmanagedcases")),this.filterOptions=new FilterOptions(this),this.isNextAvailable=!0}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),await this.fetch(),this.pageLoading.remove(),this.construct()}async updateListing(){this.emptyListing(),this.listLoading=new LoadingClass(this.$pageDiv.find("#casesRgt")),this.listLoading.add(),await this.fetch(),this.listLoading.remove(),this.constructListing(this.listData.hrcaseList)}fetch(){let e=this;return new Promise(((t,s)=>{let i={method:"unmanagedCases",myCasesJson:JSON.stringify(this.filterOptions.getFilterParams()),conreqcsr:csrfToken};ZPeople.Request.send("/cases/unmanaged/list",i,(s=>{e.setListData(s),e.isNextAvailable=s.isNextAvailable,e.isNextAvailable&&(ZPeople.FireScroll.getFireScrollPropertie(ZPeople.FireScroll.getCurrentMode()).triggered=!1),t()}))}))}async fireScrollCallback(){this.isNextAvailable&&(this.filterOptions.index=this.$caselistBdy.find('[name="caseRow"]').length+1,await this.fetch(),this.constructListing(this.listData.hrcaseList))}}class WatchList extends CasesListing{constructor(){super(Layout.Page.container,REQ_TYPE_FOLLOWS,ZPI18N.getString("zp.nofollowedcases")),this.filterOptions=new FilterOptions(this),this.isNextAvailable=!0}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),await this.fetch(),this.pageLoading.remove(),this.construct()}async updateListing(){this.emptyListing(),this.listLoading=new LoadingClass(this.$pageDiv.find("#casesRgt")),this.listLoading.add(),await this.fetch(),this.listLoading.remove(),this.constructListing(this.listData.hrcaseList)}fetch(){let e=this;return new Promise(((t,s)=>{let i={method:"followedHRCases",myCasesJson:JSON.stringify(this.filterOptions.getFilterParams()),conreqcsr:csrfToken};ZPeople.Request.send("/cases/watchlist/list",i,(s=>{e.setListData(s),e.isNextAvailable=s.isNextAvailable,e.isNextAvailable&&(ZPeople.FireScroll.getFireScrollPropertie(ZPeople.FireScroll.getCurrentMode()).triggered=!1),t()}))}))}async fireScrollCallback(){this.isNextAvailable&&(this.filterOptions.index=this.$caselistBdy.find('[name="caseRow"]').length+1,await this.fetch(),this.constructListing(this.listData.hrcaseList))}}class UnassignedList extends CasesListing{constructor(){super(Layout.Page.container,REQ_TYPE_UNASSIGNCASES,ZPI18N.getString("zp.nodataunassign")),this.filterOptions=new FilterOptions(this),this.filterOptions.type="unassigned",this.isNextAvailable=!0}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),await this.fetch(),this.pageLoading.remove(),this.construct()}async updateListing(){this.emptyListing(),this.listLoading=new LoadingClass(this.$pageDiv.find("#casesRgt")),this.listLoading.add(),await this.fetch(),this.listLoading.remove(),this.constructListing(this.listData.hrcaseList)}fetch(){let e=this;return new Promise(((t,s)=>{let i={method:"unassignedHRCases",myCasesJson:JSON.stringify(this.filterOptions.getFilterParams()),conreqcsr:csrfToken};ZPeople.Request.send("/cases/unassigned/list",i,(s=>{e.setListData(s),e.isNextAvailable=s.isNextAvailable,e.isNextAvailable&&(ZPeople.FireScroll.getFireScrollPropertie(ZPeople.FireScroll.getCurrentMode()).triggered=!1),t()}))}))}async fireScrollCallback(){this.isNextAvailable&&(this.filterOptions.index=this.$caselistBdy.find('[name="caseRow"]').length+1,await this.fetch(),this.constructListing(this.listData.hrcaseList))}}class MyRequestList extends CasesListing{constructor(){super(Layout.Page.container,REQ_TYPE_MYREQUEST,ZPI18N.getString("zp.norequestedcases")),this.filterOptions=new FilterOptions(this),this.isNextAvailable=!0}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),this.filterOptions.status="",await this.fetch(),this.pageLoading.remove(),this.construct()}async updateListing(){this.emptyListing(),this.listLoading=new LoadingClass(this.$pageDiv.find("#casesRgt")),this.listLoading.add(),await this.fetch(),this.listLoading.remove(),this.constructListing(this.listData.hrcaseList)}fetch(){let e=this;return new Promise(((t,s)=>{let i={method:"myHrCasesRequest",myCaseRequestJson:JSON.stringify(this.filterOptions.getFilterParams()),conreqcsr:csrfToken};ZPeople.Request.send("/cases/myrequest/list",i,(s=>{e.setListData(s),e.isNextAvailable=s.isNextAvailable,e.isNextAvailable&&(ZPeople.FireScroll.getFireScrollPropertie(ZPeople.FireScroll.getCurrentMode()).triggered=!1),t()}))}))}async fireScrollCallback(){this.isNextAvailable&&(this.filterOptions.index=this.$caselistBdy.find('[name="caseRow"]').length+1,await this.fetch(),this.constructListing(this.listData.hrcaseList))}}class MyCasesList extends CasesListing{constructor(){super(Layout.Page.container,REQ_TYPE_MYCASES,ZPI18N.getString("zp.noongoingcases")),this.filterOptions=new FilterOptions(this),this.isNextAvailable=!0}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),await this.fetch(),this.pageLoading.remove(),this.construct()}async updateListing(){this.emptyListing(),this.listLoading=new LoadingClass(this.$pageDiv.find("#casesRgt")),this.listLoading.add(),await this.fetch(),this.listLoading.remove(),this.constructListing(this.listData.hrcaseList)}fetch(){let e=this;return new Promise(((t,s)=>{let i={method:"myHrCases",myCasesJson:JSON.stringify(this.filterOptions.getFilterParams()),conreqcsr:csrfToken};ZPeople.Request.send("/cases/mycases/list",i,(s=>{e.setListData(s),e.isNextAvailable=s.isNextAvailable,e.isNextAvailable&&(ZPeople.FireScroll.getFireScrollPropertie(ZPeople.FireScroll.getCurrentMode()).triggered=!1),t()}))}))}async fireScrollCallback(){this.isNextAvailable&&(this.filterOptions.index=this.$caselistBdy.find('[name="caseRow"]').length+1,await this.fetch(),this.constructListing(this.listData.hrcaseList))}}class AllCasesList extends CasesListing{constructor(){super(Layout.Page.container,REQ_TYPE_ALLCASES,ZPI18N.getString("zp.noallcases")),this.filterOptions=new FilterOptions(this),this.isNextAvailable=!0,this.categoryid=null}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),this.filterOptions.status="",await this.fetch(),this.pageLoading.remove(),this.construct()}async updateListing(){this.emptyListing(),this.listLoading=new LoadingClass(this.$pageDiv.find("#casesRgt")),this.listLoading.add(),await this.fetch(),this.listLoading.remove(),this.constructListing(this.listData.hrcaseList)}fetch(){let e=this;return new Promise(((t,s)=>{let i=this.filterOptions.getFilterParams();const a=Layout.Page.hash.match(/categoryid:(\d+).*status:(\d+)/);null!=a&&(this.categoryid=a[1]);let n={method:"allHrCases",myCasesJson:JSON.stringify(i),conreqcsr:csrfToken};ZPeople.Request.send("/cases/allcase/list",n,(s=>{null!=this.categoryid&&(s.hrcaseList=s.hrcaseList.filter((e=>e.categoryId==this.categoryid)),s.isFiltered=!0),e.setListData(s),e.isNextAvailable=s.isNextAvailable,e.isNextAvailable&&(ZPeople.FireScroll.getFireScrollPropertie(ZPeople.FireScroll.getCurrentMode()).triggered=!1),t()}))}))}async fireScrollCallback(){this.isNextAvailable&&(this.filterOptions.index=this.$caselistBdy.find('[name="caseRow"]').length+1,await this.fetch(),this.constructListing(this.listData.hrcaseList))}}class MySpaceCasesList extends CasesListing{constructor(){super(Layout.Page.container,REQ_TYPE_MYREQUEST,ZPI18N.getString("zp.norequestedcases")),this.filterOptions=new FilterOptions(this),this.isNextAvailable=!0}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),this.filterOptions.status=5,await this.fetch(),this.pageLoading.remove(),this.construct()}async updateListing(){this.emptyListing(),this.listLoading=new LoadingClass(this.$caselistBdy),this.listLoading.add(),await this.fetch(),this.listLoading.remove(),this.constructListing(this.listData.hrcaseList)}fetch(){let e=this;return new Promise(((t,s)=>{let i={method:"mySpaceHrCasesRequest",mySpaceCaseRequestJson:JSON.stringify(this.filterOptions.getFilterParams()),conreqcsr:csrfToken};ZPeople.Request.send("/cases/myspace/list",i,(s=>{e.setListData(s),e.isNextAvailable=s.isNextAvailable,t()}))}))}}class FilterOptions{constructor(e){this.caseList0=e,this.$filterDiv=this.caseList0.$pageDiv,this.$caseFilter=void 0,this.cgyList={},this.status="1,2,3,4",this.index=1,this.reqFlag=!0,this.timeFlag=!0,this.statusFlag=!0,this.reqTypeFlag=!1,this.cgyFlag=!0,this.subCgyFlag=!0,this.priorityFlag=!0,this.caseList0.urlMode==REQ_TYPE_MYREQUEST?(this.reqFlag=!1,this.timeFlag=!1,this.cgyFlag=!1,this.subCgyFlag=!1,this.priorityFlag=!1):this.caseList0.urlMode==REQ_TYPE_UNMANAGED?(this.statusFlag=!1,this.timeFlag=!1,this.cgyFlag=!1,this.subCgyFlag=!1):this.caseList0.urlMode==REQ_TYPE_MYCASES?(this.cgyFlag=!1,this.subCgyFlag=!1):this.caseList0.urlMode==REQ_TYPE_OPENCASE?(this.statusFlag=!1,this.cgyFlag=!1,this.subCgyFlag=!1):this.caseList0.urlMode==REQ_TYPE_ALLCASES&&(this.reqTypeFlag=!0),this.timePeriodObj=[{id:0,value:ZPI18N.getString("zp.today")},{id:1,value:ZPI18N.getString("zp.yesterday")},{id:2,value:ZPI18N.getString("zp.last7days")},{id:3,value:ZPI18N.getString("zp.last30days")}],this.requestorTypeObj=[{id:"0",value:ZPI18N.getString("zp.allemployees")},{id:"1",value:ZPI18N.getString("zp.activeemployees"),isDefaultValue:!0},{id:"2",value:ZPI18N.getString("zp.formeremployees")}],this.cgyMode=USER_CGY_LISTING,casesObj?.ISCASEADMIN?this.cgyMode=ADMIN_CGY_LISTING:casesObj?.CATEGORYADMINDATA.length>0&&(this.cgyMode=CGYADMIN_AGENT_CGY_LISTING),this.init()}listen(){let e=this;this.$filterDiv.find("#fltrIc").off().on("click",(function(){e.$filterDiv.toggleClass("zpl_fltr_flt")})),this.$filterDiv.find("#fltCls").off().on("click",(function(){e.close()})),this.$filterDiv.find("#cseFltrRst").off().on("click",(function(){e.resetFilter()})),this.$filterDiv.find("#cseFltrSve").off().on("click",(function(){e.$filterTagUl=e.caseList0.$pageDiv.find("#filterOptMne"),e.$filterTagUl.html(""),e.applyFilter(!0)})),this.$filterDiv.find("#clearAllFilter").off().on("click",(async function(){e.removeHeader(),e.$filterTagUl.html(""),e.resetFilter(),await e.caseList0.updateListing(),e.caseList0.statusHeadObj.statusList=e.caseList0.listData?.statusCount,e.caseList0.statusHeadObj.updateCount()}))}close(){this.$filterDiv.removeClass("zpl_fltr_flt")}open(){this.$filterDiv.addClass("zpl_fltr_flt")}async applyFilter(e){this.$filterTagUl=this.caseList0.$pageDiv.find("#filterOptMne"),this.$fltHdr=this.$filterTagUl.closest("#fltrOpt"),this.setDefaultValues(e),this.searchtype="filter",this.setFilterParams(),await this.caseList0.updateListing(),this.caseList0.statusHeadObj.statusList=this.caseList0.listData?.statusCount,this.caseList0.statusHeadObj.updateCount(),e&&this.updateHeader(),this.$filterTagUl.find("li").length<=0&&this.removeHeader()}showHeader(){this.$fltHdr.removeClass("DNI")}removeHeader(){this.$fltHdr.addClass("DNI")}updateHeader(){this.showHeader(),this._notEmpty(this.query)&&this.addSearchTag(),this.statusTagObj=new FilterHeader(this.$statusSel,ZPI18N.getString("zp.status"),this),this.statusTagObj.construct(),this.priorityTagObj=new FilterHeader(this.$prioritySel,ZPI18N.getString("zp.priority"),this),this.priorityTagObj.construct(),this.reqTagObj=new FilterHeader(this.$reqSel,ZPI18N.getString("zp.requestor"),this),this.reqTagObj.construct(),this.cgyTagObj=new FilterHeader(this.$cgySel,ZPI18N.getString("zp.category"),this),this.cgyTagObj.construct(),this.subCgyTagObj=new FilterHeader(this.$subCgySel,ZPI18N.getString("zp.subcategory"),this),this.subCgyTagObj.construct(),this.PTimeTagObj=new FilterHeader(this.$timeSel,ZPI18N.getString("zp.fromtodate"),this),this.PTimeTagObj.construct(),this.reqTypeTagObj=new FilterHeader(this.$reqTypeSel,ZPI18N.getString("zp.requestorstatus"),this),this.reqTypeTagObj.construct()}setFilterParams(){this._notEmpty(ZPeopleComponents.select(this.$statusSel)?.getValues())&&(this.status=ZPeopleComponents.select(this.$statusSel)?.getValues().join(",")),this._notEmpty(ZPeopleComponents.select(this.$prioritySel)?.getValues())&&(this.priority=ZPeopleComponents.select(this.$prioritySel)?.getValues().join(",")),this._notEmpty(ZPeopleComponents.select(this.$reqSel)?.getValues())&&(this.requestorErecno=ZPeopleComponents.select(this.$reqSel)?.getValues().join(",")),this._notEmpty(ZPeopleComponents.select(this.$cgySel)?.getValues())&&(this.categoryId=ZPeopleComponents.select(this.$cgySel)?.getValues().join(",")),this._notEmpty(ZPeopleComponents.select(this.$subCgySel)?.getValues())&&(this.subcategoryId=ZPeopleComponents.select(this.$subCgySel)?.getValues().join(",")),this._notEmpty(ZPeopleComponents.select(this.$timeSel)?.getValue())&&(this.periodOfTime=ZPeopleComponents.select(this.$timeSel)?.getValue()),this._notEmpty(ZPeopleComponents.select(this.$reqTypeSel)?.getValue())&&(this.requestorType=ZPeopleComponents.select(this.$reqTypeSel)?.getValue()),this.query=this.$cseSrch.val().trim()}getFilterParams(){let e={status:this.status,index:this.index,categoryId:this.categoryId,subcategoryId:this.subcategoryId,requestorType:this.requestorType,requestorErecno:this.requestorErecno,periodOfTime:this.periodOfTime,priority:this.priority};return this._notEmpty(this.type)&&(e.type=this.type),this._notEmpty(this.searchtype)&&(e.searchtype=this.searchtype),this._notEmpty(this.query)&&(e.query=this.query),e}_notEmpty(e){return""!=e&&null!=e}addSearchTag(){let e=this,t=$(`<li><label>${ZPI18N.getString("zp.search")} : </label><span title="${ZSEC.Encoder.encodeForHTMLAttribute(this.query)}">${ZSEC.Encoder.encodeForHTML(this.query)}</span><a class="PI_cls" title="${ZPI18N.getString("zp.clear")}"></a></li>`);this.$filterTagUl.append(t),t.find(".PI_cls").off().on("click",(function(){e.$cseSrch.val(""),$(this).closest("li").remove(),e.applyFilter(!1)}))}resetFilter(){this.$cseSrch.val(""),ZPeopleComponents.select(this.$statusSel)?.deselectAllOptions(),ZPeopleComponents.select(this.$prioritySel)?.deselectAllOptions(),ZPeopleComponents.select(this.$reqSel)?.deselectAllOptions(),ZPeopleComponents.select(this.$cgySel)?.deselectAllOptions(),ZPeopleComponents.select(this.$subCgySel)?.deselectAllOptions(),ZPeopleComponents.select(this.$timeSel)?.deselectAllOptions(),ZPeopleComponents.select(this.$reqTypeSel)?.deselectAllOptions(),this.setDefaultValues(!0)}setDefaultValues(e){this.status=e?"":"1,2,3,4",this.index=1,this.requestorErecno=void 0,this.query=void 0,this.requestorType=void 0,this.categoryId=void 0,this.subcategoryId=void 0,this.searchtype=void 0,this.periodOfTime=void 0,this.priority=void 0}constructOuter(){this.$filterDiv.append(`<div id="caseFilter" class="zpl_fltr"> <div> <div class="zpl_fltrhd"> <h5>${ZPI18N.getString("zp.filter")}</h5> <i id="fltCls" class="PI_cls" role="button" aria-label = "Close" tabindex="0"></i> </div> <div class="zpl_search zpl_srchsml"> <input id="cseSrch" type="search" class="ztextbox" placeholder="${ZPI18N.getString("zp.search")}" aria-label="Case Search" role="input-box"> <i class="PI_lens"></i> </div> </div> <div id="fltrCnt" class="zpl_fltrcnt"> <div> <div class="zpl_fltclps fltopn"> <div id="fltrLst" class="zpl_fltrlst"> </div> </div> </div> </div> <div> <button id="cseFltrSve" type="button" class="zlabel zlabel--blue zlabel--medium" aria-label=${ZPI18N.getString("zp.apply")}>${ZPI18N.getString("zp.apply")}</button> <button id="cseFltrRst" type="button" class="zlabel zlabel--outline zlabel--medium"  aria-label=${ZPI18N.getString("zp.reset")}>${ZPI18N.getString("zp.reset")}</button> </div> <div></div></div>`),this.$caseFilter=this.$filterDiv.find("#caseFilter"),this.$fltrCnt=this.$caseFilter.find("#fltrCnt"),this.$fltCls=this.$caseFilter.find("#fltCls"),this.$cseSrch=this.$caseFilter.find("#cseSrch"),this.$fltrLst=this.$caseFilter.find("#fltrLst")}async init(){this.constructOuter(),this.initStatus(),this.initPriority(),this.initRequestor(),this.initTimeChange(),await this.initCategory(),this.initSubCgy(),this.initReqType()}initStatus(){if(this.statusFlag){let e={value:"systemValue",label:"optionValue"},t={options:casesObj.STATUS,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$caseFilter,randomDropdownListId:!0,cacheData:!0,multiple:!0,clearButton:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0},isLabelHTMLEncoded:!0};this.$fltrLst.append(`<div id="statusSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.status")}</label> </div> <div> <select id="statusSel" class="select-js" style="display: none;"> </select> </div> </div>`),this.$statusSel=this.$fltrLst.find("#statusSel"),ZPeopleComponents.select(this.$statusSel,t),ZPeopleComponents.select(this.$statusSel).removeOption([casesObj.CANCELLED_SID])}}initPriority(){if(this.priorityFlag){let e={value:"systemValue",label:"optionValue"},t={options:casesObj.ALLPRIORITY,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$caseFilter,randomDropdownListId:!0,cacheData:!0,multiple:!0,clearButton:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0},isLabelHTMLEncoded:!0};this.$fltrLst.append(`<div id="priorityFSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.priority")}</label> </div> <div> <select id="priorityFSel" class="select-js" style="display: none;"> </select> </div> </div>`),this.$prioritySel=this.$fltrLst.find("#priorityFSel"),ZPeopleComponents.select(this.$prioritySel,t)}}initRequestor(){if(this.reqFlag){this.$fltrLst.append(`<div id="reqSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.requestor")}</label> </div> <div> <select id="reqSel" class="select-js" style="display: none;"> </select> </div> </div>`),this.$reqSel=this.$fltrLst.find("#reqSel");let e={showSearchField:!0};e.options=EmployeeSearch.getEmpList("","emp","HRCASES_ADDCASE_AGENT",[],{},!0,[],!1,!0),e.dataSource={search:function(e){return new Promise((function(t,s){t({delay:20,results:EmployeeSearch.getEmpList(e.query,"emp","HRCASES_ADDCASE_AGENT",[],{},!0,[],!1,!0),more:!1})}))},paginated:!0},e.placeholder=ZPI18N.getString("zp.select"),e.multiple=!0,e.serverSearch=!0,e.cacheData=!0,e.clearButton=!0,e.appendTo=this.$askUS,e.randomDropdownListId=!0,e.isLabelHTMLEncoded=!0,e.dataMapping={value:"id",label:"value",image:"image"},e.contentType="image-text",e.dropdownList={contentType:"image-text",isTextHTMLEncoded:!0},e.search={by:["value","email"]},ZPeopleComponents.select(this.$reqSel,e),this.$reqSel.parents("#reqSec").removeClass("zpl_DNI"),this.employeeId=erecno}}async initCategory(){if(this.cgyFlag){let e=new Category(this.cgyMode);await e.fetch(),this.cgyList=e._currCgyData;let t={value:"categoryId",label:"categoryName",iconClassName:"iconClass"},s={options:this.cgyList,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$caseFilter,randomDropdownListId:!0,cacheData:!0,multiple:!0,clearButton:!0,dataMapping:t,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0},isLabelHTMLEncoded:!0};this.$fltrLst.append(`<div id="cgySec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.category")}</label> </div> <div> <select id="cgySel" class="select-js" style="display: none;"> </select> </div> </div>`),this.$cgySel=this.$fltrLst.find("#cgySel"),ZPeopleComponents.select(this.$cgySel,s)}}initSubCgy(){if(this.subCgyFlag){this.subCgyList=[];let e=this;if($.each(this.cgyList,(function(t,s){$.each(s.subCategoryList,(function(t,i){let a={};a.id=i.subCategoryId,a.value=s.categoryName+" - "+i.subcategoryname,a.categoryId=s.categoryId,e.subCgyList.push(a)}))})),this.subCgyList.length>0){let e={value:"id",label:"value"},t={options:this.subCgyList,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$caseFilter,randomDropdownListId:!0,cacheData:!0,multiple:!0,clearButton:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0},isLabelHTMLEncoded:!0};this.$fltrLst.append(`<div id="subcgySec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.subcategory")}</label> </div> <div> <select id="subcgySel" class="select-js" style="display: none;"> </select> </div> </div>`),this.$subCgySel=this.$fltrLst.find("#subcgySel"),ZPeopleComponents.select(this.$subCgySel,t)}}}initTimeChange(){if(this.timeFlag){let e={value:"id",label:"value"},t={options:this.timePeriodObj,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$caseFilter,randomDropdownListId:!0,cacheData:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0},clearButton:!0,isLabelHTMLEncoded:!0};this.$fltrLst.append(`<div id="timeSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.fromtodate")}</label> </div> <div> <select id="timeSel" class="select-js" style="display: none;"> </select> </div> </div>`),this.$timeSel=this.$fltrLst.find("#timeSel"),ZPeopleComponents.select(this.$timeSel,t),ZPeopleComponents.select(this.$timeSel).deselectAllOptions()}}initReqType(){if(this.reqTypeFlag){let e={value:"id",label:"value"},t={options:this.requestorTypeObj,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$caseFilter,randomDropdownListId:!0,cacheData:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0},selectedIndex:1,isLabelHTMLEncoded:!0};this.$fltrLst.append(`<div id="reqTypeSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.requestorstatus")}</label> </div> <div> <select id="reqTypeSel" class="select-js" style="display: none;"> </select> </div> </div>`),this.$reqTypeSel=this.$fltrLst.find("#reqTypeSel"),ZPeopleComponents.select(this.$reqTypeSel,t)}}}class FilterHeader{constructor(e,t,s){this.ele=e,this.filterObj=s,this.$filterTagUl=s.$filterTagUl,this.name=t,this.compEle=ZPeopleComponents.select(e),this.optionsData=this._notEmpty(this.compEle?.getValues())?this.compEle?.getOptionData():[],this.label="",this.setOptionsLabel()}setOptionsLabel(){this.optionsData=this._notEmpty(this.compEle?.getValues())?this.compEle?.getOptionData():[];for(let e=0;e<this.optionsData?.length;e++)this.label+=this.optionsData[e].label+",";this.label=this.label.endsWith(",")?this.label.slice(0,-1):this.label}_notEmpty(e){return""!=e&&null!=e}construct(){""!=this.label&&(this.tag=$(`<li><label>${this.name} : </label><span title="${this.label}">${this.label}</span><a class="PI_cls" title="Clear"></a></li>`),this.$filterTagUl.append(this.tag),this.listen())}listen(){let e=this;this.tag.find(".PI_cls").off().on("click",(function(){$(this).closest("li").remove(),e.compEle.deselectAllOptions(),e.filterObj.applyFilter(!1)}))}}class StatusHeader{constructor(e){this.casesList0=e,this.urlMode=e.urlMode,this.$btnMnuDiv=e.$btnMnuDiv,this.$caselistBdy=e.$caselistBdy,this.statusList=e.listData.statusCount}updateCount(){for(let e=0;e<this.statusList.length;e++){let t=this.statusList[e];if(0!=t.systemValue&&null!=t.count){if(t.systemValue==HRCase.CANCELLED_SID&&this.urlMode!=REQ_TYPE_MYREQUEST||t.systemValue==HRCase.COMPLETED_SID&&this.urlMode==REQ_TYPE_OPENCASE)continue;this.$btnMnuDiv.find('li[statusId="'+t.systemValue+'"]').find("#stsCnt").text(t.count)}else this.$btnMnuDiv.find('li[statusId="'+t.systemValue+'"]').find("#stsCnt").text(0)}}constructStatus(){this.statusDiv="";let e=0;for(let t=0;t<this.statusList.length;t++){let s=this.statusList[t];if(0!=s.systemValue&&null!=s.count){if(s.systemValue==HRCase.CANCELLED_SID&&this.urlMode!=REQ_TYPE_MYREQUEST||s.systemValue==HRCase.COMPLETED_SID&&this.urlMode==REQ_TYPE_OPENCASE)continue;this.statusDiv+='<li statusId="'+s.systemValue+'" aria-label="'+s.optionValue+" - "+s.count+' associated case." role=tab tabindex="0"><span id="stsTxt">'+s.optionValue+'</span><b id="stsCnt" class="'+CommonMethod.getStatusColorClass(s.systemValue)+'">'+s.count+"</b></li>",e++}}let t=`There are ${e} classifications based on case status`;this.statusDiv=`<div class="zpl_lft flxauto"><ul class="zpl_tpcrdlst" role="tablist" aria-label="${t}">${this.statusDiv}</ul></div>`,this.$btnMnuDiv.prepend(this.statusDiv)}listen(){let e=this;this.$btnMnuDiv.on("click","li[statusId]",(function(){e.casesList0.filterOptions.index="1",$(this).hasClass("zpl_act")?($(this).removeClass("zpl_act"),e.casesList0.filterOptions.status="1,2,3,4"):($(this).siblings().removeClass("zpl_act"),$(this).addClass("zpl_act"),e.casesList0.filterOptions.status=$(this).attr("statusId")),e.casesList0.removeEmptyCasePage(),e.casesList0.updateListing()}))}}class caseImportExport{constructor(e){this.urlMode=e.urlMode,this.casesList0=e,this.$btnMnuDiv=e.$btnMnuDiv,this.importReq=e.importReq,this.exportReq=e.exportReq,this.$pageDiv=e.$pageDiv,this.moreIcnId="#more_"+e.urlMode}constructMoreMenu(){let e=this.importReq?'<li name="csimp" data-icon-class="PI_imprt"><div class="zmenu__iconcontainer"><i class="zmenu__icon PI_imprt"></i></div><span class="zmenu__text">'+ZPI18N.getString("zp.import")+"</span></li>":"";e+=this.exportReq?'<li name="csexp" data-icon-class="PI_exprt"><div class="zmenu__iconcontainer"><i class="zmenu__icon PI_exprt"></i></div><span class="zmenu__text">'+ZPI18N.getString("zp.export")+"</span></li>":"";let t=""!=e?'<div id="more_'+this.urlMode+'"><ul>'+e+"</ul></div>":"";""!=t&&(this.$pageDiv.append(t),ZPeopleComponents.menu(this.$pageDiv.find(this.moreIcnId),{forElement:settingsPage.container.find("[name=moremnu]"),displayType:"callout",contentType:"icon-text"}))}listen(){let e=this;e.$pageDiv.find("[name=moremnu]").off("click").on("click",(function(t){ZPeopleComponents.menu("#more_"+e.urlMode).show()})),e.$pageDiv.find("li[name=csimp]").off("click").on("click",(function(t){e.import()})),e.$pageDiv.find("li[name=csexp]").off("click").on("click",(function(t){e.export()}))}import(){ZP5Import.init(ZP5Import.HANDLER_MODE.CASES)}export(){let e=this;var t=new Tab("casesExport",(function(){var e='<div class="zradiobutton zradiobutton--horizontal"><input id="fmt_xls" type="radio" checked="true" name="exfmt_cases" class="zradiobutton__helper"/><label name="fmt_xls" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.xls")+"</span></label></div>";e+='<div class="zradiobutton zradiobutton--horizontal"><input id="fmt_xlsx" type="radio" name="exfmt_cases" class="zradiobutton__helper"/><label name="fmt_xlsx" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.xlsx")+"</span></label></div>",e+='<div class="zradiobutton zradiobutton--horizontal"><input id="fmt_csv" type="radio" name="exfmt_cases" class="zradiobutton__helper"/><label name="fmt_csv" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.csv")+"</span></label></div>";var t=$('<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_Emptydata"><div class="zpl_mdexprtimg smll"></div><h4>'+ZPI18N.getString("zp.exportas",[""])+' </h4><div class="zpl_secn"><div>'+e+"</div></div><div></div></div></div></div>");t.find("[name=exfmt_cases]").closest("div").off("click").on("click",(function(e){t.find("[name=exfmt_cases]").prop("checked",!1),$(this).find("[name=exfmt_cases]").prop("checked",!0)})),$("#cardcasesExport").empty().append(t)}),(function(){var t=$("#cardcasesExport").find("[name=exfmt_cases]:checked").attr("id").split("_")[1];0==$("#zp_cases_export_form").length&&$("body").append('<form id="zp_cases_export_form" action="cases/export" method="post" name="zp_cases_export_form" style="display: none;" target="exportresp"></form>');var i=$("#zp_cases_export_form").html("");i.append('<input type="hidden" value="'+e.urlMode+'" name="url_mode"/>'),i.append('<input type="hidden" value="exportData" name="method"/>'),i.append('<input type="hidden" value="'+t+'" name="fType"/>'),i.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),i.append('<input type="hidden" value="1" name="index"/>');var a=e.casesList0.filterOptions.getFilterParams();ZPUtil.Validation.isEmpty(a.mode)||i.append('<input type="hidden" value="'+a.mode+'" name="mode"/>'),ZPUtil.Validation.isEmpty(a.status)||i.append('<input type="hidden" value="'+a.status+'" name="status"/>'),ZPUtil.Validation.isEmpty(a.priority)||i.append('<input type="hidden" value="'+a.priority+'" name="priority"/>'),ZPUtil.Validation.isEmpty(a.requestorErecno)||i.append('<input type="hidden" value="'+a.requestorErecno+'" name="requestorErecno"/>'),ZPUtil.Validation.isEmpty(a.query)||i.append('<input type="hidden" value="'+a.query+'" name="query"/>'),ZPUtil.Validation.isEmpty(a.categoryId)||i.append('<input type="hidden" value="'+a.categoryId+'" name="categoryId"/>'),ZPUtil.Validation.isEmpty(a.periodOfTime)||i.append('<input type="hidden" value="'+a.periodOfTime+'" name="periodOfTime"/>'),ZPUtil.Validation.isEmpty(a.type)||i.append('<input type="hidden" value="'+a.type+'" name="type"/>'),ZPUtil.Validation.isEmpty(a.searchtype)||i.append('<input type="hidden" value="'+a.searchtype+'" name="searchtype"/>'),ZPUtil.Validation.isEmpty(a.requestorType)||i.append('<input type="hidden" value="'+a.requestorType+'" name="requestorType"/>'),ZPUtil.Validation.isEmpty(a.agenterecno)||i.append('<input type="hidden" value="'+a.agenterecno+'" name="tempAgentErecno"/>'),ZPUtil.Validation.isEmpty(a.from)||i.append('<input type="hidden" value="'+a.from+'" name="from"/>'),ZPUtil.Validation.isEmpty(a.to)||i.append('<input type="hidden" value="'+a.to+'" name="to"/>'),ZPUtil.Validation.isEmpty(a.reqType)||i.append('<input type="hidden" value="'+a.reqType+'" name="reqType"/>'),ZPUtil.Validation.isEmpty(a.subcategoryId)||i.append('<input type="hidden" value="'+a.subcategoryId+'" name="subcategoryId"/>');i.append('<input type="hidden" value="" name="selectedFields"/>'),i.trigger("submit"),s.close()}));let s=new popupModal(ZPI18N.getString("zp.exportas",[""]),t);s.setCloseCallback((function(e){e.remove()})),s.save=ZPI18N.getString("zp.export"),s.construct()}}class BulkSelect{constructor(e){this.urlMode=e.urlMode,this.$btnMnuDiv=e.$btnMnuDiv,this.$caselistBdy=e.$caselistBdy,this.$headSel=e.$caseListbdyHead.find("#cseChkAll"),this.casesList0=e,this._buttons=e._clsBulkBton+e._delBulkBton+e._picBulkBton,this.selectedIds=[],this.selStatus={},this.selectedChkboxs=void 0,this.selcaseRows=[],this.constructBulkHeader()}constructBulkHeader(){this.$btnMnuDiv.append('<div id="bulkHdr" class="actn_ovrly"> <div class="d-flexC flexclmcap">'+this._buttons+'</div> <div> <i id="blCls" class="PI_cls"></i> </div> </div>'),this.$bulkHdr=this.$btnMnuDiv.find("#bulkHdr")}listen(){this._rowListen(),this._headListen(),this._buttonListen()}_rowListen(){let e=this;this.$caselistBdy.on("click",'label[name="selChkBx"]',(function(t){t.stopPropagation(),t.preventDefault();let s=$(this).parent().find("input");s.prop("checked")?(s.prop("checked",!1),e.selectedCount()>0?e.showBulkHeader():e.hideBulkHeader()):(s.prop("checked",!0),e.showBulkHeader())})),this.$bulkHdr.find("#blCls").off().on("click",(function(){e.hideBulkHeader()}))}_headListen(){let e=this;this.$headSel.off().on("click",(function(){let t=$(this).parent().find("input");t.prop("checked")?(t.prop("checked",!1),e.unSelectAll(),e.hideBulkHeader()):(t.prop("checked",!0),e.selectAll(),e.showBulkHeader())}))}selectAll(){this.$caselistBdy.find('input[class="zcheckbox__helper"]').prop("checked",!0)}unSelectAll(){this.$caselistBdy.find('input[class="zcheckbox__helper"]').prop("checked",!1)}_buttonListen(){let e=this;this.$bulkHdr.on("click","button",(function(){switch($(this).attr("name")){case"close":e.bulkClose();break;case"delete":e.bulkDelete();break;case"pickup":e.bulkPickup()}}))}bulkDelete(){let e=this.selectedCount();if(e<200){let t=this,s=new DeleteAlertMessage(ZPI18N.getString("zp.delete"),ZPI18N.getString("zp.confirmdeletecases"));s.removeAfterYes=!1,s.isDoubleCnf=!0,s.setCloseCallback(this._resetSelectedIds()),s.setCallback((function(){ZPeopleComponents.button(s.alertDiv.find("#yesBtn"),{actionInProgress:!0,progressIndicator:{type:"circular",position:"left"}});let i={method:"deleteCase",caseId:t.getSelectedIds().join(","),conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/cases/delete",i,(function(i){"success"==i.status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.casedeletesuccess")),s.close(),t.hideAllSelRows(),CommonMethod.updateStatus(t.selStatus,t.$btnMnuDiv),t.removeAllSelRows(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.bulkdeletesuccess",[e]))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannotdeletecases"))})),s.remove(),t._resetSelectedIds(),t.hideBulkHeader()})),s.show()}else ZPeople.Message.showFailureMsg("Delete Case count should be less than 200")}bulkPickup(){if(this.selectedCount()<100){let e=this,t=new InfoAlertMessage(ZPI18N.getString("zp.pickupcases"),ZPI18N.getString("zp.bulkpickup"));t.removeAfterYes=!1,t.setCloseCallback(this._resetSelectedIds()),t.setCallback((function(){ZPeopleComponents.button(t.alertDiv.find("#yesBtn"),{actionInProgress:!0,progressIndicator:{type:"circular",position:"left"}});let s=e.casesList0.assignCase0.bulkAssign(JSON.stringify(e.getSelectedIds()),erecno);if(s.isSuccess){var i=Object.keys(s.modifiedPkIds).length;e.hideAllSelRows();let t=e.$btnMnuDiv.find('li[statusId="7"] #stsCnt');t.text(parseInt(t.text())-i),e.removeAllSelRows(),e.$caselistBdy.find('tr[name="caseRow"]').length<=0&&e.casesList0.showEmptyCasePage(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.bulkpickupsuccess",new Array(i+"")))}t.remove(),e._resetSelectedIds(),e.hideBulkHeader()})),t.show()}else ZPeople.Message.showFailureMsg("Pickup Case count should be less than 100")}bulkClose(){if(this.selectedCount()<100){let e=this,t=new InfoAlertMessage(ZPI18N.getString("zp.closecases"),"I confirm and wish to proceed with closing the selected cases");t.removeAfterYes=!1,t.yesButtonText=ZPI18N.getString("zp.confirm"),t.setCloseCallback(this._resetSelectedIds()),t.setCenterHtml('<textarea id="clsCmt" class="ztextbox"></textarea>'),t.setCallback((function(){ZPeopleComponents.button(t.alertDiv.find("#yesBtn"),{actionInProgress:!0,progressIndicator:{type:"circular",position:"left"}});let s=t.alertDiv.find("#clsCmt").val(),i=e._statusChange(JSON.stringify(e.getSelectedIds(HRCase.COMPLETED_SID)),CommonMethod.getStatusName(HRCase.COMPLETED_SID),s);if(i.isSuccess){let t=e.$caselistBdy.find('input[class="zcheckbox__helper"]:checked').closest('[name="caseRow"').find("[statusid]");t.attr("statusid",HRCase.COMPLETED_SID),t.find('[id="statusSpan"]').removeClass().addClass(CommonMethod.getStatusColorClass(HRCase.COMPLETED_SID)).text(CommonMethod.getStatusName(HRCase.COMPLETED_SID));let s=i.updateList[Object.keys(i.updateList)[0]].length||0;CommonMethod.addSingleStatus(HRCase.COMPLETED_SID,s,e.$btnMnuDiv),CommonMethod.updateStatus(e.selStatus,e.$btnMnuDiv),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.bulkstatuschangesuccess",new Array(s,CommonMethod.getStatusName(HRCase.COMPLETED_SID))))}t.remove(),e._resetSelectedIds(),e.hideBulkHeader()})),t.show()}else ZPeople.Message.showFailureMsg("Close Case count should be less than 100")}_statusChange(e,t,s){let i={method:"bulkStatusChange",pkIds:e,status:t,comment:"<div>"+s+"</br><div>",messageText:s,conreqcsr:csrfToken},a={};return ZPeople.Request.sendAsyncPost("/cases/listing/statuschange",i,(function(e){e.isSuccess?a=e:ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannotclosecases"))})),a}selectedCount(){return this.$caselistBdy.find('input[class="zcheckbox__helper"]:checked').length}getSelectedIds(e){let t=this;return t.selStatus={},this.selectedChkboxs=this.$caselistBdy.find('input[class="zcheckbox__helper"]:checked'),this.selectedIds=this.$caselistBdy.find('input[class="zcheckbox__helper"]:checked').map((function(){let s=$(this).closest('[name="caseRow"]');if(null!=e||0==s.find('[statusId="'+e+'"]').length){t.selcaseRows.push(s);let e=s.find("#statusDiv").attr("statusId");return t.selStatus[e]=(t.selStatus[e]||0)+1,s.attr("caseId")}})).get(),this.selectedIds}_resetSelectedIds(){this.selectedIds=[],this.selStatus={},this.selectedChkboxs=void 0,this.selcaseRows=[]}showBulkHeader(){this.$bulkHdr.addClass("opn")}hideBulkHeader(){this.unSelectAll(),this.$headSel.siblings("input").prop("checked",!1),this.$bulkHdr.removeClass("opn")}hideAllSelRows(){this.selectedChkboxs.closest('[name="caseRow"]').hide()}removeAllSelRows(){this.selectedChkboxs.closest('[name="caseRow"]').remove()}}class DeleteCase{constructor(e){this.casesList0=e,this.$caselistBdy=e.$caselistBdy,this.$delBtns=e.$caselistBdy.find(".PI_delete")}listen(){let e=this;this.$caselistBdy.on("click",".PI_delete",(function(t){t.stopPropagation(),t.preventDefault();let s=$(this).closest('[name="caseRow"]');e.deleteCase(s,s.attr("caseId"))}))}deleteCase(e,t){var s=!1;let i=new DeleteAlertMessage(ZPI18N.getString("zp.delete"),ZPI18N.getString("zp.confirmdeletecase"));i.isDoubleCnf=!0,i.removeAfterYes=!1,i.setCallback((function(){let a={method:"deleteCase",caseId:t,conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/cases/delete",a,(function(t){return"success"==t.status?(s=!0,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.casedeletesuccess")),i.close(),e.remove()):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannotdeletecases")),s}))})),i.show()}}class AssignCase{constructor(e){this.casesList0=e,this.$caselistBdy=e.$caselistBdy,this.$assgnIc=e.$caselistBdy.find('[id="cseAssignTo"] span'),this.assigneeList=[]}bulkAssign(e,t){let s={method:"pickupCases",pkIds:e,agent:t,conreqcsr:csrfToken},i={};return ZPeople.Request.sendAsyncPost("/cases/pickup/list",s,(function(e){e.isSuccess?i=e:ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannotpickcases"))})),i}listen(){let e=this;this.$caselistBdy.on("click",'[id="cseAssignTo"]',(function(t){t.stopPropagation(),t.preventDefault();let s=$(this).closest("td"),i=s.find("#assignToList"),a=s.closest("tr").attr("caseId"),n=$(this);i.children().length<=0?ZPeople.Request.sendAsyncPost("/cases/assignedto/list",{caseId:a,method:"getAssignedToList",conreqcsr:csrfToken},(function(t){if("success"==t.status)if(t.assignedToList.isAssigneeAvailable){let l={value:"empErecno",text:"empDispName",image:"empPhoto",textIcon:"avatarText",informativeText:"email"},o={contentType:"image-text-desc",isTextHTMLEncoded:!0,appendTo:s,viewport:e.$caselistBdy.parent(),randomDropdownListId:!0,forElement:n,items:t.assignedToList.assigneeList,dataMapping:l,displayType:"callout",position:"left"};ZPeopleComponents.dropdownlist(i,o),i.on("click",(function(e,t){e.stopPropagation(),e.preventDefault()})),i.on("zdropdownlistitemclick",(function(e,t){let i={conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:a,assignedId:t.itemData.empErecno};ZPeople.Request.send("/cases/assigned",i,(function(e){"success"==e.status&&(s.empty(),s.append('<div class="zpl_em"> <div class="zpl_emimg"> <img src="'+t.itemData.empPhoto+'"> </div> </div>'))}))})),ZPeopleComponents.dropdownlist(i).open()}else ZPeople.Message.showFailureMsg("No agents available to assign");else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ttfailuremsg"))})):ZPeopleComponents.dropdownlist(i).open()}))}}class ShowAttatchments{constructor(e){this.casesList0=e,this.$pageDiv=e.$pageDiv,this.$attachemntButton=e.$caselistBdy.find("[id  = caseAttchment]")}constructAttachmentList(){let e=this;e.casesList0.$caselistBdy.on("click","[id  = caseAttchment]",(function(t){let s=this;t.stopPropagation();var i=$(this).closest("tr").attr("caseid");let a={conreqcsr:csrfToken,method:"getFilesList",caseId:i};ZPeople.Request.send("/cases/files/list",a,(function(t){var a=t;let n="";if(!$("#fileMenu_"+i).length>0){for(let e=0;e<a.length;e++){let t=a[e].fileName.substring(a[e].fileName.lastIndexOf(".")+1),s=ZSEC.Encoder.encodeForHTML(a[e].fileName),i=ZPFeeds.Attachments.getIconClass(t);n+='<li class="'+i+'" id="'+a[e].fileUploadId+'" name="'+s+'" SVGIconId="'+i+'" previewfileid="'+a[e].previewFileId+'"><i class ="'+i+' lft"></i><span>'+ZSEC.Encoder.encodeForHTML(a[e].fileName)+"</span></li>"}let t=""!=n?'<div id="fileMenu_'+i+'" ><ul class="LI">'+n+"</ul></div>":"";""!=t&&(e.$pageDiv.append(t),ZPeopleComponents.menu($("#fileMenu_"+i),{forElement:$(s),displayType:"callout",contentType:"icon-text",direction:"bottom-right",itemclick:function(e,t){e.preventDefault(),e.stopPropagation(),ZPeopleComponents.menu($("#fileMenu_"+i)).hide();let s=t.attrs.id,a=t.attrs.name,n=a.substring(a.lastIndexOf(".")+1),l=t.attrs.previewfileid,o=i;CasesFilesCommon.getLightBoxPreview(s,o,HR_CASE_ATTACHEMENTS,ZSEC.Encoder.encodeForHTML(a),ZSEC.Encoder.encodeForHTML(n),l)}}))}ZPeopleComponents.menu($("#fileMenu_"+i)).show()}))}))}}var CustomServiceResources={CATEGORY_ID:"",FAQ_DATA:"",faqListObj:"",SERVICE_NAME:"",RESOURCES:"",init:function(){var e=window.location.hash.split("/")[0];e=e.startsWith("#")?e.substring(1):e,Object.keys(ZPNewTabs.main.tabObj).forEach((t=>{t.toLowerCase()==e.toLowerCase()&&(e=ZPNewTabs.main.tabObj[t].name)})),CustomServiceResources.SERVICE_NAME=e,CustomServiceResources.faqListObj="",CustomServiceResources.RESOURCES=""},getRelatedDoc:function(){var e={mode:"relatedDoc",conreqcsr:csrfToken};e.serviceName=CustomServiceResources.SERVICE_NAME,null==CustomServiceResources.RESOURCES||null==CustomServiceResources.RESOURCES||""==CustomServiceResources.RESOURCES?ZPeople.Request.send("/services/references/list",e,(function(e){CustomServiceResources.RESOURCES=e,CustomServiceResources.CATEGORY_ID=e.categoryId,CustomServiceResources.showRelatedDoc(CustomServiceResources.RESOURCES)})):$("#refgendoc").removeClass("DN")},showRelatedDoc:function(e){let t=Layout.Page.container;$('[id="refgendoc"]').length>0&&$('[id="refgendoc"]').remove(),e.FilesList.length>0?(t.find("#emptPage")&&CustomServiceResources.removeEmptyPage(),CustomServiceResources.showReferenceListing(e)):CustomServiceResources.showEmptyPage()},showReferenceListing:function(e){let t=Layout.Page.container,s=`<div class="zpl_container" id="refgendoc"><div class="zpl_iwrpr"><div class="zpl_iwrprrgt"><div class="zpl_act" data-tab="files_Orgop"><div class="zpl_rgtcnt"><div class="zpl_tblres"><table class="zpl_tbl"><thead><tr tabindex="1"><th> ${ZPI18N.getString("zp.name")}</th><th>Details </th></tr></thead></table></div></div></div></div></div></div></div>`;t.append(s);for(let t=0;t<e.FilesList.length;t++)if(2==e.FilesList[t].formType){let s=FilesCommon.getFileSize(e.FilesList[t].fileSize),i=e.FilesList[t].linkName.substring(e.FilesList[t].linkName.lastIndexOf(".")+1);"0"!=e.FilesList[t].uploadSource||ZPUtil.Validation.isEmpty(e.FilesList[t].filePath)||(i=e.FilesList[t].filePath.substring(e.FilesList[t].filePath.lastIndexOf(".")+1));let a=FilesCommon.getFileIcon(i),n=e.FilesList[t].linkName,l=e.FilesList[t].linkId;"1"==e.FilesList[t].uploadSource&&(a="PI_workdrive",s=e.FilesList[t].link);let o=`<tbody linkId="${l}"><tr tabindex="1"><td><div class="d-flexC d-flexclmcap10"><i class="${a}"></i><span class="d-flexclmcap5 a-itm-cntr">${n}</span></div></td><td><span>${s}</span></td></tr></tbody>`;$("#refgendoc table").append(o),e.FilesList[t].link.indexOf(workDriveUrl)>-1||e.FilesList[t].link.indexOf(writerUrl)>-1||e.FilesList[t].link.indexOf(sheetUrl)>-1||e.FilesList[t].link.indexOf(showUrl)>-1||"1"==e.FilesList[t].uploadSource?(a="workdrive",$('[linkId="'+l+'"]').attr("onclick",'window.open("'+e.FilesList[t].link+'")')):$('[linkId="'+l+'"]').attr("onclick","CasesFilesCommon.getLightBoxPreview('"+e.FilesList[t].linkId+"','"+CustomServiceResources.CATEGORY_ID+"','"+HR_CATEGORY_ATTACHEMENTS+"','"+n+"','"+ZSEC.Encoder.encodeForHTML(i)+"','"+(e.FilesList[t].hasOwnProperty("filePath")?"attachmentz"+e.FilesList[t].link:"")+"')")}else if(0==e.FilesList[t].formType){let s="PI_link",n=e.FilesList[t].link,l=e.FilesList[t].linkName.length>0?e.FilesList[t].linkName:e.FilesList[t].link,o=e.FilesList[t].linkId,c=`<tbody linkId="${o}"><tr tabindex="1"><td><div class="d-flexC d-flexclmcap10"><i class="${s}"></i><span class="d-flexclmcap5 a-itm-cntr">${l}</span></div></td><td><span>${n}</span></td></tr></tbody>`;$("#refgendoc table").append(c);var i=e.FilesList[t].link.match(/^http[s]*:\/\//),a=i?i+escape(e.FilesList[t].link.split(/^http[s]*:\/\//)[1]):"https://"+escape(e.FilesList[t].link);$('[linkId="'+o+'"]').attr("onclick",'window.open("'+a+'", "_blank")')}},faqList:async function(){$("#refgendoc").addClass("DN"),$("body").addClass("zpl_casesptch"),$("#faqDetView").remove(),null!=CustomServiceResources.faqListObj&&null!==CustomServiceResources.faqListObj&&""!==CustomServiceResources.faqListObj||(CustomServiceResources.faqListObj=new CasesFaqList(CustomServiceResources.CATEGORY_ID),await CustomServiceResources.faqListObj.init()),$("#btnMnu").remove();var e=settingsUrlProps.urlParamsArr.faqId;ZPUtil.Validation.isEmpty(e)||new CasesFaqView(e).init()},resourceCloseCallback:function(){Layout.Page.hash.includes("resource")||$("body").removeClass("zpl_casesptch")},showEmptyPage:function(){let e=Layout.Page.container.find(".zpl_rgtcnt");0==e.find("#emptPage").length&&(e.children().addClass("zpl_DNI"),e.append('<div id="emptPage" class="zpl_crd wd100_per"><div class="zpl_crdcnt"><div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_cases"></div><h4>'+ZPI18N.getString("zp.nodatafound")+"</h4><p></p></div></div></div></div>"))},removeEmptyPage:function(){let e=Layout.Page.container.find(".zpl_rgtcnt");e.find("#emptPage").length&&(e.children().removeClass("zpl_DNI"),e.find("#emptPage").remove())},setTLTabParams:function(e){let t=Layout.Page.hash.split("/")[0].slice(1),s="";ZPServices.SERVICE_JSON.forEach((e=>{e.tabName.toLowerCase()===t.toLowerCase()&&(s=e.tabName)})),s&&(e.serviceName=s,e.submode="resources")}};class CasesMySpace{constructor(){this.$pageDiv=Layout.Page.container,this.erecno=erecno}async init(){if(""==this.$pageDiv.html().trim()){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),await(new Category).fetch(),this.constructCgy(),this.MySpaceCasesObject=new MySpaceCasesList,await this.MySpaceCasesObject.fetch();let e=this.MySpaceCasesObject.listData.mySpaceClosedcaseList;this.constructMySpaceCase(e,"Closed Cases");let t=this.MySpaceCasesObject.listData.mySpaceOpencaseList;this.constructMySpaceCase(t,"Open Cases"),this.listen()}}listen(){this.caseRwClk(),this.askUsClk()}caseRwClk(){this.$pageDiv.find("[caseId]").off().on("click",(function(){$('[id="caseDtls"]').remove(),$("body").addClass("zpl_casesptch"),casesObj.caseViewObj=new CaseViewPage($(this).attr("caseId"),Layout.Page.container),casesObj.caseViewObj.init()}))}askUsClk(){this.$pageDiv.find("[cgyId]").off().on("click",(function(){casesObj.addCaseObj=new AddCases($(this).attr("cgyId")),casesObj.addCaseObj.init()}))}constructCgy(){if(casesObj?.USERVIEW_CATEGORY_LIST.length>0){let e="";for(let t in casesObj.USERVIEW_CATEGORY_LIST)t=casesObj.USERVIEW_CATEGORY_LIST[t],e+=`<div cgyId="${t.categoryId}"><span class="${ServiceIcons.getIconClass(t.categoryIcon)} icn"></span><div class="zpl_msp-dts wd80_per"><div class="zpl_msp-name"><div class="zpl_msp-title">${t.categoryName}</div></div><div><em>${t.categoryShortDescription}</em></div></div><div class="zpl_msp-act"><div class="zpl_hvr"><button class="zlabel zlabel--blue zlabel--medium zlabel--outline">${ZPI18N.getString("zp.askus")}</button></div></div></div>`;e=`<div class="zpl_msplst"><div class="zpl_msp-hgroup"><div><b>${ZPI18N.getString("zp.categories")}</b></div></div>${e}</div>`,this.$pageDiv.append(e)}}async constructMySpaceCase(e,t){if(0!=e.length){let a=Math.min(e.length,5),n="";for(let t=0;t<a;t++){let a=e[t];var s="",i="";ZPUtil.Validation.isEmpty(a.agent)?(s='<span class="zpl_pichr PI_Approval-pending"></span>',i='<em class="ylw">'+ZPI18N.getString("zp.inreview")+"</em>"):(s=ZPUtil.Validation.isEmpty(a.agent.name)?`<span class="zpl_pichr PC2">${ZSEC.Encoder.encodeForHTML(CommonTemplates.getAltText(ZPeople.decodeTxt(a.agent.details)))}</span>`:`<img alt="" src="${a.agent.employeePhoto}">`,ZPUtil.Validation.isEmpty(a.agent.name),i=a.agent.details),n+=`<div caseId="${a.recordId}"> <div class="zpl_msp-dts"> <div class="zpl_em"> <div class="zpl_emimg">${s}</div> <div class="zpl_emdts zpl_ellipsis"> <div> <span>${a.caseId} -</span> <b>${a.subject}</b> </div> <div>${i} </div> </div> </div> </div> <div class="zpl_compoffar"> <span class="zpl_progtitle" cgyId="${a.categoryId}"> <b>${a.categoryName}</b> </span> <div> <em>Raised on ${a.requestedTime} </em> </div> </div> <div class="zpl_msp-act"> <div statusId="${a.statusId}" class="${CommonMethod.getStatusColorClass(a.statusId)}">${a.status}</div> </div> </div>`}n=`<div class="zpl_msplst"><div class="zpl_msp-hgroup"><div><b>${t}</b></div></div>${n}</div>`,this.$pageDiv.prepend(n)}this.pageLoading.remove()}}class Category{constructor(e){this.mode=e||"userListing",this._currCgyData=[]}fetch(){let e=this;return new Promise(((t,s)=>{let i={method:"fetchCategoryList",conreqcsr:csrfToken,mode:e.mode},a="/cases/category/operationlist";"operationCategoryListing"!=e.mode&&(a="/cases/category/list"),ZPeople.Request.send(a,i,(function(s){switch(e._currCgyData=s,e.mode){case SUBMIT_CASE:casesObj.CATEGORY_LIST=s;break;case USER_CGY_LISTING:casesObj.USERVIEW_CATEGORY_LIST=s;break;case ADMIN_CGY_LISTING:casesObj.ADMINVIEW_CATEGORY_LIST=s;break;case AGENT_CGY_LISTING:casesObj.AGENTVIEW_CGY_LIST=s;break;case CGYADMIN_AGENT_CGY_LISTING:case"operationCategoryListing":casesObj.CGYADMIN_AGENT_CGY_LIST=s}for(let e in s)e=s[e],casesObj.SUBCATEGORY_LIST[e.categoryId]=e.subCategoryList;t()}))}))}}class CasesUserCgy{constructor(){this.$pageDiv=Layout.Page.container,this.$pageDiv.parents(".cont-wrap").addClass("zpl_casesptch"),this.$pageDiv.addClass("zpl_cScatUr").append('<div id="rgtCnt" class="zpl_rgtcnt"></div>'),this.$rgtCnt=this.$pageDiv.find("#rgtCnt")}async init(){""==this.$rgtCnt.html().trim()&&(this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),CommonMethod.getStatusList(),CommonMethod.fetchAdminPerm(),await(new Category).fetch(),this.constructCgy(),this.faqCases=new FaqCasesXHR("recentFaq",0),await this.faqCases.fetch(),this.recentFaq=this.faqCases.faqList,this.listen(),this.pageLoading.remove())}constructCgy(){if(casesObj?.USERVIEW_CATEGORY_LIST.length>0){let e="",t=1;for(let s in casesObj.USERVIEW_CATEGORY_LIST)s=casesObj.USERVIEW_CATEGORY_LIST[s],e+=`<li cgyId="${s.categoryId}" aria-label=" Category ${t}  ${s.categoryName}" tabindex="0"> ${s?.isAgent?`<div class="zpl_catetoppos"> <div class="zpl_tg zpl_hvrop"><span>${ZPI18N.getString("zp.agent")}</span></div> </div>`:""} <span class="${ServiceIcons.getIconClass(s.categoryIcon)} icn"></span> <h6>${s.categoryName}</h6> <p class="zpl_hvrop">${s.categoryShortDescription}</p> <div class="zpl_btnpos"><button class="zlabel zlabel--blue zlabel--small" name="askUsCse" aria-label="Ask Us" aria-haspopup = "true">${ZPI18N.getString("zp.askus")}</button></div> </li>`,s?.isAgent&&casesObj.agentCgyIds.push(s.categoryId),t++;e=`<div id="cgySecn" class="zpl_cScatLst zpl_cSUpFrnt"> <div class="zpl_cScatLsIn"> <div class="zpl_secn"> <div> <ul id="cgyList" class="zpl_catecrd">${e}</ul> </div> </div> </div> </div>`,this.$rgtCnt.append(e),this.$cgySecn=this.$rgtCnt.find("#cgySecn"),this._checkFaqSecn(),this.$pageDiv.attr("aria-label","You are in the categories tab of HR Help desk service."),this.$pageDiv.attr("tabindex","0"),this.$pageDiv.attr("role","tablist"),this.pageLoading.remove()}}_checkFaqSecn(){0==this.$rgtCnt.find("#faqSecn").length&&(this.$rgtCnt.append(` <div id="faqSecn" class="zpl_cScatSrh" tabindex="0"> <h2>${ZPI18N.getString("zp.gotaquestion")}</h2> <p>${ZPI18N.getString("zp.findyouranswers")}</p> <div class="zpl_cScatSrIn"> <input id="searchFaq" type="text" placeholder="${ZPI18N.getString("zp.searchfaq")}" role="input box" tabindex="0"> <button aria-label = "Search" tabindex="0">${ZPI18N.getString("zp.search")}</button> </div>  <div id="srchBx" class="zpl_cScatSrRt"> <div class="zpl_cScatSrRtIn"> <h3 id="faqHd">${ZPI18N.getString("zp.recentfaq")}</h3> <ul id="faqList" class="zpl_cScatFqLst"> </ul> </div></div>`),this.$faqList=this.$rgtCnt.find("#faqList"),this.$faqInp=this.$rgtCnt.find("#searchFaq"),this.$searchBx=this.$rgtCnt.find("#srchBx"),this.$faqHd=this.$pageDiv.find("#faqHd"),this.searchNoDt=new EmptyPages("zp_nd_faq",ZPI18N.getString("zp.nofaqs"),"",this.$faqList),this.searchLoad=new LoadingClass(this.$faqList))}constructFaq(e){if(e.FAQ_LIST.length>0){let t="";for(let s in e.FAQ_LIST)s=e.FAQ_LIST[s],t+=`<li faqId="${s.faqID}"> <p>${s.query}</p> <a>${s.catalogName}</a> </li>`;this.searchLoad.remove(),this.searchNoDt.remove(),this.$faqList.html(""),this.$faqList.append(t)}else this.searchNoDt.show()}listen(){this.searchFaq(),this.recentFaqClk(),this.addCaseListen(),this.pageClick(),this.faqViewClk()}faqViewClk(){let e=this;this.$faqList.on("click","li[faqId]",(function(t){t.stopPropagation(),e.faqViewObj=new CasesFaqView($(this).attr("faqId")),e.faqViewObj.init(),$(this).data("faqViewObj",e.faqViewObj)}))}pageClick(){let e=this;this.$pageDiv.on("click",(function(t){t.stopPropagation(),e.#e()}))}addCaseListen(){this.$rgtCnt.on("click",'button[name="askUsCse"]',(function(e){e.stopPropagation();let t=$(this).parents("li[cgyId]").attr("cgyId");window.location.href="#hrcase/askus-categoryid:"+t}))}redirectAddCases(e){casesObj.addCaseObj=new AddCases(e),casesObj.addCaseObj.init()}recentFaqClk(){let e=this;this.$faqInp.off("click").on("click",(function(t){t.stopPropagation(),e.$faqHd.text(ZPI18N.getString("zp.recentfaq")),e.#t(),e.searchLoad.add(),e.constructFaq(e.recentFaq)}))}#t(){this.$searchBx?.addClass("toggle"),this.$cgySecn.removeClass("zpl_cSUpFrnt")}#e(){this.$faqInp.val(""),this.$searchBx?.removeClass("toggle"),this.$cgySecn.addClass("zpl_cSUpFrnt")}searchFaq(){let e=this,t=null;this.$faqInp.off("keyup").on("keyup",(function(){e.#t();let s=$(this).val().trim();clearTimeout(t),t=setTimeout((async function(){s.length>=3&&(e.$faqHd.text(ZPI18N.getString("zp.searchfaq")),e.searchLoad.add(),e.faqCases.searchStr=s,await e.faqCases.search(),e.constructFaq(e.faqCases.faqSearch))}),750),""==s&&e.$faqHd.text()!=ZPI18N.getString("zp.recentfaq")&&(e.searchLoad.add(),e.$faqHd.text(ZPI18N.getString("zp.recentfaq")),e.constructFaq(e.recentFaq))})),this.$faqInp.off("keydown").on("keydown",(function(e){clearTimeout(t)}))}}class FaqCasesXHR{constructor(e,t){this.listMode=e,this.index=t||0,this.searchStr="",this.isTagsNeeded=!1}fetch(){let e=this;return new Promise(((t,s)=>{let i={conreqcsr:csrfToken,method:"faqList",mode:e.listMode,index:e.index},a="cases/faq/list";window.location.hash.includes("resources/faqs")&&(a="services/faq/list",i.serviceName=CustomServiceResources.SERVICE_NAME),ZPeople.Request.send(a,i,(function(s){e.faqList=s,CustomServiceResources.CATEGORY_ID=s.FAQ_LIST?.[0]?.categoryId,t()}))}))}search(){let e=this;return new Promise(((t,s)=>{let i={mode:"searchFAQ",conreqcsr:csrfToken,searchStr:e.searchStr};ZPeople.Request.send("/cases/faq/search",i,(function(s){e.faqSearch=s,t()}))}))}}class OperationCategory{constructor(){this.$pageDiv=Layout.Page.container}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),await CommonMethod.fetchAdminPerm();var e=new Category("operationCategoryListing");await e.fetch(),this.constructCgy(),this.listen(),this.pageLoading.remove()}static casesOperationHome(){(new OperationCategory).init()}static OperationCasesCloseCallback(){Layout.Page.hash.includes("hrcase")||$("body").removeClass("zpl_casesptch")}constructCgy(){if(this.constructCategoryWrapper(),casesObj?.CGYADMIN_AGENT_CGY_LIST.length>0){let e=$("#admCgyList"),t=1;for(let s in casesObj.CGYADMIN_AGENT_CGY_LIST){s=casesObj.CGYADMIN_AGENT_CGY_LIST[s];let i=this.constructCurrentCategoryDiv(s);i.off("click").on("click",(function(e){var t=$(this).attr("categoryid");window.location.href="#operations/hrcase/category/view-categoryid:"+t})),e.append(i),s?.isAgent&&casesObj.agentCgyIds.push(s.categoryId),t++}}}constructCategoryWrapper(){$("#operations-hrcase-category").attr("class","zpl_act zpl_cScatUr"),$("#operations-hrcase-category").attr("aria-label","You are in the categories tab of Cases service."),$("#operations-hrcase-category").attr("tabindex","0"),$("#operations-hrcase-category").attr("role","tablist");$("#operations-hrcase-category").append('<div class="zpl_act zpl_catgCs"><div id="rgtCnt" class="zpl_rgtcnt"><div class="zpl_crdlst" id="admCgyList"></div></div></div>')}fetchCgyFromList(e,t){return null!=t&&""!=t&&casesObj[e].length>0?casesObj[e].find((e=>e.categoryId===t)):null}constructCurrentCategoryDiv(e){let t=ZPI18N.getString("zp.addcaseforuser"),s=`<span class="${ServiceIcons.getIconClass(e.categoryIcon)} icn"></span>`,i=2==e.typeOthers?"<span>services</span>":"",a=`<div class="zpl_flex-1"><h5>${e.categoryName} ${i}</h5><p>${e.categoryShortDescription}</p></div>`,n="3"==e.typeOthers?"":`<div class="zpl_msp-act" style= "display : ${e.isEnabled?"block":"none"}"><div name="addCaseBtn"><button class="zlabel zlabel--blue zlabel--medium zlabel--outline zpl_btnellips"><span>${t}</span></button></div></div>`;return $(`<div class="${e.isEnabled?"zpl_catlst":"zpl_catlst zpl_op5"}" categoryid="${e.categoryId}">${s} ${a} ${n}</div>`)}AddCaseForUser(){Layout.Page.container.find("[name=addCaseBtn]").on("click",(function(e){e.stopPropagation(),e.preventDefault();let t=$(this).closest(".zpl_catlst").attr("categoryid"),s=new AddCases(t);s.cgyListObj=casesObj.CGYADMIN_AGENT_CGY_LIST,s.init()}))}listen(){this.AddCaseForUser()}}class CasesFaqList{constructor(){this.$pageDiv=Layout.Page.container,this.strtList=void 0,this.faqList={}}async init(){this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),this.faqData=new FaqCasesXHR("faqList",0),await this.faqData.fetch(),this.faqList=this.faqData.faqList?.FAQ_LIST,this.constructMenu(),this.constructCont(),this.faqList.length>0?(this.removeEmptyPage(),this.pageLoading.remove(),this.construct(this.$faqList),this.listen()):(this.pageLoading.remove(),this.showEmptyPage())}listen(){this._openSearch(),this._clsSearch(),this.searchFaq(),this.faqClk()}faqClk(){let e=this;this.$rgtCnt.on("click",".zpl_qalst[faqId]",(function(){$(this).data("faqViewObj",e.faqViewObj);let t=window.location.hash.split("/")[0];window.location.href=-1!=window.location.hash.indexOf("resources/faqs")?`${t}/resources/faqs/view-faqId:`+$(this).attr("faqid"):"#hrcase/faq/view-faqId:"+$(this).attr("faqid")}))}_openSearch(){let e=this;this.$opnSrch.off().on("click",(function(){e.$srchDiv.addClass("opn")}))}_clsSearch(){let e=this;this.$clsSrch.off().on("click",(function(){e.$srchList.addClass("zpl_DNI"),e.$faqList.removeClass("zpl_DNI"),e.$srchDiv.removeClass("opn"),e.$faqInp.val("")}))}searchFaq(){let e=this,t=null;this.$faqInp.off("keyup").on("keyup",(function(){let s=$(this).val().trim();clearTimeout(t),t=setTimeout((async function(){s.length>=3&&(e.searchLoad.add(),e.faqData.searchStr=s,await e.faqData.search(),e.faqList=e.faqData.faqSearch?.FAQ_LIST,e.searchLoad.remove(),e.faqList.length>0?(e.removeEmptyPage(),e.$srchList.removeClass("zpl_DNI"),e.$faqList.addClass("zpl_DNI"),e.construct(e.$srchList)):e.showEmptyPage())}),750)})),this.$faqInp.off("keydown").on("keydown",(function(e){clearTimeout(t)}))}constructMenu(){this.$pageDiv.append(' <div id="btnMnu" class="zpl_btnmnu"><div id="srchDiv" class="search-cmn"> <i class="PI_lens" aria-label ="Search" role="button" ></i> <input id="searchFaq" type="text" class="ztextbox" id="suggestFieldId" placeholder="Search data" aria-label="Enter FAQ search query" tabindex="0"> <i class="PI_cls" id="clsSrch" ></i> </div> <div class="zpl_rgt"> <i id="opnSrch" class="zpl_ibg PI_lens"></i> </div> </div>'),this.$btnMnu=this.$pageDiv.find("#btnMnu"),this.$srchDiv=this.$btnMnu.find("#srchDiv"),this.$faqInp=this.$pageDiv.find("#searchFaq"),this.$clsSrch=this.$pageDiv.find("#clsSrch"),this.$opnSrch=this.$pageDiv.find("#opnSrch")}constructCont(){if("operations-hrcase-faq-list"===this.$pageDiv.attr("id"))this.$pageDiv.attr("aria-label","You are in FAQ tab within Cases service"),this.$pageDiv.attr("tabindex","0");this.$pageDiv.append(' <div class="zpl_rgtcnt"> <div class="zpl_faqcnt"> <div id="faqList" class="zpl_qacrd" aria-label = "Proceeding to FAQ list"> </div><div id="srchList" class="zpl_qacrd zpl_DNI"> </div></div> </div>'),this.$rgtCnt=this.$pageDiv.find(".zpl_rgtcnt"),this.$faqList=this.$rgtCnt.find("#faqList"),this.$srchList=this.$rgtCnt.find("#srchList"),this.searchLoad=new LoadingClass(this.$rgtCnt)}construct(e){let t="";for(let e=0;e<this.faqList.length;e++){let s=this.faqList[e];t+=`<div class='zpl_qalst' faqId='${s.faqID}' aria-label = 'FAQ ${e+1} - Category : ${s.catalogName}. Question: ${s.query}. Answer: ${ZSEC.Encoder.encodeForHTMLAttribute(s.answer)}.' tabindex='0'><div class="zpl_qalsthdr"><div class="zpl_qalsthd"><div></div><div><h5>${s.query}</h5><p>${ZSEC.Encoder.encodeForHTML(s.answer).slice(0,180)}</p><div class="zpl_qalsthdbtm"><div class="zpl_tg"><span>${s.catalogName}</span></div></div></div></div></div></div>`}e.html(t)}showEmptyPage(){0==this.$rgtCnt.find("#emptPage").length&&(this.$rgtCnt.children().addClass("zpl_DNI"),this.$rgtCnt.append('<div id="emptPage" class="zpl_crd wd100_per"><div class="zpl_crdcnt"><div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_cases"></div><h4>'+ZPI18N.getString("zp.nofaqs")+"</h4><p></p></div></div></div></div>"))}removeEmptyPage(){this.$rgtCnt.find("#emptPage").length&&(this.$rgtCnt.children().removeClass("zpl_DNI"),this.$rgtCnt.find("#emptPage").remove())}}class CasesFaqView{constructor(e){this.$pageDiv=Layout.Page.container,this.faqId=e}async init(){this.addOuterCnt(),this.pageLoading=new LoadingClass(this.$faqDetView.find(".zpl_minr")),this.pageLoading.add(),await CommonMethod.fetchAdminPerm(),await this.fetch(),null!=this.faqData&&this.faqData.length>0?(this.faqData=this.faqData[0],0===window.location.hash.indexOf("#home/myspace")&&(this.faqData.isReportAvailable=!1),this.pageLoading.remove(),this.construct()):(this.close(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.permdenied")))}addOuterCnt(){this.$pageDiv.append(`<div id="faqDetView" faqId="${this.faqId}" class="zpl_mdl zpl_mopen"> <div class="zpl_minr"> <div id="faqHdr" class="zpl_mhder"> <div class="zpl_mhderrgt"><a id="faqDetCpyLink" class="PI_link zpl_btnic" title="${ZPI18N.getString("zp.lms.settings.copyurl")}"></a></div><a id="faqDetCls" class="_cls PI_cls" title="${ZPI18N.getString("zp.close")}"></a> </div> <div class="zpl_mcnt"> <div class="zpl_crd"> <div id="faqCnt" class="zpl_crdcnt"> </div> </div> </div> </div> </div>`),this.$faqDetView=this.$pageDiv.find("#faqDetView"),this.$faqCnt=this.$faqDetView.find("#faqCnt")}_faqCls(){let e=this;this.$faqCls=this.$faqDetView.find("#faqDetCls"),this.$faqCls.off().on("click",(function(t){let s=window.location.hash.split("/")[0];t.stopPropagation(),e.close(),-1!=window.location.hash.indexOf("hrcase/faq/view-faqId")?window.location.href="#hrcase/faq/list":-1!=window.location.hash.indexOf("resources/faqs/view-faqId")&&(window.location.href=`${s}/resources/faqs`)}))}_faqUrlCpy(){let e=this;this.$faqCls=this.$faqDetView.find("#faqDetCpyLink"),this.$faqCls.off().on("click",(function(t){var s;t.stopPropagation();var i=document.createElement("input"),a="#hrcase/faq/view-faqId:"+e.faqId;-1!=window.location.hash.indexOf("resources/faqs/view-faqId")&&(a=window.location.hash),i.value=window.location.origin+window.location.pathname+a,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i);try{!1===(s=document.execCommand("copy"))?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.copyfailed")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.copysuccess"))}catch(e){s=!1,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.copyfailed"))}return s}))}_faqRelFAQ(){let e=this;this.$faqDetView.off().on("click","div.zpl_qalst[faqid]",(function(t){t.stopPropagation(),e.close(),window.location.href="#hrcase/faq/view-faqId:"+$(this).attr("faqid")}))}close(){this.$faqDetView.remove(),this.faqReportObj?.$faqRept?.remove()}construct(){this.$faqDetView.find("#faqHdr").prepend(`<h4 id="faqHdrTxt">${this.faqData.query}</h4>`),this.$faqAns=$(`<div class="zpl_secn"><p>${ZPFeeds.Activity.getRawSmileys(this.faqData.answer)}</p></div>`).css("line-height","").css("font-weight","").css("font-family","").css("font-size",""),this.$faqCnt.append(this.$faqAns),this.$faqCnt.append(this._filesHtm()+this._likesHtm()+this._tagsHtml()+this._relFAQHtml()),this.set$Obj(),this.listen()}show(){this.$faqDetView.find("#faqHdr").prepend(`<h4 id="faqHdrTxt">${this.faqData.query}</h4>`),this.$faqCnt.append(this.$faqAns),this.$faqCnt.append(this._filesHtm()+this._likesHtm()),this.set$Obj(),this.listen()}set$Obj(){this.$like=this.$faqCnt.find("#likeFaq"),this.$dLike=this.$faqCnt.find("#dLikeFaq"),this.$faqAnlyts=this.$faqCnt.find("#faqAnlyts")}listen(){this._faqCls(),this._faqUrlCpy(),this._faqRelFAQ(),this.faqData.reactObj.hasOwnProperty("isReactedType")||(this.likeListen(),this.disLikeListen()),(casesObj.ISCASEADMIN||this.faqData.isCgyAgent&&this.faqData.isReportAvailable)&&this.faqReptListen()}faqReptListen(){let e=this;this.$faqAnlyts.off().on("click",(function(t){t.stopPropagation(),null==e.faqReportObj?(e.faqReportObj=new FaqReport(e.faqId,e.faqData.categoryId),e.faqReportObj.$pageDiv=e.$pageDiv,e.faqReportObj.init()):e.faqReportObj.show()}))}_filesHtm(){let e="";for(let t in this.faqData.filesList){t=this.faqData.filesList[t];let s=t.fileName.substring(t.fileName.lastIndexOf(".")+1),i=FilesCommon.getFileIcon(s);"1"==t.uploadSource||t.filePath.indexOf(workDriveUrl)>-1||t.filePath.indexOf(writerUrl)>-1||t.filePath.indexOf(sheetUrl)>-1||t.filePath.indexOf(showUrl)>-1?(i="1"==t.uploadSource?"PI_workdrive":"PI_cloud",e+='<div class="zpl_atchd atsml" onclick=window.open("'+t.filePath+'")> <div> <div class="zpl_atchimg"> <i class="'+i+'"></i> </div> <div class="zpl_atchdtl"> <h4>'+ZSEC.Encoder.encodeForHTML(t.fileName)+"</h4> <p><span>"+(null!=t.filesize?t.filesize:"1"==t.uploadSource?t.filePath:"")+"</span></p> </div> </div> </div>"):e+='<div class="zpl_atchd atsml" onclick="CasesFilesCommon.getLightBoxPreview(\''+t.fileUploadId+"','"+this.faqData.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+"','"+ZSEC.Encoder.encodeForHTML(ZSEC.Encoder.encodeForHTML(t.fileName))+"','"+ZSEC.Encoder.encodeForHTML(ZSEC.Encoder.encodeForHTML(s))+"','"+(t.hasOwnProperty("previewFileId")?t.previewFileId:"")+'\')"> <div> <div class="zpl_atchimg"> <i class="'+i+'"></i> </div> <div class="zpl_atchdtl"> <h4>'+ZSEC.Encoder.encodeForHTML(t.fileName)+"</h4> <p><span>"+(null!=t.filesize?t.filesize:"")+"</span></p> </div> </div> </div>"}return this.filesHtm=""!=e?'<div class="zpl_secn"> <div> <h5>'+ZPI18N.getString("zp.attachment")+'</h5> </div> <div class="flex-wrap zpl_idiv">'+e+"</div> </div>":"",this.filesHtm}_tagsHtml(){let e="";return $.each(this.faqData.tagsArr,(function(t,s){e+='<div class="zpl_tg"><span>'+s.tagName+"</span></div>"})),this.tagHtm=""!=e?'<div class="zpl_secn"> <div> <h5>'+ZPI18N.getString("zp.tags")+"</h5> </div> <div>"+e+"</div> </div>":"",this.tagHtm}_relFAQHtml(){let e="";return $.each(this.faqData.relFaqArr,(function(t,s){e+=`<div class="zpl_qalst" faqid="${s.faqID}"><div class="zpl_qalsthdr"><div class="zpl_qalsthd"><div></div><div><h5>${s.query}</h5><p>${ZPeople.escapeHtml(ZPFeeds.getTextContent(s.answer)).slice(0,180)}</p><div class="zpl_qalsthdbtm"><div class="zpl_tg"><span>${s.catalogName}</span></div></div></div></div></div></div>`})),this.relFAQHtm=""!=e?'<div class="zpl_secn"> <div> <h5>'+ZPI18N.getString("zp.relfaq")+'</h5> </div> <div class="zpl_qacrd">'+e+"</div> </div>":"",this.relFAQHtm}_likesHtm(){let e="",t="";return this.faqData.reactObj.hasOwnProperty("isReactedType")&&(1==this.faqData.reactObj.isReactedType?e="grn":0==this.faqData.reactObj.isReactedType&&(t="red")),this.reactHtm=`<div class="zpl_secn"> <div> <h4>${ZPI18N.getString("zp.helpfull")}</h4> </div> <div class="zpl_idiv j-cnt-btwen"> <div class="zpl_reviewconinfo"> <label id="zpl_like_count" class="zpl_hvr zpl_hvrsw"> <i id="likeFaq" class="PI_like ${e}"></i> <span id="like_cnt">${ZPI18N.getString("zp.yes")}</span></label> <label id="zpl_dislike_count" class="zpl_hvr zpl_hvrsw"> <i id="dLikeFaq" class="PI_unlike ${t}"></i><span id="dislike_count">${ZPI18N.getString("zp.no")}</span> </label> </div> ${(casesObj.ISCASEADMIN||this.faqData.isCgyAgent)&&this.faqData.isReportAvailable?`<div> <div> <a id="faqAnlyts"> <i class="PI_vreport_analytic"></i> <span>${ZPI18N.getString("zp.analytics")}</span> </a> </div> </div>`:""} </div> </div>${this.faqData.reactObj.hasOwnProperty("isReactedType")?"":'<div id="cmtSec" class="zpl_secn zpl_DNI"> <div> <h5>Comments</h5> </div><div><textarea id="cmtTxt" class="ztextbox"></textarea><button id="pstCmt" class="zlabel zlabel--blue zlabel--medium">Post</button></div></div>'}`,this.reactHtm}likeListen(){let e=this;this.$like.off().on("click",(function(t){t.stopPropagation(),e.sendLikeDisLikeXHR({type:1}),(e.reactStatus="success")&&e.$like.addClass("grn")}))}disLikeListen(){let e=this;this.$dLike.off().on("click",(function(t){t.stopPropagation(),e.$faqCnt.find("#cmtSec").removeClass("zpl_DNI"),e.$faqCnt.find("#pstCmt").off().on("click",(function(){e.sendLikeDisLikeXHR({type:0,comment:e.$faqCnt.find("#cmtTxt").val()}),(e.reactStatus="success")&&(e.$dLike.addClass("red"),e.$faqCnt.find("#cmtSec").addClass("zpl_DNI"))}))}))}sendLikeDisLikeXHR(e){let t=this;return new Promise(((s,i)=>{e.method="LikeOrDisLikeFaq",e.recordId=t.faqId,e.conreqcsr=csrfToken;let a="/cases/faq/reaction";window.location.hash.includes("resources")&&(a="/services/faq/reaction",e.serviceName=CustomServiceResources.SERVICE_NAME),ZPeople.Request.send(a,e,(function(e){t.reactStatus=e.status,s()}))}))}fetch(){let e=this;return new Promise(((t,s)=>{let i={conreqcsr:csrfToken,method:"singleFAQDetails",faqId:e.faqId},a="/cases/faq/info";window.location.hash.includes("resources")&&(a="services/faq/view",i={conreqcsr:csrfToken,method:"singleFAQDetails",faqId:e.faqId,serviceName:CustomServiceResources.SERVICE_NAME}),ZPeople.Request.send(a,i,(function(s){e.faqData=s,t()}))}))}setFaqData(e){this.faqData=e,this.faqSldr=new sliderModal(e.query),this.faqTab=new Tab("faq"+e.faqID),this.faqSldr.setTab(this.faqTab)}}class FaqReport{constructor(e,t){this.faqId=e,this.categoryId=t,this.$pageDiv=Layout.Page.container,this.renderId="faqDonutChart",this.likeBg="#3EE0BA",this.dislikeBg="#FF7270"}async init(){this.addOuterCnt(),this.pageLoading=new LoadingClass(this.$faqRept.find(".zpl_minr")),this.pageLoading.add(),this.listen(),await this.fetch(),this.faqReport.disLikeCount>0||this.faqReport.likeCount>0?(this.pageLoading.remove(),this.construct()):(this.close(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.survey.reports.nodata.header")))}construct(){this.constructChart(),this.likeNdisLikeSec(),this.listen()}addOuterCnt(){this.$pageDiv.append(`<div id="faqRept" faqId=${this.faqId} class="zpl_mdl zpl_faqaly zpl_mopen" > <div class="zpl_minr"> <div id="faqReptHd" class="zpl_mhder"> <div class="d-flexcap a-itm-cntr"> <i id="faqRptCls" class="_cls PI_back"></i> <h4>${ZPI18N.getString("zp.analytics")}</h4> </div> </div> <div id="faqRptCnt" class="zpl_mcnt"> </div> </div> </div>`),this.$faqRept=this.$pageDiv.find("#faqRept"),this.$faqRptCnt=this.$faqRept.find("#faqRptCnt")}async fetch(){let e=this;return new Promise(((t,s)=>{let i={conreqcsr:csrfToken,method:"faqReport",faqId:e.faqId,categoryId:e.categoryId},a="/cases/faq/report";if(window.location.hash.includes("resources")){a="/services/faq/report";var n=window.location.hash.split("/")[2],l=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==n.toLowerCase()}));i.serviceName=l[0].tabName}ZPeople.Request.send(a,i,(function(s){e.faqReport=s,t()}))}))}close(){this.$faqRept.removeClass("zpl_mopen")}show(){this.$faqRept.addClass("zpl_mopen")}listen(){this.faqRptCls(),this.faqReactHdr()}faqReactHdr(){let e=this;this.$faqRptCnt.find("#reactCrdHdr li").off().on("click",(function(t){t.stopPropagation(),$(this).siblings("li").removeClass("zpl_act"),$(this).addClass("zpl_act"),"1"==$(this).attr("type")?e._actLik():e._actDLik()}))}faqRptCls(){let e=this;this.$faqRptCls=this.$faqRept.find("#faqRptCls"),this.$faqRptCls.off().on("click",(function(t){t.stopPropagation(),e.close()}))}likeNdisLikeSec(){this.reactHtm=`<div id="reactCrd" class="zpl_crd"> <div class="zpl_crdhdr"> <div> <div class="zpl_hdcnt nomrgn"> <ul id="reactCrdHdr" class="zpl_tabpane"> ${this.faqReport.likeCount?`<li id="likeLi" type="1"> <a><i class="PI_like grn"></i> <span>${ZPI18N.getString("zp.like")}</span></a> </li>`:""} ${this.faqReport.disLikeCount?`<li id="dLikeLi" type="0"> <a><i class="PI_unlike red"></i> <span>${ZPI18N.getString("zp.dislike")}</span></a> </li>`:""} </ul> </div> </div> </div> <div class="zpl_crdcnt"> <div id="reactCnt" class="zpl_tabcnt"> ${this.faqReport.likeCount?`<div id="likedfaq"> <div class="zpl_secn"> <ul class="zpl_lkstr"> ${this.reactRows(this.faqReport.likeEmpArr)} </ul> </div>`:""} </div> ${this.faqReport.disLikeCount?`<div id="dislikedfaq" > <div class="zpl_secn"> <ul class="zpl_lkstr"> ${this.reactRows(this.faqReport.disLikeEmpCmtArr)} </ul> </div> </div>`:""} </div> </div> </div>`,this.$faqRptCnt.append(this.reactHtm),this.$reactLi=this.$faqRptCnt.find("#reactCrdHdr li"),this.$reactCntDiv=this.$faqRptCnt.find("#reactCnt").children(),this.faqReport.likeCount>0?this._actLik():this._actDLik()}_actLik(){this.$reactLi.removeClass("zpl_act"),this.$reactCntDiv.addClass("zpl_DNI"),this.$faqRptCnt.find("#likeLi").addClass("zpl_act"),this.$faqRptCnt.find("#likedfaq").removeClass("zpl_DNI")}_actDLik(){this.$reactLi.removeClass("zpl_act"),this.$reactCntDiv.addClass("zpl_DNI"),this.$faqRptCnt.find("#dLikeLi").addClass("zpl_act"),this.$faqRptCnt.find("#dislikedfaq").removeClass("zpl_DNI")}reactRows(e){let t="";for(let s in e)s=e[s],t+=`<li> <div class="j-cnt-btwen"> <div class="zpl_em"> <div class="zpl_emimg"><img src="${s.employeePhoto}"></div> <div class="zpl_emdts"> <span>${s.empid} - </span><span>${s.name}</span> </div> </div> ${s.reactedTime?`<div> <span class="gry"> ${s.reactedTime}</span> </div>`:""} </div> ${s.comment?`<div> <p> ${s.comment}</p> </div>`:""} </li>`;return t}constructChart(){this.chartHtm=`<div id="faqPieCrd" class="zpl_crd"> <div class="zpl_dashcard"> <div class="zpl_dashbody"> <div class="zpl_dashcht"> <div id="faqDonutChart" class="pie-data" style="width: 180px; height: 180px; margin: 10px auto 5px; overflow: hidden;"></div> <div class="zpl_dashchtdes"> <ul> <li> <div class="cod" style="background-color:${this.likeBg};"></div> ${ZPI18N.getString("zp.like")} <b id="faqLkCnt">${this.faqReport.likeCount}</b> </li> <li> <div class="cod" style="background-color:${this.dislikeBg};"></div> ${ZPI18N.getString("zp.dislike")} <b id="faqDLkCnt">${this.faqReport.disLikeCount}</b> </li> </ul> </div> </div> </div> </div> </div>`,this.$faqRptCnt.append(this.chartHtm),this.initChart()}initChart(){let e=this;this.chart=new Highcharts.Chart(e.renderId,{chart:{plotBackgroundColor:null,plotBorderWidth:0,plotShadow:!1,margin:[0,0,0,0],spacingTop:0,spacingBottom:0,spacingLeft:0,spacingRight:0},title:{verticalAlign:"middle",useHTML:!0,style:{fontSize:"12px"},x:.5*(this.chartWidth-(this.spacingLeft+this.spacingRight)),y:.5*(this.chartHeight-(this.spacingTop+this.spacingBottom)),floating:!0,text:ZPI18N.getString("zp.totalEmplyees")+'<br><span style="font-size:20px;color: #000000; display:block; text-align: center; font-weight: bold">'+(e.faqReport.disLikeCount+e.faqReport.likeCount)+"</span>"},credits:{enabled:!1},tooltip:{formatter:function(){return this.point.name+" : "+this.y}},plotOptions:{pie:{shadow:!1,center:["50%","50%"],size:"100%",showInLegend:!1,states:{hover:{enabled:!0}},startAngle:0,endAngle:360},series:{point:{events:{click:function(){this.y>0&&(1==this.x?e._actLik():e._actDLik())}}}}},series:[{type:"pie",name:"Count",data:[{name:ZPI18N.getString("zp.liked"),x:1,y:e.faqReport.likeCount,color:e.likeBg},{name:ZPI18N.getString("zp.lms.content.Disliked"),x:2,y:e.faqReport.disLikeCount,color:e.dislikeBg}],innerSize:"90%",dataLabels:{enabled:!1}}],exporting:{enabled:!1,chartOptions:{title:{text:"Faq Report - "+e.faqId}},plotOptions:{series:{dataLabels:{enabled:!0}}},pie:{showInLegend:!0,dataLabels:{style:{cursor:"pointer"}}},buttons:{contextButton:{theme:{states:{hover:{stroke:"#000000",fill:null},select:{stroke:"#000000",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"Faq Report - "+e.faqId}})}}class AddCases{constructor(e){this.categoryId=e,this.employeeId=erecno,this.$pageDiv=Layout.Page.container,this.categoryData={},this.cgyInfo={},this.subCategoryData=[],this.filesAtt=[],this.params={},this.fileUp=$('<div><input name="refFile" onclick="this.value=null" multiple type="file"/></div>'),this.$pageDiv.append(` <div id="askUsCase" class="zpl_mdl zpl_mlg zpl_mopen" > <div class="zpl_minr"> <div class="zpl_mdlclum"> <div class="zpl_mdlclumlft"> <div id="aUlftHdr" class="zpl_mhder"> <div> <h4 id="aUlftHdrTxt"></h4> </div> </div> <div class="zpl_mcnt"> <div class="zpl_crd"> <div id="aUlftCnt" class="zpl_crdcnt"> <div id="reqSec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.requestor")}</label> </div> <div> <select id="reqSel" class="select-js" style="display: none;"> </select> </div> </div> <div id="cgySec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.category")}</label> </div> <div> <select id="cgySel" class="select-js" style="display: none;"> </select> </div> </div> <div id="subCgySec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.subcategory")}</label> </div> <div> <select id="subCgySel" class="select-js" style="display: none;"> </select> </div> </div> <div id="caseTypeSec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.casetype")}</label> </div> <div> <select id="caseTypeSel" class="select-js" style="display: none;"> </select> </div> </div><div id="mgrAgntSec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.agent")}</label> </div> <div> <select id="mgrAgntSel" class="select-js" style="display: none;"> </select> </div> </div> <div id="priorSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.priority")}</label> </div> <div> <select id="priorSel" class="select-js" style="display: none;"> </select> </div> </div><div id="sourceSec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.sourceofrequest")}</label> </div> <div> <select id="sourceSel" class="select-js" style="display: none;"> </select> </div> </div> <div id="subjSec" class="zpl_secn"> <div> <label class="zpl_mtry">${ZPI18N.getString("zp.subject")}</label> </div> <div> <input id="subjInp" type="text" class="ztextbox"> </div> </div> <div id="despSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.description")}</label> </div> <div class="zpl_msgedtr msgedtr_optnl"> <div class="zpl_feedCompsr zpl_edtrply tlbarTop"><div class="feedCompsr_area"> <div id="descEdi"> </div> </div></div> </div> </div> <div class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.attachments")}</label> </div> <div> <div class="zpl_upld fldupld"> <div class="zpl_fldrp"> <h5> <div class="zpl_flupld_img"></div> Upload from <a id="localUpload" class="zpl_lnk"><i class="PI_desktop"></i>${ZPI18N.getString("zp.files.desktop")}</a> / <a id="zohoUpload" class="zpl_lnk"><i class="PI_workdrive zpl_icnobg"></i>${ZPI18N.getString("zp.workdrive")}</a> / <a id="cldUpload" class="zpl_lnk"><i class="PI_cloud"></i>${ZPI18N.getString("zp.files.cloud")}</a> </h5> <div id="attchDiv" class="zpl_atchd atsml"> </div> </div> <p> <span>Maximum allowed files: 5</span> <span>Maximum size: 5MB</span> </p> </div> </div> </div><div id="stausSec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.status")}</label> </div> <div> <select id="statusSel" class="select-js" style="display: none;"> </select> </div> </div> <div id="resolSec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.resolution")}</label> </div> <div> <input id="resolInp" type="text" class="ztextbox"> </select> </div> </div> </div> </div> </div> </div> <div class="zpl_mdlclumrgt"> <div id="aUrgtHdr" class="zpl_mhder"> <div> <h4 id="aUrgtHdrTxt"></h4> </div> <a id="askUsCls" class="_cls PI_cls"></a> </div> <div class="zpl_mcnt"> <div class="zpl_crd"> <div id="aUrgtHdrCnt" class="zpl_crdcnt"> </div> </div> </div> </div> </div> <div id="aUcseFtr" class="zpl_mfoter"> <button id="aUcseFtrSbt" type="button" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.submit")}</button> <button id="aUcseFtrCnl" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.cancel")}</button> </div> </div> </div>`),this.$askUS=this.$pageDiv.find("#askUsCase"),this.$cgySel=this.$askUS.find("#cgySel"),this.$reqSel=this.$askUS.find("#reqSel"),this.$mgragntSel=this.$askUS.find("#mgrAgntSel"),this.$subCgySel=this.$askUS.find("#subCgySel"),this.$caseTypeSel=this.$askUS.find("#caseTypeSel"),this.$priorSel=this.$askUS.find("#priorSel"),this.$sourceSel=this.$askUS.find("#sourceSel"),this.$subjInp=this.$askUS.find("#subjInp"),this.$statusSel=this.$askUS.find("#statusSel"),this.$resolInp=this.$askUS.find("#resolInp"),this.$rgtCnt=this.$askUS.find("#aUrgtHdrCnt"),this.$attchDiv=this.$askUS.find("#attchDiv"),this.$localUpload=this.$askUS.find("#localUpload"),this.$zohoUpload=this.$askUS.find("#zohoUpload"),this.$cldUpload=this.$askUS.find("#cldUpload"),this.$saveBtn=this.$askUS.find("#aUcseFtrSbt")}_setCgyMode(){this.cgyMode=""==this.mode&&null==this.mode?casesObj.USER_CGY_LISTING:casesObj.AGENT_CGY_LISTING,this.cgyListObj=this.mode==casesObj.USER_CGY_LISTING?casesObj.USERVIEW_CATEGORY_LIST:casesObj.AGENTVIEW_CGY_LIST}fetchAskUsMode(){var e=-1!=Layout.Page.hash.indexOf("operations/hrcase");this.mode=e&&(Cases.isCaseAdmin(this.categoryId)||this.categoryData.isAgent)?casesObj.AgentAddMode:ZPeople.SUB_USERLIST.length>1?casesObj.ManagerAddMode:void 0}async _getPreRequiste(){await CommonMethod.getStatusList(),await CommonMethod.getPriorityList(),await CommonMethod.getSourceList(),await CommonMethod.getCaseTypeList()}async init(){let e=this;this.pageLoading=new LoadingClass(this.$askUS.find(".zpl_minr")),this.pageLoading.add(),this.setCategoryData(),this.initCgy(),this.$subjInp.trigger("focus"),this.initDesp(),this.setCgyInfo(),this._getPreRequiste().then((function(){e.initPriority(),e.fetchAskUsMode(),e.initRequestor(),e.initSubCgy(),e.initCaseType(),e.initMgrAgent(),e.initStatus(),e.initSource()})),this.pageLoading.remove(),this.listen()}initDesp(){let e=this;this.categoryData?.isDescMandatory&&this.$askUS.find("#despSec").find("label").addClass("zpl_mtry");var t={currentContainer:$("[id=askUsCase]"),editorheight:300,isMiniEditor:!0,isMentionsEnabled:!1};ZPFeeds.Editor.getEditor("descEdi","HrCase",t).afterEditorLoad((function(){setTimeout((function(){e.$subjInp.trigger("focus")}),50)}))}listen(){this.closeClk(),this.saveClk(),this.fileUpload()}saveClk(){let e=this;this.$saveBtn.off().on("click",(function(t){e.save()}))}save(){let e=this,t=!0;$("#aUcseFtrSbt").prop("disabled",!0),this.params={conreqcsr:csrfToken,methodName:"addHRCase"},this.params.categoryId=this.categoryId,this.subject=this.$subjInp.val().trim().replace(/ +/g," "),this.params.subject=this.subject,this.$askUS.find(".ztextbox--error__label").remove(),""==this.subject&&(this.addErrorDiv(this.$subjInp,ZPI18N.getString("zp.subjectemptymsg")),t=!1),this.subject.length>250&&(this.addErrorDiv(this.$subjInp,ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.subject"),"250"))),t=!1);let s=ZPFeeds.Editor.editorList.descEdi;if(null!=s&&(this.description=ZPFeeds.getSmileysAndMentions(s.getContent(),!1),this.params.description=this.description),this.categoryData?.isDescMandatory&&""==ZPFeeds.getTextContent(this.params.description)&&(this.addErrorDiv(this.$askUS.find("#despSec").children().last(),ZPI18N.getString("zp.casedescempty")),t=!1),this.mode==casesObj.AgentAddMode||this.mode==casesObj.ManagerAddMode){let e=this.$resolInp.val().trim().replace(/ +/g," ");this.params.status=this.status,this.params.messageText=e,this.params.comment=e}this.params.priority=this.priority,this.params.source=this.source,this.params.caseType=this.caseType,this.params.employeeId=this.employeeId,ZPUtil.Validation.isEmpty(this.subCategoryId)&&this.categoryData.isSubCategoryMandatory&&null!=this.categoryData.subCategoryList&&this.categoryData.subCategoryList.length>0&&(this.addErrorDiv(this.$subCgySel,"Subcategory cannot be empty"),t=!1),this.params.subCategoryId=this.subCategoryId,this.getFilesAttached().then((function(){t?e.submitCase():($("#aUcseFtrSbt").prop("disabled",!1),e._animateTop())}))}submitCase(){let e=this;var t=this.params;ZPeople.Request.send("/cases/add",t,(function(s){if("success"==s.status){var i='<a href="#hrcase/'+(t.employeeId==erecno?"myrequest":"watchlist")+"/view-caseid:"+s.zp_recordId+'">'+ZPI18N.getString("zp.here")+"</a>";ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.viewqueryraise",[i])),e.close()}else $("#aUcseFtrSbt").prop("disabled",!1),ZPeople.Message.showFailureMsg(s.desc)}),{},(function(e,t){$("#aUcseFtrSbt").prop("disabled",!1);var s=e.responseJSON;"case_attachment"==s.paramName&&"PATTERN_NOT_MATCHED"==s.code&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.projectattachmentnameerror"))}))}getFilesAttached(){let e=this,t=[],s=[],i=[];return new Promise(((a,n)=>{for(let a in e.filesAtt)a=e.filesAtt[a],"1"==a.type?t.push(a.data):"2"==a.type?s.push(a.data):"3"==a.type&&i.push(a.data);e.filesAtt.length>0?(t.length>0&&(e.params.case_attachment=JSON.stringify(t)),i.length>0||s.length>0?e.sendFileAction(i,s,t).then((function(){a()})):a()):a()}))}sendFileAction(e,t,s){let i=this;return new Promise(((a,n)=>{var l=new FormData;l.append("loginUserZUID",_ZUIDENRYPT),l.append("formId",0),l.append("tableName","P_HR_Case"),l.append("conreqcsr",csrfToken),l.append("uploadFromCloud",JSON.stringify(e)),l.append("uploadFromWD",JSON.stringify(t)),l.append("needJSONresponse",!0),$.ajax({url:"/fileUploadAction.zp",type:"POST",data:l,contentType:!1,processData:!1,cache:!1,error:function(e){var t=JSON.parse(err);ZPeople.Message.showFailureMsg(t.error),a()},success:function(e){if("7000"==e.code){var t=[];$.each(e.message,(function(e,s){var i={filePath:s.filePath,fileName:s.fileName};null==s.uploadSource||ZPSetupCommon.isEmpty(s.uploadSource)?i.uploadSource=0:i.uploadSource=s.uploadSource,t.push(i)})),i.params.case_attachment=JSON.stringify($.merge(t,s))}else ZPeople.Message.showFailureMsg(e.message);a()}})}))}addErrorDiv(e,t){e.parent().append(`<span class="ztextbox--error__label">${t}</span>`),this._animateTop()}_animateTop(){this.$askUS.find(".zpl_mcnt").animate({scrollTop:0},"slow")}fileUpload(){this.lclFileUpload(),this.cloudFileUpload(),this.zohoUpload();let e=this;this.$attchDiv.on("click",".PI_delete",(function(){let t=$(this).parent().parent();e.filesAtt.splice(t.index(),1),t.remove()}))}zohoUpload(){let e=this;this.$zohoUpload.off().on("click",(function(){e.$attchDiv.children().length<5?WorkDriveInt.showWorkDriveModal("AddCase"):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.maxfileupload"))}))}cloudFileUpload(){let e=this;this.$cldUpload.off().on("click",(function(){e.$attchDiv.children().length<5?(CloudPicker.init("hrcase-home",(function(){var e=JSON.parse(CloudPicker.getFileObj());e.labelName="case_attachment";let t=new CasesFiles(casesObj.addCaseObj.$attchDiv,e,3);t.success=!0,t.data=JSON.stringify(e),t.loadDNI="zpl_DNI",t.labelName="case_attachment",t.attachFile(),casesObj.addCaseObj.filesAtt.push(t)})),CloudPicker.construct()):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.maxfileupload"))}))}lclFileUpload(){let e=this;this.$localUpload.off().on("click",(function(){e.fileUp.find("input").trigger("click")})),this.fileUp.find("input").off("change").on("change",(async function(t){let s=$(this)[0].files;if(e.$attchDiv.children().length+s.length<=5){let t=[],i=[];for(let a of s){let s=new CasesFiles(e.$attchDiv,a,"1");s.attachFile(),t.push(s.upload()),i.push(s)}Promise.allSettled(t).then((t=>{t.forEach(((t,s)=>{"fulfilled"===t.status&&e.filesAtt.push(i[s])}))}))}else ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.maxfileupload"))}))}closeClk(){let e=this;this.$askUS.find("#askUsCls, #aUcseFtrCnl").off().on("click",(function(){e.close()}))}close(){this.$askUS.remove(),-1!=window.location.hash.indexOf("hrcase/askus")&&(window.location.href="#hrcase/home")}initPriority(){let e={options:casesObj.ALLPRIORITY,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$askUS,randomDropdownListId:!0,cacheData:!0,multiple:!1,dataMapping:{value:"systemValue",label:"optionValue"},contentType:"text",dropdownList:{contentType:"text"},selectedIndex:1};this.priority=casesObj.MEDIUM_SID,this.$priorSel.parents("#priorSec").removeClass("zpl_DNI"),ZPeopleComponents.select(this.$priorSel,e);let t=this;this.$priorSel.off("zselectoptionclick").on("zselectoptionclick",(function(e,s){t.priority=s.optionData.systemValue}))}show(){this.$askUS.addClass("zpl_mopen"),this.pageLoading.add(),this.reset(),this.pageLoading.add()}async reset(){this.$subjInp.trigger("focus"),null!=this.categoryId?this.$cgySel.parents("#cgySec").addClass("zpl_DNI"):ZPeopleComponents.select(this.$cgySel).setValue(this.categoryId),this._setCgyMode(),this.setCategoryData(),this.setCgyInfo(),this.initSubCgy(),this.$subjInp.trigger("focus"),this.$resolInp.parents("#resolSec").addClass("zpl_DNI"),this.$askUS.find("span.ztextbox--error__label").remove(),casesObj.AgentAddMode==this.mode?(ZPeopleComponents.select(this.$caseTypeSel).setValue(casesObj.OPEN_SID),ZPeopleComponents.select(this.$reqSel).setValue(erecno)):(this.$reqSel.parents("#reqSec").addClass("zpl_DNI"),this.$caseTypeSel.parents("#caseTypeSec").addClass("zpl_DNI"),this.employeeId=erecno,this.caseType=void 0),this.categoryData.typeOthers==CasesCommon.MANAGER_TYPE&&this.initMgrAgent()}getCgyInfo(){let e=this;return new Promise(((t,s)=>{let i=e.cgyInfo[e.categoryId];if(null==i||$.isEmptyObject(i)){let i={method:"fetchCatalogDetails",categoryId:e.categoryId,conreqcsr:csrfToken,mode:"userView"};ZPeople.Request.sendAsyncPost("/cases/category/view",i,(function(i){i.hasOwnProperty("status")&&"failure"==i.status?(ZPeople.Message.showFailureMsg(i.desc),s()):(casesObj.SUBCATEGORY_LIST[e.categoryId]=i.subCategories,e.cgyInfo[e.categoryId]=i,t())}))}else t()}))}async setCgyInfo(){let e=this,t=this.getCgyInfo();t.then((function(){let t=e.cgyInfo[e.categoryId];e.$askUS.find("#aUlftHdrTxt").parent().remove(),e.$askUS.find("#aUlftHdr").prepend(`<div> <h4 id="aUlftHdrTxt">${ZPI18N.getString("zp.submitrequeston",new Array(t.categoryName))}</h4> </div>`),e.$askUS.find("#aUrgtHdrTxt").parent().remove(),e.$askUS.find("#aUrgtHdr").prepend(`<div> <h4 id="aUrgtHdrTxt">${t.categoryName}</h4> </div>`);let s=""!=e._getAgentRow(t.categoryConfiguration[0].categoryAgents)?e._getAgentRow(t.categoryConfiguration[0].categoryAgents):"No agent available for your location";e.$rgtCnt.append(`<div class="zpl_secn"> <div> <p>${t.categoryShortDescription}</p> </div> </div>  ${""!=t.description&&"<div><br /></div>"!=t.description&&"<br />"!=t.description&&"<div>&nbsp;</div>"!=t.description?`<div class="zpl_secn"> <div> <h5>${ZPI18N.getString("zp.description")}</h5> </div> <div class="zpl_edtTxt"> <p>${ZPFeeds.Activity.getSmileys(t.description)}</p> </div> </div>`:""}<div class="zpl_secn"> <div> <h5>${ZPI18N.getString("zp.agentdetails")}</h5> </div> <div>${s} </div> </div> ${t?.subCategories?.length>0?`<div class="zpl_secn"> <div> <h5>${ZPI18N.getString("zp.subcategory")}</h5> </div> <div> <div class="zpl_tblres"> <table class="zpl_tbl wd100_per"> <thead> <tr> <th width="50%">${ZPI18N.getString("zp.subcategoryname")}</th> <th>${ZPI18N.getString("zp.agent")}</th> </tr> </thead> <tbody>${e._getSubCgyRow(t.subCategories)}</tbody> </table> </div> </div> </div>`:""} ${t.categoryConfiguration[0].categoryReferences?.length>0?`<div class="zpl_secn"> <div> <h5>${ZPI18N.getString("zp.knowledgebase")}</h5> </div>${e._getRefRow(t.categoryConfiguration[0].categoryReferences)} </div>`:""} ${t?.faqList?.length>0?`<div class="zpl_secn"> <div> <h5>${ZPI18N.getString("zp.faqs")}</h5> </div> <div class="zpl_tblres"> <table class="zpl_tbl wd100_per"> <tbody id="faqCgyBdy">${e._getFaqRow(t.faqList)}</tbody> </table> </div> </div>`:""}`),e.faqListen()})),t.catch((function(){e.close()}))}faqListen(){let e=this;this.$rgtCnt.find("#faqCgyBdy").off().on("click","tr",(function(){e.faqViewObj=new CasesFaqView($(this).attr("faqId")),e.faqViewObj.init()}))}_getFaqRow(e){let t="",s=!0;for(let i in e)i=e[i],s?(t+=`<tr faqId="${i.faqID}"> <td scope="row">${i.query}</td></tr>`,s=!1):t+=`<tr faqId="${i.faqID}"> <td>${i.query}</td></tr>`;return t}_getRefRow(e){let t="";for(let n in e){n=e[n];var s=ZPUtil.Validation.isEmpty(n.linkName)?n.link.substring(n.link.lastIndexOf("/")+1):n.linkName;if("2"==n.formType){let e=n.link.substring(n.link.lastIndexOf(".")+1);"0"!=n.uploadSource||ZPUtil.Validation.isEmpty(n.filePath)||(e=n.filePath.substring(n.filePath.lastIndexOf(".")+1));let i=FilesCommon.getFileIcon(e);"1"==n.uploadSource||n.link.indexOf(workDriveUrl)>-1||n.link.indexOf(writerUrl)>-1||n.link.indexOf(sheetUrl)>-1||n.link.indexOf(showUrl)>-1?(i="1"==n.uploadSource?FilesCommon.getFileIcon("workdrive"):"PI_cloud",t+='<div class="zpl_atchlnk" onclick=window.open("'+n.link+'")> <div><i class="'+i+'"></i><a>'+s+"</a></div> </div>"):t+='<div class="zpl_atchlnk" onclick="CasesFilesCommon.getLightBoxPreview(\''+n.linkId+"','"+this.categoryId+"','"+HR_CATEGORY_ATTACHEMENTS+"','"+ZSEC.Encoder.encodeForHTML(s)+"','"+e+"','"+(n.hasOwnProperty("filePath")?"attachmentz"+n.link:"")+'\')"> <div><i class="'+i+'"></i><a>'+s+"</a></div> </div>"}else{var i=n.link.match(/^http[s]*:\/\//),a=i?i+escape(n.link.split(/^http[s]*:\/\//)[1]):"https://"+escape(n.link);t+='<div class="zpl_atchlnk"> <div><i class="PI_link"></i><a rel="noopener noreferrer" target="_blank" title="'+unescape(a)+'" href="'+unescape(a)+'">'+s+"</a></div> </div>"}}return t}_getSubCgyRow(e){let t=this,s="";for(let i in e)i=e[i],s+=` <tr> <td> <div class="d-flexC"> <span>${i.subcategoryname}</span> </div> </td> <td> ${t._getAgentRow(i)} </td> </tr>`;return s}_getAgentRow(e){let t="",s="",i="";if("1"==e?.agentTypeId){let i=ZPeople.getUserDetailsById(e.agentValueId);t=`<img src="${i.avatar}">`,s=`<em>${i.empid} - </em><b>${e.owner}</b>`}else ZPUtil.Validation.isEmpty(e?.owner)||(t=`<span class="zpl_pichr PC2">${ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(e.owner)))}</span>`,s=`<b>${e.owner}</b>`);return ZPUtil.Validation.isEmpty(t)||ZPUtil.Validation.isEmpty(s)||(i=`<div class="zpl_em"> <div class="zpl_emimg">${t}</div> <div class="zpl_emdts"> <div>${s}</div> </div> </div>`),i}initRequestor(){if(this.mode==casesObj.AgentAddMode&&this.categoryData.typeOthers!=CasesCommon.MANAGER_TYPE){let e=this._getEmpSearchType(this.categoryData),t={};""!=e.type&&e?.locids&&(t.locids=e.locids);let s={showSearchField:!0,selectedIndex:0};s.options=EmployeeSearch.getEmpList("","emp",e.type,[],t,!0,[],!1,!0),s.dataSource={search:function(s){return new Promise((function(i,a){i({delay:20,results:EmployeeSearch.getEmpList(s.query,"emp",e.type,[],t,!0,[],!1,!0),more:!1})}))},paginated:!0},s.placeholder=ZPI18N.getString("zp.select"),s.serverSearch=!0,s.cacheData=!0,s.appendTo=this.$askUS,s.randomDropdownListId=!0,s.isLabelHTMLEncoded=!0,s.dataMapping={value:"id",label:"value",image:"image"},s.contentType="image-text",s.dropdownList={contentType:"image-text",isTextHTMLEncoded:!0},s.search={by:["value","email"]},ZPeopleComponents.select(this.$reqSel,s),this.$reqSel.parents("#reqSec").removeClass("zpl_DNI"),this.employeeId=erecno;let i=this;this.$reqSel.off("zselectoptionclick").on("zselectoptionclick",(function(e,t){i.employeeId=t.optionData.id}))}}_getEmpSearchType(e){let t={type:"HRCASES_ADDCASE_RT"};return Cases.CASES_ADMIN.isAdmin||e.isAgent&&e.hasOwnProperty("applicableLocations")&&e.applicableLocations.length<=0?t.type="HRCASES_ADDCASE_AGENT":e.isAgent&&e.hasOwnProperty("applicableLocations")&&e.applicableLocations.length>0?(t.type="HRCASES_ADDCASE_AGENT",t.locids=e.applicableLocations):!e.isAgent&&ZPeople.SUB_USERLIST.length>1?t.type="HRCASES_ADDCASE_RT":!e.isAgent&&ZPeople.SUB_USERLIST.length<=1&&(t.type=""),t}initMgrAgent(){let e=this;e.categoryData.typeOthers==CasesCommon.MANAGER_TYPE&&CasesCommon.getManagerList(e.employeeId).then((function(){let t={options:CasesCommon.MANAGER_LIST[usererecno],placeholder:ZPI18N.getString("zp.select"),appendTo:e.$askUS,randomDropdownListId:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:{value:"id",label:"value",image:"image"},contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0}};this.$mgragntSel.parents("#mgrAgntSec").removeClass("zpl_DNI"),ZPeopleComponents.select(e.$mgragntSel,t),e.mgrAgent="",e.$mgragntSel.off("zselectoptionclick").on("zselectoptionclick",(function(t,s){e.mgrAgent=s.optionData.systemValue}))}))}initCgy(){let e=this;return new Promise(((t,s)=>{if(null==e.categoryId){let t={value:"categoryId",label:"categoryName",iconClassName:ServiceIcons.getIconClass(iconName)},s={options:e.cgyListObj,placeholder:ZPI18N.getString("zp.select"),appendTo:e.$askUS,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:t,contentType:"image-text",dropdownList:{contentType:"image-text",bodyItemVisibleCount:7,isTextHTMLEncoded:!0},selectedIndex:0};e.$cgySel.parents("#cgySec").removeClass("zpl_DNI"),ZPeopleComponents.select(e.$cgySel,s),e.$cgySel.off("zselectoptionclick").on("zselectoptionclick",(function(t,s){e.categoryId=s.optionData.categoryId,e.setCgyInfo(),e.initSubCgy()})),e.categoryId=this.cgyListObj[0]?.categoryId}t()}))}initCaseType(){if(1==this.categoryData?.isCaseTypeEnabled){let e={value:"systemValue",label:"optionValue"},t={options:casesObj.CASETYPE,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$askUS,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0}};this.$caseTypeSel.parents("#caseTypeSec").removeClass("zpl_DNI"),ZPeopleComponents.select(this.$caseTypeSel,t),this.caseType="";let s=this;this.$caseTypeSel.off("zselectoptionclick").on("zselectoptionclick",(function(e,t){s.caseType=t.optionData.systemValue}))}}initStatus(){if(this.mode==casesObj.AgentAddMode){let e={value:"systemValue",label:"optionValue"},t={options:casesObj.STATUS,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$askUS,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0}};t.selectedValue=casesObj.OPEN_SID,this.$statusSel.parents("#stausSec").removeClass("zpl_DNI"),ZPeopleComponents.select(this.$statusSel,t),ZPeopleComponents.select(this.$statusSel).removeOption([casesObj.CANCELLED_SID]),this.status=casesObj.OPEN_SID;let s=this;this.$statusSel.off("zselectoptionclick").on("zselectoptionclick",(function(e,t){s.status=t.optionData.systemValue,casesObj.OPEN_SID!=t.optionData.systemValue?s.$resolInp.closest("#resolSec").removeClass("zpl_DNI"):s.$resolInp.closest("#resolSec").addClass("zpl_DNI")}))}}initSource(){if(casesObj.ISCASEADMIN){let e={value:"systemValue",label:"optionValue"},t={options:casesObj.SOURCE,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$askUS,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0}};this.source=casesObj.EAMIL_SID,this.$sourceSel.parents("#sourceSec").removeClass("zpl_DNI"),ZPeopleComponents.select(this.$sourceSel,t);let s=this;this.$sourceSel.off("zselectoptionclick").on("zselectoptionclick",(function(e,t){s.source=t.optionData.systemValue}))}}initSubCgy(){if(this.subCategoryData=casesObj.SUBCATEGORY_LIST[this.categoryId],this.subCategoryData.length>0){let e={value:"subCategoryId",label:"subcategoryname"},t={options:this.subCategoryData,clearButton:!this.categoryData.isSubCategoryMandatory,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$askUS,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:e,contentType:"image-text",dropdownList:{contentType:"text",bodyItemVisibleCount:7,isTextHTMLEncoded:!0},selectedIndex:-1};this.$subCgySel.parents("#subCgySec").addClass("zpl_DNI"),ZPeopleComponents.select(this.$subCgySel).destroy(),ZPeopleComponents.select(this.$subCgySel,t),this.$subCgySel.parents("#subCgySec").removeClass("zpl_DNI"),this.categoryData.isSubCategoryMandatory&&this.$askUS.find("#subCgySec").find("label").addClass("zpl_mtry");let s=this;this.$subCgySel.off("zselectoptionclick").on("zselectoptionclick",(function(e,t){s.subCategoryId=t.optionData.subCategoryId}))}else this.$subCgySel.parents("#subCgySec").addClass("zpl_DNI"),this.subCategoryId=void 0}async fetch(){$.isEmptyObject(this.cgyListObj)&&(await new Category(this.cgyMode).fetch(),this.cgyListObj=this.mode==casesObj.SUBMIT_CASE?casesObj.CATEGORY_LIST:casesObj.AGENTVIEW_CGY_LIST)}setCategoryData(){let e=this;null!=e.categoryId&&(e.categoryData=e._getCgyData(e.cgyListObj),$.isEmptyObject(e.categoryData)&&($.isEmptyObject(casesObj.USERVIEW_CATEGORY_LIST)?new Category(casesObj.USER_CGY_LISTING).fetch().then((function(){e.categoryData=e._getCgyData(casesObj.USERVIEW_CATEGORY_LIST)})):e.categoryData=e._getCgyData(casesObj.USERVIEW_CATEGORY_LIST)))}_getCgyData(e){for(let t in e)if(t=e[t],t.categoryId==this.categoryId)return t}}class CasesFiles{constructor(e,t,s){this.file=t,this.fileObj={},this.$attachDiv=e,this.type=s,this.loadDNI="",this.cmtAttach=!1,this.appInfo={},this.intervalId=null,this.fieldName="caseattachment",this.formTable="",this.success=!1}static zohoUpload(e){let t=new CasesFiles(casesObj.addCaseObj.$attchDiv,e,2);t.success=!0,t.data=e,t.loadDNI="zpl_DNI",t.attachFile(),casesObj.addCaseObj.filesAtt.push(t)}attachFile(){3==this.type?this.fileName=this.file.docName:this.fileName=this.file?.name||this.file?.fileName,this.fileExtn=this.fileName.substring(this.fileName.lastIndexOf(".")+1),this.fileIcon=2==this.type?"PI_workdrive":FilesCommon.getFileIcon(this.fileExtn),this.fileSize=null!=this.file.size?FilesCommon.getFileSize(this.file.size):"",this.fileName=ZPeople.escapeHtml(this.fileName),this.$fileDiv=$(`<div type="${this.type}"> <div class="zpl_atchimg"> <i class="${this.fileIcon}"></i> </div> <div class="zpl_atchdtl"> <h4>${this.fileName}</h4> <p><span id="fSize">${this.fileSize}</span></p> </div> <div class="zpl_atchicn"> <i class="PI_delete"></i> </div> <div id="loadDiv" class="zpl_prgbr ${this.loadDNI}"> <div> <div id="loader" style="width:10%"></div> </div> </div> </div>`),this.$loadDiv=this.$fileDiv.find("#loadDiv"),this.cmtAttach?this.$attachDiv.append($('<div class="zpl_atchd atsml"></div>').append(this.$fileDiv)):this.$attachDiv.append(this.$fileDiv)}upload(){let e=this;return new Promise(((t,s)=>{e.initLoad();let i=(new Date).getTime()+"_"+_LOGGEDIN_ZUID;Layout.ISLOCALIDCSETUP&&(UDS_UPLOAD_SERVICE_CODE=window.location.host.split(".")[0]);let a=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload",n=new XMLHttpRequest;n.instanceKey=n.upload.instanceKey=this.instanceKey,n.uploadId=n.upload.uploadId=i,this.appInfo.portalId=_LOGGEDIN_ACCZSOID,this.appInfo.moduleName="HRCase",this.appInfo.fieldName=e.fieldName,this.appInfo.formTableName=e.formTable,n.open("post",a,!0),n.setRequestHeader("x-assured-response",!0),n.setRequestHeader("x-streammode","1"),n.setRequestHeader("app-info",JSON.stringify(e.appInfo)),n.setRequestHeader("file-info",JSON.stringify({fileName:encodeURIComponent(e.file.name),contentType:e.file.type,fileSize:e.file.size})),n.setRequestHeader("upload-id",i),n.withCredentials=!0,n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let s=JSON.parse(this.response);e.success=!0,e.afterSuccess(s.fileInfo),t()}else 4==this.readyState&&200!=this.status&&(e.afterFailure(),t())},n.send(e.file)}))}afterSuccess(e){this.$loadDiv.find("#loader").css("width","100%"),this.$loadDiv.remove(),this.fileSize=null!=e.size?FilesCommon.getFileSize(e.fileSize):"",this.$fileDiv.find("#fSize").text(this.fileSize),this.$fileDiv.attr("fileId",e.fileId),this.data={filePath:e.fileId,fileName:e.fileName,fileSize:e.fileSize}}afterFailure(e){ZPeople.Message.showFailureMsg(e.message),this.$fileDiv.remove()}initLoad(){let e=this,t=10;this.intervalId=setInterval((function(){t+=1,t>100&&(t=90,clearInterval(e.intervalId)),e.$loadDiv.find("#loader").css("width",t+"%")}),100)}}class CaseViewPage{constructor(e,t){this.caseId=e,this.$pageDiv=t,this.noteId=void 0,this.fileUp=$('<div><input name="refFile" onclick="this.value=null"  type="file"/></div>'),this.fileCount=0,this.status=void 0,this.assigneeList=[],this.moreOpt=[],this.allowDelete=!1,this.allowUnassign=!1,this.allowFollowCase=!1,this.allowCancel=!1,this.recentCases={},this.allowTask=!1}static casesAdmin={};static fetchAdminPerm(){if($.isEmptyObject(CaseViewPage.casesAdmin)){var e=!1;ZPeople.Request.sendAsyncPost("/cases/admin/data",{method:"getUserCasesAdminData",conreqcsr:csrfToken},(function(t){e=t.isCasesAdmin,CaseViewPage.casesAdmin.categoryAdmin=t.categoryAdmin})),CaseViewPage.casesAdmin.isAdmin=e}return CaseViewPage.casesAdmin}static toCheckFeedEditorCustomeBtnPerm(e){var t={},s=void 0!==e&&e.isAgent,i=CasesCommon.isCaseAdmin(),a=!(null==e||!e.hasOwnProperty("hr_categoryId"))&&CasesCommon.isCaseAdmin(e.hr_categoryId);return t.isComment=null!=e,t.isAgent=s||i||a,t.isEscalatorUser=void 0!==e&&e.isEscalatedUser,t}async init(){this.$pageDiv.find("#caseView").remove(),this.pageLoading=new LoadingClass(this.$pageDiv),this.pageLoading.add(),await this.fetch(),this.construct()}fetch(){let e=this;return new Promise(((t,s)=>{let i={conreqcsr:csrfToken,method:"getInfoInCase",caseId:e.caseId};ZPeople.Request.send("/cases/view",i,(function(s){"success"==s.status?(e.viewCaseDataOnly=s.InfoPanel.viewCaseDataOnly,e.caseDtls=s.InfoPanel.caseDtls,e.caseObj=s):ZPeople.Message.showFailureMsg(s.desc),t()}))}))}construct(){this.constructOuter(),this.constructCaseData(),this.constructCmt(),this.constructEditor(),this.constructRgtActions(),this.constructRecentData(),this.listen(),this.pageLoading.remove(),this.$caseView.addClass("zpl_mopen"),this.scrollComment()}listen(){this.headerListen(),this.cmtRowListen(),this.cmtSecListen(),this.rightSecListen()}headerListen(){this.close(),this.moreOption(),this.slaListen()}cmtRowListen(){this.shareFaq(),this.downloadImg(),this.deleteCmt(),this.attachView()}constructOuter(){this._cvOuter=`<div id="caseView" streamid="${this.caseId}" fdk="${this.caseObj?.HRCaseFeedComment?.fdk}" class="zpl_mdl zpl_mfull" aria-label = "You are viewing ${this.caseDtls.subject} case. Current priority - ${this.caseDtls.priority}. Handled by - ${this.caseDtls.agentDetails}." tabindex="0"> <div streamid="${this.caseId}" fdk="${this.caseObj?.HRCaseFeedComment?.fdk}" class="zpl_minr zpl_cSvw"> <div id="cvHdr" class="zpl_mhder"> <div> <a class="clsArw"> <i id="cvBck" class="PI_back"></i> </a> <span class="d-flexC"><b>${this.caseDtls.caseId}</b><span class="zpl_dots"></span><em>${this.caseDtls.subject}</em></span> </div> <div id="cvHdrRgt" class="zpl_mhderrgt"><a id="cvMre" class="PI_more zpl_DNI zpl_btnic zpl_drpdwn-js" ></a> </div> <a id="cvCls" class="_cls PI_cls"></a> </div> <div id="cvCnt" class="zpl_mcnt"> <div class="zpl_mmnu"> <div class="zpl_mmnurgt"> <div class="zpl_act"> <div class="zpl_cSvnt"> <div id="cvLftCnt" class="zpl_cSnLt"> </div><div id="cvRgt" class="zpl_cSnRt"> <div class="zpl_crd"> <div id="cvRgtCnt" class="zpl_crdcnt">${this.requestorInfo()} </div> </div> </div></div> </div> </div> </div> </div> </div> <div id="cvMreList" style="display: none;"></div> </div>`,this.$pageDiv.append(this._cvOuter),this.$caseView=this.$pageDiv.find("#caseView"),this.$cvHdrRgt=this.$caseView.find("#cvHdrRgt"),this.$cvLftCnt=this.$caseView.find("#cvLftCnt"),this.$cvRgtCnt=this.$caseView.find("#cvRgtCnt"),this.slaHrd(),this.setMoreOption()}remove(){this.$pageDiv.find("#caseView").remove()}requestorInfo(){let e=this.caseDtls.requestor;return this._reqSec=` <div class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.requestor")}</label> </div> <div> <div popup="user" empid="${e.zuid}" class="zpl_em"> <div class="zpl_emimg"> <img src="${e.employeePhoto}"> </div> <div class="zpl_emdts zpl_ellipsis"> <div><em>${e.empid}</em> - <b>${e.name}</b></div> <div> <em>${e.employeeEmailAlias}</em> </div> </div> </div> </div> </div>`,this._reqSec}close(){let e=this;this.$pageDiv.find("#cvBck, #cvCls").off().on("click",(function(){e.$caseView.remove(),-1!==Layout.Page.hash.indexOf("#hrcase/myrequest")?window.location.href="#hrcase/myrequest/list":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/list/")?window.location.href="#operations/hrcase/agent/list":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/allcases/filter")?window.location.href=`#operations/hrcase/agent/allcases/list-categoryid:${e.caseId}/status:1`:-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/allcases/")?window.location.href="#operations/hrcase/agent/allcases/list":-1!==Layout.Page.hash.indexOf("#hrcase/watchlist/")?window.location.href="#hrcase/watchlist/list":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/escalation/")?window.location.href="#operations/hrcase/agent/escalation/list":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/unassigned/")?window.location.href="#operations/hrcase/agent/unassigned/list":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/opencases/")?window.location.href="#operations/hrcase/agent/opencases/list":-1!==Layout.Page.hash.indexOf("#operations/hrcase/agent/unmanaged/")&&(window.location.href="#operations/hrcase/agent/unmanaged/list")}))}setMoreOption(){this.allowDelete=this.caseObj.InfoPanel?.allowDelete||!1,this.allowUnassign=this.caseObj.InfoPanel?.unassign||!1,this.allowFollowCase=this.caseDtls.requestor.erecno!=erecno,this.allowCancel=this.caseDtls.requestor.erecno==erecno,null!=this.caseDtls?.recordOwner&&this.caseDtls.requestor.erecno!=erecno&&(this.allowCancel=this.caseDtls.recordOwner.erecno==erecno)}_setMoreList(){this.moreOpt=[],this.caseDtls?.statusId!=casesObj.CANCELLED_SID&&this.caseDtls?.statusId!=casesObj.COMPLETED_SID&&(this.allowFollowCase&&!this.caseDtls.hasOwnProperty("followerMode")&&this.moreOpt.push({id:"followCase",value:ZPI18N.getString("zp.followcase")}),this.allowCancel&&this.moreOpt.push({id:"cancelCase",value:ZPI18N.getString("zp.cancelReq")}),this.allowUnassign&&this.moreOpt.push({id:"unassignCase",value:ZPI18N.getString("zp.unassign")})),this.allowDelete&&this.moreOpt.push({id:"delCase",value:ZPI18N.getString("zp.deletecase")})}moreOption(){if(this._setMoreList(),this.$cvMre=this.$cvHdrRgt.find("#cvMre"),this.$cvMreList=this.$caseView.find("#cvMreList"),this.moreOpt.length>0){this.$cvMre.removeClass("zpl_DNI");let e={value:"id",text:"value"},t={contentType:"text",viewport:this.$caseView,appendTo:this.$caseView,randomDropdownListId:!0,forElement:this.$cvMre,items:this.moreOpt,dataMapping:e,displayType:"callout",bodyItemVisibleCount:5,position:"left"},s=this;null!=ZPeopleComponents.dropdownlist(this.$cvMreList)&&ZPeopleComponents.dropdownlist(this.$cvMreList).destroy(),ZPeopleComponents.dropdownlist(this.$cvMreList,t),this.$cvMre.off().on("click",(function(){ZPeopleComponents.dropdownlist(s.$cvMreList).deselectAll(),ZPeopleComponents.dropdownlist(s.$cvMreList).open()})),this.$cvMreList.on("zdropdownlistitemclick",(function(e,t){switch(t.itemData.id){case"followCase":s.followCase();break;case"cancelCase":s.cancelCase();break;case"unassignCase":s.unAssignCase();break;case"delCase":s.deleteCase()}}))}else this.$cvMre.addClass("zpl_DNI")}followCase(){let e={conreqcsr:csrfToken,method:"followCase",zp_recordId:this.caseId,followCase:!0},t=this;ZPeople.Request.send("/cases/follow",e,(function(e){"success"==e.status&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.followcasesucs")),ZPeopleComponents.dropdownlist(t.$cvMreList).removeItems([{id:"followCase",value:ZPI18N.getString("zp.followcase")}]))}))}cancelCase(){let e=this,t=new InfoAlertMessage(ZPI18N.getString("zp.cancelReq"),ZPI18N.getString("zp.canceledmsg"));t.removeAfterYes=!0,t.setCallback((function(){let t={conreqcsr:csrfToken,status:casesObj.CANCELLED_SID,zp_recordId:e.caseId,method:"changeCaseStatus"};ZPeople.Request.send("/cases/status/change",t,(function(s){"success"==s.status?(s.statusId=t.status,e.afterStatusUpdate(s),e.afterActionsCommentUpdate(s)):ZPeople.Message.showFailureMsg(s.desc)}))})),t.show()}unAssignCase(){let e={conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:this.caseId,assignedId:0},t=this;ZPeople.Request.send("/cases/assigned",e,(function(e){"success"==e.status?(t.afterActionsCommentUpdate(e),ZPeopleComponents.select(t.$cseAgtSel).setAttribute("placeholder",ZPeople.decodeTxt(e.agent_details)),ZPeopleComponents.select(t.$cseAgtSel).deselectAllOptions()):ZPeople.Message.showFailureMsg(e.desc)}))}deleteCase(){let e=this,t=new DeleteAlertMessage(ZPI18N.getString("zp.delete"),ZPI18N.getString("zp.confirmdeletecases"));t.removeAfterYes=!0,t.isDoubleCnf=!0,t.setCallback((function(){let t={method:"deleteCase",caseId:e.caseId,conreqcsr:csrfToken};ZPeople.Request.send("/cases/delete",t,(function(t){"success"==t.status?(e.$pageDiv.find("#cvBck").trigger("click"),$('tr[caseId="'+e.caseId+'"]').remove()):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannotdeletecases"))}))})),t.show()}slaHrd(){if(this.slaHtm="",null!=this.caseObj.sla&&null!=this.caseObj.sla.currentStatus){let e=SLACommon.getSlaTimeAndColor(this.caseObj.sla,"band"),t="",s="";"escalated"==e.status||"paused"==e.status?(t=e.text,s="00 : 00 : 00"):(t=ZPI18N.getString("zp.caseclosesin"),s=e.text),this.slaHtm=`<div id="slaBandHdr" class="zpl_cSlt ${e.color}">\n                    <span>${t}</span>\n                    <p id="sla_time" class="">${s}</p>\n                </div>`,this.$cvHdrRgt.prepend(this.slaHtm),clearInterval(SLACommon.timer),SLACommon.timer=setInterval(SLACommon.setSLATimer,1e3)}return this.slaHtm}slaListen(){let e=this;this.$cvHdrRgt.find("#slaBandHdr").off().on("click",(function(){e.slaHis=new SlaHistory(e),e.slaHis.init()}))}constructCaseData(){let e=`<div class="zpl_cSnLtIn"> <div id="cmtRwDiv" class="zpl_tmln zpl_adhstry"><div id="caseData" class="zpl_tmlnrow" aria-label = '${`${this.caseDtls.requestor.name} wrote ${this.caseDtls.subject}, ${ZSEC.Encoder.encodeForHTMLAttribute(this.caseDtls.description)} on ${this.caseDtls.requestedTime}. `}'> <div class="zpl_tmlnrgt"> <div class="zpl_crd"> <div class="zpl_usrpfl"> <div class="zpl_em"> <div class="zpl_emimg"><img src="${this.caseDtls.requestor.employeePhoto}" alt="${this.caseDtls.requestor.name}"></div> </div> <div empid="${this.caseDtls.requestor.zuid}" popup="user" class="zpl_usrdtls"> <div><span>${this.caseDtls.requestor.empid} - <b> </b> ${this.caseDtls.requestor.name}</span></div> </div> <div> <date>${ZPDateTime.getDateDisplayFormat(this.caseDtls.createdTime)}</date> </div> </div> <div class="zpl_cSdtls"> <div> <p>${this.caseDtls.subject}</p> </div> <div class="zpl_cScntdtls"> <p>${ZPFeeds.Activity.getSmileys(this.caseDtls.description)}</p> </div> </div> ${this.caseObj.InfoPanel?.filesList?.length>0?`<div class="zpl_cSdtls"> <div> <h5>${ZPI18N.getString("zp.attachments")}</h5> </div> <div class="flex-wrap zpl_idiv">${this.getAttachList()}</div> </div>`:""} </div> </div> </div></div> </div>`;this.$cvLftCnt.append(e),this.$cmtRwDiv=this.$cvLftCnt.find("#cmtRwDiv")}getAttachList(){let e=this.caseObj.InfoPanel.filesList,t="";for(let s=0;s<e.length;s++){let i=e[s],a=i?.previewFileId?i.previewFileId:"",n=i.fileName.substring(i.fileName.lastIndexOf(".")+1),l=FilesCommon.getFileIcon(n);"1"==i.uploadSource||i.filePath.indexOf(workDriveUrl)>-1||i.filePath.indexOf(writerUrl)>-1||i.filePath.indexOf(sheetUrl)>-1||i.filePath.indexOf(showUrl)>-1?(l="PI_cloud",t+=`<div onclick="window.open('${i.filePath}')" class="zpl_atchd atsml"> <div> <div class="zpl_atchimg"> <i class="${l}"></i> </div> <div class="zpl_atchdtl"> <h4>${ZSEC.Encoder.encodeForHTML(i.fileName)}</h4> ${i?.filesize?`<p><span>${i?.filesize}</span></p>`:""} </div> </div> </div>`):t+=`<div onclick="CasesFilesCommon.getLightBoxPreview('${i.fileUploadId}','${this.caseId}', '${HR_CASE_ATTACHEMENTS}','${ZSEC.Encoder.encodeForHTML(ZSEC.Encoder.encodeForHTML(i.fileName))}','${ZSEC.Encoder.encodeForHTML(ZSEC.Encoder.encodeForHTML(n))}','${a}')" class="zpl_atchd atsml"> <div> <div class="zpl_atchimg"> <i class="${l}"></i> </div> <div class="zpl_atchdtl"> <h4>${ZSEC.Encoder.encodeForHTML(i.fileName)}</h4> ${i?.filesize?`<p><span>${i?.filesize}</span></p>`:""} </div> </div> </div>`}return t}constructCmt(){let e=this;if(this.caseObj.HRCaseFeedCommentCount>0&&this.caseObj?.HRCaseFeedComment?.comments.length>0){this.comments=this.caseObj.HRCaseFeedComment.comments,this.cmtHtm="";for(let e=0;e<this.comments.length;e++)this.cmtHtm+=new CommentRow(this.comments[e],this.caseObj.HRCaseFeedComment.departmentDts,this.caseObj.HRCaseFeedComment.groupDts).constructCmtRow();if(this.caseObj.InfoPanel.hasOwnProperty("feedbackComment")){var t=ZPeople.getUserDetailsById(e.caseObj.InfoPanel.feedbackComment.commby),s={zuid:t.id,empid:t.empid,name:t.name,employeePhoto:t.avatar};$.each(e.caseObj.InfoPanel.feedbackComment.commentArr,(function(t,i){var a=i;a.commbyinfo=s,a.isFeedbackComment=!0,e.cmtHtm+=new CommentRow(a,e.caseObj.HRCaseFeedComment.departmentDts,e.caseObj.HRCaseFeedComment.groupDts).constructCmtRow()}))}this.$cmtRwDiv.append(this.cmtHtm),this.feedbackRow=new feedbackSubmit(this),this.feedbackRow.constructFeedbackRow()}}shareFaq(){this.$cvLftCnt.on("click","[name^=sharefaq]",(function(){var e=$(this).attr("name").split("sharefaq");new CasesFaqView(e[1]).init()}))}downloadImg(){this.$cvLftCnt.on("click",".PI_downld",(function(e){e.stopPropagation(),window.location.href=$(this).parent().closest(".zpl_atchd").attr("downloadurl")}))}deleteCmt(){this.$cvLftCnt.on("click",'[name="delCmt"]',(function(){let e=$(this).closest(".zpl_tmlnrow"),t=e.attr("cmtID"),s=new DeleteAlertMessage(ZPI18N.getString("zp.deletecommentheader"),ZPI18N.getString("zp.deletecommentbody"));s.removeAfterYes=!0,s.setCallback((function(){let s={actionType:"DELETE_COMMENT",commentId:t,activityType:"HrCase"};ZPeople.Request.send("/feedActions.zp",s,(function(t){"success"==t?(e.addClass("zpl_op5"),e.find(".PI_delete").remove(),e.find(".zpl_cSdtls").remove(),e.find("#usrSpn").text(ZPI18N.getString("zp.commentwasdeleted")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.commentdeletedsuccess"))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.permissiondenied"))}))})),s.show()}))}attachView(){this.$cvLftCnt.on("click","div[viewUrl]",(function(e){e.stopPropagation(),ZPFeeds.registerAttPreview(e,this,this.caseId)}))}constructEditor(){this.$cvLftCnt.append('<div id="cseCmtSec" class="zpl_cScmt"> <div class="zp-fd-compose"> <ul id="cseRlyNoteTab" class="zpl_tabpane"> <li name="cmt" class="zpl_act"> <a>'+ZPI18N.getString("zp.reply")+'</a> </li> <li name="note" class=""> <a>'+ZPI18N.getString("zp.notes")+'</a></li> </ul> <div id="comment_cont"></div> <div id="casenote_cont" class="zpl_DNI"></div> <div class="zp-fd-composeActions"> <div class="zp-editor-foot"> <div class="editor-foot-col"> <div class="editor-atchment"> <i id="cseCmtAttch" title="'+ZPI18N.getString("zp.lms.manuals.Attachfiles")+'" class="zei-attachment"></i> </div></div> <div id="cseAttchLst" class="editor-foot-col zpl_csHrscrl zpl_idiv"> </div> <div class="editor-foot-col zpl_csBtnPs"> <div class="editor-post-bt"> <button id="cseSveNote" class="spltdwnmenu-js zbutton zpl_DNI zbutton" data-appearance="primary" data-popup-open="actionspopup">'+ZPI18N.getString("zp.save")+'</button> <div role="splitbutton" aria-label="Submit" tabindex="0" class="zbutton--split zbutton--splitprimary" id="cseCmtSbt"><button aria-label="Submit" tabindex="0" role="button" type="button" id="cseCmtSbtbtn" class="zbutton zbutton--medium zbutton--primary zbutton--action"> <span class="zbutton__text">\x3c!----\x3e'+ZPI18N.getString("zp.submit")+'\x3c!----\x3e</span> </button> <button aria-haspopup="true" aria-expanded="false" aria-controls="casescmtsubmit" tabindex="0" role="button" type="button" id="cseCmtSbtAs" class="zbutton zbutton--menu zbutton--medium zbutton--primary"> <i class="zbutton__icon zh-floatright"> \x3c!----\x3e<svg class="zbutton__svg zbutton__menuarrow" focusable="false"> <use xlink:href="#zc__svg--downarrow"></use></svg> </i></button><div id="statusAsList" style="display: none;"></div></div> </div> </div> </div> </div> </div> </div>'),this.$cseCmtSec=this.$cvLftCnt.find("#cseCmtSec"),this.$cseRlyNoteTab=this.$cvLftCnt.find("#cseRlyNoteTab"),this.$commentCont=this.$cseCmtSec.find("#comment_cont"),this.$casenoteCont=this.$cseCmtSec.find("#casenote_cont"),this.$cseCmtSbt=this.$cseCmtSec.find("#cseCmtSbt"),this.$cseSveNote=this.$cseCmtSec.find("#cseSveNote"),this.$cseCmtAttch=this.$cseCmtSec.find("#cseCmtAttch"),this.$cseAttchLst=this.$cseCmtSec.find("#cseAttchLst"),this._setNoteJson(),this._setCmtJson(),ZPFeeds.Editor.editorList.hasOwnProperty("popup_cmt_editordiv_"+this.cmtData.fdk)&&delete ZPFeeds.Editor.editorList["popup_cmt_editordiv_"+this.cmtData.fdk],ZPFeeds.Editor.editorList.zp_noteEditor&&delete ZPFeeds.Editor.editorList.zp_noteEditor,this.caseDtls?.restrictCmt||ZPUtil.Validation.isEmpty(this.cmtData.fdk)?(this.$cseRlyNoteTab.find('[name="cmt"]').addClass("zpl_DNI"),this.$cseRlyNoteTab.find('[name="note"]').addClass("zpl_act"),this.hideCmtSec(),this.showNoteSec()):(ZPFeeds.ISMODALEDITOROBJ=this.$caseView,ZPFeeds.Comment.getNewEditor(this.cmtData)),this.$casenoteCont.append(ZPFeeds.Editor.getEditorContainer(this.actJson)),this.zp_noteEditor=ZPFeeds.Editor.getEditor("zp_noteEditor","HRCaseNote"),this.noteId=this.caseDtls?.noteId,this.fetchNotes()}_setNoteJson(){this.actJson={},this.actJson.divId="zp_noteEditor",this.actJson.subBtnId="submitbtn",this.actJson.parentCon="editor_container",this.actJson.isActivity=!1,this.actJson.isavatarnded=!1,this.actJson.isTitleNeeded=!1,this.actJson.placeholder="Reply",this.actJson.actRecId=this.caseId,this.actJson.fdk=this.caseObj.HRCaseFeedComment?this.caseObj.HRCaseFeedComment.fdk:"",this.actJson.editorheight="150",this.actJson.cancelnotneeded=!0,this.actJson.isAutogrowEnabled=!1,this.actJson.isAttachNeeded=!0}_setCmtJson(){this.cmtData=this.caseObj?.HRCaseFeedComment||{},this.cmtData.actRecId=this.caseId,this.cmtData.customeButton=this.caseDtls.permittedCaseStatus.length>0,this.cmtData.status=this.caseDtls.statusId,this.cmtData.reqID=this.caseDtls.requestor.erecno,this.cmtData.isAgent=this.caseDtls.isAgent,this.cmtData.isEscalatedUser=this.caseDtls.isEscalatedUser,this.cmtData.editorheight="150",this.cmtData.cancelnotneeded=!0,this.cmtData.isAutogrowEnabled=!1,this.cmtData.isAttachNeeded=!0,this.cmtData.hr_categoryId=this.caseDtls.categoryId,this.cmtData.type=People.HrCase.type}cmtSecListen(){let e=this;this.replyAndNoteToggle(),this.attach(),this.$cseCmtSbt.find("#cseCmtSbtbtn").off().on("click",(function(){e.reply()})),e.replyAsStatus(),this.$cseCmtSbt.parent().find("#cseSveNote").off().on("click",(function(){e.saveNote()})),this.cmtAttachDelete()}cmtAttachDelete(){this.$cseAttchLst.on("click",".PI_delete",(function(){let e=$(this).closest(".zpl_atchd");e.prev('input[type="file"]').remove(),e.remove()}))}_constructReplyList(){let e=[];for(let t=0;t<this.caseDtls.permittedCaseStatus.length;t++){let s=this.caseDtls.permittedCaseStatus[t],i={id:s.systemValue};i.value=ZPI18N.getString("zp.submitas",[s.optionValue]),e.push(i)}return e}replyAsStatus(){if(this.caseDtls?.permittedCaseStatus?.length>0){let e=this.$cseCmtSbt.find("#cseCmtSbtAs");e.removeClass("zpl_DNI"),this.$statusAslist=this.$cseCmtSec.find("#statusAsList");let t=this._constructReplyList(),s={value:"id",text:"value"},i={contentType:"text",viewport:this.$caseView,appendTo:this.$caseView,randomDropdownListId:!0,forElement:e,items:t,isTextHTMLEncoded:!0,dataMapping:s,displayType:"callout",bodyItemVisibleCount:4,position:"right"},a=this;ZPeopleComponents.dropdownlist(this.$statusAslist,i),this.$cseCmtSbt.find("#cseCmtSbtAs").off().on("click",(function(){ZPeopleComponents.dropdownlist(a.$statusAslist).deselectAll(),ZPeopleComponents.dropdownlist(a.$statusAslist).open()})),this.$statusAslist.on("zdropdownlistitemclick",(function(e,t){a.status=t.itemData.id,a.reply()}))}else this.$cseCmtSbt.find("#cseCmtSbtAs").addClass("zpl_DNI")}static feedReplyNCloseCallback(e,t,s){$("#"+s).closest("#editor_container").find("[name=cases_custBtn]").remove(),$("#"+s).closest("#editor_container").find("#customeBtn").remove(),$("#"+s).closest("[streamid]").find("[name=status]").replaceWith()}saveNote(){let e=ZPFeeds.Editor.editorList.zp_noteEditor,t={text:null!=e?ZPFeeds.getSmileysAndMentions(e.getContent(),!1):"",recordId:this.caseId,formID:this.caseObj.hrcaseformId,module_type:10},s={method:"addNote",conreqcsr:csrfToken,addNoteJson:JSON.stringify(t)},i=this;ZPeople.Request.send("/cases/note/add",s,(function(e){"success"==e.status&&(null!=i.caseDtls?.noteId?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.noteseditmsg")):ZPeople.Message.showSuccessMsg("Note saved successfully"))}))}replyAndNoteToggle(){let e=this;this.$cseRlyNoteTab.find("li").off().on("click",(function(){$(this).addClass("zpl_act").siblings().removeClass("zpl_act"),"cmt"==$(this).attr("name")?(e.showCmtSec(),e.hideNoteSec()):(e.showNoteSec(),e.hideCmtSec())}))}hideCmtSec(){this.$commentCont.addClass("zpl_DNI"),this.$cseCmtAttch.parent().addClass("zpl_DNI"),this.$cseCmtSbt.addClass("zpl_DNI")}showCmtSec(){this.$commentCont.removeClass("zpl_DNI"),this.$cseCmtAttch.parent().removeClass("zpl_DNI"),this.$cseCmtSbt.removeClass("zpl_DNI")}hideNoteSec(){this.$casenoteCont.addClass("zpl_DNI"),this.$cseSveNote.addClass("zpl_DNI")}showNoteSec(){this.$casenoteCont.removeClass("zpl_DNI"),this.$cseSveNote.removeClass("zpl_DNI")}fetchNotes(){let e=this,t={method:"fetchNotes",conreqcsr:csrfToken,noteId:this.noteId,recordId:this.caseId,module_type:10};ZPeople.Request.send("/cases/note/fetch",t,(function(t){var s=t.length>0&&!ZPUtil.Validation.isEmpty(t[0].text)?t[0].text:"";e.zp_noteEditor.setContent(s)}))}attach(){let e=this;this.$cseCmtAttch.off().on("click",(function(){e.fileCount<4?e.createAndAttach():ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maximum4filesreached"))}))}createAndAttach(){let e=this;this.$cseAttchLst.find("input").length!=this.fileCount+1?(this.$cseAttchLst.append($('<input type="file" class="zpl_DNI" id="zp_attchments_'+(e.fileCount+1)+'" type="file" attachcnt="'+(e.fileCount+1)+'" name="file_upload_'+(e.fileCount+1)+'" >').off("change").on("change",(function(t){let s=this.files[0],i=this;$("#cseAttchLst").append('<div id="progressElement"></div>');let a={progressColor:"#082c5d",mode:"indeterminate",trackColor:"#dddbd7"};ZComponents.progresswheel("#progressElement",a),ZPFeeds.Attachment.upload(this.$cseAttchLst,s,!1,this,"editor_container",(function(t,a){var n=t.fileInfo;if(0!=Object.keys(n).length&&0!=Object.keys(a).length)if(void 0!==s&&s.size>0&&s.size<5242880){$(i).attr("udsfileId",t.fileInfo.fileId);let a=new CasesFiles(e.$cseAttchLst,s,"1");a.cmtAttach=!0,a.loadDNI="zpl_DNI",ZComponents.progresswheel(document.getElementById("progressElement")).destroy(),document.getElementById("progressElement").remove(),a.attachFile(),e.fileCount++,$("#cseAttchLst .PI_delete").each((function(){$(this).off("click"),$(this).on("click",(function(){e.fileCount--}))}))}else 0===s.size?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.emptyfilewarning")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.feedfilesizewarning"));else if("Failure"==t.status){"Virus Found"==t.message?(!0,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.virusfile"))):"An error occured in the File Transfer"==t.message&&(!0,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.filenotuploaded")))}}),(function(e,t,s,i){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.reuploadfile"))}))}))),this.$cseAttchLst.find("input").last().trigger("click")):this.$cseAttchLst.find("input").last().trigger("click")}reply(){this.$cseCmtSbt.find("#cseCmtSbtbtn").prop("disabled",!0);let e=ZPFeeds.Editor.editorList["popup_cmt_editordiv_"+this.cmtData.fdk],t=ZPFeeds.getContentJson(e,this.actJson),s=ZPFeeds.getSmileysAndMentions(e.getContent(),ZPeople.isSearchAllowed);s=ZPFeeds.removeTrailingEmptyDivs(s);let i=ZPFeeds.getTextContent(s);if((0===i.length&&0===$("<div>").append(s).find("img").length||i.length>5e3)&&0==this.fileCount)i.length>5e3?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.commentlengthwarning")):0===i.length&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.emptycomment")),ZPFeeds.Editor.getfocusOnEditor(e,!1),this.$cseCmtSbt.find("#cseCmtSbtbtn").prop("disabled",!1),this.status=void 0;else if(""!==t.messgeTxt){let e={type:"HrCase",fdk:this.caseObj.HRCaseFeedComment.fdk,callBack:casesObj.caseViewObj.afterReply,content:t.content,messageText:t.messgeTxt,curConObj:this.$caseView,attachCnt:this.fileCount,actRecId:this.caseId};null!=this.status&&(e.btnType=this.status),this.fileCount>0&&(e.isNewUI=!0),ZPFeeds.postAction(e,!1),this.$cseCmtSbt.find("#cseCmtSbtbtn").prop("disabled",!1)}else this.status=void 0,this.$cseCmtSbt.find("#cseCmtSbtbtn").prop("disabled",!1),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.emptycomment")),ZPFeeds.Editor.getfocusOnEditor(e,!1)}afterReply(e,t){if(e="string"==typeof e?JSON.parse(e):e,casesObj.caseViewObj.status=void 0,200==e.code){ZPFeeds.Editor.editorList["popup_cmt_editordiv_"+casesObj.caseViewObj.cmtData.fdk].setContent(""),casesObj.caseViewObj.$cseAttchLst.html(""),casesObj.caseViewObj.fileCount=0;let i=e.commentObj,a="";for(var s in i){let e=new People.Comment(new Comment(i[s]),!0);a+=new CommentRow(casesObj.caseViewObj._setCommentObj(e),casesObj.caseViewObj.caseObj.HRCaseFeedComment.departmentDts,casesObj.caseViewObj.caseObj.HRCaseFeedComment.groupDts).constructCmtRow()}casesObj.caseViewObj.$cmtRwDiv.append(a),casesObj.caseViewObj.scrollComment(),e.hasOwnProperty("permittedCaseStatus")&&(casesObj.caseViewObj.caseDtls.permittedCaseStatus=e.permittedCaseStatus,casesObj.caseViewObj.caseDtls.status=CommonMethod.getStatusName(t.btnType+""),casesObj.caseViewObj.caseDtls.statusId=t.btnType,casesObj.caseViewObj.initStatus(!0)),ZPUtil.Validation.isEmpty(e.sla)||($("#slaBandHdr").remove(),casesObj.caseViewObj.caseObj.sla=e.sla,casesObj.caseViewObj.slaHrd())}else e.hasOwnProperty("desc")?ZPeople.Message.showFailureMsg(e.desc):ZPeople.Message.showFailureMsg(e.error),casesObj.caseViewObj.$cseCmtSbt.find("#cseCmtSbtbtn").prop("disabled",!1)}scrollComment(){casesObj.caseViewObj.$cmtRwDiv.parent().animate({scrollTop:casesObj.caseViewObj.$cmtRwDiv.parent()[0].scrollHeight},"slow")}_setCommentObj(e){let t={};return t.commentId=e.commentId,t.content=e.content,t.commat=e?.commat||e?.time,t.isDelete="true"==e.isAllowedtoDelete,t.isSysComment=!e?.isDelete,t.isDeletedComment=!1,t.cmtattList=e?.cmtattList||[],t.actRecId=casesObj.caseViewObj.caseId,null==e?.commbyinfo?(t.commbyinfo={},t.commbyinfo.zuid=e.commentOwnDtl.id,t.commby=e.commentOwnDtl.id,t.commbyinfo.employeePhoto=e.commentOwnDtl.avatar,t.commbyinfo.name=e.commentOwnDtl.name,t.commbyinfo.empid=e.commentOwnDtl.empid):(t.commbyinfo=e.commbyinfo,t.commby=e.commbyinfo.zuid),t}afterActionsCommentUpdate(e){let t=this._setCommentObj(e);t.isSysComment=!0;let s=new CommentRow(t,this.caseObj.HRCaseFeedComment.departmentDts,this.caseObj.HRCaseFeedComment.groupDts).constructCmtRow();this.$cmtRwDiv.append(s),this.scrollComment()}async afterStatusUpdate(e){let t=this;var s=this.caseDtls.statusId,i=e.statusId,a=i==casesObj.CANCELLED_SID?await CommonMethod.getStatusName(i):ZSEC.Encoder.encodeForHTML($(ZPeopleComponents.select("#cseStatusSel").getElement())[0].outerText);this.caseDtls.status=a,this.caseDtls.statusId=i,this.caseDtls.permittedCaseStatus=e.permittedCaseStatus,e.statusId==casesObj.CANCELLED_SID||e.statusId==casesObj.COMPLETED_SID?(this.caseObj.InfoPanel.assignedToList=!1,this.caseDtls.priority=ZSEC.Encoder.encodeForHTML($(ZPeopleComponents.select("#csePriSel").getElement())[0].outerText),this.initStatus(!0),this.initPriority(!0),this.initCaseType(!0),this.initCgy(),this.initSubCgy(),this.cgyListen()):s==casesObj.COMPLETED_SID&&i!=casesObj.CANCELLED_SID&&i!=casesObj.COMPLETED_SID&&(this.caseObj.InfoPanel.assignedToList=this.caseDtls.isAgent&&"1"!=this.caseDtls.agent.typeId,this.initStatus(!0),this.initPriority(!0),this.initCgy(),this.initSubCgy(),this.cgyListen()),this.moreOption(),this.caseDtls.hasOwnProperty("agent")||(this.caseDtls.agent={}),$.each(e.agent,(function(e,s){t.caseDtls.agent[e]=s})),this.caseDtls.agent_details=e.agent_details,this.initAgent(!0),ZPUtil.Validation.isEmpty(e.sla)||($("#slaBandHdr").remove(),this.caseObj.sla=e.sla,this.slaHrd())}constructRgtActions(){this.$cvRgtCnt.append(`<div id="cgySec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.category")}</label> </div> <div> <input id="cgyInp" type="text" class="ztextbox zpl_cp" autocomplete="off"> </div> </div><div id="subCgySec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.subcategory")}</label> </div> <div> <select id="subCgySel" class="select-js" style="display: none;"> </select><input id="subCgyInp" type="text" class="ztextbox zpl_DNI" disabled autocomplete="off"/> </div> </div>`),this.$cgySec=this.$cvRgtCnt.find("#cgySec"),this.$cgyInp=this.$cvRgtCnt.find("#cgyInp"),this.$subCgySec=this.$cvRgtCnt.find("#subCgySec"),this.$subCgySel=this.$cvRgtCnt.find("#subCgySel"),this.initCgy(),this.initSubCgy(),this.initCaseType(),this.initStatus(),this.initPriority(),this.initSource(),this.initAgent()}rightSecListen(){this.cgyListen()}initCgy(){this.$cgyInp.val(ZPeople.decodeTxt(this.caseDtls.categoryName)),this.categoryId=this.caseDtls.categoryId,this.categoryName=this.caseDtls.categoryName,this.subCategoryId=this.caseDtls?.subCategoryId,this.subCategoryName=this.caseDtls?.subCategoryName,this._getCurrentSubCgy()}cgyListen(){if(this.caseObj.InfoPanel?.changeCategoryList?.length>0&&this.caseDtls.statusId!=casesObj.CANCELLED_SID&&this.caseDtls.statusId!=casesObj.COMPLETED_SID){let e=this;this.$cgyInp.addClass("zpl_cp"),this.$cgyInp.prop("disabled",!1),this.$cgyInp.off().on("click",(function(){new CategoryChange(e).init()}))}else this.$cgyInp.removeClass("zpl_cp"),this.$cgyInp.prop("disabled",!0),this.$cgyInp.off()}_getCurrentSubCgy(){let e=this.caseObj.InfoPanel?.changeCategoryList;this.subCgyList=[];for(let t=0;t<e?.length;t++){let s=e[t];if(this.subCgyMandatory=s.isSubCategoryMandatory,this.categoryId==s.categoryId){this.subCgyList=s?.subCategoryList||[];break}}}initSubCgy(e){if(this.subCgyList.length>0&&this.caseDtls.statusId!=casesObj.CANCELLED_SID&&this.caseDtls.statusId!=casesObj.COMPLETED_SID){let e={value:"subCategoryId",label:"subcategoryname"},t={options:this.subCgyList,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$pageDiv,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:e,contentType:"image-text",dropdownList:{contentType:"text",bodyItemVisibleCount:7,isTextHTMLEncoded:!0}};t.clearButton=!this.subCgyMandatory,null!=this.subCategoryId?t.selectedValue=this.subCategoryId:ZPUtil.Validation.isEmpty(this.subCategoryId)&&(t.selectedIndex=-1),this.$subCgySec.removeClass("zpl_DNI"),this.$subCgySel.removeClass("zpl_DNI"),ZPeopleComponents.select(this.$subCgySel).destroy(),ZPeopleComponents.select(this.$subCgySel,t);let s=this;this.$subCgySel.off("zselectchange").on("zselectchange",(function(e,t){s.subCategoryId=null==t.optionData?.subCategoryId?"":t.optionData.subCategoryId,new CategoryChange(s).changeCategory(ZPI18N.getString("zp.subcategorychangesuccs"))}))}else ZPUtil.Validation.isEmpty(this.subCategoryId)?this.$subCgySec.addClass("zpl_DNI"):(null!=ZPeopleComponents.select(this.$subCgySel)&&(ZPeopleComponents.select(this.$subCgySel).destroy(),this.$subCgySel.addClass("zpl_DNI")),this.$subCgySec.find("#subCgyInp").val(ZPeople.decodeTxt(this.caseDtls.subCategoryName)),this.$subCgySec.find("#subCgyInp").removeClass("zpl_DNI"),this.$subCgySec.removeClass("zpl_DNI"))}initCaseType(e){if(this.caseObj?.isCaseTypeEnabled)if(e||this.$cvRgtCnt.append('<div id="cseTypeSec" class="zpl_secn zpl_DNI"> <div> <label>Case Type</label> </div> <div> <select id="cseTypeSel" class="select-js" style="display: none;"> </div> </div>'),this.$cseTypeSec=this.$cvRgtCnt.find("#cseTypeSec"),this.$cseTypeSel=this.$cvRgtCnt.find("#cseTypeSel"),this.caseDtls?.permittedCaseType?.length>0&&this.caseDtls.statusId!=casesObj.CANCELLED_SID&&this.caseDtls.statusId!=casesObj.COMPLETED_SID){let e={value:"optionId",label:"optionValue"},t={options:this.caseDtls.permittedCaseType,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$pageDiv,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0}};null!=this.caseDtls?.typeId&&(t.selectedValue=this.caseDtls.typeId),this.$cseTypeSec.removeClass("zpl_DNI"),ZPeopleComponents.select(this.$cseTypeSel,t);let s=this;this.$cseTypeSel.off("zselectoptionclick").on("zselectoptionclick",(function(e,t){let i={conreqcsr:csrfToken,status:t.optionData.optionId,zp_recordId:s.caseId,method:"changeCaseType"};ZPeople.Request.send("/cases/type/change",i,(function(e){"success"==e.status?s.afterActionsCommentUpdate(e):ZPeople.Message.showFailureMsg(e.desc)}))}))}else if(!ZPUtil.Validation.isEmpty(this.caseDtls.typeId)){let e=this.$cseTypeSec.parent();this.$cseTypeSec.remove(),e.append(`<input id="cseTypeInp" type="text" value="${this.caseDtls.type}" class="ztextbox" disabled="">`),this.$cseTypeSec.removeClass("zpl_DNI")}}initStatus(e){if(e||this.$cvRgtCnt.append(`<div id="cseStatusSec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.status")}</label> </div> <div> <select id="cseStatusSel" class="select-js" style="display: none;"> </div> </div>`),this.$cseStatusSec=this.$cvRgtCnt.find("#cseStatusSec"),this.$cseStatusSel=this.$cvRgtCnt.find("#cseStatusSel"),this.caseDtls?.permittedCaseStatus?.length>0){this.caseDtls.permittedCaseStatus.unshift({systemValue:this.caseDtls.statusId,optionValue:this.caseDtls.status});let e={value:"systemValue",label:"optionValue"},t={options:this.caseDtls.permittedCaseStatus,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$pageDiv,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:e,contentType:"text",dropdownList:{contentType:"text",isTextHTMLEncoded:!0}};t.selectedValue=this.caseDtls.statusId,this.$cseStatusSec.removeClass("zpl_DNI"),null!=ZPeopleComponents.select(this.$cseStatusSel)&&ZPeopleComponents.select(this.$cseStatusSel).destroy(),ZPeopleComponents.select(this.$cseStatusSel,t);let s=this;this.$cseStatusSel.off("zselectoptionclick").on("zselectoptionclick",(function(e,t){let i={conreqcsr:csrfToken,status:t.optionData.systemValue,zp_recordId:s.caseId,method:"changeCaseStatus"};ZPeople.Request.send("/cases/status/change",i,(function(e){"success"==e.status?(e.statusId=i.status,s.afterStatusUpdate(e),s.afterActionsCommentUpdate(e)):ZPeople.Message.showFailureMsg(e.desc)}))}))}else{let e=this.$cseStatusSel.parent();null!=ZPeopleComponents.select(this.$cseStatusSel)&&ZPeopleComponents.select(this.$cseStatusSel).destroy(),this.$cseStatusSel.remove(),e.append(`<input id="cseStatusInp" type="text" value="${this.caseDtls.status}" class="ztextbox" disabled="">`),this.$cseStatusSec.removeClass("zpl_DNI")}}initPriority(e){var t=$(`<div id="csePriSec" class="zpl_secn zpl_DNI"> <div> <label>${ZPI18N.getString("zp.priority")}</label> </div> <div> <select id="csePriSel" class="select-js" style="display: none;"> </div> </div>`);if(e?this.$csePriSec.replaceWith(t):this.$cvRgtCnt.append(t),this.$csePriSec=this.$cvRgtCnt.find("#csePriSec"),this.$csePriSel=this.$cvRgtCnt.find("#csePriSel"),this.caseDtls?.permittedCasePriority?.length>0&&this.caseDtls.statusId!=casesObj.CANCELLED_SID&&this.caseDtls.statusId!=casesObj.COMPLETED_SID){let e={value:"systemValue",label:"optionValue"},t={options:this.caseDtls.permittedCasePriority,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$pageDiv,randomDropdownListId:!0,cacheData:!0,multiple:!1,dataMapping:e,contentType:"text",dropdownList:{contentType:"text"}};t.selectedValue=this.caseDtls?.priorityId,this.$csePriSec.removeClass("zpl_DNI"),null!=ZPeopleComponents.select(this.$csePriSec)&&ZPeopleComponents.select(this.$csePriSec).destroy(),ZPeopleComponents.select(this.$csePriSel,t);let s=this;this.$csePriSel.off("zselectoptionclick").on("zselectoptionclick",(function(e,t){let i={conreqcsr:csrfToken,priority:t.optionData.systemValue,zp_recordId:s.caseId,method:"changePriorityOption"};ZPeople.Request.send("/cases/priority/change",i,(function(e){"success"==e.status?s.afterActionsCommentUpdate(e):ZPeople.Message.showFailureMsg(e.desc)}))}))}else{let e=this.$csePriSel.parent();ZPeopleComponents.select(this.$csePriSel).destroy(),this.$csePriSel.remove(),e.append(`<input id="csePriorityInp" type="text" value="${this.caseDtls.priority}" class="ztextbox" disabled="">`),this.$csePriSec.removeClass("zpl_DNI")}}initSource(){null!=this.caseDtls?.sourceId&&(this.$cvRgtCnt.append(`<div id="cseSourceSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.sourceofrequest")}</label> </div> <div>  <input id="cseSourceInp" readonly type="text" class="ztextbox"> </div> </div>`),this.$cseSourceSec=this.$cvRgtCnt.find("#cseSourceSec"),this.$cseSourceInp=this.$cvRgtCnt.find("#cseSourceInp"),this.$cseSourceInp.val(ZPeople.decodeTxt(this.caseDtls.source)))}async initAgent(e){let t=this;var s="",i="",a="",n="",l="";if(this.caseDtls.hasOwnProperty("agent")&&("1"==this.caseDtls.agent.typeId||this.caseDtls.agent.hasOwnProperty("erecno")?(s="user",i=t.caseDtls.agent.name,n='empid = "'+t.caseDtls.agent.zuid+'"',a='<img src="'+this.caseDtls?.agent?.employeePhoto+'">'):"2"==this.caseDtls.agent.typeId?(s="dept",i=t.caseDtls.agent.details,n='deptid = "'+t.caseDtls.agent.valueId+'"',a='<span class="zpl_pichr PC2">'+ZSEC.Encoder.encodeForHTML(CommonTemplates.getAltText(ZPeople.decodeTxt(i)))+"</span>",l=EmployeeSearch.getImageAltText(decodeHTML(i)),a='<span class="zpl_pichr PC2">'+ZSEC.Encoder.encodeForHTML(l)+"</span>"):"3"!=this.caseDtls.agent.typeId&&"4"!=this.caseDtls.agent.typeId||(s="grp",i=t.caseDtls.agent.details,n='grpid = "'+t.caseDtls.agent.valueId+'"',l=EmployeeSearch.getImageAltText(decodeHTML(i)),a='<span class="zpl_pichr PC2">'+ZSEC.Encoder.encodeForHTML(l)+"</span>")),this.caseObj.InfoPanel?.assignedToList){e||this.$cvRgtCnt.append('<div id="cseAgtSec" class="zpl_secn zpl_DNI"> <div> <label>Agent</label> </div> <div> <select id="cseAgtSel" class="select-js" style="display: none;"> </div> </div>'),0==this.assigneeList.length&&await this.fetchAgents(),this.$cseAgtSec=this.$cvRgtCnt.find("#cseAgtSec"),this.$cseAgtSel=this.$cvRgtCnt.find("#cseAgtSel"),this.$cseAgtSec.removeClass("zpl_DNI");let s={value:"empErecno",label:"empDispName",image:"empPhoto",textIcon:"alt"},i={showSearchField:!0,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$caseView,forElement:this.$cseAgtSel,randomDropdownListId:!0,multiple:!1,dataMapping:s,contentType:"image-text",dropdownList:{contentType:"image-text",bodyItemVisibleCount:7,width:t.$cseAgtSec.width()}};CommonMethod.decodeValInList(this.assigneeList,"empDispName"),i.options=this.assigneeList,ZPeopleComponents.select(this.$cseAgtSel).destroy(),ZPeopleComponents.select(this.$cseAgtSel,i),null!=this.caseDtls?.agent?null!=this.caseDtls?.agent?.erecno?ZPeopleComponents.select(this.$cseAgtSel).setValue(this.caseDtls.agent.erecno):(ZPeopleComponents.select(t.$cseAgtSel).setAttribute("placeholder",ZPeople.decodeTxt(this.caseDtls.agent.details)),ZPeopleComponents.select(this.$cseAgtSel).deselectAllOptions()):ZPeopleComponents.select(this.$cseAgtSel).deselectAllOptions(),this.$cseAgtSel.off("zselectoptionclick").on("zselectoptionclick",(function(e,s){let i={conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:t.caseId,assignedId:s.optionData.empErecno};ZPeople.Request.send("/cases/assigned",i,(function(e){"success"==e.status?t.afterActionsCommentUpdate(e):ZPeople.Message.showFailureMsg(e.desc)}))}))}else{var o=$("<div></div>");this.caseDtls?.agent?o.append(`<div id="cseAgtSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.agent")}</label> </div> <div> <div "${n}" popup="${s}" class="zpl_em"> <div class="zpl_emimg"> ${a} </div> <div class="zpl_emdts zpl_ellipsis"> <div><b>${i}</b></div> </div> </div> </div> </div>`):o.append(`<div id="cseAgtSec" class="zpl_secn"> <div> <label>${ZPI18N.getString("zp.agent")}</label> </div> <div> <div class="zpl_em"> <div class="zpl_emimg"><span class="zpl_pichr PI_Approval-pending"></span> </div> <div class="zpl_emdts zpl_ellipsis"> <div><span>${ZPI18N.getString("zp.notassigned")}</span><span class="zpl_dots"></span><span class="ylw">${ZPI18N.getString("zp.inreview")}</span></div> </div> </div> </div> </div>`),e?this.$cvRgtCnt.find("#cseAgtSec").replaceWith(o.children()):this.$cvRgtCnt.append(o.children())}}fetchAgents(){let e=this;return new Promise(((t,s)=>{ZPeople.Request.send("/cases/assignedto/list",{caseId:this.caseId,method:"getAssignedToList",conreqcsr:csrfToken},(function(s){(s.status="success")&&s.assignedToList.isAssigneeAvailable&&(e.assignedToList=s.assignedToList,e.assigneeList=s.assignedToList.assigneeList),t()}))}))}async constructRecentData(){(casesObj.ISCASEADMIN||isManageHRCase||this.caseDtls.isAgent)&&-1==Layout.Page.hash.indexOf("#hrcase/myrequest")&&await this.fetchRecentCases();let e=this.recentCases?.hrcaseList?.length>1,t=ZP5ViewsCommon.RelatedTask.isTaskAvailable("P_HR_Case");this.allowTask=this.caseObj?.taskList?.length>0||null!=this.caseObj.InfoPanel.caseDtls.agentId&&t;let s=t&&this.allowTask&&this.caseObj.InfoPanel.caseDtls.statusId!=casesObj.COMPLETED_SID&&this.caseObj.InfoPanel.caseDtls.statusId!=casesObj.CANCELLED_SID;(e||this.allowTask)&&(this.$cvRgtCnt.append(`<div id="cvCsenTsk" class="zpl_secn zpl_hdcnt"> <ul class="zpl_tabpane"> ${e?`<li id="cvRctCse" class="zpl_act"> <a>${ZPI18N.getString("zp.recentinterations")}</a></li>`:""} ${this.allowTask?`<li id="cvRctTsk" class=""> <a>${ZPI18N.getString("zp.tasks")}</a></li>`:""} </ul> ${s?'<div class="zpl_tskAdbtn zpl_DNI"> <i class="PI_fil_plusqr blu CP" id="addTskMdl"></i> </div>':""} ${this.recentCaseList()+this.recentTaskList()} </div>`),e?this.$cvRgtCnt.find("#recntTaskList").addClass("zpl_DNI"):this.$cvRgtCnt.find(".zpl_tskAdbtn").removeClass("zpl_DNI"),this.$cvCsenTsk=this.$cvRgtCnt.find("#cvCsenTsk"),this.recentDataListen())}recentDataListen(){this.tabPaneSwitch(),this.recentCaseClick(),this.changeTaskStatus(),this.addQuickTask()}recentCaseClick(){this.$cvCsenTsk.on("click","[caseId]",(function(e){let t=$(this).attr("caseId"),s=window.location.origin+window.location.pathname;s+="#hrcase/agent/allcases/view-caseid:"+t,window.open(s)}))}addQuickTask(){let e=this;this.$cvCsenTsk.on("click","#addTskMdl",(function(t){CommonMethod.getCaseFormId().then((function(){ZP5ViewsCommon.RelatedTask.addPopup(settingsPage.container.attr("id"),e.caseId,casesObj.caseFormId,(function(t,s){var i=ZPeople.getUserDetailsById(s.taskowner),a={id:t.taskid,statusSysValue:"1",name:s.taskname,endtime:s.dueDate,taskownerdetail:{zuid:i.id,employeePhoto:i.avatar},assignedto:i.name};e.$cvRgtCnt.find("#recntTaskList").find("#emptPage").remove(),a.name=ZSEC.Encoder.encodeForHTML(a.name),e.$cvRgtCnt.find("#recntTaskList").prepend(e.taskListRow(a))})),$("#quicktask_Cards").removeClass("zpl_fm")}))}))}tabPaneSwitch(){let e=this;this.$cvCsenTsk.find("#cvRctCse, #cvRctTsk").off().on("click",(function(){$(this).addClass("zpl_act"),$(this).siblings().removeClass("zpl_act"),"cvRctCse"==$(this).attr("id")?(e.$cvCsenTsk.find("#recntCseList").removeClass("zpl_DNI"),e.$cvCsenTsk.find("#recntTaskList").addClass("zpl_DNI"),$(this).closest(".zpl_tabpane").siblings(".zpl_tskAdbtn").addClass("zpl_DNI")):(e.$cvCsenTsk.find("#recntCseList").addClass("zpl_DNI"),e.$cvCsenTsk.find("#recntTaskList").removeClass("zpl_DNI"),$(this).closest(".zpl_tabpane").siblings(".zpl_tskAdbtn").removeClass("zpl_DNI"))}))}recentCaseList(){if(this.recentCases?.hrcaseList?.length>0){let e=this.recentCases.hrcaseList,t="";for(let s=0;s<e.length;s++){let i=e[s];this.caseId!=i.recordId&&(t+=`<div caseId="${i.recordId}" class="zpl_rcntInt zpl_csTskRgt"> <div class="zpl_rcntIntIn"> <div> <h6>${i.subject}</h6> </div> <div class="zpl_rcntInrt"> <span>${i.requestedTime}</span> </div> </div> </div>`)}return t='<div id="recntCseList"> <div class="zpl_secn">'+t+"</div> </div>",t}return""}recentTaskList(){let e=this,t="";if(this.allowTask){let s=this.caseObj.taskList;if(this.caseObj?.taskList?.length>0)for(let i=0;i<s.length;i++){let a=s[i];t+=e.taskListRow(a)}else t='<div id="emptPage" class="zpl_crd wd100_per"><div class="zpl_crdcnt"><div class="zpl_Emptydata "><div><div class="zpl_emptimg zp_nd_task"></div><h4>'+ZPI18N.getString("zp.emptytasklist")+"</h4></div></div></div></div>"}return t='<div class="'+(this.allowTask?"":"zpl_DNI")+'" id="recntTaskList">'+t+"</div>",t}taskListRow(e){return`<div class="zpl_secn"> <div class="zpl_rcntInt zpl_csTskRgt" taskid=${e.id}> <div class="zpl_idiv"> <div><i class="PI_tick2_fil ${"2"==e.statusSysValue?"grn":""}"></i></div> <div> <h6>${e.name}</h6> </div> </div> <div class="zpl_rcntIntIn"> <div> <div popup="user" empid="${e.taskownerdetail.zuid}" class="zpl_em"> <div class="zpl_emimg"> <img src="${e.taskownerdetail.employeePhoto}"> </div> <div class="zpl_emdts zpl_ellipsis"> <div><b>${e.assignedto}</b></div> </div> </div> </div> <div class="zpl_rcntInrt"> <span>${e.endtime}</span> </div> </div> </div> </div>`}fetchRecentCases(){let e=this;return new Promise(((t,s)=>{let i={method:"allHrCases",myCasesJson:JSON.stringify({categoryId:e.caseDtls.categoryId,query:"",index:1,requestorErecno:e.caseDtls.requestor.erecno}),conreqcsr:csrfToken};ZPeople.Request.send("/cases/allcase/list",i,(function(s){e.recentCases=s,t()}))}))}changeTaskStatus(){this.$cvCsenTsk.on("click","[taskid]  i.PI_tick2_fil",(function(e){var t=$(this),s=$(this).hasClass("grn")?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,i={taskid:$(this).closest("div[taskid]").attr("taskid"),method:"changeTaskStatus",status:s,conreqcsr:csrfToken};$.post("/changeTasksStatus.zp",i,(function(e){if("success"==e.Status){var i=s==Task.OPEN_SYSVALUE?ZPI18N.getString("zp.taskreopenedsuccess"):ZPI18N.getString("zp.taskcompletedsuccess");s==Task.OPEN_SYSVALUE?$(t).removeClass("grn"):$(t).addClass("grn"),ZPeople.Message.showSuccessMsg(i)}}))}))}}class CategoryChange{constructor(e){this.isError=!1,null!=e&&(this.caseViewObj=e,this.$pageDiv=e.$pageDiv,this.caseInfoPanel=e.caseObj.InfoPanel,this.changeCategoryList=this.caseInfoPanel.changeCategoryList,this.categoryId=this.caseViewObj.categoryId,this.categoryName=this.caseViewObj.categoryName,this.subCgyList=this.caseViewObj.subCgyList,this.subCategoryId=this.caseViewObj.subCategoryId,this.isFollowCase=!1)}init(){this.$pageDiv.append('<div id="cseChngeCat" class="zpl_mdl zpl_mcenter zpl_mopen"> <div class="zpl_minr"> <div class="zpl_mhder"> <div> <h4>Change Category</h4> </div> <a id="clsCC" class="_cls PI_cls"></a> </div> <div class="zpl_mcnt"> <div class="zpl_crd"> <div class="zpl_crdcnt"> <div id="cgySecCC" class="zpl_secn"> <div> <label>Category</label> </div> <div> <select id="cgySelCC" class="select-js" style="display: none;"> </select></div> </div> <div id="subCgySecCC" class="zpl_secn zpl_DNI"> <div> <label>Sub-Category</label> </div> <div> <select style="display: none;" id="subCgySelCC" class="select-js"> </select> </div> </div> </div> </div> </div> <div class="zpl_mfoter"> <button id="saveCC" type="button" class="zlabel zlabel--blue zlabel--medium">Save</button> <button id="cancelCC" type="button" class="zlabel zlabel--outline zlabel--medium">Cancel</button> </div> </div> </div>'),this.$cseChngeCat=this.$pageDiv.find("#cseChngeCat"),this.$cgySecCC=this.$pageDiv.find("#cgySecCC"),this.$subCgySecCC=this.$pageDiv.find("#subCgySecCC"),this._setCgyData(),this.initCgy(),this.initSubCgy(),this.listen()}_setCgyData(){let e=this.changeCategoryList;this.subCgyList=[];for(let t=0;t<e?.length;t++){let s=e[t];if(this.isSubCategoryMandatory=s.isSubCategoryMandatory,this.categoryId==s.categoryId){this.subCgyList=s?.subCategoryList||[];break}}}initCgy(){this._setIconClass(this.changeCategoryList);let e={options:this.changeCategoryList,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$cseChngeCat,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:{value:"categoryId",label:"categoryName",iconClassName:"iconClass"},contentType:"image-text",dropdownList:{contentType:"image-text",bodyItemVisibleCount:7,isTextHTMLEncoded:!0},selectedValue:this.caseViewObj.categoryId};this.$cgySel=this.$cgySecCC.find("#cgySelCC"),ZPeopleComponents.select(this.$cgySel,e);let t=this;this.$cgySel.off("zselectoptionclick").on("zselectoptionclick",(function(e,s){t.categoryId=s.optionData.categoryId,t.categoryName=s.optionData.categoryName,t.subCgyList=s.optionData?.subCategoryList||[],t.isSubCategoryMandatory=s.optionData?.isSubCategoryMandatory,t.subCategoryId=void 0,t.initSubCgy()}))}_setIconClass(e){for(let t=0;t<e?.length;t++)e[t].iconClass=ServiceIcons.getIconClass(e[t].categoryIcon)}initSubCgy(){if(this.subCgyList.length>0){let e={value:"subCategoryId",label:"subcategoryname"},t={options:this.subCgyList,clearButton:!this.isSubCategoryMandatory,placeholder:ZPI18N.getString("zp.select"),appendTo:this.$cseChngeCat,randomDropdownListId:!0,cacheData:!0,multiple:!1,isLabelHTMLEncoded:!0,dataMapping:e,contentType:"image-text",dropdownList:{contentType:"text",bodyItemVisibleCount:7,isTextHTMLEncoded:!0}};null!=this.subCategoryId?t.selectedValue=this.subCategoryId:ZPUtil.Validation.isEmpty(this.subCategoryId)&&(t.selectedIndex=-1),this.$subCgySecCC.removeClass("zpl_DNI"),this.$subCgySel=this.$subCgySecCC.find("#subCgySelCC"),null!=ZPeopleComponents.select(this.$subCgySel)&&ZPeopleComponents.select(this.$subCgySel).destroy(),ZPeopleComponents.select(this.$subCgySel,t);let s=this;this.$subCgySel.off("zselectchange").on("zselectchange",(function(e,t){s.subCategoryId=null==t.optionData?.subCategoryId?"":t.optionData.subCategoryId}))}else this.$subCgySecCC.addClass("zpl_DNI")}listen(){this.close(),this.save()}save(){let e=this;this.$cseChngeCat.find("#saveCC").off().on("click",(async function(){e.changeCategory(ZPI18N.getString("zp.categorychangesuccs")).then((()=>{e.isError||(e._setData(),e.$cseChngeCat.remove())}))}))}_setData(){this.caseViewObj.categoryId=this.categoryId,this.caseViewObj.categoryName=this.categoryName,this.caseViewObj.subCgyList=this.subCgyList,this.caseViewObj.subCategoryId=this.subCategoryId,this.caseViewObj.$cgyInp.val(ZPeople.decodeTxt(this.categoryName)),this.caseViewObj.initSubCgy()}changeCategory(e){let t=this;return new Promise(((s,i)=>{let a={conreqcsr:csrfToken,method:"changeCatalog",categoryId:this.categoryId,zp_recordId:this.caseViewObj.caseId};null!=this.subCategoryId&&(a.subCategoryId=this.subCategoryId),this.isFollowCase&&(a.followCase=!0),ZPeople.Request.send("/cases/category/change",a,(function(i){if("success"!=i.status){let e="string"==typeof i?.desc?i?.desc:i.desc.category;ZPeople.Message.showFailureMsg(e),t.isError=!0}else t.isError=!1,ZPeople.Message.showSuccessMsg(e),t.caseViewObj.afterActionsCommentUpdate(i),ZPUtil.Validation.isEmpty(i.sla)||($("#slaBandHdr").remove(),t.caseViewObj.caseObj.sla=i.sla,t.caseViewObj.slaHrd());s()}))}))}close(){let e=this;this.$cseChngeCat.find("#clsCC, #cancelCC").off().on("click",(function(){e.$cseChngeCat.remove()}))}}class feedbackSubmit{constructor(e){this.caseObj=e.caseObj,this.$pageDiv=e.$pageDiv,this.$cmtRwDiv=e.$cmtRwDiv,this.caseId=e.caseId,this.isFeedbackPostAllowed=this.caseObj.InfoPanel?.feedbackPostComment,this.feedbackType=this.caseObj.InfoPanel?.casesFeedbackType,this.type5='<div class="zpl_cSfdbSml"> <span class="zp_em_dagree"></span> <span class="zp_em_smdagree"></span> <span class="zp_em_nadagree"></span> <span class="zp_em_smagree"></span> <span class="zp_em_sagree"></span></div>',this.type3='<div class="zpl_cSfdbSml">  <span class="zp_em_smdagree"></span> <span class="zp_em_nadagree"></span> <span class="zp_em_smagree"></span></div>',this.pop=5==this.feedbackType?["zp_em_dagree","zp_em_smdagree","zp_em_nadagree","zp_em_smagree","zp_em_sagree"]:["zp_em_smdagree","zp_em_nadagree","zp_em_smagree"]}static fetchFeedbackSmiley(e,t){if(5==t)switch(e){case 1:return'<span class="zp_em_dagree"></span>';case 2:return'<span class="zp_em_smdagree"></span>';case 3:return'<span class="zp_em_nadagree"></span>';case 4:return'<span class="zp_em_smagree"></span>';case 5:return'<span class="zp_em_sagree"></span>'}else switch(e){case 1:return'<span class="zp_em_dagree"></span>';case 2:return'<span class="zp_em_nadagree"></span>';case 3:return'<span class="zp_em_sagree"></span>'}}async constructFeedbackRow(){this.isFeedbackPostAllowed&&(this.$cmtRwDiv.append(`<div id="feedbackCmtRw" class="zpl_tmlnrow"> <div class="zpl_tmlnrgt"> <div class="zpl_crd"> <div class="zpl_usrpfl"> <div class="zpl_em"> <div class="zpl_emimg zpl_cSicn"><i class="PI_setting"></i> </div> </div> <div class="zpl_cSfdbckclk">${5==this.feedbackType?this.type5:this.type3} <div> <p>Give your feedback</p> </div> </div> <div> <button id="sbtFeedback" class="zlabel zlabel--blue zlabel--medium">Feedback</button> </div> </div> </div> </div> </div>`),this.$sbtFeedback=this.$cmtRwDiv.find("#sbtFeedback"),await this.fetch(),this.listen())}fetch(){let e=this;return new Promise(((t,s)=>{let i={conreqcsr:csrfToken,method:"getFeedbackForPopup",recordId:e.caseId};ZPeople.Request.send("/cases/feedback/popup",i,(function(s){s.hasOwnProperty("status")&&"failure"==s.status?ZPeople.Message.showFailureMsg(s.message):e.feedbackData=s,t()}))}))}fetchFeedback(){let e=this;return new Promise(((t,s)=>{let i={conreqcsr:csrfToken,recordId:e.caseId};ZPeople.Request.send("/cases/feedback/view",i,(function(s){if(s.hasOwnProperty("status")&&"failure"==s.status)ZPeople.Message.showFailureMsg(s.message);else{var i=ZPeople.getUserDetailsById(s.commby),a={zuid:i.id,empid:i.empid,name:i.name,employeePhoto:i.avatar};$.each(s.commentArr,(function(t,s){var i={content:s.content,commat:s.commat,commbyinfo:a};let n=new CommentRow(i,e.caseObj.HRCaseFeedComment.departmentDts,e.caseObj.HRCaseFeedComment.groupDts).constructCmtRow();e.$cmtRwDiv.append(n)}))}t()}))}))}listen(){let e=this;this.$sbtFeedback.off().on("click",(function(){0!=e.$pageDiv.find("#feedbackPopup").length?(e.reset(),e.$pageDiv.find("#feedbackPopup").addClass("zpl_mopen")):e.constructPopup()}))}reset(){getThis.$pageDiv.find("#feedbackPopup").find('[name="reactArr"]').removeClass("zpl_act"),getThis.$pageDiv.find("#feedbackPopup").find("#feedbackCmt").val(""),getThis.$pageDiv.find("#feedbackPopup").find("#followupMsg").addClass("zpl_DNI")}constructPopup(){this.reactArr="";let e=this;$.each(this.feedbackData.feedbackReaction,(function(t,s){e.reactArr+=`<div name="reactArr"><span class="${e.pop[t]}"></span><p>${s.reactionName}</p></div>`})),this.$pageDiv.append(`<div id="feedbackPopup" class="zpl_mdl zpl_mcenter zpl_mmd zpl_mopen" > <div class="zpl_minr"> <div class="zpl_mhder"> <div> <h4>Cases Feedback</h4> </div> <a id="feedbackPCls" class="_cls PI_cls"></a> </div> <div class="zpl_mcnt"> <div class="zpl_crd"> <div class="zpl_crdcnt"> <div class="zpl_secn"> <p>Tell us about your experince</p> <div class="zpl_cSfdbckGcnt"> ${this.reactArr} </div> <p id="followupMsg" class="zpl_DNI">Tell us about your experince</p> <div> <textarea id="feedbackCmt" type="text" placeholder="Write your feedback here" rows="4" class="ztextbox"></textarea> </div> </div> </div> </div> </div> <div class="zpl_mfoter"> <button id="feedbackPost" type="button" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.submit")}</button> <button id="feedbackCnl" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.cancel")}</button> </div> </div> </div>`),this.$feedbackPopup=this.$pageDiv.find("#feedbackPopup"),this.$followupMsg=this.$feedbackPopup.find("#followupMsg"),this.PopupListen()}PopupListen(){this.reactListen(),this.clsPopup(),this.sbtFeedback()}reactListen(){let e=this;this.$feedbackPopup.find('[name="reactArr"]').off().on("click",(function(){$(this).siblings().removeClass("zpl_act"),$(this).addClass("zpl_act");let t=e.feedbackData.feedbackReaction[$(this).index()];e.$followupMsg.text(decodeHTML(t?.followUpMessage)).removeClass("zpl_DNI")}))}clsPopup(){let e=this;this.$feedbackPopup.find("#feedbackCnl").off().on("click",(function(){e.$feedbackPopup.removeClass("zpl_mopen")})),this.$feedbackPopup.find("#feedbackPCls").off().on("click",(function(){e.$feedbackPopup.removeClass("zpl_mopen")}))}sbtFeedback(){let e=this;this.$feedbackPopup.find("#feedbackPost").off().on("click",(function(){let t=e.$feedbackPopup.find('[name="reactArr"].zpl_act');if(0!=t.length){let s=e.feedbackData.feedbackReaction[t.index()].reactionId,i={conreqcsr:csrfToken,method:"postFeedback",reactionId:s,recordId:e.caseId},a=e.$feedbackPopup.find("#feedbackCmt").val().trim();""!=a&&(i.comment=a),ZPeople.Request.send("/cases/feedback/post",i,(function(t){e.$feedbackPopup.remove(),e.$pageDiv.find("#feedbackCmtRw").remove();var s=ZPeople.getUserDetailsById(erecno),i={zuid:s.id,empid:s.empid,name:s.name,employeePhoto:s.avatar},a={content:t.comment,reactionName:t.reactionName,reactionType:t.reactionType,commat:Date.now(),commbyinfo:i,isFeedbackComment:!0,ratingType:e.feedbackData.feedbackReaction.length};let n=new CommentRow(a,e.caseObj.HRCaseFeedComment.departmentDts,e.caseObj.HRCaseFeedComment.groupDts).constructCmtRow();e.$cmtRwDiv.append(n),1==t.status?ZPeople.Message.showSuccessMsg(e.feedbackData.feedbackMessage):ZPeople.Message.showFailureMsg(t.message)}))}else ZPeople.Message.showFailureMsg("Choose your reaction")}))}}class CommentRow{constructor(e,t,s){if(this.cmtObj=e,this.departmentDts=t,this.groupDts=s,this.isFeedbackComment=null!=e.isFeedbackComment&&e.isFeedbackComment,this.content=ZPFeeds.Activity.validateContent(e.content,e.isEncoded,t,s),this.imgDiv=e?.commby?`<img src="${e?.commbyinfo.employeePhoto}">`:'<i class="PI_setting"></i>',this.zpl_cSicn="",this.cmtObj?.isEscSysComment&&(this.imgDiv='<i class="PI_setting"></i>',this.zpl_cSicn="zpl_cSicn"),this.userDtls="",this.contentDiv="",this.cmtObj?.isEscSysComment||this.cmtObj?.isDeletedComment)this.userDtls=` <div class="zpl_usrdtls"><div><span id="usrSpn">${this.content}</span></div></div>`;else if(this.isFeedbackComment){let t='<div class="zpl_cSfdbSml">'+feedbackSubmit.fetchFeedbackSmiley(e.reactionType,e.ratingType)+"</div>";this.imgDiv=`<img src="${this.cmtObj?.commbyinfo.employeePhoto}">`,this.userDtls=` <div class="zpl_usrdtls" empid="${this.cmtObj?.commbyinfo?.zuid}" popup="user"><div><span id="usrSpn">${this.cmtObj?.commbyinfo?.empid} - ${this.cmtObj?.commbyinfo?.name}</span></div></div>`,this.contentDiv=`<div class="zpl_cSdtls zpl_ba"> <div class="zpl_cSfdbckclk">${t}<div class=""><h5>${ZPI18N.getString("zp.feedback")} - ${e.reactionName}</h5><p>${this.content}</p></div></div></div>`}else this.userDtls=` <div class="zpl_usrdtls" empid="${this.cmtObj?.commbyinfo?.zuid}" popup="user"><div><span id="usrSpn">${this.cmtObj?.commbyinfo?.empid} - ${this.cmtObj?.commbyinfo?.name}</span></div></div>`,this.contentDiv=`<div class="zpl_cSdtls"> <div class="zpl_cScntdtls"><p>${this.content}</p></div></div>`;this.grnbglit1="",this.grnbdr="",this.cmtObj?.isEscSysComment&&(this.grnbglit1="grnbglit1",this.grnbdr="grnbdr"),this.zpl_op5=this.cmtObj?.isDeletedComment?"zpl_op5":"",this.deleteIC=this.cmtObj?.isEscSysComment||this.cmtObj?.isDeletedComment||this.cmtObj?.isSysComment||!this.cmtObj?.isDelete?"":'<i name="delCmt" class="PI_delete"></i>',this.dateDiv=`<div><date>${ZPDateTime.getDateDisplayFormat(this.cmtObj.commat)}</date>${this.deleteIC}</div>`,this.attachDiv=this.getAttachedFiles()}constructCmtRow(){this.cmtRow="";let e=null!=this.cmtObj.commbyinfo?this.cmtObj.commbyinfo.name:"   "+this.cmtObj.content;return 0==$(`<div>${this.content}</div>`).find("[name=postFeedback]").length&&(this.cmtRow=`<div ${this.cmtObj?.commentId?`cmtID="${this.cmtObj.commentId}"`:""}class="zpl_tmlnrow ${this.zpl_op5}" aria-label = "${e}"> <div class="zpl_tmlnrgt ${this.grnbdr}"> <div class="zpl_crd ${this.grnbglit1}"> <div class="zpl_usrpfl"> <div class="zpl_em"> <div class="zpl_emimg ${this.zpl_cSicn}">${this.imgDiv}</div> </div> ${this.userDtls} ${this.dateDiv} </div> ${this.contentDiv} ${this.attachDiv} </div> </div> </div> </div>`),this.cmtRow}getAttachedFiles(){let e="";if(this.cmtObj?.cmtattList?.length>0){this.attachList=this.cmtObj?.cmtattList;for(let t=0;t<this.attachList.length;t++){let s=this.attachList[t],i=s.fileName.substring(s.fileName.lastIndexOf(".")+1),a=FilesCommon.getFileIcon(i),n=/[a-zA-Z]/.test(s?.fileSize)?s.fileSize:this.covertBytesFileSize(s.fileSize),l=s.fileName,o=ZPFeeds.Activity.getFileViewUrl(i,s.downloadFileId,"HrCase",this.cmtObj.actRecId),c=s?.commentId?s.commentId:s.actRecId,d=s?.downloadFileId?s.downloadFileId:"",r=ZPUtil.Validation.isImage(i);if(r){o="","gif"===i.substring(i.length,i.length-3)&&(!0,d=s.thumbId)}let p=d?`downloadAttachment?recId=${this.cmtObj.actRecId}&fileId=${d}&acttype=HrCase&type=HrCase`:"";e+=`<div ${r?`href=${p}`:`file=${!r}`} ${""!=p?`downloadurl="${p}"`:""} viewUrl="${o}" fieldtitle="${l}" title="${l}"  rel="${c}" class="zpl_atchd atsml"> <div> <div class="zpl_atchimg"> <i class="${a}"></i> </div> <div class="zpl_atchdtl"> <h4>${l}</h4> <p><span>${n}</span></p> </div> ${""!=p?'<div class="zpl_atchicn"><i class="PI_downld"></i></div>':""} </div> </div>`}e=`<div class="zpl_cSdtls"> <div> <h5>${ZPI18N.getString("zp.attachments")}</h5> </div> <div class="flex-wrap zpl_idiv"> ${e} </div> </div>`}return e}covertBytesFileSize(e){let t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["kB","MB","GB","TB"][t]}}class SlaHistory{constructor(e){this.caseViewObj=e,this.$pageDiv=e.$pageDiv}async init(){this.$pageDiv.append('<div id="slaTimeLine" class="zpl_mdl zpl_mopen" > <div class="zpl_minr"> <div class="zpl_mhder"> <div> <h4>SLA Timeline</h4> </div> <a id="slaTmeCls" class="_cls PI_cls"></a> </div> <div id="slaTmeCnt" class="zpl_mcnt"> </div> </div> </div>'),this.$slaTimeLine=this.$pageDiv.find("#slaTimeLine"),this.$slaTmeCnt=this.$slaTimeLine.find("#slaTmeCnt"),this.slaPageLoading=new LoadingClass(this.$slaTmeCnt),this.slaPageLoading.add(),await this.fetch(),this.slaPageLoading.remove(),this.construct(),this.listen()}fetch(){let e=this;return new Promise(((t,s)=>{let i={recordId:this.caseViewObj.caseId,method:"getSLATimeline"};ZPeople.Request.send("/cases/sla/timeline",i,(function(s){e.slaData=s,t()}))}))}construct(){if(null!=this.slaData&&this.slaData.length>0){let e="";$.each(this.slaData,(function(t,s){e+=`<div class="zpl_tmlnhd"> <div class="zpl_tmlnlft"> <h3 class="blu">${ZPI18N.getString("zp.level")} ${t+1}</h3> </div> </div>`,$.each(s,(function(t,s){$.each(s,(function(t,s){let i="";$.each(s.actions,(function(e,t){i+=`<p>${t.message}</p>`}));let a=s.slatime.split("-"),n=a[0],l=a[1],o=a[2].split(" ")[0],c=a[2].split(" ")[1]+" "+a[2].split(" ")[2];e+=`<div class="zpl_tmlnrow ${s.isExecuted?"zpl_tmcmpl":""}"> <div class="zpl_tmlnlft"> <div> <b>${n} ${l}</b> <span>${o}</span> <div><em>${c}</em></div> </div> </div> <div class="zpl_tmlnrgt"> <div class="zpl_crd"> <div class="d-flexclmcap"> ${i} </div> </div> </div> </div>`}))}))})),this.$slaTmeCnt.append(`<div class="zpl_tmln zpl_adhstry wd100_per">${e}</div>`)}else new EmptyPages("zp_nd_cases",ZPI18N.getString("zp.noescalationfound"),"",this.$slaTmeCnt).show()}listen(){let e=this;this.$slaTimeLine.find("#slaTmeCls").off().on("click",(function(){e.remove()}))}remove(){this.$slaTimeLine.remove()}}class CasesFeeds{constructor(e,t){this.recordId=e,this.$feedContainer=t}getFeedContainer(){return this.$feedContainer}setStaticValue(e,t){var s="<span>"+(ZPUtil.Validation.isEmpty(t)?this.$feedContainer.find("[name="+e+"]").html():t)+"</span>";this.$feedContainer.find("[name="+e+"]").replaceWith(s)}replaceMenuValue(e,t){this.$feedContainer.find("a[name="+e+"]").html(t)}changePriority(e){let t=this;CommonMethod.getPriorityList().then((()=>{let s=[],i=$("#cpr_"+t.recordId);$.each(casesObj.PRIORITY,(function(e){var t={id:casesObj.PRIORITY[e],value:e};s.push(t)}));let a={contentType:"text",randomDropdownListId:!0,forElement:e,items:s,dataMapping:{value:"id",text:"value"},displayType:"callout",bodyItemVisibleCount:5,width:150};null!=ZPeopleComponents.dropdownlist(i)&&ZPeopleComponents.dropdownlist(i).destroy(),ZPeopleComponents.dropdownlist(i,a),ZPeopleComponents.dropdownlist(i).deselectAll(),ZPeopleComponents.dropdownlist(i).open(),i.off("zdropdownlistitemclick").on("zdropdownlistitemclick",(function(e,s){let i=s.itemData.id,a=s.itemData.value;var n={conreqcsr:csrfToken,priority:i,zp_recordId:t.recordId,method:"changePriorityOption"};ZPeople.Request.send("/cases/priority/change",n,(function(e){"success"==e.status&&(t.replaceMenuValue("feed_priority",ZSEC.Encoder.encodeForHTML(a)),t.constructComment(e))}))}))}))}changeStatus(e){let t=this;var s=[];let i=$("#cst_"+t.recordId);var a={method:"getPermittedStatus",conreqcsr:csrfToken,caseId:t.recordId};$.ajax({url:"/cases/status/permitted",type:"POST",data:a,async:!1,success:function(e){$.each(e.permittedCaseStatus,(function(e,t){var i={id:t.systemValue,value:ZPeople.decodeTxt(t.optionValue)};s.push(i)}))}});let n={contentType:"text",randomDropdownListId:!0,forElement:e,items:s,dataMapping:{value:"id",text:"value"},displayType:"callout",bodyItemVisibleCount:5,width:200};null!=ZPeopleComponents.dropdownlist(i)&&ZPeopleComponents.dropdownlist(i).destroy(),ZPeopleComponents.dropdownlist(i,n),ZPeopleComponents.dropdownlist(i).deselectAll(),ZPeopleComponents.dropdownlist(i).open(),i.off("zdropdownlistitemclick").on("zdropdownlistitemclick",(function(e,s){let i=s.itemData.id,a=s.itemData.value;var n={conreqcsr:csrfToken,status:i,zp_recordId:t.recordId,method:"changeCaseStatus"};ZPeople.Request.sendAsyncPost("/cases/status/change",n,(function(e){if("success"==e.status&&(e.permittedCaseStatus.length>0?t.replaceMenuValue("status",ZSEC.Encoder.encodeForHTML(a)):t.setStaticValue("status",ZSEC.Encoder.encodeForHTML(a)),n.status==HRCase.COMPLETED_SID&&(t.setStaticValue("feed_priority"),t.setStaticValue("cgyName")),t.constructComment(e),e.hasOwnProperty("agent")&&!ZPUtil.Validation.isEmpty(e.agent.erecno))){var s='<div class="dpcnt"><img popup="user" empid='+e.agent.empid+' src="'+e.agent.employeePhoto+'" class="zp-usimg"></div><div class="zp-fd-uname">'+e.agent_details+"</div>";t.$feedContainer.find(".zp-fd-user").html(s)}}))}))}changeCategory(e){let t=this;var s=t.$feedContainer,i=new CategoryChange;i.$pageDiv=$("#zpntfn_detail_modal").length>0?$("body #modal_Container"):settingsPage.container;var a=$(e).attr("cgeid"),n=$(e).attr("subcategoryid");i.caseViewObj={categoryId:a,caseId:t.recordId},i.caseViewObj.afterActionsCommentUpdate=function(e){if("success"!=e.status)ZPeople.Message.showFailureMsg(e.desc);else{if(e.assignedToList.hasOwnProperty("assigneeList")&&0==e.assignedToList.assigneeList.length){var i=s.find(".zp-fd-user"),a=e.agent;i.empty().append('<div class="dpcnt"><img popup="user" empid='+a.zuid+' src="'+a.employeePhoto+'" class="zp-usimg FL"></div><div class="zp-fd-uname">'+a.name+"</div>")}else{i=s.find(".zp-fd-user");var n=e.agentTypeId,l=!1;2==n&&e.agentValueId==_LOGGEDIN_DEPID?l=!0:3==n&&$.each(_LOGGEDIN_GROUPID,(function(t,s){e.agentValueId===s&&(l=!0)}));var o='<div class="dpcnt">'+ZPeople.getShortName(e.agent_details)+'</div><div class="zp-fd-uname">'+e.agent_details+'</div><div class="btn-pickup">';!0===l&&(o+="<button caseid="+t.recordId+' class="btn btn-primary">'+ZPI18N.getString("zp.pick")+"</button>"),o+="</div>",i.empty().append(o),i.find("button[caseid]").on("click",(function(e){t.pickupHRCase(this)}))}ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.categorychangesuccs"))}},i._setData=function(){var s=i.categoryName;ZPUtil.Validation.isEmpty(i.subCategoryId)||(s+=" - "+t.getSubCgyName(i.subCategoryId,i.subCgyList)),t.replaceMenuValue("cgyName",s),t.$feedContainer.find("#cgeNameHeader").text(ZPeople.decodeTxt(i.categoryName)),$(e).attr("cgeid",i.categoryId),$(e).attr("subcategoryid",i.subCategoryId)};var l={method:"getPermittedCategory",conreqcsr:csrfToken,caseId:t.recordId};ZPeople.Request.sendAsyncPost("/cases/category/permitted",l,(function(e){i.changeCategoryList=e.changeCategoryList;for(var t=0;t<e.changeCategoryList?.length;t++)e.changeCategoryList[t].categoryId==a&&(i.categoryName=e.changeCategoryList[t].categoryName,i.subCgyList=e.changeCategoryList[t].subCategoryList,i.isSubCgyMandatory=e.changeCategoryList[t].isSubCategoryMandatory)})),i.categoryId=a,i.subCategoryId=n,i.init()}pickupHRCase(e){let t=this;var s={conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:this.recordId,assignedId:erecno};ZPeople.Request.send("/cases/assigned",s,(function(s){if("success"==s.status){var i=$(e).parent().parent();i.empty(),i.append('<div class="dpcnt"><img popup="user" empid='+ZPeople.CURR_USER.id+' src="'+ZPeople.CURR_USER.avatar+'" class="zp-usimg"></div><div class="zp-fd-uname">'+ZPeople.CURR_USER.name+"</div>"),s.hasOwnProperty("content")&&t.constructComment(s)}}))}constructComment(e){var t=ZPFeeds.Activity.validateContent(e.content,void 0,void 0,!1),s="<div  id="+e.cfdk+'  class="zp-cmtdiv" commentid='+e.commentId+"><div empid="+ZPeople.CURR_USER.id+' popup="user" class="zp-cmt-uimg"> <img src='+ZPeople.CURR_USER.thumb+' class="zp-usimg zphvr-cpro"> </div> <div class="zp-cmt-content"><a empid='+e.zuid+' popup="user" class="zp-cmt-uname zphvr-cpro">'+ZPeople.CURR_USER.name+'</a><div class="zp-cmt-udt"><div>'+t+'<br></div></div> <div class="zp-cmt-uaction"> <span class="zpcmt-date FL">'+ZPDateTime.getDateDisplayFormat(e.time)+'</span> <div class="FL ZPdot"></div> <a id="zpcmt_like_link" class="zpcmt-like FL">'+ZPI18N.getString("zp.like")+"</a></div> </div> </div>";(s=$(s)).find("#zpcmt_like_link").off("click").on("click",(function(){ZPFeeds.Like.doLikeAction(this,recId,People.HrCase.type,!0)})),this.$feedContainer.find("#cmtlistcont").removeClass("DN").append(s)}getSubCgyName(e,t){for(var s=0;s<t?.length;s++)if(t[s].subCategoryId==e)return t[s].subcategoryname}}var CasesFAQ={inputBoxHtml:function(e,t,s,i,a,n){return'<div class="zpl_secn"><div><label class="'+(n?"zpl_mtry":"")+'">'+e+'</label></div><div><input id="'+t+'" autocomplete = "off" type="text" class="ztextbox '+(i?"disabled":"")+'" '+(a=null!=a?"maxlength = "+a:"")+' value="'+s+'" '+(i?'disabled = "disabled"':"")+"/></div></div>"},selectDivBoxHtml:function(e,t,s,i){return'<div class="zpl_secn"><div><label class="'+(i?"zpl_mtry":"")+'">'+e+'</label></div><div id="'+t+'" class="'+(s=null!=s?s:"")+'"></div></div>'},editorDivHtml:function(e,t,s,i){return'<div class="zpl_secn"><div><label class="'+(i?"zpl_mtry":"")+'">'+e+'</label></div><div class="'+s+'">'+('<div class="zpl_feedCompsr zpl_edtrply tlbarTop"><div class="feedCompsr_area"><div id="'+t+'" class="feedCompsr_cont"></div></div></div>')+"</div></div>"},fileUploadHtml:function(e){var t=ZPeople.isChinaSetup?"":'/ <a class="zpl_lnk" onclick="CasesFilesCommon.getCloudPicker(this,\'AddFAQ\')" ><i class="PI_cloud"></i>'+ZPI18N.getString("zp.files.cloud")+"</a>",s="";return isWorkdriveAllowed&&(s='/ <a class="zpl_lnk" onclick="WorkDriveInt.showWorkDriveModal(\'AddFAQ\')"><i class="PI_workdrive zpl_icnobg"></i>'+ZPI18N.getString("zp.workdrive")+"</a> "),'<div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.attachments")+'</h5></div><div><div class="zpl_upld"><div class="zpl_fldrp"><h5><div class="zpl_flupld_img"></div>'+ZPI18N.getString("zp.widgetattach",new Array(""))+'<a class="zpl_lnk" onclick="CasesFilesCommon.getFileBoxOnUpload(this)"><i class="PI_desktop"></i>'+ZPI18N.getString("zp.files.desktop")+"</a>"+s+t+'</h5></div></div></div><input id="cgyfileUpd" type="file" class="DN" multiple/></div>'},fileListDivHtml:function(e){return'<div id="'+e+'" class="zpl_secn"><div id="afilesAttach" class="zpl_atchd"></div></div>'},addFAQ:function(e,t,s){e.stopPropagation(),e.preventDefault(),CasesFAQ.FAQ_EDITOR={};var i=null!=t,a=i?"Edit FAQ":ZPI18N.getString("zp.addfaqbtn"),n=new Tab("Add FAQ",(function(){var e={};if(i){var a={mode:"fetchFaq",conreqcsr:csrfToken,faqId:t,categoryId:s};ZPeople.Request.sendAsyncPost("/cases/category/faqinfo",a,(function(t){e=t}))}var n=CasesFAQ.inputBoxHtml(ZPI18N.getString("zp.question"),"afaqquery",i?e.question:"",!1,250,!0);n+=CasesFAQ.editorDivHtml(ZPI18N.getString("zp.answer"),"afaqans","zpl_msgedtr msgedtr_optnl"),n+=CasesFAQ.selectDivBoxHtml(ZPI18N.getString("zp.tags"),"afaqtag"),n+=CasesFAQ.fileUploadHtml("afaqattach"),n+=CasesFAQ.fileListDivHtml("afaqattachDiv"),$("#cardAddFAQ").html('<div class="zpl_crd"><div class="zpl_crdcnt">'+n+"</div></div>");var l={id:"afaqans",mode:"richtext",content:i?e.answer:"",editorheight:300};if(CasesFAQ.FAQ_EDITOR=ZPUtil.initiateZEEditor(l,"HrCase"),CasesFAQ.FAQ_EDITOR.afterEditorLoad((function(){setTimeout((function(){$("#afaqquery").trigger("focus")}),50)})),ZPeopleComponents.tokenfield("#afaqtag",{dataSource:{search:function(e){return new Promise((function(t,s){t({delay:20,results:CasesFAQ.searchTags(e.query),more:!1})}))},paginated:!0},acceptNewValues:!0,showDropDownListOnFocus:!0,dataMapping:{text:"value",value:"id",id:"id"},dropdownList:{closeOnSelect:!1,height:300,checkedIcon:!0}}),i){if(e.tagsArr.length>0){var o=[];$.each(e.tagsArr,(function(e,t){o.push({id:t.tagId,value:t.tagName})})),ZPeopleComponents.tokenfield("#afaqtag").setAttribute("values",o)}e.Files.length>0&&$.each(e.Files,(function(e,t){var s=CasesFilesCommon.viewFileBox(t);$("#afilesAttach").append(s)}))}}),(function(){CasesFAQ.saveFAQ(t,s,!1)})),l=$("#zpntfn_detail_modal").length;CasesFAQ.ADD_FAQ_MODAL=new sliderModal(a,n),l>0&&(CasesFAQ.ADD_FAQ_MODAL.isAppendToBody=!0),CasesFAQ.ADD_FAQ_MODAL.setCloseCallback((function(){CasesFAQ.FAQ_EDITOR={},ZPeopleComponents.tokenfield($("#afaqtag")).destroy(),CasesFAQ.ADD_FAQ_MODAL.remove()})),CasesFAQ.ADD_FAQ_MODAL.save=ZPI18N.getString("zp.save"),CasesFAQ.ADD_FAQ_MODAL.construct(),$('<button id="sliderSbtAtch" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.saveandattach")+"</button>").insertAfter($("#tabAddFAQ").find("#sliderSbt")),$("#sliderSbtAtch").off("click").on("click",(function(e){CasesFAQ.saveFAQ(t,s,!0)})),$("#afaqquery").focus(),$("#cardAddFAQ").removeClass("zpl_fm")},saveFAQ:function(e,t,s){var i=$("#afaqquery").val();$("#afaqquery").removeClass("ztextbox__error").siblings("span").remove();var a=$.trim($(CasesFAQ.FAQ_EDITOR.iframe.contentDocument.body).html()),n=ZPeopleComponents.tokenfield($("#afaqtag")).getAllValues(),l="",o="",c=[];if($.each(n,(function(e,t){t.hasOwnProperty("newToken")&&t.newToken?o+=t.value+",":l+=t.id+","})),l=l.slice(0,-1),o=o.slice(0,-1),ZPUtil.Validation.isEmpty(i))CasesFAQ.setErrorMsg($("#afaqquery"),ZPI18N.getString("zp.enterquery"));else{var d={categoryId:t,answer:a,question:i};""!=l&&(d.tagsIds=l),""!=o&&(d.createTags=o),null!=e&&(d.faqId=e);var r=[];if($("#afilesAttach").find("div.zpl_DNI[name=fBox][fileid]").length>0&&$("#afilesAttach").find("div.zpl_DNI[name=fBox][fileid]").each((function(e,t){r.push($(this).attr("fileid"))})),d.deletedFileIds=r.join(","),$("#afilesAttach").find("div[name=fBox]:not(.zpl_DNI)").length>5)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxfileupload"));else if($("#afilesAttach").find("div[name=fBox]:not([fileid])").length>0){var p=new FormData;p.append("loginUserZUID",_ZUIDENRYPT),p.append("formId",0),p.append("tableName","P_HRCase_FAQ"),p.append("conreqcsr",csrfToken);var g=[],h=[],u=[];$("#afilesAttach").find("div[name=fBox]:not([fileid])").each((function(e){var t=$(this).data("uploadMode"),s=$(this).data("cloudUploadDoc"),i=$(this).data("WDUploadDoc"),a=$(this).data("caseFileUpload");"cloudUpload"==t?g.push(s):"localUpload"==t&&void 0!==a?u.push(a):"workDriveUpload"==t&&void 0!==i&&h.push(i)})),u.length>0&&(c=u,d.attachment=JSON.stringify(u)),g.length>0||h.length>0?(p.append("uploadFromCloud",JSON.stringify(g)),p.append("uploadFromWD",JSON.stringify(h)),p.append("attachment",JSON.stringify(u)),p.append("needJSONresponse",!0),$.ajax({url:"/fileUploadAction.zp",type:"POST",data:p,contentType:!1,processData:!1,cache:!1,error:function(e){var t=JSON.parse(e);ZPeople.Message.showFailureMsg(t.error)},success:function(i){var a=[];7e3==i.code&&$.each(i.message,(function(e,t){var s={filePath:t.filePath,fileName:t.fileName};null!=t.uploadSource?s.uploadSource=t.uploadSource:s.uploadSource=0,a.push(s)})),d.attachment=JSON.stringify($.merge(a,c)),CasesFAQ.faqRequestCall(d,e,t,s)}})):CasesFAQ.faqRequestCall(d,e,t,s)}else CasesFAQ.faqRequestCall(d,e,t,s)}},faqRequestCall:function(e,t,s,i){var a=[];a.push(e);var n={faqConf:JSON.stringify(a),mode:"addFaq"};ZPeople.Request.send("/cases/faq/add",n,(function(e){"success"==e.status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqsuccessmsg")),i&&CasesFAQ.attachFAQ(e.FAQLIST[0]),CasesFAQ.ADD_FAQ_MODAL.close(),CasesFAQ.ADD_FAQ_MODAL.remove(),CasesFAQ.ADD_FAQ_MODAL=void 0):ZPeople.Message.showFailureMsg(e.desc)}))},showShareFAQSlider:function(e,t){var s={conreqcsr:csrfToken,method:"relatedFAQ"};s.caseId=t;var i=new Tab("Attach FAQ",(function(){$("#cardAttachFAQ").html('<div class="zpl_crd"><div class="zpl_crdhdr zpl_crdhdrcnt"><div><div class="zpl_idiv"><div class="zpl_search zpl_srchsml "><input id="atchfaqSearch" placeholder="Search" type="text" class="ztextbox"><i class="PI_lens"></i></div></div></div></div><div class="zpl_crdcnt"><div id="relFAQLst"></div><div class="zpl_DNI" id="srchFAQList"></div></div></div>');var e=$("<div></div>");ZPeople.Request.send("/cases/faq/related",s,(function(t){t.FAQ_LIST.length>0?(CasesFAQ.removeEmptyData($("#relFAQLst")),$.each(t.FAQ_LIST,(function(t,s){e.append(CasesFAQ.faqListRow(s))}))):e.html(CasesFAQ.emptyData("No Related FAQs found. Please search to find more FAQs.")),$("#relFAQLst").empty().append(e.children())}));var t=null;clearTimeout(t),$("#cardAttachFAQ").find("#atchfaqSearch").off("keyup").on("keyup",(function(e){var s=ZSEC.Encoder.encodeForHTML(this.value.trim());s.length>=3?($("#srchFAQList").removeClass("zpl_DNI"),$("#relFAQLst").addClass("zpl_DNI"),clearTimeout(t),t=setTimeout((function(){CasesFAQ.searchFAQ(s)}),700)):s.length<1&&($("#srchFAQList").addClass("zpl_DNI"),$("#relFAQLst").removeClass("zpl_DNI"))}))})),a=$("#zpntfn_detail_modal").length;CasesFAQ.ATTACH_FAQ_MODAL=new sliderModal(ZPI18N.getString("zp.attachfaq"),i),a>0&&(CasesFAQ.ATTACH_FAQ_MODAL.isAppendToBody=!0),CasesFAQ.ATTACH_FAQ_MODAL.setCloseCallback((function(){CasesFAQ.ATTACH_FAQ_MODAL.remove(),CasesFAQ.ATTACH_FAQ_MODAL=void 0})),CasesFAQ.ATTACH_FAQ_MODAL.construct(),$("#tabAttachFAQ").find("#sliderSbt").remove(),$("#cardAttachFAQ").removeClass("zpl_fm")},searchFAQ:function(e){var t=$("<div></div>"),s={mode:"searchFAQ",searchStr:e,conreqcsr:csrfToken};ZPeople.Request.send("/cases/faq/search",s,(function(e){e.FAQ_LIST.length>0?(CasesFAQ.removeEmptyData($("#srchFAQList")),$.each(e.FAQ_LIST,(function(e,s){t.append(CasesFAQ.faqListRow(s))}))):t.html(CasesFAQ.emptyData("No FAQs found for the search query.")),$("#srchFAQList").empty().append(t.children())}))},attachFAQ:function(e){var t=$(ZPFeeds.COMMENTEDITOR.doc).find("body").html()+'<div class="zp_cVrBx zp_cVfaQ" style="padding: 10px;background-color: #F5F5F5;border-radius: 5px;box-shadow: 0 0 4px rgba(0, 0, 0, 0.1) inset;"><h5 style="margin-top: 5px;"  name="sharefaq'+e.faqID+'">'+e.query+"</h5></div>";ZPFeeds.COMMENTEDITOR.setContent(t),null!=CasesFAQ.ATTACH_FAQ_MODAL&&CasesFAQ.ATTACH_FAQ_MODAL.close()},faqListRow:function(e){var t=$('<div faqId="'+e.faqID+'" class="zpl_msplst"> <div><div class="zpl_msp-dts"><div class="zpl_msp-name"><div class="zpl_msp-title"><span>'+e.query+"</span></div></div><div><em>"+e.catalogName+'</em></div></div><div class="zpl_msp-act"><div class="zpl_hvr"><button name="atchfaqbtn" class="zlabel zlabel--blue zlabel--medium zlabel--outline">'+ZPI18N.getString("zp.attach")+"</button></div></div></div></div>");return t.find("[name=atchfaqbtn]").off("click").on("click",(function(t){t.stopPropagation(),t.preventDefault(),CasesFAQ.attachFAQ(e)})),t},setErrorMsg:function(e,t){e.removeClass("ztextbox__error"),e.siblings("span").remove(),e.addClass("ztextbox__error"),e.after('<span class="ztextbox--error__label">'+t+"</span>")},emptyData:function(e,t,s,i,a){var n="";return null!=s&&""!=s&&(n='<font><button onclick ="'+i+'" class="zlabel zlabel--blue zlabel--medium ">'+s+"</button></font>"),'<div id="emptPage"><div class="zpl_Emptydata"><div><div class="zpl_emptimg '+(a=a||"zp_nd_record")+'"></div><h4>'+(e=null!=e?e:ZPI18N.getString("zp.norecfound"))+"</h4><p>"+(t=null!=t?t:"")+"</p>"+n+"</div></div></div>"},removeEmptyData:function(e){null!=e?e.find("div#emptPage").remove():$("div#emptPage").remove()},searchTags:function(e,t){var s=[];if((e=null==e||""==e?"":e).length>=2){var i={method:"searchTags",conreqcsr:csrfToken};null!=e&&(i.tagStr=e.trim()),null!=t&&(i.recordId=t);let l="/cases/faq/tags";if(window.location.hash.includes("resources/faq")){l="/services/faq/tags";var a=window.location.hash.split("/")[2],n=$.grep(ZPServices.SERVICE_JSON,(function(e){return e.tabName.toLowerCase()==a.toLowerCase()}));i.serviceName=n[0].tabName}ZPeople.Request.sendAsyncPost(l,i,(function(e){$.each(e,(function(e,t){var i={};i.value=t.tagName,i.id=t.tagId,s.push(i)}))}))}return s}};class CasesCommon{static MANAGER_TYPE="3";static MANAGER_LIST={};static STATUS={};static PRIORITY={};static ALLPRIORITY={};static SOURCE={};static CASETYPE={};static OPEN_SID="1";static INPROGRESS_SID="2";static AWAITING_SID="3";static ONHOLD_SID="4";static COMPLETED_SID="5";static CANCELLED_SID="6";static caseFormId={};static isCaseAdmin(e){var t,s=!1;return null==casesObj.ISCASEADMIN&&ZPeople.Request.sendAsyncPost("/cases/admin/data",{method:"getUserCasesAdminData",conreqcsr:csrfToken},(function(e){casesObj.ISCASEADMIN=e.isCasesAdmin,casesObj.CATEGORYADMINDATA=e.categoryAdmin})),t=casesObj.ISCASEADMIN,ZPUtil.Validation.isEmpty(e)||(s=$.isEmptyObject(casesObj.CATEGORYADMINDATA)&&-1!=casesObj.CATEGORYADMINDATA.indexOf(e)),t||s}static getStatusList(){if($.isEmptyObject(CasesCommon.STATUS)){let e={method:"getStatusList",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/cases/status/list",e,(function(e){for(let t=0;t<e.length;t++){let s=e[t];CasesCommon.STATUS[s.systemValue]=s.optionValue}}))}}static getPriorityList(){if($.isEmptyObject(CasesCommon.PRIORITY)||$.isEmptyObject(CasesCommon.ALLPRIORITY)){let e={method:"getPriorityList",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/cases/priority/list",e,(function(e){CasesCommon.ALLPRIORITY=e;for(let t=0;t<e.length;t++){let s=e[t];CasesCommon.PRIORITY[s.systemValue]=s.optionValue}}))}}static getSourceList(){if($.isEmptyObject(CommonMethod.SOURCE)){let e={method:"getSourceList",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/cases/source/list",e,(function(e){for(let t=0;t<e.length;t++){let s=e[t];CommonMethod.SOURCE[s.optionValue]=s.systemValue}}))}}static getCaseTypeList(){if($.isEmptyObject(CommonMethod.CASETYPE)){let e={method:"getCaseTypeList",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/cases/types/list",e,(function(e){for(let t=0;t<e.length;t++){let s=e[t];CommonMethod.CASETYPE[s.optionValue]=s.systemValue}}))}}static getCaseFormId(){if(void 0===CommonMethod.caseFormId){csrfToken;ZPeople.Request.sendAsyncPost("/cases/formid/list",params,(function(e){CommonMethod.caseFormId=e.caseformid}))}return CommonMethod.caseFormId}static getManagerList(e){if($.isEmptyObject(CasesCommon.MANAGER_LIST[e])){let t={method:"getManagerAgents",conreqcsr:csrfToken,erecno:e};ZPeople.Request.sendAsyncPost("/cases/manager/list",t,(function(t){var s=[];$.each(t,(function(e,t){s.push({id:t.empErecno,text:t.empDispName,value:t.empDispName,type:OWNER_EMPLOYEE,image:t.empPhoto,imageAlt:""})})),CasesCommon.MANAGER_LIST[e]=s}))}return CasesCommon.MANAGER_LIST[e]}static _getPreRequiste(){CommonMethod.getStatusList(),CommonMethod.getPriorityList(),CommonMethod.getSourceList()}static myCaseObj=void 0;static openCaseObj=void 0;static escalationObj=void 0;static unAssignedObj=void 0;static myReqObj=void 0;static allCaseObj=void 0;static watchlistObj=void 0;static unManagedObj=void 0;static casesInit(){CommonMethod._getPreRequiste();let e=Layout.page.hash.split("/")[2];switch(!0){case e.includes("opencases"):CommonMethod.openCaseObj=new OpenCasesList,openCaseObj.init();break;case e.includes("escalation"):CommonMethod.escalationObj=new EscalationList,escalationObj.init();break;case e.includes("unassigned"):CommonMethod.unAssignedObj=new UnassignedList,unAssignedObj.init();break;case e.includes("watchlist"):CommonMethod.watchlistObj=new WatchList,watchlistObj.init();break;case e.includes("myrequest"):CommonMethod.myReqObj=new MyRequestList,myReqObj.init();break;case e.includes("unmanaged"):CommonMethod.unManagedObj=new UnmanagedList,unManagedObj.init();break;case e.includes("allcases"):CommonMethod.allCaseObj=new AllCasesList,allCaseObj.init();break;default:CommonMethod.myCaseObj=new MyCasesList,myCaseObj.init()}}static getStatusColorClass(e){let t="blu";switch(e){case CasesCommon.OPEN_SID:t="blu";break;case CasesCommon.INPROGRESS_SID:t="grn";break;case CasesCommon.AWAITING_SID:t="ylw";break;case CasesCommon.ONHOLD_SID:t="ylw1";break;case CasesCommon.COMPLETED_SID:case CasesCommon.CANCELLED_SID:t="gry"}return t}static addSingleStatus(e,t,s){if(null!=t){let i=s.find('li[statusId="'+e+'"] #stsCnt');i.text(parseInt(i.text())+t)}}static minusSingleStatus(e,t,s){if(null!=t){let i=s.find('li[statusId="'+e+'"] #stsCnt');i.text(parseInt(i.text())-t)}}static updateStatus(e,t){for(let s in e)if(e.hasOwnProperty(s)){let i=t.find('li[statusId="'+s+'"] #stsCnt');i.text(parseInt(i.text())-e[s])}}}var CasesWMS={init:function(e){var t=e.caseJobj.isUnmanaged,s=e.caseJobj.isCategoryAdmin,i=e.requesterId==erecno,a=e.agentId==erecno,n=!1,l=e.hasOwnProperty("caseJobj")&&e.caseJobj.statusId!=HRCase.COMPLETED_SID&&e.caseJobj.statusId!=HRCase.CANCELLED_SID,o=!1;"2"==e.agentTypeId&&e.agentValueId==_LOGGEDIN_DEPID?n=!0:"3"!=e.agentTypeId&&"4"!=e.agentTypeId||$.each(ZPeople.loggedInGroups,(function(t,s){e.agentValueId==s&&(n=!0)}));var c=!1;null!=e.followerObj&&$.each(e.followerObj,(function(e,t){1==t.isFollowerId?$.each(t.isFollower,(function(e,t){t==erecno&&(c=!0)})):2==t.isFollowerId?$.each(t.isFollower,(function(e,t){t==_LOGGEDIN_DEPID&&(c=!0)})):3!=t.isFollowerId&&4!=t.isFollowerId||$.each(t.isFollower,(function(e,t){$.each(ZPeople.loggedInGroups,(function(e,s){s==t&&(c=!0)}))}))}));var d=[];i&&d.push(REQ_TYPE_MYREQUEST),(a||n)&&(d.push(REQ_TYPE_ALLCASES),ZPUtil.Validation.isEmpty(e.agentId)?d.push(REQ_TYPE_UNASSIGNCASES):a&&d.push(REQ_TYPE_MYCASES)),(a||n&&ZPUtil.Validation.isEmpty(e.agentId))&&l&&d.push(REQ_TYPE_OPENCASE),t&&s&&(d.push(REQ_TYPE_UNMANAGED),d.push(REQ_TYPE_ALLCASES)),c&&d.push(REQ_TYPE_FOLLOWS),d=$.unique(d),$.each(d,(function(t,s){var i=CasesWMS.getContainerId(s);$("#"+i).length>0?e.isNewRwAdded?CasesWMS.addCaseRow(s,e):CasesWMS.removeCase(s,e):o=!0})),o&&(ZPNewTabs.refreshThirdLevelTab("hrcase-agent"),ZPNewTabs.updateSubtabs("HRCase"))},removeCase:function(e,t){var s=t.hrcase,i=t.caseJobj.statusId,a=CasesWMS.getContainerId(e);CasesWMS.setCount(e,-1,i),$("#"+a).find("#caseListBdy").find("[caseid = "+s+"]").remove()},addCaseRow:function(e,t){var s=t.caseJobj.statusId,i=CasesWMS.getContainerId(e);CasesWMS.setCount(e,1,s);let a=new caseListRow(t.caseJobj,e);$("#"+i).find("#caseListBdy").length>0&&$("#"+i).find("#caseListBdy").prepend(a.constructRow())},getContainerId:function(e){switch(e){case REQ_TYPE_MYREQUEST:return"hrcase-myrequest-list";case REQ_TYPE_FOLLOWS:return"hrcase-watchlist-list";case REQ_TYPE_UNMANAGED:return"hrcase-agent-unmanaged-list";case REQ_TYPE_MYCASES:return"hrcase-agent-list";case REQ_TYPE_OPENCASE:return"hrcase-agent-opencases-list";case REQ_TYPE_UNASSIGNCASES:return"hrcase-agent-unassigned-list";case REQ_TYPE_ALLCASES:return"hrcase-agent-allcases-list"}},setCount:function(e,t,s){var i=CasesWMS.getContainerId(e);if(e==REQ_TYPE_UNMANAGED||e==REQ_TYPE_UNASSIGNCASES){var a=parseInt($("#"+i).find("#stsCnt").text());a+=t,$("#"+i).find("#stsCnt").html(a)}else{a=parseInt($("#"+i).find("li[statusid="+s+"]").find("#stsCnt").text());a+=t,$("#"+i).find("li[statusid="+s+"]").find("#stsCnt").html(a)}},addNewSubTab:function(e){}},CasesActivity={constructSingleCard:function(e,t){var s="",i="",a="",n="";if("NEW_CASE"==t.caseActionType||"AGENT_ASSIGNED"==t.caseActionType)s=ZPI18N.getString("zp.newcaseassigned"),n='<img alt="" src="'+t.requestor.employeePhoto+'"/>',i="<em>"+ZPI18N.getString("zp.caseassignedtoyou")+"</em>",a='<a popup="user" empid="'+t.requestor.zuid+'" >'+t.requestor.name+'</a><em class="zpl_dots sm"></em><em>'+t.requestedTime+"</em>";else if("COMMENT_ADDED"==t.caseActionType)s=ZPI18N.getString("zp.newcommentreceived"),i='<a popup="user" empid="'+t.commentedBy.zuid+'">'+t.commentedBy.empid+" - "+t.commentedBy.name+"</a><em>"+ZPI18N.getString("zp.personaddedcomment",new Array(""))+'</em><em class="zpl_dots sm"></em><em>'+t.commentAt+"</em>",a='<i class="PI_comment"></i> <em>'+ZPFeeds.Activity.getMentions(ZSEC.Encoder.encodeForHTML(t.comment),!1,void 0,void 0,!0)+"</em>",n='<img alt="" src="'+t.commentedBy.employeePhoto+'"/>';else if("STATUS_CHANGE"==t.caseActionType)s=ZPI18N.getString("zp.casestatuschanged"),n='<img alt="" src="'+t.requestor.employeePhoto+'"/>',i=t.isCommentAdded?"<em>"+ZPI18N.getString("zp.casestatuschangewithcommentdesc",new Array(t.oldStatusName,t.status,'<a popup="user" empid="'+t.commentedBy.zuid+'">'+t.commentedBy.empid+" - "+t.commentedBy.name+"</a>"))+"</em>":"<em>"+ZPI18N.getString("zp.casestatuschangeddesc",new Array(t.oldStatusName,t.status))+"</em>",a='<a popup="user" empid="'+t.requestor.zuid+'" >'+t.requestor.name+'</a><em class="zpl_dots sm"></em><em>'+t.requestedTime+"</em>";else if("ESCALATED"==t.caseActionType){if(s=ZPI18N.getString("zp.caseescalated"),n='<img alt="" src="'+t.requestor.employeePhoto+'"/>',t.hasOwnProperty("escalatedTo")){var l='<a popup="user" empid="'+t.escalatedTo.zuid+'">'+t.escalatedTo.empid+" - "+t.escalatedTo.name+"</a>";i=t.isHighPriority?"<em>"+ZPI18N.getString("zp.caseescalatedwithprioritydesc",new Array(l)):ZPI18N.getString("zp.caseescalatedtodesc",new Array(l))}else i=t.isHighPriority?"<em>"+ZPI18N.getString("zp.caseescalatedwithpriority")+"</em>":"<em>"+ZPI18N.getString("zp.caseescalateddesc")+"</em>";a='<a popup="user" empid="'+t.requestor.zuid+'" >'+t.requestor.name+'</a><em class="zpl_dots sm"></em><em>'+t.requestedTime+"</em>"}let o=$('<div><span class="icn '+ServiceIcons.getIconClass(t.categoryIcon)+'"></span><div name="caseDtls"><div class="zpl_msp-dts"><div class="zpl_msp-name"><span class="zpl_msp-title">'+s+"</span></div><div>"+i+"</div></div></div></div>");var c=`<div class="zpl_msplst"><div class="zpl_mspsubs"> <div class="zpl_msp-dts"><div> <div class="zpl_em"> <div class="zpl_emimg">${n}</div> <div class="zpl_emdts zpl_ellipsis"> <div> <em>${t.caseId} -</em> <b>${t.subject}</b> </div> <div>${a}</div> </div> </div> </div></div> <div class="zpl_compoffar w150"> <span> <em>${ZPI18N.getString("zp.category")}</em> </span> <div> <span><b>${t.categoryName} </b></span> </div> </div> <div class="zpl_msp-act"> <div class="zpl_hvr"><button caseid="${t.recordId}" class="zlabel zlabel--blue zlabel--medium zlabel--outline">${ZPI18N.getString("zp.view")}</button></div> </div></div></div>`;o.find("div[name=caseDtls]").append(c),e.addClass("zpl_msplst").addClass("zpl_mspgroup"),e.append(o),e.find("button[caseid]").off().on("click",(function(){$('[id="caseDtls"]').remove(),$("body").addClass("zpl_casesptch"),casesObj.caseViewObj=new CaseViewPage($(this).attr("caseid"),Layout.Page.container),casesObj.caseViewObj.init()}))}},SLACommon={TIMER_START:1,TIMER_PAUSE:2,TIMER_STOP:3,COLOR_RED:"red",COLOR_GRN:"green",COLOR_ORG:"orange",timer:null,setSLATimer:function(){var e=Layout.Page.container.find("#sla_time"),t=e.html();if(null==t||"00 : 00 : 00"===t||-1==t.indexOf(":"))clearInterval(SLACommon.timer);else{var s=t.split(" : "),i=3600*s[0]+60*s[1]+parseInt(s[2])-1;if(i>0){var a=Math.floor(i/3600);i%=3600;var n=Math.floor(i/60);i%=60,e.html(SLACommon.getTimeIn2Digit(a)+" : "+SLACommon.getTimeIn2Digit(n)+" : "+SLACommon.getTimeIn2Digit(i))}else e.prev().html(ZPI18N.getString("zp.escalated")),e.html("00 : 00 : 00"),clearInterval(SLACommon.timer),setTimeout((function(){casesObj.caseViewObj=new CaseViewPage(settingsUrlProps.urlParamsArr.caseid,Layout.Page.container),casesObj.caseViewObj.init()}),3e3)}},showSLABand:function(e){var t=Layout.Page.container;if(null!=e&&null!=e.currentStatus){var s,i,a=SLACommon.getSlaTimeAndColor(e,"band");s=a.text,i="zpl_cSlt "+a.color;var n=t.find("#slaBandHdr"),l=n.find("#sla_time");n.removeClass("gr rd"),n.addClass(i),"escalated"==a.status||"paused"==a.status?(l.prev().html(s),l.html("00 : 00 : 00")):(l.prev().html(ZPI18N.getString("zp.caseclosesin")),l.html(s)),clearInterval(SLACommon.timer),SLACommon.timer=setInterval(SLACommon.setSLATimer,1e3)}else t.find("#slaBandHdr").addClass("zpl_DNI")},getSlaTimeAndColor:function(e,t){var s="",i="",a="",n={};return null!=e&&null!=e.currentStatus&&(null==e.nextViolation?e.isViolated?(s=ZPI18N.getString("zp.escalated"),i="rd",a="escalated"):e.currentStatus==SLACommon.TIMER_PAUSE?(s=ZPI18N.getString("zp.paused"),i="ylw",a="paused"):"list"!=t&&(s=ZPI18N.getString("zp.ontime"),i="grn",a="ontime"):(s=e.nextViolation,i=e.isViolated?"rd":"gr",a="nextviolation")),n.color=i,n.text=s,n.status=a,n},getTimeIn2Digit:function(e){return e>9?e:e<0?"00":"0"+e}};