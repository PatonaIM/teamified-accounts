var ZP_Mailmerge={mmtempCompRid:"",formsList:null,employeeFormID:null,templateAddHR:!1,allemplookupDetails:null,isMailMergeConfig:!1,mmtempList:null,writerURL:null,previewfname:null,previewformId:null,previewrid:null,previewtid:null,publicMMtemplate:!1,fromAct:!1,EXTNS:["doc","docx","zdoc","pdf"],LIMIT:{NAME:100},tid:null,rid:null,fileName:null,formId:null,docNameList:null,document_name:null,currFormId:null,isOffboarding:!1,offboardingFormid:void 0,creditUpgradeURL:"",availablePoints:"",paymentAdminZuids:[],textLabelfield:{},fieldsFormId:null,templateIds:{},editMMHRTemplate:function(rid){return rid.indexOf("/")>0&&""!=ZP_Mailmerge.mmtempCompRid&&(rid=ZP_Mailmerge.mmtempCompRid),writerUrl+"/writer/open/"+rid},mode:"mailmerge",sectionFormMap:[],formList:[],formNameList:{},fileUploadList:void 0,uploadMode:"",addmm:"mmadd",impmm:"mmimp",templateCount:-1,init:function(){var serviceName=settingsUrlProps.niceUrlArr[2];let formId;ZP_Mailmerge.formList=[],ZPA_Common.getFormList("mailmerge",serviceName),Compensation.LetterTemplatesUtil.isCompLetterPage()?formId=Compensation.LetterTemplatesUtil.getFormId():0==ZP_Mailmerge.formList.length&&ZP_Mailmerge.loadFormList(serviceName),ZP_Mailmerge.constructSectionFormMapping(serviceName,formId,ZP_Mailmerge.appentTemplateList)},getAddBtnTxt:function(isModalHeader){var addTmplBtnTxt=isModalHeader?ZPI18N.getString("zp.mailmerge.templateadd"):ZPI18N.getString("zp.template.add");if(Compensation.LetterTemplatesUtil.isCompLetterPage()){const toOverride=Compensation.LetterTemplatesUtil.getAddBtnTxt();addTmplBtnTxt=toOverride||addTmplBtnTxt}return addTmplBtnTxt},getImportBtnTxt:function(isModalHeader){var importTmplBtnTxt=isModalHeader?ZPI18N.getString("zp.mailmerge.templateimp"):ZPI18N.getString("zp.importmm");if(Compensation.LetterTemplatesUtil.isCompLetterPage()){const toOverride=Compensation.LetterTemplatesUtil.getImportBtnTxt();importTmplBtnTxt=toOverride||importTmplBtnTxt}return importTmplBtnTxt},getEmptyPageTitle:function(){var emptyPageTitle=ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.MAILMERGE);if(Compensation.LetterTemplatesUtil.isCompLetterPage()){const toOverride=Compensation.LetterTemplatesUtil.getEmptyPageTitle();emptyPageTitle=toOverride||emptyPageTitle}return emptyPageTitle},getEmptyPageDesc:function(){var emptyPageDesc=ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.MAILMERGE);if(Compensation.LetterTemplatesUtil.isCompLetterPage()){const toOverride=Compensation.LetterTemplatesUtil.getEmptyPageDesc();emptyPageDesc=toOverride||emptyPageDesc}return emptyPageDesc},appentTemplateList:function(){var pageId=settingsPage.container,serviceName=settingsUrlProps.niceUrlArr[2],formLiId=ZP_Mailmerge.formsListId(ZP_Automation_Mode.MAILMERGE),html='<div class="zpl_btnmnu">';if(Compensation.LetterTemplatesUtil.isCompLetterPage()||(html+="<div>\n\t\t\t\t\t\t<div><span>"+ZPI18N.getString("zp.selectform")+`</span></div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<select class="zselectbox select-js" id="${formLiId}" data-show-search-field="true" >\n\t\t\t\t\t\t\t\t<option>${ZSEC.Encoder.encodeForHTML(ZPI18N.getString("zp.all"))}</option>\n\t\t\t\t\t    \t</select>\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`),html+='<div class="zpl_rgt">',html+='<div aria-label="Add Template" id="'+settingsUrlProps.currentMode+'_top_addbtn" class="zbutton--split zbutton--splitprimary"><button id="top_addbtn_test" aria-label="Add Template" tabindex="0" role="button"class="zbutton zbutton--medium zbutton--primary zbutton--action" type="button" onclick="ZP_Mailmerge.loadAddTemplateSlider();"><span class="zbutton__text">'+ZP_Mailmerge.getAddBtnTxt()+'</span></button><button id="'+settingsUrlProps.currentMode+'_logselectBtn" class="zbutton zbutton--menu zbutton--medium zbutton--primary" type="button"><i class="zbutton__icon zh-floatright"><svg class="zbutton__svg zbutton__menuarrow" focusable="false"><use xlink:href="#zc__svg--downarrow"></use></svg></i></button></button></div>',html+='</div></div>\n\t\t\t\t\t<div id="mmtemp_rgtcnt" class="zpl_rgtcnt">\n\t\t\t\t\t<div class="zpl_info">\n                       <div>\n                          <h6>'+ZPI18N.getString("zp.mmlimits")+"</h6>\n                          <p>"+ZPI18N.getString("zp.mmlimitbanner",["https://help.zoho.com/portal/en/kb/writer/writer-add-ons/general-faq/articles/writer-automation-credits-add-on#15_How_can_I_view_my_usage_reports","https://help.zoho.com/portal/en/kb/writer/writer-add-ons/general-faq/articles/writer-automation-credits-add-on#5_How_to_increase_the_credits_to_more_than_1000"])+'</p>\n                       </div>\n                   </div>\n                               \n\t\t\t\t\t\t\t\t\t<div class="zpl_tblres">\n\t\t\t\t\t\t\t\t\t\t<table id="mmtemp_zpl-tbl" class="zpl_tbl">\n\t\t\t\t\t\t\t\t\t\t\t<thead> \n\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t                \t\t\t\t\t\t<th>'+ZPI18N.getString("zp.templatename")+`</th>\n\t\t                \t\t\t\t\t\t${ZP_Mailmerge.skipFormSelectDropdown()?"":`<th>${ZPI18N.getString("zp.formname")}</th>`}\n\t\t                \t\t\t\t\t\t<th width="80">`+ZPI18N.getString("zp.actions")+'</th>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t\t\t\t<tbody id="mmtemplate_list">  \n          \t\t                        <div id="noMMTemp-crd" class="zpl_secn" class="DN" > ',html+=`${ZP_Mailmerge.constructTemplateListing(ZP_Mailmerge.sectionFormMap)}`,html+="</tbody></div></table></div></div>",pageId.html(html),0===ZP_Mailmerge.sectionFormMap.length){var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.MAILMERGE),ZP_Mailmerge.getEmptyPageTitle(),ZP_Mailmerge.getEmptyPageDesc(),pageId.find("#noMMTemp-crd"));emptyPageObj.setButton(ZP_Mailmerge.getAddBtnTxt(),ZP_Mailmerge.loadAddTemplateSlider),emptyPageObj.setButton2(ZP_Mailmerge.getImportBtnTxt(),ZP_Mailmerge.loadImportTemplateSlider),emptyPageObj.show(),settingsPage.container.find("table#mmtemp_zpl-tbl").hide(),settingsPage.container.find("#noMMTemp-crd").removeClass("DN"),settingsPage.container.find("#"+settingsUrlProps.currentMode+"_top_addbtn").addClass("DN"),Compensation.LetterTemplatesUtil.isCompLetterPage()&&settingsPage.container.find("div.zpl_btnmnu").addClass("DNI")}else settingsPage.container.find("#"+settingsUrlProps.currentMode+"_top_addbtn").removeClass("DN"),Compensation.LetterTemplatesUtil.isCompLetterPage()&&settingsPage.container.find("div.zpl_btnmnu").removeClass("DNI");ZP_Mailmerge.constructMoreOption(serviceName);var options={search:{criteria:"startswith",by:"name"},dropdownList:{contentType:"text",fitForElement:!0},options:ZP_Mailmerge.formList,dataMapping:{label:"name",value:"id"},showSearchField:!0,change:ZP_Mailmerge.changeForm};ZPeopleComponents.select("#"+ZP_Mailmerge.formsListId(ZP_Automation_Mode.MAILMERGE),options),MP.Popup.init()},constructMoreOption:function(serviceName){$("#"+settingsUrlProps.currentMode+"_opt_list").length>0&&$("#"+settingsUrlProps.currentMode+"_opt_list").remove();var html='<div id="'+settingsUrlProps.currentMode+'_opt_list" class="zpl_drpdwn zmenu" data-type="list" ';html+=' role="menu"><ul data-body="true" class="zmenu__body">',html+='<li id="impTemp_option" class="zmenu__item" data-action="ZP_Mailmerge.loadImportTemplateSlider">',html+='<span class="zmenu__text">'+ZP_Mailmerge.getImportBtnTxt()+"</span></li>",html+="</ul></div>";var container=Compensation.LetterTemplatesUtil.isCompLetterPage()?settingsPage.container:$(settingsPage.mainWrapId).find("#tab-"+serviceName+"-mmtemplatelist");container.append(html),ZPeopleComponents.menu("#"+settingsUrlProps.currentMode+"_opt_list",{forElement:"#"+settingsUrlProps.currentMode+"_logselectBtn"}),container.find("#"+settingsUrlProps.currentMode+"_logselectBtn").off().on("click",()=>{ZPeopleComponents.menu("#"+settingsUrlProps.currentMode+"_opt_list").show()})},formsListId:function(mode){var serviceName=ZPA_Common.getServiceName();if("mailmergeTemplate"==mode)return serviceName+"_mmTempLi_FormLi"},popupId:function(mode){ZP_Mailmerge.addmm,ZP_Mailmerge.impmm;var serviceName=ZPA_Common.getServiceName();return"mmadd"==mode?serviceName+"_addPopup":"mmimp"==mode?serviceName+"_impPopup":void 0},upload:function(mode){ZP_Mailmerge.impmm;var serviceName=ZPA_Common.getServiceName();if("mmimp"==mode)return serviceName+"_localUpload"},loadFormList:function(serviceName){var mode=ZP_Mailmerge.mode;ZPA_Common.getFormList(mode,serviceName);var formsList=ZPA_Common[mode+"_"+serviceName+"_formList"];void 0!==formsList&&$.each(formsList,function(key,value){ZP_Mailmerge.formList.push({id:value.formId,name:value.dispName}),ZP_Mailmerge.formNameList[value.formId]=value.dispName})},changeForm:function(){var pageId=settingsPage.container,selectedForm=[],formId=settingsPage.container.find("#"+ZP_Mailmerge.formsListId(ZP_Automation_Mode.MAILMERGE)).val(),serviceName=ZPA_Common.getServiceName();if("accountsetup"==serviceName&&ZP_Mailmerge.templateCount>200){ZP_Mailmerge.sectionFormMap=[];var params={action:"getMailMergeTemplates",startInd:"1",limit:"200"};void 0==formId||"All"==formId||ZP_Mailmerge.isEmpty(formId)||"0"==formId||(params.formId=formId),"accountsetup"==serviceName&&(params.isFromAccsetup=!0),ZPeople.Request.sendAsyncPost("/zpmailmerge/getMailMergeTemplates",params,function(response){void 0!==response[1].templateDetails&&($.each(response[1].templateDetails,function(key,value){ZP_Mailmerge.sectionFormMap.push(value)}),void 0!=formId&&"All"!=formId&&!ZP_Mailmerge.isEmpty(formId)&&"0"!=formId||-1===response[1].mmtemplatesCount||(ZP_Mailmerge.templateCount=response[1].mmtemplatesCount))}),ZP_Mailmerge.currFormId=void 0==formId||"All"!==formId||ZP_Mailmerge.isEmpty(formId)||"0"==formId?formId:0,pageId.find("#emptpage").remove(),pageId.find("tbody#mmtemplate_list").html(ZP_Mailmerge.constructTemplateListing(ZP_Mailmerge.sectionFormMap))}else"All"===formId?(pageId.find("tbody#mmtemplate_list").html(ZP_Mailmerge.constructTemplateListing(ZP_Mailmerge.sectionFormMap)),ZP_Mailmerge.currFormId=0):(selectedForm=ZP_Mailmerge.sectionFormMap.filter(ele=>ele.formId===formId),ZP_Mailmerge.currFormId=formId,pageId.find("#emptpage").remove(),pageId.find("tbody#mmtemplate_list").html(ZP_Mailmerge.constructTemplateListing(selectedForm)))},setCurrFormId:function(formId){ZP_Mailmerge.currFormId=formId},constructSectionFormMapping:function(serviceName,formId,successCallback){ZP_Mailmerge.sectionFormMap=[];settingsPage.container;var param={action:"getMailMergeTemplateListByService",service:serviceName,startInd:1,limit:200,conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE?(param.service=serviceName,Compensation.LetterTemplatesUtil.isCompLetterPage()&&(formId=Compensation.LetterTemplatesUtil.getFormId()),formId&&(param.formId=formId),$.ajax({url:"/zpmailmerge/getMailMergeTemplateListByService",type:"POST",data:param,success:function(resultData){void 0!==resultData.templates&&$.each(resultData.templates,function(key,value){ZP_Mailmerge.sectionFormMap.push(value)}),void 0!=successCallback&&successCallback()},failure:function(data){ZP_Mailmerge.failedCallBack(data)}})):ZP_Mailmerge.constructMMTempList("accountsetup",null,"1",null,null,null,successCallback)},mmTempopupModal:function(id,header,content,callback){var popupTab=new Tab(id,content,callback);popupTab.id=id,popupTab.cardId="poupCard_mailmerge",mmpopupModal=new popupModal(header,popupTab),void 0===ZP5Form.getFormClassObj()&&settingsUrlProps.url.indexOf("listview")>=0?mmpopupModal.save=ZPI18N.getString("zp.merge"):mmpopupModal.save=ZPI18N.getString("zp.save"),mmpopupModal.cancel=ZPI18N.getString("zp.cancel"),mmpopupModal.setCloseCallback(function(){ZP_Mailmerge.closePopup(),ZP_Mailmerge.resetDocumentName(!1),ZPeopleComponents.isComponent("#mmdocumentNameList")&&ZPeopleComponents.dropdownlist("#mmdocumentNameList").destroy(),$("#mmdocumentNameList").remove()}),mmpopupModal.construct(),$("#"+popupTab.cardId).append(content)},constructTemplateListing:function(selectedForm){var html="",pageId=settingsPage.container,serviceName=settingsUrlProps.niceUrlArr[2];if(void 0!==selectedForm)if(0!=selectedForm.length){for(var i=0;i<selectedForm.length;i++)html+=`<tr template_id ="${selectedForm[i].tid}" formId="${selectedForm[i].formId}" rid="${selectedForm[i].rid}")>\n\t            \t\t\t\t\t\t<td onclick="ZP_Mailmerge.TemplatePreview(this,'${selectedForm[i].rid}', '${ZSEC.Encoder.encodeForJavaScript(selectedForm[i].fname)}', '${selectedForm[i].tid}', '${selectedForm[i].url}', '${selectedForm[i].formId}', '${ZSEC.Encoder.encodeForJavaScript(selectedForm[i].document_name)}')">\n\t              \t\t\t\t\t\t\t<span>${ZSEC.Encoder.encodeForHTML(selectedForm[i].fname)}</span>\n\t            \t\t\t\t\t\t</td>`,ZP_Mailmerge.skipFormSelectDropdown()||(html+="<td>",html+="accountsetup"==serviceName?`<span>${ZSEC.Encoder.encodeForHTML(ZP_Mailmerge.formNameList[selectedForm[i].formId])}</span>`:`<span>${selectedForm[i].formName}</span>`,html+="</td>"),html+=`<td id="edit_delete" width="10%">\n          \t\t\t\t\t\t\t<div class="zpl_hvr">\n            \t\t\t\t\t\t\t<i class="PI_delete" onclick="ZP_Mailmerge.deleteFile('${selectedForm[i].tid}','${selectedForm[i].formId}')"></i>\n          \t\t\t\t\t\t\t</div>\n          \t\t\t\t\t\t\t<div class="zpl_hvr">\n            \t\t\t\t\t\t\t<i class="PI_edt" id="edit_tempName" onclick="ZP_Mailmerge.editFileName('${selectedForm[i].tid}','${selectedForm[i].rid}', '${ZSEC.Encoder.encodeForJavaScript(selectedForm[i].fname)}','${selectedForm[i].formId}','${ZSEC.Encoder.encodeForJavaScript(selectedForm[i].document_name)}' )"></i>\n          \t\t\t\t\t\t\t</div>\n        \t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>`;settingsPage.container.find("table#mmtemp_zpl-tbl").show(),settingsPage.container.find("#noMMTemp-crd").addClass("DN"),settingsPage.container.find("#"+settingsUrlProps.currentMode+"_top_addbtn").removeClass("DN")}else if(0===selectedForm.length){var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.MAILMERGE),ZP_Mailmerge.getEmptyPageTitle(),ZP_Mailmerge.getEmptyPageDesc(),pageId.find("#noMMTemp-crd"));emptyPageObj.setButton(ZP_Mailmerge.getAddBtnTxt(),ZP_Mailmerge.loadAddTemplateSlider),emptyPageObj.setButton2(ZP_Mailmerge.getImportBtnTxt(),ZP_Mailmerge.loadImportTemplateSlider),emptyPageObj.show(),settingsPage.container.find("#mmtemp_zpl-tbl").hide(),settingsPage.container.find("#noMMTemp-crd").removeClass("DN"),settingsPage.container.find("#"+settingsUrlProps.currentMode+"_top_addbtn").addClass("DN")}else settingsPage.container.find("#"+settingsUrlProps.currentMode+"_top_addbtn").removeClass("DN");return html},deleteFile:function(templateId,formId){settingsPage.container.find(".mmlimits_info-crd").addClass("DN");let parameter={templateId:templateId,formId:formId};MP.Popup.show({type:MP.Popup.Type.DELETE,heading:ZPI18N.getString("zp.local.deletetemplate"),message:ZPI18N.getString("zp.deletemsg"),buttonMessage:ZPI18N.getString("zp.confirm"),callback:ZP_Mailmerge.deleteFileCallBack,callbackParamter:parameter})},deleteFileCallBack:function(parameter){var param={action:"deleteMergeMailTemplate",templateId:parameter.templateId,formId:parameter.formId,conreqcsr:csrfToken},serviceName=settingsUrlProps.niceUrlArr[2];ZPeople.Request.send("/zpmailmerge/deleteMergeMailTemplate",param,(data,params)=>{if("success"===data[1].result){var pageId=settingsPage.container;if(pageId.find("tbody#mmtemplate_list tr[template_id = '"+params.templateId+"']").remove(),0==settingsPage.container.find("tbody#mmtemplate_list tr").length){var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.MAILMERGE),ZP_Mailmerge.getEmptyPageTitle(),ZP_Mailmerge.getEmptyPageDesc(),pageId.find("#noMMTemp-crd"));emptyPageObj.setButton(ZP_Mailmerge.getAddBtnTxt(),ZP_Mailmerge.loadAddTemplateSlider),emptyPageObj.setButton2(ZP_Mailmerge.getImportBtnTxt(),ZP_Mailmerge.loadImportTemplateSlider),emptyPageObj.show(),settingsPage.container.find("table#mmtemp_zpl-tbl").hide(),settingsPage.container.find("#noMMTemp-crd").removeClass("DN"),settingsPage.container.find("#"+settingsUrlProps.currentMode+"_top_addbtn").addClass("DN")}else settingsPage.container.find("#"+settingsUrlProps.currentMode+"_top_addbtn").removeClass("DN");ZPeople.Message.success(ZPI18N.getString("zp.templatedeletedsuccessfully"))}else data[1].result[0].hasOwnProperty("errorMsg")?ZPeople.Message.failure(data[1].result[0].errorMsg):(ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.MAILMERGE,data[1].result),settingsPage.container.find("#"+settingsUrlProps.currentMode+"_top_addbtn").removeClass("DN"));ZP_Mailmerge.constructSectionFormMapping(serviceName)})},populateAttachName:function(){var attachName=ZP_Mailmerge.attachName,pageId=settingsPage.container,sliderbdy=$("body #modal_Container");void 0!=Zsign.currentformId&&Zsign.currentformId==ZP_Mailmerge.formId||(null!=ZP_Mailmerge.formId?Zsign.getFormCompFields(ZP_Mailmerge.formId,"workflow"):Zsign.getFormCompFields(ZP_Mailmerge.previewformId,"workflow")),$.each(ZP_Mailmerge.textLabelfield.formId,function(fcId,value){attachName.indexOf(fcId)>-1&&(attachName=attachName.replaceAll(fcId,"${"+value+"}"))}),pageId.find("#mmdocument_name").length>0?pageId.find("#mmdocument_name").val(attachName):sliderbdy.find("#mmdocument_name").val(attachName)},skipFormSelectDropdown:function(){return ZP_Mailmerge.isOffboarding||Compensation.LetterTemplatesUtil.isCompLetterPage()},skipDocumentNameInput:function(){return ZP_Mailmerge.isOffboarding||Compensation.LetterTemplatesUtil.isCompLetterPage()},editFileName:function(tid,rid,fileName,formId,attachName){settingsPage.container.find("#editTemp").remove(),ZP_Mailmerge.tid=tid,ZP_Mailmerge.rid=rid,ZP_Mailmerge.formId=formId,ZP_Mailmerge.fileName=fileName,""!=attachName&&"null"!=attachName&&void 0!=attachName&&"undefined"!=attachName||(attachName=fileName),ZP_Mailmerge.attachName=attachName;var content='\n\t\t\t\t\t\t<div class="zpl_crd">\n\t\t\t\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t\t\t\t<div class="zpl_secn" id="mmfile_namediv">\n\t\t\t\t\t\t\t\t\t<div>\n            \t\t\t\t\t\t\t<label class="">'+ZPI18N.getString("zp.templatename")+`</label>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n            \t\t\t\t\t\t\t<input id="edit_fileName" value="${ZSEC.Encoder.encodeForHTMLAttribute(fileName)}" type="text" class="ztextbox">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zpl_secn`+(ZP_Mailmerge.skipDocumentNameInput()?" zpl_DNI":"")+'" id="mmdocument_namediv">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label class="zpl_mtry">'+ZPI18N.getString("zp.zs.documentname")+'</label>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t<div class="ztextbox--group zh-alignright zpl_inpticfild">\n                               <i class="ztextbox__icon PI_addlist" style="width:50px; justify-content:center;" id="mm_pop" onclick="ZP_Mailmerge.initiateTabPanel(\'mm_tabpanel\', \'mm_pop\')"></i>\n                                  <input type="text" id="mmdocument_name" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade()">\n                                     <div id="mm_tabpanel"></div>\n                                       </div>\n                                    </div>\n                               </div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>';ZP_Mailmerge.mmTempopupModal("centerPopup",ZPI18N.getString("zp.edittemp"),content,ZP_Mailmerge.editFileNameCallBack),ZP_Mailmerge.setMergedName(formId),ZP_Mailmerge.populateAttachName()},valReturndocNameIds:function(){var attachName,returnObj=[],pageId=settingsPage.container,sliderbdy=$("body #modal_Container");return ZP_Mailmerge.skipDocumentNameInput()?(returnObj.attachName=settingsPage.container.find("#fileName").length?settingsPage.container.find("#fileName").val().trim():settingsPage.container.find("#edit_fileName").length?settingsPage.container.find("#edit_fileName").val():settingsPage.container.find("#clone_fileName").val(),returnObj):(attachName=pageId.find("#mmdocument_name").length>0?pageId.find("#mmdocument_name").val().trim():sliderbdy.find("#mmdocument_name").val().trim(),ZP_Mailmerge.isEmpty(attachName)||($.each(ZP_Mailmerge.textLabelfield.formId,function(fcId,fieldName){attachName=attachName.replaceAll(fcId,"${"+fieldName+"}")}),$.each(Zsign.textfield.formId,function(fcId,fieldName){attachName=attachName.replaceAll(fcId,"${"+fieldName+"}")})),returnObj.attachName=attachName,returnObj)},editFileNameCallBack:function(){var fileName=settingsPage.container.find("#edit_fileName").val(),serviceName=settingsUrlProps.niceUrlArr[2],err=!1;if(!ZP_Mailmerge.validation(fileName)){var attachName=ZP_Mailmerge.valReturndocNameIds().attachName;if(ZP_Mailmerge.validateAttach(attachName,"#mmdocument_namediv","#mmdocument_name","zp.zs.documentname")&&(err=!0),!err){var param={action:"editTemplate",fn:fileName,templateId:ZP_Mailmerge.tid,conreqcsr:csrfToken,formId:ZP_Mailmerge.formId};ZP_Mailmerge.isEmpty(attachName)||(param.document_name=attachName),ZPeople.Request.send("/zpmailmerge/editTemplate",param,data=>{if(data[1]){ZP_Mailmerge.closePopup(),ZP_Mailmerge.attachName=attachName,ZP_Mailmerge.fileName=fileName;var pageId=settingsPage.container,url=ZP_Mailmerge.editMMHRTemplate(ZP_Mailmerge.rid);pageId.find("tbody#mmtemplate_list tr[template_id = '"+ZP_Mailmerge.tid+"']").find("td:first-child").find("span").text(fileName),pageId.find("tbody#mmtemplate_list tr[template_id = '"+ZP_Mailmerge.tid+"']").find("td:first-child").attr("onclick","ZP_Mailmerge.TemplatePreview(this,'"+ZP_Mailmerge.rid+"', '"+ZSEC.Encoder.encodeForJavaScript(ZP_Mailmerge.fileName)+"', '"+ZP_Mailmerge.tid+"', '"+url+"', '"+ZP_Mailmerge.formId+"', '"+ZSEC.Encoder.encodeForJavaScript(ZP_Mailmerge.attachName)+"')"),pageId.find("tbody#mmtemplate_list tr[template_id = '"+ZP_Mailmerge.tid+"']").find("td#edit_delete").find("#edit_tempName").attr("onclick","ZP_Mailmerge.editFileName('"+ZP_Mailmerge.tid+"','"+ZP_Mailmerge.rid+"','"+ZSEC.Encoder.encodeForJavaScript(fileName)+"','"+ZP_Mailmerge.formId+"', '"+ZSEC.Encoder.encodeForJavaScript(attachName)+"')"),ZPeople.Message.success(ZPI18N.getString("zp.edittempname"))}else ZPeople.Message.warning(ZPI18N.getString("zp.mmtempcannotedit"));ZP_Mailmerge.tid=null,ZP_Mailmerge.rid=null,ZP_Mailmerge.fileName=null,ZP_Mailmerge.formId=null,ZP_Mailmerge.attachName=null,ZP_Mailmerge.constructSectionFormMapping(serviceName)})}}},resetMMSetValues:function(){ZP_Mailmerge.tid=null,ZP_Mailmerge.rid=null,ZP_Mailmerge.fileName=null,ZP_Mailmerge.formId=null,ZP_Mailmerge.attachName=null},loadAddTemplateSlider:function(){ZP_Mailmerge.formList=[];var serviceName=settingsUrlProps.niceUrlArr[2];0==ZP_Mailmerge.formList.length&&(ZP_Mailmerge.isOffboarding?ZP_Mailmerge.formList.push({id:ZP_Mailmerge.offboardingFormid,name:""}):Compensation.LetterTemplatesUtil.isCompLetterPage()?ZP_Mailmerge.formList.push({id:Compensation.LetterTemplatesUtil.getFormId(),name:""}):ZP_Mailmerge.loadFormList(serviceName));var formId=ZP_Mailmerge.getDefaultFormId(ZP_Mailmerge.formList),content='\t<div class="zpl_crd">\n\t\t\t\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t\t\t<div class="zpl_secn'+(ZP_Mailmerge.skipFormSelectDropdown()?" zpl_DNI":"")+'">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label class="zpl_mtry" >'+ZPI18N.getString("zp.formname")+"</label>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>";content+='<select id="SelTempId" >',content+='</select> \n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zpl_secn" id="mmfile_namediv">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label class="zpl_mtry" >'+ZPI18N.getString("zp.templatename")+'</label>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<input type="text" value="" id="fileName" class="ztextbox"/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zpl_secn'+(ZP_Mailmerge.skipDocumentNameInput()?" zpl_DNI":"")+'" id="mmdocument_namediv">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label class="zpl_mtry">'+ZPI18N.getString("zp.zs.documentname")+'</label> \n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ztextbox--group zh-alignright zpl_inpticfild">\n                               <i class="ztextbox__icon PI_addlist" style="width:50px; justify-content:center;" id="mm_pop" onclick="ZP_Mailmerge.initiateTabPanel(\'mm_tabpanel\', \'mm_pop\')"></i>\n                                  <input type="text" id="mmdocument_name" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade()">\n                                     <div id="mm_tabpanel"></div>\n                                       </div>\n                                    </div>\n                            \t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>',ZP_Mailmerge.mmTempopupModal("centerPopup",ZP_Mailmerge.getAddBtnTxt(!0),content,ZP_Mailmerge.addMailMerge),ZP_Mailmerge.setMergedName(ZP_Mailmerge.getFormIdFromPage()),ZPeopleComponents.select("#SelTempId").setAttribute("selectedValue",formId)},getFormIdFromPage:function(){var formId;return void 0!=ZP5Form.getFormClassObj()&&void 0!=ZP5Form.getFormClassObj().getParams().formId?formId=ZP5Form.getFormClassObj().getParams().formId:void 0!=ZP5Form.getCurrFormsOperation()&&void 0!=ZP5Form.getCurrFormsOperation().formId&&settingsUrlProps.niceUrl.lastIndexOf("/listview")>-1&&(formId=ZP5Form.getCurrFormsOperation().formId),void 0==formId&&(formId=settingsPage.container.find("#"+ZP_Mailmerge.formsListId(ZP_Automation_Mode.MAILMERGE)).val()),!formId&&ZP_Mailmerge.currFormId&&(formId=ZP_Mailmerge.currFormId),formId},setMergedName:function(formId){var options={dropdownList:{contentType:"text",fitForElement:!0},showSearchField:!0,options:ZP_Mailmerge.formList,dataMapping:{label:"name",value:"id"},selectedValue:formId,change:ZP_Mailmerge.resetDocumentName};ZPeopleComponents.select("#SelTempId",options),ZP_Mailmerge.setDocumentName(formId)},resetDocumentName:function(populateValues){var formId=settingsPage.container.find("#SelTempId").val(),pageId=settingsPage.container,sliderbdy=$("body #modal_Container");pageId.find("#mmdocument_name").length>0?pageId.find("#mmdocument_name").val(""):sliderbdy.find("#mmdocument_name").val(""),ZP_Mailmerge.setDocumentName(formId,populateValues)},setDocumentName:function(formId,populateValues){ZPeopleComponents.isComponent("#mmdocumentNameList")&&ZPeopleComponents.dropdownlist("#mmdocumentNameList").destroy(),void 0==formId&&(formId=settingsPage.container.find("#SelTempId").val());var singleLineFieldforPop=ZP_Mailmerge.textLabelfield.formId;"All"==formId||void 0==formId||void 0!=Zsign.currentformId&&Zsign.currentformId==formId?singleLineFieldforPop=Zsign.currentformId==formId?ZP_Mailmerge.textLabelfield.formId:void 0:(Zsign.getFormCompFields(formId,"workflow"),singleLineFieldforPop=ZP_Mailmerge.textLabelfield.formId),void 0!=populateValues&&!1===populateValues||void 0==formId||"All"==formId||ZP_Mailmerge.getTabPanelData(formId);var messtknObj={sort:!0,viewPerPage:4,lazyLoading:!0,filterByCSSSelector:!1,items:ZPA_Esign.constructFormFieldsJSON(singleLineFieldforPop,!0),dataMapping:{text:"label",name:"label",value:"value",groupLabel:"viewtype",id:"value"},contentType:"text",sortOrder:"asc",hideCheckbox:!0,showSearchField:!0,position:"left",search:{by:"label",criteria:"contains",highlightKeyword:!0},searchFieldOptions:{placeholder:"Search",clearButton:!1},title:"Fields ",focusItemOnItemMouseover:!0,itemclick:ZP_Mailmerge.addDocNamefield,bodyItemVisibleCount:3,dropdownList:{appendTo:$("#mmdocumentNameListDP"),fitForElement:!0,moveOnScroll:!0}};ZPeopleComponents.dropdownlist("#mmdocumentNameList",messtknObj)},addDocNamefield:function(event){var selectedValue=event.detail.itemData.label;selectedValue="${"+selectedValue+"}";var existingVal=$("#mmdocument_name").val();existingVal+=selectedValue,$("#mmdocument_name").val(existingVal)},loadImportTemplateSlider:function(mode){ZP_Mailmerge.resetUploadParam();var imppopup=ZP_Mailmerge.impmm,serviceName=settingsUrlProps.niceUrlArr[2];ZP_Mailmerge.formList=[];var impUploadId=ZP_Mailmerge.upload(imppopup);0==ZP_Mailmerge.formList.length&&(Compensation.LetterTemplatesUtil.isCompLetterPage()?ZP_Mailmerge.formList.push({id:Compensation.LetterTemplatesUtil.getFormId(),name:""}):ZP_Mailmerge.loadFormList(serviceName)),0!=$("#errormsg_fid_imp").length&&(settingsPage.container.find("#SelTempId-container").removeClass("ztextbox__error"),settingsPage.container.find("span#errormsg_fid_imp").remove(),settingsPage.container.find("#drop_area").removeClass("ztextbox__error"),settingsPage.container.find("span#errormsg_upload_imp").remove(),settingsPage.container.find("span#errormsg_upload_impEXT").remove()),CloudPicker.init("centerPopup",ZP_Mailmerge.attachmentConstructor,"mailmerge");var formId=ZP_Mailmerge.getDefaultFormId(ZP_Mailmerge.formList);void 0!==formId&&(settingsPage.container.find("#attachments").html("</div>"),settingsPage.container.find("#uploadSection").show(),settingsPage.container.find("span#errormsg_fid_imp").remove());var content=`\t<div class="zpl_crd">\n\t\t\t\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t\t\t<div class="zpl_secn ${ZP_Mailmerge.skipFormSelectDropdown()?"DNI":""}">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label class="zpl_mtry" >`+ZPI18N.getString("zp.formname")+"</label>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>";content+=' <select id="SelTempId">',content+='\n\t\t\t\t\t\t\t\t\t\t</select>  \n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zpl_secn" id="uploadSection">\n\t\t\t\t\t\t\t\t\t<div>\n                      \t\t\t\t\t<label class="zpl_mtry" >'+ZPI18N.getString("zp.fileupload")+'</label>\n                  \t\t\t\t\t</div>\n                \t\t\t\t\t<div>\n                  \t\t\t\t\t\t<div class="zpl_upld">\n                          \t\t\t\t\t<div id="drop_area" ondrop="event.stopPropagation(); event.preventDefault(); ZP_Mailmerge.dropHandler(event)" ondragover="event.preventDefault();" class="zpl_fldrp">\n                              \t\t\t\t\t<h5><div class="zpl_flupld_img"></div> \n                              \t\t\t\t\t<input id="uploadFile" type="file" data-text="Desktop" style="display:none;" accept=".doc, .docx, .zdoc, .pdf">',content+='   \t\t\t<a id="'+impUploadId+'"class="zpl_lnk" onclick="ZP_Mailmerge.openFileUpload()"><i class="PI_case"></i>'+ZPI18N.getString("zp.files.desktop")+'</a> / <a class="zpl_lnk" onclick="ZP_Mailmerge.openCloudPicker()"><i class="PI_cloud"></i>'+ZPI18N.getString("zp.files.cloud")+"</a>",content+=" \t\t\t</div>\n                          \t\t\t\t\t<p><span>"+ZPI18N.getString("zp.filessuported")+": Pdf , Doc , Docx , ZDoc </span>\n                              \t\t\t\t\t<span>"+ZPI18N.getString("zp.impmaxsize")+': 5MB</span>\n                          \t\t\t\t\t</p>\n                      \t\t\t\t\t</div>\n                  \t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>           \n\t\t\t\t\t\t\t\t<div id="attachments" class="zpl_secn">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zpl_secn" id="mmfile_namediv">\n\t\t\t\t\t\t\t\t\t<div>\n            \t\t\t\t\t\t\t<label class="">'+ZPI18N.getString("zp.templatename")+`</label>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n            \t\t\t\t\t\t\t<input id="edit_fileName" value="" type="text" class="ztextbox">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zpl_secn ${ZP_Mailmerge.skipDocumentNameInput()?"DNI":""}" id="mmdocument_namediv">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label class="zpl_mtry">`+ZPI18N.getString("zp.zs.documentname")+'</label>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>  \n\t\t\t\t\t\t\t\t\t   <div class="ztextbox--group zh-alignright zpl_inpticfild">\n\t\t\t\t\t\t\t\t\t       <i class="ztextbox__icon PI_addlist" style="width:50px; justify-content:center;" id="mm_pop" onclick="ZP_Mailmerge.initiateTabPanel(\'mm_tabpanel\', \'mm_pop\')"></i>\n\t\t\t\t\t\t\t\t\t       <input type="text" id="mmdocument_name" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade()">\n\t\t\t\t\t\t\t\t\t       <div id="mm_tabpanel"></div>\n\t\t\t\t\t\t\t\t\t   </div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>',ZP_Mailmerge.mmTempopupModal("centerPopup",ZP_Mailmerge.getImportBtnTxt(!0),content,ZP_Mailmerge.importMailMerge);var options={dropdownList:{contentType:"text",fitForElement:!0},showSearchField:!0,options:ZP_Mailmerge.formList,dataMapping:{label:"name",value:"id"},selectedValue:formId,change:ZP_Mailmerge.resetDocumentName};ZPeopleComponents.select("#SelTempId",options),ZP_Mailmerge.getTabPanelData(formId),ZP_Mailmerge.setMergedName(formId),document.getElementById("uploadFile").addEventListener("change",function(){ZP_Mailmerge.fileUploadList=this.files[0],ZP_Mailmerge.uploadMode="localUpload",ZP_Mailmerge.attachmentConstructor(ZP_Mailmerge.fileUploadList)},!1)},openFileUpload:function(){ZP_Mailmerge.uploadMode="localUpload",$("#uploadFile").trigger("click")},openCloudPicker:function(){ZP_Mailmerge.uploadMode="cloudUpload",CloudPicker.construct()},importMailMerge:function(){var serviceName=settingsUrlProps.niceUrlArr[2],pageId=(ZP_Mailmerge.impmm,settingsPage.container),importFile=ZP_Mailmerge.fileUploadList,maxSize=1e6*maxFileSize.split("MB")[0],err=!1,formId=settingsPage.container.find("#SelTempId").val(),SelectedformId=settingsPage.container.find("#"+ZP_Mailmerge.formsListId(ZP_Automation_Mode.MAILMERGE)).val(),templateName=settingsPage.container.find("#edit_fileName").val(),attachName=ZP_Mailmerge.valReturndocNameIds().attachName;if(ZP_Mailmerge.validateAttach(attachName,"#mmdocument_namediv","#mmdocument_name","zp.zs.documentname")&&(err=!0),ZP_Mailmerge.validateAttach(templateName,"#mmfile_namediv","#edit_fileName","zp.templatename")&&(err=!0),"localUpload"===ZP_Mailmerge.uploadMode)importFile=ZP_Mailmerge.fileUploadList;else"cloudUpload"===ZP_Mailmerge.uploadMode&&(importFile=CloudPicker.fileObj);if("Select"===formId?(err=!0,0===$("#errormsg_fid_imp").length&&(settingsPage.container.find("#SelTempId-container").addClass("ztextbox__error"),settingsPage.container.find("#SelTempId-container").after('<span id="errormsg_fid_imp" class="ztextbox--error__label">'+ZPI18N.getString("zp.formnamenotemptyerror")+"</span>"))):(settingsPage.container.find("#SelTempId-container").removeClass("ztextbox__error"),settingsPage.container.find("span#errormsg_fid_imp").remove()),void 0==importFile||""==importFile){if(err=!0,0===$("#errormsg_upload_imp").length)return settingsPage.container.find("#drop_area").addClass("ztextbox__error"),settingsPage.container.find("#drop_area").after('<span id="errormsg_upload_imp" class="ztextbox--error__label">'+ZPI18N.getString("zp.choosedoc")+"</span>")}else settingsPage.container.find("#drop_area").removeClass("ztextbox__error"),settingsPage.container.find("span#errormsg_upload_imp").remove();if(!err){var form=ZP_Mailmerge.formList.find(e=>formId===e.id),formData=new FormData;if(importFile){if(importFile&&(importFile.size>maxSize?(err=!0,ZPeople.Message.failure(ZPI18N.getString("zp.feedfilesizewarning"))):pageId.find("#uploadfile").closest("div#err_div").next("span#errormsg").remove()),!err){var fileExtn=pageId.find("div#attachments").find("h4#att_fileName").text();fileExtn=fileExtn.substr(fileExtn.lastIndexOf(".")+1,fileExtn.length).toLowerCase(),-1===ZP_Mailmerge.EXTNS.indexOf(fileExtn)?(err=!0,0===$("#errormsg_upload_impEXT").length&&settingsPage.container.find("#attachments").after('<span id="errormsg_upload_impEXT" class="ztextbox--error__label">'+ZPI18N.getString("zp.choosedocsfile")+"</span>")):settingsPage.container.find("span#errormsg_upload_impEXT").remove()}}else err=!0,ZPeople.Message.failure(ZPI18N.getString("zp.erroraddtemplate"));err||(settingsPage.container.find("#centerPopup").find("#sliderSbt").addClass("disabled"),"cloudUpload"!==ZP_Mailmerge.uploadMode&&formData.append("mmfile",importFile),ZP_Mailmerge.isEmpty(ZP_Mailmerge.uploadMode),formData.append("uploadMode",ZP_Mailmerge.uploadMode),void 0===ZP_Mailmerge.fileUploadList&&formData.append("cloudUploadDoc",CloudPicker.fileObj),ZP_Mailmerge.isEmpty(templateName)||formData.append("fn",templateName),ZP_Mailmerge.isEmpty(attachName)||formData.append("document_name",attachName),formData.append("action","importMailMerge"),formData.append("conreqcsr",csrfToken),formData.append("formId",formId),settingsPage.container.find("#emptpage").remove(),ZPeople.Message.warning(ZPI18N.getString("zp.templatecreating")),$.ajax({url:"/zpmailmerge/importMailMerge",type:"POST",data:formData,contentType:!1,processData:!1,success:function(data){var dataObj=data[1],resId=data[1].url.split("open/")[1];ZP_Mailmerge.writerURL=data[1].url.split("open/")[0];var html=`<tr template_id ="${dataObj.tid}" formId="${dataObj.formid}" rid="${resId}")>\n\t\t\t\t\t\t<td onclick="ZP_Mailmerge.TemplatePreview(this,'${resId}', '${ZSEC.Encoder.encodeForJavaScript(templateName)}', '${dataObj.tid}', '${dataObj.url}', '${form.id}', '${ZSEC.Encoder.encodeForJavaScript(attachName)}')">\n  \t\t\t\t\t\t\t<span>${ZSEC.Encoder.encodeForHTML(templateName)}</span>\n\t\t\t\t\t\t</td>`;ZP_Mailmerge.skipFormSelectDropdown()||(html+=`<td>\n\t  \t\t\t\t\t\t\t<span>${ZSEC.Encoder.encodeForHTML(form.name)}</span>\n\t\t\t\t\t\t\t</td>`),html+=`<td id="edit_delete" width="10%">\n  \t\t\t\t\t\t\t<div class="zpl_hvr">\n    \t\t\t\t\t\t\t<i class="PI_delete" onclick="ZP_Mailmerge.deleteFile('${dataObj.tid}','${dataObj.formid}')"></i>\n  \t\t\t\t\t\t\t</div>\n  \t\t\t\t\t\t\t<div class="zpl_hvr">\n    \t\t\t\t\t\t\t<i class="PI_edt" id="edit_tempName" onclick="ZP_Mailmerge.editFileName('${dataObj.tid}','${resId}','${ZSEC.Encoder.encodeForJavaScript(templateName)}','${formId}','${ZSEC.Encoder.encodeForJavaScript(attachName)}')"></i>\n  \t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>`,("All"===SelectedformId||SelectedformId===formId||ZP_Mailmerge.skipFormSelectDropdown())&&(settingsPage.container.find("#emptPage").remove(),settingsPage.container.find("table#mmtemp_zpl-tbl").show(),settingsPage.container.find("tbody#mmtemplate_list").append(html)),ZPeople.Message.success(ZPI18N.getString("zp.tempadded.successfully")),settingsPage.container.find("#centerPopup").find("#sliderSbt").removeClass("disabled"),ZP_Mailmerge.closePopup(),pageId.find("#"+settingsUrlProps.currentMode+"_top_addbtn").removeClass("DN"),ZP_Mailmerge.constructSectionFormMapping(serviceName)},error:function(req){ZP_Mailmerge.closePopup(),ZPeople.Message.failure(ZPI18N.getString("zp.erroraddtemplate"))}}))}},addMailMerge:function(){ZP_Mailmerge.addmm;var fileName=settingsPage.container.find("#fileName").val(),formId=ZPeopleComponents.select("#SelTempId").getValue();ZP_Mailmerge.publicMMtemplate=!0;var err=!1;"Select"===(formId=settingsPage.container.find("#SelTempId").val())||null==formId?(err=!0,0===$("#errormsg_fid").length&&(settingsPage.container.find("#SelTempId-container").addClass("ztextbox__error"),$("#SelTempId-container").after('<span id="errormsg_fid" class="ztextbox--error__label">'+ZPI18N.getString("zp.formnamenotemptyerror")+"</span>"))):(settingsPage.container.find("#SelTempId-container").removeClass("ztextbox__error"),settingsPage.container.find("span#errormsg_fid").remove()),ZP_Mailmerge.isEmpty(fileName)?(err=!0,0===$("#errormsg").length&&(settingsPage.container.find("#fileName").addClass("ztextbox__error"),settingsPage.container.find("#fileName").after('<span id="errormsg" class="ztextbox--error__label">'+ZPI18N.getString("zp.template.namecantempty")+"</span>"))):fileName.length>ZP_Mailmerge.LIMIT.NAME?(err=!0,0===$("#add_maxTempname").length&&(settingsPage.container.find("#fileName").addClass("ztextbox__error"),settingsPage.container.find("span#errormsg").remove(),settingsPage.container.find("#fileName").after('<span id="add_maxTempname" class="ztextbox--error__label">'+ZPI18N.getString("zp.maxmmtempname")+"</span>"))):(settingsPage.container.find("#fileName").removeClass("ztextbox__error"),settingsPage.container.find("span#add_maxTempname").remove(),settingsPage.container.find("span#errormsg").remove()),-1==fileName.indexOf("<")&&-1==fileName.indexOf(">")&&-1==fileName.indexOf("&lt;")&&-1==fileName.indexOf("&gt;")||(ZPeople.Message.failure(ZPI18N.getString("zp.files.operations.avoidchar",new Array(ZPI18N.getString("zp.templatename"),"> <"))),err=!0);var attachName=ZP_Mailmerge.valReturndocNameIds().attachName,params={action:"ConstructPublicMailMergeTemplate",fn:fileName,formId:formId};ZP_Mailmerge.validateAttach(attachName,"#mmdocument_namediv","#mmdocument_name","zp.zs.documentname")?err=!0:ZP_Mailmerge.isEmpty(attachName)||(params.document_name=attachName),err||ZPeople.Request.send("/zpmailmerge/ConstructPublicMailMergeTemplate",params,ZP_Mailmerge.publicMailmergeTemplate)},publicMailmergeTemplate:function(data){ZP_Mailmerge.addmm;var pageId=settingsPage.container;settingsPage.container.find("#centerPopup").removeClass("zpl_mopen");var template=data[1].Gallery.TEMPLATE,FileName=data[1].fn,document_name=data[1].document_name,templateheader=data[1].Gallery.TEMPLATE_HEADER,formId=data[1].Gallery.formId;if(settingsPage.container.find("#template_Select").remove(),0===$("#template_Select").length){var html='<div id="template_Select" data-modal-box="tempGallery" class="zpl_mdl zpl_mfull zpl_mopen">\n\t\t\t\t\t  <div class="zpl_minr">\n\t\t\t\t\t    <div class="zpl_mhder">\n\t\t\t\t\t      <div>\n\t\t\t\t\t        <h4>'+ZPI18N.getString("zp.mmtempgallery")+'</h4>\n\t\t\t\t\t      </div>\n\t\t\t\t\t      <a class="_cls PI_cls" onClick="ZP_Mailmerge.closeSlider()"></a>\n\t\t\t\t\t    </div>\n\t\t\t\t\t    <div class="zpl_mcnt zpl_fm">\n\t\t\t\t\t      <div class="zpl_mmnu">\n\t\t\t\t\t        <div id="zp_form_section_list" class="zpl_mmnulft zpl_stpnumrme">\n\t\t\t\t\t          <ul>';html+='<li class="zpl_act" onclick=ZP_Mailmerge.scrolltodiv("BASIC",this) ><b>1</b><a >'+ZPI18N.getString("zp.basicSearch")+"</a></li>",$.each(templateheader,function(i,faqObj){html+=`<li class="" onclick=ZP_Mailmerge.scrolltodiv('${faqObj.id}',this)><b>1</b><a >${faqObj.name}</a></li>`}),html+='\n\t\t\t\t\t          </ul>\n\t\t\t\t\t        </div>\n\t\t\t\t\t        <div id="template_preview" class="zpl_mmnurgt">\n\t\t\t\t\t          <div id="BASIC" class="zpl_act">\n\t\t\t\t\t            <div class="zpl_secn">\n\t\t\t\t\t              <div>\n\t\t\t\t\t                <h5>'+ZPI18N.getString("zp.basicSearch")+'</h5>\n\t\t\t\t\t              </div>\n\t\t\t\t\t            </div>\n\t\t\t\t\t            <div class="zpl_secn">\n\t\t\t\t\t              <div>\n\t\t\t\t\t                <div class="zpl_temp_crd">\n\t\t\t\t\t                  <div class="d-flex flex-dirC j-cnt-btwen">                        \n\t\t\t\t\t                    <div class="zpl_prfl">\n\t\t\t\t\t                    </div>                        \n\t\t\t\t\t                    <p>'+ZPI18N.getString("zp.bookcover")+`</p>\n\t\t\t\t\t                    <div><div class="zlabel zlabel--outline zlabel--medium" onClick="ZP_Mailmerge.saveMMTemplate('${ZSEC.Encoder.encodeForJavaScript(FileName)}','${formId}', '${ZSEC.Encoder.encodeForJavaScript(document_name)}')">`+ZPI18N.getString("zp.select")+"</div></div>                        \n\t\t\t\t\t                  </div>                 \n\t\t\t\t\t                </div>\n\t\t\t\t\t              </div>\n\t\t\t\t\t            </div>\n\t\t\t\t\t          </div>",$.each(templateheader,function(i,faqObj){html+=`<div id="${faqObj.id}">\n\t\t\t\t\t\t    \t  \t\t<div class="zpl_secn">\n\t\t\t\t\t\t    \t  \t\t\t<div>\n\t\t\t\t\t\t    \t  \t\t\t\t<h5>${faqObj.name}</h5>\n\t\t\t\t\t\t    \t  \t\t\t</div>\n\t\t\t\t\t\t    \t  \t\t</div>\n\t\t\t\t\t\t    \t  \t\t<div class="zpl_secn">\n\t\t\t\t\t\t    \t  \t\t\t<div>\n\t\t\t\t\t\t    \t  \t\t\t\t<div class="zpl_temp_crd">`;var documents=template[faqObj.id].DOCUMENTS;$.each(documents,function(i,doc){html+=`<div class="d-flex flex-dirC j-cnt-btwen">\n\t    \t  \t\t\t\t\t\t\t\t<div class="zpl_prfl" id="${doc.RESOURCE_ID}" templatename="${ZSEC.Encoder.encodeForHTMLAttribute(doc.DOCUMENT_NAME)}"  templateurl="${doc.PREVIEW_URL}" onclick=ZP_Mailmerge.constructPreviewimgDiv("${doc.RESOURCE_ID}")>\n\t    \t  \t\t\t\t\t\t\t\t\t<img src="https://${doc.PREVIEW_URL}" >\n                    \t\t\t\t\t\t\t<p>${ZSEC.Encoder.encodeForHTML(doc.DOCUMENT_NAME)}</p>\n                    \t\t\t\t\t\t</div>\n                    \t\t\t\t\t\t<div>\n                    \t\t\t\t\t\t\t<div><div class="zlabel zlabel--outline zlabel--medium" onClick="ZP_Mailmerge.saveCloneMMTemplate('${ZSEC.Encoder.encodeForJavaScript(FileName)}','${formId}', '${doc.RESOURCE_ID}', '${ZSEC.Encoder.encodeForJavaScript(document_name)}')">`+ZPI18N.getString("zp.select")+"</div></div>  \n\t    \t  \t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t    \t\t \t</div>"}),html+="</div>\n\t\t\t\t\t\t    \t  \t\t\t</div>\n\t\t\t\t\t\t    \t  \t\t</div>\n\t\t\t\t\t\t    \t  \t</div>"}),html+="</div>\n\t\t\t\t\t      </div>\n\t\t\t\t\t    </div>\n\t\t\t\t\t  </div>\n\t\t\t\t\t</div>",pageId.append(html)}else settingsPage.container.find("#template_Select").addClass("zpl_mopen")},constructPreviewimgDiv:function(identifier){$("#wrapper").addClass("ZPMprw");var templateName=settingsPage.container.find("#"+identifier).attr("templatename"),templateUrl="https://"+settingsPage.container.find("#"+identifier).attr("templateurl");ZP_Mailmerge.LightBox=new LightBox(templateName),ZP_Mailmerge.LightBox.viewUrl=templateUrl,ZP_Mailmerge.LightBox.isImage=!0,ZP_Mailmerge.LightBox.show()},closepreviewDiv:function(){$("#viewPublicMMDiv").remove(),$("#wrapper").removeClass("ZPMprw")},scrolltodiv:function(div,obj){$("#zp_form_section_list").find("li").removeClass("zpl_act"),$("#template_preview").find("div").removeClass("zpl_act"),$(obj).addClass("zpl_act"),$("#"+div).addClass("zpl_act")},bytesToSize:function(bytes){if(0==bytes)return"0 Byte";var i=parseInt(Math.floor(Math.log(bytes)/Math.log(1024)));return Math.round(bytes/Math.pow(1e3,i),2)+" "+["Bytes","KB","MB","GB","TB"][i]},closePopup:function(){$("#SelTempId").length>0&&ZPeopleComponents.select($("#SelTempId")).destroy(),$("#choose_template").length>0&&ZPeopleComponents.select($("#choose_template")).destroy(),settingsPage.container.find("#centerPopup").remove(),ZPeopleComponents.isComponent("#mm_tabpanel")&&ZPeopleComponents.tabbedlistboxpopup("#mm_tabpanel").destroy(),$("div#mm_tabpanel").remove(),settingsPage.container.find(".mmlimits_info-crd").removeClass("DN")},closeSlider:function(){ZPeopleComponents.isComponent("#choose_template_form")&&ZPeopleComponents.select($("#choose_template_form")).destroy(),$("#mmDownload_slider").removeClass("zpl_mopen"),$("#mmpreview").length>0&&settingsPage.container.find("#mmpreview").remove(),$("#template_Select").length>0&&(settingsPage.container.find("#template_Select").remove(),ZP_Mailmerge.closePopup()),ZPeopleComponents.isComponent("#mm_tabpanel")&&ZPeopleComponents.tabbedlistboxpopup("#mm_tabpanel").destroy(),$("div#mm_tabpanel").remove(),ZP_Mailmerge.isOffboarding&&(ZP_Mailmerge.isOffboarding=!1),ZPUtil.Validation.isEmpty(ZP_Mailmerge.offboardingFormid)||(ZP_Mailmerge.offboardingFormid=void 0)},dropHandler:function(ev){if(ev.preventDefault(),ev.dataTransfer.items)for(var i=0;i<ev.dataTransfer.items.length;i++)"file"===ev.dataTransfer.items[i].kind&&(ZP_Mailmerge.uploadMode="localUpload",ZP_Mailmerge.fileUploadList=ev.dataTransfer.items[i].getAsFile(),ZP_Mailmerge.attachmentConstructor(ZP_Mailmerge.fileUploadList))},attachmentConstructor:function(obj){var fileName="",fileSize="";if("localUpload"===ZP_Mailmerge.uploadMode)fileName=obj.name,fileSize=ZP_Mailmerge.bytesToSize(obj.size);else if("cloudUpload"===ZP_Mailmerge.uploadMode){if(void 0!=CloudPicker.fileObj&&"mailmerge"==CloudPicker.cloudUploadOrigin){ZP_Mailmerge.uploadMode="cloudUpload";var fileObj=JSON.parse(CloudPicker.fileObj);if("gdrive"==fileObj.provider&&void 0!=fileObj.mimeType&&"application/vnd.google-apps.folder"==fileObj.mimeType)return void ZPeople.Message.warning("Content Needed Folder upload not supported. Please choose a valid file");fileName=decodeURIComponent(fileObj.docName)}}else fileName=obj.docName;var html=`<div>\n\t  \t\t\t<h5>Attachment Files</h5>\n\t  \t\t </div>\n\t  \t\t <div>\n\t  \t\t\t<div class="zpl_atchd">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class="zpl_atchimg">\n\t\t\t\t\t\t\t\t<i class="${"pdf"===fileName.split(".").pop()?"PI_ft_pdf":"PI_ft_doc"}"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="zpl_atchdtl">\n\t\t\t\t\t\t\t\t<h4 id="att_fileName" title="${ZSEC.Encoder.encodeForHTMLAttribute(fileName)}">${ZSEC.Encoder.encodeForHTMLAttribute(fileName)}</h4>\n\t\t\t\t\t\t\t\t<p><span id="att_fileSize">${fileSize}</span></p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="zpl_atchicn">\n\t\t\t\t\t\t\t\t<i class="PI_delete" onclick="ZP_Mailmerge.deleteAttachment()"></i>\n\t\t\t\t\t\t</div>\n\t  \t\t\t\t</div>\n\t  \t\t\t</div>`;settingsPage.container.find("#edit_fileName").val(fileName),settingsPage.container.find("#attachments").html(html),settingsPage.container.find("#uploadSection").hide()},resetUploadParam:function(){ZP_Mailmerge.uploadMode="",ZP_Mailmerge.fileUploadList=void 0,ZP_Mailmerge.importFile=void 0},deleteAttachment:function(){settingsPage.container.find("#attachments").html("</div>"),settingsPage.container.find("#edit_fileName").val(""),settingsPage.container.find("#uploadSection").show(),settingsPage.container.find("span#errormsg_upload_impEXT").remove(),ZP_Mailmerge.resetUploadParam()},saveMMTemplate:function(fileName,formId,document_name,docNameList){var serviceName=settingsUrlProps.niceUrlArr[2],SelectedformId=(ZP_Mailmerge.addmm,fileName=settingsPage.container.find("#fileName").val(),formId=ZPeopleComponents.select("#SelTempId").getValue(),settingsPage.container.find("#"+ZP_Mailmerge.formsListId(ZP_Automation_Mode.MAILMERGE)).val()),pageId=settingsPage.container;ZPeople.Message.warning(ZPI18N.getString("zp.templatecreating"));pageId=settingsPage.container;var sliderbdy=$("body #modal_Container"),params={action:"addTemplate",fn:fileName,formId:formId};void 0!=document_name&&(params.document_name=document_name),"undefined"!=docNameList&&(params.docNameList=docNameList),ZPeople.Request.send("/zpmailmerge/addTemplate",params,data=>{var dataObj=data[1],tid=(data[1].url,data[1].tid),writerURL=data[1].url.replace("/docs/","/writer/"),resId=data[1].url.split("open/")[1];ZP_Mailmerge.writerURL=data[1].url.split("open/")[0];var form=ZP_Mailmerge.formList.find(e=>formId===e.id);if(0!=pageId.find("table#mmtemplate_list tbody tr").length&&(settingsPage.container.find("#emptPage").remove(),pageId.find("table#mmtemplate_list thead").show(),settingsPage.container.find("#"+settingsUrlProps.currentMode+"_top_addbtn").removeClass("DN")),ZPeople.Message.success(ZPI18N.getString("zp.tempadded.successfully")),window.open(writerURL),ZP_Mailmerge.closePopup(),settingsPage.container.find("#template_Select").remove(),ZP_Mailmerge.isOffboarding)OffboardingSettings.Document.getListPageByHash();else{var html=`<tr template_id ="${dataObj.tid}" formId="${formId}" rid="${resId}")>,\n\t\t\t\t<td onclick="ZP_Mailmerge.TemplatePreview(this,'${resId}', '${ZSEC.Encoder.encodeForJavaScript(fileName)}', '${tid}', '${dataObj.url}', '${form.id}', '${ZSEC.Encoder.encodeForJavaScript(document_name)}')">\n\t\t\t\t\t\t<span>${ZSEC.Encoder.encodeForHTML(fileName)}</span>\n\t\t\t\t</td>`;ZP_Mailmerge.skipFormSelectDropdown()||(html+=`<td>\n\t\t\t\t\t\t\t\t<span>${ZSEC.Encoder.encodeForHTML(form.name)}</span>\n\t\t\t\t\t\t\t</td>`),html+=`<td id="edit_delete" width="10%">\n\t\t\t\t\t\t<div class="zpl_hvr">\n\t\t\t\t\t\t<i class="PI_delete" onclick="ZP_Mailmerge.deleteFile('${tid}','${formId}')"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="zpl_hvr">\n\t\t\t\t\t\t<i class="PI_edt" id="edit_tempName" onclick="ZP_Mailmerge.editFileName('${tid}','${resId}', '${ZSEC.Encoder.encodeForJavaScript(fileName)}','${formId}', '${ZSEC.Encoder.encodeForJavaScript(document_name)}')"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>`,("All"===SelectedformId||SelectedformId===formId||ZP_Mailmerge.skipFormSelectDropdown())&&(settingsPage.container.find("#emptPage").remove(),settingsPage.container.find("table#mmtemp_zpl-tbl").show(),settingsPage.container.find("tbody#mmtemplate_list").append(html));var pageMode=ZPA_Common.getPageMode(),tempObj={};tempObj.templateId=dataObj.tid,tempObj.templateName=fileName,tempObj.url=dataObj.url,pageMode==ZP_Automation_Mode.CUSTOMACTION&&ZPA_Actions.callBackActions("mmergeTemp",tempObj),pageId.find("#"+settingsUrlProps.currentMode+"_top_addbtn").removeClass("DN"),ZP_Mailmerge.constructSectionFormMapping(serviceName)}}),ZP_Mailmerge.closePopup(),settingsPage.container.find("#fileName").val(""),pageId.find("#mmdocument_name").length>0?pageId.find("#mmdocument_name").val(""):sliderbdy.find("#mmdocument_name").val("")},saveCloneMMTemplate:function(fName,formId,rid,attachName,docListId){ZPeople.Message.warning(ZPI18N.getString("zp.templatecreating"));var params={action:"cloneMailMergeTemplate",fn:fName,formId:formId,rid:rid,isPublicMailmerge:!0};void 0!=attachName&&(params.document_name=attachName),"undefined"!=docListId&&(params.docNameList=docListId),ZPeople.Request.send("/zpmailmerge/cloneMailMergeTemplate",params,data=>{var dataObj=data[1],writerURL=(data[1].url,data[1].url.replace("/docs/","/writer/")),resId=data[1].url.split("open/")[1];ZP_Mailmerge.writerURL=data[1].url.split("open/")[0];var form=ZP_Mailmerge.formList.find(e=>formId===e.id);settingsPage.container.find("#emptpage").remove(),ZPeople.Message.success(ZPI18N.getString("zp.tempadded.successfully")),window.open(writerURL),ZP_Mailmerge.closePopup(),settingsPage.container.find("#template_Select").remove();var html=`<tr template_id ="${dataObj.tid}" formId="${formId}" rid="${resId}")>\n\t\t\t\t<td onclick="ZP_Mailmerge.TemplatePreview(this,'${resId}', '${ZSEC.Encoder.encodeForJavaScript(fName)}', '${dataObj.tid}', '${dataObj.url}', '${form.id}', '${ZSEC.Encoder.encodeForJavaScript(attachName)}')">\n\t\t\t\t\t\t<span>${ZSEC.Encoder.encodeForHTML(fName)}</span>\n\t\t\t\t</td>`;ZP_Mailmerge.skipFormSelectDropdown()||(html+=`<td>\n\t\t\t\t\t\t\t\t<span>${ZSEC.Encoder.encodeForHTML(form.name)}</span>\n\t\t\t\t\t\t\t</td>`),html+=`<td id="edit_delete" width="10%">\n\t\t\t\t\t\t<div class="zpl_hvr">\n\t\t\t\t\t\t<i class="PI_delete" onclick="ZP_Mailmerge.deleteFile('${dataObj.tid}','${formId}')"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="zpl_hvr">\n\t\t\t\t\t\t<i class="PI_edt" id="edit_tempName" onclick="ZP_Mailmerge.editFileName('${dataObj.tid}','${resId}','${ZSEC.Encoder.encodeForJavaScript(fName)}','${formId}','${ZSEC.Encoder.encodeForJavaScript(attachName)}')"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>`,settingsPage.container.find("tbody#mmtemplate_list").append(html)})},TemplatePreview:function(obj,resId,fileName,tid,url,formID,attachName){settingsPage.container.find(".mmlimits_info-crd").addClass("DN"),settingsPage.container.find("#mmpreview").remove(),settingsPage.container.find("#editTemp").remove();fileName=settingsPage.container.find("tbody#mmtemplate_list tr[template_id = '"+tid+"']").find("td:first-child").find("span").text();var pageId=settingsPage.container,params={action:"getMailMergeTemplates",startInd:"1",limit:"200",templateId:tid,conreqcsr:csrfToken};void 0!=formID&&(params.formId=formID),$.ajax({url:"/zpmailmerge/getMailMergeTemplates",type:"POST",data:params,success:function(data){ZP_Mailmerge.singleTemplateCallback(data);var URL=ZP_Mailmerge.writerURL.replace("/docs/","/writer/")+"zwpreview/"+resId;if(0===$("#mmpreview").length){var html=`<div id='mmpreview' data-modal-box="tempGallery" class="zpl_mdl zpl_mfull zpl_mopen">\n                                    <div class="zpl_minr">\n                                        <div class="zpl_mhder">\n                                            <div>\n                                                <a class="clsArw" onclick="ZP_Mailmerge.closeSlider()"><i class="PI_back"></i></a>\n                                                <h4>${ZSEC.Encoder.encodeForHTML(fileName)}</h4>\n                                            </div>\n                                        <span class="zpl_mhderrgt">\n                                            <a class="PI_edt zpl_btnic" id="preview_edit" onclick="ZP_Mailmerge.previewEditMMTemplate('${url}')"title="Edit"></a>\n                                            <a class="PI_clone zpl_btnic" id="preview_clone" onclick="ZP_Mailmerge.cloneTemplate('${resId}','${formID}', '${tid}', '${ZSEC.Encoder.encodeForJavaScript(attachName)}', '${ZSEC.Encoder.encodeForJavaScript(fileName)}')" title="Clone"></a>\n                                            <a class="PI_downld zpl_btnic" id="preview_download" onclick="ZP_Mailmerge.downloadMMTemplate('${tid}')" title="Download"></a>\n                                        </span>\n                                    </div>\n                                    <div class="zpl_mcnt zpl_fm">\n                                        <div class="zpl_mmnu">\n                                            <div style="height: 650px; width: 100%;">\n                                                <iframe src="${URL}" id="mmPreviewFrame" name="mmPreviewFrame" scrolling="auto" style="border: none; margin: 0pt; height: 100%;" frameborder="0" width="100%"></iframe>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <iframe id="download_iframe" style="display: none;"></iframe>\n                                        <div class="zpl_mfoter">\n                                    </div>\n                                </div>\n                            </div>`;pageId.append(html),!0===ZP_Mailmerge.isOffboarding&&(settingsPage.container.find("#preview_clone").hide(),settingsPage.container.find("#preview_download").hide())}else settingsPage.container.find("#mmpreview").addClass("zpl_mopen")},failure:function(data){ZP_Mailmerge.failedCallBack(data)}})},previewEditMMTemplate:function(url){if(window.open(url,"_blank"),ZPeople.sandboxInfo.isSandbox){var params={action:"previewEditTrack",fn:ZP_Mailmerge.previewfname,formId:ZP_Mailmerge.previewformId,templateId:ZP_Mailmerge.previewtid,conreqcsr:csrfToken};$.ajax({url:"/zpmailmerge/previewEditTrack",type:"POST",data:params,success:function(data){ZPeople.Message.success(ZPI18N.getString("zp.editedsuccess"))}})}},singleTemplateCallback:function(data){$.each(data[1].templateDetails,function(index,templateObj){ZP_Mailmerge.writerURL=templateObj.url.split("open/")[0],ZP_Mailmerge.previewfname=templateObj.fname,ZP_Mailmerge.previewrid=templateObj.rid,ZP_Mailmerge.previewformId=templateObj.formId,ZP_Mailmerge.previewtid=templateObj.tid,ZP_Mailmerge.docNameList=templateObj.docNameList,ZP_Mailmerge.attachName=templateObj.document_name})},cloneTemplate:function(resId,formId,tid,attachName,fileName){settingsPage.container.find("#mmpreview").remove(),ZP_Mailmerge.tid=tid,ZP_Mailmerge.rid=resId,ZP_Mailmerge.formId=formId,""!=attachName&&"null"!=attachName&&"undefined"!=attachName||(attachName=fileName),ZP_Mailmerge.attachName=attachName;var content='\n\t\t\t<div class="zpl_crd">\n\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t<div class="zpl_secn" id="mmfile_namediv">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label class="zpl_mtry" >'+ZPI18N.getString("zp.templatename")+`</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<input id="clone_fileName" value="" type="text" class="ztextbox">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="zpl_secn ${ZP_Mailmerge.skipDocumentNameInput()?"DNI":""}" id="mmdocument_namediv">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label class="zpl_mtry">`+ZPI18N.getString("zp.zs.documentname")+'</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>  \n                            <div class="ztextbox--group zh-alignright zpl_inpticfild">\n                               <i class="ztextbox__icon PI_addlist" style="width:50px; justify-content:center;" id="mm_pop" onclick="ZP_Mailmerge.initiateTabPanel(\'mm_tabpanel\', \'mm_pop\')"></i>\n                                  <input type="text" id="mmdocument_name" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade()">\n                             <div id="mm_tabpanel"></div>\n                           </div>\n                        </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>';ZP_Mailmerge.mmTempopupModal("centerPopup",ZPI18N.getString("zp.clonetemp"),content,ZP_Mailmerge.cloneTemplateCallBack),settingsPage.container.find("#clone_fileName").val(fileName),ZP_Mailmerge.setMergedName(ZP_Mailmerge.formId),ZP_Mailmerge.populateAttachName()},cloneTemplateCallBack:function(){var fileName=settingsPage.container.find("#clone_fileName").val(),err=!1;ZP_Mailmerge.isEmpty(fileName)?(err=!0,0===$("#errormsg").length&&(settingsPage.container.find("#clone_fileName").addClass("ztextbox__error"),settingsPage.container.find("#clone_fileName").after('<span id="errormsg" class="ztextbox--error__label">'+ZPI18N.getString("zp.template.namecantempty")+"</span>"))):fileName.length>ZP_Mailmerge.LIMIT.NAME?(err=!0,0===$("#clone_maxTempname").length&&(settingsPage.container.find("#clone_fileName").addClass("ztextbox__error"),settingsPage.container.find("span#errormsg").remove(),settingsPage.container.find("#clone_fileName").after('<span id="clone_maxTempname" class="ztextbox--error__label">'+ZPI18N.getString("zp.maxmmtempname")+"</span>"))):(settingsPage.container.find("#clone_fileName").removeClass("ztextbox__error"),settingsPage.container.find("span#clone_maxTempname").remove(),settingsPage.container.find("span#errormsg").remove()),-1==fileName.indexOf("<")&&-1==fileName.indexOf(">")&&-1==fileName.indexOf("&lt;")&&-1==fileName.indexOf("&gt;")||(ZPeople.Message.failure(ZPI18N.getString("zp.files.operations.avoidchar",new Array(ZPI18N.getString("zp.templatename"),"> <"))),err=!0);var attachName=ZP_Mailmerge.valReturndocNameIds().attachName;if(ZP_Mailmerge.validateAttach(attachName,"#mmdocument_namediv","#mmdocument_name","zp.zs.documentname")&&(err=!0),!err){var formData=new FormData;formData.append("action","cloneMailMergeTemplate"),formData.append("formId",ZP_Mailmerge.formId),formData.append("fn",fileName),formData.append("templateId",ZP_Mailmerge.tid),formData.append("conreqcsr",csrfToken),formData.append("isPublicMailmerge",!1),ZP_Mailmerge.isEmpty(attachName)||formData.append("document_name",attachName);ZP_Mailmerge.formList.find(e=>ZP_Mailmerge.formId===e.id);$.ajax({url:"/zpmailmerge/cloneMailMergeTemplate",type:"POST",data:formData,contentType:!1,processData:!1,success:function(data){var dataObj=data[1],writerURL=(data[1].url,data[1].url.replace("/docs/","/writer/")),resId=data[1].url.split("open/")[1];ZP_Mailmerge.writerURL=data[1].url.split("open/")[0];var form=ZP_Mailmerge.formList.find(e=>ZP_Mailmerge.formId===e.id);settingsPage.container.find("#emptpage").remove(),ZPeople.Message.success(ZPI18N.getString("zp.clonesuccess")),window.open(writerURL),ZP_Mailmerge.closePopup(),ZP_Mailmerge.closeSlider();var html=`<tr template_id ="${dataObj.tid}" formId="${dataObj.formId}" rid="${resId}")>\n\t\t\t\t\t\t<td onclick="ZP_Mailmerge.TemplatePreview(this,'${resId}', '${ZSEC.Encoder.encodeForJavaScript(fileName)}', '${dataObj.tid}', '${dataObj.url}', '${form.id}', '${ZSEC.Encoder.encodeForJavaScript(attachName)}')">\n\t\t\t\t\t\t\t\t<span id="zp_form_header_name">${ZSEC.Encoder.encodeForHTML(fileName)}</span>\n\t\t\t\t\t\t</td>`;ZP_Mailmerge.skipFormSelectDropdown()||(html+=`<td>\n\t\t\t\t\t\t\t\t\t\t<span>${ZSEC.Encoder.encodeForHTML(form.name)}</span>\n\t\t\t\t\t\t\t\t\t</td>`),html+=`<td id="edit_delete" width="10%">\n\t\t\t\t\t\t\t\t<div class="zpl_hvr">\n\t\t\t\t\t\t\t\t<i class="PI_delete" onclick="ZP_Mailmerge.deleteFile('${dataObj.tid}','${dataObj.formId}')"></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zpl_hvr">\n\t\t\t\t\t\t\t\t<i class="PI_edt" id="edit_tempName" onclick="ZP_Mailmerge.editFileName('${dataObj.tid}','${resId}','${ZSEC.Encoder.encodeForJavaScript(fileName)}','${ZP_Mailmerge.formId}','${ZSEC.Encoder.encodeForJavaScript(attachName)}')"></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>`,settingsPage.container.find("tbody#mmtemplate_list").append(html),ZP_Mailmerge.tid=null,ZP_Mailmerge.rid=null,ZP_Mailmerge.formId=null},error:function(req){ZP_Mailmerge.closePopup(),ZPeople.Message.failure(ZPI18N.getString("zp.clonefailure"))}}),ZPeople.Message.warning(ZPI18N.getString("zp.cloneprogress"))}},downloadMMTemplate:function(id){var viewUrl="/viewFile?action=mailmergeDownloadDocument&templateId="+id;"null"!=contextPath&&"undefined"!=contextPath&&(viewUrl="/"+contextPath+viewUrl),settingsPage.container.find("iframe#download_iframe").attr("src",viewUrl)},closeInfoCard:function(){settingsPage.container.find(".mmlimits_info-crd").addClass("DN")},constructMMTempList:function(mode,formId,startInd,thisObj,type,isMailMerge,successCallback){var pageId=settingsPage.container,wrapperId=$("#page-wrapper"),params={action:"getMailMergeTemplates",startInd:"1",limit:"200"};if(void 0!=ZP5Form.getFormClassObj())var recordId=ZP5Form.getFormClassObj().getParams().recordId;else ZP_Mailmerge.isEmpty(recordId)&&(recordId=settingsUrlProps.url.indexOf("home/dashboard/feeds")>-1?pageId.find("input#recordid").val():wrapperId.find("#mmDownload_slider").attr("view-recordId"));void 0!=recordId&&(params.recordId=recordId),formId=ZP_Mailmerge.formIdCheck(mode,formId),ZP_Mailmerge.isEmpty(formId)||"0"==formId||void 0==formId||(params.formId=formId),"form"!==mode&&"workflow"!==mode||($("div#download_mailmerge").attr("formId",formId),params.type="form"),"accountsetup"===mode&&(params.isFromAccsetup=!0),ZP_Mailmerge.isEmpty(startInd)||(params.startInd=startInd),params.conreqcsr=csrfToken;var otherDtls={thisObj:thisObj,type:type,mode:mode,isMailMerge:isMailMerge};$.ajax({url:"/zpmailmerge/getMailMergeTemplates",type:"POST",data:params,success:function(data){ZP_Mailmerge.getTempListCallback(data,params,otherDtls,successCallback)},failure:function(data){ZP_Mailmerge.failedCallBack(data)}})},constructLeftMMList:function(data){var templateElm,mmLeftListBody=settingsPage.container.find("#mmLeftListing");mmLeftListBody.html(""),$.each(data[1].templateDetails,function(index,templateObj){templateElm="<li><a id='"+templateObj.tid+"' template_id='"+templateObj.tid+"' formid='"+templateObj.formId+"' rid='"+templateObj.rid+"' onclick=ZP_Mailmerge.editSingleTemplate(this,'"+templateObj.tid+"') target='_blank'>"+ZSEC.Encoder.encodeForHTML(templateObj.fname)+"</a></li>",mmLeftListBody.append(templateElm)})},getTempListCallback:function(data,params,otherDtls,successCallback){var parentObj,pageId=settingsPage.container,templateElm="",mode=otherDtls.mode,type=otherDtls.type,permission=data[1].Permission,recordId=params.recordId;if("accountsetup"===mode&&(void 0!==data[1].templateDetails&&$.each(data[1].templateDetails,function(key,value){ZP_Mailmerge.sectionFormMap.push(value)}),-1!==data[1].mmtemplatesCount&&(ZP_Mailmerge.templateCount=data[1].mmtemplatesCount)),ZP_Mailmerge.allemplookupDetails=data[1].allemplookupDetails,$.each(data[1].fileSettings,function(_tabkey,tabvalue){tabvalue.hasOwnProperty(FilesUtil.hrFilesRename)&&(FilesUtil.hrfiledisname=tabvalue[FilesUtil.hrFilesRename],FilesUtil.addhrfiledisname=ZPI18N.getString("zp.add")+" "+FilesUtil.hrfiledisname,FilesUtil.edithrfiledisname=ZPI18N.getString("zp.edit")+" "+FilesUtil.hrfiledisname)}),"form"!==mode||otherDtls.isMailMerge||"workflow"==mode||(void 0===ZP5Form.getFormClassObj()?ZP_Mailmerge.constructMMdownloadPopup():void 0!=ZP5Form.getFormClassObj()&&ZP_Mailmerge.constructMMdownloadSlider()),1!=permission&&1!=isadmin?($("#mailmergemovehr").addClass("DN"),$("#add_empfiles").addClass("DN")):$("#mailmergemovehr").removeClass("DN"),"form"!==mode&&"workflow"!==mode||0==data[1].templateDetails.length&&(ZP_Mailmerge.templateIds={}),"accountsetup"!=mode&&$.each(data[1].templateDetails,function(index,templateObj){var formName=pageId.find("select#forms_list option[value='"+templateObj.formId+"']").text();"form"===mode||"workflow"===mode?(templateElm+="<option value='"+templateObj.tid+"'>"+ZSEC.Encoder.encodeForHTML(templateObj.fname)+"</option>",ZP_Mailmerge.templateIds=data[1].templateDetails):(ZP_Mailmerge.writerURL=templateObj.url.split("open/")[0],templateElm+='<tr template_id = "'+templateObj.tid+'" formid = "'+templateObj.formId+'" rid = "'+templateObj.rid+'">',templateElm+="<td></td>",templateElm+='<td><div><a class="ulnk" name="templateName" onclick=ZP_Mailmerge.editSingleTemplate(this,"'+templateObj.tid+'")>'+ZSEC.Encoder.encodeForHTML(templateObj.fname)+"</a></div></td>",templateElm+='<td name="formName">'+ZSEC.Encoder.encodeForHTML(formName)+"</td>",templateElm+='<td><a class="btn-link S14 MR20 lnk" title="Clone"></a> <a class="IC-pen lnk S14" title="Edit" onclick = "ZP_Mailmerge.editFileName(this)"></a> <a class="IC-delete ML20 lnk S14" title="Delete" onclick=ZPeople.confirm(this,"","zp.deleteconfirmtitle",ZP_Mailmerge.deleteFile)></a></td>',templateElm+="</tr>"),ZP_Mailmerge.formId=templateObj.formId}),ZP_Mailmerge.constructLeftMMList(data),ZP_Mailmerge.employeeFormID=data[1].employeeFormId,"form"===mode?"Merge"==type?parentObj=$("#page-wrapper").find("select#choose_template"):"Download"==type&&(parentObj=$("body #modal_Container").find("select#choose_template_form")):parentObj=pageId.find("table#mmtemplate_list tbody"),"scroll"!==mode&&parentObj.html(""),"workflow"===mode&&(parentObj=pageId.find("#templates")),ZP_Mailmerge.isEmpty(templateElm)?"scroll"!==mode&&"form"!==mode&&(pageId.find("table#mmtemplate_list thead").hide(),pageId.find("div#no_template_msg").show()):("scroll"!==mode&&"form"!==mode&&(pageId.find("table#mmtemplate_list thead").show(),pageId.find("div#no_template_msg").hide()),parentObj.append(templateElm)),pageId.find("div#scrollContent").data({lastDataCnt:data[1].length}),pageId.find("div#scrollContent").data({startInd:params.startInd}),"form"!==mode&&"workflow"!==mode||("Merge"==type?ZPeopleComponents.select("#choose_template",templateElm):"Download"==type&&ZPeopleComponents.select("#choose_template_form",templateElm)),!(void 0!=ZP5Form.getCurrFormsOperation()&&void 0!=ZP5Form.getCurrFormsOperation().formId&&void 0!=settingsUrlProps.niceUrl&&settingsUrlProps.niceUrl.lastIndexOf("/listview")>-1||"workflow"===mode)){ZP_Mailmerge.setMergedName(ZP_Mailmerge.formId);var templateID=$("#downSlider_cnt").find("select#choose_template_form").val();params={action:"getMailMergeTemplates",startInd:"1",limit:"200"};void 0!=templateID&&(params.templateId=templateID),void 0!=recordId&&(params.recordId=recordId),void 0!=ZP_Mailmerge.formId&&(params.formId=ZP_Mailmerge.formId),"form"===mode&&(params.type="form"),params.conreqcsr=csrfToken,$.ajax({url:"/zpmailmerge/getMailMergeTemplates",type:"POST",data:params,success:function(data){ZP_Mailmerge.singleTemplateCallback(data),""!=ZP_Mailmerge.attachName&&"null"!=ZP_Mailmerge.attachName&&void 0!=ZP_Mailmerge.attachName&&"undefined"!=ZP_Mailmerge.attachName||(ZP_Mailmerge.attachName=ZP_Mailmerge.previewfname),$("#choose_template_form").on("zselectoptionclick",function(){ZP_Mailmerge.getSingleTempDetail(mode)}),ZP_Mailmerge.populateAttachName()},failure:function(data){ZP_Mailmerge.failedCallBack(data)}})}void 0!=successCallback&&successCallback()},getSingleTempDetail:function(mode){var formId,params={action:"getMailMergeTemplates",startInd:"1",limit:"200",templateId:$("#downSlider_cnt").find("select#choose_template_form").val()};if(void 0!=ZP5Form.getFormClassObj())var recordId=ZP5Form.getFormClassObj().getParams().recordId;else ZP_Mailmerge.isEmpty(recordId)&&(recordId=settingsUrlProps.url.indexOf("home/dashboard/feeds")>-1?pageId.find("input#recordid").val():wrapperId.find("#mmDownload_slider").attr("view-recordId"));void 0!=recordId&&(params.recordId=recordId),formId=ZP_Mailmerge.formIdCheck(mode,formId),ZP_Mailmerge.isEmpty(formId)||"0"==formId||void 0==formId||(params.formId=formId),"form"===mode&&($("div#download_mailmerge").attr("formId",formId),params.type="form"),params.conreqcsr=csrfToken,$.ajax({url:"/zpmailmerge/getMailMergeTemplates",type:"POST",data:params,success:function(data){ZP_Mailmerge.singleTemplateCallback(data),""!=ZP_Mailmerge.attachName&&"null"!=ZP_Mailmerge.attachName&&void 0!=ZP_Mailmerge.attachName&&"undefined"!=ZP_Mailmerge.attachName||(ZP_Mailmerge.attachName=ZP_Mailmerge.previewfname),ZP_Mailmerge.populateAttachName()},failure:function(data){ZP_Mailmerge.failedCallBack(data)}})},showMergeAndDownloadTemplateModal:function(type,thisObj){var pageId=settingsPage.container,modalObj=$("div#downSlider_cnt"),obj="Merge"===type?pageId.find("div#merge_template_modal"):modalObj;$(modalObj.find("div#view_type").find("input[name='mmPdftype']").get(0)).prop("checked",!0),"Merge"!==type||ZP_Mailmerge.isEmpty(thisObj)||$(obj).data({recordid:$(thisObj).closest("tr").attr("recordid")})},mmTempViewType:function(viewType){settingsPage.container;var modalObj=$("div#downSlider_cnt");modalObj.find("input#select_pdf").prop("checked",!0),"2"===viewType?(modalObj.find("input#select_doc").prop("checked",!0),modalObj.find("input#select_pdf").prop("checked",!1)):"1"===viewType&&(modalObj.find("input#select_pdf").prop("checked",!0),modalObj.find("input#select_doc").prop("checked",!1))},disableSaveBtn:function(pageId,btnId){pageId.find("#"+btnId).addClass("is-disabled zlabel--outline")},enableSaveBtn:function(pageId,btnId){setTimeout(function(){pageId.find("#"+btnId).removeClass("is-disabled zlabel--outline")},500)},mergeAndDownload:function(){var pageId=settingsPage.container,modalObj=$("#downSlider_cnt"),recordId=ZP5Form.getFormClassObj().getParams().recordId;ZP_Mailmerge.isEmpty(recordId)&&(recordId=Layout.Page.hash.indexOf("home/dashboard/feeds")>-1?pageId.find("input#recordId").val():$("#downSlider_cnt").attr("recordId"));var formId=modalObj.attr("formId");void 0==formId&&(formId=ZP5Form.getFormClassObj().getParams().formId);var docType=modalObj.find("input#select_pdf").is(":checked")?"pdf":"docx",viewUrl="/viewFile?action=mailmerge&recordId="+recordId+"&templateId="+modalObj.find("select#choose_template_form").val()+"&docType="+docType+"&formId="+formId,err=!1,docNameObj=ZP_Mailmerge.valReturndocNameIds(),attachName=(docNameObj.docNameIds,docNameObj.attachName);ZP_Mailmerge.validateAttach(attachName,"#mmdocument_namediv","#mmdocument_name","zp.zs.documentname","#mmDownload_slider")&&(err=!0),err||(err||(ZAlertBanner.show({id:"downloadmmWar",message:ZPI18N.getString("zp.downloadmailmergemsg"),type:"warning",closeButton:!0,icon:!0,hideDelay:1e4,animation:{show:{name:"slideDown",duration:500},hide:{name:"slideUp",duration:500}},hideDelay:4e3,beforeshow:ZPeople.Message.beforeShow}),ZP_Mailmerge.isEmpty(attachName)||(viewUrl=viewUrl+"&document_name="+encodeURIComponent(attachName))),"null"!=contextPath&&"undefined"!=contextPath&&(viewUrl="/"+contextPath+viewUrl),err||(ZP_Mailmerge.closeSlider(),modalObj.find("iframe#download_iframe").attr("src",viewUrl)))},downloadSlider:function(){if(0===$("#downSlider_cnt").length){var addHtml='<div class="zpl_crd"><div id="downSlider_cnt" class="zpl_crdcnt">';addHtml+='<div class="zpl_secn"><div id="mmBannDown"><label>'+ZPI18N.getString("zp.selecttemplate")+'</label></div>  <div><select id="choose_template_form" onchange="ZP_Mailmerge.resetDocumentName(\'false\')" ><option>'+ZPI18N.getString("zp.select")+'</option><option data-separator="Boolean"> </option></ata-separator="Boolean"> </option></select> </div>  </div>',addHtml+='<iframe id="download_iframe" style="display:none;"></iframe>',addHtml+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.selectformat")+"</label></div><div>",addHtml+='<div class="zradiobutton zradiobutton--horizontal"><input type="radio" name="selectformat" checked=""  class="zradiobutton__helper" id="select_pdf"><label class="zradiobutton__label" onclick=ZP_Mailmerge.mmTempViewType(""+"1"+"") ><span class="zradiobutton__text">'+ZPI18N.getString("zp.pdf")+"</span></label></div>",addHtml+='<div class="zradiobutton zradiobutton--horizontal"><input type="radio" name="selectformat" class="zradiobutton__helper" id="select_doc" ><label class="zradiobutton__label" onclick=ZP_Mailmerge.mmTempViewType(""+"2"+"") ><span class="zradiobutton__text">'+ZPI18N.getString("zp.docx")+"</span></label></div></div></div>",addHtml+='<div class="zpl_secn" id="mmdocument_namediv"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.zs.documentname")+"</label></div>",addHtml+='<div class="ztextbox--group zh-alignright zpl_inpticfild">',addHtml+=' <i class="ztextbox__icon PI_addlist" style="width:50px; justify-content:center;" id="mm_pop" onclick="ZP_Mailmerge.initiateTabPanel(\'mm_tabpanel\', \'mm_pop\')"></i>',addHtml+='<input type="text" id="mmdocument_name" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade()">',addHtml+='<div id="mm_tabpanel"></div> </div></div>',addHtml+='<div id="mmdocumentNameList"></div></div></div></div></div>'}else $("#downSlider_cnt").addClass("zpl_mopen");return ZP_Mailmerge.templateAddHR=!0,addHtml},constructMMdownloadSlider:function(){settingsPage.container;var tab=new Tab;tab.id="mmDownload_slider",tab.cardId="mmDownload_cards",ZP_Mailmerge.downSlider=new sliderModal("zp.Download",tab);var headerContent="<div><h4>"+ZPI18N.getString("zp.Download")+'</h4></div><a id="sliderCls" onclick="ZP_Mailmerge.closeSlider()" class="_cls PI_cls"></a>',footerContent='<div class="zlabel zlabel--blue zlabel--medium" id="zpl_btnloading"  data-action-in-progress="true" onclick="ZP_Mailmerge.mergeAndDownload()">'+ZPI18N.getString("zp.Download")+'</div><button id="sliderCancel" onclick="ZP_Mailmerge.closeSlider()" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.cancel")+"</button>";$("#mmDownload_slider").length>0&&(ZPeopleComponents.isComponent("#choose_template_form")&&ZPeopleComponents.select($("#choose_template_form")).destroy(),$("#mmDownload_slider").remove()),ZP_Mailmerge.downSlider.isAppendToBody=!0,ZP_Mailmerge.downSlider.construct(headerContent,footerContent),$("#"+tab.cardId).append(ZP_Mailmerge.downloadSlider()),ZP_Mailmerge.getLicenseDetails(ZP_Mailmerge.constMMdldSlidCreditBann)},constMMdldSlidCreditBann:function(){$("#mmBannDown").before(ZP_Mailmerge.creditsHtml($("#downSlider_cnt")))},constMMdldPopCreditBann:function(){$("#mmBannPosition").before(ZP_Mailmerge.creditsHtml($("#selectTemp")))},constructMMdownloadPopup:function(){settingsPage.container;var content='\t<div class="zpl_crd" id="selectTemp">\n\t\t\t\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t\t\t<div class="zpl_secn">';content+='<div id = "mmBannPosition">\n\t\t\t\t\t\t\t<label>'+ZPI18N.getString("zp.selecttemplate")+'</label>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<select id="choose_template"><option>'+ZPI18N.getString("zp.select")+'</option><option data-separator="Boolean"> </option></ata-separator="Boolean"> </option></select>    \n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n            </div>',ZP_Mailmerge.getLicenseDetails(ZP_Mailmerge.constMMdldPopCreditBann),ZP_Mailmerge.mmTempopupModal("centerPopup",ZPI18N.getString("zp.mailmerge"),content,ZP_Mailmerge.mergeTemplate)},constructRecList:function(thisObject){var selectedRecords,pageId=settingsPage.container,recordId="";ZP_Mailmerge.isEmpty(thisObject)?(selectedRecords=-1!==settingsUrlProps.url.indexOf("leavetracker")&&-1!==settingsUrlProps.url.indexOf("applications")&&ZP5Views.isSystemView()?pageId.find("tbody").find("input[type='checkbox']:checked"):-1!==settingsUrlProps.url.indexOf("performance/appraisal/userlisting")?pageId.find("tbody#appraisalemps").find("input[type='checkbox']:checked"):$("tbody#recordContainer").find("input[type='checkbox']:checked"),$.each(selectedRecords,function(index,elm){0!==index&&index<selectedRecords.length&&(recordId+=","),-1!==settingsUrlProps.url.indexOf("leavetracker")&&-1!==settingsUrlProps.url.indexOf("applications")&&ZP5Views.isSystemView()?recordId+=$(elm).closest("tr").data("id"):-1!==settingsUrlProps.url.indexOf("performance/appraisal/userlisting")?recordId+=$(elm).closest("tr").attr("pa_id"):recordId+=$(elm).closest("tr").attr("id")})):recordId=$(thisObject).closest("tr").attr("id");return recordId},mergeTemplate:function(thisObj){var pageId=settingsPage.container,recordId="";if(-1===settingsUrlProps.url.indexOf("recordId:")?ZP_Mailmerge.isEmpty(pageId.find("div#merge_template_modal").data("recordid"))?recordId=settingsUrlProps.niceUrl.indexOf("operations/performance/employeesalary")>-1&&ZP5Views.isSystemView()?EmployeeSalary.ConstructRecList():settingsUrlProps.niceUrl.indexOf("operations/performance/cycle")>-1?PMSCycleManageData.ConstructRecList():ZP_Mailmerge.constructRecList():(recordId=pageId.find("div#merge_template_modal").data("recordid"),pageId.find("div#merge_template_modal").data({recordid:""})):recordId=settingsUrlProps.urlParamsArr.recordId,-1!==settingsUrlProps.url.indexOf("performance/appraisal/userlisting"))var formID=AppraisalView.pa_formId;else if(-1!==settingsUrlProps.url.indexOf("operations/performance/cycle"))formID=PMSOperation.performanceappFormDtl.formId;else formID=ZP_Mailmerge.isEmpty(Layout.Page.urlparam.formId)?ZP5Views.CURR_VIEWPARAMS.formId:Layout.Page.urlparam.formId;ZPeople.Request.send("/zpmailmerge/mergeMailTemplate",{action:"mergeMailTemplate",recList:recordId,templateId:pageId.find("select#choose_template").val(),formId:formID,type:"form"},ZP_Mailmerge.mergeTemplateCallBack,"",ZP_Mailmerge.failedCallBack)},mergeTemplateCallBack:function(data){ZP_Mailmerge.closePopup();var writerURL=data[1].url.replace("/docs/","/writer/");window.open(writerURL)},selUnSelRecords:function(isToggleHeader,Obj,type,recId){isSelect&&ZPView.VIEW_CONTAINER.find("div[id^=recordActions]").each(function(){$(this).find("#zp_sel_checkbox").length>0&&($(this).attr("recordid"),$(this).find("#zp_sel_checkbox")[0].checked=!0)})},editSingleTemplate:function(thisObj,templateID,fromAct){var formid;if(ZP_Mailmerge.previewData=!0,window.location.href="#admin/formslayout/templates/mmtemplatelist/edit-templateId:"+templateID,Layout.Page.container.find("#dvTempalateName").is(":visible")?(resourceId=Layout.Page.container.find(thisObj).attr("rid"),formid=Layout.Page.container.find(thisObj).attr("formid"),orgTid=Layout.Page.container.find(thisObj).attr("template_id"),tempName=Layout.Page.container.find(thisObj).text()):(resourceId=Layout.Page.container.find(thisObj).parent().parent().parent().attr("rid"),formid=Layout.Page.container.find(thisObj).parent().parent().parent().attr("formid"),orgTid=Layout.Page.container.find(thisObj).parent().parent().parent().attr("template_id"),tempName=Layout.Page.container.find(thisObj).text()),fromAct){var params={action:"getMailMergeTemplates",startInd:"1",limit:"200",templateId:templateID,conreqcsr:csrfToken};void 0!=formid&&(params.formId=formid),$.ajax({url:"/zpmailmerge/getMailMergeTemplates",type:"POST",data:params,success:function(data){ZP_Mailmerge.singleTemplateCallback(data),resourceId=ZP_Mailmerge.previewrid,formid=ZP_Mailmerge.previewformId,orgTid=ZP_Mailmerge.previewtid,tempName=ZP_Mailmerge.previewfname},failure:function(data){ZP_Mailmerge.failedCallBack(data)}})}else ZP_Mailmerge.previewfname=tempName,ZP_Mailmerge.previewformId=formid,ZP_Mailmerge.previewrid=resourceId,ZP_Mailmerge.previewtid=orgTid;ZP_Mailmerge.fromAct=!!fromAct},validation:function(fileName){var err=!1;return ZP_Mailmerge.isEmpty(fileName)?(err=!0,0===$("#errormsg").length&&(settingsPage.container.find("#edit_fileName").addClass("ztextbox__error"),settingsPage.container.find("#edit_fileName").after('<span id="errormsg" class="ztextbox--error__label">'+ZPI18N.getString("zp.template.namecantempty")+"</span>"))):settingsPage.container.find("span#errormsg").remove(),-1==fileName.indexOf("<")&&-1==fileName.indexOf(">")&&-1==fileName.indexOf("&lt;")&&-1==fileName.indexOf("&gt;")||(ZPeople.Message.failure(ZPI18N.getString("zp.files.operations.avoidchar",new Array(ZPI18N.getString("zp.templatename"),"> <"))),err=!0),fileName.length>ZP_Mailmerge.LIMIT.NAME&&(err=!0,0===$("#edit_maxTempname").length&&(settingsPage.container.find("#edit_fileName").addClass("ztextbox__error"),settingsPage.container.find("#edit_fileName").after('<span id="edit_maxTempname" class="ztextbox--error__label">'+ZPI18N.getString("zp.maxmmtempname")+"</span>"))),err},mmcreditInfo:function(writerurl,isAdmin){if(ZAlertBanner.hide("#downloadmmWar"),isAdmin){var alertPopUp=new DeleteAlertMessage;alertPopUp.title=ZPI18N.getString("zp.mmlimitreachedhead"),alertPopUp.despcription=ZPI18N.getString("zp.mmlimiterrormessageadmin",[writerurl]),alertPopUp.cancelButtonText=ZPI18N.getString("zp.close"),alertPopUp.show(),settingsPage.container.find("#yesBtn").remove()}else ZPeople.Message.failure(ZPI18N.getString("zp.mmlimiterrormessage"))},validateAttach:function(fileName,parentDiv,element,errMessParam,masterdivid){var err=!1,masterdiv=settingsPage.container;return void 0!=masterdivid&&(masterdiv=$(masterdivid)),ZP_Mailmerge.isEmpty(fileName)?(err=!0,0===masterdiv.find(parentDiv).find("#errormsg").length&&(masterdiv.find(element).addClass("ztextbox__error"),masterdiv.find(element).parent().after('<span id="errormsg" class="ztextbox--error__label">'+ZPI18N.getString("zp.cannotbeempty",[ZPI18N.getString(errMessParam)])+"</span>"))):(masterdiv.find(element).removeClass("ztextbox__error"),masterdiv.find(parentDiv).find("#errormsg").remove()),-1==fileName.indexOf("<")&&-1==fileName.indexOf(">")&&-1==fileName.indexOf("&lt;")&&-1==fileName.indexOf("&gt;")||(ZPeople.Message.failure(ZPI18N.getString("zp.files.operations.avoidchar",new Array(ZPI18N.getString(errMessParam),"> <"))),err=!0),fileName.length>ZP_Mailmerge.LIMIT.NAME&&(err=!0,0===masterdiv.find(parentDiv).find("#errormsg").length&&(masterdiv.find(element).addClass("ztextbox__error"),masterdiv.find(element).parent().after('<span id="errormsg" class="ztextbox--error__label">'+ZPI18N.getString("zp.survey.error.maxlimit",[ZPI18N.getString(errMessParam),ZP_Mailmerge.LIMIT.NAME])+"</span>"))),err},showdocDropdown:function(){var dropdown=document.getElementById("mmdocumentNameList");"none"==$("#mmdocumentNameList").css("display")?(ZPeopleComponents.dropdownlist(dropdown).open({forElement:"#mmdocumentNameListDP"}),$(dropdown).find("ul li").length<3&&$(dropdown).find("ul").attr("style","height:fit-content")):ZPeopleComponents.dropdownlist(dropdown).close()},formIdCheck:function(mode,formId){return"form"===mode&&ZP_Mailmerge.isEmpty(formId)&&(formId=ZP5Form.getCurrFormsOperation().formId,Layout.Page.hash.indexOf("leavetracker/views/applications")>-1&&(formId=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid),Layout.Page.hash.indexOf("performance/appraisal/userlisting")>-1&&(formId=AppraisalView.pa_formId),Layout.Page.hash.indexOf("#operations/performance/cycle")>-1&&(formId=PMSOperation.performanceappFormDtl.formId),ZP_Mailmerge.isEmpty(formId)&&(formId=ZP5Views.CURR_VIEWPARAMS.formId),ZP_Mailmerge.isEmpty(formId)&&(formId=pageId.find("div[id^=zp_view_record_]").attr("id").split("record_")[1])),formId},getMMTMergeFields:function(templateId,rid){var param={action:"getMMTMergeFields",conreqcsr:csrfToken};void 0!=rid&&""!=rid&&(param.rid=rid),void 0!=templateId&&""!=templateId&&(param.templateId=templateId),$.ajax({url:"/zpmailmerge/getMMTMergeFields",type:"POST",data:param,success:function(resultData){return resultData}})},getLicenseDetails:function(successCallback,failureCallback,isFromPromise){$.ajax({url:"/zpmailmerge/getLicenseDetails",type:"GET",data:{action:"getLicenseDetails"},success:function(resultData){if(_.isEmpty(resultData))failureCallback();else{var data=resultData.licenseObj.licenseInfo;ZP_Mailmerge.creditUpgradeURL=data.payment_link,ZP_Mailmerge.availablePoints=data.credit_points.available_points,ZP_Mailmerge.paymentAdminZuids=data.payment_admin_zuids,isFromPromise?successCallback(resultData):$.each(ZP_Mailmerge.paymentAdminZuids,function(_index,adminZuid){parseInt(_LOGGEDIN_ZUID)!=parseInt(adminZuid)||successCallback(resultData)})}},failure:function(){failureCallback()}})},getLicenseDetailsAsPromise:function(){return new Promise((resolve,reject)=>{ZP_Mailmerge.getLicenseDetails(resolve,reject,!0)})},creditsHtml:function(parentDiv){void 0!=parentDiv&&parentDiv.find("#mailmergeInfo").length>0&&parentDiv.find("#mailmergeInfo").remove();var html='<div class="zpl_info" id="mailmergeInfo">\n            <div>\n              <h6>'+ZPI18N.getString("zp.mmlimits")+'</h6>\n                <p class=""><span>You have <b class="org">'+ZP_Mailmerge.availablePoints+"</b> credit point(s) remaining in your monthly limit. ";return html+="<a href='"+ZP_Mailmerge.creditUpgradeURL+"' target='_blank'>Manage credit points</a>",html+="</span></p></div></div>"},creditsHtmlForRLG:function(){return ZP_Mailmerge.availablePoints?`<div class="zpl_info zpl_mt3 zpl_mb0">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h6>${ZPI18N.getString("zp.mmlimits")}</h6>\n\t\t\t\t\t\t<p><span>You have <b class="org">${ZP_Mailmerge.availablePoints}</b> credit point(s) remaining in your monthly limit.\n\t\t\t\t\t\t\t${isadmin?`<a href="${ZP_Mailmerge.creditUpgradeURL}" target="_blank">Manage credit points</a>`:""}\n\t\t\t\t\t\t</span></p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`:""},failedCallBack:function(error){var responseJson=error.responseJSON[1];void 0!=responseJson.msg?ZPeople.Message.failure(responseJson.msg):ZPeople.Message.failure(error.statusText)},initiateTabPanel:function(id,forEleId){if(ZPeopleComponents.isComponent("#mm_tabpanel")&&ZPeopleComponents.tabbedlistboxpopup("#mm_tabpanel").destroy(),ZPeopleComponents.isComponent("#"+id))ZPeopleComponents.tabbedlistboxpopup("#"+id).open();else{var tabPanelProps={id:id,forEleId:forEleId,select:ZP_Mailmerge.appendFormFieldToSubject};ZPA_Util.TabPanel.loadFormFieldTabPanel(ZP_Mailmerge.FORMFIELD_DTLS,tabPanelProps),ZPeopleComponents.tabbedlistboxpopup("#"+id).open()}},getTabPanelData:function(formId){var mailTempMode=ZP_Automation_Mode.MAILMERGE;if($.isEmptyObject(ZP_Mailmerge.FORMFIELD_DTLS)||void 0==ZP_Mailmerge.fieldsFormId||ZP_Mailmerge.fieldsFormId!=formId){var params={formId:formId,method:"getFormFields",mode:mailTempMode,conreqcsr:csrfToken};$.ajax({url:"/getFormFields.zp",type:"POST",data:params,success:function(data){ZP_Mailmerge.FORMFIELD_DTLS=data,ZP_Mailmerge.fieldsFormId=formId}})}},appendFormFieldToSubject:function(event){var subject=$("#mmdocument_name").val(),formFieldVal=event.detail.itemData.label;$("#mmdocument_name").val(subject+"${"+formFieldVal+"}")},getDefaultFormId:function(formList){var formId="0",formDtl=formList[0];return formDtl.hasOwnProperty("id")&&(formId=formDtl.id),formId},isEmpty:function(val){return void 0===val||null===val||val.length<=0}};Compensation.LetterTemplatesUtil={TYPES:{OFFER_LETTER:"olt",REVISION_LETTER:"rlt",APPOINTMENT_LETTER:"alt"},TYPE_VS_CLASS_OBJ:{},getClassObj:function(type=this.typeFromHash()){if(!this.TYPE_VS_CLASS_OBJ[type])switch(type){case this.TYPES.REVISION_LETTER:this.TYPE_VS_CLASS_OBJ[type]=new RevisionLetterTemplates(type);break;case this.TYPES.OFFER_LETTER:this.TYPE_VS_CLASS_OBJ[type]=new OfferLetterTemplates(type);break;case this.TYPES.APPOINTMENT_LETTER:this.TYPE_VS_CLASS_OBJ[type]=new AppointmentLetterTemplates(type)}return this.TYPE_VS_CLASS_OBJ[type]},typeFromHash:function(hash=window.location.hash){switch(hash){case"#settings/service/salarydetails/rltemplates":return this.TYPES.REVISION_LETTER;case"#operations/onboarding/offerletter/listview":return this.TYPES.OFFER_LETTER}if(hash.includes("#operations/onboarding/appointmentletter/")||hash.includes("#settings/service/onboarding/appointmentletter/"))return this.TYPES.APPOINTMENT_LETTER},isCompLetterPage:function(hash=window.location.hash){return!!this.typeFromHash(hash)},getFormId:function(type=this.typeFromHash()){return this.getClassObj(type).getFormId()},getAddBtnTxt:function(type=this.typeFromHash()){return this.getClassObj(type).getAddBtnTxt()},getImportBtnTxt:function(type=this.typeFromHash()){return this.getClassObj(type).getImportBtnTxt()},getEmptyPageTitle:function(type=this.typeFromHash()){return this.getClassObj(type).getEmptyPageTitle()},getEmptyPageDesc:function(type=this.typeFromHash()){return this.getClassObj(type).getEmptyPageDesc()}};class CompLetterTemplates{constructor(type){if(new.target===CompLetterTemplates)throw new Error("CompLetterTemplates is an abstract class and hence cannot be instantiated!");this.type=type,this.DATA=void 0,this.isRefreshNeeded=!1}async initCallback(){await this.getMetaDataPromise(),ZP_Mailmerge.init()}callback(){this.DATA&&this.setRefreshNeeded(!0),ZP_Mailmerge.setCurrFormId(this.getFormId())}hashChangeCallback(){ZP_Mailmerge.setCurrFormId()}async list(service){if(await this.getMetaDataPromise(),!this.DATA||this.isRefreshNeeded){const params={action:"getMailMergeTemplateListByService",service:service,formId:this.getFormId(),startInd:1,limit:200},[response]=await Compensation.Utils.sendRequestAsPromise("/zpmailmerge/getMailMergeTemplateListByService",params);this.DATA=response.templates,this.setRefreshNeeded(!1)}return Promise.resolve(this.DATA)}setRefreshNeeded(isRefreshNeeded){this.isRefreshNeeded=isRefreshNeeded}async getMetaDataPromise(){}getFormId(){}getAddBtnTxt(){}getImportBtnTxt(){}getEmptyPageTitle(){}getEmptyPageDesc(){}}class RevisionLetterTemplates extends CompLetterTemplates{async getMetaDataPromise(){return Compensation.Config.getConfiguration()}getFormId(){return Compensation.Config.configObj.revFormId}getAddBtnTxt(){return ZPI18N.getString("zp.comp.rlt.addtemplate")}getImportBtnTxt(){return ZPI18N.getString("zp.comp.rlt.imptemplate")}getEmptyPageTitle(){return ZPI18N.getString("zp.comp.rlt.notmpl")}getEmptyPageDesc(){return" "}}class OfferLetterTemplates extends CompLetterTemplates{async getMetaDataPromise(){OfferLetter.Operations.getFormDetails()}getFormId(){return OfferLetter.Operations.formDetails.formId}}class AppointmentLetterTemplates extends CompLetterTemplates{async getMetaDataPromise(){}getFormId(){return ZP5ServicesCommon.getDefaultFormAndViewId("Onboarding","appointmentletter").formId}getAddBtnTxt(){return ZPI18N.getString("zp.template.add")}getImportBtnTxt(){return ZPI18N.getString("zp.importmm")}getEmptyPageTitle(){return ZPI18N.getString("zp.appt.noApptTemplate")}getEmptyPageDesc(){return" "}}