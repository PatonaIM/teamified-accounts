ApprovalList={APPROVE_RECIDS:new Array,TOTAL_RECS:Number(0),APPROVAL_FORMLIST:[],viewApprTimeline:!1,getActiveTabName:function(){let mode="";return-1!=Layout.Page.currentmode.indexOf("operations/approvals/allapproval")?mode="allapproval":-1!=Layout.Page.currentmode.indexOf("operations/approvals/myrequest")?mode="myrequest":-1!=Layout.Page.currentmode.indexOf("myspace")?mode="myspace":Layout.Page.currentmode.includes("home/team/approvals")&&(mode="team"),mode},getHeaderHtml:function(activeTab){return'<div class="zpl_btnmnu"><div class="zpl_rgt"><i class="zpl_ibg PI_fltr" id=approvalsFilter title="'+ZPI18N.getString("zp.filter")+'" onclick="ApprovalList.Filter.showHideFilter(\''+activeTab+'\')" aria-label="Filter" role="button" aria-haspopup="dialog" tabindex="0"></i></div></div><div class="zpl_fltrvw zpl_DNI" id="filterResultsHeader"><div id="filterResults"><ul class="zpl_fltrvwlst" role="tablist"></ul></div><div class="d-flexcap MLauto zpl_DNI"><a id="resetFilter" onclick="ApprovalList.Filter.resetFilterResult()" role="button" tabindex="0" aria-label="'+ZPI18N.getString("zp.reset")+'">'+ZPI18N.getString("zp.reset")+'</a></div></div><div class="zpl_rgtcnt" tabindex="0"><div id="'+activeTab+'_page_content" class="zpl_msplst"></div></div>'},getTableHtml:function(activeTab){return'<div class="zpl_tblres"><table class="zpl_tbl"><thead id="'+activeTab+'_thead"><tr>'+("allapproval"==activeTab||"team"==activeTab?'<th class="" width="3%"><div class="zcheckbox"><input id="zp_allapproval_check" class="" onclick="ApprovalList.selectUnselectCheck(this, \'all\')" type="checkbox"><span></span></div></th>':"")+'<th class="" width="65%">'+ZPI18N.getString("zp.message")+'</th><th class="" width="16%">'+ZPI18N.getString("zp.requestedon")+'</th><th class="" width="16%">'+ZPI18N.getString("zp.status")+'</th></tr></thead><tbody id="'+activeTab+'_tbody"></tbody></table></div>'},initApprovalPage:function(){var pageId=Layout.Page.container;pageId.addClass("zpl_tblfxd"),pageId.attr("scroll","enabled"),pageId.append(ApprovalList.getHeaderHtml(ApprovalList.getActiveTabName()))},approvalFireScrollAction:function(){var fireScrollProp=ZPeople.FireScroll.getFireScrollPropertie(),params=fireScrollProp.curParams;fireScrollProp.isFromWidget?(params.src="widget",params.sIndex=Layout.Page.container.find("#PENDING_APPROVALS").children("li").length+1):params.sIndex=fireScrollProp.count+1,ZPeople.Request.send("/approvalAction.zp",params,fireScrollProp.isFromWidget?ZPDashboard.Widget.constructApprDashBoardRow:ApprovalList.approvalFireScrollCallback)},approvalFireScrollCallback:function(resultData,params){if(7e3===resultData.code){ApprovalList.constructApprovalDataRow(resultData,params);var rowCount=resultData.message.length;21===rowCount&&(ZPeople.FireScroll.reset(),rowCount-=1),ZPeople.FireScroll.increaseRecordCount(rowCount)}},setFireScollCount:function(result,params,isFromWidget){var rowCount=result.message.length;21==rowCount&&(ZPeople.FireScroll.reset(),rowCount-=1),ZPeople.FireScroll.setRecordCount(rowCount),ZPeople.FireScroll.setParam("curParams",params),ZPeople.FireScroll.setParam("isFromWidget",isFromWidget)},viewRequestedForm:function(obj,viewApprTimeline){let $obj=$(obj).closest("[name=approval_card]"),formId=$obj.attr("formId"),recordId=$obj.attr("id"),tableName=$obj.attr("tableName");ApprovalList.viewApprTimeline=viewApprTimeline,ApprovalList.setReqFormUrl(formId,recordId,tableName)},addClickEvent:function(apprRecDiv){"myspace"==this.getActiveTabName()?($(apprRecDiv).find(".zpl_msp-dts").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault();let transferId=this.parentElement.getAttribute("id");if("true"===this.parentElement.getAttribute("isPhotoTransfer"))ProfilePictureTransfer.photoTransferModel(transferId);else{let $this=$(this).closest("[name=approval_card]");ApprovalList.loadApprovalRecord($this.attr("formId"),$this.attr("id"),$this.attr("tableName"))}}),$(apprRecDiv).find("#zp_approval_approvereject button").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),ApprovalList.MySpace.showPopup(this,!1)})):($(apprRecDiv).find(".zpl_msp-dts").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault();let transferId=this.parentElement.getAttribute("id");"true"===this.parentElement.getAttribute("isPhotoTransfer")?ProfilePictureTransfer.photoTransferModel(transferId):ApprovalList.viewRequestedForm(this)}),$(apprRecDiv).find("[id=zp_approval_approvereject]").off("click").on("click",function(e){let obj=$(this).closest("[name=approval_card]"),transferId=obj.attr("id");"true"===obj.attr("isPhotoTransfer")?ZPeople.Request.sendRequest("/v5/profilepicture/approvalStatusDetails",{recordId:transferId},"GET",ProfilePictureTransfer.getApprovalDetails,{},FrameworkCommon.failureCallback):(e.stopPropagation(),e.preventDefault(),ApprovalList.viewRequestedForm(this,!0))}))},approvalAction:function(){void 0==Layout.Page.urlparam.formId&&void 0==Layout.Page.urlparam.formLinkName||void 0==Layout.Page.urlparam.recordId?ApprovalList.getApprovalOrRequestList():void 0!=settingsUrlProps.urlParamsArr.formLinkName?ApprovalList.viewApprovalPopup(settingsUrlProps.urlParamsArr.formLinkName,settingsUrlProps.urlParamsArr.recordId,!0):ApprovalList.viewApprovalPopup(settingsUrlProps.urlParamsArr.formId,settingsUrlProps.urlParamsArr.recordId,!1)},getApprovalsCallback:function(result,params,pageId){if(0===ApprovalList.APPROVAL_FORMLIST.length&&"myspace"!=ApprovalList.getActiveTabName()){pageId.find("zpl_iwrpr").attr("tabindex","0"),pageId.find("zpl_iwrpr").attr("aria-label",ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.approvals")]));var formList=[];formList.push({id:"-1",value:ZPI18N.getString("zp.allforms"),isDefaultValue:!0}),$.each(result.formList,function(index,data){formList.push({id:data.formId,value:decodeHTML(data.dispName)})}),ApprovalList.APPROVAL_FORMLIST=formList}var activeTab=ApprovalList.getActiveTabName();if("myspace"==activeTab?pageId.siblings("#zp_page_loading").remove():pageId.closest(".zpl_act").find("#zp_page_loading").remove(),7024===result.code){var emptyPageObj=new EmptyPages("zp_nd_approval","myspace"==activeTab?ZPI18N.getString("zp.noapprovalreq"):ZPI18N.getString("zp.noallapprovalreq"),"",pageId);Layout.Page.container.find(".zpl_rgtcnt").attr("aria-label","myspace"==activeTab?ZPI18N.getString("zp.noapprovalreq"):ZPI18N.getString("zp.noallapprovalreq")),emptyPageObj.show(),ZPeople.FireScroll.setRecordCount(0),ZPeople.FireScroll.setParam("curParams",params)}else 7e3===result.code&&(Layout.Page.container.find("#myspace_page_content").empty(),pageId.append(this.getApprovalHeaderHtml()),Layout.Page.container.find(".zpl_rgtcnt").attr("aria-label",ZPI18N.getString("zp.proceedtoappr")),this.constructApprovalDataRow(result,params,pageId),ApprovalList.setFireScollCount(result,params,!1))},getApprovalOrRequestList:function(callBackData){let activeTab=ApprovalList.getActiveTabName(),pageId=Layout.Page.container;0==pageId.find("#"+activeTab+"_page_content").length&&pageId.append('<div id="'+activeTab+'_page_content" class="zpl_msplst"></div>'),pageId=pageId.find("#"+activeTab+"_page_content");var params={};Layout.Page.container.find("#myspace_page_content").empty();var loadingContainer="myspace"==activeTab?pageId.parent():pageId.parents(":eq(1)");0===Layout.Page.container.find("#zp_page_loading").length&&loadingContainer.append(ZPeople.LOADING_HTML),params.action="myApprovals";var approverFilterValue=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_appr_fltr");void 0!=approverFilterValue&&""!=approverFilterValue&&-1!=approverFilterValue&&(params.empErecNo=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_appr_fltr"));var myApprovalsRecordOwner=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_recownr_fltr");myApprovalsRecordOwner&&"0"!=myApprovalsRecordOwner?params.myApprRecOwner=myApprovalsRecordOwner:params.empStatus=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_empstatus_fltr"),params.mode="viewApprovals",params.approvalForm=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_forms_fltr"),params.approvalStatus=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_status_fltr"),ApprovalList.Filter.showFilterResult(params),ZPeople.Request.send("/approvalAction.zp",params,function(result){ApprovalList.getApprovalsCallback(result,params,pageId),Layout.Page.container.find("#zp_page_loading").remove(),callBackData&&(callBackData.error||callBackData.errorMsg)&&ApprovalList.constructErrorMsgInfo(callBackData,void 0,!0)}),-1!==Layout.Page.hash.indexOf("home/myspace/overview-approval")&&ApprovalHome.getPendingCount()},viewApprovalPopup:function(formId,recordId,isFormLinkName,mode){mode=void 0!=mode?mode:settingsUrlProps.urlParamsArr.mode,isFormLinkName&&(formId=ZPUtil.Form_Link_Names.getFormLinkName(formId,!1)),void 0!=mode&&"Timesheet"===mode?Layout.PageUtil.loadFiles(["timely.1.min.js"],()=>Timetracker.timesheet.getTimesheetDetails(formId,recordId,!0,ApprovalList.closePopCallback)):void 0!=mode&&"TimesheetBudget"===mode?Timetracker.Budget.getTimeLogsOfBudget(recordId,ApprovalList.closePopCallback):void 0!=mode&&"Attendance"===mode?Layout.PageUtil.loadFiles(["regularization.min.js","timely.1.min.js"],()=>{regularization_operation.getAttendanceRegDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"AttendancePermissions"===mode?Layout.PageUtil.loadFiles(["permission.min.js","timely.1.min.js"],()=>{permission.getPermissionApprovalDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"Shift"===mode?Layout.PageUtil.loadFiles(["shiftRequest.min.js","empShiftMapping.min.js","timely.1.min.js"],()=>{shiftRequest.getAttendanceShiftDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"AutoAssignShift"===mode?Layout.PageUtil.loadFiles(["autoassignshiftRequest.min.js","empShiftMapping.min.js","timely.1.min.js"],()=>{AutoAssignShiftRequest.getAttendanceShiftDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"AttendanceOD"===mode?Layout.PageUtil.loadFiles(["onduty.min.js","timely.1.min.js"],()=>{onduty.getAttendanceODDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"Goal"===mode?Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>Goals.Approval.initGoalSheetApproval(recordId,ApprovalList.closePopCallback)):void 0!=mode&&"Review"===mode?Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>ApprReview.Approval.constructReviewApprovalSheet(recordId,ApprovalList.closePopCallback)):void 0!=mode&&"Rater"===mode?Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>MR.Approval.showApprovalEntriesModal("approval",recordId,ApprovalList.closePopCallback)):void 0!=mode&&"objective"===mode?Layout.PageUtil.loadFiles(["okr.com.min.js"],()=>OKRApproval.openObjectiveApproval(recordId)):void 0!=mode&&"keyResultCheckIn"===mode?Layout.PageUtil.loadFiles(["okr.com.min.js"],()=>OKRApproval.openCheckInApproval(recordId)):void 0!=mode&&"ObjectiveAlign"===mode?Layout.PageUtil.loadFiles(["okr.com.min.js"],()=>OKRApproval.openObjectiveAlignApproval(recordId)):void 0!=mode&&"Compensatory"===mode?LeaveCompensatory.RecordView.get(recordId):mode&&"LeaveGrant"===mode?LeaveGrant.RecordView.get(recordId):void 0!=mode&&"Reviewsheet"===mode?Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>BudgetReviewSheet.showReviewSheetApprovalPage("approval",recordId,ApprovalList.closePopCallback)):void 0!=mode&&mode===Compensation.CONSTANTS.SALARY_REVISION_PC_NAME?Layout.PageUtil.loadFiles(["compensation.common.min.js"],()=>{Compensation.SalRevision.Operations.showSalRevisionRecord(recordId,formId,ApprovalList.closePopCallback)}):void 0!=mode&&"TransferV2"===mode?Layout.PageUtil.loadFiles(["transfer.configuration.min.js"],()=>ZP5Views.transferV2SingleRecordCallBack(recordId)):void 0!=mode&&"Offboarding"===mode?Layout.PageUtil.loadFiles(["offboarding_common.min.js","offboarding_operations.min.js","offboarding_feedback.min.js"],()=>{Offboarding.View.loadApprovalRecord(recordId)}):OPApprovals.Forms.loadRecordByMode(formId,recordId,"VIEW",mode)},showBulkForwardButton:function(){return"allapproval"===this.getActiveTabName()||"team"===this.getActiveTabName()},isCheckBoxNeedToDisable:function(tableName,isCheckboxDisabled){return isCheckboxDisabled||["P_Resignation"].includes(tableName)},getApprovalHeaderHtml:function(){return'<div id="zp_approval_header" class="zpl_msp-hgroup zpl_DNI"><div class="zpl_btnmnu zpl_mspbtnmnu"><div>'+this.getCheckboxHtml("all")+'<button class="zlabel zlabel--blue zlabel--outline zlabel--medium DN" approvalType=1 onclick="ApprovalList.MySpace.showPopup(this, true)" data-popup-open="AllApprovalPop">Approve</button><button class="zlabel zlabel--red zlabel--medium zlabel--outline M0I DN" approvalType=0 onclick="ApprovalList.MySpace.showPopup(this, true)">Reject</button>'+(this.showBulkForwardButton()?'<button class="zlabel zlabel--outline zlabel--medium DN" approvalType=2 onclick="ApprovalList.Forward.showPopup(this, true)" data-popup-open="AllApprovalPop">'+ZPI18N.getString("zp.forward")+"</button>":"")+"</div></div></div>"},getCheckboxHtml:function(recId,isCheckboxDisabled){return'<div id="zp_approval_check_div" class="zcheckbox '+(isCheckboxDisabled?"disabled":"")+'" onclick="ApprovalList.selectUnselectCheck(this,\''+recId+'\')" tabindex="0" role="button"><input id="zp_approval_check" type="checkbox" name="check" value="" class="zcheckbox__helper"><label class="zcheckbox__label"></label></div>'},getApprReqDtlHtml:function(empPhotoUrl,empId,recordOwner,formName,reqMsg,recordOwnerZuid){return'<div class="zpl_msp-dts CP"><div><div class="zpl_em"><div class="zpl_emimg" popup="user" empid='+recordOwnerZuid+'><img alt="" src="'+empPhotoUrl+'"></div><div class="zpl_emdts zpl_ellipsis"><div><em>'+ZSEC.Encoder.encodeForHTML(empId)+" - </em><b>"+recordOwner+"</b></div><div><em>"+reqMsg+" </em><b>"+formName+"</b></div></div></div></div></div>"},getRaisedOnHtml:function(requestedOn){return'<div><div class="zpl_compoffar"><em>'+ZPI18N.getString("zp.raisedon")+'</em><div class="d-flexclmcap10"><div><b>'+requestedOn+"</b></div></div></div></div>"},getStatusTypeHtml:function(statusTypeText,btnClass,isNotButton){return'<div id="zp_approval_actiondiv" class="zpl_msp-act"><div id="zp_approval_approvereject" class="'+`${isNotButton?"zpl_compoffar":"zpl_hvr"}`+'">'+(isNotButton?statusTypeText:'<button tabindex="0"  aria-haspopup="dialog" class="zlabel zlabel--blue zlabel--medium zlabel--outline '+btnClass+'">'+statusTypeText+"</button>")+"</div></div>"},constructApprovalDataRow:function(result,params,pageId){let approvalCards="",pendingRecordCount=ApprovalList.TOTAL_RECS,activeTab=ApprovalList.getActiveTabName(),mySpace="myspace"==activeTab,allApproval="allapproval"==activeTab,team="team"==activeTab;pageId=void 0!=pageId?pageId:Layout.Page.container.find("#"+activeTab+"_page_content");var resultDataLength=result.message.length;21==resultDataLength&&(resultDataLength-=1);for(let index=0;index<resultDataLength;index++){let data=result.message[index],recId=data.recordId,approvalAction=data.approvalAction,isPrimaryAppr=data.isPrimaryAppr,recordOwnerName=ZPeople.CURR_USER.usererec===data.recordOwnerErecno?ZPeople.CURR_USER.name:data.recordOwnerName,isCheckboxDisabled=!0,isNotButton=!0,statusTypeHtml="",btnText="",btnClass="",reqMsg="";if(data.approvalStatus===zpconst.ApprovalStatus.Pending||data.approvalStatus===zpconst.ApprovalStatus.CancellationPending)(mySpace||allApproval||team)&&(isPrimaryAppr?(btnText=1==approvalAction?ZPI18N.getString("zp.extenddecline"):ZPI18N.getString("zp.clicktoapprovereject"),btnClass=data.recordImmutable?"disabled":"",isCheckboxDisabled=!1,isNotButton=!1,pendingRecordCount+=1):(isadmin&&(isCheckboxDisabled=!1,pendingRecordCount+=1),btnText=1==approvalAction?'<span class="org">'+ZPI18N.getString("zp.cancellationpending"):ZPI18N.getString("zp.pendingmessage")),statusTypeHtml=mySpace?ApprovalList.MySpace.getApprRejBtnHtml():ApprovalList.getStatusTypeHtml(btnText,btnClass,isNotButton));else if(1===data.approvalStatus||3===data.approvalStatus){let[date,...timeParts]=data.approveRejectTime.split(" "),time=timeParts.join(" "),approvedMsg=`<span class="grn">${ZPI18N.getString("zp.approvedmessage")}</span> <span>${date}, ${time}</span>`;statusTypeHtml=ApprovalList.getStatusTypeHtml(approvedMsg,btnClass,isNotButton)}else if(0===data.approvalStatus){let[date,...timeParts]=data.approveRejectTime.split(" "),time=timeParts.join(" "),rejectedMsg=`<span class="red">${ZPI18N.getString("zp.rejectedmessage")}</span> <span>${date}, ${time}</span>`;statusTypeHtml=ApprovalList.getStatusTypeHtml(rejectedMsg,btnClass,isNotButton)}else data.approvalStatus===zpconst.ApprovalStatus.Cancelled?statusTypeHtml=ApprovalList.getStatusTypeHtml(ZPI18N.getString("zp.approvalmessage",new Array("red",ZPI18N.getString("zp.cancelled"),data.approveRejectTime)),btnClass,isNotButton):data.approvalStatus===zpconst.ApprovalStatus.Revoked&&(statusTypeHtml=ApprovalList.getStatusTypeHtml(ZPI18N.getString("zp.approvalmessage",new Array("blu",ZPI18N.getString("zp.revoked"),data.approveRejectTime)),btnClass,isNotButton));reqMsg=1==data.approvalAction?ZPI18N.getString("zp.hasmadecancelreq"):ZPI18N.getString("zp.hasmadereq"),(mySpace||allApproval||team)&&(checkboxHtml=ApprovalList.getCheckboxHtml(recId,this.isCheckBoxNeedToDisable(data.tableName,isCheckboxDisabled))),data.isPhotoTransfer&&(data.formName=ZPI18N.getString("zp.photochange")),approvalCards+='<div name="approval_card" id="'+recId+'" formId="'+data.formId+'" isPhotoTransfer = '+data.isPhotoTransfer+' formDisplayName="'+data.formName+'" tableName="'+data.tableName+'" status="'+data.approvalStatus+'" recordOwnerErecno="'+data.recordOwnerErecno+'" isPrimaryAppr="'+isPrimaryAppr+'" tabindex="0" role="button" aria-haspopup="dialog" aria-label="'+`${recordOwnerName} ${reqMsg} ${data.formName}. ${ZPI18N.getString("zp.raisedon")} : ${data.requestedOn}`+'">'+checkboxHtml+this.getApprReqDtlHtml(data.employeePhotoUrl,data.recordOwnerEmpId,recordOwnerName,data.formName,reqMsg,data.recordOwnerZUID)+this.getRaisedOnHtml(data.requestedOn)+statusTypeHtml+"</div>"}pageId.append(approvalCards),ApprovalList.addClickEvent(pageId)},selectUnselectCheck:function(Obj,recId){var isSelect=$(Obj).children("#zp_approval_check").prop("checked");if(isSelect?($(Obj).children("#zp_approval_check").prop("checked",!1),isSelect=!1):($(Obj).children("#zp_approval_check").prop("checked",!0),isSelect=!0),"all"===recId)isSelect?Layout.Page.container.find("[name=approval_card]").each(function(){recId=$(this).attr("id"),0===$(this).find("#zp_approval_check").length||$(this).find("#zp_approval_check_div").hasClass("disabled")||($(this).find("#zp_approval_check")[0].checked=!0,isNaN(recId)||ApprovalList.APPROVE_RECIDS.includes(recId)||ApprovalList.APPROVE_RECIDS.push(recId))}):(ApprovalList.APPROVE_RECIDS=new Array,Layout.Page.container.find("[name=approval_card]").find("[id=zp_approval_check]").prop("checked",!1));else if(!isNaN(recId)){if(isSelect)ApprovalList.APPROVE_RECIDS.push(recId);else{var posOfEle=ApprovalList.APPROVE_RECIDS.indexOf(recId);-1!==posOfEle&&ApprovalList.APPROVE_RECIDS.splice(posOfEle,1)}var totalRec=ApprovalList.TOTAL_RECS,selRec=Layout.Page.container.find("[name=approval_card]").find("[type=checkbox]:checked"),headerSel=Layout.Page.container.find("#zp_approval_header").find("#zp_approval_check");totalRec===selRec.length?headerSel[0].checked=!0:headerSel.is(":checked")&&(headerSel[0].checked=!1)}var apprRejHdrBtn=Layout.Page.container.find("#zp_approval_header button");!apprRejHdrBtn.is(":visible")&&ApprovalList.APPROVE_RECIDS.length>0?(apprRejHdrBtn.parents("#zp_approval_header").removeClass("zpl_DNI"),apprRejHdrBtn.fadeIn(200)):apprRejHdrBtn.is(":visible")&&0===ApprovalList.APPROVE_RECIDS.length&&(apprRejHdrBtn.fadeOut(200),apprRejHdrBtn.parents("#zp_approval_header").addClass("zpl_DNI"))},setReqFormUrl:function(formId,recordId,tableName){let mode=ApprovalList.getModeByTableName(tableName),url=Layout.Page.hash.split("-")[0];if(-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&void 0!=Layout.Page.urlparam.userId)url+="-userId:"+Layout.Page.urlparam.userId+"/formId:"+formId+"/recordId:"+recordId;else if("Timesheet"==mode||"TimesheetBudget"===mode||"Attendance"==mode||"AttendanceOD"==mode||"AttendancePermissions"==mode||"Leave"==mode||"Compensatory"==mode||"LeaveGrant"==mode||"Goal"==mode||"Rater"==mode||"Reviewsheet"==mode)url+="-formId:"+formId+"/recordId:"+recordId;else{var formlinkname=OPApprovals.Forms.getFormLinkName(formId,!0),formnameString="-formLinkName:";void 0==formlinkname&&(formnameString="-formId:",formlinkname=formId),url+=formnameString+formlinkname+"/recordId:"+recordId}void 0!==mode&&(url+="/mode:"+mode),window.location.href=url},getModeByTableName:function(tableName){let mode;return"P_TimesheetList"===tableName?mode="Timesheet":"P_TimesheetBudget"===tableName?mode="TimesheetBudget":"P_EmployeeLeave"===tableName?mode="Leave":"P_AttendanceReg"===tableName?mode="Attendance":"P_PermissionDetails"===tableName?mode="AttendancePermissions":"P_ShiftMappingForm"===tableName?mode="Shift":"P_AutoShiftAssignForm"===tableName?mode="AutoAssignShift":"P_AttendanceOD"===tableName?mode="AttendanceOD":"P_Compensatory"===tableName?mode="Compensatory":"P_LeaveGrant"===tableName?mode="LeaveGrant":"P_GoalSheet"===tableName?mode="Goal":"P_ReviewApprovalSheet"===tableName?mode="Review":"P_MultiRater_Approval"===tableName?mode="Rater":"P_Budget_Splitup"===tableName?mode="Reviewsheet":tableName===Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME?mode=Compensation.CONSTANTS.SALARY_REVISION_PC_NAME:"P_EmployeeTransfer"===tableName?mode="TransferV2":"P_Resignation"===tableName?mode="Offboarding":"P_Objectives"===tableName?mode="objective":"P_KeyResult_CheckIn"===tableName?mode="keyResultCheckIn":"P_ObjectiveAlign"===tableName&&(mode="ObjectiveAlign"),mode},loadApprovalRecord:function(formId,recordId,tableName){let mode=ApprovalList.getModeByTableName(tableName);ApprovalList.viewApprovalPopup(formId,recordId,!1,mode)},closePopCallback:function(callBackRecordId,approvalStatus){if("Attendance"===Layout.Page.urlparam.mode||"AttendanceOD"===Layout.Page.urlparam.mode||"AttendancePermissions"===Layout.Page.urlparam.mode||"Goal"==Layout.Page.urlparam.mode||"Rater"==Layout.Page.urlparam.mode||"Review"==Layout.Page.urlparam.mode||"Reviewsheet"==Layout.Page.urlparam.mode||"TimesheetBudget"===Layout.Page.urlparam.mode)"Goal"!=Layout.Page.urlparam.mode&&"Rater"!=Layout.Page.urlparam.mode&&"Review"!=Layout.Page.urlparam.mode&&"Reviewsheet"!=Layout.Page.urlparam.mode||(AppraisalConfig.GOALSHEETAPPROVER=!1),ApprovalList.reloadApprovalContent();else if(0!==Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId).length){var recRow=Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId),formId=Layout.Page.urlparam.formId;if(void 0==formId&&void 0!=Layout.Page.urlparam.formLinkName&&(formId=ZPUtil.Form_Link_Names.getFormLinkName(Layout.Page.urlparam.formLinkName,!1)),void 0!==Layout.Page.urlparam.mode&&"Timesheet"===Layout.Page.urlparam.mode)void 0!==approvalStatus&&""===approvalStatus?ZPApprovals.removeSingleRec(Layout.Page.urlparam.recordId):void 0!==approvalStatus&&"-1"===approvalStatus?ZPApprovals.reloadApprovalContent():void 0!==approvalStatus&&Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId).attr("status")!==approvalStatus&&ZPApprovals.constructApproveOrReject(recRow,approvalStatus,ZPApprovals.TIMESHEET_RECORD_DTL[Layout.Page.urlparam.recordId]);else if(!ZPUtil.Validation.isEmpty(callBackRecordId)&&ZPForm.SINGLE_RECORD_DTL[formId+"_"+callBackRecordId]&&7e3===ZPForm.SINGLE_RECORD_DTL[formId+"_"+callBackRecordId].record.code){var recDetail=ZPForm.SINGLE_RECORD_DTL[formId+"_"+callBackRecordId].record;if(recRow.attr("status")!==recDetail.message.approvalStatus+""||recRow.attr("status")==zpconst.ApprovalStatus.Pending){var apprDetails=recDetail.approvalDetails?recDetail.approvalDetails:ZPApprovals.APPROVAL_DETAILS[callBackRecordId];apprDetails&&ZPApprovals.constructApproveOrReject(recRow,apprDetails.currentApprovalStatus,apprDetails)}}}var url=Layout.Page.hash.split("-")[0];-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&void 0!=Layout.Page.urlparam.userId?url+="-userId:"+Layout.Page.urlparam.userId:"#home/dashboard"==Layout.Page.hash?Layout.Page.container.find("#"+ZPDashboard.Widget.List.PAPP).find("li").off("click").on("click",function(){ZPDashboard.Widget.Actions.loadApprovalRecord($(this).attr("formid"),$(this).attr("recordid"),$(this).attr("tablename")),$(this).off("click")}):"myspace"==ApprovalList.getActiveTabName()&&(url=Layout.Page.hash),ZPApprovals.SUCCESS_PKID=void 0,window.location.hash=url,void 0===ApprovalList.APPROVAL_FORMLIST&&ApprovalList.reloadApprovalContent()},reloadApprovalContent:function(){},constructErrorMsgInfo:function(approvalResult,siblingDiv,isBulkApproval){let pageId=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content");if(approvalResult&&(approvalResult.error||approvalResult.errorMsg)){let errors=approvalResult.error;errors&&"string"!=typeof errors&&errors.forEach(function(singleErr){let errCardId=pageId.find("#"+singleErr.recordId);errCardId.find("#error_info").remove(),errCardId.find("div.zcheckbox").addClass("zpl_DNI"),errCardId.addClass("zpl_mspinfo"),errCardId.prepend('<div id="error_info" class="PI_info red tooltip-js M0I" data-title-display-type="box" data-position="top" title="'+singleErr.errorMsg+'"></div>')}),ZPeople.Message.failure(approvalResult.errorMsg)}},showErrorMsg:function($divToAppend,errorMsg){$('<span class="ztextbox--error__label">'+errorMsg+"</span>").insertAfter($divToAppend),$divToAppend.addClass("ztextbox__error")},removeErrorMsg:function($divToRemove){$divToRemove.find(".ztextbox--error__label").remove(),$divToRemove.find(".ztextbox__error").removeClass("ztextbox__error")},resetApprovalPage:function(){Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content").empty(),ApprovalList.getApprovalOrRequestList(),ApprovalList.APPROVE_RECIDS=[]}},ApprovalList.Filter={getFilterHtml:function(activeTab){return`<div class="zpl_fltr" id="apprLst_fltr_cont" tabindex="0" role="dialog" aria-label="${ZPI18N.getString("zp.filterpopupselected")}">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div class="zpl_fltrhd">\n\t\t\t\t\t\t\t\t\t\t\t<h5>`+ZPI18N.getString("zp.filter")+'</h5>\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="PI_cls" id="fltr_cls" onclick="ApprovalList.Filter.showHideFilter(\''+activeTab+'\')"  title="'+ZPI18N.getString("zp.close")+`" tabindex="0" aria-label="${ZPI18N.getString("zp.close")}"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="zpl_fltrcnt">\n\t\t\t\t\t\t\t\t\t\t<div class="zpl_fltrlst"> \n\t\t\t\t\t\t\t\t\t\t${isadmin?`<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.approver")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.approver")}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_appr_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>`:""}\n\t\t\t\t\t\t\t\t\t\t \t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.recordowner")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>`+ZPI18N.getString("zp.recordowner")+`</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_recownr_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.forms")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>`+ZPI18N.getString("zp.forms")+`</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_forms_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.status")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>`+ZPI18N.getString("zp.status")+`</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_status_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.employeestatus")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>`+ZPI18N.getString("zp.employeestatus")+`</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_empstatus_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<button id="searchFilter" type="button" class="zlabel zlabel--blue zlabel--medium" onclick="ApprovalList.Filter.searchFilterAction('`+activeTab+"')\">"+ZPI18N.getString("zp.apply")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="ApprovalList.Filter.resetFilter(\''+activeTab+"')\">"+ZPI18N.getString("zp.reset")+"</button></div>\n\t\t\t\t\t\t\t\t</div>"},constructFilterElements:function(activeTab){Layout.Page.container.append(ApprovalList.Filter.getFilterHtml(activeTab)),isadmin&&ApprovalList.Filter.loadEmployeeOptionProperties("MYAPPROVALS_APPROVER",activeTab+"_apprLst_appr_fltr"),ApprovalList.Filter.loadEmpStatusOptionProperties(),ApprovalList.Filter.loadEmployeeOptionProperties("MYAPPROVALS_RECORDOWNER",activeTab+"_apprLst_recownr_fltr"),ApprovalList.Filter.loadFormsOptionProperties(),ApprovalList.Filter.loadStatusOptionProperties()},showHideFilter:function(activeTab){var pageId=Layout.Page.container;pageId.find("#apprLst_fltr_cont").length<=0&&ApprovalList.Filter.constructFilterElements(activeTab),pageId.hasClass("zpl_fltr_flt")?(pageId.removeClass("zpl_fltr_flt"),pageId.find("#approvalsFilter").focus()):(pageId.addClass("zpl_fltr_flt"),pageId.find("#apprLst_fltr_cont").focus(),pageId.on("keydown",function(e){"Escape"===e.key&&(ApprovalList.Filter.showHideFilter(activeTab),pageId.off("keydown"))}))},loadFormsOptionProperties:function(){var approvalFormsProp={options:ApprovalList.APPROVAL_FORMLIST,removeExistingDropdown:!0,dataMapping:{label:"value",value:"id",title:"value"},forElement:"apprLst_fltr_cont",select:(event,data)=>{ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_forms_fltr-container").attr("aria-label",data.optionData.value)}};ZPA_Common.ZCompProp.loadSelectListProp(approvalFormsProp),ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_forms_fltr"),approvalFormsProp),ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_forms_fltr-container").attr("aria-label",ZPI18N.getString("zp.allforms"))},loadStatusOptionProperties:function(){var approvalStatusList=[];approvalStatusList.push({id:"all",value:ZPI18N.getString("zp.allstatus")}),approvalStatusList.push({id:"pending",value:ZPI18N.getString("zp.pending"),isDefaultValue:!0}),approvalStatusList.push({id:"approved",value:ZPI18N.getString("zp.approved")}),approvalStatusList.push({id:"rejected",value:ZPI18N.getString("zp.rejected")}),-1!=Layout.Page.hash.indexOf("approval/myrequest")&&approvalStatusList.push({id:"cancelled",value:ZPI18N.getString("zp.cancelled")});var approvalStatusProp={options:approvalStatusList,selectedValue:"pending",removeExistingDropdown:!0,dataMapping:{label:"value",value:"id"},forElement:"apprLst_fltr_cont",select:(event,data)=>{ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_status_fltr-container").attr("aria-label",data.optionData.value)}};ZPA_Common.ZCompProp.loadSelectListProp(approvalStatusProp),ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_status_fltr"),approvalStatusProp),ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_status_fltr-container").attr("aria-label",ZPI18N.getString("zp.pending"))},loadEmployeeOptionProperties:function(mode,id){let apprProp={};if(apprProp.dataSource={search:function(params){return new Promise(function(search,reject){let searchMode="MYAPPROVALS_APPROVER"===mode?"APPROVALS_MYAPPROVALS":"APPROVALS_MYAPPROVALS_RECORDOWNER",searchRes=ZPA_Common.getDecodedEmpIdWithName(EmployeeSearch.getEmpList(params.query,"emp",searchMode));searchRes.unshift({id:0,value:ZPI18N.getString("zp.allusers"),image:ZPeople.getDefaultUserImagePath()}),search({delay:20,results:searchRes,more:!1})})},paginated:!0},apprProp.dataMapping={value:"id",label:"value",image:"image"},apprProp.serverSearch=!0,apprProp.cacheData=!0,apprProp.contentType="image-text",apprProp.select=((event,data)=>{ZPA_Common.getParentPageId().find("#"+id+"-container").attr("aria-label",data.optionData.value)}),ZPA_Common.ZCompProp.loadSelectListProp(apprProp),"MYAPPROVALS_RECORDOWNER"==mode&&(apprProp.change=ApprovalList.Filter.enableDisableEmpStatusFilter),ZPeopleComponents.select("#"+id,apprProp),"allapproval"==ApprovalList.getActiveTabName()||"MYAPPROVALS_RECORDOWNER"==mode)ZPeopleComponents.select(Layout.Page.container.find("#"+id)).setValue({id:0,value:ZPI18N.getString("zp.allusers")}),Layout.Page.container.find("#"+id+"-container").attr("aria-label",ZPI18N.getString("zp.allusers"));else{let currUser=ZPA_Common.getDecodedEmpIdWithName(EmployeeSearch.getEmpList({},"emp","APPROVALS_MYAPPROVALS"))[0];ZPeopleComponents.select(Layout.Page.container.find("#"+id)).setValue({id:currUser.id,value:currUser.value,image:currUser.image}),Layout.Page.container.find("#"+id+"-container").attr("aria-label",currUser.value)}},loadEmpStatusOptionProperties:function(){var empStatusOptions=[];empStatusOptions.push({id:zpconst.EmployeeStatus.all,value:ZPI18N.getString("zp.allrequest")}),empStatusOptions.push({id:zpconst.EmployeeStatus.activeemprecord,value:ZPI18N.getString("zp.activeemprequest"),isDefaultValue:!0}),empStatusOptions.push({id:zpconst.EmployeeStatus.exitemprecord,value:ZPI18N.getString("zp.exemprequest")});var empStatusProp={options:empStatusOptions,selectedValue:zpconst.EmployeeStatus.activeemprecord,removeExistingDropdown:!0,dataMapping:{label:"value",value:"id"},forElement:"apprLst_fltr_cont",select:(event,data)=>{ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst__empstatus_fltr-container").attr("aria-label",data.optionData.value)}};ZPA_Common.ZCompProp.loadSelectListProp(empStatusProp),ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_empstatus_fltr"),empStatusProp),ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_empstatus_fltr-container").attr("aria-label",ZPI18N.getString("zp.activeemprequest"))},enableDisableEmpStatusFilter:function(event){var data=event.detail;let id=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_apprLst_empstatus_fltr");"0"!=data.selectedValue&&""!=data.selectedValue&&void 0!=data.selectedValue?(ZPeopleComponents.select(id).setValue({id:zpconst.EmployeeStatus.activeemprecord,value:ZPI18N.getString("zp.activeemprequest")}),ZPeopleComponents.select(id).setAttributes({disabled:!0})):ZPeopleComponents.select(id).setAttributes({disabled:!1})},showFilterResult:function(params){var pageId=Layout.Page.container,formId=params.approvalForm,status=params.approvalStatus;let empStatusId=params.empStatus,approverId=params.empErecNo,recordOwnerId=params.myApprRecOwner,activeTab=ApprovalList.getActiveTabName();pageId.find("#filterResultsHeader").removeClass("zpl_DNI");var formName=ZPI18N.getString("zp.all");if(ZPA_Common.isNotNull(formId)&&"-1"!=formId){var formList=ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+ApprovalList.getActiveTabName()+"_apprLst_forms_fltr")).options;$.each(formList,function(index,formObj){if(formObj.id==formId)return formName=formObj.value,!1})}let empStatus,filterContent;if(empStatusId==zpconst.EmployeeStatus.activeemprecord?empStatus=ZPI18N.getString("zp.activeemprequest"):empStatusId==zpconst.EmployeeStatus.exitemprecord&&(empStatus=ZPI18N.getString("zp.exemprequest")),pageId.find("#filterResultsHeader ul").empty(),formName!=ZPI18N.getString("zp.all")&&(filterContent=ZPI18N.getString("zp.forms")+" : "+ZSEC.Encoder.encodeForHTML(formName),pageId.find("#filterResultsHeader ul").append("<li name=\"forms\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"forms\", \"-1\")' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>")),"all"!=status&&(filterContent=ZPI18N.getString("zp.status")+" : "+ZPI18N.getString("zp."+status.toLowerCase()),pageId.find("#filterResultsHeader ul").append("<li name=\"status\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"status\", \"all\")' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>")),isadmin&&ZPA_Common.isNotNull(approverId)&&"0"!=approverId){let approverName=ZPeopleComponents.isComponent("#"+activeTab+"_apprLst_appr_fltr")?ZSEC.Encoder.encodeForHTML(ZPeopleComponents.select("#"+activeTab+"_apprLst_appr_fltr")._optDatas[0].value):ZPeople.getUserDetailsById(_LOGGEDIN_ZUID).name;filterContent=ZPI18N.getString("zp.approver")+" : "+approverName,pageId.find("#filterResultsHeader ul").append("<li name=\"appr\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"appr\")' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>")}ZPA_Common.isNotNull(recordOwnerId)&&"0"!=recordOwnerId?(filterContent=ZPI18N.getString("zp.recordowner")+" : "+ZSEC.Encoder.encodeForHTML(ZPeopleComponents.select("#"+activeTab+"_apprLst_recownr_fltr")._optDatas[0].value),pageId.find("#filterResultsHeader ul").append("<li name=\"recownr\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"recownr\", \"0\")' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>")):ZPA_Common.isNotNull(empStatusId)&&empStatusId!=zpconst.EmployeeStatus.all&&(filterContent=ZPI18N.getString("zp.employeestatus")+" : "+empStatus,pageId.find("#filterResultsHeader ul").append("<li name=\"empstatus\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"empstatus\","+zpconst.EmployeeStatus.all+" )' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>"))},removeFilterTag:function(filterName,value){let activeTab=ApprovalList.getActiveTabName();Layout.Page.container.find("#apprLst_fltr_cont").length<=0&&ApprovalList.Filter.constructFilterElements(activeTab),"appr"==filterName?ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#apprLst_fltr_cont #"+activeTab+"_apprLst_appr_fltr")).setValue({id:0,value:ZPI18N.getString("zp.allusers")}):ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#apprLst_fltr_cont #"+activeTab+"_apprLst_"+filterName+"_fltr")).setValue(value),ApprovalList.Filter.searchFilterAction()},getFilterValue:function(inputId){let activeTab=ApprovalList.getActiveTabName();var filterDiv=Layout.Page.container.find("#"+inputId);if(ZPeopleComponents.isComponent(filterDiv))return ZPeopleComponents.select(filterDiv).selectedValue;switch(inputId){case activeTab+"_apprLst_appr_fltr":return"allapproval"==activeTab?"0":erecno;case activeTab+"_apprLst_forms_fltr":return"-1";case activeTab+"_apprLst_status_fltr":return"pending";case activeTab+"_apprLst_empstatus_fltr":return zpconst.EmployeeStatus.activeemprecord}},resetFilter:function(){let activeTab=ApprovalList.getActiveTabName();var pageId=ZPA_Common.getParentPageId();pageId.find("#apprLst_fltr_cont").length<=0&&ApprovalList.Filter.constructFilterElements(activeTab),ZPA_Common.removeErrorDiv(pageId.find("#apprLst_fltr_cont")),isadmin&&ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_appr_fltr")).setValue({id:0,value:ZPI18N.getString("zp.allusers")}),ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_recownr_fltr")).setValue({id:0,value:ZPI18N.getString("zp.allusers")}),ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_forms_fltr")).setValue(-1),ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_status_fltr")).setValue("pending"),ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_empstatus_fltr")).setValue(zpconst.EmployeeStatus.activeemprecord)},searchFilterAction:function(activeTab){ApprovalList.Filter.resetApprovalFireScroll(),ApprovalList.resetApprovalPage(),activeTab&&ApprovalList.Filter.showHideFilter(activeTab)},resetApprovalFireScroll:function(){var fireScrollProperty=ZPeople.FireScroll.getFireScrollPropertie();fireScrollProperty&&(fireScrollProperty.triggered=!0)},resetFilterResult:function(){ApprovalList.Filter.resetFilter(),ApprovalList.Filter.searchFilterAction()}},ApprovalList.Forward={showPopup:function(){if(ApprovalList.APPROVE_RECIDS.length<200){let forwardApprTab=new Tab("",this.constructBulkForwardPopUpHtml);forwardApprTab.id="bulkForwardPopup",forwardApprTab.cardId="bulkForwardCard",forwardApprTab.validate=(popupObj=>{this.bulkForwardValidateAndExecute(popupObj)}),ApprovalList.Forward.popupModal=new popupModal(ZPI18N.getString("zp.bfwrdmyapprpophead"),forwardApprTab),ApprovalList.Forward.popupModal.mediumSize=!0,ApprovalList.Forward.popupModal.isAppendToBody=!0,ApprovalList.Forward.popupModal.save=ZPI18N.getString("zp.proceed"),ApprovalList.Forward.popupModal.construct(),ApprovalList.Forward.popupModal.setCloseCallback(function(){ApprovalList.Forward.closePopup()})}else ZPeople.Message.failure(ZPI18N.getString("zp.apprfrwdmaxrecordidlenerr"))},closePopup:function(){ApprovalList.Forward.popupModal.remove()},getBulkForwardPopUpHtml:function(){return'<div class="zpl_crd"><div id="forwardingDiv" class="zpl_crdcnt"><div class="zpl_secn">'+this.getBulkForwardWarningMsgHtml()+'</div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.selectapprover")+'</label></div><div><select id="appr_forward_id" style="display:none"></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.local.Comments")+'</label></div><div><textarea id="forward_comment" class="ztextbox" rows="8" placeholder="'+ZPI18N.getString("zp.local.Comments")+'"></textarea></div></div></div></div>'},constructBulkForwardPopUpHtml:function(){let frwdPopupCardId=ApprovalList.Forward.popupModal.cardElem();ApprovalList.Forward.popupModal.sliderDiv.find(".zpl_mhder div").append("<div>"+ZPI18N.getString("zp.bfwrdmyapprpopmsg")+"</div>"),frwdPopupCardId.append(ApprovalList.Forward.getBulkForwardPopUpHtml()),ZPeopleComponents.select(frwdPopupCardId.find("#appr_forward_id"),ApprovalForward.getForwardMenuProperty())},isBulkForwardWarningMsgNeeded:function(){let activeTab=ApprovalList.getActiveTabName(),isBulkForwardWarningMsgNeeded=!1;return"allapproval"!=ApprovalList.getActiveTabName()&&"team"!=ApprovalList.getActiveTabName()||void 0==ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_appr_fltr")||ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_appr_fltr")==erecno||Layout.Page.container.find("[name=approval_card][isPrimaryAppr=false] input").is(":checked")&&(isBulkForwardWarningMsgNeeded=!0),isBulkForwardWarningMsgNeeded},getBulkForwardWarningMsgHtml:function(){return this.isBulkForwardWarningMsgNeeded()?'<div class="zpl_info"><em>'+ZPI18N.getString("zp.bfwrdmyapprwrngmsg")+"</em></div>":""},bulkForwardValidateAndExecute:function(popupObj){let $forwardCard=popupObj.cardElem(),forwardErecno=ZPeopleComponents.select($forwardCard.find("#appr_forward_id")).getValue(),forwardComment=$forwardCard.find("#forward_comment").val();ApprovalList.removeErrorMsg($forwardCard),ZPUtil.Validation.isEmpty(forwardComment)?ApprovalList.showErrorMsg($forwardCard.find("#forward_comment"),ZPI18N.getString("zp.commentsrequirederrormsg")):forwardComment.length>250&&ApprovalList.showErrorMsg($forwardCard.find("#forward_comment"),ZPI18N.getString("zp.commentlenerr")),ZPUtil.Validation.isEmpty(forwardErecno)&&ApprovalList.showErrorMsg($forwardCard.find("#appr_forward_id").next("div"),ZPI18N.getString("zp.selectapprover")),0===$forwardCard.find(".ztextbox--error__label").length&&(this.isBulkForwardWarningMsgNeeded()?(ApprovalList.Forward.warningPopup=new InfoAlertMessage("",ZPI18N.getString("zp.bfwrdmyapprconfirm")),ApprovalList.Forward.warningPopup.setCallback(()=>{this.execute(forwardErecno,forwardComment)}),ApprovalList.Forward.warningPopup.setCloseCallback(this.frwdWarningCancelCallback),ApprovalList.Forward.popupModal.sliderDiv.removeClass("zpl_mopen"),ApprovalList.Forward.warningPopup.show()):($forwardCard.closest(".zpl_minr").find("#submitSbt").prop("disabled",!0),this.execute(forwardErecno,forwardComment)))},frwdWarningCancelCallback:function(){Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content button[approvalType=2]").prop("disabled",!1),ApprovalList.Forward.popupModal.sliderDiv.addClass("zpl_mopen")},execute:function(forwardErecno,forwardComment){this.closePopup();var params={method:"forwardMyApprovals",recordIds:JSON.stringify(ApprovalList.APPROVE_RECIDS),forwardErecno:forwardErecno,comment:forwardComment};ZPeople.Request.send("/forwardApproval.zp",params,this.bulkFrwdSuccessCallBack,void 0,this.bulkFrwdFailureCallBack)},bulkFrwdSuccessCallBack:function(resultData,params){"forwardMyApprovals"===params.method&&void 0!=resultData.successMsg&&ZPeople.Message.success(resultData.successMsg),Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content").empty(),ApprovalList.getApprovalOrRequestList(resultData),ApprovalList.APPROVE_RECIDS=[]},bulkFrwdFailureCallBack:function(failureData){failureData.hasOwnProperty("responseJSON")&&failureData.responseJSON.hasOwnProperty("error")&&failureData.responseJSON.error.trim().length>0&&ZPeople.Message.showFailureMsg(failureData.responseJSON.error)}},ApprovalList.MySpace={constructApprovalPage:function(result,params){let pageId=Layout.Page.container,activeTab=ApprovalList.getActiveTabName();0==pageId.find("#"+activeTab+"_page_content").length&&pageId.append('<div id="'+activeTab+'_page_content" class="zpl_msplst"></div>'),pageId.find("#"+activeTab+"_page_content").append(this.getApprovalHeaderHtml()),this.constructApprovalCards(result,params),ApprovalList.addClickEvent(pageId)},showPopup:function(btnObj,isBulkApproval,formId){let action=$(btnObj).attr("approvalType");const cardObj=$(btnObj).closest("[name=approval_card]");if(cardObj.length>0){const tableName=cardObj.attr("tablename");let callback=OPApprovals.ModuleCallback.ActionCard.initialApprovalPopup(tableName,action);if(ZPUtil.Validation.isFunction(callback)){return void callback(tableName,cardObj.attr("formid"),cardObj.attr("id"),action)}}if(1==action){let apprAlrtObj=new SuccessAlertMessage(ZPI18N.getString("zp.approval.apprconformationtitle"));apprAlrtObj.setCallback(this.apprRejAction),apprAlrtObj.yesButtonText=ZPI18N.getString("zp.approve"),apprAlrtObj.removeAfterYes=!1,apprAlrtObj.setCenterHtml('<textarea id="approver_comment" class="ztextbox" rows="8" placeholder="'+ZPI18N.getString("zp.local.Comments")+'"></textarea>'+this.getAllLevelApprovalHtml()),apprAlrtObj.show(),apprAlrtObj.alertDiv.find("p").text(ZPI18N.getString("zp.approval.apprconformationdesc")),apprAlrtObj.cardObj=cardObj,apprAlrtObj.approvalType=action,apprAlrtObj.isBulkApproval=isBulkApproval,apprAlrtObj.formId=formId}else{let rejAlrtObj=new DeleteAlertMessage(ZPI18N.getString("zp.approval.rejconformationtitle"));rejAlrtObj.setCallback(this.apprRejAction),rejAlrtObj.yesButtonText=ZPI18N.getString("zp.reject"),rejAlrtObj.removeAfterYes=!1,rejAlrtObj.setCenterHtml('<textarea id="approver_comment" class="ztextbox" rows="8" placeholder="'+ZPI18N.getString("zp.local.Comments")+'"></textarea>'),rejAlrtObj.show(),rejAlrtObj.alertDiv.find("p").text(ZPI18N.getString("zp.approval.rejconformationdesc")),rejAlrtObj.cardObj=cardObj,rejAlrtObj.approvalType=action,rejAlrtObj.isBulkApproval=isBulkApproval,rejAlrtObj.formId=formId}},apprRejAction:function(thisObj){let apprParam,alertDiv=thisObj.alertDiv,cardObj=thisObj.cardObj,isBulk=thisObj.isBulkApproval,recIdArr=isBulk?ApprovalList.APPROVE_RECIDS:new Array(cardObj.attr("id")),isRecordAdmin=ZPeople.CURR_USER.usererec===cardObj.attr("recordOwnerErecno"),approvalType=thisObj.approvalType,comment=alertDiv.find("#approver_comment").val(),isApproveAllLevel=!(!isadmin||1!=approvalType)&&alertDiv.find("#appr_alllvl_check").prop("checked");alertDiv.find("#yesBtn").attr("name","approvalBtn"),apprParam=isBulk?ApprovalParam.setBulkParam(recIdArr,isRecordAdmin,thisObj.formId):new ApprovalParam(cardObj.attr("formid"),recIdArr,cardObj.attr("tableName"),cardObj.attr("status"),isRecordAdmin);let layoutParam=new LayoutParam(alertDiv,alertDiv.find("#alrtCls"),alertDiv.find(".zpl_mfoter"),"MySpace");layoutParam.setActionLayout(alertDiv),alertDiv.find("#yesBtn").attr("disabled",!0);let approveRejectObj=new ApproveReject(apprParam,layoutParam,approvalType,comment,isApproveAllLevel);approveRejectObj.setIsBulkApproval(isBulk),approveRejectObj.setIsCardApproval(!isBulk),approveRejectObj.execute()},getAllLevelApprovalHtml:function(){return isadmin?'<div class="zcheckbox" onchange="ApprovalList.MySpace.showAllLevelApprBtn(this)"><input id="appr_alllvl_check" class="zcheckbox__helper" type="checkbox" name="check"><label for="appr_alllvl_check" class="zcheckbox__label">'+ZPI18N.getString("zp.skipinterapprlvl")+"</label></div>":""},showAllLevelApprBtn:function($this){let isSelected=$($this).children("#appr_alllvl_check").prop("checked");$($this).parents(".zpl_minr").find("#yesBtn").text(isSelected?ZPI18N.getString("zp.approveall"):ZPI18N.getString("zp.approve"))},getCheckboxHtml:function(recId){return'<div class="zcheckbox" onclick="ApprovalList.selectUnselectCheck(this,\''+recId+'\')"><input id="zp_approval_check" type="checkbox" name="check" value="" class="zcheckbox__helper"><label class="zcheckbox__label"></label></div>'},getApprReqDtlHtml:function(empPhotoUrl,recordOwner,formName,reqMsg,recordOwnerZuid){return'<div class="zpl_msp-dts CP"><div><div class="zpl_em"><div class="zpl_emimg" popup="user" empid='+recordOwnerZuid+'><img alt="" src="'+empPhotoUrl+'"></div><div class="zpl_emdts zpl_ellipsis"><div><b>'+recordOwner+"</b></div><div><em>"+reqMsg+" </em><b>"+formName+"</b></div></div></div></div></div>"},getRaisedOnHtml:function(data){return'<div><div class="zpl_compoffar"><em>'+ZPI18N.getString("zp.raisedon")+'</em><div class="d-flexclmcap10"><div><b>'+data.requestedOn+"</b></div></div></div></div>"},getApprRejBtnHtml:function(){return'<div id="zp_approval_actiondiv" class="zpl_msp-act"><div id="zp_approval_approvereject" class="zpl_hvr"><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" approvalType=1>'+ZPI18N.getString("zp.approve")+'</button><button class="zlabel zlabel--red zlabel--medium zlabel--outline" approvalType=0>'+ZPI18N.getString("zp.reject")+"</button></div></div>"},getApprRejMsgHtml:function(status){return'<div class="d-flexclmcap10 '+(status?"grn":"red")+'">'+ZPI18N.getString(status?"zp.approved":"zp.rejected")+"</div>"},constructApprovalCards:function(result,params){let pageId=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content"),approvalCards="",recordCount=ApprovalList.TOTAL_RECS,resultDataLength=result.message.length;21==resultDataLength&&(resultDataLength-=1);for(let index=0;index<resultDataLength;index++){let data=result.message[index],recordOwnerName=ZPeople.CURR_USER.usererec===data.recordOwnerErecno?ZPeople.CURR_USER.name:data.recordOwnerName,reqMsg="";reqMsg=1==data.approvalAction?ZPI18N.getString("zp.hasmadecancelreq"):ZPI18N.getString("zp.hasmadereq"),approvalCards+='<div name="approval_card" id="'+data.recordId+'" formId="'+data.formId+'" formDisplayName="'+data.formName+'" tableName="'+data.tableName+'" status="'+data.approvalStatus+'" recordOwnerErecno="'+data.recordOwnerErecno+'">'+this.getCheckboxHtml(data.recordId)+this.getApprReqDtlHtml(data.employeePhotoUrl,recordOwnerName,data.formName,reqMsg,data.recordOwnerZUID)+this.getRaisedOnHtml(data)+this.getApprRejBtnHtml()+"</div>",recordCount+=1}pageId.append(approvalCards),ApprovalList.TOTAL_RECS=recordCount},updateApprovalCard:function(recordId,status){let cardId=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content #"+recordId);0==status||1==status?(cardId.removeClass("zpl_mspinfo"),cardId.find("#error_info").remove(),cardId.find("#zp_approval_check_div").addClass("disabled"),cardId.find("#zp_approval_check").prop("checked",!1).attr("disabled",!0),cardId.find("div.zcheckbox").removeClass("zpl_DNI"),cardId.find("#zp_approval_actiondiv").empty().append(ApprovalList.MySpace.getApprRejMsgHtml(status))):cardId.remove()},updateApprovalCards:function(recordIds,status){recordIds.forEach(function(val){ApprovalList.MySpace.updateApprovalCard(val,status)}),ZPeople.Message.success(ZPI18N.getString(status?"zp.apprsuccessmsg":"zp.rejsuccessmsg"))}},ApprovalHome={getPendingCount:function(){ZPeople.Request.send("/approvalAction.zp",{mode:"pendingApprovalsCount"},function(result){let count=result.message.count;$("#home_myspace_overview_approval").addClass("zpl_NtHd").find(".zpl_Ntcont").remove(),0!=count&&$("#home_myspace_overview_approval").addClass("zpl_NtHd").append('<div class="zpl_Ntcont"><span>'+count+"</span></div>")})},updateApprovalCount:function(){-1!==Layout.Page.hash.indexOf("home/myspace/overview-approval")?ApprovalList.approvalAction():ApprovalHome.getPendingCount()}},ApprovalRedirection={getV5URL:function(){if(settingsUrlProps.urlParamsArr&&settingsUrlProps.urlParamsArr.mode){var mode=settingsUrlProps.urlParamsArr.mode,formId=settingsUrlProps.urlParamsArr.formId,recordId=settingsUrlProps.urlParamsArr.recordId;if("AttendancePermissions"==mode)return{isValid:!0,redirectToURL:"attendance/hourlyperm/viewmyrequest-formId:"+formId+"/recordId:"+recordId};if("AttendanceOD"==mode)return{isValid:!0,redirectToURL:"attendance/onduty/viewmyrequest-formId:"+formId+"/recordId:"+recordId};if("Shift"==mode)return{isValid:!0,redirectToURL:"attendance/shiftchangerequests/viewmyrequest-formId:"+formId+"/recordId:"+recordId};if("Goal"==mode)return{isValid:!0,redirectToURL:"performance/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Goal"};if("Review"==mode)return{isValid:!0,redirectToURL:"performance/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Review"};if("Rater"==mode)return{isValid:!0,redirectToURL:"performance/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Rater"};if("Reviewsheet"==mode)return{isValid:!0,redirectToURL:"performance/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Reviewsheet"};if("Salary_Revision"==mode)return{isValid:!0,redirectToURL:"salarydetails/salaryrevision/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Salary_Revison"}}}};var DelegationSettings={DELEGATION_URL:"/delegationAction.zp",DELEGATION_JSON:[],DELEGATION_TYPE:{temporary:1,permanent:2},PAGE_ID:null,DELEGTABLE_ID:null,TAB_ID:null,CARD_ID:null,VIEW_ID:null,setPageId:function(container){DelegationSettings.PAGE_ID=void 0!=container?container:settingsUrlProps.url.includes("myspace")?Layout.Page.container:settingsPage.container},isFromMySpace:function(){return settingsUrlProps.url.includes("myspace")},showPageLoading:function(divToHide,parentDiv){divToHide.addClass("zpl_DNI"),parentDiv.append(ZPeople.LOADING_HTML)},hidePageLoading:function(divToShow,parentDiv){divToShow.removeClass("zpl_DNI"),parentDiv.find("#zp_page_loading").remove()},getMySpaceErecno:function(){if(DelegationSettings.isFromMySpace())return erecno},resetPageId:function(container){DelegationSettings.PAGE_ID=null,DelegationSettings.DELEGTABLE_ID=null,DelegationSettings.TAB_ID=null,DelegationSettings.CARD_ID=null,DelegationSettings.VIEW_ID=null,DelegationSettings.setPageId(container)},failureCallBack:function(failureData,params){params&&"addUpdateDelegation"==params.method&&DelegationSettings.TAB_ID.find(".zpl_mfoter #sliderSbt").attr("disabled",!1),failureData.hasOwnProperty("responseJSON")&&failureData.responseJSON.hasOwnProperty("error")&&failureData.responseJSON.error.trim().length>0&&ZPeople.Message.showFailureMsg(failureData.responseJSON.error)},changeDelegationUrl:function(mode,delegationId){switch(mode){case"view":window.location.href=Layout.Page.hash.split("/delegation")[0]+"/delegation/view-id:"+delegationId;break;case"edit":window.location.href=Layout.Page.hash.split("/delegation")[0]+"/delegation/edit-id:"+delegationId;break;case"add":window.location.href=Layout.Page.hash.split("/delegation")[0]+"/delegation/add";break;case"close":window.location.href=Layout.Page.hash.split("/delegation")[0]+"/delegation"}}};DelegationSettings.View={EMPTY_PAGE:null,isDelegationAllowed:!1,isAddDelegationAllowed:!1,delegationRouting:function(){var url=Layout.Page.hash,delegationId=url.split(":")[1];-1!==url.indexOf("delegation/edit")?DelegationSettings.Edit.getSingleRecord("edit",delegationId):-1!==url.indexOf("delegation/view")?DelegationSettings.Edit.getSingleRecord("view",delegationId):-1!==url.indexOf("delegation/add")&&DelegationSettings.Modal.openDelegSlide()},init:function(){ZPeople.Request.send(DelegationSettings.DELEGATION_URL,{method:"getDelegationPermission",erecno:DelegationSettings.getMySpaceErecno(),conreqcsr:csrfToken},DelegationSettings.View.constructPage)},constructPage:function(delegPerm){if(DelegationSettings.View.isDelegationAllowed=delegPerm.isDelegationAllowed,DelegationSettings.resetPageId(null),container=DelegationSettings.PAGE_ID,isadmin||DelegationSettings.View.isDelegationAllowed)container.html(DelegationSettings.View.getViewPageHTML()),ZPeopleComponents.button(container.find("#add_delegation_btn"),{appearance:"primary",click:DelegationSettings.View.createDeleg}),DelegationSettings.View.fetchDelegationList();else{new EmptyPages("zp_nd_permission",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"),"",container).show()}},getViewPageHTML:function(){return DelegationSettings.isFromMySpace()?'<div class="zpl_act"><div class="zpl_btnmnu"><div class="zpl_rgt"><button id="add_delegation_btn" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.createdelegbtn")+'</button></div></div><div class="zpl_rgtcnt"><div class="zpl_tblres">'+DelegationSettings.View.getListPageOutlineHTML("zpl_tabularfxd")+'</div><div label="DelegEmptPage"></div></div></div></div>':'<div class="zpl_act"><div class="zpl_btnmnu"><div class="zpl_rgt"><button id="add_delegation_btn" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.createdelegbtn")+'</button></div></div><div class="zpl_rgtcnt"><div class="zpl_tblres">'+DelegationSettings.View.getListPageOutlineHTML("")+'</div><div label="DelegEmptPage"></div></div></div>'},getListPageOutlineHTML:function(tableCls){return'<table id="delegTable" class="zpl_tbl '+tableCls+'"><thead><tr><th>'+ZPI18N.getString("zp.delegator")+"</th><th>"+ZPI18N.getString("zp.delegatee")+"</th><th>"+ZPI18N.getString("zp.type")+"</th><th>"+ZPI18N.getString("zp.fromtodate")+"</th><th>"+ZPI18N.getString("zp.status")+'</th><th class="zpl_w100"></th></tr></thead><tbody> </tbody></table>'},createDeleg:function(){DelegationSettings.changeDelegationUrl("add")},fetchDelegationList:function(){container=DelegationSettings.PAGE_ID,DelegationSettings.DELEGTABLE_ID=container.find("#delegTable"),DelegationSettings.DELEGTABLE_ID.find("tbody tr").length>0||(DelegationSettings.showPageLoading(DelegationSettings.DELEGTABLE_ID,container),ZPeople.Request.send(DelegationSettings.DELEGATION_URL,{method:"list",erecno:DelegationSettings.getMySpaceErecno(),conreqcsr:csrfToken},DelegationSettings.View.constructDelgPage))},constructDelgPage:function(delegList){if(void 0!=delegList){DelegationSettings.DELEGATION_JSON=delegList.list,DelegationSettings.View.isAddDelegationAllowed=delegList.isAddDelegationAllowed;var pageId=DelegationSettings.PAGE_ID;if(isadmin||delegList.isAddDelegationAllowed||pageId.find("#add_delegation_btn").addClass("zpl_DNI"),pageId.find("#zp_page_loading").remove(),DelegationSettings.DELEGATION_JSON.length<1)return DelegationSettings.Common.emptyData(),void DelegationSettings.hidePageLoading(DelegationSettings.DELEGTABLE_ID,pageId);DelegationSettings.DELEGTABLE_ID.removeClass("zpl_DNI");var tableBody=DelegationSettings.DELEGTABLE_ID.find("tbody").empty(),tableRows="";$.each(DelegationSettings.DELEGATION_JSON,function(i,singleDeleg){tableRows+=DelegationSettings.View.constructDelgRow(singleDeleg)}),tableBody.append(tableRows),DelegationSettings.View.addClickEvent(tableBody),DelegationSettings.hidePageLoading(DelegationSettings.DELEGTABLE_ID,pageId)}},constructDelgRow:function(singleDeleg){return'<tr class="ZPLRow" delegationid="'+singleDeleg.delegationId+'">'+DelegationSettings.View.constructDelgData(singleDeleg)+"</tr>"},addClickEvent:function(tableBody){tableBody.find("tr td div .PI_edt").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),DelegationSettings.changeDelegationUrl("edit",$(this).closest("tr").attr("delegationid"))}),tableBody.find("tr td div .PI_delete").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),DelegationSettings.Delete.deleteRecord($(this).closest("tr").attr("delegationid"))}),tableBody.find("tr").off("click").on("click",function(){DelegationSettings.changeDelegationUrl("view",$(this).closest("tr").attr("delegationid"))})},constructDelgData:function(singleDeleg){singleDeleg.delegationId;var singleDelgtr=this.constructEmpData(singleDeleg.employeeDtls);return singleDelgtr+=this.constructEmpData(singleDeleg.delegateeDtls),singleDeleg.TypeOfDelegation==DelegationSettings.DELEGATION_TYPE.temporary?(singleDelgtr+="<td> <span>"+ZPI18N.getString("zp.temporary")+"</span></td>",singleDelgtr+="<td><span>"+singleDeleg.From+" to "+singleDeleg.To+"</span></td>"):(singleDelgtr+="<td><span>"+ZPI18N.getString("zp.local.Permanent")+"</span></td>",singleDelgtr+="<td></td>"),singleDelgtr+="<td><span>"+singleDeleg.Status+"</span></td>",singleDelgtr+='<td><div class="zpl_hvr">',singleDeleg.hasEditDelPerm&&(singleDeleg.Status!==ZPI18N.getString("zp.expired")&&(singleDelgtr+='<i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" data-original-title="Edit"></i>'),singleDelgtr+='<i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" data-original-title="Delete"></i>'),singleDelgtr+="</div></td>"},constructEmpData:function(empData){var empHTML="<td>";return void 0!=empData&&Object.keys(empData).length>0&&(empHTML+='<div class="zpl_em">',empHTML+='<div class="zpl_emimg"><img src="'+empData.employeePhoto+'" data-toggle="tooltip" data-placement="top" data-original-title="" popup="user" empid="'+empData.zuid+'"></div>',empHTML+='<div class="zpl_emdts"> <div>',empHTML+=empData.erecno==erecno?"<b>"+ZPI18N.getString("zp.you")+"</b>":"<em>"+empData.employeeID+" - </em><b>"+ZPeople.decodeTxt(ZPeople.escapeHtml(empData.name))+"</b>",empHTML+="</div></div></div>"),empHTML+"</td>"}},DelegationSettings.Menu={getEmployeeProperty:function(selectedIdDtl,searchMode){var property={};if(property.dataSource={search:function(params){return new Promise(function(search,reject){var searchRes;if("DELEGATION_DELEGATOR"==searchMode){var delegatorId,defaultVal,modalObj=DelegationSettings.TAB_ID;modalObj?delegatorId=ZPeopleComponents.select(modalObj.find("#delegatorList")).getValue():"P_Employee"==ZPForm.getTableName()&&(delegatorId=ZPForm.CURRFORM_PARAM.recordId,defaultVal=ZPeople.getUserDetailsById(delegatorId).reportingTo),searchRes=EmployeeSearch.getEmpList(params.query,"emp","DELEGATION_DELEGATOR",void 0==delegatorId||""==delegatorId?void 0:[delegatorId],void 0,!1,defaultVal)}else{var delegateeId=DelegationSettings.TAB_ID.find("#delegateeList").val();searchRes=EmployeeSearch.getEmpList(params.query,"emp",searchMode,void 0==delegateeId||""==delegateeId?void 0:[delegateeId],void 0)}search({delay:20,results:searchRes,more:!1})})},paginated:!0},property.placeholder=ZPI18N.getString("zp.select"),property.dataMapping={id:"id",label:"value",value:"id",image:"image"},property.showSearchField=!0,property.contentType="image-text",property.search={by:["value","email"]},property.serverSearch=!0,property.cacheData=!0,property.isLabelHTMLEncoded=!0,property.dropdownList={fitForElement:!0,moveOnScroll:!0,isTextHTMLEncoded:!0},property.change=DelegationSettings.Modal.changeDelegCallback,selectedIdDtl){var userDtl=ZPeople.getUserDetailsById(selectedIdDtl.erecno);(param1={}).value=userDtl.name,param1.image=userDtl.avatar,param1.id=userDtl.usererec,param1.emailId=userDtl.email,param1.zuid=userDtl.id,property.selectedValue=param1}else if("DELEGATION_EMP"==searchMode){var param1;userDtl=ZPeople.getUserDetailsById(erecno);(param1={}).value=userDtl.name,param1.image=userDtl.avatar,param1.id=userDtl.usererec,param1.emailId=userDtl.email,param1.zuid=userDtl.id,property.selectedValue=param1}return property},getDelegTypeProperty:function(selectedType){var property={},invokeType=[];return invokeType.push({id:"1",value:ZPI18N.getString("zp.temporary")}),invokeType.push({id:"2",value:ZPI18N.getString("zp.local.Permanent")}),property.options=invokeType,property.dataMapping={label:"value",value:"id"},selectedType&&(property.selectedValue=selectedType),property.change=DelegationSettings.Modal.changeDelegTypeCallback,property}},DelegationSettings.Modal={SLIDER_MODAL:void 0,BODY_OUTER_HTML:'<div class="zpl_crd"><div class="zpl_crdcnt" id="delegation_modal_body"></div></div>',INPUT_HTML:'<div class="zpl_secn"><div><label class="$LABEL_CLASS$">$LABEL_DISP_NAME$</label></div><div class="$FIELD_CLASS$">$FIELD_HTML$</div></div>',getPageId:function(){return DelegationSettings.isFromMySpace()?$("body #modal_Container"):$(settingsPage.mainWrapId)},openDelegSlide:function(event,data,mode){(isadmin||DelegationSettings.View.isDelegationAllowed)&&("view"==mode?(DelegationSettings.Modal.SLIDER_MODAL=new sliderModal(DelegationSettings.Modal.getModalHeaderStr(mode),new Tab("ViewDeleg",function(){DelegationSettings.Modal.constructViewModalBody(data)},function(){DelegationSettings.Add.save(void 0===data?data:data.delegationId)})),DelegationSettings.Modal.SLIDER_MODAL.cancel=ZPI18N.getString("zp.close")):(isadmin||DelegationSettings.View.isAddDelegationAllowed)&&(void 0!=DelegationSettings.Modal.SLIDER_MODAL&&DelegationSettings.Modal.closeDelegSlide(!1),DelegationSettings.Modal.SLIDER_MODAL=new sliderModal(DelegationSettings.Modal.getModalHeaderStr(mode),new Tab("AddEditDeleg",function(){DelegationSettings.Modal.constructEditModalBody(data)},function(){DelegationSettings.Add.save(void 0===data?data:data.delegationId)}))),DelegationSettings.Modal.SLIDER_MODAL.isAppendToBody=!!DelegationSettings.isFromMySpace(),DelegationSettings.Modal.SLIDER_MODAL.construct(),DelegationSettings.Modal.SLIDER_MODAL.setCloseCallback(function(){DelegationSettings.Modal.closeDelegSlide(!0)}))},getInputHTML:function(dispName,fieldHtml,labelClass,fieldClass){var html=DelegationSettings.Modal.INPUT_HTML;return html=(html=(html=(html=html.replace("$LABEL_DISP_NAME$",dispName)).replace("$FIELD_HTML$",fieldHtml)).replace("$LABEL_CLASS$",labelClass||"")).replace("$FIELD_CLASS$",fieldClass||"")},constructEditModalBody:function(data){DelegationSettings.TAB_ID=DelegationSettings.Modal.getPageId().find("#tabAddEditDeleg"),DelegationSettings.CARD_ID=DelegationSettings.TAB_ID.find("#cardAddEditDeleg");var popup_body=DelegationSettings.CARD_ID;popup_body.append('<div class="zpl_crd"><div class="zpl_crdcnt">'+DelegationSettings.Modal.getEditModalHTML()+"</div></div>"),DelegationSettings.Modal.setEditModalProperty(data),data&&(DelegationSettings.TAB_ID.attr("delegationId",data.delegationId),popup_body.find("#delegatorList").parent("div").addClass("disabled"))},getEditModalHTML:function(){var html="";html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.delegator"),'<select id="delegatorList" label="Delegator"></select>',"zpl_mtry"),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.delegatee"),'<select id="delegateeList" label="Delegatee"></select>',"zpl_mtry");var inputHTML='<select id="delegationTypeList" label="TypeOfDelegation"></select>';return inputHTML+=DelegationSettings.Modal.getDateRangePicker(),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.type"),inputHTML,void 0,"zpl_idiv"),inputHTML=DelegationSettings.Modal.getRadioBtnHTML(),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.notification"),inputHTML),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.description"),'<textarea class="ztextbox" rows="5" label="Description"></textarea>')},getRadioBtnHTML:function(){var html='<div class="zpl_idiv zpl_erorbx" label="is_Notify">';return html+='<div class="zradiobutton d-flexC zradiobutton--horizontal">',html+='<input id="notify_bothdeleg" type="radio" checked="" class="zradiobutton__helper" name="delgNotify" value="1">',html+='<label for="notify_bothdeleg" class="zradiobutton__label">',html+='<span class="zradiobutton__text">'+ZPI18N.getString("zp.delegateeanddelegator")+"</span>",html+="</label>",html+="</div>",html+='<div class="zradiobutton d-flexC zradiobutton--horizontal">',html+='<input id="notify_delegatee" type="radio" class="zradiobutton__helper" name="delgNotify" value="0">',html+='<label for="notify_delegatee" class="zradiobutton__label">',html+='<span class="zradiobutton__text">'+ZPI18N.getString("zp.delegatee")+"</span>",html+="</label>",html+="</div>",html+="</div>"},getDateRangePicker:function(){return'<div id="delegationFromToDiv" class="zpl_DNI"><div id="delegationDateRangePicker" data-for-element="#delegDateRangeInput"></div><div><div id="delegDateRangeDiv" class="ztextbox--group zh-alignright"><i class="ztextbox__icon PI_calendar"></i><input id="delegDateRangeInput" class="ztextbox" label="FromTo" placeholder="'+ZPI18N.getString("zp.daterange")+'"></div></div></div>'},setDateRangePicker:function(){ZPeopleComponents.daterangepicker("#delegationDateRangePicker",{forElement:"#delegDateRangeDiv",appendTo:DelegationSettings.TAB_ID,change:(event,ui)=>{DelegationSettings.CARD_ID.find("#delegDateRangeInput").val(ui.fromValueString+"-"+ui.toValueString)},format:dateFmt,singleDateSelect:!0,position:"bottom"});let picker=DelegationSettings.TAB_ID.find("#delegationDateRangePicker");DelegationSettings.CARD_ID.find("#delegDateRangeDiv").off().on("click",function(){picker.is(":visible")?ZPeopleComponents.daterangepicker(picker).close():ZPeopleComponents.daterangepicker(picker).open()})},setEditModalProperty:function(data){ZPeopleComponents.select("#delegatorList",DelegationSettings.Menu.getEmployeeProperty(data&&data.employeeDtls?data.employeeDtls:void 0,"DELEGATION_EMP")),ZPeopleComponents.select("#delegateeList",DelegationSettings.Menu.getEmployeeProperty(data&&data.delegateeDtls?data.delegateeDtls:void 0,"DELEGATION_DELEGATOR")),ZPeopleComponents.select("#delegationTypeList",DelegationSettings.Menu.getDelegTypeProperty(data?data.TypeOfDelegation:void 0)),DelegationSettings.Modal.setDateRangePicker();var container=DelegationSettings.TAB_ID;data&&data.delegateeDtls&&data.delegateeDtls.hasOwnProperty("is_Notify")?container.find("[label='is_Notify']").find("[value='"+(data.delegateeDtls.is_Notify?"1":"0")+"']").trigger("click"):container.find("[label='is_Notify']").find("[value='1']"),data&&data.Description&&container.find("[label='Description']").val(ZPeople.decodeTxt(data.Description));var typeOfDeleg=data&&data.TypeOfDelegation?data.TypeOfDelegation:"1";DelegationSettings.Modal.changeDelegType(typeOfDeleg),data&&data.TypeOfDelegation&&data.TypeOfDelegation==DelegationSettings.DELEGATION_TYPE.temporary&&container.find("[label='FromTo']").val(data.From+"-"+data.To)},changeDelegTypeCallback:function(event,detail){DelegationSettings.Modal.changeDelegType(detail.selectedValue)},changeDelegType:function(selectedType){var container=DelegationSettings.TAB_ID;selectedType==DelegationSettings.DELEGATION_TYPE.temporary?(DelegationSettings.Validation.removeErrorMsg(container.find('[label="TypeOfDelegation"]').closest("div.zpl_secn")),container.find('#delegDateRangeInput[label="FromTo"]').val(""),container.find("#delegationFromToDiv").removeClass("zpl_DNI")):selectedType==DelegationSettings.DELEGATION_TYPE.permanent&&(DelegationSettings.Validation.removeErrorMsg(container.find('[label="TypeOfDelegation"]').closest("div.zpl_secn")),container.find("#delegationFromToDiv").addClass("zpl_DNI"))},changeDelegCallback:function(event,detail){var ele=detail.element.closest("div.zpl_secn");(ele.find(".ztextbox--error__label").length>0||ele.find(".ztextbox__error").length>0)&&DelegationSettings.Validation.removeErrorMsg(ele)},constructViewModalBody:function(viewData){DelegationSettings.VIEW_ID=DelegationSettings.Modal.getPageId().find("#tabViewDeleg"),DelegationSettings.VIEW_ID.find("#sliderSbt").hide(),$('<div class="zpl_mhderrgt"><a id="sliderEdt"class="_cls PI_edt zpl_DNI" title="Edit"></a></div>').insertBefore(DelegationSettings.VIEW_ID.find("#sliderCls")),DelegationSettings.VIEW_ID.attr("delegationId",viewData.delegationId);var popup_body=DelegationSettings.VIEW_ID.find("#cardViewDeleg"),headerEdt=DelegationSettings.VIEW_ID.find("#sliderEdt");viewData.hasEditDelPerm&&viewData.Status!=ZPI18N.getString("zp.expired")?(headerEdt.removeClass("zpl_DNI"),headerEdt.on("click",function(e){e.stopPropagation(),e.preventDefault(),DelegationSettings.changeDelegationUrl("edit",DelegationSettings.VIEW_ID.attr("delegationid"))})):(headerEdt.addClass("zpl_DNI"),headerEdt.off("click")),popup_body.append('<div class="zpl_crd"><div class="zpl_crdcnt">'+DelegationSettings.Modal.getViewModalHTML(viewData)+"</div></div>")},getViewModalHTML:function(viewData){var delegationType=ZPI18N.getString("zp.local.Permanent"),dateRange="";viewData.TypeOfDelegation==DelegationSettings.DELEGATION_TYPE.temporary&&(delegationType=ZPI18N.getString("zp.temporary"),dateRange=viewData.From+" - "+viewData.To);var html="";return html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.delegator"),this.setEmpData(viewData.employeeDtls)),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.delegatee"),this.setEmpData(viewData.delegateeDtls)),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.type"),'<span label="TypeOfDelegation">'+delegationType+"</span>"),html+=dateRange?DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.fromtodate"),'<span label="Date">'+dateRange+"</span>"):dateRange,html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.notification"),'<span label="is_Notify">'+(viewData.delegateeDtls.is_Notify?ZPI18N.getString("zp.delegateeanddelegator"):ZPI18N.getString("zp.delegatee"))+"</span>"),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.description"),'<span label="Description">'+(viewData.Description?viewData.Description:"-")+"</span>")},setEmpData:function(empData){if(void 0!=empData){let imageDiv='<div class="zselectbox__image"><img src="'+empData.employeePhoto+'"></img></div>';return'<div class="zselectbox__selected" popup="user" empid="'+empData.zuid+'">'+imageDiv+"<span><b>"+empData.employeeID+"</b> - "+ZPeople.decodeTxt(ZPeople.escapeHtml(empData.name))+"</span></div>"}},closeDelegSlide:function(isNeedURLChange){if(null!=DelegationSettings.TAB_ID){var container=DelegationSettings.TAB_ID;container.find("#delegatorList").length>0&&ZPeopleComponents.select($("#delegatorList")).destroy(),container.find("#delegateeList").length>0&&ZPeopleComponents.select($("#delegateeList")).destroy(),container.find("#delegationTypeList").length>0&&ZPeopleComponents.select($("#delegationTypeList")).destroy(),DelegationSettings.TAB_ID=null,DelegationSettings.CARD_ID=null}else DelegationSettings.VIEW_ID=null;DelegationSettings.Modal.SLIDER_MODAL.remove(),DelegationSettings.Modal.SLIDER_MODAL=null,isNeedURLChange&&DelegationSettings.changeDelegationUrl("close")},getModalHeaderStr:function(mode){return"view"===mode?ZPI18N.getString("zp.viewdelegation"):"edit"===mode?ZPI18N.getString("zp.editdelegheader"):ZPI18N.getString("zp.adddeleghdr")}},DelegationSettings.Validation={validateEmptyValue:function(value,valueParentEle,errorMsg){ZPUtil.Validation.isEmpty(value)&&DelegationSettings.Validation.showErrorMsg(valueParentEle,errorMsg)},showErrorMsg:function(valueParentEle,errorMsg){if(!valueParentEle.hasClass("ztextbox__error"))if(valueParentEle.length>0){var errorDiv=$('<span class="ztextbox--error__label">'+errorMsg+"</span>");"FromTo"==valueParentEle.attr("label")||"TypeOfDelegation"==valueParentEle.attr("label")?(errorDiv.insertAfter(valueParentEle.closest("div.zpl_idiv")),DelegationSettings.CARD_ID.find('[label="TypeOfDelegation"]').next("div").addClass("ztextbox__error"),DelegationSettings.CARD_ID.find("#delegDateRangeInput").addClass("ztextbox__error")):(valueParentEle.next("div").length>0?valueParentEle=valueParentEle.next("div"):valueParentEle.find("textarea").length>0&&(valueParentEle=valueParentEle.find("textarea")),valueParentEle.hasClass("ztextbox__error")||errorDiv.insertAfter(valueParentEle),valueParentEle.addClass("ztextbox__error"))}else ZPeople.Message.showFailureMsg(errorMsg)},removeErrorMsg:function(ele){var cardId=void 0==ele?DelegationSettings.CARD_ID:ele;cardId.find(".ztextbox--error__label").remove(),cardId.find(".ztextbox__error").removeClass("ztextbox__error")}},DelegationSettings.Add={save:function(delegationId){var empId,delegModal=DelegationSettings.CARD_ID;DelegationSettings.Validation.removeErrorMsg(),void 0==delegationId&&(empId=delegModal.find("#delegatorList").val(),DelegationSettings.Validation.validateEmptyValue(empId,delegModal.find('[label="Delegator"]'),ZPI18N.getString("zp.delegatorerr")));var delegId=delegModal.find("#delegateeList").val();DelegationSettings.Validation.validateEmptyValue(delegId,delegModal.find('[label="Delegatee"]'),ZPI18N.getString("zp.delegateeerr"));var isNotify=delegModal.find('[name="delgNotify"]:checked').attr("value"),desc=delegModal.find('[label="Description"]').val().trim();!ZPUtil.Validation.isEmpty(desc)&&desc.length>250&&DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="Description"]'),ZPI18N.getString("zp.maxdesclimit",[250]));var delegationType=delegModal.find("#delegationTypeList").val();if(1==delegationType){var date=delegModal.find('[label="FromTo"]').val();if(void 0==date||""==date)DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.delegdateerr"));else{var from,to,splitDate=date.split("-");splitDate.length<2||3==splitDate.length?DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.temporaryplaceholder")):2===splitDate.length?(from=splitDate[0],to=splitDate[1]):6===splitDate.length?(from=splitDate[0]+"-"+splitDate[1]+"-"+splitDate[2],to=splitDate[3]+"-"+splitDate[4]+"-"+splitDate[5]):DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.invaliddateerr")),!from||!to||Calendar.isvalidDate(from.trim())&&Calendar.isvalidDate(to.trim())||DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.invaliddateerr"))}}if(delegModal.find(".ztextbox--error__label").length<1){delegModal.find(".zpl_mfoter #sliderSbt").attr("disabled",!0);var configuration={Delegator:empId,Delegatee:delegId,From:from,To:to,Description:desc,TypeOfDelegation:delegationType,is_Notify:isNotify},params={method:"addUpdateDelegation",conreqcsr:csrfToken,configuration:JSON.stringify(configuration)};void 0!=delegationId&&(params.delegationId=delegationId),ZPeople.Request.send(DelegationSettings.DELEGATION_URL,params,DelegationSettings.Add.showSuccessMsg,void 0,DelegationSettings.failureCallBack)}},showSuccessMsg:function(data,params){if(data.success){params.delegationId?ZPeople.Message.success(ZPI18N.getString("zp.successdelegedit")):ZPeople.Message.success(ZPI18N.getString("zp.successdelegadd"));var mySpaceErecno=DelegationSettings.getMySpaceErecno();if(DelegationSettings.DELEGTABLE_ID.find("tbody tr").length>=0&&data.success.delegationId){if(void 0==mySpaceErecno||data.success.employeeDtls.erecno==mySpaceErecno||data.success.delegateeDtls.erecno==mySpaceErecno)DelegationSettings.Add.addDelegationRow(data.success);else if(mySpaceErecno){var delegation=ZPServices.getObjectFormArray(DelegationSettings.DELEGATION_JSON,"delegationId",data.success.delegationId,!0,!0);delegation&&DelegationSettings.DELEGATION_JSON.splice(delegation.index,1),DelegationSettings.DELEGTABLE_ID.find("tbody [delegationid='"+data.success.delegationId+"']").remove(),DelegationSettings.Modal.closeDelegSlide(!0)}}else DelegationSettings.Modal.closeDelegSlide(!0)}else data.errors&&("string"==typeof data.errors?ZPeople.Message.failure(data.errors):$.each(data.errors,function(key,errorMsg){DelegationSettings.Add.constructErrorMsg(key,errorMsg)}));void 0!=DelegationSettings.TAB_ID&&DelegationSettings.TAB_ID.find(".zpl_mfoter #sliderSbt").attr("disabled",!1)},addDelegationRow:function(singleDeleg){var tableBody=DelegationSettings.DELEGTABLE_ID.find("tbody");if(void 0!=singleDeleg)if(tableBody.parents(".zpl_tblres").removeClass("zpl_DNI"),tableBody.find("[delegationid='"+singleDeleg.delegationId+"']").length>0){var oldSingleDeleg=ZPServices.getObjectFormArray(DelegationSettings.DELEGATION_JSON,"delegationId",singleDeleg.delegationId,!1,!0);DelegationSettings.DELEGATION_JSON.splice(oldSingleDeleg.index,1,singleDeleg);var tableData=DelegationSettings.View.constructDelgData(singleDeleg);(tableRow=tableBody.find("[delegationid='"+singleDeleg.delegationId+"']")).empty(),tableRow.append(tableData)}else{void 0!=DelegationSettings.View.EMPTY_PAGE&&DelegationSettings.Common.removeEmptyData(),DelegationSettings.DELEGATION_JSON.splice(0,0,singleDeleg);var tableRow=DelegationSettings.View.constructDelgRow(singleDeleg);tableBody.prepend(tableRow)}DelegationSettings.View.addClickEvent(tableBody),DelegationSettings.Modal.closeDelegSlide(!0)},constructErrorMsg:function(key,errorMsg){var delegModal=DelegationSettings.CARD_ID;"From"!==key&&"To"!==key||(key="FromTo"),DelegationSettings.Validation.showErrorMsg(delegModal.find("[label='"+key+"']"),errorMsg)}},DelegationSettings.Edit={getSingleRecord:function(mode,delegationId){if(void 0!==(delegationId=delegationId||Layout.Page.childUrlParam.delegationid)){var singleDelegData=ZPServices.getObjectFormArray(DelegationSettings.DELEGATION_JSON,"delegationId",delegationId);void 0==singleDelegData||"edit"===mode&&!singleDelegData.hasEditDelPerm?ZPeople.Request.send(DelegationSettings.DELEGATION_URL,{method:"delegationOperation",mode:mode,conreqcsr:csrfToken,delegationId:delegationId},DelegationSettings.Edit.constructEditData,mode):DelegationSettings.Modal.openDelegSlide(void 0,singleDelegData,mode)}},constructEditData:function(data,param,mode){data.errors?DelegationSettings.Edit.constructDelegError(mode,data.errors):DelegationSettings.Modal.openDelegSlide(void 0,data,mode)},constructDelegError:function(mode,errorMsg){var messageHTML=$('<div class="col-lg-12 text-center" id="viewErrorModal"><div class="PArds"></div><h2 class="ZPNdt">'+errorMsg+"</h2></div>"),delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal");delegModalDiv.find("#viewErrorModal").remove(),delegModalDiv.modal("show"),delegModalDiv.find(".modal-header h6").html(DelegationSettings.Edit.getModalHeaderStr(mode)),delegModalDiv.find(".modal-body form").addClass("zpl_DNI"),delegModalDiv.find(".modal-body").append(messageHTML),delegModalDiv.find(".modal-footer .btn-default").removeClass("zpl_DNI")},getModalHeaderStr:function(mode){return"view"===mode?ZPI18N.getString("zp.viewdelegation"):"edit"===mode?ZPI18N.getString("zp.editdelegheader"):ZPI18N.getString("zp.adddeleghdr")}},DelegationSettings.Delete={deleteRecord:function(delegationId){if(void 0!==delegationId)if(isadmin||DelegationSettings.View.isDelegationAllowed){var deleteAlertMessage=new DeleteAlertMessage;deleteAlertMessage.title=ZPI18N.getString("zp.delegdelhdr"),deleteAlertMessage.despcription=ZPI18N.getString("zp.delegdeldesc"),deleteAlertMessage.callback=function(){DelegationSettings.Delete.sendDeleteRequest(delegationId)},deleteAlertMessage.show()}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.deniedtodeltdelegperm"))},sendDeleteRequest:function(delegationId){ZPeople.Request.send(DelegationSettings.DELEGATION_URL,{method:"delegationOperation",conreqcsr:csrfToken,mode:"delete",delegationId:delegationId},DelegationSettings.Delete.showMessage)},showMessage:function(data,params){if(data.errors)ZPeople.Message.failure(data.errors);else if(data.success&&params.delegationId){ZPeople.Message.success(data.success);var oldSingleDeleg=ZPServices.getObjectFormArray(DelegationSettings.DELEGATION_JSON,"delegationId",params.delegationId,!1,!0),selectedRow=DelegationSettings.DELEGTABLE_ID.find("tbody [delegationid="+params.delegationId+"]");"delete"===params.mode&&(DelegationSettings.DELEGATION_JSON.splice(oldSingleDeleg.index,1),selectedRow.remove(),DelegationSettings.DELEGTABLE_ID.find("tbody tr").length<1&&DelegationSettings.Common.emptyData())}}},DelegationSettings.Common={emptyData:function(){DelegationSettings.PAGE_ID.find("#add_delegation_btn").addClass("zpl_DNI"),DelegationSettings.DELEGTABLE_ID.parent(".zpl_tblres").addClass("zpl_DNI"),DelegationSettings.View.EMPTY_PAGE=new EmptyPages("zp_nd_template",ZPI18N.getString("zp.nodeleghdr"),ZPI18N.getString("zp.nodelegdesc"),DelegationSettings.PAGE_ID.find('[label="DelegEmptPage"]')),DelegationSettings.View.EMPTY_PAGE.setButton(ZPI18N.getString("zp.createdelegbtn"),DelegationSettings.View.createDeleg),DelegationSettings.View.EMPTY_PAGE.show()},removeEmptyData:function(){DelegationSettings.PAGE_ID.find("#add_delegation_btn").removeClass("zpl_DNI"),DelegationSettings.DELEGTABLE_ID.parent(".zpl_tblres").removeClass("zpl_DNI"),DelegationSettings.View.EMPTY_PAGE.remove(),DelegationSettings.View.EMPTY_PAGE=null}};var ZPA_Filters={};$.fn.setSearchProp=function(prop){var searchBox=$(this).parent().siblings();$(this).initOpenSearch(),searchBox.initCloseSearch(prop),searchBox.find("input").initSearch(prop)},$.fn.initOpenSearch=function(){$(this).on("click",function(){var searchBox=$(this).parent().siblings();searchBox.addClass("opn"),searchBox.find("input").focus()})},$.fn.initCloseSearch=function(prop){$(this).find(".PI_cls").on("click",function(){$(this).closeSearch(prop)})},$.fn.closeSearch=function(prop){var searchBox=$(this).parent();searchBox.searchRows(prop,""),searchBox.removeClass("opn"),searchBox.find("input").val("")},$.fn.initSearch=function(prop){$(this).on("keyup",function(e){var searchTxt=$(this).val();(13===e.keyCode||$.inArray(e.keyCode,ZPA_Common.splKeys)<=-1)&&$(this).parent().searchRows(prop,searchTxt),27==e.keyCode&&($(this).closeSearch(prop),e.preventDefault())})},$.fn.searchRows=function(prop,searchTxt){var pageId=$(this).parent().siblings(".zpl_rgtcnt"),rows=pageId.find("tbody").find("tr");if(!(rows.length<=0)){var id="",rowText="",desc="",isMatch=!1,isWorkflow=prop.mode==ZP_Automation_Mode.WORKFLOW,isApproval=prop.mode==ZP_Automation_Mode.APPROVAL,isCustomAction=prop.mode==ZP_Automation_Mode.CUSTOMACTION;pageId.find("#nodataImg").remove(),$.each(rows,function(index,row){id=$(row).attr(prop.id),rowText=$(row).find("[name$='_name']").text(),desc=isWorkflow||isApproval?ZPA_Common.DESCOBJLIST[prop.mode][id]:"",$.trim(rowText.toUpperCase()).includes($.trim(searchTxt.toUpperCase()))||void 0!=desc&&desc.toUpperCase().includes(searchTxt.toUpperCase())?($(row).show(),isMatch=!0):$(row).hide()}),isMatch?pageId.find("#nodataImg").remove():pageId.append(ZPUtil.noDataImg("","",isWorkflow?ZPI18N.getString("zp.wfsearchnodata"):isApproval?ZPI18N.getString("zp.apprsearchnodata"):isCustomAction?ZPI18N.getString("zp.casearchnodata"):ZPI18N.getString("zp.nodatafound")))}},function($){$.fn.preparePopOver=function(getThis){var settings=$.extend({targetId:"",target:"",html:"",keyname:"",callback:"",multi:!1,initobj:$(this),placement:"bottom",container:!1,maskneeded:!1},getThis);$(this).deRegisterPopOver(),$(this).attr("data-placement",settings.placement),$(this).attr("data-toggle","popover");var poppar={html:!0,trigger:"manual",content:settings.html,container:settings.container};$(this).popover(poppar).off().on("click",function(e){$(this).popover("show"),$("[data-toggle=popover]").not(this).popover("hide"),$("body").showHidePopOver($(this))}),$(this).on("show.bs.popover",function(){$("[data-toggle=popover]").not(this).popover("hide"),$("body").showHidePopOver($(this))}),$(this).on("shown.bs.popover",function(){""!==settings.keyname.trim()&&($("[name=list-tab-item]").off("click"),$("[name=list-tab-item]").on("click",function(e){var formListUl=$(this).closest("#lftFormList"),selectedTabKey=$(this).attr("formKey");formListUl.find("[name=list-tab-item]").removeClass("zpl_act"),$(this).addClass("zpl_act");var popOverDiv=$(this).closest("#formFieldList");popOverDiv.find("[name=fieldsParentDiv]").removeClass("zpl_act"),popOverDiv.find("#rghtFormList #"+selectedTabKey).addClass("zpl_act")}),$("["+settings.keyname+"]").off("click"),$("["+settings.keyname+"]").on("click",function(e){var className=$(this).closest("li").attr("class");if(!1===settings.multi){var fieldListPopOverBox=$(this).parents("#rghtFormList");fieldListPopOverBox.find("[name=fieldsParentDiv] ul [class~=zpl_act]").removeClass("zpl_act"),void 0!==className&&-1!==className.indexOf("zpl_act")?$(this).closest("li").removeClass("zpl_act"):$(this).closest("li").addClass("zpl_act")}if(!0===settings.multi&&(void 0!==className&&-1!==className.indexOf("zpl_act")?$(this).closest("li").removeClass("zpl_act"):$(this).closest("li").addClass("zpl_act")),"function"==typeof settings.callback){var html=$(settings.initobj).getContent();settings.callback.call(this,this,""!=settings.targetId?settings.targetId:settings.target,html)}}))}),$.fn.showHidePopOver=function(ele){$("body").off().on("click",function(event){$(ele).is(event.target)||0!==$(ele).has(event.target).length||0!==$(".popover").has(event.target).length||$(ele).popover("hide")})}},$.fn.deRegisterPopOver=function(){$(this).off("click")},$.fn.constructPopover=function(getThis){var settings=$.extend({targetId:"",html:"",keyname:"",callback:"",multi:!1,initobj:$(this),placement:"bottom",container:!1,maskneeded:!1},getThis);$(this).popOverUnregister(),$(this).attr("data-placement",settings.placement),$(this).attr("data-toggle","popover");var poppar={html:!0,trigger:"manual",content:settings.html,container:settings.container};function keyNameClick(ele){$("["+settings.keyname+"]").off("click"),$("["+settings.keyname+"]").on("click",function(e){var className=$(this).closest("li").attr("class");!1===settings.multi&&($(this).parents("[role=tooltip]").find("[class~=sel]").removeClass("sel"),void 0!==className&&-1!==className.indexOf("sel")?$(this).closest("li").removeClass("sel"):$(this).closest("li").addClass("sel"));if(!0===settings.multi&&(void 0!==className&&-1!==className.indexOf("sel")?$(this).closest("li").removeClass("sel"):$(this).closest("li").addClass("sel")),"function"==typeof settings.callback){var html=$(settings.initobj).getContent();settings.callback.call(this,this,settings.targetId,html);var stype=$(this).closest("[name=fieldsParentDiv]").attr("stype"),USERSEARCHDATA=$(settings.initobj).parent().data("USERSEARCHDATA"),USERSEARCHDATAID=$(settings.initobj).parent().data("USERSEARCHDATAID");if(!ZPUtil.Validation.isEmpty(stype)&&$(this).hasClass("sel"))if(jQuery.isEmptyObject(USERSEARCHDATA[stype]))USERSEARCHDATA[stype]=[this],USERSEARCHDATAID[stype]=[$(this).attr(val)],$(settings.initobj).parent().data("USERSEARCHDATAID",USERSEARCHDATAID),$(settings.initobj).parent().data("USERSEARCHDATA",USERSEARCHDATA);else{var mOpt=$(this).find("[name=mOpt]");USERSEARCHDATAID[stype].includes($(mOpt).attr("val"))||(USERSEARCHDATA[stype].push(this),USERSEARCHDATAID[stype].push($(mOpt).attr("val")),$(settings.initobj).parent().data("USERSEARCHDATAID",USERSEARCHDATAID),$(settings.initobj).parent().data("USERSEARCHDATA",USERSEARCHDATA))}}})}$(this).popover(poppar).on("click",function(e){$(this).popover("show"),$("[data-toggle=popover]").not(this).popover("hide"),$("body").showHide($(this))}),$(this).on("show.bs.popover",function(){$("[data-toggle=popover]").not(this).popover("hide"),$("body").showHide($(this))}),$(this).on("shown.bs.popover",function(){if(""!==settings.keyname.trim()){keyNameClick(this);var activefieldsParentDiv=$($(settings.initobj).getContent()).find("[name=fieldsParentDiv].tab-pane.fade.active.in");if(!ZPUtil.Validation.isEmpty($(activefieldsParentDiv).attr("stype"))&&0==$(activefieldsParentDiv).find("[name=list-group]").children().length){var i,stype=$(activefieldsParentDiv).attr("stype"),allDataObj1=$(activefieldsParentDiv).find("[name=list-group]"),e=$(settings.initobj).parent().data("USERSEARCHDATA")[stype],len=e.length,selTag=$(settings.initobj).parent().find("[ctagid]"),ctagId=[];for($.each(selTag,function(i,value){ctagId.push($(value).attr("ctagid"))}),i=0;i<len;i++){var mOpt=$(e[i]).find("[name=mOpt]"),val=$(mOpt).attr("val");ctagId.includes(val)?$(e[i]).addClass("sel"):$(e[i]).removeClass("sel"),allDataObj1.append(e[i])}}$($(settings.initobj).getContent()).find("[type=search]").off("keyup"),$($(settings.initobj).getContent()).find("[type=search]").on("keyup",function(){var parent=$(this).closest("[name=fieldsParentDiv]"),data=this.value.split(" "),stype=parent.attr("stype");if(ZPUtil.Validation.isEmpty(stype)){parent=$(this).closest("[srcTxt=true]"),data=this.value.split(" ");(allDataObj=parent.find("[name=list-group-item]")).hide(),allDataObj.hide(),$.each(data,function(i,v){allDataObj=allDataObj.filter("*:Contains('"+v+"')")}),allDataObj.show()}else{var mboxClone=ZPA_Popup.getFormFieldsHtml().clone();mboxClone.find("#contentDiv").addClass("ulItemrec"),mboxClone.find("[name=list-group]").attr("class","list-group ulRecipient");mboxClone.find("#dvRecipient li:first").clone(),mboxClone.find("#contentDiv :first").clone();var allDataObj,contLi=mboxClone.find("[name=list-group-item]").clone();(allDataObj=parent.find("[name=list-group-item]")).remove();var allDataObj1=parent.find("[name=list-group]");if(""!=this.value){if(1==stype)var results=EmployeeDropdown.getListData(this.value.toLowerCase(),"emp","AUTOMATION",this.value.toLowerCase());else if(2==stype)results=EmployeeDropdown.getListData(this.value.toLowerCase(),"dept","FEEDS",this.value.toLowerCase());else if(4==stype)results=EmployeeDropdown.getListData(this.value.toLowerCase(),"grp","HRCASES",this.value.toLowerCase());var selTag=$(settings.initobj).parent().find("[ctagid]"),ctagId=[];$.each(selTag,function(i,value){ctagId.push($(value).attr("ctagid"))}),$.each(results,function(i,value){var li=contLi.clone();li.find("[name=mOpt]").attr({val:value.id,"data-original-title":value.text}).text(ZPeople.decodeTxt(value.text)),ctagId.includes(value.id)&&$(li).addClass("sel"),allDataObj1.append(li)})}else{var i,e=(data=$(settings.initobj).parent().data("USERSEARCHDATA"))[stype],len=e.length;selTag=$(settings.initobj).parent().find("[ctagid]"),ctagId=[];for($.each(selTag,function(i,value){ctagId.push($(value).attr("ctagid"))}),i=0;i<len;i++){var mOpt=$(e[i]).find("[name=mOpt]"),val=$(mOpt).attr("val");ctagId.includes(val)?$(e[i]).addClass("sel"):$(e[i]).removeClass("sel"),allDataObj1.append(e[i])}}}keyNameClick(this)}),jQuery.expr.pseudos.Contains=function(a,i,m){return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0}}}),$.fn.showHide=function(ele){$("body").off().on("click",function(event){$(ele).is(event.target)||0!==$(ele).has(event.target).length||0!==$(".popover").has(event.target).length||$(ele).popover("hide")})}},$.fn.setHtmlContent=function(html,reflect){$(this).data("bs.popover").options.content=html,reflect&&$(this).popover("show")},$.fn.inputTag=function(parentTagJson,childTagArray){var insertDivBox=$(this),insertDiv=$(insertDivBox).children(":first"),disVal=parentTagJson.value,groupTagDiv=insertDiv.find("[pTagId="+parentTagJson.id+"]");0===groupTagDiv.length&&(groupTagDiv=$("<div pTagId="+parentTagJson.id+" attr="+parentTagJson.attr+'  class="zpl_tgrp"><p tagName="'+disVal+'">'+disVal+"</p></div>"),insertDiv.append(groupTagDiv)),$.each(childTagArray,function(key,childObj){var insertChild=$("<div cTagId="+childObj.id+'  class="zpl_tg"></div>');insertChild.append('<i name="closeIc" class="IC-cls"></i>'),insertChild.append("<span>"+childObj.value+"</span>"),insertChild.attr("attr",childObj.attr),groupTagDiv.append(insertChild),$(insertChild.find("[name=closeIc]")).on("click",function(){var tagParent=$(this).closest("[ptagid]");$(this).closest("[ctagid]").remove(),tagParent.find("[ctagid]").length<=0&&$(tagParent).remove()})})},$.fn.getHtmlContent=function(){return $(this).data("bs.popover").options.content}}(jQuery),ZPA_Util={getRecordTemplate:function(mode,callback){$.ajax({url:"/getRecTemp.zp",type:"POST",data:{method:"getRecTemplates",formId:ZPA_Common.getFormId(mode),conreqcsr:csrfToken},success:function(data){"function"==typeof callback&&callback(mode,data)}})},constructRecTempList:function(mode,data){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),items=[];!$.isEmptyObject(data)&&(data.hasOwnProperty("rt")&&data.rt.length>0||data.hasOwnProperty("mt")&&data.mt.length>0)&&$.each(data,function(tempType,templateObj){$.each(templateObj,function(i,tempDtl){var tempOptDtl={};tempOptDtl.tempId=tempDtl.templateId,tempOptDtl.tempName=decodeHTML(tempDtl.tempName),tempOptDtl.type="rt"==tempType?"2":"4",tempOptDtl.groupLabel="rt"==tempType?ZPI18N.getString("zp.lettertemp"):ZPI18N.getString("zp.mailmerge"),items.push(tempOptDtl)})});var value=pageId.find("#fvu_recTempSel").data("selectedValue"),selectedValue=void 0!=value&&""!==value?{tempId:value}:{};ZPeopleComponents.dropdownlist(pageId.find("#fvu_recTempDDList")).destroy(),ZPeopleComponents.dropdownlist("#fvu_recTempDDList",{value:selectedValue,items:items,dataMapping:{text:"tempName",label:"tempName",value:"tempId",groupLabel:"groupLabel"},showSearchField:!0,focusItemOnItemMouseover:!0,sort:!0,sortBy:"tempName",search:{by:["tempName"],criteria:"contains",highlightKeyword:!0},showSearchField:!0,displayType:"callout",searchFieldOptions:{placeholder:ZPI18N.getString("zp.search"),clearButton:!0},margin:{top:7},change:ZPA_Util.recTempListCallback,contentType:"text",lazyLoading:!0,checkedIcon:!0,checkedIconPosition:"left",messages:{noResults:ZPI18N.getString("zp.noresults")}})},recTempListCallback:function(event){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),itemData=event.detail.itemData,selectedValue=itemData.tempName,selectedValueId=itemData.tempId;ZPA_FieldUpdate.appendSelectedValue(pageId.find("#fvu_recTempSel"),selectedValue,selectedValueId)},getLookupFieldDts:function(getThis,callback){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),params={method:"getLookupList",mode:"systemRuleLookupList",selectedLookupType:JSON.parse(pageId.find("#fvu_paramName").attr("selecteddata")).fcId.toString(),conreqcsr:csrfToken};$.ajax({url:"/fieldUpdateLookupFields.zp",type:"POST",data:params,success:function(data){"function"==typeof callback&&callback(data)}})},constLkupFieldDtls:function(data){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),items=[];!$.isEmptyObject(data)&&data.length>0&&$.each(data,function(i,lookupValue){var lkupOptDtl={};lkupOptDtl.id=lookupValue.ID,lkupOptDtl.value=lookupValue.VALUE,items.push(lkupOptDtl)});var value=pageId.find("#fvu_pickListInp").data("selectedValue"),selectedValue=void 0!=value&&""!==value?{id:value}:{};ZPeopleComponents.dropdownlist("#fvu_PickList",{value:selectedValue,items:items,dataMapping:{text:"value",label:"value",value:"id"},className:"zdropdownlist--custom",showSearchField:!0,focusItemOnItemMouseover:!0,sort:!0,sortBy:"value",search:{by:["value"],criteria:"contains",highlightKeyword:!0},showSearchField:!0,displayType:"callout",searchFieldOptions:{placeholder:ZPI18N.getString("zp.search"),clearButton:!0},margin:{top:7},change:ZPA_Util.lkupListCallback,contentType:"text",checkedIcon:!0,checkedIconPosition:"left",isTextHTMLEncoded:!0})},lkupListCallback:function(event){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),itemData=event.detail.itemData,selectedValue=itemData.decodedItemText,selectedValueId=itemData.id;ZPA_FieldUpdate.appendSelectedValue(pageId.find("#fvu_pickListInp"),selectedValue,selectedValueId)},getUIDateTimeFormat:function(){var uiTimeFormat="hh:mm a"===timeFormat?"hh:mm tt":timeFormat;return dateFmt+" "+uiTimeFormat},get12HrsDateTimeFrmt:function(){return dateFmt+" hh:mm tt"}},ZPA_Util.TabPanel={loadFormFieldTabPanel:function(data,tabPanelProps){var tabs=[],formDtlAry=data.formNameJArray,formCompDtlAry=data.componentJObj;$.each(formDtlAry,function(index,formDtl){let tabObj={};$.each(formDtl,function(formKey,formObj){tabObj.label=formObj.lookupFullName,tabObj.panelId=formKey+"_panel",tabObj.id=formKey;let compItems=[];var componentJAry=formCompDtlAry[formKey];$.each(componentJAry,function(index,secObj){var secNames=Object.keys(secObj);$.each(secNames,function(index,secName){var fcInSecAry=secObj[secName];$.each(fcInSecAry,function(index,fcObj){fcObj.sectionName=secName,compItems.push(fcObj)})})}),tabObj.items=compItems}),tabs.push(tabObj)}),tabPanelProps.tabs=tabs,tabPanelProps.forElement="#"+tabPanelProps.forEleId,tabPanelProps.listboxOptions={dataMapping:{value:"label",text:"displayName",groupLabel:"sectionName"},showSearchField:!0,search:{by:"displayName",criteria:"contains"},searchFieldOptions:{placeholder:ZPI18N.getString("zp.search")},messages:{noResults:ZPI18N.getString("zp.noresults")},multiple:!1},ZPeopleComponents.tabbedlistboxpopup("#"+tabPanelProps.id,tabPanelProps)}};var ZPA_Actions={IS_LOADED:!1,ITEM_ARRAY:[{name:ZPI18N.getString("zp.emailalerts"),mode:"mailalert",action:"MAILALERT",oprType:"fetch_wf_mail_mapping",url:"/fetchMAlert.zp",method:"fetchMailAlertList",add:"ZPA_MailAlert.add"},{name:ZPI18N.getString("zp.fieldupdates"),mode:"fieldupdate",action:"FIELDUPDATE",oprType:"wf_fvu_list_mapping",url:"/fetchFvuList.zp",method:"fetchFUList",add:"ZPA_FieldUpdate.add"},{name:ZPI18N.getString("zp.workflow.checklist"),mode:"checklist",action:"CHECKLIST",oprType:"fetch_wf_checklist_mapping",url:"/fetchChecklist.zp",method:"fetchChecklist",add:"ZPA_Checklist.add"},{name:ZPI18N.getString("zp.webhooks"),mode:"webhook",action:"WEBHOOK",oprType:"wf_webhook_list_mapping",url:"/fetchWbkList.zp",method:"fetchWebhookList",add:"ZPA_Webhook.add"},{name:ZPI18N.getString("zp.customfunctions"),mode:"customfunction",action:"CUSTOMFN",oprType:"wf_customfn_list_mapping",url:"/cfList.zp",method:"list",add:"ZPA_CustomFunction.add"},{name:ZPI18N.getString("zp.esign.wf.tabname"),mode:"esign",action:"ESIGN",url:"/esign.zp",oprType:"wf_esign_list_mapping",method:"getESignConfigurationList",add:"ZPA_Esign.add"},{name:ZPI18N.getString("zp.postmessage"),mode:"postmessage",action:"POSTMESSAGE",oprType:"fetch_wf_post_mapping",url:"/fetchMAlert.zp",method:"fetchMailAlertList",add:"ZPA_PostMessage.add"}],initialCallback:function(){var pageId=settingsPage.container.find("#topSettMenu");pageId.append('<div><select id="selectId" value="MA"></select></div><div class="search-cmn"><i class="IC-lens"></i><input type="text" class="ztextbox" id="suggestFieldId" placeholder="Search data"><i class="IC-cls" onclick="clssearch(this)"></i></div><div class="zpl_rgt"> <button id="actionsButton" data-menu-id="demoMenuId" data-appearance="primary">Add Mail Alert</button> <ul id="demoMenuId" style="display:none;"><li name="actions">Add Mail Alert</li><li name="actions">Add Checklist</li><li name="actions">Add Field Update</li><li name="actions">Add Webhook</li><li name="actions">Add Custom Function</li><li name="actions">Add E-sign</li></ul><i class="zpl_ibg IC-lens" onclick="opnsearch(this)"></i><i class="zpl_ibg IC-filter-line"></i><i class="zpl_ibg IC-more"></i></div>'),pageId.removeClass("zp_dyn"),ZPA_Actions.init()},changeAction:function(event,data){switch(data.selectedValue){case"MA":ZPA_MailAlert.initPage();break;case"CH":ZPA_Checklist.initPage();break;case"FU":ZPA_FieldUpdate.initPage();break;case"WE":ZPA_Webhook.initPage();break;case"CF":ZPA_CustomFunction.initPage();break;case"ES":ZPA_Esign.initPage();break;case"PM":ZPA_PostMessage.initPage()}},add(formId,mode,holder,parentMode){ZPA_Actions.parentHolder=$(holder).parents(":eq(2)");let isFromChkList=!(!ZPA_Common.isNotNull(parentMode)||parentMode!=ZP_Automation_Mode.CHECKLIST);switch(mode){case ZP_Automation_Mode.EMAILALERT:ZPA_MailAlert.add(formId,isFromChkList);break;case ZP_Automation_Mode.FIELDUPDATE:ZPA_FieldUpdate.add(formId,isFromChkList);break;case ZP_Automation_Mode.CHECKLIST:ZPA_Checklist.add(formId);break;case ZP_Automation_Mode.WEBHOOK:ZPA_Webhook.add(formId);break;case ZP_Automation_Mode.CUSTOMFUNCTION:ZPA_CustomFunction.add(formId,isFromChkList);break;case ZP_Automation_Mode.ESIGN:ZPA_Esign.formId=formId,ZPA_Esign.add(formId);break;case ZP_Automation_Mode.POSTMESSAGE:ZPA_PostMessage.add(formId);break;case ZP_Automation_Mode.LETTERTEMPLATE:ZPA_RecordTemplate.add(formId);break;case"mmergeTemp":ZP_Mailmerge.loadAddTemplateSlider(formId)}},edit(templateId,formId,mode,holder,parentMode){ZPA_Actions.parentHolder=$(holder).parents(":eq(3)");let isFromChkList=!(!ZPA_Common.isNotNull(parentMode)||parentMode!=ZP_Automation_Mode.CHECKLIST);switch(mode){case ZP_Automation_Mode.EMAILALERT:ZPA_MailAlert.edit(templateId,formId,"",isFromChkList);break;case ZP_Automation_Mode.FIELDUPDATE:ZPA_FieldUpdate.editFieldUpdate(templateId,formId,isFromChkList);break;case ZP_Automation_Mode.CHECKLIST:ZPA_Checklist.edit(templateId,formId);break;case ZP_Automation_Mode.WEBHOOK:ZPA_Webhook.editWebhook(templateId,formId);break;case ZP_Automation_Mode.CUSTOMFUNCTION:ZPA_CustomFunction.editCF(templateId,formId,isFromChkList);break;case ZP_Automation_Mode.ESIGN:ZPA_Esign.formId=formId,ZPA_Esign.edit(templateId,formId);break;case ZP_Automation_Mode.POSTMESSAGE:ZPA_PostMessage.edit(templateId,formId);break;case ZP_Automation_Mode.LETTERTEMPLATE:ZPA_RecordTemplate.edit(templateId,formId);break;case"mmergeTemp":ZP_Mailmerge.loadAddTemplateSlider(formId)}},init(pageMode,formId,action_container,actions){var actionStr="";pageMode=ZPA_Common.isNotNull(pageMode)?pageMode:ZPA_Common.getPageMode();actions=void 0!=actions?actions:ZPA_Actions.ITEM_ARRAY;var skipped=[];pageMode==ZP_Automation_Mode.WORKFLOW&&(skipped=void 0!=ZPA_Workflow.Slider.formValue[formId]?ZPA_Workflow.Slider.formValue[formId].skipTriggerAction:[]),formId=void 0!=formId?formId:ZPeopleComponents.select("#"+pageMode+"_formList").value,$.each(actions,function(index,action){skipped.includes(action.action)||("postmessage"==action.mode?(void 0==isPostMessageConfigured&&ZPA_PostMessage.Slider.checkPostMessageIntegEnabled(),ZPA_PostMessage.canShowPostMessage&&(actionStr+=`<div class="zpl_gbox wd100_per" id=${action.mode}_holder><div class="zpl_gbxttl"><div><h4>${action.name}</h4></div><div class="zpl_gbxrgt"><i class="PI_plus ${void 0!==action.add?"":"DN"}" onclick="ZPA_Actions.add('${formId}','${action.mode}',this)"></i><i name="action_drop" id=${action.mode}_drop url=${action.url} oprType=${action.oprType} mode=${action.mode} method=${action.method} class="ztextbox__icon PI_addlist" "></i><div class="DN" id=${action.mode}_list></div></div></div></div>`)):"esign"==action.mode?(void 0==isAnySignConfigured&&Zsign.getEsignConfigurations(),isZSConfig&&(actionStr+=`<div class="zpl_gbox wd100_per" id=${action.mode}_holder><div class="zpl_gbxttl"><div><h4>${action.name}</h4></div><div class="zpl_gbxrgt"><i class="PI_plus ${void 0!==action.add?"":"DN"}" onclick="ZPA_Actions.add('${formId}','${action.mode}',this)"></i><i name="action_drop" id=${action.mode}_drop url=${action.url} oprType=${action.oprType} mode=${action.mode} method=${action.method} class="ztextbox__icon PI_addlist" "></i><div class="DN" id=${action.mode}_list></div></div></div></div>`)):action.mode==ZP_Automation_Mode.WEBHOOK&&ZPA_Common.getPageMode()==ZP_Automation_Mode.CUSTOMACTION||(actionStr+=`<div class="zpl_gbox wd100_per" id=${action.mode}_holder><div class="zpl_gbxttl"><div><h4>${action.name}</h4></div><div class="zpl_gbxrgt"><i class="PI_plus ${void 0!==action.add?"":"DN"}" onclick="ZPA_Actions.add('${formId}','${action.mode}',this, '${action.parentMode}')"></i><i name="action_drop" id=${action.mode}_drop url=${action.url} oprType=${action.oprType} mode=${action.mode} method=${action.method} class="ztextbox__icon PI_addlist" "></i><div class="DN" id=${action.mode}_list></div></div></div></div>`))});var container=void 0!=action_container?$(action_container):ZPA_Common.getMainContainer().find("[name=action_container]");container.append(actionStr),container.find("[name=action_drop]").off("click").on("click",function(event){ZPA_Actions.getList(event,pageMode,formId,action_container,this)})},getList(event,pageMode,formId,action_container,container){var target=$(event.target),url=target.attr("url"),oprType=target.attr("oprType"),method=target.attr("method"),mode=target.attr("mode"),params={formId:formId=void 0!=formId?formId:ZPeopleComponents.select("#"+pageMode+"_formList").value,conreqcsr:csrfToken};"undefined"!=oprType?(params.oprType=oprType,params.isAjax=!0):params.mode=mode,void 0!=method&&(params.method=method);var actmapCont=ZPA_Common.isNotNull(action_container)?action_container:$(container);actmapCont.find("#"+mode+"_drop").off(),$.ajax({url:url,type:"POST",data:params,success:function(data){var holder=$(container).parents(":eq(2)"),selectedValues=[];$.each(holder.find("tr"),function(index,row){selectedValues.push({templateId:$(row).attr("templateid"),formId:formId})}),ZPA_Actions.construct(data,mode,ZPA_Actions.selectAction,ZPA_Actions.deselectAction,pageMode,action_container,selectedValues)},complete:function(){actmapCont.find("#"+mode+"_drop").off().on("click",function(event){ZPA_Actions.getList(event,pageMode,formId,action_container,container)})}})},construct:function(items,mode,selCB,deselCB,pageMode,action_container,value){var holder,selectedValue=void 0!=value&&""!==value?value:{},dropDownList="";(ZPeopleComponents.isComponent("#"+mode+"_list")&&ZPeopleComponents.dropdownlist("#"+mode+"_list").destroy(!0),void 0==action_container)?((holder=$("#"+mode+"_holder")).find("#"+mode+"_list").remove(),holder.append("<div id="+mode+"_list></div>"),dropDownList=$("#"+mode+"_list")):((holder=action_container.find("#"+mode+"_holder")).find("#"+mode+"_list").remove(),holder.append("<div id="+mode+"_list></div>"),dropDownList=holder.find("#"+mode+"_list"));var dropDownProp={value:selectedValue,items:items,dataMapping:{text:"tempName",label:"tempName",value:"templateId"},sort:!0,sortBy:"value",search:{by:["tempName"],criteria:"contains",highlightKeyword:!0},margin:{top:7},select:selCB,deselect:deselCB,multiple:!0,isTextHTMLEncoded:!0,positionAlterable:!0};dropDownProp.multiple=mode!=ZP_Automation_Mode.WEBHOOK&&mode!=ZP_Automation_Mode.ESIGN&&mode!=ZP_Automation_Mode.LETTERTEMPLATE,ZPA_Common.ZCompProp.loadDropdownProp(dropDownProp);var dropDown=ZPeopleComponents.dropdownlist(dropDownList,dropDownProp);dropDown.customData=mode,dropDown.pageMode=pageMode,dropDown.action_container=action_container;var forElement=void 0==action_container?$("#"+mode+"_drop"):action_container.find("#"+mode+"_drop");dropDownList.is(":visible")?ZPeopleComponents.dropdownlist(dropDownList).close():ZPeopleComponents.dropdownlist(dropDownList).open({forElement:forElement})},selectAction(event){var target=event.currentTarget,mode=ZPeopleComponents.dropdownlist(target).customData,pageMode=ZPeopleComponents.dropdownlist(target).pageMode,action_container=ZPeopleComponents.dropdownlist(target).action_container;ZPA_Common.isNotNull(action_container)?action_container.find("#"+mode+"_holder"):$("#"+mode+"_holder");pageMode==ZP_Automation_Mode.BLUEPRINT?ZPA_Blueprint.Builder.appendActionsCallBack(mode,event.detail.value):mode==ZP_Automation_Mode.ESIGN?event.detail.value.length<=1&&ZPA_Actions.append(mode,event.detail.value,action_container):ZPA_Actions.append(mode,event.detail.value,action_container),void 0!=pageMode&&pageMode==ZP_Automation_Mode.CHECKLIST&&ZPA_Checklist.Slider.selectActionsCallback(pageMode,mode,event.detail.itemData)},deselectAction(event){var target=event.currentTarget,mode=ZPeopleComponents.dropdownlist(target).customData,pageMode=ZPeopleComponents.dropdownlist(target).pageMode,action_container=ZPeopleComponents.dropdownlist(target).action_container,holder=ZPA_Common.isNotNull(action_container)?action_container.find("#"+mode+"_holder"):$("#"+mode+"_holder"),actionId=event.detail.itemData.templateId;if(pageMode==ZP_Automation_Mode.CHECKLIST){var delActIcon=holder.find("[templateid="+actionId+"]").find("[action=delete]");ZPA_Checklist.Slider.removeAction(delActIcon,mode)}ZPA_Actions.append(mode,event.detail.value,action_container)},initValues(wfConfigDtls,parent){this.append(ZP_Automation_Mode.EMAILALERT,void 0!==wfConfigDtls.alertList?wfConfigDtls.alertList:wfConfigDtls.mailAlertIds,parent),this.append(ZP_Automation_Mode.CHECKLIST,void 0!==wfConfigDtls.checklist?wfConfigDtls.checklist:wfConfigDtls.checklistIds,parent),this.append(ZP_Automation_Mode.WEBHOOK,void 0!==wfConfigDtls.webHookList?wfConfigDtls.webHookList:[],parent),this.append(ZP_Automation_Mode.FIELDUPDATE,void 0!==wfConfigDtls.fieldUpdateList?wfConfigDtls.fieldUpdateList:wfConfigDtls.fieldUpdateIds,parent),this.append(ZP_Automation_Mode.CUSTOMFUNCTION,void 0!==wfConfigDtls.customfnList?wfConfigDtls.customfnList:wfConfigDtls.customfnIds,parent),void 0==isAnySignConfigured&&Zsign.getEsignConfigurations(),isZSConfig&&this.append(ZP_Automation_Mode.ESIGN,void 0!==wfConfigDtls.esignConfigList?wfConfigDtls.esignConfigList:wfConfigDtls.esignTempIds,parent),void 0==isPostMessageConfigured&&ZPA_PostMessage.Slider.checkPostMessageIntegEnabled(),ZPA_PostMessage.canShowPostMessage&&(isPostMessageConfigured=!0,this.append(ZP_Automation_Mode.POSTMESSAGE,void 0!==wfConfigDtls.postMessageList?wfConfigDtls.postMessageList:wfConfigDtls.postMessageIds,parent))},initDD(wfConfigDtls,parent){var holder=ZPeopleComponents.select(ZPA_Common.getMainContainer().find("#cActButTempl")).value==CAConstants.Template.LETTER?ZP_Automation_Mode.LETTERTEMPLATE:"mmergeTemp";this.append(holder,void 0!==wfConfigDtls.recordTempList?wfConfigDtls.recordTempList:wfConfigDtls.recordTempIds,parent)},append(mode,actions,parent){var pageMode=ZPA_Common.getPageMode(),action_container=(void 0==parent?ZPA_Common.getMainContainer():parent).find("#"+mode+"_holder");if(void 0!=action_container.children()[1]&&action_container.children()[1].remove(),0!=actions.length){var actionList="";$.each(actions,function(index,value){var templateId="";if(void 0!=value.templateId||void 0!=value.tempId){templateId+=void 0!=value.tempId?value.tempId:value.templateId;var formId=void 0!==ZPA_Common.getFormId()?ZPA_Common.getFormId():void 0!=value.FORMID?value.FORMID:ZPeopleComponents.select("#"+mode+"_formList").value;let tempName=void 0!=value.decodedItemText?ZPeople.decodeTxt(value.decodedItemText):value.tempName;pageMode==ZP_Automation_Mode.CHECKLIST?mode==ZP_Automation_Mode.FIELDUPDATE||mode==ZP_Automation_Mode.CUSTOMFUNCTION?actionList+=`<tr templateid=${templateId}><td templateid=${templateId} onclick='ZPA_Actions.edit("${templateId}","${formId}","${mode}",this, "${pageMode}")'><span>`+value.tempName+`</span></td><td width="80"><div class="zpl_hvr"><i action="delete" onclick="ZPA_Checklist.Slider.removeAction(this, '${mode}')" title=`+ZPI18N.getString("zp.delete")+' data-title-display-type="callout" class="PI_delete"></i></div></td></tr>':actionList+=`<tr templateid=${templateId}><td templateid=${templateId} onclick='ZPA_Actions.edit("${templateId}","${formId}","${mode}",this, "${pageMode}")'><span>`+ZSEC.Encoder.encodeForHTML(tempName)+`</span></td><td width="80"><div class="zpl_hvr"><i action="delete" onclick="ZPA_Checklist.Slider.removeAction(this, '${mode}')" title=`+ZPI18N.getString("zp.delete")+' data-title-display-type="callout" class="PI_delete"></i></div></td></tr>':pageMode==ZP_Automation_Mode.BLUEPRINT?mode==ZP_Automation_Mode.FIELDUPDATE||mode==ZP_Automation_Mode.CUSTOMFUNCTION?actionList+=`<tr templateid=${templateId}><td templateid=${templateId} onclick='ZPA_Actions.edit("${templateId}","${formId}","${mode}",this)'><span>`+value.tempName+`</span></td><td width="80"><div class="zpl_hvr"><i class="PI_delete" action="delete" onclick="ZPA_Blueprint.Builder.removeAction(this, '${mode}')" title=`+ZPI18N.getString("zp.delete")+' data-title-display-type="callout"></i></div></td></tr>':actionList+=`<tr templateid=${templateId}><td templateid=${templateId} onclick='ZPA_Actions.edit("${templateId}","${formId}","${mode}",this)'><span>`+ZSEC.Encoder.encodeForHTML(tempName)+`</span></td><td width="80"><div class="zpl_hvr"><i action="delete" class="PI_delete" onclick="ZPA_Blueprint.Builder.removeAction(this, '${mode}')" title=`+ZPI18N.getString("zp.delete")+' data-title-display-type="callout"></i></div></td></tr>':mode==ZP_Automation_Mode.FIELDUPDATE||mode==ZP_Automation_Mode.CUSTOMFUNCTION?actionList+=`<tr templateid=${templateId}><td templateid=${templateId} onclick='ZPA_Actions.edit("${templateId}","${formId}","${mode}",this)'><span>`+value.tempName+`</span></td><td width="80"><div class="zpl_hvr"><i action="delete" onclick="ZPA_Actions.removeItem(this, '${mode}')" title=`+ZPI18N.getString("zp.delete")+' data-title-display-type="callout" class="PI_delete"></i></div></td></tr>':mode==ZP_Automation_Mode.MAILMERGE||"mmergeTemp"==mode?actionList+=`<tr templateid=${templateId}><td templateid=${templateId} onclick='window.open("${value.url}")'><span>`+ZSEC.Encoder.encodeForHTML(value.tempName)+`</span></td><td width="80"><div class="zpl_hvr"><i action="delete" onclick="ZPA_Actions.removeItem(this, '${mode}')" title=`+ZPI18N.getString("zp.delete")+' data-title-display-type="callout" class="PI_delete"></i></div></td></tr>':actionList+=`<tr templateid=${templateId}><td templateid=${templateId} onclick='ZPA_Actions.edit("${templateId}","${formId}","${mode}",this)'><span>`+ZSEC.Encoder.encodeForHTML(tempName)+`</span></td><td width="80"><div class="zpl_hvr"><i action="delete" onclick="ZPA_Actions.removeItem(this, '${mode}')" title=`+ZPI18N.getString("zp.delete")+' data-title-display-type="callout" class="PI_delete"></i></div></td></tr>'}}),action_container.append($('<div class=zpl_idiv" name="action_table"><table class="zpl_tblbdr wd100_per zpl_tblcrsor zpl_whtbg"><tbody>'+actionList+"</tbody></table></div>"))}},removeItem(getThis,mode){ZPeopleComponents.isComponent("#"+mode+"_list")&&ZPeopleComponents.dropdownlist("#"+mode+"_list").destroy();var parentRow=$(getThis).parents(":eq(2)");0==parentRow.siblings().length?parentRow.parents("[name=action_table]").remove():parentRow.remove()},getSelectedParams(container,params,type){params=void 0!=params?params:{};var isCAMode=ZPA_Common.getPageMode()===ZP_Automation_Mode.CUSTOMACTION;if(void 0!=type&&type==CAConstants.Type.DOCUMENT){var holder=ZPeopleComponents.select(ZPA_Common.getMainContainer().find("#cActButTempl")).value==CAConstants.Template.LETTER?ZP_Automation_Mode.LETTERTEMPLATE+"_holder":"mmergeTemp_holder";params.recordTempIds=ZPA_Actions.getSelectedItems(holder,container)}else params.mailAlertIds=ZPA_Actions.getSelectedItems("mailalert_holder",container),params.checklistIds=ZPA_Actions.getSelectedItems("checklist_holder",container),params.fieldUpdateIds=ZPA_Actions.getSelectedItems("fieldupdate_holder",container),isCAMode||(params.webhookIds=ZPA_Actions.getSelectedItems("webhook_holder",container)),params.customfnIds=ZPA_Actions.getSelectedItems("customfunction_holder",container),void 0==isAnySignConfigured&&Zsign.getEsignConfigurations(),(isZSConfig||isCAMode)&&(params.esignTempIds=ZPA_Actions.getSelectedItems("esign_holder",container)),void 0==isPostMessageConfigured&&ZPA_PostMessage.Slider.checkPostMessageIntegEnabled(),(ZPA_PostMessage.isPostMessageEnabled||isCAMode)&&(params.postMessageIds=ZPA_Actions.getSelectedItems("postmessage_holder",container));return params},getSelectedItems(holder,container){var rows=void 0==container?$("#"+holder).find("tr"):container.find("#"+holder).find("tr"),isFromCA=ZPA_Common.getPageMode()===ZP_Automation_Mode.CUSTOMACTION,ids=isFromCA?[]:"";return $.each(rows,function(index,row){isFromCA?ids.push($(row).attr("templateid")):ids=""!=ids?ids+","+$(row).attr("templateid"):$(row).attr("templateid")}),ids},callBackActions(mode,params){var holder=ZPA_Actions.parentHolder,value=ZPA_Actions.getTemplatesAfterSave(mode,params),actions=ZPA_Actions.getSelectedActions(mode,holder,value);ZPA_Actions.append(mode,actions,holder.closest("[name=action_container]"))},getTemplatesAfterSave(mode,params){var value={};switch(mode){case ZP_Automation_Mode.EMAILALERT:value.templateId=params.mailalertId,value.tempName=params.templateName;break;case ZP_Automation_Mode.FIELDUPDATE:value.templateId=params.fieldupdateId,value.tempName=params.fvuName;break;case ZP_Automation_Mode.CHECKLIST:value.templateId=params.checklistId,value.tempName=params.label;break;case ZP_Automation_Mode.WEBHOOK:value.templateId=params.webhookId,value.tempName=params.webHookName;break;case ZP_Automation_Mode.CUSTOMFUNCTION:value.templateId=params.cfId,value.tempName=params.customfnDispName;break;case ZP_Automation_Mode.POSTMESSAGE:value.templateId=params.mailalertId,value.tempName=params.templateName;break;case ZP_Automation_Mode.LETTERTEMPLATE:value.templateId=params.templateId,value.tempName=params.templateName;break;case"mmergeTemp":value.templateId=params.templateId,value.tempName=params.templateName,value.url=params.url;break;case ZP_Automation_Mode.ESIGN:value.templateId=params.confId,value.tempName=params.confName}return value},getSelectedActions(mode,holder,selectedValue){var actions=[],rows=holder.find("tr"),selectedId="";return void 0!=selectedValue&&(actions.push(selectedValue),selectedId=selectedValue.templateId),mode!=ZP_Automation_Mode.WEBHOOK&&$.each(rows,function(index,row){var action={};selectedId!=$(row).attr("templateid")&&(action.templateId=$(row).attr("templateid"),action.tempName=ZPA_Common.getReplaceName(mode,$(row).find("span").text()),actions.push(action))}),actions},getKey(mode){var key={};switch(mode){case ZP_Automation_Mode.EMAILALERT:key="mailalertId";break;case ZP_Automation_Mode.FIELDUPDATE:key="fieldupdateId";break;case ZP_Automation_Mode.CHECKLIST:key="checklistId";break;case ZP_Automation_Mode.WEBHOOK:key="webhookId";break;case ZP_Automation_Mode.CUSTOMFUNCTION:key="cfId";break;case ZP_Automation_Mode.POSTMESSAGE:key="mailalertId"}return key}},ZPA_MailAlert={IS_LOADED:!1,defaultTempMsg:[],initPage:function(formId){var pageId=ZPA_Common.getParentPageId(),body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+"</th><th>"+ZPI18N.getString("zp.templatename")+'</th><th width="80"></th></tr></thead><tbody>';if(formId=ZPA_Common.isNotNull(formId)?formId:ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.EMAILALERT)).getValue(),!ZPA_MailAlert.IS_LOADED){pageId.find(".zpl_rgtcnt").empty(),ZPA_Common.Loader.appendPageLoading(pageId);var params={formId:formId,method:"list",conreqcsr:csrfToken},serviceName=settingsUrlProps.currentMode;serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),$.post("/mailalertList.zp",params,function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.EMAILALERT))return ZPA_Common.Loader.removePageLoading(pageId),!1;if(ZPA_MailAlert.IS_LOADED=!0,data.length>0)pageId.find("#add_mailalert").removeClass("DN"),$.each(data,function(index,row){body+='<tr alertid="'+this.FORM_TEMPLATE_ACTION_ID+'" formid="'+this.FORMID+'" onclick="ZPA_MailAlert.editSlide(\''+this.FORM_TEMPLATE_ACTION_ID+"', '"+this.FORMID+"')\"><td>"+row.TEMPLATE_NAME+"</td><td><span>"+row.DISPLAY_NAME+"</span></td><td><span>"+row.MESSAGE_TEMPLATE_NAME+'</span></td><td><div class="zpl_hvr"><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" alertid="'+this.FORM_TEMPLATE_ACTION_ID+'" onclick="ZPA_Common.deleteConfirmationPopup(this,  \''+ZP_Automation_Mode.EMAILALERT+"',  ZPA_MailAlert.deleteMailAlert)\"></i></div></td></tr>"}),body+="</tbody></table></div>",pageId.find(".zpl_rgtcnt").append(body);else{pageId.find("#add_mailalert").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.EMAILALERT),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.EMAILALERT),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.EMAILALERT),pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.addemailalert"),ZPA_MailAlert.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)})}},addSlide:function(){if(ZPA_Common.validateAddConfig()){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.EMAILALERT)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/mailalert/add-formid:"+formId}},add:function(formId,isFromChklist){ZPA_MailAlert.Slider.construct(ZPI18N.getString("zp.addemailalert"),isFromChklist),formId=ZPA_Common.getPageMode()==ZP_Automation_Mode.EMAILALERT?settingsUrlProps.urlParamsArr.formid:formId,ZPA_MailAlert.Slider.loadDefault(!1,formId),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.EMAILALERT),500)},editSlide:function(alertid,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/mailalert/edit-formid:"+formId+"/mailalertid:"+alertid},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_MailAlert.edit(editParams.mailalertid,editParams.formid)},edit:function(alertid,formId,headerName,isFromChklist,extraparam={}){headerName=ZPUtil.Validation.isEmpty(headerName)?ZPI18N.getString("zp.editemailalert"):headerName,ZPA_MailAlert.Slider.construct(headerName,isFromChklist,extraparam),ZPA_MailAlert.Slider.loadDefault(!0,formId),setTimeout(function(){var params={formId:formId,mailAlertId:alertid,method:"confMailAlertDtls",conreqcsr:csrfToken};$.ajax({url:"/confMailAlertDtls.zp",type:"POST",data:params,success:function(getMAlertDts){ZPA_MailAlert.Slider.edit(getMAlertDts),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.EMAILALERT),500)}})},500)},deleteMailAlert:function(thisObj){var delIcObj=thisObj.delIcObj,mailAlertId=$(delIcObj).attr("alertId"),params={mailAlertId:mailAlertId,method:"delete",conreqcsr:csrfToken};$.ajax({url:"/deleteMailalert.zp",type:"POST",data:params,success:function(data){if("success"===data.response){ZPA_MailAlert.IS_LOADED=!1;var actBody=ZPA_Common.getParentPageId().find("[name=action_body]");actBody.find("[alertid="+mailAlertId+"]").remove(),ZPeople.Message.success(ZPI18N.getString("zp.emailalertdeleted")),0==actBody.find("tr[alertid]").length&&ZPA_MailAlert.initPage()}else void 0!==data.wfmapping&&ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.EMAILALERT,data.wfmapping)}})},fetchDefaultTemplateMessage:function(formId){if(void 0==ZPA_MailAlert.defaultTempMsg[formId]){var params={formId:formId,method:"fetchApprovalDefaultMessageTemplate",conreqcsr:csrfToken};$.ajax({url:"/fetchApprovalDefaultMessageTemplate.zp",type:"POST",async:!1,data:params,success:function(data){ZPA_MailAlert.defaultTempMsg[formId]=data}})}},resetMailAertConfig:function(){ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.EMAILALERT,!1);var currMode=ZPA_Messages.getCurrentMode(),pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILALERT);ZPA_Common.removeErrorDiv(pageId);var formId=ZPeopleComponents.select("#mailalert_formList").getValue();pageId.find("#mail_name").val(""),ZPeopleComponents.select("#from_address").setAttribute("selectedValue","myLogin"),ZPA_Messages.resetMailTemplate(ZP_Automation_Mode.EMAILALERT,formId),ZPA_Messages.getTemplates(ZP_Automation_Mode.EMAILALERT),pageId.find("#fluplDiv").empty(),currMode==ZP_Automation_Mode.EMAILALERT&&ZPA_FileUpload.loadFileUploadTemplates(currMode)}};ZPA_MailAlert.Slider={construct:function(header,isFromChklist,extraparam){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.EMAILALERT),tab.cardId="mail_cards",tab.validate=ZPA_MailAlert.Slider.save,ZPA_MailAlert.Slider.mailModal=new sliderModal(header,tab),ZPA_MailAlert.Slider.mailModal.mediumSize=!0,ZPA_MailAlert.Slider.mailModal.construct(),ZPA_MailAlert.Slider.extraparam=extraparam,ZPA_Common.CloseAlert.construct(ZPA_MailAlert.Slider.mailModal),ZPA_MailAlert.Slider.mailModal.setCloseCallback(function(){ZPA_MailAlert.Slider.remove()});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILALERT);pageId.data("modalInstance",ZPA_MailAlert.Slider.mailModal),ZPA_Common.setRelativeContainer(pageId.find("#"+tab.cardId));var $mail_cards=pageId.find("#mail_cards");$mail_cards.append(ZPA_Common.Cards.construct("ma_basic",ZPA_MailAlert.ContainerBody.BASIC)),$mail_cards.append(ZPA_Common.Cards.construct("ma_message",ZPA_Messages.getMessageTemplate(ZPA_Messages.getCurrentMode(),tab.id),ZPI18N.getString("zp.message"))),ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.EMAILALERT)),ZPA_Common.setBasePage(pageId,isFromChklist)},remove:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILALERT);if(ZPeopleComponents.select(pageId.find("#mailalert_formList")).destroy(),void 0!=pageId.find("#chooseTemplate").data("zselect")&&ZPeopleComponents.select(pageId.find("#chooseTemplate")).destroy(),void 0!=pageId.find("#fluplTemp").data("zselect")&&ZPeopleComponents.dropdownlist("#fluplTemp").destroy(),ZPA_Messages.getCurrentMode()==ZPA_Messages.HRCASE_NOTIFICATION&&void 0!=pageId.find("#togrp_hrcase").data("zselect")&&ZPeopleComponents.select("#togrp_hrcase").destroy(),ZPA_Common.getPageMode()==ZP_Automation_Mode.EMAILALERT){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.EMAILALERT)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/mailalert-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/mailalert"}ZPA_Editor.destroy(),ZPA_MailAlert.Slider.mailModal.remove()},validateMailAlert:function(mailObj){var isValidMail=!0,pageId=(ZPA_Messages.getCurrentMode(),ZPA_Common.getPageId(ZP_Automation_Mode.EMAILALERT));ZPA_Common.removeErrorDiv(pageId);var mailAlertName=mailObj.templateName,mailAlertDesc=mailObj.description;return""===mailAlertName.trim()&&(ZPA_Common.appendErrorDiv(pageId.find("#mail_name"),ZPI18N.getString("zp.enteralertname")),isValidMail=!1),mailAlertName.length>100&&(ZPA_Common.appendErrorDiv(pageId.find("#mail_name"),ZPI18N.getString("zp.emlalrtnameexc")),isValidMail=!1),mailAlertDesc.length>250&&(ZPA_Common.appendErrorDiv(pageId.find("#mail_desc"),ZPI18N.getString("zp.maxdesclimit",[250])),isValidMail=!1),isValidMail=ZPA_Messages.validateMailTemplateObject(ZP_Automation_Mode.EMAILALERT,mailObj)&&isValidMail},save:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILALERT),curMode=ZPA_Messages.getCurrentMode();ZPA_Common.disableSaveBtn(pageId);var formId=ZPA_Common.getFormId(ZP_Automation_Mode.EMAILALERT),mailObj=ZPA_Messages.getConfDetails(ZP_Automation_Mode.EMAILALERT,formId,curMode);if(mailObj.templateName=pageId.find("#mail_name").val(),mailObj.description=pageId.find("#mail_desc").val(),void 0!=pageId.attr("alertid")&&(mailObj.formTemplateId=pageId.attr("alertid")),ZPA_MailAlert.Slider.validateMailAlert(mailObj)){var formData=new FormData;formData.append("configuration",JSON.stringify(mailObj)),formData.append("method","confMailAlert"),formData.append("conreqcsr",csrfToken),curMode===ZP_Automation_Mode.EMAILALERT&&ZPA_FileUpload.appendUploadedFile(formData),$.ajax({url:"/confMailAlert.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(data){if(ZPA_Common.enableSaveBtn(pageId),"failure"==data.status)ZPeople.Message.failure(data.message);else{if("-1"==data.message)return void ZPeople.Message.failure("Upgrade subscription to add more mailalerts");ZPA_Common.isNotNull(mailObj.formTemplateId)?ZPeople.Message.success(ZPI18N.getString("zp.emlaltupd")):ZPeople.Message.success(ZPI18N.getString("zp.emlaltadd"));var pageMode=ZPA_Common.getPageMode();mailObj.mailalertId=data.message,ZPA_Common.isFromChecklistPage(pageId)&&(pageMode=ZP_Automation_Mode.CHECKLIST),pageMode==ZP_Automation_Mode.WORKFLOW||pageMode==ZP_Automation_Mode.CUSTOMACTION?ZPA_Actions.callBackActions(ZP_Automation_Mode.EMAILALERT,mailObj):pageMode==ZP_Automation_Mode.BLUEPRINT?ZPA_Blueprint.Builder.callBackActions(ZP_Automation_Mode.EMAILALERT,mailObj):pageMode==ZP_Automation_Mode.CHECKLIST?ZPA_Checklist.Slider.callBackonSaveActions(ZP_Automation_Mode.EMAILALERT,mailObj):pageMode==ZP_Automation_Mode.EMAILALERT&&ZPA_MailAlert.Slider.afterSaveCB(formId),curMode==ZPA_Messages.HRCASE_NOTIFICATION&&casesSettings.Notifications.afterSave(mailObj),ZPA_MailAlert.Slider.remove()}},error:function(errResp){ZPA_Common.enableSaveBtn(pageId);var errJSON=errResp.responseJSON;ZPA_Common.isNotNull(errJSON.error)&&ZPeople.Message.failure(errJSON.error)}})}else ZPA_Common.enableSaveBtn(pageId)},afterSaveCB:function(formId){ZPA_MailAlert.IS_LOADED=!1,formId!=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.EMAILALERT)).getValue()&&ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.EMAILALERT)).setValue(formId)},loadDefault:function(isEdit,selFormId){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILALERT),currmode=ZPA_Messages.getCurrentMode();ZPA_Common.getFormList(ZP_Automation_Mode.EMAILALERT,ZPA_Common.getServiceName());let formListProp={options:ZPA_Common[ZPA_Common.getFormListMode(ZP_Automation_Mode.EMAILALERT,ZPA_Common.getServiceName())],dataMapping:{label:"dispName",value:"formId",title:"dispName"},change:ZPA_MailAlert.resetMailAertConfig};$.isEmptyObject(selFormId)||"0"==selFormId||(formListProp.selectedValue=selFormId,(isEdit||ZPA_Common.getPageMode()!=ZP_Automation_Mode.EMAILALERT)&&(formListProp.disabled=!0)),pageId.find("#mail_name").on("change",function(){ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.EMAILALERT)}),ZPA_Common.ZCompProp.loadSelectListProp(formListProp),ZPeopleComponents.select("#mailalert_formList",formListProp),selFormId=ZPeopleComponents.select("#mailalert_formList").getValue(),isEdit||ZPA_Messages.getTemplates(currmode),ZPA_Messages.loadTemplate(ZP_Automation_Mode.EMAILALERT,selFormId),currmode==ZP_Automation_Mode.EMAILALERT&&ZPA_FileUpload.loadFileUploadTemplates(currmode)},edit:function(data){var currmode=ZPA_Messages.getCurrentMode(),pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILALERT);if(ZPeopleComponents.select(pageId.find("#mailalert_formList")).setAttribute("selectedValue",data.formId),pageId.attr("alertid",data.formTemplateId),currmode===ZPA_Messages.TIMESHEET_NOTIFICATION)pageId.find("#mail_name").addClass("disabled"),pageId.find("#to_grp").addClass("zpl_op5 zpl_evntno"),pageId.find("#mailalert_formList").parents(".zpl_secn").hide();else if(currmode===ZPA_Messages.HRCASE_NOTIFICATION)if(void 0==data.to.formfields||$.isEmptyObject(data.to.formfields))if(void 0==data.to.sysConfList["ZP.HRCASE.CASEOWNER"]){pageId.find("#to_grp").removeClass("zpl_inpgrp").empty().append("<div id='togrp_hrcase'></div>"),ZPeopleComponents.select(pageId.find("#togrp_hrcase"),{options:casesSettings.Notifications.AGENT_LIST,"content-type":"text",dataMapping:{label:"label",value:"value"}});var setval=$.grep(casesSettings.Notifications.AGENT_LIST,function(ele){return void 0!=data.to.sysConfList[ele.value]});ZPeopleComponents.select(pageId.find("#togrp_hrcase")).setValue(setval[0])}else pageId.find("#to_grp").removeClass("zpl_inpgrp").html('<input id="to_caseowner" autocomplete = "off" type="text" class="ztextbox"  value="'+data.to.sysConfList["ZP.HRCASE.CASEOWNER"]+'" disabled = "disabled"/>');else pageId.find("#to_grp").html('<input id="to_requestor" autocomplete = "off" type="text" formfield="'+Object.keys(data.to.formfields)[0]+'" class="ztextbox"  value="'+Object.values(data.to.formfields)[0]+'" disabled = "disabled"/>');else if(currmode===ZPA_Messages.OFCREADINESS_NOTIFICATION){var toVal="",toSysVal="ZP.WORKPLACEREDINESS.EMPLOYEE";$.each(data.to.sysConfList,function(i,v){return toVal=v,toSysVal=i,!1}),pageId.find("#to_grp").html('<input name="ofr_notify_to" toSysVal="'+toSysVal+'" autocomplete = "off" type="text" class="ztextbox"  value="'+toVal+'" disabled = "disabled"/>')}else if(currmode===ZPA_Messages.OFFBOARDING_NOTIFICATION){toVal="",toSysVal="ZP.OFFBOARDING.EMPLOYEE";$.each(data.to.sysConfList,function(i,v){return toVal=v,toSysVal=i,!1}),pageId.find("#to_grp").html('<input name="ofr_notify_to" toSysVal="'+toSysVal+'" autocomplete = "off" type="text" class="ztextbox"  value="'+toVal+'" disabled = "disabled"/>')}else if(currmode===ZPA_Messages.APPOINTMENT_NOTIFICATION){pageId.find("#to_grp").removeClass("zpl_inpgrp").empty().append("<div id='togrp_apptLtrTo'></div>");let opts=ApptLtr.MailNotification.TO_ADDRESS;ZPeopleComponents.select(pageId.find("#togrp_apptLtrTo"),{options:opts,"content-type":"text",dataMapping:{label:"label",value:"value"},randomDropdownListId:!0});setval=opts.filter(o=>void 0!=data.to.sysConfList[o.value]);ZPeopleComponents.select(pageId.find("#togrp_apptLtrTo")).setValue(setval[0])}pageId.find("#mail_name").val(decodeHTML(data.templateName)),pageId.find("#mail_desc").val(data.description),ZPA_Messages.setMailTemplate(pageId,ZP_Automation_Mode.EMAILALERT,data)}},ZPA_MailAlert.ContainerBody={BASIC:'<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+'</label></div><div><select type="text" id="mailalert_formList" class="ztextbox" value=""></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.emailalertname")+'</label></div><div><input type="text" id="mail_name" placeholder="" class="ztextbox"></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.description")+'</label></div><div><textarea id="mail_desc" type="text" class="ztextbox" rows="3"></textarea></div></div>'},(ZPA_FieldUpdate={1:[EMPTY_VALUE_FIELD,FormConstants.FieldType.TEXT,FormConstants.FieldType.EMAIL_ADDRESS,FormConstants.FieldType.NUMBER,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.DATE,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.PHONE_NUMBER,FormConstants.FieldType.PICKLIST,FormConstants.FieldType.SCRIPT],4:[EMPTY_VALUE_FIELD,FormConstants.FieldType.EMAIL_ADDRESS],5:[EMPTY_VALUE_FIELD,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.NUMBER,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.SCRIPT],25:[EMPTY_VALUE_FIELD,FormConstants.FieldType.TEXT,FormConstants.FieldType.NUMBER,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.PICKLIST,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.PHONE_NUMBER],10:[EMPTY_VALUE_FIELD,FormConstants.FieldType.DATE,FormConstants.FieldType.SCRIPT],22:[EMPTY_VALUE_FIELD,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.SCRIPT],9:[EMPTY_VALUE_FIELD,FormConstants.FieldType.CHECK_BOX],3:[EMPTY_VALUE_FIELD,FormConstants.FieldType.TEXT,FormConstants.FieldType.TEXT_AREA,FormConstants.FieldType.NUMBER,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.PICKLIST,FormConstants.FieldType.DATE,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.PHONE_NUMBER,FormConstants.FieldType.SCRIPT],19:[EMPTY_VALUE_FIELD,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.NUMBER,FormConstants.FieldType.SCRIPT],8:[EMPTY_VALUE_FIELD,FormConstants.FieldType.PHONE_NUMBER],6:[EMPTY_VALUE_FIELD,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.NUMBER,FormConstants.FieldType.SCRIPT],18:[FormConstants.FieldType.FILE_UPLOAD],50:[EMPTY_VALUE_FIELD,HOURS_IN_SECONDS],51:[EMPTY_VALUE_FIELD,HOURS_IN_MINUTES],ALLOWED_FIELDS:[FormConstants.FieldType.TEXT,FormConstants.FieldType.CHECK_BOX,FormConstants.FieldType.TEXT_AREA,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.EMAIL_ADDRESS,FormConstants.FieldType.NUMBER,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.DATE,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.PHONE_NUMBER,FormConstants.FieldType.PICKLIST,FormConstants.FieldType.FILE_UPLOAD],IS_LOADED:!1,fieldUpdateId:"",FORMFIELDS_JSON:{},FC_ITEMJSON:{},initPage:function(formId){ZPA_FieldUpdate.IS_LOADED||(formId=ZPA_Common.isNotNull(formId)?formId:ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue(),ZPA_FieldUpdate.constructFVUListing(formId))},constructFVUListing:function(formId){var pageId=ZPA_Common.getParentPageId();ZPA_FieldUpdate.resetFVUListing();var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+'</th><th width="100"></th></tr></thead><tbody>',serviceName=ZPA_Common.getServiceName();formId=void 0!=formId&&""!=formId?formId:0,ZPA_Common.Loader.appendPageLoading(pageId);var params={formId:formId,method:"fetchFieldUpdateList",conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),$.post("/getFieldUpdateList.zp",params,function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.FIELDUPDATE))return ZPA_Common.Loader.removePageLoading(pageId),!1;if(ZPA_FieldUpdate.IS_LOADED=!0,data.length>0)pageId.find("#add_fieldupdate").removeClass("DN"),$.each(data,function(index,row){body+='<tr fvuId="'+row.FIELD_VALUE_UPDATE_ID+'" onclick="ZPA_FieldUpdate.editSlide(\''+row.FIELD_VALUE_UPDATE_ID+"', '"+row.FORMID+"')\"><td>"+decodeHTML(row.DISPLAYNAME)+"</td><td><span>"+row.DISPLAY_NAME+'</span></td><td><div class="zpl_hvr"><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" fvuId="'+this.FIELD_VALUE_UPDATE_ID+'" onclick="ZPA_Common.deleteConfirmationPopup(this,  \''+ZP_Automation_Mode.FIELDUPDATE+"',  ZPA_FieldUpdate.deleteFieldUpdate)\"></i></div></td></tr>"}),body+="</tbody></table></div>",pageId.find(".zpl_rgtcnt").append(body);else{pageId.find("#add_fieldupdate").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.FIELDUPDATE),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.FIELDUPDATE),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.FIELDUPDATE),pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.fieldupdate.add"),ZPA_FieldUpdate.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)})},constructSlider:function(header,isFromChklist){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.FIELDUPDATE),tab.cardId="fu_cards",tab.validate=ZPA_FieldUpdate.saveFieldUpdate,ZPA_FieldUpdate.mailModal=new sliderModal(header,tab),ZPA_FieldUpdate.mailModal.mediumSize=!0,ZPA_FieldUpdate.mailModal.construct(),ZPA_Common.CloseAlert.construct(ZPA_FieldUpdate.mailModal),ZPA_FieldUpdate.mailModal.setCloseCallback(function(){ZPA_FieldUpdate.removeSlider(ZPA_FieldUpdate.mailModal)});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);pageId.data("modalInstance",ZPA_FieldUpdate.mailModal);var $fu_cards=pageId.find("#"+tab.cardId);ZPA_Common.setRelativeContainer($fu_cards),$fu_cards.append(ZPA_FieldUpdate.getContainerBody("fu_basic")),$fu_cards.append(ZPA_FieldUpdate.getContainerBody("fu_config")),ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.FIELDUPDATE)),ZPA_Common.setBasePage(pageId,isFromChklist)},removeSlider:function(fu_Modal){ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);if(ZPA_Common.getPageMode()==ZP_Automation_Mode.FIELDUPDATE){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/fieldupdate-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/fieldupdate"}fu_Modal.remove()},loadDefault:function(isEdit,formId){ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.getFormList(ZP_Automation_Mode.FIELDUPDATE,ZPA_Common.getServiceName());let fu_formListProp={change:ZPA_FieldUpdate.resetFieldUpdateConfig,options:ZPA_Common[ZPA_Common.getFormListMode(ZP_Automation_Mode.FIELDUPDATE,ZPA_Common.getServiceName())],dataMapping:{label:"dispName",value:"formId",title:"dispName"}};ZPA_Common.isNotNull(formId)&&"0"!=formId&&(fu_formListProp.selectedValue=formId,(isEdit||ZPA_Common.getPageMode()!=ZP_Automation_Mode.FIELDUPDATE)&&(fu_formListProp.disabled=!0)),ZPA_Common.ZCompProp.loadSelectListProp(fu_formListProp),ZPeopleComponents.select("#fieldupdate_formList",fu_formListProp),ZPA_FieldUpdate.resetFieldUpdateConfig()},addSlide:function(){if(ZPA_Common.validateAddConfig()){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/fieldupdate/add-formid:"+formId}},add:function(formId,isFromChklist){ZPA_FieldUpdate.constructSlider(ZPI18N.getString("zp.fieldupdate.add"),isFromChklist),formId=ZPA_Common.getPageMode()==ZP_Automation_Mode.FIELDUPDATE?ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue():formId,ZPA_FieldUpdate.loadDefault(!1,formId),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.FIELDUPDATE),500)},editSlide:function(fvuId,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/fieldupdate/edit-formid:"+formId+"/fieldupdateid:"+fvuId},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_FieldUpdate.editFieldUpdate(editParams.fieldupdateid,editParams.formid)},editFieldUpdate:function(fuId,formId,isFromChklist){ZPA_FieldUpdate.constructSlider(ZPI18N.getString("zp.fieldupdate.edit"),isFromChklist),ZPA_FieldUpdate.loadDefault(!0,formId);var params={formId:formId,fuId:fuId,method:"getFieldUpdateRow",conreqcsr:csrfToken};$.ajax({url:"/getFieldUpdateRow.zp",type:"POST",data:params,success:function(data){ZPA_FieldUpdate.insertData(data),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.FIELDUPDATE),500)}})},deleteFieldUpdate:function(thisObj){var delIcObj=thisObj.delIcObj,fvuId=$(delIcObj).attr("fvuId"),params={fuId:fvuId,method:"deleteFieldUpdateRow",conreqcsr:csrfToken};$.ajax({url:"/deleteFieldUpdateRow.zp",type:"POST",data:params,success:function(data){if("success"===data.result){ZPA_FieldUpdate.IS_LOADED=!1;var actBody=ZPA_Common.getParentPageId().find("[name=action_body]");actBody.find("[fvuId="+fvuId+"]").remove(),ZPeople.Message.success(ZPI18N.getString("zp.deletefieldupdate")),0==actBody.find("tr[fvuId]").length&&ZPA_FieldUpdate.initPage()}else void 0!==data.wfmapping&&ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.FIELDUPDATE,data.wfmapping)}})},resetFVUListing:function(){ZPA_Common.getParentPageId(ZP_Automation_Mode.FIELDUPDATE).find(".zpl_rgtcnt").empty()},resetFieldUpdateConfig:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.FIELDUPDATE,!1),ZPA_FieldUpdate.fieldUpdateId="",pageId.find("#fvuName").val(""),pageId.find("#fvuDescription").val("");var fvu_paramName=pageId.find("#fvu_paramName"),fvu_paramValue=pageId.find("#fvu_paramValue");if(ZPA_FieldUpdate.clearSelectObj(fvu_paramName),ZPA_FieldUpdate.clearSelectObj(fvu_paramValue),ZPeopleComponents.isComponent("#paramName_tabpanel")&&ZPeopleComponents.tabbedlistboxpopup("#paramName_tabpanel").destroy(),ZPeopleComponents.isComponent("#formFieldTab")&&ZPeopleComponents.tabbedlistboxpopup("#formFieldTab").destroy(),ZPA_FieldUpdate.FORMFIELDS_JSON={},$.isEmptyObject(ZPA_FieldUpdate.FORMFIELDS_JSON)){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.getFormFields(ZP_Automation_Mode.FIELDUPDATE,formId,!1)}if("block"===pageId.find("[name=fvu_selectValueDiv]").css("display")){var anchorObj=pageId.find("#fvuAnchor");ZPA_FieldUpdate.changeFields(anchorObj)}ZPA_FieldUpdate.insertDftField(FormConstants.FieldType.TEXT,"")},getContainerBody:function(cardId){var body="";if("fu_basic"==cardId){body='<div class="zpl_crd" id="'+cardId+'"><div class="zpl_crdcnt">';body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+"</label></div>",body+='<div><select id="fieldupdate_formList"></select></div></div>',body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.fieldupdate.name")+"</label></div>",body+='<div><input type="text" class="ztextbox" id = "fvuName" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.FIELDUPDATE+"')\"></div></div>",body+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.description")+"</label></div>",body+='<div><textarea type="text" class="ztextbox" rows="3" id="fvuDescription" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.FIELDUPDATE+"')\"></textarea></div></div>",body+="</div></div>"}else"fu_config"==cardId&&(body+='<div class="zpl_crd" id="'+cardId+'">',body+='<div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.fieldupdateselect")+"</h4><p>"+ZPI18N.getString("zp.fieldupdate.slidemessage")+"</p></div></div>",body+='<div class="zpl_crdcnt"><div id="noteSection" class="zpl_secn"><div><div class="zpl_info"><ul><li>'+ZPI18N.getString("zp.fldupdleft")+"</li><li>"+ZPI18N.getString("zp.fldupdright")+"</li></ul></div></div></div>",body+='<div class="zpl_secn"><div class="zpl_cndor"><div class="zpl_gbox"><div class="zpl_idiv"><div><input  onclick="ZPA_FieldUpdate.TabPanel.openTabPanel(\'paramName_tabpanel\', \'fvu_paramName\')" type="text" id="fvu_paramName" class="ztextbox"  readonly placeholder="'+ZPI18N.getString("zp.choosefield")+'" /><div id="paramName_tabpanel"></div></div><span>=</span>',body+='<div><div name="fvu_selectValueDiv" style="display:none"><div id="formFieldTab"></div><input onclick="ZPA_FieldUpdate.TabPanel.openTabPanel(\'formFieldTab\', \'fvu_paramValue\')" type="text" id="fvu_paramValue"  class="ztextbox" readonly placeholder="'+ZPI18N.getString("zp.choosefield")+'" /></div><div id="fvu_defalutValDiv"><input type="text"  class="ztextbox" value=""  onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.FIELDUPDATE+"')\"/></div></div>",body+='<span><a id="fvuAnchor" onclick="ZPA_FieldUpdate.changeFields(this)">'+ZPI18N.getString("zp.selectfield")+"</a></span></div></div></div></div></div>");return body},fieldValidation:function(content,fieldType,fcVal,tableName,isToNeglectSysFields){var fieldMatchingList=ZPA_FieldUpdate[fieldType];void 0!=isToNeglectSysFields&&isToNeglectSysFields&&(fieldMatchingList=fieldMatchingList.slice(1,fieldMatchingList.length));var groupNameFieldContent=content.find("#lftFormList"),groupNameField=groupNameFieldContent.find("li"),fields=content.find("#rghtFormList").find("[name=list-group-item]");return $(fields).removeClass("zpl_act"),$(fields).hide(),$(groupNameField).hide(),$(fields).each(function(){var fieldObjAttr=JSON.parse($(this).find("[name=mOpt]").data("fldDtls").fldDtl),fcType=parseInt(fieldObjAttr.colType),fieldfcVal=fieldObjAttr.label;if(!isNaN(fcType)&&-1!=$.inArray(fcType,fieldMatchingList)&&fieldfcVal!==fcVal){$(this).show();var parentId=$(this).parents("[name=fieldsParentDiv]").attr("id");groupNameFieldContent.find("[formkey="+parentId+"]").show()}}),content},getInputBoxVal:function(inputObj){if(void 0!==$(inputObj).attr("selecteddata")&&""!==$(inputObj).attr("selecteddata")){var selectedDataObj=JSON.parse($(inputObj).attr("selecteddata"));return selectedDataObj.data=!0,selectedDataObj}return{data:!1}},loadFCItemJson:function(){if(!$.isEmptyObject(ZPA_FieldUpdate.FORMFIELDS_JSON)){var formDtlAry=ZPA_FieldUpdate.FORMFIELDS_JSON.formNameJArray,formCompDtlAry=ZPA_FieldUpdate.FORMFIELDS_JSON.componentJObj;$.each(formDtlAry,function(index,formDtl){$.each(formDtl,function(formKey,formObj){var lookupDisplayName=formObj.lookupDisplayName,componentJAry=formCompDtlAry[formKey];$.each(componentJAry,function(index,secObj){var secNames=Object.keys(secObj);$.each(secNames,function(index,secName){var fcInSecAry=secObj[secName];$.each(fcInSecAry,function(index,fcObj){var itemObj={},pFormId=formKey.split("_")[0];fcObj.parentFormId=pFormId,itemObj.fcJson=fcObj,itemObj.lookupDisplayName=lookupDisplayName,itemObj.formKey=formKey;fcObj.fcId;var labelname=ZPA_Common.replaceLabelName(fcObj.label);ZPA_FieldUpdate.FC_ITEMJSON[labelname]=itemObj})})})})})}},insertData:function(data){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_FieldUpdate.fieldUpdateId=data.FIELD_VALUE_UPDATE_ID,pageId.find("#fvuName").val(ZPeople.decodeTxt(data.DISPLAYNAME)),pageId.find("#fvuDescription").val(ZPeople.decodeTxt(data.DESCRIPTION));var anchorObj=pageId.find("#fvuAnchor");pageId.find("#fvu_paramName"),pageId.find("#fvu_paramValue");ZPA_FieldUpdate.FORMFIELDS_JSON=data.formComponents,ZPA_FieldUpdate.loadFCItemJson();var selParam_ItemObj=ZPA_FieldUpdate.FC_ITEMJSON[ZPA_Common.replaceLabelName(data.updateFieldLabelName)];pageId.find("#fvu_paramName").val(ZPA_Common.fieldNameFormat(selParam_ItemObj.fcJson.displayName,selParam_ItemObj.lookupDisplayName)),pageId.find("#fvu_paramName").attr("selecteddata",JSON.stringify(selParam_ItemObj.fcJson));var wfType=selParam_ItemObj.fcJson.workFlowFcType;if(!0===data.ISLOOKUP){var selVal_ItemObj=ZPA_FieldUpdate.FC_ITEMJSON[ZPA_Common.replaceLabelName(data.selectedFieldLabelName)];pageId.find("#fvu_paramValue").val(ZPA_Common.fieldNameFormat(selVal_ItemObj.fcJson.displayName,selVal_ItemObj.lookupDisplayName)),pageId.find("#fvu_paramValue").attr("selecteddata",JSON.stringify(selVal_ItemObj.fcJson)),pageId.find("[name=fvu_selectValueDiv]").show(),pageId.find("#fvu_defalutValDiv").hide(),anchorObj.text(ZPI18N.getString("zp.fieldupdate.specifyfield")),ZPA_FieldUpdate.insertDftField(wfType)}else ZPA_FieldUpdate.changeFields(anchorObj),pageId.find("[name=fvu_selectValueDiv]").hide(),pageId.find("#fvu_defalutValDiv").show(),ZPA_FieldUpdate.insertDftField(wfType,data.VALUE,data.VALUEREMOVEDOLLAR),anchorObj.text(ZPI18N.getString("zp.selectfield"))},clearSelectObj:function(obj){$(obj).val(""),$(obj).removeAttr("selecteddata")},appendDivBasedOnType:function(fcType,parentDiv){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),divEle="";switch(fcType){case FormConstants.FieldType.CHECK_BOX:divEle='<div class="zcheckbox "><input id="fvuChkbox" type="checkbox"  class="zcheckbox__helper" ><label for="fvuChkbox" class="zcheckbox__label"></label></div>',parentDiv.html($(divEle));break;case FormConstants.FieldType.DATE:divEle='<input id="fvuDateField" data-format="'+dateFmt+'" data-placeholder-type="date-format" data-calendar-icon="true" data-clear-button="focus" data-calendar-icon-ui-type="button" data-spin-buttons="none" data-locale="en-US" data-calendar-icon-ui-type="button" data-picker="true">',parentDiv.html($(divEle)),ZPeopleComponents.datefield("#fvuDateField",{pickerOptions:{appendTo:"#"+ZPA_Common.getPageIdValue(ZP_Automation_Mode.FIELDUPDATE)}});break;case FormConstants.FieldType.DATE_TIME:divEle='<input id="fvuDateTimeFld" data-format="'+ZPA_Util.getUIDateTimeFormat()+'" data-picker="true" data-spin-buttons="none" data-calendar-icon-ui-type="button" data-calendar-icon="true">',parentDiv.html($(divEle)),ZPeopleComponents.datetimefield("#fvuDateTimeFld");break;case FormConstants.FieldType.FILE_UPLOAD:divEle='<div class="ztextbox--group zh-alignright zpl_inpticfild"><input id="fvu_recTempSel"   readonly type="text" class="ztextbox"><i id="triRecTemp" class="ztextbox__icon PI_addlist" "></i><div id="fvu_recTempDDList"></div></div>',parentDiv.html($(divEle)),ZPA_Util.getRecordTemplate(ZP_Automation_Mode.FIELDUPDATE,ZPA_Util.constructRecTempList);var dropDown=pageId.find("#fvu_recTempDDList");pageId.find("#triRecTemp").off().on("click",function(){dropDown.is(":visible")?ZPeopleComponents.dropdownlist(dropDown).close():(ZPeopleComponents.dropdownlist(dropDown).setAttribute("position","right"),ZPeopleComponents.dropdownlist(dropDown).open({forElement:"#triRecTemp"}))});break;case FormConstants.FieldType.PICKLIST:divEle='<div class="ztextbox--group zh-alignright zpl_inpticfild"><input id="fvu_pickListInp"   readonly type="text" class="ztextbox"><i id="triPickList" class="ztextbox__icon PI_addlist" "></i><div id="fvu_PickList"></div></div>',parentDiv.html($(divEle)),ZPA_Util.getLookupFieldDts(pageId.find("#triPickList"),ZPA_Util.constLkupFieldDtls);var dropDownList=pageId.find("#fvu_PickList");pageId.find("#triPickList").off().on("click",function(){dropDownList.is(":visible")?ZPeopleComponents.dropdownlist(dropDownList).close():(ZPeopleComponents.dropdownlist(dropDownList).setAttribute("position","right"),ZPeopleComponents.dropdownlist(dropDownList).open({forElement:"#triPickList"}))});break;case HOURS_IN_SECONDS:divEle='<input id="fvu_timeFldInSec" data-format="hh:mm" data-clear-button="focus" data-spin-buttons="always"></input>',parentDiv.html($(divEle)),ZPeopleComponents.timefield("#fvu_timeFldInSec");break;case HOURS_IN_MINUTES:divEle='<input id="fvu_timeFld" data-format="hh:mm" data-clear-button="focus" data-spin-buttons="always"></input>',parentDiv.html($(divEle)),ZPeopleComponents.timefield("#fvu_timeFld");break;default:divEle='<input id="inpBx" type="text" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.FIELDUPDATE+"')\"></input>",parentDiv.html($(divEle))}},appendSelectedValue:function(inpDiv,selectedValue,selectedValueId){ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);inpDiv.val(selectedValue),inpDiv.data("selectedValue",selectedValueId)},insertDftField:function(wfFcType,value,dispValue){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),fcType=(FormConstants.FieldType.TEXT,FormConstants.FieldType.TEXT_AREA,FormConstants.FieldType.EMAIL_ADDRESS,FormConstants.FieldType.NUMBER,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.PHONE_NUMBER,TIME,parseInt(wfFcType));if(ZPA_FieldUpdate.appendDivBasedOnType(fcType,pageId.find("#fvu_defalutValDiv")),pageId.find("#fvuAng").show(),value&&value.indexOf("${")<0){var inputBox=pageId.find("#fvu_defalutValDiv").find("input");switch(fcType){case FormConstants.FieldType.CHECK_BOX:"true"===value&&inputBox.attr("checked","checked");break;case FormConstants.FieldType.PICKLIST:ZPA_FieldUpdate.appendSelectedValue(pageId.find("#fvu_pickListInp"),dispValue,value);break;case FormConstants.FieldType.FILE_UPLOAD:ZPA_FieldUpdate.appendSelectedValue(pageId.find("#fvu_recTempSel"),dispValue,value);break;case HOURS_IN_SECONDS:var hours=Attendance.disHours(value/60);ZPeopleComponents.timefield($("#fvu_timeFldInSec")).setValue(hours);break;case HOURS_IN_MINUTES:hours=Attendance.disHours(value);ZPeopleComponents.timefield($("#fvu_timeFld")).setValue(hours);break;case FormConstants.FieldType.DATE:ZPeopleComponents.datefield(pageId.find("#fvuDateField")).setValue(value);break;case FormConstants.FieldType.DATE_TIME:ZPeopleComponents.datetimefield(pageId.find("#fvuDateTimeFld")).setValue(value);break;default:inputBox.val(value)}}},changeFields:function(obj){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);pageId.find("[name=fvu_selectValueDiv]").toggle(),pageId.find("#fvu_defalutValDiv").toggle();var changeLinkName="block"===pageId.find("#fvu_defalutValDiv").css("display")?ZPI18N.getString("zp.selectfield"):ZPI18N.getString("zp.fieldupdate.specifyfield");$(obj).text(changeLinkName)},fvuValidation:function(fcType,getParams){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.removeErrorDiv(pageId);var isError=!1;if(getParams.fvuName.trim()||(isError=!0,ZPA_Common.appendErrorDiv(pageId.find("#fvuName"),ZPI18N.getString("zp.emptyfvuname"))),getParams.fcId||(isError=!0,ZPA_Common.appendErrorDiv(pageId.find("#fvu_paramName"),ZPI18N.getString("zp.fieldupdate.fieldemptyerror"))),pageId.find("#fvu_defalutValDiv").is(":visible")){var valueErrorDiv=pageId.find("#fvu_defalutValDiv input:first");if(fcType!==FormConstants.FieldType.CHECK_BOX&&!getParams.fcVal){switch(isError=!0,fcType){case FormConstants.FieldType.DATE_TIME:if(ZPeopleComponents.isComponent(pageId.find("#fvuDateTimeFld"))){let dateFldComp=ZPeopleComponents.datetimefield(pageId.find("#fvuDateTimeFld"));ZPA_Common.appendErrorDiv(dateFldComp.container,ZPI18N.getString("zp.fieldupdate.emptyerror"))}break;case FormConstants.FieldType.DATE:if(ZPeopleComponents.isComponent(pageId.find("#fvuDateField"))){let dateFldComp=ZPeopleComponents.datefield(pageId.find("#fvuDateField"));ZPA_Common.appendErrorDiv(dateFldComp.container,ZPI18N.getString("zp.fieldupdate.emptyerror"))}break;case HOURS_IN_MINUTES:if(ZPeopleComponents.isComponent(pageId.find("#fvu_timeFld"))){let fvuTimeComp=ZPeopleComponents.timefield(pageId.find("#fvu_timeFld"));ZPA_Common.appendErrorDiv(fvuTimeComp.container,ZPI18N.getString("zp.fieldupdate.emptyerror"))}break;case FormConstants.FieldType.PICKLIST:case FormConstants.FieldType.FILE_UPLOAD:ZPA_Common.appendErrorDiv(valueErrorDiv.parent(),ZPI18N.getString("zp.fieldupdate.emptyerror"));break;default:ZPA_Common.appendErrorDiv(valueErrorDiv,ZPI18N.getString("zp.fieldupdate.emptyerror"))}return isError}switch(fcType){case FormConstants.FieldType.EMAIL_ADDRESS:ZPUtil.Validation.isEmail(getParams.fcVal)||(isError=!0,ZPA_Common.appendErrorDiv(valueErrorDiv,ZPI18N.getString("zp.copycustomization.enteravalidemailaddress")));break;case FormConstants.FieldType.DATE_TIME:getParams.fcVal=Calendar.convertHourFormat(getParams.fcVal);break;case FormConstants.FieldType.NUMBER:ZPA_Common.isValidNumber(getParams.fcVal)||(isError=!0,ZPA_Common.appendErrorDiv(valueErrorDiv,ZPI18N.getString("zp.enteravalidnumber")));break;case FormConstants.FieldType.CURRENCY:case FormConstants.FieldType.DECIMAL:if(!ZPA_Common.checkForNumberId(getParams.fcVal)){isError=!0;var errorMsg=fcType===FormConstants.FieldType.CURRENCY?ZPI18N.getString("zp.validcurrency"):ZPI18N.getString("zp.entervaliddecimalerr");ZPA_Common.appendErrorDiv(valueErrorDiv,errorMsg)}}}else pageId.find("[name=fvu_selectValueDiv]").is(":visible")&&(getParams.vFcId||(isError=!0,ZPA_Common.appendErrorDiv(pageId.find("[name=fvu_selectValueDiv] input"),ZPI18N.getString("zp.fieldupdate.fieldemptyerror"))));return isError},saveFieldUpdate:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.disableSaveBtn(pageId);var formId=ZPA_Common.getFormId(ZP_Automation_Mode.FIELDUPDATE),name=pageId.find("#fvuName").val(),desc=pageId.find("#fvuDescription").val(),selectedFCObj=ZPA_FieldUpdate.getInputBoxVal(pageId.find("#fvu_paramName")),fcFctype=!0===selectedFCObj.data?Number(selectedFCObj.workFlowFcType):"",params={fvuName:name,formId:formId.toString(),fvuDesc:desc,method:"saveFieldUpdate",conreqcsr:csrfToken};if(params.fuId=void 0!=ZPA_FieldUpdate.fieldUpdateId&&""!=ZPA_FieldUpdate.fieldUpdateId?ZPA_FieldUpdate.fieldUpdateId:"",void 0!==selectedFCObj.lookupFcId&&(params.lkupFcId=selectedFCObj.lookupFcId.toString()),void 0!==selectedFCObj.fcId&&(params.fcId=selectedFCObj.fcId.toString()),void 0!==selectedFCObj.parentFormId&&(params.pFormId=selectedFCObj.parentFormId.toString()),pageId.find("[name=fvu_selectValueDiv]").is(":visible")){var valueFormCompObj=ZPA_FieldUpdate.getInputBoxVal(pageId.find("#fvu_paramValue"));void 0!==valueFormCompObj.fcId&&(params.vFcId=valueFormCompObj.fcId.toString()),params.fcVal="${"+ZPA_Common.replaceOriginalLabelName(valueFormCompObj.label)+"}"}else if(pageId.find("#fvu_defalutValDiv").is(":visible")){var valInpBx=pageId.find("#fvu_defalutValDiv").find("input");switch(fcFctype){case FormConstants.FieldType.CHECK_BOX:fcVal=valInpBx.prop("checked");break;case FormConstants.FieldType.PICKLIST:fcVal=pageId.find("#fvu_pickListInp").data("selectedValue");break;case FormConstants.FieldType.FILE_UPLOAD:fcVal=pageId.find("#fvu_recTempSel").data("selectedValue");break;case FormConstants.FieldType.DATE:fcVal=ZPeopleComponents.datefield(pageId.find("#fvuDateField")).getValue().dateString;break;case FormConstants.FieldType.DATE_TIME:fcVal=ZPeopleComponents.datetimefield(pageId.find("#fvuDateTimeFld")).getValue().dateString;break;case HOURS_IN_MINUTES:var timeVal=ZPeopleComponents.timefield(pageId.find("#fvu_timeFld")).getValue().dateString;if(ZPA_Common.isNotNull(timeVal)){var etime_hr=parseInt(timeVal.slice(0,2),10);fcVal=60*etime_hr+parseInt(timeVal.slice(3,5),10)}else fcVal=void 0;break;case HOURS_IN_SECONDS:timeVal=ZPeopleComponents.timefield(pageId.find("#fvu_timeFldInSec")).getValue().dateString,etime_hr=parseInt(timeVal.slice(0,2),10);fcVal=60*etime_hr+parseInt(timeVal.slice(3,5),10),fcVal*=60;break;default:fcVal=valInpBx.val()}params.fcVal=fcVal}ZPA_FieldUpdate.fvuValidation(fcFctype,params)?ZPA_Common.enableSaveBtn(pageId):$.ajax({url:"/createFieldupdate.zp",type:"POST",data:params,success:function(data){if(ZPA_Common.enableSaveBtn(pageId),!0!==data.isError){params.fieldupdateId=data.fuId,params.fvuName=data.fvuName;var pageMode=ZPA_Common.getPageMode();ZPA_Common.isFromChecklistPage(pageId)&&(pageMode=ZP_Automation_Mode.CHECKLIST),pageMode==ZP_Automation_Mode.WORKFLOW||pageMode==ZP_Automation_Mode.CUSTOMACTION?ZPA_Actions.callBackActions(ZP_Automation_Mode.FIELDUPDATE,params):pageMode==ZP_Automation_Mode.BLUEPRINT?ZPA_Blueprint.Builder.callBackActions(ZP_Automation_Mode.FIELDUPDATE,params):pageMode==ZP_Automation_Mode.CHECKLIST?ZPA_Checklist.Slider.callBackonSaveActions(ZP_Automation_Mode.FIELDUPDATE,params):ZPA_FieldUpdate.afterSaveCB(formId),ZPA_FieldUpdate.removeSlider(ZPA_FieldUpdate.mailModal),ZPA_Common.isNotNull(params.fuId)?ZPeople.Message.success(ZPI18N.getString("zp.fldupdupd")):ZPeople.Message.success(ZPI18N.getString("zp.fldupdadd"))}else ZPeople.Message.failure(data.message),ZPA_Common.enableSaveBtn(pageId)},error:function(data){ZPA_Common.enableSaveBtn(pageId);var response=data.responseJSON;void 0!=response&&"MORE_THAN_MAX_LENGTH"==response.code?"fvuName"==response.paramName?ZPA_Common.appendErrorDiv(pageId.find("#fvuName"),ZPI18N.getString("zp.fvunameexc")):"fvuDesc"==response.paramName?ZPA_Common.appendErrorDiv(pageId.find("#fvuDescription"),ZPI18N.getString("zp.maxdesclimit",[300])):ZPeople.Message.failure(response.error):ZPA_Common.isNotNull(response.error)&&ZPeople.Message.failure(response.error)}})},afterSaveCB:function(formId){(ZPA_FieldUpdate.IS_LOADED=!1,ZPeopleComponents.isComponent("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)))&&(formId!=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue()&&ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).setValue(formId))}}).TabPanel={loadFormFieldTabPanel:function(data,tabPanelProps){var tabs=[],formDtlAry=data.formNameJArray,formCompDtlAry=data.componentJObj,mandatoryFields=data.mandatoryFields,pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),selectedFCObj=ZPA_FieldUpdate.getInputBoxVal(pageId.find("#fvu_paramName")),selFCType=selectedFCObj.workFlowFcType,fcVal=selectedFCObj.label,fcId=selectedFCObj.fcId,fieldDisplayType=selectedFCObj.displayType,fieldMatchingList=ZPA_FieldUpdate[selFCType];if("fvu_paramValue"==tabPanelProps.targetId){var isToNeglectSystemFields=-1!=mandatoryFields.toString().indexOf(fcId)||101==fieldDisplayType;void 0!=isToNeglectSystemFields&&isToNeglectSystemFields&&(fieldMatchingList=fieldMatchingList.slice(1,fieldMatchingList.length))}$.each(formDtlAry,function(index,formDtl){let tabObj={};$.each(formDtl,function(formKey,formObj){if("fvu_paramName"==tabPanelProps.targetId&&"systemFields"==formKey)return;tabObj.label=formObj.lookupFullName,tabObj.lookupLabelName=ZPA_Common.isNotNull(formObj.lookupLabelName)?formObj.lookupLabelName:formObj.lookupFullName,tabObj.panelId=formKey+"_panel",tabObj.id=formKey;let compItems=[];var componentJAry=formCompDtlAry[formKey];$.each(componentJAry,function(index,secObj){var secNames=Object.keys(secObj);$.each(secNames,function(index,secName){var fcInSecAry=secObj[secName];$.each(fcInSecAry,function(index,fcObj){if(fcObj.sectionName=secName,"fvu_paramValue"==tabPanelProps.targetId&&void 0!=selectedFCObj&&1==selectedFCObj.data){var valColType=fcObj.colType,fieldFCVal=fcObj.label;isNaN(valColType)||-1==$.inArray(valColType,fieldMatchingList)||fieldFCVal===fcVal||(fcObj.label=ZPA_Common.replaceLabelName(fcObj.label),compItems.push(fcObj))}else{if(ZPA_FieldUpdate.ALLOWED_FIELDS.indexOf(fcObj.colType)<0)return!0;fcObj.label=ZPA_Common.replaceLabelName(fcObj.label),compItems.push(fcObj)}})})}),$.isEmptyObject(compItems)?tabObj={}:tabObj.items=compItems}),$.isEmptyObject(tabObj)||tabs.push(tabObj)}),tabPanelProps.tabs=tabs,tabPanelProps.forElement="#"+tabPanelProps.forEleId,tabPanelProps.listboxOptions={dataMapping:{id:"fcId",value:"label",text:"displayName",groupLabel:"sectionName"},showSearchField:!0,search:{by:"displayName",criteria:"contains"},searchFieldOptions:{placeholder:ZPI18N.getString("zp.search")},multiple:!1,messages:{noResults:ZPI18N.getString("zp.noresults")},isTextHTMLEncoded:!1},ZPeopleComponents.isComponent("#"+tabPanelProps.id)&&ZPeopleComponents.tabbedlistboxpopup("#"+tabPanelProps.id).destroy(),ZPeopleComponents.tabbedlistboxpopup("#"+tabPanelProps.id,tabPanelProps)},openTabPanel:function(id,forEleId){ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);var formId=ZPA_Common.getFormId(ZP_Automation_Mode.FIELDUPDATE);ZPeopleComponents.isComponent("#"+id)?$("#"+id).text().trim().length>0?(ZPeopleComponents.tabbedlistboxpopup("#"+id).open(),ZPA_FieldUpdate.TabPanel.selectTabbedItem(id,forEleId)):"paramName_tabpanel"===id?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.fldupsourceflderrmsg")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.flduptargetflderrmsg")):($.isEmptyObject(ZPA_FieldUpdate.FORMFIELDS_JSON)&&ZPA_Common.getFormFields(ZP_Automation_Mode.FIELDUPDATE,formId,!1),ZPA_FieldUpdate.TabPanel.loadFormFieldTab(id,forEleId),$("#"+id).text().trim().length>0?(ZPeopleComponents.tabbedlistboxpopup("#"+id).open(),ZPA_FieldUpdate.TabPanel.selectTabbedItem(id,forEleId)):"paramName_tabpanel"===id?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.fldupsourceflderrmsg")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.flduptargetflderrmsg")))},loadFormFieldTab:function(id,forEleId){var tabPanelProps={id:id,forEleId:forEleId,appendTo:"#fu_cards",select:ZPA_FieldUpdate.TabPanel.selectFieldCB,targetId:forEleId};ZPA_FieldUpdate.TabPanel.loadFormFieldTabPanel(ZPA_FieldUpdate.FORMFIELDS_JSON,tabPanelProps)},selectFieldCB:function(event,eventObj){if(event.detail.fromUI){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),forEleId=eventObj.forEleId,itemData=event.detail.itemData,tabData=event.detail.options.tabData,pFormId=tabData.id.split("_")[0];itemData.parentFormId=pFormId,itemData.fcVal=itemData.val;var wfFCType=itemData.workFlowFcType,targetId=eventObj.targetId;pageId.find("#"+targetId).val(ZPA_Common.fieldNameFormat(itemData.displayName,tabData.lookupLabelName)),pageId.find("#"+targetId).attr("selecteddata",JSON.stringify(itemData)),event.detail.fromUI&&ZPA_FieldUpdate.insertDftField(wfFCType,"",""),"fvu_paramName"==forEleId&&(pageId.find("#fvu_paramValue").val(""),pageId.find("#fvu_paramValue").removeAttr("selecteddata"),ZPeopleComponents.isComponent("#formFieldTab")&&ZPeopleComponents.tabbedlistboxpopup("#formFieldTab").destroy(),"none"===pageId.find("#fvu_defalutValDiv").css("display")&&ZPA_FieldUpdate.changeFields(pageId.find("#fvuAnchor"))),ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.FIELDUPDATE)}},selectTabbedItem:function(id,forEleId){var selData=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE).find("#"+forEleId).attr("selecteddata");if(void 0!=selData){var selDatajson=JSON.parse(selData),parentFormId=selDatajson.parentFormId,lookupFcId=selDatajson.lookupFcId,selParam_ItemObj=ZPA_FieldUpdate.FC_ITEMJSON[ZPA_Common.replaceLabelName(selDatajson.label)],activeTabId=ZPA_TabbedListBox.getActiveTabId(ZPA_FieldUpdate.FORMFIELDS_JSON.formNameJArray,parentFormId,lookupFcId);ZPA_Common.isNotNull(activeTabId)&&ZPeopleComponents.tabbedlistboxpopup("#"+id).setAttribute("activeTab","#"+activeTabId),void 0!=selParam_ItemObj&&(selParam_ItemObj.fcJson.label=ZPA_Common.replaceLabelName(selParam_ItemObj.fcJson.label),ZPeopleComponents.tabbedlistboxpopup("#"+id).selectTabItems(selParam_ItemObj.formKey,selParam_ItemObj.fcJson))}else{activeTabId=ZPA_TabbedListBox.getActiveTabId(ZPA_FieldUpdate.FORMFIELDS_JSON.formNameJArray);ZPA_Common.isNotNull(activeTabId)&&ZPeopleComponents.tabbedlistboxpopup("#"+id).setAttribute("activeTab","#"+activeTabId)}}};var ZPA_FieldUpdate,ZPA_Checklist={IS_LOADED:!1,TASK_LIST:[],LIMIT:{NAME:100},initThirdLvlTab:function(){var pageId=ZPA_Common.getParentPageId();ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.TASK)).destroy();var topMenuDiv=pageId.find("#topSettMenu");topMenuDiv.removeClass("zp_dyn"),topMenuDiv.find(".zpl_rgt").siblings().remove(),topMenuDiv.find(".zpl_rgt").remove();var topmenuHtml="<div ><span>"+ZPI18N.getString("zp.selectform")+'</span><select id="'+ZPA_Common.getFormListId(ZP_Automation_Mode.CHECKLIST)+'"></select></div>'+'<div class="zpl_rgt"> <button id="add_checklist" class="zlabel zlabel--blue zlabel--medium" onclick="ZPA_Checklist.add()">'+ZPI18N.getString("zp.checklist.add")+"</button></div>";topMenuDiv.append(topmenuHtml),ZPA_Common.loadFormListInListPage(ZP_Automation_Mode.CHECKLIST),ZPA_Checklist.initPage()},initPage:function(formId){var pageId=ZPA_Common.getParentPageId();(settingsUrlProps.url.indexOf("taskedit")>=0||settingsUrlProps.url.indexOf("taskadd")>=0)&&(pageId.find("#checklist_topTab ul .zpl_act").attr("tab")==ZP_Automation_Mode.CHECKLIST&&ZPA_Checklist.switchTab(pageId.find("#checklist_topTab ul [tab=task]")));if(pageId.find("#checklist_topTab li.zpl_act").attr("tab")!=ZP_Automation_Mode.TASK){if(!ZPA_Checklist.IS_LOADED){pageId.find(".zpl_rgtcnt").empty(),ZPA_Common.Loader.appendPageLoading(pageId);var serviceName=ZPA_Common.getServiceName(),params={formId:formId=ZPA_Common.isNotNull(formId)?formId:formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.CHECKLIST)).getValue(),method:"list",conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),$.post("/getChecklistConfList.zp",params,function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.CHECKLIST))return ZPA_Common.Loader.removePageLoading(pageId),!1;if(ZPA_Checklist.IS_LOADED=!0,data.length>0){pageId.find("#add_checklist").removeClass("DN");var body='<div class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+"</th><th>"+ZPI18N.getString("zp.associatedtasks")+'</th><th width="80"></th></tr></thead><tbody>';$.each(data,function(index,row){body+='<tr chkId="'+row.checklistId+'" onclick="ZPA_Checklist.editSlide(\''+row.checklistId+"','"+row.formId+"')\"><td>"+row.label+"</td><td><span>"+row.displayName+"</span></td><td><span>"+row.taskCount+'</span></td><td><div class="zpl_hvr"><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" checklistId="'+row.checklistId+'" onclick="ZPA_Common.deleteConfirmationPopup(this, \''+ZP_Automation_Mode.CHECKLIST+"', ZPA_Checklist.deleteChecklist)\"></i></div></td></tr>"}),body+="</tbody></table></div>",pageId.find(".zpl_rgtcnt").append(body)}else{pageId.find("#add_checklist").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.CHECKLIST),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.CHECKLIST),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.CHECKLIST),pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.checklist.add"),ZPA_Checklist.add),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)})}}else ZPA_Task.initPage(formId)},add:function(formId){if(ZPA_Common.validateAddConfig()){formId=ZPA_Common.getPageMode()==ZP_Automation_Mode.CHECKLIST?settingsUrlProps.urlParamsArr.formid:formId,ZPA_Checklist.Popup.construct(ZPI18N.getString("zp.checklist.add"));var pageId=ZPA_Common.getPopUpId(ZPA_Checklist.Popup.chkModal);ZPA_Checklist.loadDefault(pageId,formId,!1)}},editSlide:function(checklistId,formId){var serviceName=ZPA_Common.getServiceName();window.location.href="#settings/service/"+serviceName+"/checklist/edit-formid:"+formId+"/checklistid:"+checklistId},editConfig:function(checklistId,formId){var urlParams=settingsUrlProps.urlParamsArr;formId=ZPA_Common.isNotNull(formId)?formId:urlParams.formid,checklistId=ZPA_Common.isNotNull(checklistId)?checklistId:urlParams.checklistid;ZPA_Checklist.edit(checklistId,formId)},edit:function(checklistId,formId){var params={checklistId:checklistId,formId:formId,method:"getChecklist"};ZPeople.Request.send("/getChecklist.zp",params,function(data){var formId=data.formId;ZPA_Checklist.TASK_LIST=data.formtasks,ZPA_Checklist.Slider.editChecklist(data,formId),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.CHECKLIST),500),settingsUrlProps.urlParamsArr.formid=formId})},deleteChecklist:function(thisObj){var delIcObj=thisObj.delIcObj,checkListId=$(delIcObj).attr("checkListId"),params={checkListId:checkListId,method:"deleteChecklist",conreqcsr:csrfToken};$.ajax({url:"/deleteChecklist.zp",type:"POST",data:params,success:function(data){if("success"===data.result){ZPA_Checklist.IS_LOADED=!1;var pageId=ZPA_Common.getParentPageId();pageId.find("[chkId="+checkListId+"]").remove(),ZPeople.Message.success(ZPI18N.getString("zp.chkdelsucc")),0==pageId.find("tr[chkId]").length&&ZPA_Checklist.initPage()}else void 0!==data.wfmapping&&ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.CHECKLIST,data.wfmapping)}})},loadDefault:function(pageId,formId,isEdit){ZPA_Common.getFormList(ZP_Automation_Mode.CHECKLIST,ZPA_Common.getServiceName());let formListProp={options:ZPA_Common[ZPA_Common.getFormListMode(ZP_Automation_Mode.CHECKLIST,ZPA_Common.getServiceName())],dataMapping:{label:"dispName",value:"formId",title:"dispName"}};void 0!=formId&&""!=formId&&(formListProp.disabled=!0,formListProp.selectedValue=formId),ZPA_Common.ZCompProp.loadSelectListProp(formListProp),ZPeopleComponents.select("#checklist_formList",formListProp),ZPA_Task.FORMFIELDS_JSON={},ZPA_Task.TASK_OWNER={}},validateChkList:function(pageId,chkObj){var isValid=!0,chkName=chkObj.label;return ZPUtil.Validation.isEmpty(chkName)?(ZPA_Common.appendErrorDiv(pageId.find("#checklist_name"),ZPI18N.getString("zp.emptychkname")),isValid=!1):chkName.length>ZPA_Checklist.LIMIT.NAME&&(ZPA_Common.appendErrorDiv(pageId.find("#checklist_name"),ZPI18N.getString("zp.chknamelim")),isValid=!1),isValid},saveChklist:function(pageId,callbackFn){ZPA_Common.removeErrorDiv(pageId);var formId=ZPA_Common.getFormId(ZP_Automation_Mode.CHECKLIST),checklistId=pageId.data("checklistId"),chklistname=pageId.find("#checklist_name").val(),params={};void 0!=checklistId&&""!=checklistId&&(params.checklistId=checklistId),params.method="save",params.label=chklistname,params.formId=formId,ZPA_Common.disableSaveBtn(pageId),ZPA_Checklist.validateChkList(pageId,params)?(pageId.find("#checklist_name").data("checklist_name",chklistname),ZPeople.Request.send("/confChecklist.zp",params,callbackFn)):ZPA_Common.enableSaveBtn(pageId)},switchTab:function(thisObj){var selLi=$(thisObj);if(!selLi.hasClass("zpl_act")){selLi.parent().find("li").removeClass("zpl_act"),selLi.addClass("zpl_act");var tabValue=selLi.attr("tab");tabValue==ZP_Automation_Mode.TASK?(ZPA_Task.IS_LOADED=!1,ZPA_Task.initThirdLvlTab()):tabValue==ZP_Automation_Mode.CHECKLIST&&(ZPA_Checklist.IS_LOADED=!1,ZPA_Checklist.initThirdLvlTab())}},getCurrentMode:function(){var pageId=ZPA_Common.getParentPageId();return settingsUrlProps.url.indexOf("taskedit")>=0||settingsUrlProps.url.indexOf("taskadd")>=0?ZP_Automation_Mode.TASK:pageId.find("#checklist_topTab ul .zpl_act").attr("tab")}};ZPA_Checklist.Popup={construct:function(header){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.CHECKLIST),tab.cardId="checklist_cards",tab.validate=ZPA_Checklist.Popup.saveCheckList,ZPA_Checklist.Popup.chkModal=new popupModal(header,tab),ZPA_Checklist.Popup.chkModal.mediumSize=!0,ZPA_Checklist.Popup.chkModal.save=ZPI18N.getString("zp.next"),ZPA_Checklist.Popup.chkModal.construct(),ZPA_Checklist.Popup.chkModal.setCloseCallback(function(){ZPA_Checklist.Popup.remove()}),ZPA_Common.getPopUpId(ZPA_Checklist.Popup.chkModal).find("#checklist_cards").append(ZPA_Common.Cards.construct("chk_basic",ZPA_Checklist.ContainerBody.BASIC)),ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.CHECKLIST))},remove:function(){ZPeopleComponents.isComponent("#checklist_formList")&&ZPeopleComponents.select("#checklist_formList").destroy(),ZPA_Checklist.Popup.chkModal.remove()},saveCheckList:function(){var pageId=ZPA_Common.getPopUpId(ZPA_Checklist.Popup.chkModal);ZPA_Checklist.saveChklist(pageId,ZPA_Checklist.Popup.checkListSaveCallback)},checkListSaveCallback:function(resultData,params,obj){ZPA_Common.getPopUpId(ZPA_Checklist.Popup.chkModal);if(void 0!=resultData&&void 0!=resultData.checklistId){ZPeople.Message.success(ZPI18N.getString("zp.chkadd")),-1==settingsUrlProps.url.indexOf("onboarding/employeeflow")&&-1==settingsUrlProps.url.indexOf("onboarding/candidateflow")&&(ZPA_Checklist.IS_LOADED=!1),ZPA_Checklist.Popup.remove();var pageMode=ZPA_Common.getPageMode();pageMode==ZP_Automation_Mode.WORKFLOW||pageMode==ZP_Automation_Mode.CUSTOMACTION?ZPA_Actions.callBackActions(ZP_Automation_Mode.CHECKLIST,resultData):pageMode==ZP_Automation_Mode.BLUEPRINT?ZPA_Blueprint.Builder.callBackActions(ZP_Automation_Mode.CHECKLIST,resultData):-1!==settingsUrlProps.url.indexOf("onboarding/employeeflow")||-1!==settingsUrlProps.url.indexOf("onboarding/candidateflow")?NewZPOnboarding.config.checklistAddCallBack(resultData,params):window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/checklist/edit-formid:"+params.formId+"/checklistid:"+resultData.checklistId}},constructTempMapPopup:function(){var tab=new Tab;tab.id="tempMap_popUp",tab.cardId="tempMap_cards",tab.validate=ZPA_Checklist.Slider.mapTaskToAnchestor,ZPA_Checklist.Popup.taskMapModal=new popupModal(ZPI18N.getString("zp.selectexisttemplate"),tab),ZPA_Checklist.Popup.taskMapModal.mediumSize=!0,ZPA_Checklist.Popup.taskMapModal.construct(),ZPA_Checklist.Popup.taskMapModal.setCloseCallback(function(){ZPeopleComponents.isComponent("#taskDD")&&ZPeopleComponents.tokenfield("#taskDD").destroy(),ZPA_Checklist.Popup.taskMapModal.remove()}),ZPA_Common.getPopUpId(ZPA_Checklist.Popup.taskMapModal).find("#tempMap_cards").append(ZPA_Common.Cards.construct("template_map",ZPA_Checklist.ContainerBody.TEMPLATE_MAP));var assoTaskIds=ZPA_Checklist.Slider.getChecklistAssociatedTask();ZPA_Checklist.Popup.constructTaskDropDown(assoTaskIds)},constructTaskDropDown:function(assTaskIds){ZPA_Common.getPopUpId(ZPA_Checklist.Popup.taskMapModal),assTaskIds=ZPA_Checklist.Slider.getChecklistAssociatedTask();if(!$.isEmptyObject(ZPA_Checklist.TASK_LIST)&&ZPA_Checklist.TASK_LIST.length>0){var taskItems=[];$.each(ZPA_Checklist.TASK_LIST,function(index,taskItem){var taskId=taskItem.id;-1==assTaskIds.indexOf(taskId)&&taskItems.push(taskItem)});let tempDDProps={data:taskItems,dataMapping:{text:"value",label:"value",value:"id",id:"id"},sort:!0,sortBy:"value",search:{by:["value"],criteria:"contains",highlightKeyword:!0},dropdownList:{appendTo:"#tempMap_popUp"},isTextHTMLEncoded:!0};ZPeopleComponents.tokenfield("#taskDD",tempDDProps)}},getTaskAttRow:function(id,taskName){var taskRowHtml=$('<div class="zpl_tg"><span id="'+id+'"></span><i name="closeIc" class="PI_cls" onclick="ZPA_Checklist.Popup.removeTask(this)"></i></div>');return taskRowHtml.find("#"+id).text(taskName),taskRowHtml}},ZPA_Checklist.Slider={editChecklist:function(chklstObj,formId){ZPA_Checklist.Slider.construct(ZPI18N.getString("zp.editchecklist"),chklstObj,formId);var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST),checklistId=chklstObj.checklistId;pageId.data("checklistId",checklistId),ZPA_Checklist.loadDefault(pageId,formId,!0);var chklst_name=chklstObj.label;pageId.find("#checklist_name").val(decodeHTML(chklst_name)),pageId.find("#checklist_name").data("checklist_name",decodeHTML(chklst_name)),ZPA_Checklist.Slider.getCheckListMappedTask(),ZPA_Checklist.Slider.setActionValues(chklstObj.mappings),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.CHECKLIST),500)},setActionValues:function(chklstMapping){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST);void 0!=chklstMapping&&(ZPA_Actions.append(ZP_Automation_Mode.EMAILALERT,chklstMapping.mailAlertIds,pageId.find("[name=action_container]")),ZPA_Actions.append(ZP_Automation_Mode.FIELDUPDATE,chklstMapping.fieldUpdateIds,pageId.find("[name=action_container]")),ZPA_Actions.append(ZP_Automation_Mode.CUSTOMFUNCTION,chklstMapping.customfnIds,pageId.find("[name=action_container]")))},construct:function(header,chklstObj,formId){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.CHECKLIST),tab.cardId="checklist_Slicards",ZPA_Checklist.Slider.chkModal=new sliderModal(header,tab),ZPA_Checklist.Slider.chkModal.mediumSize=!0,ZPA_Checklist.Slider.chkModal.construct(),ZPA_Checklist.Slider.chkModal.setCloseCallback(function(){settingsUrlProps.url.indexOf("onboarding/employeeflow")>=0||settingsUrlProps.url.indexOf("onboarding/candidateflow")>=0?NewZPOnboarding.addChecklisttoList():ZPA_Checklist.IS_LOADED=!1,ZPA_Checklist.Slider.remove()});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST);pageId.find("#sliderSbt").addClass("DN");var chkli_cards=pageId.find("#"+tab.cardId);chkli_cards.append(ZPA_Common.Cards.construct("chk_editbasic",ZPA_Checklist.ContainerBody.BASIC_EDIT)),chkli_cards.append(ZPA_Checklist.ContainerBody.getTaskMapHtml(chklstObj.formtasks,formId)),chkli_cards.append(ZPA_Checklist.ContainerBody.ACTION_MAP),ZPA_Actions.init(ZP_Automation_Mode.CHECKLIST,formId,pageId.find("[name=action_container]"),ZPA_Common.getActionToBMapped(ZP_Automation_Mode.CHECKLIST)),ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.CHECKLIST))},remove:function(){if(ZPA_Common.getPageMode()==ZP_Automation_Mode.CHECKLIST){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.CHECKLIST)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/checklist-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/checklist"}ZPeopleComponents.isComponent("#checklist_formList")&&ZPeopleComponents.select("#checklist_formList").destroy(),ZPA_Checklist.Slider.chkModal.remove()},editChklstName:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST);pageId.find("#checklist_name").removeAttr("disabled"),pageId.find("#checklist_name").removeClass("is-disabled"),pageId.find("#saveChklstDiv").removeClass("DNI"),pageId.find("#editchkIc").addClass("DNI")},savechklistName:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST);pageId.find("#checklist_name").val()!=pageId.find("#checklist_name").data("checklist_name")&&ZPA_Checklist.saveChklist(pageId,function(data){"success"==data.status&&(ZPeople.Message.success(ZPI18N.getString("zp.chknamechange")),ZPA_Common.removeErrorDiv(pageId))})},getCheckListMappedTask:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST);pageId.find("#chk_taskmap #sortableTaskParent").remove();var checklistId=pageId.data("checklistId");if(!ZPUtil.Validation.isEmpty(checklistId)){var params={checklistId:checklistId,method:"getChecklistMappedTasks"};ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.EMAILALERT)),ZPeople.Request.send("/getChecklistMappedTasks.zp",params,ZPA_Checklist.Slider.constructTaskList)}},getChecklistAssociatedTask:function(){var taskLiList=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST).find("[parenttask=0] li"),taskIds=[];return $.each(taskLiList,function(index,liObj){var taskId=$(liObj).attr("taskid");taskIds.push(taskId)}),taskIds},mapTaskToAnchestor:function(){var popUpId=ZPA_Common.getPopUpId(ZPA_Checklist.Popup.taskMapModal),mapTaskList=ZPeopleComponents.tokenfield(popUpId.find("#taskDD")).getAllValues(),pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST),formId=ZPA_Common.getFormId(ZP_Automation_Mode.CHECKLIST),taskLiDiv=pageId.find("ul#sortable1"),taskListDiv="",taskIds=[];mapTaskList.length>0&&($.each(mapTaskList,function(index,taskItem){var taskId=taskItem.id;taskIds.push(taskId),taskListDiv+='<li taskId="'+taskId+'"><div name="fgrp"><i class="PI_drag"></i>',taskListDiv+=taskItem.value+'<span class="zpl_hvr"><i action="edit" title="'+ZPI18N.getString("zp.edit")+'" class="PI_edt" onclick="ZPA_Task.edit(\''+taskId+"', '"+formId+'\')"></i><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" class="PI_delete" onclick="ZPA_Checklist.Slider.deleteChecklistMap(\''+taskId+"')\"></i></span></div></li>"}),$.post("/mapTaskChecklist.zp",{conreqcsr:csrfToken,method:"mapTaskChecklist",tasks:JSON.stringify(taskIds),checklistid:pageId.data("checklistId")},function(data){"success"==data.status?(0==taskLiDiv.length?(pageId.find("#chk_taskmap").append('<div id="sortableTaskParent" class="zpl_crdcnt"><div class="zpl_secn"><div><div class="zpl_apilstdv"><div><ul id="sortable1" parentTask="0" name="sortableTaskDiv"></ul></div></div></div></div></div>'),(taskLiDiv=pageId.find("ul#sortable1")).append(taskListDiv),ZPA_Checklist.Slider.checklistTaskTree(),ZPA_Checklist.Slider.toggleChecklistTree()):taskLiDiv.append(taskListDiv),ZPA_Checklist.Popup.taskMapModal.remove(),ZPeople.Message.success(ZPI18N.getString("zp.tskmaptochk")),ZPA_Checklist.Slider.getChecklistAssociatedTask().length==ZPA_Checklist.TASK_LIST.length?pageId.find("#existTask").addClass("DN"):pageId.find("#existTask").removeClass("DN")):ZPeople.Message.failure("Error occurred")}))},constructTaskList:function(data){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST);if($.isEmptyObject(data))ZPA_Checklist.TASK_LIST.length>0&&pageId.find("#existTask").removeClass("DN");else{pageId.find("#chk_taskmap").append('<div id="sortableTaskParent" class="zpl_crdcnt"></div>'),ZPA_Common.Loader.add(pageId.find("#sortableTaskParent"));var taskObj=data.tasks;Object.keys(taskObj).length>=ZPA_Checklist.TASK_LIST.length?pageId.find("#existTask").addClass("DN"):pageId.find("#existTask").removeClass("DN");var parentTaskObj=data.parentDtls,taskMapHtml=$('<div class="zpl_secn"><div><div class="zpl_apilstdv"><div class="zpl_secn"><ul id="sortable1" parentTask="0" name="sortableTaskDiv"></ul></div></div></div></div>');ZPA_Checklist.Slider.getChecklistTasksTreeHtml(taskMapHtml,0,parentTaskObj,taskObj,[]),pageId.find("#chk_taskmap .zpl_crdcnt").html(taskMapHtml.html()),ZPA_Checklist.Slider.checklistTaskTree(),ZPA_Checklist.Slider.toggleChecklistTree(),ZPA_Common.Loader.remove(pageId.find("#sortableTaskParent"),1e3)}},getChecklistTasksTreeHtml:function(obj,taskId,parentDtls,tasks,addTaskIds){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.CHECKLIST);if(-1==addTaskIds.indexOf(taskId)){addTaskIds.push(taskId);var taskIds=parentDtls[taskId];void 0!==taskIds&&$.each(taskIds,function(index,childTaskId){str="<li taskId="+childTaskId+'><div name="fgrp"><i class="PI_drag"></i>',void 0!==parentDtls[childTaskId]&&(str+='<i name="darrow" class="PI_argt expnd"></i>'),str+=tasks[childTaskId].taskConfigName+'<span class="zpl_hvr"><i action="edit" title="'+ZPI18N.getString("zp.edit")+'" class="PI_edt" onclick="ZPA_Task.edit(\''+childTaskId+"', '"+formId+'\')"></i><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" class="PI_delete" onclick="ZPA_Checklist.Slider.deleteChecklistMap(\''+childTaskId+"')\"></i></span></div>",void 0!==parentDtls[childTaskId]&&(str+="<ul parentTask="+childTaskId+"></ul>"),$(obj).find("ul[parentTask='"+taskId+"']").append(str),ZPA_Checklist.Slider.getChecklistTasksTreeHtml(obj,childTaskId,parentDtls,tasks,addTaskIds)})}},checklistTaskTree:function(){ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST).find("#sortable1").nestedSortable({listType:"ul",forcePlaceholderSize:!0,isTree:!0,handle:"div",items:"li",placeholder:"placeholder",toleranceElement:"> div",start:function(event,ui){var curId=ui.item.attr("taskid");oldParent=$("[taskid="+curId+"]").parent().parent(),oldParentTaskId=$(oldParent).attr("taskid")},stop:function(event,ui){var curId=ui.item.attr("taskid"),currentItem=ui.item,parentId=$("[taskid="+curId+"]").parent().parent().attr("taskid");void 0===parentId&&(parentId=0);var noOfchilds=ZPA_Checklist.Slider.checkNumberOfSubTask(currentItem),parentNodeObj=$("[taskid="+curId+"]").parent().parent(),parentTaskId=$(parentNodeObj).attr("taskid"),currentElmClass=$(currentItem).children("[name=fgrp]").children("[name=darrow]").attr("class");if($(currentItem).children("[name=fgrp]").children("[name=darrow]").remove(),0!==noOfchilds&&$(currentItem).children("[name=fgrp]").find(".PI_drag").first().after($("<b class='"+currentElmClass+"' name='darrow'>")),oldParentTaskId){var childOfOldParent=ZPA_Checklist.Slider.checkNumberOfSubTask(oldParent);$(oldParent).children("[name=fgrp]").children("[name=darrow]").remove(),0!==childOfOldParent&&$(oldParent).children("[name=fgrp]").find(".PI_drag").first().after($("<b class='PI_argt expnd' name='darrow'>"))}if(parentTaskId){var childOfNewParent=ZPA_Checklist.Slider.checkNumberOfSubTask(parentNodeObj);$(parentNodeObj).children("[name=fgrp]").children("[name=darrow]").remove(),0!==childOfNewParent&&$(parentNodeObj).children("[name=fgrp]").find(".PI_drag").first().after($("<b class='PI_argt expnd' name='darrow'>"))}ZPA_Common.isNotNull(oldParentTaskId)&&ZPA_Common.isNotNull(parentTaskId)||oldParentTaskId==parentTaskId||(ZPA_Checklist.Slider.reOrderChecklist(curId,parentId),ZPA_Checklist.Slider.toggleChecklistTree())}})},reOrderChecklist:function(src,dest){var params="child="+src+"&parent="+dest+"&checklistid="+ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST).data("checklistId")+"&method=changeCheckListTaskOrder&"+csrfParamName+"="+csrfToken;params.method="changeCheckListItemOrder",$.post("/changeCheckListTaskOrder.zp",params,function(data){"failure"===data.status?ZPeople.Message.failure(ZPI18N.getString("zp.rebranderrinaction")):ZPeople.Message.success(ZPI18N.getString("zp.chkorderchange"))})},toggleChecklistTree:function(){ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST).find("[name=darrow]").off().on("click",function(){$(this).parent("[name=fgrp]").siblings("ul").toggle(),$(this).attr("class").indexOf("expnd")>=0?$(this).removeClass("expnd"):$(this).addClass("expnd")})},deleteChecklistMap:function(taskId){var params={checklistId:ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST).data("checklistId")+"",taskConfigId:taskId,method:"deleteChecklistMap",conreqcsr:csrfToken};$.ajax({url:"/deleteChecklistMap.zp",type:"POST",data:params,success:function(data){"success"===data.status?(ZPA_Checklist.Slider.getCheckListMappedTask(),ZPeople.Message.success(ZPI18N.getString("zp.tskrmvdfrmchk"))):ZPeople.Message.failure(ZPI18N.getString("zp.rebranderrinaction"))}})},checkNumberOfSubTask:function(obj){return $(obj).find("ul li").length},callBackonSaveActions:function(mode,params){var checklistId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST).data("checklistId");ZPA_Actions.callBackActions(mode,params);var actionId=params[ZPA_Actions.getKey(mode)],actionType=ZPA_Checklist.Slider.getActionType(mode);ZPA_Checklist.Slider.mapClWfAction(checklistId,actionId,actionType,!0)},getActionType:function(mode){var actionType="";switch(mode){case ZP_Automation_Mode.EMAILALERT:actionType="mailAlertIds";break;case ZP_Automation_Mode.FIELDUPDATE:actionType="fieldUpdateIds";break;case ZP_Automation_Mode.CUSTOMFUNCTION:actionType="customfnIds"}return actionType},selectActionsCallback:function(pageMode,mode,itemData){var checklistId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST).data("checklistId"),actionType=ZPA_Checklist.Slider.getActionType(mode),actionId=itemData.templateId;ZPA_Checklist.Slider.mapClWfAction(checklistId,actionId,actionType,!0),ZPeople.Message.success(ZPA_Checklist.Slider.getActionMapMsg(mode,!0))},mapClWfAction:function(checklistId,actionId,actionType,oprType){var params={checklistId:checklistId,method:"mapClWfAction",mode:1==oprType?"add":"remove",actionType:actionType,actionId:actionId,conreqcsr:csrfToken};ZPeople.Request.send("/mapClWfAction.zp",params)},getActionMapMsg:function(mode,oprType){var respMsg="";switch(mode){case ZP_Automation_Mode.EMAILALERT:respMsg=1==oprType?ZPI18N.getString("zp.emlalrtmap"):ZPI18N.getString("zp.emlalrtrem");break;case ZP_Automation_Mode.FIELDUPDATE:respMsg=1==oprType?ZPI18N.getString("zp.fldupdmap"):ZPI18N.getString("zp.fldupdrem");break;case ZP_Automation_Mode.CUSTOMFUNCTION:respMsg=1==oprType?ZPI18N.getString("zp.cfmap"):ZPI18N.getString("zp.cfrem")}return respMsg},removeAction:function(getThis,mode){var checklistId=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST).data("checklistId"),actionId=$(getThis).closest("tr").attr("templateid");ZPA_Checklist.Slider.mapClWfAction(checklistId,actionId,ZPA_Checklist.Slider.getActionType(mode),!1),ZPA_Actions.removeItem(getThis,mode),ZPeople.Message.success(ZPA_Checklist.Slider.getActionMapMsg(mode,!1))}},ZPA_Checklist.ContainerBody={BASIC:'<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+'</label></div><div><select type="text" id="checklist_formList" class="ztextbox" value=""></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.checklist.name")+'</label></div><div><input type="text" id="checklist_name" placeholder="" class="ztextbox"></div></div>',BASIC_EDIT:'<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+'</label></div><div><select type="text" id="checklist_formList" class="ztextbox" value=""></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.checklist.name")+'</label></div><div><input type="text" id="checklist_name" placeholder="" class="ztextbox" onblur="ZPA_Checklist.Slider.savechklistName()"></div></div>',ACTION_MAP:'<div class="zpl_crd" id="chk_actionmap"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.actionafterchklist")+'</h4></div></div><div class="zpl_crdcnt"><div name="action_container" class="zpl_secn"></div></div></div>',TEMPLATE_MAP:'<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.associatedtasks")+'</label></div><div><div id="taskDD"></div></div></div>',getTaskMapHtml:function(taskList,formId){var taskMapHtml='<div class="zpl_crd" id="chk_taskmap"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.task")+"</h4><p>"+ZPI18N.getString("zp.dragdropinfo")+"</p></div><div>";return taskMapHtml+='<button type="button" id="existTask" onclick="ZPA_Checklist.Popup.constructTempMapPopup()" class="zlabel zlabel--outline zlabel--medium '+(void 0!=taskList&&0==taskList.length?"DN":"")+'">'+ZPI18N.getString("zp.selectexisttemplate")+"</button>",taskMapHtml+='<button id="addnewtask" onclick="ZPA_Task.add(\''+formId+'\')" data-popup-open="taskpopup" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.checklistaddnewtask")+"</button></div></div>",taskMapHtml+="</div>"}},ZPA_Task={FORMFIELDS_JSON:{},priorityArray:[],TASK_OWNER:{},IS_LOADED:!1,LIMIT:{TASK_NAME:100,DESC:5e3,DISP_NAME:255},initThirdLvlTab:function(){var pageId=ZPA_Common.getParentPageId();ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.CHECKLIST)).destroy();var topMenuDiv=pageId.find("#topSettMenu");topMenuDiv.removeClass("zp_dyn"),topMenuDiv.find(".zpl_rgt").siblings().remove(),topMenuDiv.find(".zpl_rgt").remove();var topmenuHtml="<div ><span>"+ZPI18N.getString("zp.selectform")+'</span><select id="'+ZPA_Common.getFormListId(ZP_Automation_Mode.TASK)+'"></select></div>'+'<div class="zpl_rgt"> <button id="add_task" class="zlabel zlabel--blue zlabel--medium" onclick="ZPA_Task.addSlide()">'+ZPI18N.getString("zp.addtask")+"</button></div>";topMenuDiv.append(topmenuHtml),ZPA_Common.loadFormListInListPage(ZP_Automation_Mode.TASK),ZPA_Task.initPage()},initPage:function(formId){var pageId=ZPA_Common.getParentPageId(),serviceName=ZPA_Common.getServiceName();if(formId=ZPA_Common.isNotNull(formId)?formId:formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.TASK)).getValue(),0==ZPA_Task.IS_LOADED){pageId.find(".zpl_rgtcnt").empty(),ZPA_Common.Loader.appendPageLoading(pageId);var params={formId:formId,method:"list",conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),$.post("/getTaskList.zp",params,function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.TASK))return ZPA_Common.Loader.removePageLoading(pageId),!1;if(ZPA_Task.IS_LOADED=!0,0!=data.length){pageId.find("#add_task").removeClass("DN");var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+"</th><th>"+ZPI18N.getString("zp.dueby")+"</th><th>"+ZPI18N.getString("zp.taskowner")+'</th><th width="80"></th></tr></thead><tbody>';$.each(data,function(index,taskDtl){body+='<tr taskId="'+taskDtl.taskconfigid+'" onclick="ZPA_Task.editSlide(\''+taskDtl.taskconfigid+"','"+taskDtl.formid+"')\"><td>"+taskDtl.dispname+"</td><td><span>"+taskDtl.displayname+"</span></td><td><span>"+ZPA_TBA.tbaConstructView(taskDtl.dayslimit)+"</span></td>",$.each(this.taskOwner,function(key,value){$.each(value,function(index,owner){"employee"===key?body+="<td><span>"+owner+" - "+ZPI18N.getString("zp.employee")+"</span></td>":"department"===key?body+="<td><span>"+owner+" - "+ZPI18N.getString("zp.department")+"</span></td>":"group"===key?body+="<td><span>"+owner+" - "+ZPI18N.getString("zp.group")+"</span></td>":"role"===key?body+="<td><span>"+owner+" - "+ZPI18N.getString("zp.role")+"</span></td>":"lookup"===key?body+="<td><span>"+owner+" - "+ZPI18N.getString("zp.formfield")+"</span></td>":"system"===key&&(body+="<td><span>"+owner+" - "+ZPI18N.getString("zp.systemopt")+"</span></td>")})}),body+='<td><div class="zpl_hvr"><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" taskId="'+this.taskconfigid+'" onclick="ZPA_Common.deleteConfirmationPopup(this, \''+ZP_Automation_Mode.TASK+"', ZPA_Task.deleteTask)\"></i></div></td></tr>"}),body+="</tbody></table></div>",pageId.find(".zpl_rgtcnt").append(body)}else{pageId.find("#add_task").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.TASK),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.TASK),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.TASK),pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.addtask"),ZPA_Task.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)})}},addSlide:function(){if(ZPA_Common.validateAddConfig()){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.TASK)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/checklist/taskadd-formid:"+formId}},add:function(formId){ZPA_Task.construct(ZPI18N.getString("zp.addtask"),0),formId=ZPA_Common.getPageMode()==ZP_Automation_Mode.TASK?ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.TASK)).getValue():formId,ZPA_Task.loadDefault(!1,formId),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.TASK),500)},editSlide:function(taskId,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/checklist/taskedit-formid:"+formId+"/taskid:"+taskId},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_Task.edit(editParams.taskid,editParams.formid)},edit:function(taskId,formId){ZPA_Task.construct(ZPI18N.getString("zp.edittask"),taskId),ZPA_Task.loadDefault(!0,formId);var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.TASK),params={taskConfigId:taskId,method:"getTaskConfig",conreqcsr:csrfToken};$.post("/getTaskConfig.zp",params,function(data){pageId.find("#formDiv").html($("<div>",{mode:"task",id:"editmode",formId:data.formId,taskconfigid:data.taskConfigId,text:ZPeople.decodeTxt(data.displayName)})),ZPA_Task.resetTaskConfig(),pageId.find("#task_name").val(decodeHTML(data.taskname)),pageId.find("#task_dispname").val(decodeHTML(data.dispname)),pageId.find("#task_desc").val(decodeHTML(data.desc)),void 0!=data.priorityId&&(ZPeopleComponents.select("#task_priority").setAttribute("selectedValue",data.priorityId),ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.TASK,!1)),void 0!==data.taskOwner&&ZPA_Task.TabPanel.appendTaskOwnerDtls(data.taskOwner),ZPA_TBA.setTbaValues(data.days,pageId.find("#tbaDiv")),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.TASK),500)})},deleteTask:function(thisObj){var delIcObj=thisObj.delIcObj,taskId=$(delIcObj).attr("taskId"),params={taskConfigId:taskId,method:"delete",conreqcsr:csrfToken};$.post("/deleteTaskConfig.zp",params,function(data){if(void 0!==data.status)if("success"===data.status){ZPA_Task.IS_LOADED=!1;var actBody=ZPA_Common.getParentPageId().find("[name=action_body]");actBody.find("[taskId="+taskId+"]").remove(),ZPeople.Message.success(ZPI18N.getString("zp.taskdeletesuccess")),0==actBody.find("tr[taskId]").length&&ZPA_Task.initPage()}else void 0!==data.checklistmapping&&ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.TASK,data.checklistmapping);else ZPeople.Message.failure(ZPI18N.getString("zp.taskconfignotfound"))})},construct:function(header,taskId){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.TASK),tab.cardId="task_cards",tab.validate=ZPA_Task.save,ZPA_Task.taskModal=new sliderModal(header,tab),ZPA_Task.taskModal.construct(),ZPA_Common.CloseAlert.construct(ZPA_Task.taskModal),ZPA_Task.taskModal.setCloseCallback(function(){ZPA_Task.remove()});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.TASK);pageId.data("modalInstance",ZPA_Task.taskModal),pageId.data("taskId",taskId);var $task_cards=pageId.find("#"+tab.cardId);ZPA_Common.setRelativeContainer($task_cards),$task_cards.append(ZPA_Common.Cards.construct("task_basic",ZPA_Task.getContainerBody())),ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.TASK))},remove:function(){if(ZPA_TBA.destroyTBA(),ZPA_Common.getPageMode()==ZP_Automation_Mode.TASK){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.TASK)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/checklist-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/checklist"}ZPA_Task.taskModal.remove()},loadDefault:function(isEdit,formId){ZPA_Common.getFormList(ZP_Automation_Mode.TASK,ZPA_Common.getServiceName());var formListProp={options:ZPA_Common[ZPA_Common.getFormListMode(ZP_Automation_Mode.TASK,ZPA_Common.getServiceName())],dataMapping:{label:"dispName",value:"formId",title:"dispName"},change:ZPA_Task.resetTaskConfig};ZPA_Common.isNotNull(formId)&&"0"!=formId&&(formListProp.selectedValue=formId,(isEdit||ZPA_Common.getPageMode()!=ZP_Automation_Mode.TASK)&&(formListProp.disabled=!0)),ZPA_Common.ZCompProp.loadSelectListProp(formListProp),ZPeopleComponents.select("#task_formList",formListProp),formId=void 0!=formId?formId:ZPeopleComponents.select("#task_formList").getValue(),ZPA_Common.isNotNull(ZPA_Task.priorityArray)&&0!=ZPA_Task.priorityArray.length||ZPA_Task.getOptionValues();var priorityProp={options:ZPA_Task.priorityArray,dataMapping:{label:"DISPVALUE",value:"ID"},change:function(){ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.TASK)}};isEdit||(priorityProp.selectedValue=ZPA_Task.DEFAULT_PRIORITY),ZPA_Common.ZCompProp.loadSelectListProp(priorityProp,!0),ZPeopleComponents.select("#task_priority",priorityProp),ZPA_TBA.loadDefault(ZPA_Common.getMainContainer().find("#task_cards"),formId),ZPA_Task.loadTaskOwnerDtls(formId,!0)},loadTaskOwnerDtls:function(formId,async){if(void 0==ZPA_Task.TASK_OWNER[formId]){var params={formId:formId,method:"getTaskOwnerList",conreqcsr:csrfToken};$.ajax({url:"/getTaskOwnerList.zp",type:"POST",data:params,async:async,success:function(data){ZPA_Task.TASK_OWNER={},data.employee=ZPA_Task.getClEmployeeObjs(),ZPA_Task.TASK_OWNER[formId]=data}})}},resetTaskConfig:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.TASK);ZPA_Common.getFormId(ZP_Automation_Mode.TASK);pageId.find("#task_name").val(""),pageId.find("#task_dispname").val(""),pageId.find("#task_desc").val(""),ZPA_Task.FORMFIELDS_JSON={},ZPA_Task.TASK_OWNER={},ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.TASK,!1),ZPeopleComponents.isComponent("#dispName_tabPanel")&&ZPeopleComponents.tabbedlistboxpopup("#dispName_tabPanel").destroy(),ZPeopleComponents.isComponent("#taskName_tabPanel")&&ZPeopleComponents.tabbedlistboxpopup("#taskName_tabPanel").destroy(),ZPeopleComponents.isComponent("#desc_tabPanel")&&ZPeopleComponents.tabbedlistboxpopup("#desc_tabPanel").destroy(),ZPeopleComponents.isComponent("#taskOwner_tabPanel")&&ZPeopleComponents.tabbedlistboxpopup("#taskOwner_tabPanel").destroy()},getOptionValues:function(){if(void 0===ZPA_Task.priorityArray||!ZPA_Common.isNotNull(ZPA_Task.priorityArray)||0==ZPA_Task.priorityArray.length){var params={method:"getTaskOptionValues",conreqcsr:csrfToken,mode:"list"};$.ajax({url:"/getOptionValues.zp",type:"POST",data:params,async:!1,success:function(data){ZPA_Task.priorityArray=data.Priority,ZPA_Task.setDefaultPriorityVal()}})}return{}},setDefaultPriorityVal:function(){$.each(ZPA_Task.priorityArray,function(index,priorityObj){2==priorityObj.SYSVALUE&&(ZPA_Task.DEFAULT_PRIORITY=priorityObj.ID)})},validateTaskConfig:function(taskObj){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.TASK),isError=!1;ZPUtil.Validation.isEmpty(taskObj.taskName)&&(ZPA_Common.appendErrorDiv(pageId.find("#task_name").parent(),ZPI18N.getString("zp.entdispname")),isError=!0),taskObj.taskName.length>ZPA_Task.LIMIT.DISP_NAME&&(ZPA_Common.appendErrorDiv(pageId.find("#task_name").parent(),ZPI18N.getString("zp.maxtaskdisplayname")),isError=!0),taskObj.desc.length>ZPA_Task.LIMIT.DESC&&(ZPA_Common.appendErrorDiv(pageId.find("#task_desc").parent(),ZPI18N.getString("zp.maxdesclimit",[ZPA_Task.LIMIT.DESC])),isError=!0),ZPUtil.Validation.isEmpty(taskObj.taskConfigName)&&(ZPA_Common.appendErrorDiv(pageId.find("#task_dispname"),ZPI18N.getString("zp.emptytaskname")),isError=!0),taskObj.taskConfigName.length>ZPA_Task.LIMIT.TASK_NAME&&(ZPA_Common.appendErrorDiv(pageId.find("#task_dispname"),ZPI18N.getString("zp.maxtaskname")),isError=!0);var isTaskOwnerSelected=!1;$.each(taskObj.taskownerdtls,function(key,value){taskObj.taskownerdtls[key]=value[0],isTaskOwnerSelected=!0}),isTaskOwnerSelected||(ZPA_Common.appendErrorDiv(pageId.find("#taskOwner_Inp").parent(),ZPI18N.getString("zp.emptytaskowner")),isError=!0);var dueDate=taskObj.dayLimit.days;return(!ZPA_Common.isValidNumber(dueDate)||dueDate<0)&&(ZPA_Common.appendErrorDiv(pageId.find("#tbaDiv #duration"),ZPI18N.getString("zp.enteravalidnumber")),isError=!0),isError},save:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.TASK);ZPA_Common.disableSaveBtn(pageId);var taskId=pageId.data("taskId"),taskObj={},formId=ZPA_Common.getFormId(ZP_Automation_Mode.TASK);if(taskObj.formId=formId,taskObj.taskName=pageId.find("#task_name").val(),taskObj.taskConfigName=pageId.find("#task_dispname").val(),taskObj.desc=pageId.find("#task_desc").val(),taskObj.dayLimit=ZPA_TBA.getTbaObj(pageId.find("#tbaDiv")),taskObj.taskConfigId=taskId,taskObj.priorityId=ZPeopleComponents.select("#task_priority").getValue(),taskObj.taskownerdtls=ZPA_TabbedListBox.getTagConfig(pageId.find("#taskOwner_Inp")),ZPA_Common.removeErrorDiv(pageId),ZPA_Task.validateTaskConfig(taskObj))ZPA_Common.enableSaveBtn(pageId);else{var pageMode=ZPA_Common.getPageMode();0==taskId&&pageMode!=ZP_Automation_Mode.TASK&&(taskObj.checklistid=ZPA_Common.getPageId(ZP_Automation_Mode.CHECKLIST).data("checklistId"));var params={configuration:JSON.stringify(taskObj),method:"save",conreqcsr:csrfToken};ZPeople.Request.send("/saveTaskConfig.zp",params,function(data){if(void 0!==data.status&&"success"===data.status){if(ZPA_Common.isNotNull(taskId)&&0!=taskId?ZPeople.Message.success(ZPI18N.getString("zp.tskupd")):ZPeople.Message.success(ZPI18N.getString("zp.tasksuccessmsg")),ZPA_Common.enableSaveBtn(pageId),ZPA_Task.remove(),pageMode!=ZP_Automation_Mode.TASK){let taskObj={id:data.taskconfigid,value:data.taskConfigName};ZPA_Checklist.TASK_LIST.push(taskObj),ZPA_Checklist.Slider.getCheckListMappedTask(),ZPeople.Message.success(ZPI18N.getString("zp.tskmaptochk"))}else ZPA_Task.afterSaveCB(formId);ZPACommon.getUrlMode()===ZPOnboarding.MODE&&NewZPOnboarding.config.taskListener(data)}else data.hasOwnProperty("isActiveTaskOwner")?!1===data.isActiveTaskOwner&&(ZPeople.Message.failure(ZPI18N.getString("zp.inactiveusermsg")),ZPA_Common.enableSaveBtn(pageId)):ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror"))},"",function(data){ZPA_Common.enableSaveBtn(pageId),ZPA_Common.isNotNull(data.responseJSON.error)&&ZPeople.Message.failure(data.responseJSON.error)})}},afterSaveCB:function(formId){ZPA_Task.IS_LOADED=!1,formId!=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.TASK)).getValue()&&ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.TASK)).setValue(formId)},getContainerBody:function(){var body='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+'</label></div><div><select type="text" id="task_formList" class="ztextbox" value=""></select></div></div>';return body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.taskname")+'</label></div><div><div><input type="text" id="task_dispname" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.TASK+'\')" placeholder="" class="ztextbox"></div></div></div>',body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.displayname")+'</label></div><div><div class="ztextbox--group zh-alignright zpl_inpticfild"><i id="taskName_AddIc" class="ztextbox__icon PI_addlist" onclick="ZPA_Task.TabPanel.openTabPanel(\'taskName_tabPanel\', \'taskName_AddIc\', \'task_name\')"></i><input type="text" id="task_name" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.TASK+'\')" placeholder="" class="ztextbox"><div id="taskName_tabPanel"></div></div></div></div>',body+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.description")+'</label></div><div><div class="ztextbox--group zh-alignright zpl_inpticfild"><i id="desc_AddIc" class="ztextbox__icon PI_addlist" onclick="ZPA_Task.TabPanel.openTabPanel(\'desc_tabPanel\', \'desc_AddIc\', \'task_desc\')"></i><textarea type="text" id="task_desc" rows="4" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.TASK+'\')"></textarea><div id="desc_tabPanel"></div></div></div></div>',body+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.prioritylvl")+'</label></div><div><select type="text" id="task_priority" class="ztextbox" value=""></select></div></div>',body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.taskowner")+'</label></div><div><div class="zpl_inpgrp" ><div id="taskOwner_Inp" class="zpl_frmctrl"></div><a class="grp_add" id="taskOwner_AddIc" onclick="ZPA_TabbedListBox.initializeTabPanel(this, \'taskOwner\', \'taskOwner_tabPanel\', \'taskOwner_AddIc\', \'taskOwner_Inp\')"><i class="PI_addlist"></i></a><div id="taskOwner_tabPanel"></div></div></div></div>',body+='<div class="zpl_secn" id="tbaDiv"><label>'+ZPI18N.getString("zp.dueby")+"</label>"+ZPA_TBA.HTML+"</div></div>"},constructFormFieldDtls:function(async){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.TASK);$.isEmptyObject(ZPA_Task.FORMFIELDS_JSON)&&ZPA_Common.getFormFields(ZP_Automation_Mode.TASK,formId,async)},getClEmployeeObjs:function(){var employeeObjs={},userList=ZPeople.getUserDetailsByIds(ZPeople.SUB_USERLIST);return $.each(userList,function(cnt,empObj){"false"===empObj.isNonUser&&(employeeObjs[empObj.usererec]=empObj.name)}),employeeObjs}},ZPA_Task.TabPanel={openTabPanel:function(id,forEleId,targetId){if(ZPA_Task.constructFormFieldDtls(!1),!ZPeopleComponents.isComponent("#"+id)){var tabPanelObj={id:id,forEleId:forEleId,targetId:targetId,appendTo:"#task_cards",select:ZPA_Task.TabPanel.selectFormField};ZPA_Util.TabPanel.loadFormFieldTabPanel(ZPA_Task.FORMFIELDS_JSON,tabPanelObj)}ZPeopleComponents.tabbedlistboxpopup("#"+id).open()},selectFormField:function(event,eventObj){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.TASK),itemData=(eventObj.id,eventObj.forEleId,event.detail.itemData),targetId=(event.detail.options.tabData,eventObj.targetId),inpVal=pageId.find("#"+targetId).val();inpVal+="${"+itemData.label+"}",pageId.find("#"+targetId).val(inpVal),ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.TASK)},keyPairIdJson:{employee:{id:"employee",dispVal:ZPI18N.getString("zp.users")},department:{id:"department",dispVal:ZPI18N.getString("zp.departments")},role:{id:"role",dispVal:ZPI18N.getString("zp.roles")},group:{id:"group",dispVal:ZPI18N.getString("zp.groups")},lookup:{id:"lookup",dispVal:ZPI18N.getString("zp.formfields")},system:{id:"system",dispVal:ZPI18N.getString("zp.systemopt")}},openTaskOwnerTabPanel:function(id,forEleId,targetId){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.TASK);ZPA_Task.loadTaskOwnerDtls(formId,!1),ZPA_Task.TabPanel.loadTaskOwnerTabs(id,forEleId,targetId)},loadTaskOwnerTabs:function(id,forEleID,targetId){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.TASK),tabs=[],tabKeys=Object.keys(ZPA_Task.TabPanel.keyPairIdJson),taskOwnerDtls=ZPA_Task.TASK_OWNER[formId];$.each(tabKeys,function(index,tabKey){let keyPairOBj=ZPA_Task.TabPanel.keyPairIdJson[tabKey];if(void 0==keyPairOBj)return;let tabObj={};if(tabObj.label=keyPairOBj.dispVal,tabObj.panelId=tabKey+"_panel",tabObj.id=keyPairOBj.id,"employee"==tabKey)tabObj.listboxOptions={searchFieldOptions:{placeholder:ZPI18N.getString("zp.searchbyemp")},messages:{noResults:ZPI18N.getString("zp.nologinusers")},dataSource:{search:function(params){return new Promise(function(search,reject){var searchQry=params.query,userList=[];if(ZPA_Common.isNotNull(searchQry)){var searchRes=EmployeeSearch.getEmpList(searchQry,"emp","AUTOMATION");$.each(searchRes,function(index,userData){let mailAddrObj={};mailAddrObj.Id=userData.id,mailAddrObj.Value=userData.value,mailAddrObj.title=userData.value,mailAddrObj.imageUrl=userData.image,userList.push(mailAddrObj)})}else{var orgUsersList=ZPeople.getUserListData();$.each(orgUsersList,function(index,userData){if(index>=AutomationConstants.Limit.LISTING_LIMIT)return!1;if("false"==userData.isNonUser){let mailAddrObj={};mailAddrObj.Id=userData.usererec,mailAddrObj.Value=userData.empid+" "+userData.name,mailAddrObj.title=userData.empid+" "+userData.name,mailAddrObj.imageUrl=userData.avatar,userList.push(mailAddrObj)}})}search({delay:20,results:userList,more:!1})})}},serverSearch:!0,cacheData:!0},tabs.push(tabObj);else if("group"==tabKey||"department"==tabKey)tabObj.listboxOptions={searchFieldOptions:{placeholder:"group"==tabKey?ZPI18N.getString("zp.entergroupname"):ZPI18N.getString("zp.entdept")},dataSource:{search:function(params){return new Promise(function(search,reject){var searchQry=params.query,resultList=[];if(ZPA_Common.isNotNull(searchQry)){var category="group"==tabKey?"grp":"dept",module="group"==tabKey?"AUTOMATION":"FEEDS",searchRes=EmployeeSearch.getListData(searchQry.toLowerCase(),category,module,searchQry.toLowerCase());$.each(searchRes,function(index,userData){let mailAddrObj={};mailAddrObj.Id=userData.id,mailAddrObj.Value=userData.value,mailAddrObj.imageUrl=userData.image,resultList.push(mailAddrObj)})}else{var taskOwnerJObj=taskOwnerDtls[tabKey],taskOwnerIds=Object.keys(taskOwnerJObj);void 0!=taskOwnerIds&&taskOwnerIds.length>0&&$.each(taskOwnerIds,function(index,ownerId){if(index>=AutomationConstants.Limit.LISTING_LIMIT)return!1;let ownerObj={};ownerObj.Id=ownerId,ownerObj.Value=taskOwnerJObj[ownerId],resultList.push(ownerObj)})}search({delay:20,results:resultList,more:!1})})}},serverSearch:!0,cacheData:!0},tabs.push(tabObj);else{var taskOwnerJObj=taskOwnerDtls[tabKey],taskOwnerIds=Object.keys(taskOwnerJObj);if(void 0!=taskOwnerIds&&taskOwnerIds.length>0){var taskOwnerItems=[];$.each(taskOwnerIds,function(index,ownerId){let ownerObj={};ownerObj.Id=ownerId,ownerObj.Value=taskOwnerJObj[ownerId],taskOwnerItems.push(ownerObj)}),tabObj.items=taskOwnerItems,tabs.push(tabObj)}}});var tabPanelProps={tabs:tabs,id:id,forElement:"#"+forEleID,targetId:targetId,appendTo:"#task_cards",select:ZPA_Task.TabPanel.selectCallback,deselect:ZPA_TabbedListBox.deselectCallback,pointer:!0};tabPanelProps.listboxOptions={dataMapping:{id:"Id",value:"Id",text:"Value"},showSearchField:!0,search:{by:"Id",criteria:"contains"},searchFieldOptions:{placeholder:ZPI18N.getString("zp.search")},messages:{noResults:ZPI18N.getString("zp.noresults")},multiple:!1,isTextHTMLEncoded:!0},ZPeopleComponents.tabbedlistboxpopup("#"+id,tabPanelProps)},selectCallback:function(event,tabPanelProps){if(event.detail.fromUI){ZPA_Common.getPageId(ZP_Automation_Mode.TASK).find("#taskOwner_Inp").empty();tabPanelProps.id;ZPA_TabbedListBox.selectCallback(event,tabPanelProps),ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.TASK)}},appendTaskOwnerDtls:function(taskOwnerDtls){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.TASK);if(!$.isEmptyObject(taskOwnerDtls)){var taskOwnKeys=Object.keys(taskOwnerDtls);$.each(taskOwnKeys,function(index,taskOwnKey){if(ZPA_Task.TabPanel.keyPairIdJson.hasOwnProperty(taskOwnKey)){var parentJson=ZPA_Task.TabPanel.keyPairIdJson[taskOwnKey],parentTagJson={id:parentJson.id,value:parentJson.dispVal},taskOwnObj=taskOwnerDtls[taskOwnKey],taskOwnIds=Object.keys(taskOwnObj);$.each(taskOwnIds,function(ind,taskOwnId){var childTagJson={id:taskOwnId,value:taskOwnObj[taskOwnId]};ZPA_TabbedListBox.appendRecipientTag("taskOwner_tabPanel",pageId.find("#taskOwner_Inp"),parentTagJson,childTagJson)})}})}}},TaskStatusCustomization={customize:function(){var pageId=settingsPage.container;pageId.find("div.zpl_rgtcnt").length<=0&&(pageId.append('<div class="zpl_rgtcnt"><div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.taskstatus")+'</h4></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.customtaskstatusdesc")+'</h5></div><div><div class="zpl_gbox"><div id="customStatus"></div></div></div></div></div></div></div>'),TaskStatusCustomization.appendStatus())},appendStatus:function(){var pageId=settingsPage.container,listOptions={contentType:"custom",dropdownList:{contentType:"custom"},template:function(data){return TaskStatusCustomization.getListTemplate(data)},items:TaskStatusCustomization.getList(),width:350,reorderable:!0,dataMapping:{text:"DISPVALUE",value:"ID"}};pageId.find("#customStatus").zlistbox(listOptions),pageId.find("[name=enable_status]").on("click",function(event,data){event.stopPropagation();var includeBtn=$(this),statusDiv=includeBtn.parent().prev("div"),optionId=statusDiv.attr("optionid"),optionName=statusDiv.children().text(),previousStatus=TaskStatusCustomization.getExistingStatus(optionName);if(previousStatus!=optionId)TaskStatusCustomization.deleteStatus(previousStatus,optionId);else{var params={value:optionName,method:"add",status:optionId,conreqcsr:csrfToken};ZPeople.Request.send("/addTaskStatus.zp",params,function(data){"success"==data.result?(statusDiv.attr("optionid",data.optionid),ZPeople.Message.showSuccessMsg(data.message),statusDiv.removeClass("disabled"),$(includeBtn.siblings()[0]).removeClass("DN"),includeBtn.remove()):ZPeople.Message.showFailureMsg(data.message)})}}),pageId.find("#customStatus").on("zsortablechange",function(ev,data){ZPeople.Request.sendAsyncPost("/reorderTaskStatus.zp",{method:"reorder",statusOrderList:TaskStatusCustomization.fetchIdsinOrder("customStatus")},function(data){"success"==data.status&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskstatusrearrnge"))})})},fetchIdsinOrder:function(id){var idList="";return settingsPage.container.find("#"+id).find("li").each(function(i){idList+=$(this).attr("aria-value")+","}),idList=idList.slice(0,-1)},getList:function(){var statusList=TaskStatus.getStatusArray(),newList=statusList,actualList=TaskStatus.getSysStatusList();return $.each(actualList,function(index,row){var sysValue=row.SYSVALUE,isAvailable=!1;$.each(statusList,function(ind,data){data.SYSVALUE==sysValue&&(isAvailable=!0)}),isAvailable||(row.isYetToAdd=!0,newList.push(row))}),newList},getListTemplate:function(data){var isYetToAdd="",actionBtn="";data.isYetToAdd&&(isYetToAdd="disabled",actionBtn=`<button name="enable_status" tabindex="-1" title=${ZPI18N.getString("zp.add")} class="zlistbox__action PI_plus"><i class="zlistbox__icon"></i></button>`);var deleteBtn="";return 0==data.SYSVALUE&&(deleteBtn=`<button name="delete" tabindex="-1" title=${ZPI18N.getString("zp.delete")} onclick="TaskStatusCustomization.deletePopup('${data.ID}')" class="zlistbox__action PI_delete"><i class="zlistbox__icon"></i></button>`),actionBtn=actionBtn+`<button tabindex="-1" onclick="TaskStatusCustomization.showEdit(this,event)" title=${ZPI18N.getString("zp.edit")} class="zlistbox__action PI_edt '+ (actionBtn == '' ? '' : 'DN') +' "><i class="zlistbox__icon"></i></button><button tabindex="-1" title=${ZPI18N.getString("zp.save")} class="zlistbox__action PI_tick DN" onclick="TaskStatusCustomization.saveEdit(this,event)"><i class="zlistbox__icon"></i></button><button tabindex="-1" title=${ZPI18N.getString("zp.cancel")} class="zlistbox__action PI_cls DN" onclick="TaskStatusCustomization.closeEdit(this,event)"><i class="zlistbox__icon"></i></button>`+deleteBtn,'<div class="zlistbox__content '+isYetToAdd+'" optionId="'+data.ID+'" name="status"><span class="zlistbox__text" name="optionVal">'+data.VALUE+'</span><input name="optionVal" autocomplete="off" class="ztextbox DN" value="'+data.VALUE+'"/></div><div class="zlistbox__actions">'+actionBtn+"</div>"},saveEdit:function(obj,ev){ev.stopPropagation(),ev.preventDefault();var parentDiv=$(obj).closest("li"),optionId=parentDiv.find("div[optionid]").attr("optionid"),modifiedVal=parentDiv.find("input[name=optionVal]").val(),valueJson={recordId:optionId,text:modifiedVal.trim()},params={method:"edit"};params.customstatusjson=JSON.stringify(valueJson);var errorMsg=TaskStatusCustomization.validateText(modifiedVal,optionId);""==errorMsg?ZPeople.Request.send("/editTaskStatus.zp",params,function(data){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),parentDiv.find("input[name=optionVal]").addClass("DN"),parentDiv.find("span[name=optionVal]").html(ZSEC.Encoder.encodeForHTML(modifiedVal)).removeClass("DN"),parentDiv.find("button.PI_edt").removeClass("DN"),parentDiv.find("button.PI_tick, button.PI_cls").addClass("DN")}):ZPeople.Message.showFailureMsg(errorMsg)},validateText:function(text,optionId){var data=text.trim(),errorMsg="";if(""==data||data.length>15){if(errorMsg=ZPI18N.getString("zp.statusempty"),data.length>15){errorMsg=ZPI18N.getString("zp.taskstatuslength",new Array("15"))}}else""!=TaskStatusCustomization.getExistingStatus(text,optionId)&&(errorMsg=ZPI18N.getString("zp.statusavailable"));return errorMsg},getExistingStatus:function(text,optionId){var data=text.trim(),previousStatus="",statusList=TaskStatusCustomization.getList();return $.each(statusList,function(i,option){if(option.DISPVALUE==data&&option.ID!=optionId)return previousStatus=option.ID,!1}),previousStatus},showEdit:function(obj,ev){ev.stopPropagation(),ev.preventDefault();var parentDiv=$(obj).closest("li"),existingVal=parentDiv.find("span[name=optionVal]").text();parentDiv.find("span[name=optionVal]").addClass("DN"),parentDiv.find("input[name=optionVal]").val(existingVal),parentDiv.find("input[name=optionVal]").removeClass("DN"),parentDiv.find("button.PI_edt").addClass("DN"),parentDiv.find("button.PI_tick, button.PI_cls").removeClass("DN")},closeEdit:function(obj,ev){ev.stopPropagation(),ev.preventDefault();var parentDiv=$(obj).closest("li");parentDiv.find("input[name=optionVal]").addClass("DN"),parentDiv.find("span[name=optionVal]").removeClass("DN"),parentDiv.find("button.PI_edt").removeClass("DN"),parentDiv.find("button.PI_tick, button.PI_cls").addClass("DN")},deletePopup:function(optionId){var tab=new Tab;tab.id="deleteStatusPopup",tab.cardId="deleteStatus_cards",tab.validate=TaskStatusCustomization.deleteStatus,TaskStatusCustomization.deleteModal=new popupModal(ZPI18N.getString("zp.lms.updatestatus"),tab),TaskStatusCustomization.deleteModal.mediumSize=!0,TaskStatusCustomization.deleteModal.isAppendToBody=!0,TaskStatusCustomization.deleteModal.optionId=optionId,TaskStatusCustomization.deleteModal.construct(),TaskStatusCustomization.deleteModal.setCloseCallback(function(){TaskStatusCustomization.closePopup()}),ZPA_Common.getPopUpId(TaskStatusCustomization.deleteModal).find("#deleteStatus_cards").append(ZPA_Common.Cards.construct("deleteStatus_basic",TaskStatusCustomization.getDeleteHtml())),ZPA_Common.Loader.add("status_cards");var statusProp={options:TaskStatusCustomization.getActiveSystemStatus(),dataMapping:{label:"DISPVALUE",title:"DISPVALUE",value:"SYSVALUE"}};ZPeopleComponents.select("#migstatus",statusProp)},closePopup:function(){ZPeopleComponents.isComponent("#migstatus")&&(ZPeopleComponents.select("#migstatus").destroy(),TaskStatusCustomization.deleteModal.remove()),TaskStatus.statusArray=void 0,ZPeopleComponents.listbox("#customStatus").destroy(),TaskStatusCustomization.appendStatus()},getActiveSystemStatus:function(){var existingList=TaskStatusCustomization.getList(),systemStatusList=[];return $.each(existingList,function(index,row){row.SYSVALUE!=TaskStatus.INPROGRESS_SYSVALUE&&row.SYSVALUE!=TaskStatus.ONHOLD_SYSVALUE&&row.SYSVALUE!=TaskStatus.NA_SYSVALUE||systemStatusList.push(row)}),systemStatusList},deleteStatus:function(oldId,newId){void 0!=newId&&""!=newId||(oldId=TaskStatusCustomization.deleteModal.optionId,newId=ZPeopleComponents.select("#migstatus").getValue());var params={method:"migrate",oldStatus:oldId,newStatus:newId,conreqcsr:csrfToken};ZPeople.Request.send("/migrateTaskStatus.zp",params,function(data){ZPeople.Message.success(ZPI18N.getString("zp.lms.messages.statusUpdatedSuccess")),TaskStatusCustomization.closePopup()})},getDeleteHtml:function(){return`<div class="zpl_secn"><div><label class="zpl_mtry">${ZPI18N.getString("zp.taskupdatedto")}</label></div><div><select type="text" id="migstatus" class="ztextbox" value=""></select></div>\n\t\t\t\t\t<div  class="zpl_info">${ZPI18N.getString("zp.taskupdatedtodesc")}</div></div>`}},(ZPA_FieldUpdate={1:[EMPTY_VALUE_FIELD,FormConstants.FieldType.TEXT,FormConstants.FieldType.EMAIL_ADDRESS,FormConstants.FieldType.NUMBER,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.DATE,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.PHONE_NUMBER,FormConstants.FieldType.PICKLIST,FormConstants.FieldType.SCRIPT],4:[EMPTY_VALUE_FIELD,FormConstants.FieldType.EMAIL_ADDRESS],5:[EMPTY_VALUE_FIELD,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.NUMBER,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.SCRIPT],25:[EMPTY_VALUE_FIELD,FormConstants.FieldType.TEXT,FormConstants.FieldType.NUMBER,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.PICKLIST,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.PHONE_NUMBER],10:[EMPTY_VALUE_FIELD,FormConstants.FieldType.DATE,FormConstants.FieldType.SCRIPT],22:[EMPTY_VALUE_FIELD,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.SCRIPT],9:[EMPTY_VALUE_FIELD,FormConstants.FieldType.CHECK_BOX],3:[EMPTY_VALUE_FIELD,FormConstants.FieldType.TEXT,FormConstants.FieldType.TEXT_AREA,FormConstants.FieldType.NUMBER,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.PICKLIST,FormConstants.FieldType.DATE,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.PHONE_NUMBER,FormConstants.FieldType.SCRIPT],19:[EMPTY_VALUE_FIELD,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.NUMBER,FormConstants.FieldType.SCRIPT],8:[EMPTY_VALUE_FIELD,FormConstants.FieldType.PHONE_NUMBER],6:[EMPTY_VALUE_FIELD,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.NUMBER,FormConstants.FieldType.SCRIPT],18:[FormConstants.FieldType.FILE_UPLOAD],50:[EMPTY_VALUE_FIELD,HOURS_IN_SECONDS],51:[EMPTY_VALUE_FIELD,HOURS_IN_MINUTES],ALLOWED_FIELDS:[FormConstants.FieldType.TEXT,FormConstants.FieldType.CHECK_BOX,FormConstants.FieldType.TEXT_AREA,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.EMAIL_ADDRESS,FormConstants.FieldType.NUMBER,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.DATE,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.PHONE_NUMBER,FormConstants.FieldType.PICKLIST,FormConstants.FieldType.FILE_UPLOAD],IS_LOADED:!1,fieldUpdateId:"",FORMFIELDS_JSON:{},FC_ITEMJSON:{},initPage:function(formId){ZPA_FieldUpdate.IS_LOADED||(formId=ZPA_Common.isNotNull(formId)?formId:ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue(),ZPA_FieldUpdate.constructFVUListing(formId))},constructFVUListing:function(formId){var pageId=ZPA_Common.getParentPageId();ZPA_FieldUpdate.resetFVUListing();var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+'</th><th width="100"></th></tr></thead><tbody>',serviceName=ZPA_Common.getServiceName();formId=void 0!=formId&&""!=formId?formId:0,ZPA_Common.Loader.appendPageLoading(pageId);var params={formId:formId,method:"fetchFieldUpdateList",conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),$.post("/getFieldUpdateList.zp",params,function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.FIELDUPDATE))return ZPA_Common.Loader.removePageLoading(pageId),!1;if(ZPA_FieldUpdate.IS_LOADED=!0,data.length>0)pageId.find("#add_fieldupdate").removeClass("DN"),$.each(data,function(index,row){body+='<tr fvuId="'+row.FIELD_VALUE_UPDATE_ID+'" onclick="ZPA_FieldUpdate.editSlide(\''+row.FIELD_VALUE_UPDATE_ID+"', '"+row.FORMID+"')\"><td>"+decodeHTML(row.DISPLAYNAME)+"</td><td><span>"+row.DISPLAY_NAME+'</span></td><td><div class="zpl_hvr"><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" fvuId="'+this.FIELD_VALUE_UPDATE_ID+'" onclick="ZPA_Common.deleteConfirmationPopup(this,  \''+ZP_Automation_Mode.FIELDUPDATE+"',  ZPA_FieldUpdate.deleteFieldUpdate)\"></i></div></td></tr>"}),body+="</tbody></table></div>",pageId.find(".zpl_rgtcnt").append(body);else{pageId.find("#add_fieldupdate").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.FIELDUPDATE),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.FIELDUPDATE),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.FIELDUPDATE),pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.fieldupdate.add"),ZPA_FieldUpdate.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)})},constructSlider:function(header,isFromChklist){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.FIELDUPDATE),tab.cardId="fu_cards",tab.validate=ZPA_FieldUpdate.saveFieldUpdate,ZPA_FieldUpdate.mailModal=new sliderModal(header,tab),ZPA_FieldUpdate.mailModal.mediumSize=!0,ZPA_FieldUpdate.mailModal.construct(),ZPA_Common.CloseAlert.construct(ZPA_FieldUpdate.mailModal),ZPA_FieldUpdate.mailModal.setCloseCallback(function(){ZPA_FieldUpdate.removeSlider(ZPA_FieldUpdate.mailModal)});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);pageId.data("modalInstance",ZPA_FieldUpdate.mailModal);var $fu_cards=pageId.find("#"+tab.cardId);ZPA_Common.setRelativeContainer($fu_cards),$fu_cards.append(ZPA_FieldUpdate.getContainerBody("fu_basic")),$fu_cards.append(ZPA_FieldUpdate.getContainerBody("fu_config")),ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.FIELDUPDATE)),ZPA_Common.setBasePage(pageId,isFromChklist)},removeSlider:function(fu_Modal){ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);if(ZPA_Common.getPageMode()==ZP_Automation_Mode.FIELDUPDATE){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/fieldupdate-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/fieldupdate"}fu_Modal.remove()},loadDefault:function(isEdit,formId){ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.getFormList(ZP_Automation_Mode.FIELDUPDATE,ZPA_Common.getServiceName());let fu_formListProp={change:ZPA_FieldUpdate.resetFieldUpdateConfig,options:ZPA_Common[ZPA_Common.getFormListMode(ZP_Automation_Mode.FIELDUPDATE,ZPA_Common.getServiceName())],dataMapping:{label:"dispName",value:"formId",title:"dispName"}};ZPA_Common.isNotNull(formId)&&"0"!=formId&&(fu_formListProp.selectedValue=formId,(isEdit||ZPA_Common.getPageMode()!=ZP_Automation_Mode.FIELDUPDATE)&&(fu_formListProp.disabled=!0)),ZPA_Common.ZCompProp.loadSelectListProp(fu_formListProp),ZPeopleComponents.select("#fieldupdate_formList",fu_formListProp),ZPA_FieldUpdate.resetFieldUpdateConfig()},addSlide:function(){if(ZPA_Common.validateAddConfig()){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/fieldupdate/add-formid:"+formId}},add:function(formId,isFromChklist){ZPA_FieldUpdate.constructSlider(ZPI18N.getString("zp.fieldupdate.add"),isFromChklist),formId=ZPA_Common.getPageMode()==ZP_Automation_Mode.FIELDUPDATE?ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue():formId,ZPA_FieldUpdate.loadDefault(!1,formId),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.FIELDUPDATE),500)},editSlide:function(fvuId,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/fieldupdate/edit-formid:"+formId+"/fieldupdateid:"+fvuId},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_FieldUpdate.editFieldUpdate(editParams.fieldupdateid,editParams.formid)},editFieldUpdate:function(fuId,formId,isFromChklist){ZPA_FieldUpdate.constructSlider(ZPI18N.getString("zp.fieldupdate.edit"),isFromChklist),ZPA_FieldUpdate.loadDefault(!0,formId);var params={formId:formId,fuId:fuId,method:"getFieldUpdateRow",conreqcsr:csrfToken};$.ajax({url:"/getFieldUpdateRow.zp",type:"POST",data:params,success:function(data){ZPA_FieldUpdate.insertData(data),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.FIELDUPDATE),500)}})},deleteFieldUpdate:function(thisObj){var delIcObj=thisObj.delIcObj,fvuId=$(delIcObj).attr("fvuId"),params={fuId:fvuId,method:"deleteFieldUpdateRow",conreqcsr:csrfToken};$.ajax({url:"/deleteFieldUpdateRow.zp",type:"POST",data:params,success:function(data){if("success"===data.result){ZPA_FieldUpdate.IS_LOADED=!1;var actBody=ZPA_Common.getParentPageId().find("[name=action_body]");actBody.find("[fvuId="+fvuId+"]").remove(),ZPeople.Message.success(ZPI18N.getString("zp.deletefieldupdate")),0==actBody.find("tr[fvuId]").length&&ZPA_FieldUpdate.initPage()}else void 0!==data.wfmapping&&ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.FIELDUPDATE,data.wfmapping)}})},resetFVUListing:function(){ZPA_Common.getParentPageId(ZP_Automation_Mode.FIELDUPDATE).find(".zpl_rgtcnt").empty()},resetFieldUpdateConfig:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.FIELDUPDATE,!1),ZPA_FieldUpdate.fieldUpdateId="",pageId.find("#fvuName").val(""),pageId.find("#fvuDescription").val("");var fvu_paramName=pageId.find("#fvu_paramName"),fvu_paramValue=pageId.find("#fvu_paramValue");if(ZPA_FieldUpdate.clearSelectObj(fvu_paramName),ZPA_FieldUpdate.clearSelectObj(fvu_paramValue),ZPeopleComponents.isComponent("#paramName_tabpanel")&&ZPeopleComponents.tabbedlistboxpopup("#paramName_tabpanel").destroy(),ZPeopleComponents.isComponent("#formFieldTab")&&ZPeopleComponents.tabbedlistboxpopup("#formFieldTab").destroy(),ZPA_FieldUpdate.FORMFIELDS_JSON={},$.isEmptyObject(ZPA_FieldUpdate.FORMFIELDS_JSON)){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.getFormFields(ZP_Automation_Mode.FIELDUPDATE,formId,!1)}if("block"===pageId.find("[name=fvu_selectValueDiv]").css("display")){var anchorObj=pageId.find("#fvuAnchor");ZPA_FieldUpdate.changeFields(anchorObj)}ZPA_FieldUpdate.insertDftField(FormConstants.FieldType.TEXT,"")},getContainerBody:function(cardId){var body="";if("fu_basic"==cardId){body='<div class="zpl_crd" id="'+cardId+'"><div class="zpl_crdcnt">';body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+"</label></div>",body+='<div><select id="fieldupdate_formList"></select></div></div>',body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.fieldupdate.name")+"</label></div>",body+='<div><input type="text" class="ztextbox" id = "fvuName" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.FIELDUPDATE+"')\"></div></div>",body+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.description")+"</label></div>",body+='<div><textarea type="text" class="ztextbox" rows="3" id="fvuDescription" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.FIELDUPDATE+"')\"></textarea></div></div>",body+="</div></div>"}else"fu_config"==cardId&&(body+='<div class="zpl_crd" id="'+cardId+'">',body+='<div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.fieldupdateselect")+"</h4><p>"+ZPI18N.getString("zp.fieldupdate.slidemessage")+"</p></div></div>",body+='<div class="zpl_crdcnt"><div id="noteSection" class="zpl_secn"><div><div class="zpl_info"><ul><li>'+ZPI18N.getString("zp.fldupdleft")+"</li><li>"+ZPI18N.getString("zp.fldupdright")+"</li></ul></div></div></div>",body+='<div class="zpl_secn"><div class="zpl_cndor"><div class="zpl_gbox"><div class="zpl_idiv"><div><input  onclick="ZPA_FieldUpdate.TabPanel.openTabPanel(\'paramName_tabpanel\', \'fvu_paramName\')" type="text" id="fvu_paramName" class="ztextbox"  readonly placeholder="'+ZPI18N.getString("zp.choosefield")+'" /><div id="paramName_tabpanel"></div></div><span>=</span>',body+='<div><div name="fvu_selectValueDiv" style="display:none"><div id="formFieldTab"></div><input onclick="ZPA_FieldUpdate.TabPanel.openTabPanel(\'formFieldTab\', \'fvu_paramValue\')" type="text" id="fvu_paramValue"  class="ztextbox" readonly placeholder="'+ZPI18N.getString("zp.choosefield")+'" /></div><div id="fvu_defalutValDiv"><input type="text"  class="ztextbox" value=""  onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.FIELDUPDATE+"')\"/></div></div>",body+='<span><a id="fvuAnchor" onclick="ZPA_FieldUpdate.changeFields(this)">'+ZPI18N.getString("zp.selectfield")+"</a></span></div></div></div></div></div>");return body},fieldValidation:function(content,fieldType,fcVal,tableName,isToNeglectSysFields){var fieldMatchingList=ZPA_FieldUpdate[fieldType];void 0!=isToNeglectSysFields&&isToNeglectSysFields&&(fieldMatchingList=fieldMatchingList.slice(1,fieldMatchingList.length));var groupNameFieldContent=content.find("#lftFormList"),groupNameField=groupNameFieldContent.find("li"),fields=content.find("#rghtFormList").find("[name=list-group-item]");return $(fields).removeClass("zpl_act"),$(fields).hide(),$(groupNameField).hide(),$(fields).each(function(){var fieldObjAttr=JSON.parse($(this).find("[name=mOpt]").data("fldDtls").fldDtl),fcType=parseInt(fieldObjAttr.colType),fieldfcVal=fieldObjAttr.label;if(!isNaN(fcType)&&-1!=$.inArray(fcType,fieldMatchingList)&&fieldfcVal!==fcVal){$(this).show();var parentId=$(this).parents("[name=fieldsParentDiv]").attr("id");groupNameFieldContent.find("[formkey="+parentId+"]").show()}}),content},getInputBoxVal:function(inputObj){if(void 0!==$(inputObj).attr("selecteddata")&&""!==$(inputObj).attr("selecteddata")){var selectedDataObj=JSON.parse($(inputObj).attr("selecteddata"));return selectedDataObj.data=!0,selectedDataObj}return{data:!1}},loadFCItemJson:function(){if(!$.isEmptyObject(ZPA_FieldUpdate.FORMFIELDS_JSON)){var formDtlAry=ZPA_FieldUpdate.FORMFIELDS_JSON.formNameJArray,formCompDtlAry=ZPA_FieldUpdate.FORMFIELDS_JSON.componentJObj;$.each(formDtlAry,function(index,formDtl){$.each(formDtl,function(formKey,formObj){var lookupDisplayName=formObj.lookupDisplayName,componentJAry=formCompDtlAry[formKey];$.each(componentJAry,function(index,secObj){var secNames=Object.keys(secObj);$.each(secNames,function(index,secName){var fcInSecAry=secObj[secName];$.each(fcInSecAry,function(index,fcObj){var itemObj={},pFormId=formKey.split("_")[0];fcObj.parentFormId=pFormId,itemObj.fcJson=fcObj,itemObj.lookupDisplayName=lookupDisplayName,itemObj.formKey=formKey;fcObj.fcId;var labelname=ZPA_Common.replaceLabelName(fcObj.label);ZPA_FieldUpdate.FC_ITEMJSON[labelname]=itemObj})})})})})}},insertData:function(data){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_FieldUpdate.fieldUpdateId=data.FIELD_VALUE_UPDATE_ID,pageId.find("#fvuName").val(ZPeople.decodeTxt(data.DISPLAYNAME)),pageId.find("#fvuDescription").val(ZPeople.decodeTxt(data.DESCRIPTION));var anchorObj=pageId.find("#fvuAnchor");pageId.find("#fvu_paramName"),pageId.find("#fvu_paramValue");ZPA_FieldUpdate.FORMFIELDS_JSON=data.formComponents,ZPA_FieldUpdate.loadFCItemJson();var selParam_ItemObj=ZPA_FieldUpdate.FC_ITEMJSON[ZPA_Common.replaceLabelName(data.updateFieldLabelName)];pageId.find("#fvu_paramName").val(ZPA_Common.fieldNameFormat(selParam_ItemObj.fcJson.displayName,selParam_ItemObj.lookupDisplayName)),pageId.find("#fvu_paramName").attr("selecteddata",JSON.stringify(selParam_ItemObj.fcJson));var wfType=selParam_ItemObj.fcJson.workFlowFcType;if(!0===data.ISLOOKUP){var selVal_ItemObj=ZPA_FieldUpdate.FC_ITEMJSON[ZPA_Common.replaceLabelName(data.selectedFieldLabelName)];pageId.find("#fvu_paramValue").val(ZPA_Common.fieldNameFormat(selVal_ItemObj.fcJson.displayName,selVal_ItemObj.lookupDisplayName)),pageId.find("#fvu_paramValue").attr("selecteddata",JSON.stringify(selVal_ItemObj.fcJson)),pageId.find("[name=fvu_selectValueDiv]").show(),pageId.find("#fvu_defalutValDiv").hide(),anchorObj.text(ZPI18N.getString("zp.fieldupdate.specifyfield")),ZPA_FieldUpdate.insertDftField(wfType)}else ZPA_FieldUpdate.changeFields(anchorObj),pageId.find("[name=fvu_selectValueDiv]").hide(),pageId.find("#fvu_defalutValDiv").show(),ZPA_FieldUpdate.insertDftField(wfType,data.VALUE,data.VALUEREMOVEDOLLAR),anchorObj.text(ZPI18N.getString("zp.selectfield"))},clearSelectObj:function(obj){$(obj).val(""),$(obj).removeAttr("selecteddata")},appendDivBasedOnType:function(fcType,parentDiv){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),divEle="";switch(fcType){case FormConstants.FieldType.CHECK_BOX:divEle='<div class="zcheckbox "><input id="fvuChkbox" type="checkbox"  class="zcheckbox__helper" ><label for="fvuChkbox" class="zcheckbox__label"></label></div>',parentDiv.html($(divEle));break;case FormConstants.FieldType.DATE:divEle='<input id="fvuDateField" data-format="'+dateFmt+'" data-placeholder-type="date-format" data-calendar-icon="true" data-clear-button="focus" data-calendar-icon-ui-type="button" data-spin-buttons="none" data-locale="en-US" data-calendar-icon-ui-type="button" data-picker="true">',parentDiv.html($(divEle)),ZPeopleComponents.datefield("#fvuDateField",{pickerOptions:{appendTo:"#"+ZPA_Common.getPageIdValue(ZP_Automation_Mode.FIELDUPDATE)}});break;case FormConstants.FieldType.DATE_TIME:divEle='<input id="fvuDateTimeFld" data-format="'+ZPA_Util.getUIDateTimeFormat()+'" data-picker="true" data-spin-buttons="none" data-calendar-icon-ui-type="button" data-calendar-icon="true">',parentDiv.html($(divEle)),ZPeopleComponents.datetimefield("#fvuDateTimeFld");break;case FormConstants.FieldType.FILE_UPLOAD:divEle='<div class="ztextbox--group zh-alignright zpl_inpticfild"><input id="fvu_recTempSel"   readonly type="text" class="ztextbox"><i id="triRecTemp" class="ztextbox__icon PI_addlist" "></i><div id="fvu_recTempDDList"></div></div>',parentDiv.html($(divEle)),ZPA_Util.getRecordTemplate(ZP_Automation_Mode.FIELDUPDATE,ZPA_Util.constructRecTempList);var dropDown=pageId.find("#fvu_recTempDDList");pageId.find("#triRecTemp").off().on("click",function(){dropDown.is(":visible")?ZPeopleComponents.dropdownlist(dropDown).close():(ZPeopleComponents.dropdownlist(dropDown).setAttribute("position","right"),ZPeopleComponents.dropdownlist(dropDown).open({forElement:"#triRecTemp"}))});break;case FormConstants.FieldType.PICKLIST:divEle='<div class="ztextbox--group zh-alignright zpl_inpticfild"><input id="fvu_pickListInp"   readonly type="text" class="ztextbox"><i id="triPickList" class="ztextbox__icon PI_addlist" "></i><div id="fvu_PickList"></div></div>',parentDiv.html($(divEle)),ZPA_Util.getLookupFieldDts(pageId.find("#triPickList"),ZPA_Util.constLkupFieldDtls);var dropDownList=pageId.find("#fvu_PickList");pageId.find("#triPickList").off().on("click",function(){dropDownList.is(":visible")?ZPeopleComponents.dropdownlist(dropDownList).close():(ZPeopleComponents.dropdownlist(dropDownList).setAttribute("position","right"),ZPeopleComponents.dropdownlist(dropDownList).open({forElement:"#triPickList"}))});break;case HOURS_IN_SECONDS:divEle='<input id="fvu_timeFldInSec" data-format="hh:mm" data-clear-button="focus" data-spin-buttons="always"></input>',parentDiv.html($(divEle)),ZPeopleComponents.timefield("#fvu_timeFldInSec");break;case HOURS_IN_MINUTES:divEle='<input id="fvu_timeFld" data-format="hh:mm" data-clear-button="focus" data-spin-buttons="always"></input>',parentDiv.html($(divEle)),ZPeopleComponents.timefield("#fvu_timeFld");break;default:divEle='<input id="inpBx" type="text" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.FIELDUPDATE+"')\"></input>",parentDiv.html($(divEle))}},appendSelectedValue:function(inpDiv,selectedValue,selectedValueId){ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);inpDiv.val(selectedValue),inpDiv.data("selectedValue",selectedValueId)},insertDftField:function(wfFcType,value,dispValue){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),fcType=(FormConstants.FieldType.TEXT,FormConstants.FieldType.TEXT_AREA,FormConstants.FieldType.EMAIL_ADDRESS,FormConstants.FieldType.NUMBER,FormConstants.FieldType.DECIMAL,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.PHONE_NUMBER,TIME,parseInt(wfFcType));if(ZPA_FieldUpdate.appendDivBasedOnType(fcType,pageId.find("#fvu_defalutValDiv")),pageId.find("#fvuAng").show(),value&&value.indexOf("${")<0){var inputBox=pageId.find("#fvu_defalutValDiv").find("input");switch(fcType){case FormConstants.FieldType.CHECK_BOX:"true"===value&&inputBox.attr("checked","checked");break;case FormConstants.FieldType.PICKLIST:ZPA_FieldUpdate.appendSelectedValue(pageId.find("#fvu_pickListInp"),dispValue,value);break;case FormConstants.FieldType.FILE_UPLOAD:ZPA_FieldUpdate.appendSelectedValue(pageId.find("#fvu_recTempSel"),dispValue,value);break;case HOURS_IN_SECONDS:var hours=Attendance.disHours(value/60);ZPeopleComponents.timefield($("#fvu_timeFldInSec")).setValue(hours);break;case HOURS_IN_MINUTES:hours=Attendance.disHours(value);ZPeopleComponents.timefield($("#fvu_timeFld")).setValue(hours);break;case FormConstants.FieldType.DATE:ZPeopleComponents.datefield(pageId.find("#fvuDateField")).setValue(value);break;case FormConstants.FieldType.DATE_TIME:ZPeopleComponents.datetimefield(pageId.find("#fvuDateTimeFld")).setValue(value);break;default:inputBox.val(value)}}},changeFields:function(obj){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);pageId.find("[name=fvu_selectValueDiv]").toggle(),pageId.find("#fvu_defalutValDiv").toggle();var changeLinkName="block"===pageId.find("#fvu_defalutValDiv").css("display")?ZPI18N.getString("zp.selectfield"):ZPI18N.getString("zp.fieldupdate.specifyfield");$(obj).text(changeLinkName)},fvuValidation:function(fcType,getParams){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.removeErrorDiv(pageId);var isError=!1;if(getParams.fvuName.trim()||(isError=!0,ZPA_Common.appendErrorDiv(pageId.find("#fvuName"),ZPI18N.getString("zp.emptyfvuname"))),getParams.fcId||(isError=!0,ZPA_Common.appendErrorDiv(pageId.find("#fvu_paramName"),ZPI18N.getString("zp.fieldupdate.fieldemptyerror"))),pageId.find("#fvu_defalutValDiv").is(":visible")){var valueErrorDiv=pageId.find("#fvu_defalutValDiv input:first");if(fcType!==FormConstants.FieldType.CHECK_BOX&&!getParams.fcVal){switch(isError=!0,fcType){case FormConstants.FieldType.DATE_TIME:if(ZPeopleComponents.isComponent(pageId.find("#fvuDateTimeFld"))){let dateFldComp=ZPeopleComponents.datetimefield(pageId.find("#fvuDateTimeFld"));ZPA_Common.appendErrorDiv(dateFldComp.container,ZPI18N.getString("zp.fieldupdate.emptyerror"))}break;case FormConstants.FieldType.DATE:if(ZPeopleComponents.isComponent(pageId.find("#fvuDateField"))){let dateFldComp=ZPeopleComponents.datefield(pageId.find("#fvuDateField"));ZPA_Common.appendErrorDiv(dateFldComp.container,ZPI18N.getString("zp.fieldupdate.emptyerror"))}break;case HOURS_IN_MINUTES:if(ZPeopleComponents.isComponent(pageId.find("#fvu_timeFld"))){let fvuTimeComp=ZPeopleComponents.timefield(pageId.find("#fvu_timeFld"));ZPA_Common.appendErrorDiv(fvuTimeComp.container,ZPI18N.getString("zp.fieldupdate.emptyerror"))}break;case FormConstants.FieldType.PICKLIST:case FormConstants.FieldType.FILE_UPLOAD:ZPA_Common.appendErrorDiv(valueErrorDiv.parent(),ZPI18N.getString("zp.fieldupdate.emptyerror"));break;default:ZPA_Common.appendErrorDiv(valueErrorDiv,ZPI18N.getString("zp.fieldupdate.emptyerror"))}return isError}switch(fcType){case FormConstants.FieldType.EMAIL_ADDRESS:ZPUtil.Validation.isEmail(getParams.fcVal)||(isError=!0,ZPA_Common.appendErrorDiv(valueErrorDiv,ZPI18N.getString("zp.copycustomization.enteravalidemailaddress")));break;case FormConstants.FieldType.DATE_TIME:getParams.fcVal=Calendar.convertHourFormat(getParams.fcVal);break;case FormConstants.FieldType.NUMBER:ZPA_Common.isValidNumber(getParams.fcVal)||(isError=!0,ZPA_Common.appendErrorDiv(valueErrorDiv,ZPI18N.getString("zp.enteravalidnumber")));break;case FormConstants.FieldType.CURRENCY:case FormConstants.FieldType.DECIMAL:if(!ZPA_Common.checkForNumberId(getParams.fcVal)){isError=!0;var errorMsg=fcType===FormConstants.FieldType.CURRENCY?ZPI18N.getString("zp.validcurrency"):ZPI18N.getString("zp.entervaliddecimalerr");ZPA_Common.appendErrorDiv(valueErrorDiv,errorMsg)}}}else pageId.find("[name=fvu_selectValueDiv]").is(":visible")&&(getParams.vFcId||(isError=!0,ZPA_Common.appendErrorDiv(pageId.find("[name=fvu_selectValueDiv] input"),ZPI18N.getString("zp.fieldupdate.fieldemptyerror"))));return isError},saveFieldUpdate:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);ZPA_Common.disableSaveBtn(pageId);var formId=ZPA_Common.getFormId(ZP_Automation_Mode.FIELDUPDATE),name=pageId.find("#fvuName").val(),desc=pageId.find("#fvuDescription").val(),selectedFCObj=ZPA_FieldUpdate.getInputBoxVal(pageId.find("#fvu_paramName")),fcFctype=!0===selectedFCObj.data?Number(selectedFCObj.workFlowFcType):"",params={fvuName:name,formId:formId.toString(),fvuDesc:desc,method:"saveFieldUpdate",conreqcsr:csrfToken};if(params.fuId=void 0!=ZPA_FieldUpdate.fieldUpdateId&&""!=ZPA_FieldUpdate.fieldUpdateId?ZPA_FieldUpdate.fieldUpdateId:"",void 0!==selectedFCObj.lookupFcId&&(params.lkupFcId=selectedFCObj.lookupFcId.toString()),void 0!==selectedFCObj.fcId&&(params.fcId=selectedFCObj.fcId.toString()),void 0!==selectedFCObj.parentFormId&&(params.pFormId=selectedFCObj.parentFormId.toString()),pageId.find("[name=fvu_selectValueDiv]").is(":visible")){var valueFormCompObj=ZPA_FieldUpdate.getInputBoxVal(pageId.find("#fvu_paramValue"));void 0!==valueFormCompObj.fcId&&(params.vFcId=valueFormCompObj.fcId.toString()),params.fcVal="${"+ZPA_Common.replaceOriginalLabelName(valueFormCompObj.label)+"}"}else if(pageId.find("#fvu_defalutValDiv").is(":visible")){var valInpBx=pageId.find("#fvu_defalutValDiv").find("input");switch(fcFctype){case FormConstants.FieldType.CHECK_BOX:fcVal=valInpBx.prop("checked");break;case FormConstants.FieldType.PICKLIST:fcVal=pageId.find("#fvu_pickListInp").data("selectedValue");break;case FormConstants.FieldType.FILE_UPLOAD:fcVal=pageId.find("#fvu_recTempSel").data("selectedValue");break;case FormConstants.FieldType.DATE:fcVal=ZPeopleComponents.datefield(pageId.find("#fvuDateField")).getValue().dateString;break;case FormConstants.FieldType.DATE_TIME:fcVal=ZPeopleComponents.datetimefield(pageId.find("#fvuDateTimeFld")).getValue().dateString;break;case HOURS_IN_MINUTES:var timeVal=ZPeopleComponents.timefield(pageId.find("#fvu_timeFld")).getValue().dateString;if(ZPA_Common.isNotNull(timeVal)){var etime_hr=parseInt(timeVal.slice(0,2),10);fcVal=60*etime_hr+parseInt(timeVal.slice(3,5),10)}else fcVal=void 0;break;case HOURS_IN_SECONDS:timeVal=ZPeopleComponents.timefield(pageId.find("#fvu_timeFldInSec")).getValue().dateString,etime_hr=parseInt(timeVal.slice(0,2),10);fcVal=60*etime_hr+parseInt(timeVal.slice(3,5),10),fcVal*=60;break;default:fcVal=valInpBx.val()}params.fcVal=fcVal}ZPA_FieldUpdate.fvuValidation(fcFctype,params)?ZPA_Common.enableSaveBtn(pageId):$.ajax({url:"/createFieldupdate.zp",type:"POST",data:params,success:function(data){if(ZPA_Common.enableSaveBtn(pageId),!0!==data.isError){params.fieldupdateId=data.fuId,params.fvuName=data.fvuName;var pageMode=ZPA_Common.getPageMode();ZPA_Common.isFromChecklistPage(pageId)&&(pageMode=ZP_Automation_Mode.CHECKLIST),pageMode==ZP_Automation_Mode.WORKFLOW||pageMode==ZP_Automation_Mode.CUSTOMACTION?ZPA_Actions.callBackActions(ZP_Automation_Mode.FIELDUPDATE,params):pageMode==ZP_Automation_Mode.BLUEPRINT?ZPA_Blueprint.Builder.callBackActions(ZP_Automation_Mode.FIELDUPDATE,params):pageMode==ZP_Automation_Mode.CHECKLIST?ZPA_Checklist.Slider.callBackonSaveActions(ZP_Automation_Mode.FIELDUPDATE,params):ZPA_FieldUpdate.afterSaveCB(formId),ZPA_FieldUpdate.removeSlider(ZPA_FieldUpdate.mailModal),ZPA_Common.isNotNull(params.fuId)?ZPeople.Message.success(ZPI18N.getString("zp.fldupdupd")):ZPeople.Message.success(ZPI18N.getString("zp.fldupdadd"))}else ZPeople.Message.failure(data.message),ZPA_Common.enableSaveBtn(pageId)},error:function(data){ZPA_Common.enableSaveBtn(pageId);var response=data.responseJSON;void 0!=response&&"MORE_THAN_MAX_LENGTH"==response.code?"fvuName"==response.paramName?ZPA_Common.appendErrorDiv(pageId.find("#fvuName"),ZPI18N.getString("zp.fvunameexc")):"fvuDesc"==response.paramName?ZPA_Common.appendErrorDiv(pageId.find("#fvuDescription"),ZPI18N.getString("zp.maxdesclimit",[300])):ZPeople.Message.failure(response.error):ZPA_Common.isNotNull(response.error)&&ZPeople.Message.failure(response.error)}})},afterSaveCB:function(formId){(ZPA_FieldUpdate.IS_LOADED=!1,ZPeopleComponents.isComponent("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)))&&(formId!=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).getValue()&&ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.FIELDUPDATE)).setValue(formId))}}).TabPanel={loadFormFieldTabPanel:function(data,tabPanelProps){var tabs=[],formDtlAry=data.formNameJArray,formCompDtlAry=data.componentJObj,mandatoryFields=data.mandatoryFields,pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),selectedFCObj=ZPA_FieldUpdate.getInputBoxVal(pageId.find("#fvu_paramName")),selFCType=selectedFCObj.workFlowFcType,fcVal=selectedFCObj.label,fcId=selectedFCObj.fcId,fieldDisplayType=selectedFCObj.displayType,fieldMatchingList=ZPA_FieldUpdate[selFCType];if("fvu_paramValue"==tabPanelProps.targetId){var isToNeglectSystemFields=-1!=mandatoryFields.toString().indexOf(fcId)||101==fieldDisplayType;void 0!=isToNeglectSystemFields&&isToNeglectSystemFields&&(fieldMatchingList=fieldMatchingList.slice(1,fieldMatchingList.length))}$.each(formDtlAry,function(index,formDtl){let tabObj={};$.each(formDtl,function(formKey,formObj){if("fvu_paramName"==tabPanelProps.targetId&&"systemFields"==formKey)return;tabObj.label=formObj.lookupFullName,tabObj.lookupLabelName=ZPA_Common.isNotNull(formObj.lookupLabelName)?formObj.lookupLabelName:formObj.lookupFullName,tabObj.panelId=formKey+"_panel",tabObj.id=formKey;let compItems=[];var componentJAry=formCompDtlAry[formKey];$.each(componentJAry,function(index,secObj){var secNames=Object.keys(secObj);$.each(secNames,function(index,secName){var fcInSecAry=secObj[secName];$.each(fcInSecAry,function(index,fcObj){if(fcObj.sectionName=secName,"fvu_paramValue"==tabPanelProps.targetId&&void 0!=selectedFCObj&&1==selectedFCObj.data){var valColType=fcObj.colType,fieldFCVal=fcObj.label;isNaN(valColType)||-1==$.inArray(valColType,fieldMatchingList)||fieldFCVal===fcVal||(fcObj.label=ZPA_Common.replaceLabelName(fcObj.label),compItems.push(fcObj))}else{if(ZPA_FieldUpdate.ALLOWED_FIELDS.indexOf(fcObj.colType)<0)return!0;fcObj.label=ZPA_Common.replaceLabelName(fcObj.label),compItems.push(fcObj)}})})}),$.isEmptyObject(compItems)?tabObj={}:tabObj.items=compItems}),$.isEmptyObject(tabObj)||tabs.push(tabObj)}),tabPanelProps.tabs=tabs,tabPanelProps.forElement="#"+tabPanelProps.forEleId,tabPanelProps.listboxOptions={dataMapping:{id:"fcId",value:"label",text:"displayName",groupLabel:"sectionName"},showSearchField:!0,search:{by:"displayName",criteria:"contains"},searchFieldOptions:{placeholder:ZPI18N.getString("zp.search")},multiple:!1,messages:{noResults:ZPI18N.getString("zp.noresults")},isTextHTMLEncoded:!1},ZPeopleComponents.isComponent("#"+tabPanelProps.id)&&ZPeopleComponents.tabbedlistboxpopup("#"+tabPanelProps.id).destroy(),ZPeopleComponents.tabbedlistboxpopup("#"+tabPanelProps.id,tabPanelProps)},openTabPanel:function(id,forEleId){ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE);var formId=ZPA_Common.getFormId(ZP_Automation_Mode.FIELDUPDATE);ZPeopleComponents.isComponent("#"+id)?$("#"+id).text().trim().length>0?(ZPeopleComponents.tabbedlistboxpopup("#"+id).open(),ZPA_FieldUpdate.TabPanel.selectTabbedItem(id,forEleId)):"paramName_tabpanel"===id?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.fldupsourceflderrmsg")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.flduptargetflderrmsg")):($.isEmptyObject(ZPA_FieldUpdate.FORMFIELDS_JSON)&&ZPA_Common.getFormFields(ZP_Automation_Mode.FIELDUPDATE,formId,!1),ZPA_FieldUpdate.TabPanel.loadFormFieldTab(id,forEleId),$("#"+id).text().trim().length>0?(ZPeopleComponents.tabbedlistboxpopup("#"+id).open(),ZPA_FieldUpdate.TabPanel.selectTabbedItem(id,forEleId)):"paramName_tabpanel"===id?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.fldupsourceflderrmsg")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.flduptargetflderrmsg")))},loadFormFieldTab:function(id,forEleId){var tabPanelProps={id:id,forEleId:forEleId,appendTo:"#fu_cards",select:ZPA_FieldUpdate.TabPanel.selectFieldCB,targetId:forEleId};ZPA_FieldUpdate.TabPanel.loadFormFieldTabPanel(ZPA_FieldUpdate.FORMFIELDS_JSON,tabPanelProps)},selectFieldCB:function(event,eventObj){if(event.detail.fromUI){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE),forEleId=eventObj.forEleId,itemData=event.detail.itemData,tabData=event.detail.options.tabData,pFormId=tabData.id.split("_")[0];itemData.parentFormId=pFormId,itemData.fcVal=itemData.val;var wfFCType=itemData.workFlowFcType,targetId=eventObj.targetId;pageId.find("#"+targetId).val(ZPA_Common.fieldNameFormat(itemData.displayName,tabData.lookupLabelName)),pageId.find("#"+targetId).attr("selecteddata",JSON.stringify(itemData)),event.detail.fromUI&&ZPA_FieldUpdate.insertDftField(wfFCType,"",""),"fvu_paramName"==forEleId&&(pageId.find("#fvu_paramValue").val(""),pageId.find("#fvu_paramValue").removeAttr("selecteddata"),ZPeopleComponents.isComponent("#formFieldTab")&&ZPeopleComponents.tabbedlistboxpopup("#formFieldTab").destroy(),"none"===pageId.find("#fvu_defalutValDiv").css("display")&&ZPA_FieldUpdate.changeFields(pageId.find("#fvuAnchor"))),ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.FIELDUPDATE)}},selectTabbedItem:function(id,forEleId){var selData=ZPA_Common.getPageId(ZP_Automation_Mode.FIELDUPDATE).find("#"+forEleId).attr("selecteddata");if(void 0!=selData){var selDatajson=JSON.parse(selData),parentFormId=selDatajson.parentFormId,lookupFcId=selDatajson.lookupFcId,selParam_ItemObj=ZPA_FieldUpdate.FC_ITEMJSON[ZPA_Common.replaceLabelName(selDatajson.label)],activeTabId=ZPA_TabbedListBox.getActiveTabId(ZPA_FieldUpdate.FORMFIELDS_JSON.formNameJArray,parentFormId,lookupFcId);ZPA_Common.isNotNull(activeTabId)&&ZPeopleComponents.tabbedlistboxpopup("#"+id).setAttribute("activeTab","#"+activeTabId),void 0!=selParam_ItemObj&&(selParam_ItemObj.fcJson.label=ZPA_Common.replaceLabelName(selParam_ItemObj.fcJson.label),ZPeopleComponents.tabbedlistboxpopup("#"+id).selectTabItems(selParam_ItemObj.formKey,selParam_ItemObj.fcJson))}else{activeTabId=ZPA_TabbedListBox.getActiveTabId(ZPA_FieldUpdate.FORMFIELDS_JSON.formNameJArray);ZPA_Common.isNotNull(activeTabId)&&ZPeopleComponents.tabbedlistboxpopup("#"+id).setAttribute("activeTab","#"+activeTabId)}}};var ZPA_Webhook={IS_LOADED:!1,FORMFIELDS_JSON:{},ALL_WBK:"allWbk",SUCC_WBK:"succWbk",FAIL_WBK:"failWbk",webhookId:"",FC_ITEMJSON:{},LIMIT:{NAME:100,DESC:250,URL:255,PARAM_NAME:500,PARAM_VALUE:1e3,USERPARAM_NAME:100,HEADER_PARAM_NAME:100,HEADER_PARAM_VALUE:250},initTopSettMenu:function(tabValue){var pageId=ZPA_Common.getParentPageId(),serviceName=ZPA_Common.getServiceName();ZPeopleComponents.isComponent("#"+serviceName+"_allWbk_formList")?ZPeopleComponents.select("#"+serviceName+"_allWbk_formList").destroy():ZPeopleComponents.isComponent("#"+serviceName+"_failWbk_formList")?ZPeopleComponents.select("#"+serviceName+"_failWbk_formList").destroy():ZPeopleComponents.isComponent("#"+serviceName+"_succWbk_formList")&&ZPeopleComponents.select("#"+serviceName+"_succWbk_formList").destroy();var topMenuDiv=pageId.find("#topSettMenu");topMenuDiv.removeClass("zp_dyn"),topMenuDiv.find(".zpl_rgt").siblings().remove(),topMenuDiv.find(".zpl_rgt").remove();var formListID=ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK),formLiDiv="<div ><span>"+ZPI18N.getString("zp.form")+'</span><select id="'+formListID+'"></select></div>';if(tabValue==ZPA_Webhook.ALL_WBK){var topmenuHtml=formLiDiv+'<div class="zpl_rgt"> <button id="add_webhook" class="zlabel zlabel--blue zlabel--medium" onclick="ZPA_Webhook.addSlide()">'+ZPI18N.getString("zp.addwebhook")+"</button></div>";topMenuDiv.append(topmenuHtml)}else{topmenuHtml=formLiDiv+'<div class="zpl_rgt"><i class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" onclick="ZPA_Webhook.Filter.showHideFilter(\''+tabValue+"')\"></i></div>";topMenuDiv.append(topmenuHtml)}},redirectTab:function(){switch(ZPA_Webhook.getSelectedTabValue()){case ZPA_Webhook.ALL_WBK:ZPA_Webhook.initPage();break;case ZPA_Webhook.FAIL_WBK:ZPA_Webhook.SuccessFailureWbk.constructFailureWbkList();break;case ZPA_Webhook.SUCC_WBK:ZPA_Webhook.SuccessFailureWbk.constructSuccessWbkList()}},initPage:function(formId){ZPA_Webhook.IS_LOADED||(formId=ZPA_Common.isNotNull(formId)?formId:ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK)).getValue(),ZPA_Webhook.constructWebhookList(formId))},constructWebhookList:function(formId){var pageId=ZPA_Common.getParentPageId(ZP_Automation_Mode.WEBHOOK);ZPA_Webhook.resetWbkListing();var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+"</th><th>"+ZPI18N.getString("zp.webhooks.urltonotify")+'</th><th width="80"></th></tr></thead><tbody>',serviceName=settingsUrlProps.currentMode;formId=void 0!=formId&&""!=formId?formId:0,ZPA_Common.Loader.appendPageLoading(pageId);var params={formId:formId,method:"showAllWebhooks",conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),$.post("/getWebhookList.zp",params,function(data){if(ZPA_Webhook.webhooks=data,!ZPA_Common.isProperPage(ZP_Automation_Mode.WEBHOOK))return ZPA_Common.Loader.removePageLoading(pageId),!1;if(ZPA_Webhook.IS_LOADED=!0,data.length>0)pageId.find("#add_webhook").removeClass("DN"),$.each(data,function(index,row){body+='<tr wbkId="'+row.WEBHOOKID+'" onclick="ZPA_Webhook.editSlide(\''+row.WEBHOOKID+"', '"+row.FORMID+"')\"><td>"+row.NAME+"</td><td><span>"+row.DISPLAY_NAME+"</span></td><td><span>"+row.URL+'</span></td><td><div class="zpl_hvr"><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" wbkId="'+this.WEBHOOKID+'" onclick="ZPA_Common.deleteConfirmationPopup(this, \''+ZP_Automation_Mode.WEBHOOK+"', ZPA_Webhook.deleteWebhook)\"></i></div></td></tr>"}),body+="</tbody></table></div>",pageId.find("#allWbk_listing").append(body);else{pageId.find("#add_webhook").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.WEBHOOK),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.WEBHOOK),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.WEBHOOK),pageId.find("#allWbk_listing"));emptyPageObj.setButton(ZPI18N.getString("zp.addwebhook"),ZPA_Webhook.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)})},constructSlider:function(header){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.WEBHOOK),tab.cardId="wbk_cards",tab.validate=ZPA_Webhook.saveWebhook,ZPA_Webhook.wbkModal=new sliderModal(header,tab),ZPA_Webhook.wbkModal.mediumSize=!0,ZPA_Webhook.wbkModal.construct(),ZPA_Common.CloseAlert.construct(ZPA_Webhook.wbkModal),ZPA_Webhook.wbkModal.setCloseCallback(function(){ZPA_Webhook.removeSlider(ZPA_Webhook.wbkModal)});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK),$wbk_cards=pageId.find("#"+tab.cardId);pageId.data("modalInstance",ZPA_Webhook.wbkModal),ZPA_Common.setRelativeContainer($wbk_cards),$wbk_cards.append(ZPA_Webhook.getContainerBody("wbk_basic")),$wbk_cards.append(ZPA_Webhook.getContainerBody("wbk_entity")),$wbk_cards.append(ZPA_Webhook.getContainerBody("wbk_custom")),$wbk_cards.append(ZPA_Webhook.getContainerBody("wbk_hcustom")),$wbk_cards.append(ZPA_Webhook.getContainerBody("wbk_preview")),pageId.find("#webhookFormParamName").off().on("keypress keyup paste",ZPA_Common.paramValidateAct),ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.WEBHOOK))},removeSlider:function(wbk_modal){ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);if(ZPA_Common.getPageMode()==ZP_Automation_Mode.WEBHOOK){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/webhook-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/webhook"}wbk_modal.remove()},loadDefault:function(isEdit,formId){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);ZPA_Common.getFormList(ZP_Automation_Mode.WEBHOOK,ZPA_Common.getServiceName());let wbk_formLiProp={change:ZPA_Webhook.resetWebhookConfig,options:ZPA_Common[ZPA_Common.getFormListMode(ZP_Automation_Mode.WEBHOOK,ZPA_Common.getServiceName())],dataMapping:{label:"dispName",value:"formId",title:"dispName"}};$.isEmptyObject(formId)||"0"==formId||(wbk_formLiProp.selectedValue=formId,(isEdit||ZPA_Common.getPageMode()!=ZP_Automation_Mode.WEBHOOK)&&(wbk_formLiProp.disabled=!0)),ZPA_Common.ZCompProp.loadSelectListProp(wbk_formLiProp),ZPeopleComponents.select("#webhook_formList",wbk_formLiProp),ZPA_Webhook.resetWebhookConfig(isEdit),pageId.find("input[type=radio][name=wbkmethod]").change(function(){ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.WEBHOOK)})},addSlide:function(){if(ZPA_Common.validateAddConfig()){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/webhook/add-formid:"+formId}},add:function(formId){ZPA_Webhook.constructSlider(ZPI18N.getString("zp.addwebhook")),formId=ZPA_Common.getPageMode()==ZP_Automation_Mode.WEBHOOK?settingsUrlProps.urlParamsArr.formid:formId,ZPA_Webhook.loadDefault(!1,formId),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.WEBHOOK),500)},editSlide:function(fvuId,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/webhook/edit-formid:"+formId+"/webhookid:"+fvuId},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_Webhook.editWebhook(editParams.webhookid,editParams.formid)},editWebhook:function(webhookId,formId){ZPA_Webhook.constructSlider(ZPI18N.getString("zp.webhooks.edit")),ZPA_Webhook.loadDefault(!0,formId);var params={method:"getWebhookRow",formId:formId,webHookId:webhookId,conreqcsr:csrfToken};$.ajax({url:"/getWebhookRow.zp",type:"POST",data:params,success:function(data){ZPA_Webhook.insertData(data),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.WEBHOOK),500)}})},deleteWebhook:function(thisObj){var delIcObj=thisObj.delIcObj,webHookId=$(delIcObj).attr("wbkId"),params={webHookId:webHookId,method:"deleteWebhookRow",conreqcsr:csrfToken};$.ajax({url:"/deleteWebhookRow.zp",type:"POST",data:params,success:function(data){if("success"===data.result){ZPA_Webhook.IS_LOADED=!1;var actBody=ZPA_Common.getParentPageId().find("[name=action_body]");actBody.find("[wbkId="+webHookId+"]").remove(),ZPeople.Message.success(ZPI18N.getString("zp.wbkdelsuc")),0==actBody.find("tr[wbkId]").length&&ZPA_Webhook.initPage()}else void 0!==data.wfmapping&&ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.WEBHOOK,data.wfmapping)}})},loadFCItemJson:function(){if(!$.isEmptyObject(ZPA_Webhook.FORMFIELDS_JSON)){var formDtlAry=ZPA_Webhook.FORMFIELDS_JSON.formNameJArray,formCompDtlAry=ZPA_Webhook.FORMFIELDS_JSON.componentJObj;$.each(formDtlAry,function(index,formDtl){$.each(formDtl,function(formKey,formObj){var lookupDisplayName=formObj.lookupDisplayName,componentJAry=formCompDtlAry[formKey];$.each(componentJAry,function(index,secObj){var secNames=Object.keys(secObj);$.each(secNames,function(index,secName){var fcInSecAry=secObj[secName];$.each(fcInSecAry,function(index,fcObj){var itemObj={},pFormId=formKey.split("_")[0];fcObj.parentFormId=pFormId,itemObj.fcJson=fcObj,itemObj.lookupDisplayName=lookupDisplayName,itemObj.formKey=formKey;var label=fcObj.label;ZPA_Webhook.FC_ITEMJSON[label]=itemObj})})})})})}},insertData:function(data){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);ZPA_Common.removeErrorDiv(pageId),ZPA_Webhook.webhookId=data.WEBHOOKID,pageId.find("#webhookName").val(decodeHTML(data.NAME)),pageId.find("#webhookUrl").val(decodeHTML(data.URL)),pageId.find("#webhookDesc").val(decodeHTML(data.DESCRIPTION)),"GET"==data.METHODTYPE?pageId.find("#wbkGet").prop("checked",!0):$("#wbkPost").prop("checked",!0),ZPA_Webhook.FORMFIELDS_JSON=data.formComponents,ZPA_Webhook.loadFCItemJson();var entityParam=decodeHTML(data.ENTITYPARAMS).split(",");ZPA_Webhook.constructEntityParam(entityParam,data.formComponents),pageId.find("#webhookFormParamName").val(decodeHTML(data.FORMATTED_PARAM_NAME)),pageId.find("#webhookFormParamVal").val(decodeHTML(data.FORMATTED_PARAM));var customParam=decodeHTML(data.ADDLPARAMS).split(",");ZPA_Webhook.constructCustomParam(customParam);var customHeaderParam=decodeHTML(data.CUS_HPARAMS).split(",");ZPA_Webhook.constructCustomHeaderParam(customHeaderParam),ZPA_Webhook.previewURL()},resetWbkListing:function(){ZPA_Common.getParentPageId().find(".zpl_rgtcnt").empty()},resetWebhookConfig:function(isEdit){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);ZPA_Webhook.webhookId="",ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.WEBHOOK,!1),pageId.find("#webhookName").val(""),pageId.find("#webhookUrl").val(""),pageId.find("#webhookDesc").val(""),pageId.find("#webhookEntityBody").html(""),ZPA_Webhook.appendNewEntityRowHtml(),pageId.find("#webhookCustomParamBody").html(""),ZPA_Webhook.appendNewCustomRowHtml(),pageId.find("#webhookCustomHParamBody").html(""),ZPA_Webhook.appendNewHeaderCustomRowHtml(),pageId.find("#webhookFormParamName").val(""),pageId.find("#webhookFormParamVal").val(""),pageId.find("#previewURL").val(""),ZPA_Webhook.FORMFIELDS_JSON={},void 0!=isEdit&&isEdit||ZPA_Webhook.constructFormFieldDtls()},constructEntityParam:function(entityParam,formFieldDtl){var keyValue,entityParamValId,pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);if(""!=entityParam&&entityParam.length>0)for(index in pageId.find("#webhookEntityBody [name=entityParam]").closest(".zpl_idiv").remove(),entityParam){ZPA_Webhook.appendNewEntityRowHtml();pageId.find("#webhookEntityBody [name=entityValue]").last(),keyValue=entityParam[index].split("="),pageId.find("#webhookEntityBody [name=entityParam]").last().val(keyValue[0]),entityParamValId=keyValue[1].slice(0,-1).slice(2,keyValue[1].length);var selFCItemObj=ZPA_Webhook.FC_ITEMJSON[entityParamValId],selFCObj=selFCItemObj.fcJson;pageId.find("#webhookEntityBody [name=entityValue]").last().val(ZPA_Common.fieldNameFormat(selFCObj.displayName,selFCItemObj.lookupDisplayName)),pageId.find("#webhookEntityBody [name=entityValue]").last().attr("val",selFCObj.label)}},constructCustomParam:function(customParam){var keyValue,pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);if(customParam.length>0)for(index in pageId.find("#webhookCustomParamBody [name=customParam]").closest(".zpl_idiv").remove(),customParam)ZPA_Webhook.appendNewCustomRowHtml(),keyValue=customParam[index].split("="),pageId.find("#webhookCustomParamBody [name=customParam]").last().val(keyValue[0]),pageId.find("#webhookCustomParamBody [name=customValue]").last().val(keyValue[1])},constructCustomHeaderParam:function(customHParam){var keyValue,pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);if(customHParam.length>0)for(index in pageId.find("#webhookCustomHParamBody [name=customHParam]").closest(".zpl_idiv").remove(),customHParam)ZPA_Webhook.appendNewHeaderCustomRowHtml(),keyValue=customHParam[index].split("="),pageId.find("#webhookCustomHParamBody [name=customHParam]").last().val(keyValue[0]),pageId.find("#webhookCustomHParamBody [name=customHValue]").last().val(keyValue[1])},constructFormFieldDtls:function(async){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.WEBHOOK);$.isEmptyObject(ZPA_Webhook.FORMFIELDS_JSON)&&ZPA_Common.getFormFields(ZP_Automation_Mode.WEBHOOK,formId,async)},validateWebhook:function(params){var errJson={isError:!1},pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);ZPA_Common.removeErrorDiv(pageId);var webhookName=params.webHookName;ZPUtil.Validation.isEmpty(webhookName)?(ZPA_Common.appendErrorDiv(pageId.find("#webhookName"),ZPI18N.getString("zp.emptywbkname")),errJson.isError=!0):webhookName.length>ZPA_Webhook.LIMIT.NAME&&(ZPA_Common.appendErrorDiv(pageId.find("#webhookName"),ZPI18N.getString("zp.wbknamelim")),errJson.isError=!0);var webhookUrl=params.webHookUrl;ZPUtil.Validation.isEmpty(webhookUrl)?(ZPA_Common.appendErrorDiv(pageId.find("#webhookUrl"),ZPI18N.getString("zp.emptywbkurl")),errJson.isError=!0):webhookUrl.length>ZPA_Webhook.LIMIT.URL&&(ZPA_Common.appendErrorDiv(pageId.find("#webhookUrl"),ZPI18N.getString("zp.wbkurllim")),errJson.isError=!0);var webHookDesc=params.webHookDesc;ZPA_Common.isNotNull(webHookDesc)&&webHookDesc.length>ZPA_Webhook.LIMIT.DESC&&(ZPA_Common.appendErrorDiv(pageId.find("#webhookDesc"),ZPI18N.getString("zp.maxdesclimit",[ZPA_Webhook.LIMIT.DESC])),errJson.isError=!0);var formParamName=params.formParamName;if(ZPA_Common.isNotNull(formParamName)){formParamName.length>ZPA_Webhook.LIMIT.USERPARAM_NAME&&(ZPA_Common.appendErrorDiv(pageId.find("#webhookFormParamName"),ZPI18N.getString("zp.parnamlim")),errJson.isError=!0);var formParamVal=params.formParamVal;ZPUtil.Validation.isEmpty(formParamVal)&&(ZPA_Common.appendErrorDiv(pageId.find("#webhookFormParamVal").parent(),ZPI18N.getString("zp.entervalidparam")),errJson.isError=!0)}var entityParamAry=[];if(pageId.find("#webhookEntityBody [name=entityParam]").each(function(index){var entityParamDiv=$(this),entityValueDiv=$(this).closest(".zpl_idiv").find("[name=entityValue]"),entityParam=entityParamDiv.val(),entityValue=entityValueDiv.attr("val");void 0!=entityParam&&""!=entityParam||void 0==entityValue||""==entityValue?void 0==entityParam||""==entityParam||void 0!=entityValue&&""!=entityValue?entityParamAry.push(entityParam):(ZPA_Common.appendErrorDiv(entityValueDiv.parent(),ZPI18N.getString("zp.entervalidparam")),errJson.isError=!0):(ZPA_Common.appendErrorDiv(entityParamDiv,ZPI18N.getString("zp.entervalidparam")),errJson.isError=!0)}),$(entityParamAry).each(function(index,value){if(entityParamAry.indexOf(value)>=0&&(entityParamAry.indexOf(value)!=index||entityParamAry.lastIndexOf(value)!=index)){var errPos=index+1;ZPA_Common.appendErrorDiv(pageId.find("#webhookEntityBody [name=entityParamDiv]:nth-child("+errPos+") [name=entityParam]"),ZPI18N.getString("zp.parnamedup")),errJson.isError=!0}}),params.entityparam.length>ZPA_Webhook.LIMIT.PARAM_NAME||params.entityParamVal.length>ZPA_Webhook.LIMIT.PARAM_VALUE)return errJson.isError=!0,ZPeople.Message.failure(ZPI18N.getString("zp.parlimexc")),errJson;var customParamAry=[];pageId.find("#webhookCustomParamBody [name=customParam]").each(function(index){var customParamDiv=$(this),customValueDiv=$(this).closest(".zpl_idiv").find("[name=customValue]"),customParam=customParamDiv.val(),customValue=customValueDiv.val();void 0!=customParam&&""!=customParam||void 0==customValue||""==customValue?void 0==customParam||""==customParam||void 0!=customValue&&""!=customValue?customParamAry.push(customParam):(ZPA_Common.appendErrorDiv(customValueDiv,ZPI18N.getString("zp.entervalidparam")),errJson.isError=!0):(ZPA_Common.appendErrorDiv(customParamDiv,ZPI18N.getString("zp.entervalidparam")),errJson.isError=!0)}),$(customParamAry).each(function(index,value){if(customParamAry.indexOf(value)>=0&&(customParamAry.indexOf(value)!=index||customParamAry.lastIndexOf(value)!=index)){var parBxCnt=index+1;ZPA_Common.appendErrorDiv(pageId.find("#webhookCustomParamBody [name=customParamDiv]:nth-child("+parBxCnt+") [name=customParam]"),ZPI18N.getString("zp.parnamedup")),errJson.isError=!0}});var customHeaderParamAry=[];return pageId.find("#webhookCustomHParamBody [name=customHParam]").each(function(index){var customHParamDiv=$(this),customHValueDiv=$(this).closest(".zpl_idiv").find("[name=customHValue]"),customHParam=customHParamDiv.val(),customHValue=customHValueDiv.val();void 0!=customHParam&&""!=customHParam||void 0==customHValue||""==customHValue?void 0==customHParam||""==customHParam||void 0!=customHValue&&""!=customHValue?customHParam.length>ZPA_Webhook.LIMIT.HEADER_PARAM_NAME?(ZPA_Common.appendErrorDiv(customHParamDiv,ZPI18N.getString("zp.parameternamelim")),errJson.isError=!0):customHValue.length>ZPA_Webhook.LIMIT.HEADER_PARAM_VALUE?(ZPA_Common.appendErrorDiv(customHValueDiv,ZPI18N.getString("zp.parametervaluelim")),errJson.isError=!0):customHeaderParamAry.push(customHParam):(ZPA_Common.appendErrorDiv(customHValueDiv,ZPI18N.getString("zp.entervalidparam")),errJson.isError=!0):(ZPA_Common.appendErrorDiv(customHParamDiv,ZPI18N.getString("zp.entervalidparam")),errJson.isError=!0)}),$(customHeaderParamAry).each(function(index,value){if(customHeaderParamAry.indexOf(value)>=0&&(customHeaderParamAry.indexOf(value)!=index||customHeaderParamAry.lastIndexOf(value)!=index)){var parBxCnt=index+1;ZPA_Common.appendErrorDiv(pageId.find("#webhookCustomHParamBody [name=customHParamDiv]:nth-child("+parBxCnt+") [name=customHParam]"),ZPI18N.getString("zp.parnamedup")),errJson.isError=!0}}),params.custParamName.length>ZPA_Webhook.LIMIT.PARAM_NAME||params.custParamVal.length>ZPA_Webhook.LIMIT.PARAM_VALUE?(errJson.isError=!0,ZPeople.Message.failure(ZPI18N.getString("zp.parlimexc")),errJson):(errJson.isError&&ZPA_Common.scrollErrorDiv(pageId),errJson)},saveWebhook:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);ZPA_Common.disableSaveBtn(pageId);var webHookFormId=ZPA_Common.getFormId(ZP_Automation_Mode.WEBHOOK),webHookName=pageId.find("#webhookName").val(),webHookDesc=pageId.find("#webhookDesc").val(),webHookUrl=pageId.find("#webhookUrl").val(),webHookMethod=0==$("#wbkMethodDiv").find("input[type='radio']:checked").val()?"POST":"GET",formParamName=pageId.find("#webhookFormParamName").val(),formParamVal=pageId.find("#webhookFormParamVal").val(),entityParams=ZPA_Webhook.getEntityParams("saveWebhook"),customParams=ZPA_Webhook.getCustomParams("saveWebhook"),customHeaderParams=ZPA_Webhook.getHeaderCustomParams(),webhookId=void 0!=ZPA_Webhook.webhookId&&""!=ZPA_Webhook.webhookId?ZPA_Webhook.webhookId:"",param={webHookId:webhookId,webHookFormId:webHookFormId.toString(),webHookName:webHookName,webHookDesc:webHookDesc,webHookUrl:webHookUrl,webHookMethod:webHookMethod,formParamName:formParamName,formParamVal:formParamVal,isActive:"1",entityparam:"",entityParamVal:"",custParamName:"",custParamVal:""};if(""!==entityParams&&(param.entityparam=entityParams.split(";")[0],param.entityParamVal=entityParams.split(";")[1]),""!=customParams&&(param.custParamName=customParams.split(";")[0],param.custParamVal=customParams.split(";")[1]),""!=customHeaderParams&&(param.custHParamName=customHeaderParams.split(";")[0],param.custHParamVal=customHeaderParams.split(";")[1]),ZPA_Webhook.validateWebhook(param).isError)return ZPA_Common.enableSaveBtn(pageId),!1;if(param.custHParamName.split(",").length>5||param.custHParamVal.split(",").length>5)return ZPeople.Message.failure(ZPI18N.getString("zp.headerparamlimitmsg")),ZPA_Common.enableSaveBtn(pageId),!1;var params={method:"saveWebhook",entityParam:JSON.stringify(param),conreqcsr:csrfToken};ZPeople.Request.send("/saveWebhook.zp",params,function(data){if(ZPA_Common.enableSaveBtn(pageId),void 0!==data.status&&"error"===data.status){switch(data.errorType){case"paymentException":case"invalidParams":ZPeople.Message.failure(data.message)}pageId.find("#webhookCreateButton").attr("data-dismiss",""),pageId.find("#webhookCreateButton").removeAttr("disabled")}else{ZPA_Common.isNotNull(webhookId)?ZPeople.Message.success(ZPI18N.getString("zp.wbkupd")):ZPeople.Message.success(ZPI18N.getString("zp.wbkadd"));var pageMode=ZPA_Common.getPageMode();pageMode==ZP_Automation_Mode.WORKFLOW||pageMode==ZP_Automation_Mode.CUSTOMACTION?ZPA_Actions.callBackActions(ZP_Automation_Mode.WEBHOOK,data):pageMode==ZP_Automation_Mode.BLUEPRINT?ZPA_Blueprint.Builder.callBackActions(ZP_Automation_Mode.WEBHOOK,data):ZPA_Webhook.afterSaveCB(webHookFormId),ZPA_Webhook.removeSlider(ZPA_Webhook.wbkModal)}},"",function(data){ZPA_Common.enableSaveBtn(pageId),void 0!=data.responseJSON&&("MORE_THAN_MAX_LENGTH"==data.responseJSON.code?ZPeople.Message.failure(ZPI18N.getString("zp.exceedmaxlength")):ZPA_Common.isNotNull(data.responseJSON.error)&&ZPeople.Message.failure(data.responseJSON.error))})},afterSaveCB:function(formId){ZPA_Webhook.IS_LOADED=!1,formId!=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK)).getValue()&&ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK)).setValue(formId)},getEntityParams:function(mode){var tempKey,tempVal,makeUrl="",entityKey="",entityValue="";return ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK).find("#webhookEntityBody [name=entityParam]").each(function(index){var inputObjs=$(this),selectObj=$(this).closest(".zpl_idiv").find("[name=entityValue]");tempKey=inputObjs.val(),tempVal=selectObj.attr("val"),"previewUrl"==mode?void 0!=tempKey&&void 0!=tempVal&&""!==tempKey&&""!==tempVal&&(makeUrl+=tempKey+"=${"+tempVal+"}&"):"saveWebhook"==mode&&(entityKey+=tempKey+",",ZPA_Common.isNotNull(tempVal)&&(entityValue+="${"+tempVal+"},"))}),"previewUrl"==mode?makeUrl.slice(0,-1):""!=entityKey&&""!=entityValue?entityKey.slice(0,-1)+";"+entityValue.slice(0,-1):""},getCustomParams:function(mode){var tempKey,tempVal,makeUrl="",customParam="",customValue="";return ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK).find("#webhookCustomParamBody [name=customParam]").each(function(index){var inputObjs=$(this),selectObj=$(this).closest(".zpl_idiv").find("[name=customValue]");tempKey=inputObjs.val(),tempVal=selectObj.val(),"previewUrl"==mode?void 0!=tempKey&&void 0!=tempVal&&""!==tempKey&&""!==tempVal&&(makeUrl+=tempKey+"="+tempVal+"&"):"saveWebhook"==mode&&(customParam+=tempKey+",",customValue+=tempVal+",")}),"previewUrl"==mode?makeUrl.slice(0,-1):""!=customParam&&""!=customValue?customParam.slice(0,-1)+";"+customValue.slice(0,-1):""},getHeaderCustomParams:function(){var tempKey,tempVal,customHParam="",customHValue="";return ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK).find("#webhookCustomHParamBody [name=customHParam]").each(function(index){var inputObjs=$(this),selectObj=$(this).closest(".zpl_idiv").find("[name=customHValue]");tempKey=inputObjs.val(),tempVal=selectObj.val(),customHParam+=tempKey+",",customHValue+=tempVal+","}),""!=customHParam&&""!=customHValue?customHParam.slice(0,-1)+";"+customHValue.slice(0,-1):""},getContainerBody:function(cardId){var body="";return"wbk_basic"==cardId?(body+='<div class="zpl_crd"><div class="zpl_crdcnt">',body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+"</label></div>",body+='<div><select id="webhook_formList"></select></div></div>',body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.webhooks.name")+"</label></div>",body+='<div><input type="text" class="ztextbox" id = "webhookName" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.WEBHOOK+"')\"></div></div>",body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.webhooks.urltonotify")+"</label></div>",body+='<div><input type="text" class="ztextbox" id = "webhookUrl" onchange="ZPA_Webhook.onChangeWbkUrl()"></div></div>',body+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.description")+"</label></div>",body+='<div><input type="text" rows="2" class="ztextbox" id="webhookDesc" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.WEBHOOK+"')\"></div></div>",body+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.method")+"</label></div>",body+='<div id="wbkMethodDiv"><div class="zradiobutton zradiobutton--horizontal"><input id="wbkPost" class="zradiobutton__helper" type="radio" name="wbkmethod" value="0" checked=""><label class="zradiobutton__label" for="wbkPost"><span class="zradiobutton__text">'+ZPI18N.getString("zp.post")+"</span></label></div>",body+='<div class="zradiobutton zradiobutton--horizontal"><input id="wbkGet" name="wbkmethod" class="zradiobutton__helper" type="radio" value="1"><label class="zradiobutton__label" for="wbkGet"><span class="zradiobutton__text">'+ZPI18N.getString("zp.get")+"</span></label></div></div>",body+="</div></div>"):"wbk_entity"==cardId?(body+='<div class="zpl_crd"><div class="zpl_crdhdr">',body+="<div><h4>"+ZPI18N.getString("zp.urlparam")+"</h4><p>"+ZPI18N.getString("zp.formfldparam")+"</p></div></div>",body+='<div class="zpl_crdcnt"><div class="zpl_secn"><div><div class="zpl_gbox">',body+='<div class="zpl_idiv"><p>'+ZPI18N.getString("zp.paraminstdformat")+"</p></div>",body+='<div id="webhookEntityBody" rowCnt="1">'+ZPA_Webhook.getEntityRowHtml()+"</div>",body+='<div class="zpl_idiv"><a class="zpl_lnkbg" onclick="ZPA_Webhook.appendNewEntityRowHtml()">'+ZPI18N.getString("zp.addnew")+"</a></div>",body+="</div></div></div>",body+='<div class="zpl_secn"><p>'+ZPI18N.getString("zp.usrdefparam")+"</p><div><label>"+ZPI18N.getString("zp.paramname")+'</label></div><div><input type="text" class="ztextbox" id="webhookFormParamName" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.WEBHOOK+"')\"></div></div>",body+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.paramval")+'</label></div><div><div class="ztextbox--group zh-alignright zpl_inpticfild"><i id="webhookUDFPopoverBtn" class="ztextbox__icon PI_addlist" onclick="ZPA_Webhook.TabPanel.openTabPanel(\'udf_tabpanel\', \'webhookUDFPopoverBtn\')"></i><textarea type="text" id="webhookFormParamVal" rows="4" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.WEBHOOK+'\')"></textarea><div id="webhookFormParamVal"></div></div><div id="udf_tabpanel"></div></div></div>',body+="</div></div>"):"wbk_custom"==cardId?(body+='<div class="zpl_crd"><div class="zpl_crdhdr">',body+="<div><h4>"+ZPI18N.getString("zp.urlparam")+"</h4><p>"+ZPI18N.getString("zp.custparam")+"</p></div></div>",body+='<div class="zpl_crdcnt"><div class="zpl_secn"><div><div class="zpl_gbox">',body+='<div class="zpl_idiv"><p>'+ZPI18N.getString("zp.paraminstdformat")+"</p></div>",body+='<div id="webhookCustomParamBody">'+ZPA_Webhook.getCustomRowHtml()+"</div>",body+='<div class="zpl_idiv"><a class="zpl_lnkbg" onclick="ZPA_Webhook.appendNewCustomRowHtml()">'+ZPI18N.getString("zp.addnew")+"</a></div>",body+="</div></div></div>",body+="</div></div>"):"wbk_hcustom"==cardId?(body+='<div class="zpl_crd"><div class="zpl_crdhdr">',body+="<div><h4>"+ZPI18N.getString("zp.headerparam")+"</h4><p>"+ZPI18N.getString("zp.custheaderparam")+"</p></div></div>",body+='<div class="zpl_crdcnt"><div class="zpl_secn"><div><div class="zpl_gbox">',body+='<div class="zpl_idiv"><p>'+ZPI18N.getString("zp.paraminstdformat")+"</p></div>",body+='<div id="webhookCustomHParamBody">'+ZPA_Webhook.getHeaderCustomRowHtml()+"</div>",body+='<div class="zpl_idiv"><a class="zpl_lnkbg" onclick="ZPA_Webhook.appendNewHeaderCustomRowHtml()">'+ZPI18N.getString("zp.addnew")+"</a></div>",body+="</div></div></div>",body+="</div></div>"):"wbk_preview"==cardId&&(body+='<div class="zpl_crd"><div class="zpl_crdcnt">',body+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.previewurl")+"</label></div>",body+='<div><textarea class="ztextbox is-disabled" rows="4" id ="previewURL" disabled></textarea></div>',body+='<div class="zpl_idiv""><a class="zpl_lnkbg" onclick="ZPA_Webhook.previewURL()"><i class="PI_refresh"></i>'+ZPI18N.getString("zp.webhooks.refreshurl")+"</a></div></div>",body+="</div></div>"),body},onChangeWbkUrl:function(){ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.WEBHOOK),ZPA_Webhook.previewURL()},appendNewEntityRowHtml:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);pageId.find("#webhookEntityBody").append(ZPA_Webhook.getEntityRowHtml()),pageId.find("#webhookEntityBody [name=entityParam]").off().on("keypress keyup paste",ZPA_Common.paramValidateAct),ZPA_Webhook.checkDeleteIcon(pageId.find("#webhookEntityBody"))},checkDeleteIcon:function(parent){1==parent.children().length?parent.find(".PI_delete").addClass("DN"):parent.children(":first").find(".PI_delete").removeClass("DN")},getEntityRowHtml:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK),entityCnt=pageId.find("#webhookEntityBody").attr("rowCnt");pageId.find("#webhookEntityBody").attr("rowCnt",parseInt(entityCnt)+1);var panelDivId="entVal_Panel_"+entityCnt,panelForDivId="entPan_Icon_"+entityCnt,rowHtml='<div class="zpl_idiv" name="entityParamDiv" "><div><input type="text" class="ztextbox"  name="entityParam" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.WEBHOOK+"')\"/></div><span>=</span>";return rowHtml+='<div><div class="ztextbox--group zh-alignright zpl_inpticfild"><i class="ztextbox__icon PI_addlist" id="'+panelForDivId+'" onclick="ZPA_Webhook.TabPanel.openTabPanel(\''+panelDivId+"', '"+panelForDivId+'\')"  readonly ></i><input name="entityValue" placeholder="'+ZPI18N.getString("zp.choosefield")+'" type="text" class="ztextbox" readonly=""><div id="'+panelDivId+'"></div></div></div>',rowHtml+='<i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" onclick="ZPA_Webhook.removeRow(this,\'entityParam\')"></i></div>'},appendNewCustomRowHtml:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);pageId.find("#webhookCustomParamBody").append(ZPA_Webhook.getCustomRowHtml()),pageId.find("#webhookCustomParamBody [name=customParam]").off().on("keypress keyup paste",ZPA_Common.paramValidateAct),ZPA_Webhook.checkDeleteIcon(pageId.find("#webhookCustomParamBody"))},getCustomRowHtml:function(){var rowHtml='<div class="zpl_idiv" name="customParamDiv"><div><input type="text" class="ztextbox" name="customParam" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.WEBHOOK+"')\"/></div><span>=</span>";return rowHtml+='<div><input name="customValue" type="text" class="ztextbox" name="customValue" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.WEBHOOK+"')\"></div>",rowHtml+='<i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" onclick="ZPA_Webhook.removeRow(this,\'customParam\')"></i></div>'},appendNewHeaderCustomRowHtml:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);pageId.find("#webhookCustomHParamBody").append(ZPA_Webhook.getHeaderCustomRowHtml()),pageId.find("#webhookCustomHParamBody [name=customHParam]").off().on("keypress keyup paste",ZPA_Common.paramValidateAct),ZPA_Webhook.checkDeleteIcon(pageId.find("#webhookCustomHParamBody"))},getHeaderCustomRowHtml:function(){var rowHtml='<div class="zpl_idiv" name="customHParamDiv"><div><input type="text" class="ztextbox" name="customHParam" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.WEBHOOK+"')\"/></div><span>=</span>";return rowHtml+='<div><input name="customHValue" type="text" class="ztextbox" name="customHValue" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.WEBHOOK+"')\"></div>",rowHtml+='<i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" onclick="ZPA_Webhook.removeRow(this,\'customHParam\')"></i></div>'},removeRow:function(thisObj,mode){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);if($(thisObj).parent().remove(),void 0!=mode&&"entityParam"==mode){pageId.find("#webhookEntityBody [name=entityParamDiv]").length;ZPA_Webhook.checkDeleteIcon(pageId.find("#webhookEntityBody"))}else if(void 0!=mode&&"customParam"==mode){pageId.find("#webhookCustomParamBody [name=customParamDiv]").length;ZPA_Webhook.checkDeleteIcon(pageId.find("#webhookCustomParamBody"))}else void 0!=mode&&"customHParam"==mode&&ZPA_Webhook.checkDeleteIcon(pageId.find("#webhookCustomHParamBody"));ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.WEBHOOK)},previewURL:function(){var entityParam,valOfOtherParam,pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK),url=pageId.find("#webhookUrl").val();if(void 0!=url&&""!==url){url+="?"+(entityParam=ZPA_Webhook.getEntityParams("previewUrl"));var formatPName=pageId.find("#webhookFormParamName").val(),formatTextVal=pageId.find("#webhookFormParamVal").val();""!==formatPName&&""!==formatTextVal&&(url+=entityParam?"&":"",url+=formatPName+"=<"+formatPName.toUpperCase()+">"),(valOfOtherParam=ZPA_Webhook.getCustomParams("previewUrl"))&&(url+=entityParam||""!==formatPName&&""!==formatTextVal?"&":"",url+=valOfOtherParam)}pageId.find("#previewURL").val(url)},switchTab:function(thisObj){var pageId=ZPA_Common.getParentPageId(),selLi=$(thisObj);if(!selLi.hasClass("zpl_act")){selLi.parent().find("li").removeClass("zpl_act"),selLi.addClass("zpl_act");var tabValue=selLi.attr("tab");switch(pageId.find(".zpl_rgtcnt").addClass("DN"),pageId.find("#"+tabValue+"_listing").removeClass("DN"),pageId.find("#wbkfltr_cont").remove(),ZPA_Webhook.IS_LOADED=!1,tabValue){case ZPA_Webhook.ALL_WBK:ZPA_Webhook.initTopSettMenu(tabValue),ZPA_Common.loadFormListInListPage(ZP_Automation_Mode.WEBHOOK,ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK)),pageId.find("#filterResultsHeader ul").empty(),pageId.find("#filterResultsHeader").addClass("DN"),ZPA_Webhook.initPage();break;case ZPA_Webhook.FAIL_WBK:case ZPA_Webhook.SUCC_WBK:ZPA_Webhook.initTopSettMenu(tabValue),ZPA_Webhook.SuccessFailureWbk.initThirdLvlTab(tabValue)}}},getSelectedTabValue:function(){return ZPA_Common.getParentPageId().find("#webhook_topTab ul .zpl_act").attr("tab")}};ZPA_Webhook.SuccessFailureWbk={IS_SUCC_LOADED:!1,IS_FAIL_LOADED:!1,initThirdLvlTab:function(tabValue){var formListID=ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK);ZPA_Common.loadFormListInListPage(ZP_Automation_Mode.WEBHOOK,formListID),ZPA_Webhook.SuccessFailureWbk.initPage(tabValue)},initPage:function(tabValue,formId){ZPA_Common.getParentPageId();switch(ZPA_Webhook.resetWbkListing(),tabValue){case ZPA_Webhook.SUCC_WBK:ZPA_Webhook.SuccessFailureWbk.IS_SUCC_LOADED=!1,ZPA_Webhook.SuccessFailureWbk.constructSuccessWbkList(formId);break;case ZPA_Webhook.FAIL_WBK:ZPA_Webhook.SuccessFailureWbk.IS_FAIL_LOADED=!1,ZPA_Webhook.SuccessFailureWbk.constructFailureWbkList(formId)}},constructFailureWbkList:function(formId,isFromFilter){var pageId=ZPA_Common.getParentPageId();formId=ZPA_Common.isNotNull(formId)?formId:ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK)).getValue();var params={method:"showAllFailureWebhooks",conreqcsr:csrfToken};ZPA_Webhook.SuccessFailureWbk.constructFilterParam(params,formId,isFromFilter)&&!ZPA_Webhook.SuccessFailureWbk.IS_FAIL_LOADED&&(pageId.find("#failWbk_listing").empty(),ZPA_Common.Loader.appendPageLoading(pageId),$.post("/getFailureWebhookList.zp",params,function(data){if(data.length>0){ZPA_Webhook.resetWbkListing();var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.webhooks.name")+"</th><th>"+ZPI18N.getString("zp.formname")+"</th><th>"+ZPI18N.getString("zp.associatedrecord")+"</th><th>"+ZPI18N.getString("zp.latestinvoketime")+'</th><th width="150">'+ZPI18N.getString("zp.redoanaction")+'</th><th width="100">'+ZPI18N.getString("zp.response")+"</th></tr></thead><tbody>";$.each(data,function(){body+="<tr onclick=\"ZPA_Webhook.editSlide('"+this.WEBHOOKID+"', '"+this.FORMID+"')\"><td>"+this.NAME+"</td>",body+="<td><span>"+this.DISPLAY_NAME+"</span></td><td><a onclick=\"ZPA_Common.viewRecord('"+this.FORMID+"','"+this.PKID+"')\">"+ZPI18N.getString("zp.viewRecord")+"</a></td>",body+="<td><span>"+this.PREVIOUS_INVOKE_TIME+"</span></td>",body+='<td><span class="zpl_hvr zpl_hvrsw"><i title="'+ZPI18N.getString("zp.redo")+'" class="PI_reset" onclick="ZPA_Webhook.SuccessFailureWbk.redo(this,\''+this.WEBHOOK_FAILURE_ID+"', '"+this.FORMID+'\')"></i></span><span class="zpl_hvr zpl_hvrsw"><i  class="PI_cls DNI" name="clsFailWbk"></i></span></td>',body+='<td><span class="zpl_hvr zpl_hvrsw"><i title="'+ZPI18N.getString("zp.message")+'" id="showComment_'+this.WEBHOOK_FAILURE_ID+'" class="PI_comment" onclick="ZPA_Webhook.SuccessFailureWbk.showResponseMessage(this,\''+this.WEBHOOK_FAILURE_ID+"','"+this.RESP_CODE+'\')"></i><label style="display:none">'+this.RESPONSE+"</label></span></td>"}),pageId.find("#failWbk_listing").append(body),pageId.find("#failWbk_listing [name=clsFailWbk]").on("click",function(event){event.stopPropagation()}),ZPA_Webhook.SuccessFailureWbk.IS_FAIL_LOADED=!0}else{new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.WEBHOOK,ZPA_Webhook.FAIL_WBK),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.WEBHOOK,ZPA_Webhook.FAIL_WBK),"",pageId.find("#failWbk_listing")).show()}ZPA_Common.Loader.removePageLoading(pageId)}))},constructSuccessWbkList:function(formId,isFromFilter){var pageId=ZPA_Common.getParentPageId();formId=ZPA_Common.isNotNull(formId)?formId:ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.WEBHOOK)).getValue();var params={method:"showAllSuccessWebhooks",conreqcsr:csrfToken};ZPA_Webhook.SuccessFailureWbk.constructFilterParam(params,formId,isFromFilter)&&!ZPA_Webhook.SuccessFailureWbk.IS_SUCC_LOADED&&(pageId.find("#succWbk_listing").empty(),ZPA_Common.Loader.appendPageLoading(pageId),$.post("/getSuccessWebhookList.zp",params,function(data){if(data.length>0){var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.webhooks.name")+"</th><th>"+ZPI18N.getString("zp.formname")+"</th><th>"+ZPI18N.getString("zp.associatedrecord")+"</th><th>"+ZPI18N.getString("zp.latestinvoketime")+'</th><th width="100">'+ZPI18N.getString("zp.response")+"</th></tr></thead><tbody>";$.each(data,function(){body+="<tr onclick=\"ZPA_Webhook.editSlide('"+this.WEBHOOKID+"', '"+this.FORMID+"')\"><td><b>"+this.NAME+"</b></td>",body+="<td><span>"+this.DISPLAY_NAME+'</span></td><td><a class="" onclick="ZPA_Common.viewRecord(\''+this.FORMID+"','"+this.PKID+"')\">"+ZPI18N.getString("zp.viewRecord")+"</a></td>",body+="<td><span>"+this.INVOKE_TIME+"</span></td>",body+='<td><span class="zpl_hvr zpl_hvrsw"><i title="'+ZPI18N.getString("zp.message")+'" id="showComment_'+this.WEBHOOK_SUCCESS_ID+'" class="PI_comment" onclick="ZPA_Webhook.SuccessFailureWbk.showResponseMessage(this,\''+this.WEBHOOK_SUCCESS_ID+'\')"></i><label style="display:none">'+this.RESPONSE+"</label></span></td>"}),pageId.find("#succWbk_listing").append(body),ZPA_Webhook.SuccessFailureWbk.IS_SUCC_LOADED=!0}else{new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.WEBHOOK,ZPA_Webhook.SUCC_WBK),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.WEBHOOK,ZPA_Webhook.SUCC_WBK),"",pageId.find("#succWbk_listing")).show()}ZPA_Common.Loader.removePageLoading(pageId)}))},constructFilterParam:function(params,formId,isFromFilter){var pageId=ZPA_Common.getParentPageId();if(ZPA_Common.removeErrorDiv(pageId.find("#wbkfltr_cont")),params.serviceName=ZPA_Common.getServiceName(),isFromFilter&&ZPeopleComponents.isComponent(pageId.find("#wbkfltr_cont #wbkList_fltr")))var wbkId=ZPeopleComponents.select(pageId.find("#wbkfltr_cont #wbkList_fltr")).getValue();0!=wbkId&&null!==wbkId&&void 0!==wbkId&&(params.webHookId=wbkId);var period="4";if(isFromFilter&&ZPeopleComponents.isComponent(pageId.find("#wbkfltr_cont #wbkPeriod_fltr"))&&(period=ZPeopleComponents.select(pageId.find("#wbkfltr_cont #wbkPeriod_fltr")).getValue()),params.sDate=period,"5"==period){var fromValue="",toValue="";if(ZPeopleComponents.isComponent(pageId.find("#wbkfltr_cont #dateRangePicker"))&&(fromValue=ZPeopleComponents.daterangepicker(pageId.find("#dateRangePicker")).getFromValue(),toValue=ZPeopleComponents.daterangepicker(pageId.find("#dateRangePicker")).getToValue()),!ZPA_Common.isNotNull(fromValue)||!ZPA_Common.isNotNull(toValue))return ZPA_Common.appendErrorDiv(pageId.find("#wbkfltr_cont #dateRangeInp").parent(),ZPI18N.getString("zp.daterangeerr")),!1;params.sDate=fromValue.fromValueString,params.eDate=toValue.toValueString}return params.startindex=1,void 0!=formId&&""!=formId&&0!=formId&&(params.formId=formId),ZPA_Webhook.Filter.showFilterResult(params),!0},showResponseMessage:function(thisObj,id,respCode){event.stopPropagation();var popOver=$("#popover_"+id);void 0!=popOver&&popOver.length>0&&(ZPeopleComponents.popover("#popover_"+id).destroy(),popOver.remove());var resMsg=$(thisObj).parent().find("label").text();resMsg=ZPA_Common.isNotNull(resMsg)?""+resMsg:""+ZPI18N.getString("zp.noresponsefound");var title=ZPA_Common.isNotNull(respCode)?ZPI18N.getString("zp.responsecode")+" : "+respCode:"",popoverHtml=$('<div id="popover_'+id+'" data-title="'+title+'" data-is-content-html-encoded="true" data-for-element="#showComment_'+id+'" data-close-button="true">'+('<div class="zpl_gbox" style="max-width: 400px; max-height: 200px; overflow-y: auto; margin: 0;"><div style="white-space: normal;">'+resMsg+"</div></div>")+"</div>");ZPA_Common.getParentPageId().append(popoverHtml),ZPeopleComponents.popover("#popover_"+id,{forElement:"#showComment_"+id,beforeclose:function(event){event.stopPropagation()}}).open()},redo:function(thisObj,wbhFailureId,formId){event.stopPropagation(),$(thisObj).addClass("DNI"),$(thisObj).parent().parent().find(".PI_cls").removeClass("DNI");var params={method:"redoWebhook"};params.webHookFailureId=wbhFailureId,params.formid=formId,params.conreqcsr=csrfToken,$.post("/redoWebhook.zp",params,function(data){ZPA_Webhook.SuccessFailureWbk.IS_FAIL_LOADED=!1,ZPA_Webhook.SuccessFailureWbk.constructFailureWbkList("",!1)}).fail(function(){$(thisObj).removeClass("DNI"),$(thisObj).parent().parent().find(".PI_cls").addClass("DNI")})}},ZPA_Webhook.Filter={getFilterHtml:function(tabValue){return'<div class="zpl_fltr" id="wbkfltr_cont">\n\t\t\t                    <div>\n\t\t\t                        <div class="zpl_fltrhd">\n\t\t\t                            <h5>'+ZPI18N.getString("zp.filter")+'</h5>\n\t\t\t                            <i class="PI_cls" id="fltr_cls" onclick="ZPA_Webhook.Filter.showHideFilter()"  title="'+ZPI18N.getString("zp.close")+'"></i>\n\t\t\t                        </div>\n \t\t\t                    </div>\n \t\t\t                   <div class="zpl_fltrcnt">\n\t\t\t                        <div class="zpl_fltrlst">\n\t\t\t                            <div class="zpl_secn" name="wbk">\n                                        \t<div><label>'+ZPI18N.getString("zp.webhooks")+'</label></div>\n\t\t\t                            \t<div><select id="wbkList_fltr"></select></div>\n\t\t\t                            </div>\n                                        <div class="zpl_secn" name="period">\n                                        \t<div><label>'+ZPI18N.getString("zp.wfdays")+'</label></div>\n\t\t\t                            \t<div><select id="wbkPeriod_fltr"></select> </div>\n                                        </div>\n                                        <div class="zpl_secn DN" id="dateRangeDiv">\n\t\t\t                            \t<div class="ztextbox--group zh-alignright"><i class="ztextbox__icon PI_calendar"></i><input id="dateRangeInp" class="ztextbox is-disabled" placeholder="'+ZPI18N.getString("zp.daterange")+'"></div>\n                                        </div>\n                                        <div id="dateRangePicker"></div>\n                                    </div>\n\t\t\t                   </div>   \n\t\t\t                   <div ><button id="filterAction" type="button" class="zlabel zlabel--blue zlabel--medium" onclick="ZPA_Webhook.Filter.filterAction(\''+tabValue+"')\">"+ZPI18N.getString("zp.apply")+'</button> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="ZPA_Webhook.Filter.resetFilter(\''+tabValue+"')\">"+ZPI18N.getString("zp.reset")+"</button>\n \t\t\t                   </div>\n \t\t\t                 </div>"},loadDefault:function(tabValue){var pageId=ZPA_Common.getParentPageId();ZPA_Webhook.Filter.loadWbkList(tabValue,0);var periodList=[];periodList.push({period:1,dispName:ZPI18N.getString("zp.today")}),periodList.push({period:2,dispName:ZPI18N.getString("zp.yesterday")}),periodList.push({period:3,dispName:ZPI18N.getString("zp.webhooks.timepicker",[7])}),periodList.push({period:4,dispName:ZPI18N.getString("zp.webhooks.timepicker",[30])}),periodList.push({period:5,dispName:ZPI18N.getString("zp.webhooks.customdate")});var periodListProp={selectedValue:4,options:periodList,tabValue:tabValue,removeExistingDropdown:!0,change:function(event,selProps){var selValue=event.detail.value;event.detail.options.tabValue;if("5"==selValue){pageId.find("#dateRangeDiv").removeClass("DN");var dateRangeProps={forElement:"#dateRangeInp",appendTo:"#wbkfltr_cont",format:dateFmt,change:function(event){var ui=event.detail;pageId.find("#dateRangeInp").val(ZPI18N.getString("zp.daterangeinput",[ui.fromValueString,ui.toValueString]))}};ZPeopleComponents.daterangepicker("#dateRangePicker",dateRangeProps);var picker=pageId.find("#dateRangePicker");pageId.find("#dateRangeInp").off().on("click",function(){$(picker).is(":visible")?ZPeopleComponents.daterangepicker(picker).close():ZPeopleComponents.daterangepicker(picker).open()})}else pageId.find("#dateRangeDiv").addClass("DN")},dataMapping:{label:"dispName",value:"period"}};ZPA_Common.ZCompProp.loadSelectListProp(periodListProp),periodListProp.dropdownList.appendTo=pageId.find("#wbkfltr_cont"),ZPeopleComponents.select(pageId.find("#wbkPeriod_fltr"),periodListProp)},loadWbkList:function(tabValue,formId){var pageId=ZPA_Common.getParentPageId();if(ZPeopleComponents.isComponent(pageId.find("#wbkList_fltr"))&&ZPeopleComponents.select(pageId.find("#wbkList_fltr")).destroy(),ZPA_Common.isNotNull(ZPA_Webhook.webhooks)){var wbkList=[];wbkList.push({wbkId:0,wbkName:ZPI18N.getString("zp.all")}),$.each(ZPA_Webhook.webhooks,function(){0!=formId&&formId!=this.FORMID||wbkList.push({wbkId:this.WEBHOOKID,wbkName:this.NAME})});var wbkListProp={options:wbkList,appendTo:pageId.find("#wbkfltr_cont"),dataMapping:{label:"wbkName",value:"wbkId"},removeExistingDropdown:!0};ZPA_Common.ZCompProp.loadSelectListProp(wbkListProp,!0),wbkListProp.dropdownList.appendTo=pageId.find("#wbkfltr_cont"),ZPeopleComponents.select(pageId.find("#wbkList_fltr"),wbkListProp)}},filterAction:function(tabValue){ZPA_Common.getParentPageId();var formId=ZPA_Common.getFormId(ZP_Automation_Mode.WEBHOOK);(tabValue=ZPA_Common.isNotNull(tabValue)?tabValue:ZPA_Webhook.getSelectedTabValue())==ZPA_Webhook.FAIL_WBK?(ZPA_Webhook.SuccessFailureWbk.IS_FAIL_LOADED=!1,ZPA_Webhook.SuccessFailureWbk.constructFailureWbkList(formId,!0)):tabValue==ZPA_Webhook.SUCC_WBK&&(ZPA_Webhook.SuccessFailureWbk.IS_SUCC_LOADED=!1,ZPA_Webhook.SuccessFailureWbk.constructSuccessWbkList(formId,!0))},showFilterResult:function(params){var pageId=ZPA_Common.getParentPageId(),period=ZPA_Common.isNotNull(params.eDate)?"5":params.sDate;pageId.find("#filterResultsHeader").removeClass("DN");var wbkId=params.webHookId,wbkDispName=ZPI18N.getString("zp.all");if(ZPA_Common.isNotNull(wbkId)){var wbkList=ZPeopleComponents.select(pageId.find("#wbkfltr_cont #wbkList_fltr")).options;$.each(wbkList,function(ind,wbkObj){if(wbkObj.wbkId==wbkId)return wbkDispName=wbkObj.wbkName,!1})}var perDispName="";switch(period){case"1":perDispName=ZPI18N.getString("zp.today");break;case"2":perDispName=ZPI18N.getString("zp.yesterday");break;case"3":perDispName=ZPI18N.getString("zp.webhooks.timepicker",[7]);break;case"5":perDispName=ZPI18N.getString("zp.daterangeinput",[params.sDate,params.eDate]);break;default:perDispName=ZPI18N.getString("zp.webhooks.timepicker",[30])}ZPA_Common.isNotNull(wbkId)||"4"!=period?pageId.find("#resetFilter").parent().removeClass("DN"):pageId.find("#resetFilter").parent().addClass("DN"),pageId.find("#filterResultsHeader ul").empty(),pageId.find("#filterResultsHeader ul").append('<li name="wbk"><label>'+ZPI18N.getString("zp.webhooks")+" : </label><span title='"+wbkDispName+"'>"+wbkDispName+'</span><a class="PI_cls" name="wbFilterResultsClose"></a></li>'),pageId.find("#filterResultsHeader ul").append('<li name="period"><label>'+ZPI18N.getString("zp.wfdays")+" : </label><span title='"+perDispName+"'>"+perDispName+'</span><a class="PI_cls" name="wbFilterResultsClose"></a></li>'),pageId.find("#filterResultsHeader ul").find("li").on("click",event=>{ZPA_Webhook.Filter.openSelectedFilterOption(event)}),pageId.find("[name=wbFilterResultsClose]").on("click",event=>{ZPA_Webhook.Filter.removeFilter(event)})},showHideFilter:function(tabValue){var pageId=ZPA_Common.getParentPageId();pageId.find("#wbkfltr_cont").length<=0&&(pageId.append(ZPA_Webhook.Filter.getFilterHtml(tabValue)),ZPA_Webhook.Filter.loadDefault(tabValue)),pageId.hasClass("zpl_fltr_flt")?pageId.removeClass("zpl_fltr_flt"):(pageId.addClass("zpl_fltr_flt"),ZPA_Common.removeErrorDiv(pageId.find("#wbkfltr_cont")))},openSelectedFilterOption:function(event){let filterName=$(event.target).parent("li").attr("name"),tabValue=ZPA_Webhook.getSelectedTabValue(),pageId=ZPA_Common.getParentPageId();ZPA_Webhook.Filter.showHideFilter(tabValue),pageId.find("#wbkfltr_cont").find("[name="+filterName+"]")[0].scrollIntoView({behavior:"smooth",block:"center"})},removeFilter:function(event){let filterName=$(event.target).parent("li").attr("name"),tabValue=ZPA_Webhook.getSelectedTabValue();switch(ZPA_Webhook.Filter.showHideFilter(tabValue),filterName){case"wbk":ZPeopleComponents.select("#wbkList_fltr").setValue(0);break;case"period":ZPeopleComponents.select("#wbkPeriod_fltr").setValue(4)}ZPA_Webhook.Filter.showHideFilter(tabValue),ZPA_Webhook.Filter.filterAction(tabValue)},resetFilter:function(){var pageId=ZPA_Common.getParentPageId();ZPA_Common.removeErrorDiv(pageId.find("#wbkfltr_cont")),ZPeopleComponents.select(pageId.find("#wbkfltr_cont #wbkList_fltr")).setValue(0),ZPeopleComponents.select(pageId.find("#wbkfltr_cont #wbkPeriod_fltr")).setValue(4)},resetFilterResult:function(){ZPA_Webhook.Filter.resetFilter(),ZPA_Webhook.Filter.filterAction()}},ZPA_Webhook.TabPanel={openTabPanel:function(id,forEleId){if(ZPA_Webhook.constructFormFieldDtls(!1),!ZPeopleComponents.isComponent(id)){var tabPanelObj={id:id,forEleId:forEleId,appendTo:"#wbk_cards",select:ZPA_Webhook.TabPanel.setParamValue};ZPA_Util.TabPanel.loadFormFieldTabPanel(ZPA_Webhook.FORMFIELDS_JSON,tabPanelObj)}ZPeopleComponents.tabbedlistboxpopup("#"+id).open(),ZPA_Webhook.TabPanel.selectTabPanelItem(id,forEleId)},setParamValue:function(event,eventObj){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK),tabId=eventObj.id,forEleId=eventObj.forEleId,itemData=event.detail.itemData,tabData=event.detail.options.tabData;if("udf_tabpanel"==tabId){var label="${"+itemData.label+"}",udfText=pageId.find("#webhookFormParamVal").val();pageId.find("#webhookFormParamVal").val(udfText+label)}else pageId.find("#"+forEleId).parent().find("[name=entityValue]").val(ZPA_Common.fieldNameFormat(itemData.displayName,tabData.label)),pageId.find("#"+forEleId).parent().find("[name=entityValue]").attr("val",itemData.label);ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.WEBHOOK)},selectTabPanelItem:function(id,forEleId){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.WEBHOOK);if("udf_tabpanel"!=id){var selVal=pageId.find("#"+forEleId).parent().find("[name=entityValue]").attr("val"),selItemObj=ZPA_Webhook.FC_ITEMJSON[selVal];if(!$.isEmptyObject(selItemObj)){var formKey=selItemObj.formKey,fcjson=selItemObj.fcJson;ZPA_Common.isNotNull(formKey)&&ZPeopleComponents.tabbedlistboxpopup("#"+id).setAttribute("activeTab","#"+formKey),ZPeopleComponents.tabbedlistboxpopup("#"+id).selectTabItems(formKey,fcjson)}}}},ZPA_Deluge={POPUP_MODAL:null,EXEC_POPUP_MODAL:null,getCurrentPageMode:function(){var pageMode=ZPA_Common.getPageMode();switch(pageMode){case ZP_Automation_Mode.CUSTOMSCHEDULER:pageMode=ZP_Automation_Mode.CUSTOMSCHEDULER;break;case ZP_Automation_Mode.STANDALONE_FUNCTION:pageMode=ZP_Automation_Mode.STANDALONE_FUNCTION;break;default:pageMode=ZP_Automation_Mode.CUSTOMFUNCTION}return pageMode},initiateDeluge:function(pageId,customFnId,script,dreFuncId){ZPA_Deluge.constructFormList(pageId);var editorDivElement=pageId.find("#delugeEditorArea");editorDivElement.attr("customfunctionid",customFnId),editorDivElement.html("");var callBackParams={delugeDivObj:editorDivElement[0],script:script};void 0!=dreFuncId&&(callBackParams.dreFuncId=dreFuncId),ZPA_DelugeEditor.load(ZPA_Deluge.initDeluge,callBackParams)},initDeluge:function(params){var saveAndExeFunc=ZPA_Deluge.getCurrentPageMode()==ZP_Automation_Mode.STANDALONE_FUNCTION?ZPA_StandaloneFunction.saveAndExecute:ZPA_Deluge.saveAndExecute,options={execute:ZPA_Deluge.execute,saveAndExecute:saveAndExeFunc,callback:ZPA_Deluge.callBack,serviceName:"zohopeople",zuid:_LOGGEDIN_ZUID,sharedBy:_LOGGEDIN_ZSOID,connections:{version:1,internalConnections:!0,userAccess:{show:!1,checked:!1}}};isPlatformOrg&&(options.connections.groupName=pfExtId);var script=params.script;if(void 0!=script&&""!=script&&(options.script=ZPA_Deluge.getModifiedScptCont(script)),initializeDelugeEditor(params.delugeDivObj,options),void 0!=params.dreFuncId){var counter=0,versionFunc=function(){counter<=10?(counter++,void 0!=delugeEditor&&(delugeEditor.initializeVersion(_LOGGEDIN_ACCZSOID,params.dreFuncId,"zohopeople"),clearInterval(versionFunc))):clearInterval(versionFunc)};setInterval(versionFunc,500)}},resetEditor:function(){var pageMode=ZPA_Deluge.getCurrentPageMode(),pageId=ZPA_Common.getPageId(pageMode);ZPA_Deluge.updateDelugeFunctionName("Untitledfunction");try{void 0!==delugeEditor&&ZPA_Deluge.updateDelugeParams([])}catch(e){}pageId.find("#delugeEditorArea").attr("customfunctionid",""),pageId.find("#compilationErr").html("")},callBack:function(_delugeEditor){delugeEditor=_delugeEditor},execute:function(){ZPA_Deluge.getConfigParamDtls()&&ZPA_Deluge.getConfigParamDtls().length>0?ZPA_Deluge.executeFnParams():ZPA_Deluge.executeFunction()},saveAndExecute:function(){var pageMode=ZPA_Deluge.getCurrentPageMode(),pageId=ZPA_Common.getPageId(pageMode);ZPA_Common.Loader.appendPageLoading(pageId),pageId.find("#atmn_page_loading").css({position:"absolute",top:"0px",left:"0px",opacity:"0.5","z-index":"9999","background-color":"#ffffff"});var delugeConfig=ZPA_Deluge.getConfiguration(pageId),cfid=delugeConfig.cfId,params={method:"createFunction",oprType:"saveAndExecute",script:delugeConfig.fnName+"{\n"+delugeConfig.script+"\n}",paramJson:JSON.stringify(ZPA_Deluge.getConfigParamDtls()),cfId:cfid};ZPeople.ISUNCONFIRMEDACC?(ZPeople.unconfirmedErr(),ZPA_Common.Loader.removePageLoading(pageId)):ZPeople.Request.send("/createCustomFunction.zp",params,ZPA_Deluge.afterSaveAndExecute)},afterSaveAndExecute:function(resultData,params){var pageMode=ZPA_Deluge.getCurrentPageMode(),pageId=ZPA_Common.getPageId(pageMode);pageId.find("#compilationErr").html(""),void 0!==resultData.failure?(pageId.find("#compilationErr").html(ZSEC.Encoder.encodeForHTML(resultData.failure)),pageId.find("#compilationErr")[0].scrollIntoView({behavior:"smooth",block:"end"}),ZPA_Common.Loader.removePageLoading(pageId)):setTimeout(function(){ZPA_Common.Loader.removePageLoading(pageId)},300),"saveAndExecute"==resultData.oprType&&(pageId.find("#delugeEditorArea").attr("customfunctionid",resultData.cfId),void 0!==resultData.executeFunctionResponse?ZPA_Deluge.displayExecutionOutput(resultData.executeFunctionResponse):ZPA_Deluge.executeFnParams())},executeFnParams:function(){var pageMode=ZPA_Deluge.getCurrentPageMode(),tab=(ZPA_Common.getPageId(pageMode),new Tab);tab.id="cfExecParam",tab.cardId="cfParam_Cards",tab.validate=ZPA_Deluge.executeFunction,ZPA_Deluge.EXEC_POPUP_MODAL=new popupModal(ZPI18N.getString("zp.executscript"),tab),ZPA_Deluge.EXEC_POPUP_MODAL.save=ZPI18N.getString("zp.execute"),ZPA_Deluge.EXEC_POPUP_MODAL.construct(),ZPA_Deluge.EXEC_POPUP_MODAL.setCloseCallback(function(){ZPA_Deluge.closeExecPopup()});var $execParam_cards=ZPA_Common.getPopUpId(ZPA_Deluge.EXEC_POPUP_MODAL).find("#"+tab.cardId);ZPA_Common.setRelativeContainer($execParam_cards),$execParam_cards.append(ZPA_Deluge.getExecParamBodyHtml()),ZPA_Deluge.constructBoolParamVal()},constructBoolParamVal:function(){var returnTypeList=[];returnTypeList.push({value:"true",name:"true"}),returnTypeList.push({value:"false",name:"false"});var rtnTypeListProp={options:returnTypeList,dataMapping:{label:"name",value:"value"}},popUpId=ZPA_Common.getPopUpId(ZPA_Deluge.EXEC_POPUP_MODAL);ZPA_Common.ZCompProp.loadSelectListProp(rtnTypeListProp);var rtnTypeDiv=popUpId.find("#execParamList [name=boolParamVal]");ZPeopleComponents.select(rtnTypeDiv,rtnTypeListProp)},closeExecPopup:function(){ZPA_Deluge.EXEC_POPUP_MODAL&&ZPA_Deluge.EXEC_POPUP_MODAL.remove(),ZPA_Deluge.EXEC_POPUP_MODAL=null},getExecParamBodyHtml:function(){var paramJson=ZPA_Deluge.getConfigParamDtls(),body='<div class="zpl_crd"">';return body+='<div  id="execParamList" class="zpl_crdcnt">',$.each(paramJson,function(index,value){var entityRow=ZPA_Deluge.getExecParamRow(value.PARAMETERNAME,value.PARAMETERDATATYPE);body+=entityRow}),body+="</div></div>"},getExecParamRow:function(paramName,paramType){var paramRowHtml='<div class="zpl_secn" name="paramRow"><div><label name="entityParamName">'+paramType+" "+paramName+"</label></div>";return paramRowHtml+="bool"==paramType?'<div><select name="boolParamVal"></select></div>':'<div><input class="ztextbox" name="entityParamValue"></input></div>',paramRowHtml+="</div>"},displayExecutionOutput:function(data){var responseStr="";if("Success"===data.status){if(void 0!==data.result.message.userMessage){var infos=data.result.message.userMessage,respTxt="";$.each(infos,function(i,item){respTxt+="<div>"+$("<div/>").text(item).html()+"</div>"}),responseStr+="<div class='zpl_secn wd100_per' style='max-height: 400px; overflow-y: auto;'><div class='zpl_gbox text-left' style='word-break:break-all;'><div>"+respTxt+"</div></div></div>"}var paramJson=ZPA_Deluge.getConfigParamDtls(),succAlrt=new SuccessAlertMessage(ZPI18N.getString("zp.cfexecutesucc"));succAlrt.setCallback(ZPA_Deluge.executeAgain),void 0==paramJson||paramJson.length<=0?(succAlrt.yesButtonText="",succAlrt.removeAfterYes=!1):succAlrt.yesButtonText=ZPI18N.getString("zp.executeagain"),succAlrt.setCenterHtml(responseStr),succAlrt.show(),succAlrt.alertDiv.find(".zpl_mcnt").css("overflow","hidden")}else{var failAlrt=new DeleteAlertMessage(ZPI18N.getString("zp.executionfailed")),respStr="<div class='zpl_gbox' style='max-height: 200px; overflow-y: auto;'><div>"+data.errorMessage+"</div></div>";void 0!=(paramJson=ZPA_Deluge.getConfigParamDtls())&&paramJson.length>0?(failAlrt.setCallback(ZPA_Deluge.executeAgain),failAlrt.yesButtonText=ZPI18N.getString("zp.executeagain")):(failAlrt.yesButtonText="",failAlrt.removeAfterYes=!1),failAlrt.setCenterHtml(respStr),failAlrt.show(),failAlrt.alertDiv.find(".zpl_mcnt").css("overflow","hidden")}},executeFunction:function(){var currMode=ZPA_Deluge.getCurrentPageMode(),pageId=ZPA_Common.getPageId(currMode),popUpId=ZPA_Common.getPopUpId(ZPA_Deluge.EXEC_POPUP_MODAL);popUpId.find("#sliderSbt").addClass("disabled");var cusFnId=pageId.find("#delugeEditorArea").attr("customfunctionid"),executeParamArr=[],executeParamJson={};popUpId.find("#execParamList [name=paramRow]").each(function(index,element){(executeParamJson={}).PARAMETERNAME=$(element).find("[name=entityParamName]").text().split(" ")[1];var entityParamVal=$(element).find("[name=entityParamValue]");void 0!=entityParamVal&&entityParamVal.length>0?executeParamJson.PARAMETERVALUE=$(element).find("[name=entityParamValue]").val():executeParamJson.PARAMETERVALUE=ZPeopleComponents.select($(element).find("[name=boolParamVal]")).getValue(),executeParamArr.push(executeParamJson)});var params={cfId:cusFnId,method:"excuteCustomFunction",conreqcsr:csrfToken,paramJson:JSON.stringify(executeParamArr)};$.post("/execCustomFunction.zp",params,function(data){popUpId.find("#sliderSbt").removeClass("disabled"),ZPA_Deluge.closeExecPopup(),ZPA_Deluge.displayExecutionOutput(data)})},executeAgain:function(alrtPopupObj){var paramJson=ZPA_Deluge.getConfigParamDtls();void 0!=paramJson&&paramJson.length>0&&(alrtPopupObj.remove(),ZPA_Deluge.executeFnParams())},getConfiguration:function(pageId){return{script:getEditorValue(),cfId:pageId.find("#delugeEditorArea").attr("customfunctionid"),fnName:ZPA_Deluge.getFunctionDef()}},getFunctionDef:function(){var currMode=ZPA_Deluge.getCurrentPageMode(),pageId=ZPA_Common.getPageId(currMode),paramJson=ZPA_Deluge.getConfigParamDtls(),functionName=pageId.find("#cfRtnType").html()+" "+pageId.find("#delugeFuncName").html()+"(";return $.each(paramJson,function(index,value){functionName+=value.PARAMETERDATATYPE+" "+value.PARAMETERNAME,functionName+=","}),functionName+="map recordDetails",functionName+=")"},openEditParams:function(){var currMode=ZPA_Deluge.getCurrentPageMode();ZPA_Common.getPageId(currMode);ZPA_CustomFunction.constructFormFieldDtls(!1),ZPA_CustomFunction.loadFCItemJson();var cfParams=ZPA_Deluge.getConfigParamDtls();if(cfParams=void 0!=cfParams?cfParams:[],$.isEmptyObject(cfParams)){var paramObj={PARAMETERNAME:"",PARAMETERVALUE:"",pLookUp:!0};cfParams.push(paramObj)}ZPA_Deluge.iterateParams(cfParams)},iterateParams:function(cfParams){var currMode=ZPA_Deluge.getCurrentPageMode(),pageId=ZPA_Common.getPageId(currMode);ZPA_Deluge.constructEditParamHtml();var popUpId=ZPA_Common.getPopUpId(ZPA_Deluge.POPUP_MODAL),delugeFuncName=pageId.find("#delugeFuncName").data("delugeFuncName");if(popUpId.find("#delugeFnName").val(delugeFuncName),cfParams.length>0)$.each(cfParams,function(index,paramObj){var rowHtml=ZPA_Deluge.getFuncParamRow();if(popUpId.find("#paramListDiv").append(rowHtml),popUpId.find("#paramListDiv [name=cf_selectDiv]").last().hide(),popUpId.find("#paramListDiv [name=cf_valueDiv]").last().hide(),popUpId.find("#paramListDiv [name=paramName]").last().val(paramObj.PARAMETERNAME),paramObj.pLookUp){popUpId.find("#paramListDiv [name=cf_selectDiv]").last().show();var paramVal=paramObj.PARAMETERVALUE;if(void 0!=paramVal&&""!=paramVal){paramVal=paramVal.substring(paramVal.indexOf("${")+2,paramVal.length-1);var selItemObj=ZPA_CustomFunction.FC_ITEMJSON[paramVal],entValInpDiv=popUpId.find("#paramListDiv [name=cf_selectDiv]").last().find("input");entValInpDiv.val(ZPA_Common.fieldNameFormat(selItemObj.fcJson.displayName,selItemObj.lookupDisplayName)),entValInpDiv.attr("labelname",selItemObj.fcJson.label),entValInpDiv.attr("fctype",selItemObj.fcJson.colType),entValInpDiv.attr("wffctype",selItemObj.fcJson.workFlowFcType)}}else popUpId.find("#paramListDiv [name=cf_valueDiv]").last().show(),popUpId.find("#paramListDiv [name=cf_valueDiv] input").last().val(paramObj.PARAMETERVALUE),popUpId.find("#paramListDiv [name=cf_Anker]").last().text(ZPI18N.getString("zp.selectfield"))});else{var rowHtml=ZPA_Deluge.getFuncParamRow();popUpId.find("#paramListDiv").append(rowHtml)}popUpId.find("input").off().on("keypress keyup paste",ZPA_Common.paramValidateAct),ZPA_Deluge.handleDeleteIcon()},handleDeleteIcon(){var popUpId=ZPA_Common.getPopUpId(ZPA_Deluge.POPUP_MODAL);1==popUpId.find("#paramListDiv").children().length?popUpId.find(".PI_delete").addClass("DN"):popUpId.find(".PI_delete").removeClass("DN")},getConfigParamDtlsArr:function(){var popUpId=ZPA_Common.getPopUpId(ZPA_Deluge.POPUP_MODAL);ZPA_Common.removeErrorDiv(popUpId);var paramDtlArr=[],paramJson={},isError=!1,paramDivList=popUpId.find("#paramListDiv").children();return $(paramDivList).each(function(index,paramObj){paramJson={};var currParamObj=$(paramObj),paramName=currParamObj.find("[name=paramName]").val().trim(),type="string",paramValue="";if(paramJson.PARAMETERNAME=paramName,"none"!=currParamObj.find("[name=cf_selectDiv]").css("display")){var inputObj=currParamObj.find("[name=cf_selectDiv] input"),labelname=inputObj.attr("labelname");switch(void 0!=labelname&&""!=labelname&&(paramValue="${"+labelname+"}"),parseInt(inputObj.attr("wffctype"))){case 5:type="int"}paramJson.pLookUp=!0}else paramValue=currParamObj.find("[name=cf_valueDiv] input").val(),paramJson.pLookUp=!1;paramJson.PARAMETERVALUE=paramValue,paramJson.PARAMETERDATATYPE=type,paramName.length>0&&paramValue.length>0?paramDtlArr.push(paramJson):void 0!==paramValue&&0!==paramValue.length||0==paramName.length?void 0!==paramName&&0!==paramName.length||0==paramValue.length||(ZPA_Common.appendErrorDiv(currParamObj.find("[name=paramName]"),ZPI18N.getString("zp.emptyvaluenotallowed")),isError=!0):("none"!=currParamObj.find("[name=cf_selectDiv]").css("display")?ZPA_Common.appendErrorDiv(currParamObj.find("[name=cf_selectDiv]"),ZPI18N.getString("zp.emptyvaluenotallowed")):ZPA_Common.appendErrorDiv(currParamObj.find("[name=cf_valueDiv] input"),ZPI18N.getString("zp.emptyvaluenotallowed")),isError=!0)}),isError?null:paramDtlArr},saveConfigParamDtls:function(){var pageMode=ZPA_Deluge.getCurrentPageMode(),popUpId=(ZPA_Common.getPageId(pageMode),ZPA_Common.getPopUpId(ZPA_Deluge.POPUP_MODAL)),delugeFuncName=popUpId.find("#delugeFnName").val().trim(),paramDtlArr=ZPA_Deluge.getConfigParamDtlsArr();ZPA_Common.isNotNull(delugeFuncName)?delugeFuncName.length>250?ZPA_Common.appendErrorDiv(popUpId.find("#delugeFnName"),ZPI18N.getString("zp.maxdlgfuncname")):null!=paramDtlArr&&(delugeFuncName.length>0&&(ZPA_Deluge.updateDelugeFunctionName(delugeFuncName),ZPA_Deluge.putConfigParamDtls(paramDtlArr),ZPA_Deluge.updateDelugeParams(paramDtlArr)),null!=ZPA_Deluge.POPUP_MODAL&&(ZPA_Deluge.POPUP_MODAL.close(),ZPA_Deluge.POPUP_MODAL=null),ZPA_Common.CloseAlert.changesMade(pageMode)):ZPA_Common.appendErrorDiv(popUpId.find("#delugeFnName"),ZPI18N.getString("zp.entdlgfuncname"))},updateDelugeFunctionName:function(funcName){var currMode=ZPA_Deluge.getCurrentPageMode(),pageId=ZPA_Common.getPageId(currMode);pageId.find("#delugeFuncName").text(" "+funcName.replace(/ /g,"_")),pageId.find("#delugeFuncName").data("delugeFuncName",funcName)},updateDelugeParams:function(paramJAry){var currMode=ZPA_Deluge.getCurrentPageMode(),pageId=ZPA_Common.getPageId(currMode),paramStr="",setParamToFunction="";$.each(paramJAry,function(index,value){paramStr+='<span id="custFnParamType">'+value.PARAMETERDATATYPE+'</span><span id="custFnParamName"> '+ZSEC.Encoder.encodeForHTML(value.PARAMETERNAME)+"</span>,",setParamToFunction+=value.PARAMETERDATATYPE+":"+ZSEC.Encoder.encodeForHTML(value.PARAMETERNAME)+" ,"}),paramStr=paramStr.slice(0,-1),setParamToFunction.length>0&&(setParamToFunction="{"+setParamToFunction.substring(0,setParamToFunction.length-2)+"}",setTimeout(function(){delugeEditor.addFuncParamsToEditor(""+setParamToFunction)},300)),pageId.find("#allCustFnParams").html("").append("(").append(paramStr).append(")")},putConfigParamDtls:function(paramDtlArr){var currMode=ZPA_Deluge.getCurrentPageMode();ZPA_Common.getPageId(currMode).find("#allCustFnParams").data("paramList",paramDtlArr)},getConfigParamDtls:function(){var currMode=ZPA_Deluge.getCurrentPageMode();return ZPA_Common.getPageId(currMode).find("#allCustFnParams").data("paramList")},getModifiedScptCont:function(script){var strIndex=script.indexOf("{")+1,len=script.length-1;return script=(script=script.substring(strIndex,len)).replace(/\n\t/g,"\n")},constructEditParamHtml:function(){null!=ZPA_Deluge.POPUP_MODAL&&(ZPA_Deluge.POPUP_MODAL.remove(),ZPA_Deluge.POPUP_MODAL=null);var tab=new Tab;tab.id="cfEditParam",tab.cardId="cfParam_Cards",tab.validate=ZPA_Deluge.saveConfigParamDtls,ZPA_Deluge.POPUP_MODAL=new popupModal(ZPI18N.getString("zp.editparams"),tab),ZPA_Deluge.POPUP_MODAL.construct(),ZPA_Deluge.POPUP_MODAL.setCloseCallback(ZPA_Deluge.callBackBfrClose);var popUpId=ZPA_Common.getPopUpId(ZPA_Deluge.POPUP_MODAL);popUpId.addClass("zpl_mmd"),popUpId.find("#"+tab.cardId).append(ZPA_Deluge.getCardBody()),popUpId.find("#delugeFnName").off().on("keypress keyup paste",ZPA_Common.paramValidateAct)},callBackBfrClose:function(){ZPA_Deluge.POPUP_MODAL.remove()},getCardBody:function(){var body='<div class="zpl_crd">';return body+='<div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.methodname")+'</label></div><div><input id="delugeFnName" type="text" class="ztextbox"></div></div>',body+='<div class="zpl_secn"><div class="zpl_cndor"><div class="zpl_gbox">',body+='<div class=""><div><label><b>'+ZPI18N.getString("zp.methodarg")+'</b></label></div></div><div id="paramListDiv"></div>',body+='<div class=""><a class="zpl_lnkbg" onclick="ZPA_Deluge.appendNewParamRow()">'+ZPI18N.getString("zp.addnew")+"</a></div>",body+="</div></div></div></div></div></div>"},getFuncParamRow:function(){var rowCnt=ZPA_Common.getPopUpId(ZPA_Deluge.POPUP_MODAL).find("[name=paramName]").length+1,entValId="entityValue_"+rowCnt,entTabPanelId="entTabPanel_"+rowCnt,rowHtml='<div class="zpl_idiv"><div><input name="paramName"  class="ztextbox w300" /></div><div><span>=</span></div>';return rowHtml+='<div><div name="cf_selectDiv" class="ztextbox--group zh-alignright zpl_inpticfild w300"><i class="ztextbox__icon PI_addlist" readonly="" onclick="ZPA_Deluge.TabPanel.openTabPanel(\''+entTabPanelId+"', '"+entValId+'\')"></i><input id="'+entValId+'" placeholder="'+ZPI18N.getString("zp.choosefield")+'" type="text" class="ztextbox" disabled="disabled" readonly=""><div id="'+entTabPanelId+'"></div></div><div name="cf_valueDiv" style="display: none;"><input id="inpBx" type="text" class="ztextbox w300"></div></div>',rowHtml+='<div><span><a name="cf_Anker" onclick="ZPA_Deluge.changeFields(this)">'+ZPI18N.getString("zp.fieldupdate.specifyfield")+"</a></span></div>",rowHtml+='<i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" onclick="ZPA_Deluge.removeParamRow(this)"></i></div>'},appendNewParamRow:function(){var popUpId=ZPA_Common.getPopUpId(ZPA_Deluge.POPUP_MODAL);popUpId.find("#cfParam_Cards #paramListDiv").append(ZPA_Deluge.getFuncParamRow()),popUpId.find("input").off().on("keypress keyup paste",ZPA_Common.paramValidateAct),ZPA_Deluge.handleDeleteIcon()},removeParamRow:function(thisObj){$(thisObj).closest(".zpl_idiv").remove(),ZPA_Deluge.handleDeleteIcon()},changeFields:function(thisObj){var parentObj=$(thisObj).closest(".zpl_idiv");parentObj.find("[name=cf_valueDiv]").toggle(),parentObj.find("[name=cf_selectDiv]").toggle();var changeLinkName="block"===parentObj.find("[name=cf_valueDiv]").css("display")?ZPI18N.getString("zp.selectfield"):ZPI18N.getString("zp.fieldupdate.specifyfield");$(thisObj).text(changeLinkName)},toggleFormList:function(thisObj){$(thisObj).closest(".dvcustom-editor").toggleClass("zpl_sHaPi")},constructFormList:function(pageId){pageId.find("ul#formsList li").length<=0&&APIref.init({fromAutomation:!0})},sortFormsList:function(pageId){var formList=pageId.find("ul#formsList");$.each(APIref.formsList,function(i,formsDtl){var formDtl=pageId.find("ul#formsList li#getForms"+formsDtl.formId);formList.append(formDtl)})},rearrangeFormsList:function(pageId){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.CUSTOMFUNCTION),currForm=pageId.find("ul[elem=formsList] li[formid="+formId+"]");pageId.find("ul[elem=formsList]").prepend(currForm)},getButtonAttribute:function(isEditView){return(isEditView?" execute=true ":"")+(ZPA_Common.Sandbox.isPrdOrgAndSBActive()?"":" saveAndExecute=true ")}},ZPA_Deluge.TabPanel={openTabPanel:function(id,forEleId){if(ZPA_CustomFunction.constructFormFieldDtls(!1),!ZPeopleComponents.isComponent("#"+id)){var tabPanelProps={id:id,forEleId:forEleId,appendTo:"#cfEditParam",select:ZPA_Deluge.TabPanel.setEntityValue};ZPA_Util.TabPanel.loadFormFieldTabPanel(ZPA_CustomFunction.FORMFIELDS_JSON,tabPanelProps)}ZPeopleComponents.tabbedlistboxpopup("#"+id).open(),ZPA_Deluge.TabPanel.selectTabItems(id,forEleId)},setEntityValue:function(event,eventObj){var popupId=ZPA_Common.getPopUpId(ZPA_Deluge.POPUP_MODAL),forEleId=(eventObj.id,eventObj.forEleId),itemData=event.detail.itemData,tabData=event.detail.options.tabData;popupId.find("#"+forEleId).val(ZPA_Common.fieldNameFormat(itemData.displayName,tabData.label)),popupId.find("#"+forEleId).attr("labelname",itemData.label),popupId.find("#"+forEleId).attr("fctype",itemData.colType),popupId.find("#"+forEleId).attr("wffctype",itemData.workFlowFcType),popupId.find("#"+forEleId).attr("labelname",itemData.label),popupId.find("#"+forEleId).attr("fctype",itemData.colType),popupId.find("#"+forEleId).attr("wffctype",itemData.workFlowFcType)},selectTabItems:function(id,forEleId){var selVal=ZPA_Common.getPopUpId(ZPA_Deluge.POPUP_MODAL).find("#"+forEleId).attr("labelname"),selItemObj=ZPA_CustomFunction.FC_ITEMJSON[selVal];if(ZPA_Common.isNotNull(selItemObj)){var formKey=selItemObj.formKey;ZPA_Common.isNotNull(formKey)&&ZPeopleComponents.tabbedlistboxpopup("#"+id).setAttribute("activeTab","#"+formKey)}}};var ZPA_CustomFunction={IS_LOADED:!1,CF_MODAL:null,modalDtls:{},FORMFIELDS_JSON:{},FC_ITEMJSON:{},initPage:function(formId){ZPA_CustomFunction.IS_LOADED||(formId=ZPA_Common.isNotNull(formId)?formId:ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.CUSTOMFUNCTION)).getValue(),ZPA_CustomFunction.constuctCFListing(formId))},constuctCFListing:function(formId){var pageId=ZPA_Common.getParentPageId();pageId.find(".zpl_rgtcnt").empty(),ZPA_Common.Loader.appendPageLoading(pageId);var serviceName=ZPA_Common.getServiceName(),params={formId:formId=void 0!=formId&&""!=formId?formId:0,method:"list",oprType:"customFn",conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),$.post("/cfList.zp",params,function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.CUSTOMFUNCTION))return ZPA_Common.Loader.removePageLoading(pageId),!1;if(ZPA_CustomFunction.IS_LOADED=!0,data.length>0){pageId.find("#add_customfunction").removeClass("DN");var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+'</th><th width="80"></th></tr></thead><tbody>';$.each(data,function(index,row){body+='<tr cfId="'+row.CUSTOMFUNCTIONID+'" onclick="ZPA_CustomFunction.editSlide(\''+row.CUSTOMFUNCTIONID+"', '"+row.FORMID+"')\"><td>"+row.DISPLAYNAME+"</td><td><span>"+row.DISPLAY_NAME+'</span></td><td><div class="zpl_hvr"><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" cfId="'+this.CUSTOMFUNCTIONID+'" onclick="ZPA_Common.deleteConfirmationPopup(this, \''+ZP_Automation_Mode.CUSTOMFUNCTION+"', ZPA_CustomFunction.deleteCustomFunction)\"></i></div></td></tr>"}),body+="</tbody></table></div>",pageId.find(".zpl_rgtcnt").append(body)}else{pageId.find("#add_customfunction").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.CUSTOMFUNCTION),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.CUSTOMFUNCTION),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.CUSTOMFUNCTION),pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.addcustomfunction"),ZPA_CustomFunction.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)})},constructCFSlider:function(headerName,isFromChklist,isEdit){null!=ZPA_CustomFunction.CF_MODAL&&(ZPA_CustomFunction.CF_MODAL.remove(),ZPA_CustomFunction.CF_MODAL=null);var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.CUSTOMFUNCTION),tab.cardId="cf_cards",tab.validate=ZPA_CustomFunction.save,ZPA_CustomFunction.CF_MODAL=new sliderModal(headerName,tab),ZPA_CustomFunction.CF_MODAL.largeSize=!0,ZPA_CustomFunction.CF_MODAL.NoCallback=!0,ZPA_CustomFunction.CF_MODAL.setCloseCallback(ZPA_CustomFunction.callbackBfrClose),ZPA_CustomFunction.CF_MODAL.construct(),ZPA_Common.CloseAlert.construct(ZPA_CustomFunction.CF_MODAL);var cf_cards=$(settingsPage.mainWrapId).find("#"+tab.cardId);ZPA_Common.setRelativeContainer(cf_cards),cf_cards.append(ZPA_Common.Cards.construct("cf_editor",ZPA_CustomFunction.getContainerBody(isEdit)));var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION);pageId.data("modalInstance",ZPA_CustomFunction.CF_MODAL),pageId.find("#cf_editor").addClass("wd100_per"),pageId.find("#sliderCls").before(ZPA_CustomFunction.getmaxMinIconHtml),ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.CUSTOMFUNCTION)),ZPA_Common.setBasePage(pageId,isFromChklist)},getmaxMinIconHtml:function(){return'<span class="zpl_mhderrgt"><i class="PI_maxmz zpl_btnic" title='+ZPI18N.getString("zp.expand")+' onclick="ZPA_CustomFunction.minimizeMaximize(this)"></i></span>'},minimizeMaximize:function(thisObj){var currMode=ZPA_Deluge.getCurrentPageMode(),pageIdValue=ZPA_Common.getPageIdValue(currMode),pageId=$(thisObj).closest("#"+pageIdValue);pageId.hasClass("zpl_mfull")?(pageId.find("#cf_cards").removeClass("h100_per"),pageId.find("#delugeEditorArea").css("height","490px"),pageId.removeClass("zpl_mfull").promise().done(function(){delugeEditor.resize()}),pageId.removeClass("zpl_cstmmdfr"),$(thisObj).removeClass("PI_minmz").addClass("PI_maxmz"),$(thisObj).attr("title",ZPI18N.getString("zp.expand"))):(pageId.find("#cf_cards").addClass("h100_per"),pageId.find("#delugeEditorArea").css("height","740px"),pageId.find("#delugeEditorArea").parent()[0].scrollIntoView({behavior:"smooth",block:"start"}),pageId.addClass("zpl_cstmmdfr"),pageId.addClass("zpl_mfull").promise().done(function(){delugeEditor.resize()}),$(thisObj).removeClass("PI_maxmz").addClass("PI_minmz"),$(thisObj).attr("title",ZPI18N.getString("zp.shrink")))},loadDefault:function(isEdit,formId){ZPA_Common.getFormList(ZP_Automation_Mode.CUSTOMFUNCTION,settingsUrlProps.currentMode);let cf_formLiProp={change:ZPA_CustomFunction.resetCFConfig,options:ZPA_Common[ZPA_Common.getFormListMode(ZP_Automation_Mode.CUSTOMFUNCTION,settingsUrlProps.currentMode)],dataMapping:{label:"dispName",value:"formId",title:"dispName"}};$.isEmptyObject(formId)||"0"==formId||(cf_formLiProp.selectedValue=formId,(isEdit||ZPA_Common.getPageMode()!=ZP_Automation_Mode.CUSTOMFUNCTION)&&(cf_formLiProp.disabled=!0)),ZPA_Common.ZCompProp.loadSelectListProp(cf_formLiProp),ZPeopleComponents.select("#customfunction_formList",cf_formLiProp),ZPA_CustomFunction.resetCFConfig()},addSlide:function(){if(ZPA_Common.validateAddConfig()){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.CUSTOMFUNCTION)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/customfunction/add-formid:"+formId}},add:function(formId,isFromChklist){ZPA_CustomFunction.constructCFSlider(ZPA_Common.getHeaderHtml(ZPI18N.getString("zp.addcustomfunction")),isFromChklist,!1),ZPA_DelugeEditor.isCFFromValidation?ZPA_CustomFunction.loadDefault(!0,FormCustomNew.formId):(formId=ZPA_Common.getPageMode()==ZP_Automation_Mode.CUSTOMFUNCTION?settingsUrlProps.urlParamsArr.formid:formId,ZPA_CustomFunction.loadDefault(!1,formId)),ZPA_Deluge.initiateDeluge(ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION)),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.CUSTOMFUNCTION),500)},editSlide:function(cfId,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/customfunction/edit-formid:"+formId+"/customfunctionid:"+cfId},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_CustomFunction.editCF(editParams.customfunctionid,editParams.formid)},editCF:function(cfId,formId,isFromChklist){let isEdit=ZPA_Common.isNotNull(cfId)&&"0"!=cfId;ZPA_CustomFunction.constructCFSlider(ZPA_Common.getHeaderHtml(ZPI18N.getString("zp.editcustomfunction")),isFromChklist,isEdit),ZPA_CustomFunction.loadDefault(!0,formId);var params={method:"getConfiguration",formId:formId,cfId:cfId,conreqcsr:csrfToken};ZPeople.Request.send("/getCFConfig.zp",params,ZPA_CustomFunction.insertCFConfig)},deleteCustomFunction:function(thisObj){var delIcObj=thisObj.delIcObj,cusFnId=$(delIcObj).attr("cfId"),params={cusFnId:cusFnId,method:"delete",conreqcsr:csrfToken};$.ajax({url:"/deleteCustomFunctionRow.zp",type:"POST",data:params,success:function(data){if("success"===data.result){ZPA_CustomFunction.IS_LOADED=!1;var actBody=ZPA_Common.getParentPageId().find("[name=action_body]");actBody.find("[cfId="+cusFnId+"]").remove(),ZPeople.Message.success(ZPI18N.getString("zp.cfdel")),0==actBody.find("tr[cfId]").length&&ZPA_CustomFunction.initPage()}else ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.CUSTOMFUNCTION,data.wfmapping)}})},resetCFConfig:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION);if(ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.CUSTOMFUNCTION,!1),pageId.find("#fnNameInpBx").val(""),pageId.find("#allCustFnParams").data("paramList",[]),ZPA_CustomFunction.FORMFIELDS_JSON={},$.isEmptyObject(ZPA_CustomFunction.FORMFIELDS_JSON)){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.CUSTOMFUNCTION);ZPA_Common.getFormFields(ZP_Automation_Mode.CUSTOMFUNCTION,formId,!1)}ZPA_Deluge.resetEditor()},validateCF:function(params){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION);ZPA_Common.removeErrorDiv(pageId);var isValid=!0,cfDispName=params.customfnDispName,cfDesc=params.cfDesc;return ZPA_Common.isNotNull(cfDispName)||(ZPA_Common.appendErrorDiv(pageId.find("#fnNameInpBx"),ZPI18N.getString("zp.entcfname")),isValid=!1),cfDesc>250&&(ZPA_Common.appendErrorDiv(pageId.find("#cfDesc"),ZPI18N.getString("zp.maxdesclimit",[250])),isValidApproval=!1),isValid},save:function(oprType){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION);ZPA_Common.disableSaveBtn(pageId);var funcDispName=pageId.find("#fnNameInpBx").val(),cfDesc=pageId.find("#cfDesc").val().trim(),delugeConfigJson=ZPA_Deluge.getConfiguration(pageId),script=delugeConfigJson.fnName+"{\n"+delugeConfigJson.script+"\n}",formId=ZPA_Common.getFormId(ZP_Automation_Mode.CUSTOMFUNCTION),cfId=pageId.find("#delugeEditorArea").attr("customfunctionid"),params={method:"createFunction",script:script,customfnDispName:funcDispName,cfDesc:cfDesc,paramJson:JSON.stringify(ZPA_Deluge.getConfigParamDtls()),formId:formId,cfId:cfId,conreqcsr:csrfToken};isValid=ZPA_CustomFunction.validateCF(params),isValid?(ZPA_DelugeEditor.isCFFromValidation&&(params.isValidate=!0),ZPeople.ISUNCONFIRMEDACC?(ZPeople.unconfirmedErr(),ZPA_CustomFunction.callbackBfrClose()):ZPeople.Request.send("/createCustomFunction.zp",params,ZPA_CustomFunction.afterSave,"",function(data){ZPA_Common.enableSaveBtn(pageId),ZPA_Common.isNotNull(data.responseJSON.error)&&ZPeople.Message.failure(ZSEC.Encoder.encodeForHTML(data.responseJSON.error))})):ZPA_Common.enableSaveBtn(pageId)},afterSave:function(resultData,params){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION);if(ZPA_Common.enableSaveBtn(pageId),void 0===resultData.failure){if(ZPA_DelugeEditor.isCFFromValidation)FormCustomNew.cfId=resultData.cfId,FormCustomNew.closeCFValidation(resultData);else{var pageMode=ZPA_Common.getPageMode();resultData.customfnDispName=ZSEC.Encoder.encodeForHTML(resultData.customfnDispName),ZPA_Common.isFromChecklistPage(pageId)&&(pageMode=ZP_Automation_Mode.CHECKLIST),pageMode==ZP_Automation_Mode.WORKFLOW||pageMode==ZP_Automation_Mode.CUSTOMACTION?ZPA_Actions.callBackActions(ZP_Automation_Mode.CUSTOMFUNCTION,resultData):pageMode==ZP_Automation_Mode.BLUEPRINT?ZPA_Blueprint.Builder.callBackActions(ZP_Automation_Mode.CUSTOMFUNCTION,resultData):pageMode==ZP_Automation_Mode.CHECKLIST?ZPA_Checklist.Slider.callBackonSaveActions(ZP_Automation_Mode.CUSTOMFUNCTION,resultData):ZPA_CustomFunction.afterSaveCB(params.formId)}null!=ZPA_CustomFunction.CF_MODAL&&(ZPA_CustomFunction.callbackBfrClose(),ZPA_CustomFunction.CF_MODAL=null),ZPA_Common.isNotNull(params.cfId)?ZPeople.Message.success(ZPI18N.getString("zp.cfupd")):ZPeople.Message.success(ZPI18N.getString("zp.cfadd"))}else ZPeople.Message.failure(ZSEC.Encoder.encodeForHTML(resultData.failure))},afterSaveCB:function(formId){ZPA_CustomFunction.IS_LOADED=!1,formId!=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.CUSTOMFUNCTION)).getValue()&&ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.CUSTOMFUNCTION)).setValue(formId)},loadFCItemJson:function(){if(!$.isEmptyObject(ZPA_CustomFunction.FORMFIELDS_JSON)){var formDtlAry=ZPA_CustomFunction.FORMFIELDS_JSON.formNameJArray,formCompDtlAry=ZPA_CustomFunction.FORMFIELDS_JSON.componentJObj;$.each(formDtlAry,function(index,formDtl){$.each(formDtl,function(formKey,formObj){var lookupDisplayName=formObj.lookupDisplayName,componentJAry=formCompDtlAry[formKey];$.each(componentJAry,function(index,secObj){var secNames=Object.keys(secObj);$.each(secNames,function(index,secName){var fcInSecAry=secObj[secName];$.each(fcInSecAry,function(index,fcObj){var itemObj={},pFormId=formKey.split("_")[0];fcObj.parentFormId=pFormId,itemObj.fcJson=fcObj,itemObj.lookupDisplayName=lookupDisplayName,itemObj.formKey=formKey;var label=fcObj.label;ZPA_CustomFunction.FC_ITEMJSON[label]=itemObj})})})})})}},insertCFConfig:function(resultData){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION);ZPA_CustomFunction.resetCFConfig();var cfId=resultData.cfId;if(pageId.find("#delugeEditorArea").attr("customfunctionid",cfId),void 0!=cfId&&""!=cfId){var script=resultData.script;if(ZPA_Deluge.initiateDeluge(ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION),cfId,script,resultData.dreFnId),script.trim().length>0){pageId.find("#fnNameInpBx").val(resultData.displayName),pageId.find("#cfDesc").val(resultData.description);var funcName=script.substring(script.indexOf("void ")+5,script.indexOf("(")),paramList=resultData.paramList;paramList.length>0&&(ZPA_Deluge.putConfigParamDtls(paramList),ZPA_Deluge.updateDelugeParams(paramList)),ZPA_Deluge.updateDelugeFunctionName(funcName)}}else ZPA_Deluge.initiateDeluge(ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION));ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.CUSTOMFUNCTION),500)},callbackBfrClose:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.CUSTOMFUNCTION);if(ZPeopleComponents.select(pageId.find("#customfunction_formList")).destroy(),null!=ZPA_CustomFunction.CF_MODAL){if(ZPA_DelugeEditor.isCFFromValidation)FormCustomNew.closeCFCallback();else if(ZPA_Common.getPageMode()==ZP_Automation_Mode.CUSTOMFUNCTION){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.CUSTOMFUNCTION)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/customfunction-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/customfunction"}ZPA_CustomFunction.CF_MODAL.remove(),ZPA_CustomFunction.CF_MODAL=null}},getContainerBody:function(isEdit){var body='<div class="zpl_secn zpl_twoclum"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+'</label><select id="customfunction_formList"></select></div>';return body+='<div><label class="zpl_mtry">'+ZPI18N.getString("zp.customfunctionname")+'</label><input type="text" class="ztextbox" id="fnNameInpBx" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.CUSTOMFUNCTION+"')\"></div>",body+='<div><label></label><div class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="ZPA_Deluge.openEditParams()">'+ZPI18N.getString("zp.editparams")+"</div></div></div>",body+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.description")+'</label></div><div><textarea id="cfDesc" type="text" class="ztextbox" rows="3"></textarea></div></div>',body+='<div class="zpl_secn"> ',body+='<div  class="dvcustom-editor fl zpl_cFopt" id="delugeParent""><div class="workflow-decl"><span class="normalcode" id="cfRtnType">void </span><span class="add_parameter" id="delugeFuncName">Untitledfunction</span><span class="add_parameter" id="allCustFnParams">()</span></div>',body+='<div class="zpl_deluCnt"><a class="PI_alft" onclick="ZPA_Deluge.toggleFormList(this)"></a><div class="zpl_cFipt"><h3 id="apiRef">'+ZPI18N.getString("zp.apiref")+"</h3>",body+='<div class="zpl_cFsrl" id="apiref_formLi"></div></div></div><div id="delugeEditorArea" '+ZPA_Deluge.getButtonAttribute(isEdit)+'> </div><span id="compilationErr" class="ztextbox--error__label"></span></div>'},constructFormFieldDtls:function(async){var formId=ZPA_Common.getFormId(ZP_Automation_Mode.CUSTOMFUNCTION);$.isEmptyObject(ZPA_CustomFunction.FORMFIELDS_JSON)&&ZPA_Common.getFormFields(ZP_Automation_Mode.CUSTOMFUNCTION,formId,async)}},ZPA_Approvers={APPROVER_ROW:'<div class="zpl_idiv"><div class="zpl_rwfld"><input name="approver_type"></div><div class="zpl_rwfld"><div><input name="approver_value"></div></div><div class="zpl_rwfld zpl_rwicn" onClick="ZPA_Approvers.removeLevel(this)"><i class="PI_delete"></i></div></div>',MODE_COMMON:0,MODE_APPRAISAL:1,MODE_OFFBOARDING:2,MAX_LEVEL:10,addLevel(){ZPA_Approvers.getApproverMode();var body=ZPA_Common.getMainContainer().find("#approver_body"),addBtn=body.find("#add_level");addBtn.before(ZPA_Approvers.APPROVER_ROW);var approverParams={options:ZPA_Approvers.getType(),dataMapping:{label:"type",value:"key"},dropdownList:{moveOnScroll:!0,fitForElement:!0},change:ZPA_Approvers.showApproverValues};body.find("[name=approver_type]").length>1&&(approverParams.selectedValue=ApproverConstants.Type.USER),ZPeopleComponents.select(body.find("[name=approver_type]").last(),approverParams),ZPeopleComponents.select(body.find("[name=approver_value]").last(),{options:ZPA_Approvers.reporting,dataMapping:{label:"displayName",value:"id"},change:ZPA_Approvers.showApproverFlow}),ZPA_Approvers.showApproverValues(null,null,body),body.find("[name=approver_type]").length==ZPA_Approvers.MAX_LEVEL&&(addBtn.children().addClass("disabled"),addBtn.attr("data-title-display-type","callout"),addBtn.attr("title","Max of "+ZPA_Approvers.MAX_LEVEL+" Levels can be added"))},reset(isEdit){var container=ZPA_Common.getMainContainer();container.find("#add_level").siblings().remove(),ZPA_Approvers.addLevel(),ZPA_Approvers.getApproverMode()==ZPA_Approvers.MODE_COMMON?(container.find("[name=apr_empty]").removeClass("DN").siblings().addClass("DN"),container.find("[name=apr_empty]").parent().siblings().addClass("DNI"),ZPA_Messages.resetMessages(container.find("#auto_approve").is(":checked")?ApproverConstants.Type.AUTO_APPROVE:ApproverConstants.Type.AUTO_REJECT,!0,isEdit)):(container.find("[name=apr_empty]").addClass("DN").siblings().removeClass("DN"),container.find("[name=apr_empty]").parent().siblings().removeClass("DNI")),ZPA_Approvers.MAX_LEVEL=10},configure(getThis){var container=$(getThis).parents(".zpl_act");container.find("[name=apr_empty]").addClass("DN").siblings().removeClass("DN"),container.find("[name=apr_empty]").parent().siblings().removeClass("DNI"),ZPA_Messages.resetMessages(MAConstants.ApprovalType.MANUAL_APPROVAL,!0)},getApproverMode:()=>-1!==settingsUrlProps.niceUrl.indexOf("approval")?ZPA_Approvers.MODE_COMMON:ZPA_Common.Offboarding.isSettingsPage()?ZPA_Approvers.MODE_OFFBOARDING:ZPA_Approvers.MODE_APPRAISAL,getType(mode){mode=ZPA_Common.isNotNull(mode)?mode:ZPA_Approvers.getApproverMode(),(void 0===ZPA_Approvers.commontype&&mode==ZPA_Approvers.MODE_COMMON||void 0===ZPA_Approvers.appraisaltype&&mode==ZPA_Approvers.MODE_APPRAISAL)&&ZPA_Approvers.loadDefault(mode);var typeArr,rowLength=ZPA_Common.getMainContainer().find("#approver_body").find("[name=approver_type]").length;if(mode==ZPA_Approvers.MODE_COMMON){typeArr=JSON.parse(JSON.stringify(ZPA_Approvers.commontype));var slice=0,tableName=ZPA_Common.getTableName("approval",ZPA_Common.getFormId());tableName==Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME?$.each(ZPA_Approvers.commontype,function(index,row){row.key==ApproverConstants.Type.PROJECT||row.key==ApproverConstants.Type.DEPT_MEMS||row.key==ApproverConstants.Type.FORM_FIELD||row.key==ApproverConstants.Type.CHOOSEN_USER?(typeArr.splice(index-slice,1),slice++):row.key==ApproverConstants.Type.MODULE&&(typeArr[index-slice].type=ZPI18N.getString("zp.compensationadmin"))}):$.each(ZPA_Approvers.commontype,function(index,row){row.key==ApproverConstants.Type.MODULE?tableName==urlFormConf.formLabelMap.workfromoffice||tableName==urlFormConf.formLabelMap.visitoratoffice?typeArr[index].type=ZPI18N.getString("zp.premisesincharge"):(typeArr.splice(index-slice,1),slice++):row.key==ApproverConstants.Type.CHOOSEN_USER&&["P_MultiRater_Approval","P_ReviewApprovalSheet","P_GoalSheet","P_LeaveGrant"].includes(tableName)&&(typeArr.splice(index-slice,1),slice++)}),1!=rowLength&&typeArr[typeArr.length-1].key==ApproverConstants.Type.CHOOSEN_USER&&typeArr.splice(typeArr.length-1,1)}else mode==ZPA_Approvers.MODE_APPRAISAL?(typeArr=JSON.parse(JSON.stringify(ZPA_Approvers.appraisaltype)),1==rowLength&&$.each(ZPA_Approvers.appraisaltype,function(index,value){"APPRAISER_CHOOSEN_BY_LASTLEVEL"===value.key&&typeArr.splice(index,1)})):mode==ZPA_Approvers.MODE_OFFBOARDING&&(typeArr=JSON.parse(JSON.stringify(ZPA_Approvers.offboardingtype)));return typeArr},loadDefault(mode,isAsync,callBack){var params={method:"loadApprovers",conreqcsr:csrfToken,mode:void 0!=mode?mode:ZPA_Approvers.MODE_COMMON};$.ajax({url:"/loadApprovers.zp",type:"POST",async:void 0!=isAsync&&isAsync,data:params,success(result){mode==ZPA_Approvers.MODE_COMMON?ZPA_Approvers.commontype=result.approverTypeJson:mode==ZPA_Approvers.MODE_APPRAISAL?void 0!==ZPA_Approvers.formfield?ZPA_Approvers.appraisaltype=result.approverTypeJson:(ZPA_Approvers.appraisaltype=[],$.each(result.approverTypeJson,function(index,value){"FORM_FIELD"!==value.key&&ZPA_Approvers.appraisaltype.push(value)})):mode==ZPA_Approvers.MODE_OFFBOARDING&&(ZPA_Approvers.offboardingtype=result.approverTypeJson),ZPA_Approvers.department=result.departmentJson&&ZPA_Common.decodeValueInJsonObj(result.departmentJson,"displayName"),ZPA_Approvers.group=result.groupJson&&ZPA_Common.decodeValueInJsonObj(result.groupJson,"displayName"),ZPA_Approvers.reporting=result.reportingLevelJson,ZPA_Approvers.role=result.roleJson&&ZPA_Common.decodeValueInJsonObj(result.roleJson,"displayName"),ZPA_Approvers.projects=result.projectsJson,void 0!=callBack&&callBack()}})},showApproverValues(type,value,container){container=void 0!=container?container:ZPA_Common.getMainContainer();var approverDiv=void 0!=type?type.target.parent().next().find("input"):container.find("[name=approver_value]:last");ZPA_Common.approverDiv=approverDiv;var selectedValue=void 0!=value?value.selectedValue:ZPeopleComponents.select(container.find("[name=approver_type]:last")).value,approverParams=ZPA_Approvers.changeApproverValue(approverDiv,selectedValue);void 0!=type&&ZPA_Approvers.hasManyRM(),approverParams.endOfApproval?(container.find("#add_level").addClass("zpl_DNI"),approverDiv.parents(".zpl_idiv").nextAll(":visible").remove()):container.find("#add_level").removeClass("zpl_DNI"),ZPA_Approvers.showApproverFlow()},hasManyRM(){var rmapprovers=0,container=ZPA_Common.getMainContainer().find("#approver_body");return ZPA_Common.removeErrorDiv(container),container.find("[name=approver_type]").each(function(index,row){ZPeopleComponents.select($(row)).value==ApproverConstants.Type.REPORTING&&++rmapprovers>1&&ZPA_Common.appendErrorDiv($(row).parents(":eq(1)"),ZPI18N.getString("zp.errorreportingto"))}),rmapprovers>1},hasModuleValidation(approvalJObj){if("P_Resignation"===ZPA_Common.getTableName("approval",approvalJObj.formId)){if(approvalJObj.approvalConfigJSon){var isRTAvail=!1;return $.each(approvalJObj.approvalConfigJSon,function(index,row){row.apprType==ApproverConstants.Type.REPORTING&&(isRTAvail=!0)}),!!isRTAvail||(ZPeople.Message.failure("Reporting Manager approval is required in approval flow"),!1)}return!1}return!0},changeApproverValue:function(apprValDiv,apprParamVal,appendTo){var approverParams=ZPA_Approvers.getApproverParams(apprParamVal);return"#"+apprValDiv.parent().parent().attr("id")===ZPA_ApprovalSettings.getApproverValueDivId("cancelAppr")&&"SELECTED_ROLE"===apprParamVal&&(approverParams.options=""),ZPA_Common.isNotNull(appendTo)&&(approverParams.dropdownList.appendTo="#"+appendTo),ZPeopleComponents.isComponent(apprValDiv)&&ZPeopleComponents.select(apprValDiv).destroy(),void 0!=approverParams.options&&""!=approverParams.options?(apprValDiv.parent().removeClass("DN"),approverParams.dropdownList.fitForElement=!0,approverParams.dropdownList.moveOnScroll=!0,approverParams.dropdownList.height=450,ZPeopleComponents.select(apprValDiv,approverParams)):apprValDiv.parent().addClass("DN"),approverParams},showApproverFlow(){var flow="";let container=ZPA_Common.getMainContainer();ZPA_Approvers.getApproverMode()==ZPA_Approvers.MODE_OFFBOARDING&&(container=ZPA_Common.getPageId(ZP_Automation_Mode.APPROVAL)),$.each(container.find("#approver_body").find("[name=approver_type]"),function(index,row){var approverValue=$(row).parent().next().find("[name=approver_value]");flow+=""===flow?"":'<i class="PI_argt"></i>',flow+="<label>"+ZPA_Approvers.getApproverValue(ZPeopleComponents.select(row).selectedValue,0!=approverValue.siblings().length?ZSEC.Encoder.encodeForHTML(approverValue.siblings()[0].outerText):"",approverValue.siblings())+"</label>"}),ZPA_Approvers.getApproverMode()!==ZPA_Approvers.COMMON_MODE&&ZPA_Approvers.getApproverMode()!=ZPA_Approvers.MODE_OFFBOARDING||(flow+='<div><font class="grn">Approved</font> / <font class="red">Rejected</font></div>'),container.find("#approver_flow").html(flow)},showOffboardingApproverFlow(approvalJSON){var flow="";return $.each(approvalJSON,function(index,row){row.apprTypeDisplayName?flow+="<label>"+row.apprTypeDisplayName+'</label><i class="PI_argt"></i>':flow+="<label>"+ZPA_Approvers.getApproverValue(row.apprType,"")+'</label><i class="PI_argt"></i>'}),flow+='<div><font class="grn">'+ZPI18N.getString("zp.approved")+'</font> / <font class="red">'+ZPI18N.getString("zp.rejected")+"</font></div>"},getApproverParams(type){var options,params={};switch(params.dataMapping={label:"displayName",value:"id",title:"displayName"},params.change=ZPA_Approvers.showApproverFlow,params.endOfApproval=!1,params.dropdownList={},params.showSearchField=!0,params.dropdownList.contentType="image-text",type){case ApproverConstants.Type.USER:var empObj=EmployeeSearch.getEmpList("","emp","APPROVAL_CONFIGURATION");options=ZPA_Common.getDecodedEmpIdWithName(empObj),params.dataMapping={value:"id",label:"value",image:"image"},params.dataSource={search:param=>new Promise(function(search,reject){search({delay:20,results:ZPA_Common.getDecodedEmpIdWithName(EmployeeSearch.getEmpList(param.query,"emp","APPROVAL_CONFIGURATION")),selectedIndex:erecno,more:!1})}),paginated:!0},params.serverSearch=!0,params.cacheData=!0,params.contentType="image-text",params.search={by:["value","email"]};break;case ApproverConstants.Type.DEPT_HEAD_LOGIN:options="";break;case ApproverConstants.Type.DEPT_HEAD:case ApproverConstants.Type.DEPT_MEMS:options=ZPA_Approvers.department;break;case ApproverConstants.Type.ROLE:options=ZPA_Approvers.role;break;case ApproverConstants.Type.REPORTING:options=ZPA_Approvers.reporting;break;case ApproverConstants.Type.CHOOSEN_USER:options="",params.endOfApproval=!0;break;case ApproverConstants.Type.PROJECT:options=ZPA_Approvers.projects,"P_TimesheetList"!=ZPA_Common.getTableName(ZP_Automation_Mode.APPROVAL,ZPA_Common.getFormId())&&(options=options.slice(1));break;case ApproverConstants.Type.APPRAISER_LAST_LEVEL:options="",params.endOfApproval=!0;break;case ApproverConstants.Type.FORM_FIELD:void 0==ZPA_Approvers.formfield&&ZPA_Approvers.fetchEmpLookup(ZPA_Common.getFormId()),options=ZPA_Approvers.formfield;break;case ApproverConstants.Type.GROUP:options=ZPA_Approvers.group;break;case ApproverConstants.Type.MODULE:options="";break;default:options="",params.endOfApproval=!0}return params.options=options,params},fetchEmpLookup(formId){var params={formId:formId,method:"fetchEmpLookup",conreqcsr:csrfToken};$.ajax({url:"/fetchEmpLookup.zp",type:"POST",data:params,async:!1,success:function(data){for(var key in ZPA_Approvers.formfield=[],data.emplookup){var formfield={};formfield.id=key,formfield.displayName=ZPeople.decodeTxt(data.emplookup[key]),ZPA_Approvers.formfield.push(formfield)}}})},getApproverValue(type,value,row){switch(type){case ApproverConstants.Type.AUTO_APPROVE:apprValue=ZPI18N.getString("zp.autoapprove");break;case ApproverConstants.Type.AUTO_REJECT:apprValue=ZPI18N.getString("zp.autoreject");break;case ApproverConstants.Type.CHOOSEN_USER:apprValue=ZPI18N.getString("zp.apprchoosenbyuser");break;case ApproverConstants.Type.USER:case ApproverConstants.Type.ROLE:case ApproverConstants.Type.FORM_FIELD:apprValue=value;break;case ApproverConstants.Type.DEPT_HEAD_LOGIN:if("#settings-service-performance-appraisaltemplate"===settingsPage.tabId||"#operations-performance-cycle"===settingsPage.tabId){apprValue=ZPI18N.getString("zp.depthdAppsee");break}apprValue=ZPI18N.getString("zp.deptheadofrecordowner");break;case ApproverConstants.Type.DEPT_HEAD:apprValue=ZPI18N.getString("zp.deptheadtype").replace("$deptName",value);break;case ApproverConstants.Type.DEPT_MEMS:apprValue=ZPI18N.getString("zp.deptmemtype").replace("$deptName",value);break;case ApproverConstants.Type.REPORTING:apprValue=ZPI18N.getString("zp.reporttype").replace("$reportingLevel",ZPeopleComponents.select(row.siblings("input")).value);break;case ApproverConstants.Type.PROJECT:(value=ZPeopleComponents.select(row.siblings("input")).value)==ApproverConstants.ProjectType.HEAD?apprValue=ZPI18N.getString("zp.projecthead"):apprValue=ZPI18N.getString("zp.projectmanagers");break;case ApproverConstants.Type.APPRAISER_LAST_LEVEL:apprValue=ZPI18N.getString("zp.lastlevelreview");break;case ApproverConstants.Type.GROUP:apprValue=ZPI18N.getString("zp.grouptype").replace("$groupname",value);break;case ApproverConstants.Type.MODULE:ZPA_Approvers.getApproverMode()==ZPA_Approvers.MODE_OFFBOARDING?apprValue=ZPI18N.getString("zp.hrpartner"):ZPA_Common.getTableName("approval",ZPA_Common.getFormId())==Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME?apprValue=ZPI18N.getString("zp.compensationadmin"):apprValue=ZPI18N.getString("zp.premisesincharge");break;default:apprValue=value+"of Reporting To"}return apprValue},removeLevel(delButton){var row=$(delButton).parent();"APPRAISER_CHOOSEN_BY_LASTLEVEL"==ZPeopleComponents.select($(row).find("[name=approver_type]")).value&&row.next().removeClass("zpl_DNI");var totalApprovers=row.siblings().length;if(1!=totalApprovers){if(row.remove(),ZPA_Approvers.hasManyRM(),ZPA_Approvers.showApproverFlow(),totalApprovers==ZPA_Approvers.MAX_LEVEL){var addBtn=ZPA_Common.getMainContainer().find("#add_level");addBtn.children().removeClass("disabled"),addBtn.removeAttr("title")}}else ZPA_Approvers.reset()},getApprovalConfigJson(configDivId){var pageId=ZPA_Common.getMainContainer(),approvalConfigJSon={};if(pageId.find("[name=apr_empty]").is(":visible")&&void 0===configDivId){var singleApprConf={},apprType=pageId.find("#auto_approve").prop("checked")?"AUTO_APPROVE":"AUTO_REJECT",apprTypeText=pageId.find("#auto_approve").prop("checked")?"AUTO_APPROVE":"AUTO_REJECT";singleApprConf.apprType=apprType,singleApprConf.apprTypeText=apprTypeText,singleApprConf.erecno="-1",singleApprConf.deptid="-1",singleApprConf.fcid="-1",singleApprConf.roleid="-1",singleApprConf.groupid="-1",singleApprConf.noOfReportingToLevels="1",singleApprConf.projectmgrType="-1",singleApprConf.empName="",singleApprConf.deptName="",singleApprConf.groupName="",singleApprConf.roleName="",singleApprConf.projectmgrTypeName="",approvalConfigJSon[1]=singleApprConf}else{var configDiv=pageId.find("#approver_body").children(":not(#add_level)");if(ZPA_Common.isNotNull(configDivId)){var selDivId=ZPA_ApprovalSettings.getApproverValueDivId(configDivId);switch(configDivId){case"critmismatch":case"noapprover":case"cancelAppr":configDiv=pageId.find(selDivId)}}configDiv.each(function(index,row){var singleApprConf={},apprType=ZPeopleComponents.select($(row).find("[name=approver_type]")).value;if("APPROVAL_NOT_APPLICABLE"!=apprType){var apprTypeText=$(this).find("option:selected",this).text(),erecno="-1",deptid="-1",roleid="-1",groupid="-1",fcid="-1",noReportingToOfLevels="1",projectmgrType="-1";switch(apprType){case"SELECTED_USER":erecno=ZPeopleComponents.select($(row).find("[name=approver_value]")).value;break;case"FORM_FIELD":fcid=ZPeopleComponents.select($(row).find("[name=approver_value]")).value;break;case"DEPARTMENT_HEAD":case"DEPARTMENT_MEMBERS":deptid=ZPeopleComponents.select($(row).find("[name=approver_value]")).value;break;case"SELECTED_ROLE":roleid=ZPeopleComponents.select($(row).find("[name=approver_value]")).value;break;case"SELECTED_GROUP":groupid=ZPeopleComponents.select($(row).find("[name=approver_value]")).value;break;case"REPORTING_TO":noReportingToOfLevels=ZPeopleComponents.select($(row).find("[name=approver_value]")).value;break;case ApproverConstants.Type.PROJECT:projectmgrType=ZPeopleComponents.select($(row).find("[name=approver_value]")).value;break;case"APPRAISER_CHOOSEN_BY_LASTLEVEL":$(this).find("[id=addNewApprovalConfigButton]").hide(),$(this).find("[id=removeNewApprovalConfigButton]").show()}singleApprConf.apprType=apprType,singleApprConf.apprTypeText=apprTypeText,singleApprConf.erecno=erecno,singleApprConf.deptid=deptid,singleApprConf.roleid=roleid,singleApprConf.groupid=groupid,singleApprConf.fcid=fcid,singleApprConf.noOfReportingToLevels=noReportingToOfLevels,singleApprConf.projectmgrType=projectmgrType,singleApprConf.empName="",singleApprConf.deptName="",singleApprConf.roleName="",singleApprConf.groupName="",singleApprConf.projectmgrTypeName="",approvalConfigJSon[index+1]=singleApprConf}})}return approvalConfigJSon},loadApprovers(data,ele){var approverBox=ZPA_Common.getMainContainer();ele=void 0!=ele?ele:"",data.length>10&&(ZPA_Approvers.MAX_LEVEL=data.length),$.each(data,function(index,row){if(0!=index)ZPA_Approvers.addLevel();else{if(row.apprType==ApproverConstants.Type.AUTO_APPROVE||row.apprType==ApproverConstants.Type.AUTO_REJECT)return approverBox.find("[name=apr_empty]").removeClass("DN").siblings().addClass("DN"),approverBox.find("[name=apr_empty]").parent().siblings().addClass("DNI"),void(row.apprType==ApproverConstants.Type.AUTO_REJECT&&(approverBox.find("[name=apr_empty]").find("#auto_reject").length>0?approverBox.find("[name=apr_empty]").find("#auto_reject").prop("checked","true"):ZPeopleComponents.select(approverBox.find(ele+" [name=approver_type]").last()).setValue(row.apprType)));approverBox.find("[name=apr_empty]").addClass("DN").siblings().removeClass("DN"),approverBox.find("[name=apr_empty]").parent().siblings().removeClass("DNI")}ZPeopleComponents.select(approverBox.find(ele+" [name=approver_type]").last()).setValue(row.apprType);var id=ZPA_Approvers.getUniqueApproverValue(row);if("SELECTED_USER"==row.apprType){var agtData=[],avatar=ZPeople.getUserDetailsById(row.erecno).avatar;agtData.push({id:row.erecno,value:ZPeople.decodeTxt(row.apprTypeDisplayName),image:avatar});var apprValue=ZPeopleComponents.select(ZPA_Common.getMainContainer().find(ele+" [name=approver_value]").last());apprValue.addOption(agtData),apprValue.setValue(agtData)}else ZPeopleComponents.select(approverBox.find(ele+" [name=approver_value]").last()).setValue(id)})},getUniqueApproverValue(data){var appr_value="";switch(data.apprType){case"SELECTED_USER":appr_value=data.erecno;break;case"FORM_FIELD":appr_value=data.fcid;break;case"DEPARTMENT_HEAD":case"DEPARTMENT_MEMBERS":appr_value=data.deptid;break;case"SELECTED_ROLE":appr_value=data.roleid;break;case"SELECTED_GROUP":appr_value=data.groupid;break;case"REPORTING_TO":appr_value=data.noOfReportingToLevels;break;case ApproverConstants.Type.PROJECT:appr_value=data.optionType}return appr_value}},ZPA_Popup={keyPairIdJson:{sysConfList:{id:"sysConfList",dispVal:ZPI18N.getString("zp.systemopt"),Class:"tab-pane fade active in",parentClass:"active"},system:{id:"system",dispVal:ZPI18N.getString("zp.users"),sType:"1"},roles:{id:"roles",dispVal:ZPI18N.getString("zp.roles")},departments:{id:"departments",dispVal:ZPI18N.getString("zp.departments"),sType:"2"},groups:{id:"groups",dispVal:ZPI18N.getString("zp.groups")},locations:{id:"locations",dispVal:ZPI18N.getString("zp.locations")},formfields:{id:"formfields",dispVal:ZPI18N.getString("zp.formfields")}},mailAddrPopOver:"",getFormFieldsHtml:function(){var searchBox='<div class="dvPopsearch"><input id="searchInp" class="form-control" type="search" placeholder="'+ZPI18N.getString("zp.search")+'"></div>';return $('<div id="fieldListTemplate"><div name="popOverDiv" class="tabvertical"><div name="groupName" class="lfttab"><ul id="dvRecipient" class="nav nav-pills nav-stacked PT10 PB10 ulRecipient" role="tablist" id="dvRecipient"><li><a data-toggle="tab" elName="mailAdd" role="tab"  href="#" aria-expanded="false"></a></li></ul></div>'+('<div class="rhtlstsrl"><div id="contentDiv" class="tab-content ulItemrec  PT10 PB10"><div name="fieldsParentDiv" srcTxt="true" role="tabpanel" class="tab-pane fade" id="">'+searchBox+'<div class="col-md-12"> <ul name="list-group" class="rhttablst"> <li name="list-group-item"> <a name="optDiv" data-toggle="tooltip" data-placement="bottom" data-container="body" ><span name="mOpt" data-toggle="tooltip" data-placement="bottom" data-container="body" ></span></a></li></ul></div></div></div></div>')+"</div></div>")},constructMenubox:function(data,keyPairIdJson,id){var mboxClone=ZPA_Popup.getFormFieldsHtml().clone();mboxClone.find("#contentDiv").addClass("ulItemrec"),mboxClone.find("[name=list-group]").attr("class","list-group ulRecipient");var tabLi=mboxClone.find("#dvRecipient li:first").clone(),contDiv=mboxClone.find("#contentDiv :first").clone(),contLi=mboxClone.find("[name=list-group-item]").clone();return mboxClone.find("#dvRecipient").empty(),CustomAction.USERSEARCHDATAID={},CustomAction.USERSEARCHDATA={},mboxClone.find("#contentDiv").empty(),$.each(keyPairIdJson,function(key,obj){var getData=data[key];if(!$.isEmptyObject(getData)){var getParentClass=void 0!==obj.parentClass?obj.parentClass:"",cloneTagLi=tabLi.clone();cloneTagLi.find("a").attr({href:"#"+obj.id,"data-original-title":obj.dispVal}).text(obj.dispVal),cloneTagLi.attr("class",getParentClass),mboxClone.find("#dvRecipient").append(cloneTagLi);var cloneContDiv=contDiv.clone();cloneContDiv.find("[name=list-group]").empty();var sType=obj.sType,isStype=!1,count=0;ZPUtil.Validation.isEmpty(sType)||(CustomAction.USERSEARCHDATAID[sType]=[],CustomAction.USERSEARCHDATA[sType]=[],isStype=!0),$(cloneContDiv).attr({id:obj.id,class:obj.Class,sType:sType});var listGroup=$(cloneContDiv).find("[name=list-group]");$.each(getData,function(valId,value){var li=contLi.clone();li.find("[name=mOpt]").attr({val:valId,"data-original-title":ZPeople.decodeTxt(value)}).text(ZPeople.decodeTxt(value)),isStype&&count<10?(listGroup.append(li),CustomAction.USERSEARCHDATAID[sType].push(valId),CustomAction.USERSEARCHDATA[sType].push(li),count++):isStype||listGroup.append(li)});var selTag=$(id).parent().find("[ptagid="+obj.id+"]").find("[ctagid]");if(isStype){CustomAction.USERSEARCHDATA[sType];$.each(selTag,function(i,value){var val=$(value).attr("ctagid"),text=$(value).text();if(!CustomAction.USERSEARCHDATAID[sType].includes(val)){var li=contLi.clone();li.find("[name=mOpt]").attr({val:val,"data-original-title":ZPeople.decodeTxt(text)}).text(ZPeople.decodeTxt(text)),li.addClass("sel"),listGroup.append(li),CustomAction.USERSEARCHDATAID[sType].push(val),CustomAction.USERSEARCHDATA[sType].push(li)}}),$(id).parent().data("USERSEARCHDATAID",CustomAction.USERSEARCHDATAID),$(id).parent().data("USERSEARCHDATA",CustomAction.USERSEARCHDATA)}mboxClone.find("#contentDiv").append(cloneContDiv)}}),ZPA_Popup.mailAddrPopOver=$(mboxClone),$(mboxClone)},selectMalertAddr:function(objId,getThis){var pageDiv=$("body"),getObjHtml=(pageDiv.find("#"+objId),$(getThis).getContent());getObjHtml.find("[name=notifyAll]").prop("checked",!1),getObjHtml.find("[name=list-group-item]").removeClass("sel"),void 0!==pageDiv.find("#"+objId).getTagConfig().NotifyAll?getObjHtml.find("[name=notifyAll]").trigger("click"):ZPA_Popup.selectedTagPopover(objId,getThis)},selectedTagPopover:function(objId,getThis){var inputBoxId=$("body").find("#"+objId),inputTagConfObj=$(inputBoxId).getTagConfig(),getObjHtml=$(getThis).getContent();getObjHtml.find("[name=list-group-item]").removeClass("sel"),$.each(inputTagConfObj,function(key,childTagObjArray){"NotifyAll"==key?(getObjHtml.find("[name=notifyAll]").prop("checked",!1),getObjHtml.find("[name=notifyAll]").trigger("click")):$.each(childTagObjArray,function(ind,valId){var getSelectedOpt=getObjHtml.find("[val='"+valId+"']");$(getSelectedOpt).closest("li").addClass("sel")})})},initiatePopOver:function(data){var keyPairIdJson,pageDiv=$("body");keyPairIdJson=JSON.parse(JSON.stringify(ZPA_Popup.keyPairIdJson));var employeeObjs={},userList=ZPeople.getUserListData();$.each(userList,function(cnt,empObj){"false"===empObj.isNonUser&&"false"===empObj.isMobileUser&&(employeeObjs[empObj.usererec]=empObj.name+" "+empObj.empid)}),data.system=employeeObjs;var popOverObjs=pageDiv.find("[targetid]");$.each(popOverObjs,function(i,obj){var id=$(obj).attr("targetid"),addrPopOverHtml=ZPA_Popup.constructMenubox(data,keyPairIdJson,obj),footerDiv='<div class="popover-footer"><div class="inlRadio" nottitle="Notify All" data-toggle="tooltip" data-original-title="" title=""><label class="checkbox"><input name="notifyAll" type="checkbox"><span>'+ZPI18N.getString("zp.toaddrnotifyall")+"</span></label></div></div>",popOverContent=$(addrPopOverHtml).clone();popOverContent="toInputTag"===id?$(popOverContent).append(footerDiv):popOverContent,void 0===$(obj).data("bs.popover")?$(obj).constructPopover({callback:ZPA_Popup.msgTempAddrFn,html:popOverContent,targetId:$(obj).attr("targetid"),keyname:"name=list-group-item",multi:!0}):$(obj).setContent(popOverContent)}),$(popOverObjs).data("data",!0)},msgTempAddrFn:function(getLiObj,targetId,content){var pageDiv=$("body"),idObj="",getThis=$(getLiObj).find("[name=mOpt]"),parentObjId=$(getLiObj).parents("[name='fieldsParentDiv']").attr("id"),parentTagObj=$(content).find('[href="#'+parentObjId+'"]'),isSelect=(idObj=pageDiv.find("#"+targetId+":visible"),-1!==$(getLiObj).attr("class").indexOf("sel"));$(getThis).parents("#fieldListTemplate");if(isSelect)if("msubject"===targetId){var text="${"+$(getThis).text()+"}",val=0===$(idObj).val().length?text:$(idObj).val()+","+text;idObj.val(val)}else{var parentTagJson={id:$(parentTagObj).attr("href").replace("#",""),value:$(parentTagObj).text(),attr:$(parentTagObj).attr("attr")},childTagJson={id:$(getThis).attr("val"),value:$(getThis).text(),attr:$(getThis).attr("val")};pageDiv.find("#"+targetId).inputTag(parentTagJson,[childTagJson],ZPA_Popup.newConstant),ZPA_Popup.newConstant(pageDiv.find("#"+targetId))}else pageDiv.find("#"+targetId).removeTag($(getThis).attr("val")),ZPA_Popup.newConstant(pageDiv.find("#"+targetId))},newConstant:function(getThis){var $this=$(getThis),getConfig=$this.getTagConfig();$.isEmptyObject(getConfig)&&!$($this).find("#constantValDiv").is(":visible")?($this.removeAllTag(),$this.find("[name='addNewTag']").addClass("hide")):$.isEmptyObject(getConfig)||$this.find("[name='addNewTag']").removeClass("hide"),void 0!==getConfig.NotifyAll&&$this.find("[name='addNewTag']").addClass("hide")}},ZPA_Criteria={FC_ITEMJSON:{},CRITERIA_ROW:'<div class="zpl_idiv" name="crt_row"><div class="zpl_rwfld zpl_rwnum"><span name="row_num"></span></div><div class="zpl_rwfld"><input type="text" name="operator" class="ztextbox"></div><div class="zpl_rwfld"><input type="text" class="ztextbox" name="ruleFields" onClick="ZPA_Criteria.popFields(this)" readonly="" value='+ZPI18N.getString("zp.choosefield")+'></div><div class="zpl_rwfld" name="condition_div"><input name="condition" type="text" class="ztextbox" value=""></div><div style="width:100%" name="value_div"><div class="zpl_rwfld"><input type="text" name="crt_value" class="ztextbox" value=""></div></div><div style="width:100%" class="DN" name="to_value_div"><div class="zpl_rwfld"><input type="text" name="to_crt_value" class="ztextbox" value=""></div></div><div class="zpl_rwfld zpl_rwicn" name="del_button" onClick="ZPA_Criteria.removeLevel(this)"><i class="PI_delete"></i></div></div>',OPERATORS:[{value:"AND",label:ZPI18N.getString("zp.captialand")},{value:"OR",label:ZPI18N.getString("zp.captialor")}],initiate(formId,container){container=void 0!=container?container:ZPA_Common.getMainContainer(),ZPA_Criteria.addLevel(container),ZPA_Criteria.formId=formId,ZPA_Criteria.FORMFIELDS_JSON={},container.find("#add_criteria").children().off().on("click",function(){ZPA_Criteria.addLevel(container)}),ZPA_Common.getPageMode()!==ZP_Automation_Mode.CUSTOMACTION&&ZPA_Common.getPageMode()!==ZP_Automation_Mode.BLUEPRINT||ZPA_Criteria.configure(),container.on("input",'[name="crt_value"]',function(){$(this).parent().attr("title",$(this).val())})},loadDefault(formId,container){(container=void 0!=container?container:ZPA_Common.getMainContainer()).find("#add_criteria").siblings().remove(),container.find("[name=crt_empty]").siblings("[name=crt_pattern], [name=crt_structure]").addClass("DN"),container.find("[name=crt_empty]").removeClass("DN").parent().siblings().addClass("DNI"),ZPA_Criteria.initiate(formId,container)},configure(getThis){var container=void 0==getThis?ZPA_Common.getMainContainer():$(getThis).parents(".zpl_act");container.find("[name=crt_empty]").addClass("DN").siblings("[name=crt_structure]").removeClass("DN"),container.find("[name=crt_empty]").parent().siblings().removeClass("DNI")},open(getThis){var container=$(getThis).parent(".zpl_crdcnt");container.find("#emptPage").remove(),container.children().removeClass("DN")},isAllowed:function(crtBody){return!!crtBody.find("#verifyPattern").hasClass("DNI")||(ZPeople.Message.warning(ZPI18N.getString("zp.criteria.actionnotallowed")),!1)},addLevel(body){if(body=void 0!=body?body:ZPA_Common.getMainContainer().find("[name=criteria_body]"),ZPA_Criteria.isAllowed(body)){var addButton=body.find("#add_criteria"),level=void 0==addButton.attr("level")?100*ZPA_Common.getMainContainer().find("[name=criteria_body").length:parseInt(addButton.attr("level"))+1;addButton.attr("level",level),addButton.before(ZPA_Criteria.CRITERIA_ROW);var operator_inp=body.find("[name=operator]").last(),rulefield="rulefield_"+level,ruleforfield="ruleforfield_"+level;body.find("[name=ruleFields]").last().attr("id",rulefield),body.find("[name=ruleFields]").last().attr("pop",ruleforfield),body.find("[name=ruleForFields]").append("<div id="+ruleforfield+"></div>"),ZPA_Criteria.resetRow(body),ZPeopleComponents.select(operator_inp,{options:ZPA_Criteria.OPERATORS,dataMapping:{label:"label",value:"value"},change:ZPA_Criteria.Pattern.onChange}),ZPA_Criteria.Pattern.setPattern(body,"add")}},resetRow(container){var rows=container.find("[name=crt_row]");$.each(rows,function(index,row){var comparator=$(row).find("input")[0];0==index&&($(comparator).addClass("DN"),$(comparator).siblings().addClass("DN")),$($(row).find("[name=row_num]")[0]).text(index+1)})},replaceRuleFormat:ruleFormat=>ruleFormat=(ruleFormat=ruleFormat.replace(/AND/g,"&")).replace(/OR/g,"|"),replaceRuleFormatToString:ruleFormat=>ruleFormat=(ruleFormat=ruleFormat.replace(/&/g," AND ")).replace(/\|/g," OR "),populatePattern(format,container){var patterDiv=(container=void 0!=container?container:ZPA_Common.getMainContainer()).find("[name=crt_pattern]");"1"==format||"(1)"==format||void 0==format?patterDiv.addClass("DN"):patterDiv.removeClass("DN"),void 0!=format?container.find("#criteriaPattern").val(ZPA_Criteria.replaceRuleFormatToString(format)):container.find("#criteriaPattern").val(1)},removeLevel(delButton){var row=$(delButton).parent(),criteria_body=row.parent("[name=criteria_body]").parents().eq(2);ZPA_Criteria.isAllowed(criteria_body)&&(1==row.siblings().length&&(ZPA_Common.getPageMode()!==ZP_Automation_Mode.BLUEPRINT&&ZPA_Common.getPageMode()!==ZP_Automation_Mode.CUSTOMACTION&&(criteria_body.find("[name=crt_empty]").removeClass("DN").siblings().addClass("DN"),criteria_body.find("[name=crt_empty]").parent().siblings().addClass("DNI")),ZPA_Criteria.addLevel(criteria_body)),row.remove(),ZPA_Criteria.resetRow(criteria_body),ZPA_Criteria.Pattern.setPattern(criteria_body,"remove",delButton))},popFields(getThis){var ruleField=$(getThis).attr("id"),ruleForField=$(getThis).attr("pop");if(void 0==ZPA_Criteria.FORMFIELDS_JSON||void 0==ZPA_Criteria.FORMFIELDS_JSON.formNameJArray){var mode=ZPA_Common.getPageMode()===ZP_Automation_Mode.CUSTOMACTION?ZP_Automation_Mode.WORKFLOW:ZPA_Common.getPageMode(),params={formId:ZPA_Criteria.formId,mode:mode,method:"getCriteriaFcDtls",conreqcsr:csrfToken};$.ajax({url:"/criteriaFcDtls.zp",type:"POST",data:params,async:!1,success:function(data){ZPA_Criteria.FORMFIELDS_JSON=data,ZPeopleComponents.isComponent("#"+ruleForField)&&ZPeopleComponents.tabbedlistboxpopup("#"+ruleForField).destroy(),ZPA_Criteria.TabPanel.openTabPanel(ruleForField,ruleField,ZPA_Common.getPageMode())}})}else ZPeopleComponents.isComponent("#"+ruleForField)&&ZPeopleComponents.tabbedlistboxpopup("#"+ruleForField).destroy(),ZPA_Criteria.TabPanel.openTabPanel(ruleForField,ruleField,ZPA_Common.getPageMode())},changeOperator(obj,data){var opType=parseInt(data.value),inputBx=$(obj.target).parent().next().find("input"),wfFcType=obj.detail.options.workFlowFcType;void 0!=wfFcType&&""!=wfFcType||(wfFcType=JSON.parse($(obj.target).parent().prev().children("[name=ruleFields]").attr("selecteddata")).workFlowFcType),ZPA_Criteria.setOperatorValue(opType,inputBx,wfFcType)},setOperatorValue(opType,inputBx,fcType,data){inputBx.removeClass("DN");var inputParent=inputBx.parent(),toDiv=inputParent.parent().next(),toInputBx=toDiv.children().children();(toDiv.addClass("DN"),inputBx.siblings().remove(),toInputBx.siblings().remove(),inputBx.removeAttr("disabled"),inputBx.val(""),inputBx.data("selectedValue",""),inputBx.parent().attr("class","zpl_rwfld"),ZPeopleComponents.isComponent(inputParent))&&((valueDiv=inputParent.parent()).children().remove(),valueDiv.append('<div class="zpl_rwfld"><input type="text" name="crt_value" class="ztextbox" value=""></div>'),inputBx=(inputParent=valueDiv.children()).children());var valueDiv,toInputParent=toInputBx.parent();ZPeopleComponents.isComponent(toInputParent)&&((valueDiv=toInputParent.parent()).children().remove(),valueDiv.append('<div class="zpl_rwfld"><input type="text" name="crt_value" class="ztextbox" value=""></div>'));switch(ZPA_Common.removeErrorDiv(inputBx.parents("[name=criteria_body]")),opType){case ZPA_Criteria.Operators.EMPTY.value:case ZPA_Criteria.Operators.NOT_EMPTY.value:case ZPA_Criteria.Operators.YESTERDAY.value:case ZPA_Criteria.Operators.TODAY.value:case ZPA_Criteria.Operators.TOMORROW.value:case ZPA_Criteria.Operators.TRUE.value:case ZPA_Criteria.Operators.FALSE.value:case ZPA_Criteria.Operators.APPROVAL_PENDING.value:case ZPA_Criteria.Operators.BOOKABLE.value:case ZPA_Criteria.Operators.EXPIRED.value:case ZPA_Criteria.Operators.REJECTED.value:case ZPA_Criteria.Operators.USED.value:inputBx.addClass("DN");break;case ZPA_Criteria.Operators.BETWEEN.value:if(fcType==ZPA_Criteria.FcType.HOURS_IN_MINUTES){toDiv.removeClass("DN");var time=void 0!=data&&""!=data.fromValue&&void 0!=data.fromValue?data.fromValue:"00:00";ZPA_Criteria.setTimeField(inputBx,time),time=void 0!=data&&""!=data.toValue&&void 0!=data.toValue?data.toValue:"00:00",ZPA_Criteria.setTimeField(toInputBx,time)}else inputBx.attr("disabled",!0),inputBx.attr("id","dateRangeInput"),inputParent.addClass("ztextbox--group zh-alignright zpl_inpticfild"),inputParent.append('<i class="ztextbox__icon PI_date"></i>'),inputParent.attr("id","dateRangeDiv"),inputParent.parent().append('<div id="dateRangePicker" data-for-element="#dateRangeInput"></div>'),void 0!=data&&void 0!=data.fromValue&&void 0!=data.toValue?(inputBx.attr("fromValue",data.fromValue),inputBx.attr("toValue",data.toValue),ZPA_Criteria.setDateRangePicker(inputParent.parent(),data.fromValue,data.toValue)):ZPA_Criteria.setDateRangePicker(inputParent.parent());break;case ZPA_Criteria.Operators.CONTAINS.value:case ZPA_Criteria.Operators.NOT_CONTAINS.value:case ZPA_Criteria.Operators.IN.value:case ZPA_Criteria.Operators.NOT_IN.value:case ZPA_Criteria.Operators.IS.value:case ZPA_Criteria.Operators.IS_NOT.value:fcType!=ZPA_Criteria.FcType.TEXT&&fcType!=ZPA_Criteria.FcType.TEXT_AREA&&fcType!=ZPA_Criteria.FcType.EMAIL_ADDRESS&&fcType!=ZPA_Criteria.FcType.PHONE_NUMBER&&(inputBx.attr("disabled",!0),inputBx.parent().addClass("ztextbox--group zh-alignright zpl_inpticfild").append('<i id="icon_PickList" class="ztextbox__icon PI_addlist" onclick="ZPA_Criteria.fetchRuleValueList(this)"></i>'));break;case ZPA_Criteria.Operators.EQUAL.value:case ZPA_Criteria.Operators.NOT_EQUAL.value:case ZPA_Criteria.Operators.GREATER_THAN.value:case ZPA_Criteria.Operators.LESS_THAN.value:case ZPA_Criteria.Operators.GREATER_EQUAL.value:case ZPA_Criteria.Operators.LESS_EQUAL.value:if(fcType===ZPA_Criteria.FcType.HOURS_IN_SECONDS||fcType===ZPA_Criteria.FcType.HOURS_IN_MINUTES){time=void 0!=data&&""!=data.crtVal&&void 0!=data.crtVal?data.crtVal:"00:00";ZPA_Criteria.setTimeField(inputBx,time)}}},setTimeField:function(inputBx,time){var attr={format:"HH:mm",spinButtons:"none",clearButton:"none",placeholder:"01:00",pickerOptions:{appendTo:inputBx},dropdownList:{appendTo:inputBx}},inputParent=inputBx.parent();ZPeopleComponents.timefield(inputParent,attr),ZPeopleComponents.timefield(inputParent).setValue(time)},setDateRangePicker:function(inputParent,fromValue,toValue){var pageContainer=void 0!=inputParent?inputParent:ZPA_Common.getMainContainer();ZPeopleComponents.daterangepicker(pageContainer.find("#dateRangePicker"),{forElement:"#dateRangeDiv",appendTo:pageContainer,change:(event,ui)=>{pageContainer.find("#dateRangeInput").val(ui.fromValueString+" - "+ui.toValueString),pageContainer.find("#dateRangeInput").attr("fromValue",ui.fromValueString),pageContainer.find("#dateRangeInput").attr("toValue",ui.toValueString)},format:dateFmt,singleDateSelect:!0,position:"bottom"}),void 0!=fromValue&&void 0!=toValue&&(ZPeopleComponents.daterangepicker(pageContainer.find("#dateRangePicker")).setFromValue(fromValue),ZPeopleComponents.daterangepicker(pageContainer.find("#dateRangePicker")).setToValue(toValue));let picker=pageContainer.find("#dateRangePicker");pageContainer.find("#dateRangeDiv").off().on("click",function(){picker.is(":visible")?ZPeopleComponents.daterangepicker(picker).close():ZPeopleComponents.daterangepicker(picker).open()})},fetchRuleValueList:function(getThis){var inputObj=$(getThis).parents("[name=crt_row]").find("[name=ruleFields]"),fcAttributes=JSON.parse(inputObj.attr("selectedData")),uitype=void 0==fcAttributes.colType?void 0!=fcAttributes.parentFcType?parseInt(fcAttributes.parentFcType):parseInt(fcAttributes.fcType):parseInt(fcAttributes.colType),wfType=parseInt(fcAttributes.workFlowFcType),selectedLookupType=void 0==fcAttributes.fcId?fcAttributes.formComponentID:fcAttributes.fcId;if([ZPA_Criteria.FcType.SYSTEMCRTFIELDTYPE,ZPA_Criteria.FcType.LOOKUP,ZPA_Criteria.FcType.DATE,ZPA_Criteria.FcType.DATE_TIME,ZPA_Criteria.FcType.PICKLIST,ZPA_Criteria.FcType.COUNTRY,ZPA_Criteria.FcType.RULE_APPROVALSTATUS_TYPE,ZPA_Criteria.FcType.RULE_PROJECTROLE_TYPE].includes(wfType)){var params={selectedLookupType:selectedLookupType,fcType:uitype,method:"getSystemRuleLookupList",crtVal:inputObj.attr("valueid"),mode:"systemRuleLookupList",conreqcsr:csrfToken},criPickListid="cri_PickList_"+selectedLookupType;if(void 0==$(getThis).attr("isclicked")){var dropDownList=$(getThis).attr("isclicked","true").after("<div id="+criPickListid+"></div>").next(),selectedValue=void 0!=$(getThis).siblings("input").data("selectedValue")?$(getThis).siblings("input").data("selectedValue").split(","):"";$.post("/getSystemRuleLookup.zp",params,function(data){ZPeopleComponents.dropdownlist(dropDownList,{isTextHTMLEncoded:!0,value:selectedValue,items:data.lookupDetailsList,dataMapping:{text:"VALUE",label:"VALUE",value:"ID"},className:"zdropdownlist--custom",showSearchField:!0,focusItemOnItemMouseover:!0,sort:!0,sortBy:"value",search:{by:["VALUE"],criteria:"contains",highlightKeyword:!0},showSearchField:!0,displayType:"callout",width:300,height:260,searchFieldOptions:{placeholder:"Search",clearButton:!0},margin:{top:7},change:ZPA_Criteria.lkupListCallback,multiple:!0,positionAlterable:!0,contentType:"text"}),ZPA_Criteria.openInput=$(getThis).prev(),ZPA_Criteria.ddList=dropDownList,ZPeopleComponents.dropdownlist(dropDownList).open({forElement:getThis})}),$(getThis).off().on("click",function(){dropDownList.is(":visible")?ZPeopleComponents.dropdownlist(dropDownList).close():(ZPA_Criteria.openInput=$(getThis).prev(),ZPeopleComponents.dropdownlist(dropDownList).open({forElement:getThis}))})}}},getSystemRuleLookup(selectedLookupType,uitype,crtValId,callback){let response;var params={selectedLookupType:selectedLookupType,fcType:uitype,method:"getSystemRuleLookupList",crtVal:crtValId,mode:"systemRuleLookupList",conreqcsr:csrfToken};return $.ajax({context:this,type:"POST",async:!1,url:"/getSystemRuleLookup.zp",data:params,success:function(data){response=data}}),response},lkupListCallback(event){var itemData=event.detail.value;ZPA_Criteria.appendSelectedValue(ZPA_Criteria.openInput,itemData)},appendSelectedValue(inpDiv,itemData){var selectedValue="",selectedValueId="";$.each(itemData,function(index,row){void 0!==row.VALUE&&void 0!==row.ID&&(selectedValue=""==selectedValue?row.VALUE:selectedValue+","+row.VALUE,selectedValueId=""==selectedValueId?row.ID:selectedValueId+","+row.ID)}),inpDiv.val(decodeHTML(selectedValue)),inpDiv.parent().attr("title",decodeHTML(selectedValue)),inpDiv.data("selectedValue",selectedValueId)},getCriteriaConfigJson(container,skipValidation){var tempJson={},crtJsonObj=[],isInvalidCrt=!1,pageId=(container=void 0!=container?container:ZPA_Common.getMainContainer()).find("[name=criteria_body]");return ZPA_Common.removeErrorDiv(pageId),container.find("[name=crt_empty]").is(":visible")?crtJsonObj:($(pageId.children(":not(:last)")).each(function(index,row){0!=index&&(tempJson.conjunctiveCondn=ZPeopleComponents.select($(row).find("[name=operator]")).value);var fcAttributes=$(row).find("[name=ruleFields]").attr("selecteddata"),condition=ZPeopleComponents.select($(row).find("[name=condition]")).value,crtVal="";if(void 0!==fcAttributes){fcAttributes=JSON.parse(fcAttributes),crtVal=$(row).find("[name=crt_value]").val(),fcAttributes.workFlowFcType!==ZPA_Criteria.FcType.HOURS_IN_SECONDS&&fcAttributes.workFlowFcType!==ZPA_Criteria.FcType.HOURS_IN_MINUTES||(crtVal=ZPeopleComponents.timefield($(row).find("[name=crt_value]").parent()).getValue().dateString);var crtValId=$(row).find("[name=crt_value]").data("selectedValue"),fcType=void 0!=fcAttributes.parentFcType?parseInt(fcAttributes.parentFcType):void 0!=fcAttributes.colType?fcAttributes.colType:fcAttributes.fcType;if(tempJson.formComponentID=void 0!=fcAttributes.fcId?fcAttributes.fcId:fcAttributes.formComponentID,tempJson.Operator=condition,tempJson.crtVal=crtVal,tempJson.crtValId=void 0!=crtValId?crtValId:"",tempJson.fcType=fcType,void 0!==fcAttributes.lookupFcId&&(tempJson.lookupFcId=fcAttributes.lookupFcId),condition==ZPA_Criteria.Operators.BETWEEN.value&&(tempJson.formComponentID==ZPA_Criteria.FcType.RULE_OTHER_INTERVAL_TYPE?(tempJson.fromValue=crtVal,tempJson.toValue=ZPeopleComponents.timefield($(row).find("[name=to_crt_value]").parent()).getValue().dateString,tempJson.crtVal="",tempJson.crtValId="",skipValidation=!0):(tempJson.fromValue=$(row).find("#dateRangeInput").attr("fromValue"),tempJson.toValue=$(row).find("#dateRangeInput").attr("toValue"))),fcType==ZPA_Criteria.FcType.RULE_CUMULATIVE_COMP_TYPE?(tempJson.ruleType=1,tempJson.workFlowFcType=fcAttributes.workFlowFcType):fcType==ZPA_Criteria.FcType.RULE_OTHER_FIELD_TYPE&&(tempJson.ruleType=2,tempJson.workFlowFcType=fcAttributes.workFlowFcType),!ZPA_Criteria.validateSingleRule(Number(fcAttributes.workFlowFcType),Number(tempJson.Operator),tempJson.crtVal,"",tempJson.fromValue,tempJson.toValue)&&!skipValidation)return ZPA_Common.appendErrorDiv($(row).find("[name=crt_value]").parent(),ZPI18N.getString("zp.criteriainvalid"),$(row).find("[name=crt_value]")),void(isInvalidCrt=!0);crtJsonObj.push(tempJson),tempJson={}}}),isInvalidCrt?{isError:!0}:crtJsonObj)},isNumeric:input=>/^-{0,1}\d*\.{0,1}\d+$/.test(input),validateSingleRule(fcType,operator,value,dateFormat,fromValue,toValue){if(fcType===ZPA_Criteria.FcType.TEXT||fcType===ZPA_Criteria.FcType.TEXT_AREA||fcType===ZPA_Criteria.FcType.EMAIL_ADDRESS||fcType===ZPA_Criteria.FcType.PHONE_NUMBER){var stringOpList=[];return stringOpList.push(ZPA_Criteria.Operators.CONTAINS.value),stringOpList.push(ZPA_Criteria.Operators.NOT_CONTAINS.value),stringOpList.push(ZPA_Criteria.Operators.STARTS_WITH.value),stringOpList.push(ZPA_Criteria.Operators.ENDS_WITH.value),stringOpList.push(ZPA_Criteria.Operators.EQUAL.value),stringOpList.push(ZPA_Criteria.Operators.NOT_EQUAL.value),stringOpList.push(ZPA_Criteria.Operators.EMPTY.value),stringOpList.push(ZPA_Criteria.Operators.NOT_EMPTY.value),ZPA_Criteria.returnRuleValidation(stringOpList,operator,value)}if(fcType===ZPA_Criteria.FcType.NUMBER||fcType===ZPA_Criteria.FcType.HOURS_IN_SECONDS||fcType===ZPA_Criteria.FcType.HOURS_IN_MINUTES||fcType===ZPA_Criteria.FcType.CURRENCY||fcType===ZPA_Criteria.FcType.DECIMAL||fcType===ZPA_Criteria.FcType.RULE_CUMULATIVE_COMP_TYPE){var numberOptList=[];if(numberOptList.push(ZPA_Criteria.Operators.GREATER_EQUAL.value),numberOptList.push(ZPA_Criteria.Operators.GREATER_THAN.value),numberOptList.push(ZPA_Criteria.Operators.LESS_EQUAL.value),numberOptList.push(ZPA_Criteria.Operators.LESS_THAN.value),numberOptList.push(ZPA_Criteria.Operators.EQUAL.value),numberOptList.push(ZPA_Criteria.Operators.NOT_EQUAL.value),numberOptList.push(ZPA_Criteria.Operators.BETWEEN.value),operator===ZPA_Criteria.Operators.BETWEEN.value)return ZPA_Criteria.returnRuleValidation(numberOptList,operator,value);if(fcType==ZPA_Criteria.FcType.HOURS_IN_SECONDS||fcType===ZPA_Criteria.FcType.HOURS_IN_MINUTES||0===operator||3===operator)return!0;if(ZPA_Criteria.isNumeric(value))return ZPA_Criteria.returnRuleValidation(numberOptList,operator,value)}else if(fcType===ZPA_Criteria.FcType.DATE||fcType===ZPA_Criteria.FcType.DATE_TIME){var dateOptList=[];if(dateOptList.push(ZPA_Criteria.Operators.EQUAL.value),dateOptList.push(ZPA_Criteria.Operators.NOT_EQUAL.value),dateOptList.push(ZPA_Criteria.Operators.IN.value),dateOptList.push(ZPA_Criteria.Operators.NOT_IN.value),dateOptList.push(ZPA_Criteria.Operators.EMPTY.value),dateOptList.push(ZPA_Criteria.Operators.NOT_EMPTY.value),dateOptList.push(ZPA_Criteria.Operators.LESS_EQUAL.value),dateOptList.push(ZPA_Criteria.Operators.GREATER_EQUAL.value),dateOptList.push(ZPA_Criteria.Operators.YESTERDAY.value),dateOptList.push(ZPA_Criteria.Operators.TODAY.value),dateOptList.push(ZPA_Criteria.Operators.TOMORROW.value),(operator===ZPA_Criteria.Operators.LESS_EQUAL.value||operator===ZPA_Criteria.Operators.GREATER_EQUAL.value)&&ZPA_Criteria.isNumeric(value))return ZPA_Criteria.returnRuleValidation(dateOptList,operator,value);if((operator===ZPA_Criteria.Operators.EMPTY.value||operator===ZPA_Criteria.Operators.NOT_EMPTY.value||operator===ZPA_Criteria.Operators.YESTERDAY.value||operator===ZPA_Criteria.Operators.TODAY.value||operator===ZPA_Criteria.Operators.TOMORROW.value)&&""===value)return!0;if((operator===ZPA_Criteria.Operators.IN.value||operator===ZPA_Criteria.Operators.NOT_IN.value)&&""!==value)return!0;if(operator==ZPA_Criteria.Operators.BETWEEN.value&&""!==fromValue&&""!==toValue)return!0}else{if(fcType===ZPA_Criteria.FcType.LOOKUP||fcType===ZPA_Criteria.FcType.PICKLIST||fcType===ZPA_Criteria.FcType.RADIO||fcType===ZPA_Criteria.FcType.COUNTRY||fcType===ZPA_Criteria.FcType.GENDER||fcType===ZPA_Criteria.FcType.BLOODGROUP){var dropDownOptList=[];return dropDownOptList.push(ZPA_Criteria.Operators.IN.value),dropDownOptList.push(ZPA_Criteria.Operators.NOT_IN.value),dropDownOptList.push(ZPA_Criteria.Operators.EMPTY.value),dropDownOptList.push(ZPA_Criteria.Operators.NOT_EMPTY.value),operator!==ZPA_Criteria.Operators.IN&&operator!==ZPA_Criteria.Operators.NOT_IN||value.match("^[\\d{n}+,]+$"),ZPA_Criteria.returnRuleValidation(dropDownOptList,operator,value)}var sysCompOptList;if(fcType===ZPA_Criteria.FcType.SYSTEMCRTFIELDTYPE)return(sysCompOptList=[]).push(ZPA_Criteria.Operators.EMPTY.value),sysCompOptList.push(ZPA_Criteria.Operators.NOT_EMPTY.value),sysCompOptList.push(ZPA_Criteria.Operators.IN.value),sysCompOptList.push(ZPA_Criteria.Operators.NOT_IN.value),operator!==ZPA_Criteria.Operators.IN.value&&operator!==ZPA_Criteria.Operators.NOT_IN.value||value.match("^[\\d{n}+,]+$"),ZPA_Criteria.returnRuleValidation(sysCompOptList,operator,value);if(fcType===ZPA_Criteria.FcType.RULE_APPROVALSTATUS_TYPE)return(sysCompOptList=[]).push(ZPA_Criteria.Operators.IN.value),sysCompOptList.push(ZPA_Criteria.Operators.NOT_IN.value),ZPA_Criteria.returnRuleValidation(sysCompOptList,operator,value);if(fcType===ZPA_Criteria.FcType.RULE_PROJECTROLE_TYPE)return(sysCompOptList=[]).push(ZPA_Criteria.Operators.IN.value),ZPA_Criteria.returnRuleValidation(sysCompOptList,operator,value);if(fcType===ZPA_Criteria.FcType.SCRIPT){var formulaOptList=[];if(formulaOptList.push(ZPA_Criteria.Operators.GREATER_EQUAL.value),formulaOptList.push(ZPA_Criteria.Operators.GREATER_THAN.value),formulaOptList.push(ZPA_Criteria.Operators.LESS_EQUAL.value),formulaOptList.push(ZPA_Criteria.Operators.LESS_THAN.value),formulaOptList.push(ZPA_Criteria.Operators.EQUAL.value),formulaOptList.push(ZPA_Criteria.Operators.NOT_EQUAL.value),formulaOptList.push(ZPA_Criteria.Operators.BETWEEN.value),formulaOptList.push(ZPA_Criteria.Operators.YESTERDAY.value),formulaOptList.push(ZPA_Criteria.Operators.TODAY.value),formulaOptList.push(ZPA_Criteria.Operators.TOMORROW.value),formulaOptList.push(ZPA_Criteria.Operators.EMPTY.value),formulaOptList.push(ZPA_Criteria.Operators.NOT_EMPTY.value),(operator===ZPA_Criteria.Operators.LESS_THAN.value||operator===ZPA_Criteria.Operators.GREATER_THAN.value)&&ZPA_Criteria.isNumeric(value))return ZPA_Criteria.returnRuleValidation(formulaOptList,operator,value);if((operator===ZPA_Criteria.Operators.EMPTY||operator===ZPA_Criteria.Operators.NOT_EMPTY||operator===ZPA_Criteria.Operators.YESTERDAY||operator===ZPA_Criteria.Operators.TODAY||operator===ZPA_Criteria.Operators.TOMORROW)&&""===value)return!0;if(ZPA_Criteria.isNumeric(value))return ZPA_Criteria.returnRuleValidation(formulaOptList,operator,value)}else if(fcType===ZPA_Criteria.FcType.CHECK_BOX){var booleanOptList=[];if(booleanOptList.push(ZPA_Criteria.Operators.TRUE.value),booleanOptList.push(ZPA_Criteria.Operators.FALSE.value),-1!==$.inArray(operator,booleanOptList))return!0}else if(fcType===ZPA_Criteria.FcType.CHECK_BOX_UNIT){if((optList=[]).push(0),optList.push(3),-1!==$.inArray(operator,optList))return!0}else if(fcType===ZPA_Criteria.FcType.CHECK_BOX_COMPENSATORY_STATUS){var optList;if((optList=[]).push(111),optList.push(112),optList.push(113),optList.push(114),optList.push(115),-1!==$.inArray(operator,optList))return!0}else if(!(fcType!==ZPA_Criteria.FcType.TIME&&fcType!==ZPA_Criteria.FcType.FILE_UPLOAD&&fcType!==ZPA_Criteria.FcType.IMAGE&&fcType!==ZPA_Criteria.FcType.PAN&&fcType!==ZPA_Criteria.FcType.AADHAR&&fcType!==ZPA_Criteria.FcType.UAN&&fcType!==ZPA_Criteria.FcType.SSN||operator!==ZPA_Criteria.Operators.EMPTY.value&&operator!==ZPA_Criteria.Operators.NOT_EMPTY.value||""!==value))return!0}return!1},returnRuleValidation(list,operator,value){var emptyOperators=[];return emptyOperators.push(ZPA_Criteria.Operators.EMPTY.value),emptyOperators.push(ZPA_Criteria.Operators.NOT_EMPTY.value),emptyOperators.push(ZPA_Criteria.Operators.YESTERDAY.value),emptyOperators.push(ZPA_Criteria.Operators.TODAY.value),emptyOperators.push(ZPA_Criteria.Operators.TOMORROW.value),-1!==$.inArray(operator,list)&&(-1!==$.inArray(operator,emptyOperators)&&""===value||-1===$.inArray(operator,emptyOperators)&&""!==value)},getCriteriaFormat(container){var ruleFormat=1==(container=void 0!=container?container:ZPA_Common.getMainContainer()).find("#criteriaPattern").val().length?"":container.find("#criteriaPattern").val();return ruleFormat=(ruleFormat=ZPA_Criteria.replaceRuleFormat(ruleFormat)).replace(/ +/g,"")},getOperators(fcType,fcId){var operators=[];switch(fcType){case ZPA_Criteria.FcType.TEXT:case ZPA_Criteria.FcType.TEXT_AREA:case ZPA_Criteria.FcType.EMAIL_ADDRESS:case ZPA_Criteria.FcType.PHONE_NUMBER:operators.push(ZPA_Criteria.Operators.EQUAL),operators.push(ZPA_Criteria.Operators.NOT_EQUAL),operators.push(ZPA_Criteria.Operators.EMPTY),operators.push(ZPA_Criteria.Operators.NOT_EMPTY),operators.push(ZPA_Criteria.Operators.STARTS_WITH),operators.push(ZPA_Criteria.Operators.ENDS_WITH),operators.push(ZPA_Criteria.Operators.CONTAINS),operators.push(ZPA_Criteria.Operators.NOT_CONTAINS);break;case ZPA_Criteria.FcType.FILE_UPLOAD:case ZPA_Criteria.FcType.IMAGE:operators.push(ZPA_Criteria.Operators.EMPTY),operators.push(ZPA_Criteria.Operators.NOT_EMPTY);break;case ZPA_Criteria.FcType.BLOODGROUP:case ZPA_Criteria.FcType.GENDER:operators.push(ZPA_Criteria.Operators.EQUAL),operators.push(ZPA_Criteria.Operators.NOT_EQUAL);break;case ZPA_Criteria.FcType.DATE:case ZPA_Criteria.FcType.DATE_TIME:operators.push(ZPA_Criteria.Operators.AFTER),operators.push(ZPA_Criteria.Operators.BEFORE),operators.push(ZPA_Criteria.Operators.EMPTY),operators.push(ZPA_Criteria.Operators.NOT_EMPTY),operators.push(ZPA_Criteria.Operators.IS),operators.push(ZPA_Criteria.Operators.IS_NOT),fcType==ZPA_Criteria.FcType.DATE&&operators.push(ZPA_Criteria.Operators.BETWEEN),operators.push(ZPA_Criteria.Operators.YESTERDAY),operators.push(ZPA_Criteria.Operators.TODAY),operators.push(ZPA_Criteria.Operators.TOMORROW);break;case ZPA_Criteria.FcType.CHECK_BOX:operators.push(ZPA_Criteria.Operators.TRUE),operators.push(ZPA_Criteria.Operators.FALSE);break;case ZPA_Criteria.FcType.CHECK_BOX_UNIT:operators.push(ZPA_Criteria.Operators.DAY),operators.push(ZPA_Criteria.Operators.HOUR);break;case ZPA_Criteria.FcType.CHECK_BOX_COMPENSATORY_STATUS:operators.push(ZPA_Criteria.Operators.APPROVAL_PENDING),operators.push(ZPA_Criteria.Operators.BOOKABLE),operators.push(ZPA_Criteria.Operators.EXPIRED),operators.push(ZPA_Criteria.Operators.REJECTED),operators.push(ZPA_Criteria.Operators.USED);break;case ZPA_Criteria.FcType.NUMBER:case ZPA_Criteria.FcType.CURRENCY:case ZPA_Criteria.FcType.SCRIPT:case ZPA_Criteria.FcType.HOURS_IN_SECONDS:case ZPA_Criteria.FcType.HOURS_IN_MINUTES:case ZPA_Criteria.FcType.DECIMAL:case ZPA_Criteria.FcType.RULE_CUMULATIVE_COMP_TYPE:fcId==ZPA_Criteria.FcType.RULE_OTHER_INTERVAL_TYPE?operators.push(ZPA_Criteria.Operators.BETWEEN):(operators.push(ZPA_Criteria.Operators.EQUAL),operators.push(ZPA_Criteria.Operators.NOT_EQUAL),operators.push(ZPA_Criteria.Operators.LESS_THAN),operators.push(ZPA_Criteria.Operators.GREATER_THAN),operators.push(ZPA_Criteria.Operators.LESS_EQUAL),operators.push(ZPA_Criteria.Operators.GREATER_EQUAL));break;case ZPA_Criteria.FcType.RULE_APPROVALSTATUS_TYPE:operators.push(ZPA_Criteria.Operators.IN),operators.push(ZPA_Criteria.Operators.NOT_IN);break;case ZPA_Criteria.FcType.RULE_PROJECTROLE_TYPE:operators.push(ZPA_Criteria.Operators.IN);break;case ZPA_Criteria.FcType.PICKLIST:case ZPA_Criteria.FcType.LOOKUP:case ZPA_Criteria.FcType.COUNTRY:operators.push(ZPA_Criteria.Operators.IN),operators.push(ZPA_Criteria.Operators.NOT_IN),operators.push(ZPA_Criteria.Operators.EMPTY),operators.push(ZPA_Criteria.Operators.NOT_EMPTY);break;case ZPA_Criteria.FcType.SYSTEMCRTFIELDTYPE:operators.push(ZPA_Criteria.Operators.EMPTY),operators.push(ZPA_Criteria.Operators.NOT_EMPTY),operators.push(ZPA_Criteria.Operators.IN),operators.push(ZPA_Criteria.Operators.NOT_IN);break;case ZPA_Criteria.FcType.TIME:case ZPA_Criteria.FcType.PAN:case ZPA_Criteria.FcType.AADHAR:operators.push(ZPA_Criteria.Operators.EMPTY),operators.push(ZPA_Criteria.Operators.NOT_EMPTY);break;default:operators.push(ZPA_Criteria.Operators.NOT_EQUAL)}return operators},loadCriteria(data,format,container){var criteriaBox=void 0!=container?container:ZPA_Common.getMainContainer().find("[name=criteria_body]"),tableName=ZPA_Common.getTableName("approval",ZPA_Common.getFormId());tableName==urlFormConf.formLabelMap.workfromoffice||tableName==urlFormConf.formLabelMap.visitoratoffice?(ZPA_Common.getMainContainer().find("#apr_criteria").addClass("DNI"),ZPA_Common.getMainContainer().find("#apr_crd_criteria").addClass("DNI")):(ZPA_Common.getMainContainer().find("#apr_criteria").removeClass("DNI"),ZPA_Common.getMainContainer().find("#apr_crd_criteria").removeClass("DNI")),$.each(data,function(index,row){0!=index?ZPA_Criteria.addLevel(criteriaBox):ZPA_Criteria.configure();var field=criteriaBox.find("[name=ruleFields]").last();void 0!=row.parentFcType&&(row.fcType=row.parentFcType,row.workFlowFcType=row.parentFcType),field.attr("selecteddata",JSON.stringify(row)),field.val(row.fielddisplayName),field.attr("title",row.fielddisplayName);var operatorDiv=field.parent().next().find("input");ZPeopleComponents.select(operatorDiv,{options:ZPA_Criteria.getOperators(row.workFlowFcType,row.formComponentID),dataMapping:{label:"label",value:"value"},selectedValue:row.Operator,change:ZPA_Criteria.changeOperator});var value_field=criteriaBox.find("[name=crt_value]").last();if(ZPA_Criteria.setOperatorValue(parseInt(row.Operator),value_field,row.workFlowFcType,row),ZPeopleComponents.select(criteriaBox.find("[name=operator]").last()).setValue(row.conjunctiveCondn),void 0!=row.fromValue&&""!=row.fromValue){var dateRange=row.fromValue+" - "+row.toValue;value_field.val(dateRange),value_field.data("selectedValue",dateRange),value_field.parent().attr("title",dateRange)}else""==row.crtVal?value_field.addClass("DN"):(value_field.val(row.crtVal),value_field.data("selectedValue",row.crtValId),value_field.parent().attr("title",row.crtVal))}),ZPA_Criteria.populatePattern(format,container)}};ZPA_Criteria.Operators={EQUAL:{label:ZPI18N.getString("zp.is"),value:18},NOT_EQUAL:{label:ZPI18N.getString("zp.isnot"),value:19},EMPTY:{label:ZPI18N.getString("zp.isempty"),value:29},NOT_EMPTY:{label:ZPI18N.getString("zp.isnotempty"),value:30},STARTS_WITH:{label:ZPI18N.getString("zp.startswith"),value:24},ENDS_WITH:{label:ZPI18N.getString("zp.endswith"),value:25},CONTAINS:{label:ZPI18N.getString("zp.contains"),value:26},NOT_CONTAINS:{label:ZPI18N.getString("zp.notcontains"),value:27},AFTER:{label:ZPI18N.getString("zp.after"),value:23},BEFORE:{label:ZPI18N.getString("zp.before"),value:22},BETWEEN:{label:ZPI18N.getString("zp.between"),value:58},YESTERDAY:{label:ZPI18N.getString("zp.yesterdaydate"),value:31},TODAY:{label:ZPI18N.getString("zp.todaydate"),value:32},TOMORROW:{label:ZPI18N.getString("zp.tomorrowdate"),value:33},TRUE:{label:ZPI18N.getString("zp.true"),value:49},FALSE:{label:ZPI18N.getString("zp.false"),value:50},DAY:{label:ZPI18N.getString("zp.cday"),value:0},HOUR:{label:ZPI18N.getString("zp.leavetype.hour"),value:3},APPROVAL_PENDING:{label:ZPI18N.getString("zp.approvalpending"),value:111},BOOKABLE:{label:ZPI18N.getString("zp.leave.compensatory.bookable"),value:112},EXPIRED:{label:ZPI18N.getString("zp.expired"),value:113},REJECTED:{label:ZPI18N.getString("zp.rejected"),value:115},USED:{label:ZPI18N.getString("zp.Used"),value:115},LESS_THAN:{label:ZPI18N.getString("zp.lesserthan"),value:20},GREATER_THAN:{label:ZPI18N.getString("zp.greaterthan"),value:21},LESS_EQUAL:{label:ZPI18N.getString("zp.lesserorequalto"),value:22},GREATER_EQUAL:{label:ZPI18N.getString("zp.greaterorequalto"),value:23},IN:{label:ZPI18N.getString("zp.contains"),value:61},NOT_IN:{label:ZPI18N.getString("zp.notcontains"),value:62},IS:{label:ZPI18N.getString("zp.is"),value:61},IS_NOT:{label:ZPI18N.getString("zp.isnot"),value:62}},ZPA_Criteria.FcType={TEXT:1,TEXT_AREA:3,EMAIL_ADDRESS:4,NUMBER:5,CURRENCY:6,SYSTEMCRTFIELDTYPE:1001,RULE_APPROVALSTATUS_TYPE:90,RULE_PROJECTROLE_TYPE:91,PHONE_NUMBER:8,CHECK_BOX:9,DATE:10,PLAIN_TEXT:14,SCRIPT:15,FLOAT:16,FROMTO:17,FILE_UPLOAD:18,DECIMAL:19,IMAGE:20,DATE_TIME:22,PAN:35,AADHAR:36,HOURS_IN_SECONDS:50,HOURS_IN_MINUTES:51,CHECK_BOX_UNIT:52,CHECK_BOX_COMPENSATORY_STATUS:53,TIME:23,LOOKUP:26,PICKLIST:25,BLOODGROUP:27,GENDER:28,COUNTRY:29,RULE_CUMULATIVE_COMP_TYPE:1002,RULE_OTHER_FIELD_TYPE:1003,RULE_OTHER_INTERVAL_TYPE:2049},ZPA_Criteria.TabPanel={openTabPanel(id,forEleId,mode,json_comp){var container=ZPA_Common.getMainContainer(),tabPanelObj={id:id,forEleId:forEleId,appendTo:"#"+ZPA_Common.getPageIdValue(mode),select:ZPA_Criteria.TabPanel.setParamValue};json_comp=void 0!=json_comp?json_comp:ZPA_Criteria.FORMFIELDS_JSON,container.find("#"+id).length>0&&(container.find("#"+id).remove(),container.find("[name=ruleForFields]").append("<div id="+id+"></div>")),ZPA_Criteria.TabPanel.loadFCItemJson(json_comp),ZPA_Util.TabPanel.loadFormFieldTabPanel(json_comp,tabPanelObj),ZPeopleComponents.tabbedlistboxpopup("#"+id).open(),ZPA_Criteria.TabPanel.selectTabbedItem(id,forEleId)},setParamValue(event,eventObj){var forElement=ZPA_Common.getMainContainer().find(eventObj.forElement),selectedData=void 0!=forElement.attr("selecteddata")?JSON.parse(forElement.attr("selecteddata")):{};if((void 0==selectedData.fcId?selectedData.formComponentID:selectedData.fcId)!=event.detail.itemData.fcId){let panelName=$(eventObj.activeTab).closest('[role="tablist"]').find('li[data-selected="true"]').find("span:last")[0].innerText;forElement.val(event.detail.itemData.displayName+" ("+panelName+")"),forElement.attr("title",event.detail.itemData.displayName+" ("+panelName+")"),forElement.closest('[name="crt_row"]').find('[name="crt_value"]').parent().attr("title",""),forElement.attr("selecteddata",JSON.stringify(event.detail.itemData)),ZPA_Criteria.TabPanel.getSelectedFieldDetails(eventObj.forElement,event.detail.itemData),ZPeopleComponents.tabbedlistboxpopup("#"+eventObj.id).close()}},loadFCItemJson:function(json_comp){if(!$.isEmptyObject(json_comp)){var formDtlAry=json_comp.formNameJArray,formCompDtlAry=json_comp.componentJObj;$.each(formDtlAry,function(index,formDtl){$.each(formDtl,function(formKey,formObj){var lookupDisplayName=formObj.lookupDisplayName,componentJAry=formCompDtlAry[formKey];$.each(componentJAry,function(index,secObj){var secNames=Object.keys(secObj);$.each(secNames,function(index,secName){var fcInSecAry=secObj[secName];$.each(fcInSecAry,function(index,fcObj){var itemObj={},pFormId=formKey.split("_")[0];fcObj.parentFormId=pFormId,itemObj.fcJson=fcObj,itemObj.lookupDisplayName=lookupDisplayName,itemObj.formKey=formKey;var fcId=fcObj.fcId;ZPA_Criteria.FC_ITEMJSON[fcId]=itemObj})})})})})}},getSelectedFieldDetails(operatorId,objAttr){$(operatorId).parents("[name=criteria_body]");var operatorDiv=$(operatorId).parent().nextAll("[name=condition_div]:first").find("input");ZPeopleComponents.isComponent(operatorDiv)&&ZPeopleComponents.select(operatorDiv).destroy(),ZPeopleComponents.select(operatorDiv,{options:ZPA_Criteria.getOperators(objAttr.workFlowFcType,objAttr.fcId),dataMapping:{label:"label",value:"value"},change:ZPA_Criteria.changeOperator,workFlowFcType:objAttr.workFlowFcType}),"#dbafield"!=operatorId&&ZPA_Criteria.setOperatorValue(parseInt(ZPeopleComponents.select(operatorDiv).value),operatorDiv.parent().next().find("input"),objAttr.workFlowFcType)},selectTabbedItem:function(id,forEleId){var selData=ZPA_Common.getPageId().find("#"+forEleId).attr("selecteddata");if(void 0!=selData){var selDatajson=JSON.parse(selData),selFcId=void 0==selDatajson.fcId?selDatajson.formComponentID:selDatajson.fcId,selParam_ItemObj=ZPA_Criteria.FC_ITEMJSON[selFcId],parentFormId=selParam_ItemObj.parentFormId,activeTabId=ZPA_TabbedListBox.getActiveTabId(ZPA_Criteria.FORMFIELDS_JSON.formNameJArray,parentFormId);ZPA_Common.isNotNull(activeTabId)&&ZPeopleComponents.tabbedlistboxpopup("#"+id).setAttribute("activeTab","#"+activeTabId),void 0!=selParam_ItemObj&&ZPeopleComponents.tabbedlistboxpopup("#"+id).selectTabItems(selParam_ItemObj.formKey,selParam_ItemObj.fcJson)}else{activeTabId=ZPA_TabbedListBox.getActiveTabId(ZPA_Criteria.FORMFIELDS_JSON.formNameJArray);ZPA_Common.isNotNull(activeTabId)&&ZPeopleComponents.tabbedlistboxpopup("#"+id).setAttribute("activeTab","#"+activeTabId)}}},ZPA_Criteria.Pattern={setPattern(criteria_body,action,button){var critPtrnValDiv=criteria_body.find("#criteriaPattern"),ruleFormat=critPtrnValDiv.val(),childLength=criteria_body.find("[name=crt_row]:visible").length,impactRow="";if("remove"==action?impactRow=$(button).parent("[name=crt_row]"):"add"==action&&(impactRow=criteria_body.find("[name=crt_row]").last()),2==childLength&&"add"==action)criteria_body.find("[name=crt_pattern]").removeClass("DN"),critPtrnValDiv.val("(1 AND 2)");else if(childLength>=1){if("remove"==action&&1==childLength)return criteria_body.find("[name=crt_pattern]").addClass("DN"),void critPtrnValDiv.val("");var selRuleCount=1,modifiedRuleFormat=ruleFormat;"add"==action?(selRuleCount=impactRow.find("[name=row_num]").text()-1,modifiedRuleFormat=ZPA_Criteria.Pattern.increaseOperandValue(ruleFormat,childLength,ruleFormat.indexOf(selRuleCount),selRuleCount)):"remove"==action&&(selRuleCount=impactRow.find("[name=row_num]").text(),modifiedRuleFormat=ZPA_Criteria.Pattern.decreaseOperandValue(ruleFormat,childLength+1,ruleFormat.indexOf(selRuleCount),selRuleCount)),modifiedRuleFormat=modifiedRuleFormat.replace(/  +/g," "),critPtrnValDiv.val(modifiedRuleFormat)}},onChange(ele){var ruleFormatDiv=ele.target.parents("[name=criteria_body]").parents().eq(2).find("#criteriaPattern"),ruleFormat=ruleFormatDiv.val(),conj=ele.detail.selectedValue,selRuleCount=ele.target.parents().eq(1).find("[name=row_num]").text(),selRuleIndex=ruleFormat.indexOf(selRuleCount),preRule=ruleFormat.substring(0,selRuleIndex),modifingOperName="AND";"AND"==conj?modifingOperName="OR":"OR"==conj&&(modifingOperName="AND");var sameOperIndex=preRule.lastIndexOf(conj),modifyoperIndex=preRule.lastIndexOf(modifingOperName);sameOperIndex<modifyoperIndex&&(ruleFormat=ruleFormat.substring(0,modifyoperIndex)+conj+ruleFormat.substring(modifyoperIndex+modifingOperName.length)),ruleFormatDiv.val(ruleFormat)},increaseOperandValue(ruleFormat,ruleLength,startindex,selRuleCount){var insertRuleCount=selRuleCount+1;for(i=ruleLength;i>selRuleCount;i--)ruleFormat.indexOf(i)>=0&&(ruleFormat=ruleFormat.replace(i,i+1));return ruleFormat=insertRuleCount>10?ruleFormat.substring(0,startindex+2)+" AND "+insertRuleCount+ruleFormat.substring(startindex+2):ruleFormat.substring(0,startindex+1)+" AND "+insertRuleCount+ruleFormat.substring(startindex+1)},decreaseOperandValue(ruleFormat,ruleLength,startindex,selRuleCount){for(i=ruleLength;i>selRuleCount;i--)ruleFormat.indexOf(i)>=0&&(ruleFormat=ruleFormat.replace(i,i-1));var postReplaceIndex=selRuleCount>=10?startindex+2:startindex+1;ruleFormat=ruleFormat.substring(0,startindex)+ruleFormat.substring(postReplaceIndex);var postOpername=ZPA_Criteria.Pattern.findPostOperator(ruleFormat.substring(startindex)),postRule=(ruleFormat=ZPA_Criteria.Pattern.replacePreOByPostOperator(ruleFormat.substring(0,startindex),postOpername,ruleFormat)).substring(startindex);if("AND"==postOpername){var removeRuleIndex=startindex+postRule.indexOf(postOpername);ruleFormat=ruleFormat.substring(0,removeRuleIndex)+ruleFormat.substring(removeRuleIndex+3)}else if("OR"==postOpername){removeRuleIndex=startindex+postRule.indexOf(postOpername);ruleFormat=ruleFormat.substring(0,removeRuleIndex)+ruleFormat.substring(removeRuleIndex+2)}return ruleFormat=ZPA_Criteria.Pattern.checkAndChangeRuleFormat(ruleFormat.substring(0,startindex),postOpername,ruleFormat)},checkAndChangeRuleFormat:function(preRuleFormat,postOpername,ruleFormat){var operLInd=preRuleFormat.lastIndexOf(postOpername);if(""==postOpername)return ruleFormat;var startInd="AND"==postOpername?parseInt(operLInd)+3:parseInt(operLInd)+2;for(i=startInd;i<ruleFormat.length;i++){if(")"==ruleFormat.charAt(i))return ruleFormat=(ruleFormat=ruleFormat.substring(0,i+1)+postOpername+ruleFormat.substring(i+1)).substring(0,operLInd)+ruleFormat.substring(startInd+1);if(" "!=ruleFormat.charAt(i))return ruleFormat}},findPostOperator:function(postRule){var oprname="";for(i=0;i<postRule.length;i++){var currChar=postRule.charAt(i);if("A"==currChar){if("AND"==(oprname=postRule.charAt(i)+postRule.charAt(i+1)+postRule.charAt(i+2)))return oprname}else if("O"==currChar&&"OR"==(oprname=postRule.charAt(i)+postRule.charAt(i+1)))return oprname}return oprname},replacePreOByPostOperator:function(preRuleFormat,postOperator,ruleFormat){var andOperLInd=preRuleFormat.lastIndexOf("AND"),orOperLInd=preRuleFormat.lastIndexOf("OR");return andOperLInd>orOperLInd?ruleFormat=ruleFormat.substring(0,andOperLInd)+postOperator+ruleFormat.substring(andOperLInd+3):orOperLInd>andOperLInd&&(ruleFormat=ruleFormat.substring(0,orOperLInd)+postOperator+ruleFormat.substring(orOperLInd+2)),ruleFormat},replaceRuleFormat:function(ruleFormat,isBlueprint){var andChar=isBlueprint?/and/g:/AND/g,orChar=isBlueprint?/or/g:/OR/g;return ruleFormat=(ruleFormat=ruleFormat.replace(andChar,"&")).replace(orChar,"|")},replaceRuleFormatToString:function(ruleFormat,isBlueprint){var andChar=isBlueprint?" and ":" AND ",orChar=isBlueprint?" or ":" OR ";return ruleFormat=(ruleFormat=ruleFormat.replace(/&/g,andChar)).replace(/\|/g,orChar)},validateRuleWithFormat:function(crtBody,ruleJson,ruleFormat){return ruleJson.length>25?(ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.criteria.criteriaexceed")),{isError:!0}):ruleJson.length>0&&(ZPA_Criteria.Pattern.validateForAllowedCharacters(crtBody,ruleFormat)||ZPA_Criteria.Pattern.validateSequentialNumber(crtBody,ruleFormat,ruleJson.length)||ZPA_Criteria.Pattern.validateAdjacentBrackets(crtBody,ruleFormat)||ZPA_Criteria.Pattern.validateMissingBrackets(crtBody,ruleFormat)||ZPA_Criteria.Pattern.validateForOperatorMismatch(crtBody,ruleJson,ruleFormat)||ZPA_Criteria.Pattern.validateExtraOperator(crtBody,ruleFormat,ruleJson.length))?{isError:!0}:void 0},save(getThis){var crtBody=$(getThis).parents().eq(3),critPtrnInp=crtBody.find("#criteriaPattern"),modifiedPtrn=critPtrnInp.val();modifiedPtrn=(modifiedPtrn=ZPA_Criteria.replaceRuleFormat(modifiedPtrn)).replace(/ +/g,"");ZPA_Criteria.getCriteriaConfigJson(crtBody);ZPA_Common.removeErrorDiv(crtBody);var ruleValidationResult=ZPA_Criteria.Pattern.validate(critPtrnInp,modifiedPtrn,crtBody.find("[name=crt_row]").length);void 0!=ruleValidationResult&&1==ruleValidationResult.isError||(ZPA_Criteria.Pattern.changeCriteriaConj(modifiedPtrn,crtBody.find("[name=crt_row]")),ZPA_Common.removeErrorDiv(crtBody),critPtrnInp.attr("disabled",!0),$(getThis).parent().addClass("DNI"),crtBody.find("#editPattern").removeClass("DN"))},edit(getThis){$(getThis).addClass("DN");var crtBody=$(getThis).parents().eq(3),critPtrnInp=crtBody.find("#criteriaPattern"),oldPtrn=critPtrnInp.val();critPtrnInp.removeAttr("disabled"),crtBody.find("#verifyPattern").removeClass("DNI"),crtBody.find("#cancelPattern").data("savedPtrn",oldPtrn)},cancel(getThis){var crtBody=$(getThis).parents().eq(3),critPtrnInp=crtBody.find("#criteriaPattern");critPtrnInp.val($(getThis).data("savedPtrn")),critPtrnInp.attr("disabled",!0),$(getThis).parent().addClass("DNI"),crtBody.find("#editPattern").removeClass("DN"),ZPA_Common.removeErrorDiv(crtBody)},changeCriteriaConj(modifiedPtrn,crtRowDiv){var operators=["&","|"],operInCrit=[];for(i=0;i<modifiedPtrn.length;i++){var currChar=modifiedPtrn.charAt(i);operators.indexOf(currChar)>=0&&operInCrit.push(currChar)}$.each(crtRowDiv,function(i,ele){if(0!=i){var crtRowEle=$(ele),conj=operInCrit[i-1],selectDiv=ZPeopleComponents.select(crtRowEle.find("[name=operator]")),selectedVal=selectDiv.value;"AND"==selectedVal&&"|"==conj?selectDiv.setValue("OR"):"OR"==selectedVal&&"&"==conj&&selectDiv.setValue("AND")}})},validateForOperatorMismatch:function(crtBody,ruleJson,ruleFormat){var operators="";for(i=0;i<ruleFormat.length;i++){var tempChar=ruleFormat.charAt(i);"&"!=tempChar&&"|"!=tempChar||(operators+=tempChar)}var initIndex=0,conjChar="&";for(i=1;i<ruleJson.length;i++){var conj=ruleJson[i].conjunctiveCondn;if("or"==conj||"OR"==conj?conjChar="|":"and"!=conj&&"AND"!=conj||(conjChar="&"),conjChar!=operators.charAt(initIndex++))return ZPA_Common.appendErrorDiv(crtBody.parent(),ZPI18N.getString("zp.criteria.operatornotmatched"),crtBody),!0}},validate(crtPtrnDiv,critPtrn,critLength){if(ZPA_Criteria.Pattern.validateForAllowedCharacters(crtPtrnDiv,critPtrn)||ZPA_Criteria.Pattern.validateSequentialNumber(crtPtrnDiv,critPtrn,critLength)||ZPA_Criteria.Pattern.validateAdjacentBrackets(crtPtrnDiv,critPtrn)||ZPA_Criteria.Pattern.validateMissingBrackets(crtPtrnDiv,critPtrn)||ZPA_Criteria.Pattern.validateExtraOperator(crtPtrnDiv,critPtrn,critLength))return{isError:!0}},validateForAllowedCharacters:function(crtPtrnDiv,ruleFormat){var allowedChars=new Array;allowedChars.push("&"),allowedChars.push("|"),allowedChars.push("("),allowedChars.push(")");var ruleLen=ruleFormat.length;for(i=0;i<ruleLen;i++){var currChar=ruleFormat.charAt(i);if(!(allowedChars.indexOf(currChar)>=0||ZPA_Criteria.Pattern.isDigit(currChar)))return ruleFormat.indexOf("and")>=0||ruleFormat.indexOf("or")>=0?ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.casesensivtive"),crtPtrnDiv):ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.notallowedcharacters"),crtPtrnDiv),!0}},validateAdjacentOperators:function(crtPtrnDiv,ruleFormat){var rulelength=ruleFormat.length;for(i=0;i<rulelength-1;i++)if("&"==ruleFormat.charAt(i)&&"|"==ruleFormat.charAt(i+1)||"|"==ruleFormat.charAt(i)&&"&"==ruleFormat.charAt(i+1))return ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.adjacentoperators"),crtPtrnDiv),!0},validateAdjacentBrackets:function(crtPtrnDiv,ruleFormat){var rulelength=ruleFormat.length;for(i=0;i<rulelength-1;i++)if("("==ruleFormat.charAt(i)&&")"==ruleFormat.charAt(i+1)||")"==ruleFormat.charAt(i)&&"("==ruleFormat.charAt(i+1))return ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.adjacentbrackets"),crtPtrnDiv),!0},validateExtraOperator:function(crtPtrnDiv,ruleFormat,ruleCount){var count=0,operators=new Array;for(operators.push("&"),operators.push("|"),i=0;i<ruleFormat.length;i++){var currChar=ruleFormat.charAt(i);operators.indexOf(currChar)>=0&&count++}if(count!=ruleCount-1)return ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.extraoperators"),crtPtrnDiv),!0},validateSequentialNumber:function(crtPtrnDiv,ruleFormat,ruleCount){if(1==ruleCount)return!1;var startNumber=1;for(i=0;i<ruleFormat.length;i++){var tempChar=ruleFormat.charAt(i);if(ZPA_Criteria.Pattern.isDigit(tempChar)){var operandNumber=tempChar,nextChar=ruleFormat.charAt(i+1);if(ZPA_Criteria.Pattern.isDigit(nextChar)&&(operandNumber+=nextChar,i++),startNumber!=operandNumber)return ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.sequentialorder"),crtPtrnDiv),!0;startNumber++}}var finalNumber=startNumber-1;return finalNumber<ruleCount?(ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.samelength"),crtPtrnDiv),!0):finalNumber>ruleCount?(ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.samelength"),crtPtrnDiv),!0):void 0},isDigit:function(character){return void 0!=character&&character>="0"&&character<="9"},validateMissingBrackets:function(crtPtrnDiv,ruleFormat){for(var ruleLen=ruleFormat.length,validationStack=new Array,i=0;i<ruleLen;i++){var currChar=ruleFormat.charAt(i);if("("===currChar)validationStack.push("(");else if(")"===currChar){if(!(validationStack.length>0))return ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.removeclose"),crtPtrnDiv),!0;validationStack.pop()}}if(validationStack.length>0)return ZPA_Common.appendErrorDiv(crtPtrnDiv.parent(),ZPI18N.getString("zp.criteria.removeopen"),crtPtrnDiv),!0},removeDummyBrackets:function(patternText){for(var staticIndex=1,totalBrackets=patternText.match(/\$[\d]+\$-/g).length/2;staticIndex<=totalBrackets;){var substr="$"+staticIndex+"$-",startIndex=patternText.indexOf(substr),endIndex=patternText.lastIndexOf(substr),nextStr="$"+ ++staticIndex+"$-",nextStart=patternText.indexOf(nextStr),substrLength=substr.length,nextStrLength=nextStr.length;if(nextStart>=0&&nextStart<endIndex)for(;nextStart<endIndex;){var nextEnd=patternText.lastIndexOf(nextStr);if(nextStart!=startIndex+substrLength||nextEnd!=endIndex-nextStrLength){if(nextStart>=0?(checkindex=staticIndex,midString=patternText.substr(nextStart+nextStrLength,nextEnd-nextStart-nextStrLength)):(checkindex=staticIndex-1,midString=patternText.substr(startIndex+substrLength,endIndex-startIndex-substrLength)),null==midString.match(/and|or/g)){regex=new RegExp("\\$"+checkindex+"\\$-","g");for(patternText=patternText.replace(regex,""),presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]==checkindex){matching=presentNumbers[numind];break}if(void 0!=matching){index=checkindex;patternText=ZPA_Criteria.Pattern.updateDollars(patternText,index)}totalBrackets=ZPA_Criteria.Pattern.updatestaticIndex(patternText,totalBrackets,endIndex,substr),nextStart=patternText.indexOf(nextStr)}break}var matching,regex=new RegExp("\\$"+staticIndex+"\\$-","g");for(patternText=patternText.replace(regex,""),presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]==staticIndex){matching=presentNumbers[numind];break}if(void 0!=matching){var index=staticIndex;patternText=ZPA_Criteria.Pattern.updateDollars(patternText,index)}totalBrackets=ZPA_Criteria.Pattern.updatestaticIndex(patternText,totalBrackets,endIndex,substr),nextStart=patternText.indexOf(nextStr)}else if(midString=patternText.substr(startIndex+substrLength,endIndex-startIndex-substrLength),null==midString.match(/and|or/g)){regex=new RegExp("\\$"+(staticIndex-1)+"\\$-","g");for(patternText=patternText.replace(regex,""),presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]==staticIndex){matching=presentNumbers[numind];break}if(void 0!=matching){index=staticIndex-1;patternText=ZPA_Criteria.Pattern.updateDollars(patternText,index)}totalBrackets=ZPA_Criteria.Pattern.updatestaticIndex(patternText,totalBrackets,endIndex,substr)}}return patternText},updatestaticIndex:function(patternText,totalBracket,staticInd,endInd,substr){return totalBracket=null!=patternText.match(/\$[\d]+\$-/g)?patternText.match(/\$[\d]+\$-/g).length/2:1,patternText.lastIndexOf(substr),totalBracket},updateDollars:function(patternText,ind){var len=0;for(presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)presentNumbers[numind]>=ind&&len++;var dollarLen=len/2;for(dInd=0;dInd<dollarLen;dInd++){var reg=new RegExp("\\$"+(ind+1)+"\\$-","g");patternText=patternText.replace(reg,"$"+ind+++"$-")}return patternText}};var ZPA_Posts={RECIPIENT_ADDRESS:{},FORMFIELD_DTLS:{},MAILADDRESS_KEY:["publicgroups","walls"],getMessageTemplate:function(currMode,tabId){var msgTemp='<div class="zpl_secn zpl_mailtmp"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.from")+'</label></div><div><div class="zpl_idiv"><select id="from_address" data-width="350"></select>';return msgTemp+="</div></div></div>",msgTemp+='<div class="zpl_secn zpl_mailtmp"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.postmessage.postin")+'</label></div><div><div id="to_grp" class="zpl_inpgrp"><div class="zpl_frmctrl" id="to_list"></div><a class="grp_add" id="to_pop" targetid="to_grp" onclick="ZPA_TabbedListBox.initializeTabPanel(this, \'postrecipient\', \'to_tabPanel\', \'to_pop\', \'to_list\')"><i class="PI_addlist"></i></a><div id="to_tabPanel"></div></div></div></div>',msgTemp+='<div class="zpl_secn zpl_mailtmp"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.subject")+'</label></div><div><div class="ztextbox--group zh-alignright zpl_inpticfild"><i class="ztextbox__icon PI_addlist" id="sub_pop" onclick="ZPA_Posts.initiateTabPanel(\'sub_tabpanel\', \'sub_pop\')"></i><input type="text" id="sub_list" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade()"><div id="sub_tabpanel"></div></div></div></div>',msgTemp+='<div class="zpl_secn zpl_mailtmp"><div><label>'+ZPI18N.getString("zp.message")+'</label></div><div><div class="zpl_idiv"><select id="chooseTemplate" data-width="250"></select><div id="tempAnker" class="zpl_cc DNI"><a class="zpl_lnk" onclick="ZPA_PostMessage.Slider.editTemplate(\''+currMode+"')\">"+ZPI18N.getString("zp.edittemp")+"</a></div></div></div></div>",msgTemp+='<div class="zpl_secn"><div><div class="zpl_msgedtr DNI" id="msgEditor"></div></div></div>',msgTemp+='<div class="zpl_secn"><div id="msgTemplate" class="zpl_msgedtr DN"></div></div>',msgTemp+=ZPA_FileUpload.getFileUploadHtml(tabId),msgTemp+='<div class="zcheckbox DN" id="disablecomments"><input id="post_disablecomments" type="checkbox" class="zcheckbox__helper"><label for="post_disablecomments" class="zcheckbox__label">'+ZPI18N.getString("zp.disablecomments")+"</label></div>"},resetPostTemplate:function(pageMode,formId){ZPA_Common.CloseAlert.changesMade(pageMode,!1);var pageId=ZPA_Common.getPageId(pageMode);ZPA_Posts.RECIPIENT_ADDRESS={},ZPA_Posts.FORMFIELD_DTLS={},pageId.find("#to_list").find("[taggrpid]").remove(),ZPeopleComponents.isComponent("#to_tabPanel")&&ZPeopleComponents.tabbedlistboxpopup("#to_tabPanel").destroy(),pageId.find("#sub_list").val(""),pageId.find("#msgTemplate").addClass("DN"),pageId.find("#msgTemplate").empty(),pageId.find("#msgEditor").addClass("DNI"),pageId.find("#msgEditor").empty(),pageId.find("#tempAnker").addClass("DNI"),pageId.find("#attach_section").addClass("DN"),pageId.find("#disablecomments").addClass("DN"),pageId.find("#attachedFiles").addClass("DN"),pageId.find("#post_diablecomments").addClass("DN"),ZPA_Messages.loadTemplate(pageMode,formId),ZPeopleComponents.isComponent("#chooseTemplate")&&ZPeopleComponents.select("#chooseTemplate").destroy()},loadTemplate:function(mode,formId){ZPA_Posts.loadAddresses(mode,formId)},loadAddresses:function(mode,formId){var pageId=ZPA_Common.getPageId(mode);let fromAddrProps={options:ZPA_Posts.getFromList(),dataMapping:{label:"displayName",value:"value"},change:function(event,data){ZPA_Common.CloseAlert.changesMade(mode)}};ZPA_Common.ZCompProp.loadSelectListProp(fromAddrProps),ZPeopleComponents.select(pageId.find("#from_address"),fromAddrProps);var pageMode=ZP_Automation_Mode.POSTMESSAGE,addrKey=void 0!=formId&&""!=formId?pageMode+"_"+formId:pageMode,params={formId:formId,mode:pageMode,method:"getPostMessageDtls",conreqcsr:csrfToken};ZPeople.Request.send("/postmessage/getPostMessageDtls",params,function(data){ZPA_Posts.RECIPIENT_ADDRESS={},ZPA_Posts.RECIPIENT_ADDRESS[addrKey]=data})},appendFromAddress:function(fromAddressId,fromAddress,displayName){var fromAddrList=[{value:fromAddressId,displayName:displayName+"<"+fromAddress+">"}];ZPeopleComponents.select("#from_address").addOption(fromAddrList),ZPeopleComponents.select("#from_address").setValue(fromAddrList)},getCurrentMode:function(){return ZP_Automation_Mode.POSTMESSAGE},initiateTabPanel:function(id,forEleId){var pageMode=ZP_Automation_Mode.POSTMESSAGE;if($.isEmptyObject(ZPA_Posts.FORMFIELD_DTLS)||!ZPeopleComponents.isComponent("#"+id)){var params={formId:ZPA_Common.getFormId(pageMode),method:"getFormFields",mode:pageMode,conreqcsr:csrfToken};$.ajax({url:"/getFormFields.zp",type:"POST",data:params,success:function(data){ZPA_Posts.FORMFIELD_DTLS=data;var tabPanelProps={id:id,forEleId:forEleId,appendTo:ZPA_Common.getPageCardContainerId(ZP_Automation_Mode.POSTMESSAGE),select:ZPA_Posts.appendFormFieldToSubject};ZPA_Util.TabPanel.loadFormFieldTabPanel(ZPA_Posts.FORMFIELD_DTLS,tabPanelProps),ZPeopleComponents.tabbedlistboxpopup("#"+id).open()}})}else ZPeopleComponents.tabbedlistboxpopup("#"+id).open()},appendFormFieldToSubject:function(event,opts){var pageMode=ZP_Automation_Mode.POSTMESSAGE,pageId=ZPA_Common.getPageId(pageMode),subject=pageId.find("#sub_list").val(),formFieldVal=event.detail.itemData.label;pageId.find("#sub_list").val(subject+"${"+formFieldVal+"}"),ZPA_Common.CloseAlert.changesMade(pageMode)},enableAddressBox:function(getThis){var pageId=$(settingsPage.mainWrapId),target=$(getThis).attr("target");"cc"==target?(pageId.find("#ccDiv").removeClass("DNI"),ZPA_Posts.TabPanel.newConstant(pageId.find("#cc_grp"))):"bcc"==target?(pageId.find("#bccDiv").removeClass("DNI"),ZPA_Posts.TabPanel.newConstant(pageId.find("#bcc_grp"))):"reply"==target&&(pageId.find("#replyDiv").removeClass("DNI"),ZPA_Posts.TabPanel.newConstant(pageId.find("#reply_grp"))),pageId.find("[action="+target+"]").removeClass("DNI"),2==$(getThis).siblings(".DN").length&&$(getThis).closest("#addRecipient").addClass("DNI"),$(getThis).addClass("DN")},validateFromAddress:function(mode,fromAddr){var isValidFromAddr="myLogin"==fromAddr||"byBot"==fromAddr,pageId=ZPA_Common.getPageId(mode);return isValidFromAddr||ZPA_Common.appendErrorDiv(pageId.find("#from_address").parent(),ZPI18N.getString("zp.entervalidfrom")),isValidFromAddr},emailAddressValidation:function(emailAddressObj){var resultObj={},configuredKeys=Object.keys(emailAddressObj);return $.each(configuredKeys,function(index,key){"publicGroups"===key?resultObj.errormsg=ZPI18N.getString("zp.mailalert.systemoptions.errmsg"):"system"===key&&emailAddressObj.system.length>25?resultObj.errormsg=ZPI18N.getString("zp.mailalert.users.errmsg"):"roles"===key&&emailAddressObj.roles.length>25?resultObj.errormsg=ZPI18N.getString("zp.mailalert.roles.errmsg"):"departments"===key&&emailAddressObj.departments.length>25?resultObj.errormsg=ZPI18N.getString("zp.mailalert.depts.errmsg"):"groups"===key&&emailAddressObj.groups.length>20?resultObj.errormsg=ZPI18N.getString("zp.mailalert.groups.errmsg"):"locations"===key&&emailAddressObj.locations.length>20?resultObj.errormsg=ZPI18N.getString("zp.mailalert.locations.errmsg"):"formfields"===key&&emailAddressObj.formfields.length>10?resultObj.errormsg=ZPI18N.getString("zp.mailalert.formfields.errmsg"):"constantVal"===key&&emailAddressObj.constantVal.length>10&&(resultObj.errormsg=ZPI18N.getString("zp.mailalert.constants.errmsg"))}),resultObj},replyToAddressValidation:function(emailAddressObj){var resultObj={},configuredKeys=Object.keys(emailAddressObj);if(configuredKeys.length>1)resultObj.errormsg=ZPI18N.getString("zp.mailalert.replyto.errmsg");else if(1==configuredKeys.length){emailAddressObj[configuredKeys[0]].length>1&&(resultObj.errormsg=ZPI18N.getString("zp.mailalert.replyto.errmsg"))}return resultObj},validatePostTemplateObject:function(mode,mailObj,isFromSync){var isValidPost=!0,pageId=ZPA_Common.getPageId(mode),fromAddr=mailObj.from,subject=mailObj.subject,to=mailObj.to,toValue=mailObj.toValue;isValidPost=ZPA_Posts.validateFromAddress(mode,fromAddr);var containsEmailAddrErr=!1,errorMsg="";if($.isEmptyObject(to))errorMsg=ZPI18N.getString("zp.toaddrnotempty"),containsEmailAddrErr=!0;else if(!$.isEmptyObject(to)){var wallsValue=toValue.wallsValue;$.isEmptyObject(wallsValue)||$.each(wallsValue,function(valId,value){$.each(value,function(key,val){"myLogin"==fromAddr&&void 0!=val&&"Company Wall"==val&&(errorMsg=ZPI18N.getString("zp.connect.bot.to"),isValidPost=!1,containsEmailAddrErr=!0),void 0!=ZPA_PostMessage.isConnectIntegrationEnabled&&ZPA_PostMessage.isConnectIntegrationEnabled&&void 0!=key&&"departmentwall"==key&&(ZPA_PostMessage.isDepartmentSyncdone||ZPA_PostMessage.isDepartmentSyncInitiated?ZPA_PostMessage.isDepartmentSyncdone||(isFromSync||ZPA_PostMessage.syncDepartmentsToConnect(!0),ZPA_PostMessage.isDepartmentSyncdone||(errorMsg=ZPI18N.getString("zp.connect.deptsync"),containsEmailAddrErr=!0)):(isFromSync||void 0==ZPA_PostMessage.isDepartmentSchRunning||ZPA_PostMessage.isDepartmentSchRunning||ZPA_PostMessage.departmentSyncPopUp.construct(!0),ZPA_PostMessage.isDepartmentSyncInitiated?(errorMsg=ZPI18N.getString("zp.connect.deptsync"),containsEmailAddrErr=!0):(isValidPost=!1,containsEmailAddrErr=!0)))})})}if(!containsEmailAddrErr){var toResultObj=ZPA_Posts.emailAddressValidation(to);void 0!=toResultObj.errormsg&&(errorMsg=toResultObj.errormsg,containsEmailAddrErr=!0)}return containsEmailAddrErr&&(ZPA_Common.appendErrorDiv(pageId.find("#to_grp"),errorMsg),isValidPost=!1),""===subject&&(ZPA_Common.appendErrorDiv(pageId.find("#sub_list").parent(),ZPI18N.getString("zp.enteremailsubject")),isValidPost=!1),subject.length>300&&(ZPA_Common.appendErrorDiv(pageId.find("#sub_list").parent(),ZPI18N.getString("zp.emlalrtsubexc")),isValidPost=!1),void 0===mailObj.templateId?""==$.trim(mailObj.templateMessage)?(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.editoremptymsg")),isValidPost=!1):mailObj.templateMessage.length>1e5&&(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.lengthofmessage")),isValidPost=!1):"-1"===mailObj.templateId&&(ZPA_Common.appendErrorDiv(pageId.find("#chooseTemplate").parent(),ZPI18N.getString("zp.template.selecttemplate")),isValidPost=!1),isValidPost},getConfDetails:function(mode,formId,currMode){var pageId=ZPA_Common.getPageId(mode),savePostMessageJObj={},fromMailAddr=ZPeopleComponents.select(pageId.find("#from_address")).getValue(),disableComments=!1,toMailAddr=ZPA_TabbedListBox.getTagConfig(pageId.find("#to_grp")),toMailAddrValues=ZPA_TabbedListBox.getTagValue(pageId.find("#to_grp"));pageId.find("#disablecomments").is(":visible")&&(disableComments=pageId.find("#post_disablecomments").is(":checked"));var subject=pageId.find("#sub_list").val();savePostMessageJObj.formId=formId,savePostMessageJObj.from=fromMailAddr,savePostMessageJObj.to=toMailAddr,savePostMessageJObj.subject=subject,savePostMessageJObj.toValue=toMailAddrValues,savePostMessageJObj.disableComments=disableComments;var mailTempId="";(currMode=void 0!=currMode&&""!=currMode?currMode:mode)==ZP_Automation_Mode.POSTMESSAGE&&(mailTempId=ZPeopleComponents.select(pageId.find("#chooseTemplate")).getValue()),void 0!=mailTempId&&""!=mailTempId&&"0"!=mailTempId&&(savePostMessageJObj.templateId=mailTempId);var createEditTemplateDiv=pageId.find("#msgEditor");if(currMode==ZP_Automation_Mode.POSTMESSAGE&&(savePostMessageJObj.recordTempIds=ZPA_FileUpload.getUploadedRecordTempList()),createEditTemplateDiv.find("#editorTextArea_"+currMode).is(":visible")){var orginalMessage=editor.getContent();savePostMessageJObj.templateMessage=orginalMessage}return savePostMessageJObj},isRecipientPresent:function(recipientAddr){var isRecPresent=!1;if(void 0!=recipientAddr&&""!=recipientAddr){var recipientKeys=Object.keys(recipientAddr);$.each(recipientKeys,function(index,recipientKey){var recipientObj=recipientAddr[recipientKey];Object.keys(recipientObj).length>0&&(isRecPresent=!0)})}return isRecPresent},getTemplates:function(mode,async){var formId=ZPA_Common.getFormId(mode),params={mode:mode,formId:formId.toString(),method:"getTemplates",conreqcsr:csrfToken};async=!(void 0!=async&&!async)||async,$.ajax({url:"/getTemplates.zp",type:"POST",async:async,data:params,success:function(respData){var templateItems=ZPA_Posts.getConstrutMsgTempAry(respData.messageTemplateJArray);ZPA_Posts.contructTemplatedDD(mode,templateItems)}})},contructTemplatedDD:function(mode,templateJArray){ZPA_Common.getPageId(mode);var empTempJson={TEMPLATEID:"-1",TEMPLATE_NAME:ZPI18N.getString("zp.choosefield"),TEMPLATE:""},createNewTempJson={TEMPLATEID:"0",TEMPLATE_NAME:ZPI18N.getString("zp.createtemp"),TEMPLATE:"",isFooter:!0,zitemid:"0"};templateJArray.splice(0,0,empTempJson),templateJArray.push(createNewTempJson);let tempProps={options:templateJArray,dataMapping:{label:"TEMPLATE_NAME",value:"TEMPLATEID"},change:ZPA_Posts.templateChangeCallback,mode:mode,footerSelectable:!0,removeExistingDropdown:!0};ZPA_Common.ZCompProp.loadSelectListProp(tempProps),ZPeopleComponents.select("#chooseTemplate",tempProps)},templateChangeCallback:function(event){var mode=event.detail.options.mode,pageId=ZPA_Common.getPageId(mode);ZPA_Common.removeErrorDiv(pageId.find("#chooseTemplate").closest(".zpl_secn"));var templateId=event.detail.optionData.TEMPLATEID,templateMsg=event.detail.optionData.TEMPLATE;pageId.find("#msgTemplate").addClass("DN"),pageId.find("#msgEditor").addClass("DNI"),pageId.find("#tempAnker").addClass("DNI"),pageId.find("#attach_section").addClass("DN"),pageId.find("#disablecomments").addClass("DN"),-1!=templateId?(0!=templateId?(pageId.find("#msgTemplate").html(ZPA_Editor.getViewTemplateHtml(templateMsg)),pageId.find("#msgTemplate").removeClass("DN"),pageId.find("#tempAnker").removeClass("DNI")):ZPA_Editor.initiateEditor(mode,ZPA_Common.getFormId(mode),""),pageId.find("#attach_section").removeClass("DN"),pageId.find("#disablecomments").removeClass("DN"),pageId.find("#fluplDiv").removeClass("DN"),ZPA_FileUpload.toggleAttachFileHeader(!0)):pageId.find("#fluplDiv").addClass("DN"),ZPA_Common.CloseAlert.changesMade(mode)},getConstrutMsgTempAry:function(msgTempAry){var templateItems=[];return $.each(msgTempAry,function(index,tempJSON){var tempItem={};tempItem.TEMPLATEID=tempJSON.TEMPLATEID,tempItem.TEMPLATE_NAME=tempJSON.TEMPLATE_NAME,tempItem.TEMPLATE=decodeHTML(tempJSON.TEMPLATE),tempItem.TEMPLATE_TYPE=tempJSON.TEMPLATE_TYPE,templateItems.push(tempItem)}),templateItems},constructMailId:function(tabPanelId,configJson,tagInputObj,targetId){var dispValJson=ZPA_Posts.TabPanel.keyPairIdJson,keyNameList=[dispValJson.publicgroups.id,dispValJson.walls.id];$.each(keyNameList,function(i,keyVal){configJson.hasOwnProperty(keyVal)&&$.each(configJson[keyVal],function(key,val){var parentJson=dispValJson[keyVal],parentTagJson={id:parentJson.id,value:parentJson.dispVal},childTagJson={id:key,value:ZSEC.Encoder.encodeForHTML(val)};ZPA_TabbedListBox.appendRecipientTag(tabPanelId,tagInputObj.find("#"+targetId),parentTagJson,childTagJson)})}),ZPA_Posts.TabPanel.newConstant(tagInputObj)},constructAactPerm:function(tabPanelId,configJson,tagInputObj,targetId){var dispValJson=ZPA_Posts.TabPanel.cActkeyPairIdJson,keyNameList=[dispValJson.publicgroups.id,dispValJson.walls.id];$.each(keyNameList,function(i,keyVal){configJson.hasOwnProperty(keyVal)&&$.each(configJson[keyVal],function(key,val){var parentJson=dispValJson[keyVal],parentTagJson={id:parentJson.id,value:parentJson.dispVal},childTagJson={id:key,value:val};ZPA_TabbedListBox.appendRecipientTag(tabPanelId,tagInputObj.find("#"+targetId),parentTagJson,childTagJson)})})},resetMessages(value,reset){var defaultValue,mode=ZP_Automation_Mode.APPROVAL;if(void 0!=value&&void 0!=ZPA_MailAlert.defaultTempMsg[ZPA_Common.getFormId(mode)])switch(value){case ApproverConstants.Type.AUTO_APPROVE:defaultValue=ZPA_MailAlert.defaultTempMsg[ZPA_Common.getFormId(mode)][MAConstants.ApprovalType.AUTO_APPROVE],reset=!0;break;case ApproverConstants.Type.AUTO_REJECT:defaultValue=ZPA_MailAlert.defaultTempMsg[ZPA_Common.getFormId(mode)][MAConstants.ApprovalType.AUTO_REJECT],reset=!0;break;default:defaultValue=ZPA_MailAlert.defaultTempMsg[ZPA_Common.getFormId(mode)][MAConstants.ApprovalType.MANUAL_APPROVAL]}void 0!=defaultValue&&reset&&(ZPeopleComponents.isComponent(ZPA_Common.getPageId(mode).find("#chooseTemplate"))&&ZPeopleComponents.select(ZPA_Common.getPageId(mode).find("#chooseTemplate")).setValue(defaultValue.templateId),ZPA_Common.getPageId(mode).find("#sub_list").val(defaultValue.subject),ZPA_Posts.populateRecipient(ZPA_Common.getPageId(mode),{to:defaultValue.to}))},setMailTemplate:function(pageId,pageMode,data){pageId=ZPA_Common.getPageId(pageMode);var fromAddrId=data.from_address;data.subject;if(ZPeopleComponents.select(pageId.find("#from_address")).setValue(fromAddrId),ZPA_Posts.populateRecipient(pageId,data),pageMode==ZP_Automation_Mode.POSTMESSAGE){var templateItems=ZPA_Posts.getConstrutMsgTempAry(data.messageTemplateJArray);ZPA_Posts.contructTemplatedDD(pageMode,templateItems)}ZPA_Posts.setData(pageId,pageMode,data),pageMode==ZP_Automation_Mode.POSTMESSAGE&&(pageId.find("#attach_section").removeClass("DN"),pageId.find("#disablecomments").removeClass("DN"),ZPA_FileUpload.setFileUploadList(data))},populateRecipient:function(pageId,data){if(data.notifyTo){var targetDiv=pageId.find("#to_list");targetDiv.find(".zpl_tgrp:not('#constEmlDiv'), .zpl_tg").remove(),targetDiv.find("[elem=addContactEmlLnk]").addClass("DN");var childTagJson={id:"NotifyAll",value:ZPI18N.getString("zp.notifyall")};ZPA_TabbedListBox.appendRecipientTag("to_tabPanel",targetDiv,{id:"NOTIFY_ALL",value:""},childTagJson)}ZPA_Posts.constructMailId("to_tabPanel",data.to,pageId.find("#to_grp"),"to_list"),ZPA_Posts.TabPanel.newConstant(pageId.find("#to_grp"))},setData:function(pageId,pageMode,data){var currMode=ZPA_Posts.getCurrentMode();data.disableComments?pageId.find("#post_disablecomments").prop("checked",!0):pageId.find("#post_disablecomments").prop("checked",!1),pageId.find("#sub_list").val(decodeHTML(data.subject)),pageId.find("#msgTemplate").addClass("DN"),pageId.find("#msgEditor").addClass("DNI"),pageId.find("#tempAnker").addClass("DNI"),pageId.find("#msgEditor").attr("mailTempId",data.templateId),pageId.find("disableComments").attr("post_disablecomments"),pageId.find("#msgTemplate").removeClass("DN"),currMode==ZP_Automation_Mode.POSTMESSAGE?(ZPeopleComponents.select(pageId.find("#chooseTemplate")).setValue(data.templateId),ZPA_Common.CloseAlert.changesMade(pageMode,!1)):pageId.find("#msgTemplate").html(ZPA_Editor.getViewTemplateHtml(data.templateMessage)),pageId.find("#tempAnker").removeClass("DNI")},getFromList:function(){return[{value:"myLogin",displayName:ZPI18N.getString("zp.personperformingaction")},{value:"byBot",displayName:ZPI18N.getString("zp.postmessage.bot")}]}};ZPA_Posts.TabPanel={keyPairIdJson:{publicgroups:{id:"publicgroups",dispVal:ZPI18N.getString("zp.connect.publicgroups")},walls:{id:"walls",dispVal:ZPI18N.getString("zp.connect.walls")}},loadMailAddrTabPanel:function(formId,idToLoad,forEleID,targetId){var pageMode=ZP_Automation_Mode.POSTMESSAGE,addrKey=void 0!=formId&&""!=formId?pageMode+"_"+formId:pageMode,tabs=[],messKeys=ZPA_Posts.MAILADDRESS_KEY;$.each(messKeys,function(index,key){let keyPairOBj=ZPA_Posts.TabPanel.keyPairIdJson[key];if(void 0==keyPairOBj)return;let tabObj={};tabObj.label=keyPairOBj.dispVal,tabObj.panelId=key+"_panel",tabObj.id=keyPairOBj.id;var recipientAddr=ZPA_Posts.RECIPIENT_ADDRESS[addrKey],mailAddrList=void 0!=recipientAddr&&""!=recipientAddr?recipientAddr[key]:void 0;if(void 0!=mailAddrList&&Object.keys(mailAddrList).length>0){var mailAddrItems=[];$.each(mailAddrList,function(addressId,addrName){"Department Wall"==addrName&&"departmentwall"==addressId&&(ZPA_PostMessage.isDepartmentSyncdone=recipientAddr.isDepartmentSyncdone,ZPA_PostMessage.isDepartmentSyncInitiated=recipientAddr.isDepartmentSyncInitiated,ZPA_PostMessage.isConnectIntegrationEnabled=recipientAddr.isConnectIntegrationEnabled,ZPA_PostMessage.UserPresentInConnect=recipientAddr.UserPresentInConnect,ZPA_PostMessage.UserPresentInAnotherConnect=recipientAddr.UserPresentInAnotherConnect,ZPA_PostMessage.isDepartmentSchRunning=recipientAddr.isDepartmentSchRunning);let mailAddrObj={};mailAddrObj.Id=ZPA_Common.getCustomFormComponentId(addressId),mailAddrObj.Value=addrName,mailAddrItems.push(mailAddrObj)}),tabObj.items=mailAddrItems}else if(void 0!=recipientAddr.connectUrl){var connectUrl=recipientAddr.connectUrl,createNewGroup=ZPI18N.getString("zp.connect.clickhere",[connectUrl]),noRecords="<div><p> "+ZPI18N.getString("zp.nogroupfound")+". "+createNewGroup+"</p></div>";ZPA_PostMessage.connectUrl=noRecords,tabObj.listboxOptions={serverSearch:!0,cacheData:!0,customNoResultsHTML:noRecords}}tabs.push(tabObj)});var tabPanelProps={tabs:tabs,id:idToLoad,forElement:"#"+forEleID,targetId:targetId,appendTo:ZPA_Common.getPageCardContainerId(ZP_Automation_Mode.POSTMESSAGE),select:ZPA_TabbedListBox.selectCallback,deselect:ZPA_TabbedListBox.deselectCallback,groupLabel:"sectionName",type:ZPA_TabbedListBox.POSTRECIPIENT,noResults:ZPA_PostMessage.connectUrl};tabPanelProps.listboxOptions={dataMapping:{id:"Id",value:"Id",text:"Value",noResults:ZPA_PostMessage.connectUrl},showSearchField:!0,search:{by:"Value",criteria:"contains"},searchFieldOptions:{placeholder:ZPI18N.getString("zp.search"),noResults:ZPA_PostMessage.connectUrl},isTextHTMLEncoded:!0},ZPeopleComponents.tabbedlistboxpopup("#"+idToLoad,tabPanelProps)},openTabPanel:function(id,forEleId,targetId){var pageMode=ZP_Automation_Mode.POSTMESSAGE,formId=ZPA_Common.getFormId(pageMode),addrKey=void 0!=formId&&""!=formId?pageMode+"_"+formId:pageMode;if(void 0==ZPA_Posts.RECIPIENT_ADDRESS[addrKey]){var params={formId:formId,mode:pageMode,method:"getPostMessageDtls",async:!1,conreqcsr:csrfToken};ZPeople.Request.send("/postmessage/getPostMessageDtls",params,function(data){ZPA_Posts.RECIPIENT_ADDRESS={},ZPA_Posts.RECIPIENT_ADDRESS[addrKey]=data})}ZPA_Posts.TabPanel.loadMailAddrTabPanel(formId,id,forEleId,targetId)},openEmailInpbx:function(thisObj,idToAppend){var constEmlDiv=$(thisObj).closest(".zpl_crd").find("#"+idToAppend+" #constEmlDiv");constEmlDiv.removeClass("DN"),$(constEmlDiv.find("input")).on("blur",function(event){ZPA_Posts.TabPanel.acceptContactEmail(event)}),$(constEmlDiv.find("input")).on("keypress",function(event){ZPA_Posts.TabPanel.acceptContactEmail(event)}),constEmlDiv.find("input").trigger("focus")},acceptContactEmail:function(event,thisObj){thisObj=event.currentTarget;var recipDiv=$(thisObj).closest(".zpl_inpgrp");if(ZPA_Common.removeErrorDiv(recipDiv),"blur"===event.type||"keypress"===event.type&&13===event.which){recipDiv=$(thisObj).closest(".zpl_inpgrp");var contactEmail=$(thisObj).val().trim(),emailValidation=ZPUtil.Validation.isEmail(contactEmail);if(0!==contactEmail.length&&emailValidation){if(0==recipDiv.find("[tagGrpId=constantVal").length){var tagGrp=ZPA_TabbedListBox.getRecipientTagGrpDiv("constantVal",ZPI18N.getString("zp.contactemail"));recipDiv.find(".zpl_frmctrl").append(tagGrp)}var systemTagDiv=recipDiv.find("[tagGrpId=constantVal]"),addrDtlDiv=ZPA_TabbedListBox.getRecipientTag(contactEmail,contactEmail);systemTagDiv.append(addrDtlDiv)}else if(0!==contactEmail.length&&!emailValidation)return void ZPA_Common.appendErrorDiv($(thisObj).parent(),ZPI18N.getString("zp.zp.copycustomization.enteravalidemailaddress"));$(thisObj).off(),$(thisObj).val(""),recipDiv.find("#constEmlDiv").addClass("DN"),ZPA_Posts.TabPanel.newConstant(recipDiv)}},newConstant:function(recipDiv){var tagAddr=ZPA_TabbedListBox.getTagConfig(recipDiv);$.isEmptyObject(tagAddr)?(recipDiv.find("[elem=addContactEmlLnk]").addClass("DN"),recipDiv.find(".zpl_frmctrl").on("click",function(event){ZPA_Posts.TabPanel.openEmailInpbx(event.currentTarget,recipDiv.attr("id"))})):$.isEmptyObject(tagAddr)||recipDiv.find("#constEmlDiv").is("visible")||(tagAddr.NOTIFY_ALL?recipDiv.find("[elem=addContactEmlLnk]").addClass("DN"):recipDiv.find("[elem=addContactEmlLnk]").removeClass("DN"),recipDiv.find(".zpl_frmctrl").off("click"))}};var ZPA_PostMessage={IS_LOADED:!1,defaultTempMsg:[],isPostMessageEnabled:!1,isDepartmentSchRunning:!1,isDepartmentSyncConfirmed:!1,isDepartmentSyncInitiated:!1,isDepartmentSyncdone:!1,isConnectIntegrationEnabled:!1,UserPresentInConnect:!1,UserPresentInAnotherConnect:!1,connectUrl:"",canShowPostMessage:!1,initPage:function(formId){var pageId=ZPA_Common.getParentPageId(),body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+"</th><th>"+ZPI18N.getString("zp.templatename")+'</th><th width="100"></th></tr></thead><tbody>';formId=ZPA_Common.isNotNull(formId)?formId:ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.POSTMESSAGE)).getValue(),ZPA_PostMessage.IS_LOADED||(pageId.find(".zpl_rgtcnt").empty(),ZPA_Common.Loader.appendPageLoading(pageId),$.post("/postmessage/getPostMessagelist",{formId:formId,serviceName:settingsUrlProps.currentMode,method:"list",conreqcsr:csrfToken},function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.POSTMESSAGE))return ZPA_Common.Loader.removePageLoading(pageId),!1;if(ZPA_PostMessage.IS_LOADED=!0,data.length>0)ZPA_PostMessage.IS_LOADED=!0,pageId.find("#add_postmessage").removeClass("DN"),$.each(data,function(index,row){body+='<tr alertid="'+this.FORM_TEMPLATE_ACTION_ID+'" formid="'+this.FORMID+'" onclick="ZPA_PostMessage.editSlide(\''+this.FORM_TEMPLATE_ACTION_ID+"', '"+this.FORMID+"')\"><td>"+row.TEMPLATE_NAME+"</td><td><span>"+row.DISPLAY_NAME+"</span></td><td><span>"+row.MESSAGE_TEMPLATE_NAME+'</span></td><td><div class="zpl_hvr"><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" alertid="'+this.FORM_TEMPLATE_ACTION_ID+'" alertName="'+this.TEMPLATE_NAME+'" onclick="ZPA_Common.deleteConfirmationPopup(this,  \''+ZP_Automation_Mode.POSTMESSAGE+"', ZPA_PostMessage.deletePostMessage)\"></i></div></td></tr>"}),body+="</tbody></table></div>",pageId.find(".zpl_rgtcnt").append(body);else{pageId.find("#add_postmessage").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.POSTMESSAGE),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.POSTMESSAGE),"",pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.postmessage.addpostMessage"),ZPA_PostMessage.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)}))},addSlide:function(){if(ZPA_Common.validateAddConfig())if(ZPA_PostMessage.Slider.enableConnectInteg(),!ZPA_PostMessage.isPostMessageEnabled||ZPA_PostMessage.isConnectIntegrationEnabled&&ZPA_PostMessage.UserPresentInConnect){if(ZPA_PostMessage.isPostMessageEnabled){var formId=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.POSTMESSAGE)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/postmessage/add-formid:"+formId}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.postmessage.error"))},add:function(formId){ZPA_PostMessage.Slider.enableConnectInteg(),!ZPA_PostMessage.isPostMessageEnabled||ZPA_PostMessage.isConnectIntegrationEnabled&&ZPA_PostMessage.UserPresentInConnect?ZPA_PostMessage.isPostMessageEnabled&&(ZPA_PostMessage.Slider.construct(ZPI18N.getString("zp.postmessage.addpostMessage")),formId=ZPA_Common.getPageMode()==ZP_Automation_Mode.POSTMESSAGE?settingsUrlProps.urlParamsArr.formid:formId,ZPA_PostMessage.Slider.loadDefault(!1,formId),ZPA_Posts.TabPanel.newConstant(ZPA_Common.getPageId(ZP_Automation_Mode.POSTMESSAGE).find("#to_grp")),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.POSTMESSAGE),500)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.postmessage.error"))},editSlide:function(alertid,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/postmessage/edit-formid:"+formId+"/mailalertid:"+alertid},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_PostMessage.edit(editParams.mailalertid,editParams.formid)},edit:function(alertid,formId){ZPA_PostMessage.Slider.construct(ZPI18N.getString("zp.editpostMessage")),ZPA_PostMessage.Slider.loadDefault(!0,formId);var params={mode:"postmessage",formId:formId,mailAlertId:alertid,method:"confMailAlertDtls",conreqcsr:csrfToken};$.ajax({url:"/confMailAlertDtls.zp",type:"POST",data:params,success:function(getMAlertDts){ZPA_PostMessage.Slider.edit(getMAlertDts),ZPA_Common.Loader.remove(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.POSTMESSAGE),500)}})},deletePostMessage:function(thisObj){var delIcObj=thisObj.delIcObj,mailAlertId=$(delIcObj).attr("alertId"),displayName=$(delIcObj).attr("alertName"),params={mailAlertId:mailAlertId,method:"deletePosts",conreqcsr:csrfToken};$.ajax({url:"/postmessage/deleteConnectPosts",type:"POST",data:params,success:function(data){"success"===data.response?(ZPeople.Message.success(ZPI18N.getString("zp.postmessagedeleted")),ZPA_PostMessage.IS_LOADED=!1,ZPA_PostMessage.initPage()):void 0!==data.wfmapping&&ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.POSTMESSAGE,data.wfmapping,displayName)}})},syncDepartmentsToConnect:function(isValidation){var params={method:"syncDepartmentsToConnect",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/postmessage/syncDepartmentsToConnect.zp",params,function(data){if(0!=data.length&&"success"==data.status){ZPA_PostMessage.isDepartmentSyncInitiated=!0,ZPA_PostMessage.isDepartmentSchRunning=!0,isValidation?ZPA_PostMessage.Slider.save(!0):ZPeople.Message.success(ZPI18N.getString("zp.connect.deptsync")),settingsPage.container.find("#toInputTag").find("#toinputpopup").click();var i=0,checkIfDepartmentSyncDone=setInterval(function(){i++,ZPA_PostMessage.syncDepartmentsToConnect(),(5==i||ZPA_PostMessage.isDepartmentSyncdone)&&clearInterval(checkIfDepartmentSyncDone)},12e4)}else 0!=data.length&&"syncing"==data.status?(ZPA_PostMessage.isDepartmentSyncInitiated=!0,ZPA_PostMessage.isDepartmentSchRunning=!0,isValidation?ZPA_PostMessage.save(!0):ZPeople.Message.success(ZPI18N.getString("zp.connect.deptsync"))):0!=data.length&&"fullsyncdone"==data.status&&(ZPA_PostMessage.isDepartmentSyncdone=data.isDepartmentsSynced)})},resetPostMessageConfig:function(){ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.POSTMESSAGE,!1);var currMode=ZPA_Posts.getCurrentMode(),pageId=ZPA_Common.getPageId(ZP_Automation_Mode.POSTMESSAGE);ZPA_Common.removeErrorDiv(pageId);var formId=ZPeopleComponents.select("#postmessage_formList").getValue();pageId.find("#post_name").val(""),ZPeopleComponents.select("#from_address").setAttribute("selectedValue","myLogin"),ZPA_Posts.resetPostTemplate(ZP_Automation_Mode.POSTMESSAGE,formId),ZPA_Posts.getTemplates(ZP_Automation_Mode.POSTMESSAGE),pageId.find("#fluplDiv").empty(),currMode==ZP_Automation_Mode.POSTMESSAGE&&ZPA_FileUpload.loadFileUploadTemplates(currMode)}};ZPA_PostMessage.Slider={construct:function(header){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.POSTMESSAGE),tab.cardId="post_cards",tab.validate=ZPA_PostMessage.Slider.save,ZPA_PostMessage.Slider.mailModal=new sliderModal(header,tab),ZPA_PostMessage.Slider.mailModal.mediumSize=!0,ZPA_PostMessage.Slider.mailModal.construct(),ZPA_Common.CloseAlert.construct(ZPA_PostMessage.Slider.mailModal),ZPA_PostMessage.Slider.mailModal.setCloseCallback(function(){ZPA_PostMessage.Slider.remove()});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.POSTMESSAGE);pageId.data("modalInstance",ZPA_PostMessage.Slider.mailModal),ZPA_Common.setRelativeContainer(pageId.find("#"+tab.cardId));var $post_cards=pageId.find("#post_cards");$post_cards.append(ZPA_Common.Cards.construct("pm_basic",ZPA_PostMessage.ContainerBody.BASIC)),$post_cards.append(ZPA_Common.Cards.construct("pm_message",ZPA_Posts.getMessageTemplate(ZPA_Posts.getCurrentMode(),tab.id),ZPI18N.getString("zp.message"))),ZPA_Common.Loader.add(ZPA_Common.Loader.getContainer(ZP_Automation_Mode.POSTMESSAGE))},remove:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.POSTMESSAGE);ZPeopleComponents.select(pageId.find("#postmessage_formList")).destroy(),void 0!=pageId.find("#chooseTemplate").data("zselect")&&ZPeopleComponents.select(pageId.find("#chooseTemplate")).destroy(),void 0!=pageId.find("#fluplTemp").data("zselect")&&ZPeopleComponents.dropdownlist("#fluplTemp").destroy(),ZPA_Common.getPageMode()==ZP_Automation_Mode.POSTMESSAGE&&(window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/postmessage"),ZPA_Editor.destroy(),ZPA_PostMessage.Slider.mailModal.remove()},validatePostMessage:function(mailObj,isFromSync){var isValidMail=!0,pageId=(ZPA_Posts.getCurrentMode(),ZPA_Common.getPageId(ZP_Automation_Mode.POSTMESSAGE));return ZPA_Common.removeErrorDiv(pageId),""===pageId.find("#post_name").val().trim()&&(ZPA_Common.appendErrorDiv(pageId.find("#post_name"),ZPI18N.getString("zp.postMessagecantbeempty")),isValidMail=!1),isValidMail=ZPA_Posts.validatePostTemplateObject(ZP_Automation_Mode.POSTMESSAGE,mailObj,isFromSync)&&isValidMail},save:function(isFromSync){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.POSTMESSAGE),curMode=ZPA_Posts.getCurrentMode();ZPA_Common.disableSaveBtn(pageId);var formId=ZPA_Common.getFormId(ZP_Automation_Mode.POSTMESSAGE),mailObj=ZPA_Posts.getConfDetails(ZP_Automation_Mode.POSTMESSAGE,formId,curMode);if(mailObj.templateName=pageId.find("#post_name").val(),void 0!=pageId.attr("alertid")&&(mailObj.formTemplateId=pageId.attr("alertid")),ZPA_PostMessage.Slider.validatePostMessage(mailObj,isFromSync)){var formData=new FormData;formData.append("configuration",JSON.stringify(mailObj)),formData.append("method","confMailAlert"),formData.append("mode",curMode),formData.append("conreqcsr",csrfToken),curMode===ZP_Automation_Mode.POSTMESSAGE&&ZPA_FileUpload.appendUploadedFile(formData),$.ajax({url:"/confMailAlert.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(data){if(ZPA_Common.enableSaveBtn(pageId),"failure"==data.status)new DeleteAlertMessage("",data.message).show();else{ZPeople.Message.success(ZPI18N.getString("zp.postmessagesaved"));var pageMode=ZPA_Common.getPageMode();pageMode==ZP_Automation_Mode.WORKFLOW?(mailObj.mailalertId=data.message,ZPA_Actions.callBackActions(ZP_Automation_Mode.POSTMESSAGE,mailObj)):pageMode==ZP_Automation_Mode.POSTMESSAGE&&ZPA_PostMessage.Slider.afterSaveCB(formId),ZPA_PostMessage.Slider.remove(),mailObj.mailalertId=data.message}}})}else ZPA_Common.enableSaveBtn(pageId)},checkPostMessageIntegEnabled:function(){var params={method:"checkPostMessageIntegEnabled",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/postmessage/checkPostMessageIntegEnabled",params,function(data){0!=data.length&&void 0!=data.isConnectIntegrationEnabled&&(ZPA_PostMessage.isConnectIntegrationEnabled=data.isConnectIntegrationEnabled),void 0!=data.UserPresentInConnect&&(ZPA_PostMessage.UserPresentInConnect=data.UserPresentInConnect),void 0!=data.canShowPostMessage&&(ZPA_PostMessage.canShowPostMessage=data.canShowPostMessage,isPostMessageConfigured=!0),ZPA_PostMessage.UserPresentInConnect&&ZPA_PostMessage.isConnectIntegrationEnabled&&(ZPA_PostMessage.isPostMessageEnabled=!0,isPostMessageConfigured=!0)})},enableConnectInteg:function(){var params={method:"enableZohoConnectInteg",conreqcsr:csrfToken},pageId=settingsPage.container;ZPeople.Request.sendAsyncPost("/postmessage/enableZohoConnectInteg",params,function(data){if(0!=data.length&&"failure"==data.status){var eMsg=data.message;ZPeople.Message.showFailureMsg(eMsg),pageId.find("#addActionBtn").removeAttr("disabled"),ZPA_PostMessage.isPostMessageEnabled=!1}else 0!=data.length&&"success"==data.status&&(void 0!=data.isConnectIntegrationEnabled&&(ZPA_PostMessage.isConnectIntegrationEnabled=data.isConnectIntegrationEnabled),data.isZohoConnectIntegEnabled&&(ZPA_PostMessage.isPostMessageEnabled=!0),void 0!=data.UserPresentInConnect&&(ZPA_PostMessage.UserPresentInConnect=data.UserPresentInConnect),void 0!=data.UserPresentInAnotherConnect&&(ZPA_PostMessage.UserPresentInAnotherConnect=data.UserPresentInAnotherConnect),void 0!=data.canShowPostMessage&&(ZPA_PostMessage.canShowPostMessage=data.canShowPostMessage,isPostMessageConfigured=!0))})},afterSaveCB:function(formId){ZPA_PostMessage.IS_LOADED=!1,formId!=ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.POSTMESSAGE)).getValue()&&ZPeopleComponents.select("#"+ZPA_Common.getFormListId(ZP_Automation_Mode.POSTMESSAGE)).setValue(formId)},loadDefault:function(isEdit,selFormId){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.POSTMESSAGE),currmode=ZPA_Posts.getCurrentMode();ZPA_Common.getFormList(ZP_Automation_Mode.POSTMESSAGE,ZPA_Common.getServiceName());let formListProp={options:ZPA_Common[ZPA_Common.getFormListMode(ZP_Automation_Mode.POSTMESSAGE,ZPA_Common.getServiceName())],dataMapping:{label:"dispName",value:"formId",title:"dispName"},change:ZPA_PostMessage.resetMailAertConfig};$.isEmptyObject(selFormId)||"0"==selFormId||(formListProp.selectedValue=selFormId,(isEdit||ZPA_Common.getPageMode()!=ZP_Automation_Mode.POSTMESSAGE)&&(formListProp.disabled=!0)),pageId.find("#post_name").on("change",function(){ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.POSTMESSAGE)}),ZPA_Common.ZCompProp.loadSelectListProp(formListProp),ZPeopleComponents.select("#postmessage_formList",formListProp),selFormId=ZPeopleComponents.select("#postmessage_formList").getValue(),isEdit||ZPA_Posts.getTemplates(currmode),ZPA_Posts.loadTemplate(ZP_Automation_Mode.POSTMESSAGE,selFormId),currmode==ZP_Automation_Mode.POSTMESSAGE&&ZPA_FileUpload.loadFileUploadTemplates(currmode)},edit:function(data){ZPA_Posts.getCurrentMode();var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.POSTMESSAGE);ZPeopleComponents.select(pageId.find("#postmessage_formList")).setAttribute("selectedValue",data.formId),pageId.attr("alertid",data.formTemplateId),pageId.find("#post_name").val(decodeHTML(data.templateName)),ZPA_Posts.setMailTemplate(pageId,ZP_Automation_Mode.POSTMESSAGE,data)},editTemplate:function(mode){mode=ZPA_Common.isNotNull(mode)?mode:ZP_Automation_Mode.POSTMESSAGE;var pageId=ZPA_Common.getPageId(mode);pageId.find("#msgTemplate").addClass("DN"),pageId.find("#tempAnker").addClass("DNI");var templateMsg=pageId.find("#viewTempDiv").html();ZPA_Editor.initiateEditor(mode,ZPA_Common.getFormId(mode),templateMsg)}},ZPA_PostMessage.ContainerBody={BASIC:'<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+'</label></div><div><select type="text" id="postmessage_formList" class="ztextbox" value=""></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.postmessage.messageName")+'</label></div><div><input type="text" id="post_name" placeholder="" class="ztextbox"></div></div>'},ZPA_PostMessage.departmentSyncPopUp={construct:function(isValidation){if(ZPA_PostMessage.isDepartmentSyncInitiated)ZPA_PostMessage.syncDepartmentsToConnect(isValidation);else{var infoPopUp=new InfoAlertMessage;infoPopUp.title=ZPI18N.getString("zp.postmessage.syncdeptdata"),infoPopUp.despcription=ZPI18N.getString("zp.postmessage.deptsync"),infoPopUp.yesButtonText=ZPI18N.getString("zp.confirm"),infoPopUp.cancelButtonText=ZPI18N.getString("zp.close"),infoPopUp.show(),infoPopUp.setCallback(function(){ZPA_PostMessage.syncDepartmentsToConnect(isValidation)})}}};var ZPA_TBA={HTML:'<div class="zpl_idiv" name="tba"><div class="zpl_rwfld"><input id="duration" type="text" class="ztextbox" value="1"></div><div class="zpl_rwfld"><select name="duration_type"></select></div><div class="zpl_rwfld"><select name="invoke_type"></select></div><div class="zpl_rwfld"><select name="fc_id"></select></div></div>',UNDOHTML:'<div class="zpl_crdcnt DN" name="tbaUndo"><div class="zpl_secn"><div class="zpl_gbox wd100_per"><div class="zpl_gbxttl"><div><p>'+ZPI18N.getString("zp.tbaundodesc")+'</p></div><div class="zpl_gbxrgt"><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="ZPA_TBA.tbaDelProcess(this)">'+ZPI18N.getString("zp.undo")+"</button></div></div></div></div></div>",DETAILS:[],create(){var pageContainer=ZPA_Common.getMainContainer();pageContainer.find("#wfcrd_action").append(ZPA_Workflow.ContainerBody.TBA),pageContainer.find("#tba_add").on("click",function(){ZPA_TBA.addTBA()})},loadDefault(getThis,formId,mode){ZPA_TBA.getDetails(formId),void 0==getThis&&(getThis=ZPA_Common.getMainContainer()),ZPA_TBA.createDuration(mode,getThis);var fcProp={options:ZPA_TBA.getFC(formId,mode),dataMapping:{label:"label",value:"value"},change:ZPA_TBA.changeFieldCB,parentCont:getThis,mode:mode};ZPA_Common.ZCompProp.loadSelectListProp(fcProp,!0),ZPeopleComponents.select(getThis.find("[name=fc_id]"),fcProp);var selFcId=ZPeopleComponents.select(getThis.find("[name=fc_id]")).getValue(),durVal=getThis.find("#duration").val(),fcType=ZPA_TBA.getFCType(durVal,ZPeopleComponents.select(getThis.find("[name=fc_id]")).getOptions());ZPA_TBA.createDuration(mode,getThis,fcType),ZPA_TBA.createInvokeType(getThis,selFcId)},createDuration:function(mode,getThis,fcType){ZPeopleComponents.isComponent(getThis.find("[name=duration_type]"))&&ZPeopleComponents.select(getThis.find("[name=duration_type]")).destroy();var durProp={options:ZPA_TBA.getTbaDType(mode,fcType),dataMapping:{label:"label",value:"value"}};ZPA_Common.ZCompProp.loadSelectListProp(durProp),ZPeopleComponents.select(getThis.find("[name=duration_type]"),durProp)},createInvokeType:function(container,selFcId){ZPeopleComponents.isComponent(container.find("[name=invoke_type]"))&&ZPeopleComponents.select(container.find("[name=invoke_type]")).destroy();var invTypeProp={options:ZPA_TBA.getInvokeType(selFcId),dataMapping:{label:"label",value:"value"}};ZPA_Common.ZCompProp.loadSelectListProp(invTypeProp),ZPeopleComponents.select(container.find("[name=invoke_type]"),{options:ZPA_TBA.getInvokeType(selFcId),dataMapping:{label:"label",value:"value"}})},getFCType:function(fcVal,options){var fcType="";return $.each(options,function(ind,opt){if(fcVal==opt.value)return fcType=opt.fcType,!1}),fcType},changeFieldCB:function(event){var container=event.detail.options.parentCont[0],mode=event.detail.options.mode,selFcId=event.detail.selectedValue,prevSelFcId=event.detail.previousValue,fcType=ZPA_TBA.getFCType(selFcId,ZPeopleComponents.select($(container).find("[name=fc_id]")).getOptions());ZPA_TBA.createDuration(mode,$(container),fcType),("0"==selFcId&&"0"!=prevSelFcId||"0"!=selFcId&&"0"==prevSelFcId)&&ZPA_TBA.createInvokeType($(container),selFcId)},loadTBA(tbaList,isClone){$.each(tbaList,function(index,tba){var container=ZPA_TBA.addTBA();container.find("#tba_name").val(ZPeople.decodeTxt(tba.timeBasedExecution.displayName)),ZPA_Actions.initValues(tba,container),container.attr("tbaOprType",isClone?"new":"edit"),ZPA_TBA.setTbaValues(tba.timeBasedExecution,container,ZP_Automation_Mode.WORKFLOW)})},addTBA(){var pageContainer=ZPA_Common.getMainContainer();if(ZPA_TBA.validateAddTba())return!1;var getThis=pageContainer.find("#tba_add").before('<div class="zpl_crd" name="tba_actions"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.workflow.timebasedaction")+"</h4><p>"+ZPI18N.getString("zp.tbadesc")+'</p></div><div><div name="tbaDelEditDiv" class="zpl_icncnt" onclick="ZPA_TBA.tbaDelProcess(this)"><i name="tbaDelUndo" class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'"></i></div></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.name")+'</label></div><div><input type="text" class="ztextbox" id="tba_name"></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.workflow.timeofexe")+"</label></div>"+ZPA_TBA.HTML+'</div></div><div class="zpl_crdcnt" name="action_container"></div>'+ZPA_TBA.UNDOHTML+"</div>"),container=$(getThis).prev();return container.attr("tbaOprType","new"),ZPA_TBA.loadDefault(container),ZPA_Actions.init(ZP_Automation_Mode.WORKFLOW,ZPeopleComponents.select("#workflow_formList").value,container.find("[name=action_container]")),container},validateAddTba:function(){var pageId=ZPA_Common.getMainContainer().find("#workflow_slider"),isError=pageId.find("[name=tba_actions]").length-pageId.find("[name=tbaUndo]:visible").length>=3;return isError&&ZPeople.Message.failure(ZPI18N.getString("zp.wftbaerrormsg")),isError},tbaDelProcess:function(getThis){var $this=$(getThis),$parent=$this.parents("[name=tba_actions]"),$tbaUndo=$($parent).find("[name=tbaUndo]"),$oprType=$parent.attr("tbaOprType");if(!!$tbaUndo.is(":visible")){if(this.validateAddTba())return;$this.parents("[name=tba_actions]").find("[name=tbaDelUndo]").addClass("PI_delete"),$parent.find(".zpl_crdcnt").removeClass("DN"),$tbaUndo.addClass("DN"),$oprType="newDel"===$oprType?"new":"edit",$parent.find("[tbaOprType]").attr("tbaOprType",$oprType)}else $this.find("[name=tbaDelUndo]").removeClass("PI_delete"),$parent.find(".zpl_crdcnt").addClass("DN"),$tbaUndo.removeClass("DN"),$oprType="new"===$oprType?"newDel":"delete",$parent.attr("tbaOprType",$oprType)},destroyTBA(){ZPeopleComponents.isComponent("#duration_type")&&ZPeopleComponents.select("#duration_type").destroy(),ZPeopleComponents.isComponent("#invoke_type")&&ZPeopleComponents.select("#invoke_type").destroy(),ZPeopleComponents.isComponent("#fc_id")&&ZPeopleComponents.select("#fc_id").destroy()},getDetails(formId){var pageContainer=ZPA_Common.getMainContainer();settingsUrlProps.url.indexOf("onboarding/employeeflow")>=0?formId=NewZPOnboarding.EmployeeForm.id:settingsUrlProps.url.indexOf("onboarding/candidateflow")>=0&&(formId=NewZPOnboarding.CandidateForm.id);var params={formId:formId=void 0!=formId?formId:ZPeopleComponents.select(pageContainer.find($("#"+ZPA_Common.getPageMode()+"_formList"))).getValue(),method:"timeBasedActionDtls",conreqcsr:csrfToken};void 0!==ZPA_TBA.DETAILS[formId]&&""!==ZPA_TBA.DETAILS[formId]||$.ajax({url:"/timeBaseActionDtls.zp",async:!1,type:"POST",data:params,success:function(data){ZPA_TBA.DETAILS[formId]=data}})},getTbaDType(mode,fcType){var options=[];return ZPA_Common.isNotNull(fcType)&&fcType!=FormConstants.FieldType.DATE_TIME||mode!=ZP_Automation_Mode.APPROVAL&&(options.push({value:"2",label:ZPI18N.getString("zp.minute")}),options.push({value:"3",label:ZPI18N.getString("zp.gracehour")})),options.push({value:"4",label:ZPI18N.getString("zp.leavetype.smalldays")},{value:"5",label:ZPI18N.getString("zp.leave.customize.weeks")}),mode!=ZP_Automation_Mode.APPROVAL&&options.push({value:"6",label:ZPI18N.getString("zp.leave.customize.months")},{value:"7",label:ZPI18N.getString("zp.leavetype.v2.entitlement.years")}),options},getInvokeType(fcVal){var options=[];return options.push({value:"1",label:ZPI18N.getString("zp.safter")}),0!=fcVal&&options.push({value:"-1",label:ZPI18N.getString("zp.sbefore")}),options},getFC(formId,mode){var pageContainer=ZPA_Common.getMainContainer();settingsUrlProps.url.indexOf("onboarding/employeeflow")>=0?formId=NewZPOnboarding.EmployeeForm.id:settingsUrlProps.url.indexOf("onboarding/candidateflow")>=0&&(formId=NewZPOnboarding.CandidateForm.id),formId=void 0!=formId?formId:ZPeopleComponents.select(pageContainer.find($("#"+ZPA_Common.getPageMode()+"_formList"))).getValue();var dateComponent=ZPA_TBA.DETAILS[formId].dateComponentJObjTBA,options=[];return mode!=ZP_Automation_Mode.APPROVAL&&options.push({value:"0",label:ZPI18N.getString("zp.ruletriggerdate")}),$.each(dateComponent,function(key,fcObj){options.push({value:key,label:fcObj.displayName,fcType:fcObj.fcType})}),options},setTbaValues(tbaObj,obj,mode){var tbaFcid,days,tbaDType,tbaInvokeType,tbaId;mode==ZP_Automation_Mode.WORKFLOW?(tbaFcid=void 0==tbaObj||null==tbaObj.fcId?0:tbaObj.fcId,days=tbaObj.duration,tbaDType=tbaObj.durationType,tbaInvokeType=tbaObj.invokeType,tbaId=tbaObj.gAId):(tbaFcid=void 0==tbaObj?0:tbaObj.tbaFcid,days=tbaObj.days,tbaDType=tbaObj.tbaDType,tbaInvokeType=tbaObj.tbaInvokeType,tbaId=tbaObj.tbaId),ZPeopleComponents.select(obj.find("[name=fc_id]")).setValue(tbaFcid),obj.find("#duration").val(days),ZPeopleComponents.select(obj.find("[name=duration_type]")).setValue(tbaDType),ZPeopleComponents.select(obj.find("[name=invoke_type]")).setValue(tbaInvokeType),obj.attr("tbaid",tbaId)},getTbaObj(obj){var tbaObj={};return tbaObj.days=obj.find("#duration").val(),tbaObj.tbaDType=ZPeopleComponents.select(obj.find("[name=duration_type]")).getValue(),tbaObj.tbaInvokeType=ZPeopleComponents.select(obj.find("[name=invoke_type]")).getValue(),tbaObj.tbaFcid=ZPeopleComponents.select(obj.find("[name=fc_id]")).getValue(),tbaObj.tbaName="TBA",tbaObj.tbaId=void 0!=obj.attr("tbaid")?obj.attr("tbaid"):"0",tbaObj},getTimeBasedActionObj(obj){var tbaObj={};return tbaObj.duration=obj.find("#duration").val(),tbaObj.durationType=ZPeopleComponents.select(obj.find("[name=duration_type]")).getValue(),tbaObj.invokeType=ZPeopleComponents.select(obj.find("[name=invoke_type]")).getValue(),tbaObj.fcid=ZPeopleComponents.select(obj.find("[name=fc_id]")).getValue(),tbaObj.fctype=ZPeopleComponents.select(obj.find("[name=fc_id]"))._selected[0].optData.fcType,tbaObj},getDurTypeStr:function(durVal,durType){var durTypeObj={2:ZPI18N.getString("zp.minute"),3:ZPI18N.getString("zp.gracehour"),4:ZPI18N.getString("zp.leavetype.smalldays"),5:ZPI18N.getString("zp.leave.customize.weeks"),6:ZPI18N.getString("zp.leave.customize.months"),7:ZPI18N.getString("zp.leavetype.v2.entitlement.years")},durTypeForSing={2:ZPI18N.getString("zp.smin"),3:ZPI18N.getString("zp.leavetype.hour.singular"),4:ZPI18N.getString("zp.day"),5:ZPI18N.getString("zp.sweek"),6:ZPI18N.getString("zp.smonth"),7:ZPI18N.getString("zp.leavetype.yearlyinfo")};return 1==durVal?durTypeForSing[durType]:durTypeObj[durType]},tbaConstructView(tbaConfigJObj){ZPI18N.getString("zp.wftbaminutes"),ZPI18N.getString("zp.hours"),ZPI18N.getString("zp.days"),ZPI18N.getString("zp.wftbaweeks"),ZPI18N.getString("zp.months"),ZPI18N.getString("zp.years");var invokeTypeObj={1:ZPI18N.getString("zp.safter"),"-1":ZPI18N.getString("zp.sbefore"),0:"Same Day"},tbaExecutionData=tbaConfigJObj.timeBasedExecution,tbaExeContent=tbaExecutionData.duration+" "+ZPA_TBA.getDurTypeStr(tbaExecutionData.duration,tbaExecutionData.durationType)+" "+invokeTypeObj[tbaExecutionData.invokeType]+" "+tbaExecutionData.fcDisplayName;if(void 0!=tbaExecutionData.tbaType&&1==tbaExecutionData.tbaType)return tbaExeContent},getSelectedItems(skipValidation){var isError=!1,tbaList=[],tbaContainers=ZPA_Common.getMainContainer().find("[name=tba_actions]");return $.each(tbaContainers,function(index,container){var params={},oprType=$(container).attr("tbaOprType");if(params.oprType=oprType,"new"==oprType||"edit"==oprType||"delete"==oprType){var tbaid=$(container).attr("tbaid");void 0!=tbaid&&(params.gAId=tbaid),"delete"!=oprType&&(params=Object.assign({},params,ZPA_TBA.getTimeBasedActionObj($(container))),ZPA_Actions.getSelectedParams($(container),params),params.displayName=$(container).find("#tba_name").val(),!skipValidation&&ZPA_TBA.tbaValidation(params,$(container))&&(isError=!0)),tbaList.push(params)}}),!0===isError?isError:tbaList},tbaValidation(tbaObj,$container){var isError=!1;return ZPA_Common.isNotNull(tbaObj.displayName.trim())?tbaObj.displayName.trim().length>ZPA_Workflow.LIMIT.NAME&&(ZPA_Common.appendErrorDiv($container.find("#tba_name"),ZPI18N.getString("zp.tbanamelimit")),isError=!0):(ZPA_Common.appendErrorDiv($container.find("#tba_name"),ZPI18N.getString("zp.actionnameempty")),isError=!0),ZPA_Common.isNotNull(tbaObj.duration)||(ZPA_Common.appendErrorDiv($container.find("#duration"),ZPI18N.getString("zp.executiontimeempty")),isError=!0),tbaObj.mailAlertIds.trim()||tbaObj.checklistIds.trim()||tbaObj.webhookIds.trim()||tbaObj.fieldUpdateIds.trim()||tbaObj.customfnIds.trim()||ZPA_Common.isNotNull(tbaObj.esignTempIds)&&tbaObj.esignTempIds.trim()||ZPA_Common.isNotNull(tbaObj.postMessageIds)&&tbaObj.postMessageIds.trim()||(ZPeople.Message.failure(ZPI18N.getString("zp.triggerprocesstba")),isError=!0),isError}};