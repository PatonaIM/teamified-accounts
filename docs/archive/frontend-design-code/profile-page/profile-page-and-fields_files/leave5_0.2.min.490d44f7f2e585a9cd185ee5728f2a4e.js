var MyLvBalance={};MyLvBalance={initLeaveType:void 0,initPage(){if(-1!=Layout.Page.hash.indexOf("/add")){new LeaveForm({initLeaveType:MyLvBalance.initLeaveType,initEmployee:LVUtil.urls.getCurrentPageUser()}).add()}else Layout.Page.container.find(".zpl_mdl").length>0&&Layout.Page.container.find(".zpl_mdl").remove(),LVUtil.Tab.InitPage(MyLvBalance.init,!1)},initHTML(){var html='<div class="zpl_container" id="rpts_leavebalance"><div class="zpl_iwrpr" tabindex="0" aria-label="'+ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.leavebalance")])+'"><div class="zpl_iwrprrgt"><div class="zpl_act zpl_tblfxd"><div class="zpl_rgtcnt"></div></div></div></div></div>';settingsPage.container.append(html)},init(){0==Layout.Page.container.find(".zpl_container").length&&MyLvBalance.initHTML(),MyLvBalance.get()},get(){var container=settingsPage.container.find(".zpl_rgtcnt"),params={key:"report_yearly",leaveyear:0};params.employee=LVUtil.Tab.isMyPage()?erecno:Layout.Page.urlparam.id,params.repType="dashboard",ZPeople.Request.send(Leave.Report.url,params,function(resp){"success"==resp.status?($(container).html(""),resp.data&&resp.data.report&&resp.data.report.length>0&&!_.isEmpty(resp.data.report[0].leavetypes)?TAMSUtil.UserSpace.Leave.construct(resp.data.report[0],resp.data.allowAdd,container,resp.data.absdata,resp.data.regAllowed):Leave.Util.showHideNoData(!0,"",container)):($(container).html(""),Leave.Util.showHideNoData(!0,"",container))},{})}};var TeamLeave={};(TeamLeave={initPage(){LVUtil.Tab.InitPage(TeamLeave.init,!1)},initHTML(selVal){var html='<div class="zpl_btnmnu"><div class="zpl_lft"></div><div class="zpl_cntrdv ZP-WeekSEPager"><div class="zpl_inav"><i class="PI_alft" aria-label="'+ZPI18N.getString("zp.common.previous")+'" tabindex="0"></i> <i class="PI_monthly"></i><i class="PI_argt" aria-label="'+ZPI18N.getString("zp.common.next")+'" tabindex="0"></i></div><div elem="dateNavigator" id="listcalview_weekly"><b class="ZPCalNav"><span id="pager_from"></span><span> - </span><span id="pager_to"></span></b></div></div><div class="zpl_rgt"><div class="grpbtn" id="viewOpts"><i class="PI_listview '+("PI_listview"==selVal?"zpl_act":"")+'" onclick="TeamLeave.switchView(this)"></i><i class="PI_weekly '+("PI_weekly"==selVal||void 0==selVal?"zpl_act":"")+' " onclick="TeamLeave.switchView(this)"></i><i class="PI_monthly '+("PI_monthly"==selVal?"zpl_act":"")+'" onclick="TeamLeave.switchView(this)"></i></div><i class="zpl_ibg PI_fltr" aria-label="'+ZPI18N.getString("zp.filter")+'" tabindex="0"></i></div></div><div class="zpl_rgtcnt"><div class="" id="lvlistvw"></div><div class="_dayvw"><div class="zpl_tblres"></div></div></div>';Layout.Page.container.append(html)},init(selVal){Layout.Page.container.find(".zpl_btnmnu").length<=0&&TeamLeave.initHTML(),Layout.Page.container.addClass("zpl_tblfxd zpl_sstbl"),Leave.Util.reg(),Layout.Page.container.find("#lvfilter").length<=0&&TeamLeave.constructFilter(),-1!=(selVal=void 0==selVal?Layout.Page.container.find(".zpl_rgt .grpbtn").find(".zpl_act").attr("class"):selVal).indexOf("PI_weekly")?TeamLeave.Weekly.get():-1!=selVal.indexOf("PI_listview")?TeamLeave.List.construct():-1!=selVal.indexOf("PI_monthly")&&(Layout.Page.container.find("#zp_lvCalOutCont").length<=0&&TeamLeave.Monthly.construct(),Leave.View.Calendar.init()),Layout.Page.container.find(".zpl_rgt").find(".PI_fltr").off("click").on("click",function(){LeaveAdminOpers.toggleFilter()})},switchView(viewOptsObj){var cont=Layout.Page.container;cont.find("#viewOpts").find("i").removeClass("zpl_act"),cont.find(".zpl_tblres").empty(),cont.find("#lvlistvw").empty();var mode=$(viewOptsObj).attr("class");$(viewOptsObj).addClass("zpl_act"),-1!=mode.indexOf("PI_listview")?cont.find("#zp_lvCalOutCont").length>0?(cont.find("#zp_lvCalOutCont").remove(),cont.find("#lvfilter").remove(),TeamLeave.init("PI_listview"),cont.find("#viewOpts").find("i").removeClass("zpl_act"),cont.find("#viewOpts").find(".PI_listview").addClass("zpl_act")):TeamLeave.List.construct():-1!=mode.indexOf("PI_weekly")?cont.find("#zp_lvCalOutCont").length>0?(cont.find("#zp_lvCalOutCont").remove(),cont.find("#lvfilter").remove(),TeamLeave.init("PI_weekly")):TeamLeave.Weekly.get():TeamLeave.Monthly.construct()},constructFilter(mode){var params={};let filteropt={};void 0!=mode&&mode!=TeamLeave.List.mode&&mode!=TeamLeave.Weekly.mode||(filteropt={periodV2:{single:!0,label:ZPI18N.getString("zp.period"),load:"week"},lvfrom:{type:"input",label:ZPI18N.getString("zp.from"),disabled:!0,date:!0},lvto:{type:"input",label:ZPI18N.getString("zp.to"),disabled:!0,date:!0}}),filteropt.department={single:!1,label:ZPI18N.getString("zp.department"),attr:{type:"select-one"}},filteropt.incReporteeOnly={type:"checkbox",label:ZPI18N.getString("zp.showreportee"),title:ZPI18N.getString("zp.showreportee")},params.filteropt=filteropt,LeaveAdminOpers.constructFilter(params);var filContainer=Layout.Page.container.find("#lvfilter");void 0!=mode&&mode!=TeamLeave.List.mode&&mode!=TeamLeave.Weekly.mode||(ZPeopleComponents.select(filContainer.find("[name=periodV2]")).setValue("8"),filContainer.find("[name=lvfrom]").off("zdatefieldpickerdateselect").on("zdatefieldpickerdateselect",function(){var dt=ZPeopleComponents.datefield(filContainer.find("[name=lvfrom]")).getValue().dateString;(dt=Calendar.parseDate(dt,uidateFormat)).setDate(dt.getDate()+6),ZPeopleComponents.datefield(filContainer.find("[name=lvto]")).setValue(dt)}));let deptComp=filContainer.find("[name=department]");deptComp.attr("defval",[_LOGGEDIN_DEPID]),LVSettings.Util.TokenField.setValues(deptComp,[_LOGGEDIN_DEPID])}}).Monthly={mode:"Monthly",construct(){let html='<div id="zp_lvCalOutCont"><div class="zpl_btnmnu"><div class="zpl_lft"></div><div class="zpl_cntrdv ZP-YearPager"><div class="zpl_inav"><i class="PI_alft"></i> <i class="PI_monthly"></i><i class="PI_argt"></i> </div><div><b class="ZPCalNav mon" id="calmonth"></b></div></div><div class="zpl_rgt"><div class="grpbtn" id="viewOpts"><i class="PI_listview" onclick="TeamLeave.switchView(this)"></i><i class="PI_weekly" onclick="TeamLeave.switchView(this)"></i><i class="PI_monthly zpl_act" onclick="TeamLeave.switchView(this)"></i></div><i class="zpl_ibg PI_fltr"></i></div></div>';html+='<div class="zpl_rgtcnt" id="zp_lvCalOutCont"><div id="caldiv" class="zpl_calndrvw"></div></div></div>',Layout.Page.container.html(html),Layout.Page.container.find("#lvfilter").remove(),TeamLeave.constructFilter(TeamLeave.Monthly.mode),Layout.Page.container.find(".zpl_rgt").find(".PI_fltr").off("click").on("click",function(){LeaveAdminOpers.toggleFilter()}),Leave.View.Calendar.init()}},TeamLeave.List={mode:"List",constructOnLeaveSummary(data,countObj){if(-1!=Layout.Page.pageId.indexOf("leavetracker-team-availability")){Layout.Page.container.find(".zpl_rgtcnt").find("#lvlistvw").empty(),Layout.Page.container.find(".zpl_rgtcnt").find("#lvlistvw").append('<div id="onLeaveSummary" class="zpl_brdfordtogg" aria-multiselectable="true"></div>');var cur_date=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date;$.each(data,function(i,obj){var date=Object.keys(obj)[0],dateSummaryHTML='<div class="zpl_collapsepanel" aria-expanded="false" id="date_'+date+'" aria-label="'+ZPI18N.getString("zp.date")+" "+date+" "+ZPI18N.getString("zp.leave.leavetype.leavecount")+" "+countObj[date]+'" tabindex="0"><div class="zpl_collapseheader"><span class="d-flexC"><b>'+date+"</b>"+(cur_date==date?'<span class="zpl_dots"></span><em>'+ZPI18N.getString("zp.today")+"</em>":"")+'<span class="zpl_dots"></span><em>'+ZPI18N.getString("zp.leave.leavetype.leavecount")+"<b> "+countObj[date]+'</b></em></span><div class="zpl_collaspeactions"></div></div><div class="zpl_collapsecontent"><div class=" zpl_accrdnTblfxd"><div class="zpl_tblres"></div></div></div></div>';Layout.Page.container.find("#onLeaveSummary").append(dateSummaryHTML);var formattedDate=-1!=date.indexOf("/")?date.replace(/\//g,"\\/"):-1!=date.indexOf(".")?date.replace(/\./g,"\\."):date;ZPeopleComponents.collapsiblepanel(Layout.Page.container.find("#onLeaveSummary").find("#date_"+formattedDate),{toggleButtonPosition:"right",toggleOnHeaderClick:!0,isActive:cur_date==date,beforepanelexpand:TeamLeave.List.showHideOtherPanels}),$.each(obj,function(i,o){TeamLeave.List.constructDtWiseLeaveList(Layout.Page.container.find("#onLeaveSummary").find("#date_"+formattedDate).find(".zpl_tblres"),o)})})}},showHideOtherPanels:event=>{if(1==event.detail.isTrusted){let temp=ZPeopleComponents.collapsiblepanels("#onLeaveSummary");temp.collapseAllPanels();var panelId=$(event.detail.element).attr("id");panelId=-1!=panelId.indexOf("/")?panelId.replace(/\//g,"\\/"):-1!=panelId.indexOf(".")?panelId.replace(/\./g,"\\."):panelId,temp.expandPanel("#"+panelId)}},constructDtWiseLeaveList(ele,data){$(ele).append('<table class="zpl_tbl"><tbody></tbody></table>'),$.each(data,function(i,empObj){let empname=LeaveAdminOpers.Util.getEmpRow({id:empObj.empId,name:ZPeople.getUserDisplayName(empObj.fname,empObj.lname),photo:empObj.photo});empObj.ltyp_name&&$(empname).find(".zpl_emdts").append('<div class="zpl_flexaligngap2"> <span class="zpl_lbdr _bx lv_bg'+empObj.ltyp_color+'"></span><em> '+empObj.ltyp_name+"</em> </div>"),$(ele).find("tbody").append(empname)})},construct(){var cont=Layout.Page.container,params={key:"get_reportees_on_leave"};params.conreqcsr=csrfToken,params.from=ZPeopleComponents.datefield(cont.find("#lvfilter").find("[name=lvfrom]")).getValue().dateString,params.to=ZPeopleComponents.datefield(cont.find("#lvfilter").find("[name=lvto]")).getValue().dateString,params.department=JSON.stringify(LVUtil.TokenField.getValues(cont.find("#lvfilter").find("[name=department]"))),params.incReporteeOnly=cont.find("#lvfilter").find("[name=incReporteeOnly]").is(":checked");var fromDt=Calendar.parseDate(params.from,uidateFormat),toDt=Calendar.parseDate(params.to,uidateFormat);if(6!=Leave.Util.getDateDiff(fromDt,toDt))return cont.find("#lvfilter").find(".ztextbox--error__label").removeClass("DNI"),cont.find("#lvfilter").find(".ztextbox--error__label").text(ZPI18N.getString("zp.selectvaliddaterage")),void LeaveAdminOpers.toggleFilter();cont.find(".ztextbox--error__label").addClass("DNI"),cont.find(".ztextbox--error__label").text(""),cont.find(".PI_monthly").text(""),cont.find("#pager_from").text(params.from),cont.find("#pager_from").data("date",Calendar.parseDate(params.from,uidateFormat)),cont.find("#pager_to").text(params.to),cont.find("#pager_to").data("date",Calendar.parseDate(params.to,uidateFormat)),params.mode=3,$("#onLeaveSummary",Layout.Page.container).remove(),Leave.Util.showHideNoData(!1),LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.appendLoading(),ZPeople.Request.send("/leave_view_actions.zp",params,function(resp){if("success"!==resp.status)return LeaveAdminOpers.Util.removeLoading(),void Leave.Util.showHideNoData(!0,ZPI18N.getString("zp.leave.teammems.nodata"),Layout.Page.container.find(".zpl_rgtcnt"));resp.data&&Object.keys(resp.data).length>0?TeamLeave.List.constructOnLeaveSummary(resp.data,resp.count):Leave.Util.showHideNoData(!0,ZPI18N.getString("zp.leave.teammems.nodata"),Layout.Page.container.find(".zpl_rgtcnt")),LeaveAdminOpers.Util.removeLoading()})}},TeamLeave.Weekly={mode:"Weekly",constructTable(){Layout.Page.container.find(".zpl_rgtcnt .zpl_tblres").append('<table class="zpl_tbl zpl_shftmap zpl_usrnlvvw"><thead><tr><th class="mw80"><table id="table_header"><thead><tr></tr></thead></table></th></tr></thead><tbody><tr><td class="mw80"><table><tbody id="empLvTakenDiv"></tbody><tfoot class="DNI"><td colspan=7></td></tfoot></table></td></tr></tbody></table><div id="zp_empty_data" systemviewonly=""></div>')},constructTableHeader(header){var cont=Layout.Page.container,tableCont=cont.find(".zpl_rgtcnt .zpl_tblres");if(header){$.each(header,function(i,data){var dayTh=ZP.create("th",{date:data.displayDate+""}),headerDiv=ZP.create("div",{class:"zpl_usrnlvhdr"}),daySpan=ZP.create("span");daySpan.appendChild(ZP.create("em",{text:data.day})),daySpan.appendChild(ZP.create("b",{text:data.date+"",class:"blk"})),headerDiv.appendChild(daySpan);var countCont=ZP.create("em",{class:"d-flexclmcap8 zpl_f12",text:ZPI18N.getString("zp.leave.leavetype.leavecount")});countCont.appendChild(ZP.create("b",{text:"",id:"lvCount"})),headerDiv.appendChild(countCont),dayTh.appendChild(headerDiv),tableCont.find("#table_header > thead > tr").append(dayTh)});var curDateTd=cont.find('table > thead > tr >th[date="'+ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date+'"]');curDateTd&&curDateTd.find("span").addClass("Cl-today")}},constrcutEmpContainer(empData,size,lvtypename,lvtypecolor){var empDiv1=ZP.create("div",{class:"zpl_usrnlv "+(size>0?"days"+size:"")+" "+(lvtypecolor?"lv_bdr"+lvtypecolor:"")}),empDiv2=ZP.create("div",{class:"zpl_em"}),empImg=ZP.create("div",{class:"zpl_emimg"});empImg.appendChild(ZP.create("img",{src:empData.photo}));var empdiv=ZP.create("div",{class:"zpl_emdts zpl_ellipsis tooltip-js","data-title-position":"bottom",title:empData.emp_name});let empName=ZP.create("span",{html:"<em>"+ZPeople.escapeHtml(empData.emp_id)+"-</em>",text:ZPeople.escapeHtml(empData.emp_name)});return empdiv.append(empName),lvtypename&&empdiv.append(ZP.create("span",{html:lvtypename})),empDiv2.appendChild(empImg),empDiv2.appendChild(empdiv),empDiv1.appendChild(empDiv2),empDiv1},changeAvailStatus(ele,size){for(var td=ele;size;)td.attr("isavail",!1),td=td.next(),size--},constructLvCount(){for(var from=Calendar.parseDate(Layout.Page.container.find(".ZP-WeekSEPager #pager_from").text(),uidateFormat),to=Calendar.parseDate(Layout.Page.container.find(".ZP-WeekSEPager #pager_to").text(),uidateFormat);from<=to;){var dispDate=Calendar.formatDate(from,uidateFormat),count=Layout.Page.container.find("#empLvTakenDiv").find("tr").find('td[date="'+dispDate+'"][isavail=false]').length;Layout.Page.container.find(".zpl_tblres").find("#table_header").find('th[date="'+dispDate+'"]').find("#lvCount").text(count),from.setDate(from.getDate()+1)}},construct(resp){var cont=Layout.Page.container;if(-1!=Layout.Page.pageId.indexOf("leavetracker-team-availability")){cont.find(".zpl_rgtcnt").append('<div class="" id="lvlistvw"></div><div class="_dayvw"> <div class="zpl_tblres"></div></div>'),cont.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.leave.onleave")]),tabindex:"0"}),TeamLeave.Weekly.constructTable(),TeamLeave.Weekly.constructTableHeader(resp.header),TeamLeave.Weekly.constructBody(resp.data)}},get(){var cont=Layout.Page.container,params={key:"dept_weekly_leave_taken_view"};params.conreqcsr=csrfToken,params.from=ZPeopleComponents.datefield(cont.find("#lvfilter").find("[name=lvfrom]")).getValue().dateString,params.to=ZPeopleComponents.datefield(cont.find("#lvfilter").find("[name=lvto]")).getValue().dateString,params.department=JSON.stringify(LVUtil.TokenField.getValues(cont.find("#lvfilter").find("[name=department]"))),params.incReporteeOnly=cont.find("#lvfilter").find("[name=incReporteeOnly]").is(":checked");var fromDt=Calendar.parseDate(params.from,uidateFormat),toDt=Calendar.parseDate(params.to,uidateFormat);if(6!=Leave.Util.getDateDiff(fromDt,toDt))return cont.find("#lvfilter").find(".ztextbox--error__label").removeClass("DNI"),cont.find("#lvfilter").find(".ztextbox--error__label").text(ZPI18N.getString("zp.selectvaliddaterage")),void LeaveAdminOpers.toggleFilter();cont.find(".ztextbox--error__label").addClass("DNI"),cont.find(".ztextbox--error__label").text(""),cont.find(".PI_monthly").text(""),cont.find("#pager_from").text(params.from),cont.find("#pager_from").data("date",Calendar.parseDate(params.from,uidateFormat)),cont.find("#pager_to").text(params.to),cont.find("#pager_to").data("date",Calendar.parseDate(params.to,uidateFormat)),cont.find("#listcalview_weekly").attr({"aria-label":ZPI18N.getString("zp.common.period")+params.from+" - "+params.to,tabindex:"0"});var tableCont=cont.find(".zpl_rgtcnt");tableCont.empty(),tableCont.append(ZPeople.LOADING_HTML),ZPeople.Request.send("/leave_view_actions.zp",params,function(resp){if("success"!==resp.status)return tableCont.find("#zp_page_loading").remove(),void Leave.Util.showHideNoData(!0,ZPI18N.getString("zp.leave.teammems.nodata"),Layout.Page.container.find(".zpl_rgtcnt"));var data_arr=resp;TeamLeave.Weekly.construct(data_arr),tableCont.find("#zp_page_loading").remove()})},constructTableRow(tbody){if(tbody){for(var from=Calendar.parseDate(Layout.Page.container.find(".ZP-WeekSEPager #pager_from").text(),uidateFormat),to=Calendar.parseDate(Layout.Page.container.find(".ZP-WeekSEPager #pager_to").text(),uidateFormat),tr=ZP.create("tr");from<=to;)tr.appendChild(ZP.create("td",{date:Calendar.formatDate(from,uidateFormat),isavail:!0})),from.setDate(from.getDate()+1);return tr}},findCellAndAppendRecs(lvRecs,empDets){var tbody=Layout.Page.container.find(".zpl_tblres").find("table.zpl_tbl").find("#empLvTakenDiv"),from=ZPeopleComponents.datefield(Layout.Page.container.find("#lvfilter").find("[name=lvfrom]")).getValue().dateString;$.each(lvRecs,function(i,lvObj){var lv_dts=lvObj.lvSubSets;$.each(lv_dts,function(i,lv_dt){var bar_st=Calendar.parseDate(from,uidateFormat),bar_end=Calendar.parseDate(from,uidateFormat);bar_st=bar_st.setDate(bar_st.getDate()+lv_dt[0]),bar_end=bar_end.setDate(bar_end.getDate()+lv_dt[1]);var diff=Leave.Util.getDateDiff(new Date(bar_st),new Date(bar_end))+1,tds=tbody.find("tr").find('td[date="'+Calendar.formatDate(new Date(bar_st),uidateFormat)+'"][isavail=true]'),isTdAdded=!1;if($.each(tds,function(i,td){if(isTdAdded)return!1;var rowtd=td,isTdAvail=!0;for(i=0;i<diff;i++){if(0==$(rowtd).attr("isavail")||"false"==$(rowtd).attr("isavail")){isTdAvail=!1;break}rowtd=$(rowtd).next()}isTdAvail&&(td.append(TeamLeave.Weekly.constrcutEmpContainer(empDets[lvObj.erecno],diff,lvObj.ltyp_name,lvObj.ltyp_color)),isTdAdded=!0,TeamLeave.Weekly.changeAvailStatus($(td),diff))}),!isTdAdded){var tr=TeamLeave.Weekly.constructTableRow(tbody),td=$(tr).find('td[date="'+Calendar.formatDate(new Date(bar_st),uidateFormat)+'"]');td.append(TeamLeave.Weekly.constrcutEmpContainer(empDets[lvObj.erecno],diff,lvObj.ltyp_name,lvObj.ltyp_color)),tbody.append(tr),TeamLeave.Weekly.changeAvailStatus($(td),diff)}})})},constructBody(data){if(data){var tableCont=Layout.Page.container.find(".zpl_tblres").find("table.zpl_tbl"),records=data.records,empDets=data.empsMap,tbody=tableCont.find("#empLvTakenDiv");if(void 0==records||records.length<=0&&data.longLvRecs.length<=0)return void Leave.Util.showHideNoData(!0,ZPI18N.getString("zp.leave.teammems.nodata"),Layout.Page.container.find(".zpl_rgtcnt"));Leave.Util.showHideNoData(!1),tbody.append(TeamLeave.Weekly.constructTableRow(tbody)),TeamLeave.Weekly.findCellAndAppendRecs(records,empDets),TeamLeave.Weekly.constructLvCount();var lvRecs=data.longLvRecs;lvRecs.length>0&&(tbody.parent().find("tfoot").removeClass("DNI"),TeamLeave.LongLeave.constructLongLvCont(lvRecs,empDets),TeamLeave.LongLeave.constructLongLvCount(lvRecs))}}},TeamLeave.LongLeave={getFooterHTML:()=>'<div class="a-itm-cntr d-flexcap"><span>'+ZPI18N.getString("zp.leave.teammemsonlongleave")+' :</span><div class="zpl_avatarimg"></div><ul class="zpl_lstbdrlne"><li><a class="blu" id="viewAllLongLvEmpsDets">'+ZPI18N.getString("zp.view")+"</a></li><li>"+ZPI18N.getString("zp.counttotal")+' : <b id="longLvCount"> </b></li></ul></div>',appendLongLvEmps(tFoot,lvRecs,empDets){$.each(lvRecs,function(i,lvRec){if(4==i)return tFoot.find(".zpl_avatarimg").append('<span class="zpl_totaltxt">+'+(lvRecs.length-4)+"</span>"),!1;var empData=empDets[lvRec.erecno],html='<div class="zpl_em" data-popup-open="teammeaImg" title="'+empData.emp_name+'" data-title-position="top" data-title-class-name="dark" data-title-display-type="callout"><div class="zpl_emimg"><img src="'+empData.photo+'"></div></div>';tFoot.find(".zpl_avatarimg").append(html)}),tFoot.find("#longLvCount").text(" "+lvRecs.length+" ")},getLongLvModalHTML:needlvtypecol=>'<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr class="TblGryBg"><th>'+ZPI18N.getString("zp.employee")+"</th>"+(needlvtypecol?"<th>"+ZPI18N.getString("zp.leavetype")+"</th>":"")+"<th>"+ZPI18N.getString("zp.leaveperiod")+"</th><th>"+ZPI18N.getString("zp.leave.taken")+'</th></tr></thead><tbody id="longLvBody"></tbody></table></div></div></div></div>',appendLongLvEmpDetails(ele,lvRecs,empDets){$.each(lvRecs,function(i,lvRec){var empData=empDets[lvRec.erecno],tr=ZP.create("tr"),name_td=ZP.create("td"),empDiv=ZP.create("div",{class:"zpl_em"}),imgDiv=ZP.create("div",{class:"zpl_emimg"});imgDiv.append(ZP.create("img",{src:empData.photo}));var empDetsDiv=ZP.create("div",{class:"zpl_emdts"}),empDetDiv=ZP.create("div");if(empDetDiv.append(ZP.create("em",{text:empData.emp_id+"-"})),empDetDiv.append(ZP.create("b",{text:empData.emp_name})),empDetsDiv.append(empDetDiv),empDiv.append(imgDiv),empDiv.append(empDetsDiv),name_td.append(empDiv),tr.append(name_td),lvRec.ltyp_name){var lvtyp_td=ZP.create("td");lvtyp_td.append(ZP.create("span",{html:lvRec.ltyp_name})),tr.append(lvtyp_td)}var dt_td=ZP.create("td");dt_td.append(ZP.create("span",{text:lvRec.from+" - "+lvRec.to}));var days_td=ZP.create("td");days_td.append(ZP.create("span",{text:lvRec.leavetaken+" "+lvRec.leaveunit})),tr.append(dt_td),tr.append(days_td),ele.find("#longLvBody").append(tr)})},constructLongLvCont(lvRecs,empDets){if(lvRecs){var tFoot=Layout.Page.container.find("tfoot").find("tr").find("td");tFoot.append(TeamLeave.LongLeave.getFooterHTML()),TeamLeave.LongLeave.appendLongLvEmps(tFoot,lvRecs,empDets),$("#viewAllLongLvEmpsDets",tFoot).off("click").on("click",function(event){var modalParams={id:"longleave_list_view",cardId:"longleave_list_view_cont"},viewModal=new sliderModal(ZPI18N.getString("zp.leave.teammemsonlongleave"),modalParams);viewModal.construct(),viewModal.setCloseCallback(function(){viewModal.remove()});var ele=Layout.Page.container.find("#longleave_list_view");ele.find(".zpl_mfoter").remove();let needlvtypecol=!1;$.each(lvRecs,function(i,lvRec){if(lvRec.ltyp_name)return needlvtypecol=!0,!1}),ele.find(".zpl_mcnt").append(TeamLeave.LongLeave.getLongLvModalHTML(needlvtypecol)),TeamLeave.LongLeave.appendLongLvEmpDetails(ele,lvRecs,empDets)})}},constructLongLvCount(longLvRecs){$.each(longLvRecs,function(i,longLvRec){var lv_st=Calendar.parseDate(longLvRec.from,uidateFormat),lv_end=Calendar.parseDate(longLvRec.to,uidateFormat),from=Calendar.parseDate(Layout.Page.container.find(".ZP-WeekSEPager #pager_from").text(),uidateFormat),to=Calendar.parseDate(Layout.Page.container.find(".ZP-WeekSEPager #pager_to").text(),uidateFormat);for(lv_st<from&&(lv_st=from),lv_end>to&&(lv_end=to);lv_st<=lv_end;){var dispDate=Calendar.formatDate(lv_st,uidateFormat),count=parseInt(Layout.Page.container.find(".zpl_tblres").find("#table_header").find('th[date="'+dispDate+'"]').find("#lvCount").text());Layout.Page.container.find(".zpl_tblres").find("#table_header").find('th[date="'+dispDate+'"]').find("#lvCount").text(count+1),lv_st.setDate(lv_st.getDate()+1)}})}};var LeaveCompensatory={};(LeaveCompensatory={recordData:{},refresh:!1,regEvents:function(){settingsPage.container.find("[name=addrequest]").off("click").on("click",function(){LeaveCompensatory.Add.html()}),settingsPage.container.find("[name=dataSelect],[name=status]").off("zselectchange").on("zselectchange",function(ele,data){data.fromUI&&(0==settingsPage.container.find(".zpl_rgtcnt").find(".zpl_tblres").find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),LeaveAdminOpers.Util.Footer.searchcallback())}),settingsPage.container.find(".zpl_rgt").find("ul>li").off("click").on("click",function(){$(this).siblings().removeClass("zpl_act"),$(this).addClass("zpl_act"),0==settingsPage.container.find(".zpl_rgtcnt").find(".zpl_tblres").find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),LeaveAdminOpers.Util.Footer.searchcallback()}),settingsPage.container.find(".zpl_icncnt").find("i").off("click").on("click",function(){LeaveAdminOpers.Util.toggleSort(this)})},changeViewEditURL:function(ele){var id=$(ele).closest("div").attr("id").split("_"),rec_id=id[id.length-1];"viewOpt"==ele.id?LeaveCompensatory.RecordView.get(rec_id):LeaveCompensatory.Edit.get(rec_id)},View:{changeUrl:function(){LVUtil.Tab.isOpersPage()||LVUtil.Tab.isNewTabPage()?(LeaveCompensatory.recordData={},LeaveCompensatory.refresh&&(LeaveCompensatory.View.get(),LeaveCompensatory.refresh=!1)):-1!==Layout.Page.hash.indexOf("#approvals/myapproval")?window.location.href="#approvals/myapproval":-1!==Layout.Page.hash.indexOf("#approvals/myrequest")?window.location.href="#approvals/myrequest":-1==Layout.Page.hash.indexOf("leavetracker/compensatory/view")&&-1==Layout.Page.hash.indexOf("leavetracker/compensatory/edit")||(window.location.href=LVUtil.urls.ListView.HOME())},getParams:function(){var params={key:"compensatory_view"};let dataele=settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=dataSelect]");return params.dataSelect=dataele.length>0?ZPeopleComponents.select(dataele).getValue():3,LVUtil.Tab.isMyPage()?params.viewMode=1:LVUtil.Tab.isTeamPage()&&(params.dataSelect=settingsPage.container.find(".zpl_rgt").find("ul>li.zpl_act").attr("value"),2==params.dataSelect?params.viewMode=4:params.viewMode=3),LeaveAdminOpers.Util.filterParams(params),LVUtil.Tab.isOpersPage()&&!LVUtil.Tab.isOpersUserPage()||delete params.dataSelect,params.conreqcsr=csrfToken,params},get:function(){var params=LeaveCompensatory.View.getParams();ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.compApprovalEnabled?params.status=ZPeopleComponents.select(settingsPage.container.find("[name=status]")).getValue():($("#approval_col",settingsPage.container).hide(),$("[name=status]",settingsPage.container).next().hide()),LeaveAdminOpers.Util.sortParams(params);var data_footer=$("#systemview_pagination",settingsPage.container),getMore=($(data_footer.find("select")),$(".pagecount",data_footer));params.sIndx=getMore.find("span").data("sIndx"),params.limit=getMore.find("span").data("eIndx"),LeaveAdminOpers.Util.showHideNoData(!1),$("tbody#compRecordContainer",settingsPage.container).empty(),LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.appendLoading();var rowCnt=0;ZPeople.Request.send(LeaveAdminOpers.viewUrl,params,function(resp){var isRepToHide="6"==settingsPage.container.find(".zpl_rgt").find("ul>li.zpl_act").attr("value")&&LVUtil.Tab.isTeamPage(),repToHeadCont=settingsPage.container.find(".zpl_tblres > table > thead > tr").find("#repTo");isRepToHide?repToHeadCont.hide():repToHeadCont.show(),LeaveCompensatory.View.html(resp,isRepToHide),resp.count&&data_footer.find("a#recCount").data("totalCount",resp.count),resp.count<=ZPeopleComponents.select(data_footer.find("select")).getValue()&&data_footer.find("a#recCount").text(resp.count),rowCnt=params.sIndx+resp.data.length-1,LeaveAdminOpers.Util.Footer.setNavi(params.sIndx,rowCnt);var tbody=settingsPage.container.find(".zpl_rgtcnt table tbody");$(tbody).on("click","td",function(){if(0==$(this).find("i,input,button").length){var rec_id=$(this).closest("tr").data("id");LeaveCompensatory.RecordView.get(rec_id)}}),settingsPage.container.data("isreg",!0)},{})},html:function(result,isRepToHide){var show_approval=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.compApprovalEnabled;if("success"===result.status){var tbody=$("tbody#compRecordContainer",settingsPage.container);tbody.html(""),LeaveAdminOpers.Util.removeLoading();var dataArr=result.data;if(_.isEmpty(dataArr))return void LeaveAdminOpers.Util.showHideNoData(!0,ZPI18N.getString("zp.leave.operations.nodatamsg",[ZPI18N.getString("zp.leave.operations.scompoff")]));tbody.parents("table").find("thead").show(),LeaveAdminOpers.Util.showHideNoData(!1);var temp_doc=document.createDocumentFragment();for(var indx in dataArr){var recJson=dataArr[indx],tr=ZP.create("tr",{class:"CP"});$(tr).data("id",recJson.rec_id);var options={viewOpt:LeaveCompensatory.changeViewEditURL};recJson.isbookable&&(options.bookOpt=function(ele){window.location.href=LeaveAdminOpers.Router.getRecordUrl("book",ele.getAttribute("recordId"))}),recJson.allowedit&&(options.editOpt=LeaveCompensatory.changeViewEditURL),recJson.allowdelete&&(options.deleteOpt=LeaveAdminOpers.Util.deleteWarning),tr.appendChild(LeaveAdminOpers.Util.getDropDownActionsTD(options,recJson.rec_id));var chxTd=ZP.create("td"),chxLabel="";if(recJson.allowdelete?(chxLabel=ZP.create("div",{class:"zcheckbox"})).appendChild(ZP.create("input",{type:"checkbox",name:"check",class:"zcheckbox__helper"})):(chxLabel=ZP.create("div",{class:"zcheckbox disabled"})).appendChild(ZP.create("input",{type:"checkbox",name:"check",class:"zcheckbox__helper",disabled:!0})),chxLabel.appendChild(ZP.create("label",{class:"zcheckbox__label"})),chxTd.appendChild(chxLabel),tr.appendChild(chxTd),show_approval){var approvalTd=ZP.create("td");LeaveAdminOpers.Util.getStatusTd(approvalTd,recJson.approval_status),tr.appendChild(approvalTd)}var nameTd=ZP.create("td",{scope:"row",tabindex:0}),nameDiv=ZP.create("div",{class:"zpl_em"}),nameSubDiv2=nameDiv.appendChild(ZP.create("div",{class:"zpl_emdts"})).appendChild(ZP.create("div",{class:"tooltip-js w150","data-title-position":"bottom",title:recJson.name}));if(nameSubDiv2.appendChild(ZP.create("em",{text:recJson.empid+" -"})),nameSubDiv2.appendChild(ZP.create("b",{text:recJson.name})),nameTd.appendChild(nameDiv),tr.appendChild(nameTd),!isRepToHide){var repToTd=ZP.create("td"),repToDiv=ZP.create("div",{class:"tooltip-js w150","data-title-position":"bottom",title:recJson.reportingTo}),repToSpan=ZP.create("span",{text:recJson.reportingTo});repToDiv.appendChild(repToSpan),repToTd.appendChild(repToDiv),tr.appendChild(repToTd)}var workDtTd=ZP.create("td"),workDtSpan=ZP.create("span",{text:recJson.date});workDtTd.appendChild(workDtSpan),tr.appendChild(workDtTd);var expDtTd=ZP.create("td"),expDtSpan=ZP.create("span",{text:recJson.expiry});expDtTd.appendChild(expDtSpan),tr.appendChild(expDtTd);var availTd=ZP.create("td");availTd.appendChild(LeaveCompensatory.View.showCompOffStatus(recJson)),tr.appendChild(availTd);var unit=recJson.isHourType?ZPI18N.getString("zp.shours"):ZPI18N.getString("zp.leavetype.daysinfo"),report=["credited","availed","balance"];for(var key in report){var field=report[key],td=ZP.create("td"),info=ZP.create("span"),txt="-";txt=recJson.isHourType?recJson[field]&&2!=recJson.approval_status&&0!=recJson.approval_status?Leave.Util.convertToHoursandMinutes(recJson[field])+" ":"-":recJson[field]&&2!=recJson.approval_status&&0!=recJson.approval_status?recJson[field]+" ":"-",info.appendChild(ZP.create("em",{text:txt})),"-"!=txt&&info.appendChild(ZP.create("small",{text:unit})),td.appendChild(info),tr.appendChild(td)}tr.appendChild(td);var reasonTd=ZP.create("td"),reasonDiv=ZP.create("div",{class:"tooltip-js","data-title-position":"bottom",title:recJson.desc}),reasonSpan=ZP.create("span",{text:recJson.desc?recJson.desc:"",class:"txttrim w150"});reasonDiv.appendChild(reasonSpan),reasonTd.appendChild(reasonDiv),tr.appendChild(reasonTd),temp_doc.appendChild(tr)}tbody.append(temp_doc),tbody.ztooltip(),settingsPage.container.find("tbody#compRecordContainer").off("click").on("click","div.zcheckbox",function(){var data_body=$("tbody#compRecordContainer",settingsPage.container),status=!0,showDelete=!1,swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked")),data_body.find("input:checkbox").each(function(){$(this).is(":checked")?showDelete=!0:status=!1}),status?$(settingsPage.container.find(".headerSelect")).attr("checked","checked").prop("checked",!0):$(settingsPage.container.find(".headerSelect")).attr("checked","").prop("checked",!1),LeaveAdminOpers.Util.showBulkDelete(showDelete)}),settingsPage.container.find("thead").off("click").on("click","div.zcheckbox",function(){var data_body=$(".zpl_tblres",settingsPage.container),swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"));var status=$(settingsPage.container.find(".headerSelect")[0]).is(":checked");data_body.find("tbody#compRecordContainer").find("input:checkbox").each(function(){$(this).parent().hasClass("disabled")||(this.checked=status)}),LeaveAdminOpers.Util.showBulkDelete(status)})}LeaveAdminOpers.Util.removeLoading()},showCompOffStatus:function(recJson){if(recJson.is_leave_taken)return ZP.create("span",{text:ZPI18N.getString("zp.leave.availed")});if(recJson.isexpired)return ZP.create("span",{text:ZPI18N.getString("zp.expired")});if(recJson.isbookable){var href="";href=LVUtil.Tab.isMyPage()?"#leavetracker/mydata/compensatory/book-recordId:"+recJson.rec_id:LVUtil.Tab.isTeamPage()?"#leavetracker/team/compensatory/book-recordId:"+recJson.rec_id:LVUtil.Tab.isUserPage()?"#leavetracker/team/user/compensatory/book-recordId:"+recJson.rec_id:LVUtil.Tab.isOpersUserPage()?"#operations/leavetracker/user/compensatory/book-recordId:"+recJson.rec_id:"#operations/leavetracker/compensatory/book-recordId:"+recJson.rec_id;var ele=ZP.create("a",{href:href});return ele.appendChild(ZP.create("button",{text:ZPI18N.getString("zp.leave.compensatory.bookcompoff"),class:"zlabel zlabel--blue zlabel--outline zlabel--small",id:"bookCompOff"})),ele}return 1==recJson.approval_status||-2==recJson.approval_status?ZP.create("span",{text:ZPI18N.getString("zp.approved")}):0==recJson.approval_status?ZP.create("span",{text:ZPI18N.getString("zp.rejected")}):2==recJson.approval_status?ZP.create("span",{text:ZPI18N.getString("zp.cancelled")}):-3==recJson.approval_status?ZP.create("span",{text:ZPI18N.getString("zp.leave.compensatory.notsubmitted")}):ZP.create("span",{text:ZPI18N.getString("zp.waitingmsg")})}},Add:{expiresAfter:0,expiryUnit:"",html:function(){var modalParams={id:"compensatory_add_edit_view",cardId:"compensatory_add_edit_cont"};modalParams.validate=LeaveCompensatory.Add.save;var addModal=new sliderModal(ZPI18N.getString("zp.addrequests"),modalParams);addModal.construct(),addModal.setCloseCallback(function(){addModal.remove()});var modal=$("#compensatory_add_edit_view",settingsPage.container);modal.attr({"aria-label":ZPI18N.getString("zp.common.addreqpage"),tabindex:"0"}),modal.focus(),modal.hide(),modal.find(".zpl_mfoter").find("#sliderSbt").text(ZPI18N.getString("zp.submit")),modal.find("#compensatory_add_edit_cont").css("position","relative");var filterObj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,config=filterObj.Compensatory_Configuration;modal.find(".zpl_mcnt").html(LeaveCompensatory.getCompOffForm()),LeaveCompensatory.Add.pageInit(config,modal),$(".credited_field",settingsPage.container).addClass("DN"),LVSettings.Util.userInputSelect2(modal.find("[name=employee]"),void 0,void 0,modal.find("#compensatory_add_edit_cont"),void 0,"400px");var emp=LVUtil.urls.getCurrentPageUser(),empObj=ZP.getUserDetailsById(emp);void 0!=empObj&&ZPeopleComponents.select(modal.find("[name=employee]")).setValues({id:empObj.id,text:empObj.name,html:ZPUtil.escapeHtml(empObj.name),photo:empObj.photo}),(LVUtil.Tab.isMyPage()||LVUtil.Tab.isUserPage())&&(modal.find("[name=employee]").parent().find(".zselectbox").addClass("disabled"),modal.find("[name=employee]").parent().parent().hide());LeaveAdminOpers.ZPeopleComponents.DateField.init({container:modal.find("[name=date]"),appendTo:"#compensatory_add_edit_cont",pickerDateCB:function(){LeaveCompensatory.Add.changeExpiry($("[name=date]",modal)),LeaveCompensatory.fetchAndShowAttendanceDetails()}}),modal.find("input[name=unit]").on("click",function(event){"day"==$(this).attr("id")?modal.find("input#hour").prop("checked",!1):modal.find("input#day").prop("checked",!1),LeaveCompensatory.Add.switchDuration(this)});var optArray=[];optArray.push({label:ZPI18N.getString("zp.fullday"),value:"0"}),optArray.push({label:ZPI18N.getString("zp.halfday"),value:"1"}),optArray.push({label:ZPI18N.getString("zp.quarterday"),value:"2"}),LeaveAdminOpers.ZPeopleComponents.Select.init({container:modal.find("[name=compoff_type]"),optArray:optArray,defVal:0,appendTo:"#compensatory_add_edit_cont"}),LeaveAdminOpers.ZPeopleComponents.TimeField.init({container:modal.find("[name=comp_fromtime]"),format:Leave.Util.is24HrTimeFormat()?"HH:mm":"hh:mm tt",width:"165",minStep:15,onChangeCB:LeaveCompensatory.Add.regFromToChange}),modal.find("#comp_fromtime").next().attr("title",ZPI18N.getString("zp.from")),LeaveAdminOpers.ZPeopleComponents.TimeField.init({container:modal.find("[name=comp_totime]"),format:Leave.Util.is24HrTimeFormat()?"HH:mm":"hh:mm tt",width:"165",minStep:15,onChangeCB:LeaveCompensatory.Add.regFromToChange}),modal.find("#comp_totime").next().attr("title",ZPI18N.getString("zp.to")),LeaveAdminOpers.ZPeopleComponents.TimeField.init({container:modal.find("[name=compoff_hours]"),format:"HH:mm",width:"165",minStep:15}),LeaveAdminOpers.ZPeopleComponents.DateField.init({container:modal.find("[name=expiry]"),appendTo:"#compensatory_add_edit_cont"}),modal.find("[name=employee]").on("zselectchange",function(event){ZPeopleComponents.datefield($("[name=expiry]",modal)).setValue(LeaveAdminOpers.Util.getCurrentLYear(ZP.getUserDetailsById($(this).val()).location).to)});var location=filterObj.curuser.location,expiry=$("[name=expiry]",modal);ZPeopleComponents.datefield($("[name=expiry]",modal)).setValue(LeaveAdminOpers.Util.getCurrentLYear(location).to),filterObj.isdataadmin||expiry.next().addClass("disabled"),LeaveCompensatory.Add.pageInit(config,modal);$("[name=employee]",modal);var date=$("[name=date]",modal);(modal.find("[name=employee]").on("zselectchange",function(event){LeaveCompensatory.Add.suggestWorkedDate($(this),$(date),modal)}),modal.find("[name=comp_fromtime],[name=comp_totime]").on("zselectchange",function(){var hours=modal.find("[name=compoff_hours]"),from=ZPeopleComponents.timefield(modal.find("[name=comp_fromtime]")).getValue().dateString,to=ZPeopleComponents.timefield(modal.find("[name=comp_totime]")).getValue().dateString,mins=Leave.Util.getTimeDiff(from,to);ZPeopleComponents.timefield(hours).setValue(Leave.Util.convertToHoursandMinutes(mins))}),modal.find("[name=employee]").trigger("zselectchange"),modal.show(),modal.ztooltip(),(LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()||LVUtil.Tab.isGlobalSearchUserPage())&&modal.find("[name=employee]").parent().parent().hide(),modal.find("#sliderCancel").attr({"aria-label":ZPI18N.getString("zp.close")+ZPI18N.getString("zp.common.cancelpopup"),tabindex:"0"}),modal.find("#sliderSbt").attr({"aria-label":ZPI18N.getString("zp.submit"),tabindex:"0"}),void 0!=Leave&&Leave.isEmbed)&&(modal.find("#sliderCancel").remove(),modal.find(".zpl_secn").removeClass("w400"),modal.find(".PI_cls").remove(),modal.addClass("zpl_mfull").css({top:0,bottom:0,left:0,right:0,padding:0}),modal.find(".zpl_crdcnt").removeClass("zpl_crdinfo"),modal.find(".zpl_crd").addClass("wd100_per"),modal.find(".zpl_secn.zpl_twoclum.time_component").find("[title='From']").css("width",""),modal.find(".zpl_secn.zpl_twoclum.time_component").find("[title='To']").css("width",""))},pageInit:function(config,modalhtml,record){var duration_component=$("[name=compoff_type]",modalhtml),time_component=$(".time_component",modalhtml);"both"==config.unit||"hour"==config.unit?$(".PI_info").removeClass("DN"):$(".PI_info").addClass("DN"),"both"==config.unit?($("#unit_choice",modalhtml).removeClass("DN"),$("#unit_fixed",modalhtml).addClass("DN")):($("#unit_choice",modalhtml).addClass("DN"),$("#unit_fixed",modalhtml).removeClass("DN").html("<em>"+("hour"==config.unit?ZPI18N.getString("zp.leavetype.hour"):ZPI18N.getString("zp.cday"))+"</em>"),"hour"==config.unit&&($("[value=Hours][type=radio]",modalhtml).trigger("click"),$("#duration_choice",modalhtml).removeClass("DN"),$("#duration_fixed",modalhtml).addClass("DN"))),record?($("#duration_fixed",modalhtml).addClass("DN"),$("#duration_choice",modalhtml).removeClass("DN")):"both"!=config.unit&&"day"!=config.unit||(config.ishalfday_allowed||config.isquarterday_allowed?config.isfullday_allowed||config.isquarterday_allowed?config.isfullday_allowed||config.ishalfday_allowed?($("#duration_choice",modalhtml).removeClass("DN"),$("#duration_fixed",modalhtml).addClass("DN"),config.isfullday_allowed||(ZPeopleComponents.select(duration_component).removeOption(0),ZPeopleComponents.select(duration_component).setValue("1")),config.ishalfday_allowed||ZPeopleComponents.select(duration_component).removeOption(1),config.isquarterday_allowed||ZPeopleComponents.select(duration_component).removeOption(2)):($("#duration_fixed",modalhtml).removeClass("DN").html("<em>"+ZPI18N.getString("zp.quarterday")+"</em><span class='ztextbox--error__label'></span>"),$("#duration_choice",modalhtml).addClass("DN"),ZPeopleComponents.select(duration_component).setValue("2")):($("#duration_fixed",modalhtml).removeClass("DN").html("<em>"+ZPI18N.getString("zp.halfday")+"</em><span class='ztextbox--error__label'></span>"),$("#duration_choice",modalhtml).addClass("DN"),ZPeopleComponents.select(duration_component).setValue("1")):($("#duration_fixed",modalhtml).removeClass("DN").html("<em>"+ZPI18N.getString("zp.fullday")+"</em><span class='ztextbox--error__label'></span>"),$("#duration_choice",modalhtml).addClass("DN"))),config.time?time_component.removeClass("DNI"):time_component.addClass("DNI");var reason_component=$("#reasonLabel",modalhtml);config.mandate_reason&&reason_component.addClass("zpl_mtry")},regFromToChange:function(){var ele=$("#compensatory_add_edit_view",settingsPage.container),hours=ele.find("[name=compoff_hours]"),from=ZPeopleComponents.timefield(ele.find("[name=comp_fromtime]")).getValue().dateString,to=ZPeopleComponents.timefield(ele.find("[name=comp_totime]")).getValue().dateString,mins=Leave.Util.getTimeDiff(from,to);ZPeopleComponents.timefield(hours).setValue(Leave.Util.convertToHoursandMinutes(mins))},switchDuration:function(ele){var modal=$("#compensatory_add_edit_view",settingsPage.container),type=$("[name=type]",modal).parent(),duration=$("[name=duration]",modal).parent();"day"==$(ele).attr("id")?(type.removeClass("DN"),!duration.hasClass("DN")&&duration.addClass("DN")):(duration.removeClass("DN"),!type.hasClass("DN")&&type.addClass("DN"))},suggestWorkedDate:function(employee,date,modal){var params={key:"suggestDate"};params.employee=ZPeopleComponents.select(employee).getValue();var loc=ZP.getUserDetailsById(params.employee).location;params.location=loc+""=="null"?-1:loc,ZPeople.Request.send("/leave_common_action.zp",params,function(resp){LeaveCompensatory.Add.expiresAfter=parseInt(resp.expiresAfter),LeaveCompensatory.Add.expiryUnit=resp.expiryUnit,ZPeopleComponents.datefield(date).setValue(resp.date),LeaveCompensatory.showAttendanceDetails(resp.attendance_details,modal),LeaveCompensatory.Add.changeExpiry(date)})},changeExpiry:function(ele){if(!(LeaveCompensatory.Add.expiresAfter<=0)){var dateStr=ZPeopleComponents.datefield($(ele)).getValue().dateString;if("M"==LeaveCompensatory.Add.expiryUnit||"D"==LeaveCompensatory.Add.expiryUnit){dateStr=void 0!==dateStr?dateStr:"";var date=Calendar.parseDate(dateStr,uidateFormat);"D"==LeaveCompensatory.Add.expiryUnit?date.setDate(date.getDate()+LeaveCompensatory.Add.expiresAfter):date.setMonth(date.getMonth()+LeaveCompensatory.Add.expiresAfter),date=Calendar.formatDate(date),ZPeopleComponents.datefield($("#compensatory_add_edit_view",settingsPage.container).find("input[name=expiry]")).setValue(date),$("#compensatory_add_edit_view",settingsPage.container).find("input[name=expiry]").next().removeClass("has-focus")}else if("WD"==LeaveCompensatory.Add.expiryUnit){var modal=$("#compensatory_add_edit_view",settingsPage.container),params={key:"get_compoff_expirydate"},isEdit=$(".zpl_crd",modal).data("rec_id");params.employee=isEdit?$(".zpl_crd",modal).data("employee"):ZPeopleComponents.select($("[name=employee]",modal)).getValue();var loc=ZP.getUserDetailsById(params.employee).location;params.location=loc+""=="null"?-1:loc,params.date=dateStr,ZPeople.Request.send("/leave_common_action.zp",params,function(resp){ZPeopleComponents.datefield($("[name=expiry]",modal)).setValue(resp.date),$("input[name=expiry]",modal).next().removeClass("has-focus")})}}},save:function(){var modal=$("#compensatory_add_edit_view",settingsPage.container);modal.find("#sliderSbt").addClass("disabled");var employee=ZPeopleComponents.select($("[name=employee]",modal)).getValue(),date=ZPeopleComponents.datefield($("[name=date]",modal)).getValue().dateString,unit=$("[name=unit]:checked",modal).attr("id"),type=ZPeopleComponents.select($("[name=compoff_type]",modal)).getValue(),duration=ZPeopleComponents.timefield($("[name=compoff_hours]",modal)).getValue().dateString,startTime=ZPeopleComponents.timefield($("[name=comp_fromtime]",modal)).getValue().dateString,endTime=ZPeopleComponents.timefield($("[name=comp_totime]",modal)).getValue().dateString,credited=$("[name=credited]",modal).val(),expiry=ZPeopleComponents.datefield($("[name=expiry]",modal)).getValue().dateString,description=$("[name=description]",modal).val(),params={key:"compensatory_add"},rec_id=$(".zpl_crd",modal).data("rec_id");employee=rec_id?$(".zpl_crd",modal).data("employee"):employee;var count=1;if(params.rec_id=rec_id,$.each(modal.find(".ztextbox__error"),function(){$(this).removeClass("ztextbox__error")}),$.each(modal.find("span.ztextbox--error__label"),function(){$(this).text("")}),!(date&&Calendar.isvalidDate(date)&&expiry&&Calendar.isvalidDate(expiry)))return expiry&&Calendar.isvalidDate(expiry)?($("[name=date]",modal).siblings("div#date-container").addClass("ztextbox__error"),$("[name=date]",modal).siblings("span.ztextbox--error__label").text(ZPI18N.getString("zp.validdateerr")).show(),void modal.find("#sliderSbt").removeClass("disabled")):($("[name=expiry]",modal).siblings("div#expiry-container").addClass("ztextbox__error"),$("[name=expiry]",modal).siblings("span.ztextbox--error__label").text(ZPI18N.getString("zp.validdateerr")).show(),void modal.find("#sliderSbt").removeClass("disabled"));if(LeaveCompensatory.Add.hideError(modal),"day"==unit)"1"==type?count=.5:"2"==type&&(count=.25);else{if(0==(count=Leave.Util.convertHourstoMinutes(duration)))return $("[name=compoff_hours]",modal).siblings("div#compoff_hours-container").addClass("ztextbox__error"),$("[name=duration]",modal).find("span.ztextbox--error__label").text(ZPI18N.getString("zp.leave.compensatory.hourseerr")).show(),void modal.find("#sliderSbt").removeClass("disabled");type="3"}params.type=parseInt(type),params.date=date,params.count=count;var start=0,end=0;if(ZPUtil.Validation.isEmpty(startTime)&&ZPUtil.Validation.isEmpty(endTime))$("[name=timeDiv]",modal).children("span.ztextbox--error__label").text("");else{if(ZPUtil.Validation.isEmpty(startTime)||ZPUtil.Validation.isEmpty(endTime)||startTime==endTime)return ZPUtil.Validation.isEmpty(startTime)?$("div#comp_fromtime-container").addClass("ztextbox__error"):$("div#comp_totime-container").addClass("ztextbox__error"),$("[name=timeDiv]",modal).children("span.ztextbox--error__label").text(ZPI18N.getString("zp.entervalidtime")).show(),void modal.find("#sliderSbt").removeClass("disabled");$("[name=timeDiv]",modal).children("span.ztextbox--error__label").text(""),start=Leave.Util.convertTimetoMinutes(startTime),end=Leave.Util.convertTimetoMinutes(endTime)}params.startTime=start,params.endTime=end,!ZPUtil.Validation.isEmpty(credited)&&(params.credited=credited),params.employee=employee,params.description=description,params.expiry=expiry,params[csrfParamName]=csrfToken,params.save_expiry_only=modal.find(".zpl_crd").data("save_expiry_only"),params.save_expiry_only=!!params.save_expiry_only&&params.save_expiry_only,LeaveCompensatory.Add.validateData(params)?ZPeople.Request.send(LeaveAdminOpers.viewUrl,params,LeaveCompensatory.Add.checkAndChange,{}):modal.find("#sliderSbt").removeClass("disabled")},validateData:function(params){var config=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.Compensatory_Configuration,errors={};if(params.rec_id&&(isNaN(params.credited)||params.credited<0)&&(errors.credited=ZPI18N.getString("zp.leave.onlypositivevalues")),config.mandate_reason&&(""==params.description||""==params.description.trim()?errors.description=ZPI18N.getString("zp.enterareason"):$("#compensatory_add_edit_view",settingsPage.container).find("[name=description]").removeClass("ztextbox__error")),_.size(errors)>0){var modalhtml=$("#compensatory_add_edit_view",settingsPage.container);return LeaveCompensatory.Add.showError(errors,modalhtml),!1}return!0},checkAndChange:function(result){if("success"===result.status)void 0!=Leave&&Leave.isEmbed?($("#compensatory_add_edit_view").attr("style","display:none"),$("#status").addClass("zalertbanner zalertbanner--success"),$("#status").append('<span class="zalertbanner__text">Record added Successfully</span>')):($("#compensatory_add_edit_view",settingsPage.container).modal("hide"),LeaveCompensatory.refresh=!0,LeaveCompensatory.RecordView.get(result.rec_id));else if("VALIDATIONERROR"===result.status){var errors=result.error,modalhtml=$("#compensatory_add_edit_view",settingsPage.container);LeaveCompensatory.Add.showError(errors,modalhtml)}},showError:function(errors,parent){for(var elename in errors)if("showInfo"==elename)parent.find("i.PI_info").siblings("div.popover").is(":visible")||parent.find("i.PI_info").trigger("click"),parent.find("#sliderSbt").removeClass("disabled");else if("duration"==elename||"timeDiv"==elename||"hourpicker"==elename){var errortxt=errors[elename];(eles="duration"==elename?parent.find("[name="+elename+"]").find("[name=hourpicker]"):parent.find("[name="+elename+"]")).children("span.ztextbox--error__label").text(errortxt).show(),eles.children("div").length>0?eles.children("div").addClass("ztextbox__error"):eles.addClass("ztextbox__error"),parent.find("#sliderSbt").removeClass("disabled")}else{var eles;errortxt=errors[elename];(eles=parent.find("[name="+elename+"]")).siblings("span.ztextbox--error__label").text(errortxt).show(),eles.siblings("div").length>0?eles.siblings("div").addClass("ztextbox__error"):eles.addClass("ztextbox__error"),parent.find("#sliderSbt").removeClass("disabled")}},hideError:function(parent){parent.find("span.ztextbox--error__label").hide()}},Edit:{get:function(rec_id){if($.isEmptyObject(LeaveCompensatory.recordData)){var params={key:"compensatory_record"};params.rec_id=rec_id,params[csrfParamName]=csrfToken,ZPeople.Request.send(LeaveAdminOpers.viewUrl,params,LeaveCompensatory.Edit.html,{})}else LeaveCompensatory.Edit.html(LeaveCompensatory.recordData)},html:function(result){var modalParams={id:"compensatory_add_edit_view",cardId:"compensatory_add_edit_cont"};modalParams.validate=LeaveCompensatory.Add.save;var editModal=new sliderModal(ZPI18N.getString("zp.editrequest"),modalParams);editModal.construct(),editModal.setCloseCallback(function(){LeaveCompensatory.View.changeUrl(),editModal.remove()});var ele=$("#compensatory_add_edit_view",settingsPage.container);ele.find(".zpl_mfoter").find("#sliderSbt").text(ZPI18N.getString("zp.submit")),ele.find("#compensatory_add_edit_cont").css("position","relative"),LeaveCompensatory.Add.expiresAfter=parseInt(result.expiresAfter),LeaveCompensatory.Add.expiryUnit=result.expiryUnit;var record=result.data,modalbody=ele,filterObj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,config=filterObj.Compensatory_Configuration;if(!record.allowEdit)return ele.find(".zpl_mcnt").append('<div id="zp_empty_data"></div>'),record.error_msg?LeaveAdminOpers.Util.showHideNoData(!0,record.error_msg,ele.find(".zpl_mcnt")):LeaveAdminOpers.Util.showHideNoData(!0,ZPI18N.getString("zp.leave.compensatory.editerror"),ele.find(".zpl_mcnt")),ele.show(),void(LeaveCompensatory.recordData={});ele.find(".zpl_mcnt").html(LeaveCompensatory.getCompOffForm()),ele.find(".zpl_crd").data("rec_id",record.rec_id),ele.find(".zpl_crd").data("employee",record.employee),LVSettings.Util.userInputSelect2(ele.find("[name=employee]"));var empObj=ZP.getUserDetailsById(record.employee);ZPeopleComponents.select(ele.find("[name=employee]")).setValues({id:record.employee,text:empObj.name,html:ZPUtil.escapeHtml(empObj.name),photo:empObj.photo}),(LVUtil.Tab.isMyPage()||LVUtil.Tab.isUserPage())&&(ele.find("[name=employee]").parent().find(".zselectbox").addClass("disabled"),ele.find("[name=employee]").parent().parent().hide());LeaveAdminOpers.ZPeopleComponents.DateField.init({container:ele.find("[name=date]"),pickerDateCB:function(){LeaveCompensatory.Add.changeExpiry($("[name=date]",ele)),LeaveCompensatory.fetchAndShowAttendanceDetails()},appendTo:"#compensatory_add_edit_view"}),ZPeopleComponents.datefield($("[name=date]",ele)).setValue(record.date),ele.find("input[name=unit]").on("click",function(event){"day"==$(this).attr("id")?ele.find("input#hour").prop("checked",!1):ele.find("input#day").prop("checked",!1),LeaveCompensatory.Add.switchDuration(this)});var optArray=[];optArray.push({label:ZPI18N.getString("zp.fullday"),value:"0"}),optArray.push({label:ZPI18N.getString("zp.halfday"),value:"1"}),optArray.push({label:ZPI18N.getString("zp.quarterday"),value:"2"}),LeaveAdminOpers.ZPeopleComponents.Select.init({container:ele.find("[name=compoff_type]"),optArray:optArray,defVal:0});var type=$("[name=compoff_type]",ele);record.type<3?ZPeopleComponents.select(type).setValue(record.type):"day"!=config.unit&&$("[name=unit][id=hour]",ele).trigger("click"),LeaveAdminOpers.ZPeopleComponents.TimeField.init({container:ele.find("[name=comp_fromtime]"),format:Leave.Util.is24HrTimeFormat()?"HH:mm":"hh:mm tt",width:"165",minStep:15,onChangeCB:LeaveCompensatory.Add.regFromToChange}),LeaveAdminOpers.ZPeopleComponents.TimeField.init({container:ele.find("[name=comp_totime]"),format:Leave.Util.is24HrTimeFormat()?"HH:mm":"hh:mm tt",width:"165",minStep:15,onChangeCB:LeaveCompensatory.Add.regFromToChange}),LeaveAdminOpers.ZPeopleComponents.TimeField.init({container:ele.find("[name=compoff_hours]"),format:"HH:mm",width:"165",minStep:15});var hours=ele.find("[name=compoff_hours]"),hasTime=record.startTime>0||record.endTime>0,startTime=hasTime?Leave.Util.convertMinutestoTime(record.startTime):void 0,endTime=hasTime?Leave.Util.convertMinutestoTime(record.endTime):void 0;void 0!=startTime&&ZPeopleComponents.timefield(ele.find("[name=comp_fromtime]")).setValue(startTime),void 0!=endTime&&ZPeopleComponents.timefield(ele.find("[name=comp_totime]")).setValue(endTime),record.isHourType&&ZPeopleComponents.timefield(hours).setValue(Leave.Util.convertToHoursandMinutes(record.applied)),LeaveAdminOpers.ZPeopleComponents.DateField.init({container:ele.find("[name=expiry]"),appendTo:"#compensatory_add_edit_view"}),ele.find("[name=employee]").on("zselectchange",function(event){ZPeopleComponents.datefield($("[name=expiry]",ele)).setValue(LeaveAdminOpers.Util.getCurrentLYear(ZP.getUserDetailsById($(this).val()).location).to)});var location=filterObj.curuser.location,expiry=$("[name=expiry]",ele);ZPeopleComponents.datefield($("[name=expiry]",ele)).setValue(LeaveAdminOpers.Util.getCurrentLYear(location).to),filterObj.isdataadmin||expiry.attr("disabled","disabled"),ZPeopleComponents.datefield($("[name=expiry]",ele)).setValue(record.expiry),$("[name=credited]",ele).val(3==record.type?record.credited/60:record.credited),$("[name=description]",ele).val(record.description);$("[name=employee]",ele);var date=$("[name=date]",ele);ele.find("[name=employee]").on("zselectchange",function(event){LeaveCompensatory.Add.suggestWorkedDate($(this),$(date),ele)}),ele.find("[name=comp_fromtime],[name=comp_totime]").on("zselectchange",function(){var hours=ele.find("[name=compoff_hours]"),from=ZPeopleComponents.timefield(ele.find("[name=comp_fromtime]")).getValue().dateString,to=ZPeopleComponents.timefield(ele.find("[name=comp_totime]")).getValue().dateString,mins=Leave.Util.getTimeDiff(from,to);ZPeopleComponents.timefield(hours).setValue(Leave.Util.convertToHoursandMinutes(mins))}),LeaveCompensatory.Edit.pageInit(record,config,modalbody),LeaveCompensatory.showAttendanceDetails(result.attendanceDetails,ele),LeaveCompensatory.recordData={},ele.find(".zpl_mcnt").scrollTop(0),ele.show(),ele.find("[name=expiry").next().removeClass("has-focus"),ele.find("[name=date]").next().addClass("has-focus")},pageInit:function(record,config,modalbody){if("both"==config.unit||"day"==config.unit&&record.type<3||"hour"==config.unit&&3==record.type)LeaveCompensatory.Add.pageInit(config,modalbody);else{$("[name=compoff_type]",modalbody);var time_component=$(".time_component",modalbody);if(3==record.type&&$("[value=Hours][type=radio]",modalbody).trigger("click"),"both"==config.unit||"hour"==config.unit?$(".PI_info").removeClass("DN"):$(".PI_info").addClass("DN"),$("#unit_choice, #duration_choice, #hour_duration_choice, #date_choice",modalbody).addClass("DN"),$("#date_fixed",modalbody).removeClass("DN").html("<em>"+record.date+"</em>"),$("#unit_fixed",modalbody).removeClass("DN").html("<em>"+(record.isHourType?ZPI18N.getString("zp.leavetype.hour"):ZPI18N.getString("zp.cday"))+"</em>"),$("#hour_duration_fixed, #duration_fixed",modalbody).removeClass("DN").html("<em>"+Leave.Compensatory.getDurationText(record)+"</em><span class='ztextbox--error__label'></span>"),config.time){var txt="-";(record.startTime>0||record.endTime>0)&&(txt=Leave.Util.convertMinutestoTime(record.startTime)+" - "+Leave.Util.convertMinutestoTime(record.endTime)),time_component.removeClass("DNI"),time_component.find("[name=fromtoTime]").remove(),time_component.append('<div class="col-sm-6 hrsDts PT5" name="fromtoTime"><span>'+txt+"</span></div>")}else time_component.addClass("DNI");modalbody.data("save_expiry_only",!0)}}},RecordView:{recordId:{},get:function(recordId){var params={key:"compensatory_record"};params.rec_id=recordId,params[csrfParamName]=csrfToken,ZPeople.Request.send(LeaveAdminOpers.viewUrl,params,LeaveCompensatory.RecordView.html,{})},html:function(result){$("#compensatory_add_edit_view",settingsPage.container).remove();var fields=["employee","date","fromtoTime","type","credited","expiry","description"],config=result.Compensatory_Configuration,modalParams={id:"compensatory_add_edit_view",cardId:"compensatory_add_edit_cont"},viewModal=new sliderModal(ZSEC.Encoder.encodeForHTML(result.formDisName),modalParams);if(viewModal.construct(),viewModal.setCloseCallback(function(){LeaveCompensatory.View.changeUrl(),viewModal.remove()}),"ERROR"==result.status)return viewModal.footerDiv.remove(),settingsPage.container.find(".zpl_mcnt").append('<div id="zp_empty_data"></div>'),void LeaveAdminOpers.Util.showHideNoData(!0,ZPI18N.getString("zp.permdeniedornodata"),settingsPage.container.find(".zpl_mcnt"));var modalhtml=$("#compensatory_add_edit_view",settingsPage.container);!config.time&&delete fields[2];var record=result.data;LeaveCompensatory.recordData=result;var approval=result.approvalDetails;if(record.allowEdit&&-1!=Layout.Page.hash.indexOf("leavetracker"))LeaveCompensatory.RecordView.addEditIcon(modalhtml,record.rec_id);else{$('<span id="edit_icon" class="zpl_mhderrgt a-itm-cntr CP"></span>').insertBefore(modalhtml.find(".zpl_mhder .PI_cls"))}var compViewHtmls='<div class="zpl_crd"> <div class="zpl_crdcnt zpl_crdinfo"><div class="">';for(var field in compViewHtmls+='<div class="zpl_secn w400"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.leave.operations.employeename")+'</label></div><div name="employee"></div></div>',compViewHtmls+='<div class="zpl_secn w400"><div id="Date"><label class="zpl_mtry">'+ZPI18N.getString("zp.leave.operations.workeddate")+'</label></div><div name="date"></div></div>',compViewHtmls+='<div class="zpl_secn w400"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.duration")+'</label></div><div name="type" id="duration_choice"></div></div>',compViewHtmls+='<div class="zpl_secn zpl_twoclum time_component zpl_idivingrp"><div name="timeDiv"><label>'+ZPI18N.getString("zp.leave.operations.workedtime")+'</label><div name="fromtoTime"></div></div></div>',compViewHtmls+='<div class="zpl_secn credited_field w400"><div><label>'+ZPI18N.getString("zp.leave.customform.credited")+'</label></div><div name="credited"></div></div>',compViewHtmls+='<div class="zpl_secn w400"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.local.Expirydate")+'</label></div><div name="expiry"></div></div>',compViewHtmls+='<div class="zpl_secn w400"><div> <label id="reasonLabel">'+ZPI18N.getString("zp.reason")+'</label> </div><div name="description"></div></div>',compViewHtmls+="</div>",compViewHtmls+='<div class="MLauto"><div class="zpl_info" id="attendance_detail"><div><h6><b>'+ZPI18N.getString("zp.leave.compensatory.attendancedetails")+'</b></h6><div><table class="zpl_itbl"><tbody><tr><td width="90"><em>'+ZPI18N.getString("zp.leave.operations.firstin",[""])+'</em></td><td><b id="firstIn"></b></td></tr><tr><td><em>'+ZPI18N.getString("zp.leave.operations.lastout",[""])+'</em></td><td><b id="lastOut"></b></td></tr><tr><td><em>'+ZPI18N.getString("zp.overtime")+'</em></td><td><b id="overTime"></b></td></tr><tr><td><em>'+ZPI18N.getString("zp.stotalhours")+'</em></td><td><b id="totalHours"></b></td></tr></tbody></table></div></div></div>',compViewHtmls+='<div class="zpl_info zpl_secn DNI" id="zp_leave_details"><div><h6><b>'+ZPI18N.getString("zp.leave.compensatory.leavedetails")+'</b></h6><div><table class="zpl_itbl"><tbody id="leave_details_body"></tbody></table></div></div></div></div>',compViewHtmls+="</div></div>",modalhtml.find(".zpl_mcnt").html(compViewHtmls),modalhtml.find(".zpl_mhder #edit_icon").prepend($('<div id="headerApprovalBtn"></div>')),LeaveCompensatory.Add.pageInit(config,modalhtml,record),fields){var name=fields[field],eleparent=modalhtml.find("[name="+name+"]");if("employee"===name)eleparent.append(ZP.create("span",{text:record.empname}));else if("date"===name)eleparent.append(ZP.create("span",{text:record.date}));else if("fromtoTime"===name){var txt="-";(record.startTime>0||record.endTime>0)&&(txt=Leave.Util.convertMinutestoTime(record.startTime)+" - "+Leave.Util.convertMinutestoTime(record.endTime)),eleparent.append(ZP.create("span",{text:txt}))}else"type"==name?eleparent.append(ZP.create("span",{text:Leave.Compensatory.getDurationText(record)})):"credited"==name?eleparent.append(ZP.create("span",{text:2==record.approvalStatus||0==record.approvalStatus?"-":3==record.type?record.credited/60:record.credited})):eleparent.append(ZP.create("span",{text:record[name]?record[name]:"-"}))}LeaveCompensatory.showAttendanceDetails(result.attendanceDetails,modalhtml);var leavebody=modalhtml.find(".zpl_mcnt #leave_details_body"),leavedata=record.leavedata;if($.each(leavedata,function(indx){var dateTd,fromtoTd,data=leavedata[indx],taken=data.isHour?parseFloat(data.taken/60).toFixed(2)+" "+ZPI18N.getString("zp.shours"):data.taken+" "+ZPI18N.getString("zp.leavetype.daysinfo"),date=ZP.create("tr"),count=ZP.create("tr"),status=ZP.create("tr");data.from!=data.to?((dateTd=ZP.create("td",{style:"width=90"})).appendChild(ZP.create("em",{text:ZPI18N.getString("zp.local.Leaveperiod")})),date.appendChild(dateTd),(fromtoTd=ZP.create("td",{style:"width=90"})).appendChild(ZP.create("b",{text:data.from+" "+ZPI18N.getString("zp.to")+" "+data.to})),date.appendChild(fromtoTd)):((dateTd=ZP.create("td",{style:"width=90"})).appendChild(ZP.create("em",{text:ZPI18N.getString("zp.leaveperiod")})),date.appendChild(dateTd),(fromtoTd=ZP.create("td",{style:"width=90"})).appendChild(ZP.create("b",{text:data.from})),date.appendChild(fromtoTd));var countTd=ZP.create("td");countTd.appendChild(ZP.create("em",{text:ZPI18N.getString("zp.count")})),count.appendChild(countTd),(countTd=ZP.create("td")).appendChild(ZP.create("em",{text:taken})),count.appendChild(countTd);var statusTd=ZP.create("td");statusTd.appendChild(ZP.create("em",{text:ZPI18N.getString("zp.status")})),status.appendChild(statusTd),(statusTd=ZP.create("td")).appendChild(ZP.create("em",{text:data.approvalStatus?Leave.Util.getStatusText(data.approvalStatus):""})),status.appendChild(statusTd),leavebody.append(date),leavebody.append(count),leavebody.append(status),leavebody.append("<tr><td colspan='2'><hr></td></tr>")}),leavebody.find("tr:last-child").remove(),leavedata.length>0&&modalhtml.find(".zpl_mcnt #zp_leave_details").removeClass("DNI"),modalhtml.find("#sliderSbt").hide(),modalhtml.find("#sliderCancel").text(ZPI18N.getString("zp.close")),modalhtml.find("#sliFootDiv").prepend('<div id="zp_appproval_container"></div>'),modalhtml.show(),LeaveCompensatory.RecordView.recordId=record.rec_id,approval&&2!=record.approvalStatus){OPApprovals.Common.RecordOwner.setOwner(record.rec_id,[approval.recOwner]),OPApprovals.Common.RecordOwner.setAddedBy(record.rec_id,record.employee);let apprParam=new ApprovalParam(approval.formId,record.rec_id,approval.tableName,record.approvalStatus,approval.isRecordAdmin),layoutParam=new LayoutParam(modalhtml,modalhtml.find(".zpl_mhder"),modalhtml.find(".zpl_mfoter"),"Compensatory");new ApprovalRecordHeader(apprParam,layoutParam,{isRecordApprover:approval.isOwner,isPrimaryApprover:approval.isPrimaryAppr}).show()}modalhtml.find(".zlabel.zlabel--outline").hide(),modalhtml.find("#zp_appproval_container").append('<button type="button" class="zlabel zlabel--outline zlabel--medium" id="sliderCancel" onclick="">'+ZPI18N.getString("zp.close")+"</button>"),record.allowCancel&&modalhtml.find("#zp_appproval_container").append('<button class="zlabel zlabel--red zlabel--outline zlabel--medium" type="button" onclick="LeaveCompensatory.cancelCompoffWarning();" approvaltype="2">'+ZPI18N.getString("zp.cancelrecord")+"</button>"),(2==record.approvalStatus||approval&&(approval.canceledRecord||2==approval.currentApprovalStatus))&&modalhtml.find("#zp_appproval_container").append(ZP.create("button",{class:"zlabel zlabel--gray zlabel--outline zlabel--medium disabled",text:ZPI18N.getString("zp.cancelledrecord")})),modalhtml.find("#sliderCancel").off("click").on("click",function(){LeaveCompensatory.removeModal(),LeaveCompensatory.View.changeUrl()})},addEditIcon:function(modalhtml,rec_id){var actionSpan=ZP.create("span",{id:"edit_icon",class:"zpl_mhderrgt a-itm-cntr CP"}),edit=ZP.create("a",{class:"zpl_ibg PI_edt"});$(edit).on("click",edit,function(){var ele=$("#compensatory_add_edit_view",settingsPage.container);ele.length&&(ele.hide(),ele.remove()),LeaveCompensatory.Edit.get(rec_id)}),$(actionSpan).append(edit),modalhtml.find(".zpl_mhder").find("#edit_icon").remove(),$(actionSpan).insertBefore(modalhtml.find(".zpl_mhder .PI_cls"))}},fetchAndShowAttendanceDetails:function(){var modal=$("#compensatory_add_edit_view",settingsPage.container),employee=$(".zpl_crd",modal).data("rec_id")?$(".zpl_crd",modal).data("employee"):ZPeopleComponents.select($("[name=employee]",modal)).getValue(),params={key:"fetch_attendance_info",date:ZPeopleComponents.datefield($("[name=date]",modal)).getValue().dateString,employee:employee};ZPeople.Request.send("/leave_common_action.zp",params,function(resp){LeaveCompensatory.showAttendanceDetails(resp.data,modal)})},showAttendanceDetails:function(attendanceDetails,modalhtml){attendanceDetails=attendanceDetails;var attedanceHtml=modalhtml.find("#attendance_detail"),firstIn="-",lastOut="-",overTime="-",totalHours="-";void 0!=attendanceDetails&&null!=attendanceDetails?(_.isEmpty(attendanceDetails)||(firstIn=attendanceDetails.fromDate?attendanceDetails.fromDate+" "+attendanceDetails.firstIn:ZP.optValue(attendanceDetails,"firstIn","-"),lastOut=attendanceDetails.toDate?attendanceDetails.toDate+" "+attendanceDetails.lastOut:ZP.optValue(attendanceDetails,"lastOut","-"),overTime=attendanceDetails.overTime?attendanceDetails.overTime+" "+ZPI18N.getString("zp.hours"):"-",totalHours=attendanceDetails.totalHours?attendanceDetails.totalHours+" "+ZPI18N.getString("zp.hours"):"-"),attedanceHtml.find("#firstIn").html(firstIn),attedanceHtml.find("#lastOut").html(lastOut),attedanceHtml.find("#overTime").html(overTime),attedanceHtml.find("#totalHours").html(totalHours),attedanceHtml.removeClass("DN")):attedanceHtml.addClass("DN")},cancelCompoffWarning:function(){var cancelCompOffModal=new DeleteAlertMessage;cancelCompOffModal.title=ZPI18N.getString("zp.confirm"),cancelCompOffModal.despcription=ZPI18N.getString("zp.leave.operations.cancelcompoffinfo"),cancelCompOffModal.yesButtonText=ZPI18N.getString("zp.confirm"),cancelCompOffModal.cancelButtonText=ZPI18N.getString("zp.cancel"),cancelCompOffModal.callback=function(){LeaveCompensatory.cancelCompoff()},cancelCompOffModal.construct("--blue","success")},cancelCompoff:function(){var calcelCont=$(".zpl_malrtmsg",settingsPage.container);calcelCont.find(".zpl_mfoter").find("#yesBtn").attr("disabled","disabled");var params={key:"cancel_compoff",id:LeaveCompensatory.RecordView.recordId};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){"success"===result.status&&(result.data?(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.leave.operations.cancelmsg",[ZPI18N.getString("zp.tt.compensatoryoff")])),$("#compensatory_add_edit_view",settingsPage.container).remove(),LeaveCompensatory.switchToRecView()):(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.notallowedtoedit")),calcelCont.find(".zpl_mfoter").find("#yesBtn").prop("disabled",!1))),calcelCont.find(".zpl_mfoter").find("#yesBtn").prop("disabled",!1)})},switchToRecView:function(){LVUtil.Tab.isCompOff()&&(LeaveCompensatory.refresh=!0,LeaveCompensatory.View.get())},loadExtraInfo:function(){var data=ZP5Form.LAYOUT.data("record").extraDetails,extrainfo=$("#zp_formcompoff_extrainfo",ZP5Form.LAYOUT),fields=["duration"];ZP5Form.CONF.time_enabled&&(fields[1]="time"),$(fields).each(function(indx){var field=ZP.create("div",{class:"form-group",id:fields[indx]}),div=ZP.create("div",{class:"col-sm-6 PT5"}),label=ZP.create("label",{class:"control-label col-sm-3 MT1 zp_mdt"});if("duration"==fields[indx])label.appendChild(ZP.create("font",{text:document.createTextNode(ZPI18N.getString("zp.duration"))})),div.appendChild(ZP.create("span",{text:LeaveCompensatory.getDurationText(data)}));else{label.appendChild(document.createTextNode(ZPI18N.getString("zp.time")));var txt="-";(data.fromTime>0||data.toTime>0)&&(txt=Leave.Util.convertMinutestoTime(data.fromTime)+" - "+Leave.Util.convertMinutestoTime(data.toTime)),div.appendChild(ZP.create("span",{text:txt}))}field.appendChild(label),field.appendChild(div),extrainfo.append(field)}),ZP5Form.LAYOUT.find("#zp_form_editin_singlerec").hide()},getDurationText:function(data){return 0==data.type?ZPI18N.getString("zp.fullday"):1==data.type?ZPI18N.getString("zp.halfday"):2==data.type?ZPI18N.getString("zp.quarterday"):Leave.Util.convertToHoursandMinutes(data.applied)+" "+ZPI18N.getString("zp.shours")},getCompOffForm:function(){var holidayDispName=ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name,compOffHtmls='<div class="zpl_crd"> <div class="zpl_crdcnt zpl_crdinfo"><div>';return compOffHtmls+='<div class="zpl_secn w400"><div><label for="employee" tabindex="0" class="zpl_mtry">'+ZPI18N.getString("zp.leave.operations.employeename")+'</label></div><div><input type="text" class="ztextbox" name="employee" searchmode="DATAADD" issingleemp="true"><span class="ztextbox--error__label"></span></div></div>',compOffHtmls+='<div class="zpl_secn w400"><div id="Date"><label tabindex="0" for="date" class="zpl_mtry">'+ZPI18N.getString("zp.leave.operations.workeddate")+'</label><i class="PI_info tooltip-js" data-title-position="right" title="1.'+ZPI18N.getString("zp.leavetype.busdays")+"="+ZPI18N.getString("zp.leave.compensatory.businessdayhelp")+" 2."+(holidayDispName+ZPI18N.getString("zp.leave.compensatory.holidayweekend"))+"="+ZPI18N.getString("zp.leave.compensatory.holidayhelp")+'"></i></div><div><input name="date" id="date" class="datepicker-js"><span id="dateErr" class="ztextbox--error__label"></span></div></div>',compOffHtmls+='<div class="zpl_secn w400"><div><label for="unit_choice" tabindex="0" class="zpl_mtry">'+ZPI18N.getString("zp.unit")+'</label></div><div id="unit_choice"><div class="zradiobutton zradiobutton--horizontal"><input id="day" checked="checked" name="unit" value="Days" type="radio" onchange="LeaveCompensatory.Add.switchDuration(this)" class="zradiobutton__helper"><label for="day" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.day.plural")+'</span></lable></div><div class="zradiobutton zradiobutton--horizontal"><input id="hour" name="unit" value="Hours" type="radio" onchange="LeaveCompensatory.Add.switchDuration(this)" class="zradiobutton__helper"><label for="hour" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.hourslog")+'</span></lable></div></div><div id="unit_fixed"></div></div>',compOffHtmls+='<div class="zpl_secn w400"><div><label class="zpl_mtry" for="duration_choice" tabindex="0">'+ZPI18N.getString("zp.duration")+'</label></div><div name="type" id="duration_choice"><select class="select-js" name="compoff_type"></select><span class="ztextbox--error__label"></span></div><div id="duration_fixed"><span class="ztextbox--error__label"></span></div></div>',compOffHtmls+='<div class="zpl_secn DN w400"><div><label for="hour_duration_choice" tabindex="0" class="zpl_mtry">'+ZPI18N.getString("zp.duration")+'</label></div><div name="duration" id="hour_duration_choice"><div name="hourpicker"><input type="text" class="ztextbox" name="compoff_hours" id="compoff_hours"><span class="ztextbox--error__label"></span></div></div><div id="hour_duration_fixed"><span class="ztextbox--error__label"></span></div></div>',compOffHtmls+='<div class="zpl_secn zpl_twoclum time_component zpl_idivingrp"><div name="timeDiv"><label for="comp_fromtime" tabindex="0">'+ZPI18N.getString("zp.leave.operations.workedtime")+'</label><input name="comp_fromtime" id="comp_fromtime" type="text" class="ztextbox timepicker"/><span class="ztextbox--error__label"></span></div><div><label></label><input name="comp_totime" id="comp_totime" type="text" class="ztextbox timepicker"/><span class="ztextbox--error__label"></span></div></div>',compOffHtmls+='<div class="zpl_secn credited_field w400"><div><label for="credited" tabindex="0" >'+ZPI18N.getString("zp.leave.customform.credited")+'</label></div><div><input type="text" class="ztextbox" name="credited"><span class="ztextbox--error__label"></span></div></div>',compOffHtmls+='<div class="zpl_secn w400"><div><label class="zpl_mtry" for="expiry" tabindex="0" >'+ZPI18N.getString("zp.local.Expirydate")+'</label></div><div><input name="expiry" id="expiry" class="datepicker-js"><span class="ztextbox--error__label"></span></div></div>',compOffHtmls+='<div class="zpl_secn w400"><div> <label id="reasonLabel" for="description" tabindex="0">'+ZPI18N.getString("zp.reason")+'</label> </div><div><textarea class="ztextbox" name="description" rows="2"></textarea><span class="ztextbox--error__label"></span></div></div>',compOffHtmls+="</div>",compOffHtmls+='<div class="zpl_info" id="attendance_detail"><div><h6><b>'+ZPI18N.getString("zp.leave.compensatory.attendancedetails")+'</b></h6><div class="zpl_pachotypeinfo zpl_pachtysub"><table class="zpl_itbl"><tbody><tr><td width="90"><em>'+ZPI18N.getString("zp.leave.operations.firstin",[""])+'</em></td><td><b id="firstIn"></b></td></tr><tr><td><em>'+ZPI18N.getString("zp.leave.operations.lastout",[""])+'</em></td><td><b id="lastOut"></b></td></tr><tr><td><em>'+ZPI18N.getString("zp.overtime")+'</em></td><td><b id="overTime"></b></td></tr><tr><td><em>'+ZPI18N.getString("zp.stotalhours")+'</em></td><td><b id="totalHours"></b></td></tr></tbody></table></div></div></div>',compOffHtmls+="</div></div>"},removeModal:function(){$("#compensatory_add_edit_view",settingsPage.container).remove()}}).Import={isRecAddOrUpt:!1,construct:function(){Timetracker.Import.dtls={},Timetracker.Import.dtls.noteArr=[],Timetracker.Import.dtls.fileSlider=Timetracker.Import.getImportSlider,Timetracker.Import.dtls.fileUploading=LeaveCompensatory.Import.fileUploading,Timetracker.Import.dtls.getMappingSliderHtml=LeaveCompensatory.Import.getMappingSliderHtml,Timetracker.Import.dtls.getVerifySliderHtml=LeaveCompensatory.Import.getVerifySliderHtml,Timetracker.Import.dtls.getImportSummaryHtml=LeaveCompensatory.Import.getImportSummaryHtml,Timetracker.Import.dtls.inputFileVerify=LeaveCompensatory.Import.inputFileVerify,Timetracker.Import.dtls.autoMappingFields=LeaveCompensatory.Import.autoMappingFields,Timetracker.Import.dtls.viewRecords=LeaveCompensatory.Import.viewRecords,Timetracker.Import.dtls.importTemplate=LeaveCompensatory.Import.importTemplate,Timetracker.Import.construct(),LeaveCompensatory.Import.getSupportFormatHtml();var importModal=$("#ttImportFileUpload").find("#importFileDiv1");$(importModal.find(".zpl_fldrp").find("p")[0]).html(ZPI18N.getString("zp.fomtsupportxlscsv")),importModal.find(".zpl_info").parent().parent().remove(),importModal.find("input[elem=ttConfigImportFile]").attr("accept",".xls,.csv")},importTemplate:function(){Leave.exportForm.getHTMLFormDataObj("compoff_imp_form","","leave_view_export.zp?key=compensatory_import_template","post","exportresp1",null).submit()},getSupportFormatHtml:function(){var html='<div class="zpl_secn" elem="template_section"><div><h5>'+ZPI18N.getString("zp.supportedformats")+'</h5></div><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr><th></th> <th><b>A</b></th><th><b>B</b></th><th><b>C</b></th><th><b>D</b></th><th><b>E</b></th><th><b>F</b></th></tr></thead><tbody><tr><td><b>1</b></td><td><span><b>'+ZPI18N.getString("zp.emailemployeeid")+"*</b></span></td><td><span><b>"+ZPI18N.getString("zp.date")+"*</b></span></td><td><span><b>"+ZPI18N.getString("zp.leave.customform.credited")+"*</b></span></td><td><span><b>"+ZPI18N.getString("zp.unit")+'*</b></span></td><td class="asondate_cell"><span><b>'+ZPI18N.getString("zp.expiry")+'*</b></span></td><td class=""><span><b>'+ZPI18N.getString("zp.reason")+(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.Compensatory_Configuration.mandate_reason?"*":"")+"</b></span></td></tr><tr><td><b>2</b></td><td>ZCON001</td><td>"+moment("16-01-2018","DD-MM-YYYY").format(dateFmt.toUpperCase())+"</td><td>5</td><td>Day</td><td>"+moment("31-12-2018","DD-MM-YYYY").format(dateFmt.toUpperCase())+"</td><td>Worked on a weekend to complete a project.</td></tr><tr><td><b>3</b></td><td>charles.stones@zylker.com</td><td>"+moment("05-11-2017","DD-MM-YYYY").format(dateFmt.toUpperCase())+"</td><td>8</td><td>Hour</td><td>"+moment("05-02-2018","DD-MM-YYYY").format(dateFmt.toUpperCase())+"</td><td>Worked on a holiday for a client meeting.</td></tr></tbody></table><b>* "+ZPI18N.getString("zp.leave.compensatory.importhelp")+"</b></div></div>";$("#ttImportFileUpload").find("#importFileDiv1").append(html)},fileUploading:function(fileObj){var cont=Timetracker.Import.importfileUpContiner;cont.find("#importFileDiv1,#importFileDiv2").addClass("DN"),cont.find("#loadingImportDiv").show(),cont.find("#loadingImportDiv").html(ZPeople.LOADING_HTML);var formData=new FormData;fileObj&&(formData.append("file_data",fileObj),formData.append("key","compensatory_getheaders"),formData.append("conreqcsr",csrfToken),$.ajax({url:"/leave_view_actions.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){var obj={res:1};obj.resObj=JSON.parse(response),Timetracker.Import.fileData=obj,Timetracker.Import.constructImportDiv()}}))},getMappingSliderHtml:function(){var html='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li elem="mapUnMapDiv" value="allFields" class="zpl_act">'+ZPI18N.getString("zp.all")+"</li>";return html+='<li elem="mapUnMapDiv" value="mappedFields">'+ZPI18N.getString("zp.mapping")+' <div id="mappedNo"><b></b></div></li><li elem="mapUnMapDiv" value="unMappedFields">'+ZPI18N.getString("zp.unmapped")+' <div id="unMappedNo"><b></b></div></li></ul></div>',html+='<div class="zpl_rgt"><button class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields(true);">'+ZPI18N.getString("zp.resetfields")+'</button><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields();">'+ZPI18N.getString("zp.automapfields")+"</button></div></div>",html+=LeaveCompensatory.Import.getColumns("ttimport_mapping_collapseDiv",!0)},getVerifySliderHtml:function(){return LeaveCompensatory.Import.getColumns("ttimport_verify_collapseDiv")},getColumn:function(con1,con2,id1,id2,isMan1,isMan2,isMap,isSingle){isMap&&(id1+="_map");var html='<div class="zpl_secn zpl_twoclum" elem="rowContainer">';return html+='<div><div elem="mappingFieldDiv"><label class="'+(isMan1?"zp_mdt":"")+'" style="'+(isMan1?"":"overflow: hidden !important;")+'"><font>'+con1+"</font>",html+='<b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="'+id1+'" name="'+id1+'" style="display: none;"></select>'+(isMan1?'<span class="ztextbox--error__label"></span>':"")+"</div></div>",isSingle||(isMap&&(id2+="_map"),html+='<div><div elem="mappingFieldDiv"><label class="'+(isMan2?"zp_mdt":"")+'" style="'+(isMan2?"":"overflow: hidden !important;")+'"><font>'+con2+"</font>",html+='<b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="'+id2+'" name="'+id2+'" class="select-js" style="display: none;"></select></div>'+(isMan2?'<span class="ztextbox--error__label"></span>':"")+"</div></div>"),html+="</div>"},getColumns:function(id,isMap){var html='<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd" elem="collapseMainDiv">';html+='<div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true">',html+='<div id="'+id+'" elem="collapsibleSectionPanel"><div><div><h4="">'+ZPI18N.getString("zp.basicinfo")+"</div></div><div>";var fields=Timetracker.Import.fileData.resObj.fields;return html+=LeaveCompensatory.Import.getColumn(fields[0].lable,fields[1].lable,fields[0].name,fields[1].name,!fields[0].ignoreMandatory||fields[0].ignoreMandatory,!fields[1].ignoreMandatory||fields[1].ignoreMandatory,isMap),html+=LeaveCompensatory.Import.getColumn(fields[2].lable,fields[3].lable,fields[2].name,fields[3].name,!fields[2].ignoreMandatory||fields[2].ignoreMandatory,!fields[3].ignoreMandatory||fields[3].ignoreMandatory,isMap),html+=LeaveCompensatory.Import.getColumn(fields[4].lable,fields[5].lable,fields[4].name,fields[5].name,!fields[4].ignoreMandatory||fields[4].ignoreMandatory,!fields[5].ignoreMandatory,isMap),html+='</div></div></div></div><div id="zp_empty_data" style="display: none;"></div></div>'},validateFields:function(){var verifyDiv=Timetracker.Import.importContainer.find("#ttimport_verify_card"),config=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.Compensatory_Configuration,haserror=!1;return $.each(verifyDiv.find("select"),function(idx,ele){ele=$(ele);var value=ZPeopleComponents.select(ele).getValue();-1==value||""==value?("reason"!=ele.attr("name")||config.mandate_reason)&&(haserror=!0,ele.parent().parent().find("span.ztextbox--error__label").removeClass("DN"),ele.parent().parent().find("span.ztextbox--error__label").html(ZPI18N.getString("zp.MandatoryFieldMap"))):ele.parent().parent().find("span.ztextbox--error__label").addClass("DN")}),haserror},getImportSummaryHtml:function(resultData){var html='<div class="zpl_imprtrecordvw"><div class="zpl_secn"><div><div class="zpl_imprtrecord">';if(html+='<div><i class="IC-task-chk grn"></i><b>'+ZPI18N.getString("zp.importSuccess",[""])+"</b></div>",html+='<button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="Timetracker.Import.viewRecords()">'+ZPI18N.getString("zp.viewRecords")+"</button>",html+="</div></div></div></div>",html+='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu">',html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfTot")+" <b>"+resultData.totalRows+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfAdd")+" <b>"+resultData.addedRows+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfUpdate")+" <b>0</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfSkip")+" <b>"+resultData.skippedRows+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfErr")+" <b>"+resultData.errorRows+"</b></li>",html+="</ul></div></div>",resultData.errors){var errLen=resultData.errors.length;if(errLen>0){html+=' <div class="zpl_rgtcnt"><div class="zpl_tblres"> <table class="zpl_tbl">  <thead><tr><th>'+ZPI18N.getString("zp.row")+"</th><th>"+ZPI18N.getString("zp.error")+"</th></tr></thead><tbody>";for(var index=0;index<errLen;index++){html+="<tr><td>"+("Row "+resultData.errors[index].row)+"</td><td>"+resultData.errors[index].msg.replace("<br>","")+"</td></tr>"}html+="</tbody></table></div></div>"}}return html},inputFileVerify:function(){var params={},container=Timetracker.Import.importContainer.find("#ttimport_verify_card");if(LeaveCompensatory.Import.validateFields())Timetracker.Import.importObj.showTab(2);else{params.key="compensatory_import";var employee=ZPeopleComponents.select(container.find("#employee")).getValue(),date=ZPeopleComponents.select(container.find("#date")).getValue(),credited=ZPeopleComponents.select(container.find("#credited")).getValue(),unit=ZPeopleComponents.select(container.find("#unit")).getValue(),expiry=ZPeopleComponents.select(container.find("#expiry")).getValue(),reason=ZPeopleComponents.select(container.find("#reason")).getValue();params.employee=Number(employee),params.date=Number(date),params.credited=Number(credited),params.unit=Number(unit),params.expiry=Number(expiry),params.reason=Number(reason),params[csrfParamName]=csrfToken,$("#ttimport_slider").find("#nextButton").hide(),Timetracker.Import.importContainer.find("#ttimport_summary_card").html(ZPeople.LOADING_HTML),ZPeople.Request.send("/leave_view_actions.zp",params,function(resultData){LeaveAdminOpers.Util.removeLoading(),"success"==resultData.status||"success"==resultData.msg?(Timetracker.Import.importContainer.find("#ttimport_summary_card").html(LeaveCompensatory.Import.getImportSummaryHtml(resultData)),resultData.addedRows>0&&(LeaveCompensatory.Import.isRecAddOrUpt=!0),$("#ttimport_slider").find("#cancelButton,#closeMark").on("click",function(){LeaveCompensatory.View.get()})):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.import.error"))})}},viewRecords:function(){LeaveCompensatory.Import.isRecAddOrUpt?LeaveCompensatory.View.get():$("#ttimport_slider").find("#closeMark").trigger("click")},autoMappingFields:function(cont){var headers=Timetracker.Import.fileData.resObj.tableHeaders,headerHash=Timetracker.Import.headerHash;for(var index in headers){var curHLC=headers[index].toLowerCase(),mapId=void 0;-1!=curHLC.indexOf("employee")&&(mapId="#employee_map"),"date"===curHLC&&(mapId="#date_map"),"credited"===curHLC&&(mapId="#credited_map"),"unit"===curHLC&&(mapId="#unit_map"),"expiry"===curHLC&&(mapId="#expiry_map"),"reason"===curHLC&&(mapId="#reason_map"),void 0!==mapId&&ZPeopleComponents.select(cont.find(mapId)).setValue(headerHash[curHLC])}}},LeaveCompensatory.Settings={loadPage:function(){window.open("#settings/service/leavetracker/compensatoryoff")}};var LeaveGrant={};LeaveGrant={recordData:{},refresh:!1,leavetype:{},regEvents:function(){settingsPage.container.find("[name=addrequest]").off("click").on("click",function(){LeaveGrant.Add.html()}),settingsPage.container.find("[name=dataSelect],[name=status]").off("zselectchange").on("zselectchange",function(ele,data){data.fromUI&&(0==settingsPage.container.find(".zpl_rgtcnt").find(".zpl_tblres").find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),LeaveAdminOpers.Util.Footer.searchcallback())}),settingsPage.container.find(".zpl_rgt").find("ul>li").off("click").on("click",function(){$(this).siblings().removeClass("zpl_act"),$(this).addClass("zpl_act"),0==settingsPage.container.find(".zpl_rgtcnt").find(".zpl_tblres").find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),LeaveAdminOpers.Util.Footer.searchcallback()}),settingsPage.container.find(".zpl_icncnt").find("i").off("click").on("click",function(){LeaveAdminOpers.Util.toggleSort(this)})},changeViewEditURL:function(ele){var id=$(ele).closest("div").attr("id").split("_"),rec_id=id[id.length-1];"viewOpt"==ele.id?LeaveGrant.RecordView.get(rec_id):LeaveGrant.Edit.get(rec_id)},getOptionForGrantLT:function(empNo,defVal){var leavetype=$("#grant_add_edit_view").find("[name=leavetype]");ZPeopleComponents.select(leavetype).destroy(),ZPeopleComponents.select(leavetype).removeAllOptions(),ZPeople.Request.send("/zpleave/grant/applicable/"+empNo,{conreqcsr:csrfToken},function(result){LeaveGrant.leavetype={};var optData=[];result&&result.data.length>0&&$.each(result.data,function(i,value){optData.push({label:value.name,value:value.id}),LeaveGrant.leavetype[value.id+""]=value.day}),LeaveAdminOpers.ZPeopleComponents.Select.init({container:leavetype,optArray:optData,appendTo:"#grant_add_edit_cont",defVal:defVal})})},View:{getParams:function(){var params={};let dataele=settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=dataSelect]");return LVUtil.Tab.isMyPage()?params.viewMode=1:LVUtil.Tab.isTeamPage()?(params.dataSelect=settingsPage.container.find(".zpl_rgt:not(.DNI)").find("ul>li.zpl_act").attr("value"),2==params.dataSelect?params.viewMode=4:params.viewMode=3):params.dataSelect=dataele.length>0?ZPeopleComponents.select(dataele).getValue():3,LeaveAdminOpers.Util.filterParams(params),LVUtil.Tab.isOpersPage()&&!LVUtil.Tab.isOpersUserPage()||delete params.dataSelect,params},list:function(){var params=LeaveGrant.View.getParams();ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.grantApprovalEnabled?params.status=ZPeopleComponents.select(settingsPage.container.find("[name=status]")).getValue():($("#approval_col",settingsPage.container).hide(),$("[name=status]",settingsPage.container).next().hide()),LeaveAdminOpers.Util.sortParams(params);var data_footer=$("#systemview_pagination",settingsPage.container),getMore=($(data_footer.find("select")),$(".pagecount",data_footer));params.sIndx=getMore.find("span").data("sIndx"),params.limit=getMore.find("span").data("eIndx");var listParams=JSON.stringify(params);(params={}).listParams=listParams,params.conreqcsr=csrfToken,LeaveAdminOpers.Util.showHideNoData(!1),$("#systemview_pagination",settingsPage.container).removeClass("DNI"),$("tbody#grantRecordContainer",settingsPage.container).empty(),LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.appendLoading();var rowCnt=0;ZPeople.Request.send("/zpleave/grant/list",params,function(resp){LeaveGrant.View.html(resp),resp.data.count&&data_footer.find("a#recCount").data("totalCount",resp.data.count),resp.data.count<=ZPeopleComponents.select(data_footer.find("select")).getValue()&&data_footer.find("a#recCount").text(resp.data.count),rowCnt=getMore.find("span").data("sIndx")+resp.data.records.length-1,LeaveAdminOpers.Util.Footer.setNavi(getMore.find("span").data("sIndx"),rowCnt);var tbody=settingsPage.container.find(".zpl_rgtcnt table tbody");$(tbody).on("click","td",function(){if(0==$(this).find("i,input,button,a").length){var rec_id=$(this).closest("tr").data("id");LeaveGrant.RecordView.get(rec_id)}}),settingsPage.container.data("isreg",!0)},{})},html:function(result){var show_approval=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.grantApprovalEnabled;if(result.success){var dataArr=result.data.records,tbody=$("tbody#grantRecordContainer",settingsPage.container);if(tbody.parents("table").find("thead").show(),_.isEmpty(dataArr))return LeaveAdminOpers.Util.showHideNoData(!0,ZPI18N.getString("zp.leave.operations.nodatamsg",[ZPI18N.getString("zp.leave.operations.sleavegrant")])),void $("#systemview_pagination",settingsPage.container).addClass("DNI");LeaveAdminOpers.Util.showHideNoData(!1);var temp_doc=document.createDocumentFragment();for(var indx in dataArr){var recJson=dataArr[indx],tr=ZP.create("tr",{class:"CP"});$(tr).data("id",recJson._id);var options={viewOpt:LeaveGrant.changeViewEditURL};recJson.actions.edit&&(options.editOpt=LeaveGrant.changeViewEditURL),recJson.actions.delete&&(options.deleteOpt=LeaveAdminOpers.Util.deleteWarning),tr.appendChild(LeaveAdminOpers.Util.getDropDownActionsTD(options,recJson._id));var chxTd=ZP.create("td"),chxLabel="";if(recJson.actions.delete?(chxLabel=ZP.create("div",{class:"zcheckbox"})).appendChild(ZP.create("input",{type:"checkbox",name:"check",class:"zcheckbox__helper"})):(chxLabel=ZP.create("div",{class:"zcheckbox disabled"})).appendChild(ZP.create("input",{type:"checkbox",name:"check",class:"zcheckbox__helper",disabled:!0})),chxLabel.appendChild(ZP.create("label",{class:"zcheckbox__label"})),chxTd.appendChild(chxLabel),tr.appendChild(chxTd),show_approval){var approvalTd=ZP.create("td");LeaveAdminOpers.Util.getStatusTd(approvalTd,recJson.approvalStatus),tr.appendChild(approvalTd)}var nameTd=ZP.create("td",{tabindex:0,scope:"row"}),nameDiv=ZP.create("div",{class:"zpl_em"}),nameSubDiv2=nameDiv.appendChild(ZP.create("div",{class:"zpl_emdts"})).appendChild(ZP.create("div",{class:"tooltip-js w150","data-title-position":"bottom",title:recJson.employee.name}));nameSubDiv2.appendChild(ZP.create("em",{text:recJson.employee.id+" -"})),nameSubDiv2.appendChild(ZP.create("b",{text:recJson.employee.name})),nameTd.appendChild(nameDiv),tr.appendChild(nameTd);var ltTd=ZP.create("td"),ltSpan=ZP.create("span",{text:recJson.leavetype.name});ltTd.appendChild(ltSpan),tr.appendChild(ltTd);var workDtTd=ZP.create("td"),workDtSpan=ZP.create("span",{text:recJson.date});workDtTd.appendChild(workDtSpan),tr.appendChild(workDtTd);var lgTd=ZP.create("td"),lgSpan=ZP.create("span",{text:recJson.count});lgTd.appendChild(lgSpan),tr.appendChild(lgTd);var reasonTd=ZP.create("td"),reasonDiv=ZP.create("div",{class:"tooltip-js","data-title-position":"bottom",title:recJson.reason}),reasonSpan=ZP.create("span",{text:recJson.reason?recJson.reason:"",class:"txttrim w150"});reasonDiv.appendChild(reasonSpan),reasonTd.appendChild(reasonDiv),tr.appendChild(reasonTd);var docTd=ZP.create("td"),docSpan="";void 0!=recJson.document?recJson.document.fileUrl?docSpan=ZP.create("a",{text:recJson.document.name,onclick:'window.open("'+recJson.document.fileUrl+'","_blank","noopener")'}):recJson.document.localFileId&&(docSpan=ZP.create("a",{text:recJson.document.name,onclick:'LeaveGrant.File.onFileDownload("'+recJson.document.localFileId+'","grant")'})):docSpan=ZP.create("a",{text:""}),docTd.appendChild(docSpan),tr.appendChild(docTd),temp_doc.appendChild(tr)}tbody.append(temp_doc),tbody.ztooltip(),settingsPage.container.find("tbody#grantRecordContainer").off("click").on("click","div.zcheckbox",function(){var data_body=$("tbody#grantRecordContainer",settingsPage.container),status=!0,showDelete=!1,swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked")),data_body.find("input:checkbox").each(function(){$(this).is(":checked")?showDelete=!0:status=!1}),status?$(settingsPage.container.find(".headerSelect")).attr("checked","checked").prop("checked",!0):$(settingsPage.container.find(".headerSelect")).attr("checked","").prop("checked",!1),LeaveAdminOpers.Util.showBulkDelete(showDelete)}),settingsPage.container.find("thead").off("click").on("click","div.zcheckbox",function(){var data_body=$(".zpl_tblres",settingsPage.container),swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"));var status=$(settingsPage.container.find(".headerSelect")[0]).is(":checked");data_body.find("tbody#grantRecordContainer").find("input:checkbox").each(function(){$(this).parent().hasClass("disabled")||(this.checked=status)}),LeaveAdminOpers.Util.showBulkDelete(status)})}LeaveAdminOpers.Util.removeLoading()},changeUrl:function(){LVUtil.Tab.isOpersPage()||LVUtil.Tab.isNewTabPage()?(LeaveGrant.recordData={},LeaveGrant.refresh&&(LeaveGrant.View.list(),LeaveGrant.refresh=!1)):-1!==Layout.Page.hash.indexOf("#approvals/myapproval")?window.location.href="#approvals/myapproval":-1!==Layout.Page.hash.indexOf("#approvals/myrequest")?window.location.href="#approvals/myrequest":-1==Layout.Page.hash.indexOf("#leavetracker/grant/view")&&-1==Layout.Page.hash.indexOf("#leavetracker/grant/edit")||(window.location.href=LVUtil.urls.ListView.HOME())}},File:{fileObj:{},tiggerLocalFilePick:function(event){$(".zpl_upld").find('[type="file"]').trigger("click")},onLocalFilePick:function(event){var localFile=settingsPage.container.find("#attachmentInput")[0].files[0];if(localFile){var fileObject={name:localFile.name};LeaveGrant.File.fileObj=fileObject,LeaveGrant.File.uploadLocalFile(localFile),LeaveGrant.File.PickerStatusChange.setUploading(!0)}},uploadLocalFile:function(file){$("#grant_add_edit_view");if(-1===file.name.indexOf("<")&&-1===file.name.indexOf(">"))if(LeaveGrant.File.isValid(file)){var xhr=new XMLHttpRequest,uploadId=(new Date).getTime()+"_"+_LOGGEDIN_ZUID;xhr.upload.uploadId=uploadId;var udsUploadApi="".concat(UPLOAD_URL,"/").concat(UDS_UPLOAD_SERVICE_CODE,"/ver1/stream/upload");xhr.open("post",udsUploadApi,!0),ZPeople.zaid&&xhr.setRequestHeader("x-cli-zaid",ZPeople.zaid),xhr.setRequestHeader("x-assured-response",!0),xhr.setRequestHeader("x-streammode","1"),xhr.setRequestHeader("app-info",JSON.stringify({portalId:_LOGGEDIN_ACCZSOID,zaid:ZPeople.zaid,moduleName:"Leave"})),xhr.setRequestHeader("file-info",JSON.stringify({fileName:encodeURIComponent(file.name),contentType:file.type,fileSize:file.size})),xhr.setRequestHeader("upload-id",uploadId),xhr.withCredentials=!0,xhr.onreadystatechange=function(oEvent){if(4==xhr.readyState)try{const response=JSON.parse(xhr.response);if(response.fileInfo)LeaveGrant.File.fileObj={localFileId:response.fileInfo.localFileId,name:response.fileInfo.fileName,source:"local"},LeaveGrant.File.PickerStatusChange.setUploadDone(!0);else{if("Failure"!=response.status)throw LeaveGrant.File.fileObj={},null;if(LeaveGrant.File.fileObj={},"Virus Found"==response.message)throw{msg:ZPI18N.getString("zp.virusfile")};if("An error occured in the File Transfer"==response.message)throw null}}catch(e){LeaveGrant.File.fileObj={},e&&ModuleComp.Msg.showFailureMsg(e.msg?e.msg:ZPI18N.getString("zp.fileuploaderror"))}},xhr.send(file)}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.attachmentssizeerror"));else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.projectattachmentnameerror"))},openWorkdrivePicker:function(){WorkDriveInt.showWorkDriveModal("Leave")},onWorkdriveFilePick:function(obj,uploadMode){obj&&(LeaveGrant.File.fileObj={filePath:obj.fileUrl,name:obj.name,source:"workdrive"},LeaveGrant.File.PickerStatusChange.setUploading(!0),LeaveGrant.File.PickerStatusChange.setUploadDone(!0))},openCloudPicker:function(){CloudPicker.init("grant_add_edit_view",LeaveGrant.File.onPickCloudPicker,"Leave"),CloudPicker.construct()},onPickCloudPicker:function(){var obj=JSON.parse(CloudPicker.getFileObj());obj&&(LeaveGrant.File.fileObj={docName:obj.docName,provider:obj.provider,docId:obj.docId,docType:obj.docType,mimeType:obj.mimeType,name:obj.docName,source:"cloud",accountId:obj.accountId,filePath:obj.filePath},LeaveGrant.File.PickerStatusChange.setUploading(!0),LeaveGrant.File.PickerStatusChange.setUploadDone(!0))},setFileDiv:function(){if(LeaveGrant.File.fileObj){var modal=settingsPage.container.find("#grant_add_edit_view"),fileInfo=LeaveGrant.File.fileObj,fileName=fileInfo.name,fileExtn=fileName.substring(fileName.lastIndexOf(".")+1),fileIcon=FileUpload.getFileIcon(fileExtn),fileSize=void 0!=fileInfo.fileSize?FilesCommon.getFileSize(fileInfo.fileSize):"",html='<div class="zpl_secn" id="fileCont"><div><label>'+ZPI18N.getString("zp.supportingdoc")+'</label></div><div><div class="zpl_atchd"><div><div class="zpl_atchimg"><i class="'+fileIcon+'"></i></div><div class="zpl_atchdtl"><h4>'+ZPeople.escapeHtml(fileName)+"</h4><p><span>"+fileSize+'</span></p> </div><div class="zpl_atchicn"><i class="PI_delete" onclick="LeaveGrant.File.removeSelectedAttachments(this)"></i></div><div class="zpl_prgbr DN"><div><div data-progressjs="fileUpload_Progress" style="width:0%"></div></div></div></div></div> </div></div>';modal.find(".zpl_crd").find("form").append(html),modal.find("#fileUploadCont").hide()}},isValid:function(file){return file&&file.size>0&&file.size<=maxFileSizeBytes},removeSelectedAttachments:function(obj){var modal=$("#grant_add_edit_view");modal.find("#fileCont").remove(),modal.find("#fileUploadCont").show(),modal.find("#attachmentInput").val(""),LeaveGrant.File.fileObj={}},onFileDownload:function(localFileId,page){try{if(localFileId){let params={[csrfParamName]:csrfToken,localFileId:localFileId,page:page};Leave.exportForm.getHTMLFormDataObj("zp_export_form","","leave_common_action.zp?key=downloadFile","post",null,params).submit()}}catch(e){}},PickerStatusChange:{setUploading:function(status){status&&(LeaveGrant.File.setFileDiv(),settingsPage.container.find("#fileCont").find(".zpl_prgbr").removeClass("DN"),progressJs("div[data-progressjs='fileUpload_Progress']").autoIncrease(8,10))},setUploadDone:function(status){if(status){var progressDiv=settingsPage.container.find("div[data-progressjs='fileUpload_Progress']");progressJs("div[data-progressjs='fileUpload_Progress']").end(),progressDiv[0].style.width="100%"}}}},Add:{html:function(){var modalParams={};LeaveGrant.File.fileObj=void 0,modalParams.id="grant_add_edit_view",modalParams.cardId="grant_add_edit_cont",modalParams.validate=LeaveGrant.Add.save;var addModal=new sliderModal(ZPI18N.getString("zp.addrequests"),modalParams);addModal.construct(),addModal.setCloseCallback(function(){addModal.remove(),LeaveGrant.File.fileObj=void 0});var ele=$("#grant_add_edit_view",settingsPage.container);ele.hide(),ele.find(".zpl_mcnt").html(LeaveGrant.getGrantForm(0)),ele.find("#grant_add_edit_cont").css("position","relative"),ele.attr({"aria-label":ZPI18N.getString("zp.addreqpage"),tabindex:"0"}),ele.find("#sliderSbt").attr({"aria-label":ZPI18N.getString("zp.save"),tabindex:"0"}),ele.find(".zpl_mfoter").find("#sliderCancel").text(ZPI18N.getString("zp.close")),ele.find("#sliderCancel").attr({"aria-label":ZPI18N.getString("zp.close")+","+ZPI18N.getString("zp.common.cancelpopup"),tabindex:"0"}),ele.attr({"aria-label":ZPI18N.getString("zp.common.addreqpage"),tabindex:"0"}),LVSettings.Util.userInputSelect2(ele.find("[name=employee]"),void 0,void 0,ele.find("#grant_add_edit_cont"),void 0,"400px");var emp=LVUtil.urls.getCurrentPageUser(),empObj=ZP.getUserDetailsById(emp);void 0!=empObj&&ZPeopleComponents.select(ele.find("[name=employee]")).setValues({id:empObj.id,text:empObj.name,html:ZPUtil.escapeHtml(empObj.name),photo:empObj.photo}),(LVUtil.Tab.isMyPage()||LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage())&&(ele.find("[name=employee]").parent().find(".zselectbox").addClass("disabled"),ele.find("[name=employee]").parent().parent().hide()),ele.find("[name=employee]").on("zselectchange",function(event){LeaveGrant.getOptionForGrantLT(ZPeopleComponents.select($(this)).getValue(),void 0)}),ele.find("[name=leavetype]").on("zselectchange",function(event){LeaveGrant.leavetype[ZPeopleComponents.select($(this)).getValue()]?ele.find("[name=count]").siblings("em").text(" "+ZPI18N.getString("zp.days")):ele.find("[name=count]").siblings("em").text(" "+ZPI18N.getString("zp.hours"))}),LeaveAdminOpers.ZPeopleComponents.DateField.init({container:ele.find("[name=date]"),appendTo:"#grant_add_edit_view"}),ele.find("[name=employee]").trigger("zselectchange"),ele.show(),ele.focus(),ele.find("[name=leavetype]").next().addClass("is-active")},save:function(){var modal=$("#grant_add_edit_view",settingsPage.container);modal.find("#sliderSbt").removeClass("disabled").addClass("disabled");var params={};if(!LeaveGrant.Operation.validateParams(params))return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.entermandatoryfields")),void modal.find("#sliderSbt").removeClass("disabled");params.conreqcsr=csrfToken;try{ZPeople.Request.send("/zpleave/grant/create",params,function(result){LeaveGrant.Add.checkAndChange(result,!1)},{},function(result){if(result.responseJSON&&result.responseJSON.errors){var errors=result.responseJSON.errors,modalhtml=$("#grant_add_edit_view");LeaveGrant.Add.showError(errors,modalhtml),modal.find("#sliderSbt").removeClass("disabled")}})}catch(e){}},checkAndChange:function(result,isEdit){if(result.success)ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.leave.operations.addeditmsg",[ZPI18N.getString("zp.leavetype.v2.entitlement.typeofcredit.grant"),isEdit?ZPI18N.getString("zp.leave.operations.editedmsg"):ZPI18N.getString("zp.addedmsg")])),$("#grant_add_edit_view",settingsPage.container).modal("hide"),LeaveGrant.refresh=!0,LeaveGrant.RecordView.get(result.id);else if(result.errors){var errors=result.errors,modalhtml=$("#grant_add_edit_view",settingsPage.container);LeaveGrant.Add.showError(errors,modalhtml)}$("#grant_add_edit_view",settingsPage.container).find("#sliderSbt").removeClass("disabled")},showError:function(errors,parent){for(var elename in parent.find(".ztextbox--error__label").text(""),errors){var errortxt=errors[elename];errortxt&&errortxt.message&&(errortxt=errortxt.message);var eles=parent.find("[name="+elename+"]");eles.siblings("span.ztextbox--error__label").text(errortxt).show(),eles.trigger("focus"),$(eles.siblings()[0]).addClass("ztextbox__error")}},hideError:function(parent){parent.find("span.ztextbox--error__label").hide()}},Edit:{get:function(rec_id){$.isEmptyObject(LeaveGrant.recordData)?ZPeople.Request.send("/zpleave/grant/read/"+rec_id,{conreqcsr:csrfToken},LeaveGrant.Edit.html,{}):LeaveGrant.Edit.html(LeaveGrant.recordData)},html:function(result){if(result.success){var record=result.data,modalParams={};LeaveGrant.File.fileObj=void 0,modalParams.id="grant_add_edit_view",modalParams.cardId="grant_add_edit_view",modalParams.validate=LeaveGrant.Edit.update;var editModal=new sliderModal(ZPI18N.getString("zp.editrequest"),modalParams);editModal.construct(),editModal.setCloseCallback(function(){LeaveGrant.View.changeUrl(),editModal.remove(),LeaveGrant.File.fileObj=void 0});var ele=$("#grant_add_edit_view",settingsPage.container);ele.hide(),ele.find(".zpl_mcnt").html(LeaveGrant.getGrantForm(1)),ele.data("id",record._id),ele.find("[name=employee]").append("<span>"+ZPeople.escapeHtml(record.employee.name)+"</span>"),ele.find("[name=employee]").attr("id",record.employee._id),ele.find("[name=leavetype]").on("zselectchange",function(event){LeaveGrant.leavetype[ZPeopleComponents.select($(this)).getValue()]?ele.find("[name=count]").siblings("em").text(" "+ZPI18N.getString("zp.days")):ele.find("[name=count]").siblings("em").text(" "+ZPI18N.getString("zp.hours"))}),LeaveGrant.getOptionForGrantLT(record.employee._id,record.leavetype._id),LeaveAdminOpers.ZPeopleComponents.DateField.init({container:ele.find("[name=date]"),appendTo:"#grant_add_edit_view"}),ZPeopleComponents.datefield($("[name=date]",ele)).setValue(record.date),$("[name=count]",ele).val(record.count),$("[name=reason]",ele).val(record.reason?record.reason:""),result.data.document&&(LeaveGrant.File.fileObj=result.data.document,LeaveGrant.File.setFileDiv()),LeaveGrant.recordData={},ele.show(),ele.find(".zpl_mfoter").find("#sliderCancel").text(ZPI18N.getString("zp.close")),ele.find("[name=leavetype]").next().addClass("is-active")}},update:function(){var modal=$("#grant_add_edit_view",settingsPage.container),params={};if(params.id=modal.data("id"),!LeaveGrant.Operation.validateParams(params))return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.entermandatoryfields")),void modal.find("#sliderSbt").removeClass("disabled");params.conreqcsr=csrfToken,ZPeople.Request.send("/zpleave/grant/update/"+modal.data("id"),params,function(result){LeaveGrant.Add.checkAndChange(result,!0)},{},function(result){if(result.responseJSON&&result.responseJSON.errors){var errors=result.responseJSON.errors,modalhtml=$("#grant_add_edit_view",settingsPage.container);LeaveGrant.Add.showError(errors,modalhtml),modal.find("#sliderSbt").removeClass("disabled")}})}},Delete:{deleteRecord:function(rec_id){var deleteIds=[];rec_id&&deleteIds.push(rec_id),ZPeople.Request.send("/zpleave/grant/delete",{deleteIds:deleteIds.join(","),conreqcsr:csrfToken},function(result){result.success?(LeaveAdminOpers.Util.showBulkDelete(!1),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.leave")+" "+ZPI18N.getString("zp.deleted.successfully.msg",[""])),LeaveGrant.View.list()):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.rpschunabletodelete"))})},deleteRecords:function(){var deleteIds=[];$(".zpl_rgtcnt",settingsPage.container).find("tbody input:checkbox:checked").each(function(){var data_rec_id=$(this).closest("tr").data("id");data_rec_id&&deleteIds.push(data_rec_id)}),ZPeople.Request.send("/zpleave/grant/delete",{deleteIds:deleteIds.join(","),conreqcsr:csrfToken},function(result){result.success?(LeaveAdminOpers.Util.showBulkDelete(!1),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.leave")+" "+ZPI18N.getString("zp.deleted.successfully.msg",[""])),LeaveGrant.View.list()):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.rpschunabletodelete"))})}},RecordView:{recordId:{},get:function(recordId){var params={};params.conreqcsr=csrfToken,ZPeople.Request.send("/zpleave/grant/read/"+recordId,params,LeaveGrant.RecordView.html,{})},html:function(result){$("#grant_add_edit_view",settingsPage.container).remove();var fields=["employee","leavetype","date","grant","reason","document"],modalParams={id:"grant_add_edit_view",cardId:"grant_add_edit_cont"},viewModal=new sliderModal(ZPI18N.getString("zp.leave.grantrequest"),modalParams);viewModal.construct(),viewModal.setCloseCallback(function(){LeaveGrant.View.changeUrl(),viewModal.remove(),LeaveGrant.File.fileObj=void 0});var modalhtml=$("#grant_add_edit_view",settingsPage.container),record=result.data;LeaveGrant.recordData=result;var recActions=record.actions;if(recActions.edit&&-1!=Layout.Page.hash.indexOf("leavetracker"))LeaveGrant.RecordView.addEditIcon(modalhtml,record.rec_id);else{$('<span id="edit_icon" class="zpl_mhderrgt a-itm-cntr CP"></span>').insertBefore(modalhtml.find(".zpl_mhder .PI_cls"))}LeaveGrant.RecordView.addInfoIcon(modalhtml,record);var compViewHtmls='<div class="zpl_crd"> <div class="zpl_crdcnt">';for(var field in compViewHtmls+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.employeename")+'</label></div><div name="employee"></div></div>',compViewHtmls+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.local.Leavetype")+'</label></div><div name="leavetype"></div></div>',compViewHtmls+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.effectfrom",[""])+'</label></div><div name="date"></div></div>',compViewHtmls+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.leavetype.v2.entitlement.grant")+'</label></div><div name="grant"></div></div>',compViewHtmls+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.reason")+'</label></div><div name="reason"></div></div>',compViewHtmls+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.supportingdoc")+'</label> </div><div name="document"></div></div>',compViewHtmls+="</div></div>",modalhtml.find(".zpl_mcnt").html(compViewHtmls),modalhtml.find(".zpl_mhder #edit_icon").prepend($('<div id="headerApprovalBtn"></div>')),fields){var name=fields[field],eleparent=modalhtml.find("[name="+name+"]");if("employee"===name)eleparent.append(ZP.create("span",{text:record.employee.name}));else if("leavetype"===name)eleparent.append(ZP.create("span",{text:record.leavetype.name}));else if("date"===name)eleparent.append(ZP.create("span",{text:record.date}));else if("grant"==name)eleparent.append(ZP.create("span",{text:record.count+" "+(record.leavetype.day?ZPI18N.getString("zp.days"):ZPI18N.getString("zp.hours"))}));else if("reason"==name)eleparent.append(ZP.create("span",{text:record.reason?record.reason:"-"}));else if("document"==name){var docSpan="";void 0!=record.document?record.document.fileUrl?docSpan=ZP.create("a",{text:record.document.name,onclick:'window.open("'+record.document.fileUrl+'","_blank","noopener")'}):record.document.localFileId&&(docSpan=ZP.create("a",{text:record.document.name,onclick:'LeaveGrant.File.onFileDownload("'+record.document.localFileId+'","grant")'})):docSpan=ZP.create("a",{text:"-"}),eleparent.append(docSpan)}else eleparent.append(ZP.create("span",{text:record[name]?record[name]:"-"}))}if(modalhtml.find("#sliderSbt").hide(),modalhtml.show(),modalhtml.find(".zpl_mfoter").find("#sliderCancel").text(ZPI18N.getString("zp.close")),recActions.cancel){var cancelbtn=ZP.create("button",{class:"zlabel zlabel--red zlabel--outline zlabel--medium",onclick:"LeaveGrant.cancelGrantWarning();"});$(cancelbtn).html(ZPI18N.getString("zp.cancelrecord")),modalhtml.find(".zpl_mfoter").append(cancelbtn)}2!=record.approvalStatus||void 0!=approval&&!approval.systemApproved||modalhtml.find(".zpl_mfoter").append(ZP.create("button",{class:"zlabel zlabel--gray zlabel--outline zlabel--medium disabled",text:ZPI18N.getString("zp.cancelledrecord")})),LeaveGrant.RecordView.recordId=record._id;var approval=record.approvalJson;if(approval){if(2!=record.approvalStatus){OPApprovals.Common.RecordOwner.setOwner(record._id,[approval.recOwner]),OPApprovals.Common.RecordOwner.setAddedBy(record._id,record.employee._id);let apprParam=new ApprovalParam(approval.formId,record._id,record._tableName,record.approvalStatus,approval.isOwner),layoutParam=new LayoutParam(modalhtml,modalhtml.find(".zpl_mhder"),modalhtml.find(".zpl_mfoter"),"LeaveGrant");new ApprovalRecordHeader(apprParam,layoutParam,{isRecordApprover:approval.isOwner,isPrimaryApprover:approval.isPrimaryAppr}).show()}modalhtml.find(".zlabel.zlabel--outline").hide(),record.actions.cancel?modalhtml.find(".zpl_mfoter").append('<button class="zlabel zlabel--red zlabel--outline zlabel--medium" type="button" onclick="LeaveGrant.cancelGrantWarning();" approvaltype="2">'+ZPI18N.getString("zp.cancelrecord")+"</button>"):modalhtml.find(".zpl_mfoter").append('<button type="button" class="zlabel zlabel--outline zlabel--medium" id="sliderCancel" onclick="LeaveGrant.RecordView.removeModal()">'+ZPI18N.getString("zp.close")+"</button>"),(approval.canceledRecord||2==approval.currentApprovalStatus)&&modalhtml.find(".zpl_mfoter").append(ZP.create("button",{class:"zlabel zlabel--gray zlabel--outline zlabel--medium disabled",text:ZPI18N.getString("zp.cancelledrecord")}))}},addEditIcon:function(modalhtml,rec_id){var actionSpan=ZP.create("span",{id:"edit_icon",class:"zpl_mhderrgt a-itm-cntr CP"}),edit=ZP.create("a",{class:"zpl_ibg PI_edt"});$(edit).on("click",edit,function(){var ele=$("#grant_add_edit_view",settingsPage.container);ele.length&&(ele.hide(),ele.remove()),LeaveGrant.Edit.get(rec_id)}),$(actionSpan).append(edit),modalhtml.find(".zpl_mhder").find("#edit_icon").remove(),$(actionSpan).insertBefore(modalhtml.find(".zpl_mhder .PI_cls"))},removeModal:function(){$("#grant_add_edit_view").remove(),LeaveGrant.View.changeUrl()},addInfoIcon:function(modalhtml,data){modalhtml.find(".zpl_mhder").find("#info_icon").remove(),modalhtml.find("#edit_icon").append("<a id='zp_form_createinfo' class='PI_info zpl_btnic' data-menu-id='recordInfo'></a>"),LeaveGrant.RecordView.constructShowTimeInfo(modalhtml,data)},constructShowTimeInfo:function(container,data){if(0==container.find("#grantRecordInfo").length){let popover='<div id="grantRecordInfo" class="zpl_popovr zpopover" data-display-type="box" data-type="popover" aria-haspopup="true" aria-expanded="false" tabindex="0" style="display: none; left: 987px; top: -8px;"></div>',infoObject=data;container.append(popover),container.find("#zp_form_createinfo").on("click",function(event){let target=$(event.target);if(0===container.find("#infoContainer").length){let infoTypes={cInfo:["created",ZPI18N.getString("zp.reports.createdby")],mInfo:["modified",ZPI18N.getString("zp.modifiedby")]},infoContainer='<div class="zpopover__content"><div class="zpl_recinfo" id = "infoContainer">';$.each(infoTypes,(key,value)=>{let obj={};if(infoObject[value[0]+"Time"]&&(obj.time=infoObject[value[0]+"Time"]),infoObject[value[0]+"By"]&&(obj.name=ZSEC.Encoder.encodeForHTML(infoObject[value[0]+"By"].name),obj.image=infoObject[value[0]+"By"].photo,obj.hasInfo=!0),!obj.hasInfo)return;let div=`\n                                <label class="lbldivider"><span><em>${value[1]}</em></span></label>\n                                <div class="zpl_em">\n                                    <div class="zpl_emimg">\n                                        ${void 0!==obj.image?"<img src='"+obj.image+"'>":"<span class='zpl_pichr'></span>"}\n                                    </div>\n                                    <div class="zpl_emdts zpl_ellipsis w200">\n                                        <div title = "${obj.name}"><b>${void 0!==obj.name?obj.name:""}</b></div>\n                                        <div class="d-flexclmcap10">`+"<em><date>"+`${void 0!==obj.time?obj.time:""}</date></em>\n                                        </div>\n                                    </div>\n                                </div>\n                            `;infoContainer+=div}),infoContainer+="</div></div>",container.find("#grantRecordInfo").html(infoContainer)}ZPeopleComponents.popover("#grantRecordInfo").open({forElement:target})})}container.find("#zp_form_createinfo").removeClass("zpl_DNI")}},Operation:{validateParams:function(params){var isEdit=params.hasOwnProperty("id"),modal=$("#grant_add_edit_view",settingsPage.container);modal.find("#sliderSbt").removeClass("disabled").addClass("disabled");var employee=isEdit?$("[name=employee]",modal).attr("id"):ZPeopleComponents.select($("[name=employee]",modal)).getValue(),leavetype=ZPeopleComponents.select($("[name=leavetype]",modal)).getValue(),date=ZPeopleComponents.datefield($("[name=date]",modal)).getValue().dateString,count=$("[name=count]",modal).val(),reason=$("[name=reason]",modal).val();modal.find(".zselectbox").removeClass("ztextbox__error"),modal.find(".zinputfield").removeClass("ztextbox__error"),modal.find(".ztextbox").removeClass("ztextbox__error");var isValid=!0;return void 0==employee||""==employee.toString().trim()?(modal.find("[name=employee]").parent().find(".zselectbox").addClass("ztextbox__error"),isValid=!1):void 0==leavetype||""==leavetype.toString().trim()?(modal.find("[name=leavetype]").parent().find(".zselectbox").addClass("ztextbox__error"),isValid=!1):void 0==date||""==date.trim()?(modal.find("[name=date]").parent().find(".zinputfield").addClass("ztextbox__error"),isValid=!1):(void 0==count||""==count.toString().trim()||isNaN(count))&&(modal.find("[name=count]").addClass("ztextbox__error"),isValid=!1),!!isValid&&(params.employee=employee,params.leavetype=leavetype,params.date=date,params.count=count,params.reason=reason,params.fileObject=JSON.stringify(LeaveGrant.File.fileObj),isValid)}},cancelGrantWarning:function(){var cancelGrantModal=new DeleteAlertMessage;cancelGrantModal.title=ZPI18N.getString("zp.confirm"),cancelGrantModal.despcription=ZPI18N.getString("zp.cancel")+" "+ZPI18N.getString("zp.sleave")+"?",cancelGrantModal.yesButtonText=ZPI18N.getString("zp.confirm"),cancelGrantModal.cancelButtonText=ZPI18N.getString("zp.cancel"),cancelGrantModal.callback=function(){LeaveGrant.cancelGrant()},cancelGrantModal.construct("--blue","success")},cancelGrant:function(){var calcelCont=$(".zpl_malrtmsg",settingsPage.container);calcelCont.find(".zpl_mfoter").find("#yesBtn").attr("disabled","disabled");var params={};params.conreqcsr=csrfToken,$.post("/zpleave/grant/cancel/"+LeaveGrant.RecordView.recordId,params,function(result){result.success?(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.cancelmsg")),$("#grant_add_edit_view",settingsPage.container).remove(),LeaveGrant.switchToRecView()):(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.notallowedtoedit")),calcelCont.find(".zpl_mfoter").find("#yesBtn").prop("disabled",!1)),Layout.Page.container.find(".zpl_mfoter").find("#sliderSbt").prop("disabled",!1)})},switchToRecView:function(){LVUtil.Tab.isGrant()&&(LeaveGrant.refresh=!0,LeaveGrant.View.list())},getGrantForm:function(isEdit){var grantHtmls='<div class="zpl_crd"> <div class="zpl_crdcnt"><form>';return grantHtmls+='<div class="zpl_secn"><div><label for="employee" tabindex="0" class="zpl_mtry">'+ZPI18N.getString("zp.employeename")+"</label></div>"+(1==isEdit?'<div name="employee"></div>':'<div><input type="text" class="ztextbox" name="employee" searchmode="DATAADD" issingleemp="true"><span class="ztextbox--error__label"></span></div>')+"</div>",grantHtmls+='<div class="zpl_secn"><div><label for="leavetype"  tabindex="0" class="zpl_mtry">'+ZPI18N.getString("zp.local.Leavetype")+'</label></div><div><select class="select-js" name="leavetype" style="display: none;"></select><span class="ztextbox--error__label"></span></div></div>',grantHtmls+='<div class="zpl_secn"><div id="Date"><label for="date" tabindex="0" class="zpl_mtry">'+ZPI18N.getString("zp.effectfrom",[""])+'</label></div><div><input name="date" class="datepicker-js W100"><span id="dateErr" class="ztextbox--error__label"></span></div></div>',grantHtmls+='<div class="zpl_secn"><div><label for="count" tabindex="0" class="zpl_mtry">'+ZPI18N.getString("zp.leavetype.v2.entitlement.grant")+'</label></div> <div><input type="text" name="count" class="ztextbox w60"><em>&nbsp &nbsp'+ZPI18N.getString("zp.leavetype.days")+'</em><span class="ztextbox--error__label"></span></div> </div>',grantHtmls+='<div class="zpl_secn"><div><label for="reason" tabindex="0">'+ZPI18N.getString("zp.reason")+'</label></div><div><textarea class="ztextbox" name="reason" rows="2"></textarea> </div> </div>',grantHtmls+='<div class="zpl_secn" id="fileUploadCont"><div><label for="document" tabindex="0">'+ZPI18N.getString("zp.supportingdoc")+'</label></div><div>\x3c!-- upload --\x3e<div class="zpl_upld" name="document">\x3c!-- File upload --\x3e<div class="zpl_fldrp"><input class="form-control" id="attachmentInput" type="file" onchange="LeaveGrant.File.onLocalFilePick(this)" file_source="local" style="display:none"><h5><img src="../images/nodata/fileupload.png" alt="">'+ZPI18N.getString("zp.upload")+" "+ZPI18N.getString("zp.files.from")+'<a class="zpl_lnk" onclick="LeaveGrant.File.tiggerLocalFilePick()"><i class="PI_case"></i>'+ZPI18N.getString("zp.leave.operations.file.desktop")+"</a> "+ZPI18N.getString("zp.files.smallor")+' <a class="zpl_lnk" onclick="LeaveGrant.File.openWorkdrivePicker()"> <i class="PI_cloud"></i>'+ZPI18N.getString("zp.workdrive")+"</a> "+ZPI18N.getString("zp.files.smallor")+' <a class="zpl_lnk" onclick="LeaveGrant.File.openCloudPicker()"> <i class="PI_cloud"></i>'+ZPI18N.getString("zp.smallothers")+'</a></h5></div></div><span class="ztextbox--error__label"></span></div></div>',grantHtmls+="</form></div></div>"}};var LeavePolicy={};LeavePolicy.CZBalance={key:"list_balance",fireScrollObj:void 0,regEvents:function(){settingsPage.container.find("[name=addcustomize]").on("click",function(){LeavePolicy.Transaction.add()})},getParams:function(){var params={key:LeavePolicy.CZBalance.key};return LeaveAdminOpers.Util.filterParams(params),params.sIndx=0,params.conreqcsr=csrfToken,params.dataSelect=5,params},get:function(){if(LVUtil.Tab.isOpersUserPage()){settingsPage.container.removeClass("zpl_tblfxd"),settingsPage.container.find("#topOpersMenu").remove(),settingsPage.container.find(".zpl_rgtcnt").attr("id","ZP_Add_Transaction");var tableContainer=settingsPage.container.find(".zpl_tblres");tableContainer.attr("id","zp_leavetype_tabular"),tableContainer.find("table").removeAttr("id"),tableContainer.find("table thead").empty(),tableContainer.find("table thead").append('<tr><th width="20%">'+ZPI18N.getString("zp.local.Leavetype")+'</th><th width="20%">'+ZPI18N.getString("zp.date")+'</th><th width="15%">'+ZPI18N.getString("zp.leave.operations.exisitingbalance")+'</th><th width="15%">'+ZPI18N.getString("zp.leave.operations.newbalance")+'</th><th width="30%">'+ZPI18N.getString("zp.reason")+"</th></tr>"),tableContainer.find("table tbody").empty(),settingsPage.container.find(".zpl_rgtcnt").find(".zdatetimepicker").remove(),tableContainer.find("table tbody").attr("id","zp_balancedata"),LeavePolicy.Transaction.getBalanceData();var footer='<div class="zpl_tblpagination"><div class="zpl_lftpgn"></div><div class="zpl_rhtpgn"><div class="d-flexM"><button class="zlabel zlabel--blue zlabel--medium" id="opersUser_sliderSbt">'+ZPI18N.getString("zp.submit")+"</button></div></div></div>";return settingsPage.container.find(".zpl_tblpagination").remove(),settingsPage.container.append(footer),settingsPage.container.find("#opersUser_sliderSbt").off("click").on("click",function(){LeavePolicy.Transaction.save(settingsPage.container.find("#ZP_Add_Transaction"))}),void settingsPage.container.find("#zp_leavetype_tabular").find("table thead").show()}LeavePolicy.CZBalance.fireScrollObj=new FireScrollBack(LeavePolicy.CZBalance.getMore,"#"+settingsPage.container.attr("id"),"opersCustomizeBalance");var params=LeavePolicy.CZBalance.getParams(),czBalTable=$("#ZP_CustomizeBalance",settingsPage.container);czBalTable.find("thead").empty(),czBalTable.find("tbody").empty(),LeaveAdminOpers.Util.showHideNoData(!1),LeaveAdminOpers.Util.appendLoading(),ZPeople.Request.send(LeaveAdminOpers.settingsUrl,params,function(resp){LeavePolicy.CZBalance.html(resp),settingsPage.container.data("isreg",!0)},{},LeavePolicy.CZBalance.showErrorMsg)},getMore:function(){var rowCnt=$("#ZP_CustomizeBalance",settingsPage.container).find(".Report_row").length;if(rowCnt%Leave.Util.MAX_REC==0){var params=LeavePolicy.CZBalance.getParams();params.sIndx=rowCnt+1,params.sIndx>1&&ZPeople.Request.send(LeaveAdminOpers.settingsUrl,params,function(resp){LeavePolicy.CZBalance.html(resp),resp.data.length==Leave.Util.MAX_REC&&LeavePolicy.CZBalance.fireScrollObj.reset()},{},LeavePolicy.CZBalance.showErrorMsg)}},html:function(resp){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#ZP_CustomizeBalance",settingsPage.container);data_table.addClass("reg_tbl");var prop={},tbody=data_table.children("tbody");if(_.has(resp,"header")){var header_arr=resp.header;_.isEmpty(header_arr)||_.isEmpty(data_arr)?LeaveAdminOpers.Util.showHideNoData(!0):(data_table.html(""),data_table.append(LeavePolicy.CZBalance.header(header_arr)),data_table.append(ZP.create("tbody",{id:"ZP_CustomizeRecordContainer"})),LeaveAdminOpers.Util.showHideNoData(!1),data_table.ztooltip())}if(!_.isEmpty(data_arr)){var header=$("thead",settingsPage.container);header.show(),prop.leavetypes=header.data("leavetypes"),(tbody=data_table.children("tbody#ZP_CustomizeRecordContainer")).append(LeavePolicy.CZBalance.body(data_arr,prop)),tbody.data("isRowClickReg")||($(tbody).on("click","tr:not(.disabled)",function(){LeavePolicy.Transaction.add($(this).closest(".Report_row").data("employee"))}),tbody.data("isRowClickReg",!0))}}LeaveAdminOpers.Util.removeLoading()},header:function(header_arr){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead"),common_tr=ZP.create("tr"),emp_td=ZP.create("th",{text:ZPI18N.getString("zp.employee")});for(var indx in common_tr.appendChild(emp_td),header_arr){var ltypeth=ZP.create("th",{class:"tblthead"}),table=ZP.create("table",{class:"zpl_tblcntr zpl_itbl"}),tbody=ZP.create("thead"),leavetypes=header_arr[indx],noofltyps=leavetypes.length;$(tbody).append('<tr><th class="mw200 zpl_tblbrbtm" colspan="'+noofltyps+'"><div class="tooltip-js" data-title-position="bottom" title="'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+'" >'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+"</div></th></tr>");var ltypeheadtr=ZP.create("tr");for(var id in leavetypes){var ljson=leavetypes[id],header=ZP.create("th",{class:"mw180"});header.appendChild(ZP.create("div",{class:"tooltip-js txttrim","data-title-position":"bottom",title:ZPeople.decodeTxt(ljson.leavetype_name),text:ZPeople.decodeTxt(ljson.leavetype_name)})),ltypeheadtr.appendChild(header)}tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypeth.appendChild(table),common_tr.appendChild(ltypeth)}return header_tr.appendChild(common_tr),$(header_tr).data("leavetypes",header_arr),temp_doc.appendChild(header_tr),temp_doc},body:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),lt_arr=prop.leavetypes;prop.td_width;for(var indx in data_arr){var empJson=data_arr[indx],employee=empJson.erecno,row_tr=LeaveAdminOpers.Util.getEmpRow(empJson);for(var indx in $(row_tr).attr("class","CP Report_row"),lt_arr){var ltypetd=ZP.create("td",{class:"tblbody"}),table=ZP.create("table",{class:"zpl_tblcntr zpl_itbl"}),tbody=ZP.create("tbody"),ltypeheadtr=ZP.create("tr"),ltypes=lt_arr[indx];for(var idx in ltypes){var lcount=empJson[ltypes[idx].leavetype_id],td=ZP.create("td",{class:"mw180"});lcount=isNaN(lcount)?"-":lcount,td.appendChild(ZP.create("span",{text:lcount})),ltypeheadtr.appendChild(td)}tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypetd.appendChild(table),row_tr.appendChild(ltypetd),$(row_tr).data("employee",employee+"")}temp_doc.appendChild(row_tr)}return temp_doc},showErrorMsg:function(){ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.settings.balance.errormsg")),LeaveAdminOpers.Util.removeLoading()}},LeavePolicy.Transaction={add:function(erecno){var modalParams={id:"ZP_Add_Transaction",cardId:"ZP_Add_Transaction_Cont",validate:function(){var parent=$("#ZP_Add_Transaction",settingsPage.container);parent.find("#sliderSbt").attr("disabled","disabled"),parent.data("submitandnew","zp_modal_submitnew_blubtn"==$(this).attr("id")),LeavePolicy.Transaction.save(parent)}},addModal=new sliderModal(ZPI18N.getString("zp.leave.customizebalance"),modalParams);addModal.largeSize=!0,addModal.construct(),addModal.setCloseCallback(function(){addModal.remove()});var modal=$("#ZP_Add_Transaction",settingsPage.container);modal.find("#ZP_Add_Transaction_Cont").css("position","relative");var html='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"> <div> <label>'+ZPI18N.getString("zp.employee")+'</label></div> <div><input id="" style="display: none;" name="employee" searchmode="DATAVIEW" issingleemp="true"></div></div></div></div>';if(html+='<div class="zpl_crd"><div class="zpl_crdcnt"> <div class="zpl_tblres" id="zp_leavetype_tabular"><table class="zpl_tbl"><thead><tr class="TblGryBg"></th><th style="min-width:250px">'+ZPI18N.getString("zp.local.Leavetype")+'</th><th style="min-width:200px">'+ZPI18N.getString("zp.date")+'</th><th style="min-width:100px">'+ZPI18N.getString("zp.leave.operations.exisitingbalance")+'</th><th style="min-width:200px">'+ZPI18N.getString("zp.leave.operations.newbalance")+'</th><th style="min-width:350px">'+ZPI18N.getString("zp.reason")+'</th></tr></thead><tbody id="zp_balancedata"></tbody></table></div></div></div>',modal.find(".zpl_mcnt").html(html),modal.find("#zp_modal_submitnew_blubtn").remove(),modal.find(".zpl_mfoter").find("#sliderSbt").after('<button type="button" class="zlabel zlabel--outline zlabel--medium" id="zp_modal_submitnew_blubtn">'+ZPI18N.getString("zp.submitNew")+"</button>"),modal.find("#zp_modal_submitnew_blubtn").off("click").on("click",function(){var parent=$("#ZP_Add_Transaction",settingsPage.container);parent.find("#sliderSbt").attr("disabled","disabled"),parent.data("submitandnew","zp_modal_submitnew_blubtn"==$(this).attr("id")),LeavePolicy.Transaction.save(parent)}),LVSettings.Util.userInputSelect2(modal.find("[name=employee]"),void 0,void 0,modal.find("#ZP_Add_Transaction_Cont"),!0,"400px"),(void 0==erecno||erecno.length<=0)&&(erecno=modal.find("[name=employee]").data().searchJson.defaultValues[0].id),erecno){var empObj=ZP.getUserDetailsById(erecno);ZPeopleComponents.select($("#ZP_Add_Transaction",settingsPage.container).find("[name=employee]")).setValues({id:erecno,text:empObj.name,html:ZPUtil.escapeHtml(empObj.name),photo:empObj.photo})}modal.find("[name=employee]").off("zselectchange").on("zselectchange",function(event){LeavePolicy.Transaction.getBalanceData($(this))}),modal.show(),$("#ZP_Add_Transaction",settingsPage.container).find("[name=employee]").trigger("zselectchange")},getBalanceData:function(ele){var erecno="";erecno=LVUtil.Tab.isOpersUserPage()?Layout.Page.urlparam.id:ZPeopleComponents.select(ele).getValue();var params={key:"currentbalance"};params.employee=erecno,params.date=Calendar.formatDate(new Date),params[csrfParamName]=csrfToken;var tbody=$("#ZP_Add_Transaction",settingsPage.container).find("tbody#zp_balancedata");tbody.html("<tr><td colspan=6></td></tr>"),tbody.find("td").append(ZPeople.LOADING_HTML),ZPeople.Request.send("/leave_common_action.zp",params,function(resp){LeavePolicy.Transaction.constructTabSection(resp.data),tbody.hide().fadeIn(100)})},constructTabSection:function(data){var tbody=$("#ZP_Add_Transaction",settingsPage.container).find("tbody#zp_balancedata");for(var id in tbody.html(""),data){var ltObj=Leave.Util.getLeaveTypeObj(id);if(""!=ltObj){var tr=ZP.create("tr",{class:"",id:id}),nameTd=ZP.create("td"),nameDiv=$(ZP.create("div",{class:"d-flexC"})).append(ZP.create("span",{class:"zpl_lbdr CL"+ltObj.color}));$(nameDiv).append(ZP.create("span",{class:"PL5",text:" "+ZPeople.decodeTxt(ltObj.name)})),$(nameTd).append(nameDiv),tr.appendChild(nameTd);var dateTd=ZP.create("td");$(dateTd).html('<div class="W150"><input name="date" class="datepicker" ltype="'+id+'" style="display: none;"></div>');LeaveAdminOpers.ZPeopleComponents.DateField.init({container:$(dateTd).find("[name=date]"),pickerDateCB:function(ele){LeavePolicy.Transaction.showBalance(ele)},value:Calendar.formatDate(new Date),appendTo:LVUtil.Tab.isOpersUserPage()?"#ZP_Add_Transaction":"#ZP_Add_Transaction_Cont"}),tr.appendChild(dateTd),tr.appendChild(ZP.create("td",{id:"curbalance",ltype:id,text:data[id]}));var balanceTd=ZP.create("td");$(balanceTd).html('<div class="W90"><input type="text" class="form-control" name="newbalance"/></div>'),tr.appendChild(balanceTd);var reasonTd=ZP.create("td");$(reasonTd).html('<div class="W300"><input placeholder ="'+ZPI18N.getString("zp.leave.operations.manualcorrection")+'" type="text" class="form-control" name="reason"/></div>'),tr.appendChild(reasonTd),tbody.append(tr)}}if(0==tbody.find("tr").length){(tr=ZP.create("tr")).appendChild(ZP.create("td"));var infoTd=ZP.create("td",{class:"text-center",colspan:"4"});infoTd.appendChild(ZP.create("em",{class:"dgry",text:ZPI18N.getString("zp.leave.noappltfound")})),tr.appendChild(infoTd),tbody.append(tr),$("#ZP_Add_Transaction .zpl_mfoter #sliderSbt",settingsPage.container).attr("disabled","disabled")}else $("#ZP_Add_Transaction .zpl_mfoter #sliderSbt",settingsPage.container).prop("disabled",!1);Leave.Util.removeLoading()},showBalance:function(ele){var date=ZPeopleComponents.datefield($(ele)).getValue().dateString;if(!ZPUtil.Validation.isEmpty(date)){var employee=LVUtil.Tab.isOpersUserPage()?Layout.Page.urlparam.id:ZPeopleComponents.select($("input[name=employee]",settingsPage.container.find("#ZP_Add_Transaction"))).getValue(),ltypeId=$(ele).closest("tr").attr("id"),params={key:"currentbalance",employee:employee,leavetypeid:ltypeId,date:date};ZPeople.Request.send("leave_common_action.zp",params,function(resp){$("#ZP_Add_Transaction",settingsPage.container).find("tbody#zp_balancedata").find("td#curbalance[ltype="+ltypeId+"]").text(resp.data).hide().fadeIn(200)})}},save:function(parent){var balanceData={},isReasonStrTooLarge=!1;if(parent.find("tbody#zp_balancedata").find("tr").each(function(){var id=$(this).attr("id"),date=ZPeopleComponents.datefield($(this).find("[name=date]")).getValue().dateString,newbalance=$(this).find("[name=newbalance]").val(),oldbalance=$(this).find("#curbalance").text(),reasonText=$(this).find("input[name=reason]").val().trim();if($(this).find(".ztextbox--error__label").remove(),!(ZPUtil.Validation.isEmpty(date)||ZPUtil.Validation.isEmpty(newbalance)||isNaN(newbalance)||parseFloat(newbalance)==parseFloat(oldbalance)))return Leave.Util.Validate.isReasonTooLarge(reasonText)?(isReasonStrTooLarge=!0,!1):void(balanceData[id]={date:date,newbalance:newbalance,reason:reasonText})}),isReasonStrTooLarge)return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.customizebalance.error.maxlength")),void parent.find(".ZP_submit").prop("disabled",!1);if($.isEmptyObject(balanceData))return ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.leavetype.v2.info3")),void parent.find("#sliderSbt").prop("disabled",!1);var params={key:"customize_balance"};LVUtil.Tab.isOpersUserPage()?params.employee=Layout.Page.urlparam.id:params.employee=ZPeopleComponents.select($("#ZP_Add_Transaction",settingsPage.container).find("[name=employee]")).getValue(),params.balanceData=JSON.stringify(balanceData),params[csrfParamName]=csrfToken,ZPeople.Request.send(LeaveAdminOpers.settingsUrl,params,function(resp){"SUCCESS"==resp.status?(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.leavetype.v2.success.customizebalance")),parent.data("submitandnew")?LeavePolicy.Transaction.getBalanceData($("#ZP_Add_Transaction",settingsPage.container).find("input[name=employee]")):!LVUtil.Tab.isOpersUserPage()&&$("#ZP_Add_Transaction",settingsPage.container).remove(),LeavePolicy.CZBalance.get()):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.import.error")),parent.find("#sliderSbt").prop("disabled",!1)},void 0,function(){ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.import.error")),parent.find("#sliderSbt").prop("disabled",!1)})}},LeavePolicy.Transaction.Import={importMode:"",date:"",construct:function(){Timetracker.Import.dtls={},Timetracker.Import.dtls.noteArr=[],Timetracker.Import.dtls.fileSlider=Timetracker.Import.getImportSlider,Timetracker.Import.dtls.fileUploading=LeavePolicy.Transaction.Import.fileUploading,Timetracker.Import.dtls.getMappingSliderHtml=LeavePolicy.Transaction.Import.getMappingSliderHtml,Timetracker.Import.dtls.getVerifySliderHtml=LeavePolicy.Transaction.Import.getVerifySliderHtml,Timetracker.Import.dtls.getImportSummaryHtml=LeavePolicy.Transaction.Import.getImportSummaryHtml,Timetracker.Import.dtls.inputFileVerify=LeavePolicy.Transaction.Import.inputFileVerify,Timetracker.Import.dtls.autoMappingFields=LeavePolicy.Transaction.Import.autoMappingFields,Timetracker.Import.dtls.viewRecords=LeavePolicy.CZBalance.get,Timetracker.Import.dtls.importTemplate=LeavePolicy.Transaction.Import.importTemplate,Timetracker.Import.construct(),LeavePolicy.Transaction.Import.constructDateDiv($("#ttImportFileUpload").find("#importFileDiv1")),LeavePolicy.Transaction.Import.getSupportFormatHtml();var importModal=$("#ttImportFileUpload").find("#importFileDiv1");$(importModal.find(".zpl_fldrp").find("p")[0]).html(ZPI18N.getString("zp.fomtsupportxlscsv")),importModal.find(".zpl_info").parent().parent().remove(),importModal.find("input[elem=ttConfigImportFile]").attr("accept",".xls,.csv")},importTemplate:function(){let params={mode:$("#ttImportFileUpload").find("#importFileDiv1").find('[name="importModeOpt"]:checked').attr("value")};Leave.exportForm.getHTMLFormDataObj("cuzbal_imp_form","","leave_v2_settings_export.zp?key=cuzbal_import_template","post","exportresp1",params).submit()},getSupportFormatHtml:function(){var html='<div class="zpl_secn" elem="template_section"><div><h5>'+ZPI18N.getString("zp.supportedformats")+'</h5></div><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr><th></th> <th><b>A</b></th><th><b>B</b></th><th><b>C</b></th><th><b>D</b></th><th><b class="asondate_cell" style="display:none">E</b></th></tr></thead><tbody><tr><td><b>1</b></td><td><span><b>'+ZPI18N.getString("zp.emailemployeeid")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.leavetype")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.leave.newbalance")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.reason")+'</b></span></td><td class="asondate_cell" style="display:none"><span><b>'+ZPI18N.getString("zp.date")+'</b></span></td></tr><tr><td><b>2</b></td><td>ZCON001</td><td>Casual Leave</td><td>14</td><td></td><td class="asondate_cell" style="display:none">'+Calendar.formatDate(new Date((new Date).getFullYear(),0,1),uidateFormat)+'</td></tr><tr><td><b>3</b></td><td>charles.stones@zylker.com</td><td>Permission Hours</td><td>38</td><td>Special Leave</td><td class="asondate_cell" style="display:none">'+Calendar.formatDate(new Date,uidateFormat)+"</td></tr></tbody></table></div></div>";$("#ttImportFileUpload").find("#importFileDiv1").append(html)},constructDateDiv:function(importModal,prevDateSelVal){var html='<div class="zpl_secn"><div> <label class="zpl_mtry">'+ZPI18N.getString("zp.leavetype.v2.modifybalanceon",[""])+'</label> </div><div><div class="zradiobutton zradiobutton--horizontal"><input type="radio" id="specificDate" name="importModeOpt" value="0" checked=true class="zradiobutton__helper"><label class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.leavetype.v2.specificdate")+' </span></label><div style="margin: -7px 0px 0px 10px;"><input class="datepicker" name="date" datefmt="'+dateFmt+'" id="date"></div></div><div class="zradiobutton zradiobutton--horizontal"><input type="radio" id="multiDate" name="importModeOpt" value="1" class="zradiobutton__helper"><label class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.leavetype.v2.multipledates")+"</span></label></div><div><div>";if(importModal.append(html),LVSettings.Util.createDatePicker(importModal),importModal.find(".zradiobutton").on("click",function(event){importModal.find('input[name="importModeOpt"]').prop("checked",!1),$(this).find('[name="importModeOpt"]').prop("checked","checked"),0==$(this).find('[name="importModeOpt"]').attr("value")?(ZPeopleComponents.datefield(importModal.find("#date")).setAttributes({disabled:!1}),importModal.find(".asondate_cell").hide()):(ZPeopleComponents.datefield(importModal.find("#date")).setValue(""),ZPeopleComponents.datefield(importModal.find("#date")).setAttributes({disabled:!0}),importModal.find(".asondate_cell").show())}),prevDateSelVal)if("1"==prevDateSelVal)importModal.find("#multiDate").trigger("click");else{var date=ZPeopleComponents.datefield($("#importFileDiv1").find(".datepicker")[0]).getValue().dateString;""!=date&&ZPeopleComponents.datefield(importModal.find("#date")).setValue(date)}},fileUploading:function(fileObj){var cont=Timetracker.Import.importfileUpContiner,importMode=cont.find("#importFileDiv1").find("[name=importModeOpt]:checked").val(),date=ZPeopleComponents.datefield($("#importFileDiv1").find(".datepicker")[0]).getValue().dateString;if("0"==importMode&&(ZPUtil.Validation.isEmpty(date)||!Calendar.isvalidDate(date)))return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.entervaliddate")),void $("#importFileDiv1").find("#date-container").addClass("zlabel zlabel--red zlabel--outline");LeavePolicy.Transaction.Import.importMode=importMode,LeavePolicy.Transaction.Import.date="0"==importMode?date:"",cont.find("#importFileDiv1").addClass("DN"),cont.find("#loadingImportDiv").show(),cont.find("#loadingImportDiv").html(ZPeople.LOADING_HTML);var formData=new FormData;fileObj&&(formData.append("file_data",fileObj),formData.append("key","parse_manualbalancefile"),formData.append("importMode",importMode),formData.append("conreqcsr",csrfToken),$.ajax({url:"/leave_v2_settings_actions.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){var obj={res:1};obj.resObj=JSON.parse(response),Timetracker.Import.fileData=obj,Timetracker.Import.constructImportDiv()}}))},getMappingSliderHtml:function(){var html='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li elem="mapUnMapDiv" value="allFields" class="zpl_act">'+ZPI18N.getString("zp.all")+"</li>";return html+='<li elem="mapUnMapDiv" value="mappedFields">'+ZPI18N.getString("zp.mapping")+' <div id="mappedNo"><b></b></div></li><li elem="mapUnMapDiv" value="unMappedFields">'+ZPI18N.getString("zp.unmapped")+' <div id="unMappedNo"><b></b></div></li></ul></div>',html+='<div class="zpl_rgt"><button class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields(true);">'+ZPI18N.getString("zp.resetfields")+'</button><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields();">'+ZPI18N.getString("zp.automapfields")+"</button></div></div>",html+=LeavePolicy.Transaction.Import.getColumns("ttimport_mapping_collapseDiv",!0)},getVerifySliderHtml:function(){return LeavePolicy.Transaction.Import.getColumns("ttimport_verify_collapseDiv")},getColumn:function(con1,con2,id1,id2,isMan1,isMan2,colNo1,colNo2,isMap,isSingle){isMap&&(id1+="_map");var html='<div class="zpl_secn zpl_twoclum" elem="rowContainer">';return html+='<div><div elem="mappingFieldDiv"><label class="'+(isMan1?"zp_mdt":"")+'" style="'+(isMan1?"":"overflow: hidden !important;")+'"><font>'+con1+"</font>",html+='<b class="zbadges">(c:'+colNo1+')</b></label><select class="select-js" id="'+id1+'" name="'+id1+'" style="display: none;"></select>'+(isMan1?'<span class="ztextbox--error__label"></span>':"")+"</div></div>",isSingle||(isMap&&(id2+="_map"),html+='<div><div elem="mappingFieldDiv"><label class="'+(isMan2?"zp_mdt":"")+'" style="'+(isMan2?"":"overflow: hidden !important;")+'"><font>'+con2+"</font>",html+='<b class="zbadges">(c:'+colNo2+')</b></label><div class="d-flexcap a-itm-cntr"><select id="'+id2+'" name="'+id2+'" class="select-js" style="display: none;"></select></div>'+(isMan2?'<span class="ztextbox--error__label"></span>':"")+"</div></div>"),html+="</div>"},getColumns:function(id,isMap){var html='<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd" elem="collapseMainDiv">';html+='<div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true">',html+='<div id="'+id+'" elem="collapsibleSectionPanel"><div><div><h4="">'+ZPI18N.getString("zp.basicinfo")+"</div></div><div>";var fields=Timetracker.Import.fileData.resObj.fields;return html+=LeavePolicy.Transaction.Import.getColumn(fields[0].lable,fields[1].lable,fields[0].name,fields[1].name,!fields[0].ignoreMandatory||fields[0].ignoreMandatory,!fields[1].ignoreMandatory||fields[1].ignoreMandatory,0,1,isMap),html+=LeavePolicy.Transaction.Import.getColumn(fields[2].lable,fields[3].lable,fields[2].name,fields[3].name,!fields[2].ignoreMandatory||fields[2].ignoreMandatory,!1,2,3,isMap),html+="1"==LeavePolicy.Transaction.Import.importMode?LeavePolicy.Transaction.Import.getColumn(fields[4].lable,"",fields[4].name,"",!fields[4].ignoreMandatory||fields[4].ignoreMandatory,"",5,"",isMap,!0):"",html+='</div></div></div></div><div id="zp_empty_data" style="display: none;"></div></div>'},validateFields:function(){var verifyDiv=Timetracker.Import.importContainer.find("#ttimport_verify_card"),haserror=!1;return $.each(verifyDiv.find("select"),function(idx,ele){ele=$(ele);var value=ZPeopleComponents.select(ele).getValue();-1==value||""==value?"reason"!=ele.attr("name")&&(haserror=!0,ele.parent().parent().find("span.ztextbox--error__label").removeClass("DN"),ele.parent().parent().find("span.ztextbox--error__label").html(ZPI18N.getString("zp.MandatoryFieldMap"))):ele.parent().parent().find("span.ztextbox--error__label").addClass("DN")}),haserror},getImportSummaryHtml:function(resultData){var html='<div class="zpl_imprtrecordvw"><div class="zpl_secn"><div><div class="zpl_imprtrecord">';if(html+='<div><i class="IC-task-chk grn"></i><b>'+ZPI18N.getString("zp.importSuccess",[""])+"</b></div>",html+='<button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="Timetracker.Import.viewRecords()">'+ZPI18N.getString("zp.viewRecords")+"</button>",html+="</div></div></div></div>",html+='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu">',html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfTot")+" <b>"+resultData.totalRows+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfAdd")+" <b>"+resultData.addedRows+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfUpdate")+" <b>0</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfSkip")+" <b>"+resultData.skippedRows+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfErr")+" <b>"+resultData.errorRows+"</b></li>",html+="</ul></div></div>",resultData.importSummary){var errLen=resultData.importSummary.length;if(errLen>0){html+=' <div class="zpl_rgtcnt"><div class="zpl_tblres"> <table class="zpl_tbl">  <thead><tr><th>'+ZPI18N.getString("zp.row")+"</th><th>"+ZPI18N.getString("zp.error")+"</th></tr></thead><tbody>";for(var index=0;index<errLen;index++){html+="<tr><td>"+("Row "+resultData.importSummary[index].rowNumber)+"</td><td>"+resultData.importSummary[index].message.replace("<br>","")+"</td></tr>"}html+="</tbody></table></div></div>"}}return html},inputFileVerify:function(){var params={},container=Timetracker.Import.importContainer.find("#ttimport_verify_card");if(LeavePolicy.Transaction.Import.validateFields())Timetracker.Import.importObj.showTab(2);else{params.key="import_manualbalance",params.importMode=LeavePolicy.Transaction.Import.importMode,params.date=LeavePolicy.Transaction.Import.date;var employee=ZPeopleComponents.select(container.find("#employee")).getValue(),leavetype=ZPeopleComponents.select(container.find("#leavetype")).getValue(),newbalance=ZPeopleComponents.select(container.find("#newbalance")).getValue(),asondate="";if("1"!=params.importMode||""!=(asondate=ZPeopleComponents.select(container.find("#asondate")).getValue())&&"-1"!=asondate){params.employee=Number(employee),params.leavetype=Number(leavetype),params.newbalance=Number(newbalance);var reason=ZPeopleComponents.select(container.find("#reason")).getValue();params.reason=Number(reason),"1"==params.importMode&&(params.asondate=Number(asondate)),params[csrfParamName]=csrfToken,$("#ttimport_slider").find("#nextButton").hide(),Timetracker.Import.importContainer.find("#ttimport_summary_card").html(ZPeople.LOADING_HTML),ZPeople.Request.send(LVSettings.url,params,function(resultData){"success"==resultData.status||"success"==resultData.msg?(Timetracker.Import.importContainer.find("#ttimport_summary_card").html(LeavePolicy.Transaction.Import.getImportSummaryHtml(resultData)),resultData.addedRows&&ModuleComp.Msg.showWarningMsg("This may take a few seconds to get updated !"),$("#ttimport_slider").find("#cancelButton,#closeMark").on("click",function(){LeavePolicy.CZBalance.get()})):resultData.globalError?ModuleComp.Msg.showFailureMsg(resultData.globalError):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.import.error"))})}else Timetracker.Import.importObj.showTab(2)}},autoMappingFields:function(cont){var headers=Timetracker.Import.fileData.resObj.tableHeaders,headerHash=Timetracker.Import.headerHash;for(var index in headers){var curHLC=headers[index].toLowerCase(),mapId=void 0;-1!=curHLC.indexOf("employee")&&(mapId="#employee_map"),-1!=curHLC.indexOf("leave type")&&(mapId="#leavetype_map"),"new balance"===curHLC&&(mapId="#newbalance_map"),"reason"===curHLC&&(mapId="#reason_map"),"date"===curHLC&&(mapId="#asondate_map"),void 0!==mapId&&ZPeopleComponents.select(cont.find(mapId)).setValue(headerHash[curHLC])}}},LeavePolicy.Transaction.ExportPDF={construct:function(){LeaveAdminOpers.Util.exportPdf()}},LeavePolicy.Transaction.Print=function(){var newWindow=window.open();newWindow.focus();var newContent='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html>',copyhead=$("head").clone();copyhead.find("script").each(function(){$(this).remove()});var wholeCont=settingsPage.container.clone();$(wholeCont).find(".zpl_lft").append("<span>"+ZPI18N.getString("zp.leave.customizebalance")+"</span>"),$(wholeCont).find(".zpl_rgt").remove(),newContent+=copyhead.html(),newContent+='<body onload="self.print()" style="overflow:scroll;zoom:80%;background: #fff"><div class="ZPHeadLft">',newContent+='</div><div class="clearfix"></div><hr>',newContent+=wholeCont.html(),newWindow.document.write(newContent),newWindow.document.close()};var UserSpecificPolicy={};(UserSpecificPolicy={key:"getall_czpolicy_list",regEvents:function(){settingsPage.container.find(".zpl_grpmnu").find("li").off("click").on("click",function(event){$(this).addClass("zpl_act").siblings().removeClass("zpl_act"),UserSpecificPolicy.get()}),settingsPage.container.find("#topOpersMenu").find("[name=addcustomize]").off("click").on("click",function(){UserSpecificPolicy.Customize.construct()}),settingsPage.container.find("#topOpersMenu").addClass("PT10")},get(){LVUtil.Tab.isOpersUserPage()?UserSpecificPolicy.Employee.get():UserSpecificPolicy.CustomizeEmps.get()}}).AllEmps={fireScrollObj:void 0,result:{},getParams(){var params={mode:"SEARCH",isDef:!0,start:1,searchType:"emp",searchMode:"LEAVE_DATAVIEW"};return params.extraparam=JSON.stringify({employeeStatus:3,incDateOfExit:!1}),params.conreqcsr=csrfToken,params},get(){UserSpecificPolicy.AllEmps.fireScrollObj=new FireScrollBack(UserSpecificPolicy.AllEmps.getMore,"#"+settingsPage.container.attr("id"),"opersCustomizePolicyForAllEmps");var czPolicyTable=$("#ZP_CustomizePolicy",settingsPage.container);czPolicyTable.find("thead").empty(),czPolicyTable.find("thead").append(UserSpecificPolicy.AllEmps.header()),czPolicyTable.find("tbody").empty(),LeaveAdminOpers.Util.showHideNoData(!1),LeaveAdminOpers.Util.appendLoading();var params=UserSpecificPolicy.AllEmps.getParams();settingsPage.container.find("#topOpersMenu").find(".zpl_rgt").css({"pointer-events":"none"}),ZPeople.Request.send("/commonAction.zp",params,function(resp){UserSpecificPolicy.AllEmps.result=resp,UserSpecificPolicy.AllEmps.html(resp),settingsPage.container.data("isreg",!0),LeaveAdminOpers.Util.removeLoading()})},getMore(){if(UserSpecificPolicy.AllEmps.result){var result=UserSpecificPolicy.AllEmps.result;if(result.isNextAvailable){var params=UserSpecificPolicy.AllEmps.getParams();params.start=result.start,params.start>1&&(settingsPage.container.find("#topOpersMenu").find(".zpl_rgt").css({"pointer-events":"none"}),ZPeople.Request.send("/commonAction.zp",params,function(resp){UserSpecificPolicy.AllEmps.result=resp,UserSpecificPolicy.AllEmps.html(resp),resp.isNextAvailable||UserSpecificPolicy.AllEmps.fireScrollObj.reset()}))}}},html(resp){var tbody=settingsPage.container.find("#ZP_CustomizePolicy").find("#ZP_CZPolicyRecordContainer");resp&&resp.results&&(tbody.append(UserSpecificPolicy.AllEmps.body(resp.results)),$(tbody).off("click").on("click","tr:not(.disabled)",function(){UserSpecificPolicy.Customize.construct($(this).closest(".Report_row").data("employee"))})),settingsPage.container.find("#topOpersMenu").find(".zpl_rgt").css({"pointer-events":"auto"})},header(){var temp_doc=document.createDocumentFragment(),common_tr=ZP.create("tr"),emp_th=ZP.create("th",{text:ZPI18N.getString("zp.employee")});return common_tr.appendChild(emp_th),temp_doc.appendChild(common_tr),temp_doc},body(result){var tempDoc=document.createDocumentFragment();for(var indx in result){var empData=result[indx],empJson={erecno:empData[0],id:empData[1],name:ZPeople.decodeTxt(ZPeople.getUserDisplayName(empData[2],empData[3])),photo:""},rowTr=LeaveAdminOpers.Util.getEmpRow(empJson);$(rowTr).attr("class","CP Report_row"),$(rowTr).data("employee",empData[0]),tempDoc.appendChild(rowTr)}return tempDoc}},UserSpecificPolicy.CustomizeEmps={fireScrollObj:void 0,getParams(){var params={};return params.key=UserSpecificPolicy.key,params.sIndx=0,params.conreqcsr=csrfToken,params},get(){UserSpecificPolicy.CustomizeEmps.fireScrollObj=new FireScrollBack(UserSpecificPolicy.CustomizeEmps.getMore,"#tab-leavetracker-userspecificpolicy","opersCustomizePolicy");var czPolicyTable=$("#ZP_CustomizePolicy",settingsPage.container);czPolicyTable.find("thead").empty(),czPolicyTable.find("thead").append(UserSpecificPolicy.CustomizeEmps.header()),czPolicyTable.find("tbody").empty(),LeaveAdminOpers.Util.showHideNoData(!1),LeaveAdminOpers.Util.appendLoading();var params=UserSpecificPolicy.CustomizeEmps.getParams();settingsPage.container.find("#topOpersMenu").find(".zpl_rgt").css({"pointer-events":"none"}),ZPeople.Request.send(LeaveAdminOpers.settingsUrl,params,function(resp){UserSpecificPolicy.CustomizeEmps.html(resp),settingsPage.container.data("isreg",!0),LeaveAdminOpers.Util.removeLoading()},{},LeavePolicy.CZBalance.showErrorMsg)},getMore(){var rowCnt=$("#ZP_CustomizePolicy",settingsPage.container).find(".Report_row").length;if(rowCnt%Leave.Util.MAX_REC==0){var params=UserSpecificPolicy.CustomizeEmps.getParams();params.sIndx=rowCnt+1,params.sIndx>1&&(settingsPage.container.find("#topOpersMenu").find(".zpl_rgt").css({"pointer-events":"none"}),ZPeople.Request.send(LeaveAdminOpers.settingsUrl,params,function(resp){UserSpecificPolicy.CustomizeEmps.html(resp),resp.length==Leave.Util.MAX_REC&&UserSpecificPolicy.CustomizeEmps.fireScrollObj.reset()},{},LeavePolicy.CZBalance.showErrorMsg))}},html(resp){var tbody=settingsPage.container.find("#ZP_CustomizePolicy").find("#ZP_CZPolicyRecordContainer");tbody.parents("table").find("thead").show(),void 0!=resp&&(tbody.append(UserSpecificPolicy.CustomizeEmps.body(resp)),$(tbody).off("click").on("click","td",function(event){0==$(this).find("a").length&&UserSpecificPolicy.Customize.construct($(this).closest(".Report_row").data("employee"))}),$(tbody).find(".zpl_tg").off("click").on("click",function(event){ZPeopleComponents.menu("#moreoptionmenu_"+$(this).closest(".Report_row").data("employee")).show()})),settingsPage.container.find("#topOpersMenu").find(".zpl_rgt").css({"pointer-events":"auto"})},header(){var temp_doc=document.createDocumentFragment(),common_tr=ZP.create("tr"),emp_th=ZP.create("th",{text:ZPI18N.getString("zp.employee")});common_tr.appendChild(emp_th);var cz_th=ZP.create("th",{text:ZPI18N.getString("zp.leave.customized")+" "+ZPI18N.getString("zp.leavetypes")});return common_tr.appendChild(cz_th),temp_doc.appendChild(common_tr),temp_doc},constructCZLTData(leavetype){var ltObj=Leave.Util.getLeaveTypeObj(leavetype),ltDiv=ZP.create("div",{class:"d-flexclmcap10 d-inle-flex d-flexC"}),ltIcon=ZP.create("span",{class:"zpl_lbdr lv_bg"+ltObj.color}),ltTxt=ZP.create("span",{text:ZPeople.decodeTxt(ltObj.name)});return ltDiv.appendChild(ltIcon),ltDiv.appendChild(ltTxt),ltDiv},body(result){if(!(result&&result.length<=0)){var tempDoc=document.createDocumentFragment();for(var indx in result){var empJson={erecno:result[indx].erecno,id:result[indx].id,name:result[indx].name,photo:result[indx].photo},employee=empJson.erecno,rowTr=LeaveAdminOpers.Util.getEmpRow(empJson);$(rowTr).attr("class","CP Report_row");var ltList=result[indx].ltList,ltTd=ZP.create("td"),ltDiv=ZP.create("div",{class:"d-flexclmcap20"});for(var i in ltList)if(0!=i&&1!=i||ltDiv.appendChild(UserSpecificPolicy.CustomizeEmps.constructCZLTData(ltList[i])),2==i){var countDiv=ZP.create("div",{class:"zpl_tg MT5",id:"moreoptionmenuBtn_"+employee});countDiv.appendChild(ZP.create("a",{class:"zpl_drpdwn-js",text:"+"+parseInt(ltList.length-2)})),ltDiv.appendChild(countDiv),UserSpecificPolicy.CustomizeEmps.constructMoreLTDiv(employee,ltList);break}ltTd.appendChild(ltDiv),$(rowTr).data("employee",employee),rowTr.appendChild(ltTd),tempDoc.appendChild(rowTr)}return tempDoc}LeaveAdminOpers.Util.showHideNoData(!0)},constructMoreLTDiv(employee,ltList){if(!($("#moreoptionmenu_"+employee).length>0)){for(var mhtml='<div id="moreoptionmenu_'+employee+'" class="zpl_drpdwn zpl_tagdrpdwn zmenu zposition--bottomleft" data-type="list" tabindex="0" aria-hidden="false" role="menu"><ul data-body="true" class="zmenu__body">',length=ltList.length,i=2;i<length;i++){var ltObj=Leave.Util.getLeaveTypeObj(ltList[i]);mhtml+='<li data-item-type="custom" id="" class="d-flex zmenu__item zmenu__custom" role="menuitem">',mhtml+='<div class="d-flexclmcap10 "><span class="zpl_lbdr lv_bg'+ltObj.color+'"></span><span>'+ltObj.name+"</span></div>",mhtml+="</li>"}mhtml+="</ul></div>",$(settingsPage.mainWrapId).append(mhtml),ZPeopleComponents.menu("#moreoptionmenu_"+employee,{forElement:"#moreoptionmenuBtn_"+employee})}}},UserSpecificPolicy.Customize={construct(erecno){var modalParams={id:"ZP_List_UserPolicy",cardId:"ZP_List_UserPolicy_Cont"},addModal=new sliderModal(ZPI18N.getString("zp.leave.customizepolicy"),modalParams);addModal.largeSize=!0,addModal.construct(),addModal.setCloseCallback(function(){addModal.remove()});var modal=$("#ZP_List_UserPolicy",settingsPage.container);modal.find("#ZP_List_UserPolicy_Cont").css("position","relative");var html='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"> <div> <label>'+ZPI18N.getString("zp.employee")+'</label></div> <div><input id="" style="display: none;" name="employee" searchmode="DATAVIEW" issingleemp="true"></div></div></div></div>';html='<div id="topSettMenu" class="zpl_btnmnu"><div class="zpl_lft" style="max-width:500px"><input id="userspecificpolicyempsearch" style="display: none;" name="employee" searchmode="DATAVIEW" issingleemp="true"></div><div class="zpl_rgt"><i class="zpl_ibg PI_fltr tooltip-js" data-title-position="bottom" title="'+ZPI18N.getString("zp.filter")+'"></i><i class="zpl_ibg PI_refresh tooltip-js" id="refreshpolicy" title="'+ZPI18N.getString("zp.leavetype.v2.refreshpolicies")+'" data-title-position="left" onclick="LVSettings.UserPolicy.optionCallBack(this)"></i></div></div></div>';if(html+='<div class="zpl_crd"><div class="zpl_crdcnt"> <div class="zpl_tblres" id="zp_leavetype_tabular"><table class="zpl_tbl"><thead><tr class="TblGryBg"><th style="min-width: 300px;">'+ZPI18N.getString("zp.leave.context.lvpolicy")+'</th><th style="min-width: 150px;">'+ZPI18N.getString("zp.type")+'</th><th style="min-width: 100px;">'+ZPI18N.getString("zp.unit")+'</th><th style="min-width: 100px;">'+ZPI18N.getString("zp.leave.view.balance")+'</th><th style="min-width: 450px;"></th></tr></thead><tbody id="zp_czpolicydata"></tbody></table></div></div></div>',modal.find(".zpl_mcnt").html(html),LVSettings.Util.userInputSelect2(modal.find("[name=employee]"),void 0,void 0,modal.find("#ZP_List_UserPolicy_Cont"),!0,"400px"),(void 0==erecno||erecno.length<=0)&&(erecno=modal.find("[name=employee]").data().searchJson.defaultValues[0].id),erecno){var empObj=ZP.getUserDetailsById(erecno);ZPeopleComponents.select(modal.find("[name=employee]")).setValues({id:erecno,text:empObj.name,html:ZPUtil.escapeHtml(empObj.name),photo:empObj.photo})}modal.find("[name=employee]").on("zselectchange",function(event){settingsPage.container.find("#ZP_List_UserPolicy_Cont #zp_czpolicydata").html(""),UserSpecificPolicy.Customize.getPolicyData($(this))}),modal.find(".zpl_mfoter").remove(),modal.show(),UserSpecificPolicy.Customize.Filter.constructFilter(),UserSpecificPolicy.Customize.getPolicyData(modal.find("[name=employee]")),settingsPage.container.find("#ZP_List_UserPolicy_Cont").find(".PI_fltr").off("click").on("click",function(){UserSpecificPolicy.Customize.Filter.toggleFilter()})},getPolicyData(ele){var erecno=LVUtil.Tab.isOpersUserPage()?Layout.Page.urlparam.id:""!=ZPeopleComponents.select(ele).getValue()?ZPeopleComponents.select(ele).getValue():"-1",params={key:"czpolicy_list"};params.employee=erecno,params.isActive=ZPeopleComponents.select(settingsPage.container.find("#ZP_List_UserPolicy").find("[name=isActive]")).getValue(),params[csrfParamName]=csrfToken,settingsPage.container.find("#ZP_List_UserPolicy_Cont .zpl_crd").find("#zp_empty_data").length>0&&settingsPage.container.find("#ZP_List_UserPolicy_Cont .zpl_crd").find("#zp_empty_data").remove(),$("#ZP_List_UserPolicy_Cont",settingsPage.container).find(".zpl_crd").hide(),$(settingsPage.container.find("#ZP_List_UserPolicy_Cont .zpl_crd")).after(ZPeople.LOADING_HTML),ZPeople.Request.send(LeaveAdminOpers.settingsUrl,params,function(resp){UserSpecificPolicy.Customize.View.html(resp),settingsPage.container.find("#ZP_List_UserPolicy_Cont").find("[id=zp_page_loading]").remove()})},View:{html(resp){var tbody=$("#ZP_List_UserPolicy",settingsPage.container).find("tbody#zp_czpolicydata");tbody.html("");var data=resp.data,balanceObj=data.balances,ltData=data.ltData,tableDiv=$("#ZP_List_UserPolicy_Cont",settingsPage.container).find(".zpl_tblres");($("#ZP_List_UserPolicy_Cont",settingsPage.container).find(".zpl_crd").show(),0!=ltData.length)?(tableDiv.find(".zpl_tbl").show(),$.each(ltData,function(indx){var ltObj=ltData[indx],id=ltObj.id,tr="<tr >";tr+='<td class="clickallow"> <div class="d-flexclmcap5 a-itm-cntr" id="lvtypename"> <span class="zpl_lbdr lv_bg'+ltObj.color+'"></span><span class="tooltip-js" title="'+ltObj.name+'">'+ltObj.name+"</span>"+(ltObj.iscustomized?'<em id="customem">('+ZPI18N.getString("zp.leave.customized").toUpperCase()+")</em> ":"")+"</div> </td> ",tr+='<td class="clickallow"><div  class="zpl_tg"><span>'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(ltObj.typeOfLeave))+"</span></div></td> ",tr+='<td class="clickallow"><div><span>'+(ltObj.isDayBased?ZPI18N.getString("zp.day.plural"):ZPI18N.getString("zp.hourslog"))+"</span></div></td> ",tr+='<td  class="clickallow" id="curbalance_td"> <span>'+(isNaN(balanceObj[id])?"-":balanceObj[id])+"</span> </td>",tr+='<td><div class="zpl_hvr">',tr+='<a href="javascript:;" id="viewhistoryOpt"  class="zlabel zlabel--blue zlabel--outline zlabel--small"  onclick="LVSettings.UserPolicy.ViewHistory.init(this)">'+ZPI18N.getString("zp.leavetype.v2.viewhistory")+"</a> ",resp.isActive&&(tr+='<a href="javascript:;" id="rerunOpt" class="zlabel zlabel--blue zlabel--outline zlabel--small" onclick=LVSettings.UserPolicy.confirmation(this)>'+ZPI18N.getString("zp.leavetype.v2.rerun")+"</a> ",ltObj.iscustomized&&(tr+='<a href="javascript:;" id="resetDefaultOpt" class="zlabel zlabel--blue zlabel--outline zlabel--small" onclick="LVSettings.UserPolicy.confirmation(this)">'+ZPI18N.getString("zp.leavetype.v2.resettodefault")+"</a></div></td>  ")),tr+="</tr>",(tr=$(tr)).data("id",id).data("isActive",resp.isActive).data("name",ltObj.name).data("modaltype",ltObj.creditType),tr.find(".clickallow").on("click",function(){LVSettings.UserPolicy.Customize.editPolicy($(this).parents("tr"))}),tbody.append(tr)})):(0===tableDiv.find("#zp_empty_data").length&&tableDiv.append('<div id="zp_empty_data"></div>'),tableDiv.find("#zp_empty_data").siblings().hide(),0===tableDiv.find("#emptPage").length?new EmptyPages("zp_nd_record",ZPI18N.getString("zp.nodatafound"),"",tableDiv.find("#zp_empty_data")).show():tableDiv.find("#emptPage").show())},refresh(){UserSpecificPolicy.Customize.getPolicyData($("#ZP_List_UserPolicy").find("[name=employee]")),UserSpecificPolicy.get()}},Filter:{constructFilter(){if(!(settingsPage.container.find("#czPolicyfilter").length>0)){var fHtml='<div class="zpl_fltr DNI" id="czPolicyfilter">';fHtml+='<div> <div class="zpl_fltrhd"> <h5>'+ZPI18N.getString("zp.filter")+'</h5> <i class="PI_cls" onclick="UserSpecificPolicy.Customize.Filter.toggleFilter()"></i> </div>',fHtml+="</div>",fHtml+='<div class="zpl_fltrcnt" style="position: relative;"> <div> ',fHtml+='<div class="zpl_fltclps fltopn"> <div class="zpl_fltrlst">',fHtml+='<div> <div class="zpl_secn"> <div> <label>'+ZPI18N.getString("zp.status")+'</label> </div> <select class="select-js" name="isActive"></select><span class="ztextbox--error__label DNI"></span> </div>',fHtml+=" </div>",fHtml+="</div> </div> ",fHtml+="</div> </div> ",fHtml+="<div>",fHtml+='<button name="applyFilter" type="button" class="zlabel zlabel--blue zlabel--medium" onclick="UserSpecificPolicy.Customize.Filter.applyFilter();">'+ZPI18N.getString("zp.apply")+"</button>",fHtml+='<button name="resetFilter"  type="button" class="zlabel zlabel--outline zlabel--medium" onclick="UserSpecificPolicy.Customize.Filter.resetFilter();">'+ZPI18N.getString("zp.reset")+"</button>",fHtml+="</div></div>",settingsPage.container.find("#ZP_List_UserPolicy").append(fHtml);var optArray=LeaveAdminOpers.getOptionsForFilter("isActive",[],void 0);LeaveAdminOpers.ZPeopleComponents.Select.init({container:settingsPage.container.find("#ZP_List_UserPolicy").find("[name=isActive]"),optArray:optArray,defVal:"1",isFieldHideForNodata:!0})}},toggleFilter(){settingsPage.container.find("#czPolicyfilter").length>0&&(settingsPage.container.find("#czPolicyfilter").hasClass("DNI")?(settingsPage.container.find("#czPolicyfilter").removeClass("DNI"),settingsPage.container.addClass("zpl_fltr_flt")):(settingsPage.container.find("#czPolicyfilter").addClass("DNI"),settingsPage.container.removeClass("zpl_fltr_flt")))},applyFilter(){settingsPage.container.find("#ZP_List_UserPolicy_Cont #zp_czpolicydata").html(""),UserSpecificPolicy.Customize.getPolicyData(settingsPage.container.find("#ZP_List_UserPolicy").find("[name=employee]"))},resetFilter(){ZPeopleComponents.select(settingsPage.container.find("#ZP_List_UserPolicy").find("[name=isActive]")).setValue(1)}}},UserSpecificPolicy.Employee={getParams(){var params={key:"czpolicy_list"};return params.employee=Layout.Page.urlparam.id,params.isActive=ZPeopleComponents.select(settingsPage.container.find("#lvfilter").find("[name=isActive]")).getValue(),params[csrfParamName]=csrfToken,params},get(){var html='<i class="zpl_ibg PI_refresh tooltip-js" id="refreshpolicy" data-title-position="left" onclick="LVSettings.UserPolicy.optionCallBack(this)" title="'+ZPI18N.getString("zp.leavetype.v2.refreshpolicies")+'"></i>';0==Layout.Page.container.find("#topOpersMenu").find(".zpl_rgt").find("#refreshpolicy").length&&Layout.Page.container.find("#topOpersMenu").find(".zpl_rgt").append(html),$("#ZP_CustomizePolicy",settingsPage.container).find("tbody").empty();var params=UserSpecificPolicy.Employee.getParams();LeaveAdminOpers.Util.showHideNoData(!1),LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.appendLoading(),ZPeople.Request.send(LeaveAdminOpers.settingsUrl,params,function(resp){UserSpecificPolicy.Employee.html(resp),LeaveAdminOpers.Util.removeLoading()})},html(resp){var tbody=$("#ZP_CustomizePolicy",settingsPage.container).find("tbody#ZP_CZPolicyRecordContainer");tbody.html(""),$("#ZP_CustomizePolicy",settingsPage.container).find("thead").show();var data=resp.data,balanceObj=data.balances,ltData=data.ltData,tableDiv=$("#ZP_List_UserPolicy",settingsPage.container).find(".zpl_tblres");0!=ltData.length?(tableDiv.find(".zpl_tbl").show(),$.each(ltData,function(indx){var ltObj=ltData[indx],id=ltObj.id,tr="<tr >";tr+='<td class="clickallow"> <div class="d-flexclmcap5 a-itm-cntr" id="lvtypename"> <span class="zpl_lbdr lv_bg'+ltObj.color+'"></span><span title='+ltObj.name+">"+ltObj.name+"</span>"+(ltObj.iscustomized?'<em id="customem">('+ZPI18N.getString("zp.leave.customized").toUpperCase()+")</em> ":"")+"</div> </td> ",tr+='<td class="clickallow"><div  class="zpl_tg"><span>'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(ltObj.typeOfLeave))+"</span></div></td> ",tr+='<td class="clickallow"><div><span>'+(ltObj.isDayBased?ZPI18N.getString("zp.day.plural"):ZPI18N.getString("zp.hourslog"))+"</span></div></td> ",tr+='<td  class="clickallow" id="curbalance_td"> <span>'+(isNaN(balanceObj[id])?"-":balanceObj[id])+"</span> </td>",tr+='<td><div class="zpl_hvr">',tr+='<a href="javascript:;" id="viewhistoryOpt"  class="zlabel zlabel--blue zlabel--outline zlabel--small"  onclick="LVSettings.UserPolicy.ViewHistory.init(this)">'+ZPI18N.getString("zp.leavetype.v2.viewhistory")+"</a> ",resp.isActive&&(tr+='<a href="javascript:;" id="rerunOpt" class="zlabel zlabel--blue zlabel--outline zlabel--small" onclick=LVSettings.UserPolicy.confirmation(this)>'+ZPI18N.getString("zp.leavetype.v2.rerun")+"</a> ",ltObj.iscustomized&&(tr+='<a href="javascript:;" id="resetDefaultOpt" class="zlabel zlabel--blue zlabel--outline zlabel--small" onclick="LVSettings.UserPolicy.confirmation(this)">'+ZPI18N.getString("zp.leavetype.v2.resettodefault")+"</a></div></td>  ")),tr+="</tr>",(tr=$(tr)).data("id",id).data("isActive",resp.isActive).data("name",ltObj.name).data("modaltype",ltObj.creditType),tr.find(".clickallow").on("click",function(){LVSettings.UserPolicy.Customize.editPolicy($(this).parents("tr"))}),tbody.append(tr)})):(0===tableDiv.find("#zp_empty_data").length&&tableDiv.append('<div id="zp_empty_data"></div>'),tableDiv.find("#zp_empty_data").siblings().hide(),0===tableDiv.find("#emptPage").length?new EmptyPages("zp_nd_record",ZPI18N.getString("zp.nodatafound"),"",tableDiv.find("#zp_empty_data")).show():tableDiv.find("#emptPage").show())}};var LeaveIB={};(LeaveIB={key:"list_initialbalance",fireScrollObj:void 0,regEvents:function(){settingsPage.container.find(".zpl_rgt").find("[name=add]").on("click",function(){LeaveIB.Modify.init()}),settingsPage.container.find(".zpl_rgt").find("[name=rollover]").on("click",function(){LeaveIB.generaterollover_popup()})},getParams:function(){var params={key:LeaveIB.key};return LeaveAdminOpers.Util.filterParams(params),params.sIndx=0,params.conreqcsr=csrfToken,params},get:function(){if(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isV1User){LeaveIB.fireScrollObj=new FireScrollBack(LeaveIB.getMore,"#"+settingsPage.container.attr("id"),"opersInitialBalance");var params=LeaveIB.getParams(),iniBalTable=$("#ZP_Leave_Settings_IB_View",settingsPage.container);iniBalTable.find("thead").empty(),iniBalTable.find("tbody").empty(),LeaveAdminOpers.Util.showHideNoData(!1),LeaveAdminOpers.Util.appendLoading(),ZPeople.Request.send(LeaveAdminOpers.v1SettingsUrl,params,function(resp){LeaveIB.html(resp),settingsPage.container.data("isreg",!0)},{},LeaveIB.showErrorMsg)}else window.location.hash="operations/leavetracker/customizebalance"},getMore:function(){var rowCnt=$("#ZP_Leave_Settings_IB_View",settingsPage.container).find(".Report_row").length;if(rowCnt%Leave.Util.MAX_REC==0){var params=LeaveIB.getParams();params.sIndx=rowCnt+1,params.sIndx>1&&ZPeople.Request.send(LeaveAdminOpers.v1SettingsUrl,params,function(resp){LeaveIB.html(resp),resp.data.length==Leave.Util.MAX_REC&&LeaveIB.fireScrollObj.reset()},{},LeaveIB.showErrorMsg)}},html:function(resp){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#ZP_Leave_Settings_IB_View",settingsPage.container),prop={edit:!0,action:!0},tbody=data_table.children("tbody");if(_.has(resp,"header")){var header_arr=resp.header;_.isEmpty(header_arr)||_.isEmpty(data_arr)?LeaveAdminOpers.Util.showHideNoData(!0):(data_table.html(""),data_table.append(LeaveIB.header(header_arr,prop)),data_table.append(ZP.create("tbody",{id:"ZP_Leave_Settings_IB_View_Container"})),LeaveAdminOpers.Util.showHideNoData(!1),data_table.ztooltip())}if(!_.isEmpty(data_arr)){var header=$("thead",settingsPage.container);prop.leavetypes=header.data("leavetypes"),(tbody=data_table.children("tbody#ZP_Leave_Settings_IB_View_Container")).append(LeaveIB.balance(data_arr,prop)),tbody.data("isRowClickReg")||($(tbody).on("click","tr:not(.disabled)",function(){LeaveIB.Modify.init($(this).closest(".Report_row").data("employee"))}),tbody.data("isRowClickReg",!0))}}LeaveAdminOpers.Util.removeLoading()},header:function(header_arr,prop){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead"),common_tr=ZP.create("tr"),emp_td=ZP.create("th",{text:ZPI18N.getString("zp.employee")});for(var indx in common_tr.appendChild(emp_td),header_arr){var ltypeth=ZP.create("th",{class:"tblthead"}),table=ZP.create("table"),tbody=ZP.create("thead"),leavetypes=header_arr[indx],noofltyps=leavetypes.length;$(tbody).append('<tr><th class="zpl_tblbrbtm" colspan="'+noofltyps+'"><div class="tooltip-js" data-title-position="bottom" title="'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+'" >'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+"</div></th></tr>");var ltypeheadtr=ZP.create("tr");for(var id in leavetypes){var ljson=leavetypes[id],header=ZP.create("th");header.appendChild(ZP.create("div",{class:"tooltip-js","data-title-position":"bottom",title:ZPeople.decodeTxt(ljson.leavetype_name),text:ZPeople.decodeTxt(ljson.leavetype_name)})),ltypeheadtr.appendChild(header)}tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypeth.appendChild(table),common_tr.appendChild(ltypeth)}return prop.leavetypes=header_arr,header_tr.appendChild(common_tr),$(header_tr).data("leavetypes",header_arr),temp_doc.appendChild(header_tr),temp_doc},balance:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),lt_arr=prop.leavetypes;prop.td_width;for(var indx in data_arr){var empJson=data_arr[indx],employee=empJson.erecno,row_tr=LeaveAdminOpers.Util.getEmpRow(empJson);for(var indx in $(row_tr).attr("class","CP Report_row"),lt_arr){var ltypetd=ZP.create("td"),table=ZP.create("table"),tbody=ZP.create("tbody"),ltypeheadtr=ZP.create("tr"),ltypes=lt_arr[indx];for(var idx in ltypes){var ljson=ltypes[idx],lcount=empJson[ljson.leavetype_id];lcount=""===(lcount=void 0!==lcount?lcount:"N/A")?"-":lcount;var td=ZP.create("td",{name:ljson.leavetype_id+""});td.appendChild(ZP.create("span",{text:lcount})),ltypeheadtr.appendChild(td)}tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypetd.appendChild(table),row_tr.appendChild(ltypetd),$(row_tr).data("employee",employee+"")}temp_doc.appendChild(row_tr)}return temp_doc},showErrorMsg:function(){ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.settings.balance.errormsg")),LeaveAdminOpers.Util.removeLoading()}}).Modify={rolledover:!1,init:function(employee){var modalParams={id:"leavetracker-initialbalance-add",cardId:"leavetracker-initialbalance-add-cont",validate:function(){$("#leavetracker-initialbalance-add").find("#sliderSbt").attr("disabled","disabled"),LeaveIB.Modify.update($("#leavetracker-initialbalance-add").find("input[name=employee]"))}},addModal=new sliderModal(ZPI18N.getString("zp.leave.initialbalance"),modalParams);addModal.largeSize=!0,addModal.construct(),addModal.setCloseCallback(function(){addModal.remove()});var modal=$("#leavetracker-initialbalance-add");modal.find("#leavetracker-initialbalance-add-cont").css("position","relative");var html='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"> <div> <label>'+ZPI18N.getString("zp.employee")+'</label></div> <div><input id="" style="display: none;" name="employee" searchmode="SETTINGS" issingleemp="true"></div></div></div></div>';if(html+='<div class="zpl_hdcnt" id="optionsCont"><ul class="zpl_tabpane zpl_act"><li class="zpl_act" val="0"><a>'+ZPI18N.getString("zp.leave.initialbalance")+' </a></li><li class="" val="1"><a onclick="">'+ZPI18N.getString("zp.leave.rollover")+"</a></li></ul></div>",html+='<div class="zpl_tabcnt"><div class="" id="inibal"><div class="zpl_crd"><div class="zpl_crdcnt"> <div class="zpl_secn"><div class="zpl_info"><em class="zpl_mtry">'+ZPI18N.getString("zp.leavetype.compoffinitialbalance")+'</em></div><div class="zpl_tblres" id="ZP_Leave_Report"><table class="zpl_tbl"><thead><tr class="TblGryBg"><th width="20%">'+ZPI18N.getString("zp.leave")+'</th><th width="10%">'+ZPI18N.getString("zp.type")+'</th><th width="20%">'+ZPI18N.getString("zp.leave.report.permitted")+'</th><th width="20%">'+ZPI18N.getString("zp.leave.initialbalance")+'</th><th width="15%">'+ZPI18N.getString("zp.leave.taken")+'</th><th width="10%">'+ZPI18N.getString("zp.leave.report.available")+'</th></tr></thead><tbody id="zp_balancedata"></tbody></table></div></div></div></div></div>',html+='<div id="rollovr" class="DNI"><div class="zpl_crd"><div class="zpl_crdcnt"> <div class="zpl_secn"><div class="zpl_info"><a href="javascript:void(0)" name="rollover">'+ZPI18N.getString("zp.leavetype.employeerollover")+'</a></div><div class="zpl_tblres" id="ZP_Leave_Rollover"><table class="zpl_tbl"><thead><tr class="TblGryBg"><th width="600">'+ZPI18N.getString("zp.leave")+'</th><th width="600">'+ZPI18N.getString("zp.leave.initialbalance")+'</th></tr></thead><tbody id=""></tbody></table></div></div></div></div></div></div>',modal.find(".zpl_mcnt").html(html),modal.find("#optionsCont").find("ul li").off("click").on("click",function(event){var val=$(this).attr("val");modal.find("#optionsCont").find("ul li").not(this).removeClass("zpl_act"),$(this).addClass("zpl_act"),0==val?(modal.find("#inibal").removeClass("DNI"),modal.find("#rollovr").addClass("DNI")):(modal.find("#inibal").addClass("DNI"),modal.find("#rollovr").removeClass("DNI"))}),LVSettings.Util.userInputSelect2(modal.find("[name=employee]"),void 0,void 0,modal.find("#leavetracker-initialbalance-add-cont")),modal.find("[name=employee]").on("zselectchange",function(event){LeaveIB.Modify.showleaves($(this))}),employee){var empObj=ZP.getUserDetailsById(employee);ZPeopleComponents.select($("#leavetracker-initialbalance-add-cont").find("[name=employee]")).setValues({id:employee,text:empObj.name,html:ZPUtil.escapeHtml(empObj.name),photo:empObj.photo})}LeaveIB.Modify.showleaves(modal.find("[name=employee]"))},showleaves:function(ele){var params={erecno:ZPeopleComponents.select(ele).getValue(),key:"get_initialbalance"};params[csrfParamName]=csrfToken,$.post(LeaveAdminOpers.v1SettingsUrl,params,function(result){var data_arr=result.data,editableBalLvTypeIds=[],initialBalanceObject={};$.each(data_arr,function(_index,value){value.initialBalance&&(initialBalanceObject[value.id]=value.initialBalance),editableBalLvTypeIds.push(value.id)}),LeaveIB.Modify.constructIBTabSection(result.report,editableBalLvTypeIds,initialBalanceObject),LeaveIB.Modify.constructROTabSection(data_arr),LeaveIB.Modify.changeTableContent(),$("#leavetracker-initialbalance-add").find("a[name=rollover]").off("click").on("click",function(){result.dojNotdefined?ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leavetype.updatedoj")):LeaveIB.generaterollover_popup()})})},constructROTabSection:function(data_arr){var isRollOverLTFound=!1,tempDoc=document.createDocumentFragment(),data_div=$("#ZP_Leave_Rollover",settingsPage.container);for(var indx in data_arr){var leave_type=data_arr[indx];if($("#ZP_Leave_Report",settingsPage.container).find("tr[name="+leave_type.id+"]").find("input").attr("syscount",leave_type.hasOwnProperty("ROcount")?leave_type.ROcount:""),leave_type.isrollover||4==leave_type.type){var span=ZP.create("p",{class:""}),txt=leave_type.isrollover?"("+ZPI18N.getString("zp.leave.rolloverenabled")+")":"("+ZPI18N.getString("zp.leave.onlypositivevalues")+")";span.appendChild(document.createTextNode(txt)),settingsPage.container.find("#ZP_Leave_Report").find("tr[name="+leave_type.id+"]").find("td")[0].append(span)}if(leave_type.isrollover){isRollOverLTFound=!0;var data_tr=ZP.create("tr",{name:leave_type.id}),nameTd=ZP.create("td"),nameDiv=$(ZP.create("div",{class:"d-flexC"})).append(ZP.create("span",{class:"zpl_lbdr CL"+leave_type.color}));if($(nameDiv).append(ZP.create("b",{class:"PL5",text:" "+ZPeople.decodeTxt(leave_type.name)})),$(nameTd).append(nameDiv),leave_type.isaccrual){var msg=ZP.create("p",{class:"",text:" ("+leave_type.accrualperiod+" "+ZPI18N.getString("zp.leavetype.accrual")+")"});nameTd.appendChild(msg)}data_tr.appendChild(nameTd);var balanceTd=ZP.create("td");$(balanceTd).html((leave_type.hasOwnProperty("ROcount"),leave_type.ROcount)),data_tr.appendChild(balanceTd),tempDoc.appendChild(data_tr)}}isRollOverLTFound||(settingsPage.container.find("#optionsCont").find("li[val=1]").addClass("DNI"),settingsPage.container.find("#rollovr").addClass("DNI"));var data_tbody=$("tbody",data_div);data_tbody.hide(),data_tbody.html(""),data_tbody.append(tempDoc),data_tbody.fadeIn("fast")},constructIBTabSection:function(data_arr,editableBalLvTypeIds,initialBalanceObject){var tempDoc=document.createDocumentFragment(),data_div=$("#ZP_Leave_Report",settingsPage.container);if(!_.isEmpty(data_arr)){var leave_types=data_arr[0].leavetypes;for(var indx in leave_types){var leave_type=leave_types[indx];if(2!=leave_type.type&&(4!=leave_type.type||-1!=Layout.Page.hash.indexOf("#operations/leavetracker/initialbalance"))){var data_tr=ZP.create("tr",{name:leave_type.leavetypeid}),nameTd=ZP.create("td"),nameDiv=$(ZP.create("div",{class:"d-flexC"})).append(ZP.create("span",{class:"zpl_lbdr CL"+leave_type.color}));if($(nameDiv).append(ZP.create("b",{class:"PL5 "+(4==leave_type.type?"zpl_mtry":""),text:" "+ZPeople.decodeTxt(leave_type.name)})),$(nameTd).append(nameDiv),leave_type.isaccrual){var msg=ZP.create("p",{class:"",text:" ("+leave_type.accrualperiod+" "+ZPI18N.getString("zp.leavetype.accrual")+")"});nameTd.appendChild(msg)}data_tr.appendChild(nameTd);var duration=1;0!==ZP.optValue(leave_type,"leave_count",0)&&(duration=ZP.optValue(leave_type,"leave_count",0)/ZP.optValue(leave_type,"temp_count",0)),data_tr.appendChild(ZP.create("td",{text:ZSEC.Encoder.encodeForHTML(Leave.Type.text(leave_type.type))}));var allowedtd=ZP.create("td",{value:ZP.optValue(leave_type,"leave_count",0)});if(allowedtd.appendChild(ZP.create("span",{id:"permcount",value:ZP.optValue(leave_type,"allowed",0),text:ZP.optValue(leave_type,"allowed",0),accrual:duration})),leave_type.isRollOver){var para=ZP.create("p",{class:""}),sml=ZP.create("small");sml.appendChild(ZP.create("span",{id:"leavecount",value:ZP.optValue(leave_type,"leave_count",0),text:ZP.optValue(leave_type,"leave_count",0)})),sml.appendChild(document.createTextNode(" + "+ZPI18N.getString("zp.leave.initialbalance")+" (")),sml.appendChild(ZP.create("span",{id:"ibcount",value:ZP.optValue(leave_type,"ibCount",0),text:ZP.optValue(leave_type,"ibCount",0)})),sml.appendChild(document.createTextNode(")")),para.appendChild(sml),allowedtd.appendChild(para)}data_tr.appendChild(allowedtd);var balanceTd=ZP.create("td"),initialBalance=initialBalanceObject[leave_type.leavetypeid]?initialBalanceObject[leave_type.leavetypeid]:"";$(balanceTd).html('<div class="W90"><input type="text" class="ztextbox'+(editableBalLvTypeIds.indexOf(leave_type.leavetypeid)>-1?"":" is-disabled disabled")+'" name="'+leave_type.leavetypeid+'" maxlength="6" value="'+initialBalance+'"/></div>'),data_tr.appendChild(balanceTd),data_tr.appendChild(ZP.create("td",{text:ZP.optValue(leave_type,"taken",0)})),data_tr.appendChild(ZP.create("td",{value:ZP.optValue(leave_type,"available",0),text:ZP.optValue(leave_type,"available",0)})),4==leave_type.type&&$(data_tr).data("isCompoff",!0),tempDoc.appendChild(data_tr)}}var data_tbody=$("tbody",data_div);data_tbody.hide(),data_tbody.html(""),data_tbody.append(tempDoc),data_tbody.fadeIn("fast")}},changeTableContent:function(){$("tbody#zp_balancedata","#leavetracker-initialbalance-add").find("input").each(function(){$(this).on("keyup change input",function(){var name=$(this).attr("name"),ele=$("#ZP_Leave_Report").find("tr[name="+name+"]"),isCompoff=ele.data("isCompoff"),permspan=ele.find("span#permcount"),ibspan=ele.find("span#ibcount"),leavecountspan=ele.find("span#leavecount"),daystakenspan=ele.find("td:nth-child(5)"),availspan=ele.find("td:nth-child(6)"),allowedtd=ele.find("td:nth-child(3)"),allowedval=allowedtd.attr("value"),input=$(this).val();if(isCompoff&&input&&-1!=input.indexOf("-"))$(this).val("");else if(0!=input.length){ele.find("span").length<3&&LeaveIB.Modify.addinfohtml(allowedtd,allowedval,input);var ibcnt=1*parseFloat(input).toFixed(2);""===$(this).attr("syscount")||isNaN($(this).attr("syscount"))||(ibcnt=1*(ibcnt+=1*parseFloat($(this).attr("syscount")).toFixed(2)).toFixed(2));var perm=1*parseFloat(parseFloat(allowedval)+ibcnt).toFixed(2),avail=(perm=isNaN(perm)?parseFloat(allowedval):perm)-parseFloat(daystakenspan.text());avail=isNaN(avail)?"":avail.toFixed(2),void 0!=perm&&ele.find("span#permcount").text(perm),void 0!=ibcnt&&ele.find("span#ibcount").text(ibcnt),void 0!=avail&&ele.find("td:nth-child(6)").text(avail)}else{perm=permspan.attr("value")?permspan.attr("value"):allowedtd.attr("value");var lcount=leavecountspan.attr("value");ibspan.attr("value"),avail=availspan.attr("value");""===$(this).attr("syscount")||isNaN($(this).attr("syscount"))?(avail=(perm=parseFloat(allowedval))-parseFloat(daystakenspan.text()),avail=isNaN(avail)?"":avail.toFixed(2),void 0!=perm&&ele.find("span#permcount").text(perm),void 0!=avail&&ele.find("td:nth-child(6)").text(avail),ele.find("br").remove(),ele.find("p").remove()):(ibcnt=1*parseFloat($(this).attr("syscount")).toFixed(2),perm=1*parseFloat(parseFloat(allowedval)+ibcnt).toFixed(2),avail=(perm=isNaN(perm)?parseFloat(allowedval):perm)-parseFloat(daystakenspan.text()),avail=isNaN(avail)?"":avail.toFixed(2),void 0!=perm&&ele.find("span#permcount").text(perm),void 0!=ibcnt&&ele.find("span#ibcount").text(ibcnt),void 0!=lcount&&ele.find("span#leavecount").text(lcount),void 0!=avail&&ele.find("td:nth-child(6)").text(avail))}})})},addinfohtml:function(allowedtd,allowedval,input){allowedtd.html(""),allowedtd.append(ZP.create("span",{id:"permcount",text:allowedval})),info=ZP.create("br"),allowedtd.append(info),para=ZP.create("p",{class:"gry MT5"});var sml=ZP.create("small");sml.appendChild(ZP.create("span",{id:"leavecount",text:allowedval})),sml.appendChild(document.createTextNode("+ Initial balance (")),sml.appendChild(ZP.create("span",{id:"ibcount",text:input})),sml.appendChild(document.createTextNode(")")),para.appendChild(sml),allowedtd.append(para)},update:function(element){var leaves={};leaves.employee=ZPeopleComponents.select(element).getValue();var params={key:"update_initialbalance"};params[csrfParamName]=csrfToken;var hasError=!1;if($("#ZP_Leave_Report").find("input").each(function(){var name=$(this).attr("name"),value=$(this).val();value&&isNaN(value)?hasError=!0:leaves[name]=value}),hasError)return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.entervalidinput")),void $("#leavetracker-initialbalance-add").find("#sliderSbt").removeAttr("disabled");params.leavetype=JSON.stringify(leaves),$.post(LeaveAdminOpers.v1SettingsUrl,params,function(data){"success"===data.status&&(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully")),$("#sliderCancel").click(),LeaveIB.get())})}},LeaveIB.generaterollover_popup=function(){var erecno=$("#leavetracker-initialbalance-add").length>0?ZPeopleComponents.select($("#leavetracker-initialbalance-add").find("input[name=employee]")).getValue():void 0,info=erecno?ZPI18N.getString("zp.leave.employeerollover.help"):ZPI18N.getString("zp.leave.rollover.help"),rollOverModal=new SuccessAlertMessage;rollOverModal.title=ZPI18N.getString("zp.confirm"),rollOverModal.despcription=info,rollOverModal.yesButtonText=ZPI18N.getString("zp.confirm"),rollOverModal.cancelButtonText=ZPI18N.getString("zp.cancel");rollOverModal.setCallback(function(){LeaveIB.Modify.rolledover=!0,LeaveIB.generaterollover(erecno)}),rollOverModal.construct("--blue","success")},LeaveIB.generaterollover=function(erecno){var params={employee:erecno,key:"generate_rollover"};erecno?params.employee=JSON.stringify(erecno.split(",")):(params=LeaveIB.getParams()).key="generate_rollover",ZPeople.Request.send(LeaveAdminOpers.v1SettingsUrl,params,function(response){ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully")),erecno?LeaveIB.Modify.init(erecno):LeaveIB.get()})},LeaveIB.Import={construct:function(){Timetracker.Import.dtls={},Timetracker.Import.dtls.noteArr=[],Timetracker.Import.dtls.fileSlider=Timetracker.Import.getImportSlider,Timetracker.Import.dtls.fileUploading=LeaveIB.Import.fileUploading,Timetracker.Import.dtls.getMappingSliderHtml=LeaveIB.Import.getMappingSliderHtml,Timetracker.Import.dtls.getVerifySliderHtml=LeaveIB.Import.getVerifySliderHtml,Timetracker.Import.dtls.getImportSummaryHtml=LeaveIB.Import.getImportSummaryHtml,Timetracker.Import.dtls.inputFileVerify=LeaveIB.Import.inputFileVerify,Timetracker.Import.dtls.autoMappingFields=LeaveIB.Import.autoMappingFields,Timetracker.Import.dtls.viewRecords=LeaveIB.get,Timetracker.Import.construct(),LeaveIB.Import.getSupportFormatHtml();var importModal=$("#ttImportFileUpload").find("#importFileDiv1");$(importModal.find(".zpl_fldrp").find("p")[0]).html(ZPI18N.getString("zp.fomtsupportxlscsv")),importModal.find(".zpl_info").parent().parent().remove(),importModal.find("input[elem=ttConfigImportFile]").attr("accept",".xls,.csv"),importModal.find(".zpl_fldrp").find("p")[2].remove()},getSupportFormatHtml:function(){var html='<div class="zpl_secn" elem="template_section"><div><h5>'+ZPI18N.getString("zp.supportedformats")+'</h5></div><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr><th></th> <th><b>A</b></th><th><b>B</b></th><th><b>C</b></th></tr></thead><tbody><tr><td><b>1</b></td><td><span><b>'+ZPI18N.getString("zp.emailemployeeid")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.leavetype")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.leave.newbalance")+"</b></span></td></tr><tr><td><b>2</b></td><td>ZCON001</td><td>Casual Leave</td><td>2</td></tr><tr><td><b>3</b></td><td>Employee 47</td><td>Unpaid Hours</td><td>10</td></tr></tbody></table></div></div>";$("#ttImportFileUpload").find("#importFileDiv1").append(html)},fileUploading:function(fileObj){var cont=Timetracker.Import.importfileUpContiner;cont.find("#importFileDiv1,#importFileDiv2").addClass("DN"),cont.find("#loadingImportDiv").show(),cont.find("#loadingImportDiv").html(ZPeople.LOADING_HTML);var formData=new FormData;fileObj&&(formData.append("file_data",fileObj),formData.append("key","import_file"),formData.append("module","initial_balance"),formData.append("conreqcsr",csrfToken),$.ajax({url:"/leave_settings_actions.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){var obj={res:1};obj.resObj=JSON.parse(response),Timetracker.Import.fileData=obj,Timetracker.Import.constructImportDiv()}}))},getMappingSliderHtml:function(){var html='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li elem="mapUnMapDiv" value="allFields" class="zpl_act">'+ZPI18N.getString("zp.all")+"</li>";return html+='<li elem="mapUnMapDiv" value="mappedFields">'+ZPI18N.getString("zp.mapping")+' <div id="mappedNo"><b></b></div></li><li elem="mapUnMapDiv" value="unMappedFields">'+ZPI18N.getString("zp.unmapped")+' <div id="unMappedNo"><b></b></div></li></ul></div>',html+='<div class="zpl_rgt"><button class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields(true);">'+ZPI18N.getString("zp.resetfields")+'</button><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields();">'+ZPI18N.getString("zp.automapfields")+"</button></div></div>",html+=LeaveIB.Import.getColumns("ttimport_mapping_collapseDiv",!0)},getVerifySliderHtml:function(){return LeaveIB.Import.getColumns("ttimport_verify_collapseDiv")},getColumn:function(con1,con2,id1,id2,isMan1,isMan2,isMap,isSingle){isMap&&(id1+="_map");var html='<div class="zpl_secn zpl_twoclum" elem="rowContainer">';return html+='<div><div elem="mappingFieldDiv"><label class="'+(isMan1?"zp_mdt":"")+'" style="'+(isMan1?"":"overflow: hidden !important;")+'"><font>'+con1+"</font>",html+='<b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="'+id1+'" name="'+id1+'" style="display: none;"></select>'+(isMan1?'<span class="ztextbox--error__label"></span>':"")+"</div></div>",isSingle||(isMap&&(id2+="_map"),html+='<div><div elem="mappingFieldDiv"><label class="'+(isMan2?"zp_mdt":"")+'" style="'+(isMan2?"":"overflow: hidden !important;")+'"><font>'+con2+"</font>",html+='<b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="'+id2+'" name="'+id2+'" class="select-js" style="display: none;"></select></div>'+(isMan2?'<span class="ztextbox--error__label"></span>':"")+"</div></div>"),html+="</div>"},getColumns:function(id,isMap){var html='<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd" elem="collapseMainDiv">';html+='<div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true">',html+='<div id="'+id+'" elem="collapsibleSectionPanel"><div><div><h4="">'+ZPI18N.getString("zp.basicinfo")+"</div></div><div>";var fields=Timetracker.Import.fileData.resObj.fields;return html+=LeaveIB.Import.getColumn(fields[0].lable,fields[1].lable,fields[0].name,fields[1].name,!fields[0].ignoreMandatory||fields[0].ignoreMandatory,!fields[1].ignoreMandatory||fields[1].ignoreMandatory,isMap),html+=LeaveIB.Import.getColumn(fields[2].lable,"",fields[2].name,"",!fields[2].ignoreMandatory||fields[2].ignoreMandatory,"",isMap,!0),html+='</div></div></div></div><div id="zp_empty_data" style="display: none;"></div></div>'},validateFields:function(){var verifyDiv=Timetracker.Import.importContainer.find("#ttimport_verify_card"),haserror=!1;return $.each(verifyDiv.find("select"),function(idx,ele){ele=$(ele);var value=ZPeopleComponents.select(ele).getValue();-1==value||""==value?"reason"!=ele.attr("name")&&(haserror=!0,ele.parent().parent().find("span.ztextbox--error__label").removeClass("DN"),ele.parent().parent().find("span.ztextbox--error__label").html(ZPI18N.getString("zp.MandatoryFieldMap"))):ele.parent().parent().find("span.ztextbox--error__label").addClass("DN")}),haserror},getImportSummaryHtml:function(resultData){var html='<div class="zpl_imprtrecordvw"><div class="zpl_secn"><div><div class="zpl_imprtrecord">';return html+='<div><i class="IC-task-chk grn"></i><b>'+ZPI18N.getString("zp.importSuccess",[""])+"</b></div>",html+='<button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="Timetracker.Import.viewRecords()">'+ZPI18N.getString("zp.viewRecords")+"</button>",html+="</div></div></div></div>",html+='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu">',html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfAdd")+" <b>"+resultData.addedCount+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfUpdate")+" <b>0</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfSkip")+" <b>0</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfErr")+" <b>0</b></li>",html+="</ul></div></div>"},inputFileVerify:function(){var params={},container=Timetracker.Import.importContainer.find("#ttimport_verify_card");if(LeaveIB.Import.validateFields())Timetracker.Import.importObj.showTab(2);else{params.actionType="IMPORT_ROLLOVER",params.operation="rolloveractions";var employee=ZPeopleComponents.select(container.find("#empMapVal")).getValue(),leavetype=ZPeopleComponents.select(container.find("#leaveTypeMapVal")).getValue(),newbalance=ZPeopleComponents.select(container.find("#rollOverCountMapVal")).getValue();params.empMapVal=Number(employee),params.leaveTypeMapVal=Number(leavetype),params.rollOverCountMapVal=Number(newbalance),params[csrfParamName]=csrfToken,$("#ttimport_slider").find("#nextButton").hide(),Timetracker.Import.importContainer.find("#ttimport_summary_card").html(ZPeople.LOADING_HTML);var url=Timetracker.Import.fileData.resObj.requestURL;ZPeople.Request.send(url,params,function(resultData){"success"==resultData.msg?(Timetracker.Import.importContainer.find("#ttimport_summary_card").html(LeaveIB.Import.getImportSummaryHtml(resultData)),$("#ttimport_slider").find("#cancelButton,#closeMark").on("click",function(){LeaveIB.get()})):resultData.globalError?ModuleComp.Msg.showFailureMsg(resultData.globalError):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.import.error"))})}},autoMappingFields:function(cont){var headers=Timetracker.Import.fileData.resObj.tableHeaders,headerHash=Timetracker.Import.headerHash;for(var index in headers){var curHLC=headers[index].toLowerCase(),mapId=void 0;-1!=curHLC.indexOf("employee id")&&(mapId="#empMapVal_map"),-1!=curHLC.indexOf("leave type")&&(mapId="#leaveTypeMapVal_map"),"initial balance"===curHLC&&(mapId="#rollOverCountMapVal_map"),void 0!==mapId&&ZPeopleComponents.select(cont.find(mapId)).setValue(headerHash[curHLC])}}},LeaveIB.ExportPDF={construct:function(){LeaveAdminOpers.Util.exportPdf()}};var ExpWorkingDay={init:function(){ExpWorkingDay.View.list()},regEvents:function(){$("[name=addExpWD]",settingsPage.container).on("click",function(){ExpWorkingDay.Add.html(0)}),AppExc.getApplicableIds()},hideModal:function(modalId){ModuleComp.Modal.hide(modalId)},View:{list:function(){var params={method:"view",mode:"list_view"};if(""==(params=ExpWorkingDay.View.getParams(params)).location||""==params.shift)return""==params.location?Holidays.Operation.showerror(settingsPage.container.find("[name=location]"),ZPI18N.getString("zp.locationerror")):Holidays.Operation.showerror(settingsPage.container.find("[name=shift]"),ZPI18N.getString("zp.pleaseselectdes",[ZPI18N.getString("zp.shiftsig")])),void LeaveAdminOpers.toggleFilter();Holidays.Operation.hideerror(settingsPage.container.find("[name=location]")),Holidays.Operation.hideerror(settingsPage.container.find("[name=shift]"));var expworkingTable=$("table",settingsPage.container),tbody=expworkingTable.find("tbody#workingdayRecordContainer");tbody.empty(),LeaveAdminOpers.Util.showHideNoData(!1),LeaveAdminOpers.Util.appendLoading(),ZPeople.Request.send("list_workingday.zp",params,function(resultData){if(!(resultData.length>0))return LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.showHideNoData(!0),void settingsPage.container.data("isreg",!0);expworkingTable.find("thead").show(),LeaveAdminOpers.Util.showHideNoData(!1),$.each(resultData,function(ind,rData){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,workDayId=rData.id,row=ZP.create("tr",{pk_id:workDayId+""}),column=ZP.create("td"),nameSpan=ZP.create("span",{text:ZPeople.decodeTxt(rData.name),href:"javascript:;"});column.appendChild(nameSpan),$(row).append(column);var daytxt=" "+rData.day+" ",datestd=ZP.create("td"),dateSpan=ZP.create("span",{text:rData.date});datestd.appendChild(dateSpan),$(datestd).append(ZP.create("em",{text:daytxt})),$(row).append(datestd),row.appendChild(Holidays.View.getTD(rData.locations,rData.shifts,workDayId,"locaction")),row.appendChild(Holidays.View.getTD(rData.shifts,rData.locations,workDayId,"shift"));var desSpan=ZP.create("span",{text:ZPeople.decodeTxt(rData.remark)}),desTd=ZP.create("td");desTd.appendChild(desSpan),row.appendChild(desTd),moduleData.issettingsadmin&&row.appendChild(Holidays.View.get_editdeleteTD(workDayId,ExpWorkingDay.Operation.deleteRecord)),$(tbody).append(row)}),LeaveAdminOpers.Util.removeLoading(),expworkingTable.ztooltip(),settingsPage.container.data("isreg",!0),tbody.find("tr td:not(:last-child)").off("click").on("click",function(){ExpWorkingDay.View.html($(this).parents("tr").attr("pk_id"))})})},html:function(workDayId){var modalParams={id:"workingday_add_edit_view",cardId:"workingday_add_edit_cont"},viewModal=new sliderModal(ZPI18N.getString("zp.view"),modalParams);viewModal.construct(),viewModal.setCloseCallback(function(){viewModal.remove()});var ele=settingsPage.container.find("#workingday_add_edit_view"),workingDayAddHtmls='<div class="zpl_crd"> <div class="zpl_crdcnt">';workingDayAddHtmls+='<div class="zpl_secn"><div><label name="name" class="zpl_mtry"><b>'+ZPI18N.getString("zp.name")+"</b></label></div></div>",workingDayAddHtmls+='<div class="zpl_secn"><div><label name="date" class="zpl_mtry"><b>'+ZPI18N.getString("zp.date")+"</b></label></div></div>",workingDayAddHtmls+='<div class="zpl_secn"><div><label name="location"><b>'+ZPI18N.getString("zp.multiplelocation")+"</b></label></div></div>",workingDayAddHtmls+='<div class="zpl_secn"><div><label name="shift"><b>'+ZPI18N.getString("zp.multipleshift")+"</b></label></div></div>",workingDayAddHtmls+='<div class="zpl_secn"><div><label name="remark"><b>'+ZPI18N.getString("zp.description")+"</b></label></div></div>",ele.find(".zpl_mcnt").html(workingDayAddHtmls),ele.find("#sliderSbt").remove();var actionSpan=ZP.create("span",{id:"edit_icon",class:"zpl_mhderrgt a-itm-cntr CP"}),edit=ZP.create("a",{class:"zpl_ibg PI_edt"});$(edit).on("click",edit,function(){ele.length>0&&(viewModal.remove(),ele.remove()),ExpWorkingDay.Add.html(1,workDayId+"")}),$(actionSpan).append(edit),ele.find(".zpl_mhder").find("#edit_icon").remove(),$(actionSpan).insertBefore(ele.find(".zpl_mhder .PI_cls"));var params={mode:"edit_view",method:"view",id:workDayId+""};ZPeople.Request.send("getdetail_workingday.zp",params,function(result){ExpWorkingDay.Operation.fillViewData(result,ele),viewModal.open()})},getParams:function(params){settingsPage.container.find(".datepicker");params.from=ZPeopleComponents.datefield(settingsPage.container.find(".datepicker")[0]).getValue().dateString,params.to=ZPeopleComponents.datefield(settingsPage.container.find(".datepicker")[1]).getValue().dateString;var applFor=ZPeopleComponents.select(settingsPage.container.find("[name=applFor]")).getValue(),groupBy=ZPeopleComponents.select(settingsPage.container.find("[name=applFor]"))._selected[0].optData.groupBy;return 0==applFor||1==applFor?params.applicableFor=applFor:"Location"==groupBy?params.location=applFor:"Shift"==groupBy&&(params.shift=applFor),params.conreqcsr=csrfToken,params}},Add:{appElementsIndex:[0,8],appElementsKey:[],html:function(operationVal,workDayId){var title=0==operationVal?ZPI18N.getString("zp.weekendwork.addweekendworkdaytitle"):ZPI18N.getString("zp.weekendwork.editweekendworkdaytitle");$("#workingday_add_edit_view").remove();var modalParams={id:"workingday_add_edit_view",cardId:"moduleCards"};modalParams.validate=ExpWorkingDay.Operation.save;var addModal=new sliderModal(title,modalParams);addModal.construct(),addModal.setCloseCallback(function(){addModal.remove()});var modal=settingsPage.container.find("#workingday_add_edit_view");modal.find("#moduleCards").css("position","relative");var ele=settingsPage.container.find("#workingday_add_edit_view");ele.data("pk_id","");var workingDayAddHtmls='<div class="zpl_crd"> <div class="zpl_crdcnt">';if(workingDayAddHtmls+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.name")+'</label></div><div><input type="text" class="ztextbox" name="name"><span class="ztextbox--error__label"></span></div></div>',workingDayAddHtmls+='<div class="zpl_secn"><div id="Date"><label class="zpl_mtry">'+ZPI18N.getString("zp.date")+'</label></div><div><input name="date" class="datepicker-js W100"><span id="dateErr" class="ztextbox--error__label"></span></div></div>',workingDayAddHtmls+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.description")+'</label></div><div><textarea class="ztextbox" name="remark" rows="2"></textarea></div></div>',workingDayAddHtmls+='<div class="zpl_secn"><div><div class="zpl_info" id="leaveinfo"><b>'+ZPI18N.getString("zp.note")+" : </b> "+ZPI18N.getString("zp.weekendwork.weekendworkdaynotemsg")+"</div></div></div>",workingDayAddHtmls+="</div></div>",modal.find(".zpl_mcnt").html(workingDayAddHtmls),LeaveAdminOpers.ZPeopleComponents.DateField.init({container:ele.find("[name=date]"),appendTo:"#workingday_add_edit_view"}),ExpWorkingDay.Add.appElementsKey[0]="location",ExpWorkingDay.Add.appElementsKey[8]="shifts",ExpWorkingDay.Add.appElementsIndex=AppExc.removeUnApplicableElements([0,8]),AppExc.setAppIndex(ExpWorkingDay.Add.appElementsIndex,!1),modal.find(".zpl_crdcnt .zpl_secn").eq(2).before(AppExc.returnApplicableHtml("appToSec")),AppExc.showHideAddMoreEle(modal,AppExc.returnAppElementsIndex()),settingsPage.container.find("#appToSec .zpl_mtry").text(ZPI18N.getString("zp.applicablefor",[""])),settingsPage.container.find("#appToSec #employeeBox").remove(),settingsPage.container.find("#appToSec .zpl_cndop").remove(),settingsPage.container.find("#appToSec").find("label").removeClass("zpl_mtry"),1==operationVal){var form=settingsPage.container.find("#workingday_add_edit_view");form.data("pk_id",workDayId);var params={mode:"edit_view",method:"view",id:workDayId};ZPeople.Request.send("getdetail_workingday.zp",params,function(result){void 0!==result&&""!==result&&(ExpWorkingDay.Add.fillFormData(result,form),addModal.open(),AppExc.addNewConditionRow(void 0,"appToSec"),modal.find('[name="name"]').focus())}),form.find(".modal-header").find(".PI_edt").remove()}else addModal.open(),modal.find('[name="name"]').focus(),AppExc.addNewConditionRow(void 0,"appToSec")},fillFormData:function(result,form){var locations=result.locations,locationArray=new Array;$(locations).each(function(idx,location){locationArray.push(location.id)}),result.location=locationArray;var shifts=result.shifts,shiftArray=new Array;$(shifts).each(function(idx,shift){shiftArray.push(shift.id)}),result.location=locationArray,result.shift=shiftArray,ExpWorkingDay.Operation.fillFormData(result,form)}},Operation:{save:function(){var holiday=settingsPage.container.find("#workingday_add_edit_view");holiday.find("#sliderSbt").addClass("disabled");holiday.find("input[name=date]");var params={method:"update"},pk_id=holiday.data("pk_id");if(void 0==pk_id||""==pk_id||isNaN(pk_id)||(params.id=pk_id),!ExpWorkingDay.Operation.validate(params))return holiday.find("#sliderSbt").removeClass("disabled"),!1;ZPeople.Request.send("update_workingday.zp",params,function(respdata){var name=holiday.find("input[name='name']"),period=holiday.find("input[name=date]");$.isEmptyObject(respdata.error)?respdata.success?(holiday.find("#sliderSbt").removeClass("disabled"),ExpWorkingDay.hideModal("workingday_add_edit_view"),ExpWorkingDay.View.list(),ModuleComp.Msg.showSuccessMsg(respdata.message)):(respdata.duplicate||respdata.noweekend)&&(Holidays.Operation.showerror(period,respdata.message),holiday.find("#sliderSbt").removeClass("disabled")):(respdata.error.hasOwnProperty("name")&&(Holidays.Operation.showerror(name,ZPI18N.getString("zp.holiday.nameerror")),holiday.find("#sliderSbt").removeClass("disabled")),respdata.error.hasOwnProperty("date")&&(Holidays.Operation.showerror(period,ZPI18N.getString("zp.validdateerr")),holiday.find("#sliderSbt").removeClass("disabled")))})},fillViewData:function(data,form){$(form.find("label")).each(function(){var name=(field=$(this)).attr("name");if($(ZP.create("div",{name:name,class:""})).insertAfter($(this).parent()),ele=$(this).parent().siblings("div"),"location"===name){if(data.locations)if(_.isEmpty(data.locations))$(ele).append(ZP.create("span",{text:ZPI18N.getString("zp.alllocaction")+""}));else for(indx in data.locations)indx<data.locations.length-1?$(ele).append(ZP.create("span",{text:ZPeople.decodeTxt(data.locations[indx].name)+", "})):$(ele).append(ZP.create("span",{text:ZPeople.decodeTxt(data.locations[indx].name)}))}else if("shift"===name){if(data.shifts)if(_.isEmpty(data.shifts))$(ele).append(ZP.create("span",{text:ZPI18N.getString("zp.allshift")+""}));else for(indx in data.shifts)indx<data.shifts.length-1?$(ele).append(ZP.create("span",{text:ZPeople.decodeTxt(data.shifts[indx].name)+", "})):$(ele).append(ZP.create("span",{text:ZPeople.decodeTxt(data.shifts[indx].name)}))}else{var field=data[name]?data[name]:"-";$(ele).append(ZP.create("span",{text:"name"==name||"remark"==name?ZPeople.decodeTxt(field):field}))}})},fillFormData:function(result,form){$(form.find("[name]")).each(function(idx,ele){var field=$(ele),name=field.attr("name");"name"===name||"remark"===name?field.val(ZPeople.decodeTxt(result[name])):"date"===name&&ZPeopleComponents.datefield(field).setValue(result[name])}),ExpWorkingDay.Add.appElementsKey.forEach(function(val,index){val="shifts"==val?"shift":val,ExpWorkingDay.Add.appElementsIndex.includes(index)&&result[val].length>0&&AppExc.addNewConditionRow(void 0,"appToSec",index,result[val])})},validate:function(params){var isvalid=!0,workingday=settingsPage.container.find("#workingday_add_edit_view"),name=workingday.find("input[name='name']"),date=workingday.find("input[name=date]"),dateVal=ZPeopleComponents.datefield(date).getValue().dateString,description=workingday.find("textarea[name='remark']");if(name.val()&&""!=name.val()?(Holidays.Operation.hideerror(name),params.name=name.val()):(Holidays.Operation.showerror(name,ZPI18N.getString("zp.holiday.nameerror")),isvalid=!1),dateVal&&Calendar.isvalidDate(dateVal)){var date_dt=Calendar.parseDate(dateVal,uidateFormat);isNaN(date_dt.getTime())?(Holidays.Operation.showerror(date,ZPI18N.getString("zp.validdateerr")),isvalid=!1):(Holidays.Operation.hideerror(date),params.date=dateVal)}else Holidays.Operation.showerror(date,ZPI18N.getString("zp.validdateerr")),isvalid=!1;var remarks=description.val()?description.val():"";params.remark=remarks;var applFor=AppExc.constructAppValues(workingday,"#appToSec",ExpWorkingDay.Add.appElementsKey);return params.location=JSON.stringify(applFor.location),params.shifts=JSON.stringify(applFor.shifts),isvalid},deleteRecord:function(ele){var trparent=$(ele).closest("tr"),params={method:"delete"};params[csrfParamName]=csrfToken;var recId=trparent.attr("pk_id");recId&&(params.id=recId,$.post("/delete_workingday.zp",params,function(data){"success"===data.status&&(data.isDeleted?(trparent.remove(),ModuleComp.Msg.showSuccessMsg(data.message)):ModuleComp.Msg.showFailureMsg(data.message))}))}}};Leave.Reports={moduleName:"leavetracker",url:"/leave_reports_actions.zp",exporturl:"leave_reports_export.zp",url2:"/leave_v2_reports_actions.zp",exporturl2:"leave_v2_reports_export.zp",Filters:{cache:{},searchCache:{},constructFilter:function(obj,entity,isSingle,filterOnChangeCallback,firescrollMode,includePayPeriod){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker;if("legalEntity"!==entity&&"businessUnit"!==entity&&"division"!==entity||isOrgStructureEnabled){var details={entity:entity,isSingle:isSingle};switch(filterOnChangeCallback&&(details.filterOnChangeCallback=filterOnChangeCallback),entity){case"datePeriod":details.text=ZPI18N.getString("zp.period");var objId=Layout.Page.container.attr("id");objId.indexOf("leave-leavetaken")>-1||objId.indexOf("leave-lbalance")>-1||objId.indexOf("leave-summary")>-1?details.staticOptions=[{id:"0",text:ZPI18N.getString("zp.yesterday"),periodType:ZPLite.DateNavigator.TYPE.DAILY,tense:"previous"},{id:"1",text:ZPI18N.getString("zp.today"),periodType:ZPLite.DateNavigator.TYPE.DAILY,tense:"current"},{id:"2",text:ZPI18N.getString("zp.lastmonth"),periodType:ZPLite.DateNavigator.TYPE.MONTHLY,tense:"previous"},{id:"3",text:ZPI18N.getString("zp.tt_thismonth"),periodType:ZPLite.DateNavigator.TYPE.MONTHLY,tense:"current"},{id:"4",text:ZPI18N.getString("zp.lastyear"),periodType:ZPLite.DateNavigator.TYPE.CUSTOM,tense:"previous"},{id:"5",text:ZPI18N.getString("zp.thisyear"),periodType:ZPLite.DateNavigator.TYPE.CUSTOM,tense:"current"},{id:"6",text:ZPI18N.getString("zp.custom"),periodType:"custom"}]:details.staticOptions=[{id:"0",text:ZPI18N.getString("zp.yesterday"),periodType:ZPLite.DateNavigator.TYPE.DAILY,tense:"previous"},{id:"1",text:ZPI18N.getString("zp.today"),periodType:ZPLite.DateNavigator.TYPE.DAILY,tense:"current"},{id:"2",text:ZPI18N.getString("zp.lastweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:"previous"},{id:"3",text:ZPI18N.getString("zp.thisweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:"current"},{id:"4",text:ZPI18N.getString("zp.lastmonth"),periodType:ZPLite.DateNavigator.TYPE.MONTHLY,tense:"previous"},{id:"5",text:ZPI18N.getString("zp.tt_thismonth"),periodType:ZPLite.DateNavigator.TYPE.MONTHLY,tense:"current"},{id:"6",text:ZPI18N.getString("zp.custom"),periodType:"custom"}];break;case"period":details.text=ZPI18N.getString("zp.period"),details.staticOptions=[{id:"-1",text:ZPI18N.getString("zp.lastyear"),periodType:ZPLite.DateNavigator.TYPE.MONTHLY,tense:"previous"},{id:"0",text:ZPI18N.getString("zp.thisyear"),periodType:ZPLite.DateNavigator.TYPE.MONTHLY,tense:"current"},{id:"1",text:ZPI18N.getString("zp.custom"),periodType:"custom"}];break;case"reportType":details.text=ZPI18N.getString("zp.reports.reporttype"),details.staticOptions=[{id:"0",text:ZPI18N.getString("zp.default")},{id:"1",text:ZPI18N.getString("zp.detailed")}];break;case"typeofLeave":details.text=ZPI18N.getString("zp.type"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")};var type=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.typeofleave;type instanceof Array&&type.length>0?($.each(type,function(i,typeOfLeave){typeOfLeave.name=ZSEC.Encoder.encodeForHTML(typeOfLeave.name),type[i]=typeOfLeave}),details.staticOptions=Leave.Reports.Filters.formatFilterData(type,entity)):details.staticOptions=[];break;case"leaveyear":details.text=ZPI18N.getString("zp.period");var lYear=Leave.Reports.Util.getLeaveYear(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location);lYear instanceof Array&&lYear.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(lYear,entity):details.staticOptions=[];break;case"employee":details.text=ZPI18N.getString("zp.employee"),details.showSelectedOptionCount=!0,details.enableClear=!0,(Layout.Page.pageId.indexOf("leave-yearly")>-1||Layout.Page.pageId.indexOf("leave-user")>-1)&&(details.enableClear=!1),details.loadOptionsCallback=Leave.Reports.Filters.getOptionsForFilter,details.searchDtls={text:ZPI18N.getString("zp.search")},firescrollMode&&(details.firescrollDtls={mode:firescrollMode,maxFetchLimit:25});break;case"ppLocation":details.text=ZPI18N.getString("zp.location"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.loadOptionsCallback=Leave.Reports.Filters.getOptionsForFilter,details.searchDtls={text:ZPI18N.getString("zp.search")};break;case"ppRole":details.text=ZPI18N.getString("zp.role"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.loadOptionsCallback=Leave.Reports.Filters.getOptionsForFilter,details.searchDtls={text:ZPI18N.getString("zp.search")};break;case"department":var dept;details.text=ZPI18N.getString("zp.department"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")};var deptViewPerm=moduleData.leave_filterops.deptViewPerm;if(dept=Layout.Page.pageId.indexOf("leave-availability")>-1&&!Leave.Util.isCurPageAdmin()&&("0"==deptViewPerm||"1"==deptViewPerm||"2"==deptViewPerm)&&moduleData.leave_filterops.depPermDepartments?moduleData.leave_filterops.depPermDepartments:moduleData.leave_filterops.department,moduleData.leave_filterops.isSPOCLvReportViewEnabled)void 0!==(spocJson=moduleData.leave_filterops.spocReportJson)&&void 0!==spocJson[entity]&&(dept=Leave.SPOCSettings.mergeJsonWithoutDuplicates(dept,spocJson[entity]));dept instanceof Array&&dept.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(dept,entity):details.staticOptions=[];break;case"location":var loc;details.text=ZPI18N.getString("zp.location"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")},details.loadOptionsCallback=Leave.Reports.Filters.getOptionsForFilter;deptViewPerm=moduleData.leave_filterops.deptViewPerm;if(loc=Layout.Page.pageId.indexOf("leave-availability")>-1&&!Leave.Util.isCurPageAdmin()&&("0"==deptViewPerm||"1"==deptViewPerm||"2"==deptViewPerm)&&moduleData.leave_filterops.depPermLocs?moduleData.leave_filterops.depPermLocs:moduleData.leave_filterops.location,moduleData.leave_filterops.isSPOCLvReportViewEnabled)void 0!==(spocJson=moduleData.leave_filterops.spocReportJson)&&void 0!==spocJson[entity]&&(loc=Leave.SPOCSettings.mergeJsonWithoutDuplicates(loc,spocJson[entity]));loc instanceof Array&&loc.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(loc,entity):details.staticOptions=[];break;case"role":if(!Leave.roleFilter.isEnabled()){obj.addClass("DNI");break}details.text=ZPI18N.getString("zp.role"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")};var role=moduleData.leave_filterops.role;role instanceof Array&&role.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(role,entity):details.staticOptions=[];break;case"orgTag":if(!Leave.organizationTag.isEnabled()){obj.addClass("DNI");break}details.text=ZPeople.orgTagDisplayName,details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")};var orgTag=moduleData.leave_filterops.orgTag;if(moduleData.leave_filterops.isSPOCLvReportViewEnabled)void 0!==(spocJson=moduleData.leave_filterops.spocReportJson)&&void 0!==spocJson[entity]&&(orgTag=Leave.SPOCSettings.mergeJsonWithoutDuplicates(orgTag,spocJson[entity]));orgTag instanceof Array&&orgTag.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(orgTag,entity):details.staticOptions=[],obj.removeClass("DNI");break;case"designation":details.text=ZPI18N.getString("zp.designation"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")};var spocJson,desg=moduleData.leave_filterops.designation;if(moduleData.leave_filterops.isSPOCLvReportViewEnabled)void 0!==(spocJson=moduleData.leave_filterops.spocReportJson)&&void 0!==spocJson[entity]&&(desg=Leave.SPOCSettings.mergeJsonWithoutDuplicates(desg,spocJson[entity]));desg instanceof Array&&desg.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(desg,entity):details.staticOptions=[];break;case"legalEntity":details.text=ZPeople.orgStructureDispNameMap.entity,details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")};var legalEntity=moduleData.leave_filterops.entity;legalEntity instanceof Array&&legalEntity.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(legalEntity,entity):details.staticOptions=[];break;case"businessUnit":details.text=ZPeople.orgStructureDispNameMap.unit,details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")};var businessUnit=moduleData.leave_filterops.businessUnit;businessUnit instanceof Array&&businessUnit.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(businessUnit,entity):details.staticOptions=[];break;case"division":details.text=ZPeople.orgStructureDispNameMap.division,details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")};var division=moduleData.leave_filterops.division;division instanceof Array&&division.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(division,entity):details.staticOptions=[];break;case"leavetype":var formName=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formdisplayName;details.text=formName+" "+ZPI18N.getString("zp.leave.type"),details.showSelectedOptionCount=!0,details.enableClear=-1==Layout.Page.pageId.indexOf("leave-summary"),details.searchDtls={text:ZPI18N.getString("zp.search")};var leavetype=moduleData.leave_filterops.leavetype;leavetype instanceof Array&&leavetype.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(leavetype,entity):details.staticOptions=[];break;case"employeeStatus":details.text=ZPI18N.getString("zp.employeestatus"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")};var employeeStatus=moduleData.leave_filterops.employeeStatus;employeeStatus instanceof Array&&employeeStatus.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(employeeStatus,entity):details.staticOptions=[];break;case"payPeriod":details.text=ZPI18N.getString("zp.leave.report.payperiod"),details.searchDtls={text:ZPI18N.getString("zp.search")};var payperiod=moduleData.leave_filterops.payPeriod;payperiod instanceof Array&&payperiod.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(payperiod,entity):details.staticOptions=[];break;case"bfType":details.text=ZPI18N.getString("zp.type"),details.searchDtls={text:ZPI18N.getString("zp.search")};var bfType=moduleData.leave_filterops.bradford;bfType instanceof Array&&bfType.length>0?details.staticOptions=Leave.Reports.Filters.formatFilterData(bfType,entity):details.staticOptions=[];break;case"bfThresHold":details.text=ZPI18N.getString("zp.bradfordfactor.threslevel"),details.staticOptions=[{id:"0",text:ZPI18N.getString("zp.select")},{id:"1",text:ZPI18N.getString("zp.Level")+" 1"},{id:"2",text:ZPI18N.getString("zp.Level")+" 2"},{id:"3",text:ZPI18N.getString("zp.Level")+" 3"},{id:"4",text:ZPI18N.getString("zp.Level")+" 4"},{id:"5",text:ZPI18N.getString("zp.Level")+" 5"}]}ZPLite.Filters.init(obj,details)}},getOptionsForFilter:function(data,searchText,fetchedRecordCount){fetchedRecordCount=fetchedRecordCount||0;var options=[],result=Leave.Reports.Filters.getOptionsFromCache(data,searchText,fetchedRecordCount);if(result.makeRequest){var entity=data.entity;if("employee"===entity)(params={mode:"SEARCH",isDef:!0,searchType:"emp",searchMode:"LEAVE_REPORTDATA_VIEW",conreqcsr:csrfToken}).extraparam=JSON.stringify(Leave.Reports.Filters.employeeSearchExtraParams()),searchText&&""!==searchText&&(params.key=encodeURIComponent(searchText)),params.start=fetchedRecordCount>0?fetchedRecordCount+1:1,ZPeople.Request.sendAsyncPost(ZPComponents.Search.URL,params,function(response){return options=Leave.Reports.Filters.formatFilterData(ZPLite.Modules.Filters.getEmpMatchData(response,searchText),entity),searchText&&""!==searchText?Leave.Reports.Filters.searchCache[entity][searchText]?Leave.Reports.Filters.searchCache[entity][searchText]=Leave.Reports.Filters.searchCache[entity][searchText].concat(options):Leave.Reports.Filters.searchCache[entity][searchText]=options:void 0!==Leave.Reports.Filters.cache[entity]?Leave.Reports.Filters.cache[entity]=Leave.Reports.Filters.cache[entity].concat(options):Leave.Reports.Filters.cache[entity]=options,options});else if("ppLocation"===entity){var loc;entity="location";var moduleData=ZPeople.Module.MODULE_DATA.leavetracker;if((payPeriods=moduleData.leave_filterops.payPeriod)&&payPeriods.length>0){var cur_pp=void 0==ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'))[0]?moduleData.leave_filterops.payPeriod[0].rsID:ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'))[0].id;for(idx in payPeriods)payPeriods[idx].rsID==cur_pp&&(loc=[],Object.keys(payPeriods[idx].rsLocations).length?$(moduleData.leave_filterops[entity]).each(function(){var id=$(this)[0].id,name=$(this)[0].name;payPeriods[idx].rsLocations.hasOwnProperty(id)&&loc.push({id:id,name:name})}):$(moduleData.leave_filterops[entity]).each(function(){var id=$(this)[0].id,name=$(this)[0].name;loc.push({id:id,name:name})}),payPeriods[idx].isAllLocation&&loc.push({id:"-2",name:ZPI18N.getString("zp.notspecified")}));if(moduleData.leave_filterops.isSPOCLvReportViewEnabled)void 0!==(spocJson=moduleData.leave_filterops.spocReportJson)&&void 0!==spocJson[entity]&&(loc=Leave.SPOCSettings.mergeJsonWithoutDuplicates(loc,spocJson[entity]));if(searchText&&""!==searchText){for(var len=loc.length,searchLoc=[],i=0;i<len;i++)loc[i].name.toUpperCase().indexOf(searchText.toUpperCase())>-1&&searchLoc.push({id:loc[i].id,name:loc[i].name});options=Leave.Reports.Filters.formatFilterData(searchLoc,entity)}else options=Leave.Reports.Filters.formatFilterData(loc,entity);return options}}else if("ppRole"===entity){var role;entity="role";var payPeriods;moduleData=ZPeople.Module.MODULE_DATA.leavetracker;if((payPeriods=moduleData.leave_filterops.payPeriod)&&payPeriods.length>0){var spocJson;cur_pp=void 0==ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'))[0]?moduleData.leave_filterops.payPeriod[0].rsID:ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'))[0].id;for(idx in payPeriods)payPeriods[idx].rsID==cur_pp&&(role=[],Object.keys(payPeriods[idx].rsRoles).length?$(moduleData.leave_filterops[entity]).each(function(){var id=$(this)[0].id,name=$(this)[0].name;payPeriods[idx].rsRoles.hasOwnProperty(id)&&role.push({id:id,name:name})}):$(moduleData.leave_filterops[entity]).each(function(){var id=$(this)[0].id,name=$(this)[0].name;role.push({id:id,name:name})}),payPeriods[idx].isAllRole&&role.push({id:"-2",name:ZPI18N.getString("zp.notspecified")}));if(moduleData.leave_filterops.isSPOCLvReportViewEnabled)void 0!==(spocJson=moduleData.leave_filterops.spocReportJson)&&void 0!==spocJson[entity]&&(role=Leave.SPOCSettings.mergeJsonWithoutDuplicates(role,spocJson[entity]));if(searchText&&""!==searchText){len=role.length;var searchRole=[];for(i=0;i<len;i++)role[i].name.toUpperCase().indexOf(searchText.toUpperCase())>-1&&searchRole.push({id:role[i].id,name:role[i].name});options=Leave.Reports.Filters.formatFilterData(searchRole,entity)}else options=Leave.Reports.Filters.formatFilterData(role,entity);return options}}else{var params={entity:entity,conreqcsr:csrfToken};searchText&&""!==searchText&&(params.searchText=searchText);params.sIndex=fetchedRecordCount>0?fetchedRecordCount+1:0,params.limit=25,ZPeople.Request.sendAsyncPost(ZPLite.Reports.url+"getFilterData",params,function(response){return response&&void 0!==response[entity]&&(options=response[entity]),searchText&&""!==searchText?Leave.Reports.Filters.searchCache[entity][searchText]?Leave.Reports.Filters.searchCache[entity][searchText]=Leave.Reports.Filters.searchCache[entity][searchText].concat(options):Leave.Reports.Filters.searchCache[entity][searchText]=options:void 0!==Leave.Reports.Filters.cache[entity]?Leave.Reports.Filters.cache[entity]=Leave.Reports.Filters.cache[entity].concat(options):Leave.Reports.Filters.cache[entity]=options,options})}}else options=result.options;return options},employeeSearchExtraParams:function(){var extra_params={employeeStatus:3,employeeStatusarr:[19,-2,18],incDateOfExit:!0};"myReports"===ZPLite.Reports.selectedTab?extra_params.peopleLiteReportType="personalReport":"teamReports"===ZPLite.Reports.selectedTab?extra_params.peopleLiteReportType="teamReport":extra_params.peopleLiteReportType="orgReport";var emp_status=ZPLite.Filters.getValues(Layout.Page.container.find('[name="employeeStatusFilter"]')),isMultiple=!1,incDtOFExit=Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked");if(extra_params.incDateOfExit=incDtOFExit,void 0!==emp_status&&emp_status.length>0)if(isMultiple=!0,Layout.Page.container.find("[name=fromDateFilter]")[0]&&(extra_params.from=Layout.Page.container.find("[name=fromDateFilter]").val(),extra_params.to=Layout.Page.container.find("[name=toDateFilter]").val()),isMultiple){var employeeStatus=[];$.each(emp_status,function(index,options){employeeStatus.push(options.id)}),extra_params.employeeStatusarr=employeeStatus}else extra_params.employeeStatus=emp_status;if(Layout.Page.pageId.indexOf("leave-lop")>-1||Layout.Page.pageId.indexOf("leave-payroll")>-1||Layout.Page.pageId.indexOf("leave-encashment")>-1){var cur_pp=ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'))[0].id;extra_params.payPeriodSettingId=cur_pp}return extra_params},getOptionsFromCache:function(data,searchText,fetchedRecordCount){var makeRequest=!0,entity=data.entity,firescrollDtls=data.firescrollDtls,options=[];if(searchText&&""!==searchText){if(void 0===Leave.Reports.Filters.searchCache[entity]&&(Leave.Reports.Filters.searchCache[entity]={}),void 0!==Leave.Reports.Filters.searchCache[entity][searchText])if(0===Leave.Reports.Filters.searchCache[entity][searchText].length)makeRequest=!1;else if(Leave.Reports.Filters.searchCache[entity][searchText].length>fetchedRecordCount){for(var itr=fetchedRecordCount;itr<Leave.Reports.Filters.searchCache[entity][searchText].length&&options.length<firescrollDtls.maxFetchLimit;itr++)options.push(Leave.Reports.Filters.searchCache[entity][searchText][itr]);makeRequest=!1}}else if(void 0!==Leave.Reports.Filters.cache[entity])if(0===Leave.Reports.Filters.cache[entity].length)makeRequest=!1;else if(Leave.Reports.Filters.cache[entity].length>fetchedRecordCount){for(itr=fetchedRecordCount;itr<Leave.Reports.Filters.cache[entity].length&&options.length<firescrollDtls.maxFetchLimit;itr++)options.push(Leave.Reports.Filters.cache[entity][itr]);makeRequest=!1}return{makeRequest:makeRequest,options:options}},clearCache:function(clearAll,entity){clearAll?(Leave.Reports.Filters.cache={},Leave.Reports.Filters.searchCache={}):entity&&(void 0!==Leave.Reports.Filters.cache[entity]&&(Leave.Reports.Filters.cache[entity]=void 0),void 0!==Leave.Reports.Filters.searchCache[entity]&&(Leave.Reports.Filters.searchCache[entity]=void 0))},formatFilterData:function(options,entity){var results=[];if(options)for(var itr in options){var option=options[itr];if(("-1"!=option.id||"typeofLeave"==entity||"leaveyear"==entity)&&("leavetype"!==entity||!option.isDisabled)){var res;if("employee"===entity)(res={id:option[0]}).text=ZPeople.decodeTxt(ZPeople.escapeHtml(option[1]+" "+ZPeople.getUserDisplayName(option[2],option[3]))),""===option[6].trim()?""===option[5].trim()?res.photoUrl=ZPeople.getResourceURL(imageUrl+"user.png"):res.photoUrl=contactUrl+"/file?ID="+option[5]+"&fs=thumb":0==option[6].indexOf("/newhr/images/sampleemployeephotos/")?res.photoUrl=option[6]:res.photoUrl="viewPhoto?filename="+option[6];else if("payPeriod"===entity)res={id:option.rsID,text:ZPeople.escapeHtml(option.rsName)};else{if(Layout.Page.pageId.indexOf("leave-summary")>-1&&"leavetype"===entity&&("4"==option.type||"2"==option.type))continue;res={id:option.id,text:option.name}}results.push(res)}}return results},setFromToDateFilter:function(from,to){var container=Layout.Page.container,fromDateFilter=container.find('[name="fromDateFilter"]'),name=fromDateFilter.attr("name");fromDateFilter.val(from),fromDateFilter.data("selectedDate",Calendar.parseDate(from,uidateFormat)),fromDateFilter.data("text",from),fromDateFilter.addClass("selected"),fromDateFilter.find('[name="'+name+'Text"]').text(from),fromDateFilter.find('[name="'+name+'Text"]').val(from);var toDateFilter=container.find('[name="toDateFilter"]');name=toDateFilter.attr("name");toDateFilter.val(to),toDateFilter.data("selectedDate",Calendar.parseDate(to,uidateFormat)),toDateFilter.data("text",to),toDateFilter.addClass("selected"),toDateFilter.find('[name="'+name+'Text"]').text(to),toDateFilter.find('[name="'+name+'Text"]').val(to)},validateFilterParams:function(){var errorMessage,container=Layout.Page.container.find("#filterDiv"),errorDivs=container.find(".error-clr");if(errorDivs.length>0&&$.each(errorDivs,function(index,errorDiv){$(errorDiv).removeClass("error-clr")}),"Custom"===container.find('[name="datePeriodFilter"]').find(".optionsList").find("li.sel").find("a").text()){var from=container.find('[name="fromDateFilter"]').val(),to=container.find('[name="toDateFilter"]').val();Calendar.parseDate(from,uidateFormat),Calendar.parseDate(to,uidateFormat);void 0===from||""===from?(container.find('[name="fromDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptyfromdate")):void 0===to||""===to?(container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptytodate")):Leave.Util.Validate.toafterfrom(from,to)||(container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.greaterfromdate"))}return void 0===errorMessage||(ZPeople.Message.showWarningMsg(errorMessage),!1)}},Util:{getDate:function(name){return"from_month"==name?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.month_start:"to_month"==name?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.month_end:"from_year"===name?Leave.Reports.Util.getCurrentLYear(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location).from:"to_year"===name?Leave.Reports.Util.getCurrentLYear(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location).to:"date"===name?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date:void 0},getMultiLocationLYear:function(location,nav){var loc_data=null;if(location){loc_data=Leave.Reports.Util.getLYear(location[0],nav);for(var isSame_lyear=!0,i=1;i<location.length;i++)if(JSON.stringify(loc_data)!=JSON.stringify(Leave.Reports.Util.getLYear(location[i],nav))){isSame_lyear=!1;break}isSame_lyear||(loc_data=Leave.Reports.Util.getLYear(-1,nav))}else loc_data=Leave.Reports.Util.getLYear(location,nav);return loc_data},getCurrentLYear:function(key){return Leave.Reports.Util.getLYear(key,0)},getLYear:function(key,lyear){var lyear_obj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leaveyear,lyArr=[];for(var indx in lyArr=lyear_obj.hasOwnProperty(key)?lyear_obj[key]:lyear_obj[-1]){var data_json=lyArr[indx];if(data_json.id==lyear)return data_json}},getLeaveYear:function(key){var lyear_obj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leaveyear,arr=[];if(lyear_obj.hasOwnProperty(key)){var years=lyear_obj[key];if(Layout.Page.pageId.indexOf("rollover")>-1){var obj={id:"all",name:ZPI18N.getString("zp.allyears")};arr.push(obj)}for(var indx in years)Layout.Page.pageId.indexOf("rollover")>-1&&years[indx].id>0||arr.push(years[indx]);return arr}years=lyear_obj[-1];if(Layout.Page.pageId.indexOf("rollover")>-1){obj={id:"all",name:ZPI18N.getString("zp.allyears")};arr.push(obj)}for(var indx in years)Layout.Page.pageId.indexOf("rollover")>-1&&years[indx].id>0||arr.push(years[indx]);return arr},appendLoading:function(id){Layout.Page.container.find(".ZPNdata").fadeOut(100).remove(),$(ZPeople.LOADING_HTML).insertBefore(Layout.Page.container.find("#"+id))},removeLoading:function(){Layout.Page.container.find("[id=zp_page_loading]").fadeOut(200).remove()},showHideNoRecord:function(isShow,id,text,html){(Layout.Page.container.find(".ZPNdata ").remove(),isShow)&&(text=void 0==text?ZPI18N.getString("zp.noreportsmsg"):text,$(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",text,void 0,void 0,html)).insertBefore(Layout.Page.container.find("#"+id)))},toggleSort:function(curEle,bodyHeader){(curEle=$(curEle)).addClass("ignore"),curEle.hasClass("sort-d")?(curEle.addClass("sort-u"),curEle.removeClass("sort-d")):(curEle.addClass("sort-d"),curEle.removeClass("sort-u")),$(".Tclr:not(.ignore)",bodyHeader).removeClass("Tclr IC-ar-sel sort-d sort-u").addClass("Tclr"),curEle.removeClass("ignore")},sortParams:function(params){var sortEle=Layout.Page.container.find(".table_responsive > table > thead").find(".sort-d , .sort-u");if(sortEle){var sortBy=sortEle.attr("id");params.sortType=sortEle.hasClass("sort-d")?0:1,params.sortBy=1,"Leavetype"===sortBy?params.sortBy=2:"FromTo"===sortBy?params.sortBy=3:"WorkedDate"===sortBy?params.sortBy=5:"ExpiryDate"===sortBy?params.sortBy=6:"ReportingTo"===sortBy?params.sortBy=7:"Balance"===sortBy&&(params.sortBy=8)}},getFilterLocIds:function(){var locationId=[],values=ZPLite.Filters.getValues(Layout.Page.container.find('[name="locationFilter"]'));return void 0!==values&&values.length>0&&$.each(values,function(index,options){locationId.push(options.id)}),locationId},getReportSetingsConfByLoc:function(location){var locationReport,payPeriods=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod;for(idx in payPeriods){var report=payPeriods[idx];report.isAllLocation&&(locationReport=report);var locFlag=!0;for(indx in location)if(!report.rsLocations.hasOwnProperty(location[indx])){locFlag=!1;break}if(locFlag){locationReport=report;break}}return locationReport&&(locationReport.rsPayrollClosure&&-1!=locationReport.rsPayrollClosure||(locationReport.rsPayrollClosure=locationReport.rsClosureDay,locationReport.payrollClosureNotConfigured=!0,4==locationReport.rsFrequency&&(locationReport.rsSecPayrollClosure=locationReport.rsSecClosureDay))),locationReport},navPayPeriod:function(pager,input){var payperiod=pager.data("payperiod"),reportConf=payperiod.conf;if(1!=input||!(payperiod.end>=payperiod.cur_date||payperiod.closure>=payperiod.cur_date)){if(3==payperiod.conf.rsFrequency||4==payperiod.conf.rsFrequency){payperiod.period_pos+=input;var cur_payperiod=Attendance.Report.getFromToForPayPeriod(payperiod.period_pos,reportConf.rsFrequency,reportConf.rsClosureDay,reportConf.rsSecClosureDay,reportConf.rsToDay,reportConf.lastScheRunTime,reportConf.rsPayrollClosure,reportConf.rsSecPayrollClosure);payperiod.start=cur_payperiod.fromDay._d,payperiod.end=cur_payperiod.toDay._d,payperiod.closure=cur_payperiod.closureDay._d,payperiod.payroll_closure=cur_payperiod.payrollclosureDay._d}else Leave.Reports.Util.addorReducePayPeriod(payperiod,input);pager.data("payperiod",payperiod),pager.find("[name=dateNavigatorText]").text(Calendar.formatDate(payperiod.start)+" - "+Calendar.formatDate(payperiod.end)),Layout.Page.pageId.indexOf("payroll")>-1?Leave.Reports.payrollReport.generateReport():Layout.Page.pageId.indexOf("encashment")>-1?Leave.Reports.encashmentReport.generateReport():Leave.Reports.lopReport.generateReport()}},loadPayPeriod:function(){var cur_period=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period,pager=$(".calendar",Layout.Page.container),payperiod=Leave.Reports.Util.getPayPeriod(cur_period.cur_date);payperiod.conf?(pager.data("payperiod","").removeClass("DNI"),pager.find("[name=dateNavigatorText]").text(Calendar.formatDate(payperiod.start)+" - "+Calendar.formatDate(payperiod.end)),pager.data("payperiod",payperiod)):pager.data("payperiod","").addClass("DNI")},getPreviousPayPeriod:function(payperiod,cur_date,count){if(3==payperiod.conf.rsFrequency||4==payperiod.conf.rsFrequency){var reportConf=payperiod.conf,prev_payperiod=Attendance.Report.getFromToForPayPeriod(count+1,reportConf.rsFrequency,reportConf.rsClosureDay,reportConf.rsSecClosureDay,reportConf.rsToDay,reportConf.lastScheRunTime);return{from:prev_payperiod.fromDay._d,to:prev_payperiod.toDay._d,closure:prev_payperiod.closureDay._d,payroll_closure:prev_payperiod.payrollclosureDay?prev_payperiod.payrollclosureDay._d:void 0}}return(count<-1||!payperiod.closure<Calendar.parseDate(cur_date,uidateFormat))&&Leave.Reports.Util.addorReducePayPeriod(payperiod,count),{from:payperiod.start,to:payperiod.end,closure:payperiod.closure,payroll_closure:payperiod.payroll_closure}},getReportSetingsConf:function(id){var rsConf,payPeriods=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod;for(idx in payPeriods){var report=payPeriods[idx];id===report.rsID&&(rsConf=report)}return rsConf&&(rsConf.rsPayrollClosure&&-1!=rsConf.rsPayrollClosure||(rsConf.rsPayrollClosure=rsConf.rsClosureDay,rsConf.payrollClosureNotConfigured=!0,4==rsConf.rsFrequency&&(rsConf.rsSecPayrollClosure=rsConf.rsSecClosureDay))),rsConf},getPayPeriod:function(curDate){var values=ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'));if(!(void 0==values||values.length<=0)){var rsID=values[0].id,reportConf=Leave.Reports.Util.getReportSetingsConf(rsID),payperiod={conf:reportConf,cur_date:curDate=Calendar.parseDate(curDate,uidateFormat)},period_pos=1,reportEnd=new Date(curDate),reportStart=new Date(curDate),reportClosure=new Date(curDate),payrollReportClosure=new Date(curDate);if(reportConf){if(1==reportConf.rsFrequency)(reportClosure=32==reportConf.rsClosureDay?new Date(reportClosure.getFullYear(),reportClosure.getMonth()+1,0):new Date(reportClosure.setDate(reportConf.rsClosureDay)))<curDate&&reportClosure.setMonth(reportClosure.getMonth()+1),32==reportConf.rsToDay?(reportEnd=(reportEnd=new Date(reportClosure.getFullYear(),reportClosure.getMonth()+1,0))>reportClosure?new Date(reportEnd.getFullYear(),reportEnd.getMonth(),0):reportEnd,reportStart=new Date(reportEnd.getFullYear(),reportEnd.getMonth(),1)):(reportEnd=(reportEnd=new Date(reportClosure.getFullYear(),reportClosure.getMonth(),reportConf.rsToDay))>reportClosure?new Date(reportEnd.setMonth(reportEnd.getMonth()-1)):reportEnd,reportStart=new Date(reportEnd.getFullYear(),reportEnd.getMonth()-1,reportEnd.getDate()+1)),payrollReportClosure=new Date(reportClosure),ZPUtil.setDate(payrollReportClosure,reportConf.rsPayrollClosure),payrollReportClosure<reportClosure&&(payrollReportClosure.setMonth(payrollReportClosure.getMonth()+1),ZPUtil.setDate(payrollReportClosure,reportConf.rsPayrollClosure));else if(2==reportConf.rsFrequency){(reportClosure=new Date(curDate)).setDay(reportConf.rsClosureDay),reportClosure<curDate&&reportClosure.setDate(reportClosure.getDate()+7),(reportEnd=new Date(reportClosure)).setDay(reportConf.rsToDay),reportEnd=reportEnd>reportClosure?new Date(reportEnd.setDate(reportEnd.getDate()-7)):reportEnd;reportStart=new Date(reportEnd);reportStart=new Date(reportStart.setDate(reportStart.getDate()-6)),(payrollReportClosure=new Date(reportClosure)).setDay(reportConf.rsPayrollClosure),payrollReportClosure<reportClosure&&payrollReportClosure.setDate(payrollReportClosure.getDate()+7)}else if(3==reportConf.rsFrequency||4==reportConf.rsFrequency){var cur_payperiod=Attendance.Report.getFromToForPayPeriod(1,reportConf.rsFrequency,reportConf.rsClosureDay,reportConf.rsSecClosureDay,reportConf.rsToDay,reportConf.lastScheRunTime,reportConf.rsPayrollClosure,reportConf.rsSecPayrollClosure);reportClosure<cur_payperiod.closureDay._d&&(period_pos=2,cur_payperiod=Attendance.Report.getFromToForPayPeriod(2,reportConf.rsFrequency,reportConf.rsClosureDay,reportConf.rsSecClosureDay,reportConf.rsToDay,reportConf.lastScheRunTime,reportConf.rsPayrollClosure,reportConf.rsSecPayrollClosure)),reportStart=cur_payperiod.fromDay._d,reportEnd=cur_payperiod.toDay._d,reportClosure=cur_payperiod.closureDay._d,payrollReportClosure=cur_payperiod.payrollclosureDay._d}payperiod.start=reportStart,payperiod.end=reportEnd,payperiod.closure=reportClosure,payperiod.period_pos=period_pos,payperiod.payroll_closure=payrollReportClosure}return payperiod}},addorReducePayPeriod:function(modifiedPP,input){var reportEnd=modifiedPP.end,reportStart=modifiedPP.start,reportClosure=modifiedPP.closure,payrollReportClosure=modifiedPP.closure;1==modifiedPP.conf.rsFrequency?(input<0?(reportEnd=32==modifiedPP.conf.rsToDay?new Date(reportEnd.getFullYear(),reportEnd.getMonth(),0):new Date(reportEnd.setMonth(reportEnd.getMonth()-1)),reportStart=new Date(reportStart.setMonth(reportStart.getMonth()-1)),modifiedPP.conf.rsFromDay!=reportStart.getDate()&&2!=reportEnd.getMonth()&&(reportStart=new Date(reportStart.setMonth(reportEnd.getMonth()-1)),reportStart=new Date(reportStart.setDate(modifiedPP.conf.rsFromDay))),reportClosure=32==modifiedPP.conf.rsClosureDay?new Date(reportClosure.getFullYear(),reportClosure.getMonth(),0):new Date(reportClosure.setMonth(reportClosure.getMonth()-1))):(reportEnd=32==modifiedPP.conf.rsToDay?new Date(reportEnd.getFullYear(),reportEnd.getMonth()+2,0):new Date(reportEnd.setMonth(reportEnd.getMonth()+1)),reportStart=new Date(reportStart.setMonth(reportStart.getMonth()+1)),modifiedPP.conf.rsFromDay!=reportStart.getDate()&&2!=reportEnd.getMonth()&&(reportStart=new Date(reportStart.setMonth(reportEnd.getMonth()-1)),reportStart=new Date(reportStart.setDate(modifiedPP.conf.rsFromDay))),reportClosure=32==modifiedPP.conf.rsClosureDay?new Date(reportClosure.getFullYear(),reportClosure.getMonth()+2,0):new Date(reportClosure.setMonth(reportClosure.getMonth()+1))),modifiedPP.conf.rsPayrollClosure&&modifiedPP.conf.rsPayrollClosure>-1?(payrollReportClosure=new Date(reportClosure),ZPUtil.setDate(payrollReportClosure,modifiedPP.conf.rsPayrollClosure),payrollReportClosure<reportClosure&&(payrollReportClosure.setMonth(payrollReportClosure.getMonth()+1),ZPUtil.setDate(payrollReportClosure,modifiedPP.conf.rsPayrollClosure))):payrollReportClosure=new Date(reportClosure)):(input<0?(reportEnd=new Date(reportEnd.setDate(reportEnd.getDate()-7)),reportClosure=new Date(reportClosure.setDate(reportClosure.getDate()-7))):(reportEnd=new Date(reportEnd.setDate(reportEnd.getDate()+7)),reportClosure=new Date(reportClosure.setDate(reportClosure.getDate()+7))),reportStart=new Date(reportEnd),reportStart=new Date(reportStart.setDate(reportStart.getDate()-6)),modifiedPP.conf.rsPayrollClosure&&modifiedPP.conf.rsPayrollClosure>-1?((payrollReportClosure=new Date(reportClosure)).setDay(modifiedPP.conf.rsPayrollClosure),payrollReportClosure<reportClosure&&payrollReportClosure.setDate(payrollReportClosure.getDate()+7)):payrollReportClosure=new Date(reportClosure)),modifiedPP.start=reportStart,modifiedPP.end=reportEnd,modifiedPP.closure=reportClosure,modifiedPP.payroll_closure=payrollReportClosure},generateReportPopup:function(){var msg1,msg2,cur_date=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,payperiod=Leave.Reports.Util.getPayPeriod(cur_date),period=Leave.Reports.Util.getGenerateReportPeriod();Layout.Page.pageId.indexOf("encashment")>-1?(msg1=ZPI18N.getString("zp.leave.encashmentreport.regenerate.warning",[Calendar.formatDate(period.from),Calendar.formatDate(period.to)]),msg2=ZPI18N.getString("zp.leave.encashmentreport.regenerate.resigned",[Calendar.formatDate(payperiod.start),Calendar.formatDate(payperiod.end)])):Layout.Page.pageId.indexOf("payroll")>-1?(msg1=ZPI18N.getString("zp.leave.payroll.regenerate.warning",[Calendar.formatDate(period.from),Calendar.formatDate(period.to)]),msg2=ZPI18N.getString("zp.leave.payroll.regenerate.resigned",[Calendar.formatDate(payperiod.start),Calendar.formatDate(payperiod.end)])):(msg1=ZPI18N.getString("zp.leave.lopreport.regeneratereport",[Calendar.formatDate(period.from),Calendar.formatDate(period.to)]),msg2=ZPI18N.getString("zp.leave.lopreport.regenerate.resigned",[Calendar.formatDate(payperiod.start),Calendar.formatDate(payperiod.end)]));var msg='<div class="row PT10 PB10 text-left" id="zp_export_ftype"><div class="col-md-12"><div class=""><div class="MB20"><label class="radio MR10"><input type="radio" name="cycle" value="-1" checked="checked"><span>Previous cycle</span> </label><span class="dgry MT5 DB ML20 LH20">'+msg1+'</span></div><div class=""><label class="radio MR10"><input type="radio" name="cycle" value="0"><span>Current cycle for resigned users</span> </label><span class="dgry MT5 DB ML20 LH20">'+msg2+"</span></div></div></div></div>";ZPeople.BSModal.confirm(Leave.Reports.Util.generate_LOP_report,ZPI18N.getString("zp.alert"),msg)},getGenerateReportPeriod:function(){var cur_date=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,payperiod=Leave.Reports.Util.getPayPeriod(cur_date),period=(Layout.Page.pageId.indexOf("lop")>-1?ZPI18N.getString("zp.leave.lopreport"):ZPI18N.getString("zp.payrollreport"),Leave.Reports.Util.getPreviousPayPeriod(payperiod,cur_date,-1));return period.payroll_closure&&Layout.Page.pageId.indexOf("payroll")>-1&&period.payroll_closure>Calendar.parseDate(cur_date,uidateFormat)&&(period=Leave.Reports.Util.getPreviousPayPeriod(payperiod,cur_date,-2)),period},generate_LOP_report:function(){var params,rsid=ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'))[0].id,period=Leave.Reports.Util.getGenerateReportPeriod(),cycle=Layout.Page.container.find("[name=cycle]:checked").val(),cur_period=Leave.Reports.Util.getPayPeriod(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date),page=Layout.Page.pageId.split("-")[3];(params="-1"===cycle?{key:"generate_report",rsid:rsid,page:page,from:Calendar.formatDate(period.from),to:Calendar.formatDate(period.to)}:{key:"generate_report_offBoarding",rsid:rsid,page:page,from:Calendar.formatDate(cur_period.start),to:Calendar.formatDate(cur_period.end)})[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){"success"===data.status?(ZPeople.Message.showSuccessMsg(data.success?data.success:"Successfull!"),"lop"==page?Leave.Reports.lopReport.generateReport():"encashment"==page&&Leave.Reports.encashmentReport.generateReport()):ZPeople.Message.showFailureMsg(data.failure?data.failure:ZPI18N.getString("zp.exceptionmessage",[ZPeople.peopleSupportEmail]))})},permDenied:function(){var permissionDenied="<div class='ZPNdata'><div></div><p class='no-para'>"+ZPI18N.getString("zp.permdenied")+"</p></div>";Layout.Page.container.find("#pageDiv").children().remove(),Layout.Page.container.find("#pageDiv").html(permissionDenied),ZPUtil.noDataSVG(null,ZPeople.getResourceURL(newUIImageUrl+"svg/no-permission.svg"),null,Layout.Page.container.find(".ZPNdata div"))},checkPermDenied:function(report){var modules=ZPLite.Reports.reportsJSON[ZPLite.Reports.selectedTab].modules,isReportFound=!1,isLeaveTabLookup=!1;$.each(modules,function(key,module){if(isReportFound||isLeaveTabLookup)return!1;if("Leavetracker"===module.tabName){var repObj=module.formArr;isLeaveTabLookup=!0;for(var i=0;i<repObj.length&&!isReportFound;i++)if(-1!=repObj[i].tabURL.indexOf(report)){isReportFound=!0;break}}}),isReportFound||Leave.Reports.Util.permDenied()}},Export:{openExport:function(obj){$(obj).hasClass("open")?$(obj).removeClass("open"):$(obj).addClass("open")},exportIcs:function(){let formId="zp_export_form",formParentId="wrapper";Layout.Page.container.find("#ZPLeave_exp_form").length>0&&(formId="ZPLeave_exp_form",formParentId="");var url,params={};Layout.Page.pageId.indexOf("leave-availability")>-1&&(url=Leave.Reports.exporturl,params=Leave.Reports.userAvailReport.getParamsForReport()),params.exporttype=5;let keyValue=params.key;delete params.key,""!==keyValue&&void 0!==keyValue&&(url=url+"?key="+keyValue),Leave.exportForm.getHTMLFormDataObj(formId,formParentId,url,"post",null,params).submit()},exportData:function(containerId){let formId="zp_export_form",formParentId="wrapper";Layout.Page.container.find("#ZPLeave_exp_form").length>0&&(formId="ZPLeave_exp_form",formParentId="");var exportcontainer=ZP5Export.getCurrContainer(),fieldsSelected=[];$(".chkbx_lsts input").each(function(){!0===$(this).prop("checked")&&fieldsSelected.push($(this).attr("name").split("_")[1])});var url,params={};if(Layout.Page.pageId.indexOf("leave-user")>-1){url=Leave.Reports.exporturl2,(params=Leave.Reports.userReport.getParamsForReport()).key="view_transactions",params.leavetypeid=Leave.Reports.userReport.PolicyTransView.ltId;var exportParams=Leave.Reports.userReport.PolicyTransView.getParams(params.employee,Leave.Reports.userReport.PolicyTransView.ltId);params.from=exportParams.from,params.to=exportParams.to}else if(Layout.Page.pageId.indexOf("leave-daily")>-1)url=Leave.Reports.exporturl,params=Leave.Reports.dailyReport.getParamsForReport();else if(Layout.Page.pageId.indexOf("leave-availability")>-1)url=Leave.Reports.exporturl,params=Leave.Reports.userAvailReport.getParamsForReport();else if(Layout.Page.pageId.indexOf("leave-lbalance")>-1)url=Leave.Reports.exporturl2,params=Leave.Reports.balanceReport.getParamsForReport();else if(Layout.Page.pageId.indexOf("leave-summary")>-1)url=Leave.Reports.exporturl2,params=Leave.Reports.summaryReport.getParamsForReport();else if(Layout.Page.pageId.indexOf("leave-lop")>-1)url=Leave.Reports.exporturl,params=Leave.Reports.lopReport.getParamsForReport(),ZPeopleComponents.isComponent($(exportcontainer.find("[name=lop_report_crt]")))?params.data_filter=ZPeopleComponents.select($(exportcontainer.find("[name=lop_report_crt]"))).getValue():params.data_filter=$(exportcontainer.find("#lop_report_crt")).val();else if(Layout.Page.pageId.indexOf("leave-encashment")>-1)url=Leave.Reports.exporturl,params=Leave.Reports.encashmentReport.getParamsForReport();else if(Layout.Page.pageId.indexOf("leave-payroll")>-1)url=Leave.Reports.exporturl,(params=Leave.Reports.payrollReport.getParamsForReport())[csrfParamName]=csrfToken,params.report_type=ZPLite.Filters.getValues(Layout.Page.container.find("#filterDiv").find('[name="reportTypeFilter"]'))[0].id;else if(Layout.Page.pageId.indexOf("leave-balance")>-1)url=Leave.Reports.exporturl,params=Leave.Reports.balanceReportV1.getParamsForReport();else if(Layout.Page.pageId.indexOf("leave-leavetaken")>-1)url=Leave.Reports.exporturl,params=Leave.Reports.leaveTakenReport.getParamsForReport();else if(Layout.Page.pageId.indexOf("leave-rollover")>-1)url=Leave.Reports.exporturl,params=Leave.Reports.leaveRollOverReport.getParamsForReport();else{if(!(Layout.Page.pageId.indexOf("leave-bradford")>-1))return;url=Leave.Reports.exporturl,params=Leave.Reports.bradFordReport.getParamsForReport()}params.exporttype=1,params.fieldsSelected=fieldsSelected;var exptype=$(exportcontainer.find("[name=exportFileType]:checked")).val();if("xlsx"==exptype?params.exporttype=6:"csv"==exptype?params.exporttype=2:"tsv"==exptype&&(params.exporttype=3),Layout.Page.pageId.indexOf("leave-lop")>-1||Layout.Page.pageId.indexOf("leave-payroll")>-1||Layout.Page.pageId.indexOf("leave-encashment")>-1){var leaveFilter=JSON.parse(params.leaveFilter);Layout.Page.pageId.indexOf("leave-encashment")>-1&&leaveFilter.repType&&delete leaveFilter.repType,leaveFilter.exporttype=params.exporttype,leaveFilter.fieldsSelected=params.fieldsSelected,Layout.Page.pageId.indexOf("leave-encashment")>-1&&delete leaveFilter.startIndex,params.leaveFilter=JSON.stringify(leaveFilter),delete params.exporttype,delete params.fieldsSelected}params.fieldsSelected&&(params.fieldsSelected=JSON.stringify(fieldsSelected));let keyValue=params.key;if(delete params.key,""!==keyValue&&void 0!==keyValue&&(url=url+"?key="+keyValue),""!==url&&void 0!==url){Leave.exportForm.getHTMLFormDataObj(formId,formParentId,url,"post",null,params).submit()}},showExport:function(ele){LeaveAdminOpers.Util.showExport(ele)},printReport:function(){var reportStyle="zoom:80%;";-1!=Layout.Page.pageId.indexOf("leave-availability")?reportStyle="zoom:50%;":-1!=Layout.Page.pageId.indexOf("leave-yearly")?reportStyle="width:1400px;zoom:70%;":-1!=Layout.Page.pageId.indexOf("leave-user")||-1!=Layout.Page.pageId.indexOf("leave-daily")?reportStyle="width:1200px;zoom:80%;":-1!=Layout.Page.pageId.indexOf("leave-rollover")&&(reportStyle="zoom:80%;");var newWindow=window.open();newWindow.focus();var newContent='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html>',copyhead=$("head").clone();copyhead.find("script").each(function(){$(this).remove()});var wholeCont=$("#"+Layout.Page.pageId).clone();$(wholeCont).find("#reports-page").addClass("zpl_allreports"),$(wholeCont).find(".lt_nav").find(".fil").remove(),$(wholeCont).find(".lt_nav").find(".tfilter").remove(),$(wholeCont).find("iframe").remove(),$(wholeCont).find("form").remove(),$(wholeCont).find("#leaveUserReportChartParent").removeClass("tabcont"),$(wholeCont).find("#leaveDailyReportChartParent").removeClass("tabcont"),$(wholeCont).find(".sstab").remove(),$(wholeCont).find(".home").remove(),$(wholeCont).find(".prev").remove(),$(wholeCont).find(".next").remove(),$(wholeCont).find("#pageDiv").removeClass("shw_tfilter"),$(wholeCont).find(".table_responsive")[0]&&($(wholeCont).find(".table_responsive").find("li").removeAttr("class"),$(wholeCont).find(".table_responsive").find("a").removeAttr("href"),$(wholeCont).find(".table_responsive").find("a").removeAttr("data-toggle"),$(wholeCont).find(".table_responsive").find(".ZPLRow").find(".lt_title").addClass("DNI"),$(wholeCont).find(".tfilter").hide(),$(wholeCont).find(".table_responsive").find("desc").removeClass("CP")),$(wholeCont).find(".ZPDat")[0]&&$(wholeCont).find(".ZPDat").css("left","0px");var logoCont=$(".zpl_mnLgo").clone();$(logoCont).find("i").remove(),newContent+=copyhead.html(),newContent+='<body onload="self.print()" style="overflow:scroll;'+reportStyle+'background: #fff"><div class="ZPHeadLft">',newContent+=logoCont[0].outerHTML,newContent+='</div><div class="clearfix"></div><hr>',newContent+=wholeCont.html(),newWindow.document.write(newContent),newWindow.document.close()},exportPdf:function(){let formId="zp_export_form",formParentId="wrapper";Layout.Page.container.find("#ZPLeave_exp_form").length>0&&(formId="ZPLeave_exp_form",formParentId="");var url,params={};if(Layout.Page.pageId.indexOf("leave-daily")>-1?(url=Leave.Reports.exporturl,(params=Leave.Reports.dailyReport.getParamsForReport()).display=1):Layout.Page.pageId.indexOf("leave-availability")>-1?(url=Leave.Reports.exporturl,delete(params=Leave.Reports.userAvailReport.getParamsForReport()).sIndx,delete params.sortType):Layout.Page.pageId.indexOf("leave-lbalance")>-1?(url=Leave.Reports.exporturl2,params=Leave.Reports.balanceReport.getParamsForReport()):Layout.Page.pageId.indexOf("leave-summary")>-1?(url=Leave.Reports.exporturl2,params=Leave.Reports.summaryReport.getParamsForReport()):Layout.Page.pageId.indexOf("leave-payroll")>-1?(url=Leave.Reports.exporturl,(params=Leave.Reports.payrollReport.getParamsForReport())[csrfParamName]=csrfToken,params.report_type=ZPLite.Filters.getValues(Layout.Page.container.find("#filterDiv").find('[name="reportTypeFilter"]'))[0].id):Layout.Page.pageId.indexOf("leave-balance")>-1?(url=Leave.Reports.exporturl,params=Leave.Reports.balanceReportV1.getParamsForReport()):Layout.Page.pageId.indexOf("leave-leavetaken")>-1?(url=Leave.Reports.exporturl,params=Leave.Reports.leaveTakenReport.getParamsForReport()):Layout.Page.pageId.indexOf("leave-rollover")>-1?(url=Leave.Reports.exporturl,params=Leave.Reports.leaveRollOverReport.getParamsForReport()):Layout.Page.pageId.indexOf("leave-bradford")>-1?(url=Leave.Reports.exporturl,params=Leave.Reports.bradFordReport.getParamsForReport()):Layout.Page.pageId.indexOf("leave-encashment")>-1&&(url=Leave.Reports.exporturl,params=Leave.Reports.encashmentReport.getParamsForReport()),params.exporttype=4,Layout.Page.pageId.indexOf("leave-payroll")>-1||Layout.Page.pageId.indexOf("leave-encashment")>-1){var leaveFilter=JSON.parse(params.leaveFilter);leaveFilter.exporttype=params.exporttype,Layout.Page.pageId.indexOf("leave-encashment")>-1&&leaveFilter.repType&&delete leaveFilter.repType,Layout.Page.pageId.indexOf("leave-encashment")>-1&&delete leaveFilter.startIndex,params.leaveFilter=JSON.stringify(leaveFilter),delete params.exporttype}let keyValue=params.key;delete params.key,""!==keyValue&&void 0!==keyValue&&(url=url+"?key="+keyValue),Leave.exportForm.getHTMLFormDataObj(formId,formParentId,url,"post",null,params).submit()}},initModuledata:function(moduleData){if(void 0===ZPeople.Module.MODULE_DATA.leavetracker)if(moduleData)ZPeople.Module.MODULE_DATA.leavetracker=moduleData;else{var params={initmodule:JSON.stringify({modulePrefix:"leavetracker"})};ZPeople.Request.sendAsyncPost("/gettabdetails/initpage",params,function(result){result.initmodule&&(ZPeople.Module.MODULE_DATA.leavetracker=result.initmodule)})}void 0!==ZPeople.Module.MODULE_DATA.leavetracker&&LVUtil.Tab.InitLitePage()},yearlyReport:{reportName:"YEARLY_REPORT",employee:"",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.yearlyReport.reportName);var initParams={};initParams.callback=Leave.Reports.yearlyReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){if(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isV1User){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),Leave.Reports.yearlyReport.reg();var empFilObj=Layout.Page.container.find('[name="employeeFilter"]');Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(empFilObj,"employee",!0,Leave.Reports.yearlyReport.filterOnChangeCallback,"LEAVE_YEARLY_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),empFilObj.find("label").remove();var empId=""!=Leave.Reports.yearlyReport.employee?Leave.Reports.yearlyReport.employee:erecno,userDtl=ZPeople.getUserDetailsById(empId);ZPLite.Filters.setValues(empFilObj,[{id:empId,text:ZPeople.decodeTxt(ZPeople.escapeHtml(userDtl.empid+" "+userDtl.name)),photoUrl:userDtl.avatar}]),"myReports"==ZPLite.Reports.selectedTab?empFilObj.off("click"):empFilObj.on("click"),Leave.Reports.yearlyReport.employee="",Leave.Reports.yearlyReport.generateReport()}else window.location.href="#reports/my/leave/user"},reg:function(){var layout=Layout.Page.container;layout.find(".lt_nav").find(".cus_title").unbind("click").on("click",function(){$(this).removeClass("sel").addClass("sel"),$(this).siblings().removeClass("sel"),Leave.Reports.yearlyReport.generateReport()}),layout.find(".lt_nav").find(".ZP-SwitchUnit").unbind("click").on("click",function(){$(this).removeClass("active").addClass("active"),$(this).siblings().removeClass("active"),Leave.Reports.yearlyReport.generateReport()});var lyJson=Leave.Reports.Util.getLYear(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location,0);layout.find(".calendar").removeClass("DNI"),layout.find(".calendar").data("date",lyJson.from+" - "+lyJson.to),layout.find(".calendar").data("year",0),Leave.Reports.yearlyReport.checkNavigation(0),Leave.Reports.yearlyReport.addOrReduceDate(layout.find(".calendar"),0),layout.find(".yPrev").unbind("click").on("click",function(){Leave.Reports.yearlyReport.addOrReduceDate(layout.find(".calendar"),-1),Leave.Reports.yearlyReport.generateReport()}),layout.find(".yNext").unbind("click").on("click",function(){Leave.Reports.yearlyReport.addOrReduceDate(layout.find(".calendar"),1),Leave.Reports.yearlyReport.generateReport()})},addOrReduceDate:function(ele,count){var process_date=new Date(curdate,curmonth,curyear),year=($(ele).data("date"),$(ele).data("year")),datetext=$(ele).find("[name=dateNavigatorText]"),filterData=ZPLite.Filters.getValues(Layout.Page.container.find('[name="employeeFilter"]')),emp=void 0==filterData||""==filterData?erecno:filterData[0].id,empObj=ZP.getUserDetailsById(emp),loc="null"!=empObj.location?empObj.location:"-1",lyJson=Leave.Reports.Util.getLYear(loc,year+count);return Leave.Reports.yearlyReport.checkNavigation(year+count),lyJson&&($(ele).data("year",year+count),datetext.text(lyJson.from+" - "+lyJson.to)),$(ele).data("date",process_date),process_date},checkNavigation:function(count){var pager=Layout.Page.container.find(".calendar");Leave.Reports.Util.getLYear(void 0,count-1)?pager.find(".yPrev").removeClass("DNI"):pager.find(".yPrev").addClass("DNI"),Leave.Reports.Util.getLYear(void 0,count+1)?pager.find(".yNext").removeClass("DNI"):pager.find(".yNext").addClass("DNI")},filterOnChangeCallback:function(data){Layout.Page.container;"employee"===data.entity&&Leave.Reports.yearlyReport.generateReport()},getParamsForReport:function(){var params={key:"report_yearly",conreqcsr:csrfToken},header=Layout.Page.container.find(".lt_nav"),display_ele=$(".crd",header);params.display=display_ele.hasClass("sel")?0:1;var values=ZPLite.Filters.getValues(Layout.Page.container.find('[name="employeeFilter"]'));return void 0!==values&&values.length>0&&(params.employee=values[0].id),params.leaveunit=header.find("div[name=switchUnit]").find("li.active").attr("value"),params.leaveyear=header.find(".calendar").data("year"),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container;layout.find("#leaveYearlyReport").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),Leave.Reports.Util.removeLoading(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leaveYearlyReport")),layout.find("#leaveYearlyReport").addClass("DNI");var params=Leave.Reports.yearlyReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){response&&"permissionDenied"===response.error?Leave.Reports.Util.permDenied():(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==response&&void 0!==response.data.report&&response.data.report.length>0?(layout.find("#leaveYearlyReport").removeClass("DNI"),1==params.display?Leave.Reports.yearlyReport.list(response,params):Leave.Reports.yearlyReport.chart(response,params)):(layout.find("#leaveYearlyReportChartParent").addClass("DNI"),layout.find("#leaveYearlyReportTable").addClass("DNI"),layout.find(".ZPNdata").fadeOut(100).remove(),$(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsmsg"))).insertBefore(layout.find("#leaveYearlyReport"))))},{},Leave.Reports.showReportErrorMsg)},list:function(resp){var layout=Layout.Page.container;if(layout.find("#leaveYearlyReportChartParent").addClass("DNI"),layout.find("#leaveYearlyReportTable").removeClass("DNI"),"success"===resp.status){var tempDoc=document.createDocumentFragment(),data_arr=resp.data.report,data_div=$("#leaveYearlyReportTable",Layout.Page.container);ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.issettingsadmin;if(data_arr[0]&&!_.isEmpty(data_arr[0].leavetypes)){var leave_types=data_arr[0].leavetypes;for(var indx in leave_types){var leave_type=leave_types[indx],data_tr=ZP.create("tr",{class:"ZPLRow"}),nametd=ZP.create("td");nametd.appendChild(ZP.create("div",{class:"ZPLtyp CL"+leave_type.color})),$(nametd).append(leave_type.name);var typetd=ZP.create("td",{text:Leave.Type.text(leave_type.type)}),allowedtd=ZP.create("td",{text:ZP.optValue(leave_type,"allowed","-")}),takentd=ZP.create("td",{text:ZP.optValue(leave_type,"taken",0)}),accPC=(ZP.create("td",{text:ZP.optValue(leave_type,"lop",0)}),leave_type.accPeriodicCount);if("object"==typeof accPC){var info=ZP.create("i",{class:"IC-info S18 gry ML10 popHover","data-popover":"true","data-html":"true","data-content":Leave.Reports.yearlyReport.getPeriodicDetails(accPC)});nametd.appendChild(info),nametd.appendChild(ZP.create("br")),Leave.Util.appendinfomsg(nametd,ZPI18N.getString("zp.leavereport.accrualreset.info",[ZP.optValue(leave_type,"accrualperiod")]))}else leave_type.isRollOver&&(allowedtd.appendChild(ZP.create("br")),Leave.Util.appendinfomsg(allowedtd,ZP.optValue(leave_type,"leave_count",0)+" + "+ZPI18N.getString("zp.leave.initialbalance")+" ( "+ZP.optValue(leave_type,"ibCount",0)+" )"));data_tr.appendChild(nametd),data_tr.appendChild(typetd),data_tr.appendChild(allowedtd),data_tr.appendChild(takentd);var availabletd=ZP.create("td",{text:ZP.optValue(leave_type,"available","-")});if(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isV1User){var info_txt="";leave_type.hasOwnProperty("lapsed")&&leave_type.lapsed>0&&(info_txt=ZPI18N.getString("zp.leave.lapsed")+" ( "+ZP.optValue(leave_type,"lapsed",0)+" )"),leave_type.hasOwnProperty("expired_count")&&leave_type.expired_count>0&&(info_txt+=info_txt?", ":"",info_txt+=ZPI18N.getString("zp.leave.report.expiredcount")+" ( "+ZP.optValue(leave_type,"expired_count",0)+" )"),leave_type.hasOwnProperty("lop")&&leave_type.lop>0&&(info_txt+=info_txt?", ":"",info_txt+=ZPI18N.getString("zp.lop")+" ( "+ZP.optValue(leave_type,"lop",0)+" )"),info_txt&&(availabletd.appendChild(ZP.create("br")),Leave.Util.appendinfomsg(availabletd,info_txt)),data_tr.appendChild(availabletd)}else{data_tr.appendChild(availabletd);var lapsedTd=ZP.create("td",{text:ZP.optValue(leave_type,"lapsed",0)});data_tr.appendChild(lapsedTd)}tempDoc.appendChild(data_tr)}data_div.removeClass("DNI"),data_div.siblings("#leaveYearlyReportChartParent").addClass("DNI"),data_div.data("isreg")||data_div.data("isreg",!0),(data_tbody=$("tbody",data_div)).html(""),data_tbody.append(tempDoc),$("i.IC-info",data_tbody).popover({trigger:"hover",container:"body"}),Leave.Reports.Util.showHideNoRecord(!1,"leaveYearlyReport")}else{var data_tbody;data_div.removeClass("DNI"),data_div.siblings("#leaveYearlyReportChartParent").addClass("DNI"),layout.find("#leaveYearlyReportTable").addClass("DNI"),(data_tbody=$("tbody",data_div)).html(""),Leave.Reports.Util.showHideNoRecord(!0,"leaveYearlyReport")}}Leave.Util.removeLoading()},chart:function(resp,params){var layout=Layout.Page.container;if(layout.find("#leaveYearlyReportChartParent").removeClass("DNI"),layout.find("#leaveYearlyReportTable").addClass("DNI"),"success"===resp.status){var count_arr=resp.data.report[0]?resp.data.report[0].leavetypes:{},chart_parent=$("#leaveYearlyReportChartParent",Layout.Page.container);chart_parent.removeClass("DNI"),chart_parent.siblings("#leaveYearlyReportTable").addClass("DNI");var color=[],ltaken=[],lavail=[],name=[];$("#leaveYearlyReportChart",chart_parent).show();if(_.isEmpty(count_arr))return Leave.Util.removeLoading(),layout.find("#leaveYearlyReportChartParent").addClass("DNI"),layout.find("#leaveYearlyReportTable").addClass("DNI"),void Leave.Reports.Util.showHideNoRecord(!0,"leaveYearlyReport");for(var indx in Leave.Reports.Util.showHideNoRecord(!1,"leaveYearlyReport"),count_arr){var count_json=count_arr[indx],type=count_json.type,taken=count_json.taken;2===type&&0===taken||(color.push(count_json.dbcolor),ltaken.push(count_json.taken),lavail.push(count_json.available?count_json.available:0),name.push(ZPeople.decodeTxt(count_json.name)))}var formName=ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.formDisplayName)+" ";$("#leaveYearlyReportChart",chart_parent).highcharts({chart:{type:"column",plotBorderWidth:1,plotBorderColor:"#f3f3f3",spacingBottom:50,spacingTop:10,spacingLeft:10,spacingRight:50},credits:{enabled:!1},title:{text:formName+ZPI18N.getString("zp.reports.chart"),align:"left",x:50,style:{color:"black",fontWeight:"bold"}},xAxis:{categories:name,labels:{rotation:-45}},yAxis:{title:{text:("Days"==params.leaveunit?ZPI18N.getString("zp.cday"):ZPI18N.getString("zp.leavetype.hour"))+" "+formName+ZPI18N.getString("zp.reports.chart")},gridLineColor:"#f3f3f3"},tooltip:{valueDecimals:2,headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name} </br> {point.y.name} : {point.y}"},legend:{enabled:!1},exporting:{enabled:!1,buttons:{contextButton:{theme:{states:{hover:{stroke:"#bfbfbf",fill:null},select:{stroke:"#bfbfbf",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"Day"+formName+"Chart"},plotOptions:{column:{pointPadding:.3,borderWidth:0,stacking:"normal"}},series:[{name:"Available",color:"#D3D3D3",data:lavail},{name:"Taken",colorByPoint:!0,showInLegend:!1,colors:color,data:ltaken}]})}Leave.Util.removeLoading()},getPeriodicDetails:function(accPdetails){var detailStr='<table><thead><tr><th width="80%">Period</th><th width="20%">'+ZPI18N.getString("zp.available")+"</th></tr></thead>";return $.each(accPdetails,function(idx,detail){"object"==typeof detail&&(detailStr+="<tr height='20'>",detailStr+="<td>"+Calendar.formatDate(Calendar.parseDate(detail.from,"%Y-%m-%d"))+" - "+Calendar.formatDate(Calendar.parseDate(detail.to,"%Y-%m-%d"))+"</td>",detailStr+="<td style='text-align: center;'>"+detail.available+"</td>",detailStr+="</tr>")}),detailStr+="</table>"}},balanceReportV1:{reportName:"BALANCE_REPORT_V1",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.balanceReportV1.reportName);var initParams={};initParams.callback=Leave.Reports.balanceReportV1.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),Leave.Reports.balanceReportV1.reg(),Leave.Reports.balanceReportV1.showHideFilter();var filterDiv=Layout.Page.container.find("#filterDiv");Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="periodFilter"]'),"period",!0,Leave.Reports.balanceReportV1.filterOnChangeCallback),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="typeofLeaveFilter"]'),"typeofLeave",!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Leave.Reports.balanceReportV1.filterOnChangeCallback,"LEAVE_BALANCE_REPORT_V1_FILTER_EMPLOYEE_FIRESCROLL"),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1,Leave.Reports.balanceReportV1.filterOnChangeCallback),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.balanceReportV1.filterOnChangeCallback),Leave.Reports.balanceReportV1.setDefaultFilterParams(),Leave.Reports.balanceReportV1.generateReport()},reg:function(){Layout.Page.container.find(".lt_nav").find(".ZP-SwitchUnit").unbind("click").on("click",function(){$(this).removeClass("active").addClass("active"),$(this).siblings().removeClass("active"),Leave.Reports.balanceReportV1.generateReport()})},showHideFilter:function(){var filterDiv=Layout.Page.container.find("#filterDiv");"myReports"==ZPLite.Reports.selectedTab?(filterDiv.find('[name="employeeFilter"]').addClass("DNI"),filterDiv.find('[name="incDReportsOnly"]').addClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').addClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').addClass("DNI"),filterDiv.find('[name="divisionFilter"]').addClass("DNI"),filterDiv.find('[name="departmentFilter"]').addClass("DNI"),filterDiv.find('[name="designationFilter"]').addClass("DNI"),filterDiv.find('[name="locationFilter"]').addClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').addClass("DNI"),filterDiv.find('[name="incDateOfExit"]').addClass("DNI")):(filterDiv.find('[name="employeeFilter"]').removeClass("DNI"),filterDiv.find('[name="incDReportsOnly"]').removeClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').removeClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').removeClass("DNI"),filterDiv.find('[name="divisionFilter"]').removeClass("DNI"),filterDiv.find('[name="departmentFilter"]').removeClass("DNI"),filterDiv.find('[name="designationFilter"]').removeClass("DNI"),filterDiv.find('[name="locationFilter"]').removeClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"))},filterOnChangeCallback:function(data){var values,container=Layout.Page.container.find("#filterDiv");if("period"===data.entity||"location"===data.entity){if(values=ZPLite.Filters.getValues(container.find('[name="periodFilter"]')),!jQuery.isEmptyObject(values))if("1"===values[0].id){container.find('[name="fromDateFilter"]').addClass("disabled"),container.find('[name="toDateFilter"]').removeClass("disabled");var curPer=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period;Leave.Reports.Filters.setFromToDateFilter(curPer.year_start,curPer.cur_date)}else{var date;container.find('[name="fromDateFilter"]').addClass("disabled"),container.find('[name="toDateFilter"]').addClass("disabled"),"0"===values[0].id?date=ZPLite.Reports.Filters.getPeriod(766):"-1"===values[0].id&&(date=ZPLite.Reports.Filters.getPeriod(765)),Leave.Reports.Filters.setFromToDateFilter(date.from,date.to)}}else if("employee"==data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'));var dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");ZPLite.Filters.setValues(filterDiv.find('[name="periodFilter"]'),[{id:"1",text:ZPI18N.getString("zp.custom")}]),filterDiv.find('[name="fromDateFilter"]').addClass("disabled"),filterDiv.find('[name="toDateFilter"]').removeClass("disabled");var curPeriod=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period;Leave.Reports.Filters.setFromToDateFilter(curPeriod.year_start,curPeriod.cur_date),ZPLite.Filters.setValues(filterDiv.find('[name="typeofLeaveFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),filterDiv.find('[name="employeeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="incDReportsOnly"]').find("input").prop("checked",!1),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),"myReports"!=ZPLite.Reports.selectedTab&&filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked")},getParamsForReport:function(){var params={key:"report_balance",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv"),values=ZPLite.Filters.getValues(filterDiv.find('[name="periodFilter"]'));if(params.period=values[0].id,params.leaveyear_from=filterDiv.find('[name="fromDateFilter"]').val(),params.to=filterDiv.find('[name="toDateFilter"]').val(),(values=ZPLite.Filters.getValues(filterDiv.find('[name="typeofLeaveFilter"]')))&&values.length>0&&(params.typeofleave=values[0].id),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var erecNo=[];$.each(values,function(index,options){erecNo.push(options.id)}),params.employee=JSON.stringify(erecNo)}if(params.incDReportsOnly=filterDiv.find("[name=incDReportsOnly]").find("input").is(":checked"),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),params.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),params.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),params.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),params.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),params.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),params.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus=[];$.each(values,function(index,options){employeeStatus.push(options.id)}),params.employeeStatus=JSON.stringify(employeeStatus),params.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(params.incDateOfExit=!0)}return params.leaveunit=Layout.Page.container.find(".lt_nav").find("div[name=switchUnit]").find("li.active").attr("value"),params.sIndx=ZPLite.Firescroll.getStartIndex(Leave.Reports.balanceReportV1.Firescroll.mode),"myReports"==ZPLite.Reports.selectedTab?params.viewMode=1:"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#leaveBalanceReportV1"),Leave.Reports.balanceReportV1.Firescroll.mode),layout.find("#leaveBalanceReportV1").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leaveBalanceReportV1")),layout.find("#leaveBalanceReportV1").addClass("DN");var params=Leave.Reports.balanceReportV1.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){response&&"permissionDenied"===response.error?Leave.Reports.Util.permDenied():(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(layout.find("#leaveBalanceReportV1").removeClass("DN"),Leave.Reports.balanceReportV1.html(response),ZPLite.Firescroll.init(layout.find("#leaveBalanceReportV1"),Leave.Reports.balanceReportV1.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.balanceReportV1.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.balanceReportV1.Firescroll.mode,response.data.length)):Leave.Reports.Util.showHideNoRecord(!0,"leaveBalanceReportV1"))},{},Leave.Reports.showReportErrorMsg)},applyFilter:function(){var container=Layout.Page.container.find("#filterDiv");if("1"===ZPLite.Filters.getValues(container.find('[name="periodFilter"]'))[0].id){var errorMessage,fromDate=container.find('[name="fromDateFilter"]').data("selectedDate"),toDate=container.find('[name="toDateFilter"]').data("selectedDate");if(container.find('[name="toDateFilter"]').removeClass("error-clr"),fromDate>toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.greaterfromdate");else{ZPDateTime.getDateDiff(fromDate,toDate);(new Date).getFullYear()!=new Date(container.find('[name="toDateFilter"]').data("selectedDate")).getFullYear()&&(container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.datewithincurrentyear"))}if(errorMessage)return void ZPeople.Message.showWarningMsg(errorMessage)}Leave.Reports.balanceReportV1.generateReport()},resetFilter:function(){Leave.Reports.balanceReportV1.setDefaultFilterParams()},html:function(resp){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#leaveBalanceReportTableV1",Layout.Page.container),prop={edit:!0};if(resp.hasOwnProperty("header")){var header_arr=resp.header;_.isEmpty(header_arr)||_.isEmpty(data_arr)?(Layout.Page.container.find("#leaveBalanceReportV1").addClass("DN"),Leave.Reports.Util.showHideNoRecord(!0,"leaveBalanceReportV1")):(data_table.html(""),prop.total_tdata=Leave.Report.getTDcount(header_arr,!0),prop.td_width=($(".table_responsive",Layout.Page.container).width()-328)/prop.total_tdata,prop.td_width=prop.td_width>120?prop.td_width:120,data_table.append(Leave.Reports.balanceReportV1.header(header_arr,prop)),Leave.Reports.Util.showHideNoRecord(!1,"leaveBalanceReportV1"))}if(!_.isEmpty(data_arr)){var header=$("#leaveBalanceReportTableV1 thead",Layout.Page.container);prop.td_width=header.data("td_width"),prop.leavetypes=header.data("leavetypes");var tbody=data_table.children("tbody");tbody.append(Leave.Reports.balanceReportV1.balance(data_arr,prop)),tbody.find("[name=employee]").addClass("TBrdr-Rgt")}tbody&&!tbody.data("isreg")&&(tbody.on("click","tr.ZPLRow:not(.disabled)",function(){Leave.Reports.yearlyReport.employee=$(this).data("employee"),"myReports"==ZPLite.Reports.selectedTab?window.location.href="#reports/my/leave/yearly":"teamReports"==ZPLite.Reports.selectedTab?window.location.href="#reports/team/leave/yearly":"adminReports"==ZPLite.Reports.selectedTab&&(window.location.href="#reports/admin/leave/yearly")}),tbody.data("isreg",!0)),Leave.Util.removeLoading()},header:function(arr,prop){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead",{class:"TB_fxd",style:""}),common_tr=ZP.create("tr",{class:"ZPLHRow"}),emp_td=ZP.create("th",{style:"",class:"colM1_sticky TBrdr-Rgt",text:ZPI18N.getString("zp.employee")});common_tr.appendChild(emp_td);var th_width=prop.td_width;for(var indx in arr){var ltypeth=ZP.create("th",{class:"P0I TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),leavetypes=arr[indx],noofltyps=leavetypes.length>1?leavetypes.length+1:leavetypes.length;$(tbody).append('<tr><th class="text-center B1" colspan="'+noofltyps+'"><div class="ellipsis Mauto" data-toggle="tooltip" data-placement="bottom" title="'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+'">'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+"</div></th></tr>");var ltypeheadtr=ZP.create("tr"),elwidth=100/noofltyps;for(var id in leavetypes){var header,ljson=leavetypes[id];(header=ZP.create("th",{class:"text-center ZPLHRow",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px;","data-toggle":"tooltip","data-placement":"top",title:ZPeople.decodeTxt(ljson.leavetype_name),text:ZPeople.decodeTxt(ljson.leavetype_name)})),ltypeheadtr.appendChild(header)}if(noofltyps>1)(header=ZP.create("th",{class:"text-center",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px;","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.total"),text:ZPI18N.getString("zp.total")})),ltypeheadtr.appendChild(header);tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypeth.appendChild(table),common_tr.appendChild(ltypeth)}return header_tr.appendChild(common_tr),$(header_tr).data("leavetypes",arr),$(header_tr).data("td_width",th_width),temp_doc.appendChild(header_tr),temp_doc.appendChild(ZP.create("tbody")),temp_doc},balance:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),lt_arr=prop.leavetypes,td_width=prop.td_width;for(var indx in data_arr){var empJson=data_arr[indx],employee=empJson.erecno,row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow CP");for(var indx in $(row_tr).find('[name="employee"]').removeClass().addClass("fxdtd P_AM colM1_sticky"),$(row_tr).find('[name="employee"]').find("span").attr("data-container","body"),lt_arr){var ltypetd=ZP.create("td",{class:"P0I TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),ltypeheadtr=ZP.create("tr"),ltypes=lt_arr[indx],noofltyps=noofltyps=$(ltypes).length>1?$(ltypes).length+1:$(ltypes).length,elwidth=100/noofltyps;for(var idx in ltypes){var lcount=empJson[ltypes[idx].leavetype_id],td=ZP.create("td",{class:"text-center",width:elwidth+"%",style:"text-align:center;height:55px"});lcount=isNaN(lcount)?"-":lcount,td.appendChild(ZP.create("div",{text:lcount,style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(td)}if(noofltyps>1){var keyname="paidtotal";"1"===indx?keyname="ondutytotal":"3"===indx?keyname="unpaidtotal":"5"===indx&&(keyname="rhtotal");lcount=empJson[keyname];var totalTD=ZP.create("td",{class:"text-center",width:elwidth+"%",style:"text-align:center;height:55px"});lcount=isNaN(lcount)?"-":lcount,totalTD.appendChild(ZP.create("div",{text:lcount,style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(totalTD)}tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypetd.appendChild(table),row_tr.appendChild(ltypetd),$(row_tr).data("employee",employee)}temp_doc.appendChild(row_tr)}return temp_doc},Firescroll:{mode:"BALANCE_REPORT_V1",loadMoreData:function(){var params=Leave.Reports.balanceReportV1.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.balanceReportV1.Firescroll.mode,!1),Leave.Reports.balanceReportV1.html(response),ZPLite.Firescroll.setFetchedCount(Leave.Reports.balanceReportV1.Firescroll.mode,response.data.length)):ZPLite.Firescroll.setFetchedCount(Leave.Reports.balanceReportV1.Firescroll.mode,0)})}}},leaveTakenReport:{reportName:"TAKEN_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.leaveTakenReport.reportName);var initParams={};initParams.callback=Leave.Reports.leaveTakenReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){if(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isV1User){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),Leave.Reports.leaveTakenReport.reg(),Leave.Reports.leaveTakenReport.showHideFilter();var filterDiv=Layout.Page.container.find("#filterDiv");Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="datePeriodFilter"]'),"datePeriod",!0,Leave.Reports.leaveTakenReport.filterOnChangeCallback),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="typeofLeaveFilter"]'),"typeofLeave",!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Leave.Reports.leaveTakenReport.filterOnChangeCallback,"LEAVE_TAKEN_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1,Leave.Reports.leaveTakenReport.filterOnChangeCallback),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.leaveTakenReport.filterOnChangeCallback),Leave.Reports.leaveTakenReport.setDefaultFilterParams(),Leave.Reports.leaveTakenReport.generateReport()}else window.location.href="#reports/team/leave/lbalance"},reg:function(){Layout.Page.container.find(".lt_nav").find(".ZP-SwitchUnit").unbind("click").on("click",function(){$(this).removeClass("active").addClass("active"),$(this).siblings().removeClass("active"),Leave.Reports.leaveTakenReport.generateReport()})},showHideFilter:function(){var filterDiv=Layout.Page.container.find("#filterDiv");"myReports"==ZPLite.Reports.selectedTab?(filterDiv.find('[name="employeeFilter"]').addClass("DNI"),filterDiv.find('[name="incDReportsOnly"]').addClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').addClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').addClass("DNI"),filterDiv.find('[name="divisionFilter"]').addClass("DNI"),filterDiv.find('[name="departmentFilter"]').addClass("DNI"),filterDiv.find('[name="designationFilter"]').addClass("DNI"),filterDiv.find('[name="locationFilter"]').addClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').addClass("DNI"),filterDiv.find('[name="incDateOfExit"]').addClass("DNI")):(filterDiv.find('[name="employeeFilter"]').removeClass("DNI"),filterDiv.find('[name="incDReportsOnly"]').removeClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').removeClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').removeClass("DNI"),filterDiv.find('[name="divisionFilter"]').removeClass("DNI"),filterDiv.find('[name="departmentFilter"]').removeClass("DNI"),filterDiv.find('[name="designationFilter"]').removeClass("DNI"),filterDiv.find('[name="locationFilter"]').removeClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"))},filterOnChangeCallback:function(data){var values,container=Layout.Page.container.find("#filterDiv");if("datePeriod"===data.entity||"location"===data.entity){if(values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),container.find('[name="fromDateFilter"]').addClass("disabled"),container.find('[name="toDateFilter"]').addClass("disabled"),!jQuery.isEmptyObject(values)){var date;switch(values[0].id){case"0":date=ZPLite.Reports.Filters.getPeriod(0);break;case"1":date=ZPLite.Reports.Filters.getPeriod(1);break;case"2":date=ZPLite.Reports.Filters.getPeriod(30);break;case"3":date=ZPLite.Reports.Filters.getPeriod(31);break;case"4":date=ZPLite.Reports.Filters.getPeriod(765);break;case"5":date=ZPLite.Reports.Filters.getPeriod(766);break;case"6":container.find('[name="fromDateFilter"]').removeClass("disabled"),container.find('[name="toDateFilter"]').removeClass("disabled")}date&&Leave.Reports.Filters.setFromToDateFilter(date.from,date.to)}}else if("employee"==data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'));var dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"5",text:ZPI18N.getString("zp.thisyear")}]),filterDiv.find('[name="fromDateFilter"]').addClass("disabled"),filterDiv.find('[name="toDateFilter"]').addClass("disabled");var curPeriod=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period;Leave.Reports.Filters.setFromToDateFilter(curPeriod.year_start,curPeriod.year_end),ZPLite.Filters.setValues(filterDiv.find('[name="typeofLeaveFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),filterDiv.find('[name="employeeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="incDReportsOnly"]').find("input").prop("checked",!1),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),"myReports"!=ZPLite.Reports.selectedTab&&filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked")},getParamsForReport:function(){var values,params={key:"report_leavetaken",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv");if(params.from=filterDiv.find('[name="fromDateFilter"]').val(),params.to=filterDiv.find('[name="toDateFilter"]').val(),(values=ZPLite.Filters.getValues(filterDiv.find('[name="typeofLeaveFilter"]')))&&values.length>0&&(params.typeofleave=values[0].id),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var erecNo=[];$.each(values,function(index,options){erecNo.push(options.id)}),params.employee=JSON.stringify(erecNo)}if(params.incDReportsOnly=filterDiv.find("[name=incDReportsOnly]").find("input").is(":checked"),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),params.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),params.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),params.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),params.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),params.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),params.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus=[];$.each(values,function(index,options){employeeStatus.push(options.id)}),params.employeeStatus=JSON.stringify(employeeStatus),params.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(params.incDateOfExit=!0)}return params.leaveunit=Layout.Page.container.find(".lt_nav").find("div[name=switchUnit]").find("li.active").attr("value"),params.sIndx=ZPLite.Firescroll.getStartIndex(Leave.Reports.leaveTakenReport.Firescroll.mode),"myReports"==ZPLite.Reports.selectedTab?params.viewMode=1:"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#leaveTakenReport"),Leave.Reports.leaveTakenReport.Firescroll.mode),layout.find("#leaveTakenReport").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leaveTakenReport")),layout.find("#leaveTakenReport").addClass("DN");var params=Leave.Reports.leaveTakenReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){response&&"permissionDenied"===response.error?Leave.Reports.Util.permDenied():(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(layout.find("#leaveTakenReport").removeClass("DN"),Leave.Reports.leaveTakenReport.html(response),ZPLite.Firescroll.init(layout.find("#leaveTakenReport"),Leave.Reports.leaveTakenReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.leaveTakenReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.leaveTakenReport.Firescroll.mode,response.data.length)):(layout.find("#leaveTakenReport").addClass("DN"),Leave.Reports.Util.showHideNoRecord(!0,"leaveTakenReport")))},{},Leave.Reports.showReportErrorMsg)},applyFilter:function(){Leave.Reports.Filters.validateFilterParams()&&Leave.Reports.leaveTakenReport.generateReport()},resetFilter:function(){Leave.Reports.leaveTakenReport.setDefaultFilterParams()},html:function(resp){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#leaveTakenReportTable",Layout.Page.container),prop={edit:!0};if(resp.hasOwnProperty("header")){var header_arr=resp.header;_.isEmpty(header_arr)||_.isEmpty(data_arr)?(Layout.Page.container.find("#leaveTakenReport").addClass("DN"),Leave.Reports.Util.showHideNoRecord(!0,"leaveTakenReport")):(data_table.html(""),prop.total_tdata=Leave.Report.getTDcount(header_arr,!0),prop.td_width=($(".table_responsive",Layout.Page.container).width()-328)/prop.total_tdata,prop.td_width=prop.td_width>120?prop.td_width:120,data_table.append(Leave.Reports.leaveTakenReport.header(header_arr,prop)),Leave.Reports.Util.showHideNoRecord(!1,"leaveTakenReport"))}if(!_.isEmpty(data_arr)){var tbody=data_table.children("tbody"),header=$("#leaveTakenReportTable thead",Layout.Page.container);prop.td_width=header.data("td_width"),prop.leavetypes=header.data("leavetypes"),tbody.append(Leave.Reports.leaveTakenReport.taken(data_arr,prop)),tbody.find("[name=employee]").addClass("TBrdr-Rgt")}tbody&&!tbody.data("isreg")&&(tbody.on("click","tr.ZPLRow:not(.disabled)",function(){Leave.View.List.employee=$(this).data("employee"),Leave.View.List.refresh=!0,erecno!=Leave.View.List.employee?window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.TEAMUSERHOME())+"/id:"+Leave.View.List.employee:window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.HOME())}),tbody.data("isreg",!0)),Leave.Util.removeLoading()},header:function(arr,prop){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead",{class:"TB_fxd",style:""}),common_tr=ZP.create("tr",{class:"ZPLHRow"}),emp_td=ZP.create("th",{style:"",class:"colM1_sticky TBrdr-Rgt",text:ZPI18N.getString("zp.employee")});common_tr.appendChild(emp_td);var th_width=prop.td_width;for(var indx in arr){var ltypeth=ZP.create("th",{class:"P0I TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),leavetypes=arr[indx],noofltyps=leavetypes.length>1?leavetypes.length+1:leavetypes.length;$(tbody).append('<tr><th class="text-center B1" colspan="'+noofltyps+'"><div class="ellipsis Mauto" data-toggle="tooltip" data-placement="bottom" title="'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+'">'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+"</div></th></tr>");var ltypeheadtr=ZP.create("tr"),elwidth=100/noofltyps;for(var id in leavetypes){var header,ljson=leavetypes[id];(header=ZP.create("th",{class:"text-center ZPLHRow",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px;","data-toggle":"tooltip","data-placement":"top",title:ZPeople.decodeTxt(ljson.leavetype_name),text:ZPeople.decodeTxt(ljson.leavetype_name)})),ltypeheadtr.appendChild(header)}if(noofltyps>1)(header=ZP.create("th",{class:"text-center",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px;","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.total"),text:ZPI18N.getString("zp.total")})),ltypeheadtr.appendChild(header);tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypeth.appendChild(table),common_tr.appendChild(ltypeth)}return header_tr.appendChild(common_tr),$(header_tr).data("leavetypes",arr),$(header_tr).data("td_width",th_width),temp_doc.appendChild(header_tr),temp_doc.appendChild(ZP.create("tbody")),temp_doc},taken:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),lt_arr=prop.leavetypes,td_width=prop.td_width;for(var indx in data_arr){var empJson=data_arr[indx],employee=empJson.erecno,row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow CP");for(var indx in $(row_tr).find('[name="employee"]').removeClass().addClass("fxdtd P_AM colM1_sticky"),$(row_tr).find('[name="employee"]').find("span").attr("data-container","body"),lt_arr){var ltypetd=ZP.create("td",{class:"P0I TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),ltypeheadtr=ZP.create("tr"),ltypes=lt_arr[indx],noofltyps=noofltyps=$(ltypes).length>1?$(ltypes).length+1:$(ltypes).length,elwidth=100/noofltyps;for(var idx in ltypes){var lcount=empJson[ltypes[idx].leavetype_id];lcount=isNaN(lcount)?"-":lcount,(td=ZP.create("td",{class:"text-center",width:elwidth+"%",style:"text-align:center;height:55px"})).appendChild(ZP.create("div",{text:lcount,style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(td)}if(noofltyps>1){var keyname="paidtotal";"1"===indx?keyname="ondutytotal":"3"===indx?keyname="unpaidtotal":"5"===indx&&(keyname="rhtotal");var td;lcount=empJson[keyname];lcount=isNaN(lcount)?"-":lcount,(td=ZP.create("td",{class:"text-center",width:elwidth+"%",style:"text-align:center;height:55px"})).appendChild(ZP.create("div",{text:lcount,style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(td)}tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypetd.appendChild(table),row_tr.appendChild(ltypetd),$(row_tr).data("employee",employee)}temp_doc.appendChild(row_tr)}return temp_doc},Firescroll:{mode:"TAKEN_REPORT",loadMoreData:function(){var params=Leave.Reports.leaveTakenReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.leaveTakenReport.Firescroll.mode,!1),Leave.Reports.leaveTakenReport.html(response),ZPLite.Firescroll.setFetchedCount(Leave.Reports.leaveTakenReport.Firescroll.mode,response.data.length)):ZPLite.Firescroll.setFetchedCount(Leave.Reports.leaveTakenReport.Firescroll.mode,0)})}}},leaveRollOverReport:{reportName:"ROLLOVER_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.leaveRollOverReport.reportName);var initParams={};initParams.callback=Leave.Reports.leaveRollOverReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),Leave.Reports.leaveRollOverReport.reg();var filterDiv=Layout.Page.container.find("#filterDiv");Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="leaveYearFilter"]'),"leaveyear",!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Leave.Reports.leaveRollOverReport.filterOnChangeCallback,"LEAVE_ROLLOVER_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.leaveRollOverReport.filterOnChangeCallback),Leave.Reports.leaveRollOverReport.setDefaultFilterParams(),Leave.Reports.leaveRollOverReport.generateReport()},reg:function(){Layout.Page.container.find(".lt_nav").find(".ZP-SwitchUnit").unbind("click").on("click",function(){$(this).removeClass("active").addClass("active"),$(this).siblings().removeClass("active"),Leave.Reports.leaveRollOverReport.generateReport()})},filterOnChangeCallback:function(data){var values,container=Layout.Page.container.find("#filterDiv");if("employee"==data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'));var dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");ZPLite.Filters.setValues(filterDiv.find('[name="leaveYearFilter"]'),[{id:"all",text:ZPI18N.getString("zp.allyears")}]),filterDiv.find('[name="employeeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="incDReportsOnly"]').find("input").prop("checked",!1),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked")},getParamsForReport:function(){var values,params={key:"report_encash",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv");if((values=ZPLite.Filters.getValues(filterDiv.find('[name="leaveYearFilter"]')))&&values.length>0&&(params.leaveyear=values[0].id),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var erecNo=[];$.each(values,function(index,options){erecNo.push(options.id)}),params.employee=JSON.stringify(erecNo)}if(params.incDReportsOnly=filterDiv.find("[name=incDReportsOnly]").find("input").is(":checked"),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),params.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),params.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),params.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),params.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),params.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),params.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus=[];$.each(values,function(index,options){employeeStatus.push(options.id)}),params.employeeStatus=JSON.stringify(employeeStatus),params.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(params.incDateOfExit=!0)}return params.leaveunit=Layout.Page.container.find(".lt_nav").find("div[name=switchUnit]").find("li.active").attr("value"),params.sIndx=ZPLite.Firescroll.getStartIndex(Leave.Reports.leaveRollOverReport.Firescroll.mode),"myReports"==ZPLite.Reports.selectedTab?params.viewMode=1:"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#leaveRollOverReport"),Leave.Reports.leaveRollOverReport.Firescroll.mode),layout.find("#leaveRollOverReport").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leaveRollOverReport")),layout.find("#leaveRollOverReport").addClass("DN");var params=Leave.Reports.leaveRollOverReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){response&&"permissionDenied"===response.error?Leave.Reports.Util.permDenied():(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(layout.find("#leaveRollOverReport").removeClass("DN"),Leave.Reports.leaveRollOverReport.html(response),ZPLite.Firescroll.init(Layout.Page.container.find("#leaveRollOverReport"),Leave.Reports.leaveRollOverReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.leaveRollOverReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.leaveRollOverReport.Firescroll.mode,response.data.length)):Leave.Reports.Util.showHideNoRecord(!0,"leaveRollOverReport"))},{},Leave.Reports.showReportErrorMsg)},applyFilter:function(){Leave.Reports.leaveRollOverReport.generateReport()},resetFilter:function(){Leave.Reports.leaveRollOverReport.setDefaultFilterParams()},html:function(resp){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#leaveRollOverReportTable",Layout.Page.container);if(resp.hasOwnProperty("header")){var header_arr=resp.header;_.isEmpty(header_arr)||_.isEmpty(data_arr)?(Layout.Page.container.find("#leaveRollOverReport").addClass("DN"),Leave.Reports.Util.showHideNoRecord(!0,"leaveRollOverReport")):(data_table.html(""),data_table.append(Leave.Reports.leaveRollOverReport.header(header_arr)),Leave.Reports.Util.showHideNoRecord(!1,"leaveRollOverReport"))}if(!_.isEmpty(data_arr)){var tbody=data_table.children("tbody");tbody.append(Leave.Reports.leaveRollOverReport.body(data_arr,{edit:!0,leavetypes:$("#leaveRollOverReportTable thead",Layout.Page.container).data("leavetypes")})),tbody.find("td").css("cursor","auto")}Leave.Util.removeLoading()},header:function(arr){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead"),common_tr=ZP.create("tr",{class:"ZPLHRow"}),emp_td=ZP.create("th",{rowspan:"2",class:"colM1_sticky TBrdr-Rgt"});emp_td.appendChild(ZP.create("span",{class:"ellipsis W150",text:ZPI18N.getString("zp.employee")}));var doj_td=ZP.create("th",{rowspan:"2",class:"P0I TBrdr-Rgt text-center",text:ZPI18N.getString("zp.dateofjoining"),style:"text-align:center"}),yrtd=ZP.create("th",{rowspan:"2",class:"P0I TBrdr-Rgt text-center",text:ZPI18N.getString("zp.leave.report.leaveyear"),style:"text-align:center"});common_tr.appendChild(emp_td),common_tr.appendChild(doj_td),common_tr.appendChild(yrtd);var noofltyps=0;$.each(arr,function(indx,obj){noofltyps+=$(obj).length});var ltypeth=ZP.create("th",{class:"P0I",style:"border-bottom:0px"}),table=ZP.create("table",{class:"table Vlis bgc"}),tbody=ZP.create("tbody"),ltypeheadtr=ZP.create("tr",{class:"ZPLHRow"}),elwidth=100/noofltyps,subheader=ZP.create("tr",{class:"ZPLHRow"});return $.each(arr,function(indx,obj){for(var id in obj){var ljson=obj[id],header=ZP.create("th",{class:"P0I TBrdr-Rgt text-center B1",colspan:"2",text:ZPeople.decodeTxt(ljson.leavetype_name)});ltypeheadtr.appendChild(header),subheader.appendChild(ZP.create("th",{class:"P0I TBrdr-Rgt text-center PL0I",width:elwidth/2+"%",text:ZPI18N.getString("zp.leave.rolledover")})),subheader.appendChild(ZP.create("th",{class:"P0I TBrdr-Rgt text-center PL0I",width:elwidth/2+"%",text:ZPI18N.getString("zp.leave.lapsed")}))}}),tbody.appendChild(ltypeheadtr),tbody.appendChild(subheader),table.appendChild(tbody),ltypeth.appendChild(table),common_tr.appendChild(ltypeth),header_tr.appendChild(common_tr),$(header_tr).data("leavetypes",arr),temp_doc.appendChild(header_tr),temp_doc.appendChild(ZP.create("tbody")),temp_doc},body:function(data_arr,prop){if(prop.leavetypes){var temp_doc=document.createDocumentFragment(),noofltyps=(data_arr.length,0);for(var indx in $.each(prop.leavetypes,function(indx,obj){noofltyps+=$(obj).length}),data_arr){var empJson=data_arr[indx],empTD=(empJson.erecno,ZP.getEmpTD(empJson.erecno,empJson.id,empJson.name,empJson.photo,!1,empJson));empTD.classList.add("TBrdr-Rgt");var row_tr=ZP.create("tr",{class:"Report_row ZPLRow"+(empJson.emp_disabled?" disabled":""),style:"max-height:40px"});row_tr.appendChild(empTD),row_tr.appendChild(ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:empJson.doj,style:"text-align:center"})),$(row_tr).find('[name="employee"]').removeClass().addClass("fxdtd P_AM colM1_sticky TBrdr-Rgt"),$(row_tr).find('[name="employee"]').find("span").attr("data-container","body");var yrTd=ZP.create("td",{class:"P0I TBrdr-Rgt"}),yrTable=ZP.create("table",{class:"table Vlis bgc"}),yrBody=ZP.create("tbody"),datatd=ZP.create("td",{class:"P0I"}),table=ZP.create("table",{class:"table Vlis bgc",id:"yearTable"}),tbody=ZP.create("tbody"),rollObj=empJson.rollData,yrStrArr=empJson.yrData,elwidth=100/noofltyps;for(var indx in rollObj){var yrRow=ZP.create("tr",{class:"ZPLRow"}),yearTd=ZP.create("td",{class:"text-center POI",text:yrStrArr[indx],style:"padding-right:0px;text-align:center"});yrRow.appendChild(yearTd),yrBody.appendChild(yrRow);var dataRow=ZP.create("tr",{class:"ZPLRow"}),yearObj=rollObj[indx];if(!yearObj.length){var arr=[];arr.push(yearObj),yearObj=arr}$.each(prop.leavetypes,function(indx,obj){for(var indx in obj){var ltObj=obj[indx],rollover="-",encashed="-";for(var i in yearObj){var rollLT=yearObj[i];ltObj.leavetype_id==rollLT.ltypeid&&(rollover=rollLT.rollover,encashed=rollLT.encashed)}var roTd=ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:rollover,width:elwidth/2+"%"});dataRow.appendChild(roTd),roTd=ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:encashed,width:elwidth/2+"%"}),dataRow.appendChild(roTd)}}),yrTable.appendChild(yrBody),yrTd.appendChild(yrTable),tbody.appendChild(dataRow),table.appendChild(tbody),datatd.appendChild(table)}if(_.isEmpty(rollObj)){(yrRow=ZP.create("tr",{class:"ZPLRow"})).appendChild(ZP.create("td",{class:"text-center",text:"-",style:"padding-right:0px;text-align:center"})),yrBody.appendChild(yrRow);dataRow=ZP.create("tr",{class:"ZPLRow"});$.each(prop.leavetypes,function(indx,obj){for(var indx in obj)dataRow.appendChild(ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:"-",width:elwidth/2+"%",style:"text-align:center"})),dataRow.appendChild(ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:"-",width:elwidth/2+"%",style:"text-align:center"}))}),yrTable.appendChild(yrBody),yrTd.appendChild(yrTable),tbody.appendChild(dataRow),table.appendChild(tbody),datatd.appendChild(table)}row_tr.appendChild(yrTd),row_tr.appendChild(datatd),temp_doc.appendChild(row_tr)}return temp_doc}},Firescroll:{mode:"ROLLOVER_REPORT",loadMoreData:function(){var params=Leave.Reports.leaveRollOverReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.leaveRollOverReport.Firescroll.mode,!1),Leave.Reports.leaveRollOverReport.html(response),ZPLite.Firescroll.setFetchedCount(Leave.Reports.leaveRollOverReport.Firescroll.mode,response.data.length)):ZPLite.Firescroll.setFetchedCount(Leave.Reports.leaveRollOverReport.Firescroll.mode,0)})}}},userReport:{reportName:"USER_REPORT",employee:"",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.userReport.reportName);var initParams={};initParams.callback=Leave.Reports.userReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){if(void 0!=ZPeople.Module.MODULE_DATA.leavetracker){LVUtil.Tab.isBalance()&&LVUtil.Tab.isUserPage()&&(Leave.Reports.userReport.employee=-1!=Layout.Page.hash.indexOf("leavetracker/team/user/balance")?Layout.Page.urlparam.id:""),ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),Leave.Reports.userReport.reg(),Leave.Reports.userReport.regRow();var empFilObj=Layout.Page.container.find('[name="employeeFilter"]');Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(empFilObj,"employee",!0,Leave.Reports.userReport.filterOnChangeCallback,"LEAVE_USER_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),empFilObj.find("label").remove();var empId=""!=Leave.Reports.userReport.employee?Leave.Reports.userReport.employee:erecno,userDtl=ZPeople.getUserDetailsById(empId);ZPLite.Filters.setValues(empFilObj,[{id:empId,text:ZPeople.decodeTxt(ZPeople.escapeHtml(userDtl.empid+" "+userDtl.name)),photoUrl:userDtl.avatar}]),"myReports"==ZPLite.Reports.selectedTab?empFilObj.off("click"):empFilObj.on("click"),Leave.Reports.userReport.employee="",Leave.Reports.userReport.generateReport(),LVUtil.Tab.isBalance()&&LVUtil.Tab.isNewTabPage()&&Layout.Page.container.find(".lt_nav").find(".nav_rht").hide()}},reg:function(){var layout=Layout.Page.container;layout.find(".lt_nav").find(".cus_title").unbind("click").on("click",function(){$(this).removeClass("sel").addClass("sel"),$(this).siblings().removeClass("sel"),Leave.Reports.userReport.generateReport()}),layout.find(".lt_nav").find(".ZP-SwitchUnit").unbind("click").on("click",function(){$(this).removeClass("active").addClass("active"),$(this).siblings().removeClass("active"),Leave.Reports.userReport.generateReport()});var bodyHeader=$(".table_responsive > table > thead",layout);$(".Tclr",bodyHeader).off("click").on("click",function(){Leave.Reports.Util.toggleSort(this,bodyHeader),Leave.Reports.userReport.generateReport()})},regRow:function(){var tbody=Layout.Page.container.find("#leaveUserReportBody");$(tbody).data("isRowClickReg")||($(tbody).on("click","td",function(){var tr=$(this).parents("tr");!$(this).hasClass("dropdown")&&2!=tr.data("type")&&4!=tr.data("type")&&tr.data("showMonthSummary")&&Leave.Reports.userReport.MonthSummary.init($(this))}),$(tbody).data("isRowClickReg",!0))},filterOnChangeCallback:function(data){Layout.Page.container;"employee"===data.entity&&Leave.Reports.userReport.generateReport()},getParamsForReport:function(){var params={key:"report_user",conreqcsr:csrfToken},header=Layout.Page.container.find(".lt_nav"),display_ele=$(".crd",header);params.display=display_ele.hasClass("sel")?0:1;var values=ZPLite.Filters.getValues(Layout.Page.container.find('[name="employeeFilter"]'));return params.employee=-1,void 0!==values&&values.length>0&&(params.employee=values[0].id),params.leaveunit=header.find("div[name=switchUnit]").find("li.active").attr("value"),params.repType=ZPLite.Reports.selectedTab,Leave.Reports.Util.sortParams(params),params},generateReport:function(){var layout=Layout.Page.container;layout.find("#leaveUserReport").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),Layout.Page.container.find("[id=zp_page_loading]").remove(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leaveUserReport")),layout.find("#leaveUserReport").addClass("DNI");var params=Leave.Reports.userReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url2,params,function(response){response&&"permissionDenied"===response.error?Leave.Reports.Util.permDenied():(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==response&&void 0!==response.data&&response.data.length>0?(layout.find("#leaveUserReport").removeClass("DNI"),1==params.display?Leave.Reports.userReport.list(response,params):Leave.Reports.userReport.chart(response,params)):(layout.find("#leaveUserReportChartParent").addClass("DNI"),layout.find("#leaveUserReportTable").addClass("DNI"),$(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsmsg"))).insertBefore(layout.find("#leaveUserReport"))))},{},Leave.Reports.showReportErrorMsg)},list:function(resp){var layout=Layout.Page.container;if(layout.find("#leaveUserReportChartParent").addClass("DNI"),layout.find("#leaveUserReportTable").removeClass("DNI"),"success"===resp.status){var tempDoc=document.createDocumentFragment(),data_arr=resp.data,data_div=$("#leaveUserReportTable",Layout.Page.container),data_tbody=$("tbody",data_div);data_tbody.hide().html("");var showNoData=!0;if(data_arr[0]&&!_.isEmpty(data_arr[0].leavetypes)){var leave_types=data_arr[0].leavetypes;for(var indx in leave_types){var leave_type=leave_types[indx],isSysTypes=2==leave_type.type||4==leave_type.type;if(!leave_type.doNotDisplayBalance){var tr=ZP.create("tr",{class:"ZPLRow "+(isSysTypes?"":"CP")}),nametd=ZP.create("td");nametd.appendChild(ZP.create("div",{class:"ZPLtyp CL"+leave_type.color})),nametd.appendChild(document.createTextNode(ZPeople.decodeTxt(leave_type.name))),!isSysTypes&&leave_type.showFullSummary?tr.appendChild(Leave.Reports.userReport.getDropDownActionsTD()):tr.appendChild(ZP.create("td")),tr.appendChild(nametd),tr.appendChild(ZP.create("td",{text:ZP.optValue(leave_type,"available",0)})),$(tr).data("id",leave_type.leavetypeid).data("name",leave_type.name).data("type",leave_type.type).data("showMonthSummary",leave_type.showFullSummary),tempDoc.appendChild(tr),showNoData=!1}}data_tbody.append(tempDoc),data_tbody.find(".ddown").parent().unbind("click").on("click",function(event){event.stopPropagation(),$(this).find(".ddown").addClass("ignore"),$(this).find(".ddown").hasClass("open")?$(this).find(".ddown").removeClass("open"):$(this).find(".ddown").addClass("open"),$(".ddown:not(.ignore)",$(this).closest("tbody")).removeClass("open"),$(this).find(".ddown").removeClass("ignore")})}data_tbody.fadeIn(50),data_div.removeClass("DNI"),data_div.siblings("div#leaveUserReportChartParent").addClass("DNI"),showNoData&&(layout.find("#leaveUserReportChartParent").addClass("DNI"),layout.find("#leaveUserReportTable").addClass("DNI"),$(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsmsg"))).insertBefore(layout.find("#leaveUserReport")))}},getDropDownActionsTD:function(action){var actionTd=ZP.create("td"),actionDiv=ZP.create("div",{class:"ddown","data-toggle":"dropdown"});actionDiv.appendChild(ZP.create("a",{class:"act_more lt_title","lt-title":"More"}));var actionInnerDiv=ZP.create("div",{class:"lt_dropdown sm btm rgt"}),actionList=ZP.create("ul"),list=ZP.create("li"),a=ZP.create("a",{onclick:"Leave.Reports.userReport.MonthSummary.init(this)"});return a.appendChild(ZP.create("i",{class:"IC-pln-note S13 FL MR5 VM"})),a.appendChild(document.createTextNode(ZPI18N.getString("zp.summary"))),list.appendChild(a),actionList.appendChild(list),list=ZP.create("li"),(a=ZP.create("a",{onclick:"Leave.Reports.userReport.PolicyTransView.init(this)"})).appendChild(ZP.create("i",{class:"CR-audit S13 FL MR5 VM"})),a.appendChild(document.createTextNode(ZPI18N.getString("zp.history"))),list.appendChild(a),actionList.appendChild(list),actionInnerDiv.appendChild(actionList),actionDiv.appendChild(actionInnerDiv),actionTd.appendChild(actionDiv),actionTd},chart:function(resp,params){var layout=Layout.Page.container;if(layout.find("#leaveUserReportChartParent").removeClass("DNI"),layout.find("#leaveUserReportTable").addClass("DNI"),"success"===resp.status){var count_arr=resp.data[0]?resp.data[0].leavetypes:{};Layout.Page.container.find("#leaveUserReportChartParent").removeClass("DNI"),layout.find("#leaveUserReportTable").addClass("DNI");var color=[],ltaken=[],lavail=[],name=[],chart_div=Layout.Page.container.find("#leaveUserReportChart");if(_.isEmpty(count_arr))return Layout.Page.container.find("[id=zp_page_loading]").fadeOut(200).remove(),layout.find("#leaveUserReportChartParent").addClass("DNI"),layout.find("#leaveUserReportTable").addClass("DNI"),void $(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsmsg"))).insertBefore(layout.find("#leaveUserReport"));for(var indx in Layout.Page.container.find(".ZPNdata").fadeOut(100).remove(),count_arr){var count_json=count_arr[indx],type=count_json.type,taken=count_json.taken;2===type&&0===taken||(color.push(count_json.dbcolor),ltaken.push(count_json.taken),lavail.push(count_json.available?count_json.available:0),name.push(ZPeople.decodeTxt(count_json.name)))}var formName=ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.formDisplayName)+" ";chart_div.highcharts({chart:{type:"column",plotBorderWidth:1,plotBorderColor:"#f3f3f3",spacingBottom:50,spacingTop:10,spacingLeft:10,spacingRight:50},credits:{enabled:!1},title:{text:formName+ZPI18N.getString("zp.reports.chart"),align:"left",x:50,style:{color:"black",fontWeight:"bold"}},xAxis:{categories:name,labels:{rotation:-45}},yAxis:{title:{text:("Days"==params.leaveunit?ZPI18N.getString("zp.cday"):ZPI18N.getString("zp.leavetype.hour"))+" "+formName+ZPI18N.getString("zp.reports.chart")},gridLineColor:"#f3f3f3"},tooltip:{valueDecimals:2,headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name} </br> {point.y.name} : {point.y}"},legend:{enabled:!1},exporting:{enabled:!1,buttons:{contextButton:{theme:{states:{hover:{stroke:"#bfbfbf",fill:null},select:{stroke:"#bfbfbf",fill:null}}},symbolStroke:"#bfbfbf"}},filename:("Days"==params.leaveunit?ZPI18N.getString("zp.cday"):ZPI18N.getString("zp.leavetype.hour"))+" "+ZPI18N.getString("zp.leave.based")},plotOptions:{column:{pointPadding:.3,borderWidth:0,stacking:"normal"}},series:[{name:"Available",color:"#D3D3D3",data:lavail},{name:"Taken",colorByPoint:!0,showInLegend:!1,colors:color,data:ltaken}]})}layout.find("#Chart_Leave_Applications").slideUp(),$("#leaveUserReportChartParent").find(".label-head").off("click").on("click",Leave.Report.LYear.getformRecords),Leave.Reports.Util.removeLoading(),chart_div.fadeIn(100)},MonthSummary:{isHandlingPrevRequest:!1,init:function(ele){if(!Leave.Reports.userReport.MonthSummary.isHandlingPrevRequest){Leave.Reports.userReport.MonthSummary.isHandlingPrevRequest=!0;var parentTr=$(ele).parents("tr");Leave.Reports.userReport.MonthSummary.name=parentTr.data("name");var values=ZPLite.Filters.getValues(Layout.Page.container.find('[name="employeeFilter"]'));if(void 0!==values&&values.length>0){var employee=values[0].id;Leave.Reports.userReport.MonthSummary.get(employee,parentTr.data("id"),parentTr.data("name"))}}},get:function(employee,leavetype,ltName){var ele=Layout.Page.container.find("#ZP_MonthWiseSummary_popup"),params={key:"report_monthwise"};params.employee=employee,params.leavetype=leavetype,$(ele).length>0&&(params.from=ele.find("[name=from]").val(),params.to=ele.find("[name=to]").val()),params.hasOwnProperty("from")&&params.hasOwnProperty("to")&&!Leave.Util.Validate.noofDays(params.from,params.to,3650,"Date period should be within 10 years")?Leave.Reports.userReport.MonthSummary.isHandlingPrevRequest=!1:ZPeople.Request.send(Leave.Reports.url2,params,function(response,param){Leave.Reports.userReport.MonthSummary.construct(response,param,ltName),Leave.Reports.userReport.MonthSummary.isHandlingPrevRequest=!1})},construct:function(resp,params,ltName){var employee=params.employee,leavetype=params.leavetype;if(0==Layout.Page.container.find("#ZP_MonthWiseSummary_popup").length){var template=$('<div class="modal fade ZPsecModal" role="dialog" data-keyboard="true" tabindex="-1" id="ZP_MonthWiseSummary_popup"><div class="modal-dialog calwkpop calpluspop ZPCLmdl" role="document" style="width:'+.65*$(window).width()+'px"><div class="modal-content"><div class="modal-header" id="heading" style="border-bottom: 1px solid #e5e5e5;"><div class="ZP-UserProfPop"><div class="col-sm-4"><h6 class="addPopTitle pull-left W250 ellipsis" data-toggle="tooltip" data-placement="bottom" title="'+ltName+'">'+ltName+'</h6></div><div class="btnCal ZPft DIB ML10"><input type="text" caltype="filter" class="ZP-Date form-control W120" name="from" placeholder='+ZPI18N.getString("zp.from")+'></div>&nbsp; - <div class="btnCal ZPft ML5 DIB"><input type="text" caltype="filter" class="ZP-Date form-control W120" name="to" placeholder='+ZPI18N.getString("zp.to")+'></div><button aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div></div><div class="modal-body P0I" id="zp_form_outer_container" style="padding-top:40px!important;height:'+.75*$(window).height()+'px"></div></div></div></div>'),table=$('<div class="table-responsive tabcont"><div class="ZPfhlin"></div><table class="table table-hover Tlis FLhead" style="display: table;"><thead><tr class="ZPLHRow TblGryBg"><th style="width:25%"><div><span>'+ZPI18N.getString("zp.period")+'</span></div></th><th style="width:15%"><div><span>'+ZPI18N.getString("zp.leave.granted")+'</span></div></th><th style="width:15%"><div><span>'+ZPI18N.getString("zp.leave.view.booked")+'</span></div></th><th style="width:15%"><div><span>'+ZPI18N.getString("zp.leave.view.balance")+'</span></div></th><th style="width:15%"><div><span>'+ZPI18N.getString("zp.leave.lapsed")+"</span></div></th></tr></thead><tbody></tbody></table></div>"),tbody=table.find("tbody");table.find("tbody").append(tbody),template.find(".modal-body").append(table),template.on("hidden.bs.modal",function(){Layout.Page.container.find("#ZP_MonthWiseSummary_popup").remove()}),Layout.Page.container.append(template);var ele=Layout.Page.container.find("#ZP_MonthWiseSummary_popup");ele.modal({backdrop:"static"}),setTimeout(function(){ele.removeClass("fade")},500);ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date;ele.find("[name=from]").val(Calendar.formatDate(new Date((new Date).getFullYear(),0,1),uidateFormat)),ele.find("[name=to]").val(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date),ele.find("[name=from],[name=to]").on("click",function(event){Calendar.setUpCalendar(event,this,void 0,void 0,function(){Leave.Reports.userReport.MonthSummary.get(employee,leavetype)})}),ele.find("[name=from],[name=to]").on("change",function(){Leave.Reports.userReport.MonthSummary.get(employee,leavetype)})}this.populate(resp.data)},populate:function(data){var tbody=Layout.Page.container.find("#ZP_MonthWiseSummary_popup").find("tbody").empty(),monthArr=data.months,reportArr=data.report;_.isEmpty(months)?Leave.Util.showHideNoRecord(!0,!1,Layout.Page.container.find("#ZP_MonthWiseSummary_popup").find(".modal-body")):($.each(monthArr,function(indx,monthKey){var tr=ZP.create("tr",{class:"ZPLRow"}),monthTxt=months[monthKey.split("-")[0]]+" "+monthKey.split("-")[1],report=reportArr[indx],granted=report.granted?parseFloat(report.granted):0,taken=report.taken?parseFloat(report.taken):0,balance=report.closingBalance?parseFloat(report.closingBalance):0,lapsed=report.lapsed?parseFloat(report.lapsed):0;granted=granted%1==0?parseInt(granted):granted,taken=taken%1==0?parseInt(taken):taken,balance=balance%1==0?parseInt(balance):balance,lapsed=lapsed%1==0?parseInt(lapsed):lapsed,granted=0==granted?"-":granted,taken=0==taken?"-":taken,lapsed=0==lapsed?"-":lapsed,tr.appendChild(ZP.create("td",{text:monthTxt})),tr.appendChild(ZP.create("td",{text:granted})),tr.appendChild(ZP.create("td",{text:taken})),tr.appendChild(ZP.create("td",{text:balance})),tr.appendChild(ZP.create("td",{text:lapsed})),tbody.append(tr)}),Leave.Util.showHideNoRecord(!1,!1,Layout.Page.container.find("#ZP_MonthWiseSummary_popup").find(".modal-body")))}},PolicyTransView:{name:void 0,ltId:void 0,init:function(ele,id,name){if(ele){var parentTr=$(ele).parents("tr");Leave.Reports.userReport.PolicyTransView.ltId=parentTr.data("id"),Leave.Reports.userReport.PolicyTransView.name=parentTr.data("name");var values=ZPLite.Filters.getValues(Layout.Page.container.find('[name="employeeFilter"]'));if(void 0!==values&&values.length>0){var employee=values[0].id;Leave.Reports.userReport.PolicyTransView.get(employee,parentTr.data("id"))}}},get:function(employee,leavetype,isRgtModal){var ele=Layout.Page.container.find("#ZP_Transaction_popup"),params={key:"viewtransaction"};params.employee=employee,params.leavetypeid=leavetype,$(ele).length>0&&(params.from=ele.find("[name=from]").val(),params.to=ele.find("[name=to]").val()),params.hasOwnProperty("from")&&params.hasOwnProperty("to")&&!Leave.Util.Validate.noofDays(params.from,params.to,3650,ZPI18N.getString("zp.leavetype.v2.error.daterange"))||ZPeople.Request.send("/leave_common_action.zp",params,function(response,param){Leave.Reports.userReport.PolicyTransView.construct(response,param,isRgtModal)})},getParams:function(employee,leavetype,isRgtModal){var ele=Layout.Page.container.find("#ZP_Transaction_popup"),params={key:"viewtransaction"};return params.employee=employee,params.leavetypeid=leavetype,$(ele).length>0&&(params.from=ele.find("[name=from]").val(),params.to=ele.find("[name=to]").val()),!(params.hasOwnProperty("from")&&params.hasOwnProperty("to")&&!Leave.Util.Validate.noofDays(params.from,params.to,3650,ZPI18N.getString("zp.leavetype.v2.error.daterange")))&&params},construct:function(resp,params,isrgtmodal){var employee=params.employee,leavetype=params.leavetypeid,ltName=Leave.Reports.userReport.PolicyTransView.name;if(0==Layout.Page.container.find("#ZP_Transaction_popup").length){var template=$('<div class="modal ZPsecModal '+(isrgtmodal?"popRgtModel PopLgModel":"fade")+'" role="dialog" data-keyboard="true" tabindex="-1" id="ZP_Transaction_popup"><div class="modal-dialog '+(isrgtmodal?"":'calwkpop calpluspop ZPCLmdl" role="document" style="width:'+.65*$(window).width()+'px"')+'"><div class="modal-content"><div class="modal-header '+(isrgtmodal?"PR ZPbgblue":"")+'" id="heading" style="border-bottom: 1px solid #e5e5e5;"><div class="ZP-UserProfPop"><div class="col-sm-4">'+(isrgtmodal?'<i class="iconbck IC-ar-lft DI PR10" style="margin-top:7px;" data-dismiss="modal"></i>':"")+'<h6 class="addPopTitle pull-left W250 ellipsis" data-toggle="tooltip" data-placement="bottom" title="'+ltName+'">'+ltName+'</h6></div><div class="btnCal ZPft DIB ML10"><input type="text" caltype="filter" class="ZP-Date form-control W120" name="from" placeholder='+ZPI18N.getString("zp.from")+'></div>&nbsp; - <div class="btnCal ZPft ML5 DIB"><input type="text" caltype="filter" class="ZP-Date form-control W120" name="to" placeholder='+ZPI18N.getString("zp.to")+"></div>"+(isrgtmodal?"":'<button aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true"><div class="IC-cls-1px MR10 MT8 red S21 CP"></div></span></button>')+(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowExport?'<span class="IC-exprt blu MR5 FR MT7 S15 CP" onclick="Leave.Reports.Export.showExport(this,true)" data-toggle="tooltip" data-placement="bottom" title="'+ZPI18N.getString("zp.export")+'"></span>':"")+'</div></div><div class="modal-body P0I" id="ZP_Transaction_popup_body" style="padding-top:40px!important;'+(isrgtmodal?"bottom:0px;":"height:"+.75*$(window).height()+"px")+'"></div></div></div></div>'),table=$('<div class="table-responsive tabcont"><div class="ZPfhlin"></div><table class="table table-hover Tlis FLhead" style="display: table;"><thead><tr class="ZPLHRow TblGryBg"><th style="width:25%"><div><span>'+ZPI18N.getString("zp.date")+'</span></div></th><th style="width:25%"><div><span>'+ZPI18N.getString("zp.type")+'</span></div></th><th style="width:15%"><div><span>'+ZPI18N.getString("zp.added")+'</span></div></th><th style="width:15%"><div><span>'+ZPI18N.getString("zp.leave.view.booked")+'</span></div></th><th style="width:15%"><div><span>'+ZPI18N.getString("zp.leave.view.balance")+"</span></div></th></tr></thead><tbody></tbody></table></div>"),tbody=table.find("tbody");table.find("tbody").append(tbody),template.find(".modal-body").append(table),template.on("hidden.bs.modal",function(){setTimeout(function(){Layout.Page.container.find("#ZP_Transaction_popup").remove()},500)}),Layout.Page.container.append(template);var ele=Layout.Page.container.find("#ZP_Transaction_popup");ele.modal({backdrop:"static"}),setTimeout(function(){ele.removeClass("fade")},500);ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date;ele.find("[name=from]").val(Calendar.formatDate(new Date((new Date).getFullYear(),0,1),uidateFormat)),ele.find("[name=to]").val(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date),ele.find("[name=from],[name=to]").on("click",function(event){Calendar.setUpCalendar(event,this,void 0,void 0,function(){Leave.Reports.userReport.PolicyTransView.get(employee,leavetype)})}),ele.find("[name=from],[name=to]").on("change",function(){Leave.Reports.userReport.PolicyTransView.get(employee,leavetype)})}tbody=Layout.Page.container.find("#ZP_Transaction_popup").find("tbody").empty();if(_.isEmpty(resp.data))Leave.Util.showHideNoRecord(!0,!1,Layout.Page.container.find("#ZP_Transaction_popup").find(".modal-body"));else{var showEntriesAsDisabled=!1;$.each(resp.data,function(indx,obj){var tr=ZP.create("tr",{class:"ZPLRow "+(showEntriesAsDisabled||obj.isArchive?"dgry":"")});tr.appendChild(ZP.create("td",{text:obj.date}));var added="-",used="-",runningbalance="-";if(obj.isArchive||(added=obj.added?parseFloat(obj.added):0,used=obj.used?parseFloat(obj.used):0,runningbalance=obj.runningbalance?parseFloat(obj.runningbalance):0,added=added%1==0?parseInt(added):added,used=used%1==0?parseInt(used):used,runningbalance=runningbalance%1==0?parseInt(runningbalance):runningbalance,added=0==added?"-":added,used=0==used?"-":used),obj.isEmpExitEntry)tr.appendChild(ZP.create("td",{text:ZPI18N.getString("zp.leave.transaction.employeeexited")})),showEntriesAsDisabled=!0;else{obj.reason;if(51==obj.type){var loptd=ZP.create("td",{class:"calemdlic",text:Leave.Policy.ENTRYTYPE.get(obj.type,obj.isArchive)+""});obj.reason&&loptd.appendChild(Leave.Policy.Transaction.View.getInfoHTMl(obj)),tr.appendChild(loptd)}else if(18==obj.type){var td=ZP.create("td",{class:"calemdlic",text:obj.reason&&obj.reason.trim().length>0?obj.reason:Leave.Policy.ENTRYTYPE.get(obj.type,obj.isArchive)});td.appendChild(Leave.Policy.Transaction.View.getInfoHTMl(obj,!0)),tr.appendChild(td)}else tr.appendChild(ZP.create("td",{text:obj.reason&&obj.reason.trim().length>0?obj.reason:Leave.Policy.ENTRYTYPE.get(obj.type,obj.isArchive)}))}tr.appendChild(ZP.create("td",{text:added})),tr.appendChild(ZP.create("td",{text:used})),tr.appendChild(ZP.create("td",{text:runningbalance})),$(tr).data("id",obj.pkId),tbody.append(tr),tbody.find("[data-popover=true]").popover()}),Leave.Util.showHideNoRecord(!1,!1,Layout.Page.container.find("#ZP_Transaction_popup").find(".modal-body"))}},getInfoHTMl({type:type,reason:reason,modified:modified},skipReason){var info=!skipReason&&reason&&reason.trim().length>0?`<p class='LH18I'><b>${ZPI18N.getString("zp.reason")} : </b> ${ZPeople.escapeHtml(reason)}</p>`:"";return modified&&(info+=`<p class='LH18I'><b>${51==type?ZPI18N.getString("zp.modifiedby"):ZPI18N.getString("zp.addedby")} : </b> ${ZPeople.escapeHtml(modified.by)}</p>\n\t\t\t\t\t\t\t \t\t  <p class='LH18I'><b>${51==type?ZPI18N.getString("zp.modifiedon"):ZPI18N.getString("zp.addedon")} : </b> ${modified.at}</p>`),ZP.create("i",{class:"CR-info popHover","data-html":"true","data-popover":"true","data-placement":"bottom","data-content":info,"data-original-title":"",title:""})}}},userAvailReport:{reportName:"USER_AVAIL_REPORT",sortType:-1,initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.userAvailReport.reportName);var initParams={};initParams.callback=Leave.Reports.userAvailReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams),void 0!=Layout.Page.container.find("#permissions")&&Layout.Page.container.find("#permissions").length>0&&"true"==is5_0Enabled&&Layout.Page.container.find("#permissions").find("a").attr("href","#settings/service/leavetracker/reports")},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker");var viewperm=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.deptViewPerm;if(Leave.Util.isCurPageAdmin()||"-1"!=viewperm&&("0"!=viewperm||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.depPermDepartments&&0!=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.depPermDepartments.length)){Leave.Reports.Filters.clearCache(!0);var filterDiv=Layout.Page.container.find("#filterDiv");Leave.Reports.Filters.constructFilter(filterDiv.find('[name="datePeriodFilter"]'),"datePeriod",!0,Leave.Reports.userAvailReport.filterOnChangeCallback),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.userAvailReport.filterOnChangeCallback),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),Leave.Reports.userAvailReport.setDefaultFilterParams();var dateNavigationDtls={};dateNavigationDtls.mode=Leave.Reports.userAvailReport.reportName,dateNavigationDtls.containerId=Layout.Page.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.navigationCallback=Leave.Reports.userAvailReport.dateNaviCallback,dateNavigationDtls.getDateForCustomNavigationCallback=Leave.Reports.userAvailReport.getDateForCustomNavigation,ZPLite.DateNavigator.init(dateNavigationDtls),ZPLite.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPLite.DateNavigator.TYPE.MONTHLY,"current"),Leave.Reports.userAvailReport.generateReport(),LVUtil.Tab.isResAvail()&&LVUtil.Tab.isNewTabPage()&&Layout.Page.container.find(".lt_nav").find(".nav_rht").hide()}else Leave.Util.showNoPermission()},dateNaviCallback:function(){var filterDiv=Layout.Page.container.find("#filterDiv");filterDiv.find("[name=datePeriodFilter]").find("li.sel").removeClass("sel"),ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"6",text:ZPI18N.getString("zp.custom"),periodType:"custom"}]),filterDiv.find("[name=fromDateFilter]").removeClass("DNI"),filterDiv.find("[name=toDateFilter]").removeClass("DNI");var fVal,tVal,period=ZPLite.DateNavigator.getPeriod(Leave.Reports.userAvailReport.reportName);void 0!==period.from&&void 0!==period.to?(fVal=Calendar.formatDate(period.from),tVal=Calendar.formatDate(period.to)):tVal=fVal=Calendar.formatDate(period.day),filterDiv.find("[name=fromDateFilter]").val(fVal),filterDiv.find("[name=fromDateFilter]").data("selectedDate",Calendar.parseDate(fVal,uidateFormat)),filterDiv.find("[name=fromDateFilter]").data("text",fVal),filterDiv.find("[name=fromDateFilter]").addClass("selected"),filterDiv.find("[name=fromDateFilterText]").text(fVal),filterDiv.find("[name=fromDateFilterText]").val(fVal),filterDiv.find("[name=toDateFilter]").val(tVal),filterDiv.find("[name=toDateFilter]").data("selectedDate",Calendar.parseDate(tVal,uidateFormat)),filterDiv.find("[name=toDateFilter]").data("text",tVal),filterDiv.find("[name=toDateFilter]").addClass("selected"),filterDiv.find("[name=toDateFilterText]").text(tVal),filterDiv.find("[name=toDateFilterText]").val(tVal),Leave.Reports.userAvailReport.generateReport()},getDateForCustomNavigation:function(mode,isNext){var period,container=Layout.Page.container.find("#filterDiv"),selectedPeriod=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]'));if(selectedPeriod&&selectedPeriod.length>0){var fromDate=container.find('[name="fromDateFilter"]').data("selectedDate"),toDate=container.find('[name="toDateFilter"]').data("selectedDate"),isMonth=1==fromDate.getDate()&&toDate.getMonth()==fromDate.getMonth()&&toDate.getDate()==toDate.getDaysOfMonth(),dateDiff=ZPDateTime.getDateDiff(fromDate,toDate);isMonth?isNext?(fromDate=moment(fromDate).add(1,"months")._d,toDate=moment(toDate).add(1,"months").endOf("month")._d):(fromDate=moment(fromDate).subtract(1,"months")._d,toDate=moment(toDate).subtract(1,"months").endOf("month")._d):isNext?(fromDate=moment(fromDate).add(dateDiff,"days")._d,toDate=moment(toDate).add(dateDiff,"days")._d):(fromDate=moment(fromDate).add(-dateDiff,"days")._d,toDate=moment(toDate).add(-dateDiff,"days")._d),period={from:fromDate,to:toDate}}return period},filterOnChangeCallback:function(data){var values,container=Layout.Page.container.find("#filterDiv");if("datePeriod"===data.entity)if(values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),jQuery.isEmptyObject(values)||"6"!==values[0].id)container.find('[name="fromDateFilter"]').addClass("DNI"),container.find('[name="toDateFilter"]').addClass("DNI");else{container.find('[name="fromDateFilter"]').removeClass("DNI"),container.find('[name="toDateFilter"]').removeClass("DNI");var period=ZPLite.DateNavigator.getPeriod(Leave.Reports.userAvailReport.reportName);void 0!==period.from&&void 0!==period.to?(fVal=Calendar.formatDate(period.from),tVal=Calendar.formatDate(period.to)):(fVal=Calendar.formatDate(period.day),tVal=fVal),container.find("[name=fromDateFilter]").val(fVal),container.find("[name=fromDateFilter]").data("selectedDate",Calendar.parseDate(fVal,uidateFormat)),container.find("[name=fromDateFilter]").data("text",fVal),container.find("[name=fromDateFilter]").addClass("selected"),container.find("[name=fromDateFilterText]").text(fVal),container.find("[name=fromDateFilterText]").val(fVal),container.find("[name=toDateFilter]").val(tVal),container.find("[name=toDateFilter]").data("selectedDate",Calendar.parseDate(tVal,uidateFormat)),container.find("[name=toDateFilter]").data("text",tVal),container.find("[name=toDateFilter]").addClass("selected"),container.find("[name=toDateFilterText]").text(tVal),container.find("[name=toDateFilterText]").val(tVal)}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");if(ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"5",text:ZPI18N.getString("zp.tt_thismonth"),periodType:"monthly",tense:"current"}]),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),"teamReports"==ZPLite.Reports.selectedTab&&void 0!=ZPeople.CURR_USER.deptId&&""!=ZPeople.CURR_USER.deptId){var deptViewPerm=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.deptViewPerm,isSetDefVal=!1;if(Leave.Util.isCurPageAdmin()||"0"!=deptViewPerm)isSetDefVal=!0;else{var dept=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.depPermDepartments;if(dept)for(var i=0;i<dept.length;i++)if(dept[i].id==ZPeople.CURR_USER.deptId){isSetDefVal=!0;break}}isSetDefVal&&ZPLite.Filters.setValues(filterDiv.find('[name="departmentFilter"]'),[{id:ZPeople.CURR_USER.deptId+"",text:ZPeople.CURR_USER.deptName+""}])}ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked"),filterDiv.find('[name="fromDateFilter"]').addClass("DNI"),filterDiv.find('[name="toDateFilter"]').addClass("DNI")},getParamsForReport:function(){var values,params={key:"report_department",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv"),datePeriod=ZPLite.DateNavigator.getPeriod(Leave.Reports.userAvailReport.reportName);if(void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(params.from=Calendar.formatDate(datePeriod.from),params.to=Calendar.formatDate(datePeriod.to)):(params.from=Calendar.formatDate(datePeriod.day),params.to=Calendar.formatDate(datePeriod.day))),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),params.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),params.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),params.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),params.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),params.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),params.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="roleFilter"]')))&&values.length>0){var roleId=[];$.each(values,function(index,options){roleId.push(options.id)}),params.role=JSON.stringify(roleId)}if(Leave.organizationTag.fetchParams(filterDiv,params),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus=[];$.each(values,function(index,options){employeeStatus.push(options.id)}),params.employeeStatus=JSON.stringify(employeeStatus),params.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(params.incDateOfExit=!0)}return params.sortType=Leave.Reports.userAvailReport.sortType,params.sIndx=ZPLite.Firescroll.getStartIndex(Leave.Reports.userAvailReport.Firescroll.mode),"myReports"==ZPLite.Reports.selectedTab?params.viewMode=1:"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#leaveUserAvailReport"),Leave.Reports.userAvailReport.Firescroll.mode),layout.find("#leaveUserAvailReport").scrollTop(0),Leave.Reports.Util.removeLoading(),Leave.Reports.Util.appendLoading("leaveUserAvailReport"),layout.find("#leaveUserAvailReport").addClass("DN");var data_table=Layout.Page.container.find("#leaveUserAvailReportTable");data_table.html("");var params=Leave.Reports.userAvailReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(resp){if(resp&&"permissionDenied"===resp.error)Leave.Reports.Util.permDenied();else{if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data;_.isEmpty(data_arr)?Leave.Reports.Util.showHideNoRecord(!0,"leaveUserAvailReport"):(layout.find("#leaveUserAvailReport").show(),data_table.html(""),data_table.append(Leave.Reports.userAvailReport.header(resp.header)),data_table.append(Leave.Reports.userAvailReport.body(data_arr)),Leave.Reports.Util.showHideNoRecord(!1),ZPLite.Firescroll.init(layout.find("#leaveUserAvailReport"),Leave.Reports.userAvailReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.userAvailReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.userAvailReport.Firescroll.mode,data_arr.length))}else Leave.Reports.Util.removeLoading(),Leave.Reports.Util.showHideNoRecord(!0,"leaveUserAvailReport");Leave.Reports.userAvailReport.footer(resp.leavetypes),Leave.Reports.Util.removeLoading()}})},applyFilter:function(){var tense,customDatePeriod,container=Layout.Page.container.find("#filterDiv"),values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),type=values[0].periodType,errorDivs=container.find(".error-clr");if(errorDivs.length>0&&$.each(errorDivs,function(index,errorDiv){$(errorDiv).removeClass("error-clr")}),"6"===values[0].id){var errorMessage,fromDate=container.find('[name="fromDateFilter"]').data("selectedDate"),toDate=container.find('[name="toDateFilter"]').data("selectedDate");if(void 0===fromDate)container.find('[name="fromDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptyfromdate");else if(void 0===toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptytodate");else{if(fromDate>toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.greaterfromdate");else ZPDateTime.getDateDiff(fromDate,toDate)>31&&(container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.datewithindays",[31]))}if(errorMessage)return void ZPeople.Message.showWarningMsg(errorMessage);customDatePeriod={from:fromDate,to:toDate}}else tense=values[0].tense;ZPLite.DateNavigator.setPeriod(Leave.Reports.userAvailReport.reportName,type,tense,!1,customDatePeriod),Leave.Reports.userAvailReport.generateReport()},resetFilter:function(){Leave.Reports.userAvailReport.setDefaultFilterParams()},header:function(header){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead"),common_tr=ZP.create("tr",{class:"ZPLHRow"}),emp_td=ZP.create("th",{class:"colM1_sticky"});emp_td.appendChild(ZP.create("span",{class:"Stxt",style:"padding-left:27px;",text:ZPI18N.getString("zp.employee")}));var sortIconcls="Tclr sort-img S18 ";Leave.Reports.userAvailReport.sortType>=0&&(sortIconcls+=0==Leave.Reports.userAvailReport.sortType?"sort-d":"sort-u"),emp_td.appendChild(ZP.create("i",{class:sortIconcls,id:"EmployeeName",onclick:"Leave.Reports.userAvailReport.toggleSort(this)"})),common_tr.appendChild(emp_td);var ndayofmonth=header.length;for(dt=0;dt<ndayofmonth;dt++){var date=header[dt],date_th=ZP.create("th",{style:"text-align:center",class:"TBrdr"});date_th.appendChild(ZP.create("span",{class:"DB MB3",text:date.fmtDate,style:"min-width:48px;max-width:initial"})),date_th.appendChild(ZP.create("span",{class:"DB dgry ZPreg",text:date.day})),common_tr.appendChild(date_th)}return header_tr.appendChild(common_tr),temp_doc.appendChild(header_tr),temp_doc},body:function(data_arr){var temp_doc=document.createElement("tbody"),day=Calendar.getFirstDayofMonth(this.year,this.month),curDate=(new Date).getDate(),curMonth=ZPDateTime.getMonth((new Date).getMonth());for(var indx in data_arr){var empJson=data_arr[indx],leave_data=empJson.daydetails,ndayofmonth=leave_data.length,row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow");$(row_tr).find('[name="employee"]').css("padding-left","35px"),$(row_tr).find('[name="employee"]').removeClass().addClass("fxdtd P_AM colM1_sticky"),$(row_tr).find('[name="employee"]').find("span").attr("data-container","body");for(var dt=0;dt<ndayofmonth;dt++,day++){var date_detail=leave_data[dt],td=ZP.create("td",{class:"TBrdr"}),color=2==date_detail.ltyp_type?"absent-border":date_detail.color;if(void 0!=date_detail.txt&&""!=date_detail.txt){var fill_span=ZP.create("span",{class:"RPData "+color,text:date_detail.txt,"data-toggle":"tooltip","data-placement":"top",title:date_detail.date_summary}),fill_bar=ZP.create("div",{class:"lvprgs"});Leave.Reports.userAvailReport.getBar(date_detail.sessionDetail,date_detail.dayCount,date_detail.isHour,fill_bar),td.appendChild(fill_span),td.appendChild(fill_bar)}date_detail.isweekend&&td.setAttribute("class","WKend TBrdr"),date_detail.date===curDate&&date_detail.month===curMonth&&td.setAttribute("class","Cl-today TBrdr"),row_tr.appendChild(td)}temp_doc.appendChild(row_tr)}return temp_doc},getBar:function(session_detail,day_count,is_hour,fill_bar){if(1==session_detail.length&&is_hour)fill_bar.appendChild(ZP.create("span",{class:ZP.optValue(session_detail[0],"color","")+" full",style:"width:"+session_detail[0].mins_taken/480*100+"%;left:"+(25*session_detail[0].session-25)+"%"})),fill_bar.className+=" hrs";else if(1==session_detail.length&&1==day_count)fill_bar.appendChild(ZP.create("span",{class:ZP.optValue(session_detail[0],"color","")+" full"}));else{var noofbar=session_detail.length>2||day_count>.5||.25==day_count?4:.5==day_count?4:2,noofsession=session_detail.length,sessions=[];for(i=0;i<noofsession;i++){var leave_detail=session_detail[i];if(leave_detail).5==leave_detail.count&&4==noofbar&&(2==leave_detail.session&&(leave_detail.session=3),sessions.push(leave_detail.session+1),fill_bar.appendChild(ZP.create("span",{class:ZP.optValue(leave_detail,"color","")+" "+Leave.Reports.userAvailReport.getBarClass(noofbar,leave_detail.session+1)}))),sessions.push(leave_detail.session),fill_bar.appendChild(ZP.create("span",{class:ZP.optValue(leave_detail,"color","")+" "+Leave.Reports.userAvailReport.getBarClass(noofbar,leave_detail.session)}))}for(bar_idx=1;bar_idx<=noofbar;bar_idx++)-1==sessions.indexOf(bar_idx)&&fill_bar.appendChild(ZP.create("span",{class:"gry-bg "+Leave.Reports.userAvailReport.getBarClass(noofbar,bar_idx)}))}},getBarClass:function(noofbar,session){var bar_class=4==noofbar?" quarter":"half";switch(session){case 1:bar_class+=" first";break;case 2:bar_class+=" second";break;case 3:bar_class+=" third";break;case 4:bar_class+=" fourth"}return bar_class},footer:function(footer_arr){if($(".footer",Layout.Page.container).hide(),void 0!=footer_arr&&Object.keys(footer_arr).length>0){$(".footer",Layout.Page.container).show();footer_arr.length>6||footer_arr.length;var temp_doc=document.createDocumentFragment(),footer=$("#leaveUserAvailFooter",Layout.Page.container),ltyp_count=0;if(_.each(footer_arr,function(types_arr){for(var noofltyps=types_arr.length,i=0;i<noofltyps&&ltyp_count<8;i++,ltyp_count++){var ltyp_det=types_arr[i],color_class="Dtyps "+(2==ltyp_det.type?"absent-border":"ZPBC"+ltyp_det.color),ltyp=ZP.create("div",{class:color_class,"data-toggle":"tooltip","data-placement":"top",title:ZPeople.decodeTxt(ltyp_det.leavetype_name)});ltyp.appendChild(ZP.create("span",{text:ltyp_det.leavetype_code?ZPeople.decodeTxt(ltyp_det.leavetype_code)+" - "+ZPeople.decodeTxt(ltyp_det.leavetype_name):ZPeople.decodeTxt(ltyp_det.leavetype_name)})),temp_doc.appendChild(ltyp)}}),ltyp_count>7){var more=ZP.create("div",{class:"Dtyps B0I PT3"});more.appendChild(ZP.create("i",{class:"IC-more S21 gry CP FR"})),temp_doc.appendChild(more),more.onclick=function(){Leave.Reports.userAvailReport.leavetypes_detail(footer_arr).modal("show")}}footer.html(""),footer.append(temp_doc)}},leavetypes_detail:function(footer_arr){var modal_cont=ZPeople.BSModal.get({id:Layout.Page.pageId+"_leavetypes_view",type:2,modalClass:"popRgtModel PopSmModel",bodyClass:"ZPRPbody",deleteOnHide:!0}),data_body=$(".modal-body",modal_cont);$(".modal-dialog",modal_cont).addClass("ZPRMpnl"),$(".modal-footer",modal_cont).remove(),$(".modal-header h6",modal_cont).text(ZPI18N.getString("zp.leave.report.leavetypes"));var data_outer=ZP.create("div",{class:"PL20 PR20 tab-content"});return _.each(footer_arr,function(types_arr){_.each(types_arr,function(ltyp_det){var color_class="Dtyps "+(2==ltyp_det.type?"absent-border":"ZPBC"+ltyp_det.color),ltyp=ZP.create("div",{class:color_class,"data-toggle":"tooltip","data-placement":"bottom",title:ZPeople.decodeTxt(ltyp_det.leavetype_name)});ltyp.appendChild(ZP.create("span",{text:ltyp_det.leavetype_code?ZPeople.decodeTxt(ltyp_det.leavetype_code)+" - "+ZPeople.decodeTxt(ltyp_det.leavetype_name):ZPeople.decodeTxt(ltyp_det.leavetype_name)})),data_outer.appendChild(ltyp)})}),data_body.append(data_outer),modal_cont},toggleSort:function(curEle){(curEle=$(curEle)).hasClass("sort-d")?(curEle.addClass("sort-u"),curEle.removeClass("sort-d"),Leave.Reports.userAvailReport.sortType=1):(curEle.addClass("sort-d"),curEle.removeClass("sort-u"),Leave.Reports.userAvailReport.sortType=0),Leave.Reports.userAvailReport.generateReport()},Firescroll:{mode:"USER_AVAIL_REPORT",loadMoreData:function(){var params=Leave.Reports.userAvailReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.userAvailReport.Firescroll.mode,!1),Layout.Page.container.find("#leaveUserAvailReportTable").append(Leave.Reports.userAvailReport.body(response.data)),ZPLite.Firescroll.setFetchedCount(Leave.Reports.userAvailReport.Firescroll.mode,response.data.length)):ZPLite.Firescroll.setFetchedCount(Leave.Reports.userAvailReport.Firescroll.mode,0)})}}},dailyReport:{reportName:"DAILY_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.dailyReport.reportName);var initParams={};initParams.callback=Leave.Reports.dailyReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),Leave.Reports.dailyReport.reg(),Leave.Reports.Filters.clearCache(!0);var filterDiv=Layout.Page.container.find("#filterDiv");filterDiv.find('[name="dateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="dateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="leaveTypeFilter"]'),"leavetype",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.dailyReport.filterOnChangeCallback),Leave.Reports.dailyReport.setDefaultFilterParams(),Leave.Reports.dailyReport.generateReport()},filterOnChangeCallback:function(data){var values,container=Layout.Page.container.find("#filterDiv");if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},setDefaultFilterParams:function(){var date=Calendar.getCurrentDate(!0),filterDiv=Layout.Page.container.find("#filterDiv"),dateFilter=filterDiv.find('[name="dateFilter"]'),name=dateFilter.attr("name");dateFilter.val(date),dateFilter.data("selectedDate",Calendar.parseDate(date,uidateFormat)),dateFilter.data("text",date),dateFilter.addClass("selected"),dateFilter.find('[name="'+name+'Text"]').text(date),dateFilter.find('[name="'+name+'Text"]').val(date),filterDiv.find('[name="leaveTypeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="leaveTypeFilter"]')),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked");var dateNavigationDtls={};dateNavigationDtls.mode=Leave.Reports.dailyReport.reportName,dateNavigationDtls.containerId=Layout.Page.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.navigationCallback=Leave.Reports.dailyReport.dateNaviCallback,ZPLite.DateNavigator.init(dateNavigationDtls),ZPLite.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPLite.DateNavigator.TYPE.DAILY,"current")},dateNaviCallback:function(){var naviDate=Layout.Page.container.find("#dateNavigatorText").text(),dateFilter=Layout.Page.container.find("#filterDiv").find('[name="dateFilter"]'),name=dateFilter.attr("name");dateFilter.val(naviDate),dateFilter.data("selectedDate",Calendar.parseDate(naviDate,uidateFormat)),dateFilter.data("text",naviDate),dateFilter.addClass("selected"),dateFilter.find('[name="'+name+'Text"]').text(naviDate),dateFilter.find('[name="'+name+'Text"]').val(naviDate),Leave.Reports.dailyReport.generateReport()},reg:function(){Layout.Page.container.find(".lt_nav").find(".cus_title").unbind("click").on("click",function(){$(this).removeClass("sel").addClass("sel"),$(this).siblings().removeClass("sel"),Leave.Reports.dailyReport.generateReport()})},getParamsForReport:function(){var params={key:"report_daily",conreqcsr:csrfToken},display_ele=$(".crd",Layout.Page.container.find(".lt_nav"));params.display=display_ele.hasClass("sel")?0:1;var values,filterDiv=Layout.Page.container.find("#filterDiv"),date=filterDiv.find('[name="dateFilter"]').data("selectedDate");if(void 0!==date&&(params.date=Calendar.formatDate(date)),params.sIndx=ZPLite.Firescroll.getStartIndex(Leave.Reports.dailyReport.Firescroll.mode),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="leaveTypeFilter"]')))&&values.length>0){var leaveType=[];$.each(values,function(index,options){leaveType.push(options.id)}),params.leavetype=JSON.stringify(leaveType)}if(isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),params.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),params.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),params.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),params.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),params.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),params.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="roleFilter"]')))&&values.length>0){var roleId=[];$.each(values,function(index,options){roleId.push(options.id)}),params.role=JSON.stringify(roleId)}if(Leave.organizationTag.fetchParams(filterDiv,params),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus=[];$.each(values,function(index,options){employeeStatus.push(options.id)}),params.employeeStatus=JSON.stringify(employeeStatus),params.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(params.incDateOfExit=!0)}return"myReports"==ZPLite.Reports.selectedTab?params.viewMode=1:"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#leaveDailyReport"),Leave.Reports.dailyReport.Firescroll.mode),layout.find("#leaveDailyReport").scrollTop(0),Leave.Reports.Util.removeLoading(),Leave.Reports.Util.appendLoading("leaveDailyReport"),layout.find("#leaveDailyReport").addClass("DNI"),layout.find("#leaveDailyReportChartParent").addClass("DNI"),layout.find(".ZPNdata ").remove();var params=Leave.Reports.dailyReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){response&&"permissionDenied"===response.error?Leave.Reports.Util.permDenied():void 0!==response&&void 0!==response.data&&response.data.length>0?(layout.find("#leaveDailyReport").removeClass("DNI"),layout.find("#leaveDailyReportChartParent").removeClass("DNI"),layout.find("#leaveDailyReportBody").html(""),1==params.display?Leave.Reports.dailyReport.list_html(response):Leave.Reports.dailyReport.chart_html(response),1==params.display&&(ZPLite.Firescroll.init(layout.find("#leaveDailyReport"),Leave.Reports.dailyReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.dailyReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.dailyReport.Firescroll.mode,response.data.length))):(Leave.Reports.Util.removeLoading(),layout.find("#leaveDailyReport").addClass("DNI"),layout.find("#leaveDailyReportChartParent").addClass("DNI"),Leave.Reports.Util.showHideNoRecord(!0,"leaveDailyReport"))})},applyFilter:function(){var customDatePeriod={day:Layout.Page.container.find("#filterDiv").find('[name="dateFilter"]').data("selectedDate")};ZPLite.DateNavigator.setPeriod(Leave.Reports.dailyReport.reportName,ZPLite.DateNavigator.TYPE.DAILY,void 0,!1,customDatePeriod),Leave.Reports.dailyReport.generateReport()},resetFilter:function(){Leave.Reports.dailyReport.setDefaultFilterParams()},list_html:function(resp){if("success"===resp.status){var tempDoc=document.createDocumentFragment(),data_arr=resp.data,data_div=$("#leaveDailyReportTable ",Layout.Page.container);if(data_div.removeClass("DNI"),data_div.siblings("div#leaveDailyReportChartParent").addClass("DNI"),Layout.Page.container.find(".ZPNdata ").remove(),_.isEmpty(data_arr))Leave.Reports.Util.removeLoading(),Layout.Page.container.find("#leaveDailyReport").addClass("DNI"),Leave.Reports.Util.showHideNoRecord(!0,"leaveDailyReport");else{for(indx in data_arr){var ltObj=data_arr[indx],dataTr=ZP.create("tr",{class:"ZPLRow"+(ltObj.emp_disabled?" disabled":"")});dataTr.appendChild(ZP.getEmpTD(ltObj.erecno,ltObj.emp_id,ltObj.emp_name,ltObj.empphoto,!0,ltObj)),dataTr.appendChild(ZP.create("td",{text:ltObj.leave_name})),dataTr.appendChild(ZP.create("td",{text:Leave.Type.text(ltObj.leave_type)})),dataTr.appendChild(ZP.create("td",{text:ltObj.reason})),dataTr.appendChild(ZP.create("td",{text:ltObj.approval_disp})),tempDoc.appendChild(dataTr)}$("tbody",data_div).append(tempDoc),Leave.Reports.Util.showHideNoRecord(!1)}}Leave.Reports.Util.removeLoading()},chart_html:function(resp){if("success"===resp.status){var count_arr=resp.data,chart_parent=$("#leaveDailyReportChartParent",Layout.Page.container);if(chart_parent.removeClass("DNI"),chart_parent.siblings("#leaveDailyReportTable").addClass("DNI"),_.isEmpty(count_arr))return chart_parent.addClass("DNI"),Leave.Reports.Util.showHideNoRecord(!0,"leaveDailyReport"),void Leave.Reports.Util.removeLoading();Leave.Reports.Util.showHideNoRecord(!1);var chart_data=[],chart_div=$("#leaveDailyReportChart",chart_parent).show(),details=$(".HcrtRT",chart_parent),temp_doc=document.createDocumentFragment();for(var indx in count_arr){var count_json=count_arr[indx],color=ZP.optValue(Leave.Util.color3_0,count_json.leavetype_color,count_json.leavetype_color),li_doc=ZP.create("li");li_doc.appendChild(ZP.create("div",{style:"margin-top:2px;background-color:"+color,class:"RTC1"})),li_doc.appendChild(ZP.create("desc",{text:count_json.leavetype_name,class:"CP",id:count_json.leavetype_id})),li_doc.appendChild(ZP.create("span",{text:count_json.noofusers})),temp_doc.appendChild(li_doc),chart_data.push({y:count_json.noofusers,name:ZPeople.escapeHtml(count_json.leavetype_name),color:color})}var detailsul=$("ul",details);detailsul.html(""),detailsul.append(temp_doc),chart_div.highcharts({chart:{type:"pie",plotShadow:!1,spacingBottom:10,spacingTop:10,spacingLeft:30,spacingRight:10,width:460,height:400},credits:{enabled:!1},title:{text:ZPI18N.getString("zp.dayscomparison"),align:"left",style:{color:"black",fontWeight:"bold"}},tooltip:{percentageDecimals:2,pointFormat:"{point.name} ,<b>{point.percentage:.2f}%</b>"},legend:{enabled:!1},exporting:{enabled:!1,filename:"Leave Daily Report"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:30,dataLabels:{enabled:!0,formatter:function(){var name=this.point.name;return name.length>40&&(name=name.substring(0,40)+"..."),name+","+this.point.y},style:{fontWeight:"normal",fontSize:"12px",fontFamily:"Verdana, sans-serif",color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{data:chart_data,startAngle:225}]})}detailsul.on("click","li",function(){ZPLite.Filters.setValues(Layout.Page.container.find('[name="leaveTypeFilter"]'),[{id:$(this).find("desc").attr("id")+"",text:ZPeople.escapeHtml($(this).find("desc").text())}]),Layout.Page.container.find(".lt_nav .lst").click(),Layout.Page.container.find(".lt_nav").find("#filterIcon").click()}),Leave.Reports.Util.removeLoading()},Firescroll:{mode:"DAILY_REPORT",loadMoreData:function(){var params=Leave.Reports.dailyReport.getParamsForReport();0!=params.display&&ZPeople.Request.send(Leave.Reports.url,params,function(response){void 0!==response&&void 0!==response.data&&response.data.length>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.dailyReport.Firescroll.mode,!1),Leave.Reports.dailyReport.list_html(response),ZPLite.Firescroll.setFetchedCount(Leave.Reports.dailyReport.Firescroll.mode,response.data.length)):ZPLite.Firescroll.setFetchedCount(Leave.Reports.dailyReport.Firescroll.mode,0)})}}},balanceReport:{reportName:"BALANCE_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.balanceReport.reportName);var initParams={};initParams.callback=Leave.Reports.balanceReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),Leave.Reports.balanceReport.reg(),Leave.Reports.balanceReport.showHideFilter();var filterDiv=Layout.Page.container.find("#filterDiv");Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="datePeriodFilter"]'),"datePeriod",!0,Leave.Reports.balanceReport.filterOnChangeCallback),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="typeofLeaveFilter"]'),"typeofLeave",!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="leaveTypeFilter"]'),"leavetype",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Leave.Reports.balanceReport.filterOnChangeCallback,"LEAVE_BALANCE_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.balanceReport.filterOnChangeCallback),Leave.Reports.balanceReport.setDefaultFilterParams(),Leave.Reports.balanceReport.generateReport()},reg:function(){Layout.Page.container.find(".lt_nav").find(".ZP-SwitchUnit").unbind("click").on("click",function(){$(this).removeClass("active").addClass("active"),$(this).siblings().removeClass("active"),Leave.Reports.balanceReport.generateReport()})},showHideFilter:function(){var filterDiv=Layout.Page.container.find("#filterDiv");"myReports"==ZPLite.Reports.selectedTab?(filterDiv.find('[name="employeeFilter"]').addClass("DNI"),filterDiv.find('[name="incDReportsOnly"]').addClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').addClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').addClass("DNI"),filterDiv.find('[name="divisionFilter"]').addClass("DNI"),filterDiv.find('[name="departmentFilter"]').addClass("DNI"),filterDiv.find('[name="designationFilter"]').addClass("DNI"),filterDiv.find('[name="locationFilter"]').addClass("DNI"),filterDiv.find('[name="roleFilter"]').addClass("DNI"),filterDiv.find('[name="orgTagFilter"]').addClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').addClass("DNI"),filterDiv.find('[name="incDateOfExit"]').addClass("DNI")):(filterDiv.find('[name="employeeFilter"]').removeClass("DNI"),filterDiv.find('[name="incDReportsOnly"]').removeClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').removeClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').removeClass("DNI"),filterDiv.find('[name="divisionFilter"]').removeClass("DNI"),filterDiv.find('[name="departmentFilter"]').removeClass("DNI"),filterDiv.find('[name="designationFilter"]').removeClass("DNI"),filterDiv.find('[name="locationFilter"]').removeClass("DNI"),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').removeClass("DNI"),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').removeClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"))},filterOnChangeCallback:function(data){var values,container=Layout.Page.container.find("#filterDiv");if("datePeriod"===data.entity||"location"===data.entity){if(values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),container.find('[name="fromDateFilter"]').addClass("disabled"),container.find('[name="toDateFilter"]').addClass("disabled"),!jQuery.isEmptyObject(values)){var date;switch(values[0].id){case"0":date=ZPLite.Reports.Filters.getPeriod(0);break;case"1":date=ZPLite.Reports.Filters.getPeriod(1);break;case"2":date=ZPLite.Reports.Filters.getPeriod(30);break;case"3":date=ZPLite.Reports.Filters.getPeriod(31);break;case"4":date=ZPLite.Reports.Filters.getPeriod(765);break;case"5":date=ZPLite.Reports.Filters.getPeriod(766);break;case"6":container.find('[name="fromDateFilter"]').removeClass("disabled"),container.find('[name="toDateFilter"]').removeClass("disabled"),date=ZPLite.Reports.Filters.getPeriod(766)}date&&Leave.Reports.Filters.setFromToDateFilter(date.from,date.to)}}else if("employee"==data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'));var dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"5",text:ZPI18N.getString("zp.thisyear")}]),filterDiv.find('[name="fromDateFilter"]').addClass("disabled"),filterDiv.find('[name="toDateFilter"]').addClass("disabled");var curPeriod=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period;Leave.Reports.Filters.setFromToDateFilter(curPeriod.year_start,curPeriod.year_end),Layout.Page.container.find("#filterDiv").find('[name="datePeriodFilter"]').find(".optionsList li[id=5] a").trigger("click"),ZPLite.Filters.setValues(filterDiv.find('[name="typeofLeaveFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),filterDiv.find('[name="leaveTypeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="leaveTypeFilter"]')),filterDiv.find('[name="employeeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="incDReportsOnly"]').find("input").prop("checked",!1),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),"myReports"!=ZPLite.Reports.selectedTab&&filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked")},getParamsForReport:function(){var params={key:"report_balance",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv");params.from=filterDiv.find('[name="fromDateFilter"]').val(),params.to=filterDiv.find('[name="toDateFilter"]').val();var values=ZPLite.Filters.getValues(filterDiv.find('[name="typeofLeaveFilter"]'));if(values&&values.length>0&&(params.typeofleave=values[0].id),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="leaveTypeFilter"]')))&&values.length>0){var leavetype=[];$.each(values,function(index,options){leavetype.push(options.id)}),params.leavetype=JSON.stringify(leavetype)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var erecNo=[];$.each(values,function(index,options){erecNo.push(options.id)}),params.employee=JSON.stringify(erecNo)}if(params.incDReportsOnly=filterDiv.find("[name=incDReportsOnly]").find("input").is(":checked"),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),params.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),params.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),params.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),params.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),params.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),params.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="roleFilter"]')))&&values.length>0){var roleId=[];$.each(values,function(index,options){roleId.push(options.id)}),params.role=JSON.stringify(roleId)}if(Leave.organizationTag.fetchParams(filterDiv,params),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus=[];$.each(values,function(index,options){employeeStatus.push(options.id)}),params.employeeStatus=JSON.stringify(employeeStatus),params.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(params.incDateOfExit=!0)}return params.leaveunit=Layout.Page.container.find(".lt_nav").find("div[name=switchUnit]").find("li.active").attr("value"),params.sIndx=ZPLite.Firescroll.getStartIndex(Leave.Reports.balanceReport.Firescroll.mode),"myReports"==ZPLite.Reports.selectedTab?params.viewMode=1:"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#leaveBalanceReport"),Leave.Reports.balanceReport.Firescroll.mode),layout.find("#leaveBalanceReport").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leaveBalanceReport")),layout.find("#leaveBalanceReport").addClass("DN");var params=Leave.Reports.balanceReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url2,params,function(response){response&&"permissionDenied"===response.error?Leave.Reports.Util.permDenied():(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==response&&"success"==response.status&&void 0!==response.data&&_.size(response.data)>0?(layout.find("#leaveBalanceReport").removeClass("DN"),Leave.Reports.balanceReport.html(response),ZPLite.Firescroll.init(Layout.Page.container.find("#leaveBalanceReport"),Leave.Reports.balanceReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.balanceReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.balanceReport.Firescroll.mode,_.size(response.data))):(layout.find("#leaveBalanceReport").addClass("DN"),Leave.Reports.Util.showHideNoRecord(!0,"leaveBalanceReport")))},{},Leave.Reports.showReportErrorMsg)},applyFilter:function(){Leave.Reports.Filters.validateFilterParams()&&Leave.Reports.balanceReport.generateReport()},resetFilter:function(){Leave.Reports.balanceReport.setDefaultFilterParams()},html:function(resp){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#leaveBalanceReportTable",Layout.Page.container),prop={},tbody=data_table.children("tbody");if(resp.hasOwnProperty("header")){var header_arr=resp.header;_.isEmpty(header_arr)||_.isEmpty(data_arr)?(Layout.Page.container.find("#leaveBalanceReport").addClass("DN"),Leave.Reports.Util.showHideNoRecord(!0,"leaveBalanceReport")):(data_table.html(""),prop.total_tdata=2*Leave.Report.getTDcount(header_arr,!0),prop.td_width=($(".table_responsive",Layout.Page.container).width()-328)/prop.total_tdata,prop.td_width=prop.td_width>120?prop.td_width:120,data_table.append(Leave.Reports.balanceReport.header(header_arr,prop)),Leave.Reports.Util.showHideNoRecord(!1,"leaveBalanceReport"))}if(!_.isEmpty(data_arr)){var header=$("#leaveBalanceReportTable thead",Layout.Page.container);prop.td_width=header.data("td_width"),prop.leavetypes=header.data("leavetypes"),prop.employees=resp.employees,(tbody=data_table.children("tbody")).append(Leave.Reports.balanceReport.body(data_arr,prop)),tbody.fadeIn(150)}tbody&&!tbody.data("isreg")&&(tbody.on("click","tr.ZPLRow:not(.disabled)",function(){Leave.Reports.userReport.employee=$(this).data("employee"),"myReports"==ZPLite.Reports.selectedTab?window.location.href="#reports/my/leave/user":"teamReports"==ZPLite.Reports.selectedTab?window.location.href="#reports/team/leave/user":"adminReports"==ZPLite.Reports.selectedTab&&(window.location.href="#reports/admin/leave/user")}),tbody.data("isreg",!0)),Leave.Reports.Util.removeLoading()},header:function(arr,prop){var temp_doc=document.createDocumentFragment(),th_width=prop.td_width,header_tr=ZP.create("thead",{class:"TB_fxd"}),common_tr=ZP.create("tr",{class:"ZPLHRow"}),emp_td=ZP.create("th",{text:ZPI18N.getString("zp.employee"),class:"colM1_sticky"});for(var indx in common_tr.appendChild(emp_td),arr){var ltypeth=ZP.create("th",{class:"P0I TBrdr TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),leavetypes=arr[indx],noofltyps=leavetypes.length;$(tbody).append('<tr><th class="text-center B1" colspan="'+2*(noofltyps+1)+'"><div class="ellipsis Mauto" data-toggle="tooltip" data-placement="bottom" title="'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+'">'+ZSEC.Encoder.encodeForHTML(Leave.Type.text(indx))+"</div></th></tr>");var ltypeheadtr=ZP.create("tr"),entityTr=ZP.create("tr"),elwidth=noofltyps>1?100/(2*(noofltyps+1)):100/(2*noofltyps);for(var id in leavetypes){var header,ljson=leavetypes[id];(header=ZP.create("th",{colspan:"2",class:"text-center B1",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px; !important","data-toggle":"tooltip","data-placement":"bottom",title:ZPeople.decodeTxt(ljson.leavetype_name),text:ZPeople.decodeTxt(ljson.leavetype_name)})),ltypeheadtr.appendChild(header),entityTr.appendChild(this.entityHeader(th_width,elwidth,0)),entityTr.appendChild(this.entityHeader(th_width,elwidth,1))}if(noofltyps>1)(header=ZP.create("th",{colspan:"2",class:"text-center B1",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px; !important","data-toggle":"tooltip","data-placement":"bottom",title:ZPI18N.getString("zp.total"),text:ZPI18N.getString("zp.total")})),ltypeheadtr.appendChild(header),entityTr.appendChild(this.entityHeader(th_width,elwidth,0)),entityTr.appendChild(this.entityHeader(th_width,elwidth,1));tbody.appendChild(ltypeheadtr),tbody.appendChild(entityTr),table.appendChild(tbody),ltypeth.appendChild(table),common_tr.appendChild(ltypeth)}return header_tr.appendChild(common_tr),$(header_tr).data("leavetypes",arr),$(header_tr).data("td_width",th_width),temp_doc.appendChild(header_tr),temp_doc.appendChild(ZP.create("tbody",{style:"display:none"})),temp_doc},entityHeader:function(td_width,width,type){var text=0==type?ZPI18N.getString("zp.leave.view.booked"):ZPI18N.getString("zp.leave.view.balance"),header=ZP.create("th",{class:"text-center",width:width+"%"});return header.appendChild(ZP.create("div",{class:"",style:"width:"+td_width+"px","data-toggle":"tooltip","data-placement":"top",title:text,text:text})),header},body:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),lt_arr=prop.leavetypes,td_width=parseInt(prop.td_width);return prop.employees.forEach(function(erecno){var empJson=data_arr[erecno],employee=empJson.employee,row_tr=ZP.getEmpRow(employee,"Report_row ZPLRow CP");for(var indx in $(row_tr).find('[name="employee"]').removeClass().addClass("fxdtd P_AM colM1_sticky"),$(row_tr).find('[name="employee"]').find("span").attr("data-container","body"),lt_arr){var ltypetd=ZP.create("td",{class:"P0I TBrdr TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),ltypeheadtr=ZP.create("tr"),ltypes=lt_arr[indx],noofltyps=$(ltypes).length,elwidth=noofltyps>1?100/(2*(noofltyps+1)):100/(2*noofltyps);for(var idx in ltypes){var obj=empJson[ltypes[idx].leavetype_id],booked=obj?isNaN(obj.booked)?"0":obj.booked:"N/A",balance=obj?isNaN(obj.balance)?"0":obj.balance:"N/A",bookedTD=ZP.create("td",{class:"text-center",width:elwidth+"%",style:"text-align:center;height:55px"}),balanceTD=ZP.create("td",{class:"text-center",width:elwidth+"%",style:"text-align:center;height:55px"});bookedTD.appendChild(ZP.create("div",{text:booked,style:"width:"+td_width+"px"})),balanceTD.appendChild(ZP.create("div",{text:balance,style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(bookedTD),ltypeheadtr.appendChild(balanceTD)}if(noofltyps>1){var type="paid";switch(indx){case"1":type="onduty";break;case"2":case"3":type="unpaid";break;case"4":type="compoff";break;case"5":type="rh"}var totals=empJson.totals;bookedTD=ZP.create("td",{class:"text-center",width:elwidth+"%",style:"text-align:center;height:55px"}),balanceTD=ZP.create("td",{class:"text-center",width:elwidth+"%",style:"text-align:center;height:55px"});bookedTD.appendChild(ZP.create("div",{text:totals[type+"Booked"],style:"width:"+td_width+"px"})),balanceTD.appendChild(ZP.create("div",{text:totals[type+"Balance"],style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(bookedTD),ltypeheadtr.appendChild(balanceTD)}tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypetd.appendChild(table),row_tr.appendChild(ltypetd),$(row_tr).data("employee",employee.erecno)}temp_doc.appendChild(row_tr)}),temp_doc},Firescroll:{mode:"BALANCE_REPORT",loadMoreData:function(){var params=Leave.Reports.balanceReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url2,params,function(response){void 0!==response&&"success"==response.status&&void 0!==response.data&&_.size(response.data)>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.balanceReport.Firescroll.mode,!1),Leave.Reports.balanceReport.html(response),ZPLite.Firescroll.setFetchedCount(Leave.Reports.balanceReport.Firescroll.mode,_.size(response.data))):ZPLite.Firescroll.setFetchedCount(Leave.Reports.balanceReport.Firescroll.mode,0)})}}},summaryReport:{reportName:"SUMMARY_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.summaryReport.reportName);var initParams={};initParams.callback=Leave.Reports.summaryReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker");void 0==ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leavetype?$.ajax({url:"/lite_reports/getFilterData",type:"POST",async:!1,data:{entity:"ltLeaveType",conreqcsr:csrfToken},success:function(resp){if(null!=resp.ltLeaveType&&resp.ltLeaveType.length>0){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,leaveType=[];$.each(resp.ltLeaveType,function(index,data){leaveType.push(data)}),moduleData.leavetype=leaveType,Leave.Reports.summaryReport.initReport()}else Leave.Reports.Util.showHideNoRecord(!0,"leaveSummaryReport")}}):Leave.Reports.summaryReport.initReport()},initReport:function(){Leave.Reports.Util.showHideNoRecord(!0,"leaveSummaryReport");var filterDiv=Layout.Page.container.find("#filterDiv");Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="datePeriodFilter"]'),"datePeriod",!0,Leave.Reports.summaryReport.filterOnChangeCallback),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),Leave.Reports.Filters.constructFilter(Layout.Page.container.find('[name="leaveTypeFilter"]'),"leavetype",!0,Leave.Reports.summaryReport.filterOnChangeCallback),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Leave.Reports.summaryReport.filterOnChangeCallback,"LEAVE_SUMMARY_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.summaryReport.filterOnChangeCallback),Leave.Reports.summaryReport.setDefaultFilterParams(!0),Leave.Reports.summaryReport.generateReport()},setDefaultFilterParams:function(isLTReset){var filterDiv=Layout.Page.container.find("#filterDiv");ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"5",text:ZPI18N.getString("zp.thisyear")}]),filterDiv.find('[name="fromDateFilter"]').addClass("disabled"),filterDiv.find('[name="toDateFilter"]').addClass("disabled");var curPeriod=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period;if(Leave.Reports.Filters.setFromToDateFilter(curPeriod.year_start,curPeriod.year_end),Layout.Page.container.find("#filterDiv").find('[name="datePeriodFilter"]').find(".optionsList li[id=5] a").trigger("click"),isLTReset){var leavetypes=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leavetype;if(void 0!=leavetypes&&leavetypes.length>0)for(var i=0;i<leavetypes.length;i++)if("4"!=leavetypes[i].type&&"2"!=leavetypes[i].type&&!leavetypes[i].isDisabled){ZPLite.Filters.setValues(Layout.Page.container.find('[name="leaveTypeFilter"]'),[{id:leavetypes[i].id,text:leavetypes[i].name}]);break}}filterDiv.find('[name="employeeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="incDReportsOnly"]').find("input").prop("checked",!1),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked")},filterOnChangeCallback:function(data){var values,container=Layout.Page.container.find("#filterDiv");if("datePeriod"===data.entity||"location"===data.entity){if(values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),container.find('[name="fromDateFilter"]').addClass("disabled"),container.find('[name="toDateFilter"]').addClass("disabled"),!jQuery.isEmptyObject(values)){var date;switch(values[0].id){case"0":date=ZPLite.Reports.Filters.getPeriod(0);break;case"1":date=ZPLite.Reports.Filters.getPeriod(1);break;case"2":date=ZPLite.Reports.Filters.getPeriod(30);break;case"3":date=ZPLite.Reports.Filters.getPeriod(31);break;case"4":date=ZPLite.Reports.Filters.getPeriod(765);break;case"5":date=ZPLite.Reports.Filters.getPeriod(766);break;case"6":container.find('[name="fromDateFilter"]').removeClass("disabled"),container.find('[name="toDateFilter"]').removeClass("disabled")}date&&Leave.Reports.Filters.setFromToDateFilter(date.from,date.to)}}else if("employee"==data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'));var dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("leavetype"==data.entity)Leave.Reports.summaryReport.generateReport();else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},getParamsForReport:function(){var params={key:"report_summary",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv"),values=ZPLite.Filters.getValues(Layout.Page.container.find('[name="leaveTypeFilter"]'));if(void 0!==values&&values.length>0?params.leavetype=values[0].id:params.leavetype=0,params.from=filterDiv.find('[name="fromDateFilter"]').val(),params.to=filterDiv.find('[name="toDateFilter"]').val(),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var erecNo=[];$.each(values,function(index,options){erecNo.push(options.id)}),params.employee=JSON.stringify(erecNo)}if(params.incDReportsOnly=filterDiv.find("[name=incDReportsOnly]").find("input").is(":checked"),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),params.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),params.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),params.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),params.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),params.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),params.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="roleFilter"]')))&&values.length>0){var roleId=[];$.each(values,function(index,options){roleId.push(options.id)}),params.role=JSON.stringify(roleId)}if(Leave.organizationTag.fetchParams(filterDiv,params),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus=[];$.each(values,function(index,options){employeeStatus.push(options.id)}),params.employeeStatus=JSON.stringify(employeeStatus),params.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(params.incDateOfExit=!0)}return params.sIndx=ZPLite.Firescroll.getStartIndex(Leave.Reports.summaryReport.Firescroll.mode),"myReports"==ZPLite.Reports.selectedTab?params.viewMode=1:"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container,formName=ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.formDisplayName)+" ";ZPLite.Firescroll.reset(layout.find("#leaveSummaryReport"),Leave.Reports.summaryReport.Firescroll.mode),layout.find("#leaveSummaryReport").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leaveSummaryReport")),layout.find("#leaveSummaryReport").addClass("DN"),layout.find('[name="leaveTypeFilter"]').parent().removeClass("DNI"),layout.find('[name="leaveTypeFilter"]').parent().parent().find(".ln").removeClass("DNI");var params=Leave.Reports.summaryReport.getParamsForReport();ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leavetype.length>0?ZPeople.Request.send(Leave.Reports.url2,params,function(response){if(response&&"permissionDenied"===response.error)Leave.Reports.Util.permDenied();else if(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0){layout.find("#leaveSummaryReport").removeClass("DN");var unitMsg=response.isDayLT?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.leavetype.hour.plural");layout.find("#noOfEncash").text(ZPI18N.getString("zp.leave.noofencash",[unitMsg,formName])),layout.find("#leaveSummaryReportTable tbody").html("").append(Leave.Reports.summaryReport.html(response)),ZPLite.Firescroll.init(layout.find("#leaveSummaryReport"),Leave.Reports.summaryReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.summaryReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.summaryReport.Firescroll.mode,response.data.length)}else Leave.Reports.Util.showHideNoRecord(!0,"leaveSummaryReport")},{},Leave.Reports.showReportErrorMsg):(Leave.Reports.Util.showHideNoRecord(!0,"leaveSummaryReport"),layout.find('[name="leaveTypeFilter"]').parent().addClass("DNI"),layout.find('[name="leaveTypeFilter"]').parent().parent().find(".ln").addClass("DNI"),layout.find("#zp_page_loading").remove())},applyFilter:function(){Leave.Reports.Filters.validateFilterParams()&&Leave.Reports.summaryReport.generateReport()},resetFilter:function(){Leave.Reports.summaryReport.setDefaultFilterParams(!1)},html:function(resp){var tempDoc=document.createDocumentFragment(),data_arr=resp.data;if(Layout.Page.container.find("#leaveSummaryReportTable tbody").siblings("thead").find("th:nth-child(6)").css("display",resp.isEncashNeeded?"":"none"),!_.isEmpty(data_arr)){for(indx in data_arr){var empJson=data_arr[indx],dataTr=ZP.getEmpRow(empJson,"ZPLRow Report_row");$(dataTr).find('[name="employee"]').css("padding-left","35px"),$(dataTr).find('[name="employee"]').removeClass().addClass("fxdtd P_AM colM1_sticky"),$(dataTr).find('[name="employee"]').find("span").attr("data-container","body"),dataTr.appendChild(ZP.create("td",{class:"TBrdr TBrdr-Rgt",text:empJson.notapplicable?"N/A":empJson.openBalance?empJson.openBalance:"0"})),dataTr.appendChild(ZP.create("td",{class:"TBrdr-Rgt",text:empJson.notapplicable?"N/A":empJson.granted?empJson.granted:"0"})),dataTr.appendChild(ZP.create("td",{class:"TBrdr-Rgt",text:empJson.notapplicable?"N/A":empJson.availed?empJson.availed:"0"})),dataTr.appendChild(ZP.create("td",{class:"TBrdr-Rgt",text:empJson.notapplicable?"N/A":empJson.curBalance?empJson.curBalance:"0"})),dataTr.appendChild(ZP.create("td",{class:"TBrdr-Rgt",text:empJson.notapplicable?"N/A":empJson.encashed?empJson.encashed:"0",style:resp.isEncashNeeded?"":"display:none"})),dataTr.appendChild(ZP.create("td",{class:"TBrdr-Rgt",text:empJson.notapplicable?"N/A":empJson.lapsed?empJson.lapsed:"0"})),tempDoc.appendChild(dataTr)}Leave.Reports.Util.showHideNoRecord(!1,"leaveSummaryReport")}return Leave.Reports.Util.removeLoading(),tempDoc},Firescroll:{mode:"SUMMARY_REPORT",loadMoreData:function(){var params=Leave.Reports.summaryReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url2,params,function(response){void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.summaryReport.Firescroll.mode,!1),Layout.Page.container.find("#leaveSummaryReportTable tbody").append(Leave.Reports.summaryReport.html(response)),ZPLite.Firescroll.setFetchedCount(Leave.Reports.summaryReport.Firescroll.mode,response.data.length)):ZPLite.Firescroll.setFetchedCount(Leave.Reports.summaryReport.Firescroll.mode,0)})}}},lopReport:{reportName:"LOP_REPORT",validate_period:!0,reportFreeze:6,configuration:'<a target="_blank" href="#leavetracker/payperiod/settings"><button class="btn btn-primary">'+ZPI18N.getString("zp.config")+"</button></a>",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.lopReport.reportName);var initParams={};initParams.callback=Leave.Reports.lopReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),void 0==ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod?$.ajax({url:"leave_common_action.zp",type:"POST",async:!1,data:{key:"init_page",topics:"PAYPERIOD",conreqcsr:csrfToken},success:function(resp){if("success"===resp.status){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;$.each(resp.data,function(key,obj){"payPeriod"==key&&_.each(obj,function(pp){pp.rsName=decodeHTML(pp.rsName)}),moduleData[key]=obj}),Leave.Reports.lopReport.initReport()}else Leave.Reports.Util.showHideNoRecord(!0,"leaveLOPReport")}}):Leave.Reports.lopReport.initReport()},initReport:function(){Leave.Reports.lopReport.reg(),Leave.Reports.Util.showHideNoRecord(!0,"leaveLOPReport");var filterDiv=Layout.Page.container.find("#filterDiv");Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(Layout.Page.container.find('[name="payPeriodFilter"]'),"payPeriod",!0,Leave.Reports.lopReport.filterOnChangeCallback),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Leave.Reports.lopReport.filterOnChangeCallback,"LEAVE_LOP_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"ppLocation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"ppRole",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.lopReport.filterOnChangeCallback),Leave.Reports.lopReport.setDefaultFilterParams(!0),Leave.Reports.lopReport.generateReport()},reg:function(){var layout=Layout.Page.container;layout.find(".lt_nav").find(".ZP-SwitchUnit").unbind("click").on("click",function(){$(this).removeClass("active").addClass("active"),$(this).siblings().removeClass("active"),Leave.Reports.lopReport.generateReport()}),layout.find(".lopPrev").unbind("click").on("click",function(){Leave.Reports.Util.navPayPeriod(layout.find(".lopPager"),-1)}),layout.find(".lopNext").unbind("click").on("click",function(){Leave.Reports.Util.navPayPeriod(layout.find(".lopPager"),1)}),Leave.Util.isCurPageAdmin()&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowImport||layout.find(".CR-imprt").parent().remove()},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("payPeriod"===data.entity)Leave.Reports.lopReport.validate_period=!0,Leave.Reports.Util.loadPayPeriod(),Leave.Reports.Filters.clearCache(!1,"employee"),ZPLite.Filters.clearValues(container.find('[name="employeeFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="employeeFilter"]')),ZPLite.Filters.clearValues(container.find('[name="locationFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="locationFilter"]')),Leave.Reports.lopReport.generateReport();else if("employee"===data.entity){var values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]')),dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},setDefaultFilterParams:function(isInitPPData){var filterDiv=Layout.Page.container.find("#filterDiv"),ppFilObj=Layout.Page.container.find(".nav_rht");if(isInitPPData&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod.length>0){var ppDet=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod[0];ZPLite.Filters.setValues(ppFilObj.find('[name="payPeriodFilter"]'),[{id:ppDet.rsID+"",text:ZPeople.escapeHtml(ppDet.rsName)}]),Leave.Reports.Util.loadPayPeriod()}filterDiv.find('[name="employeeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="incDReportsOnly"]').find("input").prop("checked",!1),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked")},getParamsForReport:function(){var values,params={key:"report_lop",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv"),leaveFilter={};if(void 0!==(values=ZPLite.Filters.getValues(Layout.Page.container.find(".nav_rht").find('[name="payPeriodFilter"]')))&&values.length>0&&(leaveFilter.org_report_setting=values[0].id),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var erecNo=[];$.each(values,function(index,options){erecNo.push(options.id)}),leaveFilter.employee=JSON.stringify(erecNo)}if(leaveFilter.incDReportsOnly=filterDiv.find("[name=incDReportsOnly]").find("input").is(":checked"),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),leaveFilter.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),leaveFilter.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),leaveFilter.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),leaveFilter.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),leaveFilter.designation=JSON.stringify(designationId)}if(Leave.organizationTag.fetchParams(filterDiv,leaveFilter),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),leaveFilter.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="roleFilter"]')))&&values.length>0){var roleId=[];$.each(values,function(index,options){roleId.push(options.id)}),leaveFilter.role=JSON.stringify(roleId)}var employeeStatus=[];void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0?($.each(values,function(index,options){employeeStatus.push(options.id)}),leaveFilter.employeeStatus=JSON.stringify(employeeStatus)):leaveFilter.employeeStatus=employeeStatus,leaveFilter.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(leaveFilter.incDateOfExit=!0);var filterpayperiod=$(".lopPager",Layout.Page.container).data("payperiod");return filterpayperiod&&(leaveFilter.from=Calendar.formatDate(filterpayperiod.start),leaveFilter.to=Calendar.formatDate(filterpayperiod.end)),leaveFilter.leaveunit=Layout.Page.container.find(".lt_nav").find("div[name=switchUnit]").find("li.active").attr("value"),leaveFilter.sIndx=ZPLite.Firescroll.getStartIndex(Leave.Reports.lopReport.Firescroll.mode),params.leaveFilter=JSON.stringify(leaveFilter),"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params.repType=ZPLite.Reports.selectedTab,params},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("payPeriod"===data.entity)Leave.Reports.lopReport.validate_period=!0,Leave.Reports.Util.loadPayPeriod(),Leave.Reports.Filters.clearCache(!1,"employee"),ZPLite.Filters.clearValues(container.find('[name="employeeFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="employeeFilter"]')),ZPLite.Filters.clearValues(container.find('[name="locationFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="locationFilter"]')),ZPLite.Filters.clearValues(container.find('[name="roleFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="roleFilter"]')),Leave.Reports.lopReport.generateReport();else if("employee"===data.entity){var values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]')),dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#leaveLOPReport"),Leave.Reports.lopReport.Firescroll.mode),layout.find("#leaveLOPReport").scrollTop(0),layout.find(".ZPNdata ").fadeOut(100).remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leaveLOPReport")),layout.find("#leaveLOPReport").addClass("DN"),layout.find('[name="payPeriodFilter"]').parent().removeClass("DNI"),layout.find('[name="payPeriodFilter"]').parent().parent().find(".ln").removeClass("DNI"),layout.find("#lopFooter").removeClass("DNI"),layout.find(".lopPager").removeClass("DNI");var payperiod=$(".lopPager",Layout.Page.container).data("payperiod");if("object"==typeof payperiod){var params=Leave.Reports.lopReport.getParamsForReport();!Leave.Reports.lopReport.validateGET(payperiod.conf,params.location)||Leave.Reports.lopReport.validate_period&&!Leave.Reports.lopReport.validatePeriod()?Leave.Reports.Util.checkPermDenied("lop"):(params.get_show_generate_lop=!payperiod.conf.hasOwnProperty("show_generate"),ZPeople.Request.send(Leave.Reports.url,params,function(resp){resp&&"permissionDenied"===resp.error?Leave.Reports.Util.permDenied():(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin?layout.find("#ZP-Regenerate").show():layout.find("#ZP-Regenerate").hide(),void 0!==resp&&"success"==resp.status?(params.get_show_generate_lop&&(payperiod.conf.show_generate=resp.show_generate_lop),void 0!==resp.data&&resp.data.length>0?(layout.find("#leaveLOPReport").removeClass("DN"),layout.find(".ZPNdata ").fadeOut(100).remove(),Leave.Reports.lopReport.html(resp),ZPLite.Firescroll.init(layout.find("#leaveLOPReport"),Leave.Reports.lopReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.lopReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.lopReport.Firescroll.mode,resp.data.length)):(layout.find("#leaveLOPReport").addClass("DN"),Leave.Reports.Util.showHideNoRecord(!0,"leaveLOPReport"))):(layout.find("#leaveLOPReport").addClass("DN"),Leave.Reports.Util.showHideNoRecord(!0,"leaveLOPReport")))},{},Leave.Reports.showReportErrorMsg)),Leave.Reports.lopReport.showFooter(!1)}else{var isadmin=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.issettingsadmin;Leave.Reports.Util.showHideNoRecord(!0,"leaveLOPReport",ZPI18N.getString("zp.leave.lopreport.configuration"),isadmin?"false"==is5_0Enabled?Leave.Reports.lopReport.configuration:'<a target="_blank" href="#settings/service/leavetracker/payperiod"><button class="btn btn-primary">'+ZPI18N.getString("zp.config")+"</button></a>":void 0),!ZPeople.isZPNewUI()&&Leave.Reports.lopReport.showConfiguarationHelp(!0),layout.find('[name="payPeriodFilter"]').parent().addClass("DNI"),layout.find('[name="payPeriodFilter"]').parent().parent().find(".ln").addClass("DNI"),layout.find("#lopFooter").addClass("DNI"),layout.find(".lopPager").addClass("DNI"),layout.find("#zp_page_loading").remove()}},applyFilter:function(){Leave.Reports.lopReport.generateReport()},resetFilter:function(){Leave.Reports.lopReport.setDefaultFilterParams(!1)},validateGET:function(onPagePP,location){var layout=Layout.Page.container,locationPP="-1"!=location&&location?Leave.Reports.Util.getReportSetingsConfByLoc(location):onPagePP;if(Leave.Reports.Util.showHideNoRecord(!1,"leaveLOPReport"),layout.find("[name=payPeriodFilter]").removeClass("DN"),layout.find("#pay_period_detail",Layout.Page.container).remove(),Leave.Reports.lopReport.showConfiguarationHelp(!1),locationPP){if(onPagePP.rsID!=locationPP.rsID){Leave.Reports.Util.showHideNoRecord(!0,"leaveLOPReport");var dmsg="<div id='pay_period_detail' style='color:#666'><p>"+ZPI18N.getString("zp.leave.lopreport.payperiodlocation")+" : ";return onPagePP.isAllLocation?dmsg+="ALL":(_.each(onPagePP.rsLocations,function(name,id){dmsg+=name+", "}),dmsg=dmsg.slice(0,-2)+"</p>"),layout.find(".page_cont > .ZPNdata",Layout.Page.container).append(dmsg),!1}return!0}return Leave.Reports.Util.showHideNoRecord(!0,"leaveLOPReport",ZPI18N.getString("zp.leave.lopreport.configuration"),"false"==is5_0Enabled?Leave.Reports.lopReport.configuration:'<a target="_blank" href="#settings/service/leavetracker/payperiod"><button class="btn btn-primary">'+ZPI18N.getString("zp.config")+"</button></a>"),!ZPeople.isZPNewUI()&&Leave.Reports.lopReport.showConfiguarationHelp(!0),layout.find("[name=payPeriodFilter]").addClass("DN"),layout.find(".lopPager").css("display","none"),!1},validatePeriod:function(){var payperiod=Leave.Reports.Util.getPayPeriod(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date);Leave.Reports.Util.addorReducePayPeriod(payperiod,-1);Calendar.parseDate(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,uidateFormat);return!(Leave.Util.getDateDiff(payperiod.closure,payperiod.cur_date)<Leave.Reports.lopReport.reportFreeze)||(Leave.Reports.lopReport.validate_period=!1,$(".lopPrev",Layout.Page.container).click(),!1)},showConfiguarationHelp:function(show){var msgKey=Layout.Page.pageId.indexOf("payroll")>-1?"zp.leave.payrollreport.configuration":"zp.leave.lopreport.configuration";if(show&&isadmin){var helpLink=ZPeople.isZPNewUI()?"#leavetracker/payperiod/settings":"#admin/organization/payperiodsettings";0==$(".ZPNdata",Layout.Page.container).children("p").length&&$(".ZPNdata",Layout.Page.container).append("<p>"+ZPI18N.getString(msgKey)+'<a target="_blank" href="'+helpLink+'">'+ZPI18N.getString("zp.config")+"</a></p>")}else $(".ZPNdata>p",Layout.Page.container).remove()},html:function(resp){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,tbody=$("#leaveLOPReportTable",Layout.Page.container).children("tbody");_.isEmpty(data_arr)?Leave.Reports.Util.showHideNoRecord(!0,"leaveLOPReport"):(tbody.html(""),tbody.append(Leave.Reports.lopReport.body(data_arr,{iseditable:resp.iseditable,isdynamic:resp.isdynamic})),Leave.Reports.Util.showHideNoRecord(!1,"leaveLOPReport"))}tbody&&!tbody.data("isreg")&&(tbody.on("click",'tr.ZPLRow:not(.disabled) > [name="employee"]',function(){ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isV1User?(Leave.Reports.yearlyReport.employee=$(this).closest("tr").data("erecno"),"myReports"==ZPLite.Reports.selectedTab?window.location.href="#reports/my/leave/yearly":"teamReports"==ZPLite.Reports.selectedTab?window.location.href="#reports/team/leave/yearly":"adminReports"==ZPLite.Reports.selectedTab&&(window.location.href="#reports/admin/leave/yearly")):(Leave.Reports.userReport.employee=$(this).closest("tr").data("erecno"),"myReports"==ZPLite.Reports.selectedTab?window.location.href="#reports/my/leave/user":"teamReports"==ZPLite.Reports.selectedTab?window.location.href="#reports/team/leave/user":"adminReports"==ZPLite.Reports.selectedTab&&(window.location.href="#reports/admin/leave/user"))}),tbody.data("isreg",!0)),resp.hasOwnProperty("isGTexist")&&resp.isGTexist&&Layout.Page.container.find("#payPushList").show(),Leave.Util.removeLoading()},body:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),try_edit_msg=prop.isdynamic?ZPI18N.getString("zp.leave.lopreport.editnotallowed"):ZPI18N.getString("zp.leave.lopreport.editfreezed");return data_arr.forEach(function(empJson){var adjustTD,lopTD,reasonTD,employee=empJson.erecno,row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow");ZP.create("td",{width:"5%"});prop.iseditable?(adjustTD=ZP.create("td",{class:"TBrdr-Rgt"}),lopTD=ZP.create("td",{class:"TBrdr-Rgt"}),reasonTD=ZP.create("td",{class:"TBrdr-Rgt"}),adjust=$('<input resetVal="'+empJson.adjustment+'" class="form-control table-inpt input-bb1 DATA_INPUT" name="adjustment" value="'+empJson.adjustment+'" type="text">')[0],lop=$('<input resetVal="'+empJson.lop+'" class="form-control table-inpt input-bb1 DATA_INPUT" name="lop" value="'+empJson.lop+'" type="text">')[0],reason=$('<input resetVal="'+ZP.optValue(empJson,"reason","")+'" class="form-control table-inpt input-bb1 DATA_INPUT" name="reason" value="'+ZP.optValue(empJson,"reason","")+'" type="text">')[0],$(adjust).on("keyup",Leave.Reports.lopReport.Modify.entry),$(lop).on("keyup",Leave.Reports.lopReport.Modify.entry),$(reason).on("keyup",Leave.Reports.lopReport.Modify.entry),adjustTD.appendChild(adjust),lopTD.appendChild(lop),reasonTD.appendChild(reason)):(adjustTD=ZP.create("td",{text:empJson.adjustment,class:"TBrdr-Rgt"}),lopTD=ZP.create("td",{text:empJson.lop,class:"TBrdr-Rgt"}),reasonTD=ZP.create("td",{text:ZP.optValue(empJson,"reason",""),class:"TBrdr-Rgt"}),$(lopTD).dblclick(function(){ZPeople.Message.showWarningMsg(try_edit_msg)}));empJson.overDue,empJson.adjustment,empJson.lop;$(row_tr).data("erecno",employee),row_tr.appendChild(ZP.create("td",{text:empJson.prev_balance,name:"prev_balance",class:"TBrdr TBrdr-Rgt"})),row_tr.appendChild(ZP.create("td",{text:empJson.taken,name:"taken",class:"TBrdr-Rgt"})),row_tr.appendChild(ZP.create("td",{text:empJson.total_taken,name:"total_taken",class:"TBrdr-Rgt"})),row_tr.appendChild(adjustTD),row_tr.appendChild(lopTD),row_tr.appendChild(reasonTD),row_tr.appendChild(ZP.create("td",{text:empJson.carry_over,name:"carry_over",resetVal:empJson.carry_over,class:"TBrdr-Rgt"})),temp_doc.appendChild(row_tr)}),temp_doc},showFooter:function(show){show?Layout.Page.container.find("#lopFooter").show():Layout.Page.container.find("#lopFooter").hide()},Modify:{entry:function(){Leave.Reports.lopReport.showFooter(!0);var curELE=$(this),curTR=curELE.parents("tr");Leave.Reports.lopReport.Modify.validateEmpData(curTR)?curELE.css("border-color","red"):curELE.closest("tr").find("input.DATA_INPUT").css("border-color",""),curTR.attr("edited",!0)},save:function(){var dataBody=$("#leaveLOPReportTable",Layout.Page.container),filter_params=Leave.Reports.lopReport.getParamsForReport(),filterpayperiod=$(".lopPager",Layout.Page.container).data("payperiod"),params={};params.from=Calendar.formatDate(filterpayperiod.start),params.to=Calendar.formatDate(filterpayperiod.end);var filObj=JSON.parse(filter_params.leaveFilter);params.org_report_setting=filObj.org_report_setting,params.leaveunit=filObj.leaveunit,params.key="lop_bulk_update",Leave.Reports.lopReport.Modify.validate(dataBody,params)?ZPeople.Message.showFailureMsg("Provide proper data to edit entries"):ZPeople.Request.send(Leave.Reports.url,params,function(result){"success"===result.status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully")),Leave.Reports.lopReport.Modify.reset()):(ZPeople.Message.showFailureMsg(result.message?result.message:ZPI18N.getString("zpp.somethingwentwrong")),Leave.Reports.lopReport.Modify.reset())})},validate:function(dataBody,params){var modifiedRws=$("tr[edited=true]",dataBody),updateData={},hasError=!1;return _.each(modifiedRws,function(ele,idx){var empData={},curTR=$(ele);empData.erecno=curTR.data("erecno"),empData.adjust=curTR.find("[name=adjustment]").val()||curTR.find("[name=adjustment]").val(0).val(),empData.lop=curTR.find("[name=lop]").val()||curTR.find("[name=lop]").val(0).val(),empData.reason=curTR.find("[name=reason]").val().trim(),empData.reason=empData.reason.length>0?empData.reason:"",Leave.Reports.lopReport.Modify.validateEmpData(curTR)&&(hasError=!0),updateData[empData.erecno]=empData}),params.updateData=JSON.stringify(updateData),hasError},validateEmpData:function(empTR){var hasError=!1,taken=parseFloat(empTR.find("[name=total_taken]").text()||0),adjust=parseFloat(empTR.find("[name=adjustment]").val()||0),reason=empTR.find("[name=reason]").val();if(isNaN(adjust)||adjust<0)return!0;var lop=parseFloat(empTR.find("[name=lop]").val()||0);if(isNaN(lop)||lop<0)return!0;var afterAdjustment=taken-(adjust+lop);return empTR.find("[name=carry_over]").text(afterAdjustment),(adjust>0||lop>0)&&afterAdjustment<0&&(hasError=!0),reason.length>250&&(hasError=!0,ZPeople.Message.showFailureMsg("Reason must be less than 250 characters")),hasError},reset:function(){var dataBody=$("#leaveLOPReportTable",Layout.Page.container);_.each($("tr[edited=true]",dataBody),function(ele,idx){var curTR=$(ele),adjustment=curTR.find("[name=adjustment]").val(),lop=curTR.find("[name=lop]").val(),reason=curTR.find("[name=reason]").val(),carry_over=curTR.find("[name=carry_over]").text();curTR.find("[name=adjustment]").attr("resetVal",adjustment),curTR.find("[name=lop]").attr("resetVal",lop),curTR.find("[name=reason]").attr("resetVal",reason),curTR.find("[name=carry_over]").attr("resetVal",carry_over),curTR.attr("edited",!1)}),Leave.Reports.lopReport.showFooter(!1)},cancel:function(){var dataBody=$("#leaveLOPReportTable",Layout.Page.container);_.each($("tr[edited=true]",dataBody),function(ele,idx){var curTR=$(ele),adjustment=curTR.find("[name=adjustment]").attr("resetVal"),lop=curTR.find("[name=lop]").attr("resetVal"),reason=curTR.find("[name=reason]").attr("resetVal"),carry_over=curTR.find("[name=carry_over]").attr("resetVal");curTR.find("[name=adjustment]").val(adjustment).css("border-color",""),curTR.find("[name=lop]").val(lop).css("border-color",""),curTR.find("[name=reason]").val(reason).css("border-color",""),curTR.find("[name=carry_over]").text(carry_over),curTR.attr("edited",!1)}),Leave.Reports.lopReport.showFooter(!1)}},Import:{importPage:function(){$(Layout.Page.container.find("#import_modal"));var header='<ol class="breadcrumb ZPbcrumb P0I"><li class="active"><a>'+ZPI18N.getString("zp.uploadfile")+'</a></li><li id="mapping_header"><a>'+ZPI18N.getString("zp.mapdetails")+'</a></li></ol><button aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div>',footer='<div class="modal-footer text-left"><button class="btn btn-default btn-md MR10 FR DN" type="button" id="Next">'+ZPI18N.getString("zp.next")+'</button><button class="btn btn-default btn-md FL" type="button" data-dismiss="modal">'+ZPI18N.getString("zp.close")+"</button></div>",html=ZPeople.BSModal.get({id:Layout.Page.pageId+"-import",type:2,header:header,footer:footer,modalClass:"popRgtModel",deleteOnHide:!0}),body='<div class="modal-body PT0I"><div id="form"><iframe name="response_handler" style="display:none"></iframe>';body+='<form role="form" class="pad" id="import_form" method="Post" enctype="multipart/form-data" name="UploadForm" action="/leave_reports_actions.zp" target="response_handler"><input type="hidden" id="request_param" name="conreqcsr"><input type="hidden" name="key" value="lop_import_file">',body+='<input type="hidden" id="request_param" name="conreqcsr"><div class="ZPfileBox text-center PT30 PB30" id="import_file"><i class="IC-imprt S22 MB8 DIB blu"></i><p class="ZPbold">'+ZPI18N.getString("zp.fileimported")+'</p><p class="gry"><small>'+ZPI18N.getString("zp.fomtsupportxlscsv")+"</small></p>",body+='<div class="btn btn-primary ZPbtnDefault"><span>'+ZPI18N.getString("zp.importfile")+'</span><input name="file_data" accept=".xls,.csv" type="file" class="ZPFfile" onchange="Leave.Settings.Import.selectFile()"></div></div>',body+='<div class="ZPfileBox text-center PT40 PB40 DN" id="import_file_selected"><i class="IC-docs imtIcn DIB blu"></i><p class="MB20"><span id="file_name"></span><span class="IC-rou-tik ML5 filetck"></span></p><button class="btn btn-default" type="button" onclick="Leave.Settings.Import.showimport();">'+ZPI18N.getString("zp.removeandnew")+"</button></div></form></div></div>";var Jbody=$(body);Jbody.find("[name=theFile]").on("change",Leave.Util.selectFile),Jbody.find("form").append(Leave.Reports.lopReport.Import.importHelp),$(html.find(".modal-body")).append(Jbody.html()),html.find(".modal-footer > #Next").on("click",Leave.Reports.lopReport.Import.importfile),html.modal("show")},importfile:function(){var modal_body=$(Layout.Page.container.find("#"+Layout.Page.pageId+"-import"));$(modal_body.find("#request_param")).val(csrfToken),$(modal_body.find("#import_form")).trigger("submit")},import_mapped_data:function(){var imp_modal=$(Layout.Page.container.find("#"+Layout.Page.pageId+"-import")),params={repType:ZPLite.Reports.selectedTab+""},haserror=!1;$.each(imp_modal.find("select"),function(idx,ele){var value=(ele=$(ele)).val();-1==value?(haserror=!0,ele.next("span").removeClass("DN")):ele.next("span").addClass("DN"),params[ele.attr("name")]=value}),haserror||ZPeople.Request.send(Leave.Report.url+"?key=lop_import_mapping",params,function(response){if("success"==response.status||"success"==response.msg){var succesmsg='<div class="ZPImfrm ZPRecList"><div class="PR"><div class="ZPfileBox text-center PT40 PB40 grnbr"><i class="IC-docs imtIcn DIB blu"></i><p class="MB15"><b>The selected file has been <br> imported successfully</b></p></div><div class="ZPSAdflds infomsg MT20"><ul class="list MT20"><li>Number of records added<span id="added" class="rcount">'+(void 0!=response.added_count?response.added_count:0)+'</span></li><li>Number of records updated<span id="noOfUpdate" class="rcount">0</span></li><li>Number of records skipped<span id="noOfSkip" class="rcount">'+(void 0!=response.skipped_count?response.skipped_count:0)+'</span></li><li>Number of errors<span id="noOfErr" class="rcount">0</span></li></ul></div></div></div>';$(imp_modal.find("#mapping")).hide(),$(imp_modal.find(".modal-body")).append(succesmsg),$(imp_modal.find("#Next")).hide()}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.leave.import.error"));Leave.Util.getsearch_callback()()})},importHelp:'<div class="MT30" id="lopImportHelp"><p><b class="DB dgry">'+ZPI18N.getString("zp.example")+'</b></p><table class="table table-hover S13"><tbody><tr class="TblGryBg "><th class="PL12I" width="50"></th><th>A</th><th>B</th><th>C</th></tr><tr class="ZPLRow"><th class="PL12I">1</th><td>Employee mail ID/Employee ID</td><td>Leave Type</td><td>Previous Pay Period Balance</td></tr><tr class="ZPLRow"><th class="PL12I">2</th><td>ZCON001</td><td>LOP</td><td>2</td></tr><tr class="ZPLRow"><th class="PL12I">3</th><td>charles.stones@zylker.com</td><td>Unpaid Hours</td><td>10</td></tr></tbody></table></div><p><b class="DB dgry">Note:</b></p><ul class="list-number"><li class="S12 LH20">'+ZPI18N.getString("zp.leave.lopreport.import.note1")+"</li></ul>"},Firescroll:{mode:"LOP_REPORT",loadMoreData:function(){var params=Leave.Reports.lopReport.getParamsForReport();params.get_show_generate_lop=!1,ZPeople.Request.send(Leave.Reports.url,params,function(response){void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.lopReport.Firescroll.mode,!1),$("#leaveLOPReportTable > tbody",Layout.Page.container).append(Leave.Reports.lopReport.body(response.data,{iseditable:response.iseditable})),ZPLite.Firescroll.setFetchedCount(Leave.Reports.lopReport.Firescroll.mode,response.data.length)):ZPLite.Firescroll.setFetchedCount(Leave.Reports.lopReport.Firescroll.mode,0)})}}},encashmentReport:{reportName:"ENCASHMENT_REPORT",URI:"/api/v2/leavetracker/reports/encashment",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.encashmentReport.reportName);var initParams={};initParams.callback=Leave.Reports.encashmentReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),void 0===ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod?$.ajax({url:"leave_common_action.zp",type:"POST",async:!1,data:{key:"init_page",topics:"PAYPERIOD",conreqcsr:csrfToken},success:function(resp){if("success"===resp.status){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;$.each(resp.data,function(key,obj){"payPeriod"==key&&_.each(obj,function(pp){pp.rsName=decodeHTML(pp.rsName)}),moduleData[key]=obj}),Leave.Reports.encashmentReport.initReport()}}}):Leave.Reports.encashmentReport.initReport()},initReport:function(){Layout.Page.container;if(Leave.Util.isCurPageAdmin()){Leave.Reports.encashmentReport.reg(),Leave.Reports.Util.showHideNoRecord(!0,"leaveEncashmentReport");var filterDiv=Layout.Page.container.find("#filterDiv");Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(Layout.Page.container.find('[name="payPeriodFilter"]'),"payPeriod",!0,Leave.Reports.encashmentReport.filterOnChangeCallback),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Leave.Reports.encashmentReport.filterOnChangeCallback,"LEAVE_ENCASH_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"ppLocation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"ppRole",!1),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.encashmentReport.filterOnChangeCallback),Leave.Reports.encashmentReport.setDefaultFilterParams(!0),Leave.Reports.encashmentReport.generateReport()}else Leave.Util.showNoPermission()},reg:function(){var layout=Layout.Page.container,formName=ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.formDisplayName)+" ";layout.find(".lt_nav").find(".ZP-SwitchUnit").unbind("click").on("click",function(){$(this).removeClass("active").addClass("active"),$(this).siblings().removeClass("active");var unitMsg="Day"==layout.find(".ZP-SwitchUnit.active").attr("value")?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.leavetype.hour.plural");layout.find("#noOfEncash").text(ZPI18N.getString("zp.leave.noofencash",[unitMsg,formName])),Leave.Reports.encashmentReport.generateReport()});var unitMsg="Day"==layout.find(".ZP-SwitchUnit.active").attr("value")?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.leavetype.hour.plural");layout.find("#noOfEncash").text(ZPI18N.getString("zp.leave.noofencash",[unitMsg,formName])),layout.find(".encashmentPrev").unbind("click").on("click",function(){Leave.Reports.Util.navPayPeriod(layout.find(".encashmentPager"),-1)}),layout.find(".encashmentNext").unbind("click").on("click",function(){Leave.Reports.Util.navPayPeriod(layout.find(".encashmentPager"),1)}),Leave.Util.isCurPageAdmin()&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowImport||layout.find(".CR-imprt").parent().remove()},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("payPeriod"===data.entity)Leave.Reports.lopReport.validate_period=!0,Leave.Reports.Util.loadPayPeriod(),Leave.Reports.Filters.clearCache(!1,"employee"),ZPLite.Filters.clearValues(container.find('[name="employeeFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="employeeFilter"]')),ZPLite.Filters.clearValues(container.find('[name="locationFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="locationFilter"]')),ZPLite.Filters.clearValues(container.find('[name="roleFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="roleFilter"]')),Leave.Reports.encashmentReport.generateReport();else if("employee"===data.entity){var values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]')),dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#leaveEncashmentReport"),Leave.Reports.encashmentReport.Firescroll.mode),layout.find("#leaveEncashmentReport").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leaveEncashmentReport")),layout.find("#leaveEncashmentReport").addClass("DN"),layout.find('[name="payPeriodFilter"]').parent().removeClass("DNI"),layout.find('[name="payPeriodFilter"]').parent().parent().find(".ln").removeClass("DNI"),layout.find(".encashmentPager").removeClass("DNI");var params=JSON.parse(Leave.Reports.encashmentReport.getParamsForReport().leaveFilter);params.startIndex=0;var payperiod=$(".encashmentPager",Layout.Page.container).data("payperiod");if("object"==typeof payperiod)Leave.Reports.encashmentReport.validateGET(payperiod.conf,params.location)?(ZPeople.Request.postAPI(Leave.Reports.encashmentReport.URI,params,function(resp){resp&&"permissionDenied"===resp.error?Leave.Reports.Util.permDenied():(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin?layout.find("#ZP-Regenerate").show():layout.find("#ZP-Regenerate").hide(),void 0!==resp&&void 0!==resp.report.employees&&resp.report.employees.length>0?(layout.find("#leaveEncashmentReport").removeClass("DN"),layout.find(".ZPNdata ").fadeOut(100).remove(),Leave.Reports.encashmentReport.html(resp,params),ZPLite.Firescroll.init(layout.find("#leaveEncashmentReport"),Leave.Reports.encashmentReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.encashmentReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.encashmentReport.Firescroll.mode,resp.report.employees.length)):(layout.find("#leaveEncashmentReport").addClass("DN"),layout.find(".ZPNdata ").fadeOut(100).remove(),Leave.Reports.Util.showHideNoRecord(!0,"leaveEncashmentReport")))},{},Leave.Reports.encashmentReport.showReportErrorMsg),ZPeople.FireScroll.reset()):Leave.Reports.Util.checkPermDenied("encashment");else{var isadmin=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.issettingsadmin;Leave.Reports.Util.showHideNoRecord(!0,"leaveEncashmentReport",ZPI18N.getString("zp.leave.encashmentreport.configuration"),isadmin?"false"==is5_0Enabled?Leave.Reports.lopReport.configuration:'<a target="_blank" href="#settings/service/leavetracker/payperiod"><button class="btn btn-primary">'+ZPI18N.getString("zp.config")+"</button></a>":void 0),!ZPeople.isZPNewUI()&&Leave.Reports.encashmentReport.showConfiguarationHelp(!0),layout.find('[name="payPeriodFilter"]').parent().addClass("DNI"),layout.find('[name="payPeriodFilter"]').parent().parent().find(".ln").addClass("DNI"),layout.find(".encashmentPager").addClass("DNI"),layout.find("#zp_page_loading").remove()}},setDefaultFilterParams:function(isInitPPData){var filterDiv=Layout.Page.container.find("#filterDiv"),ppFilObj=Layout.Page.container.find(".nav_rht");if(isInitPPData&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod.length>0){var ppDet=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod[0];ZPLite.Filters.setValues(ppFilObj.find('[name="payPeriodFilter"]'),[{id:ppDet.rsID+"",text:ZPeople.escapeHtml(ppDet.rsName)}]),Leave.Reports.Util.loadPayPeriod()}filterDiv.find('[name="reportTypeFilter"]').is(":visible")&&(ZPLite.Filters.clearValues(filterDiv.find('[name="reportTypeFilter"]')),filterDiv.find('[name="reportTypeFilter_Options"]').find("ul li").removeClass("sel")),ZPLite.Filters.setValues(filterDiv.find('[name="reportTypeFilter"]'),[{id:"0",text:ZPI18N.getString("zp.default")}]),filterDiv.find('[name="employeeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="incDReportsOnly"]').find("input").prop("checked",!1),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked")},getParamsForReport:function(){var values,params={key:"encashment",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv"),leaveFilter={};if(void 0!==(values=ZPLite.Filters.getValues(Layout.Page.container.find(".nav_rht").find('[name="payPeriodFilter"]')))&&values.length>0&&(leaveFilter.payPeriodSettingId=values[0].id),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var erecNo=[];$.each(values,function(index,options){erecNo.push(options.id)}),leaveFilter.employee=JSON.stringify(erecNo)}if(leaveFilter.incDReportsOnly=filterDiv.find("[name=incDReportsOnly]").find("input").is(":checked"),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),leaveFilter.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),leaveFilter.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),leaveFilter.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),leaveFilter.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),leaveFilter.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),leaveFilter.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="roleFilter"]')))&&values.length>0){var roleId=[];$.each(values,function(index,options){roleId.push(options.id)}),leaveFilter.role=JSON.stringify(roleId)}Leave.organizationTag.fetchParams(filterDiv,leaveFilter);var employeeStatus=[];void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0?($.each(values,function(index,options){employeeStatus.push(options.id)}),leaveFilter.employeeStatus=JSON.stringify(employeeStatus)):leaveFilter.employeeStatus=employeeStatus,leaveFilter.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(leaveFilter.incDateOfExit=!0);var filterpayperiod=$(".encashmentPager",Layout.Page.container).data("payperiod");return filterpayperiod&&(leaveFilter.from=Calendar.formatDate(filterpayperiod.start),leaveFilter.to=Calendar.formatDate(filterpayperiod.end)),leaveFilter.unit=Layout.Page.container.find(".lt_nav").find("div[name=switchUnit]").find("li.active").attr("value"),leaveFilter.startIndex=ZPLite.Firescroll.getStartIndex(Leave.Reports.encashmentReport.Firescroll.mode),leaveFilter.repType=ZPLite.Reports.selectedTab,params.leaveFilter=JSON.stringify(leaveFilter),"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params},applyFilter:function(){Leave.Reports.encashmentReport.generateReport()},resetFilter:function(){Leave.Reports.encashmentReport.setDefaultFilterParams(!1)},validateGET:function(onPagePP,location){var layout=Layout.Page.container,locationPP="-1"!=location&&location?Leave.Reports.Util.getReportSetingsConfByLoc(location):onPagePP;if(Leave.Reports.Util.showHideNoRecord(!1,"leaveEncashmentReport"),layout.find("[name=payPeriodFilter]").removeClass("DN"),layout.find("#pay_period_detail",Layout.Page.container).remove(),Leave.Reports.encashmentReport.showConfiguarationHelp(!1),locationPP&&locationPP.rsProcessEncashment){if(onPagePP.rsID!=locationPP.rsID){Leave.Reports.Util.showHideNoRecord(!0,"leaveEncashmentReport");var dmsg="<div id='pay_period_detail' style='color:#666'><p>"+ZPI18N.getString("zp.leave.lopreport.payperiodlocation")+" : ";return onPagePP.isAllLocation?dmsg+="ALL":(_.each(onPagePP.rsLocations,function(name,id){dmsg+=name+", "}),dmsg=dmsg.slice(0,-2)+"</p>"),layout.find(".page_cont > .ZPNdata",Layout.Page.container).append(dmsg),!1}return!0}return Leave.Reports.Util.showHideNoRecord(!0,"leaveEncashmentReport",ZPI18N.getString("zp.leave.encashmentreport.configuration"),"false"==is5_0Enabled?Leave.Reports.lopReport.configuration:'<a target="_blank" href="#settings/service/leavetracker/payperiod"><button class="btn btn-primary">'+ZPI18N.getString("zp.config")+"</button></a>"),!ZPeople.isZPNewUI()&&Leave.Reports.encashmentReport.showConfiguarationHelp(!0),layout.find("[name=payPeriodFilter]").addClass("DN"),layout.find(".encashmentPager").css("display","none"),layout.find("#zp_page_loading").remove(),!1},html:function(resp,params){document.createDocumentFragment(),resp.report;var tbody=$("#leaveEncashmentReportTable>tbody",Layout.Page.container);tbody.html(""),_.isEmpty(resp.report.employees)?Leave.Reports.Util.showHideNoRecord(!0,"leaveEncashmentReport",ZPI18N.getString("zp.leave.payrollreport.configuration"),"false"==is5_0Enabled?Leave.Reports.lopReport.configuration:'<a target="_blank" href="#settings/service/leavetracker/payperiod"><button class="btn btn-primary">'+ZPI18N.getString("zp.config")+"</button></a>"):(tbody.append(Leave.Reports.encashmentReport.body(resp.report,resp)),Leave.Reports.Util.showHideNoRecord(!1,"leaveEncashmentReport")),Leave.Util.removeLoading()},body:function(data,prop){var temp_doc=document.createDocumentFragment();return prop.report.employees.forEach(function(erecno){var empReport=data[erecno],row_tr=ZP.getEmpRow(empReport.employee,"Report_row ZPLRow"),td=ZP.create("td",{class:"text-center TBrdr TBrdr-Rgt",width:"50%"});td.appendChild(ZP.create("div",{text:empReport.encashDetail.encash})),row_tr.appendChild(td),temp_doc.appendChild(row_tr)}),temp_doc},Firescroll:{mode:"ENCASHMENT_REPORT",loadMoreData:function(){var params=JSON.parse(Leave.Reports.encashmentReport.getParamsForReport().leaveFilter);ZPeople.Request.postAPI(Leave.Reports.encashmentReport.URI,params,function(resp){void 0!==resp&&void 0!==resp.report.employees&&resp.report.employees.length>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.encashmentReport.Firescroll.mode,!1),$("#leaveEncashmentReport>table>tbody",Layout.Page.container).append(Leave.Reports.encashmentReport.body(resp.report,resp)),ZPLite.Firescroll.setFetchedCount(Leave.Reports.encashmentReport.Firescroll.mode,resp.report.employees.length)):ZPLite.Firescroll.setFetchedCount(Leave.Reports.encashmentReport.Firescroll.mode,0)})}},showConfiguarationHelp:function(show){show&&isadmin?0==$(".ZPNdata",Layout.Page.container).children("p").length&&$(".ZPNdata",Layout.Page.container).append("<p>"+ZPI18N.getString("zp.leave.encashmentreport.configuration")+'<a target="_blank" href="'+helpLink+'">'+ZPI18N.getString("zp.config")+"</a></p>"):$(".ZPNdata>p",Layout.Page.container).remove()},showReportErrorMsg:function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.leave.reports.errormsg")),Leave.Util.removeLoading()}},payrollReport:{reportName:"PAYROLL_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.payrollReport.reportName);var initParams={};initParams.callback=Leave.Reports.payrollReport.init,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),void 0===ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod?$.ajax({url:"leave_common_action.zp",type:"POST",async:!1,data:{key:"init_page",topics:"PAYPERIOD",conreqcsr:csrfToken},success:function(resp){if("success"===resp.status){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;$.each(resp.data,function(key,obj){"payPeriod"==key&&_.each(obj,function(pp){pp.rsName=decodeHTML(pp.rsName)}),moduleData[key]=obj}),Leave.Reports.payrollReport.initReport()}}}):Leave.Reports.payrollReport.initReport()},initReport:function(){var layout=Layout.Page.container;if(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payroll_report_enabled&&Leave.Util.isCurPageAdmin()){showNewTab&&layout.find(".fil .lt_dropdown").find("[name=permSett] a").attr("href","#settings/service/leavetracker/reports"),Leave.Reports.payrollReport.reg(),Leave.Reports.Util.showHideNoRecord(!0,"leavePayrollReport");var filterDiv=Layout.Page.container.find("#filterDiv");Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(Layout.Page.container.find('[name="reportTypeFilter"]'),"reportType",!0),Leave.Reports.Filters.constructFilter(Layout.Page.container.find('[name="payPeriodFilter"]'),"payPeriod",!0,Leave.Reports.payrollReport.filterOnChangeCallback),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Leave.Reports.payrollReport.filterOnChangeCallback,"LEAVE_PR_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"ppLocation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"ppRole",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.payrollReport.filterOnChangeCallback),Leave.Reports.payrollReport.setDefaultFilterParams(!0),Leave.Reports.payrollReport.generateReport()}else Leave.Util.showNoPermission()},reg:function(){var layout=Layout.Page.container;layout.find(".lt_nav").find(".ZP-SwitchUnit").unbind("click").on("click",function(){$(this).removeClass("active").addClass("active"),$(this).siblings().removeClass("active");var unitMsg="Days"==layout.find(".ZP-SwitchUnit.active").attr("value")?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.leavetype.hour.plural");layout.find("em.leaveunit").text(unitMsg),Leave.Reports.payrollReport.generateReport()});var unitMsg="Days"==layout.find(".ZP-SwitchUnit.active").attr("value")?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.leavetype.hour.plural");layout.find("em.leaveunit").text(unitMsg),layout.find(".prPrev").unbind("click").on("click",function(){Leave.Reports.Util.navPayPeriod(layout.find(".payrollPager"),-1)}),layout.find(".prNext").unbind("click").on("click",function(){Leave.Reports.Util.navPayPeriod(layout.find(".payrollPager"),1)})},filterOnChangeCallback:function(data){var values,container=Layout.Page.container.find("#filterDiv");if("payPeriod"===data.entity)Leave.Reports.Util.loadPayPeriod(),Leave.Reports.Filters.clearCache(!1,"employee"),ZPLite.Filters.clearValues(container.find('[name="employeeFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="employeeFilter"]')),ZPLite.Filters.clearValues(container.find('[name="locationFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="locationFilter"]')),ZPLite.Filters.clearValues(container.find('[name="roleFilter"]')),ZPLite.Filters.clearOptions(container.find('[name="roleFilter"]')),Leave.Reports.payrollReport.generateReport();else if("employee"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'));var dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},setDefaultFilterParams:function(isInitPPData){var filterDiv=Layout.Page.container.find("#filterDiv"),ppFilObj=Layout.Page.container.find(".nav_rht");if(isInitPPData&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod.length>0){var ppDet=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod[0];ZPLite.Filters.setValues(ppFilObj.find('[name="payPeriodFilter"]'),[{id:ppDet.rsID+"",text:ZPeople.escapeHtml(ppDet.rsName)}]),Leave.Reports.Util.loadPayPeriod()}filterDiv.find('[name="reportTypeFilter"]').is(":visible")&&(ZPLite.Filters.clearValues(filterDiv.find('[name="reportTypeFilter"]')),filterDiv.find('[name="reportTypeFilter_Options"]').find("ul li").removeClass("sel")),ZPLite.Filters.setValues(filterDiv.find('[name="reportTypeFilter"]'),[{id:"0",text:ZPI18N.getString("zp.default")}]),filterDiv.find('[name="employeeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="incDReportsOnly"]').find("input").prop("checked",!1),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked")},getParamsForReport:function(){var values,params={key:"report_payroll",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv"),leaveFilter={};if(void 0!==(values=ZPLite.Filters.getValues(Layout.Page.container.find(".nav_rht").find('[name="payPeriodFilter"]')))&&values.length>0&&(leaveFilter.org_report_setting=values[0].id),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var erecNo=[];$.each(values,function(index,options){erecNo.push(options.id)}),leaveFilter.employee=JSON.stringify(erecNo)}if(leaveFilter.incDReportsOnly=filterDiv.find("[name=incDReportsOnly]").find("input").is(":checked"),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),leaveFilter.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),leaveFilter.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),leaveFilter.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),leaveFilter.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),leaveFilter.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),leaveFilter.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="roleFilter"]')))&&values.length>0){var roleId=[];$.each(values,function(index,options){roleId.push(options.id)}),leaveFilter.role=JSON.stringify(roleId)}Leave.organizationTag.fetchParams(filterDiv,leaveFilter);var employeeStatus=[];void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0?($.each(values,function(index,options){employeeStatus.push(options.id)}),leaveFilter.employeeStatus=JSON.stringify(employeeStatus)):leaveFilter.employeeStatus=employeeStatus,leaveFilter.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(leaveFilter.incDateOfExit=!0);var filterpayperiod=$(".payrollPager",Layout.Page.container).data("payperiod");return filterpayperiod&&(leaveFilter.from=Calendar.formatDate(filterpayperiod.start),leaveFilter.to=Calendar.formatDate(filterpayperiod.end)),leaveFilter.leaveunit=Layout.Page.container.find(".lt_nav").find("div[name=switchUnit]").find("li.active").attr("value"),leaveFilter.sIndx=ZPLite.Firescroll.getStartIndex(Leave.Reports.payrollReport.Firescroll.mode),params.leaveFilter=JSON.stringify(leaveFilter),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="reportTypeFilter"]')))&&values.length>0&&(params.report_type=values[0].id),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#leavePayrollReport"),Leave.Reports.payrollReport.Firescroll.mode),layout.find("#leavePayrollReport").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#leavePayrollReport")),layout.find("#leavePayrollReport").addClass("DN"),layout.find('[name="payPeriodFilter"]').parent().removeClass("DNI"),layout.find('[name="payPeriodFilter"]').parent().parent().find(".ln").removeClass("DNI"),layout.find(".payrollPager").removeClass("DNI");var payperiod=$(".payrollPager",Layout.Page.container).data("payperiod");if("object"==typeof payperiod){var params=Leave.Reports.payrollReport.getParamsForReport();Leave.Reports.lopReport.validateGET(payperiod.conf,params.location)&&Leave.Reports.payrollReport.validatePeriod()?ZPeople.Request.send(Leave.Reports.url,params,function(resp){resp&&"permissionDenied"===resp.error?Leave.Reports.Util.permDenied():(layout.find("[id=zp_page_loading]").fadeOut(200).remove(),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin?layout.find("#ZP-Regenerate").show():layout.find("#ZP-Regenerate").hide(),Leave.Util.getReportSetingsConf(ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'))[0].id).rsProcessEncashment?$("#Encashment_Header",Layout.Page.container).removeClass("DN"):$("#Encashment_Header",Layout.Page.container).addClass("DN"),void 0!==resp&&"success"==resp.status&&void 0!==resp.data&&resp.data.length>0?(layout.find("#leavePayrollReport").removeClass("DN"),layout.find(".ZPNdata ").fadeOut(100).remove(),Leave.Reports.payrollReport.html(resp,params),ZPLite.Firescroll.init(layout.find("#leavePayrollReport"),Leave.Reports.payrollReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.payrollReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.payrollReport.Firescroll.mode,resp.data.length)):(layout.find("#leavePayrollReport").addClass("DN"),layout.find(".ZPNdata ").fadeOut(100).remove(),Leave.Reports.Util.showHideNoRecord(!0,"leavePayrollReport")))},{},Leave.Reports.showReportErrorMsg):Leave.Reports.Util.checkPermDenied("payroll"),payperiod.conf.payrollClosureNotConfigured?(Layout.Page.container.find("#ZP-Regenerate").addClass("DNI"),Layout.Page.container.find(".prSpan").addClass("DNI")):(Layout.Page.container.find("#ZP-Regenerate").removeClass("DNI"),Layout.Page.container.find(".prSpan").removeClass("DNI"))}else{var isadmin=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.issettingsadmin;layout.find(".ZPNdata ").fadeOut(100).remove(),Leave.Reports.Util.showHideNoRecord(!0,"leavePayrollReport",ZPI18N.getString("zp.leave.payrollreport.configuration"),isadmin?"false"==is5_0Enabled?Leave.Reports.lopReport.configuration:'<a target="_blank" href="#settings/service/leavetracker/payperiod"><button class="btn btn-primary">'+ZPI18N.getString("zp.config")+"</button></a>":void 0),!ZPeople.isZPNewUI()&&Leave.Reports.lopReport.showConfiguarationHelp(!0),layout.find('[name="payPeriodFilter"]').parent().addClass("DNI"),layout.find('[name="payPeriodFilter"]').parent().parent().find(".ln").addClass("DNI"),layout.find(".payrollPager").addClass("DNI"),layout.find("#zp_page_loading").remove()}},applyFilter:function(){Leave.Reports.payrollReport.generateReport()},resetFilter:function(){Leave.Reports.payrollReport.setDefaultFilterParams(!1)},validatePeriod:function(){$(".payrollPager",Layout.Page.container).data("payperiod"),Calendar.parseDate(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,uidateFormat);return!0},html:function(resp,params){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,tbody=$("#leavePayrollReportTable>tbody",Layout.Page.container);tbody.html(""),_.isEmpty(data_arr)?Leave.Reports.Util.showHideNoRecord(!0,"leavePayrollReport",ZPI18N.getString("zp.leave.payrollreport.configuration"),"false"==is5_0Enabled?Leave.Reports.lopReport.configuration:'<a target="_blank" href="#settings/service/leavetracker/payperiod"><button class="btn btn-primary">'+ZPI18N.getString("zp.config")+"</button></a>"):(tbody.append(Leave.Reports.payrollReport.body(data_arr,resp)),resp.show_weekend?$(".show_weekend",Layout.Page.container).removeClass("DN"):$(".show_weekend",Layout.Page.container).addClass("DN"),resp.show_holiday?$(".show_holiday",Layout.Page.container).removeClass("DN"):$(".show_holiday",Layout.Page.container).addClass("DN"),resp.show_holiday||resp.show_weekend?$(".show_payable",Layout.Page.container).removeClass("DN"):$(".show_payable",Layout.Page.container).addClass("DN"),resp.detailed_report?$(".show_weekend, .show_holiday, .detailed_report",Layout.Page.container).removeClass("DN"):$(".detailed_report",Layout.Page.container).addClass("DN"),Leave.Reports.Util.showHideNoRecord(!1,"leavePayrollReport"))}Leave.Util.removeLoading()},body:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),detailed_report=(data_arr.length,prop.detailed_report),show_weekend=prop.show_weekend||detailed_report,show_holiday=prop.show_holiday||detailed_report,show_payable=show_weekend||show_holiday,show_encashment=!Layout.Page.container.find("#Encashment_Header").hasClass("DN");return data_arr.forEach(function(empJson){empJson.erecno;var row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow");((td=ZP.create("td",{class:"text-center TBrdr TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.total})),row_tr.appendChild(td),show_weekend)&&((td=ZP.create("td",{class:"text-center TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.weekend})),row_tr.appendChild(td));show_holiday&&((td=ZP.create("td",{class:"text-center TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.holiday})),row_tr.appendChild(td));show_payable&&((td=ZP.create("td",{class:"text-center TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.payable})),row_tr.appendChild(td));if(detailed_report){var td;(td=ZP.create("td",{class:"text-center TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.onduty_leave})),row_tr.appendChild(td);var leaveTD=$(Leave.Reports.payrollReport.leaveTableTmp.replace("*paidlC*",empJson.paid_leave).replace("*unpaidlC*",empJson.unpaid_leave).replace("*compoffC*",empJson.compoff_leave).replace("*totallC*",empJson.total_leave));row_tr.appendChild(leaveTD[0])}((td=ZP.create("td",{class:"text-center TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.lop})),row_tr.appendChild(td),show_encashment)&&((td=ZP.create("td",{class:"text-center TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.leave_encashed?empJson.leave_encashed:"0"})),row_tr.appendChild(td));(td=ZP.create("td",{class:"text-center TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.paid})),row_tr.appendChild(td),temp_doc.appendChild(row_tr)}),temp_doc},leaveTableTmp:'<td class="P0I TBrdr-Rgt" width="10%"><table class="table i_table"><tbody><tr class="potbl"><td class="text-center" width="33.33%" style="text-align:center;height:55px"><div class="W60" style="margin-left:2px">*paidlC*</div></td><td class="text-center" width="33.33%" style="text-align:center;height:55px"><div class="W60">*unpaidlC*</div></td><td class="text-center" width="33.33%" style="text-align:center;height:55px"><div class="W60">*compoffC*</div></td><td class="text-center" width="33.33%" style="text-align:center;height:55px"><div class="W60">*totallC*</div></td></tr></tbody></table></td>',Firescroll:{mode:"PAYROLL_REPORT",loadMoreData:function(){var params=Leave.Reports.payrollReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(response){void 0!==response&&"success"==response.status&&void 0!==response.data&&response.data.length>0?(ZPLite.Firescroll.setActiveStatus(Leave.Reports.payrollReport.Firescroll.mode,!1),$("#leavePayrollReportTable > tbody",Layout.Page.container).append(Leave.Reports.payrollReport.body(response.data,response)),ZPLite.Firescroll.setFetchedCount(Leave.Reports.payrollReport.Firescroll.mode,response.data.length)):ZPLite.Firescroll.setFetchedCount(Leave.Reports.payrollReport.Firescroll.mode,0)})}}},bradFordReport:{reportName:"BRADFORD_REPORT",key:"report_bradford",emp_score_json:{loaded:!1,emp_json:{},headers:{},params:{}},prevLiteTab:"",isReportGenerationInProgress:!1,initPage:function(){ZPLite.Reports.setCurrentModule(Leave.Reports.moduleName),ZPLite.Reports.setCurrentReport(Leave.Reports.bradFordReport.reportName);var initParams={};initParams.callback=Leave.Reports.bradFordReport.initCheck,initParams.isModuleDataNeeded=!0,initParams.moduleDataCallback=Leave.Reports.initModuledata,ZPLite.Reports.initPage(initParams)},initCheck:function(){Leave.Util.isBradfordFactorEnabled()?(Leave.Reports.bradFordReport.prevLiteTab!=ZPLite.Reports.selectedTab&&(Leave.Reports.bradFordReport.emp_score_json.loaded=!1),Leave.Reports.bradFordReport.init()):Leave.Reports.Util.showHideNoRecord(!0,"bradFordReport",ZPI18N.getString("zp.bradfordfactor.error.enableerror"))},init:function(){if(ZPLite.Reports.Util.setAvailableReportsForModule("Leavetracker"),Leave.Reports.bradFordReport.showHideFilter(),-1!==Layout.Page.hash.indexOf("leave/bradford/employee"))Leave.Reports.bradFordReport.DetailView.regModal(Layout.Page.childUrlParam.id),Leave.Reports.bradFordReport.DetailView.get();else if(-1!==Layout.Page.hash.indexOf("leave/bradford")&&!Leave.Reports.bradFordReport.emp_score_json.loaded){Leave.Reports.bradFordReport.prevLiteTab=ZPLite.Reports.selectedTab,Leave.Reports.Filters.clearCache(!0);var filterDiv=Layout.Page.container.find("#filterDiv");filterDiv.find('[name="dateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="dateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="bfTypeFilter"]'),"bfType",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="bfThresHoldFilter"]'),"bfThresHold",!0),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Leave.Reports.bradFordReport.filterOnChangeCallback,"LEAVE_BF_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),isOrgStructureEnabled&&(Leave.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),Leave.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Leave.Reports.bradFordReport.filterOnChangeCallback),Leave.Reports.bradFordReport.setDefaultFilterParams(),Leave.Reports.bradFordReport.generateReport()}},filterOnChangeCallback:function(data){var values,container=Layout.Page.container.find("#filterDiv");if(Layout.Page.container.find("#zp_report_bradford_dtl").hasClass("in")&&"employee"===data.entity)Leave.Reports.bradFordReport.DetailView.redirect(ZPLite.Filters.getValues(Layout.Page.container.find('[name="bfEmpFilter"]'))[0].id,Leave.Reports.bradFordReport.DetailView.getModalHideURL(),Leave.Reports.bradFordReport.DetailView.getIsUrlChanged(),Leave.Reports.bradFordReport.DetailView.getIsShowEmpSelect());else if("employee"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'));var dRepObj=container.find("[name=incDReportsOnly]");dRepObj.find("input").prop("checked",!1),values.length>0?dRepObj.hide():dRepObj.show()}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));var employeeStatus=[];jQuery.isEmptyObject(values)||$.each(values,function(index,options){employeeStatus.push(options.id)}),container.find('[name="incDateOfExit"]').addClass("DNI"),employeeStatus.includes("18")&&(container.find('[name="incDateOfExit"]').find("input").prop("checked",!0),container.find('[name="incDateOfExit"]').removeClass("DNI"))}},showHideFilter:function(){var filterDiv=Layout.Page.container.find("#filterDiv");"myReports"==ZPLite.Reports.selectedTab?(filterDiv.find('[name="employeeFilter"]').addClass("DNI"),filterDiv.find('[name="incDReportsOnly"]').addClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').addClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').addClass("DNI"),filterDiv.find('[name="divisionFilter"]').addClass("DNI"),filterDiv.find('[name="departmentFilter"]').addClass("DNI"),filterDiv.find('[name="designationFilter"]').addClass("DNI"),filterDiv.find('[name="locationFilter"]').addClass("DNI"),filterDiv.find('[name="roleFilter"]').addClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').addClass("DNI"),filterDiv.find('[name="incDateOfExit"]').addClass("DNI"),filterDiv.find('[name="orgTagFilter"]').addClass("DNI")):(filterDiv.find('[name="employeeFilter"]').removeClass("DNI"),filterDiv.find('[name="incDReportsOnly"]').removeClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').removeClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').removeClass("DNI"),filterDiv.find('[name="divisionFilter"]').removeClass("DNI"),filterDiv.find('[name="departmentFilter"]').removeClass("DNI"),filterDiv.find('[name="designationFilter"]').removeClass("DNI"),filterDiv.find('[name="locationFilter"]').removeClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').removeClass("DNI"),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').removeClass("DNI"))},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv"),date=Calendar.getCurrentDate(!0),dateFilter=filterDiv.find('[name="dateFilter"]'),name=dateFilter.attr("name");dateFilter.val(date),dateFilter.data("selectedDate",Calendar.parseDate(date,uidateFormat)),dateFilter.data("text",date),dateFilter.addClass("selected"),dateFilter.find('[name="'+name+'Text"]').text(date),dateFilter.find('[name="'+name+'Text"]').val(date),filterDiv.find('[name="bfTypeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="bfTypeFilter"]')),filterDiv.find('[name="bfThresHoldFilter"]').is(":visible")&&(ZPLite.Filters.clearValues(filterDiv.find('[name="bfThresHoldFilter"]')),filterDiv.find('[name="bfThresHoldFilter_Options"]').find("ul li").removeClass("sel")),ZPLite.Filters.setValues(filterDiv.find('[name="bfThresHoldFilter"]'),[{id:"0",text:ZPI18N.getString("zp.select")}]),filterDiv.find('[name="employeeFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="incDReportsOnly"]').find("input").prop("checked",!1),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),Leave.roleFilter.isEnabled()&&filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),Leave.organizationTag.isEnabled()&&filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),isOrgStructureEnabled&&(filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),"myReports"!=ZPLite.Reports.selectedTab&&filterDiv.find('[name="incDateOfExit"]').removeClass("DNI"),filterDiv.find('[name="incDateOfExit"]').find("input").prop("checked","checked"),Layout.Page.container.find("[name=dateNavigatorText]").text(Leave.Reports.Util.getDate("from_year")+" - "+Leave.Reports.Util.getDate("to_year"))},getParamsForReport:function(){var values,params={key:"report_bradford",conreqcsr:csrfToken},filterDiv=Layout.Page.container.find("#filterDiv");if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="bfTypeFilter"]')))&&values.length>0){var bfType=[];$.each(values,function(index,options){bfType.push(options.id)}),params.bradford=JSON.stringify(bfType)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="bfThresHoldFilter"]')))&&values.length>0&&"0"!=values[0].id&&(params.level=values[0].id),void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var erecNo=[];$.each(values,function(index,options){erecNo.push(options.id)}),params.employee=JSON.stringify(erecNo)}if(params.incDReportsOnly=filterDiv.find("[name=incDReportsOnly]").find("input").is(":checked"),isOrgStructureEnabled){if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId=[];$.each(values,function(index,options){legalEntityId.push(options.id)}),params.entity=JSON.stringify(legalEntityId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId=[];$.each(values,function(index,options){businessUnitId.push(options.id)}),params.businessUnit=JSON.stringify(businessUnitId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId=[];$.each(values,function(index,options){divisionId.push(options.id)}),params.division=JSON.stringify(divisionId)}}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId=[];$.each(values,function(index,options){departmentId.push(options.id)}),params.department=JSON.stringify(departmentId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId=[];$.each(values,function(index,options){designationId.push(options.id)}),params.designation=JSON.stringify(designationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId=[];$.each(values,function(index,options){locationId.push(options.id)}),params.location=JSON.stringify(locationId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="roleFilter"]')))&&values.length>0){var roleId=[];$.each(values,function(index,options){roleId.push(options.id)}),params.role=JSON.stringify(roleId)}if(void 0!==(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus=[];$.each(values,function(index,options){employeeStatus.push(options.id)}),params.employeeStatus=JSON.stringify(employeeStatus),params.incDateOfExit=!1,employeeStatus.indexOf("18")>-1&&Layout.Page.container.find("[name=incDateOfExit]").find("input").is(":checked")&&(params.incDateOfExit=!0)}return Leave.organizationTag.fetchParams(filterDiv,params),params.leaveyear=0,params.to=Calendar.formatDate(filterDiv.find('[name="dateFilter"]').data("selectedDate")),params.sIndex=ZPLite.Firescroll.getStartIndex(Leave.Reports.bradFordReport.Firescroll.mode),params.limit=30,"myReports"==ZPLite.Reports.selectedTab?params.viewMode=1:"teamReports"==ZPLite.Reports.selectedTab&&(params.viewMode=2),params.repType=ZPLite.Reports.selectedTab,params},generateReport:function(){var layout=Layout.Page.container;if(ZPLite.Firescroll.reset(layout.find("#bradFordReport"),Leave.Reports.bradFordReport.Firescroll.mode),layout.find("#bradFordReport").scrollTop(0),layout.find(".ZPNdata").fadeOut(100).remove(),Leave.Util.removeLoading(),$(ZPeople.LOADING_HTML).insertBefore(layout.find("#bradFordReport")),layout.find("#bradFordReport").addClass("DN"),!Leave.Reports.bradFordReport.emp_score_json.loaded){if(Leave.Reports.bradFordReport.isReportGenerationInProgress)return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.reportgenerate"));var params=Leave.Reports.bradFordReport.getParamsForReport();Leave.Reports.bradFordReport.isReportGenerationInProgress=!0,ZPeople.Request.send(Leave.Reports.url,params,function(result){if(result&&"permissionDenied"===result.error)Leave.Reports.Util.permDenied();else{if(Leave.Reports.bradFordReport.emp_score_json.emp_json={},Leave.Reports.bradFordReport.Response.isSuccess(result)&&result.header&&Object.keys(result.header).length>0&&result.data&&result.data.length>0){layout.find("#bradFordReport").removeClass("DN");var bradfords=result.header,headerEle=Leave.Reports.bradFordReport.constructHeader(bradfords),bodyEle=Leave.Reports.bradFordReport.constructData(bradfords,result.data),tableEle=$("#bradFordReportTable",Layout.Page.container);$(tableEle).html(""),$(tableEle).append(headerEle),$(tableEle).append(bodyEle),Leave.Util.showHideNoRecord(!1,!0),$("#bradFordReportTable",Layout.Page.container).delay(200).fadeIn(200).removeClass("DN"),ZPLite.Firescroll.init(Layout.Page.container.find("#bradFordReport"),Leave.Reports.bradFordReport.Firescroll.mode,{maxFetchLimit:30,callback:Leave.Reports.bradFordReport.Firescroll.loadMoreData}),ZPLite.Firescroll.setFetchedCount(Leave.Reports.bradFordReport.Firescroll.mode,result.data.length)}else result.message&&ZPeople.Message.showFailureMsg(result.message),Leave.Reports.Util.showHideNoRecord(!0,"bradFordReport");result&&result.from&&result.to&&$("[name=dateNavigatorText]",Layout.Page.container).removeClass("DNI").text(result.from+" - "+result.to),Leave.Reports.bradFordReport.emp_score_json.loaded=!0,Leave.Reports.bradFordReport.emp_score_json.allBradfordsAvailable=!params.level&&!params.bradford,Leave.Reports.bradFordReport.emp_score_json.headers=bradfords||{},Leave.Reports.bradFordReport.emp_score_json.params=params,Leave.Reports.bradFordReport.emp_score_json.params.from=result?result.from:result,result&&result.lastFetchedEmpIndex&&(Leave.Reports.bradFordReport.emp_score_json.params.lastFetchedEmpIndex=result.lastFetchedEmpIndex),Leave.Reports.bradFordReport.isReportGenerationInProgress=!1,Leave.Util.removeLoading()}})}},search:function(){Leave.Reports.bradFordReport.emp_score_json.loaded=!1,Leave.Reports.bradFordReport.isReportGenerationInProgress?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.reportgenerate")):Leave.Reports.bradFordReport.generateReport()},resetFilter:function(){Leave.Reports.bradFordReport.setDefaultFilterParams()},constructHeader:function(bradfords){var headerEle=$('<thead id="report_thead" class="TB_fxd" style="transition: top 0.3s ease 0s !important;"><tr class="ZPLHRow"><th style="max-width: 300px; width: 300px;" class="colM1_sticky"><div>'+ZPI18N.getString("zp.employee")+"</div></th></tr></thead>");return $.each(bradfords,function(bradfordId){headerEle.find("tr:first").append($('<th class="P0I text-center TBrdr"><table class="table i_table"><tbody><tr class="ZPLRow"><td colspan="2" style="text-align:center">'+bradfords[bradfordId]+'</td></tr><tr class="ZPLRow"><td width="50%"><div class="W120" style="margin-left:-20px">'+ZPI18N.getString("zp.bradfordfactor.bradfordscore")+'</div></td><td width="50%"><div class="W120">'+ZPI18N.getString("zp.bradfordfactor.threslevel")+"</div></td></tr></tbody></table></th>"))}),headerEle},constructData:function(bradfords,data){var bodyEle=$('<tbody id="report_tbody" bodyCont="true"></tbody>');for(var i in data){var emp_details,bradford_details,erecno,emp_json_arr=data[i];if($.each(emp_json_arr,function(idx){var emp_json=emp_json_arr[erecno=idx];emp_details=emp_json.emp_details,bradford_details=emp_json.bradford_details,Leave.Reports.bradFordReport.emp_score_json.emp_json[erecno]=emp_json}),emp_details&&bradford_details){var trEle=$('<tr class="ZPLRow" ></tr>');trEle.append($('<td class="CP fxdtd P_AM colM1_sticky" style="max-width: 300px; width: 300px;" onclick="Leave.Reports.bradFordReport.DetailView.redirect(\''+emp_details.erecno+"', '"+Leave.Reports.bradFordReport.DetailView.getCurUrl()+'\', \'true\', \'true\');"><div class="zpusImg"><img class="img-26" src="'+emp_details.empPhoto+'"><div class="zpusImg_nme"><span><strong class="ellipsis_nowdth" style="padding-right:5px" title="'+emp_details.empName+'"><b>'+emp_details.empId+" - </b>  "+emp_details.empName+'</strong><i class="IC-eye"></i></span></div></div></td>')),$.each(bradfords,function(bradfordId){var score=bradford_details[bradfordId]?bradford_details[bradfordId].score:"-",level=bradford_details[bradfordId]?ZPI18N.getString("zp.Level")+" "+bradford_details[bradfordId].level:"-";trEle.append($('<td class="P0I text-center TBrdr"><table class="table i_table" style="height:44px"><tbody><tr class="ZPLRow"><td width="50%"><div class="W120" style="margin-left:-20px">'+score+'</div></td><td width="50%"><div class="W120">'+level+"</div></td></tr></tbody></table></td>"))}),bodyEle.append(trEle)}}return bodyEle},DetailView:{url:"/leave_view_actions.zp",employee_bradford_key:"employee_bradford",modal_dtls:{employee:"",modal_hide_url:"",isUrlChanged:!0,showEmpSelect:!0},redirect:function(erecno,modal_hide_url,isUrlChange,showEmpSelect){Leave.Reports.bradFordReport.DetailView.regModal(erecno,modal_hide_url,isUrlChange,showEmpSelect),isUrlChange?window.location.href=Leave.Reports.bradFordReport.DetailView.getModalHideURL()+"/employee-id:"+erecno:Leave.Reports.bradFordReport.DetailView.get()},regModal:function(erecno,modal_hide_url,isUrlChange,showEmpSelect){Leave.Reports.bradFordReport.DetailView.setEmployee(erecno),Leave.Reports.bradFordReport.DetailView.setModalHideURL(modal_hide_url),Leave.Reports.bradFordReport.DetailView.setIsUrlChanged(isUrlChange),Leave.Reports.bradFordReport.DetailView.setIsShowEmpSelect(showEmpSelect)},setModalHideURL:function(modal_hide_url){Leave.Reports.bradFordReport.DetailView.modal_dtls.modal_hide_url=modal_hide_url||Leave.Reports.bradFordReport.DetailView.getCurUrl()},getModalHideURL:function(){return Leave.Reports.bradFordReport.DetailView.modal_dtls.modal_hide_url},setIsUrlChanged:function(isUrlChanged){Leave.Reports.bradFordReport.DetailView.modal_dtls.isUrlChanged=void 0===isUrlChanged||isUrlChanged},getIsUrlChanged:function(){return Leave.Reports.bradFordReport.DetailView.modal_dtls.isUrlChanged},setEmployee:function(erecno){Leave.Reports.bradFordReport.DetailView.modal_dtls.employee=erecno},getEmployee:function(){return Leave.Reports.bradFordReport.DetailView.modal_dtls.employee},setIsShowEmpSelect:function(showEmpSelect){Leave.Reports.bradFordReport.DetailView.modal_dtls.showEmpSelect=void 0===showEmpSelect||showEmpSelect},getIsShowEmpSelect:function(){return Leave.Reports.bradFordReport.DetailView.modal_dtls.showEmpSelect},getFromDate:function(){if(Leave.Reports.bradFordReport.emp_score_json&&Leave.Reports.bradFordReport.emp_score_json.params&&Leave.Reports.bradFordReport.emp_score_json.params.from)return Leave.Reports.bradFordReport.emp_score_json.params.from},getToDate:function(){var filterDate;return Leave.Reports.bradFordReport.DetailView.isFromReport()?!(filterDate=Layout.Page.container.find("#filterDiv").find('[name="dateFilter"]').val())&&Leave.Reports.bradFordReport.emp_score_json&&Leave.Reports.bradFordReport.emp_score_json.params&&Leave.Reports.bradFordReport.emp_score_json.params.to&&(filterDate=Leave.Reports.bradFordReport.emp_score_json.params.to):filterDate=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,filterDate},isFromReport:function(){return-1!==Layout.Page.hash.indexOf("leave/bradford/employee")},isAllBradfordsLoadedForEmp:function(){return Leave.Reports.bradFordReport.emp_score_json&&Leave.Reports.bradFordReport.emp_score_json.allBradfordsAvailable&&!0},setIsDiffDateInEmpCache:function(employee,currentTo){Leave.Reports.bradFordReport.emp_score_json.loaded&&employee&&Leave.Reports.bradFordReport.emp_score_json.emp_json[employee]&&(Leave.Reports.bradFordReport.emp_score_json.emp_json[employee].isDiffDate=currentTo!==Leave.Reports.bradFordReport.emp_score_json.params.to)},getIsDiffDateInEmpCache:function(employee){var isDiffDate=!0;return employee&&Leave.Reports.bradFordReport.emp_score_json.emp_json[employee]&&((isDiffDate=!0===Leave.Reports.bradFordReport.emp_score_json.emp_json[employee].isDiffDate)||Leave.Reports.bradFordReport.DetailView.isFromReport()||(isDiffDate=void 0===ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date!==Leave.Reports.bradFordReport.emp_score_json.params.to)),isDiffDate},getCurUrl:function(){return"myReports"==ZPLite.Reports.selectedTab?"#reports/my/leave/bradford":"teamReports"==ZPLite.Reports.selectedTab?"#reports/team/leave/bradford":"#reports/admin/leave/bradford"},get:function(){var employee=Leave.Reports.bradFordReport.DetailView.getEmployee(),to=Leave.Reports.bradFordReport.DetailView.getToDate();if(Leave.Util.appendLoading(),Leave.Reports.bradFordReport.emp_score_json.loaded&&Leave.Reports.bradFordReport.emp_score_json.emp_json[employee]&&!Leave.Reports.bradFordReport.DetailView.getIsDiffDateInEmpCache(employee)&&Leave.Reports.bradFordReport.DetailView.isAllBradfordsLoadedForEmp()){var emp_json=Leave.Reports.bradFordReport.emp_score_json.emp_json[employee];Leave.Reports.bradFordReport.DetailView.construct(Leave.Reports.bradFordReport.DetailView.getFromDate(),to,emp_json.emp_details||{},emp_json.bradford_details||{})}else{var params={key:Leave.Reports.bradFordReport.DetailView.employee_bradford_key,employee:employee,fetchLeave:!0};to&&Leave.Reports.bradFordReport.DetailView.isFromReport()&&(params.to=to),ZPeople.Request.send(Leave.Reports.bradFordReport.DetailView.url,params,Leave.Reports.bradFordReport.DetailView.empBradfordCallback)}},empBradfordCallback:function(result,params){Leave.Reports.bradFordReport.Response.isSuccess(result)&&result.data?(Leave.Reports.bradFordReport.emp_score_json.emp_json[params.employee]=result.data,Leave.Reports.bradFordReport.emp_score_json.allBradfordsAvailable=!0,Leave.Reports.bradFordReport.DetailView.setIsDiffDateInEmpCache(params.employee,result.to),Leave.Reports.bradFordReport.DetailView.construct(result.from,result.to,result.data.emp_details||{},result.data.bradford_details||{})):(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.scorelist")),Leave.Util.removeLoading(),window.location.href=Leave.Reports.bradFordReport.DetailView.getModalHideURL())},construct:function(from,to,emp_details,bradford_details){var showEmpSelect=Leave.Reports.bradFordReport.DetailView.getIsShowEmpSelect();if(0===Object.keys(emp_details).length){var userDtl=ZPeople.getUserDetailsById(Leave.Reports.bradFordReport.DetailView.getEmployee());emp_details={erecno:userDtl.usererec,empPhoto:userDtl.avatar,empId:userDtl.empid,empName:userDtl.name}}var headerHtml='<div class="zp-back" data-dismiss="modal"><i class="IC-ar-lft"></i></div><div class="row"></div><div class="row"><div class="col-md-4 MT8 PT5">';headerHtml+=showEmpSelect?'<div class="lt_btn reportsFilter" name="bfEmpFilter"></div>':'<div class="zpusImg"><img src="'+emp_details.empPhoto+'"><div class="zpusImg_nme"><span><strong class="ellipsis_nowdth"><b>'+emp_details.empId+" - </b> "+emp_details.empName+"</strong></span></div></div>",headerHtml+='</div><div class="col-md-4 MT8 PT5"><nav class="MT8"><ul class="pager ZP-YearPager"><li><i class="ZPCalNav">'+from+' <span class="DIB PL5 PR5">-</span> <span>'+to+'</span></i></li></ul></nav></div><div class="col-md-4 MT8 PT8"></div></div><a data-dismiss="modal" class="IC-cls close"></a>';var modal=ZPeople.BSModal.get({id:"zp_report_bradford_dtl",type:2,modalClass:"popRgtModel PopSsModel PopSgModel bdrfrd-empvw",headerHtml:headerHtml,body:'<div class="main-wrp"><div class="brd_vw" id="zp_bradford_dtl_view"></div></div>',disableSubmitButton:!0,whitebtnvalue:ZPI18N.getString("zp.close"),deleteOnHide:!0});if($(".modal-header>.close,.modal-header>.zp-back,#zp_modal_whitebtn",modal).on("click",function(){ZPeople.BSModal.hide("zp_report_bradford_dtl"),window.location.href=Leave.Reports.bradFordReport.DetailView.getModalHideURL()}),Object.keys(bradford_details).length>0){var tempDiv=$("<div></div>");$.each(bradford_details,function(bradfordId){var bf_json=bradford_details[bradfordId];$(tempDiv).append(Leave.Reports.bradFordReport.DetailView.constructBradfordSummary(to,bf_json,emp_details,bradfordId))}),tempDiv.find(".tgl_divhdr h5:first").trigger("click"),modal.find("#zp_bradford_dtl_view").append(tempDiv.children())}else Leave.Util.showHideNoRecord(!0,!1,modal.find(".main-wrp"),!1,void 0,ZPI18N.getString("zp.bradfordfactor.error.noscorelist"));showEmpSelect&&(Leave.Reports.Filters.clearCache(!0),Leave.Reports.Filters.constructFilter(Layout.Page.container.find('[name="bfEmpFilter"]'),"employee",!0,Leave.Reports.bradFordReport.filterOnChangeCallback,"LEAVE_BF_DET_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),ZPLite.Filters.setValues(Layout.Page.container.find('[name="bfEmpFilter"]'),[{id:emp_details.erecno,text:ZPeople.decodeTxt(ZPeople.escapeHtml(emp_details.empId+" "+emp_details.empName))}])),Leave.Util.removeLoading(),ZPeople.BSModal.show(modal,{backdrop:!1})},constructBradfordSummary:function(to,bf_json,emp_details,bradfordId){var div_ele=$('<div class="tgl_div"><div class="tgl_divhdr"><h5>'+bf_json.settingName+'</h5><div class="adVw_btns"><button class="btn btn-primary mrg MR10 DN">'+ZPI18N.getString("zp.bradfordfactor.mergeoccur")+'</button><button class="btn btn-primary splt DN">'+ZPI18N.getString("zp.bradfordfactor.splitmergeoccur")+'</button></div><div class="thrsh-lvls" style="z-index:1000; margin-top:-20px"></div><div class="brdfrd_scr"><span>'+ZPI18N.getString("zp.bradfordfactor.bradfordscore")+" - </span><b>"+bf_json.score+"</b><span>("+ZPI18N.getString("zp.Level")+" "+bf_json.level+")</span></div></div></div>");if(Leave.Reports.bradFordReport.CustomizeThreshold.isThresholdCustomizationAllowed()){var cust_thresEle=$('<span class="cust_thrsh">'+ZPI18N.getString("zp.bradfordfactor.customizethreshold")+"</span>");cust_thresEle.on("click",function(){Leave.Reports.bradFordReport.CustomizeThreshold.construct(this,to,emp_details.erecno,bradfordId,levels)}),div_ele.find(".thrsh-lvls").before(cust_thresEle)}if(bf_json.empBradfordLevels&&Leave.Reports.bradFordReport.Audit.isAllowedToView()){var auditEle=$('<i id="zp_level_audit" class="IC-info dgry CP popHover" data-placement="bottom" data-toggle="popover" data-html="true" data-animation="true" title="'+ZPI18N.getString("zp.bradfordfactor.customizethresaudit")+'"></i>');auditEle.on("click",function(){Leave.Reports.bradFordReport.Audit.getAudit(this,to,emp_details.erecno,bradfordId,bf_json.empBradfordLevels)}),div_ele.find(".thrsh-lvls").prepend(auditEle)}$(div_ele).find(".btn-primary.mrg").on("click",function(){Leave.Reports.bradFordReport.MergeOccurrences.merge(this,to,emp_details.erecno,bradfordId)}),$(div_ele).find(".btn-primary.splt").on("click",function(){Leave.Reports.bradFordReport.MergeOccurrences.split(this,to,emp_details.erecno,bradfordId)});for(var levels=bf_json.empBradfordLevels?bf_json.empBradfordLevels:bf_json.bradfordLevels,prev_threshold=0,prev_level=1,leveltxt="",i=0;i<levels.length;i++){var level_json=levels[i];leveltxt+='<div class="lvls"><span>'+ZPI18N.getString("zp.Level")+" "+level_json.level+"</span>"+(0===i?"":">")+prev_threshold+" - "+level_json.threshold+"</div>",prev_threshold=level_json.threshold,prev_level=level_json.level}return leveltxt+='<div class="lvls"><span>'+ZPI18N.getString("zp.Level")+" "+(prev_level+1)+"</span> >"+prev_threshold+"</div>",$(div_ele).find(".thrsh-lvls").append($(leveltxt)),$(div_ele).find(".tgl_divhdr h5, .brdfrd_scr").on("click",function(){Leave.Reports.bradFordReport.DetailView.showLeaveDetails(this,to,emp_details.erecno,bradfordId)}),div_ele},showLeaveDetails:function(ele,to,employee,bradfordId){var tgl_div=$(ele).closest("div.tgl_div"),leave_div=$(tgl_div).find(".sh-dtls");if(0===leave_div.length)if(Leave.Reports.bradFordReport.emp_score_json.emp_json[employee].bradford_details[bradfordId].leave_dtls)Leave.Reports.bradFordReport.DetailView.constructLeaveDetails(tgl_div,Leave.Reports.bradFordReport.emp_score_json.emp_json[employee].bradford_details[bradfordId]);else{Leave.Util.appendLoading({type:"popup",containerId:"zp_report_bradford_dtl",containerClass:"modal-body"}),Layout.Page.container.find("#zp_report_bradford_dtl .modal-body .main-wrp").fadeOut(100);var params={key:Leave.Reports.bradFordReport.DetailView.employee_bradford_key,employee:employee,bradfordId:bradfordId,to:to,fetchLeave:!0};ZPeople.Request.send(Leave.Reports.bradFordReport.DetailView.url,params,Leave.Reports.bradFordReport.DetailView.leaveDetailsCallback,{tgl_div:tgl_div})}else leave_div.slideToggle(),tgl_div.hasClass("opn")?tgl_div.removeClass("opn"):tgl_div.addClass("opn"),tgl_div.siblings().find(".sh-dtls").slideUp(),tgl_div.siblings().removeClass("opn")},leaveDetailsCallback:function(result,params,other_dtls){if(Leave.Reports.bradFordReport.Response.isSuccess(result)&&result.data&&Object.keys(result.data).length>0){var bf_json=result.data.bradford_details[params.bradfordId];Leave.Reports.bradFordReport.emp_score_json.emp_json[params.employee].bradford_details[params.bradfordId]=bf_json,Leave.Reports.bradFordReport.DetailView.constructLeaveDetails(other_dtls.tgl_div,bf_json)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.noleaves"));Leave.Util.removeLoading(),Layout.Page.container.find("#zp_report_bradford_dtl .modal-body .main-wrp").fadeIn()},constructLeaveDetails:function(tgl_div,bf_json){var leave_dtls_arr=bf_json.leave_dtls,isSingleLeaveAppl=!1;if(1===leave_dtls_arr.length){var leave_dtls=leave_dtls_arr[0];$.each(leave_dtls,function(mergeId){isSingleLeaveAppl=1===leave_dtls[mergeId].length})}var leave_div=$('<div class="sh-dtls"><div class="tblDv"><table class="table"><thead><tr>'+(Leave.Reports.bradFordReport.MergeOccurrences.isMergeSplitActionAllowed()&&!isSingleLeaveAppl?'<th id="check_all" width="40"><div class="checkbox"><input type="checkbox"><label class="MT3"></label></div></th>':"")+"<th>"+ZPI18N.getString("zp.leaveperiod")+"</th><th>"+ZPI18N.getString("zp.leavetype")+"</th><th>"+ZPI18N.getString("zp.leave.dtaken")+'</th><th width="300">'+ZPI18N.getString("zp.reason")+"</th>"+(Leave.Util.isApprovalConfigured()?'<th class="text-center">'+ZPI18N.getString("zp.approvalstatus")+"</th>":"")+'</tr></thead><tbody id="leave_tbody"></tbody></table></div><div class="stsbr"></div></div>');$(leave_div).find(".checkbox input").on("change",function(){Leave.Reports.bradFordReport.MergeOccurrences.onCheckboxAllStateChange(this)});for(var tbodyEle=$("<div></div>"),idx=0;idx<leave_dtls_arr.length;idx++){leave_dtls=leave_dtls_arr[idx];$.each(leave_dtls,function(mergeId){for(var leave_tr,leaveArr=leave_dtls[mergeId],isMerged="-1"!==mergeId&&leaveArr.length>1,i=0;i<leaveArr.length;i++){isMerged&&0!==i||(leave_tr=$('<tr class="'+(isMerged?"mrgd-occr":"")+'">'+(Leave.Reports.bradFordReport.MergeOccurrences.isMergeSplitActionAllowed()&&!isSingleLeaveAppl?'<td><div class="checkbox '+(isMerged?"spltOccr":"mrgOccr")+'"><input type="checkbox"><label class="MT3"></label></div></td>':"")+'<td id="td_date"></td><td id="td_type"></td><td id="td_days"></td><td id="td_reason"></td>'+(Leave.Util.isApprovalConfigured()?'<td id="td_status" class="text-center"></td>':"")+"</tr>"));var leaveObj=leaveArr[i];$(leave_tr).find("#td_date").append($('<div id="td_date_div" row="'+i+'" '+(isMerged?'class="mrgdts"':"")+">"+leaveObj.from+" - "+leaveObj.to+"</div>")),$(leave_tr).find("#td_date div#td_date_div[row="+i+"]").data("leaveId",leaveObj.leaveId),$(leave_tr).find("#td_type").append($("<div "+(isMerged&&i!==leaveArr.length-1?'class="MB30"':"")+">"+leaveObj.leaveTypeName+"</div>")),$(leave_tr).find("#td_days").append($("<div "+(isMerged&&i!==leaveArr.length-1?'class="MB30"':"")+">"+leaveObj.leaveTaken+" "+ZPI18N.getString("zp.days")+"</div>")),$(leave_tr).find("#td_reason").append($("<div "+(isMerged&&i!==leaveArr.length-1?'class="MB30"':"")+">"+(leaveObj.reason?leaveObj.reason:"")+"</div>")),Leave.Util.isApprovalConfigured()&&$(leave_tr).find("#td_status").append($("<div "+(isMerged&&i!==leaveArr.length-1?'class="MB30"':"")+">"+Leave.Reports.bradFordReport.DetailView.getStatusIcon(leaveObj.approvalStatus)+"</div>")),isMerged&&leaveArr.length-1!==i||($(leave_tr).data("mergeId",mergeId),$(leave_tr).data("leave_appl_cnt",i),tbodyEle.append(leave_tr))}})}tbodyEle.find("tr .checkbox input").on("change",function(){Leave.Reports.bradFordReport.MergeOccurrences.onCheckboxStateChange(this)}),leave_div.find("tbody#leave_tbody").append(tbodyEle.children()),leave_div.find(".stsbr").append($("<div><span>"+ZPI18N.getString("zp.bradfordfactor.occurrencen")+" -</span> <b>"+bf_json.no_of_instances+"</b></div><div><span>"+ZPI18N.getString("zp.bradfordfactor.totaldaysd")+" -</span> <b>"+bf_json.no_of_days.toFixed(2)+"</b></div><div><span>"+ZPI18N.getString("zp.bradfordfactor.scoref")+" -</span> <b>"+bf_json.no_of_instances+" * "+bf_json.no_of_instances+" * "+bf_json.no_of_days.toFixed(2)+"</b></div><div><b>"+bf_json.score+"</b> <span>("+ZPI18N.getString("zp.Level")+" "+bf_json.level+") </span></div>")),0===$(tgl_div).find(".sh-dtls").length?tgl_div.append(leave_div):$(tgl_div).find(".sh-dtls").replaceWith(leave_div),$(tgl_div).find(".sh-dtls").css("display","block"),tgl_div.addClass("opn"),tgl_div.siblings().find(".sh-dtls").css("display","none"),tgl_div.siblings().removeClass("opn")},getStatusIcon:function(approvalStatus){return-1==approvalStatus?'<i class="IC-pending org S18">':1==approvalStatus?'<i class="IC-like grn S18">':0==approvalStatus?'<i class="IC-unlike red S18">':2==approvalStatus?'<i class="IC-rejected red S18">':""}},Audit:{key:"bradford_emp_levels_audit",isAllowedToView:function(){return Leave.Util.isAllDataAdmin()},getAudit:function(ele,to,employee,bradfordId,bradfordLevels){if($(ele).data("content"))Leave.Reports.bradFordReport.Audit.showAudit(ele,$(ele).data("content"));else{var audit=Leave.Reports.bradFordReport.emp_score_json.emp_json[employee].bradford_details[bradfordId].audit;if(audit)Leave.Reports.bradFordReport.Audit.constructAudit(ele,audit,bradfordLevels);else{var params={key:Leave.Reports.bradFordReport.Audit.key,employee:employee,bradfordId:bradfordId,to:to};ZPeople.Request.send(Leave.Reports.url,params,Leave.Reports.bradFordReport.Audit.auditCallback,{ele:ele,bradfordLevels:bradfordLevels})}}},auditCallback:function(result,params,other_dtls){Leave.Reports.bradFordReport.Response.isSuccess(result)&&result.data&&result.data.length>0?result.data.length>0?(Leave.Reports.bradFordReport.emp_score_json.emp_json[params.employee].bradford_details[params.bradfordId].audit=result.data[0].audit,Leave.Reports.bradFordReport.Audit.constructAudit(other_dtls.ele,result.data[0].audit,other_dtls.bradfordLevels)):($(ele).data("content",ZPI18N.getString("zp.nochangesmade")),Leave.Reports.bradFordReport.Audit.showAudit(ele,ZPI18N.getString("zp.nochangesmade"))):result&&result.message?ZPeople.Message.showFailureMsg(result.message):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.audit"))},constructAudit:function(ele,time_json,bradfordLevels){var auditHtml="";$.each(time_json,function(created_time){var time_arr=time_json[created_time];auditHtml+="<div><span>"+ZPI18N.getString("zp.reason")+" :</span> <p>"+time_arr[0].reason+"</p></div><div><span>"+ZPI18N.getString("zp.bradfordfactor.customizedby",[""])+" :</span> "+time_arr[0].owner_details.empName+"</div><div><span>"+ZPI18N.getString("zp.bradfordfactor.customizedon",[""])+" :</span> "+time_arr[0].created_time+"</div><div><span>"+ZPI18N.getString("zp.bradfordfactor.prevthreshold")+' :</span> <div class="DIB">';for(var prev_level_json={},i=0;i<time_arr.length;i++){var data_json=time_arr[i];prev_level_json[data_json.level]=data_json.old_threshold}var prev_threshold=0,last_level=1;for(i=0;i<bradfordLevels.length;i++){var level_json=bradfordLevels[i],threshold=prev_level_json[level_json.level]?prev_level_json[level_json.level]:level_json.threshold;auditHtml+="<p>"+ZPI18N.getString("zp.Level")+" "+level_json.level+"  "+(0===i?prev_threshold:">"+prev_threshold)+" - "+threshold+"</p>",prev_threshold=threshold,last_level=level_json.level}auditHtml+="<p>"+ZPI18N.getString("zp.Level")+" "+(last_level+1)+"  >"+prev_threshold+"</p>",auditHtml+="</div></div>"}),$(ele).data("content",auditHtml),Leave.Reports.bradFordReport.Audit.showAudit(ele,auditHtml)},showAudit:function(ele,content){$(ele).closest(".thrsh-lvls").find(".popover.in").remove(),$(ele).popover("destroy"),$(ele).attr("data-content",content),$(ele).popover("show")}},MergeOccurrences:{key:"bradford_merge_occurrence",isMergeSplitActionAllowed:function(){return Leave.Util.isAllDataAdmin()},onCheckboxStateChange:function(ele){var tBodyEle=$(ele).closest("tbody#leave_tbody"),tgl_div=tBodyEle.parents(".tgl_div.opn");Leave.Reports.bradFordReport.MergeOccurrences.showHideActionButtons(tgl_div,tBodyEle),tBodyEle.find(".checkbox input:checked").length===tBodyEle.find(".checkbox input").length?tgl_div.find("th#check_all input").prop("checked",!0):tgl_div.find("th#check_all input").prop("checked",!1)},onCheckboxAllStateChange:function(ele){var tgl_div=$(ele).parents(".tgl_div.opn"),tBodyEle=tgl_div.find("tbody#leave_tbody");$(ele).is(":checked")?tBodyEle.find(".checkbox input").prop("checked",!0):tBodyEle.find(".checkbox input:checked").prop("checked",!1),Leave.Reports.bradFordReport.MergeOccurrences.showHideActionButtons(tgl_div,tBodyEle)},showHideActionButtons:function(tgl_div,tBodyEle){var selectedLeaveIdCnt=tBodyEle.find(".checkbox.mrgOccr input:checked").length,selectedMergeIdCnt=tBodyEle.find(".checkbox.spltOccr input:checked").length;selectedLeaveIdCnt+selectedMergeIdCnt>1?tgl_div.find(".adVw_btns .btn-primary.mrg").removeClass("disabled").show():tgl_div.find(".adVw_btns .btn-primary.mrg").hide(),selectedMergeIdCnt>0?tgl_div.find(".adVw_btns .btn-primary.splt").removeClass("disabled").show():tgl_div.find(".adVw_btns .btn-primary.splt").hide()},resetCheckBoxState:function(tgl_div){tgl_div.find(".adVw_btns .btn-primary.mrg,.btn-primary.splt").hide(),tgl_div.find("th#check_all input").prop("checked",!1),tgl_div.find("tbody#leave_tbody").find(".checkbox input:checked").prop("checked",!1)},merge:function(ele,to,employee,bradfordId){Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .tgl_div.opn",buttonClass:"btn-primary.mrg,.btn-primary.splt"});var leaveIds=new Array,tgl_div=$(ele).closest(".tgl_div.opn"),checkedEles=tgl_div.find("tbody#leave_tbody").find(".checkbox input:checked");if($.each(checkedEles,function(i){var checkedEle=checkedEles[i],leave_date_divs=$(checkedEle).closest("tr").find("td#td_date div#td_date_div");$.each(leave_date_divs,function(idx){leaveIds.push($(leave_date_divs[idx]).data("leaveId"))})}),leaveIds.length<2)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.minmergeleave")),Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .tgl_div.opn",buttonClass:"btn-primary.mrg,.btn-primary.splt"});else if(leaveIds.length>250)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.maxmergeleave")),Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .tgl_div.opn",buttonClass:"btn-primary.mrg,.btn-primary.splt"});else{Leave.Util.appendLoading({type:"popup",containerId:"zp_report_bradford_dtl",containerClass:"modal-body"}),Layout.Page.container.find("#zp_report_bradford_dtl .modal-body .main-wrp").fadeOut(100);var params={key:Leave.Reports.bradFordReport.MergeOccurrences.key,operation:"merge",leaveIds:JSON.stringify(leaveIds),employee:employee,bradfordId:bradfordId,to:to};ZPeople.Request.send(Leave.Reports.url,params,Leave.Reports.bradFordReport.MergeOccurrences.mergeSplitCallback,{tgl_div:tgl_div})}},split:function(ele,to,employee,bradfordId){Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .tgl_div.opn",buttonClass:"btn-primary.mrg,.btn-primary.splt"});var mergeIds=new Array,tgl_div=$(ele).closest(".tgl_div.opn"),checkedEles=tgl_div.find("tbody#leave_tbody").find(".checkbox input:checked");if($.each(checkedEles,function(i){var checkedEle=checkedEles[i],mergeId=$(checkedEle).closest("tr").data("mergeId");mergeId&&"-1"!==mergeId&&mergeIds.push(mergeId)}),mergeIds.length<1)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.minmergeid")),Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .tgl_div.opn",buttonClass:"btn-primary.mrg,.btn-primary.splt"});else if(mergeIds.length>250)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.maxmergeid")),Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .tgl_div.opn",buttonClass:"btn-primary.mrg,.btn-primary.splt"});else{Leave.Util.appendLoading({type:"popup",containerId:"zp_report_bradford_dtl",containerClass:"modal-body"}),Layout.Page.container.find("#zp_report_bradford_dtl .modal-body .main-wrp").fadeOut(100);var params={key:Leave.Reports.bradFordReport.MergeOccurrences.key,operation:"split",mergeIds:JSON.stringify(mergeIds),employee:employee,bradfordId:bradfordId,to:to};ZPeople.Request.send(Leave.Reports.url,params,Leave.Reports.bradFordReport.MergeOccurrences.mergeSplitCallback,{tgl_div:tgl_div})}},mergeSplitCallback:function(result,params,other_dtls){var isMerge="merge"===params.operation,skipReset=!1;if(Leave.Reports.bradFordReport.Response.isSuccess(result)){if(ZPeople.Message.showSuccessMsg(ZPI18N.getString(isMerge?"zp.bradfordfactor.success.mergesuccess":"zp.bradfordfactor.success.splitsuccess")),result.data){var bf_json=result.data.bradford_details[params.bradfordId];Leave.Reports.bradFordReport.emp_score_json.emp_json[params.employee].bradford_details[params.bradfordId]=bf_json,$(other_dtls.tgl_div).find(".adVw_btns .btn-primary.mrg,.btn-primary.splt").hide();var ntgl_div=Leave.Reports.bradFordReport.DetailView.constructBradfordSummary(params.to,bf_json,result.data.emp_details,params.bradfordId);$(other_dtls.tgl_div).replaceWith(ntgl_div),Leave.Reports.bradFordReport.DetailView.constructLeaveDetails(ntgl_div,bf_json),skipReset=!0}}else result&&result.message?ZPeople.Message.showFailureMsg(result.message):ZPeople.Message.showFailureMsg(ZPI18N.getString(isMerge?"zp.bradfordfactor.error.mergeerror":"zp.bradfordfactor.error.spliterror"));skipReset||(Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .tgl_div.opn",buttonClass:"btn-primary.mrg,.btn-primary.splt"}),Leave.Reports.bradFordReport.MergeOccurrences.resetCheckBoxState(other_dtls.tgl_div)),Leave.Util.removeLoading(),Layout.Page.container.find("#zp_report_bradford_dtl .modal-body .main-wrp").fadeIn(100)}},CustomizeThreshold:{key:"bradford_customize_level",isThresholdCustomizationAllowed:function(){return Leave.Util.isAllDataAdmin()},construct:function(ele,to,employee,bradfordId,bradfordLevels){var tgl_div=$(ele).parents(".tgl_div.opn"),body='<table class="table thrshld_tbl"><thead><tr class="zp"><th>'+ZPI18N.getString("zp.bradfordfactor.threslevel")+"</th><th>"+ZPI18N.getString("zp.bradfordfactor.thresrange")+'</th></tr></thead><tbody id="level_tbody"></tbody></table>',modal=ZPeople.BSModal.get({id:"cust_thrshld",type:2,modalClass:"zp_mdl mdl_cntr top cust-tRngePop",dialogClass:"zp_mdl-dlg",contentClass:"zp_mdl-cnt",headerClass:"zp_mdl-hdr",header:ZPI18N.getString("zp.bradfordfactor.customizethreshold"),bodyClass:"zp_mdl-bdy Nomdlfoot",body:body,footerClass:"zp_mdl-ftr",deleteOnHide:!0,buttonValue:ZPI18N.getString("zp.save"),closeOnSubmit:!1,successCallback:Leave.Reports.bradFordReport.CustomizeThreshold.save,extraDetails:{employee:employee,bradfordId:bradfordId,to:to,tgl_div:tgl_div,bradfordLevels:bradfordLevels}});$(modal).find(".zp_mdl-cnt").css("width","600px");var rows=Leave.Settings.Bradford.Operations.getLevelRows(bradfordLevels);$(rows).append($('<tr name="reason"><td>'+ZPI18N.getString("zp.bradfordfactor.customizereason")+'</td><td><textarea class="H80 form-control W300" placeholder="'+ZPI18N.getString("zp.enterreason")+'"></textarea></td></tr>')),modal.find(".zp_mdl-bdy tbody#level_tbody").append(rows.children()),ZPeople.BSModal.show(modal)},validate:function(modal,params){$(".error-clr",modal).removeClass("error-clr"),$(".error-msg",modal).remove();for(var extraDetails=modal.data("extraDetails"),tBody=$("#level_tbody",modal),bradfordLevels=extraDetails.bradfordLevels,bradford_level_json={},i=0;i<bradfordLevels.length;i++)bradford_level_json[bradfordLevels[i].level]=bradfordLevels[i].threshold;var thresholdValues="",thresholdArr=new Array,isChangeInThreshold=!1,leveltrs=tBody.find("tr[level]");for(i=0;i<leveltrs.length-1;i++){var threshold=$("input#zp_level"+(i+1),leveltrs[i]).val();if(ZPUtil.Validation.isEmpty(threshold)||"SUCCESS"!==ZPUtil.Validation.isDecimal(threshold).message)return $("input#zp_level"+(i+1),leveltrs[i]).addClass("error-clr"),$("input#zp_level"+(i+1),leveltrs[i]).after('<div class="error-msg">'+ZPI18N.getString("zp.bradfordfactor.error.validthreshold")+"</div>"),!1;if(-1!==thresholdArr.indexOf(threshold))return $("input#zp_level"+(i+1),leveltrs[i]).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({bradfordLevels:ZPI18N.getString("zp.bradfordfactor.error.dupthreshold")},modal),!1;thresholdArr.push(threshold),thresholdValues+=threshold+",",parseFloat(threshold)!==bradford_level_json[i+1]&&(isChangeInThreshold=!0)}if(!isChangeInThreshold)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nochangesmade")),!1;if(ZPUtil.Validation.isEmpty(thresholdValues))return Leave.Settings.Bradford.Operations.appendErrorMsg({bradfordLevels:ZPI18N.getString("zp.bradfordfactor.error.validlevelthreshold")},modal),!1;params.bradfordLevels=thresholdValues;var reasonEle=tBody.find("tr[name='reason'] textarea");return ZPUtil.Validation.isEmpty(reasonEle.val())?(reasonEle.addClass("error-clr"),reasonEle.after('<div class="error-msg">'+ZPI18N.getString("zp.bradfordfactor.error.levelcustomizereason")+"</div>"),!1):reasonEle.val().length>5e3?(reasonEle.addClass("error-clr"),reasonEle.after('<div class="error-msg">'+ZPI18N.getString("zp.bradfordfactor.error.thresreasonlen")+"</div>"),!1):(params.reason=reasonEle.val(),!0)},save:function(modal){Leave.Util.toggleButton({containerId:"cust_thrshld",buttonClass:"btn-primary"});var extraDetails=modal.data("extraDetails"),employee=extraDetails.employee,bradfordId=extraDetails.bradfordId,to=extraDetails.to,params={key:Leave.Reports.bradFordReport.CustomizeThreshold.key,employee:employee,bradfordId:bradfordId,to:to};Leave.Reports.bradFordReport.CustomizeThreshold.validate(modal,params)?ZPeople.Request.send(Leave.Reports.url,params,Leave.Reports.bradFordReport.CustomizeThreshold.saveCallback,{tgl_div:extraDetails.tgl_div}):Leave.Util.toggleButton({containerId:"cust_thrshld",buttonClass:"btn-primary"})},saveCallback:function(result,params,other_dtls){if(Leave.Reports.bradFordReport.Response.isSuccess(result)){if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.bradfordfactor.success.customizethressuccess")),result.data){var bf_json=result.data.bradford_details[params.bradfordId];Leave.Reports.bradFordReport.emp_score_json.emp_json[params.employee].bradford_details[params.bradfordId]=bf_json;var ntgl_div=Leave.Reports.bradFordReport.DetailView.constructBradfordSummary(params.to,bf_json,result.data.emp_details,params.bradfordId);$(other_dtls.tgl_div).replaceWith(ntgl_div),Leave.Reports.bradFordReport.DetailView.constructLeaveDetails(ntgl_div,bf_json)}}else result&&result.message?ZPeople.Message.showFailureMsg(result.message):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.customizethreserror"));Leave.Util.toggleButton({containerId:"cust_thrshld",buttonClass:"btn-primary"}),ZPeople.BSModal.hide("cust_thrshld")}},Response:{isSuccess:function(result){return result&&"success"===result.status}},Firescroll:{mode:"BRADFORD_REPORT",loadMoreData:function(){var params=Leave.Reports.bradFordReport.getParamsForReport();ZPeople.Request.send(Leave.Reports.url,params,function(result){if(Leave.Reports.bradFordReport.Response.isSuccess(result)&&result.data&&result.data.length>0){ZPLite.Firescroll.setActiveStatus(Leave.Reports.bradFordReport.Firescroll.mode,!1),delete Leave.Reports.bradFordReport.emp_score_json.params.lastFetchedEmpIndex;var bodyEle=$("#bradFordReportTable tbody#report_tbody",Layout.Page.container),newBodyEle=Leave.Reports.bradFordReport.constructData(Leave.Reports.bradFordReport.emp_score_json.headers,result.data);bodyEle.append(newBodyEle.children()),result.lastFetchedEmpIndex&&(Leave.Reports.bradFordReport.emp_score_json.params.lastFetchedEmpIndex=result.lastFetchedEmpIndex),Leave.Reports.bradFordReport.isReportGenerationInProgress=!1,Leave.Util.removeLoading(),ZPLite.Firescroll.setFetchedCount(Leave.Reports.bradFordReport.Firescroll.mode,result.data.length)}else ZPLite.Firescroll.setFetchedCount(Leave.Reports.bradFordReport.Firescroll.mode,0)})}}},showReportErrorMsg:function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.leave.reports.errormsg"));var noDataHTML=ZPUtil.newNoDataHTML("CR-nodata-rpt","path6");Layout.Page.container.find("#pageDiv").append(noDataHTML),Leave.Util.removeLoading()}},Leave.greythr={handlePayrollLOPPush:function(actions,obj){for(var parentDiv=$("#lopGtPush"),rsid=(parentDiv.find("input[name = pushByRad]:checked").val(),ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'))[0].id),payPeriodObj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod,i=0;i<payPeriodObj.length;i++)if(payPeriodObj[i].rsID==rsid)var payPariodLoc=payPeriodObj[i].rsLocationsObj,payPeriodempTypes=payPeriodObj[i].rsEmpTypes,payPeriodRole=payPeriodObj[i].rsRoles;var showPopUp=!0,payPariodLocIds=Object.keys(payPariodLoc),payPeriodRoleIds=Object.keys(payPeriodRole);if(0==payPariodLocIds.length&&0==payPeriodempTypes.length&&0==payPeriodRoleIds.length?payPariodLocIds.push("-1"):0!=payPariodLocIds.length||0==payPeriodempTypes.length&&0==payPeriodRoleIds.length||(showPopUp=!1),showPopUp){var monthBox=parentDiv.find("#monBox"),yearBox=parentDiv.find("#yrBox"),payCycBox=parentDiv.find("#payCycBox"),locBox=parentDiv.find("#locBox"),servBox=parentDiv.find("#serviceBox");$("#locBox").select2({width:"100%"}),$("#payCycBox").select2({width:"100%"}),$("#serviceBox").select2({width:"100%"});yearBox.find(":selected").text(),parentDiv.find("input[name = pushByRad]:checked").val();if("getServices"==actions)ZPeople.Request.send("/integrations/payroll/handleAttendanceMonthYears",{actions:actions,locations:JSON.stringify(payPariodLocIds)},function(resltObj){Leave.greythr.handlePayrollLOPPush.services=resltObj.services,0!=Leave.greythr.handlePayrollLOPPush.services.length?(parentDiv.modal(),parentDiv.find("#serviceBox").show(),parentDiv.find("option#serviceS").remove(),parentDiv.find("#zp_paymentinteg_attEmps").removeAttr("value"),parentDiv.find("#s2id_zp_paymentinteg_attEmps").find("li").remove(),parentDiv.find("#empSrchDiv").hide(),$.each(resltObj.services,function(k,v){servBox.append('<option id="serviceS" value='+v.IntegId+">"+v.domain+" ("+v.serviceName+")</option>")}),Leave.greythr.handlePayrollLOPPush.locIds=[],servBox.select2("val","0")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.payperiodNotSupportServices"))});else if(0!=Leave.greythr.handlePayrollLOPPush.services.length||"0"!=servBox.val())if("getLocs"==actions)parentDiv.modal(),parentDiv.find("#locBox").show(),parentDiv.find("option#locationS").remove(),parentDiv.find("#zp_paymentinteg_attEmps").removeAttr("value"),parentDiv.find("#s2id_zp_paymentinteg_attEmps").find("li").remove(),parentDiv.find("#empSrchDiv").hide(),null!=(serviceId=servBox.val())&&ZPeople.Request.send("/integrations/payroll/handleAttendanceMonthYears",{actions:actions,integId:serviceId},function(resltObj){Leave.greythr.handlePayrollLOPPush.orgLocs=resltObj.orgLocs;var orgLoclen=Leave.greythr.handlePayrollLOPPush.orgLocs.length;if(Leave.greythr.handlePayrollLOPPush.locIds=[],resltObj.hasOwnProperty("payLocations"))$.each(resltObj.payLocations,function(k,v){if("-1"!=payPariodLocIds[0])for(var i=0;i<payPariodLocIds.length;i++)payPariodLocIds[i]==v.locId&&(Leave.greythr.handlePayrollLOPPush.locIds.push(v.locId),locBox.append('<option id="locationS" value='+v.locId+">"+v.locName+"</option>"));else Leave.greythr.handlePayrollLOPPush.locIds.push(v.locId),locBox.append('<option id="locationS" value='+v.locId+">"+v.locName+"</option>")}),locBox.select2("val","0");else{var payLoclen=Leave.greythr.handlePayrollLOPPush.locIds.length;orgLoclen>0&&0==payLoclen?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.gtnolocinsetting")):0==orgLoclen&&Leave.greythr.handlePayrollLOPPush("getPayCycles"),locBox.select2("val","0")}Leave.greythr.handlePayrollLOPPush.eTypes=resltObj.eTypes}),locBox.select2("val","0");else if("getPayCycles"==actions){var locId=locBox.val();payCycBox.select2("val","0"),payCycBox.prop("disabled",!1),null!=locId&&ZPeople.Request.send("/integrations/payroll/handleAttendanceMonthYears",{actions:actions,locationId:locId},function(resltCyc){if(resltCyc.hasOwnProperty("payCycles")){parentDiv.find("option#payCyc").remove(),payCycBox.select2("val","0");var paycycl=resltCyc.payCycles;Object.keys(paycycl).sort().reverse().forEach(function(k,v){payCycBox.append('<option id="payCyc" value='+k+">"+paycycl[k]+"</option>")})}})}else if("fetchLocEmployees"==actions){monthBox.find(":selected").val(),yearBox.find(":selected").text();parentDiv.find("#usrSelDiv").show(),parentDiv.find("#pushBySubDv").hide(),parentDiv.find("#zp_paymentinteg_attEmps").removeAttr("value");(orgLocLen=Leave.greythr.handlePayrollLOPPush.locIds.length)>0&&0!=locBox.val()&&0!=payCycBox.val()&&(parentDiv.find("#empSrchDiv").show(),Leave.greythr.constructQuickPushList())}else if("pushAttToPayroll"==actions){monthBox.find(":selected").val(),yearBox.find(":selected").text(),locBox=$("#locBox").val();var serviceId=servBox.val(),empAry=ZPeopleComponents.tokenfield(document.getElementById("zp_paymentinteg_attEmps")).getAllValues().map(value=>value.erecno),orgLocLen=Leave.greythr.handlePayrollLOPPush.orgLocs.length,payCycle=(Leave.greythr.handlePayrollLOPPush.locIds.length,payCycBox.val());0==orgLocLen&&0!=payCycle||orgLocLen>0&&null!=locBox&&0!=locBox&&0!=payCycle?(parentDiv.find("#pushRotate").show(),ZPeople.Request.send("/integrations/payroll/pushAttendanceDataToPayroll",{payCycle:payCycle,employees:JSON.stringify(empAry),locationID:locBox,integId:serviceId},function(resltErr){parentDiv.find("#pushRotate").hide();var empErr=null,errMsg="",errMs="",oErr=null,servName=null;if(resltErr.hasOwnProperty("serviceName")&&(servName=resltErr.serviceName),resltErr.hasOwnProperty("errDtls")){var errDtls=resltErr.errDtls;errDtls.hasOwnProperty("PAYROLL-NOT-FOUND")&&(errMsg+=ZPI18N.getString("zp.gtpaycyclenotexist",new Array(errDtls.PAYROLL-NOT-FOUND))),errDtls.hasOwnProperty("empNotFound")&&(empErr=errDtls.empNotFound),errDtls.hasOwnProperty("othrErrs")&&(oErr=errDtls.othrErrs)}resltErr.hasOwnProperty("noEmp")&&(errMsg+=ZPI18N.getString("zp.gtnoempinpref")),resltErr.hasOwnProperty("prefEmpty")&&(errMsg+=ZPI18N.getString("zp.gtemptyemtype")),resltErr.hasOwnProperty("noReport")&&(errMsg+=ZPI18N.getString("zp.gtnolopreport")),resltErr.hasOwnProperty("exception")&&(errMsg+=ZPI18N.getString("zp.sorryservererror")),""!=errMsg&&ZPeople.Message.showFailureMsg(errMsg),null!=empErr&&empErr.length>0&&(errMs+="<p><b>"+ZPI18N.getString("zp.gtempnotingtlop")+"</b></p><span>"+empErr+"</span>"),null!=oErr&&(errMs+='<p class="MB0 MT5"><b>Other Errors</b></p>',$.each(oErr,function(key,val){errMs+='<p><i class="IC-r-close red MR5 S13 ML2"></i>'+val+"</p>"})),""!=errMsg||null!=empErr&&0!=empErr.length||null!=oErr&&0!=oErr.length||(resltErr.hasOwnProperty("LOPmailed")?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.loppushmailed")):errDtls.hasOwnProperty("success_emp")&&("GreyTip"==servName?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.gtattpushsuccess")):"PayBooks"==servName?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.pbattpushsuccess")):"ZPayroll"==servName&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.zpattpushsuccess")))),null!=errMs&&""!=errMs&&($("#lopPushErrMsgs").html(errMs),parentDiv.find("#lopErrMsgDv").trigger("click"))})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.gtproperinput"))}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.empTypeBasedPayPeriod"))},searchUserExtraParamCallback:function(){var extras={},cycDt=$("#payCycBox").val(),enIndex=cycDt.indexOf(":"),enDt=cycDt.substring(enIndex+1,cycDt.length);return extras.doj=enDt,extras.locationId=$("#locBox").val(),extras.etypeids=Leave.greythr.handlePayrollLOPPush.eTypes,extras},constructQuickPushList:function(){var tokenObj={dataMapping:{value:"erecno",id:"erecno",text:"fullName",image:"image",searchText:"searchText",email:"email",employeeID:"employeeID"},dropdownList:{contentType:"image-text",loaderIconClassName:"sample",isTextHTMLEncoded:!0},search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults"),minKeywordLength:1,by:["searchText","email","employeeID"]},placeholder:"All employees in location"};tokenObj.dataSource={search:function(params){return new Promise(function(search,reject){search({results:function(query){let response;return ZPeople.Request.sendAsyncPost("/commonAction.zp",{mode:"SEARCH",key:query,start:1,searchType:"emp",searchMode:"GreyTipAttPush",extraparam:JSON.stringify(Leave.greythr.searchUserExtraParamCallback())},function(data){var result=[];data.hasOwnProperty("results")&&data.results.length>0?result=data.results:data.hasOwnProperty("matches")&&data.matches.length>0&&(result=data.matches),response=Leave.greythr.convertUserArrayToUserObject(result)}),response}(params.query),more:!1})})},paginated:!0,serverSearch:!0},ZPeopleComponents.tokenfield(settingsPage.container.find("#zp_paymentinteg_attEmps"),tokenObj)},convertUserArrayToUserObject:function(userDetailArray){return userDetailArray.map(userArray=>{let userDetail={};return userDetail.erecno=userArray[0],userDetail.employeeID=userArray[1],userDetail.email=userArray[4],userDetail.zuid=userArray[5],userDetail.image=""!==userArray[6]?"viewPhoto?filename="+userArray[6]:contactUrl+"/file?ID="+userArray[5]+"&fs=thumb",userDetail.fullName=userArray[1]+" "+ZPeople.getUserDisplayName(userArray[2],userArray[3]),userDetail.searchText=userArray[2]+" "+userArray[3],userDetail})}},Leave.Settings.Import={},Leave.Settings.Import.imp_tempdata={},Leave.Settings.Import.selectFile=function(){var moday_body=$(Layout.Page.container.find("#"+Layout.Page.pageId+"-import")),filename=moday_body.find("[name=file_data]")[0].files[0].name,next=$(moday_body.find(".modal-footer > #Next")),filebox=$(moday_body.find("#import_file_selected"));void 0!=filename&&""!=filename.trim()?(next.show(),filebox.find("#file_name").text(filename),filebox.fadeIn(300),moday_body.find("#import_file").hide()):Leave.Settings.Import.showimport()},Leave.Settings.Import.showimport=function(){var moday_body=$(Layout.Page.container.find("#"+Layout.Page.pageId+"-import")),import_file=$(moday_body.find("#import_file"));$(moday_body.find("#import_file_selected")).hide(),import_file.find("[name=file_data]").val(""),import_file.fadeIn(300)},Leave.Settings.Import.handleimport_resp=function(response){if("success"==response.status)if("leavetracker-views-compensatory"===Layout.Page.pageId||"leavetracker-compensatory-applications"===Layout.Page.pageId)$(Layout.Page.container.find("#"+Layout.Page.pageId+"-import")).removeClass("PopLgModel"),Leave.Settings.Import.mapping_page(response,"",Leave.Compensatory.Import.import_mapped_data);else if("leavetracker-reports-lop"===Layout.Page.pageId)Leave.Settings.Import.mapping_page(response,"",Leave.Report.LOP.Import.import_mapped_data);else if(-1!=Layout.Page.pageId.indexOf("leave-lop"))Leave.Settings.Import.mapping_page(response,"",Leave.Reports.lopReport.Import.import_mapped_data);else if("leavetracker-settings-customizebalance"===Layout.Page.pageId){(impModal=Layout.Page.container.find("#"+Layout.Page.pageId+"-import")).find("#Next").prop("disabled",!1),impModal.find("#zp_page_loading").remove(),impModal.find(".modal-body").addClass("P0I").append('<div class="label-message MB20" id="recordsfoundDiv" style="display: block;"><p class="blu">'+response.recordCount+" Records found</p></div>"),Leave.Settings.Import.mapping_page(response,"",Leave.Policy.Transaction.Import.import_mapped_data)}else Leave.Settings.Import.mapping_page(response,response.requestURL,Leave.Settings.Import.import_mapped_data);else if(response.isBGProcessRunning){(impModal=Layout.Page.container.find("#"+Layout.Page.pageId+"-import")).find("#Next").prop("disabled",!1),impModal.find("#zp_page_loading").remove(),impModal.find("#form").show(),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.leavetype.v2.error.importrestricted"))}else if(response.rowLimitExceeded){var impModal;(impModal=Layout.Page.container.find("#"+Layout.Page.pageId+"-import")).find("#Next").removeAttr("disabled"),impModal.find("#zp_page_loading").remove(),impModal.find("#form").show(),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.importcntexceederror"))}},Leave.Settings.Import.mapping_page=function(response,requestURL,nextCallback){if("success"==response.status){var imp_modal=$(Layout.Page.container.find("#"+Layout.Page.pageId+"-import")),moday_body=$(imp_modal.find(".modal-dialog > .modal-content > .modal-body"));$(imp_modal.find("#mapping_header")).addClass("active"),$(imp_modal.find(".modal-footer > #Next")).off("click"),$(imp_modal.find(".modal-footer > #Next")).on("click",nextCallback),$(imp_modal.find(".modal-body > #import_help")).addClass("DN");var mapping=$('<div id="mapping" class="col-sm-6" style="display:none"></div>'),headers=response.headers;$(moday_body.find("#form")).hide();var select="<select class='PT10'><option value='-1'>-- "+ZPI18N.getString("zp.select")+" --</option>";$.each(headers,function(i,header_name){select+="<option value='"+i+"'>"+header_name+" (c:"+i+")</option>"}),select+="</select>",Leave.Settings.Import.imp_tempdata=response.request_params,mapping.append('<input type="hidden" name="req_url" value="'+requestURL+'" />'),Leave.Settings.Import.mapping_data(mapping,response.fields,select),$(mapping.find("select")).select2(),$(mapping.find("select")).parent().find(".select2-container").removeAttr("style"),moday_body.append(mapping),mapping.fadeIn(300)}},Leave.Settings.Import.mapping_data=function(container,fields,select){$.each(fields,function(idx,field){var field_comp=$("<div class='form-group'></div>");field_comp.append(field.ignoreMandatory?"<lable >"+field.lable+"</lable>":'<lable class="zp_mdt"><font>'+field.lable+"</font></lable>"),field_comp.append($(select).attr("name",field.name).val(0==$(select).find("[value="+idx+"]").length?"-1":idx)),field_comp.append('<div id="error_span" class="DN red MT5">'+ZPI18N.getString("zp.MandatoryFieldMap")+"</span>"),container.append(field_comp)})},Leave.Settings.Import.import_mapped_data=function(){var imp_modal=$(Layout.Page.container.find("#"+Layout.Page.pageId+"-import")),url=$(imp_modal.find("[name=req_url]")).val(),params=Leave.Settings.Import.imp_tempdata;params.empMapVal=imp_modal.find("[name=empMapVal]").val(),$.each(imp_modal.find("select"),function(idx,ele){params[$(ele).attr("name")]=$(ele).val()}),ZPeople.Request.send(url,params,function(response){if("success"==response.result||"success"==response.msg){var succesmsg='<div class="ZPImfrm ZPRecList"><div class="PR"><div class="ZPfileBox text-center PT40 PB40 grnbr"><i class="IC-docs imtIcn DIB blu"></i><p class="MB15"><b>The selected file has been <br> imported successfully</b></p></div><div class="ZPSAdflds infomsg MT20"><ul class="list MT20"><li>Number of records added<span id="added" class="rcount">'+(void 0!=response.rowcount?response.rowcount:response.addedCount)+'</span></li><li>Number of records updated<span id="noOfUpdate" class="rcount">0</span></li><li>Number of records skipped<span id="noOfSkip" class="rcount">0</span></li><li>Number of errors<span id="noOfErr" class="rcount">0</span></li></ul></div></div></div>';$(imp_modal.find("#mapping")).hide(),$(imp_modal.find(".modal-body")).append(succesmsg),$(imp_modal.find("#Next")).hide()}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.leave.import.error"));Layout.Page.call(Layout.Page.hashDtl.callback)})},Leave.Settings.Import.help='<div class="MT30 ML30" id="import_help"><p><b class="DB dgry">'+ZPI18N.getString("zp.example")+'</b></p><table class="table table-hover S13"><tbody><tr class="TblGryBg "><th class="PL12I" width="50"></th><th>A</th><th>B</th><th>C</th></tr><tr class="ZPLRow"><th class="PL12I">1</th><td>Employee ID</td><td>Leave Type</td><td id=>*import_column_name*</td></tr><tr class="ZPLRow"><th class="PL12I">2</th><td>ZCON001</td><td>Casual Leave</td><td>2</td></tr><tr class="ZPLRow"><th class="PL12I">3</th><td>Employee 47</td><td>Unpaid Hours</td><td>10</td></tr></tbody></table></div>',Leave.Report={url:"/leave_reports_actions.zp",exporturl:"leave_reports_export.zp",url2:"/leave_v2_reports_actions.zp",exporturl2:"leave_v2_reports_export.zp"},Leave.Report.LYear={employee:"",refresh:!1,initPage:function(){LVUtil.Tab.InitPage(Leave.Report.LYear.init,!1)},init:function(){ZPeople.Module.getData("leavetracker").leave_filterops.isV1User?(Leave.Util.regHeader(),Leave.Report.LYear.get()):window.location.href="#leavetracker/reports/user"},get:function(){var params={key:"report_yearly"},header=Layout.Page.container.find(".ZPPhed");if(""!=Leave.Report.LYear.employee){$("input[name=employee]",header).val([Leave.Report.LYear.employee]),$("a.select2-choice span",header).text(ZP.getUserDetailsById(Leave.Report.LYear.employee).name);var empObj=ZP.getUserDetailsById(Leave.Report.LYear.employee);Layout.Page.container.find(".Usrimg").attr("src",empObj.photo);var loc="null"!=empObj.location?empObj.location:"-1";return Leave.Util.populateDateBasedOnLocation(loc),Leave.Report.LYear.employee="",void header.find(".IC-list-v").parent("button").trigger("click")}var display_ele=$(".btn-primary i",header),callback=Leave.Report.LYear.chart_html;display_ele.hasClass("IC-chart")?(params.display=0,callback=Leave.Report.LYear.chart_html):(params.display=1,callback=Leave.Report.LYear.list_html),Leave.Util.filterCrt(params),Leave.Util.appendLoading(),ZPeople.Request.send(Leave.Report.url,params,callback,{},Leave.Report.showReportErrorMsg),Leave.Report.LYear.refresh=!1},list_html:function(resp,params,callback){if("success"===resp.status){var tempDoc=document.createDocumentFragment(),data_arr=resp.data.report,data_div=$("#ZP_Leave_Reports_Yearly_List",Layout.Page.container);ZPeople.Module.getData("leavetracker").leave_filterops.issettingsadmin;if(data_arr[0]&&!_.isEmpty(data_arr[0].leavetypes)){var leave_types=data_arr[0].leavetypes;for(var indx in leave_types){var leave_type=leave_types[indx],data_tr=ZP.create("tr",{class:"ZPLRow"}),nametd=ZP.create("td");nametd.appendChild(ZP.create("div",{class:"ZPLtyp CL"+leave_type.color})),$(nametd).append(leave_type.name);var allowedtd=ZP.create("td",{text:ZP.optValue(leave_type,"allowed","-")}),takentd=ZP.create("td",{text:ZP.optValue(leave_type,"taken",0)}),accPC=(ZP.create("td",{text:ZP.optValue(leave_type,"lop",0)}),leave_type.accPeriodicCount);if("object"==typeof accPC){var info=ZP.create("i",{class:"IC-info S18 gry ML10 popHover","data-popover":"true","data-html":"true","data-content":Leave.Report.LYear.getPeriodicDetails(accPC)});nametd.appendChild(info),nametd.appendChild(ZP.create("br")),Leave.Util.appendinfomsg(nametd,ZPI18N.getString("zp.leavereport.accrualreset.info",[ZP.optValue(leave_type,"accrualperiod")]))}else leave_type.isRollOver&&(allowedtd.appendChild(ZP.create("br")),Leave.Util.appendinfomsg(allowedtd,ZP.optValue(leave_type,"leave_count",0)+" + "+ZPI18N.getString("zp.leave.initialbalance")+" ( "+ZP.optValue(leave_type,"ibCount",0)+" )"));data_tr.appendChild(nametd),data_tr.appendChild(allowedtd),data_tr.appendChild(takentd);var availabletd=ZP.create("td",{text:ZP.optValue(leave_type,"available","-")});if(ZPeople.Module.getData("leavetracker").leave_filterops.isV1User){var info_txt="";leave_type.hasOwnProperty("lapsed")&&leave_type.lapsed>0&&(info_txt=ZPI18N.getString("zp.leave.lapsed")+" ( "+ZP.optValue(leave_type,"lapsed",0)+" )"),leave_type.hasOwnProperty("expired_count")&&leave_type.expired_count>0&&(info_txt+=info_txt?", ":"",info_txt+=ZPI18N.getString("zp.leave.report.expiredcount")+" ( "+ZP.optValue(leave_type,"expired_count",0)+" )"),leave_type.hasOwnProperty("lop")&&leave_type.lop>0&&(info_txt+=info_txt?", ":"",info_txt+=ZPI18N.getString("zp.lop")+" ( "+ZP.optValue(leave_type,"lop",0)+" )"),info_txt&&(availabletd.appendChild(ZP.create("br")),Leave.Util.appendinfomsg(availabletd,info_txt)),data_tr.appendChild(availabletd)}else{data_tr.appendChild(availabletd);var lapsedTd=ZP.create("td",{text:ZP.optValue(leave_type,"lapsed",0)});data_tr.appendChild(lapsedTd)}tempDoc.appendChild(data_tr)}data_div.removeClass("DN"),data_div.siblings("div#ZP_Leave_Reports_Yearly_Chart_Parent").addClass("DN"),data_div.data("isreg")||(ZPView.handleTablePosition(),data_div.data("isreg",!0)),(data_tbody=$("tbody",data_div)).html(""),data_tbody.append(tempDoc),$("i.IC-info",data_tbody).popover({trigger:"hover",container:"body"}),Leave.Util.showHideNoRecord(!1,!1,data_div)}else{var data_tbody;data_div.removeClass("DN"),data_div.siblings("div#ZP_Leave_Reports_Yearly_Chart_Parent").addClass("DN"),(data_tbody=$("tbody",data_div)).html(""),Leave.Util.showHideNoRecord(!0,!1,data_div)}}Leave.Util.removeLoading(),null!==callback&&void 0!==callback&&"function"==typeof callback&&callback()},chart_html:function(resp,params,callback){if("success"===resp.status){var count_arr=resp.data.report[0]?resp.data.report[0].leavetypes:{},chart_parent=$("#ZP_Leave_Reports_Yearly_Chart_Parent",Layout.Page.container);chart_parent.removeClass("DN"),chart_parent.siblings("div#ZP_Leave_Reports_Yearly_List").addClass("DN");var color=[],ltaken=[],lavail=[],name=[];$("#ZP_Leave_Reports_Yearly_Chart",chart_parent).show();if(_.isEmpty(count_arr))return Leave.Util.removeLoading(),void Leave.Util.showHideNoRecord(!0,!0,chart_parent);for(var indx in Leave.Util.showHideNoRecord(!1,!0,chart_parent),count_arr){var count_json=count_arr[indx],type=count_json.type,taken=count_json.taken;2===type&&0===taken||(color.push(count_json.dbcolor),ltaken.push(count_json.taken),lavail.push(count_json.available?count_json.available:0),name.push(ZPeople.decodeTxt(count_json.name)))}var formName=ZPeople.decodeTxt(ZPeople.Module.getData("leavetracker").formDisplayName)+" ";$("#ZP_Leave_Reports_Yearly_Chart",chart_parent).highcharts({chart:{type:"column",plotBorderWidth:1,plotBorderColor:"#f3f3f3",spacingBottom:50,spacingTop:10,spacingLeft:10,spacingRight:50},credits:{enabled:!1},title:{text:formName+ZPI18N.getString("zp.reports.chart"),align:"left",x:50,style:{color:"black",fontWeight:"bold"}},xAxis:{categories:name,labels:{rotation:-45}},yAxis:{title:{text:("Days"==params.leaveunit?ZPI18N.getString("zp.cday"):ZPI18N.getString("zp.leavetype.hour"))+" "+formName+ZPI18N.getString("zp.reports.chart")},gridLineColor:"#f3f3f3"},tooltip:{valueDecimals:2,headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name} </br> {point.y.name} : {point.y}"},legend:{enabled:!1},exporting:{enabled:!1,buttons:{contextButton:{theme:{states:{hover:{stroke:"#bfbfbf",fill:null},select:{stroke:"#bfbfbf",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"Day"+formName+"Chart"},plotOptions:{column:{pointPadding:.3,borderWidth:0,stacking:"normal"}},series:[{name:"Available",color:"#D3D3D3",data:lavail},{name:"Taken",colorByPoint:!0,showInLegend:!1,colors:color,data:ltaken}]})}$("#Chart_Leave_Applications").slideUp(),$("#ZP_Leave_Reports_Yearly_Chart_Parent").find(".label-head").off("click").on("click",Leave.Report.LYear.getformRecords),Leave.Util.removeLoading()},getformRecords:function(header){var params={};Leave.Util.filterCrt(params);var viewObj=$(this).siblings(".formRecords");viewObj.is(":visible")?viewObj.slideUp():(viewObj.slideDown(),ZPView.init({formId:ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid,viewId:ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.viewId,isEmbed:!0,employeeStatus:"all",container:viewObj.attr("id"),uniqueKey:"ZP_Leave_Reports_Yearly_Records",erecno:params.employee,leaveyear:params.leaveyear,leaveunit:Leave.Util.getLeaveunitID(params.leaveunit),recViewCallback:Leave.viewRec,recEditCallback:Leave.editRec}))},getPeriodicDetails:function(accPdetails){var detailStr='<table><thead><tr><th width="80%">Period</th><th width="20%">'+ZPI18N.getString("zp.available")+"</th></tr></thead>";return $.each(accPdetails,function(idx,detail){"object"==typeof detail&&(detailStr+="<tr height='20'>",detailStr+="<td>"+Calendar.formatDate(Calendar.parseDate(detail.from,"%Y-%m-%d"))+" - "+Calendar.formatDate(Calendar.parseDate(detail.to,"%Y-%m-%d"))+"</td>",detailStr+="<td style='text-align: center;'>"+detail.available+"</td>",detailStr+="</tr>")}),detailStr+="</table>"},getLOPDetails:function(lop_details){var detailStr='<table><thead><tr><th width="50%">'+ZPI18N.getString("zp.date")+'</th><th width="30%">'+ZPI18N.getString("zp.leave.lopreport.adjustment")+'</th><th width="20%">'+ZPI18N.getString("zp.lop")+"</th></tr></thead>";return _.each(lop_details,function(detail){"object"==typeof detail&&(detailStr+="<tr height='20'>",detailStr+="<td>"+Calendar.formatDate(Calendar.parseDate(detail.date,"%Y-%m-%d"))+"</td>",detailStr+="<td style='text-align: center;'>"+ZP.optValue(detail,"adjust",0)+"</td>",detailStr+="<td style='text-align: center;'>"+ZP.optValue(detail,"lop",0)+"</td>",detailStr+="</tr>")}),detailStr+="</table>"},showPeriodicDetails:function(){var curtr=$(this),accPdetails=curtr.data("accPeriodicCount"),detailStr="";$.each(accPdetails,function(idx,detail){"object"==typeof detail&&(detailStr+="<tr style='display:none'>",detailStr+="<td></td><td>"+Calendar.formatDate(Calendar.parseDate(detail.from,"%Y-%m-%d"))+" - "+Calendar.formatDate(Calendar.parseDate(detail.to,"%Y-%m-%d"))+"</td>",detailStr+="<td>"+detail.allowed+"</td>",detailStr+="<td>"+detail.taken+"</td>",detailStr+="<td>"+(detail.allowed-detail.taken)+"</td>",detailStr+="</tr>")});var detailtr=$(detailStr);curtr.after(detailtr),detailtr.show(),null!==callback&&void 0!==callback&&"function"==typeof callback&&callback()}},Leave.Report.Day={key:"report_daily",initPage:function(){LVUtil.Tab.InitPage(Leave.Report.Day.get,!0)},dateChange:function(ele){if(ele.hasClass("ZP-DayPager"))Layout.Page.container.find("[name=date]").val(Calendar.formatDate($(ele).data("date"),uidateFormat));else if(ele.hasClass("ZP-Date")){var date=Calendar.parseDate($(ele).val(),uidateFormat);Layout.Page.container.find(".ZPCalNav").text(Leave.Util.pagerDisplayDate(date,"Day")),Layout.Page.container.find(".pager").data("date",date)}},get:function(){var params={key:Leave.Report.Day.key},header=Layout.Page.container.find(".ZPPhed"),display_ele=$(".btn-primary i",header),callback=Leave.Report.Day.chart_html;display_ele.hasClass("IC-chart")?(params.display=0,callback=Leave.Report.Day.chart_html):(params.display=1,callback=Leave.Report.Day.list_html);var pager_date=$(".pager",header).data("date"),date_to_fetch=Calendar.formatDate(pager_date,uidateFormat);params.date=date_to_fetch,params.sIndx=0,Leave.Util.filterCrt(params),Leave.Util.appendLoading(),ZPeople.Request.send(Leave.Report.url,params,function(resp){callback(resp)},{},Leave.Report.showReportErrorMsg),ZPeople.FireScroll.reset()},getMore:function(){var rowCnt=$("#ZP_Leave_Reports_Daily_List").find(".ZPLRow").length;if(rowCnt%Leave.Util.MAX_REC==0){var header=Layout.Page.container.find(".ZPPhed");if(!$(".btn-primary i",header).hasClass("IC-chart")){var params={key:Leave.Report.Day.key},pager_date=$(".pager",header).data("date"),date_to_fetch=Calendar.formatDate(pager_date,uidateFormat);params.date=date_to_fetch,params.display=1,Leave.Util.filterCrt(params),params.sIndx=rowCnt+1,ZPeople.Request.send(Leave.Report.url,params,function(resp){Leave.Report.Day.list_html(resp,1),resp.data.length==Leave.Util.MAX_REC&&ZPeople.FireScroll.reset()},{},Leave.Report.showReportErrorMsg)}}},chart_html:function(resp){if("success"===resp.status){var count_arr=resp.data,chart_parent=$("#ZP_Leave_Reports_Daily_Chart_Parent",Layout.Page.container);if(chart_parent.removeClass("DN"),chart_parent.siblings("div#ZP_Leave_Reports_Daily_List").addClass("DN"),_.isEmpty(count_arr))return Leave.Util.showHideNoRecord(!0,!0,chart_parent),void Leave.Util.removeLoading();Leave.Util.showHideNoRecord(!1,!0,chart_parent);var chart_data=[],chart_div=$("#ZP_Leave_Reports_Daily_Chart",chart_parent).show(),details=chart_div.siblings(".HcrtRT"),temp_doc=document.createDocumentFragment();for(var indx in count_arr){var count_json=count_arr[indx],color=ZP.optValue(Leave.Util.color3_0,count_json.leavetype_color,count_json.leavetype_color),li_doc=ZP.create("li");li_doc.appendChild(ZP.create("div",{style:"background-color:"+color,class:"RTC1"})),li_doc.appendChild(ZP.create("desc",{text:count_json.leavetype_name,class:"CP",id:count_json.leavetype_id})),li_doc.appendChild(ZP.create("span",{text:count_json.noofusers})),temp_doc.appendChild(li_doc),chart_data.push({y:count_json.noofusers,name:ZPeople.escapeHtml(count_json.leavetype_name),color:color})}var detailsul=$("ul",details);detailsul.html(""),detailsul.append(temp_doc),chart_div.highcharts({chart:{type:"pie",plotShadow:!1,spacingBottom:10,spacingTop:10,spacingLeft:30,spacingRight:10,width:460,height:400},credits:{enabled:!1},title:{text:ZPI18N.getString("zp.dayscomparison"),align:"left",style:{color:"black",fontWeight:"bold"}},tooltip:{percentageDecimals:2,pointFormat:"{point.name} ,<b>{point.percentage:.2f}%</b>"},legend:{enabled:!1},exporting:{enabled:!1,filename:"Leave Daily Report"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:30,dataLabels:{enabled:!0,formatter:function(){return this.point.name+","+this.point.y},style:{fontWeight:"normal",fontSize:"12px",fontFamily:"Verdana, sans-serif",color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{data:chart_data,startAngle:225}]})}detailsul.on("click","li",function(){Leave.Util.showFilters(!0),Layout.Page.container.find(".ZPFilMain select[name=leavetype]").select2("val",$(this).find("desc").attr("id")),Layout.Page.container.find(".ZPPhed .IC-list-v").parent("button").trigger("click")}),Leave.Util.removeLoading()},list_html:function(resp,isscroll){if("success"===resp.status){var tempDoc=document.createDocumentFragment(),data_arr=resp.data,data_div=$("#ZP_Leave_Reports_Daily_List ",Layout.Page.container);if(data_div.removeClass("DN"),data_div.siblings("div#ZP_Leave_Reports_Daily_Chart_Parent").addClass("DN"),data_div.data("isreg")||(ZPView.handleTablePosition(),data_div.data("isreg",!0)),_.isEmpty(data_arr))isscroll||Leave.Util.showHideNoRecord(!0,!1,data_div);else{for(indx in data_arr){var ltObj=data_arr[indx],dataTr=ZP.create("tr",{class:"ZPLRow"+(ltObj.emp_disabled?" disabled":"")});dataTr.appendChild(ZP.getEmpTD(ltObj.erecno,ltObj.emp_id,ltObj.emp_name,ltObj.empphoto,!0,ltObj)),dataTr.appendChild(ZP.create("td",{text:ltObj.leave_name})),dataTr.appendChild(ZP.create("td",{text:Leave.Type.text(ltObj.leave_type)})),dataTr.appendChild(ZP.create("td",{text:ltObj.reason})),dataTr.appendChild(ZP.create("td",{text:ltObj.approval_disp})),tempDoc.appendChild(dataTr)}var data_tbody=$("tbody",data_div);1!==isscroll&&data_tbody.html(""),data_tbody.append(tempDoc),Leave.Util.showHideNoRecord(!1,!1,data_div)}}Leave.Util.removeLoading()}},Leave.Report.Department={key:"report_department",month:(new Date).getMonth(),year:(new Date).getFullYear(),sortType:-1,initPage:function(){LVUtil.Tab.InitPage(Leave.Report.Department.init,!1)},init:function(){Leave.Util.reg();var viewperm=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.deptViewPerm;Leave.Util.isCurPageAdmin()||"-1"!=viewperm&&("0"!=viewperm||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.depPermDepartments&&0!=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.depPermDepartments.length)?Leave.Report.Department.get():Leave.Util.showNoPermission()},checkGet:function(from,to){return Leave.Util.Validate.toafterfrom(from,to)?Leave.Util.Validate.noofDays(from,to,30,ZPI18N.getString("zp.datewithindays",["31"])):(ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")),!1)},get:function(){var params={key:Leave.Report.Department.key};Leave.Util.filterCrt(params),params.sortType=Leave.Report.Department.sortType,params.sIndx=0,Leave.Report.Department.checkGet(params.from,params.to)&&(Leave.Util.appendLoading(),ZPeople.Request.send(Leave.Report.url,params,Leave.Report.Department.html,{})),ZPeople.FireScroll.reset()},getMore:function(){var rowCnt=$("#ZP_Leave_Reports_Department").find(".Report_row").length;if(rowCnt%Leave.Util.MAX_REC==0){var params={key:Leave.Report.Department.key};Leave.Util.filterCrt(params),params.sortType=Leave.Report.Department.sortType,params.sIndx=rowCnt+1,params.sIndx>1&&Leave.Report.Department.checkGet(params.from,params.to)&&ZPeople.Request.send(Leave.Report.url,params,function(resp){resp.data.length==Leave.Util.MAX_REC&&ZPeople.FireScroll.reset(),$("#ZP_Leave_Reports_Department",Layout.Page.container).append(Leave.Report.Department.body(resp.data))},{})}},toggleSort:function(curEle){(curEle=$(curEle)).hasClass("sort-d")?(curEle.addClass("sort-u"),curEle.removeClass("sort-d"),Leave.Report.Department.sortType=1):(curEle.addClass("sort-d"),curEle.removeClass("sort-u"),Leave.Report.Department.sortType=0),Leave.Report.Department.get()},html:function(resp){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#ZP_Leave_Reports_Department",Layout.Page.container);_.isEmpty(data_arr)?Leave.Util.showHideNoRecord(!0,!1):(data_table.html(""),data_table.append(Leave.Report.Department.header(resp.header)),data_table.append(Leave.Report.Department.body(data_arr)),Leave.Util.showHideNoRecord(!1,!1),Leave.Util.handleTableHeader())}Leave.Report.Department.footer(resp.leavetypes),Leave.Util.removeLoading()},header:function(header){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead",{class:"TB_fxd",style:"transition: top 0.3s !important;display: block;left: 500px;"}),common_tr=ZP.create("tr",{class:"ZPLHRow"}),emp_td=ZP.create("th",{style:"max-width: 300px; width: 300px; left: 200px;"});emp_td.appendChild(ZP.create("span",{class:"Stxt",text:ZPI18N.getString("zp.employee")}));var sortIconcls="Tclr sort-img S18 ";Leave.Report.Department.sortType>=0&&(sortIconcls+=0==Leave.Report.Department.sortType?"sort-d":"sort-u"),emp_td.appendChild(ZP.create("i",{class:sortIconcls,id:"EmployeeName",onclick:"Leave.Report.Department.toggleSort(this)"})),common_tr.appendChild(emp_td);var ndayofmonth=header.length;for(dt=0;dt<ndayofmonth;dt++){var date=header[dt],date_th=ZP.create("th",{class:"text-center"});date_th.appendChild(ZP.create("span",{class:"DB MB3",text:date.fmtDate})),date_th.appendChild(ZP.create("span",{class:"DB dgry ZPreg",text:date.day})),common_tr.appendChild(date_th)}return header_tr.appendChild(common_tr),temp_doc.appendChild(header_tr),temp_doc},body:function(data_arr){var temp_doc=document.createElement("tbody"),day=Calendar.getFirstDayofMonth(this.year,this.month),curDate=(new Date).getDate(),curMonth=ZPDateTime.getMonth((new Date).getMonth());for(var indx in data_arr){for(var empJson=data_arr[indx],leave_data=empJson.daydetails,ndayofmonth=leave_data.length,row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow"),dt=0;dt<ndayofmonth;dt++,day++){var date_detail=leave_data[dt],td=ZP.create("td"),color=2==date_detail.ltyp_type?"absent-border":date_detail.color;if(void 0!=date_detail.txt&&""!=date_detail.txt){var fill_span=ZP.create("span",{class:"RPData "+color,text:date_detail.txt,"data-toggle":"tooltip","data-placement":"top",title:date_detail.date_summary}),fill_bar=ZP.create("div",{class:"lvprgs"});Leave.Report.Department.getBar(date_detail.sessionDetail,date_detail.dayCount,date_detail.isHour,fill_bar),td.appendChild(fill_span),td.appendChild(fill_bar)}date_detail.isweekend&&td.setAttribute("class","WKend"),date_detail.date===curDate&&date_detail.month===curMonth&&td.setAttribute("class","Cl-today"),row_tr.appendChild(td)}temp_doc.appendChild(row_tr)}return temp_doc},getBar:function(session_detail,day_count,is_hour,fill_bar){if(1==session_detail.length&&is_hour)fill_bar.appendChild(ZP.create("span",{class:ZP.optValue(session_detail[0],"color","")+" full",style:"width:"+session_detail[0].mins_taken/480*100+"%;left:"+(25*session_detail[0].session-25)+"%"})),fill_bar.className+=" hrs";else if(1==session_detail.length&&1==day_count)fill_bar.appendChild(ZP.create("span",{class:ZP.optValue(session_detail[0],"color","")+" full"}));else{var noofbar=session_detail.length>2||day_count>.5||.25==day_count?4:.5==day_count?4:2,noofsession=session_detail.length,sessions=[];for(i=0;i<noofsession;i++){var leave_detail=session_detail[i];if(leave_detail).5==leave_detail.count&&4==noofbar&&(2==leave_detail.session&&(leave_detail.session=3),sessions.push(leave_detail.session+1),fill_bar.appendChild(ZP.create("span",{class:ZP.optValue(leave_detail,"color","")+" "+Leave.Report.Department.getBarClass(noofbar,leave_detail.session+1)}))),sessions.push(leave_detail.session),fill_bar.appendChild(ZP.create("span",{class:ZP.optValue(leave_detail,"color","")+" "+Leave.Report.Department.getBarClass(noofbar,leave_detail.session)}))}for(bar_idx=1;bar_idx<=noofbar;bar_idx++)-1==sessions.indexOf(bar_idx)&&fill_bar.appendChild(ZP.create("span",{class:"gry-bg "+Leave.Report.Department.getBarClass(noofbar,bar_idx)}))}},getBarClass:function(noofbar,session){var bar_class=4==noofbar?" quarter":"half";switch(session){case 1:bar_class+=" first";break;case 2:bar_class+=" second";break;case 3:bar_class+=" third";break;case 4:bar_class+=" fourth"}return bar_class},getBar2:function(session,count,color,leavedetail,fill_bar){if(leavedetail)leavedetail.forEach(function(leave){});else{var bar_class="CL"+color;if(0==session)bar_class+=" full";else switch(bar_class+=.5==count?" half":.25==count?" quarter":"",session){case 1:bar_class+=" first";break;case 2:bar_class+=" second";break;case 3:bar_class+=" third";break;case 4:bar_class+=" fourth"}fill_bar.appendChild(ZP.create("span",{class:bar_class}))}},footer:function(footer_arr){$(".ZPDat",Layout.Page.container).show();footer_arr.length>6||footer_arr.length;var temp_doc=document.createDocumentFragment(),footer=$("#ZP_Leave_Report_Footer",Layout.Page.container),ltyp_count=0;if(_.each(footer_arr,function(types_arr){for(var noofltyps=types_arr.length,i=0;i<noofltyps&&ltyp_count<7;i++,ltyp_count++){var ltyp_det=types_arr[i],color_class="Dtyps "+(2==ltyp_det.type?"absent-border":"ZPBC"+ltyp_det.color),ltyp=ZP.create("div",{class:color_class,"data-toggle":"tooltip","data-placement":"top",title:ZPeople.decodeTxt(ltyp_det.leavetype_name)});ltyp.appendChild(ZP.create("span",{text:ltyp_det.leavetype_code?ZPeople.decodeTxt(ltyp_det.leavetype_code)+" - "+ZPeople.decodeTxt(ltyp_det.leavetype_name):ZPeople.decodeTxt(ltyp_det.leavetype_name)})),temp_doc.appendChild(ltyp)}}),ltyp_count>6){var more=ZP.create("div",{class:"Dtyps B0I PT3"});more.appendChild(ZP.create("i",{class:"IC-more S21 gry CP FR"})),temp_doc.appendChild(more),more.onclick=function(){Leave.Report.Department.leavetypes_detail(footer_arr).modal("show")}}footer.html(""),footer.append(temp_doc)},leavetypes_detail:function(footer_arr){var modal_cont=ZPeople.BSModal.get({id:Layout.Page.pageId+"_leavetypes_view",type:2,modalClass:"popRgtModel PopSmModel",bodyClass:"ZPRPbody",deleteOnHide:!0}),data_body=$(".modal-body",modal_cont);$(".modal-dialog",modal_cont).addClass("ZPRMpnl"),$(".modal-footer",modal_cont).remove(),$(".modal-header h6",modal_cont).text(ZPI18N.getString("zp.leave.leavetypes"));var data_outer=ZP.create("div",{class:"PL20 PR20 tab-content"});return _.each(footer_arr,function(types_arr){_.each(types_arr,function(ltyp_det){var color_class="Dtyps "+(2==ltyp_det.type?"absent-border":"ZPBC"+ltyp_det.color),ltyp=ZP.create("div",{class:color_class,"data-toggle":"tooltip","data-placement":"bottom",title:ZPeople.decodeTxt(ltyp_det.leavetype_name)});ltyp.appendChild(ZP.create("span",{text:ltyp_det.leavetype_code?ZPeople.decodeTxt(ltyp_det.leavetype_code)+" - "+ZPeople.decodeTxt(ltyp_det.leavetype_name):ZPeople.decodeTxt(ltyp_det.leavetype_name)})),data_outer.appendChild(ltyp)})}),data_body.append(data_outer),modal_cont},showExcessFooter:function(){}},Leave.Report.Balance={key:"report_balance",initPage:function(){LVUtil.Tab.InitPage(Leave.Report.Balance.init,!1)},init:function(){ZPeople.Module.getData("leavetracker").leave_filterops.isV1User?(Leave.Util.regHeader(),Leave.Report.Balance.get()):window.location.href="#leavetracker/reports/lbalance"},get:function(){var params={key:Leave.Report.Balance.key};Leave.Util.filterCrt(params),params.sIndx=0,Leave.Util.Validate.fromtoValidation(params.leaveyear_from,params.to)&&Leave.Util.Validate.currentyear(params.to,params.location?JSON.parse(params.location):params.location)&&(Leave.Util.appendLoading(),ZPeople.Request.send(Leave.Report.url,params,Leave.Report.Balance.html,{},Leave.Report.showReportErrorMsg)),ZPeople.FireScroll.reset()},getMore:function(){var rowCnt=$("#ZP_Leave_Reports_Balance").find(".Report_row").length;if(rowCnt%Leave.Util.MAX_REC==0){var params={key:Leave.Report.Balance.key};Leave.Util.filterCrt(params),params.sIndx=rowCnt+1,params.sIndx>1&&Leave.Util.Validate.fromtoValidation(params.leaveyear_from,params.to)&&Leave.Util.Validate.currentyear(params.to,params.location)&&ZPeople.Request.send(Leave.Report.url,params,function(resp){Leave.Report.Balance.html(resp),resp.data.length==Leave.Util.MAX_REC&&ZPeople.FireScroll.reset()},{},Leave.Report.showReportErrorMsg)}},html:function(resp){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#ZP_Leave_Reports_Balance",Layout.Page.container),prop={edit:!0};if(resp.hasOwnProperty("header")){var header_arr=resp.header;_.isEmpty(header_arr)||_.isEmpty(data_arr)?Leave.Util.showHideNoRecord(!0,!1):(data_table.html(""),prop.total_tdata=Leave.Report.getTDcount(header_arr,!0),prop.td_width=($(".Scrcont",Layout.Page.container).width()-328)/prop.total_tdata,prop.td_width=prop.td_width>120?prop.td_width:120,data_table.append(Leave.Report.Balance.header(header_arr,prop)),Leave.Util.showHideNoRecord(!1,!1))}if(!_.isEmpty(data_arr)){var header=$("#ZP_Leave_Reports_Balance thead",Layout.Page.container);prop.td_width=header.data("td_width"),prop.leavetypes=header.data("leavetypes");var tbody=data_table.children("tbody");tbody.append(Leave.Report.Balance.balance(data_arr,prop))}}tbody&&!tbody.data("isreg")&&(tbody.on("click","tr.ZPLRow:not(.disabled)",function(){Leave.Report.LYear.employee=$(this).data("employee"),window.location.href="#leavetracker/reports/yearly"}),tbody.data("isreg",!0)),Leave.Util.handleTableHeader(),Leave.Util.removeLoading()},header:function(arr,prop){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead",{class:"TB_fxd",style:"transition: top 0.3s !important; left: 500px;"}),common_tr=ZP.create("tr",{class:"ZPLHRow"}),emp_td=ZP.create("th",{style:"max-width: 300px; width: 300px; height: 64px; left: 200px;",text:ZPI18N.getString("zp.employee")});common_tr.appendChild(emp_td);var th_width=prop.td_width;for(var indx in arr){var ltypeth=ZP.create("th",{class:"P0I TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),leavetypes=arr[indx],noofltyps=leavetypes.length>1?leavetypes.length+1:leavetypes.length;$(tbody).append('<tr><th class="text-center B1" colspan="'+noofltyps+'"><div class="ellipsis Mauto" data-toggle="tooltip" data-placement="bottom" title="'+Leave.Type.text(indx)+'">'+Leave.Type.text(indx)+"</div></th></tr>");var ltypeheadtr=ZP.create("tr"),elwidth=100/noofltyps;for(var id in leavetypes){var header,ljson=leavetypes[id];(header=ZP.create("th",{class:"text-center ZPLHRow",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px","data-toggle":"tooltip","data-placement":"top",title:ZPeople.decodeTxt(ljson.leavetype_name),text:ZPeople.decodeTxt(ljson.leavetype_name)})),ltypeheadtr.appendChild(header)}if(noofltyps>1)(header=ZP.create("th",{class:"text-center",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.total"),text:ZPI18N.getString("zp.total")})),ltypeheadtr.appendChild(header);tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypeth.appendChild(table),common_tr.appendChild(ltypeth)}return header_tr.appendChild(common_tr),$(header_tr).data("leavetypes",arr),$(header_tr).data("td_width",th_width),temp_doc.appendChild(header_tr),temp_doc.appendChild(ZP.create("tbody")),temp_doc},balance:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),lt_arr=prop.leavetypes,td_width=prop.td_width;for(var indx in data_arr){var empJson=data_arr[indx],employee=empJson.erecno,row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow CP");for(var indx in lt_arr){var ltypetd=ZP.create("td",{class:"P0I TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),ltypeheadtr=ZP.create("tr"),ltypes=lt_arr[indx],noofltyps=noofltyps=$(ltypes).length>1?$(ltypes).length+1:$(ltypes).length,elwidth=100/noofltyps;for(var idx in ltypes){var lcount=empJson[ltypes[idx].leavetype_id],td=ZP.create("td",{class:"text-center",width:elwidth+"%"});lcount=isNaN(lcount)?"-":lcount,td.appendChild(ZP.create("div",{text:lcount,style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(td)}if(noofltyps>1){var keyname="paidtotal";"1"===indx?keyname="ondutytotal":"3"===indx?keyname="unpaidtotal":"5"===indx&&(keyname="rhtotal");lcount=empJson[keyname];var totalTD=ZP.create("td",{class:"text-center",width:elwidth+"%"});lcount=isNaN(lcount)?"-":lcount,totalTD.appendChild(ZP.create("div",{text:lcount,style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(totalTD)}tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypetd.appendChild(table),row_tr.appendChild(ltypetd),$(row_tr).data("employee",employee)}temp_doc.appendChild(row_tr)}return temp_doc}},Leave.Report.LTaken={key:"report_leavetaken",initPage:function(){LVUtil.Tab.InitPage(Leave.Report.LTaken.init,!1)},init:function(){ZPeople.Module.getData("leavetracker").leave_filterops.isV1User?(Leave.Util.regHeader(),Leave.Report.LTaken.get()):window.location.href="#leavetracker/reports/lbalance"},get:function(){var params={key:Leave.Report.LTaken.key};Leave.Util.filterCrt(params),params.sIndx=0,Leave.Util.Validate.fromtoValidation(params.from,params.to)&&(Leave.Util.appendLoading(),ZPeople.Request.send(Leave.Report.url,params,function(resp){Leave.Report.LTaken.html(resp)},{},Leave.Report.showReportErrorMsg)),ZPeople.FireScroll.reset()},getMore:function(){var rowCnt=$("#ZP_Leave_Reports_LTaken").find(".Report_row").length;if(rowCnt%Leave.Util.MAX_REC==0){var params={key:Leave.Report.LTaken.key};Leave.Util.filterCrt(params),params.sIndx=rowCnt+1,params.sIndx>1&&Leave.Util.Validate.fromtoValidation(params.from,params.to)&&ZPeople.Request.send(Leave.Report.url,params,function(resp){Leave.Report.LTaken.html(resp),resp.data.length==Leave.Util.MAX_REC&&ZPeople.FireScroll.reset()},{},Leave.Report.showReportErrorMsg)}},html:function(resp){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#ZP_Leave_Reports_LTaken",Layout.Page.container),prop={edit:!0};if(resp.hasOwnProperty("header")){var header_arr=resp.header;_.isEmpty(header_arr)||_.isEmpty(data_arr)?Leave.Util.showHideNoRecord(!0,!1):(data_table.html(""),prop.total_tdata=Leave.Report.getTDcount(header_arr,!0),prop.td_width=($(".Scrcont",Layout.Page.container).width()-328)/prop.total_tdata,prop.td_width=prop.td_width>120?prop.td_width:120,data_table.append(Leave.Report.LTaken.header(header_arr,prop)),Leave.Util.showHideNoRecord(!1,!1))}if(!_.isEmpty(data_arr)){var tbody=data_table.children("tbody"),header=$("#ZP_Leave_Reports_LTaken thead",Layout.Page.container);prop.td_width=header.data("td_width"),prop.leavetypes=header.data("leavetypes"),tbody.append(Leave.Report.LTaken.taken(data_arr,prop))}}tbody&&!tbody.data("isreg")&&(tbody.on("click","tr.ZPLRow:not(.disabled)",function(){Leave.View.List.employee=$(this).data("employee"),Leave.View.List.refresh=!0,window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.HOME())}),tbody.data("isreg",!0)),Leave.Util.handleTableHeader(),Leave.Util.removeLoading()},header:function(arr,prop){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead",{class:"TB_fxd",style:"transition: top 0.3s !important; left: 500px;"}),common_tr=ZP.create("tr",{class:"ZPLHRow"}),emp_td=ZP.create("th",{style:"max-width: 300px; width: 300px; height: 64px; left: 200px;",text:ZPI18N.getString("zp.employee")});common_tr.appendChild(emp_td);var th_width=prop.td_width;for(var indx in arr){var ltypeth=ZP.create("th",{class:"P0I TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),leavetypes=arr[indx],noofltyps=leavetypes.length>1?leavetypes.length+1:leavetypes.length;$(tbody).append('<tr><th class="text-center B1" colspan="'+noofltyps+'"><div class="ellipsis Mauto" data-toggle="tooltip" data-placement="bottom" title="'+Leave.Type.text(indx)+'">'+Leave.Type.text(indx)+"</div></th></tr>");var ltypeheadtr=ZP.create("tr"),elwidth=100/noofltyps;for(var id in leavetypes){var header,ljson=leavetypes[id];(header=ZP.create("th",{class:"text-center ZPLHRow",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px","data-toggle":"tooltip","data-placement":"top",title:ZPeople.decodeTxt(ljson.leavetype_name),text:ZPeople.decodeTxt(ljson.leavetype_name)})),ltypeheadtr.appendChild(header)}if(noofltyps>1)(header=ZP.create("th",{class:"text-center",width:elwidth+"%"})).appendChild(ZP.create("div",{class:"Mauto ellipsis",style:"width:"+th_width+"px","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.total"),text:ZPI18N.getString("zp.total")})),ltypeheadtr.appendChild(header);tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypeth.appendChild(table),common_tr.appendChild(ltypeth)}return header_tr.appendChild(common_tr),$(header_tr).data("leavetypes",arr),$(header_tr).data("td_width",th_width),temp_doc.appendChild(header_tr),temp_doc.appendChild(ZP.create("tbody")),temp_doc},taken:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),lt_arr=prop.leavetypes,td_width=prop.td_width;for(var indx in data_arr){var empJson=data_arr[indx],employee=empJson.erecno,row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow CP");for(var indx in lt_arr){var ltypetd=ZP.create("td",{class:"P0I TBrdr-Rgt"}),table=ZP.create("table",{class:"table i_table"}),tbody=ZP.create("tbody"),ltypeheadtr=ZP.create("tr"),ltypes=lt_arr[indx],noofltyps=noofltyps=$(ltypes).length>1?$(ltypes).length+1:$(ltypes).length,elwidth=100/noofltyps;for(var idx in ltypes){var lcount=empJson[ltypes[idx].leavetype_id];lcount=isNaN(lcount)?"-":lcount,(td=ZP.create("td",{class:"text-center",width:elwidth+"%"})).appendChild(ZP.create("div",{text:lcount,style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(td)}if(noofltyps>1){var keyname="paidtotal";"1"===indx?keyname="ondutytotal":"3"===indx?keyname="unpaidtotal":"5"===indx&&(keyname="rhtotal");var td;lcount=empJson[keyname];lcount=isNaN(lcount)?"-":lcount,(td=ZP.create("td",{class:"text-center",width:elwidth+"%"})).appendChild(ZP.create("div",{text:lcount,style:"width:"+td_width+"px"})),ltypeheadtr.appendChild(td)}tbody.appendChild(ltypeheadtr),table.appendChild(tbody),ltypetd.appendChild(table),row_tr.appendChild(ltypetd),$(row_tr).data("employee",employee)}temp_doc.appendChild(row_tr)}return temp_doc}},Leave.Report.getTDcount=function(array,includeTotal){var count=0;return array&&_.each(array,function(obj){var size=_.size(obj);includeTotal&&(count+=size>1?1:0),count+=size}),count},Leave.Report.Encash={key:"report_encash",initPage:function(){LVUtil.Tab.InitPage(Leave.Report.Encash.init,!1)},init:function(){Leave.Util.regHeader(),Leave.Report.Encash.get()},get:function(){var params={key:Leave.Report.Encash.key};Leave.Util.filterCrt(params),Leave.Util.appendLoading(),params.sIndx=0,ZPeople.Request.send(Leave.Report.url,params,function(resp){Leave.Report.Encash.html(resp)},{},Leave.Report.showReportErrorMsg),ZPeople.FireScroll.reset()},getMore:function(){var rowCnt=$("#ZP_Leave_Reports_Encash").find(".Report_row").length;if(rowCnt%Leave.Util.MAX_REC==0){var params={key:Leave.Report.Encash.key};Leave.Util.filterCrt(params),params.sIndx=rowCnt+1,params.sIndx>1&&ZPeople.Request.send(Leave.Report.url,params,function(resp){Leave.Report.Encash.html(resp),resp.data.length==Leave.Util.MAX_REC&&ZPeople.FireScroll.reset()},{},Leave.Report.showReportErrorMsg)}},html:function(resp){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#ZP_Leave_Reports_Encash",Layout.Page.container);if(resp.hasOwnProperty("header")){var header_arr=resp.header;_.isEmpty(header_arr)||_.isEmpty(data_arr)?Leave.Util.showHideNoRecord(!0,!1):(data_table.html(""),data_table.append(Leave.Report.Encash.header(header_arr)),Leave.Util.showHideNoRecord(!1,!1))}if(!_.isEmpty(data_arr)){var tbody=data_table.children("tbody");tbody.append(Leave.Report.Encash.body(data_arr,{edit:!0,leavetypes:$("#ZP_Leave_Reports_Encash thead",Layout.Page.container).data("leavetypes")})),tbody.find("td").css("cursor","auto")}}Leave.Util.removeLoading()},header:function(arr){var temp_doc=document.createDocumentFragment(),header_tr=ZP.create("thead"),common_tr=ZP.create("tr",{class:"ZPLHRow"}),emp_td=ZP.create("th",{rowspan:"2",class:"TBrdr-Rgt"});emp_td.appendChild(ZP.create("span",{class:"ellipsis W150",text:ZPI18N.getString("zp.employee")}));var doj_td=ZP.create("th",{rowspan:"2",class:"P0I TBrdr-Rgt text-center",text:ZPI18N.getString("zp.dateofjoining")}),yrtd=ZP.create("th",{rowspan:"2",class:"P0I TBrdr-Rgt text-center",text:ZPI18N.getString("zp.leave.report.leaveyear")});common_tr.appendChild(emp_td),common_tr.appendChild(doj_td),common_tr.appendChild(yrtd);var noofltyps=0;$.each(arr,function(indx,obj){noofltyps+=$(obj).length});var ltypeth=ZP.create("th",{class:"P0I",style:"border-bottom:0px"}),table=ZP.create("table",{class:"table Vlis bgc"}),tbody=ZP.create("tbody"),ltypeheadtr=ZP.create("tr",{class:"ZPLHRow"}),elwidth=100/noofltyps,subheader=ZP.create("tr",{class:"ZPLHRow"});return $.each(arr,function(indx,obj){for(var id in obj){var ljson=obj[id],header=ZP.create("th",{class:"P0I TBrdr-Rgt text-center B1",colspan:"2",text:ZPeople.decodeTxt(ljson.leavetype_name)});ltypeheadtr.appendChild(header),subheader.appendChild(ZP.create("th",{class:"P0I TBrdr-Rgt text-center PL0I",width:elwidth/2+"%",text:ZPI18N.getString("zp.leave.rolledover")})),subheader.appendChild(ZP.create("th",{class:"P0I TBrdr-Rgt text-center PL0I",width:elwidth/2+"%",text:ZPI18N.getString("zp.leave.lapsed")}))}}),tbody.appendChild(ltypeheadtr),tbody.appendChild(subheader),table.appendChild(tbody),ltypeth.appendChild(table),common_tr.appendChild(ltypeth),header_tr.appendChild(common_tr),$(header_tr).data("leavetypes",arr),temp_doc.appendChild(header_tr),temp_doc.appendChild(ZP.create("tbody")),temp_doc},body:function(data_arr,prop){if(prop.leavetypes){var temp_doc=document.createDocumentFragment(),noofltyps=(data_arr.length,0);for(var indx in $.each(prop.leavetypes,function(indx,obj){noofltyps+=$(obj).length}),data_arr){var empJson=data_arr[indx],empTD=(empJson.erecno,ZP.getEmpTD(empJson.erecno,empJson.id,empJson.name,empJson.photo,!1,empJson));empTD.classList.add("TBrdr-Rgt");var row_tr=ZP.create("tr",{class:"Report_row ZPLRow"+(empJson.emp_disabled?" disabled":""),style:"max-height:40px"});row_tr.appendChild(empTD),row_tr.appendChild(ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:empJson.doj}));var yrTd=ZP.create("td",{class:"P0I TBrdr-Rgt"}),yrTable=ZP.create("table",{class:"table Vlis bgc"}),yrBody=ZP.create("tbody"),datatd=ZP.create("td",{class:"P0I"}),table=ZP.create("table",{class:"table Vlis bgc",id:"yearTable"}),tbody=ZP.create("tbody"),rollObj=empJson.rollData,yrStrArr=empJson.yrData,elwidth=100/noofltyps;for(var indx in rollObj){var yrRow=ZP.create("tr",{class:"ZPLRow"}),yearTd=ZP.create("td",{class:"text-center POI",text:yrStrArr[indx],style:'padding-right:0px;"'});yrRow.appendChild(yearTd),yrBody.appendChild(yrRow);var dataRow=ZP.create("tr",{class:"ZPLRow"}),yearObj=rollObj[indx];if(!yearObj.length){var arr=[];arr.push(yearObj),yearObj=arr}$.each(prop.leavetypes,function(indx,obj){for(var indx in obj){var ltObj=obj[indx],rollover="-",encashed="-";for(var i in yearObj){var rollLT=yearObj[i];ltObj.leavetype_id==rollLT.ltypeid&&(rollover=rollLT.rollover,encashed=rollLT.encashed)}var roTd=ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:rollover,width:elwidth/2+"%"});dataRow.appendChild(roTd),roTd=ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:encashed,width:elwidth/2+"%"}),dataRow.appendChild(roTd)}}),yrTable.appendChild(yrBody),yrTd.appendChild(yrTable),tbody.appendChild(dataRow),table.appendChild(tbody),datatd.appendChild(table)}if(_.isEmpty(rollObj)){(yrRow=ZP.create("tr",{class:"ZPLRow"})).appendChild(ZP.create("td",{class:"text-center",text:"-",style:"padding-right:0px"})),yrBody.appendChild(yrRow);dataRow=ZP.create("tr",{class:"ZPLRow"});$.each(prop.leavetypes,function(indx,obj){for(var indx in obj)dataRow.appendChild(ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:"-",width:elwidth/2+"%"})),dataRow.appendChild(ZP.create("td",{class:"text-center P0I TBrdr-Rgt",text:"-",width:elwidth/2+"%"}))}),yrTable.appendChild(yrBody),yrTd.appendChild(yrTable),tbody.appendChild(dataRow),table.appendChild(tbody),datatd.appendChild(table)}row_tr.appendChild(yrTd),row_tr.appendChild(datatd),temp_doc.appendChild(row_tr)}return temp_doc}}},Leave.Report.LOP={key:"report_lop",pageData:{},reportFreeze:6,validate_period:!0,configuration:'<a target="_blank" href="#leavetracker/payperiod/settings"><button class="btn btn-primary">'+ZPI18N.getString("zp.config")+"</button></a>",initPage:function(){LVUtil.Tab.InitPage(Leave.Report.LOP.regAndGet,!0)},regAndGet:function(){Leave.Util.regFooter(),Leave.Report.LOP.get()},get:function(){var params={key:Leave.Report.LOP.key},filterParams={};Leave.Util.filterCrt(filterParams),Leave.Report.LOP.validateLeaveUnit(filterParams),filterParams.sIndx=0;var payperiod=$(".ZP-PayPeriodPager",Layout.Page.container).data("payperiod");if("object"==typeof payperiod)!Leave.Report.LOP.validateGET(payperiod.conf,filterParams.location)||Leave.Report.LOP.validate_period&&!Leave.Report.LOP.validatePeriod()||(params.leaveFilter=JSON.stringify(filterParams),params.get_show_generate_lop=!payperiod.conf.hasOwnProperty("show_generate"),Leave.Util.appendLoading(),ZPeople.Request.send(Leave.Report.url,params,function(resp){Leave.Report.LOP.html(resp),Leave.Report.LOP.pageData=filterParams,params.get_show_generate_lop&&(payperiod.conf.show_generate=resp.show_generate_lop,Leave.Report.LOP.show_generate())},{},Leave.Report.showReportErrorMsg));else{var isadmin=ZPeople.Module.getData("leavetracker").leave_filterops.issettingsadmin;Leave.Util.showHideNoRecord(!0,!1,void 0,void 0,void 0,ZPI18N.getString("zp.leave.lopreport.configuration"),isadmin?Leave.Report.LOP.configuration:void 0),!ZPeople.isZPNewUI()&&Leave.Report.LOP.showConfiguarationHelp(!0)}ZPeople.FireScroll.reset(),Leave.Report.LOP.showFooter(!1)},getMore:function(){var rowCnt=$("#ZP_Leave_Reports_LOP").find(".Report_row").length;if(rowCnt%Leave.Util.MAX_REC==0){var params={key:Leave.Report.LOP.key},filterParams={};Leave.Util.filterCrt(filterParams),Leave.Report.LOP.validateLeaveUnit(filterParams),filterParams.sIndx=rowCnt+1,filterParams.sIndx>1&&(params.leaveFilter=JSON.stringify(filterParams),params.get_show_generate_lop=!1,ZPeople.Request.send(Leave.Report.url,params,function(resp){resp.data.length==Leave.Util.MAX_REC&&ZPeople.FireScroll.reset(),$("#ZP_Leave_Reports_LOP > tbody",Layout.Page.container).append(Leave.Report.LOP.body(resp.data,{iseditable:resp.iseditable}))},{},Leave.Report.showReportErrorMsg))}},validateGET:function(onPagePP,location){var locationPP="-1"!=location&&location?Leave.Util.getReportSetingsConfByLoc(location):onPagePP;if(Leave.Util.showHideNoRecord(!1,!1),$("#org_report_setting").removeClass("DN"),$(".ZP-PayPeriodPager").css("display","inline-block"),$("#pay_period_detail",Layout.Page.container).remove(),Leave.Report.LOP.showConfiguarationHelp(!1),locationPP){if(onPagePP.rsID!=locationPP.rsID){Leave.Util.showHideNoRecord(!0,!1);var dmsg="<div id='pay_period_detail' style='color:#666'><p>"+ZPI18N.getString("zp.leave.lopreport.payperiodlocation")+" : ";return onPagePP.isAllLocation?dmsg+="ALL":(_.each(onPagePP.rsLocations,function(name,id){dmsg+=name+", "}),dmsg=dmsg.slice(0,-2)+"</p>"),$(".Scrcont > .ZPNdata",Layout.Page.container).append(dmsg),!1}return!0}return Leave.Util.showHideNoRecord(!0,!1,void 0,void 0,void 0,ZPI18N.getString("zp.leave.lopreport.configuration"),Leave.Report.LOP.configuration),!ZPeople.isZPNewUI()&&Leave.Report.LOP.showConfiguarationHelp(!0),$("#org_report_setting").addClass("DN"),$(".ZP-PayPeriodPager").css("display","none"),!1},validatePeriod:function(){var payperiod=Leave.Util.getPayPeriod(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date);Leave.Util.addorReducePayPeriod(payperiod,-1);Calendar.parseDate(ZPeople.Module.getData("leavetracker").leave_filterops.cur_period.cur_date,uidateFormat);return!(Leave.Util.getDateDiff(payperiod.closure,payperiod.cur_date)<Leave.Report.LOP.reportFreeze)||(Leave.Report.LOP.validate_period=!1,$(".IC-ar-lft",Layout.Page.container).trigger("click"),!1)},validateLeaveUnit:function(params){if(!params.leaveunit){var lunits=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leaveunit;params.leaveunit=lunits[0].id}},showConfiguarationHelp:function(show){var msgKey="leavetracker-reports-payroll"===Layout.Page.pageId?"zp.leave.payrollreport.configuration":"zp.leave.lopreport.configuration";if(show&&isadmin){var helpLink=ZPeople.isZPNewUI()?"#leavetracker/payperiod/settings":"#admin/organization/payperiodsettings";0==$(".ZPNdata",Layout.Page.container).children("p").length&&$(".ZPNdata",Layout.Page.container).append("<p>"+ZPI18N.getString(msgKey)+'<a target="_blank" href="'+helpLink+'">'+ZPI18N.getString("zp.config")+"</a></p>")}else $(".ZPNdata>p",Layout.Page.container).remove()},html:function(resp){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,data_table=$("#ZP_Leave_Reports_LOP",Layout.Page.container),tbody=data_table.children("tbody");_.isEmpty(data_arr)?Leave.Util.showHideNoRecord(!0,!1):(tbody.html(""),data_table.append(Leave.Report.LOP.body(data_arr,{iseditable:resp.iseditable,isdynamic:resp.isdynamic})),Leave.Util.showHideNoRecord(!1,!1))}tbody&&!tbody.data("isreg")&&(tbody.on("click",'tr.ZPLRow:not(.disabled) > [name="employee"]',function(){ZPeople.Module.getData("leavetracker").leave_filterops.isV1User?(Leave.Report.LYear.employee=$(this).closest("tr").data("erecno"),window.location.href="#leavetracker/reports/yearly"):(Leave.Report.V2.User.employee=$(this).closest("tr").data("erecno"),window.location.href="#leavetracker/reports/user")}),tbody.data("isreg",!0)),resp.hasOwnProperty("isGTexist")&&resp.isGTexist&&$("#payPushList").show(),Leave.Util.removeLoading()},body:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),try_edit_msg=prop.isdynamic?ZPI18N.getString("zp.leave.lopreport.editnotallowed"):ZPI18N.getString("zp.leave.lopreport.editfreezed");return data_arr.forEach(function(empJson){var adjustTD,lopTD,reasonTD,employee=empJson.erecno,row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow");ZP.create("td",{width:"5%"});prop.iseditable?(adjustTD=ZP.create("td"),lopTD=ZP.create("td"),reasonTD=ZP.create("td"),adjust=$('<input resetVal="'+empJson.adjustment+'" class="form-control table-inpt input-bb1 DATA_INPUT" name="adjustment" value="'+empJson.adjustment+'" type="text">')[0],lop=$('<input resetVal="'+empJson.lop+'" class="form-control table-inpt input-bb1 DATA_INPUT" name="lop" value="'+empJson.lop+'" type="text">')[0],reason=$('<input resetVal="'+ZP.optValue(empJson,"reason","")+'" class="form-control table-inpt input-bb1 DATA_INPUT" name="reason" value="'+ZP.optValue(empJson,"reason","")+'" type="text">')[0],$(adjust).on("keyup",Leave.Report.LOP.Modify.entry),$(lop).on("keyup",Leave.Report.LOP.Modify.entry),$(reason).on("keyup",Leave.Report.LOP.Modify.entry),adjustTD.appendChild(adjust),lopTD.appendChild(lop),reasonTD.appendChild(reason)):(adjustTD=ZP.create("td",{text:empJson.adjustment}),lopTD=ZP.create("td",{text:empJson.lop}),reasonTD=ZP.create("td",{text:ZP.optValue(empJson,"reason","")}),$(lopTD).dblclick(function(){ModuleComp.Msg.showWarningMsg(try_edit_msg)}));empJson.overDue,empJson.adjustment,empJson.lop;$(row_tr).data("erecno",employee),row_tr.appendChild(ZP.create("td",{text:empJson.prev_balance,name:"prev_balance"})),row_tr.appendChild(ZP.create("td",{text:empJson.taken,name:"taken"})),row_tr.appendChild(ZP.create("td",{text:empJson.total_taken,name:"total_taken"})),row_tr.appendChild(adjustTD),row_tr.appendChild(lopTD),row_tr.appendChild(reasonTD),row_tr.appendChild(ZP.create("td",{text:empJson.carry_over,name:"carry_over",resetVal:empJson.carry_over})),temp_doc.appendChild(row_tr)}),temp_doc},showFooter:function(show){show?Layout.Page.container.find("#lopFooter").show():Layout.Page.container.find("#lopFooter").hide()},show_generate:function(){$(".pager",Layout.Page.container).data("payperiod")}},Leave.Report.LOP.Modify={entry:function(){Leave.Report.LOP.showFooter(!0);var curELE=$(this),curTR=curELE.parents("tr");Leave.Report.LOP.Modify.validateEmpData(curTR)?curELE.css("border-color","red"):curELE.closest("tr").find("input.DATA_INPUT").css("border-color",""),curTR.attr("edited",!0)},save:function(){var dataBody=$("#ZP_Leave_Reports_LOP",Layout.Page.container),filter_params={};Leave.Util.filterCrt(filter_params),Leave.Report.LOP.validateLeaveUnit(filter_params);var filterpayperiod=$(".ZP-PayPeriodPager",Layout.Page.container).data("payperiod"),params={};params.from=Calendar.formatDate(filterpayperiod.start),params.to=Calendar.formatDate(filterpayperiod.end),params.org_report_setting=filter_params.org_report_setting,params.leaveunit=filter_params.leaveunit,params.key="lop_bulk_update",Leave.Report.LOP.Modify.validate(dataBody,params)?ModuleComp.Msg.showFailureMsg("Provide proper data to edit entries"):ZPeople.Request.send(Leave.Report.url,params,function(result){"success"===result.status?(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully")),Leave.Report.LOP.Modify.reset()):(ModuleComp.Msg.showFailureMsg(result.message?result.message:ZPI18N.getString("zpp.somethingwentwrong")),Leave.Report.LOP.Modify.reset())})},validate:function(dataBody,params){var modifiedRws=$("tr[edited=true]",dataBody),updateData={},hasError=!1;return _.each(modifiedRws,function(ele,idx){var empData={},curTR=$(ele);empData.erecno=curTR.data("erecno"),empData.adjust=curTR.find("[name=adjustment]").val()||curTR.find("[name=adjustment]").val(0).val(),empData.lop=curTR.find("[name=lop]").val()||curTR.find("[name=lop]").val(0).val(),empData.reason=curTR.find("[name=reason]").val().trim(),empData.reason=empData.reason.length>0?empData.reason:"",Leave.Report.LOP.Modify.validateEmpData(curTR)&&(hasError=!0),updateData[empData.erecno]=empData}),params.updateData=JSON.stringify(updateData),hasError},validateEmpData:function(empTR){var hasError=!1,taken=parseFloat(empTR.find("[name=total_taken]").text()||0),adjust=parseFloat(empTR.find("[name=adjustment]").val()||0),reason=empTR.find("[name=reason]").val();if(isNaN(adjust)||adjust<0)return!0;var lop=parseFloat(empTR.find("[name=lop]").val()||0);if(isNaN(lop)||lop<0)return!0;var afterAdjustment=taken-(adjust+lop);return empTR.find("[name=carry_over]").text(afterAdjustment),(adjust>0||lop>0)&&afterAdjustment<0&&(hasError=!0),reason.length>250&&(hasError=!0,ModuleComp.Msg.showFailureMsg("Reason must be less than 250 characters")),hasError},reset:function(){var dataBody=$("#ZP_Leave_Reports_LOP",Layout.Page.container);_.each($("tr[edited=true]",dataBody),function(ele,idx){var curTR=$(ele),adjustment=curTR.find("[name=adjustment]").val(),lop=curTR.find("[name=lop]").val(),reason=curTR.find("[name=reason]").val(),carry_over=curTR.find("[name=carry_over]").text();curTR.find("[name=adjustment]").attr("resetVal",adjustment),curTR.find("[name=lop]").attr("resetVal",lop),curTR.find("[name=reason]").attr("resetVal",reason),curTR.find("[name=carry_over]").attr("resetVal",carry_over),curTR.attr("edited",!1)}),Leave.Report.LOP.showFooter(!1)},cancel:function(){var dataBody=$("#ZP_Leave_Reports_LOP",Layout.Page.container);_.each($("tr[edited=true]",dataBody),function(ele,idx){var curTR=$(ele),adjustment=curTR.find("[name=adjustment]").attr("resetVal"),lop=curTR.find("[name=lop]").attr("resetVal"),reason=curTR.find("[name=reason]").attr("resetVal"),carry_over=curTR.find("[name=carry_over]").attr("resetVal");curTR.find("[name=adjustment]").val(adjustment).css("border-color",""),curTR.find("[name=lop]").val(lop).css("border-color",""),curTR.find("[name=reason]").val(reason).css("border-color",""),curTR.find("[name=carry_over]").text(carry_over),curTR.attr("edited",!1)}),Leave.Report.LOP.showFooter(!1)}},Leave.Report.LOP.Export={showContainer:function(){var exportCont=$(ZPExport.exportContainer);exportCont.attr("id","zp_lop_export_container");var lop_report_crt='<div class="form-group"><label class="control-label col-sm-3 zp_mdt MT5"><font> Data Details</font></label><div class="col-sm-6"><select id="lop_report_crt"><option value="0">'+ZPI18N.getString("zp.alldata")+'</option><option value="1">'+ZPI18N.getString("zp.leave.lopreport.exportlop")+'</option><option value="2">'+ZPI18N.getString("zp.leave.lopreport.exportadjust")+'</option><option value="3">'+ZPI18N.getString("zp.leave.lopreport.exportloporadj")+"</option></select></div></div>";exportCont.find("#zp_export_body").append(lop_report_crt),exportCont.find("#zp_export_inctabularsec,#zp_export_incAttachements").remove(),exportCont.find("#zp_export_submit").on("click",function(){Leave.Util.exportData("zp_lop_export_container")}),exportCont.find("#lop_report_crt").select2(),exportCont.modal("show"),exportCont.on("hide.bs.modal",function(){$("#zp_lop_export_container").remove()})}},Leave.Report.Payroll={key:"report_payroll",pageData:{},initPage:function(){LVUtil.Tab.InitPage(Leave.Report.Payroll.init,!0)},init:function(){ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payroll_report_enabled&&Leave.Util.isCurPageAdmin()?Leave.Report.Payroll.get():Leave.Util.showNoPermission()},get:function(){var params={key:Leave.Report.Payroll.key},filterParams={};Leave.Util.filterCrt(filterParams),Leave.Report.LOP.validateLeaveUnit(filterParams),filterParams.sIndx=0;var payperiod=$(".ZP-PayPeriodPager",Layout.Page.container).data("payperiod");if("object"==typeof payperiod)Leave.Report.LOP.validateGET(payperiod.conf,filterParams.location)&&Leave.Report.Payroll.validatePeriod()&&(params.leaveFilter=JSON.stringify(filterParams),params.report_type=$("select[name=report_type]").val(),Leave.Util.appendLoading(),ZPeople.Request.send(Leave.Report.url,params,function(resp){Leave.Report.Payroll.PageOrientation(params),Leave.Report.Payroll.html(resp,params),Leave.Report.Payroll.pageData=filterParams},{},Leave.Report.showReportErrorMsg)),payperiod.conf.payrollClosureNotConfigured?Layout.Page.container.find("#ZP-Regenerate").addClass("DN"):Layout.Page.container.find("#ZP-Regenerate").removeClass("DN");else{var isadmin=ZPeople.Module.getData("leavetracker").leave_filterops.issettingsadmin;Leave.Util.showHideNoRecord(!0,!1,void 0,void 0,void 0,ZPI18N.getString("zp.leave.payrollreport.configuration"),isadmin?Leave.Report.LOP.configuration:void 0),!ZPeople.isZPNewUI()&&Leave.Report.LOP.showConfiguarationHelp(!0)}ZPeople.FireScroll.reset()},getMore:function(){var rowCnt=$("#ZP_Leave_Reports_Payroll").find(".Report_row").length;if(rowCnt%Leave.Util.MAX_REC==0){var params={key:Leave.Report.Payroll.key},filterParams={};Leave.Util.filterCrt(filterParams),filterParams.sIndx=rowCnt+1,filterParams.sIndx>1&&(params.leaveFilter=JSON.stringify(filterParams),params.report_type=$("select[name=report_type]").val(),ZPeople.Request.send(Leave.Report.url,params,function(resp){resp.data.length==Leave.Util.MAX_REC&&ZPeople.FireScroll.reset(),$("#ZP_Leave_Reports_Payroll > tbody",Layout.Page.container).append(Leave.Report.Payroll.body(resp.data,resp)),$("thead>.ZPLHRow,#ZP_Leave_Reports_Payroll>tbody>.ZPLRow",Layout.Page.container).css("display","0"===params.report_type?"":"initial")},{},Leave.Report.showReportErrorMsg))}},validatePeriod:function(){var payperiod=$(".pager",Layout.Page.container).data("payperiod"),curDate=Calendar.parseDate(ZPeople.Module.getData("leavetracker").leave_filterops.cur_period.cur_date,uidateFormat);return!(payperiod.payroll_closure>curDate)||($(".IC-ar-lft",Layout.Page.container).trigger("click"),!1)},html:function(resp,params){if("success"===resp.status){document.createDocumentFragment();var data_arr=resp.data,tbody=$("#ZP_Leave_Reports_Payroll>tbody",Layout.Page.container);_.isEmpty(data_arr)?Leave.Util.showHideNoRecord(!0,!1,void 0,void 0,void 0,ZPI18N.getString("zp.leave.payrollreport.configuration"),Leave.Report.LOP.configuration):(tbody.html(""),tbody.append(Leave.Report.Payroll.body(data_arr,resp)),resp.show_weekend?$(".show_weekend",Layout.Page.container).removeClass("DN"):$(".show_weekend",Layout.Page.container).addClass("DN"),resp.show_holiday?$(".show_holiday",Layout.Page.container).removeClass("DN"):$(".show_holiday",Layout.Page.container).addClass("DN"),resp.show_holiday||resp.show_weekend?$(".show_payable",Layout.Page.container).removeClass("DN"):$(".show_payable",Layout.Page.container).addClass("DN"),resp.detailed_report?$(".show_weekend, .show_holiday, .detailed_report",Layout.Page.container).removeClass("DN"):$(".detailed_report",Layout.Page.container).addClass("DN"),$("thead>.ZPLHRow,#ZP_Leave_Reports_Payroll>tbody>.ZPLRow",Layout.Page.container).css("display","0"===params.report_type?"":"initial"),Leave.Util.showHideNoRecord(!1,!1))}Leave.Util.removeLoading()},body:function(data_arr,prop){var temp_doc=document.createDocumentFragment(),detailed_report=(data_arr.length,prop.detailed_report),show_weekend=prop.show_weekend||detailed_report,show_holiday=prop.show_holiday||detailed_report,show_payable=show_weekend||show_holiday;return data_arr.forEach(function(empJson){empJson.erecno;var row_tr=ZP.getEmpRow(empJson,"Report_row ZPLRow");((td=ZP.create("td",{class:"TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.total})),row_tr.appendChild(td),show_weekend)&&((td=ZP.create("td",{class:"TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.weekend})),row_tr.appendChild(td));show_holiday&&((td=ZP.create("td",{class:"TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.holiday})),row_tr.appendChild(td));show_payable&&((td=ZP.create("td",{class:"TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.payable})),row_tr.appendChild(td));if(detailed_report){var td;(td=ZP.create("td",{class:"TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.onduty_leave})),row_tr.appendChild(td);var leaveTD=$(Leave.Report.Payroll.leaveTableTmp.replace("*paidlC*",empJson.paid_leave).replace("*unpaidlC*",empJson.unpaid_leave).replace("*compoffC*",empJson.compoff_leave).replace("*totallC*",empJson.total_leave));row_tr.appendChild(leaveTD[0])}((td=ZP.create("td",{class:"TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.lop})),row_tr.appendChild(td),Layout.Page.container.find("#Encashment_Header").hasClass("DN"))||((td=ZP.create("td",{class:"TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.leave_encashed?empJson.leave_encashed:"0"})),row_tr.appendChild(td));(td=ZP.create("td",{class:"TBrdr-Rgt",width:"12%"})).appendChild(ZP.create("div",{text:empJson.paid})),row_tr.appendChild(td),temp_doc.appendChild(row_tr)}),temp_doc},PageOrientation:function(params){"0"===params.report_type?($("#Payroll_Fixed",Layout.Page.container).removeClass("RHLtbl RHFixed").removeAttr("style").addClass("tabcont").addClass("H100"),$("table.table",Layout.Page.container).addClass("table table-hover table-border Tlis FLhead").removeAttr("style"),$(".Scrcont",Layout.Page.container).removeClass("fixTable rpt-tbl").addClass("section"),$(".table-responsive",Layout.Page.container).append('<div class="ZPfhlin" style="width:100%"></div>'),$("#ZP_Leave_Reports_Payroll",Layout.Page.container).before('<div class="ZPfhlin" style="width:100%"></div>'),$(".ZPLHRow>th:first-child",Layout.Page.container).removeAttr("style"),$(".table-responsive",Layout.Page.container).find("td.TBrdr-Rgt > div").removeClass("text-center")):($("#Payroll_Fixed",Layout.Page.container).addClass("RHLtbl RHFixed").removeClass("tabcont H100").attr("style","padding-left: 300px;position : static"),$("table.table",Layout.Page.container).removeClass("table-hover table-border Tlis FLhead").attr("style","").find("thead").addClass("TB_fxd").attr("style","transition: top 0.3s !important;right:0; left: "+(ZPeople.isZPNewUI()?"570px;":"500px;")),$(".Scrcont",Layout.Page.container).addClass("fixTable rpt-tbl").removeClass("section"),$(".ZPfhlin",Layout.Page.container).remove(),$(".table-responsive",Layout.Page.container).removeClass("tabcont H100"),$(".ZPLHRow>th:first-child",Layout.Page.container).attr("style","max-width: 300px; width: 300px; height: 64px;"+(ZPeople.isZPNewUI()?"":"left:200px")),$(".table-responsive",Layout.Page.container).find("td.TBrdr-Rgt > div").addClass("text-center"));var paramObj=JSON.parse(params.leaveFilter);Leave.Util.getReportSetingsConf(paramObj.org_report_setting+"").rsProcessEncashment?$("#Encashment_Header",Layout.Page.container).removeClass("DN"):$("#Encashment_Header",Layout.Page.container).addClass("DN")},leaveTableTmp:'<td class="P0I TBrdr-Rgt" width="10%"><table class="table i_table"><tbody><tr class="potbl"><td class="text-center" width="33.33%"><div class="W60">*paidlC*</div></td><td class="text-center" width="33.33%"><div class="W60">*unpaidlC*</div></td><td class="text-center" width="33.33%"><div class="W60">*compoffC*</div></td><td class="text-center" width="33.33%"><div class="W60">*totallC*</div></td></tr></tbody></table></td>'},Leave.greythr={handlePayrollLOPPush:function(actions,obj){for(var parentDiv=$("#lopGtPush"),rsid=(parentDiv.find("input[name = pushByRad]:checked").val(),ZPLite.Filters.getValues(Layout.Page.container.find('[name="payPeriodFilter"]'))[0].id),payPeriodObj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod,i=0;i<payPeriodObj.length;i++)if(payPeriodObj[i].rsID==rsid)var payPariodLoc=payPeriodObj[i].rsLocationsObj,payPeriodempTypes=payPeriodObj[i].rsEmpTypes,payPeriodRole=payPeriodObj[i].rsRoles;var showPopUp=!0,payPariodLocIds=Object.keys(payPariodLoc),payPeriodRoleIds=Object.keys(payPeriodRole);if(0==payPariodLocIds.length&&0==payPeriodempTypes.length&&0==payPeriodRoleIds.length?payPariodLocIds.push("-1"):0!=payPariodLocIds.length||0==payPeriodempTypes.length&&0==payPeriodRoleIds.length||(showPopUp=!1),showPopUp){var monthBox=parentDiv.find("#monBox"),yearBox=parentDiv.find("#yrBox"),payCycBox=parentDiv.find("#payCycBox"),locBox=parentDiv.find("#locBox"),servBox=parentDiv.find("#serviceBox");$("#locBox").select2({width:"100%"}),$("#payCycBox").select2({width:"100%"}),$("#serviceBox").select2({width:"100%"});yearBox.find(":selected").text(),parentDiv.find("input[name = pushByRad]:checked").val();if("getServices"==actions)ZPeople.Request.send("/integrations/payroll/handleAttendanceMonthYears",{actions:actions,locations:JSON.stringify(payPariodLocIds)},function(resltObj){Leave.greythr.handlePayrollLOPPush.services=resltObj.services,0!=Leave.greythr.handlePayrollLOPPush.services.length?(parentDiv.modal(),parentDiv.find("#serviceBox").show(),parentDiv.find("option#serviceS").remove(),parentDiv.find("#zp_paymentinteg_attEmps").removeAttr("value"),parentDiv.find("#s2id_zp_paymentinteg_attEmps").find("li").remove(),parentDiv.find("#empSrchDiv").hide(),$.each(resltObj.services,function(k,v){servBox.append('<option id="serviceS" value='+v.IntegId+">"+v.domain+" ("+v.serviceName+")</option>")}),Leave.greythr.handlePayrollLOPPush.locIds=[],servBox.select2("val","0")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.payperiodNotSupportServices"))});else if(0!=Leave.greythr.handlePayrollLOPPush.services.length||"0"!=servBox.val())if("getLocs"==actions)parentDiv.modal(),parentDiv.find("#locBox").show(),parentDiv.find("option#locationS").remove(),parentDiv.find("#zp_paymentinteg_attEmps").removeAttr("value"),parentDiv.find("#s2id_zp_paymentinteg_attEmps").find("li").remove(),parentDiv.find("#empSrchDiv").hide(),null!=(serviceId=servBox.val())&&ZPeople.Request.send("/integrations/payroll/handleAttendanceMonthYears",{actions:actions,integId:serviceId},function(resltObj){Leave.greythr.handlePayrollLOPPush.orgLocs=resltObj.orgLocs;var orgLoclen=Leave.greythr.handlePayrollLOPPush.orgLocs.length;if(Leave.greythr.handlePayrollLOPPush.locIds=[],resltObj.hasOwnProperty("payLocations"))$.each(resltObj.payLocations,function(k,v){if("-1"!=payPariodLocIds[0])for(var i=0;i<payPariodLocIds.length;i++)payPariodLocIds[i]==v.locId&&(Leave.greythr.handlePayrollLOPPush.locIds.push(v.locId),locBox.append('<option id="locationS" value='+v.locId+">"+v.locName+"</option>"));else Leave.greythr.handlePayrollLOPPush.locIds.push(v.locId),locBox.append('<option id="locationS" value='+v.locId+">"+v.locName+"</option>")}),locBox.select2("val","0");else{var payLoclen=Leave.greythr.handlePayrollLOPPush.locIds.length;orgLoclen>0&&0==payLoclen?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.gtnolocinsetting")):0==orgLoclen&&Leave.greythr.handlePayrollLOPPush("getPayCycles"),locBox.select2("val","0")}Leave.greythr.handlePayrollLOPPush.eTypes=resltObj.eTypes}),locBox.select2("val","0");else if("getPayCycles"==actions){var locId=locBox.val();payCycBox.select2("val","0"),payCycBox.prop("disabled",!1),null!=locId&&ZPeople.Request.send("/integrations/payroll/handleAttendanceMonthYears",{actions:actions,locationId:locId},function(resltCyc){if(resltCyc.hasOwnProperty("payCycles")){parentDiv.find("option#payCyc").remove(),payCycBox.select2("val","0");var paycycl=resltCyc.payCycles;Object.keys(paycycl).sort().reverse().forEach(function(k,v){payCycBox.append('<option id="payCyc" value='+k+">"+paycycl[k]+"</option>")})}})}else if("fetchLocEmployees"==actions){monthBox.find(":selected").val(),yearBox.find(":selected").text();parentDiv.find("#usrSelDiv").show(),parentDiv.find("#pushBySubDv").hide(),parentDiv.find("#zp_paymentinteg_attEmps").removeAttr("value");(orgLocLen=Leave.greythr.handlePayrollLOPPush.locIds.length)>0&&0!=locBox.val()&&0!=payCycBox.val()&&(parentDiv.find("#empSrchDiv").show(),Leave.greythr.constructQuickPushList())}else if("pushAttToPayroll"==actions){monthBox.find(":selected").val(),yearBox.find(":selected").text(),locBox=$("#locBox").val();var serviceId=servBox.val(),empAry=ZPeopleComponents.tokenfield(document.getElementById("zp_paymentinteg_attEmps")).getAllValues().map(value=>value.erecno),orgLocLen=Leave.greythr.handlePayrollLOPPush.orgLocs.length,payCycle=(Leave.greythr.handlePayrollLOPPush.locIds.length,payCycBox.val());0==orgLocLen&&0!=payCycle||orgLocLen>0&&null!=locBox&&0!=locBox&&0!=payCycle?(parentDiv.find("#pushRotate").show(),ZPeople.Request.send("/integrations/payroll/pushAttendanceDataToPayroll",{payCycle:payCycle,employees:JSON.stringify(empAry),locationID:locBox,integId:serviceId},function(resltErr){parentDiv.find("#pushRotate").hide();var empErr=null,errMsg="",errMs="",oErr=null,servName=null;if(resltErr.hasOwnProperty("serviceName")&&(servName=resltErr.serviceName),resltErr.hasOwnProperty("errDtls")){var errDtls=resltErr.errDtls;errDtls.hasOwnProperty("PAYROLL-NOT-FOUND")&&(errMsg+=ZPI18N.getString("zp.gtpaycyclenotexist",new Array(errDtls.PAYROLL-NOT-FOUND))),errDtls.hasOwnProperty("empNotFound")&&(empErr=errDtls.empNotFound),errDtls.hasOwnProperty("othrErrs")&&(oErr=errDtls.othrErrs)}resltErr.hasOwnProperty("noEmp")&&(errMsg+=ZPI18N.getString("zp.gtnoempinpref")),resltErr.hasOwnProperty("prefEmpty")&&(errMsg+=ZPI18N.getString("zp.gtemptyemtype")),resltErr.hasOwnProperty("noReport")&&(errMsg+=ZPI18N.getString("zp.gtnolopreport")),resltErr.hasOwnProperty("exception")&&(errMsg+=ZPI18N.getString("zp.sorryservererror")),""!=errMsg&&ZPeople.Message.showFailureMsg(errMsg),null!=empErr&&empErr.length>0&&(errMs+="<p><b>"+ZPI18N.getString("zp.gtempnotingtlop")+"</b></p><span>"+empErr+"</span>"),null!=oErr&&(errMs+='<p class="MB0 MT5"><b>Other Errors</b></p>',$.each(oErr,function(key,val){errMs+='<p><i class="IC-r-close red MR5 S13 ML2"></i>'+val+"</p>"})),""!=errMsg||null!=empErr&&0!=empErr.length||null!=oErr&&0!=oErr.length||(resltErr.hasOwnProperty("LOPmailed")?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.loppushmailed")):errDtls.hasOwnProperty("success_emp")&&("GreyTip"==servName?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.gtattpushsuccess")):"PayBooks"==servName?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.pbattpushsuccess")):"ZPayroll"==servName&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.zpattpushsuccess")))),null!=errMs&&""!=errMs&&($("#lopPushErrMsgs").html(errMs),parentDiv.find("#lopErrMsgDv").trigger("click"))})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.gtproperinput"))}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.empTypeBasedPayPeriod"))},searchUserExtraParamCallback:function(){var extras={},cycDt=$("#payCycBox").val(),enIndex=cycDt.indexOf(":"),enDt=cycDt.substring(enIndex+1,cycDt.length);return extras.doj=enDt,extras.locationId=$("#locBox").val(),extras.etypeids=Leave.greythr.handlePayrollLOPPush.eTypes,extras},constructQuickPushList:function(){var tokenObj={dataMapping:{value:"erecno",id:"erecno",text:"fullName",image:"image",searchText:"searchText",email:"email",employeeID:"employeeID"},dropdownList:{contentType:"image-text",loaderIconClassName:"sample",isTextHTMLEncoded:!0},search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults"),minKeywordLength:1,by:["searchText","email","employeeID"]},placeholder:"All employees in location"};tokenObj.dataSource={search:function(params){return new Promise(function(search,reject){search({results:function(query){let response;return ZPeople.Request.sendAsyncPost("/commonAction.zp",{mode:"SEARCH",key:query,start:1,searchType:"emp",searchMode:"GreyTipAttPush",extraparam:JSON.stringify(Leave.greythr.searchUserExtraParamCallback())},function(data){let result=data.results.length>0?data.results:data.matches.length>0?data.matches:[];response=Leave.greythr.convertUserArrayToUserObject(result)}),response}(params.query),more:!1})})},paginated:!0,serverSearch:!0},ZPeopleComponents.tokenfield(settingsPage.container.find("#zp_paymentinteg_attEmps"),tokenObj)},convertUserArrayToUserObject:function(userDetailArray){return userDetailArray.map(userArray=>{let userDetail={};return userDetail.erecno=userArray[0],userDetail.employeeID=userArray[1],userDetail.email=userArray[4],userDetail.zuid=userArray[5],userDetail.image=""!==userArray[6]?"viewPhoto?filename="+userArray[6]:contactUrl+"/file?ID="+userArray[5]+"&fs=thumb",userDetail.fullName=userArray[1]+" "+ZPeople.getUserDisplayName(userArray[2],userArray[3]),userDetail.searchText=userArray[2]+" "+userArray[3],userDetail})}},Leave.Report.showReportErrorMsg=function(){ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.reports.errormsg")),Leave.Util.removeLoading()},Leave.Report.Bradford={key:"report_bradford",emp_score_json:{loaded:!1,emp_json:{},headers:{},params:{}},isReportGenerationInProgress:!1,MAX_LIMIT:25,initPage:function(){Leave.Util.isBradfordFactorEnabled()?LVUtil.Tab.InitPage(Leave.Report.Bradford.init,!1):Leave.Util.showHideNoRecord(!0,!1,void 0,!1,void 0,ZPI18N.getString("zp.bradfordfactor.error.enableerror"))},init:function(){-1!==Layout.Page.hash.indexOf("#leavetracker/reports/bradford/employee")?(Leave.Report.Bradford.DetailView.regModal(Layout.Page.urlparam.id),Leave.Report.Bradford.DetailView.get()):-1!==Layout.Page.hash.indexOf("#leavetracker/reports/bradford")&&(Leave.Util.regHeader(),Leave.Report.Bradford.get())},get:function(){if(!Leave.Report.Bradford.emp_score_json.loaded){if(Leave.Report.Bradford.isReportGenerationInProgress)return void ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.reportgenerate"));var params={key:Leave.Report.Bradford.key};Leave.Util.filterCrt(params),params.to=params.date,delete params.date,0==params.level&&delete params.level,params.sIndex=0,params.limit=Leave.Report.Bradford.MAX_LIMIT,ZPeople.FireScroll.init(Leave.Report.Bradford.getMore),Leave.Util.appendLoading(),Leave.Report.Bradford.isReportGenerationInProgress=!0,ZPeople.Request.send(Leave.Report.url,params,Leave.Report.Bradford.construct)}},getMore:function(){if(Leave.Report.Bradford.isReportGenerationInProgress)ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.reportgenerate"));else{var params=Leave.Report.Bradford.emp_score_json.params;params.sIndex=ZPeople.FireScroll.getRecordCount()+1,params.limit=Leave.Report.Bradford.MAX_LIMIT,Leave.Report.Bradford.emp_score_json.params.lastFetchedEmpIndex&&(params.lastFetchedEmpIndex=Leave.Report.Bradford.emp_score_json.params.lastFetchedEmpIndex),Leave.Util.appendLoading({containerId:"zp_reports_bradford",placement:"append"}),Leave.Report.Bradford.isReportGenerationInProgress=!0,ZPeople.Request.send(Leave.Report.url,params,Leave.Report.Bradford.construct,{isFirescroll:!0})}},search:function(){Leave.Report.Bradford.emp_score_json.loaded=!1,Leave.Report.Bradford.init()},construct:function(result,params,other_dtls){if(other_dtls&&other_dtls.isFirescroll){if(delete Leave.Report.Bradford.emp_score_json.params.lastFetchedEmpIndex,Leave.Report.Bradford.Response.isSuccess(result)&&result.data&&result.data.length>0){bodyEle=$("#zp_leave_reports_bradford tbody#report_tbody",Layout.Page.container);var newBodyEle=Leave.Report.Bradford.constructData(Leave.Report.Bradford.emp_score_json.headers,result.data);bodyEle.append(newBodyEle.children()),Leave.Util.handleTableHeader(),params.limit&&result.data.length>=params.limit&&ZPeople.FireScroll.reset(),result.lastFetchedEmpIndex&&(Leave.Report.Bradford.emp_score_json.params.lastFetchedEmpIndex=result.lastFetchedEmpIndex)}}else{if(Leave.Report.Bradford.emp_score_json.emp_json={},ZPeople.FireScroll.setRecordCount(0),Leave.Report.Bradford.Response.isSuccess(result)&&result.header&&Object.keys(result.header).length>0&&result.data&&result.data.length>0){var bradfords=result.header,headerEle=Leave.Report.Bradford.constructHeader(bradfords),bodyEle=Leave.Report.Bradford.constructData(bradfords,result.data),tableEle=$("#zp_leave_reports_bradford",Layout.Page.Container);$(tableEle).html(""),$(tableEle).append(headerEle),$(tableEle).append(bodyEle),Leave.Util.showHideNoRecord(!1,!0),$("#zp_leave_reports_bradford",Layout.Page.container).delay(200).fadeIn(200).removeClass("DN"),Leave.Util.handleTableHeader(),ZPeople.FireScroll.setParam("triggered",!0),result.data.length>=params.limit&&ZPeople.FireScroll.reset()}else result.message&&ModuleComp.Msg.showFailureMsg(result.message),Leave.Util.showHideNoRecord(!0,!0);result&&result.from&&result.to&&$("#zp_bradford_report_date",Layout.Page.container).text(result.from+" - "+result.to),Leave.Report.Bradford.emp_score_json.loaded=!0,Leave.Report.Bradford.emp_score_json.allBradfordsAvailable=!params.level&&!params.bradford,Leave.Report.Bradford.emp_score_json.headers=bradfords||{},Leave.Report.Bradford.emp_score_json.params=params,Leave.Report.Bradford.emp_score_json.params.from=result?result.from:result,result&&result.lastFetchedEmpIndex&&(Leave.Report.Bradford.emp_score_json.params.lastFetchedEmpIndex=result.lastFetchedEmpIndex)}Leave.Report.Bradford.isReportGenerationInProgress=!1,Leave.Util.removeLoading()},constructHeader:function(bradfords){var headerEle=$('<thead id="report_thead" class="TB_fxd" style="transition: top 0.3s ease 0s !important;"><tr class="ZPLHRow"><th style="max-width: 300px; width: 300px; height: 102px;"><div>'+ZPI18N.getString("zp.employee")+"</div></th></tr></thead>");return $.each(bradfords,function(bradfordId){headerEle.find("tr:first").append($('<th class="P0I text-center TBrdr"><table class="table i_table"><tbody><tr class="ZPLRow"><td class="PL0I" colspan="2">'+bradfords[bradfordId]+'</td></tr><tr class="ZPLRow"><td width="50%"><div class="W120">'+ZPI18N.getString("zp.bradfordfactor.bradfordscore")+'</div></td><td width="50%"><div class="W120">'+ZPI18N.getString("zp.bradfordfactor.threslevel")+"</div></td></tr></tbody></table></th>"))}),headerEle},constructData:function(bradfords,data){var bodyEle=$('<tbody id="report_tbody" bodyCont="true"></tbody>');for(var i in data){var emp_details,bradford_details,erecno,emp_json_arr=data[i];if($.each(emp_json_arr,function(idx){var emp_json=emp_json_arr[erecno=idx];emp_details=emp_json.emp_details,bradford_details=emp_json.bradford_details,Leave.Report.Bradford.emp_score_json.emp_json[erecno]=emp_json}),emp_details&&bradford_details){var trEle=$('<tr class="ZPLRow"></tr>');trEle.append($('<td class="CP fxdtd" style="max-width: 300px; width: 300px;" onclick="Leave.Report.Bradford.DetailView.redirect(\''+emp_details.erecno+"', '#leavetracker/reports/bradford', 'true', 'true');\"><div class=\"zpusImg\"><img class=\"img-26\" src=\""+emp_details.empPhoto+'"><div class="zpusImg_nme"><span><strong class="ellipsis_nowdth" title="'+emp_details.empName+'"><b>'+emp_details.empId+" - </b>  "+emp_details.empName+'</strong><i class="IC-eye"></i></span></div></div></td>')),$.each(bradfords,function(bradfordId){var score=bradford_details[bradfordId]?bradford_details[bradfordId].score:"-",level=bradford_details[bradfordId]?ZPI18N.getString("zp.Level")+" "+bradford_details[bradfordId].level:"-";trEle.append($('<td class="P0I text-center TBrdr"><table class="table i_table"><tbody><tr class="ZPLRow"><td width="50%"><div class="W120">'+score+'</div></td><td width="50%"><div class="W120">'+level+"</div></td></tr></tbody></table></td>"))}),bodyEle.append(trEle)}}return ZPeople.FireScroll.increaseRecordCount(data.length),bodyEle},DetailView:{url:"/leave_view_actions.zp",employee_bradford_key:"employee_bradford",modal_dtls:{employee:"",modal_hide_url:"#leavetracker/reports/bradford",isUrlChanged:!0,showEmpSelect:!0},redirect:function(erecno,modal_hide_url,isUrlChange,showEmpSelect,home_url){if(Leave.Report.Bradford.DetailView.regModal(erecno,modal_hide_url,isUrlChange,showEmpSelect,home_url),isUrlChange){let suffix=-1==Leave.Report.Bradford.DetailView.getModalHideURL().indexOf("-id:")?"-id:":"";!showNewTab||LVUtil.Tab.isList()?window.location.href=Leave.Report.Bradford.DetailView.getModalHideURL()+""+(showNewTab?LVUtil.Tab.isMyPage()?"":suffix:":"+erecno):window.location.href=Leave.Report.Bradford.DetailView.getModalHideURL()}else Leave.Report.Bradford.DetailView.get()},regModal:function(erecno,modal_hide_url,isUrlChange,showEmpSelect,home_url){Leave.Report.Bradford.DetailView.setEmployee(erecno),Leave.Report.Bradford.DetailView.setModalHideURL(modal_hide_url),Leave.Report.Bradford.DetailView.setHomeURL(void 0!=home_url?home_url:modal_hide_url),Leave.Report.Bradford.DetailView.setIsUrlChanged(isUrlChange),Leave.Report.Bradford.DetailView.setIsShowEmpSelect(showEmpSelect)},setModalHideURL:function(modal_hide_url){Leave.Report.Bradford.DetailView.modal_dtls.modal_hide_url=modal_hide_url||"#leavetracker/reports/bradford"},getModalHideURL:function(){return Leave.Report.Bradford.DetailView.modal_dtls.modal_hide_url},setHomeURL:function(home_url){Leave.Report.Bradford.DetailView.modal_dtls.home_url=home_url||"#leavetracker/reports/bradford"},getHomeURL:function(){return Leave.Report.Bradford.DetailView.modal_dtls.home_url},setIsUrlChanged:function(isUrlChanged){Leave.Report.Bradford.DetailView.modal_dtls.isUrlChanged=void 0===isUrlChanged||isUrlChanged},getIsUrlChanged:function(){return Leave.Report.Bradford.DetailView.modal_dtls.isUrlChanged},setEmployee:function(erecno){Leave.Report.Bradford.DetailView.modal_dtls.employee=erecno},getEmployee:function(){return Leave.Report.Bradford.DetailView.modal_dtls.employee},setIsShowEmpSelect:function(showEmpSelect){Leave.Report.Bradford.DetailView.modal_dtls.showEmpSelect=void 0===showEmpSelect||showEmpSelect},getIsShowEmpSelect:function(){return Leave.Report.Bradford.DetailView.modal_dtls.showEmpSelect},getFromDate:function(){if(Leave.Report.Bradford.emp_score_json&&Leave.Report.Bradford.emp_score_json.params&&Leave.Report.Bradford.emp_score_json.params.from)return Leave.Report.Bradford.emp_score_json.params.from},isFromReport:function(){return-1!==Layout.Page.hash.indexOf("#leavetracker/reports/bradford/employee")},getToDate:function(){var filterDate;return Leave.Report.Bradford.DetailView.isFromReport()?!(filterDate=$("input[name='date']",Layout.Page.container).length>0?$("input[name='date']",Layout.Page.container).val():void 0)&&Leave.Report.Bradford.emp_score_json&&Leave.Report.Bradford.emp_score_json.params&&Leave.Report.Bradford.emp_score_json.params.to&&(filterDate=Leave.Report.Bradford.emp_score_json.params.to):filterDate=Leave.Util.getCurrDateFromFilterOptions(),filterDate},isAllBradfordsLoadedForEmp:function(){return Leave.Report.Bradford.emp_score_json&&Leave.Report.Bradford.emp_score_json.allBradfordsAvailable&&!0},setIsDiffDateInEmpCache:function(employee,currentTo){Leave.Report.Bradford.emp_score_json.loaded&&employee&&Leave.Report.Bradford.emp_score_json.emp_json[employee]&&(Leave.Report.Bradford.emp_score_json.emp_json[employee].isDiffDate=currentTo!==Leave.Report.Bradford.emp_score_json.params.to)},getIsDiffDateInEmpCache:function(employee){var isDiffDate=!0;return employee&&Leave.Report.Bradford.emp_score_json.emp_json[employee]&&((isDiffDate=!0===Leave.Report.Bradford.emp_score_json.emp_json[employee].isDiffDate)||Leave.Report.Bradford.DetailView.isFromReport()||(isDiffDate=void 0===Leave.Util.getCurrDateFromFilterOptions()||Leave.Util.getCurrDateFromFilterOptions()!==Leave.Report.Bradford.emp_score_json.params.to)),isDiffDate},get:function(){var employee=Leave.Report.Bradford.DetailView.getEmployee(),to=Leave.Report.Bradford.DetailView.getToDate();if(Leave.Util.appendLoading(),Leave.Report.Bradford.emp_score_json.loaded&&Leave.Report.Bradford.emp_score_json.emp_json[employee]&&!Leave.Report.Bradford.DetailView.getIsDiffDateInEmpCache(employee)&&Leave.Report.Bradford.DetailView.isAllBradfordsLoadedForEmp()){var emp_json=Leave.Report.Bradford.emp_score_json.emp_json[employee];Leave.Report.Bradford.DetailView.construct(Leave.Report.Bradford.DetailView.getFromDate(),to,emp_json.emp_details||{},emp_json.bradford_details||{})}else{var params={key:Leave.Report.Bradford.DetailView.employee_bradford_key,employee:employee,fetchLeave:!0};to&&Leave.Report.Bradford.DetailView.isFromReport()&&(params.to=to),ZPeople.Request.send(Leave.Report.Bradford.DetailView.url,params,Leave.Report.Bradford.DetailView.empBradfordCallback)}},empBradfordCallback:function(result,params){Leave.Report.Bradford.Response.isSuccess(result)&&result.data?(Leave.Report.Bradford.emp_score_json.emp_json[params.employee]=result.data,Leave.Report.Bradford.emp_score_json.allBradfordsAvailable=!0,Leave.Report.Bradford.DetailView.setIsDiffDateInEmpCache(params.employee,result.to),Leave.Report.Bradford.DetailView.construct(result.from,result.to,result.data.emp_details||{},result.data.bradford_details||{})):(ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.scorelist")),Leave.Util.removeLoading(),window.location.href=Leave.Report.Bradford.DetailView.getModalHideURL())},construct:function(from,to,emp_details,bradford_details){Leave.Report.Bradford.DetailView.getIsShowEmpSelect();if(Leave.Util.removeLoading(),Layout.Page.container.find("#zpl_brdfordtogg").remove(),Layout.Page.container.html('<div class="zpl_btnmnu"><div class="zpl_lft"></div><div class="zpl_cntrdv" aria-label="'+ZPI18N.getString("zp.common.period")+from+" - "+to+'" tabindex="0"><div id="ZPCalNavTxt"><b>'+from+" - "+to+'</b></div></div><div class="zpl_rgt"></div></div><div class="zpl_rgtcnt" id="zp_report_bradford_dtl"><div class="zpl_brdfordtogg" id="zpl_brdfordtogg"></div></div>'),Object.keys(bradford_details).length>0){let contdiv=Layout.Page.container.find("#zpl_brdfordtogg");$.each(bradford_details,function(bradfordId){var bf_json=bradford_details[bradfordId];contdiv.append(Leave.Report.Bradford.DetailView.constructBradfordSummary(to,bf_json,emp_details,bradfordId))});let temp=ZPeopleComponents.collapsiblepanels(Layout.Page.container.find("#zpl_brdfordtogg"),{toggleButtonPosition:"right",toggleOnHeaderClick:!0,beforepanelexpand:"Leave.Report.Bradford.DetailView.showHideOtherPanels"});setTimeout(function(){temp.expandPanel("#"+$(Layout.Page.container.find("#zpl_brdfordtogg").find(".zcollapsiblepanel")[0]).attr("id"))},500)}else Leave.Util.showHideNoData(!0,ZPI18N.getString("zp.bradfordfactor.error.noscorelist"),Layout.Page.container.find("#zpl_brdfordtogg"));Layout.Page.container.find("#zp_report_bradford_dtl").parent().parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.leave.report.bradfordscore")]),tabindex:"0"})},constructBradfordSummary:function(to,bf_json,emp_details,bradfordId){{let div_ele='<div data-is-active=false id="panel_'+bradfordId+'" tabindex="0" aria-label="'+bf_json.settingName+" "+ZPI18N.getString("zp.bradfordfactor.bradfordscore")+":"+bf_json.score+" "+ZPI18N.getString("zp.Level")+" "+bf_json.level+'"><div class="heading"><div class=" d-flexclmcap20 a-itm-cntr">';div_ele+="<b>"+bf_json.settingName+"</b> </div>",div_ele+='<div class="zpl_collaspeactions"> <div class="zpl_brdscrlvl"> <em>'+ZPI18N.getString("zp.bradfordfactor.bradfordscore")+" - </em> <b>"+bf_json.score+"</b> <em>("+ZPI18N.getString("zp.Level")+" "+bf_json.level+")</em> </div> </div>",div_ele+="</div>",div_ele+='<div class="body">',div_ele+='<div class="zpl_secn"> <div class=" d-flexC flexclmcap"><div class="zpl_info d-flexclmcap20  MTauto"></div></div><div class="actn_ovrly"> <div> <button type="button" class="zlabel zlabel--blue zlabel--medium mrg DN">'+ZPI18N.getString("zp.bradfordfactor.mergeoccur")+'</button><button type="button" class="zlabel zlabel--blue zlabel--medium splt DN">'+ZPI18N.getString("zp.bradfordfactor.splitmergeoccur")+"</button> </div> </div></div>",div_ele+='<div class="zpl_secn zpl_accrdnTblfxd" id="lv_details_sec"></div>',div_ele+='<div class="zpl_gbox wd100_per"><div class="d-flex d-flex-btw"  id="stsbr"></div></div>',div_ele+="</div>",div_ele=$(div_ele);for(var auditEle,cust_thresEle,levels=bf_json.empBradfordLevels?bf_json.empBradfordLevels:bf_json.bradfordLevels,prev_threshold=0,prev_level=1,leveltxt="",i=0;i<levels.length;i++){var level_json=levels[i];leveltxt+='<span class="d-flexclmcap10"><span>'+ZPI18N.getString("zp.Level")+" "+level_json.level+"</span>"+(0===i?"":">")+"<b>"+prev_threshold+" - "+level_json.threshold+"</b></span>",prev_threshold=level_json.threshold,prev_level=level_json.level}if(leveltxt+='<span class="d-flexclmcap10"><span>'+ZPI18N.getString("zp.Level")+" "+(prev_level+1)+"</span><b> > "+prev_threshold+"</b></span>",div_ele.find(".MTauto").html(leveltxt),$(div_ele).find(".zlabel--medium.mrg").on("click",function(){Leave.Report.Bradford.MergeOccurrences.merge(this,to,emp_details.erecno,bradfordId)}),$(div_ele).find(".zlabel--medium.splt").on("click",function(){Leave.Report.Bradford.MergeOccurrences.split(this,to,emp_details.erecno,bradfordId)}),bf_json.empBradfordLevels&&Leave.Report.Bradford.Audit.isAllowedToView())(auditEle=$('<i id="zp_level_audit" class="PI_info M0I zpl_popovr-js" title="'+ZPI18N.getString("zp.bradfordfactor.customizethresaudit")+'"></i>')).on("click",function(){Leave.Report.Bradford.Audit.getAudit(auditEle,to,emp_details.erecno,bradfordId,bf_json.empBradfordLevels)}),div_ele.find(".MTauto").prepend(auditEle);if(Leave.Report.Bradford.CustomizeThreshold.isThresholdCustomizationAllowed())(cust_thresEle=$("<a>"+ZPI18N.getString("zp.bradfordfactor.customizethreshold")+"</a>")).on("click",function(){Leave.Report.Bradford.CustomizeThreshold.construct(this,to,emp_details.erecno,bradfordId,levels)}),div_ele.find(".MTauto").after(cust_thresEle);return Leave.Report.Bradford.DetailView.showLeaveDetails(div_ele,to,emp_details.erecno,bradfordId),div_ele}},showHideOtherPanels:event=>{if(1==event.detail.isTrusted){let temp=ZPeopleComponents.collapsiblepanels("#zpl_brdfordtogg");temp.collapseAllPanels(),temp.expandPanel("#"+$(event.detail.element).attr("id"))}},showLeaveDetails:function(ele,to,employee,bradfordId){var tgl_div=ele;if(0===$(tgl_div).find(".zpl_tblres").length)if(Leave.Report.Bradford.emp_score_json.emp_json[employee].bradford_details[bradfordId].leave_dtls)Leave.Report.Bradford.DetailView.constructLeaveDetails(tgl_div,Leave.Report.Bradford.emp_score_json.emp_json[employee].bradford_details[bradfordId]);else{Leave.Util.appendLoading({type:"popup",containerId:"zp_report_bradford_dtl"}),Layout.Page.container.find("#zp_report_bradford_dtl").fadeOut(100);var params={key:Leave.Report.Bradford.DetailView.employee_bradford_key,employee:employee,bradfordId:bradfordId,to:to,fetchLeave:!0};ZPeople.Request.send(Leave.Report.Bradford.DetailView.url,params,Leave.Report.Bradford.DetailView.leaveDetailsCallback,{tgl_div:tgl_div})}},leaveDetailsCallback:function(result,params,other_dtls){if(Leave.Report.Bradford.Response.isSuccess(result)&&result.data&&Object.keys(result.data).length>0){var bf_json=result.data.bradford_details[params.bradfordId];Leave.Report.Bradford.emp_score_json.emp_json[params.employee].bradford_details[params.bradfordId]=bf_json,Leave.Report.Bradford.DetailView.constructLeaveDetails(other_dtls.tgl_div,bf_json)}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.noleaves"));Leave.Util.removeLoading(),Layout.Page.container.find("#zp_report_bradford_dtl").fadeIn()},constructLeaveDetails:function(tgl_div,bf_json){{let bradfordId=bf_json.bradfordId;var leave_dtls_arr,isSingleLeaveAppl=!1;if(1===(leave_dtls_arr=bf_json.leave_dtls).length){var leave_dtls=leave_dtls_arr[0];$.each(leave_dtls,function(mergeId){isSingleLeaveAppl=1===leave_dtls[mergeId].length})}var leave_div='<div class="zpl_tblres"> <table class="zpl_tbl"><thead>';leave_div+=(Leave.Report.Bradford.MergeOccurrences.isMergeSplitActionAllowed()&&!isSingleLeaveAppl?'<th id="check_all" class="w60"><div class="zcheckbox" ><input id="checkall_'+bradfordId+'" type="checkbox" name="checkall" class="zcheckbox__helper"><label for="checkall_'+bradfordId+'" class="zcheckbox__label"></label></div></th>':"")+"<th>"+ZPI18N.getString("zp.leaveperiod")+"</th><th>"+ZPI18N.getString("zp.leavetype")+"</th><th>"+ZPI18N.getString("zp.leave.dtaken")+'</th><th width="300">'+ZPI18N.getString("zp.leave.reason")+"</th>"+(Leave.Util.isApprovalConfigured()?'<th class="text-center">'+ZPI18N.getString("zp.approvalstatus")+"</th>":""),leave_div+=' </thead> <tbody id="leave_tbody"> </tbody></table></div>',(leave_div=$(leave_div)).find(".zcheckbox input").on("change",function(){Leave.Report.Bradford.MergeOccurrences.onCheckboxAllStateChange(this)});for(var tbodyEle=$("<div></div>"),idx=0;idx<leave_dtls_arr.length;idx++){leave_dtls=leave_dtls_arr[idx];$.each(leave_dtls,function(mergeId){for(var leave_tr,leaveArr=leave_dtls[mergeId],isMerged="-1"!==mergeId&&leaveArr.length>1,i=0;i<leaveArr.length;i++){isMerged&&0!==i||(leave_tr=$('<tr class="'+(isMerged?"mrgd-occr":"")+'">'+(Leave.Report.Bradford.MergeOccurrences.isMergeSplitActionAllowed()&&!isSingleLeaveAppl?'<td><div class="zcheckbox '+(isMerged?"spltOccr":"mrgOccr")+'"><input type="checkbox" id="'+bradfordId+"_chk_"+i+'" name="chk_'+i+'" class="zcheckbox__helper"><label for="'+bradfordId+"_chk_"+i+'" class="zcheckbox__label"></label></div></td>':"")+'<td id="td_date"></td><td id="td_type" class="zpl_bfbrk"></td><td id="td_days" class="zpl_bfbrk"></td><td id="td_reason" class="zpl_bfbrk"></td>'+(Leave.Util.isApprovalConfigured()?'<td id="td_status" class="text-center zpl_bfbrk"></td>':"")+"</tr>"));var leaveObj=leaveArr[i];if($(leave_tr).find("#td_date").append($('<div class="zpl_bfmrge"><span id="td_date_div" row="'+i+'" '+(isMerged?'class="mrgdts"':"")+">"+leaveObj.from+" - "+leaveObj.to+"</span></div>")),$(leave_tr).find("#td_date span#td_date_div[row="+i+"]").data("leaveId",leaveObj.leaveId),$(leave_tr).find("#td_type").append($("<span "+(isMerged&&i!==leaveArr.length-1?'class=""':"")+">"+leaveObj.leaveTypeName+"</span>")),$(leave_tr).find("#td_days").append($("<span "+(isMerged&&i!==leaveArr.length-1?'class=""':"")+">"+leaveObj.leaveTaken+" "+ZPI18N.getString("zp.days")+"</span>")),$(leave_tr).find("#td_reason").append($("<span "+(isMerged&&i!==leaveArr.length-1?'class=""':"")+">"+(leaveObj.reason?leaveObj.reason:"")+"</span>")),Leave.Util.isApprovalConfigured()){let tempstatus=Leave.Report.Bradford.DetailView.getStatusIcon(leaveObj.approvalStatus);$(leave_tr).find("#td_status").append($('<span class=" '+tempstatus.classname+'">'+tempstatus.text+"</span>"))}isMerged&&leaveArr.length-1!==i||($(leave_tr).data("mergeId",mergeId),$(leave_tr).data("leave_appl_cnt",i),tbodyEle.append(leave_tr))}})}tbodyEle.find("tr .zcheckbox input").on("change",function(){Leave.Report.Bradford.MergeOccurrences.onCheckboxStateChange(this)}),leave_div.find("tbody#leave_tbody").append(tbodyEle.children()),tgl_div.find("#stsbr").html($("<div><em>"+ZPI18N.getString("zp.bradfordfactor.occurrencen")+" -</em> <b>"+bf_json.no_of_instances+"</b></div><div><em>"+ZPI18N.getString("zp.bradfordfactor.totaldaysd")+" -</em> <b>"+bf_json.no_of_days.toFixed(2)+"</b></div><div><em>"+ZPI18N.getString("zp.bradfordfactor.scoref")+" -</em> <b>"+bf_json.no_of_instances+" * "+bf_json.no_of_instances+" * "+bf_json.no_of_days.toFixed(2)+"</b></div><div><b>"+bf_json.score+"</b> <em>("+ZPI18N.getString("zp.Level")+" "+bf_json.level+") </em></div>")),0===$(tgl_div).find("#lv_details_sec").find(".zpl_tblres").length?$(tgl_div).find("#lv_details_sec").append(leave_div):$(tgl_div).find("#lv_details_sec").find(".zpl_tblres").replaceWith(leave_div)}},getStatusIcon:function(approvalStatus){{let obj={text:ZPI18N.getString("zp.approved"),classname:"grn"};return-1==approvalStatus?obj={text:ZPI18N.getString("zp.pending"),classname:"ylw"}:1==approvalStatus?obj={text:ZPI18N.getString("zp.approved"),classname:"grn"}:0==approvalStatus?obj={text:ZPI18N.getString("zp.rejected"),classname:"red"}:2==approvalStatus&&(obj={text:ZPI18N.getString("zp.rejected"),classname:"red"}),obj}}},Audit:{key:"bradford_emp_levels_audit",isAllowedToView:function(){return Leave.Util.isAllDataAdmin()},getAudit:function(ele,to,employee,bradfordId,bradfordLevels){if(Layout.Page.container.find("[id=bradford_popup]").length>0&&Layout.Page.container.find("[id=bradford_popup]").remove(),$(ele).data("content"))Leave.Report.Bradford.Audit.showAudit(ele,$(ele).data("content"));else{var audit=Leave.Report.Bradford.emp_score_json.emp_json[employee].bradford_details[bradfordId].audit;if(audit)Leave.Report.Bradford.Audit.constructAudit(ele,audit,bradfordLevels);else{var params={key:Leave.Report.Bradford.Audit.key,employee:employee,bradfordId:bradfordId,to:to};ZPeople.Request.send(Leave.Report.url,params,Leave.Report.Bradford.Audit.auditCallback,{ele:ele,bradfordLevels:bradfordLevels})}}},auditCallback:function(result,params,other_dtls){Leave.Report.Bradford.Response.isSuccess(result)&&result.data&&result.data.length>0?result.data.length>0?(Leave.Report.Bradford.emp_score_json.emp_json[params.employee].bradford_details[params.bradfordId].audit=result.data[0].audit,Leave.Report.Bradford.Audit.constructAudit(other_dtls.ele,result.data[0].audit,other_dtls.bradfordLevels)):($(ele).data("content",ZPI18N.getString("zp.nochangesmade")),Leave.Report.Bradford.Audit.showAudit(ele,ZPI18N.getString("zp.nochangesmade"))):result&&result.message?ModuleComp.Msg.showFailureMsg(result.message):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.audit"))},constructAudit:function(ele,time_json,bradfordLevels){var auditHtml="";$.each(time_json,function(created_time){var time_arr=time_json[created_time];auditHtml+='<div id="bradford_popup" class="zpl_popoverinr"> <h5>'+ZPI18N.getString("zp.bradfordfactor.customizethresaudit")+"</h5> ",auditHtml+='<table class="zpl_itbl"> <tbody> <tr> <td> <span>'+ZPI18N.getString("zp.reason")+" </span> </td> <td><em>"+time_arr[0].reason+"</em></td> </tr>",auditHtml+="<tr> <td> <span>"+ZPI18N.getString("zp.bradfordfactor.customizedby",[""])+" :</span> </td> <td><em> "+time_arr[0].owner_details.empName+"</em></td> </tr>",auditHtml+=" <tr> <td> <span>"+ZPI18N.getString("zp.bradfordfactor.customizedon",[""])+" :</span> </td> <td><em> "+time_arr[0].created_time+"</em></td> </tr>";for(var prev_level_json={},i=0;i<time_arr.length;i++){var data_json=time_arr[i];prev_level_json[data_json.level]=data_json.old_threshold}var prev_threshold=0,last_level=1;for(i=0;i<bradfordLevels.length;i++){var level_json=bradfordLevels[i],threshold=prev_level_json[level_json.level]?prev_level_json[level_json.level]:level_json.threshold;auditHtml+="<tr>",auditHtml+=0==i?"<td> <span>"+ZPI18N.getString("zp.bradfordfactor.prevthreshold")+" :</span> </td> ":"<td></td>",auditHtml+="<td><em>"+ZPI18N.getString("zp.Level")+" "+level_json.level+"  "+(0===i?prev_threshold:">"+prev_threshold)+" - "+threshold+"</em></td>",auditHtml+="</tr>",prev_threshold=threshold,last_level=level_json.level}auditHtml+="<tr><td></td><td><em>"+ZPI18N.getString("zp.Level")+" "+(last_level+1)+"  >"+prev_threshold+"</em></td></tr>",auditHtml+=" </tbody> </table> </div>"}),Layout.Page.container.append(auditHtml),Leave.Report.Bradford.Audit.showAudit(ele,auditHtml)},showAudit:function(ele,content){ZPeopleComponents.popover("#bradford_popup",{displayType:"callout",closeOnBodyClick:!0,forElement:ele,position:"bottom-left"}).open()}},MergeOccurrences:{key:"bradford_merge_occurrence",isMergeSplitActionAllowed:function(){return Leave.Util.isAllDataAdmin()},onCheckboxStateChange:function(ele){var tBodyEle=$(ele).closest("tbody#leave_tbody"),tgl_div=tBodyEle.parents(".zcollapsiblepanel.is-selected");Leave.Report.Bradford.MergeOccurrences.showHideActionButtons(tgl_div,tBodyEle),tBodyEle.find(".zcheckbox input:checked").length===tBodyEle.find(".zcheckbox input").length?tgl_div.find("th#check_all input").prop("checked",!0):tgl_div.find("th#check_all input").prop("checked",!1)},onCheckboxAllStateChange:function(ele){var tgl_div=$(ele).parents(".zcollapsiblepanel.is-selected"),tBodyEle=tgl_div.find("tbody#leave_tbody");$(ele).is(":checked")?tBodyEle.find(".zcheckbox input").prop("checked",!0):tBodyEle.find(".zcheckbox input:checked").prop("checked",!1),Leave.Report.Bradford.MergeOccurrences.showHideActionButtons(tgl_div,tBodyEle)},showHideActionButtons:function(tgl_div,tBodyEle){var selectedLeaveIdCnt=tBodyEle.find(".zcheckbox.mrgOccr input:checked").length,selectedMergeIdCnt=tBodyEle.find(".zcheckbox.spltOccr input:checked").length;let isHide=0;selectedLeaveIdCnt+selectedMergeIdCnt>1?tgl_div.find(".actn_ovrly .zlabel--medium.mrg").removeClass("disabled").show():(isHide++,tgl_div.find(".actn_ovrly .zlabel--medium.mrg").hide()),selectedMergeIdCnt>0?tgl_div.find(".actn_ovrly .zlabel--medium.splt").removeClass("disabled").show():(isHide++,tgl_div.find(".actn_ovrly .zlabel--medium.splt").hide()),2==isHide?tgl_div.find(".actn_ovrly").removeClass("opn"):tgl_div.find(".actn_ovrly").addClass("opn")},resetCheckBoxState:function(tgl_div){tgl_div.find(".actn_ovrly").removeClass("opn"),tgl_div.find(".actn_ovrly .zlabel--medium.mrg,.zlabel--medium.splt").hide(),tgl_div.find("th#check_all input").prop("checked",!1),tgl_div.find("tbody#leave_tbody").find(".zcheckbox input:checked").prop("checked",!1)},merge:function(ele,to,employee,bradfordId){Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .zcollapsiblepanel.is-selected",buttonClass:"zlabel--medium.mrg,.zlabel--medium.splt"});var leaveIds=new Array,tgl_div=$(ele).closest(".zcollapsiblepanel.is-selected"),checkedEles=tgl_div.find("tbody#leave_tbody").find(".zcheckbox input:checked");if($.each(checkedEles,function(i){var checkedEle=checkedEles[i],leave_date_divs=$(checkedEle).parents("tr").find("td#td_date span#td_date_div");$.each(leave_date_divs,function(idx){leaveIds.push($(leave_date_divs[idx]).data("leaveId"))})}),leaveIds.length<2)ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.minmergeleave")),Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .zcollapsiblepanel.is-selected",buttonClass:"zlabel--medium.mrg,.zlabel--medium.splt"});else if(leaveIds.length>250)ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.maxmergeleave")),Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .zcollapsiblepanel.is-selected",buttonClass:"zlabel--medium.mrg,.zlabel--medium.splt"});else{Leave.Util.appendLoading({type:"popup",containerId:"zp_report_bradford_dtl",containerClass:"modal-body"}),Layout.Page.container.find("#zp_report_bradford_dtl").fadeOut(100);var params={key:Leave.Report.Bradford.MergeOccurrences.key,operation:"merge",leaveIds:JSON.stringify(leaveIds),employee:employee,bradfordId:bradfordId,to:to};ZPeople.Request.send(Leave.Report.url,params,Leave.Report.Bradford.MergeOccurrences.mergeSplitCallback,{tgl_div:tgl_div})}},split:function(ele,to,employee,bradfordId){Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .zcollapsiblepanel.is-selected",buttonClass:"zlabel--medium.mrg,.zlabel--medium.splt"});var mergeIds=new Array,tgl_div=$(ele).closest(".zcollapsiblepanel.is-selected"),checkedEles=tgl_div.find("tbody#leave_tbody").find(".zcheckbox input:checked");if($.each(checkedEles,function(i){var checkedEle=checkedEles[i],mergeId=$(checkedEle).parents("tr").data("mergeId");mergeId&&"-1"!==mergeId&&mergeIds.push(mergeId)}),mergeIds.length<1)ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.minmergeid")),Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .zcollapsiblepanel.is-selected",buttonClass:"zlabel--medium.mrg,.zlabel--medium.splt"});else if(mergeIds.length>250)ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.maxmergeid")),Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .zcollapsiblepanel.is-selected",buttonClass:"zlabel--medium.mrg,.zlabel--medium.splt"});else{Leave.Util.appendLoading({type:"popup",containerId:"zp_report_bradford_dtl",containerClass:"modal-body"}),Layout.Page.container.find("#zp_report_bradford_dtl").fadeOut(100);var params={key:Leave.Report.Bradford.MergeOccurrences.key,operation:"split",mergeIds:JSON.stringify(mergeIds),employee:employee,bradfordId:bradfordId,to:to};ZPeople.Request.send(Leave.Report.url,params,Leave.Report.Bradford.MergeOccurrences.mergeSplitCallback,{tgl_div:tgl_div})}},mergeSplitCallback:function(result,params,other_dtls){var isMerge="merge"===params.operation,skipReset=!1;if(Leave.Report.Bradford.Response.isSuccess(result)){if(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString(isMerge?"zp.bradfordfactor.success.mergesuccess":"zp.bradfordfactor.success.splitsuccess")),result.data){var bf_json=result.data.bradford_details[params.bradfordId];Leave.Report.Bradford.emp_score_json.emp_json[params.employee].bradford_details[params.bradfordId]=bf_json,$(other_dtls.tgl_div).find(".actn_ovrly").removeClass("opn"),$(other_dtls.tgl_div).find(".actn_ovrly .zlabel--medium.mrg,.zlabel--medium.splt").hide();var ntgl_div=Leave.Report.Bradford.DetailView.constructBradfordSummary(params.to,bf_json,result.data.emp_details,params.bradfordId);$(other_dtls.tgl_div).find(".heading").html(ntgl_div.find(".heading").children()),$(other_dtls.tgl_div).find(".body").html(ntgl_div.find(".body").children()),Leave.Report.Bradford.DetailView.constructLeaveDetails($(other_dtls.tgl_div).find(".body"),bf_json),skipReset=!0}}else result&&result.message?ModuleComp.Msg.showFailureMsg(result.message):ModuleComp.Msg.showFailureMsg(ZPI18N.getString(isMerge?"zp.bradfordfactor.error.mergeerror":"zp.bradfordfactor.error.spliterror"));skipReset||(Leave.Util.toggleButton({containerId:"zp_report_bradford_dtl .zcollapsiblepanel.is-selected",buttonClass:"zlabel--medium.mrg,.zlabel--medium.splt"}),Leave.Report.Bradford.MergeOccurrences.resetCheckBoxState(other_dtls.tgl_div)),Leave.Util.removeLoading(),Layout.Page.container.find("#zp_report_bradford_dtl").fadeIn(100)}},CustomizeThreshold:{key:"bradford_customize_level",isThresholdCustomizationAllowed:function(){return Leave.Util.isAllDataAdmin()},construct:function(ele,to,employee,bradfordId,bradfordLevels){var tgl_div=$(ele).parents(".zcollapsiblepanel.is-selected"),body='<table class="table thrshld_tbl"><thead><tr class="zp"><th>'+ZPI18N.getString("zp.bradfordfactor.threslevel")+"</th><th>"+ZPI18N.getString("zp.bradfordfactor.thresrange")+'</th></tr></thead><tbody id="level_tbody"></tbody></table>';body='<div class="zpl_crd"> ';body+='<div class="zpl_crdcnt"> <div class="zpl_secn"> <div> <div class="zpl_tblres"> <table class="zpl_tbl wd100_per"> <thead> <tr> <th>'+ZPI18N.getString("zp.bradfordfactor.threslevel")+"</th> <th>"+ZPI18N.getString("zp.bradfordfactor.thresrange")+'</th> </tr> </thead> <tbody id="level_tbody"> </tbody> </table> </div> </div> </div>',body+='<div class="zpl_secn" name="reason"> <div> <label>'+ZPI18N.getString("zp.bradfordfactor.customizereason")+'</label> </div> <div> <textarea class="ztextbox" placeholder="'+ZPI18N.getString("zp.enterreason")+'"></textarea> </div> </div> </div> </div>',ModuleComp.Modal.centerModal(Leave.Report.Bradford.CustomizeThreshold.save,ZPI18N.getString("zp.bradfordfactor.customizethreshold"),body,ZPI18N.getString("zp.save"),{employee:employee,bradfordId:bradfordId,to:to,tgl_div:tgl_div,bradfordLevels:bradfordLevels,closeOnSubmit:!1},void 0,void 0,"cust_thrshld",void 0,void 0);let modal=Layout.Page.container.find("#cust_thrshld");var rows=Leave.Report.Bradford.CustomizeThreshold.getLevelRows(bradfordLevels);modal.find(".zpl_mcnt tbody#level_tbody").append(rows.children()),ModuleComp.Modal.show(modal)},getLevelRows:function(bradfordLevels){for(var rows=$("<div></div>"),level=0,prev_val=0,i=0;i<bradfordLevels.length;i++){var leveljson=bradfordLevels[i],threshold=(level=leveljson.level,leveljson.threshold);$(rows).append($('<tr level="'+level+'"><td>'+ZPI18N.getString("zp.Level")+" "+level+'</td><td><div class="zpl_idiv"><span class="thsval_frm" id="zp_level'+level+'"> &gt; '+prev_val+'</span><span> - </span> <input id="zp_level'+level+'" level="'+level+'" type="text" value="'+threshold+'" class="ztextbox w100"></div></td></tr>')),prev_val=threshold}return $(rows).find("tr input[id^='zp_level']").on("keyup",function(){Leave.Report.Bradford.CustomizeThreshold.onThresholdChange(this)}),$(rows).append('<tr level="last"><td id="zp_lastlevel_label">'+ZPI18N.getString("zp.Level")+" "+(level+1)+'</td><td><div class="zpl_idiv"><span id="zp_lastlevel" level="last" class="thsval_frm"> &gt; '+prev_val+"</span></div></td></tr>"),rows},onThresholdChange:function(ele){var threshold=$(ele).val();if($(ele).removeClass("ztextbox__error"),$(ele).parents("table").siblings(".ztextbox--error__label").remove(),$(ele).parents("#zp_addedit_bradford").find(".btn-primary.disabled").removeClass("disabled"),"SUCCESS"!==ZPUtil.Validation.isDecimal(threshold).message)return $(ele).addClass("ztextbox__error"),void Leave.Util.toggleButton({containerId:"zp_addedit_bradford",buttonClass:"btn-primary"});$(ele).attr("level");var nextleveltr=$(ele).closest("tr").next();"last"===nextleveltr.attr("level")?nextleveltr.find("span#zp_lastlevel").text(" > "+threshold):nextleveltr.find("span").text(" > "+threshold)},validate:function(modal,params){$(".ztextbox__error",modal).removeClass("ztextbox__error"),$(".ztextbox--error__label",modal).remove();for(var extraDetails=modal.data("extraDetails"),tBody=$("#level_tbody",modal),bradfordLevels=extraDetails.bradfordLevels,bradford_level_json={},i=0;i<bradfordLevels.length;i++)bradford_level_json[bradfordLevels[i].level]=bradfordLevels[i].threshold;var thresholdValues="",thresholdArr=new Array,isChangeInThreshold=!1,leveltrs=tBody.find("tr[level]");for(i=0;i<leveltrs.length-1;i++){var threshold=$("input#zp_level"+(i+1),leveltrs[i]).val();if(ZPUtil.Validation.isEmpty(threshold)||"SUCCESS"!==ZPUtil.Validation.isDecimal(threshold).message)return $("input#zp_level"+(i+1),leveltrs[i]).addClass("ztextbox__error"),$("input#zp_level"+(i+1),leveltrs[i]).after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.bradfordfactor.error.validthreshold")+"</span>"),!1;if(-1!==thresholdArr.indexOf(threshold))return $("input#zp_level"+(i+1),leveltrs[i]).addClass("ztextbox__error"),Leave.Settings.Bradford.Operations.appendErrorMsg({bradfordLevels:ZPI18N.getString("zp.bradfordfactor.error.dupthreshold")},modal),!1;thresholdArr.push(threshold),thresholdValues+=threshold+",",parseFloat(threshold)!==bradford_level_json[i+1]&&(isChangeInThreshold=!0)}if(!isChangeInThreshold)return ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.nochangesmade")),!1;if(ZPUtil.Validation.isEmpty(thresholdValues))return Leave.Settings.Bradford.Operations.appendErrorMsg({bradfordLevels:ZPI18N.getString("zp.bradfordfactor.error.validlevelthreshold")},modal),!1;params.bradfordLevels=thresholdValues;var reasonEle=modal.find("div[name='reason'] textarea");return ZPUtil.Validation.isEmpty(reasonEle.val())?(reasonEle.addClass("ztextbox__error"),reasonEle.after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.bradfordfactor.error.levelcustomizereason")+"</span>"),!1):reasonEle.val().length>5e3?(reasonEle.addClass("ztextbox__error"),reasonEle.after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.bradfordfactor.error.thresreasonlen")+"</span>"),!1):(params.reason=reasonEle.val(),!0)},save:function(modal){Leave.Util.toggleButton({containerId:"cust_thrshld",buttonClass:"btn-primary"});var extraDetails=modal.data("extraDetails"),employee=extraDetails.employee,bradfordId=extraDetails.bradfordId,to=extraDetails.to,params={key:Leave.Report.Bradford.CustomizeThreshold.key,employee:employee,bradfordId:bradfordId,to:to};Leave.Report.Bradford.CustomizeThreshold.validate(modal,params)?ZPeople.Request.send(Leave.Report.url,params,Leave.Report.Bradford.CustomizeThreshold.saveCallback,{tgl_div:extraDetails.tgl_div}):Leave.Util.toggleButton({containerId:"cust_thrshld",buttonClass:"btn-primary"})},saveCallback:function(result,params,other_dtls){if(Leave.Report.Bradford.Response.isSuccess(result)){if(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.bradfordfactor.success.customizethressuccess")),result.data){var bf_json=result.data.bradford_details[params.bradfordId];Leave.Report.Bradford.emp_score_json.emp_json[params.employee].bradford_details[params.bradfordId]=bf_json;var ntgl_div=Leave.Report.Bradford.DetailView.constructBradfordSummary(params.to,bf_json,result.data.emp_details,params.bradfordId);$(other_dtls.tgl_div).find(".heading").html(ntgl_div.find(".heading").children()),$(other_dtls.tgl_div).find(".body").html(ntgl_div.find(".body").children()),Leave.Report.Bradford.DetailView.constructLeaveDetails($(other_dtls.tgl_div).find(".body"),bf_json)}}else result&&result.message?ModuleComp.Msg.showFailureMsg(result.message):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.customizethreserror"));Leave.Util.toggleButton({containerId:"cust_thrshld",buttonClass:"btn-primary"}),ModuleComp.Modal.hide("cust_thrshld")}},Response:{isSuccess:function(result){return result&&"success"===result.status}}};