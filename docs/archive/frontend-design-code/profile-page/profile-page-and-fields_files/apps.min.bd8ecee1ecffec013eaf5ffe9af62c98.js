var AccessControl={Roles:{url:"Roles.zp",isEditOnFuncInitialized:!1,isAddOnFuncInitialized:!1},Permissions:{NODATA:0,MYDATA:1,SUBDATA:4,TEAMDATA:2,ALLDATA:3,RolesPerm:{fcId:null,url:"/rolePermissions.zp",template:'<div class="modal modal-small fade" id="RolesPerm" role="dialog"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"><a type="button" class="close IC-cls-1px red" data-dismiss="modal"></a> <h4 class="modal-title"><span class="txttrim" id="perm_label"></span></h4> </div> <div class="modal-body"> <div class="row"> <div class="col-md-12 dvtabsfrm"> <table class="table table-responsive"> <thead><tr><th>'+ZPI18N.getString("zp.roles")+'</th> <th class="text-center">'+ZPI18N.getString("zp.view")+'</th> <th class="text-center" id="editPermRow">'+ZPI18N.getString("zp.edit")+'</th> </tr> </thead> <tbody></tbody> </table></div> </div> </div> <div class="modal-footer"><div class="text-left"><a class="btn btn-primary" onclick="AccessControl.Permissions.RolesPerm.addList()">'+ZPI18N.getString("zp.done")+'</a><a class="btn btn-link pull-right MR0" id = "permissions"onclick="$(\'#RolesPerm\').modal(\'hide\')">'+ZPI18N.getString("zp.goToPermission")+'<i class="IC-ar-rgt S10 ML5"></i></a></div></div></div></div></div>'},ModulePerm:{url:"modulePermissions.zp"},GlobalPerm:{url:"globalPermissions.zp"},configPermForRole:function(ele){var isOperationalRole=$(ele).attr("isOperationalRole"),roleId=ele;void 0==ele?(roleId=AccessControl.Permissions.FormPerm.roleId,AccessControl.Permissions.FormPerm.roleId=null):roleId=$(ele).attr("value");ele=Layout.Page.container.find("#formpermissionsidlist option:selected");if(AccessControl.Permissions.FormPerm.IS_RESTRICTED_FORM){var formid=Layout.Page.container.find("#permissionPopUpFormId").val();Layout.Page.container.find("#permissionPopUpRoleId").val(roleId).select2(),Layout.Page.container.find("#permissionPopUpFormId").val(formid).select2();var params={roleId:roleId,formId:formid,mode:"fperm.list.sub",submode:"fieldperm"};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.FieldPerm.show)}else AccessControl.Permissions.FormPerm.RecordPerm.forRole(roleId,isOperationalRole)}}};AccessControl.Permissions.remove=function(){$("#admin-accesscontrol-permissions-form").remove(),AccessControl.Permissions.FormPerm.ID_LIST_INITIALISED=!1},AccessControl.Roles.init=function(){OrgStructureRoles.ROLE_DETAILS=[];var params={conreqcsr:csrfToken,mode:"list"};ZPeople.Request.send(AccessControl.Roles.url,params,AccessControl.Roles.listAllRoles)},AccessControl.Roles.listAllRoles=function(resdata){if("success"==resdata.status){ZPUtil.Location.load();var data=resdata.rolesList;AccessControl.Roles.ROLESLIST=data;var main=jQuery("<div />");for(dat in AccessControl.Roles.roleList=data,data){var count=data[dat].count;-1==count&&(count=0);var roleCreationHTML='<div class="col-md-3" id="listRoleId-'+data[dat].roleId+'" name="roleBlock" roleid="'+data[dat].roleId+'" count="'+count+'" isopradmin="'+data[dat].isOperationalRoleAdmin+'" isoprrole="'+data[dat].isOperationalRole+'">';roleCreationHTML+='<div class="bgwhite"><div class="dvRoleTp"><b class="DB" name="rolename">'+data[dat].roleName+'</b><span class="dgry S12">'+(data[dat].isOperationalRole||data[dat].isOperationalRoleAdmin?ZPI18N.getString("zp.operationalrole"):ZPI18N.getString("zp.userrole"))+"</span>"+(data[dat].isAdmin||data[dat].isOrgStructureRoleAdmin||data[dat].isSystemRole?"":'<div class="ZPActIcn"><a id="zp_formedit_submit" data-toggle="modal" data-target="#editRolePopUp" name="edit_role" class="IC-pen-1px"></a><a id="zp_formedit_cancel" name="delete_role" class="IC-delete-1px"></a></div>')+'</div><div class="dvRoleBt">'+(data[dat].isAdmin||data[dat].isOperationalRoleAdmin?data[dat].isOperationalRoleAdmin?"":"<span>"+ZPI18N.getString("zp.alllocaction")+"</span>":'<a class="btn btn-default btnpermission" value="'+data[dat].roleId+'" onclick="AccessControl.Roles.configPermissions(this)">Configure Permissions</a>')+'<a class="spncount" '+(data[dat].isOperationalRole||data[dat].isOperationalRoleAdmin?"":"onclick=\"Organization.ManageOrgs.redirectToItsProfile('"+data[dat].roleId+"','"+encodeURIComponent(data[dat].roleName)+"','"+count+"',this)\"")+'><label class="lblcount">'+data[dat].count+"<span></span></label></a></div></div></div>",main.append($(roleCreationHTML))}Layout.Page.container.find("#listOfRoles").siblings("#zp_page_loading").remove(),Layout.Page.container.find("#listOfRoles").empty().append(main.children()),Layout.Page.container.find("#listOfRoles").find("[name='edit_role']").on("click",function(event){AccessControl.Roles.initEditRole($(event.target))}),Layout.Page.container.find("#listOfRoles").find("[name='delete_role']").on("click",function(event){var baseEle=$(event.target).closest('[name="roleBlock"]'),isoprrole=$(event.target).closest('[name="roleBlock"]').attr("isoprrole");0==parseInt(baseEle.attr("count"))||isoprrole?ZPeople.confirm($(event.target),"","zp.roleDeleteMessage",AccessControl.Roles.deleteRole):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.rolesassignedcannotdelete"))});var list=Layout.Page.container.find("#rolestemplist");for(dat in list.empty(),data)data[dat].isAdmin||data[dat].isProfile||list.append(jQuery("<option />",{value:data[dat].roleId,id:"cloneRoleId"+data[dat].roleId}).append(data[dat].roleName))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},AccessControl.Roles.deleteRole=function(ele){var roleId=$(ele).closest('[name="roleBlock"]').attr("roleid"),params={conreqcsr:csrfToken,roleId:roleId,mode:"delete"};$.post("/Roles.zp",params,function(data){if(data.isSuccess){var cloneRoleId="#cloneRoleId"+roleId;$("#listRoleId-"+roleId).remove(),$(cloneRoleId).remove(),OrgStructureRoles.ROLE_DETAILS=[],ZPeople.Message.showSuccessMsg(data.message)}else ZPeople.Message.showFailureMsg(data.message)})},AccessControl.Roles.getRoleObj=function(roleid){var roleObj={};for(d in AccessControl.Roles.roleList)if(AccessControl.Roles.roleList[d].roleId==roleid){roleObj=AccessControl.Roles.roleList[d];break}return roleObj},AccessControl.Roles.initEditRole=function(ele){var baseEle=$(ele).closest('[name="roleBlock"]');Layout.Page.container.find("#editedRoleName").val(baseEle.find('[name="rolename"]').text()),Layout.Page.container.find("#editRoleId").attr("value",baseEle.attr("roleid")),Layout.Page.container.find("#editRoleErr").remove(),Layout.Page.container.find("#editRoleButton").attr("disabled",!1);var roleObj=AccessControl.Roles.getRoleObj(baseEle.attr("roleid"));roleObj.isProfile?(Layout.Page.container.find("#profileLocationidEdit").html(ZPUtil.Location.constructLocationComboBoxOption()),Layout.Page.container.find("#profileLocationidEdit").val(roleObj.locs),Layout.Page.container.find("#profileLocationidEdit").closest(".form-group").show()):Layout.Page.container.find("#profileLocationidEdit").closest(".form-group").hide(),Layout.Page.container.find("select").select2(),AccessControl.Roles.isEditOnFuncInitialized||Layout.Page.container.find("#editRolePopUp").on("shown.bs.modal",function(){Layout.Page.container.find("#editedRoleName").trigger("focus");var val=Layout.Page.container.find("#editedRoleName").val();Layout.Page.container.find("#editedRoleName").val("").val(val),AccessControl.Roles.isEditOnFuncInitialized=!0})},AccessControl.Roles.initAddRole=function(){AccessControl.Roles.IS_OPERATIONROLE_ADD=!1,isOperationRoleAssignEnabled&&Layout.Page.container.find("#orgStructureRole").removeClass("DN"),Layout.Page.container.find("#createRoleName").val(""),Layout.Page.container.find("#addRoleErr").remove(),Layout.Page.container.find("#dvAddrole .has-error").removeClass("has-error").find("label").removeClass("red"),Layout.Page.container.find("select").select2("destroy");for(var orgStructureRoleHtml="",i=0;i<AccessControl.Roles.ROLESLIST.length;i++){var roleObj=AccessControl.Roles.ROLESLIST[i];roleObj.isAdmin||roleObj.isProfile||roleObj.isOperationalRole||roleObj.isOperationalRoleAdmin||(orgStructureRoleHtml+='<option value="'+roleObj.roleId+'">'+roleObj.roleName+"</option>")}Layout.Page.container.find("#createCloneId").html(orgStructureRoleHtml).val($("#createCloneId option:first").val()),Layout.Page.container.find("#profileLocationidAdd").html(ZPUtil.Location.constructLocationComboBoxOption()),Layout.Page.container.find("select").select2(),Layout.Page.container.find("#createRoleButton").attr("disabled",!1),Layout.Page.container.find("#roleType").prop("checked",!1),Layout.Page.container.find("#orgStructureRole").find("#oprRole").prop("checked",!1),Layout.Page.container.find("#orgStructureRole").find("#usrRole").prop("checked",!0),AccessControl.Roles.isAddOnFuncInitialized||Layout.Page.container.find("#dvAddrole").on("shown.bs.modal",function(){Layout.Page.container.find("#createRoleName").trigger("focus"),AccessControl.Roles.isAddOnFuncInitialized=!0,Layout.Page.container.find("#dvAddrole").find(".dvhelpover").popover({container:"body"})}),Layout.Page.container.find("#roleType").trigger("change")},AccessControl.Roles.initAddOperationalRole=function(obj,ischck){if(ischck){AccessControl.Roles.IS_OPERATIONROLE_ADD=!0;for(var orgStructureRoleHtml='<option value="-1">select</option>',i=0;i<AccessControl.Roles.ROLESLIST.length;i++){(roleObj=AccessControl.Roles.ROLESLIST[i]).isOperationalRole&&(orgStructureRoleHtml+='<option value="'+roleObj.roleId+'">'+roleObj.roleName+"</option>")}Layout.Page.container.find("#createCloneId").html(orgStructureRoleHtml),Layout.Page.container.find("#profileLocationidAdd").closest(".form-group").hide(),Layout.Page.container.find("#roleType").prop("checked",!1),Layout.Page.container.find("#createCloneId").select2("destroy").select2()}else{AccessControl.Roles.IS_OPERATIONROLE_ADD=!1,Layout.Page.container.find("#profileLocationidAdd").val();for(orgStructureRoleHtml="",i=0;i<AccessControl.Roles.ROLESLIST.length;i++){var roleObj;(roleObj=AccessControl.Roles.ROLESLIST[i]).isOperationalRole||roleObj.isOperationalRoleAdmin||roleObj.isAdmin||(orgStructureRoleHtml+='<option value="'+roleObj.roleId+'">'+roleObj.roleName+"</option>")}Layout.Page.container.find("#createCloneId").html(orgStructureRoleHtml),Layout.Page.container.find("#createCloneId").select2("destroy").select2().val($("#createCloneId option:first").val())}},AccessControl.Roles.addNewRole=function(ele){var RoleName=Layout.Page.container.find("#createRoleName").val(),id=Layout.Page.container.find("#createCloneId").val();Layout.Page.container.find("#addRoleErr").remove();var newRoleName=RoleName=RoleName.trim();if(newRoleName&&""!=newRoleName&&newRoleName.length>0&&newRoleName.length<=50){Layout.Page.container.find("#roleType").prop("checked");var params={roleName:newRoleName,mode:"add"};params.cloneRoleId=id,params.isOperationalRole=!1,AccessControl.Roles.IS_OPERATIONROLE_ADD&&(params.isOperationalRole=!0),Layout.Page.container.find("#createRoleButton").attr("disabled",!0),ZPeople.Request.send(AccessControl.Roles.url,params,AccessControl.Roles.handleAddNewRole)}else newRoleName.length>50?AccessControl.Roles.errorInAdd(ZPI18N.getString("zp.roleLengthViolation"),Layout.Page.container.find("#createRoleName").closest("div")):AccessControl.Roles.errorInAdd(ZPI18N.getString("zp.noRoleName"),Layout.Page.container.find("#createRoleName").closest("div"))},AccessControl.Roles.errorInAdd=function(msg,ele){Layout.Page.container.find("#addRoleErr").remove(),Layout.Page.container.find("#dvAddrole .has-error").removeClass("has-error").find("label").removeClass("red");var errDiv=jQuery("<div />",{class:"red",id:"addRoleErr"}).text(msg);errDiv.html(msg),ele.addClass("has-error").append(errDiv),ele.find("label").addClass("red")},AccessControl.Roles.handleAddNewRole=function(data,params){data.isSuccess?(Layout.Page.container.find("#dvAddrole").modal("hide"),ZPeople.Message.showSuccessMsg(data.message),AccessControl.Roles.init(),AccessControl.Permissions.remove()):(Layout.Page.container.find("#createRoleButton").attr("disabled",!1),AccessControl.Roles.errorInAdd(data.message,Layout.Page.container.find("#createRoleName").closest("div")))},AccessControl.Roles.errorInEdit=function(msg){jQuery("<div />",{class:"red",id:"editRoleErr"}).append(msg).insertAfter(Layout.Page.container.find("#editedRoleName"))},AccessControl.Roles.editRole=function(){var newRoleName=Layout.Page.container.find("#editedRoleName").val(),editRoleId=Layout.Page.container.find("#editRoleId").val();if(newRoleName=newRoleName.trim(),Layout.Page.container.find("#editRoleErr").remove(),null!=newRoleName&&""!=newRoleName&&newRoleName.length>0&&newRoleName.length<=50){var locids=Layout.Page.container.find("#profileLocationidEdit").val(),params={roleId:editRoleId,roleName:newRoleName,mode:"edit"};null!=locids&&(params.locIds=JSON.stringify(locids)),Layout.Page.container.find("#editRoleButton").attr("disabled",!0),ZPeople.Request.send(AccessControl.Roles.url,params,AccessControl.Roles.handleEditRole)}else newRoleName.length>50?AccessControl.Roles.errorInEdit(ZPI18N.getString("zp.roleLengthViolation")):AccessControl.Roles.errorInEdit(ZPI18N.getString("zp.noRoleName"))},AccessControl.Roles.handleEditRole=function(data,params){data.isSuccess?(Layout.Page.container.find("#editRolePopUp").modal("hide"),ZPeople.Message.showSuccessMsg(data.message),AccessControl.Roles.init(),AccessControl.Permissions.remove()):(Layout.Page.container.find("#editRoleButton").attr("disabled",!1),AccessControl.Roles.errorInEdit(data.message))},AccessControl.Roles.configPermissions=function(ele){AccessControl.Permissions.FormPerm.roleId=$(ele).attr("value"),window.location.href="#admin/accesscontrol/permissions/form"},AccessControl.Permissions.FormPerm={EXCLUDEDLIST:["P_PerformanceAppraisal","P_SelfAppraisal","P_AppraiseeList","P_MultiRater","P_MultiRater_Approval"],PROFILE_RESTRICTED_FORMS:["P_AppraisalConfiguration","P_AppraiseeList","P_EmployeeSalary","P_Rating","P_SelfAppraisal","P_PerformanceAppraisal","P_Goals","P_MultiRater","P_MultiRater_Approval","P_KRA","P_KRA_User","P_ReviewApprovalSheet","P_GoalSheet","P_ExtendReview"],roleId:null,IS_RESTRICTED_FORM:!1,url:"formPermissions.zp",row:jQuery("<tr />",{id:""}).append(jQuery("<td />").append(jQuery("<span />",{class:"tbllnk dvshwalert rname txttrim",onclick:"AccessControl.Permissions.configPermForRole(this)"}))).append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{name:"viewPermissions","data-trigger":"manual","data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.getPopOver(this)",class:"selPerm",isfldtitle:"true"}).append(jQuery("<span />",{class:""})))).append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{name:"editPermissions","data-trigger":"manual","data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.getPopOver(this)",isfldtitle:"true",class:"selPerm "}).append(jQuery("<span />",{class:""})))).append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{name:"addPermissions","data-trigger":"manual","data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.getPopOver(this)",isfldtitle:"true",class:"selPerm "}).append(jQuery("<span />",{class:""})))).append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{name:"deletePermissions","data-trigger":"manual","data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.getPopOver(this)",isfldtitle:"true",class:"selPerm "}).append(jQuery("<span />",{class:""})))).append(jQuery("<td />",{class:"text-center field"}).append(jQuery("<div />",{class:"selPerm  fieldper",onclick:"javascript:AccessControl.Permissions.FormPerm.FieldPerm.forRole(this)"}))).append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"selPerm editRecord fieldim ZP-PermissionsSlider",onclick:"AccessControl.Permissions.FormPerm.setActionPerm(this)",name:"importset"}))).append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"selPerm",onclick:"AccessControl.Permissions.FormPerm.setActionPerm(this)",name:"exportset"}))),ICON_CLASS:{0:"IC-per-my nodata",1:"IC-per-my",2:"IC-per-submy",3:"IC-per-all",4:"IC-per-sub"},TITLE:{0:ZPI18N.getString("zp.nodata"),1:ZPI18N.getString("zp.mydata"),2:ZPI18N.getString("zp.teamdata"),3:ZPI18N.getString("zp.alldata"),4:ZPI18N.getString("zp.subdata")},ROLE_HTML:"",ROLE_WITH_PROFILE_HTML:"",ID_LIST_INITIALISED:!1,init:function(resultData){var params={type:"default",mode:"fperm.list.all",formList:!AccessControl.Permissions.FormPerm.ID_LIST_INITIALISED},sendReq=!1;Layout.Page.urlparam.hasOwnProperty("formId")&&(params.type="selected",params.formId=Layout.Page.urlparam.formId,sendReq=!0),$("body").on("click",function(e){"true"!=$(e.target).attr("isfldtitle")&&"true"!=$(e.target).parent().attr("isfldtitle")&&$(".selPerm,.dvShwperm").popover("hide")}),sendReq||0==Layout.Page.container.find("#formPermissionsTable").find("tbody").children().length?(Layout.Page.container.find('[istooltip="true"]').tooltip(),Layout.Page.container.find("#formPermissionsTable").hide().parent().append(ZPeople.LOADING_HTML),ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.show)):null!=AccessControl.Permissions.FormPerm.roleId&&AccessControl.Permissions.configPermForRole()},show:function(data){if(data.isSuccess){var body=jQuery("<div />"),rolesList=data.roleConfigList,forms=jQuery("<div />");for(AccessControl.Permissions.FormPerm.ISMSGRFORM=data.isLookupEnabled,AccessControl.Permissions.FormPerm.IS_RESTRICTED_FORM=!1,i=0;i<AccessControl.Permissions.FormPerm.EXCLUDEDLIST.length;i++)if(AccessControl.Permissions.FormPerm.EXCLUDEDLIST[i]==data.formtableName){AccessControl.Permissions.FormPerm.IS_RESTRICTED_FORM=!0;break}var isProfileRestrictedForm=ZPUtil.checkIsExistInArray(AccessControl.Permissions.FormPerm.PROFILE_RESTRICTED_FORMS,data.formtableName),formsList=data.formsList;if(!AccessControl.Permissions.FormPerm.ID_LIST_INITIALISED){for(i in formsList)forms.append(jQuery("<option />",{value:formsList[i].formId,tabName:formsList[i].tableName}).append(formsList[i].dispName));Layout.Page.container.find("#formpermissionsidlist").empty().append(forms.clone().children()),Layout.Page.container.find("#permissionPopUpFormId").empty().append(forms.clone().children())}Layout.Page.container.find("#formpermissionsidlist").val(data.formId).select2(),Layout.Page.container.find("#permissionPopUpFormId").val(data.formId).select2(),Layout.Page.container.find("#roleEmpty_totalEle").hide(),Layout.Page.container.find("#roleEmpty_formroleList").hide(),Layout.Page.container.find("#roleEmpty_addNewRolePerm").hide(),Layout.Page.container.find("#dvFormPerm").find("#addNewRolePerm").hide(),Layout.Page.container.find("#formroleList").hide(),Layout.Page.container.find("#formroleList_selectBox").empty(),Layout.Page.container.find("#roleEmpty_formroleList_selectBox").empty(),AccessControl.Permissions.FormPerm.ROLE_WITH_PROFILE_HTML="",AccessControl.Permissions.FormPerm.ROLE_HTML="";var nonPermRoleOptions="";for(i in rolesList)if(!rolesList[i].isAdmin&&("P_EmployeeLeave"!=data.formtableName&&"P_TimesheetJob"!=data.formtableName&&"P_TimesheetJobsList"!=data.formtableName&&"P_ClientDetails"!=data.formtableName||!rolesList[i].isOperationalRole)){var id=rolesList[i].roleId;if(AccessControl.Permissions.FormPerm.ROLE_WITH_PROFILE_HTML+='<option value="'+id+'" isOperationalRole="'+rolesList[i].isOperationalRole+'" isProfile="'+rolesList[i].isProfile+'">'+rolesList[i].roleName+"</option>",rolesList[i].isProfile||(AccessControl.Permissions.FormPerm.ROLE_HTML+='<option value="'+id+'" isOperationalRole="'+rolesList[i].isOperationalRole+'" isProfile="'+rolesList[i].isProfile+'">'+rolesList[i].roleName+"</option>"),0==rolesList[i].viewPermission&&0==rolesList[i].editPermission&&0==rolesList[i].createPermission&&0==rolesList[i].deletePermission&&!rolesList[i].Import&&!rolesList[i].Export){rolesList[i].isProfile&&!isProfileRestrictedForm||(nonPermRoleOptions+='<option value="'+id+'" isOperationalRole="'+rolesList[i].isOperationalRole+'">'+rolesList[i].roleName+"</option>");continue}var row=AccessControl.Permissions.FormPerm.row.clone();row.attr("id","FormPermissionsTableRow"+id),row.find(".rname").append(rolesList[i].roleName).attr({value:id,isOperationalRole:rolesList[i].isOperationalRole}),AccessControl.Permissions.FormPerm.updateRecordIcon(row.find('[name="viewPermissions"]'),id,rolesList[i].viewPermission,rolesList[i].isOperationalRole),AccessControl.Permissions.FormPerm.updateRecordIcon(row.find('[name="editPermissions"]'),id,rolesList[i].editPermission,rolesList[i].isOperationalRole),AccessControl.Permissions.FormPerm.updateRecordIcon(row.find('[name="addPermissions"]'),id,rolesList[i].createPermission,rolesList[i].isOperationalRole),AccessControl.Permissions.FormPerm.updateRecordIcon(row.find('[name="deletePermissions"]'),id,rolesList[i].deletePermission,rolesList[i].isOperationalRole),AccessControl.Permissions.FormPerm.updateActionIcon(row.find('[name="importset"]').attr("value",id).attr("perm",rolesList[i].Import),rolesList[i].Import),AccessControl.Permissions.FormPerm.updateActionIcon(row.find('[name="exportset"]').attr("value",id).attr("perm",rolesList[i].Export),rolesList[i].Export),"P_Employee"==data.formtableName?(row.find('[name="addPermissions"]').removeAttr("onclick").addClass("disabled"),row.find('[name="deletePermissions"]').removeAttr("onclick").addClass("disabled")):"P_Goals"==data.formtableName?row.find('[name="viewPermissions"],[name="importset"],[name="exportset"]').removeAttr("onclick").addClass("disabled"):"P_SelfAppraisal"==data.formtableName?(row.find('[name="exportset"],[name="importset"],[name="exportset"]').removeAttr("onclick").addClass("disabled"),row.find('[name="importset"],[name="importset"],[name="exportset"]').removeAttr("onclick").addClass("disabled"),row.find('[name="addPermissions"],[name="importset"],[name="exportset"]').removeAttr("onclick").addClass("disabled"),row.find('[name="viewPermissions"],[name="importset"],[name="exportset"]').removeAttr("onclick").addClass("disabled"),row.find('[name="deletePermissions"],[name="importset"],[name="exportset"]').removeAttr("onclick").addClass("disabled")):"P_EmployeeLeave"==data.formtableName?row.find('[name="editPermissions"],[name="deletePermissions"]').removeAttr("onclick").addClass("disabled"):"P_EmployeeSalary"==data.formtableName?row.find('[name="addPermissions"],[name="deletePermissions"]').removeAttr("onclick").addClass("disabled"):AccessControl.Permissions.FormPerm.IS_RESTRICTED_FORM&&row.find('[name="importset"],[name="exportset"],[name="viewPermissions"],[name="editPermissions"],[name="addPermissions"],[name="deletePermissions"]').removeAttr("onclick").addClass("disabled"),row.find(".field").find("div").attr("value",id),body.append(row)}Layout.Page.container.find("#formPermissionsTable").show().siblings("#zp_page_loading").remove(),0===body.children().length&&(Layout.Page.container.find("#roleEmpty_formroleList_selectBox").append(nonPermRoleOptions),Layout.Page.container.find("#roleEmpty_totalEle").show(),Layout.Page.container.find("#roleEmpty_addNewRolePerm").show()),nonPermRoleOptions.length>0&&0!=body.children().length&&(Layout.Page.container.find("#formroleList_selectBox").append(nonPermRoleOptions),Layout.Page.container.find("#dvFormPerm").find("#addNewRolePerm").show()),AccessControl.Permissions.FormPerm.ID_LIST_INITIALISED||(AccessControl.Permissions.FormPerm.ID_LIST_INITIALISED=!0),isProfileRestrictedForm?Layout.Page.container.find("#permissionPopUpRoleId").empty().append(AccessControl.Permissions.FormPerm.ROLE_WITH_PROFILE_HTML).select2():Layout.Page.container.find("#permissionPopUpRoleId").empty().append(AccessControl.Permissions.FormPerm.ROLE_HTML).select2(),null!=AccessControl.Permissions.FormPerm.roleId&&AccessControl.Permissions.configPermForRole(),Layout.Page.container.find("#formPermissionsTable").find("tbody").empty().append(body.children()).find('[isfldtitle="true"]').tooltip({title:function(){return $(this).attr("fldtitle")},placement:"top",trigger:"hover"})}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},optionValueShow:function(ele){"roleEmpty_addNewRolePerm"==$(ele).attr("id")?(Layout.Page.container.find("#roleEmpty_formroleList_selectBox").select2(),Layout.Page.container.find("#roleEmpty_formroleList").show(),Layout.Page.container.find("#roleEmpty_addNewRolePerm").hide()):(Layout.Page.container.find("#formroleList_selectBox").select2(),Layout.Page.container.find("#dvFormPerm").find("#addNewRolePerm").hide(),Layout.Page.container.find("#formroleList").show())},nonPermRoleAdd:function(ele){if("roleEmpty_formroleList"==$(ele).parent().attr("id")){var selectedOption=Layout.Page.container.find("#roleEmpty_formroleList_selectBox option:selected").val();Layout.Page.container.find("#formroleList_selectBox").empty().append(Layout.Page.container.find("#roleEmpty_formroleList_selectBox").children()).val(selectedOption),Layout.Page.container.find("#roleEmpty_totalEle").hide(),Layout.Page.container.find("#formPermissionsTable").show(),$("#formroleList").show()}var body=jQuery("<div />"),selectRole=Layout.Page.container.find("#formroleList_selectBox option:selected").text(),roleId=Layout.Page.container.find("#formroleList_selectBox option:selected").val(),isOperationalRole=Layout.Page.container.find("#formroleList_selectBox option:selected").attr("isOperationalRole"),row=AccessControl.Permissions.FormPerm.row.clone();row.attr("id","FormPermissionsTableRow"+roleId),row.attr("class","rowhglight"),row.find(".rname").text(selectRole).attr("value",roleId),AccessControl.Permissions.FormPerm.updateRecordIcon(row.find('[name="viewPermissions"],[name="editPermissions"],[name="addPermissions"],[name="deletePermissions"]'),roleId,"0",isOperationalRole),AccessControl.Permissions.FormPerm.updateActionIcon(row.find('[name="importset"],[name="exportset"]').attr("value",roleId).attr("perm","false"),!1),"P_Employee"==Layout.Page.container.find("#formpermissionsidlist option:selected").attr("tabname")?(row.find('[name="addPermissions"]').removeAttr("onclick").addClass("disabled"),row.find('[name="deletePermissions"]').removeAttr("onclick").addClass("disabled")):"P_EmployeeLeave"==Layout.Page.container.find("#formpermissionsidlist option:selected").attr("tabname")?row.find('[name="editPermissions"],[name="deletePermissions"]').removeAttr("onclick").addClass("disabled"):AccessControl.Permissions.FormPerm.IS_RESTRICTED_FORM&&row.find('[name="importset"],[name="exportset"],[name="viewPermissions"],[name="editPermissions"],[name="addPermissions"],[name="deletePermissions"]').removeAttr("onclick"),row.find(".field").find("div").attr("value",roleId),body.append(row),$(body).find('[isfldtitle="true"]').tooltip({title:function(){return $(this).attr("fldtitle")},placement:"top",trigger:"hover"}),Layout.Page.container.find("#formPermissionsTable").find("tbody").append(body.children()),Layout.Page.container.find("#formroleList_selectBox option:selected").remove(),Layout.Page.container.find("#formroleList_selectBox").select2(),0==Layout.Page.container.find("#formroleList_selectBox option").length&&(Layout.Page.container.find("#formroleList").hide(),setTimeout(function(){Layout.Page.container.find(".rowhglight").removeClass("rowhglight")},2200))},updateRecordIcon:function(row,id,val,isOperationalRole){isOperationalRole=void 0==isOperationalRole?"false":isOperationalRole,row.attr("value",id).attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[val]).attr("perm",val).attr("isOperationalRole",isOperationalRole).find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[val])},updateActionIcon:function(row,val){val?row.removeClass("fieldex").addClass("fieldim"):row.removeClass("fieldim").addClass("fieldex")},setActionPerm:function(ele){var formid=Layout.Page.container.find("#formpermissionsidlist").val(),roleid=$(ele).attr("value"),valPerm="true"!=$(ele).attr("perm"),params={roleId:roleid,formId:formid,mode:"fperm.aperm",type:$(ele).attr("name"),valPerm:valPerm};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.handleActionPerm)},handleActionPerm:function(data,params){if("success"==data.status){var valPerm=params.valPerm;ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.actionPermssionsSuccess"));var rolerowid="#FormPermissionsTableRow"+params.roleId;AccessControl.Permissions.FormPerm.updateActionIcon(Layout.Page.container.find(rolerowid).find('[name="'+params.type+'"]').attr("perm",valPerm),valPerm)}else{if(Layout.Page.container.find("#ZP-PermissionsSlider").modal("hide"),void 0!=data.status&&""!=data.status.trim()&&"error"!=data.status.trim())return void ZPeople.Message.showFailureMsg(data.status);ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}},getPopOver:function(ele){var POPOVER_HTML="true"==$(ele).attr("isOperationalRole")?AccessControl.Permissions.FormPerm.FieldPerm.ORG_STRUCTURE_ROLE_POPOVERCONTENT:AccessControl.Permissions.FormPerm.FieldPerm.POPOVERCONTENT;$(ele).popover({html:!0,content:function(){var html=$(POPOVER_HTML);return html.find("li").attr("onclick","AccessControl.Permissions.FormPerm.setRecordPermCheck(this)"),html.find(".active").removeClass("active"),html.find("."+$(ele).attr("perm")).addClass("active"),html}}),Layout.Page.container.find(".selPerm").not($(ele)).popover("hide"),$(ele).popover("toggle"),$(ele).siblings().find('[istooltip="true"]').tooltip()},setRecordPermCheck:function(ele){if(!$(ele).hasClass("active")){var actele=$(ele).closest('[id^="popover"]').siblings(),val=AccessControl.Permissions.FormPerm.VAL=$(ele).attr("value"),prev=actele.attr("perm"),type=actele.attr("name"),tabname=Layout.Page.container.find("#permissionPopUpFormId").find(":selected").attr("tabname");if("viewPermissions"==type&&(val==AccessControl.Permissions.NODATA||(val==AccessControl.Permissions.MYDATA||val==AccessControl.Permissions.SUBDATA)&&prev!=AccessControl.Permissions.NODATA||val==AccessControl.Permissions.TEAMDATA&&prev==AccessControl.Permissions.ALLDATA)){var ePerm=actele.closest("tr").find('[name="editPermissions"]').attr("perm"),dPerm=actele.closest("tr").find('[name="deletePermissions"]').attr("perm");if(val==AccessControl.Permissions.NODATA&&(val!=ePerm||val!=dPerm)||!AccessControl.Permissions.FormPerm.validateSetPermission(val,ePerm)||!AccessControl.Permissions.FormPerm.validateSetPermission(val,dPerm))return void ZPeople.confirm(actele,"","zp.updateViewPermissionDesc",AccessControl.Permissions.FormPerm.setRecordPerm)}if("addPermissions"==type&&!AccessControl.Permissions.FormPerm.ISMSGRFORM&&val>AccessControl.Permissions.MYDATA&&"P_TimesheetJob"!=tabname&&"P_TimesheetJobsList"!=tabname&&"P_Goals"!=tabname)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.addContradict"));else{if("editPermissions"==type||"deletePermissions"==type){var vPerm=actele.closest("tr").find('[name="viewPermissions"]').attr("perm");if(!AccessControl.Permissions.FormPerm.validateSetPermission(vPerm,val))return void("editPermissions"==type?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.RecordViewEditContradict")):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.RecordViewDeleteContradict")))}"Candidate"!=actele.parents("tr").first("td").find("span").text()||0==val||1==val?this.setRecordPerm(actele):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.candidateroleperm"))}}},setRecordPerm:function(ele){Layout.Page.container.find("#permissionPopUpRoleId").val();var params={formId:Layout.Page.container.find("#formpermissionsidlist").val(),roleId:ele.attr("value"),typePerm:ele.attr("name"),valPerm:AccessControl.Permissions.FormPerm.VAL,mode:"fperm.rperm"};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.handleRecordPerm,$(ele).closest("tr"))},handleRecordPerm:function(data,params,ele){if(data.isSuccess)ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.recordPermssionsSuccess")),ele.find('[name="viewPermissions"]').attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[data.viewPermission]).attr("perm",data.viewPermission).find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[data.viewPermission]),ele.find('[name="editPermissions"]').attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[data.editPermission]).attr("perm",data.editPermission).find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[data.editPermission]),ele.find('[name="addPermissions"]').attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[data.createPermission]).attr("perm",data.createPermission).find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[data.createPermission]),ele.find('[name="deletePermissions"]').attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[data.deletePermission]).attr("perm",data.deletePermission).find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[data.deletePermission]);else{if(Layout.Page.container.find("#ZP-PermissionsSlider").modal("hide"),void 0!=data.status&&""!=data.status.trim()&&"error"!=data.status.trim())return void ZPeople.Message.showFailureMsg(data.status);ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}},getForForm:function(ele){Layout.Page.container.find("#roleEmpty_totalEle").hide(),window.location.href="#admin/accesscontrol/permissions/form-formId:"+ele.value},switchSliderTab:function(id){Layout.Page.container.find("#ZP-PermissionsSlider #zp_page_loading").show();var formid=Layout.Page.container.find("#permissionPopUpFormId").val(),roleId=Layout.Page.container.find("#permissionPopUpRoleId").val(),tabName=Layout.Page.container.find("#permissionPopUpFormId option:selected").attr("tabname"),isDisabled=!1;for(i=0;i<AccessControl.Permissions.FormPerm.EXCLUDEDLIST.length;i++)if(AccessControl.Permissions.FormPerm.EXCLUDEDLIST[i]==tabName){isDisabled=!0;break}isDisabled?(id="Fieldperm",Layout.Page.container.find("#Recordperm").hide()):Layout.Page.container.find("#Recordperm").show(),ZPUtil.checkIsExistInArray(AccessControl.Permissions.FormPerm.PROFILE_RESTRICTED_FORMS,tabName)?Layout.Page.container.find("#permissionPopUpRoleId").html(AccessControl.Permissions.FormPerm.ROLE_WITH_PROFILE_HTML):Layout.Page.container.find("#permissionPopUpRoleId").html(AccessControl.Permissions.FormPerm.ROLE_HTML),Layout.Page.container.find("#permissionPopUpRoleId").val(roleId),null==(roleId=Layout.Page.container.find("#permissionPopUpRoleId").val())&&(roleId=$(Layout.Page.container.find("#permissionPopUpRoleId").find("option")[0]).attr("value"),Layout.Page.container.find("#permissionPopUpRoleId").val(roleId)),Layout.Page.container.find("#permissionPopUpRoleId").select2(),Layout.Page.container.find("#setPermissionsButton").hide(),void 0==id&&(id=Layout.Page.container.find("#dvPermission").find(".active").attr("id")),"Recordperm"==id?(func=AccessControl.Permissions.FormPerm.RecordPerm.show,mode="rperm"):"Fieldperm"==id&&(Layout.Page.container.find("#ZP-PermissionsSlider").modal("show"),func=AccessControl.Permissions.FormPerm.FieldPerm.show,mode="fieldperm");var params={roleId:roleId,formId:formid,mode:"fperm.list.sub",submode:mode};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,func)},validateEditPermission:function(val,radd,redit){var rAdd=void 0==radd?AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM:radd,rEdit=void 0==redit?AccessControl.Permissions.FormPerm.FieldPerm.EDITPERM:redit;return(rAdd==AccessControl.Permissions.SUBDATA&&rEdit==AccessControl.Permissions.MYDATA||rAdd==AccessControl.Permissions.MYDATA&&rEdit==AccessControl.Permissions.SUBDATA)&&val==rAdd},validateSetPermission:function(first_limit,val){return val==AccessControl.Permissions.NODATA||!(first_limit==AccessControl.Permissions.NODATA||first_limit==AccessControl.Permissions.SUBDATA&&val!=AccessControl.Permissions.SUBDATA&&val!=AccessControl.Permissions.NODATA||val==AccessControl.Permissions.SUBDATA&&first_limit==AccessControl.Permissions.MYDATA||val!=AccessControl.Permissions.SUBDATA&&first_limit!=AccessControl.Permissions.SUBDATA&&val>first_limit)}},AccessControl.Permissions.FormPerm.RecordPerm={ISMSGRFORM:!1,forRole:function(roleId,isOperationalRole){var formId=Layout.Page.container.find("#formpermissionsidlist").val();Layout.Page.container.find("#permissionPopUpRoleId").val(roleId).select2(),Layout.Page.container.find("#permissionPopUpFormId").val(formId).select2(),Layout.Page.container.find("#Recordperm").show();var params={mode:"fperm.list.sub",formId:formId,roleId:roleId,submode:"rperm"};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.RecordPerm.show)},show:function(data,params,isSuccessMsgShow){var isOperationalRole=Layout.Page.container.find("#permissionPopUpRoleId option:selected").attr("isOperationalRole");if(data.isSuccess){var tabName=Layout.Page.container.find("#permissionPopUpFormId option:selected").attr("tabname");if(void 0!=isSuccessMsgShow&&isSuccessMsgShow&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.recordPermssionsSuccess")),AccessControl.Permissions.FormPerm.RecordPerm.ISMSGRFORM=data.isLookupEnabled,Layout.Page.container.find("#formpermissionsidlist").val()==params.formId&&void 0!=isSuccessMsgShow&&isSuccessMsgShow){var row=Layout.Page.container.find("#FormPermissionsTableRow"+params.roleId);row.find('[name="viewPermissions"]').attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[data.viewPermission]).attr("perm",data.viewPermission).find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[data.viewPermission]),row.find('[name="editPermissions"]').attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[data.editPermission]).attr("perm",data.editPermission).find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[data.editPermission]),row.find('[name="addPermissions"]').attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[data.createPermission]).attr("perm",data.createPermission).find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[data.createPermission]),row.find('[name="deletePermissions"]').attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[data.deletePermission]).attr("perm",data.deletePermission).find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[data.deletePermission])}var dvPerm=Layout.Page.container.find("#dvRecordperm");dvPerm.find('[name="viewPermissions"],[name="editPermissions"],[name="addPermissions"],[name="deletePermissions"]').find("li").removeClass("disabled"),dvPerm.find('[name="viewPermissions"],[name="editPermissions"],[name="addPermissions"],[name="deletePermissions"]').find(".active").removeClass("active"),"true"==isOperationalRole&&$.each(dvPerm.find('[name="viewPermissions"],[name="editPermissions"],[name="addPermissions"],[name="deletePermissions"]').find(".1,.2,.4"),function(){$(this).addClass("disabled")}),"P_Employee"==tabName&&(dvPerm.find('[name="addPermissions"] li').addClass("disabled"),dvPerm.find('[name="deletePermissions"] li').addClass("disabled")),"P_Goals"==tabName?dvPerm.find('[name="viewPermissions"] li').addClass("disabled"):"P_EmployeeSalary"==tabName?(dvPerm.find('[name="addPermissions"] li').addClass("disabled"),dvPerm.find('[name="deletePermissions"] li').addClass("disabled")):dvPerm.find('[name="viewPermissions"] .'+data.viewPermission).addClass("active"),"P_EmployeeLeave"==tabName&&(dvPerm.find('[name="editPermissions"] li').addClass("disabled"),dvPerm.find('[name="deletePermissions"] li').addClass("disabled")),dvPerm.find('[name="editPermissions"] .active').removeClass("active"),dvPerm.find('[name="editPermissions"] .'+data.editPermission).addClass("active"),dvPerm.find('[name="addPermissions"] .active').removeClass("active"),dvPerm.find('[name="addPermissions"] .'+data.createPermission).addClass("active"),dvPerm.find('[name="deletePermissions"] .active').removeClass("active"),dvPerm.find('[name="deletePermissions"] .'+data.deletePermission).addClass("active"),Layout.Page.container.find("#ZP-PermissionsSlider #zp_page_loading").hide(),Layout.Page.container.find("#dvPermission li:eq(0) a").tab("show"),Layout.Page.container.find("#ZP-PermissionsSlider").modal("show")}else if(data.iscandidaterole)Layout.Page.container.find("#ZP-PermissionsSlider").modal("hide"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.candidateroleperm"));else{if(Layout.Page.container.find("#ZP-PermissionsSlider").modal("hide"),void 0!=data.status&&""!=data.status.trim()&&"error"!=data.status.trim())return void ZPeople.Message.showFailureMsg(data.status);ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}},setView:function(ele){var val=$(ele).attr("value");if(!$(ele).parent().hasClass("active")){var prev=Layout.Page.container.find('#dvRecordperm [name="viewPermissions"] .active a').attr("value");if(val==AccessControl.Permissions.NODATA||(val==AccessControl.Permissions.MYDATA||val==AccessControl.Permissions.SUBDATA)&&prev!=AccessControl.Permissions.NODATA||val==AccessControl.Permissions.TEAMDATA&&prev==AccessControl.Permissions.ALLDATA){var ePerm=Layout.Page.container.find('#dvRecordperm [name="editPermissions"] .active a').attr("value"),dPerm=Layout.Page.container.find('#dvRecordperm [name="deletePermissions"] .active a').attr("value");if(val==AccessControl.Permissions.NODATA&&(val!=ePerm||val!=dPerm)||!AccessControl.Permissions.FormPerm.validateSetPermission(val,ePerm)||!AccessControl.Permissions.FormPerm.validateSetPermission(val,dPerm))return void ZPeople.confirm(ele,"","zp.updateViewPermissionDesc",AccessControl.Permissions.FormPerm.RecordPerm.set)}AccessControl.Permissions.FormPerm.RecordPerm.set(ele)}},set:function(ele){var type=$(ele).closest("ul").attr("name"),val=$(ele).attr("value");if(!$(ele).parent().hasClass("active")){var formid=Layout.Page.container.find("#permissionPopUpFormId").val(),tabname=Layout.Page.container.find("#permissionPopUpFormId option:selected").attr("tabname"),roleid=Layout.Page.container.find("#permissionPopUpRoleId").val();if("addPermissions"==type&&!AccessControl.Permissions.FormPerm.RecordPerm.ISMSGRFORM&&val>AccessControl.Permissions.MYDATA&&"P_TimesheetJob"!=tabname&&"P_TimesheetJobsList"!=tabname&&"P_Goals"!=tabname)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.addContradict"));else{if("editPermissions"==type||"deletePermissions"==type){var vPerm=Layout.Page.container.find('#dvRecordperm ul[name="viewPermissions"] li.active a').attr("value");if(!AccessControl.Permissions.FormPerm.validateSetPermission(vPerm,val))return void("editPermissions"==type?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.RecordViewEditContradict")):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.RecordViewDeleteContradict")))}var params={formId:formid,roleId:roleid,typePerm:type,valPerm:val,mode:"fperm.rperm"};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.RecordPerm.show,void 0,!0)}}}},AccessControl.Permissions.FormPerm.FieldPerm={VIEWPERM:0,EDITPERM:0,RESTRICTED_COLUMN_LIST:{P_Employee:["EMPLOYEEPHOTO","SECOND_REPORTING_TO"],P_EmployeeLeave:["EMPLOYEEID","LEAVE_TYPE","FROM","TO","DAYSTAKEN","CERTIFICATE"],P_Goals:["USERRATING","MANAGERRATING","ASSIGNBY","ASSIGNTO","ARCHIVE","GOAL"],P_SelfAppraisal:["CONFIGURATIONID"],P_PerformanceAppraisal:["CONFIGURATIONID","APPRAISER","USERERECNO"],P_TimesheetJob:["JOBNAME","JOBSLISTID","ASSIGNEES","ISCOMPLETED","JOBOWNER","DURATION"],P_TimesheetJobsList:["CLIENTID","JOBSLISTNAME","STATUS","PROJECTOWNER","PROJECTHEAD","PROJECTMANAGER","PROJECTMANAGERS","PROJECTUSERS","DESCRIPTION"],P_ClientDetails:["CLIENTNAME","CURRENCY"],P_Task:["NAME","DESCRIPTION","STARTDATE","ENDDATE","ASSIGNEDTO","COMPLETEDON","COMPLETEDBY","STATUS","PRIORITY","REMINDERTIME"]},POPOVERCONTENT:'<div class="dropfield"><ul class="step-nav"><li istooltip="true" class="0" onclick = "AccessControl.Permissions.FormPerm.FieldPerm.setIndividualField(this)" value="0" title="'+ZPI18N.getString("zp.nodata")+'"><a class="IC-per-my nodata"></a></li><li  istooltip="true" class="1" onclick = "AccessControl.Permissions.FormPerm.FieldPerm.setIndividualField(this)" value="1"  title="'+ZPI18N.getString("zp.mydata")+'"><a class="IC-per-my"></a></li><li  istooltip="true" class="4"  value="4" onclick = "AccessControl.Permissions.FormPerm.FieldPerm.setIndividualField(this)" title="'+ZPI18N.getString("zp.subdata")+'"><a class="IC-per-sub"></a></li><li  istooltip="true" class="2"  value="2"  onclick = "AccessControl.Permissions.FormPerm.FieldPerm.setIndividualField(this)" title="'+ZPI18N.getString("zp.teamdata")+'"><a class="IC-per-submy"></a></li><li  istooltip="true" class="3" value="3"  onclick = "AccessControl.Permissions.FormPerm.FieldPerm.setIndividualField(this)" title="'+ZPI18N.getString("zp.alldata")+'"><a class="IC-per-all"></a></li></ul></div>',ORG_STRUCTURE_ROLE_POPOVERCONTENT:'<div class="dropfield"><ul class="step-nav"><li istooltip="true" class="0" onclick = "AccessControl.Permissions.FormPerm.FieldPerm.setIndividualField(this)" value="0" title="'+ZPI18N.getString("zp.nodata")+'"><a class="IC-per-my nodata"></a></li><li class="1 disabled"><a class="IC-per-my"></a></li><li class="4 disabled"><a class="IC-per-sub"></a></li><li class="2 disabled"><a class="IC-per-submy"></a></li><li  istooltip="true" class="3" value="3"  onclick = "AccessControl.Permissions.FormPerm.FieldPerm.setIndividualField(this)" title="'+ZPI18N.getString("zp.alldata")+'"><a class="IC-per-all"></a></li></ul></div>',forRole:function(rele){var roleId=$(rele).attr("value"),formId=Layout.Page.container.find("#formpermissionsidlist").val();Layout.Page.container.find("#permissionPopUpRoleId").val(roleId).select2(),Layout.Page.container.find("#permissionPopUpFormId").val(formId).select2();var tabName=Layout.Page.container.find("#permissionPopUpFormId option:selected").attr("tabname"),isDisabled=!1;for(i=0;i<AccessControl.Permissions.FormPerm.EXCLUDEDLIST.length;i++)if(AccessControl.Permissions.FormPerm.EXCLUDEDLIST[i]==tabName){isDisabled=!0;break}isDisabled?(id="Fieldperm",Layout.Page.container.find("#Recordperm").hide()):Layout.Page.container.find("#Recordperm").show(),Layout.Page.container.find("#ZP-PermissionsSlider #zp_page_loading").show();var params={mode:"fperm.list.sub",formId:formId,roleId:roleId,submode:"fieldperm"};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.FieldPerm.show)},show:function(data){if("success"==data.status){var viewperm=data.recordPermission.viewPermission,editperm=data.recordPermission.editPermission,addperm=data.recordPermission.createPermission;AccessControl.Permissions.FormPerm.FieldPerm.VIEWPERM=viewperm,AccessControl.Permissions.FormPerm.FieldPerm.EDITPERM=editperm,AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM=addperm;var sections=data.sectionsList,lookupFcId=data.lookupFcId,head=jQuery("<ul />",{class:"list-group"}).append(jQuery("<li />",{class:"list-group-item clearfix list-head"}).append(jQuery("<div />",{class:"col-md-4 PL0"}).append(jQuery("<span />").text(ZPI18N.getString("zp.fieldname")))).append(jQuery("<div />",{class:"col-md-4"}).append(jQuery("<span />").text(ZPI18N.getString("zp.viewPerm")))).append(jQuery("<div />",{class:"col-md-4"}).append(jQuery("<span />").text(ZPI18N.getString("zp.editPerm"))))).append(jQuery("<li />",{class:"list-group-item clearfix list-head",id:"setPermissionsButton",style:"display:none"}).append(jQuery("<a />",{class:"btn btn-primary dvSetpemission","data-target":"#permissionsInnerSlider","data-toggle":"modal",onclick:"AccessControl.Permissions.FormPerm.FieldPerm.selectedFieldTags()"}).append(ZPI18N.getString("zp.setpermission")))),list=jQuery("<div />"),tabName=Layout.Page.container.find("#permissionPopUpFormId option:selected").attr("tabname");for(secid in sections){var firstDiv=jQuery("<div />",{class:"clearfix"}),secs=jQuery("<div />",{class:"panel-heading list-head active ZPbold",id:"fieldpermissions_sectionid-"+sections[secid].sectionID});secs.append(jQuery("<div />",{class:"form-group MB0"}).append(jQuery("<div />",{class:"checkbox checkbox-primary DI txttrim",isColapse:!1}).append(jQuery("<input />",{class:"secinput",id:"label_checkBox",type:"checkbox",onchange:"AccessControl.Permissions.FormPerm.FieldPerm.toggleSectionSelect(this)"})).append(jQuery("<label />"))).append(jQuery("<div />",{class:"input-group DI"}).append(jQuery("<span />",{class:"sName"}).append(sections[secid].sectionName)))),secs.append(jQuery("<div />",{class:"dvswitch",isColapse:!1}).append(jQuery("<input />",{id:"togglesection-"+sections[secid].sectionID,checked:sections[secid].secEnabled,class:"cmn-toggle-small cmn-toggle-round-small",type:"checkbox",onclick:" AccessControl.Permissions.FormPerm.FieldPerm.toggleSection(this)"})).append(jQuery("<label />",{for:"togglesection-"+sections[secid].sectionID})));var fcList=sections[secid].fcList,headId=jQuery("<ul />",{id:"lstsec"+secid,class:"list-group BL0 collapse","aria-expanded":"false"});for(fcid in fcList){var li=jQuery("<li />",{class:"list-group-item clearfix",id:"fieldpermissions_fcid-"+fcList[fcid].fcId});li.append(jQuery("<div />",{class:"col-md-4 PL0"}).append(jQuery("<div />",{class:"checkbox checkbox-primary"}).append(jQuery("<input />",{value:fcList[fcid].fcId,class:"fieldinput",type:"checkbox",onchange:"AccessControl.Permissions.FormPerm.FieldPerm.toggleFieldSelect(this)"})).append(jQuery("<label />",{class:"FL"})).append(jQuery("<div />",{class:"fName txttrim"}).append(fcList[fcid].dispName))));fcList[fcid].vPerm;li.append(jQuery("<div />",{class:"col-md-4 view"}).append(jQuery("<div />",{}).append(jQuery("<a />",{value:fcList[fcid].vPerm,isView:!0,"data-trigger":"manual",class:"selPerm dvShwperm","data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.FieldPerm.getPopOver(this)",fldtitle:AccessControl.Permissions.FormPerm.TITLE[fcList[fcid].vPerm],isfldtitle:"true"}).append(jQuery("<span />",{class:AccessControl.Permissions.FormPerm.ICON_CLASS[fcList[fcid].vPerm]}))))),li.append(jQuery("<div />",{class:"col-md-4 edit"}).append(jQuery("<div />",{}).append(jQuery("<a />",{value:fcList[fcid].wPerm,isView:!1,"data-trigger":"manual",class:"selPerm dvShwperm","data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.FieldPerm.getPopOver(this)",fldtitle:AccessControl.Permissions.FormPerm.TITLE[fcList[fcid].wPerm],isfldtitle:"true"}).append(jQuery("<span />",{class:AccessControl.Permissions.FormPerm.ICON_CLASS[fcList[fcid].wPerm]}))))),(15==fcList[fcid].compType||30==fcList[fcid].compType||fcList[fcid].isReadOnly)&&li.find(".edit").find("a").addClass("disabled"),lookupFcId==fcList[fcid].fcId||AccessControl.Permissions.FormPerm.FieldPerm.RESTRICTED_COLUMN_LIST.hasOwnProperty(tabName)&&ZPUtil.checkIsExistInArray(AccessControl.Permissions.FormPerm.FieldPerm.RESTRICTED_COLUMN_LIST[tabName],fcList[fcid].colName)?(li.find(".view").find("a").addClass("disabled"),li.find(".edit").find("a").addClass("disabled"),li.find(".fieldinput").addClass("disabled"),lookupFcId==fcList[fcid].fcId&&li.attr("isPrim",!0),li.attr("isDisp",!1)):(("P_Goals"==tabName||"P_Employee"==tabName&&"ORGANIZATION_TAG_NAME"==fcList[fcid].colName)&&li.find(".view").find("a").addClass("disabled"),"P_EmployeeSalary"==tabName&&(li.find(".view").find("a").addClass("disabled"),li.find(".edit").find("a").addClass("disabled")),li.attr("isDisp",!0),"MOBILE"==fcList[fcid].colName&&"P_Employee"==tabName&&li.attr("ismob","true")),AccessControl.Permissions.isAppEnab=data.isApprovalEnabled,headId.append(li)}0==secid&&headId.attr("class","list-group BL0 collapse in"),sections[secid].secEnabled||(secs.addClass("disabled"),secs.find("#label_checkBox").attr("disabled",!0),headId.find("li").addClass("disabled")),firstDiv.append(secs),firstDiv.append(headId),list.append(firstDiv)}Layout.Page.container.find("#fieldsList").empty().append(head).append(list.children()).find(".ZPtitle").tooltip(),Layout.Page.container.find("#dvPermission li:eq(1) a").tab("show"),Layout.Page.container.find("#innerSliderPermissionsView,#innerSliderPermissionsEdit").find("li").removeClass("active"),Layout.Page.container.find("#ZP-PermissionsSlider").modal("show"),Layout.Page.container.find('#ZP-PermissionsSlider [isfldtitle="true"]').tooltip({title:function(){return $(this).attr("fldtitle")},placement:"top",trigger:"hover"}),Layout.Page.container.find('[id^="fieldpermissions_sectionid-"]').on("click",function(e){"false"!=$(e.target).parent().attr("iscolapse")&&(void 0!=$(e.target).attr("id")&&0==$(e.target).attr("id").indexOf("fieldpermissions_sectionid-")?$(e.target).siblings().collapse("toggle"):$(e.target).closest('[id^="fieldpermissions_sectionid-"]').siblings().collapse("toggle"))}),AccessControl.Permissions.FormPerm.FieldPerm.VIEWPERM==AccessControl.Permissions.NODATA&&ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.NoAccessToForm",[ZPeople.escapeHtml(Layout.Page.container.find("#permissionPopUpRoleId option:selected").text()),ZPeople.escapeHtml(Layout.Page.container.find("#permissionPopUpFormId option:selected").text())])),Layout.Page.container.find("#ZP-PermissionsSlider #zp_page_loading").hide()}else{if(Layout.Page.container.find("#ZP-PermissionsSlider").modal("hide"),void 0!=data.status&&""!=data.status.trim()&&"error"!=data.status.trim())return void ZPeople.Message.showFailureMsg(data.status);void 0!=data.message?ZPeople.Message.showFailureMsg(data.message):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}},markThisActive:function(ele){var addperneed=!1,val=$(ele).attr("value"),first_limit=AccessControl.Permissions.FormPerm.FieldPerm.VIEWPERM,isView=!0,isValid=!1;if("innerSliderPermissionsEdit"==$(ele).parent().attr("id")){isView=!1;var ele1=Layout.Page.container.find("#innerSliderPermissionsView .active");!AccessControl.Permissions.isAppEnab&&AccessControl.Permissions.FormPerm.validateSetPermission(AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM,AccessControl.Permissions.FormPerm.FieldPerm.EDITPERM)?(first_limit=AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM,addperneed=!0):ele1.length>0&&(first_limit=Layout.Page.container.find("#innerSliderPermissionsView .active").attr("value"))}if(isView||(isValid=AccessControl.Permissions.FormPerm.validateEditPermission(val)),!isValid){if(AccessControl.Permissions.isAppEnab||isView||!AccessControl.Permissions.FormPerm.validateSetPermission(AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM,AccessControl.Permissions.FormPerm.FieldPerm.EDITPERM)||(first_limit=AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM,isValid.addperneed=!0),!AccessControl.Permissions.FormPerm.validateSetPermission(first_limit,val)){var key="zp.FieldViewContradict";if(isView||(key="zp.FieldEditViewContradict",addperneed&&(key="zp.FieldEditAddContradict")),!AccessControl.Permissions.isAppEnab||"zp.FieldEditViewContradict"==key)return void ZPeople.Message.showWarningMsg(ZPI18N.getString(key,[AccessControl.Permissions.FormPerm.TITLE[val],AccessControl.Permissions.FormPerm.TITLE[first_limit]]))}if(first_limit=AccessControl.Permissions.FormPerm.FieldPerm.EDITPERM,!(AccessControl.Permissions.isAppEnab||isView||AccessControl.Permissions.FormPerm.validateSetPermission(first_limit,val)||AccessControl.Permissions.FormPerm.validateSetPermission(AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM,val)))return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.FieldEditContradict",[AccessControl.Permissions.FormPerm.TITLE[val],AccessControl.Permissions.FormPerm.TITLE[first_limit]]))}$(ele).siblings().removeClass("active"),$(ele).addClass("active")},toggleFieldSelect:function(ele){var parent=$(ele).closest("ul");parent.find(".fieldinput:checked").length==parent.find('li[isDisp="true"]').find(".fieldinput").length?parent.siblings().find(".secinput").prop("checked",!0):parent.siblings().find(".secinput").prop("checked",!1),AccessControl.Permissions.FormPerm.FieldPerm.togglePermissionsButton()},togglePermissionsButton:function(){Layout.Page.container.find("#dvFieldperm").find(".fieldinput:checked").length>0?(Layout.Page.container.find("#setPermissionsButton").show(),Layout.Page.container.find("#setPermissionsButton").siblings().hide()):(Layout.Page.container.find("#setPermissionsButton").hide(),Layout.Page.container.find("#setPermissionsButton").siblings().show())},selectedFieldTags:function(){Layout.Page.container.find("#innerSliderPermissionsView li").removeClass("disabled"),Layout.Page.container.find("#innerSliderPermissionsEdit li").removeClass("disabled");var isOperationalRole=Layout.Page.container.find("#permissionPopUpRoleId option:selected").attr("isOperationalRole");"P_Goals"==Layout.Page.container.find("#formpermissionsidlist option:selected").attr("tabname")?(Layout.Page.container.find("#innerSliderPermissionsView li").addClass("disabled"),Layout.Page.container.find("#innerSliderPermissionsView li").prop("onclick",null).off("click")):(Layout.Page.container.find("#innerSliderPermissionsView li").on("click",function(){AccessControl.Permissions.FormPerm.FieldPerm.markThisActive(this)}),Layout.Page.container.find("#innerSliderPermissionsEdit li").on("click",function(){AccessControl.Permissions.FormPerm.FieldPerm.markThisActive(this)})),"true"==isOperationalRole&&$.each(Layout.Page.container.find("#innerSliderPermissionsView,#innerSliderPermissionsEdit").find("[value='1'],[value='2'],[value='4']"),function(){$(this).addClass("disabled"),$(this).prop("onclick",null).off("click")}),Layout.Page.container.find("#bulkPermissionsSelectedFields").empty();var lis=Layout.Page.container.find("#fieldsList").children(),roleId=$("#permissionPopUpRoleId").val(),roleName=Layout.Page.container.find("tr").find("span[value='"+roleId+"']").text();for(Layout.Page.container.find("#bulkPermRoleName").text(roleName),li=0;li<lis.length;li++){var slected=$(lis[li]).find(".fieldinput:checked");if(slected.length>0){var div=jQuery("<div />",{class:"clearfix"});for(div.append(jQuery("<p />").append($(lis[li]).find(".sName").html())),j=0;j<slected.length;j++)div.append(jQuery("<span />",{class:"spntag"}).append($(slected[j]).siblings(".fName").html()).append(jQuery("<i />",{class:"IC-cls-1px",value:$(slected[j]).attr("value"),onclick:"AccessControl.Permissions.FormPerm.FieldPerm.removeThisTag(this)"})));Layout.Page.container.find("#bulkPermissionsSelectedFields").append(div)}}},removeThisTag:function(ele){id=$(ele).attr("value");var ele1=Layout.Page.container.find("#fieldsList input[value="+id+"]").attr("checked",!1);AccessControl.Permissions.FormPerm.FieldPerm.toggleFieldSelect(ele1);var par=$(ele).parent().parent();$(ele).parent().remove(),1==par.children().length&&par.remove(),0==Layout.Page.container.find("#bulkPermissionsSelectedFields").children().length&&Layout.Page.container.find("#bulkPermissionsSelectedFields").append(jQuery("<span />",{class:"spntag"}).append(ZPI18N.getString("zp.noFieldsSelected")))},setBulkPermission:function(){var input=Layout.Page.container.find("#dvFieldperm").find(".fieldinput:checked");if(input.length>0){var params={mode:"fperm.fieldperm.bulk"},views=Layout.Page.container.find("#innerSliderPermissionsView").find(".active").removeClass("active");params.isView=!1,params.isEdit=!1,1==views.length&&(params.isView=!0,params.vPerm=views.attr("value"));var edits=Layout.Page.container.find("#innerSliderPermissionsEdit").find(".active").removeClass("active");if(1==edits.length&&(params.isEdit=!0,params.ePerm=edits.attr("value")),params.isEdit||params.isView){Layout.Page.container.find("#dvFieldperm").find(".secinput:checked").attr("checked",!1);var fcids="";for(i=0;i<input.length;i++)fcids=fcids+input[i].value+",",input[i].checked=!1;params.formId=Layout.Page.container.find("#permissionPopUpFormId").val(),params.roleId=Layout.Page.container.find("#permissionPopUpRoleId").val(),params.fcIds=fcids,ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.FieldPerm.handleBulkPermission),Layout.Page.container.find("#setPermissionsButton").hide()}}Layout.Page.container.find("#permissionsInnerSlider").modal("hide")},handleBulkPermission:function(data){if("success"==data.status)ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.fieldPermssionsSuccess")),AccessControl.Permissions.FormPerm.switchSliderTab("Fieldperm");else if("warning"==data.status)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.PrimaryLookuPermissionChange"));else{if(void 0!=data.status&&""!=data.status.trim()&&"error"!=data.status.trim())return void ZPeople.Message.showFailureMsg(data.status);ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}},toggleSectionSelect:function(ele){var isChecked=ele.checked,fields=$(ele).closest('[id^="fieldpermissions_sectionid"]').siblings("ul").children('li[isDisp="true"]').find("input.fieldinput");for(i=0;i<=fields.length;i++)$(fields[i]).prop("checked",isChecked);AccessControl.Permissions.FormPerm.FieldPerm.togglePermissionsButton()},toggleSection:function(ele){if(AccessControl.Permissions.FormPerm.FieldPerm.VIEWPERM==AccessControl.Permissions.NODATA&&ele.checked)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.NoRecordPermission",[Layout.Page.container.find("#permissionPopUpFormId option:selected").text(),Layout.Page.container.find("#permissionPopUpRoleId option:selected").text()])),$(ele).prop("checked",!ele.checked);else{var id=ele.id.substring(14),set=$(ele).closest('[id^="fieldpermissions_sectionid"]').siblings("ul"),isPrim=set.find('li[isPrim="true"]').length>0,isDisp=set.find('li[isDisp="false"]').length>0;if((isPrim||isDisp)&&!ele.checked)return isPrim?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.sectionContainsPrimaryLookup")):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.canNotDisableSection")),void $(ele).prop("checked",!0);var formId=$("#permissionPopUpFormId").val(),params={roleId:$("#permissionPopUpRoleId").val(),formId:formId,mode:"fperm.fieldperm.section",sectId:id,enable:ele.checked};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.FieldPerm.handleToggleSection)}},handleToggleSection:function(data,params){if(data.isSuccess){for(var vperm=data.vPerm,wperm=data.wPerm,section=Layout.Page.container.find("#fieldpermissions_sectionid-"+params.sectId),li=section.siblings("ul").children("li").not(section.siblings("ul").children('li[isPrim="true"]')),prim=section.siblings("ul").children('li[isPrim="true"]'),i=0;i<li.length;i++)$(li[i]).children(".view").find(".dvShwperm").attr("value",vperm).attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[vperm]),$(li[i]).children(".view").find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[vperm]),$(li[i]).children(".edit").find(".dvShwperm").hasClass("disabled")||($(li[i]).children(".edit").find(".dvShwperm").attr("value",wperm).attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[wperm]),$(li[i]).children(".edit").find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[wperm]));section.toggleClass("disabled"),section.siblings("ul").children("li").toggleClass("disabled"),section.children().find("#label_checkBox").attr("disabled",!params.enable),params.enable&&prim.length>0&&($(prim).children(".view").find(".dvShwperm").attr("value",AccessControl.Permissions.FormPerm.FieldPerm.VIEWPERM).attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[AccessControl.Permissions.FormPerm.RecordPerm.VIEWPERM]),$(prim).children(".view").find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[AccessControl.Permissions.FormPerm.RecordPerm.VIEWPERM]),$(prim).children(".edit").find(".dvShwperm").attr("value",AccessControl.Permissions.FormPerm.FieldPerm.EDITPERM).attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[AccessControl.Permissions.FormPerm.RecordPerm.EDITPERM]),$(prim).children(".edit").find("span").attr("class",AccessControl.Permissions.FormPerm.ICON_CLASS[AccessControl.Permissions.FormPerm.RecordPerm.EDITPERM]))}else if(data.isPrimaryLookup)Layout.Page.container.find("#togglesection-"+params.sectId).prop("checked",!0),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.sectionContainsPrimaryLookup"));else{if(Layout.Page.container.find("#ZP-PermissionsSlider").modal("hide"),void 0!=data.status&&""!=data.status.trim()&&"error"!=data.status.trim())return void ZPeople.Message.showFailureMsg(data.status);ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}},getPopOver:function(ele){var isOperationalRole=Layout.Page.container.find("#permissionPopUpRoleId option:selected").attr("isOperationalRole"),popoverHtml=AccessControl.Permissions.FormPerm.FieldPerm.POPOVERCONTENT;"true"==isOperationalRole&&(popoverHtml=AccessControl.Permissions.FormPerm.FieldPerm.ORG_STRUCTURE_ROLE_POPOVERCONTENT),$(ele).popover({html:!0,content:function(){var html=$(popoverHtml);return html.find(".active").removeClass("active"),html.find("."+$(ele).attr("value")).addClass("active"),html}}),Layout.Page.container.find(".dvShwperm").not($(ele)).popover("hide"),$(ele).popover("toggle"),$(ele).siblings().find('[istooltip="true"]').tooltip()},setIndividualField:function(ele){if(!$(ele).hasClass("active")){var formId=$("#permissionPopUpFormId").val(),roleId=$("#permissionPopUpRoleId").val(),val=$(ele).attr("value"),addperneed=!1,actualele=$(ele).closest('[id^="popover"]').siblings(),isView="true"==actualele.attr("isview"),liEle=actualele.closest("li"),fcId=liEle.attr("id").substring(22),first_limit=isView?liEle.attr("ismob")?AccessControl.Permissions.ALLDATA:AccessControl.Permissions.FormPerm.FieldPerm.VIEWPERM:actualele.closest("li").find("[isview='true']").attr("value"),isValid=!1;if(isView||(isValid=AccessControl.Permissions.FormPerm.validateEditPermission(val)),!isValid){if(AccessControl.Permissions.isAppEnab||isView||!AccessControl.Permissions.FormPerm.validateSetPermission(AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM,AccessControl.Permissions.FormPerm.FieldPerm.EDITPERM)||(first_limit=AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM,addperneed=!0),!AccessControl.Permissions.FormPerm.validateSetPermission(first_limit,val)){var key="zp.FieldViewContradict";if(isView||(key="zp.FieldEditViewContradict",addperneed&&(key="zp.FieldEditAddContradict")),!AccessControl.Permissions.isAppEnab||"zp.FieldEditViewContradict"==key)return void ZPeople.Message.showWarningMsg(ZPI18N.getString(key,[AccessControl.Permissions.FormPerm.TITLE[val],AccessControl.Permissions.FormPerm.TITLE[first_limit]]))}if(first_limit=AccessControl.Permissions.FormPerm.FieldPerm.EDITPERM,!(AccessControl.Permissions.isAppEnab||isView||AccessControl.Permissions.FormPerm.validateSetPermission(first_limit,val)||AccessControl.Permissions.FormPerm.validateSetPermission(AccessControl.Permissions.FormPerm.FieldPerm.ADDPERM,val)))return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.FieldEditContradict",[AccessControl.Permissions.FormPerm.TITLE[val],AccessControl.Permissions.FormPerm.TITLE[first_limit]]))}var params={roleId:roleId,formId:formId,mode:"fperm.fieldperm.single",fcId:fcId,valPerm:val,isView:isView};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.FormPerm.FieldPerm.handleIndividualField)}},handleIndividualField:function(data,params){if(data.isSuccess){var cls="",tabname=Layout.Page.container.find("#formpermissionsidlist option:selected").attr("tabname");(15==data.compType||30==data.compType||data.lookupFcId==data.fcId||data.isReadOnly)&&(cls="disabled"),"P_Goals"==tabname||"P_Employee"==tabname&&"ORGANIZATION_TAG_NAME"==data.colName||Layout.Page.container.find("#fieldpermissions_fcid-"+params.fcId).find(".view").empty().append(jQuery("<div />",{class:"btn-group FL"}).append(jQuery("<a />",{value:data.vPerm,isView:!0,"data-trigger":"manual",class:" ZPtitle selPerm dvShwperm","data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.FieldPerm.getPopOver(this)",fldtitle:AccessControl.Permissions.FormPerm.TITLE[data.vPerm],isfldtitle:"true"}).append(jQuery("<span />",{class:AccessControl.Permissions.FormPerm.ICON_CLASS[data.vPerm]})))),Layout.Page.container.find("#fieldpermissions_fcid-"+params.fcId).find(".edit").empty().append(jQuery("<div />",{class:"btn-group FL"}).append(jQuery("<a />",{value:data.ePerm,isView:!1,"data-trigger":"manual",class:"ZPtitle selPerm dvShwperm "+cls,"data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.FieldPerm.getPopOver(this)",fldtitle:AccessControl.Permissions.FormPerm.TITLE[data.ePerm],isfldtitle:"true"}).append(jQuery("<span />",{class:AccessControl.Permissions.FormPerm.ICON_CLASS[data.ePerm]})))),Layout.Page.container.find("#fieldpermissions_fcid-"+params.fcId+' [isfldtitle="true"]').tooltip({title:function(){return $(this).attr("fldtitle")},placement:"top",trigger:"hover"}),data.report&&(Layout.Page.container.find("#fieldpermissions_fcid-"+data.report).find(".view").empty().append(jQuery("<div />",{class:"btn-group FL"}).append(jQuery("<a />",{value:data.vPerm,isView:!0,"data-trigger":"manual",class:" disabled selPerm dvShwperm","data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.FieldPerm.getPopOver(this)",fldtitle:AccessControl.Permissions.FormPerm.TITLE[data.vPerm],isfldtitle:"true"}).append(jQuery("<span />",{class:AccessControl.Permissions.FormPerm.ICON_CLASS[data.vPerm]})))),Layout.Page.container.find("#fieldpermissions_fcid-"+data.report).find(".edit").empty().append(jQuery("<div />",{class:"btn-group FL"}).append(jQuery("<a />",{value:data.ePerm,isView:!1,"data-trigger":"manual",class:"disabled selPerm dvShwperm","data-toggle":"popover","data-placement":"bottom",onclick:"AccessControl.Permissions.FormPerm.FieldPerm.getPopOver(this)",fldtitle:AccessControl.Permissions.FormPerm.TITLE[data.ePerm],isfldtitle:"true"}).append(jQuery("<span />",{class:AccessControl.Permissions.FormPerm.ICON_CLASS[data.ePerm]}))))),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.fieldPermssionsSuccess"))}else if(data.isPrimLookup)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.PrimaryLookuPermissionChange"));else{if(Layout.Page.container.find("#ZP-PermissionsSlider").modal("hide"),void 0!=data.status&&""!=data.status.trim()&&"error"!=data.status.trim())return void ZPeople.Message.showFailureMsg(data.status);ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}}},AccessControl.Permissions.GlobalPerm.init=function(){var params={mode:"gperm.list"},sendReq=!1;Layout.Page.urlparam.hasOwnProperty("roleId")?(params.type="selected",params.roleId=Layout.Page.urlparam.roleId,sendReq=!0):params.type="default",(sendReq||0==Layout.Page.container.find("#globalRolesList").children().length)&&ZPeople.Request.send(AccessControl.Permissions.GlobalPerm.url,params,AccessControl.Permissions.GlobalPerm.show)},AccessControl.Permissions.GlobalPerm.get=function(roleId){window.location.href="#admin/accesscontrol/permissions/global-roleId:"+roleId},AccessControl.Permissions.GlobalPerm.show=function(data){if("success"==data.status){var roles=Layout.Page.container.find("#globalRolesList");if(0==roles.children().length){var list=data.roleslist;for(i in list)list[i].isAdmin||roles.append(jQuery("<option />",{value:list[i].roleId}).append(list[i].roleName));roles.val(data.roleId),roles.select2()}AccessControl.Permissions.GlobalPerm.getGlobalBloks(data.operations.self,Layout.Page.container.find("#global_panel_self"),"self"),AccessControl.Permissions.GlobalPerm.getGlobalBloks(data.operations.info,Layout.Page.container.find("#global_panel_info"),"info"),AccessControl.Permissions.GlobalPerm.getGlobalBloks(data.operations.hierarchy,Layout.Page.container.find("#global_panel_hierarchy"),"hierarchy"),AccessControl.Permissions.GlobalPerm.getGlobalBloks(data.operations.collobarative,Layout.Page.container.find("#global_panel_collobarative"),"collobarative")}else Layout.Page.container.find("#ZP-PermissionsSlider").modal("hide"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},AccessControl.Permissions.GlobalPerm.getGlobalBloks=function(data,div,id){var ul=jQuery("<div />"),active=!1,subordinate=!1,emptree=!1,viewpermDtl=void 0,allpermDtl=void 0;for(i in data){if("EMP_TREE_HIERARCHY"==data[i].opername)data[i].perm&&(subordinate=!0);else if("DASHBOARD_ANNOUNCEMENT"==data[i].opername)viewpermDtl=data[i];else if("ANNOUNCEMENT_ADMIN"==data[i].opername)allpermDtl=data[i];else{if((li=jQuery("<li />",{class:"list-group-item"})).append(jQuery("<div />",{class:"checkbox checkbox-primary DI"}).append(jQuery("<input />",{id:"global_operid_"+data[i].operid,type:"checkbox",checked:data[i].perm,value:data[i].operid,onclick:"AccessControl.Permissions.GlobalPerm.set(this,'"+data[i].opername+"','"+id+"')",class:"check"})).append(jQuery("<label />",{for:"global_operid_"+data[i].operid}).text(data[i].operlabel))),data[i].perm&&(active=!0),"EMP_TREE"==data[i].opername)(ul1=jQuery("<ul />",{class:"PT10"})).append(jQuery("<li />",{class:"list-group-item"}).append(jQuery("<div />",{class:"radio radio-primary DI"}).append(jQuery("<input />",{id:"global_operid_emptree_orgtree",type:"radio",checked:!1,name:"global_emptree",value:data[i].operid,onclick:"AccessControl.Permissions.GlobalPerm.setGlobalPermissionsEmpTree(this,true)"})).append(jQuery("<label />",{for:"global_operid_emptree_orgtree"}).text(ZPI18N.getString("zp.organizationtree"))))),ul1.append(jQuery("<li />",{class:"list-group-item"}).append(jQuery("<div />",{class:"radio radio-primary DI"}).append(jQuery("<input />",{id:"global_operid_emptree_subtree",type:"radio",checked:!1,name:"global_emptree",value:data[i].operid,onclick:"AccessControl.Permissions.GlobalPerm.setGlobalPermissionsEmpTree(this,false)"})).append(jQuery("<label />",{for:"global_operid_emptree_subtree"}).text(ZPI18N.getString("zp.SubordinateTree"))))),li.append(ul1),data[i].perm&&(ul1.find("#global_operid_emptree_orgtree").prop("checked",!0),emptree=!0)}ul.append(li)}if(subordinate&&emptree&&ul.find("#global_operid_emptree_subtree").prop("checked",!0),void 0!==viewpermDtl&&void 0!==allpermDtl){var ul1,isAnnAllowed=!1,isViewDisable=!1,li=jQuery("<li />",{class:"list-group-item"});(viewpermDtl.perm||allpermDtl.perm)&&(isAnnAllowed=!0,active=!0),allpermDtl.perm&&(isViewDisable=!0),li.append(jQuery("<div />",{class:"checkbox checkbox-primary DI"}).append(jQuery("<input />",{id:"global_operid_announcement",type:"checkbox",checked:isAnnAllowed,onclick:"AccessControl.Permissions.GlobalPerm.setAnnouncementGlobalPerm(this, false, '"+data[i].opername+"','"+id+"')",class:"check",name:"global_announcementperm"})).append(jQuery("<label />",{for:"global_operid_announcement"}).text(ZPI18N.getString("zp.announcement")))),(ul1=jQuery("<ul />",{class:"PT10"})).append(jQuery("<li />",{class:"list-group-item"}).append(jQuery("<div />",{class:"checkbox checkbox-primary DI"}).append(jQuery("<input />",{id:"global_operid_"+viewpermDtl.operid,type:"checkbox",checked:viewpermDtl.perm,name:"global_annviewperm",value:viewpermDtl.operid,onclick:"AccessControl.Permissions.GlobalPerm.setAnnouncementGlobalPerm(this,false, '"+data[i].opername+"','"+id+"')",disabled:!!isViewDisable})).append(jQuery("<label />",{for:"global_operid_ann_viewperm",onclick:"AccessControl.Permissions.GlobalPerm.setAnnouncementGlobalPerm('global_annviewperm',false)"}).text(ZPI18N.getString("zp.view"))))),ul1.append(jQuery("<li />",{class:"list-group-item"}).append(jQuery("<div />",{class:"checkbox checkbox-primary DI"}).append(jQuery("<input />",{id:"global_operid_"+allpermDtl.operid,type:"checkbox",checked:allpermDtl.perm,name:"global_annallperm",value:allpermDtl.operid,onclick:"AccessControl.Permissions.GlobalPerm.setAnnouncementGlobalPerm(this,true, '"+data[i].opername+"','"+id+"')"})).append(jQuery("<label />",{for:"global_operid_ann_allperm",onclick:"AccessControl.Permissions.GlobalPerm.setAnnouncementGlobalPerm('global_annallperm',true)"}).text(ZPI18N.getString("zp.add")+"/"+ZPI18N.getString("zp.edit")+"/"+ZPI18N.getString("zp.delete"))))),li.append(ul1),ul.append(li)}div.find("ul").empty().append(ul.children()),div.find(".dvswitch").find("input").prop("checked",active)},AccessControl.Permissions.GlobalPerm.set=function(eve,name,secid){var params={operId:eve.value,valPerm:eve.checked,roleId:Layout.Page.container.find("#globalRolesList").val(),mode:"gperm.single"},edetails={name:name,secid:secid,eve:eve};ZPeople.Request.send(AccessControl.Permissions.GlobalPerm.url,params,AccessControl.Permissions.GlobalPerm.handleSet,edetails)},AccessControl.Permissions.GlobalPerm.handleSet=function(resultData,params,edetails){if("success"==resultData.status){var secid=edetails.secid,name=edetails.name,eve=edetails.eve;ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully")),Layout.Page.container.find("#global_panel_"+secid).find(".check:checked").length>0?Layout.Page.container.find("#global_panel_switch_"+secid).prop("checked",!0):Layout.Page.container.find("#global_panel_switch_"+secid).prop("checked",!1),"EMP_TREE"==name&&(0==eve.checked?($("#global_operid_emptree_orgtree").prop("checked",!1),$("#global_operid_emptree_subtree").prop("checked",!1)):resultData.isEmployeeTree?Layout.Page.container.find("#global_operid_emptree_subtree").prop("checked",!0):Layout.Page.container.find("#global_operid_emptree_orgtree").prop("checked",!0))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},AccessControl.Permissions.GlobalPerm.setGlobalPermissionsEmpTree=function(ele,val){var params={conreqcsr:csrfToken,operId:ele.value,empTreeEnable:val,roleId:Layout.Page.container.find("#globalRolesList").val(),mode:"gperm.emptree"};$.post(AccessControl.Permissions.GlobalPerm.url,params,function(resultData){"success"==resultData.status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully")),Layout.Page.container.find("#global_operid_"+ele.value).prop("checked",!0),Layout.Page.container.find("#global_panel_switch_hierarchy").prop("checked",!0)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))})},AccessControl.Permissions.GlobalPerm.setAnnouncementGlobalPerm=function(ele,isAllPerm,name,id){var c=Layout.Page.container.find("#global_panel_info"),ischecked=!1,value=void 0,isAll=!1;ischecked="global_annviewperm"===ele||"global_annallperm"===ele?!(ele=c.find("input[name='"+ele+"']")).is(":checked"):$(ele).is(":checked");name=(ele=$(ele)).attr("name");if(value=ele.val(),void 0===name||isAllPerm)"global_annallperm"===name&&(isAll=!0,ischecked?(ele.prop("checked",!0),c.find("input[name='global_announcementperm']").prop("checked",!0),c.find("input[name='global_annviewperm']").attr("disabled",!0),c.find("input[name='global_annviewperm']").prop("checked",!0)):(ele.prop("checked",!1),c.find("input[name='global_annviewperm']").attr("disabled",!1),c.find("input[name='global_annviewperm']").prop("checked",!0),c.find("input[name='global_announcementperm']").prop("checked",!0)));else if(c.find("input[name='global_annviewperm']").parent().attr("disabled",!1),"global_announcementperm"===name)value=c.find("input[name='global_annviewperm']").val(),ischecked?(c.find("input[name='global_annviewperm']").prop("checked",!0),ele.prop("checked",!0)):(c.find("input[name='global_annviewperm']").prop("checked",!1),ele.prop("checked",!1),c.find("input[name='global_annallperm']").prop("checked",!1));else if("global_annviewperm"===name)if(ischecked||c.find("input[name='global_annallperm']").is(":checked")){if(!ischecked)return!1;c.find("input[name='global_announcementperm']").prop("checked",!0),ele.prop("checked",!0)}else ele.prop("checked",!1),c.find("input[name='global_announcementperm']").prop("checked",!1);var params={conreqcsr:csrfToken,isEnable:ischecked,operId:value,roleId:Layout.Page.container.find("#globalRolesList").val(),mode:"gperm.announcement",isAll:isAll};$.post(AccessControl.Permissions.GlobalPerm.url,params,function(resultData){var edetails={name:name,secid:id,eve:ele};AccessControl.Permissions.GlobalPerm.handleSet(resultData,params,edetails)})},AccessControl.Permissions.GlobalPerm.toggleSection=function(ele){var params={conreqcsr:csrfToken,mode:"gperm.section"};params.roleId=Layout.Page.container.find("#globalRolesList").val(),params.valPerm=ele.checked,params.secId=ele.value,$.post(AccessControl.Permissions.GlobalPerm.url,params,function(resultData){if("success"==resultData.status){var params1={mode:"gperm.list",type:"selected"};params1.roleId=params.roleId,ZPeople.Request.send(AccessControl.Permissions.GlobalPerm.url,params1,AccessControl.Permissions.GlobalPerm.show),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))})},AccessControl.Permissions.ModulePerm={URL:"modulePermissions.zp",init:function(){ZPUtil.Location.load();ZPeople.Request.send(AccessControl.Permissions.ModulePerm.URL,{submode:"System Modules",mode:"mperm.list"},AccessControl.Permissions.ModulePerm.sysModuleShow)},showAdminError:function(){ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.adminpermnochange"))},sysModuleShow:function(data){var funcList=data.funcList,adminList=funcList.adminList,empList=funcList.empList,modulesList=funcList.modulesList,adminOperationCount=funcList.adminOperationCount,adminCount=funcList.adminCount,superAdminErecno=AccessControl.Permissions.superAdminErecno=funcList.superAdminErecno;Layout.Page.container.find("#adminOperationCount").append(adminOperationCount),Layout.Page.container.find("#adminCount").append(adminCount),Layout.Page.container.find("#adminLocCount").append(funcList.adminLocCount);var adminrows=jQuery("<tr />"),emprows=jQuery("<tr />"),users=jQuery("<div />"),permissions=jQuery("<div />");for(i in modulesList){var modules=modulesList[i].modules;isOb=modulesList[i].isOnboarding,isCases=modulesList[i].isCases,isCompensationModule=modulesList[i].isCompensationModule;var func=isCompensationModule?"":"AccessControl.Permissions.ModulePerm.set('moduleAdminPerm',this)",modName=isOb?"isOb":isCases?"isCases":isCompensationModule?"Compensation":"";if(!1!==modulesList[i].isTraining)for(j in modules)isCases||isCompensationModule?adminrows.append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"DI"}).append(jQuery("<a />",{aoid:modules[j].id,perm:!1,class:"IC-rdo-cir-1 text-default",onclick:func,isCases:isCases,modName:modName})))):adminrows.append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"DI"}).append(jQuery("<a />",{class:"IC-round text-success",onclick:"AccessControl.Permissions.ModulePerm.showAdminError()"})))),emprows.append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"DI"}).append(jQuery("<a />",{aoid:modules[j].id,perm:!1,class:"IC-rdo-cir-1 text-default",onclick:func,isOb:isOb,isCases:isCases,modName:modName}))))}for(i in adminList){users.append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",erecno:adminList[i].erecNo,admin:"true",isProf:adminList[i].isProf,onclick:"ModulePerm.Summary.get(this)"}).append(adminList[i].empId+"  "+adminList[i].empName))));var adminRows=adminrows.clone();for(j in adminRows.attr("erecno",adminList[i].erecNo),modulesList){modules=modulesList[j].modules;for(k in modules)(ZPUtil.checkIsExistInArray(modules[k].empList,adminList[i].erecNo)||adminList[i].erecNo==superAdminErecno)&&(-1!=empList.indexOf(adminList[i].erecNo)&&empList.splice(empList.indexOf(adminList[i].erecNo),1),adminRows.find("[aoid='"+modules[k].id+"']").attr("perm",!0).addClass("IC-round").addClass("text-success").removeClass("IC-rdo-cir-1").removeClass("text-default"),adminList[i].erecNo==superAdminErecno&&adminRows.find("[aoid='"+modules[k].id+"']").attr("onclick","AccessControl.Permissions.ModulePerm.showAdminError()"))}permissions.append(adminRows)}for(j in empList){users.append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",erecno:empList[j].erecNo,onclick:"ModulePerm.Summary.get(this)"}).append(empList[j].empId+"  "+empList[j].empName))));var empRows=emprows.clone();for(i in empRows.attr("erecno",empList[j].erecNo),modulesList){modules=modulesList[i].modules;for(k in modules)ZPUtil.checkIsExistInArray(modules[k].empList,empList[j].erecNo)&&empRows.find("[aoid='"+modules[k].id+"']").attr("perm",!0).addClass("IC-round").addClass("text-success").removeClass("IC-rdo-cir-1").removeClass("text-default")}permissions.append(empRows)}$(".dvhelpover").popover({container:"body"}),Layout.Page.container.find("#systemModulePanel .users").empty().append(users.children()),Layout.Page.container.find("#systemModulePanel .permissions").empty().append(permissions.children()).append(emprows.addClass("newEmpRow").addClass("hide"))},sysFuncsShow:function(data){var system_Modules=data.funcList,adminList=system_Modules.adminList,empList=system_Modules.empList,modulesList=system_Modules.modulesList,users=jQuery("<div />"),permissions=jQuery("<div />"),emprows=jQuery("<tr />"),adminrows=jQuery("<tr />");for(i in modulesList)adminrows.append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"DI"}).append(jQuery("<a />",{class:"IC-round text-success",onclick:"AccessControl.Permissions.ModulePerm.showAdminError()"})))),emprows.append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"DI"}).append(jQuery("<a />",{aoid:modulesList[i].AOID,perm:!1,class:"IC-rdo-cir-1 text-default",onclick:"javascript:AccessControl.Permissions.ModulePerm.set('moduleAdminPerm',this)"}))));jQuery("<tbody />");for(i in adminList)adminrows.attr("erecno",adminList[i].erecNo),users.append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",admin:"true",isProf:adminList[i].isProf,erecno:adminList[i].erecNo,onclick:"ModulePerm.Summary.get(this)"}).append(adminList[i].empId+"  "+adminList[i].empName)))),permissions.append(adminrows.clone());for(j in empList){users.append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",erecno:empList[j].erecNo,onclick:"ModulePerm.Summary.get(this)"}).append(empList[j].empId+"  "+empList[j].empName))));var empRows=emprows.clone();for(k in empRows.attr("erecno",empList[j].erecNo),modulesList)ZPUtil.checkIsExistInArray(modulesList[k].dataList,empList[j].erecNo)&&empRows.find('[aoid="'+modulesList[k].AOID+'"]').attr("perm",!0).addClass("IC-round").addClass("text-success").removeClass("IC-rdo-cir-1").removeClass("text-default");permissions.append(empRows)}Layout.Page.container.find("#systemFunctionsPanel .users").empty().append(users.children()),Layout.Page.container.find("#systemFunctionsPanel .permissions").empty().append(permissions.children()).append(emprows.addClass("newEmpRow").addClass("hide"))},otherFormsShow:function(data){var users=jQuery("<div />"),permissions=jQuery("<div />"),funcList=data.funcList,adminList=funcList.sysForms.adminList,empList=funcList.empList,modulesList=funcList.modulesList,addedList=[],commonheader=jQuery("<tr />").append(jQuery("<th />",{nowrap:!0,colspan:4,class:"text-center"}).append(ZPI18N.getString("zp.SystemForm"))),specificheader=jQuery("<tr />",{class:"thRowchg"}).append(jQuery("<th />",{class:"text-center",nowrap:!0}).append(ZPI18N.getString("zp.users"))).append(jQuery("<th />",{class:"text-center",nowrap:!0}).append(ZPI18N.getString("zp.departments"))).append(jQuery("<th />",{class:"text-center",nowrap:!0}).append(ZPI18N.getString("zp.designations"))).append(jQuery("<th />",{class:"text-center",nowrap:!0}).append(ZPI18N.getString("zp.locations"))),adminrows=jQuery("<tr />"),emprows=jQuery("<tr />"),sysForms=funcList.sysForms;for(i in sysForms.modulesList)adminrows.append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"DI"}).append(jQuery("<a />",{class:"IC-round text-success",onclick:"AccessControl.Permissions.ModulePerm.showAdminError()"})))),emprows.append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"DI"}).append(jQuery("<a />",{aoid:sysForms.modulesList[i].AOID,perm:!1,class:"IC-rdo-cir-1 text-default",onclick:"javascript:AccessControl.Permissions.ModulePerm.set('moduleAdminPerm',this)"}))));for(i in modulesList){commonheader.append(jQuery("<th />",{nowrap:!0,colspan:modulesList[i].count,class:"text-center"}).append(modulesList[i].Name));var modules=modulesList[i].modules;for(j in modules)specificheader.append(jQuery("<th />",{class:"text-center",nowrap:!0}).append(modules[j].Name)),adminrows.append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"DI"}).append(jQuery("<a />",{class:"IC-round text-success",onclick:"AccessControl.Permissions.ModulePerm.showAdminError()"})))),emprows.append(jQuery("<td />",{class:"text-center"}).append(jQuery("<div />",{class:"DI"}).append(jQuery("<a />",{aoid:modules[j].id,perm:!1,class:"IC-rdo-cir-1 text-default unset",onclick:"javascript:AccessControl.Permissions.ModulePerm.set('formAdminPerm',this)"}))))}for(i in Layout.Page.container.find("#otherFormsPanel .headers").empty().append(commonheader).append(specificheader),adminList)adminrows.attr("erecno",adminList[i].erecNo),users.append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",isProf:adminList[i].isProf,admin:"true",erecno:adminList[i].erecNo,onclick:"ModulePerm.Summary.get(this)"}).append(adminList[i].empId+"  "+adminList[i].empName)))),permissions.append(adminrows.clone());for(k in sysForms.empList){addedList.push(sysForms.empList[k].erecNo);var empRows=emprows.clone();for(l in empRows.attr("erecno",sysForms.empList[k].erecNo),users.append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",erecno:sysForms.empList[k].erecNo,onclick:"ModulePerm.Summary.get(this)"}).append(sysForms.empList[k].empId+"  "+sysForms.empList[k].empName)))),sysForms.modulesList){modules=sysForms.modulesList[l];ZPUtil.checkIsExistInArray(sysForms.modulesList[l].dataList,sysForms.empList[k].erecNo)&&empRows.find('[aoid="'+sysForms.modulesList[l].AOID+'"]').attr("perm",!0).addClass("IC-round").addClass("text-success").removeClass("IC-rdo-cir-1").removeClass("text-default")}permissions.append(empRows)}for(j in empList){empRows=null;for(i in ZPUtil.checkIsExistInArray(addedList,empList[j].erecNo)?empRows=permissions.find("[erecno='"+empList[j].erecNo+"']"):(addedList.push(empList[j].erecNo),(empRows=emprows.clone()).attr("erecno",empList[j].erecNo),users.append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",erecno:empList[j].erecNo,onclick:"ModulePerm.Summary.get(this)"}).append(empList[j].empId+"  "+empList[j].empName)))),permissions.append(empRows)),modulesList){modules=modulesList[i].modules;for(k in modules)ZPUtil.checkIsExistInArray(modules[k].empList,empList[j].erecNo)&&empRows.find('[aoid="'+modules[k].id+'"]').attr("perm",!0).addClass("IC-round").addClass("text-success").removeClass("IC-rdo-cir-1").removeClass("text-default")}}Layout.Page.container.find("#otherFormsPanel .users").empty().append(users.children()),Layout.Page.container.find("#otherFormsPanel .permissions").empty().append(permissions.children()).append(emprows.addClass("newEmpRow").addClass("hide"))},show:function(func,id,mode){if(Layout.Page.container.find("#"+id).find(".users").children().length<=0){var params={submode:mode,mode:"mperm.list"},edetails={mode:mode,id:id};ZPeople.Request.send(AccessControl.Permissions.ModulePerm.URL,params,func,edetails)}},set:function(submode,ele){$(ele).removeAttr("onclick");var params={id:$(ele).attr("aoid"),mode:"mperm.set"},val="true"!=$(ele).attr("perm");params.val=val,params.erecNo=$(ele).closest("tr").attr("erecno"),params.submode=submode;var edetails={ele:ele};ZPeople.Request.send(AccessControl.Permissions.ModulePerm.URL,params,AccessControl.Permissions.ModulePerm.handleSet,edetails)},handleSet:function(data,params,edetails){if("success"==data.status){var val=params.val,ele=edetails.ele;if(data.isAccntNtVerified)return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.verifyAccountModulePerm"));"success"==data.updatestatus?(Compensation.Administrators.setRefreshNeeded(!0),Layout.Page.container.find("#adminOperationCount").empty().append(data.adminOperationCount),val?$(ele).attr("perm",val).addClass("IC-round").addClass("text-success").removeClass("IC-rdo-cir-1").removeClass("text-default"):$(ele).attr("perm",val).removeClass("IC-round").removeClass("text-success").addClass("IC-rdo-cir-1").addClass("text-default"),"true"!=$(ele).attr("isOb")&&"true"!=$(ele).attr("isCases")||ModulePerm.selectBoth(ele),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully"))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")),$(ele).attr("onclick","javascript:AccessControl.Permissions.ModulePerm.set('"+params.submode+"',this)")}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},getNonAdminUserList:function(ele,id){var sel=$(ele).parent().find("select"),len=sel.children().length;if(0==len){var params={mode:"mperm.add"};"systemModulePanel"==id?params.submode="System Modules":"systemFunctionsPanel"==id?params.submode="System Functions":"otherFormsPanel"==id&&(params.submode="Other Forms");var edetails={sel:sel,ele:ele};ZPeople.Request.send(AccessControl.Permissions.ModulePerm.URL,params,AccessControl.Permissions.ModulePerm.handleNonAdminUserList,edetails)}else len>1?($(ele).hide(),sel.parent().removeClass("hide")):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nomoreusersfound"))},handleNonAdminUserList:function(data,params,edetails){if("success"==data.status){var sel=jQuery("<div />"),ele=edetails.ele,empList=data.empList;if(0==empList.length)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nomoreusersfound"));else{for(i in sel.append(jQuery("<option />")),empList)sel.append(jQuery("<option />",{value:empList[i].erecNo}).append(empList[i].empId+"  "+empList[i].empName));$(ele).hide(),edetails.sel.empty().append(sel.children()).select2().parent().removeClass("hide")}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},addUser:function(ele,id){sel=$(ele).parent().parent().find("a"),sel.show(),Layout.Page.container.find("#"+id).find(".users").append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",erecno:ele.value,onclick:"ModulePerm.Summary.get(this)"}).text($(ele).find("option:selected").text()))));var empRow=Layout.Page.container.find("#"+id).find(".permissions").find(".newEmpRow").clone().removeAttr("class").attr("erecno",ele.value);Layout.Page.container.find("#"+id).find(".permissions").append(empRow),Layout.Page.container.find("#"+id).find(".users").find("a[erecno="+ele.value+"]").trigger("click"),Layout.Page.container.find("option:selected",ele).remove(),$(ele).select2(),$(ele).parent().addClass("hide")}};var ModulePerm={};ModulePerm.Summary={isLoaded:!1,permList:null,container:null,optns:null,get:function(ele){var element=$(ele);$(ele).attr("admin");AccessControl.Permissions.ModulePerm.ercNum=$(ele).attr("erecno");var params={mode:"mperm.summary",erecNo:$(ele).attr("erecno"),isOperationListNeeded:!ModulePerm.Summary.isLoaded};AccessControl.Permissions.superAdminErecno==AccessControl.Permissions.ModulePerm.ercNum&&ModulePerm.Summary.isLoaded?ModulePerm.Summary.show(void 0,void 0,element):ZPeople.Request.send(AccessControl.Permissions.ModulePerm.URL,params,ModulePerm.Summary.show,element)},show:function(data,params,ele){var username=$(ele).text(),erecno=void 0==params?AccessControl.Permissions.superAdminErecno:params.erecNo,isAdmin=$(ele).attr("admin"),isProf=$(ele).attr("isprof"),isCompensationModuleAdmin=Compensation.PermissionBean.getPermBean().isConsideredModuleAdmin,isCompModuleEnabled=!1;if(ModulePerm.Summary.optns=ZPUtil.Location.constructLocationComboBoxOption(),ModulePerm.Summary.isLoaded)isCompModuleEnabled=!(void 0===data||!data.isCompModuleEnabled)&&data.isCompModuleEnabled,ModulePerm.Summary.container.find("#adminOp_summaryTablebody").show(),ModulePerm.Summary.container.find("#adminOp_summaryTablebody").prev().show(),ModulePerm.Summary.container.find("#adminOp_summaryFormTablebody").show(),ModulePerm.Summary.container.find("#adminOp_summaryFormTablebody").prev().show();else{ModulePerm.Summary.permList=data,ModulePerm.Summary.container=Layout.Page.container.find("#adminOp_popOver");for(var tab=ModulePerm.Summary.container.find("#zp_module_perm_summary_table"),html="",locHtml="",i=0;i<data.modules.length;i++){var obclick=data.modules[i].isOnboarding?'isOb="true"':"";obclick=data.modules[i].isCases?'isCases="true"':obclick,"Compensation"===data.modules[i].name?(isCompModuleEnabled=data.modules[i].isCompModuleEnabled,html+='<tr style="display:none" ismod="true"><td><span>'+data.modules[i].name+'</span></td><td isLocAllowed="true" aoid="'+data.modules[i].settingAOID+'" class="text-center"><div class="DI"><span '+obclick+' isIcon="true"  issetting="true" isCompensation="true" class="IC-rdo-cir-1 text-default"></span><div name="locpop"></div></div></td><td class="text-center" isLocAllowed="true" aoid="'+data.modules[i].dataAOID+'"><div class="PR"><span '+obclick+' isIcon="true" isCompensation="true" issetting="false" class="IC-rdo-cir-1 text-default"></span>'):html+='<tr style="display:none" ismod="true"><td><span>'+data.modules[i].name+'</span></td><td isLocAllowed="false" aoid="'+data.modules[i].settingAOID+'" class="text-center"><div class="DI"><span '+obclick+' isIcon="true"  issetting="true" class="IC-rdo-cir-1 text-default"></span></div></td><td class="text-center" isLocAllowed="true" aoid="'+data.modules[i].dataAOID+'"><div class="PR"><span '+obclick+' isIcon="true" issetting="false" class="IC-rdo-cir-1 text-default"></span>',data.modules[i].isLocAllowed&&("Compensation"===data.modules[i].name?locHtml+=isCompensationModuleAdmin?'<tr style="display:none"><td><span>'+data.modules[i].name+"-"+ZPI18N.getString("zp.settings")+"&"+ZPI18N.getString("zp.data")+'</span></td><td><select multiple aoid="'+data.modules[i].settingAOID+'" dataAoid="'+data.modules[i].dataAOID+'"  data-placeholder="'+ZPI18N.getString("zp.alllocaction")+'">'+ModulePerm.Summary.optns+"</select></td></tr>":'<tr style="display:none"><td><span>'+data.modules[i].name+"-"+ZPI18N.getString("zp.settings")+"&"+ZPI18N.getString("zp.data")+'</span></td><td><select multiple disabled aoid="'+data.modules[i].settingAOID+'" dataAoid="'+data.modules[i].dataAOID+'"  data-placeholder="'+ZPI18N.getString("zp.alllocaction")+'">'+ModulePerm.Summary.optns+"</select></td></tr>":locHtml+='<tr style="display:none"><td><span>'+data.modules[i].name+'</span></td><td><select multiple aoid="'+data.modules[i].dataAOID+'" data-placeholder="'+ZPI18N.getString("zp.alllocaction")+'">'+ModulePerm.Summary.optns+"</select></td></tr>",html+='<div name="locpop"></div>'),html+="</div></td></tr>"}tab.find("#adminOp_summaryModuleTablebody").append(html),ModulePerm.Summary.container.find("#adminOp_summaryModuleTablebody_locations").append(locHtml),html="";for(i=0;i<data.func.length;i++)html+='<tr style="display:none" ismod="true"><td><span>'+data.func[i].name+'</span></td><td isLocAllowed="false" aoid="'+data.func[i].aoid+'" class="text-center" colspan="2"><div class="DI"><span isIcon="true" class="IC-rdo-cir-1 text-default"></span></div></td></tr>';tab.find("#adminOp_summaryTablebody").append(html),html="",locHtml="";for(i=0;i<data.forms.sysForms.length;i++)html+='<tr style="display:none" ismod="true"><td><span>'+data.forms.sysForms[i].name+'</span></td><td isLocAllowed="true"  aoid="'+data.forms.sysForms[i].aoid+'" class="text-center" colspan="2"><div class="PR"><span isIcon="true" isLocForm="'+data.forms.sysForms[i].isLocForm+'" class="IC-rdo-cir-1 text-default"></span>',data.forms.sysForms[i].isLocAllowed&&(locHtml+='<tr style="display:none"><td><span>'+data.forms.sysForms[i].name+'</span></td><td><select multiple aoid="'+data.forms.sysForms[i].aoid+'" data-placeholder="'+ZPI18N.getString("zp.alllocaction")+'">'+ModulePerm.Summary.optns+"</select></td></tr>",html+='<div name="locpop"></div>'),html+="</div></td></tr>";for(i=0;i<data.forms.otherForms.length;i++)html+='<tr style="display:none" isform="true"><td><span>'+data.forms.otherForms[i].name+'</span></td><td isLocAllowed="true" aoid="'+data.forms.otherForms[i].aoid+'" class="text-center" colspan="2"><div class="PR"><span isIcon="true" class="IC-rdo-cir-1 text-default"></span><div name="locpop"></div></div></td></tr>',data.forms.otherForms[i].isLocAllowed&&(locHtml+='<tr style="display:none"><td><span>'+data.forms.otherForms[i].name+'</span></td><td><select multiple aoid="'+data.forms.otherForms[i].aoid+'" data-placeholder="'+ZPI18N.getString("zp.alllocaction")+'">'+ModulePerm.Summary.optns+"</select></td></tr>");ModulePerm.Summary.container.find("#adminOp_summaryFormTablebody_locations").append(locHtml),tab.find("#adminOp_summaryFormTablebody").append(html),data=data.perms,AccessControl.Permissions.ModulePerm.summary_container=Layout.Page.container.find("#adminOp_popOver"),ModulePerm.Summary.isLoaded=!0}if(ModulePerm.Summary.container.find("select").html(ModulePerm.Summary.optns),ModulePerm.Summary.container.find("#adminTopPanel").hide(),ModulePerm.Summary.container.find("[href='#admin_alldata']").tab("show"),ModulePerm.Summary.container.find("#admin_summary_empname").text(username),ModulePerm.Summary.container.find("#admin_summary_edit").hide(),ModulePerm.Summary.container.find('span[isEdit="true"]').removeAttr("class").removeAttr("isEdit").prop("onclick",null).off("click"),ModulePerm.Summary.container.find('a[class="btn btn-primary"]').text("Close").attr("data-dismiss","modal").prop("onclick",null).off("click"),ModulePerm.Summary.container.find("td span").removeData("perms"),(!isAdmin||isCompModuleEnabled&&isCompensationModuleAdmin)&&erecno!=AccessControl.Permissions.superAdminErecno&&ModulePerm.Summary.container.find("#admin_summary_edit").show(),void 0==isAdmin){var allElements=ModulePerm.Summary.container.find('span[isIcon="true"]').attr({class:"IC-cls-1px",ispermset:"false"}).closest("tr");allElements.hide(),allElements.closest("tbody").prev().hide(),ModulePerm.Summary.container.find('[name="locpop"]').html("");var isEmpty=!0;$.each(data.aoids,function(key,value){isEmpty=!1;var permElemTr=ModulePerm.Summary.container.find('td[aoid="'+key+'"] span').attr({class:"IC-tick2",ispermset:"true"}).closest("td");permElemTr.closest("tr").show(),ModulePerm.Summary.container.find('td[aoid="'+key+'"] span').data("perms",value),0!=value.length&&permElemTr.find('[name="locpop"]').empty().append("(").append(ModulePerm.Summary.getLocationPopover(value)).append(")"),permElemTr.closest("tbody").prev().show()}),isEmpty&&ModulePerm.Summary.showEditable()}else ModulePerm.Summary.container.find('span[isIcon="true"]').not('span[isCompensation="true"]').attr("class","IC-tick2").closest("tr").show(),ModulePerm.Summary.container.find("[name='locpop']").html(""),ModulePerm.Summary.container.find('span[isIcon="true"][isCompensation="true"]').closest("tr").hide(),erecno!=AccessControl.Permissions.superAdminErecno&&(ModulePerm.Summary.container.find('span[isIcon="true"][iscases]').attr({class:"IC-cls-1px",ispermset:"false"}),ModulePerm.Summary.container.find('span[isIcon="true"][isCompensation="true"]').attr({class:"IC-cls-1px"})),"true"==isProf&&(erecno!=AccessControl.Permissions.superAdminErecno?ModulePerm.Summary.container.find('span[isIcon="true"][issetting="true"], #adminOp_summaryTablebody span[isIcon="true"], #adminOp_summaryFormTablebody [isLocForm="true"]').not('span[isIcon="true"][iscases]').attr("class","IC-cls-1px"):ModulePerm.Summary.container.find('span[isIcon="true"][issetting="true"], #adminOp_summaryTablebody span[isIcon="true"], #adminOp_summaryFormTablebody [isLocForm="true"]').attr("class","IC-cls-1px")),erecno!=AccessControl.Permissions.superAdminErecno&&$.each(data.aoids,function(key,value){var permElemTr=ModulePerm.Summary.container.find('td[aoid="'+key+'"] span').attr({class:"IC-tick2",ispermset:"true"}).closest("td");permElemTr.closest("tr").show(),ModulePerm.Summary.container.find('td[aoid="'+key+'"] span').data("perms",value),0!=value.length&&permElemTr.find('[name="locpop"]').empty().append("(").append(ModulePerm.Summary.getLocationPopover(value)).append(")"),permElemTr.closest("tbody").prev().show()}),ModulePerm.Summary.container.find("#zp_module_perm_summary_table th").show();ModulePerm.Summary.container.modal("show")},getLocationPopover:function(locids){var listHtml="",popHtml="",count=0;$.each(locids,function(index,locId){count<2?(listHtml+=ZPUtil.Location.ALL_LOCATION[locId],listHtml+=index!=locids.length-1&&1!=index?", ":"",count++):popHtml+="<li>"+ZPUtil.Location.ALL_LOCATION[locId]+"</li>"});var toReturn=jQuery("<span>").append(listHtml);if(""!=popHtml){toReturn.append(" & "+(locids.length-count)+" ");var anch=jQuery("<a />",{class:"dvShwlocation S13"}).append(ZPI18N.getString("zp.more").toLowerCase());toReturn.append(anch),$(anch).popover({html:!0,content:'<ul class="P5 PL8">'+popHtml+"</ul>",placement:"bottom",trigger:"click"})}return toReturn},showEditable:function(){var isAdmin=Layout.Page.container.find("a[erecno='"+AccessControl.Permissions.ModulePerm.ercNum+"']").attr("admin");ModulePerm.Summary.container.find("#adminTopPanel").show(),ModulePerm.Summary.container.find("#admin_summary_edit").hide(),Layout.Page.container.find("#admin_alldata").find('span[class="IC-cls-1px"]').attr({class:"text-default IC-rdo-cir-1",isEdit:"true"}).on("click",function(){ModulePerm.Summary.changePerm(this)}).closest("tr").show(),Layout.Page.container.find("#admin_alldata").find('span[class="IC-tick2"]').attr({class:"IC-round text-success",isEdit:"true",isSelected:"true"}).on("click",function(){ModulePerm.Summary.changePerm(this)}).closest("tr").show(),ModulePerm.Summary.container.find("#admin_locdata").find("thead, tbody tr").hide(),ModulePerm.Summary.container.find("[href='#admin_locdata']").hide(),ModulePerm.Summary.container.find("select").attr("isVisible","false"),ModulePerm.Summary.container.find("#assignedAdminErrDiv").hide(),ModulePerm.Summary.container.find("span[ispermset='true']").each(function(){var aoid=$(this).closest("td").attr("aoid"),aoids=$(this).data().perms,select=ModulePerm.Summary.container.find('select[aoid="'+aoid+'"]');(void 0==select||select.length<=0)&&(select=ModulePerm.Summary.container.find('select[dataAoid="'+aoid+'"]')),1==select.length&&(select.val(aoids),select.attr("isVisible","true").closest("tr").show().parent().prev().show())}),0!=ModulePerm.Summary.container.find('select[isVisible="true"]').length?$(ModulePerm.Summary.container.find("#admin_locdata").find("table").children()[0]).show():ModulePerm.Summary.container.find("#assignedAdminErrDiv").show(),ModulePerm.Summary.container.find("[href='#admin_locdata']").show(),ModulePerm.Summary.container.find('[href="#admin_locdata"]').off("shown.bs.tab"),ModulePerm.Summary.container.find('[href="#admin_locdata"]').on("shown.bs.tab",function(){ModulePerm.Summary.container.find("select").select2()}),ModulePerm.Summary.container.find("#admin_alldata").find("thead, tr").show(),isAdmin&&(ModulePerm.Summary.container.find('span[isIcon="true"]').not('span[isCompensation="true"]').closest("tr").each(function(){$(this).hide()}),ModulePerm.Summary.container.find("#adminOp_summaryTablebody").hide(),ModulePerm.Summary.container.find("#adminOp_summaryTablebody").prev().hide(),ModulePerm.Summary.container.find("#adminOp_summaryFormTablebody").hide(),ModulePerm.Summary.container.find("#adminOp_summaryFormTablebody").prev().hide()),Compensation.PermissionBean.getPermBean().isConsideredModuleAdmin||ModulePerm.Summary.container.find('span[isIcon="true"][isCompensation="true"]').closest("tr").each(function(){$(this).hide()}),ModulePerm.Summary.container.find('[name="locpop"]').html(""),ModulePerm.Summary.container.find('a[class="btn btn-primary"]').text(ZPI18N.getString("zp.submit")).removeAttr("data-dismiss").on("click",function(){ModulePerm.Summary.submit()})},changePerm:function(ele){"true"==$(ele).attr("ispermset")?$(ele).attr({class:"text-default IC-rdo-cir-1",isEdit:"true",ispermset:"false"}):$(ele).attr({class:"IC-round text-success",isEdit:"true",ispermset:"true"});var iscompensation="true"==$(ele).attr("iscompensation");"true"!=$(ele).attr("isOb")&&"true"!=$(ele).attr("isCases")||ModulePerm.selectBoth(ele,!0);var aoid=$(ele).closest("td").attr("aoid"),select=ModulePerm.Summary.container.find('select[aoid="'+aoid+'"]');(void 0==select||select.length<=0)&&(select=ModulePerm.Summary.container.find('select[dataAoid="'+aoid+'"]')),iscompensation&&ModulePerm.Summary.container.find('span[isCompensation="true"][ispermset="true"]').not($(ele)).length>0&&(select=""),1==select.length&&("true"==$(ele).attr("ispermset")?(select.attr("isVisible","true").val([]).select2().closest("tr").show().parent().prev().show(),ModulePerm.Summary.container.find("[href='#admin_locdata']").show(),ModulePerm.Summary.container.find('[href="#admin_locdata"]').off("shown.bs.tab"),ModulePerm.Summary.container.find('[href="#admin_locdata"]').on("shown.bs.tab",function(){ModulePerm.Summary.container.find("select").select2()})):(select.attr("isVisible","false").closest("tr").hide(),0==select.closest("tbody").find("tr:visible").length&&select.closest("tbody").prev().hide())),0==ModulePerm.Summary.container.find('select[isVisible="true"]').length?(ModulePerm.Summary.container.find("#assignedAdminErrDiv").show(),$(ModulePerm.Summary.container.find("#admin_locdata").find("table").children()[0]).hide()):(ModulePerm.Summary.container.find("#assignedAdminErrDiv").hide(),$(ModulePerm.Summary.container.find("#admin_locdata").find("table").children()[0]).show())},submit:function(){ModulePerm.Summary.container.find('a[class="btn btn-primary"]').off("click");var modules=ModulePerm.Summary.container.find('tr[ismod="true"] [ispermset="true"]'),forms=ModulePerm.Summary.container.find('tr[isform="true"] [ispermset="true"]'),moduleList=ModulePerm.Summary.getSelectedLocList(modules),formList=ModulePerm.Summary.getSelectedLocList(forms),params={mode:"mperm.bulkset.old",erecNo:AccessControl.Permissions.ModulePerm.ercNum,moduleList:JSON.stringify(moduleList),formList:JSON.stringify(formList)};ZPeople.Request.send(AccessControl.Permissions.ModulePerm.URL,params,ModulePerm.Summary.getResult)},getSelectedLocList:function(list){for(var selectedLocs={},i=0;i<list.length;i++){var aoid=$(list[i]).closest("td").attr("aoid"),selec=ModulePerm.Summary.container.find('select[aoid="'+aoid+'"]');(void 0==selec||selec.length<=0)&&(selec=ModulePerm.Summary.container.find('select[dataAoid="'+aoid+'"]'));var val=selec.val();0==selec.length||null==val?selectedLocs[aoid]=[]:selectedLocs[aoid]=val}return selectedLocs},getResult:function(data,params){if(data.isAccntNtVerified)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.verifyAccountModulePerm")),void ModulePerm.Summary.container.modal("hide");if(data.isSuccess){if(Compensation.Administrators.setRefreshNeeded(!0),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully")),Layout.Page.container.find("a[erecno='"+AccessControl.Permissions.ModulePerm.ercNum+"']").attr("admin")||Layout.Page.container.find("#systemModulePanel .permissions,#systemFunctionsPanel .permissions,#otherFormsPanel .permissions").children("tr[erecno='"+AccessControl.Permissions.ModulePerm.ercNum+"']").find("a").removeAttr("class").attr({class:"IC-rdo-cir-1 text-default",perm:"false"}),Layout.Page.container.find("#systemModulePanel .permissions,#systemFunctionsPanel .permissions,#otherFormsPanel .permissions").children("tr[erecno='"+AccessControl.Permissions.ModulePerm.ercNum+"']").find('a[modname="Compensation"]').removeAttr("class").attr({class:"IC-rdo-cir-1 text-default",perm:"false"}),Layout.Page.container.find("#adminOp_popOver").modal("hide"),Layout.Page.container.find("#adminOperationCount").empty().append(data.adminOperationCount),0==data.aoids.length)return;var header=Layout.Page.container.find("#adminOp_popOver").find('[isSelected="true"]').closest("tbody"),query="";$.each(data.aoids,function(index,value){query+='[aoid="'+value+'"]',data.aoids.length!=index+1&&(query+=",")});for(var i=0;i<header.length;i++){if("module"==$(header[i]).attr("type")&&0==Layout.Page.container.find("#systemModulePanel .permissions").children("tr[erecno='"+AccessControl.Permissions.ModulePerm.ercNum+"']").length){Layout.Page.container.find("#systemModulePanel").find(".users").append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",erecno:AccessControl.Permissions.ModulePerm.ercNum,onclick:"ModulePerm.Summary.get(this)"}).text(Layout.Page.container.find("#admin_summary_empname").text()))));var empRow=Layout.Page.container.find("#systemModulePanel").find(".permissions").find(".newEmpRow").clone().removeAttr("class").attr("erecno",AccessControl.Permissions.ModulePerm.ercNum);Layout.Page.container.find("#systemModulePanel").find(".permissions").append(empRow)}if("func"==$(header[i]).attr("type")&&0!=Layout.Page.container.find("#systemFunctionsPanel .permissions").children().length&&0==Layout.Page.container.find("#systemFunctionsPanel .permissions").children("tr[erecno='"+AccessControl.Permissions.ModulePerm.ercNum+"']").length){Layout.Page.container.find("#systemFunctionsPanel").find(".users").append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",erecno:AccessControl.Permissions.ModulePerm.ercNum,onclick:"ModulePerm.Summary.get(this)"}).text(Layout.Page.container.find("#admin_summary_empname").text()))));empRow=Layout.Page.container.find("#systemFunctionsPanel").find(".permissions").find(".newEmpRow").clone().removeAttr("class").attr("erecno",AccessControl.Permissions.ModulePerm.ercNum);Layout.Page.container.find("#systemFunctionsPanel").find(".permissions").append(empRow)}if("forms"==$(header[i]).attr("type")&&0!=Layout.Page.container.find("#otherFormsPanel .permissions").children().length&&0==Layout.Page.container.find("#otherFormsPanel .permissions").children("tr[erecno='"+AccessControl.Permissions.ModulePerm.ercNum+"']").length){Layout.Page.container.find("#otherFormsPanel").find(".users").append(jQuery("<tr />").append(jQuery("<td />",{width:"22"})).append(jQuery("<td />").append(jQuery("<a />",{class:"btn-link txttrim",erecno:AccessControl.Permissions.ModulePerm.ercNum,onclick:"ModulePerm.Summary.get(this)"}).text(Layout.Page.container.find("#admin_summary_empname").text()))));empRow=Layout.Page.container.find("#otherFormsPanel").find(".permissions").find(".newEmpRow").clone().removeAttr("class").attr("erecno",AccessControl.Permissions.ModulePerm.ercNum);Layout.Page.container.find("#otherFormsPanel").find(".permissions").append(empRow)}}Layout.Page.container.find("tr[erecno='"+AccessControl.Permissions.ModulePerm.ercNum+"']").find(query).removeAttr("class").attr({class:"IC-round text-success",perm:"true"}),$(Layout.Page.container.find("tbody.users a[erecno='"+AccessControl.Permissions.ModulePerm.ercNum+"']")[0]).trigger("click"),ModulePerm.Summary.container.find('span[isSelected="true"]').removeAttr("isSelected")}else data.isCompModuleAdmin?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.compensation.compAdminErrMsg.notAllowedToChangeCompAdminOps"))}},ModulePerm.selectBoth=function(obj,isspan){var cls=$(obj).attr("class");if(isspan){(abc=$(obj).parents("[aoid]").siblings("[aoid]").find("span")).attr("class",cls),abc.attr("ispermset",$(obj).attr("ispermset"))}else{var modName=$(obj).attr("modName");if($(obj).parents("td").next("td").find("a["+modName+'="true"]').length>0)var abc=$(obj).parents("td").next("td").find("a");else abc=$(obj).parents("td").prev("td").find("a");abc.attr("class",cls),abc.attr("perm",$(obj).attr("perm"))}},AccessControl.Permissions.RolesPerm.init=function(obj){var perm_label,params={mode:"rperm.get"};void 0!=$(obj).closest('[name^="sectionMain"]').attr("tabtype")?(AccessControl.Permissions.RolesPerm.fcType=$(obj).closest('[name^="tabFld"]').attr("type"),AccessControl.Permissions.RolesPerm.isReadOnly="true"==$(obj).closest('[name^="tabFld"]').attr("isreadonly"),perm_label=$(obj).siblings("label").text(),AccessControl.Permissions.RolesPerm.fcId=params.fcId=$(obj).parent().attr("id").match(/[\d]+$/).toString()):(AccessControl.Permissions.RolesPerm.fcType=$(obj).closest('[name^="formcomponentDiv"]').attr("type"),AccessControl.Permissions.RolesPerm.isReadOnly="true"==$(obj).closest('[name^="formcomponentDiv"]').attr("isreadonly"),perm_label=$(obj).parent("div").siblings("label").text(),AccessControl.Permissions.RolesPerm.fcId=params.fcId=$(obj).parent("div").siblings("label").attr("id").match(/[\d]+$/).toString()),params.fcId=AccessControl.Permissions.RolesPerm.fcId,void 0===AccessControl.Permissions.RolesPerm.Container&&($("body").append(AccessControl.Permissions.RolesPerm.template),AccessControl.Permissions.RolesPerm.Container=$("#RolesPerm")),"15"===AccessControl.Permissions.RolesPerm.fcType||"30"===AccessControl.Permissions.RolesPerm.fcType||AccessControl.Permissions.RolesPerm.isReadOnly?AccessControl.Permissions.RolesPerm.Container.find("#editPermRow").hide():AccessControl.Permissions.RolesPerm.Container.find("#editPermRow").show();var formid=Layout.Page.container.attr("id").match(/[\d]+$/).toString();url="",Layout.UrlConf.isServiceMode?url=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.permissions,formid):url="#admin/accesscontrol/permissions/form-formId:"+formid,AccessControl.Permissions.RolesPerm.Container.find("#permissions").attr("href",url),AccessControl.Permissions.RolesPerm.Container.find("#perm_label").empty().append(ZPI18N.getString("zp.permissionsFor")).append(jQuery("<span />").text(" "+perm_label)),ZPeople.Request.send(AccessControl.Permissions.RolesPerm.url,params,AccessControl.Permissions.RolesPerm.rolelist)},AccessControl.Permissions.RolesPerm.rolelist=function(data){AccessControl.Permissions.isAppEnab=data.isApprovalEnabled;var div="";if(data.isHidden||data.isPrimaryLookup||data.isSecHidden||!data.isSuccess)data.isHidden?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.hiddenFieldFailureMsg")):data.isPrimaryLookup?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.primaryLookupFailureMsg")):data.isSecHidden?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.enableSectionFailureMsg")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"));else{for(var i=0;i<data.permList.length;i++)data.permList[i].isAdmin||(div+='<tr roleId="'+data.permList[i].roleId+'"><td class="tbltxt-middle">'+data.permList[i].roleName+'</td> <td class="text-center"><div class="btn-group"><a class="selPerm dvShwperm" data-toggle="popover" data-placement="bottom" data-trigger="manual" isfldtitle="true" fldtitle="'+AccessControl.Permissions.FormPerm.TITLE[data.permList[i].fView]+'" value="'+data.permList[i].fView+'" rView="'+data.permList[i].rView+'" isView="true" isOperationalRole="'+data.permList[i].isOperationalRole+'" onclick="AccessControl.Permissions.RolesPerm.getPopOver(this)"> <span class="'+AccessControl.Permissions.FormPerm.ICON_CLASS[data.permList[i].fView]+'"></span></a></div></td>',"15"==AccessControl.Permissions.RolesPerm.fcType||AccessControl.Permissions.RolesPerm.isReadOnly||"30"==AccessControl.Permissions.RolesPerm.fcType||(div+='<td class="text-center"><div class="btn-group"><a class="selPerm dvShwperm" data-toggle="popover" data-placement="bottom" data-trigger="manual" isfldtitle="true" fldtitle="'+AccessControl.Permissions.FormPerm.TITLE[data.permList[i].fEdit]+'" fView="'+data.permList[i].fView+'"value="'+data.permList[i].fEdit+'" rEdit="'+data.permList[i].rEdit+'" rAdd="'+data.permList[i].rAdd+'" isView="false" isOperationalRole="'+data.permList[i].isOperationalRole+'" onclick="AccessControl.Permissions.RolesPerm.getPopOver(this)"><span class="'+AccessControl.Permissions.FormPerm.ICON_CLASS[data.permList[i].fEdit]+'"></span></a></div></td></tr>'),div+="</tr>");AccessControl.Permissions.RolesPerm.Container.find("tbody").empty().append(div),AccessControl.Permissions.RolesPerm.Container.find('[isfldtitle="true"]').tooltip({title:function(){return $(this).attr("fldtitle")},placement:"top",trigger:"hover"}),AccessControl.Permissions.RolesPerm.Container.modal("show")}},AccessControl.Permissions.RolesPerm.getPopOver=function(ele){var POPOVER_HTML="true"==$(ele).attr("isOperationalRole")?AccessControl.Permissions.FormPerm.FieldPerm.ORG_STRUCTURE_ROLE_POPOVERCONTENT:AccessControl.Permissions.FormPerm.FieldPerm.POPOVERCONTENT;$(ele).popover({html:!0,content:function(){var html=$(POPOVER_HTML);return html.find("li").attr("onclick","AccessControl.Permissions.RolesPerm.addicon(this)"),html.find(".active").removeClass("active"),html.find("."+$(ele).attr("value")).addClass("active"),html}}),Layout.Page.container.find(".dvShwperm").not($(ele)).popover("hide"),$(ele).popover("toggle"),$(ele).siblings().find('[istooltip="true"]').tooltip()},AccessControl.Permissions.RolesPerm.addicon=function(ele){var val=$(ele).attr("value"),actualele=$(ele).closest('[id^="popover"]').siblings(),isView="true"==actualele.attr("isview"),first_limit=isView?actualele.attr("rView"):actualele.attr("fView"),isValid=!1,addperneed=!1;if(!isView){var redit=actualele.attr("rEdit"),radd=actualele.attr("rAdd");isValid=AccessControl.Permissions.FormPerm.validateEditPermission(val,radd,redit)}if(!isValid){if(AccessControl.Permissions.isAppEnab||isView||!AccessControl.Permissions.FormPerm.validateSetPermission(radd,redit)||(first_limit=radd,addperneed=!0),!AccessControl.Permissions.FormPerm.validateSetPermission(first_limit,val)){var key="zp.FieldViewContradict";if(isView||(key="zp.FieldEditViewContradict",addperneed&&(key="zp.FieldEditAddContradict")),!AccessControl.Permissions.isAppEnab||"zp.FieldEditViewContradict"==key)return void ZPeople.Message.showWarningMsg(ZPI18N.getString(key,[AccessControl.Permissions.FormPerm.TITLE[val],AccessControl.Permissions.FormPerm.TITLE[first_limit]]))}if(first_limit=actualele.attr("rEdit"),!(isView||AccessControl.Permissions.FormPerm.validateSetPermission(first_limit,val)||(first_limit=actualele.attr("rAdd"),AccessControl.Permissions.isAppEnab||AccessControl.Permissions.FormPerm.validateSetPermission(first_limit,val))))return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.FieldEditContradict",[AccessControl.Permissions.FormPerm.TITLE[val],AccessControl.Permissions.FormPerm.TITLE[first_limit]]))}if(actualele.attr("value")!=val){var newval=AccessControl.Permissions.FormPerm.ICON_CLASS[val];actualele.children("span").attr("class",newval),actualele.attr("value",val),actualele.attr("fldtitle",AccessControl.Permissions.FormPerm.TITLE[val]),actualele.closest("tr").attr("Perm","changed"),isView?(actualele.closest("tr").attr("vPerm","changed"),"15"==AccessControl.Permissions.RolesPerm.fcType||AccessControl.Permissions.RolesPerm.isReadOnly||"30"==AccessControl.Permissions.RolesPerm.fcType||actualele.closest("td[class ^= 'text-center']").siblings(".text-center").children().children().attr("fview",val)):actualele.closest("tr").attr("ePerm","changed")}$(actualele).popover("hide")},AccessControl.Permissions.RolesPerm.addList=function(){var listArray={},smallList={},ele=AccessControl.Permissions.RolesPerm.Container.find("tbody").children('tr[Perm="changed"]');if(0!=ele.length)for(var i=0;i<ele.length;i++){var roleId=$(ele[i]).attr("roleId");if(void 0!=$(ele[i]).attr("vPerm")){var viewTrue=$(ele[i]).find("[isView='true']"),vPerm=$(viewTrue).attr("value");smallList.vPerm=vPerm}if(void 0!=$(ele[i]).attr("ePerm")){var viewFalse=$(ele[i]).find("[isView='false']"),ePerm=$(viewFalse).attr("value");smallList.ePerm=ePerm}listArray[roleId]=smallList,smallList={}}if(0!=Object.keys(listArray).length){var params={mode:"rperm.set"};params.fcId=AccessControl.Permissions.RolesPerm.fcId,params.permList=JSON.stringify(listArray),ZPeople.Request.send(AccessControl.Permissions.RolesPerm.url,params,AccessControl.Permissions.RolesPerm.result)}AccessControl.Permissions.RolesPerm.Container.modal("hide")},AccessControl.Permissions.RolesPerm.result=function(data){data.isSuccess?(AccessControl.Permissions.RolesPerm.Container.modal("hide"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.fieldPermssionsSuccess"))):(AccessControl.Permissions.RolesPerm.Container.modal("hide"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")))},AccessControl.Permissions.TabularPermission={init:function(tabformid){var params={formId:tabformid,mode:"tperm.list"};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.TabularPermission.show)},show:function(data,params){var div="";if(data.isSuccess)for(var i=0;i<data.permList.length;i++)div+='<tr roleId="'+data.permList[i].id+'"> <td class="tbltxt-middle">'+data.permList[i].name+"</td> ",div+='<td class="text-center"><div class="btn-group"><a onclick="$(this).attr(\'Perm\',\'changed\'); $(this).toggleClass(\'fieldim fieldex\')" permtype="1" class="selPerm dvShwperm '+(data.permList[i].aperm?"fieldim":"fieldex")+'" currperm="'+data.permList[i].aperm+'"> </a></div></td>',div+='<td class="text-center"><div class="btn-group"><a onclick="$(this).attr(\'Perm\',\'changed\'); $(this).toggleClass(\'fieldim fieldex\')" permtype="2" class="selPerm dvShwperm '+(data.permList[i].eperm?"fieldim":"fieldex")+'" currperm="'+data.permList[i].eperm+'"> </a></div></td>',div+='<td class="text-center"><div class="btn-group"><a onclick="$(this).attr(\'Perm\',\'changed\'); $(this).toggleClass(\'fieldim fieldex\')" permtype="3" class="selPerm dvShwperm '+(data.permList[i].dperm?"fieldim":"fieldex")+'" currperm="'+data.permList[i].dperm+'"> </a></div></td>',div+="</tr>";void 0===AccessControl.Permissions.TabularPermission.Container&&($("body").append('<div class="modal modal-small fade" id="TabularPerm" role="dialog"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"><a type="button" class="close IC-cls-1px red" data-dismiss="modal"></a> <h4 class="modal-title"><span class="txttrim" id="perm_label"></span></h4> </div> <div class="modal-body"> <div class="row"> <div class="col-md-12 dvtabsfrm"> <table class="table table-responsive tblpermission"> <thead><tr><th>'+ZPI18N.getString("zp.roles")+'</th> <th class="text-center">'+ZPI18N.getString("zp.add")+'</th> <th class="text-center">'+ZPI18N.getString("zp.edit")+'</th> <th class="text-center">'+ZPI18N.getString("zp.delete")+'</th> </tr> </thead> <tbody></tbody> </table></div> </div> </div> <div class="modal-footer"><div class="text-right"><a class="btn btn-primary" onclick="AccessControl.Permissions.TabularPermission.submit()">'+ZPI18N.getString("zp.done")+"</a></div></div></div></div></div>"),AccessControl.Permissions.TabularPermission.Container=$("#TabularPerm")),AccessControl.Permissions.TabularPermission.Container.attr("tabformid",params.formId),AccessControl.Permissions.TabularPermission.Container.find("#perm_label").html(ZPI18N.getString("zp.permissionsFor")+"<span> "+data.disp+" </span>"),AccessControl.Permissions.TabularPermission.Container.find("tbody").empty().append(div),AccessControl.Permissions.TabularPermission.Container.modal("show")},submit:function(){var listArray={},ele=AccessControl.Permissions.TabularPermission.Container.find("td a[Perm='changed']");if(0!=ele.length){for(var i=0;i<ele.length;i++){var roleId=$(ele[i]).closest("tr").attr("roleId");if($(ele[i]).hasClass("fieldim")&&"false"==$(ele[i]).attr("currperm")||$(ele[i]).hasClass("fieldex")&&"true"==$(ele[i]).attr("currperm")){listArray[roleId]||(listArray[roleId]={});var perm=listArray[roleId];switch($(ele[i]).attr("permtype")){case"1":perm.aperm=$(ele[i]).hasClass("fieldim");break;case"2":perm.eperm=$(ele[i]).hasClass("fieldim");break;case"3":perm.dperm=$(ele[i]).hasClass("fieldim")}}}if(Object.keys(listArray).length>0){var params={formId:AccessControl.Permissions.TabularPermission.Container.attr("tabformid"),mode:"tperm.update",perms:JSON.stringify(listArray)};ZPeople.Request.send(AccessControl.Permissions.FormPerm.url,params,AccessControl.Permissions.TabularPermission.showStatus)}}AccessControl.Permissions.TabularPermission.Container.modal("hide")},showStatus:function(data){data.isSuccess?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.permissionsUpdated")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}};var isDropElement=!1;AppFlow={id:"all"},AppsCustom={},AppsCustom.Form_Container=null,AppFlow.templates={ADDAPPCARD:'<li class="addcrd $SHOWHIDE$" onclick="AppsCustom.addNewApp(this);"><a class="appcrddt"><i class="IC-plus-big"></i></a></li>',SINGLEAPPLI:'<li name="$APPNAME$" class="$APPCOLOR$" tab="$TABID$" form="$FORMID$" $ADDNPROPS$><a href="#services/listview-formId:$FORMID$/viewId:$VIEWID$" class="appcrddt"><span><i class="$ICONCLASS$">$ICONNAME$</i><p id="appName_$FORMID$">$APPNAME$</p><span class="anibg"></span></span></a><div class="appact"><ul><li><a><i class="IC-pin"></i></a></li><li><a class="btnapplst clkdv" name="appOpern" data-original-title="" title=""><i class="IC-info" name="appOperns"></i></a></li></ul></div></li>',SINGLETABLI:'<li id="zp_maintab_$TABNAME$" tabname="$TABNAME$"><a $HREF$><div id="zp_mt_$TABNAME$"><i class="ZPMic ZPic-$TABNAME$"><i class="IC-$TABNAME$-01 path1"></i><i class="IC-$TABNAME$-02 path2"></i></i><span class="ZPmtxt">$TABDISPNAME$</span></div></a></li>'},AppFlow.setParams=function(){Layout.Page.container.parents("#wrapper").find("#zpeople_tabs #zp_maintabs li#zp_maintab_services a").attr("href",$(this).find("a").attr("href")),void 0==AppFlow.TAB_JSON?ZPeople.Request.send("/getAppsList.zp",{method:"appListingPage"},AppFlow.init,null,null):AppFlow.init({msg:zpconst.CommonMessages.SUCCESSMSG,tabList:AppFlow.TAB_JSON})},AppFlow.init=function(data){if(data.msg.trim()==zpconst.CommonMessages.SUCCESSMSG){AppFlow.id=window.location.href.split("-").pop().toString();var tabs=data.tabList;AppFlow.TAB_JSON=tabs;var className="all"==AppFlow.id?"sel":"",tabDiv='<div prop="appListing" class="appslistall"><div class="appcat"><ul id="tabsUl"><li id="all" class="'+className+'"><a href="#services/adminop/appslayout/appslist-all">All Services<span></span></a></li>',tabList=tabs;if(tabs.length>8)var moreDiv='<li class="more dropdown" id="moreIcon"><a data-toggle="dropdown"><i class="IC-more"></i></a><ul class="dropdown-menu">';if("all"!=AppFlow.id){var selInd=AppFlow.findIndexVal(AppFlow.id,"tabIndex",AppFlow.TAB_JSON,"tabId");null==selInd&&(window.location.href="zp#services/adminop/appslayout/appslist-all"),selInd>6&&AppFlow.updateTabs(selInd)}$.each(tabs,function(tabIndex,tab){if(className="",AppFlow.id==tab.tabId&&(tabList=[tab],className="sel",tabIndex>6)){AppFlow.updateTabs(tabIndex);var tabClone=tabs[6];tabs[6]=tab,delete tabs[tabIndex],tabs[tabs.length-1]=tabClone}var liDiv='<li class="'+className+'" id="'+tab.tabId+'"><a href="#services/adminop/appslayout/appslist-'+tab.tabId+'">'+tab.displayName+"<span></span></a></li>";tabIndex<7?tabDiv+=liDiv:moreDiv+=liDiv}),void 0!=moreDiv&&(tabDiv+=moreDiv+="</ul></li>"),tabDiv+='</ul><div class="appcustom"><div class="appsearch"><input id="searchApps" placeholder="Search Services" name="Search" class="form-control inputsearch" type="Search" onkeyup="AppFlow.searchApps(this)"></div>',(ZPeople.isAdmin()||ZPeople.adminPerms.hasOwnProperty("Manage_Tabs_Forms_Customization"))&&(tabDiv+='<a id="appCustom" class="IC-setting2 btncust" onclick="AppsCustom.customizeTab(this)"></a>'),tabDiv+="</div></div>",tabDiv+=AppFlow.Construct(tabList),tabDiv+='</div><a class="IC-cls clsbg" onclick="AppsCustom.customizeTab(this)"></a></div><div></div><div></div><div></div></div></div></div><div class="appcustomize" prop="appCustomize"><div class="ctable ZPTscrlcont" id="zp_page_loading"><div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div></div></div>',Layout.Page.container.html($(tabDiv)),$("#page-wrapper").find("[id=tabsUl] li[id]").unbind(),$("#page-wrapper").find("[id=tabsUl] li[id]").not("#moreIcon").click(function(){var tabId=$(this).attr("id"),selIndex=AppFlow.findIndexVal(tabId,"tabIndex",AppFlow.TAB_JSON,"tabId");selIndex>6&&AppFlow.updateTabs(selIndex)}),$("#zp-contwrap-services-adminop").find("#tabsUl li").unbind(),$("#zp-contwrap-services-adminop").find("#tabsUl li").click(function(){Layout.Page.container.parents("#wrapper").find("#zpeople_tabs #zp_maintabs li#zp_maintab_services a").attr("href",$(this).find("a").attr("href"))}),AppFlow.popoverConstruct()}},AppFlow.appsCons=function(){if(AppFlow.id=window.location.href.split("-").pop().toString(),Layout.Page.container.find("[prop=appListing] #"+AppFlow.id).addClass("sel"),Layout.Page.container.find("[prop=appListing] [id=tabsUl] li").not("#"+AppFlow.id).removeClass("sel"),0==$("[prop=appListing]").find("[tabprop=all]").length)ZPeople.Request.send("/getAppsList.zp",{appId:AppFlow.id,method:"appListingPage"},AppFlow.constructAppsList);else if(0==$("[prop=appListing]").find("[tabprop="+AppFlow.id+"]").length){var clonediv=$("[tabprop=all]").parents("[name=appScrollDiv]").clone();$("[tabprop=all]").find("li[tab="+AppFlow.id+"]").length>0&&(clonediv=$("[tabprop=all]").find("li[tab="+AppFlow.id+"]").parents("[name=appScrollDiv]").clone()),clonediv.find("li[tab]").not("li[tab="+AppFlow.id+"]").remove(),clonediv.find("[tabprop]").attr("tabprop",AppFlow.id),Layout.Page.container.find("[prop=appListing]:visible").append('<div class="dvflow_str scrl bgrey" name="appScrollDiv">'+clonediv.html()+"</div>"),Layout.Page.container.find("[prop=appListing]:visible").siblings("#zp_page_loading").hide(),AppFlow.popoverConstruct()}},AppFlow.constructAppsList=function(data,params){if(data.hasOwnProperty("tabList")){var tabList=data.tabList;$("[prop=appListing]:visible").siblings("#zp_page_loading").hide(),$("[prop=appListing]:visible").append(AppFlow.Construct(tabList)),AppFlow.popoverConstruct()}},AppFlow.Construct=function(tabList){var appListingDiv='<div class="dvflow_str scrl bgrey" name="appScrollDiv"><div class="applst" id="slideshow"><ul class="appcrd" tabprop="'+AppFlow.id+'">',showclass=ZPeople.isAdmin()||ZPeople.adminPerms.hasOwnProperty(zpconst.ControlPanelFunctions.create)?"":"hide";return appListingDiv=(appListingDiv+=AppFlow.templates.ADDAPPCARD).replace(/\$SHOWHIDE\$/g,showclass),$.each(tabList,function(index,tabInfo){var appsInTab=tabInfo.formArr;tabInfo.isLink||tabInfo.tabId;$.each(appsInTab,function(ind,singleAppInfo){var addnProps="";appListingDiv=(appListingDiv=(appListingDiv=(appListingDiv+=AppFlow.templates.SINGLEAPPLI.replace(/\$APPNAME\$/g,singleAppInfo.displayName)).replace(/\$FORMID\$/g,singleAppInfo.pcId)).replace(/\$VIEWID\$/g,singleAppInfo.viewId)).replace(/\$TABID\$/g,tabInfo.tabId);var iconName="",iconClass="empty";if(void 0!=singleAppInfo.formicon)iconClass=singleAppInfo.formicon;else{var nameSplit=ZPeople.decodeTxt(singleAppInfo.displayName).split(/[^\w]/);$.each(nameSplit,function(nameSplitInd,str){if(2==iconName.length)return!1;str.trim().length>0&&(iconName+=str.substring(0,1))})}appListingDiv=(appListingDiv=(appListingDiv=appListingDiv.replace(/\$ICONNAME\$/g,iconName)).replace(/\$ICONCLASS\$/g,iconClass)).replace(/\$APPCOLOR\$/g,void 0!=singleAppInfo.formcolor?singleAppInfo.formcolor:""),-1!=$.inArray(singleAppInfo.tablename,["P_ClientDetails","P_TimesheetJobsList","P_TimesheetJob","P_Timesheet","P_EmployeeJobs","P_Candidate"])&&singleAppInfo.hasOwnProperty("tablename")||(addnProps=$.inArray(singleAppInfo.tablename,["P_Employee"])>=0?"employeeForm=true":"onlyDisable=true empLeave = "+("P_EmployeeLeave"==singleAppInfo.tablename)),singleAppInfo.isCustom||(addnProps=" issystem=true"),appListingDiv=(appListingDiv=appListingDiv.replace(/\$ADDNPROPS\$/g,addnProps)).replace(/\$METHODNAME\$/g,"appOperations.postMethod(this,['formCustOperations','showhideform'])")})}),appListingDiv+="</div></div></ul>"},AppFlow.searchApps=function(obj){var value=$(obj).val(),searchDiv=Layout.Page.container.find("[tabprop]:visible");$(obj).parent("div").hasClass("active")||$(obj).parent("div").addClass("active"),$(searchDiv).find("li[tab]").hide(),$(searchDiv).find("li[tab]").filter(function(){if($(this).attr("name").match(new RegExp(value,"i")))return this}).show()},AppsCustom.addAppPopup=function(data,params,others){if(data.indexOf("</div>")>0){var parentDiv=$("body");parentDiv.append('<div id="addFormSlider"></div>');var addformPopup=ZPeople.createModalPopup("dvaddform",ZPI18N.getString("zp.addnewform"),"popRgtModel modal-right rmbxsdw",{});addformPopup.find("#bodyTag").append(data),addformPopup.find("#newTab").hide(),parentDiv.find("#addFormSlider").html(addformPopup),parentDiv.find("#addFormSlider [buttonname=done]").unbind(),parentDiv.find("#addFormSlider [buttonname=done]").click(function(){tabCustom.saveForm(this,others)}),parentDiv.find("#dvaddform").modal("show"),formCustom.select2ForSelectBox(parentDiv.find("#addFormSlider #dvaddform")),$("#dvaddform").bind("shown",function(){$("#dvaddform").find("input").first().select()}),parentDiv.find("#dvaddform #newTab input").change(function(){errorFunction.removeErrorSpan($("[id=addFormSlider]"),"[for=formname]",!0);var tabName=$.trim($(this).val());if(""!=tabName){if($.grep(ZPServices.SERVICE_JSON,function(ele){return ele.dispName.toLowerCase()==tabName.toLowerCase()}).length>0||tabName.length>50){var errorMsg=ZPI18N.getString("zp.servicenameduplicateerror");tabName.length>50&&(errorMsg=ZPI18N.getString("zp.servicenamelengthmax")),errorFunction.errorSpanAttach(errorMsg,$(this).parent("div"),!1,!0),$(this).parents("[errorDiv=cantbeempty]"),error="true"}}}),AppsCustom.Form_Container=parentDiv.find("#addFormSlider"),others&&others.tabshow?AppsCustom.Form_Container.find("[keyname=tabId]").closest('[name="addFormFields"]').show():AppsCustom.Form_Container.find("[keyname=tabId]").closest('[name="addFormFields"]').hide(),others&&others.tabid&&(AppsCustom.Form_Container.find("[keyname=tabId]").val(others.tabid),AppsCustom.Form_Container.find("[keyname=tabId]").select2()),others&&others.portalType?AppsCustom.Form_Container.find("#portalType").val(others.portalType):"onboarding"==ZPeople.Help.getHelpModuleKey()&&AppsCustom.Form_Container.find("#portalType").val(1),AppsCustom.Form_Container.find('[data-toggle="popover"]').popover()}else""!=(data=JSON.parse(data)).msg.trim()&&ZPeople.Message.showFailureMsg(data.msg.trim())},AppsCustom.addNewApp=function(obj,optns){var tabId=window.location.href.split("-").pop();if(null!=AppsCustom.Form_Container){if(AppsCustom.appCount<=0)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.upgradeformsubscription",[paymentUrl]));AppsCustom.Form_Container.show(),errorFunction.removeErrorSpan(addFormSlider,void 0,!0),AppsCustom.Form_Container.find("textarea, input").val(""),AppsCustom.Form_Container.find("input[keyname=startsFrom]").val(1),AppsCustom.Form_Container.find("select option:first").prop("selected",!0),$.each(AppsCustom.Form_Container.find("select"),function(ele){$(this).val($(this).find("option:first").val())}),AppsCustom.Form_Container.find("input[type=checkbox]").prop("checked",!1),AppsCustom.Form_Container.find("#selectForm,#autonumberDiv,#chooseFileForAddForm").hide(),AppsCustom.Form_Container.find("#newTab").siblings("div").show(),AppsCustom.Form_Container.find("#newTab").hide(),void 0!=optns.portalType?AppsCustom.Form_Container.find("#portalType").val(optns.portalType):"onboarding"==ZPeople.Help.getHelpModuleKey()&&AppsCustom.Form_Container.find("#portalType").val(1),AppsCustom.Form_Container.find("[buttonname=done]").removeClass("disabled"),AppsCustom.Form_Container.find("[buttonname=done]").unbind(),AppsCustom.Form_Container.find("[buttonname=done]").click(function(){tabCustom.saveForm(this,optns)}),AppsCustom.Form_Container.find("#dvaddform").modal("show"),optns&&optns.tabshow?AppsCustom.Form_Container.find("[keyname=tabId]").closest('[name="addFormFields"]').show():AppsCustom.Form_Container.find("[keyname=tabId]").closest('[name="addFormFields"]').hide(),optns&&optns.tabid&&AppsCustom.Form_Container.find("[keyname=tabId]").val(optns.tabid),AppsCustom.Form_Container.find("select").select2()}else tabAndFormsCustom.hasOwnProperty("FormCount")&&tabAndFormsCustom.FormCount<=0?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.upgradeformsubscription",[paymentUrl])):formCustom.formOperations(obj,["newForm",AppsCustom.addAppPopup],tabId,optns)},AppsCustom.customizeTab=function(obj){$("body").toggleClass("applstcust"),Layout.Page.container.find("[name=appScrollDiv]").toggleClass("custdrap"),"appCustom"==$(obj).attr("id")?(0==$("#page-wrapper").find("[name=customiseDiv]").length?appsCategoryCustom.init():($("#page-wrapper").find("[prop=appCustomize]").html(""),Layout.Page.container.find("[prop=appCustomize]").append($("#page-wrapper").find("[name=customiseDiv]").clone().removeClass("DN")),Layout.Page.container.find("[prop=appCustomize] #zp_page_loading").hide(),appOperations.sortApps()),$("body").hasClass("ZPsbarMini")||($("body").attr("forAppCustomize",!0),ZPeople.minmaxTab())):($("#page-wrapper").find("[name=customiseDiv]").html(Layout.Page.container.find("[name=customiseDiv]").html()),Layout.Page.container.find("[prop=appCustomize]").html(""),AppFlow.hasOwnProperty("setDeleteOnCloseId")&&($("#services-adminop-appslayout-appslist-"+AppFlow.setDeleteOnCloseId).remove(),window.location.href=Layout.Page.container.find("#tabsUl li#all a").attr("href"),delete AppFlow.setDeleteOnCloseId),AppFlow.deletecustomiseDiv&&($("[name=customiseDiv]").remove(),delete AppFlow.deletecustomiseDiv),window.dispatchEvent(new HashChangeEvent("hashchange")),"true"==$("body").attr("forAppCustomize")&&($("body").attr("forAppCustomize",""),ZPeople.minmaxTab()))},AppFlow.hidePop=function(){$("body").click()},AppFlow.popoverConstruct=function(){$("[prop=appListing]:visible").find("[name=appOpern]").setPopOver({html:function(){AppFlow.fid=$(this).parents("li[form]").attr("form"),0==$("body").find("#poverBgDiv").length&&$("body").append('<div id="poverBgDiv" class="pover-bg open"></div>'),$(this).parents("li[form]").addClass("sel");var a='<div class="dvshwappdtl"><div class="applst-info"><ul class="">';return ZPeople.isAdmin()?$.each(ZPAppConstants,function(key,value){a+='<li><a name="appAction" onclick="AppFlow.hidePop()" href="'+Layout.CustomizedUrl.getNewCustomizedUrl(value)+"formid:"+AppFlow.fid+'"><i class="IC-app5"></i>'+ZPI18N.getString("zp."+key)+"</a></li>"}):(AppFlow.fnsCount=Object.keys(ZPeople.adminPerms).length,AppFlow.fnsCount>0&&$.each(ZPAppConstants,function(key,value){(ZPeople.adminPerms.hasOwnProperty(zpconst.ControlPanelFunctions[key])||("approvals"==key||"automate"==key)&&ZPeople.adminPerms.hasOwnProperty(zpconst.ControlPanelFunctions.automation))&&(a+='<li><a name="appAction" onclick="AppFlow.hidePop()" href="'+Layout.CustomizedUrl.getNewCustomizedUrl(value)+"formid:"+AppFlow.fid+'"><i class="IC-app5"></i>'+ZPI18N.getString("zp."+key)+"</a></li>")})),a+="</ul></div></div>",void 0!=AppFlow.fnsCount&&0==AppFlow.fnsCount?($(this).parents("li[form]").removeClass("sel"),$("body").find("#poverBgDiv").remove(),null):a},placement:"right",container:"li[form].sel:visible"}),1==$("[id*=zp-contwrap-services-]").children().length&&$("body").on("click",function(e){$('[data-toggle="popover"]').each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||0!==$(".popover").parents("li[form]").has(e.target).length||($(this).popover("hide"),"appOperns"!=$(e.target).attr("name")&&(Layout.Page.container.find("li[form]").removeClass("sel"),$("body").find("#poverBgDiv").remove()))})}),$("[name=appAction]").on("click",function(){$("body").click()}),$("[id*=searchApps]").on("focus blur",function(e){AppFlow.toggleActive(e,this)})},AppFlow.findIndexVal=function(id,returnKey,tabData,key){var returnVal=null;return $.each(tabData,function(index,tab){if(tab[key]==id)return returnVal="tabIndex"==returnKey?index:tab,!1}),returnVal},AppFlow.updateTabs=function(tabIndex){var tabClone=AppFlow.TAB_JSON[6];AppFlow.TAB_JSON[6]=AppFlow.TAB_JSON[tabIndex],AppFlow.TAB_JSON.splice(tabIndex,1),AppFlow.TAB_JSON[AppFlow.TAB_JSON.length]=tabClone,setTimeout(function(){Layout.Page.container.siblings("div").remove()},100)},AppFlow.findAppIndex=function(id,returnKey){var returnVal={},returnBool=!0;return $.each(AppFlow.TAB_JSON,function(tInd,tab){return $.each(tab.formArr,function(fInd,app){if(app.pcId==id)return returnKey.indexOf("tInd")>=0&&(returnVal.tInd=tInd),returnKey.indexOf("fInd")>=0&&(returnVal.fInd=fInd),returnKey.indexOf("tab")>=0&&(returnVal.tab=tab),returnVal.app=app,returnBool=!1}),returnBool}),returnVal},AppFlow.getServiceProp=function(formId){var serviceDtl={},service=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",Layout.CustomizedUrl.getServiceName(),!0),isEmpHealthFormAvailable="organization"==service.tabName.toLowerCase()&&service.hasOwnProperty("empHealthFormDetails");if(void 0!=service){serviceDtl.dispName=service.dispName;var params=[],formName="",formLabel="",isExtensionForm=!1;$.each(service.forms,function(i,form){form.isActive&&(params.push({id:form.pcId,value:form.dispName,label:form.label}),form.pcId===formId&&(formName=form.dispName,formLabel=form.label,isExtensionForm=form.isExtensionForm))}),isEmpHealthFormAvailable&&service.empHealthFormDetails.isActive&&(params.push({id:service.empHealthFormDetails.pcId,value:service.empHealthFormDetails.dispName,label:service.empHealthFormDetails.label}),service.empHealthFormDetails.pcId===formId&&(formName=service.empHealthFormDetails.dispName,formLabel=service.empHealthFormDetails.label)),serviceDtl.selectedFormName=formName,serviceDtl.selectedFormLabel=formLabel,serviceDtl.selectedFormId=formId,serviceDtl.isExtensionForm=isExtensionForm,serviceDtl.menuProperties={id:"appFlowFormList",data:params,callback:function(dataObj,sourceObj){var oldFormId=void 0!=Layout.Page.urlparam.formid?Layout.Page.urlparam.formid:Layout.Page.childUrlParam.formid,newFormId=$(dataObj).attr("id");oldFormId!==newFormId&&($(sourceObj).text($(dataObj).attr("name")),window.location.href=Layout.Page.hash.replace(oldFormId,newFormId))}}}return serviceDtl},AppFlow.redirectFlow=function(getThis){var keyName=$(getThis).attr("keyname"),value=ZPAppConstants[keyName],formId=Layout.Page.urlparam.formid;void 0==formId&&(formId=AutomationCommon.getFormId(!0)),window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(value,formId)},AppFlow.setFlow=function(data){ZPeople.isAdmin()||void 0!=AppFlow.fnsCount||(AppFlow.fnsCount=Object.keys(ZPeople.adminPerms).length);var hashUrlDtl=Layout.UrlConf.getHashDetails(),tltConf=ZPConf.isThirdLevelTabsEnabled(),index=ZPConf.getModulePrefixIndex(),wrapId=tltConf.isModuleConf||hashUrlDtl.moduleMode?ZPeople.Module.getModulePrefix(1):ZPeople.Module.getModulePrefix(index);!0===Layout.Page.moduleenabled&&(wrapId="home-"+wrapId),null!=hashUrlDtl.wrapId&&(wrapId=hashUrlDtl.wrapId);var contWrapId="zp-contwrap-"+wrapId,pageWrap=$("#page-wrapper").find("#"+contWrapId),url=window.location.href.split("/zp").pop(),formId=url.match(/[\d]+$/);!Layout.Page.container.attr("id").endsWith("formlinkname")||(formId=ZPUtil.Form_Link_Names.getFormLinkName(spliturl.pop().split(":").pop().trim(),!1));var serviceProp=AppFlow.getServiceProp(formId[0]),isCandidateForm=!1;if(-1!==url.indexOf("#onboarding/admin")&&formId[0]==serviceProp.menuProperties.data[0].id&&(isCandidateForm=!0),pageWrap.find("#"+Layout.Page.pageId+" #formFlow").length<=0){var formFlowDiv='<div class="apph-nav" id="formFlow"><div class="frmname" id="formname">';formFlowDiv+='<a class="sback" href = "'+Layout.CustomizedUrl.getNewCustomizedUrl("generalsettings")+'" >'+serviceProp.dispName+'</a><span class="IC-ar-rgt divider"></span><a class="chgfrm" id="dvfrmlisting"></a></div><div class="apph">',(ZPeople.isAdmin()||AppFlow.fnsCount>1||ZPServices.View.isServiceAdmin())&&$.each(ZPAppConstants,function(key,value){if(!ZPeople.isAdmin()&&!ZPServices.View.isServiceAdmin())if(void 0!=zpconst.ControlPanelFunctions[key]){if(!ZPeople.adminPerms.hasOwnProperty(zpconst.ControlPanelFunctions[key]))return!0}else if(!ZPeople.adminPerms.hasOwnProperty(zpconst.ControlPanelFunctions.automation))return!0;var activeClass="";-1!==url.indexOf(value)&&(activeClass="active"),"customize"==key&&(ZPeople.isDeptDesgRestricted&&("P_Department"==serviceProp.selectedFormLabel||"P_Designation"==serviceProp.selectedFormLabel)||serviceProp.isExtensionForm)||("approvals"==key||"permissions"==key)&&formId[0]==ZPeople.EMP_HEALTH_FORMID||(formFlowDiv+='<div class="col-xs-2 apph-step '+activeClass+'" keyname="'+key+'"><div class="text-center apph-stepnum"><a>'+ZPI18N.getString("zp."+key)+'</a></div><div class="progress"><div class="progress-bar"></div></div><a class="apph-dot"></a></div>')}),formFlowDiv+="</div></div>",pageWrap.find("#"+Layout.Page.pageId).prepend(formFlowDiv),isCandidateForm&&pageWrap.find("#"+Layout.Page.pageId).find('[keyname="approvals"]').hide(),pageWrap.find("[keyname] a").on("click",function(event){event.stopPropagation(),event.preventDefault(),AppFlow.redirectFlow(this.closest("[keyname]"))}),AppFlow.setFormFlowMenu(pageWrap,serviceProp,!0)}else isCandidateForm?pageWrap.find("#"+Layout.Page.pageId).find('[keyname="approvals"]').hide():pageWrap.find("#"+Layout.Page.pageId).find('[keyname="approvals"]').show(),AppFlow.setFormFlowMenu(pageWrap,serviceProp,"automation-workflow"===Layout.Page.pageId)},AppFlow.setFormFlowMenu=function(pageWrap,serviceProp,isSetDropDown){var formListing=pageWrap.find("#"+Layout.Page.pageId+" #formFlow #dvfrmlisting");if(formListing.attr("selectedIds",serviceProp.selectedFormId),formListing.text(ZPeople.decodeTxt(serviceProp.selectedFormName)),isSetDropDown){var url=window.location.href.split("/zp").pop(),isOnboardingSettings=-1!==url.indexOf("#onboarding/admin"),isApprovalPage=-1!==url.indexOf("automation/approval");isOnboardingSettings&&isApprovalPage&&(serviceProp.menuProperties.data=serviceProp.menuProperties.data.slice(1)),formListing.off("click").on("click",function(){var menuProp=serviceProp.menuProperties;if("organization"==Layout.CustomizedUrl.getServiceName()){var data=[];$.each(menuProp.data,function(key,obj){obj.id==ZPeople.EMP_HEALTH_FORMID&&(Layout.Page.pageId.includes("approval")||Layout.Page.pageId.includes("permissions"))||("P_Department"==obj.label||"P_Designation"==obj.label)&&ZPeople.isDeptDesgRestricted&&Layout.Page.pageId.includes("formedit")||data.push(obj)}),menuProp.data=data}$(this).zparrowmenu(menuProp)})}},AppFlow.findSubTab=function(formId){var subTabs=ZPTabs.getSubTabs()[0],formTab={};return $.each(subTabs,function(subInd,subTab){if(subTab.formId==formId)return formTab=subTab,!1}),formTab},AppFlow.changeForm=function(obj){var formid=$(obj).attr("formid"),url=window.location.href,flinkIndex=null;url.indexOf("formlinkname")>=0?(flinkIndex=url.indexOf("formlinkname"),formid="formid:"+formid):flinkIndex=url.match(/[\d]+$/).index,url=url.substring(0,flinkIndex)+formid;var tabid=$(obj).parents("[tabid]").attr("tabid");$("[id=dvfrmlstcontent],[id=formname]").find("[formid="+$(obj).attr("formid")+"]").addClass("sel"),$("[id=dvfrmlstcontent],[id=formname]").find("[tabid="+tabid+"]").addClass("active"),window.location.href=url},AppFlow.toggleActive=function(e,obj){"focus"==e.type?$(obj).parent("div").addClass("active"):$(obj).parent("div").removeClass("active")},AppFlow.iconsClassAdd=function(addFormSlider){addFormSlider.find("[prop=chooseColour],[prop=chooseIcon]").click(function(){"chooseIcon"==$(this).attr("prop")?(activeObj=$(this).parents("li"),selObj=$(this).parents("ul").siblings("#selectedIcon").find("b"),selClass=$(this).attr("class")):(activeObj=$(this),selObj=$(this).parent("ul").siblings("#selectedColour"),selClass="lnkcolor "+$(this).attr("class")),$(this).parents("ul").find("li").removeClass("active"),$(selObj).attr("class",selClass),$(activeObj).addClass("active")})};var appsCategoryCustom={url:"/getAppsWithCategory.zp",SINGLETABTEMPLATE:'<div class="col-md-12" name="$TABDIV$"><span class="rounded $NOMOVECLASS$">$COUNT$</span>$APPLI$</div>',TABNAMELI:'<li class="list-group-item active" name="tabNameLi"><div class="form-group M0">$ENABLEDISABLE$<div class="input-group"><b class="IC-move S14 $VISIBLE$" name="dragIcon"></b><span class="ZPbold">$TABNAME$</span>$EDITICON$</div></div></li>',SINGLEAPPLI:'<li class="list-group-item $CLASSES$" $OTHERPROPS$>$ENABLEDISABLE$<span class="IC-switch S14" name="dragIcon"></span>$APPNAME$</li>',SWITCH_TEMP:'<div class="dvswitch" name="forCustom">$DELETE$<div class="btnactive"><input id="sw_$CHECKBOXID$" name="enableDisableSwitch" $CHECKED$ onclick="$ENABLEDISABLEMETHOD$" class="cmn-toggle-small cmn-toggle-round-small" type="checkbox"><label for="sw_$CHECKBOXID$"></label></div></div>',DELETE_TEMP:'<a class="IC-delete S13 MR25 ZPtitle" name="deleteIcon" title="" data-original-title="Delete" onclick="$DELETEMETHOD$"></a>',init:function(){ZPeople.Request.send(tabAndFormsCustom.url,{method:"formsAndTabsPage"},appsCategoryCustom.getAppsCategoryCustomPage,"")},getAppsCategoryCustomPage:function(resultData){if(resultData.hasOwnProperty("tabList")){var a=appsCategoryCustom.Construct(resultData);$("#page-wrapper").append($(a)),Layout.Page.container.find("[prop=appCustomize]").append($(a).removeClass("DN")),Layout.Page.container.find("[prop=appCustomize] #zp_page_loading").hide(),appOperations.sortApps(),appOperations.emptyTabCheck()}else""!=resultData.msg.trim()&&ZPeople.Message.showFailureMsg(resultData.msg.trim())},Construct:function(resultData){var customizeDiv='<div class="frmsettings DN" name="customiseDiv">',rightDiv='<div class="col-md-6 PR0" name="tabColumn">';rightDiv+=appsCategoryCustom.addSelfService();var leftDiv='<div class="col-md-6 PL0" name="tabColumn">',switchInfo={};for(i=0;i<resultData.tabList.length;i++){var tabData=resultData.tabList[i],tabDiv=appsCategoryCustom.SINGLETABTEMPLATE;tabDiv=(tabDiv=(tabDiv=tabDiv.replace(/\$COUNT\$/g,i+2)).replace(/\$NOMOVECLASS\$/g,"")).replace(/\$TABDIV\$/g,"tabDiv");var tabChild='<ul class="list-group '+(tabData.isHidden?"disabled":"")+'" id="Tab_'+tabData.tabId+'" isLink="'+tabData.isLink+'">'+appsCategoryCustom.TABNAMELI;if(switchInfo={id:tabData.tabId,enableDisableMethod:"tabCustom.tabOperations(this,['custOperations','showhidetab'])"},!tabData.isCustom||tabData.formDetailsMap.length>0)for(tabData.isCustom||(tabChild+=appsCategoryCustom.addStaticApps(tabData.tabName)),appsInd=0;appsInd<tabData.formDetailsMap.length;appsInd++){var appData=tabData.formDetailsMap[appsInd],appLi=appsCategoryCustom.SINGLEAPPLI;appLi=appLi.replace(/\$APPNAME\$/g,'<a class="ulnk" href="#services/adminop/appslayout/formedit-formid:'+appData.formId+'">'+appData.formName+"</a>");var appClasses="",otherprops='form="'+appData.formId+'" id="'+appData.formId+'"  name="formLi" ',switchConstruct="";appswitchInfo={id:appData.formId,enableDisableMethod:"appOperations.postMethod(this,['formCustOperations','showhideform'])"},appData.isCustom&&(appswitchInfo.isDelete=!0,appswitchInfo.deleteMethod="appOperations.postMethod(this,['deleteForm'])"),(!appData.hasOwnProperty("tablename")||$.inArray(appData.tablename,["P_ClientDetails","P_TimesheetJobsList","P_TimesheetJob","P_Timesheet","P_EmployeeJobs"])<1)&&(appData.isHidden&&(appClasses+="disabled "),"P_Employee"==appData.tablename?(otherprops+="employeeForm="+!0,appClasses+="spnmov-item"):!appData.hasOwnProperty("tablename")||"P_EmployeeLeave"!=appData.tablename&&$.inArray(appData.componentName,["P_PerformanceAppraisal","P_SelfAppraisal","P_AppraiseeList","P_Goals","P_EmployeeSalary"])<0?(appClasses+="spnmov-item",switchConstruct=appsCategoryCustom.switchConstruction(appData,appswitchInfo)):appData.isHidden&&(switchConstruct=appsCategoryCustom.switchConstruction(appData,appswitchInfo))),tabChild+=appLi=(appLi=(appLi=appLi.replace(/\$OTHERPROPS\$/g,otherprops)).replace(/\$CLASSES\$/g,appClasses)).replace(/\$ENABLEDISABLE\$/g,switchConstruct)}tabChild=(tabChild=(tabChild=(tabChild=tabChild.replace(/\$ENABLEDISABLE\$/g,appsCategoryCustom.switchConstruction(tabData,switchInfo))).replace(/\$TABNAME\$/g,tabData.tabDisplayName)).replace(/\$VISIBLE\$/g,"")).replace(/\$EDITICON\$/g,'<i class="IC-pen" onclick="tabCustom.toggleEditMode(this);"></i><input type="text" class="form-control" style="display:none;" onblur="tabCustom.toggleEditMode(this);" onchange="tabCustom.tabOperations(this,[\'custOperations\',\'renameTab\']);" value="'+tabData.tabDisplayName+'"/>'),tabChild+="</ul>",tabDiv=tabDiv.replace(/\$APPLI\$/g,tabChild),i%2==1?rightDiv+=tabDiv:leftDiv+=tabDiv}return customizeDiv+=rightDiv+="</div>",customizeDiv+=leftDiv+="</div>",customizeDiv+="</div>"},addSelfService:function(){var selfService=appsCategoryCustom.SINGLETABTEMPLATE;selfService=(selfService=(selfService=selfService.replace(/\$COUNT\$/g,1)).replace(/\$NOMOVECLASS\$/g,"nomove")).replace(/\$TABDIV\$/g,"");var tabNameLi='<ul class="list-group">'+appsCategoryCustom.TABNAMELI;return tabNameLi=(tabNameLi=(tabNameLi=(tabNameLi=tabNameLi.replace(/\$ENABLEDISABLE\$/g,"")).replace(/\$TABNAME\$/g,"Self-service")).replace(/\$EDITICON\$/g,"")).replace(/\$VISIBLE\$/g,"invisible"),tabNameLi+=appsCategoryCustom.addStaticApps("Self-service"),tabNameLi+="</ul>",selfService=selfService.replace(/\$APPLI\$/g,tabNameLi)},addStaticApps:function(tabName){var staticAppsDiv="",appLi=appsCategoryCustom.SINGLEAPPLI;return appLi=(appLi=(appLi=(appLi=appLi.replace("$APPNAME$","<span>$APPNAME$</span>")).replace("$ENABLEDISABLE$","")).replace(/\$OTHERPROPS\$/g,'name="fixedLi"')).replace(/\$CLASSES\$/g,""),"Timetracker"==tabName?(staticAppsDiv=appLi.replace("$APPNAME$",ZPI18N.getString("zp.timelogs")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.projectsjobs")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.reports"))):"Leavetracker"==tabName?(staticAppsDiv=appLi.replace("$APPNAME$",ZPI18N.getString("zp.leaveview")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.reports")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.holidays"))):"Files"==tabName?(staticAppsDiv=appLi.replace("$APPNAME$",ZPI18N.getString("zp.companyfiles")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.hrfiles")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.settings"))):"Attendance"==tabName?(staticAppsDiv=appLi.replace("$APPNAME$",ZPI18N.getString("zp.entry")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.report")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.settings"))):"Self-service"==tabName?(staticAppsDiv=appLi.replace("$APPNAME$",ZPI18N.getString("zp.profile")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.feeds")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.goals")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.leave")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.relatedforms")),staticAppsDiv+=appLi.replace("$APPNAME$",ZPI18N.getString("zp.approvals"))):"Organization"==tabName&&(staticAppsDiv=appLi.replace("$APPNAME$",ZPI18N.getString("zp.announcements"))),staticAppsDiv},switchConstruction:function(tabData,switchInfo){var switchDiv=appsCategoryCustom.SWITCH_TEMP;switchDiv=(switchDiv=(switchDiv=switchDiv.replace(/\$CHECKBOXID\$/g,switchInfo.id)).replace(/\$CHECKED\$/g,tabData.isHidden?"":"checked")).replace(/\$ENABLEDISABLEMETHOD\$/g,switchInfo.enableDisableMethod);var delDiv="";return switchInfo.isDelete&&(delDiv=(delDiv=appsCategoryCustom.DELETE_TEMP).replace(/\$DELETEMETHOD\$/g,switchInfo.deleteMethod)),switchDiv=switchDiv.replace(/\$DELETE\$/g,delDiv)}};appOperations={},appOperations.postMethod=function(obj,mode){var url="/formOperations.zp",params={method:mode[0]};$(obj).parents("li[form]").length>0&&(params.formid=$(obj).parents("li[form]").attr("form").toString());var others={obj:obj},callback="";if("formCustOperations"==mode[0])params.formid=$(obj).parents("li").attr("form").toString(),url="/"+mode[0]+".zp",params.mode=mode[1],"showhideform"==mode[1]&&(params.hidden=!$(obj).is(":checked"),callback=appOperations.enableDisableForm);else if("deleteForm"==mode[0])return params.formid=$(obj).parents("li").attr("form").toString(),tabCustom.param=[url,params,appOperations.deleteApp,others],ZPeople.confirm(null,"",ZPI18N.getString("zp.fielddeletemsg",["the form"])+" "+ZPI18N.getString("zp.deleteconfirm"),tabCustom.deleteRequest,!1,!0),$(obj).parents(".popover").popover("hide"),void $("body").find("#poverBgDiv").remove();ZPeople.Request.send(url,params,callback,others,formCustom.failureCallBack)},appOperations.enableDisableForm=function(data,params,others){if(data.isLookup){var msg=ZPI18N.getString("zp.referredfieldserror",["form","disable","form"])+"\n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n',$.each(data,function(key,val){"isLookup"!=key&&(msg+="{"+key+" -> "+val+"}\n")}),ZPeople.confirm(null,"",msg,"",!0,!0),$("#textConfirmationPopupBody p").first().addClass("pspace"),$(others.obj).attr("checked",!0)}else if("Success"==data.msg.trim()){var formName=$(others.obj).parents("li").find("a").text();params.hidden?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablesuccessful"),!0),appOperations.dvfrmlstcontentEntry(params.formid,!0,!1,params.tabId),$(others.obj).attr("checked",!1),$(others.obj).parents("li").addClass("disabled"),Layout.Page.container.parent("div[id*=zp-contwrap]").find("#dvaddform [keyname=selformId] option[value="+params.formid+"]").remove()):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enablesuccessful")),$(others.obj).attr("checked",!0),$(others.obj).parents("li").removeClass("disabled"),appOperations.dvfrmlstcontentEntry(params.formid,!0,!0,params.tabId),Layout.Page.container.parent("div[id*=zp-contwrap]").find("#dvaddform [keyname=selformId]").append("<option value="+params.formid+">"+formName+"</option>"))}else""!=data.msg.trim()&&(ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0),$(others.obj).prop("checked",!$(others.obj).is(":checked")))},appOperations.deleteApp=function(data,params,others){if(data.isLookup){var msg=ZPI18N.getString("zp.referredfieldserror",["form","delete","form"])+" \n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n',$.each(data,function(key,val){"isLookup"!=key&&(msg+="{"+key+" -> "+val+"}\n")}),setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},800),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},900),$("#textConfirmationPopupBody p").first().addClass("pspace")}else if("Success"==data.msg.trim()){if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.deletesuccessful")),$("#formsListingHeader").length>0&&0==$("tr[id="+params.formid+"]").siblings("tr").length){var id=$("tr[id="+params.formid+"]").parent("[id*=tabSpecificForms_]").attr("id").match(/[\d]+$/).toString();$("#formsListingHeader #tabNameList").val()==id&&($("#formsListingHeader #tabNameList").val(0).change(),$("#formsListingHeader #tabNameList").select2()),$("[id=tabSpecificForms_"+id+"], #tabNameList option[value="+id+"]").remove()}$("[id="+params.formid+"]").remove(),$("#formsCount").show().siblings("#totalForms").hide(),$("#admin-appslayout-formedit-"+params.formId).remove(),Layout.Page.container.parent("div[id*=zp-contwrap]").find("#dvaddform [keyname=selformId] option[value="+data.formId+"]").remove(),appOperations.dvfrmlstcontentEntry(params.formid,!0,!1),appOperations.emptyTabCheck(),AppsCustom.hasOwnProperty("appCount")&&++AppsCustom.appCount,AccessControl.Permissions.remove()}else""!=data.msg.trim()&&setTimeout(function(){ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0)},1e3)},appOperations.sortApps=function(){var parent=$("[id*=services-adminop-appslayout-appslist-]:visible").find("[prop=appCustomize]"),formDiv=$(parent).find("[name=tabDiv] ul[id*=Tab_]"),isSorted=!1;$(parent).find("[name=tabColumn]").sortable({items:"[name=tabDiv]",handle:$(parent).find("[name=dragIcon]"),connectWith:"[name=tabColumn]",placeholder:"col-md-12 placeholder",start:function(){isSorted=!1},update:function(){var $sortable=$(this);if(!isSorted){var tabIds=[],obj=$(parent).find("[name=customiseDiv] [name=tabDiv] span.rounded");appOperations.tabNumberUpdate(),obj.each(function(){var txt=parseInt($(this).html());tabIds[txt-2]=$(this).siblings("ul").attr("id").match(/[\d]+$/).toString()});var params={tabIds:tabIds.toString(),method:"reorderTab"};ZPeople.Request.send("/tabOperations.zp",params,appOperations.updateSort,{obj:$sortable,isTab:!0},formCustom.failureCallBack)}isSorted=!0}}),$(formDiv).sortable({handle:$(formDiv).find("li[name=formLi] [name=dragIcon]"),items:"li[name=formLi]",connectWith:"ul[id*=Tab_][isLink=false]",placeholder:"filedplace",start:function(event,ui){isSorted=!1},update:function(event,ui){var sortableItem=$(this);if(!isSorted){$(ui.item).siblings("[name=dummy]").hide();$(ui.item).attr("id");var parentUl=$(ui.item).parent("ul"),formIds="";$(parentUl).find("li[name=formLi]").each(function(){formIds+=$(this).attr("id")+","});var params={parenttabid:$(parentUl).attr("id").match(/[\d]+$/).toString(),formIds:formIds,mode:"reorderform",method:"formCustOperations"};ZPeople.Request.send("/formCustOperations.zp",params,appOperations.updateSort,{obj:sortableItem,isTab:!1},formCustom.failureCallBack)}isSorted=!0}})},appOperations.updateSort=function(data,params,others){"success"==data.msg.trim()?(others.iTab||(appOperations.emptyTabCheck(),$("zp_hometabs").attr("isloaded",!1)),AppFlow.setDeleteOnCloseId=window.location.href.split("services/adminop/appslayout/appslist-").pop().toString(),$("[id*=services-adminop-appslayout-appslist-]").not("#services-adminop-appslayout-appslist-"+AppFlow.setDeleteOnCloseId).remove(),delete AppFlow.TAB_JSON,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))):""!=data.msg.trim()&&(others.obj.sortable("cancel"),others.isTab&&appOperations.tabNumberUpdate(),ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0))},appOperations.emptyTabCheck=function(){$("[name=customiseDiv] li[name=dummy]").fadeOut("fast"),$("[name=customiseDiv] [name=tabNameLi] a[name=deleteIcon]").fadeOut("fast"),$("ul[id*=Tab_][isLink=false]").each(function(){0==$(this).find("li[name=formLi]").length&&0==$(this).find("li[name=fixedLi]").length&&($('<a class="IC-delete S13 MR25 ZPtitle" name="deleteIcon" title="" data-original-title="Delete" onclick="tabCustom.tabOperations(this,[\'deleteTab\'])"></a>').insertBefore($(this).find("[name=tabNameLi] [name=forCustom]").children("div")),$(this).append(appOperations.emptyTabDiv()))}),tabCustom.columnHeightAdjust()},appOperations.tabNumberUpdate=function(){var cnt=3,colDiv=$("[name=customiseDiv]").find("[name=tabColumn]"),length1=$(colDiv).first().find("[name=tabDiv]").length,length2=$(colDiv).last().find("[name=tabDiv]").length,commonLength=length1<length2?length1:length2;$(colDiv).each(function(index,parent){var length=$(parent).find("[name=tabDiv]").length;$(parent).find("[name=tabDiv]").each(function(index,element){$(element).find("span.rounded").text(cnt),index<commonLength-1?cnt++:index==commonLength-1&&(cnt=2*commonLength+2),cnt++,index==length-1&&(cnt=2)})})},appOperations.emptyTabDiv=function(){var emptytabdiv='<li class="list-group-item text-center" name="dummy">';return emptytabdiv+='<div class="P20 PB10">',emptytabdiv+="<p>"+ZPI18N.getString("zp.noformsintabalert")+"</p>",emptytabdiv+='<div class="btn btn-default MT5" onclick="AppsCustom.addNewApp(this);">'+ZPI18N.getString("zp.addnewform")+"</div>",emptytabdiv+="</div></li>"},appOperations.dvfrmlstcontentEntry=function(id,isform,isadd,tabid){if(AppFlow.setDeleteOnCloseId=window.location.href.split("appslist-").pop().toString(),isadd){if(isform){if($("#dvfrmlstcontent").length>0)if($("#dvfrmlstcontent").find("div#dv"+tabid).length>0){var formname=Layout.Page.container.parent("div[id*=zp-contwrap]").find("[id=appName_"+id+"]").text();$("#dvfrmlstcontent").find("div#dv"+tabid+" ul").append(jQuery("<li />").append(jQuery("<a />",{href:"#services/adminop/appslayout/formedit-formid:"+id,text:formname})))}else $("body").find("#dvfrmlstcontent").remove();void 0!=tabid?($("[id*=services-adminop-appslayout-appslist-]").remove(),delete AppFlow.setDeleteOnCloseId,$("[name=customiseDiv]").remove()):$("[id*=services-adminop-appslayout-appslist-]").not("#services-adminop-appslayout-appslist-"+AppFlow.setDeleteOnCloseId).remove(),delete AppFlow.TAB_JSON}}else{if(void 0!=AppFlow.TAB_JSON){var indexDtls=isform?AppFlow.findAppIndex(id,"tIndfIndtab"):$("li#"+id).index();!isform&&$("li#"+id).parents("#moreIcon").length>0?indexDtls+=7:isform||(indexDtls-=2)}if(isform){if($("#dvfrmlstcontent").length>0){var formEntry=$("#dvfrmlstcontent").find('a[href="#services/adminop/appslayout/formedit-formid:'+id+'"]').parent("li");1==$(formEntry).parent("ul").find("li").length?(tabdvId=$(formEntry).parents("[tabid]").attr("id"),$("#dvfrmlstcontent").find("a[href=#"+tabdvId+"]").parent("li").remove(),$(formEntry).parents("div#"+tabdvId).remove()):$(formEntry).remove()}void 0!=indexDtls&&(indexDtls.tab.formArr.length>1?(AppFlow.TAB_JSON[indexDtls.tInd].formArr.splice([indexDtls.fInd],1),$("[form="+id+"]").not(":visible").remove(),$("#services-listview-formId-"+indexDtls.app.pcId).remove(),delete ZPView.LIST_VIEW_PARAMS["apps_listview_"+indexDtls.app.pcId]):(AppFlow.TAB_JSON.splice([indexDtls.tInd],1),$("#services-adminop-appslayout-appslist-"+tabid+",#services-adminop-appslayout-appslist-all").not("#services-adminop-appslayout-appslist-"+AppFlow.setDeleteOnCloseId).remove(),AppFlow.setDeleteOnCloseId!=indexDtls.tab.tabId&&(delete AppFlow.setDeleteOnCloseId,$("#"+indexDtls.tab.tabId).remove(),$("li[tab="+indexDtls.tab.tabId+"]").remove()),$.each(indexDtls.tab.formArr,function(fInd,app){$("#services-listview-formId-"+app.pcId).remove(),delete ZPView.LIST_VIEW_PARAMS["apps_listview_"+app.pcId]})))}else if($("#dvfrmlstcontent").length>0&&($("#dvfrmlstcontent").find("a[href=#dv"+id+"]").parent("li").remove(),$("#dvfrmlstcontent").find("div#dv"+id).remove()),indexDtls>=0){$("li[tab="+id+"]").remove(),$("[id="+id+"]").remove(),$("[id*=services-adminop-appslayout-appslist-]").not("#services-adminop-appslayout-appslist-"+AppFlow.setDeleteOnCloseId).remove(),AppFlow.setDeleteOnCloseId!=id&&delete AppFlow.setDeleteOnCloseId;var formArr=AppFlow.TAB_JSON[indexDtls].formArr;$.each(formArr,function(fInd,app){$("#services-listview-formId-"+app.pcId).remove(),delete ZPView.LIST_VIEW_PARAMS["apps_listview_"+app.pcId]}),AppFlow.TAB_JSON.splice(indexDtls,1)}}};var ZPAdminForm={formListConstruction:function(data,id,mode,currentFormId){var mainDiv=jQuery("<div />",{class:"DN",role:"menu",id:id}).append(jQuery("<div />",{class:"tabvertical"}).append(jQuery("<div />",{class:"lfttab",name:"leftTab"}).append(jQuery("<ul />",{class:"nav nav-pills nav-stacked PT10 PB10",role:"tablist"}))).append(jQuery("<div />",{class:"rhtlstsrl",name:"rightTab"}).append(jQuery("<div />",{class:"tab-content PT10 PB10",name:"rightTabDiv"}))));return $.each(data,function(i,item){if("formcustomization"!==mode||!item.isExtensionTab){$(mainDiv).find("div[name=leftTab] ul").append(jQuery("<li />",{role:"presentation",tabId:item.tabId}).append(jQuery("<a />",{href:"#dv"+item.tabId,role:"tab","data-toggle":"tab"}).append(item.tabDisplayName))),$(mainDiv).find("div[name=rightTab] div[name=rightTabDiv]").append(jQuery("<div />",{role:"tabpanel",class:"tab-pane",id:"dv"+item.tabId,tabId:item.tabId}).append(jQuery("<ul />",{class:"rhttablst"})));var formjson=item.formDetailsMap;$.each(formjson,function(j,formItem){if(!("formembed"!==mode&&ZPeople.isDeptDesgRestricted&&("P_Department"==formItem.componentName||"P_Designation"==formItem.componentName)||"formcustomization"===mode&&formItem.isExtensionForm)){var func="formembed"===mode?"Embed.constructAndSetDigest(this,'"+item.tabId+"')":"",anchorTag=jQuery("<a />",{onclick:func,formId:formItem.formId,name:"forms"}).append(formItem.formName),selClass="";"formcustomization"===mode&&anchorTag.attr("href","#admin/formslayout/formedit-"+formItem.formId),currentFormId==formItem.formId&&($(mainDiv).find('div[name=leftTab] a[href="#dv'+item.tabId+'"]').parent("li").addClass("active"),$(mainDiv).find("div[name=rightTab] div#dv"+item.tabId).addClass("active"),selClass="sel"),$(mainDiv).find("div[name=rightTab] div#dv"+item.tabId).find("ul").append(jQuery("<li />",{class:selClass}).append(anchorTag))}})}}),mainDiv}},fieldType={SINGLELINE:1,EMAIL:4,NUMBER:5,FORMULA:15,FILE_UPLOAD:18,DECIMAL:19,PICKLIST:25,LOOKUP:26,AUTONUMBER:30,IMPORTDATA:104,RADIO:101,CHECKBOXES:103,AADHAAR_NUMBER:36,UAN_NUMBER:38,SOCIAL_SECURITY_NUMBER:39},stringField={FORMULA:"15",PLAINTEXT:"14",LOOKUP:"104",DECISIONBOX:"9",FILEUPLOAD:"18",IMAGE:"20",RADIO:"101",LIST:"102",CHECKBOXES:"103",PICK_LIST:"100",DATE:"10",DATE_TIME:"22",PAN_NUMBER:"35"},formCustom={popupFieldTemplate:'<div class="col-md-10"><div class="form-group" $ERRORCLASS$ id="$PURPOSE$" name="propertyDiv"><label>$FIELDNAME$</label><input type="text" class="form-control" keyname="$PURPOSE$"></div></div>',loadingDiv:'<div class="ctable" id="zp_page_loading"><div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div></div>',singleformLayout:"admin-formslayout-formedit-",customValidation:{},dragAndDropFld:function(){Layout.Page.container.not("#addFields").find("[isTooltip=true]").not("[data-original-title]").tooltip({placement:"bottom"}),formCustom.fieldOnClick(),Layout.Page.container.find("div[name=formcomponentDiv][type="+fieldType.AUTONUMBER+"]").on("click",function(e){formCustom.openTab("#formProperties")}),formCustom.emptySectionCheck();var colDiv=Layout.Page.container.find("[tabtype=normal]:visible");Layout.Page.container.find("#ulul li a").draggable({connectToSortable:$(colDiv),helper:"clone",connectWith:Layout.Page.container.find("#mainDiv"),appendTo:"body",start:function(event,ui){$(ui.helper).addClass("dvgroupfield draging"),!0}}),$(colDiv).sortable({cancel:"[id=emptySectionMsg]",connectWith:$(colDiv),placeholder:"dvgroupfield active",scroll:!0,scrollSensitivity:10,scrollSpeed:10,containment:Layout.Page.container.find("#mainDiv"),appendTo:"#mainDiv",update:function(event,ui){ui.item.index();var element=ui.item,tabularFormId=Layout.Page.container.attr("id").match(/[\d]+$/).toString();if(0!=$(element).closest("a").length){element=Layout.Page.container.find("#mainDiv a[zptitle]");var fieldType=$(element).attr("typeid"),fieldname=formCustom.fieldTypeCount(fieldType,$(element).attr("zptitle")),labelName=/^[\W]*$/.test(fieldname)?$(element).attr("label"):fieldname.replace(/\s|\W|-/g,"_").replace(/_+/g,"_");labelName=/[a-zA-Z]+/g.test(labelName)?labelName:$(element).attr("label");var adding="<div class='dvgroupfield loading' name='adding"+fieldType+"' id='adding"+fieldType+"'><label class='MT15'>Adding ...</label></div>";$(element).replaceWith(adding),element=$("#adding"+fieldType+":visible").first();var div=$(this).parents("[name=sectionMain]");if(null!=$(div).find("[name=sectionDiv]").attr("tabformid")&&25==$(div).find("[div=fielddiv]").length)ZPeople.confirm(null,"","zp.tabularsectionmaximumfields","",!0),$(element).remove();else if(null!=$(div).find("[name=sectionDiv]").attr("tabformid")&&$.inArray(fieldType,[stringField.DECISIONBOX,stringField.PLAINTEXT,stringField.RADIO,stringField.LIST])>-1)$(element).remove(),ZPeople.confirm(null,"","zp.cannotaddthesefieldtypesintabsectionerror","",!0);else{null!=$(div).find("[name=sectionDiv]").attr("tabformid")&&(tabularFormId=$(div).find("[name=sectionDiv]").attr("tabformid"));var beforeDiv=$(element).next("[name=formcomponentDiv]"),beforeFcId="-1";$(beforeDiv).length>0&&(beforeFcId=$(beforeDiv).find("label").attr("id").match(/[\d]+$/).toString());var dispCol=$(this).attr("dispcol"),secId=$(this).attr("secid"),params={beforeFcid:beforeFcId,displaycolumn:dispCol,baseformid:Layout.Page.container.attr("id").match(/[\d]+$/).toString(),formid:tabularFormId,sectionId:secId,fieldtype:fieldType,isupdate:"false"};fieldType==stringField.FORMULA?formCustom.fieldAction(null,["getformulafields",params,params.formid]):fieldType==stringField.LOOKUP?formCustom.fieldAction(null,["fetchlookupfields",params,params.baseformid]):fieldType==stringField.PLAINTEXT?formCustom.addNotesPopup(params,params.formid):formCustom.otherFieldsPopup(params,fieldname,fieldType,labelName)}}else $(this)[0]==$(element).parents("[tabtype=normal]")[0]&&(formCustom.reorderFields(this,ui),formCustom.emptySectionCheck())}})},loadFieldProperties:function(data,params,others){var obj=others.obj;if(others.hasOwnProperty("forPost")){Layout.Page.container.find("[name=formcomponentDiv]").removeClass("active"),Layout.Page.container.find("[name=tabularFld]").removeClass("active"),$(obj).addClass("active");params={fcid:$(obj).hasClass("fieldsec")?$(obj).find("[name=fieldname]").attr("id").match(/[\d]+$/).toString():$(obj).find("label").attr("id").match(/[\d]+$/).toString(),mode:"properties"};delete others.forPost,0==Layout.Page.container.find("#fieldProperties").siblings("#zp_page_loading").length?$(formCustom.loadingDiv).insertBefore(Layout.Page.container.find("#formProperties")):Layout.Page.container.find("#fieldProperties").siblings("#zp_page_loading").show(),others.toBeClicked&&(Layout.Page.container.find("#formPropertiesTab,#formProperties").removeClass("active"),Layout.Page.container.find("#fieldPropertiesTab,#fieldProperties").addClass("active")),ZPeople.Request.send("/fieldActions.zp",params,formCustom.loadFieldProperties,others,formCustom.failureCallBack)}else if(""!=data.trim()){if(Layout.Page.container.find("#fieldProperties").siblings("#zp_page_loading").remove(),$(data).has("#EmpSts").length?(Layout.Page.container.append(data).fadeIn("slow"),formCustom.onloadEmpSts()):$(data).has("#EmpHealthSts").length?Layout.Page.container.append(data).fadeIn("slow"):Layout.Page.container.find("#fieldProperties").html(data).fadeIn("slow"),Layout.Page.container.find("#fieldProperties input").first().trigger("select"),formCustom.select2ForSelectBox(Layout.Page.container.find("#fieldProperties:visible")),Layout.Page.container.find("#fieldProperties").attr("currentfcid",params.fcid),Layout.Page.container.find("#fieldProperties").attr("tabformid",others.tabularFormId),others.toBeClicked&&$(data).has("#EmpHealthSts").length<=0&&Layout.Page.container.find("#fieldPropertiesTab a").trigger("click"),$(data).find("#notesdiv").length>0)Layout.Page.container.find("#fieldProperties").attr("fcType",stringField.PLAINTEXT);else{var type=$(data).find("#fields").val();$.inArray(type,[stringField.LIST,stringField.CHECKBOXES,stringField.PICK_LIST,stringField.RADIO])>-1&&(type=fieldType.PICKLIST),Layout.Page.container.find("#fieldProperties #decvalue").length>0&&Layout.Page.container.find("#fieldProperties #initvalue").val(Layout.Page.container.find("#fieldProperties #initvalue").attr("value")),Layout.Page.container.find("#fieldProperties").attr("fcType",type)}Layout.Page.container.find("[istootltip=true]").tooltip(),formCustom.spinnerJs(),type==fieldType.PICKLIST&&formCustom.optionsSort()}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},reorderFields:function(curDiv,ui){var div=$(curDiv).parents("[name=sectionMain]"),secId=$(div).find("[name=sectionDiv]").attr("secId"),secLftRightCols=div.find("[tabtype=normal]"),secIdStr=secId+"_",SecStr="";$(secLftRightCols).each(function(){var fieldDivs=$(this).children("div[name=formcomponentDiv]"),dispCol=$(this).attr("dispCol");$(fieldDivs).each(function(){SecStr+=secIdStr;var fcId=$(this).find("label").attr("id").match(/[\d]+$/);SecStr+=fcId=fcId+":"+dispCol+","})});var params={seq:SecStr=SecStr.substring(0,SecStr.length-1),fid:Layout.Page.container.attr("id").match(/[\d]+$/).toString(),mode:"reorderfields"};ZPeople.Request.send("fieldActions.zp",params,formCustom.responseHandling,{ui:ui,url:"setSeq"},formCustom.failureCallBack)},updFieldPost:function(data,param,others){var params=others.params,updateObj=others.obj;if("true"==params.isupdate){var updateDiv=Layout.Page.container.find("#mainDiv [id*="+params.fcid+"]");if("Success"==data.msg.trim()){var formId=Layout.Page.container.attr("formId");if(void 0!=ZPForm.FORM_DETAILS[formId]&&(ZPForm.FORM_DETAILS[formId].refreshStatus=!0),void 0!=data.sampleCurrencyValueFormat)if(Layout.Page.container.find("#sampleVal_"+params.fcid).closest("[name='formcomponentDiv']").attr("type")==ZPForm.Field.CURRENCY){var currencyCode=(Currencytext=Layout.Page.container.find("#sampleVal_"+params.fcid).html()).substring(0,3);Layout.Page.container.find("#sampleVal_"+params.fcid).html(currencyCode+" "+data.sampleCurrencyValueFormat)}else Layout.Page.container.find("#sampleVal_"+params.fcid).html(data.sampleCurrencyValueFormat);if(params.hasOwnProperty("pickListOptions")&&params.pickListOptions.hasOwnProperty("bulkOptions")||($(updateObj).parents("#choiceParent").length>0||$(updateObj).parent("#dtype").length>0)&&data.hasOwnProperty("fieldDtls")){fieldDtls=data.fieldDtls;var jsonOptions=fieldDtls.UerDefOptions;if(params.hasOwnProperty("pickListOptions")&&params.pickListOptions.hasOwnProperty("bulkOptions")){var seqNo=0;""==(seqNo=Layout.Page.container.find("#fieldProperties #choiceParent [name=choiceDiv]").last().attr("seq"))&&(seqNo=Layout.Page.container.find("#fieldProperties #choiceParent [name=choiceDiv]").last().prev().attr("seq")),seqNo<2&&($(updateDiv).siblings("#picklist").remove(),$(updateDiv).parent("[name=formcomponentDiv]").append(formCustom.picklistConstruction(fieldDtls,updateObj))),$.each(jsonOptions,function(key,value){if(value.seqNo>seqNo){var cloneObj=Layout.Page.container.find("#fieldProperties #choiceParent [name=choiceDiv]").last().clone(),cloneInp=cloneObj.find("input").not('[keyname="code"]');$(cloneObj).attr("seq",value.seqNo),$(cloneInp).attr({id:value.optId,savedvalue:ZPeople.decodeTxt(value.optval),value:ZPeople.decodeTxt(value.optval)}),$(cloneObj).attr({optid:value.optId}),cloneObj.find('input[keyname="code"]').attr({savedvalue:"",value:""}).val(""),$("#fieldProperties #EmpSts").length>0&&Layout.Page.container.find("#fieldProperties #EmpSts").hasClass("in")&&$(cloneObj).find("input[type=radio]").attr("name",value.optId),$("#fieldProperties #EmpHealthSts").length>0&&Layout.Page.container.find("#fieldProperties #EmpHealthSts").hasClass("in")&&$(cloneObj).find("input[type=radio]").attr("name",value.optId),$(cloneInp).val(ZPeople.decodeTxt(value.optval)),$(cloneObj).find("[name=initialvalue]").prop("checked",!1),$(cloneObj).find("[name=deleteOption]").off(),$(cloneObj).find("[name=deleteOption]").on("click",function(){tabAndFormsCustom.forSaveForm.isChange?tabAndFormsCustom.forSaveForm.isClick=!0:formCustom.choiceActions("remove",this)}),Layout.Page.container.find("#fieldProperties #choiceParent").append(cloneObj)}}),formCustom.optionsSort()}else{var val=$(updateObj).is("input,select")?$(updateObj).val():$(updateObj).find("input select").val();if(params.hasOwnProperty("initialvalue"))"on"==$(updateObj).attr("savedvalue")?($(updateObj).attr("savedvalue","off"),$(updateObj).prop("checked",!1)):($(updateObj).attr("savedvalue",val),$(updateObj).prop("checked",!0),$(updateObj).parents(".input-group").siblings().find("[savedvalue=on]").attr("savedvalue","off"));else $(updateObj).attr("savedvalue",val);$(updateObj).parents("[name=choiceDiv]").find("input[type=radio][status=Active],input[type=radio][status=Inactive]").prop("disabled",!1),($(updateObj).parents("#choiceParent").length>0||$.inArray($(updateObj).attr("keyname"),["lookupdisplaytype","disptype"])>-1)&&($(updateObj).siblings("div[deletefield]").remove(),$(updateObj).parents("#choiceParent").find("[name=choiceDiv]").each(function(index){""!=$(this).attr("seq")&&$(this).attr("seq",index+1)}),param.isGrid?$(updateDiv).siblings("div").html(formCustom.picklistConstruction(fieldDtls,updateObj)):($(updateDiv).siblings("#picklist").remove(),$(updateDiv).parent("[name=formcomponentDiv]").append(formCustom.picklistConstruction(fieldDtls,updateObj)))),params.hasOwnProperty("disptype")&&Layout.Page.container.find("#fieldProperties [keyname=fieldtype]").select2("val",params.disptype),tabAndFormsCustom.forSaveForm.isClick&&formCustom.choiceActions("remove",$(updateObj).find("[name=deleteOption]"))}ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),formCustom.removeZPFormFormComponentData("form")}else{var changeoptions={};if(data.hasOwnProperty("displayname")){if(param.isGrid)$(updateDiv).find("label").text(data.displayname);else{$(updateDiv).text(data.displayname);var formid=Layout.Page.container.attr("formId");formCustom.loadUniqFields(formid)}changeoptions.displayName=data.displayname}if(params.hasOwnProperty("isPrimary")){$(updateObj).prop("disabled",!0);var prevPrimary=Layout.Page.container.find("[isprimary=true]");Layout.Page.container.find("[isprimary=true]").attr("isprimary",!1),prevPrimary.find('[name="permOpt"]').show(),prevPrimary.children("label").children("span").remove(),$(updateDiv).parent().attr("isprimary",!0),$(updateDiv).parent().find('[name="permOpt"]').hide(),$(updateDiv).append('<span class="IC-key ML5 ZPtooltip-lftnav" data-placement="bottom" title="'+ZPI18N.getString("zp.primaryLookup")+'" iskey="true"> </span>'),$(updateDiv).find("span[iskey='true']").tooltip(),changeoptions.isPrimary=params.isPrimary,formCustom.loadFieldProperties("",{},{forPost:!0,obj:Layout.Page.container.find("[name=formcomponentDiv].active")})}else if(params.hasOwnProperty("ismandatory"))$(updateDiv).parent().attr("ismand",params.ismandatory),"true"==params.ismandatory?$(updateDiv).addClass("zp_mdt"):$(updateDiv).removeClass("zp_mdt"),changeoptions.isMandatory="true"==params.ismandatory;else if(params.hasOwnProperty("initialvalue")||params.hasOwnProperty("autofill")){var iniVal=data.hasOwnProperty("initialvalue")?data.initialvalue:params.hasOwnProperty("initialvalue")?params.initialvalue:"";changeoptions.autofillvalue=iniVal}else if(params.hasOwnProperty("currencyType")){if(params.isGrid||0==$(updateDiv).siblings("input").length)$(updateDiv).siblings("div").find("span").text(data.currency);else{var Currencytext,currencyFormat=(Currencytext=Layout.Page.container.find("#sampleVal_"+params.fcid).html()).substring(3,Currencytext.length);Layout.Page.container.find("#sampleVal_"+params.fcid).html(data.currency+" "+currencyFormat)}changeoptions.currencyType=params.currencyType}else(params.hasOwnProperty("enablepersonaldata")||params.hasOwnProperty("enableephidata"))&&(params.hasOwnProperty("enablepersonaldata")&&"true"==params.enablepersonaldata||params.hasOwnProperty("enableephidata")&&"true"==params.enableephidata?($(updateObj).closest(".section").find('[keyname="enableencrypt"]').prop("checked",!0),$(updateObj).closest(".section").find('[keyname="enableencrypt"]').prop("disabled",!0),$(updateObj).closest(".section").find('[keyname="enableaudit"]').prop("checked",!0),$(updateObj).closest(".section").find('[keyname="enableaudit"]').prop("disabled",!0)):$(updateObj).closest(".section").find('[keyname="enablepersonaldata"]').is(":checked")||$(updateObj).closest(".section").find('[keyname="enableephidata"]').is(":checked")||($(updateObj).closest(".section").find('[keyname="enableencrypt"]').prop("disabled",!1),$(updateObj).closest(".section").find('[keyname="enableaudit"]').prop("disabled",!1)));if(params.hasOwnProperty("formula")){formId=Layout.Page.container.attr("formId");0!=$("body").find("script[id="+formId+"]").length&&$("body").find("script[id="+formId+"]").remove(),Layout.Page.container.find(".modal").modal("hide"),$("[currentfcid="+params.fcid+"]").find("[keyname=displayname]").val(params.displayname),$("[currentfcid="+params.fcid+"]").find("[keyname=formula]").text(params.formula)}else if(params.hasOwnProperty("plainTextvalue")){var htmlObj=params.plainTextvalue;htmlObj=formCustom.addClass(htmlObj),$(updateDiv).next("div").html(htmlObj.clone()),Layout.Page.container.find("#fieldProperties").find("div[keyname=plainTextvalue]").html(htmlObj),changeoptions.autofillvalue=params.plainTextvalue}else if(params.hasOwnProperty("lookupFlds")){updateObj="addfield"!==$(updateObj).attr("name")?$(updateObj).parents("[name=addfield]"):$(updateObj);var lookupFlds=params.lookupFlds;if(lookupFlds.hasOwnProperty("optionId")&&lookupFlds.hasOwnProperty("dispFcid")&&lookupFlds.hasOwnProperty("seqNo")&&!lookupFlds.hasOwnProperty("separator")){var choiceObj=updateObj;updateObj=1==lookupFlds.seqNo?$(choiceObj).next():$(choiceObj).prev(),$(choiceObj).remove()}if(""===$(updateObj).attr("seq").trim()){seqNo=parseInt($(updateObj).prev("[name=addfield]").attr("seq"));$(updateObj).attr("seq",++seqNo)}else{var seq=1,addFields=Layout.Page.container.find("#fieldProperties #displayFields").find("[name=addfield]").not('[seq=""]');$(addFields).each(function(){$(this).attr("seq",seq++)})}tabAndFormsCustom.forSaveForm.isClick&&formCustom.choiceActions("remove",$(updateObj).find("[name=deleteOption]"))}else if(params.hasOwnProperty("childName")){var changedChildName=params.childName;void 0!=$(updateDiv).parent().find("#"+params.childFcid).attr("placeholder")?$(updateDiv).parent().find("#"+params.childFcid).attr("placeholder",changedChildName):$(updateDiv).parent().find("#"+params.childFcid).attr("value",changedChildName)}else params.hasOwnProperty("displayname")&&(formCustom.customValidation[formId].refresh=!0);val=$(updateObj).val();$(updateObj).attr("savedvalue",val),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),jQuery.isEmptyObject(changeoptions)?formCustom.removeZPFormFormComponentData("form"):formCustom.removeZPFormFormComponentData("field",params.fcid,changeoptions)}}else{if("checkbox"==$(updateObj).attr("type"))$(updateObj).prop("checked",!$(updateObj).is(":checked"));else if($(updateObj).is("select"))$(updateObj).select2();else{val=void 0!=$(updateObj).attr("savedvalue")?$(updateObj).attr("savedvalue"):"";$(updateObj).val(val).trigger("blur"),Layout.Page.container.find('#fieldProperties #choiceParent [seq=""]').length>1&&""==$(updateObj).attr("savedvalue").trim()&&$(updateObj).parents("[name=choiceDiv]").remove(),params.hasOwnProperty("displayname")&&"displayname"==$(updateObj).attr("keyname")&&formCustom.showChangeInField(updateObj)}if(data.hasOwnProperty("msg")&&""!=data.msg.trim())if(others.params.hasOwnProperty("formula"))errorFunction.errorSpanAttach(data.msg.trim(),Layout.Page.container.find("#formulaPopup #formula").parent("[errordiv=cantbeempty]")),Layout.Page.container.find("#formulaPopup [buttonname=done]").removeClass("disabled");else if(-1!=data.msg.indexOf("isEmptyFieldValue")){var errorJSON=JSON.parse(data.msg);AutomationCommon.showCannotDeleteModal("EmptyFieldValue",errorJSON.message,"Test")}else ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0),"deleteOptions"==param.mode&&params.hasOwnProperty("pickListOptions")&&params.pickListOptions.hasOwnProperty("deleteOptionId")&&(Layout.Page.container.find("#"+params.pickListOptions.deleteOptionId).closest('[name="choiceDiv"]').removeAttr("deletefield").fadeIn("slow"),data.msg==ZPI18N.getString("zp.unasscempstatusdel")&&Layout.Page.container.find("#"+params.pickListOptions.deleteOptionId).attr("status","empfieldvalue"))}}else{if(data.toString().indexOf("</div>")>=0){formId=Layout.Page.container.attr("formId");if(void 0!=ZPForm.FORM_DETAILS[formId]&&(ZPForm.FORM_DETAILS[formId].refreshStatus=!0),LookupFilterRule.ALL_FORM_COMPONENTS.hasOwnProperty(params.formid)&&delete LookupFilterRule.ALL_FORM_COMPONENTS[params.formid],data.indexOf("formcomponentDiv")>=0){Layout.Page.container.find(".modal").is(":visible")&&Layout.Page.container.find(".modal").modal("hide");var replaceDiv=Layout.Page.container.find("#mainDiv #adding"+params.fieldtype).first();if("true"==params.isupdate&&(replaceDiv=Layout.Page.container.find("[name=formcomponentDiv].active")),$(replaceDiv).fadeOut("slow",function(){$(data).fadeIn("fast"),$(this).replaceWith(data),formCustom.dragAndDropFld()}),JSON.parse(param.reqParams).primLkp){Layout.Page.container.find("#isMgr").val(!0);prevPrimary=Layout.Page.container.find("[isprimary=true]");Layout.Page.container.find("[isprimary=true]").attr("isprimary",!1),prevPrimary.find('[name="permOpt"]').show(),prevPrimary.children("label").children("span").remove()}var fid=params.baseformid==params.formid?null:params.baseformid;formCustom.loadFieldProperties(null,null,{obj:$(data),tabularFormId:fid,toBeClicked:!0,forPost:!0}),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.addsuccessful")),formCustom.customValidation[formId].refresh=!0}else if(data.indexOf("tabularFld")>=0){Layout.Page.container.find(".modal").is(":visible")&&Layout.Page.container.find(".modal").modal("hide"),formCustom.loadFieldProperties(null,null,{obj:data,tabularFormId:params.formid,toBeClicked:!0,forPost:!0});var selectedFieldType=Layout.Page.container.find("div#addfldsec:visible").find("select option:selected[value!=0]").parents("#addfldsec");$(selectedFieldType).parents("[tabformid]").find("[name=delete]").hide(),$(selectedFieldType).replaceWith(data),formCustom.fieldOnClick(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.addsuccessful")),formCustom.customValidation[formId].refresh=!0}formCustom.removeZPFormFormComponentData("form")}else{if(""!=data.msg.trim())if(params.fieldtype==fieldType.FORMULA)errorFunction.errorSpanAttach(data.msg.trim(),Layout.Page.container.find("#formulaPopup #formula").parent("[errordiv=cantbeempty]"),void 0,void 0,!0),Layout.Page.container.find("#formulaPopup [buttonname=done]").removeClass("disabled");else(selectedFieldType=Layout.Page.container.find("div#addfldsec:visible").find("select option:selected[value!=0]").parents("#addfldsec")).remove(),ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0,"",!0);Layout.Page.container.find("#formulaPopup").is(":visible")||Layout.Page.container.find("#mainDiv [name=adding"+params.fieldtype+"]").remove()}formCustom.loadUniqFields(params.formid)}tabAndFormsCustom.forSaveForm.isClick=!1,tabAndFormsCustom.forSaveForm.isChange=!1},deleteField:function(obj){var label=$(obj).parent("div").siblings("label"),parentFCDiv=$(obj).parents("[name=formcomponentDiv]");if($(parentFCDiv).attr("type")!=fieldType.AUTONUMBER||$(parentFCDiv).hasClass("disabled")){var labelName=$(label).text();ZPeople.confirm(null,"",ZPI18N.getString("zp.fielddeletemsg",["'"+labelName+"'"])+" "+ZPI18N.getString("zp.deleteconfirm"),"",!1,!0);var alertDiv=$("#confirmConfirmationPopup");$(alertDiv).on("click",function(){$(alertDiv).modal("hide"),formCustom.fieldAction(obj,["deletefield"])})}else ZPeople.confirm(null,"","zp.cantdeleteautonumber","",!0)},fieldOnClick:function(){Layout.Page.container.find("div[name=formcomponentDiv]").not("[type="+fieldType.AUTONUMBER+"],[noEdit]").on("click",function(e){if(!$(this).hasClass("active")&&!$(this).hasClass("disabled")&&!$(this).parents("[tabtype]").hasClass("disabled")){var focusElement=Layout.Page.container.find("#fieldProperties input:focus, textarea:focus").not("[type=checkbox],[type=radio]");focusElement.attr("savedvalue")!=focusElement.val()&&focusElement.trigger("change");var div=$(this).parents("[name=sectionMain]"),fid=void 0!=$(div).find("[name=sectionDiv]").attr("tabformid")?$(div).find("[name=sectionDiv]").attr("tabformid"):null;formCustom.loadFieldProperties(null,null,{obj:$(this),tabularFormId:fid,toBeClicked:!0,forPost:!0})}}),Layout.Page.container.find("div[name=formcomponentDiv][noEdit]").on("click",function(e){ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.noeditfield"))}),Layout.Page.container.find("div[name=tabularFld][noEdit]").on("click",function(e){ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.noeditfield"))}),Layout.Page.container.find("[name=formcomponentDiv] [isFieldPropertyClick=false]").on("click",function(e){e.stopPropagation()}),Layout.Page.container.find("[name=tabularFld] [isFieldPropertyClick=false]").on("click",function(e){e.stopPropagation()}),Layout.Page.container.find("div[name=tabularFld]").not("[id=addfldsec],[noEdit]").on("click",function(e){if(!$(this).hasClass("active")&&!$(this).hasClass("disabled")&&"addFldButton"!=$(this).attr("id")){var tabularFormId=$(this).parents("[name=sectionDiv]").attr("tabformid");formCustom.loadFieldProperties(null,null,{obj:$(this),tabularFormId:tabularFormId,toBeClicked:!0,forPost:!0})}}),Layout.Page.container.find("#addFldButton, [name=tabularFld] [isFieldPropertyClick=false]").on("click",function(e){e.stopPropagation()})},enableDisableField:function(data,params,others){var label,obj;if(void 0!=others&&(obj=$(others.obj).parent("div"),label=$(obj).siblings("label")),data.isLookup){var msg=ZPI18N.getString("zp.referredfielderror",["disable"])+"\n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n',$.each(data,function(key,val){"isLookup"!=key&&(msg+="{"+key+" -> "+val+"}\n")}),ZPeople.confirm(null,"",msg,"",!0,!0),$("#textConfirmationPopupBody p").first().addClass("pspace")}else if(data.hasOwnProperty("fieldMapList")){var fieldMapListMsg;fieldMapListMsg=void 0!=others?ZPI18N.getString("zp.referredfielderror",["disable"])+"\n\n":ZPI18N.getString("zp.referredlocfielderror",[data.referredField,"disable"])+"\n\n",ZPeople.confirm(null,"",fieldMapListMsg,"",!0,!0),$("#textConfirmationPopupBody p").first().addClass("pspace"),$("#textConfirmationPopupBody").append($(formCustom.getAutomationFieldActionResponse(data.fieldMapList)))}else if(data.hasOwnProperty("msg")){var message=data.msg.trim();if("systemfield"===message)ZPeople.confirm(null,"","zp.cantdisablesystemfield","",!0);else if("dateValidation"===data.msg.trim())ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldusedindatevalidationerror",[label.text(),label.text()]),"",!0,!0);else if("formula"===message)ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldusedinformulaerror",[label.text(),label.text()]),"",!0,!0);else if("uniqueField"===message)ZPeople.confirm(null,"",ZPI18N.getString("zp.disableUniqFields"),"",!0,!0);else if("triggerField"===message)ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldusedintriggerCv",[label.text()]),"",!0,!0);else if("isEnableFilter"===message){msg=ZPI18N.getString("zp.dependentfielderror",["disable"])+"\n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n';for(var i=0;i<data.refforms.length;i++)for(var keys in data.refforms[i])msg+="{"+keys+" -> "+data.refforms[i][keys]+"}\n";setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600),$("#textConfirmationPopupBody p").first().addClass("pspace")}else if("nosuchfieldexists"===message)ZPeople.confirm(null,"","zp.nosuchfieldexists","",!0);else if("waitforcalculation"===message)ZPeople.confirm(null,"","zp.waitforcalculation","",!0);else if("eSignField"===message){msg=ZPI18N.getString("zp.cantdisabledeletefieldsection",["field","disabled"]);msg+=ZPI18N.getString("zp.fileandemailfieldmsg"),ZPeople.confirm(null,"",msg,"",!0,!0)}else if("datachangedisablefield"===data.msg.trim())setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.transfer.disablefield"),"",!0,!0,ZPI18N.getString("zp.close"))},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace").append($(msg))},600);else if("Rule"===message)setTimeout(function(){ZPeople.confirm(null,"","zp.disablefieldusedinrule","",!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600);else if("enabled"===message){var formId=Layout.Page.container.attr("formId");void 0!=ZPForm.FORM_DETAILS[formId]&&(ZPForm.FORM_DETAILS[formId].refreshStatus=!0),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablesuccessful")),data.isReload&&window.location.reload(),$(obj).parent("div").addClass("disabled"),$(others.obj).switchClass("IC-eye1","IC-eye2"),$(others.obj).attr("data-original-title",ZPI18N.getString("zp.enable")).tooltip("show"),$(obj).parent("div").removeClass("active"),Layout.Page.container.find("#fieldProperties").html(""),Layout.Page.container.find("#formPropertiesTab a").trigger("click"),formCustom.removeZPFormFormComponentData("field",params.fcid),formCustom.loadUniqFields(formId),formCustom.customValidation[formId].refresh=!0}else if("disabled"===message){formId=Layout.Page.container.attr("formId");void 0!=ZPForm.FORM_DETAILS[formId]&&(ZPForm.FORM_DETAILS[formId].refreshStatus=!0),data.isReload&&(Layout.Page.container.find("#isMgr").val(!0),$(obj).parent("div").attr("isprimary",!0),$(obj).find('[name="permOpt"]').hide(),$(obj).parent().children("label").append('<span class="IC-key ML5 ZPtooltip-lftnav" data-placement="bottom" title="'+ZPI18N.getString("zp.primaryLookup")+'" iskey="true"> </span>').tooltip(),$(obj).parent().children("label").find("span[iskey='true']").tooltip()),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enablesuccessful")),$(obj).parent("div").removeClass("disabled"),$(others.obj).switchClass("IC-eye2","IC-eye1"),$(others.obj).attr("data-original-title",ZPI18N.getString("zp.disable")).tooltip("show"),formCustom.removeZPFormFormComponentData("form"),formCustom.loadUniqFields(formId),formCustom.customValidation[formId].refresh=!0}else"blueprintfield"===message?ZPeople.confirm(null,"",ZPI18N.getString("zp.blueprintfield"),"",!0,!0):"payrollMappingfield"===message?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.payroll.mappingfield.modifyErrMsg",new Array(data.serviceName))):"onboardingMappingfield"===message&&ZPeople.confirm(null,"",ZPI18N.getString("zp.disablefiledonbmaperror"),"",!0,!0)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},getAutomationFieldActionResponse:function(fieldMapList){var workflowList="",fieldUpdateList="",webhookList="",approvalList="",taskList="",apprSettingsList="",blueprintList="",transitionList="",custActList="";$.each(fieldMapList,function(index,value){value.hasOwnProperty("WORKFLOWID")&&null!=value.WORKFLOWID?workflowList+='<li class="list-group-item"><a href="#admin/automation/workflow/list/edit-formid:'+value.FORMID+"/workflowid:"+value.WORKFLOWID+'" target="_blank">'+value.DISPLAYNAME+"</a></li>":value.hasOwnProperty("FIELD_VALUE_UPDATE_ID")&&null!=value.FIELD_VALUE_UPDATE_ID?fieldUpdateList+='<li class="list-group-item"><a href="#admin/automation/workflow/actions/fieldupdate/edit-formid:'+value.FORMID+"/fuid:"+value.FIELD_VALUE_UPDATE_ID+'" target="_blank">'+value.DISPLAYNAME+"</a></li>":value.hasOwnProperty("WEBHOOKID")&&null!=value.WEBHOOKID?webhookList+='<li class="list-group-item"><a href="#admin/automation/workflow/actions/webhook/edit-formid:'+value.FORMID+"/webhookid:"+value.WEBHOOKID+'" target="_blank">'+ZSEC.Encoder.encodeForHTML(value.NAME)+"</a></li>":value.hasOwnProperty("FORM_TEMPLATE_ACTION_ID")&&null!=value.FORM_TEMPLATE_ACTION_ID&&null!=value.FORMID?approvalList+='<li class="list-group-item"><a href="#admin/automation/approval/edit-formid:'+value.FORMID+"/approvalid:"+value.FORM_TEMPLATE_ACTION_ID+'" target="_blank">'+ZSEC.Encoder.encodeForHTML(value.TEMPLATE_NAME)+"</a></li>":value.hasOwnProperty("TASKCONFIGURATIONID")&&null!=value.TASKCONFIGURATIONID?taskList+='<li class="list-group-item"><a href="#admin/automation/workflow/actions/checklist/tasks/edit-formid:'+value.FORMID+"/taskconfigid:"+value.TASKCONFIGURATIONID+'" target="_blank">'+ZPeople.decodeTxt(value.DISPLAYNAME)+"</a></li>":value.hasOwnProperty("APPRSET_FORMID")?apprSettingsList+='<li class="list-group-item"><a href="hr#admin/automation/approval/settings-formid:'+value.APPRSET_FORMID+'" target="_blank">'+ZPeople.decodeTxt(value.FORMDISPLAYNAME)+"</a></li>":value.hasOwnProperty("isTransCriteria")?transitionList+='<li class="list-group-item"><a href="#admin/automation/blueprint/edit-formid:'+value.FORMID+"/blueprintId:"+value.PROCESSID+'" target="_blank">'+ZSEC.Encoder.encodeForHTML(value.NAME)+"</a></li>":value.hasOwnProperty("PROCESSID")?blueprintList+='<li class="list-group-item"><a href="#admin/automation/blueprint/edit-formid:'+value.FORMID+"/blueprintId:"+value.PROCESSID+'" target="_blank">'+ZSEC.Encoder.encodeForHTML(value.NAME)+"</a></li>":value.hasOwnProperty("CUSTOMBUTTONID")&&(custActList+='<li class="list-group-item"><a href="#admin/formslayout/customaction/edit-formid:'+value.FORMID+"/cbId:"+value.CUSTOMBUTTONID+'" target="_blank">'+ZSEC.Encoder.encodeForHTML(value.DISPLAYNAME)+"</a></li>")});var msg="";return""!=workflowList&&(msg+='<li class="list-group-item ZPbold active"><span>'+ZPI18N.getString("zp.workflow")+"</span></li>"+workflowList),""!=fieldUpdateList&&(msg+='<li class="list-group-item ZPbold active"><span>'+ZPI18N.getString("zp.fieldupdates")+"</span></li>"+fieldUpdateList),""!=webhookList&&(msg+='<li class="list-group-item ZPbold active"><span>'+ZPI18N.getString("zp.webhooks")+"</span></li>"+webhookList),""!=approvalList&&(msg+='<li class="list-group-item ZPbold active"><span>'+ZPI18N.getString("zp.approvals")+"</span></li>"+approvalList),""!=taskList&&(msg+='<li class="list-group-item ZPbold active"><span>'+ZPI18N.getString("zp.tasks")+"</span></li>"+taskList),""!=apprSettingsList&&(msg+='<li class="list-group-item ZPbold active"><span>'+ZPI18N.getString("zp.approvalsettings")+"</span></li>"+apprSettingsList),""!=blueprintList&&(msg+='<li class="list-group-item ZPbold active"><span>'+ZPI18N.getString("zp.blueprint")+"</span></li>"+blueprintList),""!=transitionList&&(msg+='<li class="list-group-item ZPbold active"><span>'+ZPI18N.getString("zp.transitions")+"</span></li>"+transitionList),""!=custActList&&(msg+='<li class="list-group-item ZPbold active"><span>'+ZPI18N.getString("zp.customaction")+"</span></li>"+custActList),""!=msg?'<div class="row frmsettings dvConfirm text-left"><ul class="list-group col-md-10 col-md-offset-1 MT10">'+msg+"</ul></div>":""},reorderSections:function(){Layout.Page.container.find("#reorderPopup #reorderList").empty();var reorderPopup=ZPeople.createModalPopup("reorderPopup",ZPI18N.getString("zp.reordersections"),"modal-xs");reorderPopup.find("#reorderList").length<=0&&reorderPopup.find("#bodyTag").append("<div id='reorderList'></div>"),reorderPopup.find("#reorderList").append(jQuery("<ul></ul>",{id:"sectionOrder",class:"chglist"}));var div=Layout.Page.container.find("[name=sectionDiv]:visible");$(div).each(function(){var secId=$(this).attr("secId"),secName=$(this).find("label[name=sectionName]").text(),sectionTag="<li class='list-group-item BR' secid="+secId+"><span class='IC-drag MR10' name='dragicon'></span><span name='secName'></span></li>";reorderPopup.find("#sectionOrder").append(sectionTag),reorderPopup.find("#sectionOrder [secid="+secId+"] span[name=secName]").text(secName),$("mainDiv").animate({scrollTop:0})}),reorderPopup.find("#sectionOrder").sortable({handle:reorderPopup.find("#sectionOrder [name=dragicon]")}),reorderPopup.find("a[buttonname=done]").off(),reorderPopup.find("a[buttonname=done]").on("click",function(){$(this).addClass("disabled");var sectionOrder="";Layout.Page.container.find("#sectionOrder").find("li").each(function(){sectionOrder+=$(this).attr("secid")+","}),sectionOrder=sectionOrder.substring(0,sectionOrder.length-1);var params={formid:Layout.Page.container.attr("id").match(/[\d]+$/).toString(),sectionOrder:sectionOrder,method:"updateSectionOrder"};ZPeople.Request.send("/sectionActions.zp",params,formCustom.updateSectionOrder,{obj:this},formCustom.failureCallBack)})},updateSectionOrder:function(data,params,others){data.indexOf("</div>")>=0?(Layout.Page.container.find("#reorderPopup").modal("hide"),Layout.Page.container.find("#mainDiv").html(data),Layout.Page.container.find("#mainDiv")[0].scrollIntoView(),Layout.Page.container.find("#formPropertiesTab a").trigger("click"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),formCustom.removeZPFormFormComponentData("form")):"WRITE_OPERATION_NOT_ALLOWED"==data.msg.trim()?ZPeople.confirm(null,"","zp.cantaddupdaterecordserror","",!0):""!=data.msg.trim()&&ZPeople.confirm(null,"",data.msg.trim(),!0,!0),$(others.obj).removeClass("disabled")},emptySectionCheck:function(){Layout.Page.container.find("#mainDiv div[id=emptySectionMsg]").hide();var deleteOption=Layout.Page.container.find("div[name=sectionMain]").find("a[name=delete]");$(deleteOption).hide();var div=Layout.Page.container.find("div[name=sectionMain] div[secType=normal]"),tabDiv=Layout.Page.container.find("div[name=sectionMain] div[secType=tabular]"),numberOfSections=$(div).length+$(tabDiv).length;$(div).each(function(){var lcol=$(this).parents("[name=sectionMain]").find("[tabtype=normal]").first();if($(lcol).length>0){var rcol=$(lcol).next("[tabtype=normal]");0==$(lcol).find("[name=formcomponentDiv]").length&&0==$(rcol).find("[name=formcomponentDiv]").length?($(lcol).find("[id=emptySectionMsg]").show(),$(this).parents("[name=sectionMain]").find("[name=sectionDiv]").hasClass("disabled")&&$(lcol).find("[id=emptySectionMsg]").addClass("disabled"),formCustom.columnDivCss(!0,$(this).parents("[name=sectionMain]")),numberOfSections>1&&$(this).parents("div[name=sectionMain]").find("a[name=delete]").show()):formCustom.columnDivCss(!1,$(this).parents("[name=sectionMain]"))}}),$(tabDiv).each(function(){$(this).find("div#emptySectionMsg").hide(),$(this).find("[name=scrollsection]").show(),0==$(this).find("[name=tabularFld]:visible").not("#emptySectionMsg").length&&($(this).find("[name=tabularFld]").not("#emptySectionMsg,:visible").length>0?$(this).find("div#emptySectionMsg").text(ZPI18N.getString("zp.disabledfieldsinsection")):numberOfSections>1&&$(this).find("a[name=delete]").show(),$(this).find("div#emptySectionMsg").show(),$(this).find("[name=scrollsection]").hide())})},formulaPopup:function(formulaObj,param,others){var params=others.params,numberArr=formulaObj.numberfields,dateArr=formulaObj.datefields,slArr=formulaObj.slfields,urlArr=formulaObj.urlfields,emailArr=formulaObj.emailfields,formulaSecDiv=ZPeople.createModalPopup("formulaPopup",ZPI18N.getString("zp.formula"),"modal-md",[params.hasOwnProperty("isGrid"),fieldType.FORMULA]);if(formulaSecDiv.find("#formulaDiv").length<=0){var abc=Layout.Page.container.find("#formulaDiv");formulaSecDiv.find("#bodyTag").append(abc.show());var url=formulaSecDiv.find("form").attr("url");$('<a class="IC-qus S20 gry FR MR20" target="_blank" href="'+url+'/people/help/administrator/forms-answers.html#useofformulafield"></a>').insertAfter(formulaSecDiv.find("[buttonaction=dismiss]"))}formulaSecDiv.find("#skipcalc").find("input[type=checkbox]").prop("checked",!1),formulaSecDiv.find("#bodyTag").attr("formid",param.formid),$('[data-toggle="popover"]').popover(),formulaSecDiv.find("#funcheader").val(1).select2("destroy"),formulaFunctions.showfunctions(1,param.formid),i18Arr["zp.formula.eg.SubDate"]=i18Arr["zp.formula.eg.SubDate"].replace("$subDate$",formulaObj.subDate),i18Arr["zp.formula.eg.GetDate"]=i18Arr["zp.formula.eg.GetDate"].replace("$Date$",formulaObj.date),i18Arr["zp.formula.eg.AddDate"]=i18Arr["zp.formula.eg.AddDate"].replace("$addDate$",formulaObj.addDate),i18Arr["zp.formula.eg.NewDateTime"]=i18Arr["zp.formula.eg.NewDateTime"].replace("$newDate$",formulaObj.newDate),i18Arr["zp.formula.eg.GetTime"]=i18Arr["zp.formula.eg.GetTime"].replace("$time$",formulaObj.time),i18Arr["zp.formula.eg.CurrentDate"]=i18Arr["zp.formula.eg.CurrentDate"].replace("$currentTime$",formulaObj.currentTime),i18Arr["zp.formula.eg.Now"]=i18Arr["zp.formula.eg.Now"].replace("$currentTime$",formulaObj.currentTime),i18Arr["zp.formula.eg.GetExperience"]=i18Arr["zp.formula.eg.GetExperience"].replace("$exp$",formulaObj.exp).replace("$doj$",formulaObj.doj);var fieldValuesDiv=$(formulaSecDiv).find("#fieldvalues");$(fieldValuesDiv).html("");var optGroupTag="",optTag="";if(numberArr.length>0){for(optGroupTag=jQuery("<optgroup></optgroup>",{class:"select",label:ZPI18N.getString("zp.numberfields")}),i=0;i<numberArr.length;i++)optTag=jQuery("<option></option>",{value:numberArr[i],text:numberArr[++i]}),$(optGroupTag).append(optTag);$(fieldValuesDiv).append(optGroupTag)}if(dateArr.length>0){for(optGroupTag=jQuery("<optgroup></optgroup>",{class:"select",label:ZPI18N.getString("zp.datefields")}),i=0;i<dateArr.length;i++)optTag=jQuery("<option></option>",{value:dateArr[i],text:dateArr[++i]}),$(optGroupTag).append(optTag);$(fieldValuesDiv).append(optGroupTag)}if(slArr.length>0){for(optGroupTag=jQuery("<optgroup></optgroup>",{class:"select",label:ZPI18N.getString("zp.singlelinefields")}),i=0;i<slArr.length;i++)optTag=jQuery("<option></option>",{value:slArr[i],text:slArr[++i]}),$(optGroupTag).append(optTag);$(fieldValuesDiv).append(optGroupTag)}if(urlArr.length>0){for(optGroupTag=jQuery("<optgroup></optgroup>",{class:"select",label:ZPI18N.getString("zp.urlfields")}),i=0;i<urlArr.length;i++)optTag=jQuery("<option></option>",{value:urlArr[i],text:urlArr[++i]}),$(optGroupTag).append(optTag);$(fieldValuesDiv).append(optGroupTag)}if(emailArr.length>0){for(optGroupTag=jQuery("<optgroup></optgroup>",{class:"select",label:ZPI18N.getString("zp.emailfields")}),i=0;i<emailArr.length;i++)optTag=jQuery("<option></option>",{value:emailArr[i],text:emailArr[++i]}),$(optGroupTag).append(optTag);$(fieldValuesDiv).append(optGroupTag)}$(formulaSecDiv).find("#formula").val(params.formula);var name=formCustom.fieldTypeCount(fieldType.FORMULA,ZPI18N.getString("zp.formula"));if(void 0!=params.displayname?$(formulaSecDiv).find("[keyname=displayname]").val(params.displayname):$(formulaSecDiv).find("[keyname=displayname]").val(name),$(formulaSecDiv).find("[keyname=displayname]").off(),void 0!=params.labelname)$(formulaSecDiv).find("[keyname=labelname]").attr("disabled",!0),$(formulaSecDiv).find("[keyname=labelname]").val(params.labelname);else{$(formulaSecDiv).find("[keyname=labelname]").prop("disabled",!1);var labelname=/^[\w\s]*$/.test(name)?name.replace(/\s|-/g,"_").replace(/_+/g,"_"):$("#addFields").find("[typeid="+fieldType.FORMULA+"]").attr("label");$(formulaSecDiv).find("[keyname=labelname]").val(labelname),formCustom.changeLabel($(formulaSecDiv).find("[keyname=displayname]"),$(formulaSecDiv).find("[keyname=labelname]"))}formulaSecDiv.find("#funcheader").off(),formulaSecDiv.find("#funcheader").on("change",function(ele){formulaFunctions.showfunctions(ele.val,params.formid)}),formCustom.select2ForSelectBox($(formulaSecDiv)),$(formulaSecDiv).find("a[buttonname=done]").off(),$(formulaSecDiv).find("a[buttonname=done]").on("click",function(){$(this).addClass("disabled");var formula=$(formulaSecDiv).find("#formula").val();(errorFunction.removeErrorSpan(Layout.Page.container.find("#formulaPopup")),""==formula.trim())?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.enterformulaerror"),$(formulaSecDiv).find("#formula").parent("div")),$(this).removeClass("disabled")):0!=formCustom.checkDisplayandLabelName(formulaSecDiv)&&(params.formula=formula,params.skipCalc=$(formulaSecDiv).find("#skipcalc").find("input[type=checkbox]").prop("checked"),params.displayname=$(formulaSecDiv).find("[keyname=displayname]").val(),params.labelname=$(formulaSecDiv).find("[keyname=labelname]").val(),formCustom.fieldAction(null,["updField",params]))})},onChangeRelFieldsOnAdd:function(visibleLookup){return $(visibleLookup).find("#relatedfields").parent("div").find("[name=errorSpan]").remove(),!($(visibleLookup).find("#relatedfields").val().length>LookupFilterRule.maxAllowedLookupRelField)||(errorFunction.errorSpanAttach(ZPI18N.getString("zp.maxlimitrelfields"),$(visibleLookup).find("#relatedfields").parent("div")),$(visibleLookup).find("[buttonname=done]").removeClass("disabled"),!1)},lookupPopup:function(data,par,others){var params=others.params;if(params.isFormChange)formCustom.constructLookupFormFields(data,par,others);else{var visibleLookup=ZPeople.createModalPopup("lookupPopup",ZPI18N.getString("zp.lookup"),"modal-xs",[params.hasOwnProperty("isGrid"),params.fieldtype]);$(visibleLookup).find("#bodyTag").html(data);var isPrimLkpChangeAllowed="true"==Layout.Page.container.find("#isPrimLkpChangeAllowed").val();if($(visibleLookup).find("#displayAs option").removeClass("hide"),params.baseformid==params.formid){if($(visibleLookup).find("[name=relatedfields]").show().off("change").on("change",function(){formCustom.onChangeRelFieldsOnAdd(visibleLookup)}),$(visibleLookup).find("#displayAs").attr("onclick","formCustom.showHideRelatedFlds(this)"),isPrimLkpChangeAllowed)$(visibleLookup).find("#primLkp").length<=0&&$(visibleLookup).find("form .row").append('<div class="col-md-10"><div class="form-group blkCbox"><label class="checkbox"><input type="checkbox" name="primLkp" id="primLkp"><span>'+ZPI18N.getString("zp.primaryLookup")+"</span></label></div></div>"),"true"==Layout.Page.container.find("#isMgr").val()||$(visibleLookup).find("#primLkp").attr("disabled",!0).prop("checked",!0)}else $(visibleLookup).find("#displayAs option[value=103],option[value=102],option[value=101]").addClass("hide");$('[data-toggle="popover"]').popover();var name=formCustom.fieldTypeCount(26,ZPI18N.getString("zp.lookup"));$(visibleLookup).find("[keyname=displayname]").val(name);var labelname=/^[\w\s]*$/.test(name)?name.replace(/\s|-/g,"_").replace(/_+/g,"_"):$("#addFields").find("[typeid="+fieldType.IMPORTDATA+"]").attr("label");$(visibleLookup).find("[keyname=labelname]").val(labelname),formCustom.changeLabel($(visibleLookup).find("[keyname=displayname]"),$(visibleLookup).find("[keyname=labelname]")),formCustom.select2ForSelectBox($(visibleLookup)),$(visibleLookup).find("#bodyTag").find("#ImportForm").off(),$(visibleLookup).find("#bodyTag").find("#ImportForm").on("change",function(){params.isFormChange=!0;var lkupFmid=$(this).val();formCustom.fieldAction(null,["fetchlookupfields",params,lkupFmid])}),$(visibleLookup).find("a[buttonname=done]").off(),$(visibleLookup).find("a[buttonname=done]").on("click",function(){if(errorFunction.removeErrorSpan(visibleLookup),$(visibleLookup).find("[name=showErrorDiv]").remove(),$(visibleLookup).find("[name=errorSpan]").remove(),$(this).addClass("disabled"),null==$(visibleLookup).find("#bodyTag #FormFldName").val()||void 0==$(visibleLookup).find("#bodyTag #FormFldName").val())$(visibleLookup).find("#ImportForm").parents("#ImportData").append('<div class="col-md-10" name="showErrorDiv"></div>'),errorFunction.errorSpanAttach(ZPI18N.getString("zp.nofields"),$(visibleLookup).find("#ImportForm").parents("#ImportData").find("[name=showErrorDiv]")),$(this).removeClass("disabled");else{var isError=formCustom.checkDisplayandLabelName(visibleLookup);if(0!=(isError=$("#relatedfields").is(":visible")?formCustom.onChangeRelFieldsOnAdd(visibleLookup)&&isError:isError)){var relatedFields=$(visibleLookup).find("#bodyTag").find("[name=relatedfields]:visible #relatedfields").val();null!=relatedFields&&relatedFields.length>0&&(params.relatedFields=relatedFields.toString()),params.dispFcid=$(visibleLookup).find("#bodyTag #FormFldName").val(),params.lookupdisplaytype=$(visibleLookup).find("#bodyTag #displayAs").val(),params.displayname=$(visibleLookup).find("#bodyTag [keyname=displayname]").val(),params.labelname=$(visibleLookup).find("#bodyTag [keyname=labelname]").val(),params.refFormId=$(visibleLookup).find("#bodyTag #ImportForm").val(),params.primLkp=!1,$(visibleLookup).find("#primLkp").length>0&&(params.primLkp=$(visibleLookup).find("#primLkp").prop("checked")),$(visibleLookup).modal("hide"),$(visibleLookup).find("a[name=Done]").addClass("disabled"),formCustom.fieldAction(null,["updField",params])}}})}},addTabularSectionField:function(obj){if(25==$(obj).parents("[name=sectionMain]").find("[div=fielddiv]").length)ZPeople.confirm(null,"","zp.tabularsectionmaximumfields","",!0);else{var addField=Layout.Page.container.find("#addfldsec:hidden").clone();$(addField).removeClass("DN"),$(addField).find(".selectTag").select2();var div=$(obj).parents("[name=sectionMain]");$(div).find("#emptySectionMsg").hide(),$(div).find("[name=scrollsection]").show(),$(div).find("ul[name=tabularFields] li").append(addField),formCustom.tabularCss($(div).find("ul[name=tabularFields] li"),$(addField)),$(addField).find("select").on("change",function(){var fcType=$(this).val(),tabularFormId=$(div).find("div[name=sectionDiv]").attr("tabformid"),secId=$(div).find("div[name=sectionDiv]").attr("secid"),params={beforeFcid:"-1",displaycolumn:"1",baseformid:Layout.Page.container.attr("id").match(/[\d]+$/).toString(),formid:tabularFormId,sectionId:secId,fieldtype:fcType,isupdate:"false",isGrid:!0,object:obj};if(fcType==fieldType.FORMULA)formCustom.fieldAction(null,["getformulafields",params,params.formid]);else if(fcType==fieldType.IMPORTDATA)formCustom.fieldAction(null,["fetchlookupfields",params,params.baseformid]);else{var fieldname=$(this).find("option:selected").text(),labelname=/^[\w\s]*$/.test(fieldname)?fieldname.replace(/\s|-/g,"_").replace(/_+/g,"_"):$(this).find("option:selected").attr("name");formCustom.otherFieldsPopup(params,formCustom.fieldTypeCount(fcType,fieldname),fcType,labelname)}})}},tabularCss:function(obj,addField){var tabFieldCount=$(obj).find("[name=tabularFld]:visible").length;if($(obj).parents("[name=scrollsection]").css("minWidth",160*tabFieldCount),"addfldsec"==$(addField).attr("id")){var outerWidth=$(addField).parents("[name=scrollsection]").outerWidth();$(addField).parents("#scrollDiv").scrollLeft(parseInt(outerWidth)-500)}},addSection:function(data,params,others){$(others.obj).addClass("disabled");var addSectionDiv=$(others.obj).parents("#sectionPopup");$(addSectionDiv).modal("hide"),data.indexOf("</div>")>=0?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.addsuccessful")),Layout.Page.container.find("#formContentDiv [name=sectionMain]").removeAttr("last"),Layout.Page.container.find("#formContentDiv").append(data),formCustom.dragAndDropFld(),Layout.Page.container.find("[name=sectionMain]").last()[0].scrollIntoView()):(data=JSON.parse(data)).hasOwnProperty("error")&&""!=data.error.trim()?ZPeople.confirm(null,"",data.error.trim(),"",!0,!0):data.hasOwnProperty("msg")&&""!=data.msg.trim()&&ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0),$(others.obj).removeClass("disabled")},openTab:function(id){var fieldId=id;if(id=Layout.Page.container.find(id),Layout.Page.container.find("[role=presentation]").removeClass("active"),Layout.Page.container.find("[role='tabpanel']").removeClass("active in"),$(id).addClass("active in"),Layout.Page.container.find(fieldId+"Tab").addClass("active"),$(id).find("input").first().trigger("select"),fieldId.indexOf("fieldProperties")>=0&&""==$(id).html()){var firstComponent=Layout.Page.container.find("[name=sectionDiv]").not(".disabled").parents("[name=sectionMain]").find("[div=fielddiv]").not(".disabled,[type="+fieldType.AUTONUMBER+"],[noEdit]").first();0==$(firstComponent).length?Layout.Page.container.find("#formPropertiesTab a").trigger("click"):formCustom.loadFieldProperties(null,null,{obj:firstComponent,forPost:!0})}else fieldId.indexOf("formProperties")>=0&&(Layout.Page.container.find("[div=fielddiv].active").removeClass("active"),$(id).siblings("#fieldProperties").html(""))},enableDisableSection:function(data,params,others){if(data.isLookup){var msg=ZPI18N.getString("zp.referredfieldserror",["section","disable","section"])+"\n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n',$.each(data,function(key,val){"isLookup"!=key&&(msg+="{"+key+" -> "+val+"}\n")}),setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600),$("#textConfirmationPopupBody p").first().addClass("pspace")}else if(data.isFieldRule){msg=ZPI18N.getString("zp.fieldrulessectionhideerror");setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600),$("#textConfirmationPopupBody p").first().addClass("pspace")}else if(data.isTriggerCv)setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.disableSectionCVFields"),"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600),$("#textConfirmationPopupBody p").first().addClass("pspace");else if("boolean"==typeof data.msg){var div=$(others.obj).parents("div[name=sectionDiv]"),columnDiv=$(div).parents("[name=sectionMain]").find("div[tabtype=normal]");0==data.msg?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablesuccessful")),$(div).addClass("disabled"),$(others.obj).switchClass("IC-eye1","IC-eye2"),$(others.obj).attr("data-original-title",ZPI18N.getString("zp.enable")).tooltip("show"),$(columnDiv).each(function(){$(this).addClass("disabled");var fieldComponentDiv=$(this).find("[name=formcomponentDiv]");$(fieldComponentDiv).find(".dvedit-actions").each(function(){$(this).addClass("hidden")})}),$(div).parents("[name=sectionMain]").find("[div=fielddiv].active").length>0&&($(div).parents("[name=sectionMain]").find("[div=fielddiv].active").removeClass("active"),Layout.Page.container.find("#formPropertiesTab a").trigger("click"),Layout.Page.container.find("#fieldProperties").html("")),formCustom.removeZPFormFormComponentData("section",params.sectionId)):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enablesuccessful")),$(div).removeClass("disabled"),$(others.obj).switchClass("IC-eye2","IC-eye1"),$(others.obj).attr("data-original-title",ZPI18N.getString("zp.disable")).tooltip("show"),$(columnDiv).each(function(){$(this).removeClass("disabled");var fieldComponentDiv=$(this).find("[name=formcomponentDiv]");$(fieldComponentDiv).find(".dvedit-actions").each(function(){$(this).removeClass("hidden")})}),formCustom.removeZPFormFormComponentData("form")),formCustom.customValidation[Layout.Page.container.attr("formId")].refresh=!0}else if("eSignField"==data.msg.trim()){msg=ZPI18N.getString("zp.cantdisabledeletefieldsection",["section","disabled"]);msg+=ZPI18N.getString("zp.fileandemailfieldmsg"),ZPeople.confirm(null,"",msg,"",!0,!0)}else""!=data.msg.trim()&&ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0)},columnDivCss:function(isempty,sectionDiv){$(sectionDiv).find("[tabtype=normal]").css("min-height","auto");var ht=$(sectionDiv).innerHeight();ht-=$(sectionDiv).find("[name=sectionDiv]").innerHeight()-4,$(sectionDiv).find("[tabtype=normal]").css("min-height",ht),"last"==$(sectionDiv).attr("last")&&formCustom.resizeDiv($(sectionDiv))},insertIntoExpression:function(addVal){$("#expression").trigger("focus");var cursorPosition=$("#expression").prop("selectionStart"),expressionValue=$("#expression").val(),exp=expressionValue.substring(0,cursorPosition)+addVal+expressionValue.substring(cursorPosition);$("#expression").val(exp)},editFormula:function(obj){var par={fcid:$(obj).parents("#fieldProperties").attr("currentfcId"),isupdate:"true"};if($(obj).parents("#fieldProperties").find("[name=propertyDiv]").each(function(){var keynameDiv=$(this).find("[keyname]");propName=$(keynameDiv).attr("keyname"),propVal=$(keynameDiv).val(),"textarea"==$(keynameDiv).attr("type")&&(propVal=$(keynameDiv).text()),par[propName]=propVal}),"formula"!=$(obj).attr("keyname"))return par;var formidParam=null!=Layout.Page.container.find("#fieldProperties").attr("tabformid")?Layout.Page.container.find("#fieldProperties").attr("tabformid").match(/[\d]+$/).toString():Layout.Page.container.attr("id").match(/[\d]+$/).toString();formCustom.fieldAction(null,["getformulafields",par,formidParam])},successCallback:function(data){"success"==data.res?ZPeople.Message.showSuccessMsg(data.msg):"failure"==data.res&&ZPeople.Message.showFailureMsg(data.msg)},enablePasswordProtection:function(formId,obj){var checked=$(obj).prop("checked"),enabledisable="";$('[data-toggle="popover"]').popover(),""!=(enabledisable=checked?1:0)&&$.ajax({type:"POST",async:!1,url:"/formAction.zp",data:{mode:"enablediablePasswordProtection",formId:formId,enabledisable:enabledisable,conreqcsr:csrfToken},success:function(data){data.Success?1==enabledisable?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enblepasswordprotection")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablepasswordprotection")):data.hasOwnProperty("msg")&&"extensionform"==data.msg.trim()?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionformnoedit")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}})},showSubmitNew:function(formId,obj){var enabledisable=null;if(null!=(enabledisable=$(obj).prop("checked")?1:0)){var params={mode:"hideSubmitNew",formId:formId,enabledisable:enabledisable};ZPeople.Request.send("/formAction.zp",params,formCustom.showSubmitNewCallback,null,formCustom.failureCallBack)}},showSubmitNewCallback:function(data,params){data.Success?(0==params.enabledisable?$('[keyname="submitNewRename"]').parent().removeClass("DN"):$('[keyname="submitNewRename"]').parent().addClass("DN"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))):data.hasOwnProperty("msg")&&"extensionform"==data.msg.trim()?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionformnoedit")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},allowDraft:function(formId,obj){var enabledisable=null;if(null!=(enabledisable=$(obj).prop("checked")?1:0)){var params={mode:"allowDraft",formId:formId,enabledisable:enabledisable};ZPeople.Request.send("/formAction.zp",params,formCustom.allowDraftCallback,null,formCustom.failureCallBack)}},allowDraftCallback:function(data,params){data.Success?1==params.enabledisable?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enableallowdraft")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disableallowdraft")):data.hasOwnProperty("msg")&&"extensionform"==data.msg.trim()?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionformnoedit")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},locationTracking:function(formId,obj,confirm){var checked=$(obj).prop("checked"),enabledisable=null;if(checked){if(enabledisable=1,void 0==confirm){ZPeople.confirm(null,"",ZPI18N.getString("zp.capturelocationenableconfirm"),"",!1,!0,ZPI18N.getString("zp.agree"),!0);confirmDiv=$("#confirmConfirmationPopup");$(confirmDiv).off(),$(confirmDiv).on("click",function(){$(confirmDiv).modal("hide"),formCustom.locationTracking(formId,obj,!0)});cancelDiv=$("#cancelConfirmationPopup");$(cancelDiv).off(),$(cancelDiv).on("click",function(){$(cancelDiv).modal("hide"),$(obj).prop("checked",!1)})}}else if(enabledisable=0,void 0==confirm){ZPeople.confirm(null,"",ZPI18N.getString("zp.capturelocationdisableconfirm"),"",!1,!0,ZPI18N.getString("zp.agree"),!0);var confirmDiv=$("#confirmConfirmationPopup");$(confirmDiv).off(),$(confirmDiv).on("click",function(){$(confirmDiv).modal("hide"),formCustom.locationTracking(formId,obj,!0)});var cancelDiv=$("#cancelConfirmationPopup");$(cancelDiv).off(),$(cancelDiv).on("click",function(){$(cancelDiv).modal("hide"),$(obj).prop("checked",!0)})}if(void 0!=confirm){var params={mode:"locationTracking",formId:formId,enabledisable:enabledisable};ZPeople.Request.send("/formAction.zp",params,formCustom.locationTrackingCallback,{obj:obj,checked:checked},formCustom.failureCallBack)}},singleFieldEditAllowChange:function(formId,obj){$(obj).attr("disabled",!0);var isAllow=1;if($(obj).prop("checked")||(isAllow=0),null!=isAllow){var params={method:"formCustOperations",mode:"allowSingleFieldEdit",formId:formId,enabledisable:isAllow,conreqcsr:csrfToken};$.ajax({type:"POST",async:!0,url:"/formCustOperations.zp",data:params,success:function(data){data.Success?isAllow?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.singlefieldeditenabled")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.singlefieldeditdisabled")):data.hasOwnProperty("msg")&&"extensionform"==data.msg.trim()?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionformnoedit")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}})}$(obj).removeAttr("disabled")},relavantFieldInputChange:function(obj){$(obj).attr("disabled",!0);var checked=$(obj).prop("checked"),params={method:"formCustOperations",mode:"relavantFieldChange",formid:Layout.Page.container.attr("id").match(/[\d]+$/).toString(),isRelevantFieldBasedEnabled:checked,conreqcsr:csrfToken};$.ajax({type:"POST",async:!0,url:"/formCustOperations.zp",data:params,success:function(data){void 0==data.msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")):"success"==data.msg?checked?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.totalexpbasedonrelevantfieldEnable")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.totalexpbasedonrelevantfieldDisable")):ZPeople.Message.showFailureMsg(data.msg)}}),$(obj).removeAttr("disabled")},locationTrackingCallback:function(data,params,others){if(data.Success)1==params.enabledisable?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enablelocationtracking")),$("[id=dispName"+data.AddedLOCfcid+"]").parent().removeClass("disabled"),$("[id=dispName"+data.ModifiedLOCfcid+"]").parent().removeClass("disabled")):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablelocationtracking")),$("[id=dispName"+data.AddedLOCfcid+"]").parent().addClass("disabled"),$("[id=dispName"+data.ModifiedLOCfcid+"]").parent().addClass("disabled"));else{data.hasOwnProperty("msg")&&"extensionform"==data.msg.trim()&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionformnoedit"));var obj=others.obj;$(obj).prop("checked",!others.checked),formCustom.enableDisableField(data)}},enableCancel:function(formId,obj){var enabledisable=null;if(null!=(enabledisable=$(obj).prop("checked")?1:0)){var params={mode:"enableCancel",formId:formId,enabledisable:enabledisable};ZPeople.Request.send("/formAction.zp",params,formCustom.enableCancelCallback,null,formCustom.failureCallBack)}},enableCancelCallback:function(data,params){data.Success?1==params.enabledisable?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enablecancel")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablecancel")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},editForm:function(data,params,others){var obj=others.obj;if(others.hasOwnProperty("forPost")){$(obj).val(),$(obj).siblings("label").text(),params={formId:Layout.Page.container.attr("id").match(/[\d]+$/).toString(),mode:"renameform",method:"formCustOperations"};div=$(obj).parents("#formProperties");var keyname="",keyval="",isError=!1;$(div).find("[name=formProperty]").each(function(){var keynameDiv=$(this).find("[keyname]");if("enablecfvalid"!=(keyname=$(keynameDiv).attr("keyname"))&&"enablepassword"!=keyname){if(keyval=$(this).children("[keyname]").val(),"checkbox"==$(keynameDiv).attr("type")&&(keyval=$(keynameDiv).is(":checked")),("addRecordRename"==keyname||"submitRename"==keyname||"submitNewRename"==keyname||"cancelRename"==keyname)&&keyval.length>25)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.buttonrenamelength")),void(isError=!0);params[keyname]=keyval}}),keyname=$(div).find("[name=pageinationProperty]").find("input[name^=frmlayout_]:checked").attr("keyname"),keyval=$(div).find("[name=pageinationProperty]").find("input[name^=frmlayout_]:checked").val(),params[keyname]=keyval,params.isFirstTime=$(div).attr("isFirst"),(Layout.Page.container.find("[name=formcomponentDiv][type="+fieldType.AUTONUMBER+"]").length>0||"enableautonumber"!=$(obj).attr("keyname"))&&(params.isFirstTime=!1),isError||ZPeople.Request.send("/formCustOperations.zp",params,formCustom.editForm,{obj:obj},formCustom.failureCallBack)}else{if(data.hasOwnProperty("msg")&&"extensionform"==data.msg.trim())return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionformnoedit"));if("enableautonumber"==$(obj).attr("keyname")){var formProp=data.formProperties;let formId=Layout.Page.container.attr("formId");params.enableautonumber?formProp.issectionhidden?(ZPeople.confirm(null,"","zp.enableautonumbersectionerror","",!0),$(obj).prop("checked",!1)):(Layout.Page.container.find("div[type="+fieldType.AUTONUMBER+"]").removeClass("disabled"),$(div).find("[name=autonumberDiv]").slideDown(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),formCustom.removeZPFormFormComponentData("form"),formCustom.customValidation[formId].refresh=!0):formProp.isFieldUsedInLookup?(ZPeople.confirm(null,"","zp.referredfielddisableerror","",!0),$(obj).prop("checked",!0)):(Layout.Page.container.find("div[type="+fieldType.AUTONUMBER+"]").addClass("disabled"),$(div).find("[name=autonumberDiv]").slideUp(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),formCustom.customValidation[formId].refresh=!0)}else if(data.hasOwnProperty("msg")&&"Success"==data.msg.trim()){if("formlabel"==$(obj).attr("keyname")){AccessControl.Permissions.remove();var formname=data.formLabel;$("#dvfrmlstcontent a[formid="+params.formid+"]").text(formname),$("li[id*="+params.formid+"], tr#"+params.formid).each(function(){$(this).find("a[href]").text(formname)})}ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),formCustom.removeZPFormFormComponentData("form")}}},deleteTabularSectionField:function(obj){var labelName=$(obj).parent("div").text().toString().trim(),parentLi=$(obj).parents("li");if("addfldsec"==$(obj).parents("[name=tabularFld]").attr("id"))$(obj).parents("#addfldsec").remove(),formCustom.tabularCss(parentLi),formCustom.emptySectionCheck();else{ZPeople.confirm(null,"",ZPI18N.getString("zp.fielddeletemsg",["'"+labelName+"'"])+" "+ZPI18N.getString("zp.deleteconfirm"),"",!1,!0);var alertDiv=$("#confirmConfirmationPopup");$(alertDiv).off(),$(alertDiv).on("click",function(){$(alertDiv).modal("hide"),formCustom.fieldAction(obj,["deletefield"])})}},resizeDiv:function(obj){var actualHt=Layout.Page.container.find("#mainDiv").innerHeight(),usedHt=0;if(Layout.Page.container.find("#mainDiv #formContentDiv>.section").each(function(){usedHt+=$(this).innerHeight()}),actualHt>usedHt){var myHt=$(obj).innerHeight(),setHt=actualHt-usedHt+myHt;$(obj).find("[tabtype=normal]").css("min-height",setHt-$(obj).find("[name=sectionDiv]").innerHeight()-4)}},onChangeRelFields:function(){let timer=void 0;Layout.Page.container.find("#fieldProperties #relatedfields").off("change").on("change",function(event){timer&&clearTimeout(timer),timer=setTimeout(formCustom.editField,200,event.target)})},editField:function(obj,prevDiv){var fcoid=$(obj).parents("#fieldProperties").attr("currentfcid"),updParams={fcid:fcoid,object:obj},fcType=$(obj).parents("#fieldProperties").attr("fcType"),nameAttr=Layout.Page.container.find("#formContentDiv [id*="+fcoid+"]").parents("[tabtype]").attr("tabtype"),isGrid="false",propName="",checkIt=!0;propName=$(obj).attr("keyname");var propVal=$(obj).val();propVal&&propVal.length>255&&(ZPeople.confirm(null,"",ZPI18N.getString("zp.optionlength",[255]),"",!0,!0),checkIt=!1);var optionsArray=[],i=0;if("code"==propName){var codearray=[];$(obj).parents("#fieldProperties").find('#choiceParent input:visible[keyname="code"]').each(function(){var val=$(this).val().trim().toLowerCase();if(""!=val){if(codearray.includes(val))return ZPeople.confirm(null,"",ZPI18N.getString("zp.duplicatecode"),"",!0,!0),checkIt=!1,!1;codearray[i++]=val}})}else{if("enableephidata"==propName&&$(obj).closest(".section").find('[keyname="enablepersonaldata"]').is(":checked"))return $(obj).closest(".section").find('[keyname="enableephidata"]').prop("checked",!1),ZPeople.confirm(null,"",ZPI18N.getString("zp.ephiorpersonaldata"),"",!0,!0),!1;if("enablepersonaldata"==propName&&$(obj).closest(".section").find('[keyname="enableephidata"]').is(":checked"))return $(obj).closest(".section").find('[keyname="enablepersonaldata"]').prop("checked",!1),ZPeople.confirm(null,"",ZPI18N.getString("zp.ephiorpersonaldata"),"",!0,!0),!1;fcType==fieldType.PICKLIST&&$(obj).parents("#choiceParent").length>0&&(void 0!=$(obj).attr("deleteField")||"deleteOption"!=$(obj).attr("name"))&&$(obj).parents("#fieldProperties").find("#choiceParent input:visible, #choiceParent [status=empfieldvalue], #choiceParent [status=empHealthstatus]").not('[name=initialvalue],[status="Active"],[status="Inactive"],[keyname="code"],[keyname="childName"]').each(function(){if(optionsArray.includes($(this).val().toLowerCase()))return ZPeople.confirm(null,"",ZPI18N.getString("zp.duplicateentriesexist"),"",!0,!0),checkIt=!1,!1;optionsArray[i++]=$(this).val().toLowerCase()})}if(0==checkIt){var val=void 0!=$(obj).attr("savedvalue")?$(obj).attr("savedvalue"):"";return $(obj).val(val),tabAndFormsCustom.forSaveForm.isClick=!1,tabAndFormsCustom.forSaveForm.isChange=!1,checkIt=!1,!1}if(formCustom.fieldValidation(propVal,propName,fcType,obj))$(obj).val($(obj).attr("savedValue"));else{if((isGrid="tabular"==nameAttr)&&(updParams.isGrid=isGrid.toString()),fcType==fieldType.PICKLIST&&$(obj).parents("#choiceParent").length>0){var pickListOptions={};if("code"==propName)pickListOptions.code=$(obj).val().trim(),pickListOptions.optionId=$(obj).closest('[name="choiceDiv"]').attr("optid");else{if(void 0==$(obj).attr("deleteField")&&"deleteOption"==$(obj).attr("name")){var deleteDiv=$(obj).parents("[name=choiceDiv]");return pickListOptions.deleteOptionId=$(deleteDiv).find("input").not('[name=initialvalue],[status="Active"],[status="Inactive"],[keyname="code"]').attr("id"),$(deleteDiv).find("input").not('[name=initialvalue],[status="Active"],[status="Inactive"]').attr("status",""),$(deleteDiv).attr("deleteField",""),updParams.isupdate="true",updParams.pickListOptions=pickListOptions,updParams.object=prevDiv,formCustom.fieldAction(null,["deleteOptions",updParams]),!1}if(void 0!=$(obj).attr("seq")){optionsArray=[],i=0;$(obj).parents("#fieldProperties").find("#choiceParent input:visible,#choiceParent [status=empfieldvalue], #choiceParent [status=empHealthstatus]").not('[name=initialvalue],[status="Active"],[status="Inactive"],[keyname="code"]').each(function(){optionsArray[i++]=$(this).attr("id"),""==optionsArray[i-1]&&(pickListOptions.value=$(this).val().trim(),pickListOptions.seqNo=i)}),pickListOptions.optionsArray=optionsArray}else if("initialvalue"==$(obj).attr("name")){var prevval=$(obj).attr("savedvalue");updParams.initialvalue="on"==prevval?"":$(obj).parents("[keyname=initialvalue]").siblings("input").val().trim()}else pickListOptions.value=$(obj).val().trim(),""!=$(obj).attr("id")?(pickListOptions.optionId=$(obj).attr("id"),$(obj).parent("[name=choiceDiv]").find("[name=initialvalue]").is(":checked")&&(updParams.initialvalue=pickListOptions.value)):pickListOptions.seqNo=parseInt($(obj).parents("[name=choiceDiv]").prevAll("[name=choiceDiv]").length)+1}jQuery.isEmptyObject(pickListOptions)||(updParams.pickListOptions=pickListOptions)}else if(fcType==fieldType.FORMULA&&"formula"==propName){var par={fcid:fcoid,isupdate:"true"};$(obj).parents("#fieldProperties").find("[name=propertyDiv]").each(function(){var keynameDiv=$(this).find("[keyname]");propName=$(keynameDiv).attr("keyname"),propVal=$(keynameDiv).val(),"textarea"==$(keynameDiv).attr("type")&&(propVal=$(keynameDiv).text()),par[propName]=propVal});var formidParam=null!=Layout.Page.container.find("#fieldProperties").attr("tabformid")?Layout.Page.container.find("#fieldProperties").attr("tabformid").match(/[\d]+$/).toString():Layout.Page.container.attr("id").match(/[\d]+$/).toString();formCustom.fieldAction(null,["getformulafields",par,formidParam])}else{if(!(fcType!=fieldType.LOOKUP&&fcType!=stringField.LOOKUP||void 0!=propName&&"dispFcid"!=propName&&"separator"!==propName))return formCustom.lookupUpdate(obj,updParams),!1;if("relatedFields"==propName){if(null==propVal)propVal=[];else{if(propVal.length>LookupFilterRule.maxAllowedLookupRelField&&propVal.length>LookupFilterRule.lookupRelFieldLength)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxlimitrelfields")),!1;propVal.length<LookupFilterRule.lookupRelFieldLength?LookupFilterRule.lookupRelFieldLength--:LookupFilterRule.lookupRelFieldLength++,LookupFilterRule.relfieldMap.relFieldsList=propVal}propVal=propVal.toString()}"checkbox"==$(obj).attr("type")&&(propVal=$(obj).is(":checked").toString()),updParams[propName]=propVal,"custom"==$(obj).attr("name")&&(updParams.autofill="6"),"childEnabled"!=propName&&"childName"!=propName||(updParams.childFcid=$(obj).parents('[name="addressChildDiv"]').attr("childid"))}updParams.isupdate="true",formCustom.fieldAction(null,["updField",updParams])}},choiceActions:function(func,obj){if("add"==func){var isduplicate=!1,isEmployeeStatus="empStatusAdd"===$(obj).attr("name"),fieldsDiv=$(obj).parents("#choiceParent, #displayFields").find("[name=choiceDiv],[name=addfield]");if($(fieldsDiv).each(function(){"choiceDiv"===$(this).attr("name")?""==$(this).find("[elem=choiceValue][savedvalue]").val()&&(isduplicate=!0):""===$(this).attr("seq")&&(isduplicate=!0)}),isduplicate)Layout.Page.container.find('#fieldProperties #choiceParent [seq=""]')[0].scrollIntoView({behavior:"smooth"});else{var cloneDiv=$(obj).parents("[name=choiceDiv],[name=addfield]").clone(),changeDiv="";if("choiceDiv"===$(cloneDiv).attr("name"))if(isEmployeeStatus){var clone=$(cloneDiv);clone.find("input[type=radio]").attr("name","new").prop({disabled:!1}),clone.find(".emp_status span").hide(),clone.find(".emp_status input").removeClass("hide").trigger("focus"),clone.find("input[type=radio][status=Inactive]").prop({checked:!0}),clone.find("input[type=radio]").prop({disabled:!0}),clone.find("[name=deleteOption]").show()}else $(cloneDiv).find("[name=initialvalue]").prop({checked:!1,disabled:!0});if($(obj).parents("[name=choiceDiv],[name=addfield]").after(cloneDiv),"choiceDiv"===$(cloneDiv).attr("name"))$(cloneDiv).attr({seq:"",sysVal:0}),$(cloneDiv).find("input[savedvalue]").val(""),$(cloneDiv).find("input[savedvalue],[name=deleteOption]").attr({savedvalue:"",onclick:"",onchange:"",id:"",value:""}),$(cloneDiv).find('input[keyname="code"]').attr("disabled",!0),changeDiv=$(cloneDiv).find("input[savedvalue]");else{""===$(cloneDiv).find("input[keyname=separator]").val()&&$(cloneDiv).find("input[keyname=separator]").val("-").prop("disabled",!1),$(cloneDiv).attr("seq","");var id=$(obj).parents("[name=addfield]").find("select").val();$(cloneDiv).find("select#FormFlds").siblings("div").not("[ autoGenerated=false]").remove(),$(cloneDiv).find("select").val(id),$(cloneDiv).find("select#FormFlds").select2(),$(cloneDiv).find("input[keyname=separator],[name=deleteOption]").attr({onchange:"",onclick:""}),changeDiv=$(cloneDiv).find("input[keyname=separator]")}$(cloneDiv).find("[name=addIcon]").prop({disabled:!0}),$(cloneDiv).find("input[savedvalue]").trigger("focus"),$(cloneDiv).find("[name=deleteOption]").off().on("click",function(event){tabAndFormsCustom.forSaveForm.isChange?tabAndFormsCustom.forSaveForm.isClick=!0:formCustom.choiceActions("remove",$(event.target))}),$(changeDiv).off().on("change",function(event){tabAndFormsCustom.forSaveForm.isChange=!0,formCustom.editField(this)}),formCustom.optionsSort()}}else if("remove"==func){var choiceObj=$(obj).parents("[name=choiceDiv],[name=addfield]"),sysVal=(isEmployeeStatus="deleteEmpStatus"===$(obj).attr("id"),parseInt($(choiceObj).attr("sysVal")));if("choiceDiv"==$(choiceObj).attr("name")&&void 0!=$(choiceObj).attr("sysVal")&&(isEmployeeStatus&&sysVal>0||!isEmployeeStatus&&0!=sysVal))ZPeople.confirm(null,"","zp.systemoptiondelete","",!0);else if(""!==$(choiceObj).attr("seq")){var prev=null;((prev=$(choiceObj).prevAll("[name=choiceDiv],[name=addfield]").not('[seq=""], :hidden')).length>0||(prev=$(choiceObj).nextAll("[name=choiceDiv],[name=addfield]").not('[seq=""], :hidden')).length>0)&&("choiceDiv"===prev.attr("name")?$(choiceObj).find("input[name=initialvalue]").is(":checked")?(ZPeople.confirm(null,"",ZPI18N.getString("zp.deleteintialvalueoption")+" "+ZPI18N.getString("zp.deleteconfirm"),"",!1,!0),$("#confirmConfirmationPopup").on("click",function(){$(choiceObj).fadeOut("slow"),formCustom.editField(obj,prev)})):($(choiceObj).fadeOut("slow"),formCustom.editField(obj,prev)):formCustom.editField(obj))}else $(choiceObj).remove()}else if("bulkAdd"==func){if(Layout.Page.container.find('#choiceParent [seq=""]').length>0)return ZPeople.confirm(null,"","zp.emptyoption","",!0),!1;var optionsModal=ZPeople.createModalPopup("bulkAdd",ZPI18N.getString("zp.addbulkoptions"),",modal-xs");optionsModal.find("#bodyTag").html('<div class="row"><div class="col-md-12" errorDiv="cantbeempty"><textarea rows="16" class="form-control " placeholder="Please enter your options one below the other"></textarea></div></div>'),optionsModal.find("[buttonname=done]").off(),optionsModal.find("[buttonname=done]").on("click",function(){$(this).addClass("disabled"),errorFunction.removeErrorSpan(optionsModal);var options=$(optionsModal).find("textarea").val().trim().split("\n");options=options.filter(function(e){return e});var success=!0;if($.each(options,function(i,item){if($.inArray(item,options)!=i)return optionsModal.find("[buttonname=done]").removeClass("disabled"),errorFunction.errorSpanAttach(ZPI18N.getString("zp.duplicateentriesexist"),optionsModal.find("textarea").parent("div")),success=!1}),success){var updParams={fcid:Layout.Page.container.find("#fieldProperties").attr("currentfcid"),isupdate:"true",pickListOptions:{bulkOptions:options}};optionsModal.modal("hide"),formCustom.fieldAction(null,["updField",updParams])}})}},expandContract:function(obj){Layout.Page.container.find(".dvform-builder").hasClass("opn")?(Layout.Page.container.find("#expandDiv").attr("data-original-title",ZPI18N.getString("zp.minimize")),Layout.Page.container.find(".dvadd-field").removeClass("open"),Layout.Page.container.find(".dvform-builder").removeClass("opn"),Layout.Page.container.find("#addFields [isTooltip=true]").tooltip("destroy")):(Layout.Page.container.find("#expandDiv").attr("data-original-title",ZPI18N.getString("zp.maximize")),Layout.Page.container.find(".dvadd-field").addClass("open"),Layout.Page.container.find(".dvform-builder").addClass("opn"),Layout.Page.container.find("#addFields [isTooltip=true]").each(function(){$(this).attr("data-original-title",$(this).attr("zptitle"))}),Layout.Page.container.find("#addFields [isTooltip=true]").tooltip())},deleteSection:function(data,params,others){if(data.isSuccess){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.deletesuccessful"));var parentDiv=$(others.obj).parents("[name=sectionMain]");if($(parentDiv).is("[last]")){var prevSecDiv=$(parentDiv).prev("[name=sectionMain]");$(prevSecDiv).attr("last","last");var sId=$(prevSecDiv).find("[name=sectionDiv]").attr("secid"),nxtDiv=$(prevSecDiv).nextAll("[tabtype=normal][secid="+sId+"]");$(parentDiv).remove(),$(nxtDiv).length>0&&formCustom.columnDivCss(!1,$($(prevSecDiv).parents("[name=sectionMain]")))}else $(parentDiv).remove();formCustom.emptySectionCheck()}else{if(data.isAnRepsConfig){var searchElem=Layout.Page.container;return ZPeople.BSModal.get({id:"reportDeleteAlert",type:3,header:ZPI18N.getString("zp.alert"),closeOnSubmit:!0,removeModalClass:"DelMdl",iconParenClass:"orgbgi",iconClass:"IC-alert",bodyClass:"dvExecutescript",buttonValue:ZPI18N.getString("zp.close"),successCallback:function(){}}),searchElem.find("#reportDeleteAlert .modal-body").html('<div class="row"><div class="col-md-12"><div id="reportDeleteAlertBody" class="dvinfo"><p>'+ZPI18N.getString("zp.reports.removetabsecfieldsfromreports")+"</p></div></div></div>"),$.each(data.depReps,function(index,depRepObj){searchElem.find("#reportDeleteAlertBody").append("<p>"+(index+1)+". "+ZSEC.Encoder.encodeForHTML(depRepObj.ZPREPORTDISPLAYNAME)+"</p>")}),searchElem.find("#reportDeleteAlert #zp_modal_blubtn").siblings().remove(),void searchElem.find("#reportDeleteAlert").modal("show")}""!=data.message.trim()&&ZPeople.confirm(null,"",data.message.trim(),"",!0,!0)}},insertDate:function(){var currentTime=new Date,month=currentTime.getMonth()+1,day=currentTime.getDate(),year=currentTime.getFullYear();switch(month){case 1:monthName="Jan";break;case 2:monthName="Feb";break;case 3:monthName="Mar";break;case 4:monthName="Apr";break;case 5:monthName="May";break;case 6:monthName="Jun";break;case 7:monthName="Jul";break;case 8:monthName="Aug";break;case 9:monthName="Sep";break;case 10:monthName="Oct";break;case 11:monthName="Nov";break;case 12:monthName="Dec"}var todayDate="'"+day+"-"+monthName+"-"+year+"'";formCustom.insertIntoExpression(todayDate)},spinnerJs:function(){Layout.Page.container.find("input[ftype=number]").spinner(),Layout.Page.container.find("input[ftype=number]").off("mousewheel")},numberFocus:function(obj){$(obj).off(),$(obj).on("change",function(){"maxsize"==$(obj).attr("keyname")?formCustom.fileMaxSize(obj):formCustom.numberNumber(obj),$(obj).off("focusout")}),$(obj).on("focusout",function(){"maxsize"!=$(obj).attr("keyname")&&formCustom.numberNumber(obj)})},numberNumber:function(obj){var attrVal=$(obj).attr("savedValue"),v=$(obj).val();if(attrVal!=v){if(""!=v&&!/^-?\d*\.?\d+$/.test(v))return ZPeople.confirm(null,"","zp.enteravalidnumber","",!0),void $(obj).val(attrVal);var fieldType=$(obj).parents("#fieldProperties").find("[keyname=fieldtype]").val();formCustom.fieldValidation(v,$(obj).attr("keyname"),fieldType,obj)?$(obj).val(attrVal):formCustom.editField($(obj))}},fileMaxSize:function(obj){var attrVal=$(obj).attr("savedValue"),v=$(obj).val();if(""!=v&&!/^((\d*(\.\d{0,1})?)\s(KB|MB))$/i.test(v))return ZPeople.confirm(null,"","zp.filesizevalidformat","",!0),void $(obj).val(attrVal);var fieldType=$(obj).parents("#fieldProperties").find("[keyname=fieldtype]").val();formCustom.fieldValidation(v,$(obj).attr("keyname"),fieldType,obj)?$(obj).val(attrVal):formCustom.editField($(obj))},optionsSort:function(){var a=Layout.Page.container.find("#fieldProperties").find("[name=dragicon]");Layout.Page.container.find("#fieldProperties #displayFields [name=addfield]").length>1?Layout.Page.container.find("#fieldProperties #displayFields").sortable({handle:$(a),stop:function(event,ui){var el=ui.item;if(0==$(el).prev("[name=addfield]").length){var separator=$(el).find("[keyname=separator]").val();$(el).find("[keyname=separator]").val("").prop("disabled",!0),$(el).next("[name=addfield]").find("[keyname=separator]").val(separator).prop("disabled",!1)}else if(1==$(el).find("[keyname=separator]").prop("disabled")){separator=$(el).prev("[name=addfield]").find("[keyname=separator]").val();$(el).find("[keyname=separator]").val(separator).prop("disabled",!1),$("#displayFields [keyname=separator]").first().val("").prop("disabled",!0)}formCustom.editField(el,!0)}}):Layout.Page.container.find("#fieldProperties #choiceParent").sortable({handle:$(a),stop:function(event,ui){var el=ui.item;formCustom.editField(el,!0)}})},addNotesPopup:function(params,fid,data){var addNotesDiv=ZPeople.createModalPopup("addNotesPopup",ZPI18N.getString("zp.addnotes"),"modal-md",[params.hasOwnProperty("isGrid"),params.fieldtype]);if(addNotesDiv.find("#notestextarea"+fid).length<=0){var notesDiv='<div class="row ML0"><div class="col-md-6" errordiv="cantbeempty"><div class="col-md-4 PL0 "><label class="MT5">Display Name</label></div><div class="col-md-7"><div class="form-group" errordiv="cantbeempty"><input value="Formula" type="text" keyname="displayname" class="form-control" ></div></div></div>';notesDiv+='<div class="col-md-6"><div class="col-md-4 PL0"><label class="control-label MT5">Label Name</label></div><div class="col-md-7"><div class="form-group" errordiv="cantbeempty"><input type="text" class="form-control" keyname="labelname" disabled="disabled"></div></div><div class="col-md-1 PL0"><span data-content="'+ZPI18N.getString("zp.labelnamecharactersallowed")+'" data-placement="bottom" data-trigger="hover" data-toggle="popover" class="IC-info FL MT5" data-original-title="" title=""></span></div></div></div>',notesDiv+='<div  errordiv="cantbeempty" id="notesDiv"><div class="msgpreview-outer msgpreview clearfix"><div id="notestextarea'+fid+'" class="fieldn"></div></div></div>',addNotesDiv.find("#bodyTag").html(notesDiv)}else addNotesDiv.find("#notestextarea"+fid).html("");AutomationCommon.createEditor("notestextarea"+fid),editor.setContent(data);var name=formCustom.fieldTypeCount(stringField.PLAINTEXT,ZPI18N.getString("zp.notes"));if(void 0!=params.displayname?$(addNotesDiv).find("[keyname=displayname]").val(params.displayname):$(addNotesDiv).find("[keyname=displayname]").val(name),$(addNotesDiv).find("[keyname=displayname]").off(),void 0!=params.labelname)$(addNotesDiv).find("[keyname=labelname]").attr("disabled",!0),$(addNotesDiv).find("[keyname=labelname]").val(params.labelname);else{$(addNotesDiv).find("[keyname=labelname]").prop("disabled",!1);var labelname=/^[\w\s]*$/.test(name)?name.replace(/\s|-/g,"_").replace(/_+/g,"_"):$("#addFields").find("[typeid="+stringField.PLAINTEXT+"]").attr("label");$(addNotesDiv).find("[keyname=labelname]").val(labelname),formCustom.changeLabel($(addNotesDiv).find("[keyname=displayname]"),$(addNotesDiv).find("[keyname=labelname]"))}$(addNotesDiv).find("[buttonname=done]").off(),$(addNotesDiv).find("[buttonname=done]").on("click",function(){$(this).addClass("disabled");var text=editor.getContent();errorFunction.removeErrorSpan(Layout.Page.container.find("#addNotesPopup"));var tmpDiv=document.createElement("DIV");if(tmpDiv.innerHTML=text,""==(tmpDiv.textContent||tmpDiv.innerText||"").trim())errorFunction.errorSpanAttach(ZPI18N.getString("zp.emptynoteserror"),$(addNotesDiv).find("#notestextarea"+fid).parents("[errordiv]")),$(this).removeClass("disabled"),Layout.Page.container.find("#addNotesPopup #notesDiv [name=errorSpan]").addClass("ML10");else if(0!=formCustom.checkDisplayandLabelName(addNotesDiv)){var appendText="";/<\/div>$/.test(text)&&(text=text.replace(/<\/div>$/,""),appendText="</div>"),text=(text=(text=text.replace(/(<br>\s*)+$/g,"")+appendText).replace(/<ul>/,'<ul class="uleditorsty">')).replace(/<ol>/,'<ol class="oleditorsty">'),params.plainTextvalue=text,params.displayname=$(addNotesDiv).find("[keyname=displayname]").val(),params.labelname=$(addNotesDiv).find("[keyname=labelname]").val(),$(addNotesDiv).modal("hide"),formCustom.fieldAction(null,["updField",params])}})},editNotes:function(obj){var par={fcid:$(obj).parents("#fieldProperties").attr("currentfcId"),isupdate:"true",displayname:$(obj).parents("#fieldProperties").find("[keyname=displayname]").val(),labelname:$(obj).parents("#fieldProperties").find("[keyname=labelname]").val()};formCustom.addNotesPopup(par,Layout.Page.container.attr("id").match(/[\d]+$/).toString(),$(obj).html())},select2ForSelectBox:function(id,lookUp){0!=$(id).find("#setFilderCri").length&&!0!==lookUp||(id.find("select.selectTag").select2({width:"100%"}),id.find("select.selectTagLimit").select2({maximumSelectionLength:3,width:"100%"}),id.find("select.selectBox").select2({width:"100%"}),id.find("select.hideSearch").select2({width:"100%",minimumResultsForSearch:1/0}))},showChangeInField:function(obj){var activeField=Layout.Page.container.find("[div=fielddiv].active");"autoNumberName"==$(obj).attr("keyname")&&(activeField=Layout.Page.container.find("div[type="+fieldType.AUTONUMBER+"]")),$(activeField).children("label").text($(obj).val())},editAutoFill:function(obj){var toShow=$(obj).parent("[name=propertyDiv]").next("[name=customautofill]");6==$(obj).val()?$(toShow).slideDown():($(toShow).find("[name=custom]").val(""),$(toShow).slideUp(),formCustom.editField(obj))},elementFocused:function(obj){var originalVal=$(obj).val(),keyname=$(obj).attr("keyname");$(obj).off(),"displayname"!=keyname&&"autoNumberName"!=keyname||$(obj).on("input",function(e){formCustom.showChangeInField(obj)}),$(obj).on("change",function(event){$(obj).attr("savedvalue",originalVal),""==$(obj).val().trim()?"autoNumberName"==keyname?(ZPeople.confirm(null,"","zp.autonumbernamecantbeemptyerror","",!0),$(obj).val($(obj).attr("savedvalue")),formCustom.showChangeInField(obj)):(ZPeople.confirm(null,"","zp.displaynamecannotbeempty","",!0),$(obj).val($(obj).attr("savedvalue")),formCustom.showChangeInField(obj)):"autoNumberName"==keyname?formCustom.editForm(null,null,{obj:obj,forPost:!0}):formCustom.editField(obj)})},editDateTimeAutoFill:function(){var fcoid=Layout.Page.container.find("#fieldProperties").attr("currentfcid"),obj=Layout.Page.container.find("#fieldProperties [name=customautofill] input"),propVal=$(obj).val(),updParams={fcid:fcoid,object:obj,autofill:"6"};if(propVal!=$(obj).attr("value")){updParams[$(obj).attr("keyname")]=propVal,updParams.isupdate="true",formCustom.fieldAction(null,["updField",updParams])}},formNameChange:function(obj){var keyname=$(obj).attr("keyname");$(obj).off(),$(obj).on("input",function(e){$(obj).parents("#fieldProperties").attr("currentfcid");var activeField=Layout.Page.container.find("[name=selectedForm] span");$(activeField).text($(obj).val())}),$(obj).on("change",function(){if("formlabel"==keyname&&""==$(obj).val().trim()){var originalVal=$(obj).attr("value");Layout.Page.container.find("#dvfrmlisting span").text(originalVal),$(obj).val(originalVal),ZPeople.confirm(null,"","zp.formnamenotemptyerror","",!0)}else $("#accordion").find("#"+Layout.Page.container.attr("id").match(/[\d]+$/)).find("a[href]").text($(obj).val()),$(obj).attr("value",$(obj).val()),formCustom.editForm(null,null,{obj:obj,forPost:!0})})},toggleFieldEditMode:function(obj){$(obj).siblings("label").is(":visible")?($(obj).hide(),$(obj).siblings("[name=sectionName]").hide(),$(obj).siblings("input").show(),$(obj).siblings("input").off(),$(obj).siblings("input").trigger("select"),formCustom.editSectionName($(obj).siblings("input"))):($(obj).hide(),$(obj).siblings("[name=sectionName],[name=editIcon]").show())},editSectionName:function(obj,ischange){$(obj).on("change",function(){params={sectionId:$(obj).parents("[name=sectionDiv]").attr("secid"),sectionName:$(obj).val(),method:"editSection"},ZPeople.Request.send("/sectionActions.zp",params,formCustom.fieldActionResponse,{method:"editSectionName",obj:obj},formCustom.failureCallBack),formCustom.toggleFieldEditMode(obj),$(obj).off("focusout")}),$(obj).on("focusout",function(){formCustom.toggleFieldEditMode(obj)})},sectionEditActions:function(data,params){if(data.indexOf("</div>")>=0){Layout.Page.container.find("[div=fielddiv]").removeClass("active"),formCustom.openTab("#formProperties");var secMainDiv=$("div[name=sectionDiv][secid="+params.sectionId+"]").parents("[name=sectionMain]");$(secMainDiv).replaceWith(data),formCustom.dragAndDropFld(),formCustom.tabularCss(Layout.Page.container.find("div[secid="+params.sectionId+"] ul[name=tabularFields] li")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))}else""!=(data=JSON.parse(data)).msg.trim()&&ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0)},minimiseTab:function(isminimise){isminimise?$("#ZPwrapper").addClass("minimized-view"):$("#ZPwrapper").removeClass("minimized-view")},customiseHeader:function(data,params,others){if(Layout.Page.container.find("#customiseheader #reorderList").empty().siblings("div").remove(),data.isSuccess){var customiseheader=ZPeople.createModalPopup("customiseheader",ZPI18N.getString("zp.customiseheader"),"");if(customiseheader.find("#reorderList").length<=0&&customiseheader.find("#bodyTag").append("<div id='reorderList' class='dvtabsfrm'></div>"),jQuery.isEmptyObject(data.fieldDetails))jQuery("<div></div>",{class:"text-center red",text:ZPI18N.getString("zp.emptytabularsection")}).insertBefore(customiseheader.find("#reorderList"));else{customiseheader.find("#reorderList").append(jQuery("<ul></ul>",{id:"customiseHeader",secid:params.sectionId,class:"chglist"})),$.each(data.fieldDetails,function(i,item){var liclass="list-group-item";if(item.fcIsHidden&&(liclass+=" disabled"),customiseheader.find("#customiseHeader").append(jQuery("<li></li>",{class:liclass,id:item.fcID,fctype:item.fcType})),item.fcType==ZPForm.Field.IMAGE||item.fcType==ZPForm.Field.FILE_UPLOAD||item.isEncrypted||customiseheader.find("#customiseHeader li#"+item.fcID).append($("<div class='sort_wrap"+(0!=item.sortOpt?" open":" DN")+"' name='sortOpt' "+(0!=item.sortOpt?"optselected='true'":"")+"><a type='"+(0!=item.sortOpt?item.sortOpt:"1")+"' onclick='formCustom.setSortOpt(this)'>"+(2==item.sortOpt?"DSEC":"ASC")+"</a><i class='IC-cls-1px red' onclick='formCustom.removeSortOpt(this)'></i></div>")),!item.fcIsSystemField||item.fcIsDisableable){var btnDiv=jQuery("<div></div>",{class:"btnactive"}).append(jQuery("<input>",{type:"checkbox",id:"chk"+(parseInt(i)+1),class:"cmn-toggle-small cmn-toggle-round-small",checked:!item.fcIsHidden}));$(btnDiv).append(jQuery("<label></label>",{for:"chk"+(parseInt(i)+1)})),customiseheader.find("#customiseHeader li#"+item.fcID).append(jQuery("<div></div>",{class:"dvswitch",name:"switchdiv"}),jQuery("<div></div>")),customiseheader.find("#customiseHeader li#"+item.fcID+" div[name=switchdiv]").append(btnDiv)}else customiseheader.find("#customiseHeader li#"+item.fcID).append(jQuery("<div></div>"));if(item.isSumAllowed){var activeClass=item.isSum?"active":"",title=item.isSum?ZPI18N.getString("zp.disable"):ZPI18N.getString("zp.enable");customiseheader.find("#customiseHeader li#"+item.fcID).append(jQuery("<a></a>",{class:"IC-sum btnsum ZPtitle "+activeClass,id:"sum"+(parseInt(i)+1),istooltip:!0,title:title}))}customiseheader.find("#customiseHeader li#"+item.fcID).children("div:not([name=switchdiv],[name=sortOpt])").append(jQuery("<span></span>",{class:"IC-drag MR10",name:"dragicon"}),jQuery("<span></span>",{html:item.fcLabel})),customiseheader.find("#customiseHeader li#"+item.fcID).on("mouseover",function(){customiseheader.find("#customiseHeader li#"+item.fcID).find("div[name=sortOpt]").removeClass("DN")}),customiseheader.find("#customiseHeader li#"+item.fcID).on("mouseout",function(){customiseheader.find("#customiseHeader li#"+item.fcID).find("div[name=sortOpt]").not("[optselected]").addClass("DN")})}),Layout.Page.container.not("#addFields").find("[isTooltip=true]").not("[data-original-title]").tooltip({placement:"bottom"});params={};var secid=customiseheader.find("ul#customiseHeader").attr("secid"),url="/customizeTabularSection.zp";customiseheader.find("#customiseHeader").sortable({handle:customiseheader.find("#customiseHeader [name=dragicon]"),containment:customiseheader.find(".modal-content")}),customiseheader.find("a[buttonname=done]").off(),customiseheader.find("a[buttonname=done]").on("click",function(){$(this).addClass("disabled");var uldiv=$(this).parents("#customiseheader").find("#customiseHeader"),fieldOrder="";$(uldiv).find("li").each(function(){fieldOrder+=$(this).attr("id")+","}),fieldOrder=fieldOrder.substring(0,fieldOrder.length-1),(params={}).currentFieldOrder=fieldOrder,params.sectionId=secid,params.mode="tabularsection.reorder",ZPeople.Request.send(url,params,formCustom.sortTabFields,{obj:this},formCustom.failureCallBack)}),customiseheader.find("#customiseHeader input[id*=chk]").on("click",function(){params={};var fcid=$(this).parents("li").attr("id");params.attrId=fcid,params.mode="tabularsection.enable",params.sectionId=secid,ZPeople.Request.send(url,params,formCustom.enableDisableTabularField,{obj:this},formCustom.failureCallBack)}),customiseheader.find("#customiseHeader a[id*=sum]").on("click",function(){(params={}).attrId=$(this).parents("li").attr("id"),params.mode="tabularsection.summation",ZPeople.Request.send(url,params,formCustom.isSum,{obj:this},formCustom.failureCallBack)})}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionsectionnoedit"))},setSortOpt:function(obj){var type=$(obj).attr("type"),optSelected=$(obj).parent().attr("optselected"),parentobj=$(obj).parent(),ele=Layout.Page.container.find("[optselected]").not(parentobj);if(ele.length>0&&formCustom.removeSortOpt($(ele).children("i")),optSelected){var txt=1==(type=1==type?2:1)?"ASC":"DSEC";$(obj).attr("type",type),$(obj).html(txt)}params={},params.type=type,params.fcid=Layout.Page.container.find(obj).closest("li").attr("id"),params.mode="tabularsection.enableDisableSort",params.isEnable=!0,params.conreqcsr=csrfToken,$.post("/customizeTabularSection.zp",params,function(data){null!=data&&"Success"==data.msg?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")):null!=data&&"extensionfield"==data.msg.trim()?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionfieldnoedit")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}),$(obj).parent().attr("optselected","true"),$(obj).parent().addClass("open")},removeSortOpt:function(obj){params={},params.fcid=Layout.Page.container.find(obj).closest("li").attr("id"),params.mode="tabularsection.enableDisableSort",params.isEnable=!1,params.conreqcsr=csrfToken,$.post("/customizeTabularSection.zp",params,function(data){null!=data&&"Success"==data.msg?($(obj).parent().removeAttr("optselected"),$(obj).parent().removeClass("open"),$(obj).parent().addClass("DN"),$(obj).siblings("a").attr("type",1),$(obj).siblings("a").html("ASC"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))):null!=data&&"extensionfield"==data.msg.trim()?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionfieldnoedit")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))})},enableDisableTabularField:function(data,params,others){if(Layout.Page.container.find("#customiseheader #reorderList").siblings("div").remove(),"success"==data.msg.trim()){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),formCustom.customValidation[Layout.Page.container.attr("formId")].refresh=!0;var fldDiv=Layout.Page.container.find("#dispName"+params.attrId);$(fldDiv).parents("[name=tabularFld]").is(":visible")?($(fldDiv).parents("[name=tabularFld]").hide(),$(others.obj).parents("li").addClass("disabled"),formCustom.removeZPFormFormComponentData("form")):($(fldDiv).parents("[name=tabularFld]").show(),$(others.obj).parents("li").removeClass("disabled"),formCustom.removeZPFormFormComponentData("form")),formCustom.emptySectionCheck(),formCustom.tabularCss($(fldDiv).parents("[name=tabularFields]"),null)}else if("triggerField"==data.msg.trim()){var label=$("#dispName"+params.attrId).find("label[dispname]").html();ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.fieldusedintriggerCv",[label])),$(others.obj).prop("checked",!$(others.obj).is(":checked"))}else if("formula"==data.msg.trim()){label=$("#dispName"+params.attrId).find("label[dispname]").html();ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.fieldusedinformulaerror",[label,label])),$(others.obj).prop("checked",!$(others.obj).is(":checked"))}else"extensionfield"==data.msg.trim()?(ZPeople.confirm(null,"",ZPI18N.getString("zp.extensionfieldnoedit"),"",!0,!0),$(others.obj).prop("checked",!$(others.obj).is(":checked"))):""!=data.msg.trim()&&(jQuery("<div></div>",{class:"PB15 text-center red",text:data.msg.trim()}).insertBefore($("#reorderList:visible")),$(others.obj).prop("checked",!$(others.obj).is(":checked")))},sortTabFields:function(data,params,others){var uldiv=$(others.obj).parents("#customiseheader").find("#customiseHeader");Layout.Page.container.find("#customiseheader").modal("hide");params.currentFieldOrder.split(",");uldiv=Layout.Page.container.find("[name=sectionDiv][secid="+$(uldiv).attr("secid")+"] ul[name=tabularFields] li");var ulclone=$(uldiv).clone();$(uldiv).empty(),params.currentFieldOrder.split(",").forEach(function(fld){var fldClone=$(ulclone).find("#dispName"+fld).parents("[name=tabularFld]").clone();$(uldiv).append(fldClone)}),$(others.obj).removeClass("disabled"),formCustom.fieldOnClick(),formCustom.emptySectionCheck(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))},isSum:function(data,params,others){Layout.Page.container.find("#customiseheader #reorderList").siblings("div").remove(),$.inArray(data.msg.trim(),["true","false"])>-1?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),Layout.Page.container.find("ul#customiseHeader li#"+params.attrId+" a[id*=sum]").toggleClass("active"),$(others.obj).attr("data-original-title","false"==data.msg.trim()?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable")).tooltip("show")):""!=data.msg.trim()&&("extensionfield"==data.msg.trim()?ZPeople.confirm(null,"",ZPI18N.getString("zp.extensionfieldnoedit"),"",!0,!0):ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0))},formListingComponentsFetch:function(obj){if($("body").children("#dvfrmlstcontent").length<=0)$("body").append('<div id="dvfrmlstcontent" class="DN"><div class="tabvertical">'+formCustom.loadingDiv+"</div></div>"),$(obj).popover(),ZPeople.Request.send("/formListingComponentsFetch.zp",{method:"formListingComponentsFetch"},formCustom.fieldActionResponse,{method:"formListingComponentsFetch"},formCustom.failureCallBack);else{$("body #dvfrmlstcontent div[tabid]").removeClass("active"),$("body #dvfrmlstcontent div[tabid] li").removeClass("sel"),$("body #dvfrmlstcontent div[name=leftTab] li[role=presentation]").removeClass("active");var formid=0;formid=Layout.Page.container.attr("id").endsWith("formlinkname")?ZPUtil.Form_Link_Names.getFormLinkName(window.location.href.split(":").pop().toString(),!1):Layout.Page.container.attr("id").match(/[\d]+$/).toString();var tabId=$("body div[name=rightTab]").find("a[formid="+formid+"]").parents("[tabid]").attr("tabid");$("body #dvfrmlstcontent div[tabid="+tabId+"]").addClass("active"),$("body #dvfrmlstcontent li[tabid="+tabId+"]").addClass("active"),$("body #dvfrmlstcontent div[tabid="+tabId+"] a[formid="+formid+"]").parent("li").addClass("sel")}},autoNumberPopup:function(data,params,others){var obj=others.obj,formId=Layout.Page.container.attr("id").match(/[\d]+$/).toString(),element=document.getElementById("autonumrst"+formId);if(Layout.Page.container.find('[keyname="enableautonumber"]').prop("checked")?element.classList.remove("disabled"):element.classList.add("disabled"),$(obj).is(":checked")&&"true"==$(obj).parents("#formProperties").attr("isFirst"))if(others.hasOwnProperty("forPost")){if((autonumberDiv=ZPeople.createModalPopup("autonumberPopup",ZPI18N.getString("zp.autonumber"),"modal-xs")).find("#bodyTag input").length<=0){autonumberDiv.find("#bodyTag").append('<div class="row" id="appendTo"></div>');var nameTemp=formCustom.createInputFromTemplate("autoNumberName",ZPI18N.getString("zp.name")),prefixTemp=formCustom.createInputFromTemplate("prefix",ZPI18N.getString("zp.prefix")),startsFromTemp=formCustom.createInputFromTemplate("startsFrom",ZPI18N.getString("zp.startsfrom"));autonumberDiv.find("#bodyTag #appendTo").append($(nameTemp),$(prefixTemp),$(startsFromTemp))}autonumberDiv.find("#appendTo [keyname=startsFrom]").val(1),autonumberDiv.find("[buttonname=done]").off(),autonumberDiv.find("[buttonname=done]").on("click",function(){if($(this).addClass("disabled"),""==autonumberDiv.find("input[keyname=autoNumberName]").val().trim())errorFunction.errorSpanAttach(ZPI18N.getString("zp.autonumbernamecantbeemptyerror"),autonumberDiv.find("input[keyname=autoNumberName]").parent("div")),$(this).removeClass("disabled");else{autonumberDiv.modal("hide");var params={formId:Layout.Page.container.attr("id").match(/[\d]+$/).toString(),mode:"renameform",method:"formCustOperations"};autonumberDiv.find("[name=propertyDiv]").each(function(){var keynameDiv=$(this).find("[keyname]");keyname=$(keynameDiv).attr("keyname"),keyval=$(this).children("[keyname]").val(),params[keyname]=keyval}),params.enableautonumber=!0,params.isFirstTime=!0,ZPeople.Request.send("/formCustOperations.zp",params,formCustom.autoNumberPopup,{obj:obj},formCustom.failureCallBack)}}),autonumberDiv.find("[buttonaction=dismiss]").off(),autonumberDiv.find("[buttonaction=dismiss]").on("click",function(){$(obj).prop("checked",!1)})}else{var div=Layout.Page.container.find("#formProperties");if(data.toString().indexOf("</div>")>=0){$(div).attr("isFirst",!1);var firstComponent=$("[id*=admin-formslayout-formedit-]:visible [name=formcomponentDiv]").first();firstComponent.length>0?$(data).insertAfter(firstComponent):$("[id*=admin-formslayout-formedit-]:visible [tabtype=normal]").first().append(data),$(div).find("[name=autonumberDiv]").slideDown(),$(div).find("[name=autonumberDiv] [keyname=autoNumberName]").val(params.autoNumberName),$(div).find("[name=autonumberDiv] [keyname=prefix]").val(params.prefix),$(div).find("[name=autonumberDiv] [keyname=startsFrom]").val(""!=params.startsFrom?params.startsFrom:1),formCustom.dragAndDropFld(),$(data).on("click",function(e){formCustom.openTab("#formProperties")}),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))}else""!=data.msg.trim()&&("extensionform"==data.msg.trim()?ZPeople.confirm(null,"",ZPI18N.getString("zp.extensionformnoedit"),"",!0,!0):ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0),$(obj).prop("checked",!$(obj).is(":checked"))),$(this).removeClass("disabled")}else if(others.hasOwnProperty("isReset")){var autonumberDiv;if((autonumberDiv=ZPeople.createModalPopup("autonumberPopup",ZPI18N.getString("zp.resetautonumber"),"modal-xs")).find("#bodyTag input").length<=0){autonumberDiv.find("#bodyTag").append('<div class="row" id="appendTo"></div>');nameTemp=formCustom.createInputFromTemplate("autoNumberName",ZPI18N.getString("zp.name")),prefixTemp=formCustom.createInputFromTemplate("prefix",ZPI18N.getString("zp.prefix")),startsFromTemp=formCustom.createInputFromTemplate("startsFrom",ZPI18N.getString("zp.startsfrom"));autonumberDiv.find("#bodyTag #appendTo").append($(nameTemp),$(prefixTemp),$(startsFromTemp))}div=Layout.Page.container.find("#formProperties");var autoNumberName=$(div).find("[name=autonumberDiv] [keyname=autoNumberName]").val(),prefix=$(div).find("[name=autonumberDiv] [keyname=prefix]").val(),startsFrom=$(div).find("[name=autonumberDiv] [keyname=startsFrom]").val();autonumberDiv.find("#appendTo [keyname=autoNumberName]").val(autoNumberName),autonumberDiv.find("#appendTo [keyname=prefix]").val(prefix),autonumberDiv.find("#appendTo [keyname=startsFrom]").val(startsFrom),autonumberDiv.find("[buttonname=done]").off(),autonumberDiv.find("[buttonname=done]").on("click",function(){if($(this).addClass("disabled"),""==autonumberDiv.find("input[keyname=autoNumberName]").val().trim())errorFunction.errorSpanAttach(ZPI18N.getString("zp.autonumbernamecantbeemptyerror"),autonumberDiv.find("input[keyname=autoNumberName]").parent("div")),$(this).removeClass("disabled");else{autonumberDiv.modal("hide");var params={formId:Layout.Page.container.attr("id").match(/[\d]+$/).toString(),mode:"renameform",method:"formCustOperations"};autonumberDiv.find("[name=propertyDiv]").each(function(){var keynameDiv=$(this).find("[keyname]");keyname=$(keynameDiv).attr("keyname"),keyval=$(this).children("[keyname]").val(),params[keyname]=keyval}),params.enableautonumber=!0,params.isFirstTime=!1,params.resetAutoNumber=!0,ZPeople.Request.send("/formCustOperations.zp",params,formCustom.resetAutoNumber,{obj:obj},formCustom.failureCallBack)}})}else formCustom.editForm(data,params,others)},resetAutoNumber:function(data,params,others){if("failure"==data.res)ZPeople.Message.showFailureMsg(data.msg);else{var div=Layout.Page.container.find("#formProperties");$(div).find("[name=autonumberDiv] [keyname=autoNumberName]").val(params.autoNumberName),$(div).find("[name=autonumberDiv] [keyname=prefix]").val(params.prefix),$(div).find("[name=autonumberDiv] [keyname=startsFrom]").val(""!=params.startsFrom?params.startsFrom:1);var autoNumFld=Layout.Page.container.find("div[type="+fieldType.AUTONUMBER+"]");$(autoNumFld).children("label").text(params.autoNumberName),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.autonumberresetsuccessful"))}},getFormCustomMainPage:function(data){if(AppFlowPermission.backtoRecordPerm(),!($("#"+Layout.Page.pageId).find("[name=service_form]").length>0)){formCustom.singleformLayout=Layout.Page.pageId.split(/-\d/)[0]+"-";var params=window.location.hash.split("mode-").length>1?{mode:window.location.hash.split("mode-")[1].toString()}:{},formid=Layout.Page.pageId.split("-").pop();formid==ZPeople.EMP_HEALTH_FORMID||formid==ZPeople.WFO_FORMID||formid==ZPeople.VISITOR_FORMID||formid==Task.getTaskFormid()&&ZPeople.isTaskRestricted?formCustom.getFormCustomPage("",params,{formid:formid}):ZPeople.Request.send("/getFormCustomizationMainPage.zp",params,formCustom.getFormCustomPage,{formid:formid},formCustom.failureCallBack)}},getFormCustomPage:function(data,params,others){params={};if(Layout.CustomizedUrl.isService()||Layout.Page.container.find("#formNameHeading").removeClass("DN"),$("[tabid=admin_formslayout].active").length>0&&(others.tabid=$("li[id*=zp_subtab_admin_formslayout_].active").attr("id")),"IAM_SECURITY_ERROR"==$(data).attr("id"))$("[id*="+formCustom.singleformLayout+others.formid+"]").html(data);else{0==$("[id*="+formCustom.singleformLayout+others.formid+"]").find('[name="service_form"]').length&&$("[id*="+formCustom.singleformLayout+others.formid+"]").append('<div class="'+(Layout.CustomizedUrl.isService()?"dvflow_str bgrey dvfrmpos":"")+'" name="service_form">'+data+"</div>"),params.formid=others.formid;others={method:"getFormCustomPage",tabid:$("li[id*=zp_subtab_admin_formslayout_]").first().attr("id")};ZPeople.Request.send("/getFormCustomizationPage.zp",params,formCustom.fieldActionResponse,others,formCustom.failureCallBack)}},showHideRelatedFlds:function(obj){$(obj).parents("#selecttype").siblings("[name=relatedfields]").slideDown(),$.inArray($(obj).val(),[stringField.LIST,stringField.CHECKBOXES])>-1&&$(obj).parents("#selecttype").siblings("[name=relatedfields]").slideUp()},openNewSection:function(isTabular){var sectionDiv=ZPeople.createModalPopup("sectionPopup",ZPI18N.getString("zp.newsection"),"modal-xs");if(sectionDiv.find("#bodyTag input").length<=0){sectionDiv.find("#bodyTag").append('<div class="clearfix parentDiv"></div>');var sectionName=formCustom.createInputFromTemplate("section-name",ZPI18N.getString("zp.sectionname")),sectionDesc='<div class="form-group" id="section-desc"><label for="description-text" class="control-label">'+ZPI18N.getString("zp.description")+'</label><textarea class="form-control" rows="4" id="description-text"></textarea></div>',tabDiv='<div class="form-group DN" id="tabularSec"><label for="description-text" class="control-label">'+ZPI18N.getString("zp.tabulartype")+'</label><div class="input-group"><div class="radio radio-primary PT5" ><input id="grid" name="tabtype" class="check-rht" type="radio" value="1"><label for="grid" class="MR40">'+ZPI18N.getString("zp.grid")+'</label></div><div class="radio radio-primary PT5" ><input checked id="inline" name="tabtype" class="check-rht" type="radio" value="2"><label for="inline" class="MR40">'+ZPI18N.getString("zp.inline")+"</label></div></div></div>";sectionDiv.find("#bodyTag .parentDiv").append($(sectionName),$('<div class="col-md-10"></div>').append($(tabDiv),$(sectionDesc)))}isTabular?(sectionDiv.find("#tabularSec").show(),sectionDiv.find("#grid").prop("checked",!0)):sectionDiv.find("#tabularSec").hide(),sectionDiv.find("[buttonname=done]").off(),sectionDiv.find("[buttonname=done]").on("click",function(){formCustom.sectionActions(this,["newSection"])})},lookupUpdate:function(obj,params){var lookupFlds={};params.refFormId=Layout.Page.container.find("#fieldProperties #ImportForm").val(),lookupFlds.optionId=$(obj).parents("#displayFields").attr("optionId");var addNewFld=!1;if("addfield"===$(obj).attr("name")||""===$(obj).parents("[name=addfield]").attr("seq")?addNewFld=!0:"deleteOption"===$(obj).attr("name")&&"1"===$(obj).parents("[name=addfield]").attr("seq")?(addNewFld=!0,$(obj).parents("[name=addfield]").remove(),obj=Layout.Page.container.find("#fieldProperties [name=addfield]").first(),$(obj).find("[keyname=separator]").val("").prop("disabled",!0)):$(obj).parents("#displayFields").find("[name=addfield]").each(function(){""!==$(this).attr("seq")||(addNewFld=!0)}),addNewFld){var fldsArray=[],i=0;$(obj).parents("#displayFields").find("[keyname=dispFcid]").each(function(){fldsArray[i++]=$(this).val()+","+$(this).parents("[name=addfield]").find("[keyname=separator]").val()}),lookupFlds.fldsArray=fldsArray}else lookupFlds.dispFcid=$(obj).parents("[name=addfield]").find("#FormFlds").val(),lookupFlds.seqNo=$(obj).parents("[name=addfield]").attr("seq"),""==$(obj).parents("[name=addfield]").attr("seq").trim()&&(lookupFlds.seqNo=parseInt($(obj).parents("[name=addfield]").prev("[name=addfield]").attr("seq"))+1),"deleteOption"!==$(obj).attr("name")&&(lookupFlds.separator=$(obj).parents("[name=addfield]").find("[keyname=separator]").val());params.lookupFlds=lookupFlds,params.isupdate="true",formCustom.fieldAction(null,["updField",params])},lookupAdd:function(obj){var cloneDiv=$(obj).parents("[name=addfield]").clone();$(cloneDiv).find("#s2id_FormFlds").remove(),""==$(cloneDiv).find("[keyname=separator]").val()&&$(cloneDiv).find("[keyname=separator]").val("-"),$(cloneDiv).attr("optionId",null),$(cloneDiv).attr("seq",""),$(obj).parents("[name=addfield]").after(cloneDiv),formCustom.select2ForSelectBox(cloneDiv),formCustom.optionsSort(),$(cloneDiv).find("select").off(),$(cloneDiv).find("select").on("change",function(){formCustom.editField(this)})},lookupRemove:function(obj){(siblings=$(obj).parents("[name=addfield]").siblings("[name=addfield]")).length>0&&(""!==$(obj).parents("[name=addfield]").attr("seq")&&formCustom.editField($(obj)),$(obj).parents("[name=addfield]").remove())}},LookupFilterRule={formId:-1,FilterRule:{},FORM_COMPONENTS:{},ALL_FORM_COMPONENTS:{},crtSelectedRecords:{},crtSelectionRecords:{},criteriaCnt:0,func:null,maxAllowedLookupRelField:30,lookupRelFieldLength:0,fieldOptionConstruction:null,setFilterInitVar:!0,nodata:!1,fieldListCloneDom:{},CONDITION:{AND:"&&",OR:"||"},url:"/fieldActions.zp",isfieldval:!0,OPERATORS:{18:ZPI18N.getString("zp.lookup.is"),19:ZPI18N.getString("zp.lookup.isnot"),20:ZPI18N.getString("zp.lookup.lessthan"),21:ZPI18N.getString("zp.lookup.greaterthan"),22:ZPI18N.getString("zp.lookup.lessthan_equal"),23:ZPI18N.getString("zp.lookup.greaterthan_equal"),24:ZPI18N.getString("zp.lookup.startswith"),25:ZPI18N.getString("zp.lookup.endswith"),26:ZPI18N.getString("zp.contains"),27:ZPI18N.getString("zp.lookup.notcontains"),28:ZPI18N.getString("zp.like"),29:ZPI18N.getString("zp.lookup.isempty"),30:ZPI18N.getString("zp.lookup.isnotempty"),31:ZPI18N.getString("zp.lookup.isyesterday"),32:ZPI18N.getString("zp.lookup.istoday"),33:ZPI18N.getString("zp.lookup.istomorrow"),34:ZPI18N.getString("zp.lookup.islast7days"),35:ZPI18N.getString("zp.lookup.islast30days"),36:ZPI18N.getString("zp.lookup.islast60days"),37:ZPI18N.getString("zp.lookup.islast90days"),38:ZPI18N.getString("zp.lookup.islast120days"),39:ZPI18N.getString("zp.lookup.isnext7days"),40:ZPI18N.getString("zp.lookup.isnext30days"),41:ZPI18N.getString("zp.lookup.isnext60days"),42:ZPI18N.getString("zp.lookup.isnext90days"),43:ZPI18N.getString("zp.lookup.isnext120days"),44:ZPI18N.getString("zp.lookup.islastmonth"),45:ZPI18N.getString("zp.lookup.isthismonth"),46:ZPI18N.getString("zp.lookup.isnextmonth"),47:ZPI18N.getString("zp.lookup.isthisandprevmonth"),48:ZPI18N.getString("zp.lookup.isthisandnextmonth"),49:ZPI18N.getString("zp.lookup.isyes"),50:ZPI18N.getString("zp.lookup.isno"),51:ZPI18N.getString("zp.lookup.islastyear"),52:ZPI18N.getString("zp.lookup.iscurrentyear"),53:ZPI18N.getString("zp.lookup.isnextyear"),54:ZPI18N.getString("zp.lookup.islast2years"),55:ZPI18N.getString("zp.lookup.isnext2years"),56:ZPI18N.getString("zp.lookup.isthisandprevyear"),57:ZPI18N.getString("zp.lookup.isthisandnextyear"),58:ZPI18N.getString("zp.between"),61:ZPI18N.getString("zp.lookup.is"),62:ZPI18N.getString("zp.lookup.isnot"),63:ZPI18N.getString("zp.lookup.isloggedinusersdepartment"),64:ZPI18N.getString("zp.lookup.isloggedinusers"),65:ZPI18N.getString("zp.lookup.islastweek"),66:ZPI18N.getString("zp.lookup.isthisweek"),67:ZPI18N.getString("zp.lookup.isnextweek"),68:ZPI18N.getString("zp.lookup.isloggedinusersdesignation"),69:ZPI18N.getString("zp.lookup.is"),70:ZPI18N.getString("zp.loginUserEntity"),71:ZPI18N.getString("zp.loginUserUnit"),72:ZPI18N.getString("zp.loginUserDivision"),73:ZPI18N.getString("zp.lookup.isgoalssubordinates"),reportingto:ZPI18N.getString("zp.lookup.isloggedinusers")},approvaloptionsvalues:{"-1":"Pending",1:"Approved",0:"Rejected"},setFilterPopUpTemp:'<div class="modal popRgtModel ZPRpanel PopMdxModel" id="setFilter" role="dialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><a class="close IC-cls-1px red" onclick = LookupFilterRule.closeFilterPopOver(this) data-dismiss="modal" aria-label="Close"></a><h6>'+ZPI18N.getString("zp.setFilter")+'</h4></div><div class="modal-body" id="setFilderBody"><div class="dvCriteria clearfix"><div class="clearfix ZPbold PB15"><div class="col-md-2">'+ZPI18N.getString("zp.andor")+'</div><div class="col-md-3">'+ZPI18N.getString("zp.fieldname")+'</div><div class="col-md-3">'+ZPI18N.getString("zp.condition")+'</div><div class="col-md-3">'+ZPI18N.getString("zp.value")+'</div><div class="col-md-1"></div></div><div class="dvScrolllst" id="criteria_Field"></div><div class="col-md-12"> <a class="btn btn-link PL0" onclick = "LookupFilterRule.addFilterComp(this)"><span class="IC-add MR5 S12"></span>'+ZPI18N.getString("zp.addnew")+'</a></div></div></div><div class="modal-footer"><div class="text-left"><a class="btn btn-primary" onclick = LookupFilterRule.submitFilterValue(this)>'+ZPI18N.getString("zp.done")+'</a><a class="btn btn-default" data-dismiss="modal" onclick = LookupFilterRule.closeFilterPopOver(this)>'+ZPI18N.getString("zp.cancel")+"</a></div></div></div></div></div>",INPUT_TEXTFIELD:'<input class="form-control" id="txtValueFieldInput" disabled="true">',INPUT_DROPDOWN:'<div class="input-group" id="inputgrp" style="display:none"><input class="form-control" id="txtValueFieldInput" disabled="true"><span class="input-group-addon dvSetpopup" id="zp_crt_input_dropdown" data-placement="bottom" onclick = LookupFilterRule.getPickListComp(this)><i class="IC-addlist S15"></i></span><div class="dvShwRectcon DN"><div class="popover" role="tooltip" id="dvSetpopup"><div class="arrow" style="bottom: 50%;"></div><div class="popover-content"><div class="tabvertical tabselect"><div class="col-md-12 P20 hide"><span>'+ZPI18N.getString("zp.lookup.norecfound")+'</span></div><div class="rhttablst"><div class="dvPopsearch"><div class="input-group inputsearch"><span class="input-group-addon"><label class="checkbox"><input type="checkbox" id ="crtAllCheck" onclick = "LookupFilterRule.allLookUpOptSel(this)" name="chk1"><span></span></label></span><input class="form-control" id="crtRecordSearch" onkeyup="LookupFilterRule.crtRecordSearch(this)" type="search" placeholder="'+ZPI18N.getString("zp.searchUser")+'"></div></div><ul class="list-group ulRecipient" role="tablist" id="lookupOptions"></ul></div></div></div></div></div></div>',approvaloptions:'<li class="" id="-1" val="-1" dispval="Pending" onclick="LookupFilterRule.crtSelectRecord(this)"><span>'+ZPI18N.getString("zp.pending")+'</span></li><li class="" id="1" val="1" dispval="Approved" onclick="LookupFilterRule.crtSelectRecord(this)"><span>'+ZPI18N.getString("zp.approved")+'</span></li><li class="" id="0" val="0" dispval="Rejected" onclick="LookupFilterRule.crtSelectRecord(this)"><span>'+ZPI18N.getString("zp.rejected")+"</span></li>",setFilterInit:function(){LookupFilterRule.setFilterInitVar&&(LookupFilterRule.setFilterInitVar=!1,$("body").on("click",function(e){0==$(e.target).closest(".rhttablst").length&&0==$(e.target).closest("#zp_crt_input_dropdown").length&&$("#setFilter").find(".dvSetpopup").popover("hide")}))},loadFilterRule:function(fcId,filterRule,relfieldMap1,displayFldsJSON,isonlydisplayFlds){var params={mode:"getFilterComp",formId:$(Layout.Page.container).attr("id").match(/[\d]+$/).toString()};params.conreqcsr=csrfToken,$.ajax({url:LookupFilterRule.url,data:params,async:!1,type:"POST",success:function(data){data.formComp&&(LookupFilterRule.ALL_BASE_FORM_COMPONENTS=data.formComp)}}),LookupFilterRule.isonlydisplayFlds=isonlydisplayFlds,LookupFilterRule.relfieldMap=relfieldMap1,LookupFilterRule.displayFldsJSON=displayFldsJSON,Layout.Page.container.find("#setFilderCriText").on("keydown",function(e){e.preventDefault()}),Layout.Page.container.find("#setFilderCriText").hide();var formId=Layout.Page.container.find("#ImportForm").val();LookupFilterRule.FilterRule[fcId]=filterRule.ruleArray,LookupFilterRule.formId=formId,LookupFilterRule.func=LookupFilterRule.constructLoadFilterPage,LookupFilterRule.initCompAndRule(formId,filterRule)},initCompAndRule:function(formId,filterRule){void 0!=filterRule&&(LookupFilterRule.savedCriteria=filterRule.ruleArray),LookupFilterRule.initComp(formId)},initComp:function(formId,isFillRelFields){isFillRelFields=!1!==isFillRelFields;if(LookupFilterRule.ALL_FORM_COMPONENTS.hasOwnProperty(formId)&&0!=LookupFilterRule.ALL_FORM_COMPONENTS[formId].length&&LookupFilterRule.initFilterComp(formId,isFillRelFields),!LookupFilterRule.ALL_FORM_COMPONENTS.hasOwnProperty(formId)){var params={mode:"getFilterComp",formId:formId};params.conreqcsr=csrfToken,$.post(LookupFilterRule.url,params,function(data){data.formComp?(LookupFilterRule.ALL_FORM_COMPONENTS[formId]=data.formComp,LookupFilterRule.initFilterComp(formId,isFillRelFields)):(LookupFilterRule.nodata=!0,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.noReffields")))})}},initFilterComp:function(formId,isFillRelFields){0!=LookupFilterRule.ALL_FORM_COMPONENTS[formId].length&&(LookupFilterRule.nodata=!1,LookupFilterRule.isonlydisplayFlds?LookupFilterRule.constructRelFields(formId):isFillRelFields?(LookupFilterRule.constructRelFields(formId),LookupFilterRule.func(formId)):LookupFilterRule.func(formId))},constructRelFields:function(formId){for(var relFields="",displayFieldsTemp="<label >"+ZPI18N.getString("zp.displayfields")+"</label>",cnt=1;cnt<Object.keys(LookupFilterRule.displayFldsJSON).length;cnt++)if(LookupFilterRule.displayFldsJSON.hasOwnProperty(""+cnt)){LookupFilterRule.displayFldsJSON[""+cnt];value=LookupFilterRule.displayFldsJSON[""+cnt].separator,displayFieldsTemp+=1==cnt?'<div class="input-group MB10" name="addfield" seq="'+cnt+'"><div class="input-group-addon PT0 PL0" autoGenerated="false"><input type="text" maxlength="10" class="form-control dpllfileds" keyname="separator" value="'+value+'" savedValue="'+value+'" onchange="formCustom.editField(this)" disabled=""></div>':'<div class="input-group MB10" name="addfield" seq="'+cnt+'"><div class="input-group-addon PT0 PL0" autoGenerated="false"><input type="text" maxlength="10" class="form-control dpllfileds" keyname="separator" value="'+value+'" savedValue="'+value+'" onchange="formCustom.editField(this)"></div>',displayFieldsTemp+='<select id="FormFlds" name="importdisp" class="selectTag" onchange="formCustom.editField(this)" keyname="dispFcid">';var temp=LookupFilterRule.ALL_FORM_COMPONENTS[formId];for(var key in temp)temp.hasOwnProperty(key)&&(value=temp[key],value.isTabular||value.onlyForRelatedFields||value.fcType==ZPForm.Field.LOOKUP||void 0==value.formCompName||(key==LookupFilterRule.displayFldsJSON[""+cnt].dispfcid?displayFieldsTemp+='<option value="'+key+'" selected>'+value.formCompName+"</option>":value.isEncrypted||(displayFieldsTemp+='<option value="'+key+'">'+value.formCompName+"</option>")));displayFieldsTemp+='</select><div class="input-group-addon" autoGenerated="false"><span class="IC-plus-fill MR15 CP" onclick="formCustom.choiceActions(\'add\',this)"></span><span class="IC-mins MR15" name="deleteOption" onclick="formCustom.choiceActions(\'remove\',this)"></span><span class="IC-move CP" name="dragicon"></span></div></div>'}var unselectedFields="";$.each(LookupFilterRule.ALL_FORM_COMPONENTS[formId],function(key,value){value.isTabular||!value.onlyForRelatedFields&&value.fcType==ZPForm.Field.LOOKUP||void 0==value.formCompName||LookupFilterRule.relfieldMap.relFieldsList.includes(key)||(unselectedFields+="<option value='"+key+"'>"+value.formCompName+"</option>")}),LookupFilterRule.lookupRelFieldLength=0,LookupFilterRule.relfieldMap.relFieldsList.forEach(function(key){var value=LookupFilterRule.ALL_FORM_COMPONENTS[formId][key];void 0==value||value.isTabular||!value.onlyForRelatedFields&&value.fcType==ZPForm.Field.LOOKUP||void 0==value.formCompName||(relFields+="<option value='"+key+"'>"+value.formCompName+"</option>",LookupFilterRule.lookupRelFieldLength++)}),relFields+=unselectedFields,Layout.Page.container.find("#displayFields").empty().html(displayFieldsTemp),formCustom.optionsSort(),Layout.Page.container.find("#relatedfields").empty().html(relFields),formCustom.onChangeRelFields(),Layout.Page.container.find("#relatedfields").val(LookupFilterRule.relfieldMap.relFieldsList);var id=Layout.Page.container.find("#fieldProperties");LookupFilterRule.maxAllowedLookupRelField=LookupFilterRule.relfieldMap.maxAllowedRelFields,formCustom.select2ForSelectBox(id,!0)},constructLoadFilterPage:function(formId){void 0!=LookupFilterRule.savedCriteria&&(Layout.Page.container.find("#setFilderCri").find("input").prop("checked",!0),LookupFilterRule.saveFilterRule("new",void 0,LookupFilterRule.savedCriteria))},setFilterCallfunc:function(obj){if(LookupFilterRule.fcId=Layout.Page.container.find("#fieldProperties").attr("currentfcid"),1==$(obj).prop("checked")){var formId=Layout.Page.container.find("#ImportForm").val();if(LookupFilterRule.nodata)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.noReffields"));LookupFilterRule.ALL_FORM_COMPONENTS.hasOwnProperty(formId)?LookupFilterRule.constructFilterPage(formId):((params={mode:"getFilterComp",formId:formId}).conreqcsr=csrfToken,LookupFilterRule.func=LookupFilterRule.constructFilterPage,$.post(LookupFilterRule.url,params,function(data){data.formComp&&(LookupFilterRule.ALL_FORM_COMPONENTS[formId]=data.formComp),0!=LookupFilterRule.ALL_FORM_COMPONENTS[formId].length&&LookupFilterRule.constructFilterPage(formId)}))}else{var params={mode:"deleteFilterRule",fcId:LookupFilterRule.fcId};ZPeople.Request.send(LookupFilterRule.url,params,LookupFilterRule.filterDelete)}},editFilterRules:function(obj){if(LookupFilterRule.fcId=Layout.Page.container.find("#fieldProperties").attr("currentfcid"),0!=$(obj).val().length){var formId=Layout.Page.container.find("#ImportForm").val();LookupFilterRule.savedCriteria=LookupFilterRule.FilterRule[LookupFilterRule.fcId],LookupFilterRule.func=LookupFilterRule.constructEditFilterPage,LookupFilterRule.ALL_FORM_COMPONENTS.hasOwnProperty(formId)?0!=LookupFilterRule.ALL_FORM_COMPONENTS[formId].length&&LookupFilterRule.constructEditFilterPage(formId):LookupFilterRule.initComp(formId,!1)}},constructFilterPage:function(formId,undefined){LookupFilterRule.criteriaCnt=0;var criteria=LookupFilterRule.constructCriteria(),curr_criteria_id=$(criteria).attr("id");$("#setFilter").remove(),$("body").append(LookupFilterRule.setFilterPopUpTemp),LookupFilterRule.pageContainer=$("#setFilter"),$("#criteria_Field").empty().append(criteria),LookupFilterRule.fieldOptionPopOverInit(curr_criteria_id),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find(".dvSetpopup").on("shown.bs.popover",function(e){$(e.target).removeAttr("isVisible").attr("isVisible",!0)}),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find(".dvSetpopup").on("hide.bs.popover",function(e){"true"==$(e.target).attr("isVisible")&&($(e.target).removeAttr("isVisible").attr("isVisible",!1),$(e.target).parent().children().find("#dvSetpopup").find("#lookupOptions").empty().append($(e.target).parent().children().find("#lookupOptions").children()))}),LookupFilterRule.pageContainer.find("select").select2(),LookupFilterRule.pageContainer.modal({backdrop:"static",keyboard:!1})},constructEditFilterPage:function(formId){LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.ALL_FORM_COMPONENTS[formId];var savedCriteria=LookupFilterRule.savedCriteria,tempCnt=0;LookupFilterRule.criteriaCnt=0,$("#setFilter").remove(),$("body").append(LookupFilterRule.setFilterPopUpTemp),LookupFilterRule.pageContainer=$("#setFilter"),$("#criteria_Field").empty(),0!==Object.keys(savedCriteria).length?$.each(savedCriteria,function(key,value){if("APPROVAL_STATUS"!=value.sysFieldName||LookupFilterRule.FORM_COMPONENTS.isApprovalForm){var fcID,fcType,operator=value.Operator,parentFcid=value.parentfcid;if(value.isSystemField?(fcID=value.sysFieldName,"APPROVAL_STATUS"==value.sysFieldName&&(operator=ZPNewView.OPERATORS.IN)):(fcID=value.formComponentID,LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(parentFcid),void 0!=LookupFilterRule.FORM_COMPONENTS[fcID]&&(fcType=LookupFilterRule.FORM_COMPONENTS[fcID].fcType)),operator!=ZPNewView.OPERATORS.SUBORDINATES_GOAL){if(value.isSystemField||void 0!=LookupFilterRule.FORM_COMPONENTS[fcID]){var curr_criteria_id=LookupFilterRule.addCriteria();0!==tempCnt&&LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#operatorSelection").select2("val",value.conjunctiveCondn);var originalCrtValue=value.CrtVal;if(LookupFilterRule.fiedpopoverclback(LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#fieldSelection"),"-1",fcID,!0,value.isSystemField,value.sysFieldName,value.isDependentfield,parentFcid),LookupFilterRule.fieldOptionPopOverInit(curr_criteria_id),0==LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("[isopr='true']").find("option[value="+operator+"]").length&&LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("[isopr='true']").append("<option value='"+operator+"'>"+LookupFilterRule.OPERATORS[operator]+"</option>"),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("[isopr='true']").select2("val",operator),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("[isopr='true']").trigger("change"),value.isSystemField&&(fcID=value.sysFieldName),!(fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&fcType!=ZPForm.Field.NEW_COUNTRY||operator!=ZPNewView.OPERATORS.IN&&operator!=ZPNewView.OPERATORS.NOT_IN)){LookupFilterRule.getLookUpOptions(fcID,fcType);var fcRecords1=LookupFilterRule.crtSelectionRecords[fcID];if(void 0!==fcRecords1&&Object.keys(fcRecords1).length>0){var fcRecords=JSON.parse(JSON.stringify(fcRecords1));originalCrtValue="";var values=JSON.parse(value.CrtVal),selectedRecords=LookupFilterRule.crtSelectedRecords[curr_criteria_id];void 0===selectedRecords&&(selectedRecords=[]),values instanceof Object&&$.each(values,function(key,value){$.each(fcRecords,function(k,v){value!=v.Id||v.isChecked||(selectedRecords.push(v.Id+""),v.isChecked=!0,originalCrtValue+=v.Value+",")})}),originalCrtValue=originalCrtValue.slice(0,-1),LookupFilterRule.crtSelectedRecords[curr_criteria_id]=selectedRecords,LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#inputgrp #txtValueFieldInput").val(ZPeople.decodeTxt(originalCrtValue))}}if(value.isDependentfield)LookupFilterRule.fieldOptionPopOverInit(curr_criteria_id,!0,value.dependentfield,value.parentcrtvalue,value.isloginusercomponent),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#fieldSelection").attr("isdependentfield","true"),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#txtValueField").hide(),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#textvaluefordepnparent").show();else if(value.isSystemField&&"APPROVAL_STATUS"==value.sysFieldName){var criteriaval=JSON.parse(value.CrtVal);LookupFilterRule.crtSelectedRecords[curr_criteria_id]=criteriaval;for(var criteriaval1="",j=0;j<criteriaval.length;j++)criteriaval1+=LookupFilterRule.approvaloptionsvalues[criteriaval[j]]+",";criteriaval=criteriaval1.slice(0,-1),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#inputgrp #txtValueFieldInput").attr("disabled",!0),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#inputgrp #txtValueFieldInput").val(criteriaval)}else $(LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#txtValueFieldInput")[0]).val(value.CrtVal);tempCnt++}}else{var obj=LookupFilterRule.FORM_COMPONENTS[fcID],criteria=LookupFilterRule.constructCriteriaForGoalLookUp(obj.formCompName);LookupFilterRule.pageContainer.find("#criteria_Field").append(criteria),LookupFilterRule.pageContainer.find(".col-md-12").html("");var foot='<button class="btn btn-default cancel-model" data-dismiss="modal" onclick="LookupFilterRule.closeFilterPopOver(this);" >'+ZPI18N.getString("zp.close")+"</button>";LookupFilterRule.pageContainer.find(".modal-footer").html(foot)}}}):LookupFilterRule.constructCriteria(),LookupFilterRule.pageContainer.modal({backdrop:"static",keyboard:!1})},addCriteria:function(){var criteria=LookupFilterRule.constructCriteria(),curr_criteria_id=$(criteria).attr("id");return LookupFilterRule.pageContainer.find("#criteria_Field").append(criteria),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find(".dvSetpopup").on("shown.bs.popover",function(e){$(e.target).removeAttr("isVisible").attr("isVisible",!0)}),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find(".dvSetpopup").on("hide.bs.popover",function(e){"true"==$(e.target).attr("isVisible")&&($(e.target).removeAttr("isVisible").attr("isVisible",!1),$(e.target).parent().children().find("#dvSetpopup").find("#lookupOptions").empty().append($(e.target).parent().children().find("#lookupOptions").children()))}),LookupFilterRule.pageContainer.find("select").select2(),LookupFilterRule.pageContainer.find("#"+curr_criteria_id).find("#operatorSelection").select2({minimumResultsForSearch:1/0}),curr_criteria_id},addFilterComp:function(obj){if(-1!=LookupFilterRule.pageContainer.find("#criteria_Field").children().last().find("#fieldSelection").val()){var criteria=LookupFilterRule.constructCriteria(),curr_criteria_id=$(criteria).attr("id");LookupFilterRule.pageContainer.find("#criteria_Field").append(criteria),LookupFilterRule.fieldOptionPopOverInit(curr_criteria_id),LookupFilterRule.pageContainer.find("select").select2()}else LookupFilterRule.pageContainer.find("#criteria_Field").children().last().find("#zp_criteria_field_error").html(ZPI18N.getString("zp.pleaseselectfieldname")).show()},constructCriteriaForGoalLookUp:function(displayName){var criteriaRow='<div class="clearfix lst" id="criteria_Field_formCustom_'+LookupFilterRule.criteriaCnt+++'">';return criteriaRow+='<div class="form-group col-md-3 col-md-offset-2" id="fieldCompName"><input id="fieldSelection" class="form-control" value="'+displayName+'" fcid="-1" pfcid="-1" iscrtfc="true" data-placement="bottom" data-toggle="popover" disabled="true">',criteriaRow+="</div>",criteriaRow+='<div class="form-group col-md-3"><input id="fieldSelection" class="form-control" value="'+ZPI18N.getString("zp.lookup.isgoalssubordinates")+'" fcid="-1" pfcid="-1" iscrtfc="true" data-placement="bottom" data-toggle="popover" disabled="true"></div>',criteriaRow+='<div class="form-group col-md-3" id="textvaluefordepnparent" style="display:none"><select class="selectBox" id="textvaluefordepn"></select></div>',criteriaRow+='<div class="form-group col-md-3" id="txtValueField">',criteriaRow+=LookupFilterRule.INPUT_TEXTFIELD,criteriaRow+="</div></div>"},constructCriteria:function(){var criteriaRow='<div class="clearfix lst" id="criteria_Field_formCustom_'+LookupFilterRule.criteriaCnt+++'">';return LookupFilterRule.criteriaCnt>1?(criteriaRow+='<div class="form-group col-md-2"><select id="operatorSelection"><option value="AND">'+ZPI18N.getString("zp.captialand")+'</option>" +"<option value="OR">'+ZPI18N.getString("zp.captialor")+"</option></select></div>",criteriaRow+='<div class="form-group col-md-3" id="fieldCompName"><input id="fieldSelection" class="form-control" data-placement="bottom" data-toggle="popover">'):criteriaRow+='<div class="form-group col-md-3 col-md-offset-2" id="fieldCompName"><input id="fieldSelection" class="form-control" value="None" fcid="-1" pfcid="-1" iscrtfc="true" data-placement="bottom" data-toggle="popover">',criteriaRow+="</div>",criteriaRow+='<div class="form-group col-md-2"><select class="selectBox" isOpr="true" disabled="true" onChange=LookupFilterRule.onConditionChange(this)><option value="-1">'+ZPI18N.getString("zp.none")+"</option></select></div>",criteriaRow+='<div class="form-group col-md-3" id="textvaluefordepnparent" style="display:none"><input id="textvaluefordepn" class="form-control" data-placement="bottom" data-toggle="popover"></div>',criteriaRow+='<div class="form-group col-md-3" id="txtValueField">',criteriaRow+=LookupFilterRule.INPUT_TEXTFIELD,criteriaRow+=LookupFilterRule.INPUT_DROPDOWN,criteriaRow+="</div>",criteriaRow+='<div class="form-group col-md-2"><div class="dvlist-action MT8"><a class="MR10 S13" onclick="LookupFilterRule.changedependfiled(this)" style="visibility: hidden" id="lkupselectopttxt">'+ZPI18N.getString("zp.selectfield")+'</a><span class="IC-reset MR10 ZPtitle hide" title="'+ZPI18N.getString("zp.reset")+'"></span><a class="IC-remove red" onclick = LookupFilterRule.removeCriteria(this)></a></div></div>',criteriaRow+='<div class="dverrormsg DN col-md-12 text-center" id="zp_criteria_error">Invalid Criteria</div></div>'},fieldOptionPopOverInit:function(crtID,isFromDepField,defValue,parentcrtvalue,isloginusercomponent){var ruleFieldObj=LookupFilterRule.pageContainer.find("#criteria_Field").find("#"+crtID).find("#fieldSelection"),menuBoxContent="",callback=LookupFilterRule.fiedpopoverclback;isFromDepField?((ruleFieldObj=LookupFilterRule.pageContainer.find("#criteria_Field").find("#"+crtID).find("#textvaluefordepn")).unbind(),ruleFieldObj.popover("destroy"),setTimeout(function(){menuBoxContent=LookupFilterRule.constructDepenentFieldOptionsPopover(LookupFilterRule.pageContainer.find("#criteria_Field").find("#"+crtID).find("#fieldSelection"),crtID,defValue,parentcrtvalue,isloginusercomponent),callback=LookupFilterRule.dependentFieldPopoverCallback,$(ruleFieldObj).setPopOver({callback:callback,container:"#"+Layout.Page.container.attr("id"),html:menuBoxContent,keyname:"name=list-group-item",maskneeded:!0}),LookupFilterRule.crtFieldSearch(),menuBoxContent.find("#contentDiv").removeClass("ulItemrec")},200)):(menuBoxContent=LookupFilterRule.constructFieldOptionsPopover(ruleFieldObj,crtID),LookupFilterRule.crtFieldSearch(),$(ruleFieldObj).setPopOver({callback:callback,container:"#"+Layout.Page.container.attr("id"),html:menuBoxContent,keyname:"name=list-group-item",maskneeded:!0}),menuBoxContent.find("#contentDiv").removeClass("ulItemrec"))},isAllowedForChildComp:function(fcidObj){return("P_PerformanceAppraisal"!=LookupFilterRule.baseTableName||"CurrentCTC"!=fcidObj.labelname&&"CurrentDesignation"!=fcidObj.labelname&&"PromotedDesignation"!=fcidObj.labelname&&"Configuration"!=fcidObj.labelname&&"Department"!=fcidObj.labelname)&&("P_Employee"!=LookupFilterRule.baseTableName||"Role"!=fcidObj.labelname&&"Entity"!=fcidObj.labelname&&"Business_unit"!=fcidObj.labelname&&"Division"!=fcidObj.labelname)&&("P_SelfAppraisal"!=LookupFilterRule.baseTableName||"AppriasalConfiguration"!=fcidObj.labelname&&"Rating"!=fcidObj.labelname)&&("P_Goals"!=LookupFilterRule.baseTableName||"UserRating"!=fcidObj.labelname&&"ManagerRating"!=fcidObj.labelname)&&("P_TimesheetJob"!=LookupFilterRule.baseTableName||"Project"!=fcidObj.labelname)},constructFieldOptionsPopover:function(obj,crtID){LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents();var parentlabelName,fieldListClone,fcid=$(obj).attr("fcid"),systemvalue=($(obj).attr("pfcid"),$(obj).attr("value")),isSystemField=$(obj).attr("isSystemField"),parentfcid=($(obj).attr("isdependontime"),$(obj).attr("parentfcid"));if(void 0!=parentfcid&&(parentlabelName=LookupFilterRule.FORM_COMPONENTS[parentfcid].labelname),!LookupFilterRule.fieldListCloneDom.hasOwnProperty(LookupFilterRule.fcId)){var components=LookupFilterRule.sort(LookupFilterRule.FORM_COMPONENTS),tabLi=(fieldListClone=AutomationCommon.getFormFieldsHtml().clone()).find("#dvRecipient li:first").clone(),contDiv=fieldListClone.find("#contentDiv :first").clone(),contLi=fieldListClone.find("[name=list-group-item]").clone();fieldListClone.find("#dvRecipient").empty(),fieldListClone.find("#contentDiv").empty();var cloneTagLiForBaseForm=tabLi.clone();cloneTagLiForBaseForm.attr({class:"",id:"UserDefinedFields"}),cloneTagLiForBaseForm.find("a").attr({"data-toggle":"tab",href:"#UserDefinedFields1"}).html(ZPI18N.getString("zp.lookup.userDefFields")),fieldListClone.find("#dvRecipient").append(cloneTagLiForBaseForm);var cloneTagLi=tabLi.clone();cloneTagLi.attr({class:"",id:"SystemFields"}),cloneTagLi.find("a").attr({"data-toggle":"tab",href:"#SystemFields1"}).html(ZPI18N.getString("zp.systemfields")),fieldListClone.find("#dvRecipient").append(cloneTagLi),(cloneContDiv=contDiv.clone()).find("[name=list-group]").empty(),$(cloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(cloneContDiv).attr({class:"tab-pane fade",id:"UserDefinedFields1",isParent:!0});var cloneContDiv,childFCElem=[];if($.each(components,function(key,value){var column=LookupFilterRule.FORM_COMPONENTS[value],dispname=column.formCompName;column.labelname;if(column.fcType!==ZPForm.Field.IMAGE&&void 0!==column.fcType&&!column.isTabular&&column.fcType!==ZPForm.Field.ADDRESS){var li=contLi.clone(),fieldKey=value;if(li.find("[name=optDiv]").attr({id:fieldKey,value:fieldKey,pfcid:"-1"}),li.find("[name=mOpt]").html(dispname),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li),column.fcType==ZPForm.Field.LOOKUP&&LookupFilterRule.isAllowedForChildComp(column)&&void 0!==column.childComponents&&Object.keys(column.childComponents).length>0){var cloneTagLi=tabLi.clone(),elemId=column.labelname+"_"+fieldKey;cloneTagLi.attr({class:"",id:elemId}),cloneTagLi.find("a").attr({"data-toggle":"tab",href:"#"+elemId+"_Options"}).html(column.formCompName),fieldListClone.find("#dvRecipient").append(cloneTagLi);var RefcloneContDiv=contDiv.clone();RefcloneContDiv.find("[name=list-group]").empty(),$(RefcloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(RefcloneContDiv).attr({class:"tab-pane fade",id:elemId+"_Options",isParent:!0}),$.each(column.childComponents,function(k,v){if(v.fcType!==ZPForm.Field.IMAGE&&void 0!==v.fcType&&!v.isTabular){var refli=contLi.clone();refli.find("[name=optDiv]").attr({id:v.formComponentId,value:v.formComponentId,pfcid:"-1",parentFcid:fieldKey,childFctype:v.fcType}),refli.find("[name=mOpt]").html(v.formCompName),refli.find("[name=mOpt]").parent("for",v.formComponentId),$(RefcloneContDiv).find("[name=list-group]").append(refli)}}),fieldListClone.find("#contentDiv").append(RefcloneContDiv),childFCElem.push(RefcloneContDiv)}}}),fieldListClone.find("#contentDiv").append(cloneContDiv),(cloneContDiv=contDiv.clone()).find("[name=list-group]").empty(),$(cloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(cloneContDiv).attr({class:"tab-pane fade",id:"SystemFields1",isParent:!0}),LookupFilterRule.FORM_COMPONENTS.isApprovalForm){var fieldKey="APPROVAL_STATUS";(li=contLi.clone()).find("[name=optDiv]").attr({isSystemField:"true",isapprovalform:"true",systemFieldValue:"APPROVAL_STATUS"}),li.find("[name=mOpt]").html(ZPI18N.getString("zp.lookup.recordappstat")),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li)}fieldKey="CREATEDBY";(li=contLi.clone()).find("[name=optDiv]").attr({isSystemField:"true",isdepentonuser:!0,systemFieldValue:"CREATEDBY"}),li.find("[name=mOpt]").html(ZPI18N.getString("zp.reports.createdby")),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li);var li;fieldKey="CREATEDTIME";(li=contLi.clone()).find("[name=optDiv]").attr({isSystemField:"true",isdependontime:"true",systemFieldValue:"CREATEDTIME"}),li.find("[name=mOpt]").html(ZPI18N.getString("zp.createdtime")),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li),fieldListClone.find("#contentDiv").append(cloneContDiv),LookupFilterRule.fieldListCloneDom[LookupFilterRule.fcId]=$(fieldListClone)}if(fieldListClone=LookupFilterRule.fieldListCloneDom[LookupFilterRule.fcId].html(),fieldListClone=jQuery("<div></div>",{class:"clone",id:crtID}).append(fieldListClone),"true"!=isSystemField&&-1==fcid)$(fieldListClone).find("#UserDefinedFields").attr("class","active"),$(fieldListClone).find("#UserDefinedFields1").attr("class","tab-pane fade active in");else if("true"!=isSystemField&&void 0!=parentlabelName&&-1!==fcid){var id=parentlabelName+"_"+parentfcid;$(fieldListClone).find("#"+id).attr("class","active"),$(fieldListClone).find("#"+id+"_Options").attr("class","tab-pane fade active in"),$(fieldListClone).find("#"+id+"_Options").find('a[id="'+fcid+'"]').parent().attr("class","sel")}else"true"!=isSystemField&&-1!==fcid?($(fieldListClone).find("#UserDefinedFields").attr("class","active"),$(fieldListClone).find("#UserDefinedFields1").attr("class","tab-pane fade active in"),$(fieldListClone).find("#UserDefinedFields1").find('a[id="'+fcid+'"]').parent().attr("class","sel")):"true"==isSystemField&&($(fieldListClone).find("#SystemFields").attr("class","active"),$(fieldListClone).find("#SystemFields1").attr("class","tab-pane fade active in"),$(fieldListClone).find("#SystemFields1").find('a[systemFieldValue="'+systemvalue+'"]').parent().attr("class","sel"));return fieldListClone},constructDepenentFieldOptionsPopover:function(obj,crtID,defValue,parentcrtvalue,isloginusercomponent){var fieldValue=$(obj).attr("value"),parentfcid=$(obj).attr("parentfcid");LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(parentfcid);var fieldListClone,column=LookupFilterRule.FORM_COMPONENTS[fieldValue],isBaseFieldTab="tabularFld"==Layout.Page.container.find("#dispName"+LookupFilterRule.fcId).parent().parent().attr("name");Layout.Page.container.find("#dispName"+LookupFilterRule.fcId).closest("[name=sectionDiv]").attr("secid");LookupFilterRule.BaseFORM_ID_COMPONENTS=LookupFilterRule.getBaseFieldComponents();var tabLi=(fieldListClone=AutomationCommon.getFormFieldsHtml().clone()).find("#dvRecipient li:first").clone(),contDiv=fieldListClone.find("#contentDiv :first").clone(),contLi=fieldListClone.find("[name=list-group-item]").clone();fieldListClone.find("#dvRecipient").empty(),fieldListClone.find("#contentDiv").empty();var cloneTagLiForBaseForm=tabLi.clone();cloneTagLiForBaseForm.attr({class:"hide",id:"baseFormFields"}),cloneTagLiForBaseForm.find("a").attr({"data-toggle":"tab",href:"#baseFormFields_Options"}).html("Base Form Fields"),fieldListClone.find("#dvRecipient").append(cloneTagLiForBaseForm);var cloneContDiv=contDiv.clone();cloneContDiv.find("[name=list-group]").empty(),$(cloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(cloneContDiv).attr({class:"tab-pane fade",id:"baseFormFields_Options",isParent:!0});$.each(LookupFilterRule.BaseFORM_ID_COMPONENTS,function(key,value){if(fieldValue!=key&&LookupFilterRule.fcId!=key)if(column.fcType==ZPForm.Field.LOOKUP){if(value.fcType==ZPForm.Field.LOOKUP){if(!isBaseFieldTab&&value.isTabular)return;if(LookupFilterRule.fcId!=key&&void 0!=value.refFormIddepend&&value.refFormIddepend==column.refFormIddepend)(li=contLi.clone()).find("[name=optDiv]").attr({id:key,value:key}),li.find("[name=mOpt]").html(value.formCompName),li.find("[name=mOpt]").parent("for",key),$(cloneContDiv).find("[name=list-group]").append(li),fieldListClone.find("#baseFormFields").removeClass("hide");if(void 0!==value.childComponents&&13!=value.seltype)(refCloneTagLi=tabLi.clone()).attr({class:"hide",id:key}),refCloneTagLi.find("a").attr({"data-toggle":"tab",href:"#"+key+"_Options"}).html(value.formCompName),fieldListClone.find("#dvRecipient").append(refCloneTagLi),(RefcloneContDiv=contDiv.clone()).find("[name=list-group]").empty(),$(RefcloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(RefcloneContDiv).attr({class:"tab-pane fade",id:key+"_Options",isParent:!0}),$.each(value.childComponents,function(k,v){if(LookupFilterRule.fcId!=k&&(isBaseFieldTab||!v.isTabular)&&void 0!=v.refFormIddepend&&v.refFormIddepend==column.refFormIddepend){var val=key+"_"+k,refli=contLi.clone();refli.find("[name=optDiv]").attr({id:val,value:k,parentfcid:key}),refli.find("[name=mOpt]").html(v.formCompName),refli.find("[name=mOpt]").parent("for",val),$(RefcloneContDiv).find("[name=list-group]").append(refli),fieldListClone.find("#"+key).removeClass("hide")}}),fieldListClone.find("#contentDiv").append(RefcloneContDiv)}}else{if(value.isTabular)return;var li,refCloneTagLi,RefcloneContDiv;if(LookupFilterRule.isDependFieldAllowed(column.fcType,value.fcType,column.seltype,value.seltype))(li=contLi.clone()).find("[name=optDiv]").attr({id:key,value:key}),li.find("[name=mOpt]").html(value.formCompName),li.find("[name=mOpt]").parent("for",key),$(cloneContDiv).find("[name=list-group]").append(li);if(void 0!==value.childComponents&&13!=value.seltype)(refCloneTagLi=tabLi.clone()).attr({class:"hide",id:key}),refCloneTagLi.find("a").attr({"data-toggle":"tab",href:"#"+key+"_Options"}).html(value.formCompName),fieldListClone.find("#dvRecipient").append(refCloneTagLi),(RefcloneContDiv=contDiv.clone()).find("[name=list-group]").empty(),$(RefcloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(RefcloneContDiv).attr({class:"tab-pane fade",id:key+"_Options",isParent:!0}),$.each(value.childComponents,function(k,v){if(!v.isTabular&&LookupFilterRule.isDependFieldAllowed(column.fcType,v.fcType,column.seltype,v.seltype)){var val=key+"_"+k,li=contLi.clone();li.find("[name=optDiv]").attr({id:val,value:k,parentfcid:key}),li.find("[name=mOpt]").html(v.formCompName),li.find("[name=mOpt]").parent("for",val),$(RefcloneContDiv).find("[name=list-group]").append(li),fieldListClone.find("#"+key).removeClass("hide")}}),fieldListClone.find("#contentDiv").append(RefcloneContDiv)}}),fieldListClone.find("#contentDiv").append(cloneContDiv);var refCloneTagLi=tabLi.clone();refCloneTagLi.attr({class:"hide",id:"loginusercomponents"}),refCloneTagLi.find("a").attr({"data-toggle":"tab",href:"#loginusercomponents_Options"}).html("Login User"),fieldListClone.find("#dvRecipient").append(refCloneTagLi);var RefcloneContDiv=contDiv.clone();if(RefcloneContDiv.find("[name=list-group]").empty(),$(RefcloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(RefcloneContDiv).attr({class:"tab-pane fade",id:"loginusercomponents_Options",isParent:!0}),$.each(LookupFilterRule.BaseFORM_ID_COMPONENTS.loginusercomponents,function(key,value){if(column.fcType==ZPForm.Field.LOOKUP){if(value.fcType==ZPForm.Field.LOOKUP&&LookupFilterRule.fcId!=key&&(isBaseFieldTab||!value.isTabular)&&void 0!=value.refFormIddepend&&value.refFormIddepend==column.refFormIddepend){var val="loginusercomponents_"+key;(li=contLi.clone()).find("[name=optDiv]").attr({id:val,value:key,parentfcid:"loginusercomponents"}),li.find("[name=mOpt]").html(value.formCompName),li.find("[name=mOpt]").parent("for",val),$(RefcloneContDiv).find("[name=list-group]").append(li),fieldListClone.find("#loginusercomponents").removeClass("hide")}}else if(!value.isTabular&&LookupFilterRule.isDependFieldAllowed(column.fcType,value.fcType,column.seltype,value.seltype)){var li;val="loginusercomponents_"+key;(li=contLi.clone()).find("[name=optDiv]").attr({id:val,value:key,parentfcid:"loginusercomponents"}),li.find("[name=mOpt]").html(value.formCompName),li.find("[name=mOpt]").parent("for",key),$(RefcloneContDiv).find("[name=list-group]").append(li),fieldListClone.find("#loginusercomponents").removeClass("hide")}}),fieldListClone.find("#contentDiv").append(RefcloneContDiv),$.each(fieldListClone.find(".hide"),function(){var removeid=$(this).attr("id");fieldListClone.find(this).remove(),fieldListClone.find("#"+removeid+"_Options").remove()}),void 0!=parentcrtvalue||isloginusercomponent){if(void 0!=parentcrtvalue){var id=parentcrtvalue+"_"+defValue;$(fieldListClone).find("#"+parentcrtvalue).attr("class","active"),$(fieldListClone).find("#"+parentcrtvalue+"_Options").attr("class","tab-pane fade active in"),$(fieldListClone).find("#"+parentcrtvalue+"_Options").find('a[id="'+id+'"]').parent().attr("class","sel"),LookupFilterRule.pageContainer.find("#"+crtID).find("#textvaluefordepn").attr({value:defValue,parentValue:parentcrtvalue}),LookupFilterRule.pageContainer.find("#"+crtID).find("#textvaluefordepn").val($(fieldListClone).find('a[id="'+id+'"]').text())}else if(isloginusercomponent){id="loginusercomponents_"+defValue;$(fieldListClone).find("#loginusercomponents").attr("class","active"),$(fieldListClone).find("#loginusercomponents_Options").attr("class","tab-pane fade active in"),$(fieldListClone).find("#loginusercomponents_Options").find('a[id="'+id+'"]').parent().attr("class","sel"),LookupFilterRule.pageContainer.find("#"+crtID).find("#textvaluefordepn").attr({value:defValue,parentValue:"loginusercomponents"}),LookupFilterRule.pageContainer.find("#"+crtID).find("#textvaluefordepn").val($(fieldListClone).find('a[id="'+id+'"]').text())}}else{var firstEle=$(fieldListClone).find("#dvRecipient").children().first("li").attr("id");$(fieldListClone).find("#"+firstEle).attr("class","active"),$(fieldListClone).find("#"+firstEle+"_Options").attr("class","tab-pane fade active in"),void 0!=defValue&&($(fieldListClone).find("#"+firstEle+"_Options").find('a[id="'+defValue+'"]').parent().attr("class","sel"),LookupFilterRule.pageContainer.find("#"+crtID).find("#textvaluefordepn").val($(fieldListClone).find("#"+firstEle+"_Options").find('a[id="'+defValue+'"]').text()),LookupFilterRule.pageContainer.find("#"+crtID).find("#textvaluefordepn").attr("value",defValue))}return fieldListClone=jQuery("<div></div>",{class:"clone",id:crtID}).append(fieldListClone)},fiedpopoverclback:function(ele,pfcid,fcid,isFromEditView,isSystemField,sysFieldName,isDependentfield,parentFcid){var obj,dispName="";if(isFromEditView){if(isSystemField)obj=$(ele),attrs={fcid:fcid,pfcid:pfcid,iscrtfc:!0,value:sysFieldName,isSystemField:String(isSystemField),isDependentfield:!1},"APPROVAL_STATUS"==sysFieldName&&(attrs.isapprovalform="true",dispName=ZPI18N.getString("zp.lookup.recordappstat")),"CREATEDBY"==sysFieldName?(attrs.isdepentonuser=!0,dispName=ZPI18N.getString("zp.reports.createdby")):"CREATEDTIME"==sysFieldName&&(attrs.isdependontime="true",dispName=ZPI18N.getString("zp.createdtime")),$(obj).val(dispName),$(obj).attr(attrs);else if(isDependentfield){dispName=LookupFilterRule.FORM_COMPONENTS[fcid+""].formCompName,obj=$(ele),$(obj).val(ZPeople.decodeTxt(dispName)),$(obj).attr({fcid:fcid,iscrtfc:!0,value:fcid,formulatype:formulatype,isSystemField:"false",isDependentfield:!0,parentfcid:parentFcid})}else{dispName=LookupFilterRule.FORM_COMPONENTS[fcid+""].formCompName+dispName,obj=$(ele),$(obj).val(ZPeople.decodeTxt(dispName)),$(obj).attr({fcid:fcid,pfcid:pfcid,iscrtfc:!0,value:fcid,isSystemField:String(isSystemField),isDependentfield:isDependentfield,parentfcid:parentFcid})}}else{var createviewattrs,text=$(ele).find("span").text(),id=$(ele).find("a").attr("id"),cName=$(ele).find("a").attr("cName"),formulatype=$(ele).find("a").attr("formulatype"),systemFieldValue=(isSystemField=$(ele).find("a").attr("isSystemField"),$(ele).find("a").attr("isdependontime"),$(ele).find("a").attr("isdepentonuser"),$(ele).find("a").attr("systemFieldValue")),crtId=(isDependentfield=void 0!=$(ele).find("a").attr("isDependentfield")&&$(ele).find("a").attr("isDependentfield"),$(ele).closest('[id^="criteria_Field_formCustom_"]').attr("id")),childFctype=(parentFcid=void 0==$(ele).find("a").attr("parentFcid")?"":$(ele).find("a").attr("parentFcid"),void 0==$(ele).find("a").attr("childFctype")?"":$(ele).find("a").attr("childFctype"));obj=LookupFilterRule.pageContainer.find("#"+crtId).find("#fieldSelection"),$(obj).val(ZPeople.decodeTxt(text)),"true"==isSystemField?(createviewattrs={fcid:systemFieldValue,iscrtfc:!0,value:systemFieldValue,isSystemField:isSystemField,isDependentfield:!1},"APPROVAL_STATUS"==systemFieldValue&&(createviewattrs.isapprovalform="true",createviewattrs.isdepentonuser=!1,createviewattrs.isdependontime="false"),"CREATEDBY"==systemFieldValue?(createviewattrs.isdepentonuser=!0,createviewattrs.isdependontime="false",createviewattrs.isapprovalform="false"):"CREATEDTIME"==systemFieldValue&&(createviewattrs.isdependontime="true",createviewattrs.isdepentonuser=!1,createviewattrs.isapprovalform="false")):createviewattrs={fcid:id,iscrtfc:!0,cName:cName,value:id,formulatype:formulatype,isSystemField:"false",isDependentfield:isDependentfield,parentFcid:parentFcid,childFctype:childFctype},$(obj).attr(createviewattrs)}LookupFilterRule.onFieldChange(obj)},dependentFieldPopoverCallback:function(obj){var crtRowId=$(obj).closest('div[id^="criteria_Field"]').attr("id"),defValue=(obj=$(obj).find("a")).attr("value"),parentFcid=void 0==obj.attr("parentFcid")?"":obj.attr("parentFcid"),fieldName=obj.text();LookupFilterRule.pageContainer.find("#"+crtRowId).find("#textvaluefordepn").attr({value:defValue,parentValue:parentFcid}),LookupFilterRule.pageContainer.find("#"+crtRowId).find("#textvaluefordepn").val(fieldName)},constructFieldOption:function(){var fieldOption="",components=LookupFilterRule.sort(LookupFilterRule.FORM_COMPONENTS);return $.each(components,function(key,value){var column=LookupFilterRule.FORM_COMPONENTS[value],dispname=column.formCompName;column.ishoursField&&(dispname+="("+ZPI18N.getString("zp.lookup.inMinutes")+")"),column.fcType!==ZPForm.Field.IMAGE&&void 0!==column.fcType&&(fieldOption+="<option value="+value+" cName="+column.cName+" fcType="+column.fcType+" formulatype="+column.formulaType+">"+dispname+"</option>")}),LookupFilterRule.fieldOptionConstruction=fieldOption,LookupFilterRule.fieldOptionConstruction},onFieldChange:function(obj){var fieldValue=$(obj).attr("value"),parentFcid=$(obj).attr("parentfcid"),criteriaRowId=$(obj).parent().parent().attr("id");if(LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepnparent").removeClass("has-error"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldCompName").removeClass("has-error"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#zp_criteria_field_error").hide(),LookupFilterRule.pageContainer.find("#zp_criteria_error").hide(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueField").show(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepnparent").hide(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").val(""),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").removeAttr("value"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").removeAttr("parentvalue"),"-1"===fieldValue){var conditionOption="<option value='-1'>"+ZPI18N.getString("zp.none")+"</option>";return LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").first().show(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").val(""),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#inputgrp").hide(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("disabled",!0),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[-1]),void LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("disable")}LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(parentFcid),$(obj).find("option[value='-1']").remove(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("style","visibility:hidden"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").html(ZPI18N.getString("zp.selectfield")),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("isfieldval","true"),LookupFilterRule.isfieldval=!0,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").val(""),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").prop("disabled",!1),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").prop("disabled",!1);var fctype,isSystemField=$(obj).attr("isSystemField"),isDependentfield=$(obj).attr("isDependentfield");if("true"!=isSystemField)"true"==isDependentfield&&(LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfield","true"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").append('<div class="dverrormsg DN" id="zp_criteria_field_error"></div>'),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueField").hide(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepnparent").show(),void 0!==LookupFilterRule.crtSelectedRecords[criteriaRowId]&&delete LookupFilterRule.crtSelectedRecords[criteriaRowId],LookupFilterRule.addPickListComponent(criteriaRowId,!1),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("style","visibility:visible"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("isfieldval","false"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("fieldval",fieldValue),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").html(ZPI18N.getString("zp.lookup.selValue")),LookupFilterRule.isfieldval=!1),LookupFilterRule.optionsfill(fieldValue,criteriaRowId);else if("true"==$(obj).attr("isdependontime")&&(fctype=ZPForm.Field.DATE_TIME),LookupFilterRule.addPickListComponent(criteriaRowId,!1),fctype==ZPForm.Field.DATE_TIME)LookupFilterRule.dateTimeFieldOpt(criteriaRowId,!1,fctype,!0);else if("true"==$(obj).attr("isdepentonuser")){conditionOption="<option value='"+ZPNewView.OPERATORS.LOGIN_USER+"'>"+ZPI18N.getString("zp.loginUser")+"</option>";var defOptn=ZPNewView.OPERATORS.LOGIN_USER;LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").val(""),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("disabled",!0),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",defOptn)}else if("true"==$(obj).attr("isapprovalform")&&LookupFilterRule.FORM_COMPONENTS.isApprovalForm){conditionOption="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",defOptn=ZPNewView.OPERATORS.IN,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").val(""),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("disabled",!0),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",defOptn),void 0!==LookupFilterRule.crtSelectedRecords[criteriaRowId]&&delete LookupFilterRule.crtSelectedRecords[criteriaRowId],LookupFilterRule.addPickListComponent(criteriaRowId,!0)}},optionsfill:function(fieldValue,criteriaRowId,isFromdep,opr){var cName,fcType=LookupFilterRule.FORM_COMPONENTS[fieldValue].fcType,formulaType=LookupFilterRule.FORM_COMPONENTS[fieldValue].formulaType,isLookup=!1;fcType==ZPForm.Field.SCRIPT&&-1!=formulaType&&(fcType=formulaType),cName=LookupFilterRule.FORM_COMPONENTS[fieldValue].cName,lablename=LookupFilterRule.FORM_COMPONENTS[fieldValue].labelname;var isBaseFieldTab="tabularFld"==Layout.Page.container.find("#dispName"+LookupFilterRule.fcId).parent().parent().attr("name"),dubstopvar=0;if(LookupFilterRule.BaseFORM_ID_COMPONENTS=LookupFilterRule.getBaseFieldComponents(),$.each(LookupFilterRule.BaseFORM_ID_COMPONENTS,function(key,value){if(fieldValue!=key||0===dubstopvar)if(fcType==ZPForm.Field.LOOKUP)value.fcType==ZPForm.Field.LOOKUP&&(0!=dubstopvar||LookupFilterRule.fcId==key||!isBaseFieldTab&&value.isTabular||void 0==value.refFormIddepend||value.refFormIddepend!=LookupFilterRule.FORM_COMPONENTS[fieldValue].refFormIddepend||(dubstopvar=1,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfieldAllowed","true")),void 0!==value.childComponents&&$.each(value.childComponents,function(k,v){0!=dubstopvar||LookupFilterRule.fcId==k||!isBaseFieldTab&&v.isTabular||void 0==v.refFormIddepend||v.refFormIddepend!=LookupFilterRule.FORM_COMPONENTS[fieldValue].refFormIddepend||(dubstopvar=1,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfieldAllowed","true"))}));else if(0==dubstopvar&&!value.isTabular&&LookupFilterRule.isDependFieldAllowed(LookupFilterRule.FORM_COMPONENTS[fieldValue].fcType,value.fcType,LookupFilterRule.FORM_COMPONENTS[fieldValue].seltype,value.seltype)&&(dubstopvar=1,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfieldAllowed","true")),void 0!==value.childComponents){if(fieldValue==value.refFormCompID)return;$.each(value.childComponents,function(k,v){0==dubstopvar&&!v.isTabular&&LookupFilterRule.isDependFieldAllowed(LookupFilterRule.FORM_COMPONENTS[fieldValue].fcType,v.fcType,LookupFilterRule.FORM_COMPONENTS[fieldValue].seltype,v.seltype)&&(dubstopvar=1,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfieldAllowed","true"))})}}),0==dubstopvar&&$.each(LookupFilterRule.BaseFORM_ID_COMPONENTS.loginusercomponents,function(key,value){0===dubstopvar&&(fcType==ZPForm.Field.LOOKUP?value.fcType==ZPForm.Field.LOOKUP&&(LookupFilterRule.fcId==key||!isBaseFieldTab&&value.isTabular||void 0==value.refFormIddepend||value.refFormIddepend!=LookupFilterRule.FORM_COMPONENTS[fieldValue].refFormIddepend||(dubstopvar=1,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfieldAllowed","true"))):!value.isTabular&&LookupFilterRule.isDependFieldAllowed(LookupFilterRule.FORM_COMPONENTS[fieldValue].fcType,value.fcType,LookupFilterRule.FORM_COMPONENTS[fieldValue].seltype,value.seltype)&&(dubstopvar=1,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfieldAllowed","true")))}),fcType==ZPForm.Field.LOOKUP&&(isLookup=!0,fcType=LookupFilterRule.FORM_COMPONENTS[fieldValue].reffcType,formulaType=LookupFilterRule.FORM_COMPONENTS[fieldValue].refformulaType),LookupFilterRule.FORM_COMPONENTS[fieldValue].isEncrypted&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP)conditionOption="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",conditionOption+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",conditionOption+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",conditionOption+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",fcType==ZPForm.Field.DATE&&LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("onclick","Calendar.setUpCalendar(event,this)"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("caltype","popup"),defOptn=ZPNewView.OPERATORS.EQUAL,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").removeAttr("onclick"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[defOptn]);else if(fcType==ZPForm.Field.TEXT||fcType==ZPForm.Field.EMAIL_ADDRESS||fcType==ZPForm.Field.PHONE_NUMBER||fcType==ZPForm.Field.URL||fcType==ZPForm.Field.TEXT_AREA||fcType==ZPForm.Field.BLOODGROUP||fcType==ZPForm.Field.GENDER||fcType==ZPForm.Field.COUNTRY){var conditionOption="",defOptn=0;isLookup?(conditionOption="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(conditionOption="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",conditionOption+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),"P_Employee"!=cName&&"P_Department"!=cName&&"P_Designation"!=cName&&"P_Legal_Entity"!=cName&&"P_Business_Unit"!=cName&&"P_Divisions"!=cName||("P_Department"==cName?(conditionOption+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_DEPT+"'>"+ZPI18N.getString("zp.loginUsersDept")+"</option>",defOptn=ZPNewView.OPERATORS.LOGIN_USERS_DEPT):"P_Employee"==cName?(conditionOption+="<option value='"+ZPNewView.OPERATORS.LOGIN_USER+"'>"+ZPI18N.getString("zp.loginUser")+"</option>",defOptn=ZPNewView.OPERATORS.LOGIN_USER):"P_Designation"==cName?(conditionOption+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_DESIG+"'>"+ZPI18N.getString("zp.loginUserDesig")+"</option>",defOptn=ZPNewView.OPERATORS.LOGIN_USERS_DESIG):"P_Legal_Entity"==cName?(conditionOption+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_ENTITY+"'>"+ZPI18N.getString("zp.loginUserEntity")+"</option>",defOptn=ZPNewView.OPERATORS.LOGIN_USERS_ENTITY):"P_Business_Unit"==cName?(conditionOption+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_UNIT+"'>"+ZPI18N.getString("zp.loginUserUnit")+"</option>",defOptn=ZPNewView.OPERATORS.LOGIN_USERS_UNIT):"P_Divisions"==cName?(conditionOption+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_DIVISION+"'>"+ZPI18N.getString("zp.loginUserDivision")+"</option>",defOptn=ZPNewView.OPERATORS.LOGIN_USERS_DIVISION):"P_Goals"==cName&&(conditionOption+="<option value='"+ZPNewView.OPERATORS.SUBORDINATES_GOAL+"'>"+ZPI18N.getString("zp.subordinatesgoals")+"</option>",defOptn=ZPNewView.OPERATORS.SUBORDINATES_GOAL)),conditionOption+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",conditionOption+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",fcType!=ZPForm.Field.BLOODGROUP&&fcType!=ZPForm.Field.GENDER&&fcType!=ZPForm.Field.COUNTRY&&(conditionOption+="<option value='24'>"+ZPI18N.getString("zp.startswith")+"</option>",conditionOption+="<option value='25'>"+ZPI18N.getString("zp.endswith")+"</option>",conditionOption+="<option value='26'>"+ZPI18N.getString("zp.contains")+"</option>",conditionOption+="<option value='27'>"+ZPI18N.getString("zp.notcontains")+"</option>"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").removeAttr("onclick"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[defOptn])}else if(fcType==ZPForm.Field.DATE||fcType==ZPForm.Field.DATE_TIME||fcType==ZPForm.Field.FORMULA_DATE)LookupFilterRule.dateTimeFieldOpt(criteriaRowId,isLookup,fcType);else if(fcType==ZPForm.Field.FILE_UPLOAD||fcType==ZPForm.Field.IMAGE){conditionOption="",defOptn=0;conditionOption+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",conditionOption+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",defOptn=ZPNewView.OPERATORS.EMPTY,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").removeAttr("onclick"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[defOptn])}else if(fcType==ZPForm.Field.CHECK_BOX){conditionOption="<option value='49'>"+ZPI18N.getString("zp.yes")+"</option>";conditionOption+="<option value='50'>"+ZPI18N.getString("zp.no")+"</option>",LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").removeAttr("onclick"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[49])}else if(fcType==ZPForm.Field.NUMBER||fcType==ZPForm.Field.CURRENCY||fcType==ZPForm.Field.DECIMAL){conditionOption="",defOptn=0;isLookup?(conditionOption="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(conditionOption="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",conditionOption+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),conditionOption+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",conditionOption+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",conditionOption+="<option value='20'>"+ZPI18N.getString("zp.lesserthan")+"</option>",conditionOption+="<option value='21'>"+ZPI18N.getString("zp.greaterthan")+"</option>",conditionOption+="<option value='22'>"+ZPI18N.getString("zp.lesserorequalto")+"</option>",conditionOption+="<option value='23'>"+ZPI18N.getString("zp.greaterorequalto")+"</option>",LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").removeAttr("onclick"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[defOptn])}else if(fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY){conditionOption="";var defval=ZPNewView.OPERATORS.IN;conditionOption="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",conditionOption+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",conditionOption+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",fcType==ZPForm.Field.PICKLIST&&(conditionOption+="<option value='26'>"+ZPI18N.getString("zp.contains")+"</option>",conditionOption+="<option value='27'>"+ZPI18N.getString("zp.notcontains")+"</option>"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").removeAttr("onclick"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[defval]),void 0!==LookupFilterRule.crtSelectedRecords[criteriaRowId]&&delete LookupFilterRule.crtSelectedRecords[criteriaRowId]}else{conditionOption="",defOptn=0;isLookup?(conditionOption="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(conditionOption="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").removeAttr("onclick"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[defOptn])}isLookup&&(void 0!==LookupFilterRule.crtSelectedRecords[criteriaRowId]&&delete LookupFilterRule.crtSelectedRecords[criteriaRowId]);LookupFilterRule.addPickListComponent(criteriaRowId,isLookup),isLookup||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY||fcType==ZPForm.Field.DATE||fcType==ZPForm.Field.DATE_TIME||fcType==ZPForm.Field.FORMULA_DATE?LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").on("keydown",function(e){e.preventDefault()}):LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").off("keydown"),isFromdep&&LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[opr]),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").trigger("change")},dateTimeFieldOpt:function(criteriaRowId,isLookup,fcType,isSystemField){var conditionOption="",defOptn=0;isLookup?(conditionOption="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(conditionOption="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",conditionOption+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),isSystemField||(conditionOption+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",conditionOption+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>"),conditionOption+="<option value='20'>"+ZPI18N.getString("zp.before")+"</option>",conditionOption+="<option value='21'>"+ZPI18N.getString("zp.after")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.YESTERDAY+"'>"+ZPI18N.getString("zp.yesterday")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.TODAY+"'>"+ZPI18N.getString("zp.today")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.TOMORROW+"'>"+ZPI18N.getString("zp.tomorrow")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.LAST_WEEK+"'>"+ZPI18N.getString("zp.lastweek")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.THIS_WEEK+"'>"+ZPI18N.getString("zp.thisweek")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.NEXT_WEEK+"'>"+ZPI18N.getString("zp.nextweek")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.LAST_MONTH+"'>"+ZPI18N.getString("zp.lastmonth")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.THIS_MONTH+"'>"+ZPI18N.getString("zp.thismonth")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.NEXT_MONTH+"'>"+ZPI18N.getString("zp.nextmonth")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.LAST_YEAR+"'>"+ZPI18N.getString("zp.lastyear")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.CURRENT_YEAR+"'>"+ZPI18N.getString("zp.thisyear")+"</option>",conditionOption+="<option value='"+ZPNewView.OPERATORS.NEXT_YEAR+"'>"+ZPI18N.getString("zp.nextyear")+"</option>",fcType==ZPForm.Field.DATE_TIME?LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("onclick","Calendar.setUpCalendar(event,this,1)"):LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("onclick","Calendar.setUpCalendar(event,this)"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("caltype","popup"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").html(conditionOption),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").select2("val",[defOptn])},changedependfiled:function(obj){var fieldValue=$(obj).attr("fieldval"),criteriaRowId=$(obj).parent().parent().parent().attr("id"),isfieldval=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("isfieldval");LookupFilterRule.BaseFORM_ID_COMPONENTS=LookupFilterRule.getBaseFieldComponents();var column=LookupFilterRule.FORM_COMPONENTS[fieldValue];if(void 0==isfieldval||"true"==isfieldval){LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfield","true"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").append('<div class="dverrormsg DN" id="zp_criteria_field_error"></div>'),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueField").hide(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepnparent").show();var defValue=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").attr("value"),parentcrtvalue=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").attr("parentvalue"),isloginusercomponent="loginusercomponents"==LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").attr("parentvalue");if(LookupFilterRule.fieldOptionPopOverInit(criteriaRowId,!0,defValue,parentcrtvalue,isloginusercomponent),column.fcType!=ZPForm.Field.LOOKUP&&column.fcType!=ZPForm.Field.PICKLIST)"61"==(defOpr=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').val())&&(defOpr="18"),"62"==defOpr&&(defOpr="19"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').select2("destroy"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').find('option[value="61"]').attr("value","18"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').find('option[value="62"]').attr("value","19"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').val(defOpr).select2();void 0!==LookupFilterRule.crtSelectedRecords[criteriaRowId]&&delete LookupFilterRule.crtSelectedRecords[criteriaRowId],LookupFilterRule.addPickListComponent(criteriaRowId,!1),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").text("select value"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("isfieldval","false"),LookupFilterRule.isfieldval=!1}else{var defOpr;if(LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfield","false"),LookupFilterRule.isfieldval=!0,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").html(ZPI18N.getString("zp.selectfield")),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("isfieldval","true"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepnparent").hide(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueField").show(),column.fcType!=ZPForm.Field.LOOKUP&&column.fcType!=ZPForm.Field.PICKLIST)"61"==(defOpr=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').val())&&(defOpr="18"),"62"==defOpr&&(defOpr="19"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').select2("destroy"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').find('option[value="61"]').attr("value","18"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').find('option[value="62"]').attr("value","19"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find('[isopr="true"]').val(defOpr).select2();LookupFilterRule.optionsfill(fieldValue,criteriaRowId,!0,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").val())}},isDependFieldAllowed:function(baseFieldFcType,refFieldFcType,baseFieldSelType,refFieldSelType){return 13!=refFieldSelType&&26!==baseFieldFcType&&(baseFieldFcType==refFieldFcType||baseFieldFcType==ZPForm.Field.TEXT_AREA&&refFieldFcType==ZPForm.Field.TEXT||(baseFieldFcType==ZPForm.Field.CURRENCY||baseFieldFcType==ZPForm.Field.DECIMAL)&&refFieldFcType==ZPForm.Field.NUMBER||baseFieldFcType==ZPForm.Field.PICKLIST&&refFieldFcType==ZPForm.Field.TEXT)},onConditionChange:function(obj){var fcType,optval=$(obj).val(),criteriaRowId=$(obj).parent().parent().attr("id"),fieldValue=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("value"),isSystemField=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isSystemField"),isfieldval=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("isfieldval"),parentfcid=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("parentfcid");if(LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").val(""),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").removeAttr("value"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepn").removeAttr("parentvalue"),LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(parentfcid),"false"!==isfieldval&&LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("style","visibility:hidden"),fcType="true"==isSystemField?void 0:LookupFilterRule.FORM_COMPONENTS[fieldValue].fcType,LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepnparent").removeClass("has-error"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldCompName").removeClass("has-error"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find(".error-msg").hide(),LookupFilterRule.pageContainer.find("#zp_criteria_error").hide(),optval==ZPNewView.OPERATORS.EMPTY||optval==ZPNewView.OPERATORS.NOT_EMPTY||optval==ZPNewView.OPERATORS.TRUE||optval==ZPNewView.OPERATORS.FALSE||optval==ZPNewView.OPERATORS.YESTERDAY||optval==ZPNewView.OPERATORS.TODAY||optval==ZPNewView.OPERATORS.TOMORROW||optval==ZPNewView.OPERATORS.LAST_MONTH||optval==ZPNewView.OPERATORS.THIS_MONTH||optval==ZPNewView.OPERATORS.NEXT_MONTH||optval==ZPNewView.OPERATORS.LAST_YEAR||optval==ZPNewView.OPERATORS.CURRENT_YEAR||optval==ZPNewView.OPERATORS.NEXT_YEAR||optval==ZPNewView.OPERATORS.LOGIN_USERS_DEPT||optval==ZPNewView.OPERATORS.LOGIN_USER||optval==ZPNewView.OPERATORS.THIS_WEEK||optval==ZPNewView.OPERATORS.LAST_WEEK||optval==ZPNewView.OPERATORS.NEXT_WEEK||optval==ZPNewView.OPERATORS.LOGIN_USERS_DESIG||optval==ZPNewView.OPERATORS.STARTS_WITH||optval==ZPNewView.OPERATORS.ENDS_WITH||optval==ZPNewView.OPERATORS.CONTAINS||optval==ZPNewView.OPERATORS.NOT_CONTAINS||optval==ZPNewView.OPERATORS.SUBORDINATES_GOAL)LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("style","visibility:hidden"),LookupFilterRule.addPickListComponent(criteriaRowId,!1),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#textvaluefordepnparent").hide(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueField").show(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").val(""),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("disabled",!0),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isdependentfield","false"),optval!=ZPNewView.OPERATORS.STARTS_WITH&&optval!=ZPNewView.OPERATORS.ENDS_WITH&&optval!=ZPNewView.OPERATORS.CONTAINS&&optval!=ZPNewView.OPERATORS.NOT_CONTAINS||LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").removeAttr("disabled"),(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY)&&void 0!==LookupFilterRule.crtSelectedRecords[criteriaRowId]&&delete LookupFilterRule.crtSelectedRecords[criteriaRowId];else if(optval==ZPNewView.OPERATORS.NOT_IN||optval==ZPNewView.OPERATORS.IN){if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY){if(optval==ZPNewView.OPERATORS.IN)"true"==LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfieldAllowed")&&(LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("style","visibility:visible"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("fieldval",fieldValue));return LookupFilterRule.addPickListComponent(criteriaRowId,!0),void 0!==LookupFilterRule.crtSelectedRecords[criteriaRowId]&&delete LookupFilterRule.crtSelectedRecords[criteriaRowId],LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").val(""),void LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").attr("disabled",!0)}LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").prop("disabled",!1)}else{if(fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST&&fcType!=ZPForm.Field.NEW_COUNTRY||LookupFilterRule.addPickListComponent(criteriaRowId,!1),fcType!==ZPForm.Field.LOOKUP)"true"==LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#fieldSelection").attr("isDependentfieldAllowed")&&(LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("style","visibility:visible"),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#lkupselectopttxt").attr("fieldval",fieldValue));LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").prop("disabled",!1),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").val("")}if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY){var optVal=LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("[isopr='true']").val();optVal==ZPNewView.OPERATORS.NOT_IN||optVal==ZPNewView.OPERATORS.IN?LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").on("keydown",function(e){e.preventDefault()}):LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").off("keydown")}},addPickListComponent:function(criteriaRowId,addFlag){addFlag?(LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").first().hide(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#inputgrp #txtValueFieldInput").val(""),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#inputgrp").show(),$(".dvSetpopup").popover({container:"#"+Layout.Page.container.attr("id"),html:!0,content:function(){return $(this).parent().children().find("#dvSetpopup").html()}})):(LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#inputgrp").hide(),LookupFilterRule.pageContainer.find("#"+criteriaRowId).find("#txtValueFieldInput").first().show())},getPickListComp:function(obj){var parent=$(obj).parent().parent().parent(),crtID=$(parent).attr("id");if(LookupFilterRule.pageContainer.find("#"+crtID).find("#crtAllCheck").prop("checked",!1),"APPROVAL_STATUS"==(fcID=$(parent).find("#fieldSelection").attr("value"))){LookupFilterRule.crtSelectionRecords.APPROVAL_STATUS=[{Id:"-1",VAL:"-1",Value:"Pending"},{Id:"1",VAL:"1",Value:"Approved"},{Id:"0",VAL:"0",Value:"Rejected"}],$(parent).find("#lookupOptions").attr("lkid",crtID),$(parent).find("#lookupOptions").empty().append(LookupFilterRule.approvaloptions)}else{var firstfcId,fcID=$(parent).find("#fieldSelection").attr("value"),fcType=LookupFilterRule.FORM_COMPONENTS[fcID].fcType,cName=LookupFilterRule.FORM_COMPONENTS[fcID].cName,list="";firstfcId!=fcID&&(firstfcId=fcID,"EMPLOYEESTATUS"==cName?(LookupFilterRule.crtSelectionRecords[fcID]=[{Id:"Active",VAL:"Active",Value:"Active"}],list+='<li class="" id="Active" val="Active" onclick="LookupFilterRule.crtSelectRecord(this)"><span>Active</span></li>'):(LookupFilterRule.getLookUpOptions(fcID,fcType),$.each(LookupFilterRule.crtSelectionRecords[fcID],function(key,value){list+='<li class="" id="'+value.Id+'" val="'+value.Id+'" onclick="LookupFilterRule.crtSelectRecord(this)"><span>'+value.Value+"</span></li>"})),$(parent).find("#lookupOptions").empty().append(list),$(parent).find("#lookupOptions").attr("lkid",crtID))}void 0!==LookupFilterRule.crtSelectedRecords[crtID]&&LookupFilterRule.makeSelectable(crtID,LookupFilterRule.crtSelectedRecords[crtID],!1),LookupFilterRule.pageContainer.find(".dvSetpopup").not($(obj)).popover("hide")},getLookUpOptions:function(fcID,fcType){if(void 0===LookupFilterRule.crtSelectionRecords[fcID]&&void 0!==fcID)if(fcType==ZPForm.Field.LOOKUP){var fcId=[];fcId.push(fcID),$.ajax({type:"POST",async:!1,url:"/formAction.zp",data:{mode:"fetchFormLookupOtions",conreqcsr:csrfToken,luFcIds:JSON.stringify(fcId),isViewOpt:!0,isFromFormCustom:!0},success:function(data){LookupFilterRule.crtSelectionRecords[fcID]=data.message,LookupFilterRule.crtSelectionRecords[fcID]=LookupFilterRule.crtSelectionRecords[fcID][fcID]}})}else $.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:{mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:fcID,fcType:fcType},success:function(data){LookupFilterRule.crtSelectionRecords[fcID]=JSON.stringify(data.lookupDetailsList),LookupFilterRule.crtSelectionRecords[fcID]=LookupFilterRule.crtSelectionRecords[fcID].replace(/DISPVALUE/g,"Value"),LookupFilterRule.crtSelectionRecords[fcID]=LookupFilterRule.crtSelectionRecords[fcID].replace(/VALUE/g,"VAL"),LookupFilterRule.crtSelectionRecords[fcID]=LookupFilterRule.crtSelectionRecords[fcID].replace(/ID/g,"Id"),LookupFilterRule.crtSelectionRecords[fcID]=JSON.parse(LookupFilterRule.crtSelectionRecords[fcID])}})},makeSelectable:function(crtID,selectedRecord,isFromsearch){if(isFromsearch)var pageContainer=Layout.Page.container;else pageContainer=LookupFilterRule.pageContainer.find("#"+crtID);var originalTotalLength;if(pageContainer.find("#crtAllCheck").prop("checked",!1),"true"==LookupFilterRule.pageContainer.find("#"+crtID).find("#fieldSelection").find("option:selected").attr("isSystemField"))originalTotalLength=Object.keys(LookupFilterRule.approvaloptionsvalues).length;else{var fcID=LookupFilterRule.pageContainer.find("#"+crtID).find("#fieldSelection").attr("value");originalTotalLength=LookupFilterRule.crtSelectionRecords[fcID].length}var parent=pageContainer.find("#lookupOptions"),childList=pageContainer.find("#lookupOptions").children();if(!(originalTotalLength<=0)){selectedRecord.length===originalTotalLength&&(pageContainer.find("#crtAllCheck")[0].checked=!0),$.each(selectedRecord,function(key,value){var row=$(parent).find("li#"+value);void 0!==row&&row.length>0&&$(row).removeClass().addClass("sel")});var checkBoxSelectedCount=pageContainer.find("#lookupOptions").find('li[class="sel"]').length,currChildlength=$(childList).length;0===checkBoxSelectedCount&&0===currChildlength?pageContainer.find("#crtAllCheck").prop("checked",!1):checkBoxSelectedCount===currChildlength?pageContainer.find("#crtAllCheck").attr("checked",!0):pageContainer.find("#crtAllCheck").prop("checked",!1)}},allLookUpOptSel:function(obj){var isAllChecked=$(obj).is(":checked"),childList=$(obj).parent().parent().parent().parent().parent().find("#lookupOptions").children(),childLength=childList.length;isAllChecked?childLength>0?($.each(childList,function(key,value){LookupFilterRule.crtSelectRecord($(this),isAllChecked)}),$(obj)[0].checked=!0):$(obj).prop("checked",!1):childLength>0&&$.each(childList,function(key,value){LookupFilterRule.crtSelectRecord($(this),isAllChecked)})},crtSelectRecord:function(obj,isCheck){var criteria_row_id=$(obj).parent().attr("lkid"),isChecked=!1;void 0==isCheck?$(obj).toggleClass("sel"):isCheck?$(obj).removeClass().addClass("sel"):$(obj).removeClass(),"sel"==$(obj).attr("class")&&(isChecked=!0);var fcType,fcID,tr=LookupFilterRule.pageContainer.find("#"+criteria_row_id),isapprovalForm=$(tr).find("#fieldSelection").attr("isSystemField");("true"==isapprovalForm?fcType=null:(fcID=$(tr).find("#fieldSelection").attr("value"),fcType=LookupFilterRule.FORM_COMPONENTS[fcID].fcType),Layout.Page.container.find("#crtAllCheck").is(":checked"))?Layout.Page.container.find("#crtAllCheck").prop("checked",!1):Layout.Page.container.find("#lookupOptions").children().length===Layout.Page.container.find("#lookupOptions").find('li[class="sel"]').length&&Layout.Page.container.find("#crtAllCheck").prop("checked",!0);var id,crtID=$(tr).attr("id"),selectedRecords=LookupFilterRule.crtSelectedRecords[crtID];void 0===selectedRecords&&(selectedRecords=[]),id="true"==isapprovalForm?$(obj).attr("val"):$(obj).attr("id");var index=selectedRecords.indexOf(id);isChecked?-1===index&&selectedRecords.push(id):-1!==index&&selectedRecords.splice(index,1),LookupFilterRule.crtSelectedRecords[crtID]=selectedRecords,LookupFilterRule.displayCrtTxt(crtID,fcType,obj)},displayCrtTxt:function(crtID,fcType,obj){LookupFilterRule.pageContainer.find("#"+crtID).find("#txtValueField #inputgrp #txtValueFieldInput").val(void 0);var fcID=LookupFilterRule.pageContainer.find("#"+crtID).find("#fieldSelection").attr("value"),nameArr=LookupFilterRule.getRecordNamesByFcID(crtID,fcID,fcType);LookupFilterRule.pageContainer.find("#"+crtID).find("#txtValueField #inputgrp #txtValueFieldInput").val(nameArr.toString())},getRecordNamesByFcID:function(crtID,fcID,fcType){var tempList=[];if(null==fcType)$.each(LookupFilterRule.crtSelectedRecords[crtID],function(key){tempList.push(LookupFilterRule.approvaloptionsvalues[LookupFilterRule.crtSelectedRecords[crtID][key]])});else{if(void 0===fcID)return null;var selectedRecords=LookupFilterRule.crtSelectedRecords[crtID],selectionRecords=LookupFilterRule.crtSelectionRecords[fcID];if(void 0===selectedRecords||void 0===selectionRecords)return tempList;$.each(selectedRecords,function(key,value){$.each(selectionRecords,function(k,v){value===v.Id+""&&tempList.push(ZPeople.decodeTxt(v.Value))})})}return tempList},crtFieldSearch:function(){$(document).on("keyup","#fieldSearch",function(e){var parent=$(this).closest('[isParent^="true"]'),data=this.value.split(" "),allDataObj=$(parent).find("[name=list-group-item]");allDataObj.hide(),$.each(data,function(i,v){allDataObj=allDataObj.filter("*:Contains('"+v+"')")}),allDataObj.show()})},crtRecordSearch:function(obj){var criteria_row_id=Layout.Page.container.find("#lookupOptions").attr("lkid"),tr=LookupFilterRule.pageContainer.find("#"+criteria_row_id),fcID=$(tr).find("#fieldSelection").attr("value"),isApproval=!1;if("APPROVAL_STATUS"==fcID){var currRecords=LookupFilterRule.crtSelectionRecords[fcID];isApproval=!0}else currRecords=LookupFilterRule.crtSelectionRecords[fcID];if(!(Object.keys(currRecords).length<=0)){var crtID=$(tr).attr("id"),searchStr=$(obj).val().trim();if(searchStr.length<=0)return LookupFilterRule.constructCrtSelectionRecord(crtID,currRecords,void 0,void 0,isApproval),void(void 0!==LookupFilterRule.crtSelectedRecords[crtID]&&LookupFilterRule.makeSelectable(crtID,LookupFilterRule.crtSelectedRecords[crtID],!0));searchStr=searchStr.toLowerCase();var tempList=[];$.each(currRecords,function(key,value){-1!==value.Value.toLowerCase().indexOf(searchStr)&&tempList.push(value)}),LookupFilterRule.constructCrtSelectionRecord(crtID,tempList,void 0,void 0,isApproval),void 0!==LookupFilterRule.crtSelectedRecords[crtID]&&LookupFilterRule.makeSelectable(crtID,LookupFilterRule.crtSelectedRecords[crtID],!0)}},constructCrtSelectionRecord:function(crtID,selectionRecord,fcType,fcId,isApproval){if(jQuery.isEmptyObject(selectionRecord)||selectionRecord.length<=0)Layout.Page.container.find("#lookupOptions").html(ZPI18N.getString("zp.norec"));else{var li="";$.each(selectionRecord,function(key,value){li+=isApproval?'<li class="" id="'+value.Id+'" val="'+value.Id+'" dispval="'+value.Value+'" onclick="LookupFilterRule.crtSelectRecord(this)"><span>'+value.Value+"</span></li>":'<li class="" id="'+value.Id+'" val="'+value.Id+'" onclick="LookupFilterRule.crtSelectRecord(this)"><span>'+value.Value+"</span></li>"}),Layout.Page.container.find("#lookupOptions").empty().html(li)}},submitFilterValue:function(obj){var isValid=!0,criteriaList=LookupFilterRule.pageContainer.find("#criteria_Field").children(),crtJson=[];if($.each(criteriaList,function(key){var conjunctiveCondn;conjunctiveCondn=0===key?"AND":$(this).find("#operatorSelection").val();var formComponentID=$(this).find("#fieldSelection").attr("value"),operator=$(this).find("[isopr='true']").val(),isSystemField=$(this).find("#fieldSelection").attr("isSystemField"),isDependentfield=$(this).find("#fieldSelection").attr("isDependentfield"),parentFcId=$(this).find("#fieldSelection").attr("parentfcid");if(LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(parentFcId),"-1"!==formComponentID&&"-1"!==operator){var fcType,sysFieldName,isApprovalForm,crtValue="",txtValueAttr=$(this).find("#txtValueField").find("#txtValueFieldInput").attr("disabled"),parentcrtValue=($(this).find("#txtValueField").parent(),"");void 0==txtValueAttr&&(crtValue=$(this).find("#txtValueField").find("#txtValueFieldInput").val());var isEncrypted=!1;if("true"==isSystemField)sysFieldName=$(this).find("#fieldSelection").attr("value"),isApprovalForm=$(this).find("#fieldSelection").attr("isapprovalform"),fcType=$(this).find("#fieldSelection").attr("fcType"),"true"==$(this).find("#fieldSelection").attr("isdependontime")&&(fcType=ZPForm.Field.DATE_TIME,isApprovalForm="false");else"true"==isDependentfield?(crtValue=$(this).find("#textvaluefordepn").attr("value"),parentcrtValue=$(this).find("#textvaluefordepn").attr("parentValue"),fcType=LookupFilterRule.FORM_COMPONENTS[formComponentID].fcType):"true"!=isSystemField&&(fcType=LookupFilterRule.FORM_COMPONENTS[formComponentID].fcType,isEncrypted=LookupFilterRule.FORM_COMPONENTS[formComponentID].isEncrypted);if("true"!=isApprovalForm&&(void 0!=isDependentfield&&"false"!=isDependentfield||fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&fcType!=ZPForm.Field.NEW_COUNTRY||operator!=ZPNewView.OPERATORS.NOT_IN&&operator!=ZPNewView.OPERATORS.IN)||(crtValue=$(this).find("#inputgrp #txtValueFieldInput").val(),txtValueAttr=null),operator!=ZPNewView.OPERATORS.THIS_WEEK&&operator!=ZPNewView.OPERATORS.LAST_WEEK&&operator!=ZPNewView.OPERATORS.NEXT_WEEK&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_DEPT&&operator!=ZPNewView.OPERATORS.LOGIN_USER&&operator!=ZPNewView.OPERATORS.EMPTY&&operator!=ZPNewView.OPERATORS.NOT_EMPTY&&operator!=ZPNewView.OPERATORS.YESTERDAY&&operator!=ZPNewView.OPERATORS.TODAY&&operator!=ZPNewView.OPERATORS.TOMORROW&&operator!=ZPNewView.OPERATORS.LAST_YEAR&&operator!=ZPNewView.OPERATORS.CURRENT_YEAR&&operator!=ZPNewView.OPERATORS.NEXT_YEAR&&operator!=ZPNewView.OPERATORS.LAST_MONTH&&operator!=ZPNewView.OPERATORS.THIS_MONTH&&operator!=ZPNewView.OPERATORS.NEXT_MONTH&&operator!=ZPNewView.OPERATORS.TRUE&&operator!=ZPNewView.OPERATORS.FALSE&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_DESIG&&operator!=ZPNewView.OPERATORS.SUBORDINATES_GOAL&&(void 0!=crtValue&&0!=crtValue.length||($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.fieldupdate.specifyfield")).show(),isValid=!1)),"true"!=isDependentfield&&fcType==ZPForm.Field.DATE_TIME&&(operator==ZPNewView.OPERATORS.EQUAL||operator==ZPNewView.OPERATORS.NOT_EQUAL||operator==ZPNewView.OPERATORS.GREATER_THAN||operator==ZPNewView.OPERATORS.LESS_THAN)){var dateValueSplit=crtValue.split(" ");if(isValid=ZPUtil.Validation.isDate(dateValueSplit[0])){var valueOfTime=dateValueSplit[1].split(":");(valueOfTime[0]>12||valueOfTime[1]>60)&&(isValid=!1),isValid&&(isValid="AM"==dateValueSplit[2]||"PM"==dateValueSplit[2])}if(!isValid)return void $(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.datetimeerr")).show()}if(void 0!==txtValueAttr||"disabled"==txtValueAttr||LookupFilterRule.validCriteriaValue($(this))||(isValid=!1),isValid&&isEncrypted&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&operator!=ZPNewView.OPERATORS.EMPTY&&operator!=ZPNewView.OPERATORS.NOT_EMPTY&&operator!=ZPNewView.OPERATORS.EQUAL&&operator!=ZPNewView.OPERATORS.NOT_EQUAL&&($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.EncryptedCriteriaError")).show(),isValid=!1),isValid){var crt;if("true"==isSystemField){if("true"==isApprovalForm){operator=ZPNewView.OPERATORS.EQUAL;var crtID=$(this).attr("id");crtValue=LookupFilterRule.crtSelectedRecords[crtID]}crt={isSystemField:"true",sysFieldName:sysFieldName,Operator:operator,CrtVal:crtValue,conjunctiveCondn:conjunctiveCondn}}else if("true"==isDependentfield)crt={isDependentfield:!0,dependentfield:crtValue,formComponentID:formComponentID,Operator:operator,CrtVal:crtValue,conjunctiveCondn:conjunctiveCondn},void 0!=parentFcId&&""!=parentFcId&&(crt.parentfcid=parentFcId),void 0!=parentcrtValue&&""!=parentcrtValue&&("loginusercomponents"===parentcrtValue?crt.isloginusercomponent=!0:crt.parentcrtvalue=parentcrtValue);else if(crt={formComponentID:formComponentID,Operator:operator,CrtVal:crtValue,conjunctiveCondn:conjunctiveCondn},void 0!=parentFcId&&""!=parentFcId&&(crt.parentfcid=parentFcId),fcType==ZPForm.Field.LOOKUP&&(crt.lookupFcId=LookupFilterRule.FORM_COMPONENTS[formComponentID].refFormCompID),!(fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&fcType!=ZPForm.Field.NEW_COUNTRY||operator!=ZPNewView.OPERATORS.NOT_IN&&operator!=ZPNewView.OPERATORS.IN)){var crtdisval="",selectedRecords=(crtID=$(this).attr("id"),LookupFilterRule.crtSelectedRecords[crtID]),selectionRecords=LookupFilterRule.crtSelectionRecords[formComponentID];$.each(selectedRecords,function(key,value){$.each(selectionRecords,function(k,v){value===v.Id+""&&(crtdisval+=v.Value+",")})}),crtdisval=crtdisval.slice(0,-1),crt.dispVal=crtdisval,crt.CrtVal=LookupFilterRule.crtSelectedRecords[crtID]}crtJson.push(crt)}}}),isValid){Layout.Page.container.find("#ImportForm").val();var params={mode:"saveFilterRule",fcId:LookupFilterRule.fcId,criteriaValues:JSON.stringify(crtJson)};ZPeople.Request.send(LookupFilterRule.url,params,LookupFilterRule.saveFilterRule,crtJson)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invalidentries"))},saveFilterRule:function(data,undefined,crtJson){if(LookupFilterRule.savedCriteria=crtJson,data.isSuccess&&(LookupFilterRule.FilterRule[LookupFilterRule.fcId]=data.filterRule,LookupFilterRule.savedCriteria=data.filterRule,ZPForm.FORM_COMPONENT_DATA[formCustom.formid]!=undefined&&delete ZPForm.FORM_COMPONENT_DATA[formCustom.formid],LookupFilterRule.pageContainer.modal("hide"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))),data.isSuccess||"new"==data){for(var count=0,text="",i=0;i<LookupFilterRule.savedCriteria.length;i++){var criteriaval1="",Operator=LookupFilterRule.savedCriteria[i].Operator;if(LookupFilterRule.savedCriteria[i].isSystemField){criteriaval=LookupFilterRule.savedCriteria[i].CrtVal;var sysFieldName=LookupFilterRule.savedCriteria[i].sysFieldName;if("APPROVAL_STATUS"==LookupFilterRule.savedCriteria[i].sysFieldName){if(!LookupFilterRule.ALL_FORM_COMPONENTS[LookupFilterRule.formId].isApprovalForm)return;var criteriaval;sysFieldName=ZPI18N.getString("zp.lookup.recordappstat"),criteriaval=JSON.parse(LookupFilterRule.savedCriteria[i].CrtVal);for(var j=0;j<criteriaval.length;j++)criteriaval1+=LookupFilterRule.approvaloptionsvalues[criteriaval[j]]+",";criteriaval="'"+criteriaval1.slice(0,-1)+"'"}var conjunctiveCondn="";0!=count?(conjunctiveCondn=LookupFilterRule.savedCriteria[i].conjunctiveCondn,text+=LookupFilterRule.CONDITION[conjunctiveCondn]+" ( "+sysFieldName+" "+LookupFilterRule.OPERATORS[Operator]+" "+criteriaval+" ) "):text+="( "+sysFieldName+" "+LookupFilterRule.OPERATORS[Operator]+" "+criteriaval+" ) ",count++}else{var fcType=LookupFilterRule.savedCriteria[i].fcType;criteriaval=LookupFilterRule.savedCriteria[i].CrtVal;var fcId=LookupFilterRule.savedCriteria[i].formComponentID,parentFCID=LookupFilterRule.savedCriteria[i].parentfcid;LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(parentFCID);var cname=LookupFilterRule.savedCriteria[i].cName,isdepncrtval=(conjunctiveCondn="",criteriaval);if(Operator!=ZPNewView.OPERATORS.THIS_WEEK&&Operator!=ZPNewView.OPERATORS.LAST_WEEK&&Operator!=ZPNewView.OPERATORS.NEXT_WEEK&&Operator!=ZPNewView.OPERATORS.LOGIN_USERS_DEPT&&Operator!=ZPNewView.OPERATORS.LOGIN_USER&&Operator!=ZPNewView.OPERATORS.EMPTY&&Operator!=ZPNewView.OPERATORS.NOT_EMPTY&&Operator!=ZPNewView.OPERATORS.YESTERDAY&&Operator!=ZPNewView.OPERATORS.TODAY&&Operator!=ZPNewView.OPERATORS.TOMORROW&&Operator!=ZPNewView.OPERATORS.LAST_YEAR&&Operator!=ZPNewView.OPERATORS.CURRENT_YEAR&&Operator!=ZPNewView.OPERATORS.NEXT_YEAR&&Operator!=ZPNewView.OPERATORS.LAST_MONTH&&Operator!=ZPNewView.OPERATORS.THIS_MONTH&&Operator!=ZPNewView.OPERATORS.NEXT_MONTH&&Operator!=ZPNewView.OPERATORS.TRUE&&Operator!=ZPNewView.OPERATORS.FALSE&&Operator!=ZPNewView.OPERATORS.LOGIN_USERS_ENTITY&&Operator!=ZPNewView.OPERATORS.LOGIN_USERS_UNIT&&Operator!=ZPNewView.OPERATORS.LOGIN_USERS_DIVISION&&Operator!=ZPNewView.OPERATORS.SUBORDINATES_GOAL&&fcType!=ZPForm.Field.NUMBER&&fcType!=ZPForm.Field.DECIMAL&&fcType!=ZPForm.Field.CURRENCY&&fcType!=ZPForm.Field.PHONE_NUMBER&&fcType!=ZPForm.Field.CHECK_BOX&&(criteriaval="'"+criteriaval+"'"),"REPORTING_TO"==cname&&64==Operator&&(Operator="reportingto"),"GOAL"==cname&&73==Operator){var key=Object.keys(LookupFilterRule.FilterRule);Layout.Page.container.find("#setFilterInpBox"+key[0]).prop("disabled","true")}if(LookupFilterRule.FORM_COMPONENTS[fcId]!=undefined){if(void 0!==LookupFilterRule.savedCriteria[i].dispVal&&(criteriaval="'"+LookupFilterRule.savedCriteria[i].dispVal+"'"),0!=count&&(conjunctiveCondn=LookupFilterRule.savedCriteria[i].conjunctiveCondn,text+=LookupFilterRule.CONDITION[conjunctiveCondn]+" "),LookupFilterRule.savedCriteria[i].isDependentfield){var parentFCName="",parentcrtValue="";text+="(",parentFCID!=undefined&&null!=parentFCID&&(LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(),parentFCName=LookupFilterRule.FORM_COMPONENTS[parentFCID].labelname,LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(parentFCID),text+=parentFCName+"."),text+=LookupFilterRule.FORM_COMPONENTS[fcId].labelname+" "+LookupFilterRule.OPERATORS[Operator]+" ",LookupFilterRule.BaseFORM_ID_COMPONENTS=LookupFilterRule.getBaseFieldComponents(),LookupFilterRule.savedCriteria[i].isloginusercomponent?(LookupFilterRule.BaseFORM_ID_COMPONENTS=LookupFilterRule.getBaseFieldComponents("loginusercomponents"),text+="Logged in user."):LookupFilterRule.savedCriteria[i].parentcrtvalue&&LookupFilterRule.savedCriteria[i].parentcrtvalue!=undefined&&(parentcrtValue=LookupFilterRule.BaseFORM_ID_COMPONENTS[LookupFilterRule.savedCriteria[i].parentcrtvalue].labelname,LookupFilterRule.BaseFORM_ID_COMPONENTS=LookupFilterRule.getBaseFieldComponents(LookupFilterRule.savedCriteria[i].parentcrtvalue),text+=parentcrtValue+"."),text+=LookupFilterRule.BaseFORM_ID_COMPONENTS[isdepncrtval].labelname+" ) "}else parentFCID!=undefined&&null!=parentFCID&&(LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(),parentFCName=LookupFilterRule.FORM_COMPONENTS[parentFCID].labelname,LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.getFieldComponents(parentFCID),text+=parentFCName+"."),text+=LookupFilterRule.FORM_COMPONENTS[fcId].formCompName+" "+LookupFilterRule.OPERATORS[Operator]+" "+criteriaval;count++}}}Layout.Page.container.find("#setFilderCriText").show(),Layout.Page.container.find("#setFilderCriText").val(ZPeople.decodeTxt(text))}else 2==data.code||3==data.code?(LookupFilterRule.pageContainer.find("#criteria_Field_formCustom_"+data.message.crtrow).find("#textvaluefordepnparent").addClass("has-error"),LookupFilterRule.pageContainer.find("#criteria_Field_formCustom_"+data.message.crtrow).find("#fieldCompName").addClass("has-error"),LookupFilterRule.pageContainer.find("#criteria_Field_formCustom_"+data.message.crtrow).find("#zp_criteria_error").html(data.message.message).show()):4==data.code?(LookupFilterRule.pageContainer.find("#criteria_Field_formCustom_"+data.message.crtrow).find("#textvaluefordepnparent").addClass("has-error"),LookupFilterRule.pageContainer.find("#criteria_Field_formCustom_"+data.message.crtrow).find("#fieldCompName").addClass("has-error"),LookupFilterRule.pageContainer.find("#criteria_Field_formCustom_"+data.message.crtrow).find("#zp_criteria_error").html(data.message.message).show()):data.isInvalidCriteria?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invalidentries")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"));Layout.Page.container.find("#setFilderCriText").val().length<=0&&(Layout.Page.container.find("#setFilderCriText").hide(),Layout.Page.container.find("#setFilterInpBox").prop("checked",!1))},filterDelete:function(data){data.isSuccess?(void 0!=ZPForm.FORM_COMPONENT_DATA[formCustom.formid]&&delete ZPForm.FORM_COMPONENT_DATA[formCustom.formid],delete LookupFilterRule.FilterRule[LookupFilterRule.fcId],Layout.Page.container.find("#setFilderCriText").val(""),Layout.Page.container.find("#setFilderCriText").hide(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.filterremovedsuccessfully"))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},removeCriteria:function(obj){var tr=$(obj).parent().parent().parent(),criteriaRowId=tr.attr("id"),firstRowID=LookupFilterRule.pageContainer.find("#criteria_Field").children()[0].id;if(tr.remove(),LookupFilterRule.pageContainer.find("#criteria_Field").children().length<=0){LookupFilterRule.criteriaCnt=0;var crtId=LookupFilterRule.addCriteria();LookupFilterRule.fieldOptionPopOverInit(crtId)}else firstRowID===criteriaRowId&&$(LookupFilterRule.pageContainer.find("#criteria_Field").children()[0]).find("#operatorSelection").parent().empty()},closeFilterPopOver:function(obj){var tr=$("[currentfcid="+LookupFilterRule.fcId+"]");Layout.Page.container.find("#setFilterCriText").show(),$(tr).find("#setFilderCriText").val().length>0?$(tr).find("[id^=setFilterInpBox]").prop("checked",!0):(Layout.Page.container.find("#setFilterCriText").hide(),$(tr).find("[id^='setFilterInpBox']").prop("checked",!1))},sort:function(components){var sortResult=Object.keys(components);return sortResult.sort(),sortResult},validLookUpFilterCriteriaValue:function(fcType,operator,crtValue){var key,isFromLookupFilterResult={},isValid=!0;switch(fcType){case ZPForm.Field.EMAIL_ADDRESS:operator!=ZPNewView.OPERATORS.EQUAL&&operator!=ZPNewView.OPERATORS.NOT_EQUAL||(isValid=ZPUtil.Validation.isEmail(crtValue,!0))||(key=ZPI18N.getString("zp.entervalidemailaddress"));break;case ZPForm.Field.NUMBER:(isValid=ZPUtil.Validation.isNumber(crtValue))||(key=ZPI18N.getString("zp.enteravalidnumber"));break;case ZPForm.Field.DATE:(isValid=ZPUtil.Validation.isDate(crtValue))||(key=ZPI18N.getString("zp.holiday.dateerror"));break;case ZPForm.Field.DECIMAL:case ZPForm.Field.CURRENCY:isValid=!1,"SUCCESS"===ZPUtil.getDecimalLength(crtValue).message&&(isValid=!0),isValid||(key=ZPI18N.getString("zp.enteravalidnumber"))}return(void 0==crtValue||crtValue.length<=0)&&((isValid=!1)||(key=ZPI18N.getString("zp.fieldupdate.specifyfield"))),isFromLookupFilterResult.isValid=isValid,isFromLookupFilterResult.key=key,isFromLookupFilterResult},validCriteriaValue:function(tr){var crtValue=$(tr).find("#txtValueField").find("#txtValueFieldInput").val();if("true"==$(tr).find("#fieldSelection").attr("isSystemField")){if("true"==$(tr).find("#fieldSelection").attr("isdependontime"))var fcType=$(tr).find("#fieldSelection").find("fcType")}else if("true"==$(tr).find("#fieldSelection").attr("isdependentfield")){fcType=LookupFilterRule.FORM_COMPONENTS[$(tr).find("#fieldSelection").attr("value")].fcType;crtValue=$(tr).find("#textvaluefordepn").attr("value")}else fcType=LookupFilterRule.FORM_COMPONENTS[$(tr).find("#fieldSelection").attr("value")].fcType;var opr=$(tr).find("[isopr=true]").val(),isValid=!0,key="";if(void 0==$(tr).find("#fieldSelection").attr("isdependentfield")||"true"!=$(tr).find("#fieldSelection").attr("isdependentfield")){var resultArr=LookupFilterRule.validLookUpFilterCriteriaValue(fcType,opr,crtValue);isValid=resultArr.isValid,key=resultArr.key}return(void 0==crtValue||crtValue.length<=0)&&(isValid=!1,key=ZPI18N.getString("zp.fieldupdate.specifyfield")),isValid?$(tr).find("#zp_criteria_error").hide():$(tr).find("#zp_criteria_error").html(key).show(),isValid},getFieldComponents:function(parentfcid){return LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.ALL_FORM_COMPONENTS[LookupFilterRule.formId],void 0!=parentfcid&&""!=parentfcid&&(LookupFilterRule.FORM_COMPONENTS=LookupFilterRule.ALL_FORM_COMPONENTS[LookupFilterRule.formId][parentfcid].childComponents),LookupFilterRule.FORM_COMPONENTS},getBaseFieldComponents:function(parentfcid){return LookupFilterRule.BaseFORM_ID_COMPONENTS=LookupFilterRule.ALL_BASE_FORM_COMPONENTS,void 0!=parentfcid&&""!=parentfcid&&(LookupFilterRule.BaseFORM_ID_COMPONENTS="loginusercomponents"==parentfcid?LookupFilterRule.ALL_BASE_FORM_COMPONENTS.loginusercomponents:LookupFilterRule.ALL_BASE_FORM_COMPONENTS[parentfcid].childComponents),LookupFilterRule.BaseFORM_ID_COMPONENTS}};function getdocid(id){return Layout.Page.container.find("#formulaPopup #"+id)}var formulaFunctions={checkformulasyntax:function(){if(""!=getdocid("formula").val()){var params={formid:Layout.Page.container.find("#formulaPopup #bodyTag").attr("formid"),formula:getdocid("formula").val(),mode:"checkSyntax"};ZPeople.Request.send("/fieldActions.zp",params,formCustom.fieldActionResponse,{method:"checkSyntax"},formCustom.failureCallBack)}else errorFunction.removeErrorSpan(Layout.Page.container.find("#formulaPopup #formula").parents("[errorDiv=cantbeempty]").parent("div")),errorFunction.errorSpanAttach(ZPI18N.getString("zp.enterformulaerror"),Layout.Page.container.find("#formulaPopup #formula").parent("div"))},showfunctions:function(val,formid){var number=["Min","Max","Abs","Ceil","Floor","Sqrt","Avg","Sum","ToNumber","Round"];number.sort();var time=["IsEmpty","GetTime","GetDate","GetHours","GetMinutes","GetSeconds","GetMonths","GetDays","GetYears","GetWeekday","NewDateTime","DateDiff","AddDate","SubDate","Now","CurrentDate"];time.sort();var string=["IsEmpty","Length","ToString","Lower","Upper","Trim","Find","Concat","Replace","SubString","Contains","StartsWith","EndsWith","Equals"];string.sort();var bool=["And","Or","If","Not"];if(bool.sort(),getdocid("funcoptions").html(""),2==val)for(i=0;i<number.length;i+=1)getdocid("funcoptions").append('<option id="'+number[i]+'" value="'+number[i]+'()">'+number[i]+"()</option>");else if(3==val)for(i=0;i<time.length;i+=1)getdocid("funcoptions").append('<option id="'+time[i]+'" value="'+time[i]+'()">'+time[i]+"()</option>");else if(4==val)for(i=0;i<string.length;i+=1)getdocid("funcoptions").append('<option id="'+string[i]+'" value="'+string[i]+'()">'+string[i]+"()</option>");else if(5==val)for(i=0;i<bool.length;i+=1)getdocid("funcoptions").append('<option id="'+bool[i]+'" value="'+bool[i]+'()">'+bool[i]+"()</option>");else{var whole=number.concat(time);for(whole=(whole=whole.concat(string)).concat(bool),formid==ZPeople.EMP_FORMID&&whole.push("GetExperience"),whole.sort(),whole=jQuery.uniqueSort(whole),i=0;i<whole.length;i+=1)getdocid("funcoptions").append('<option id="'+whole[i]+'" value="'+whole[i]+'()">'+whole[i]+"()</option>")}getdocid("funcoptions")[0].selectedIndex=0,this.showdesc(getdocid("funcoptions"))},showdesc:function(val){var id=$(val).children(":selected").attr("id");getdocid("func").html(id),getdocid("desc").html(ZPI18N.getString("zp.formula.desc."+id)),getdocid("usage").html(i18Arr["zp.formula.usage."+id]),getdocid("eg").html(i18Arr["zp.formula.eg."+id])},showOptions:function(){var fcid=movrfcid;null==fcidopthtml&&(fcidopthtml=docid("fcidoptions").innerHTML,docid("fcidoptions").innerHTML=""),optfcid=fcid,browser_ie?showDialog(fcidopthtml,"needIframe=no, position=relative, top=-2, left=-1, srcElement=actionsdiv, closeButton=no, closeOnBodyClick=no",null,emptyoptfcid):showDialog(fcidopthtml,"needIframe=no, position=relative, top=-2, left=-1, srcElement=actionsdiv, closeButton=no, closeOnBodyClick=yes",null,emptyoptfcid),optfcid=fcid,docid(optfcid).className=facls},insertAtCursor:function(myValue){if(0==getdocid(myValue).find("option:selected").length)ZPeople.Message.showFailureMsg("Please select an option to insert");else{var len=0;""==(myValue=getdocid(myValue).find("option:selected").attr("value"))&&alert("Select One Option To insert");var myField=getdocid("formula");if(document.selection)myField.trigger("focus"),sel=document.selection.createRange(),this.endsWith(myValue,"()")&&"Now()"!=myValue&&"CurrentDate()"!=myValue&&(myValue=myValue.substring(0,myValue.length-1)+sel.text+")"),sel.text=myValue;else if(myField[0].selectionStart||"0"==myField[0].selectionStart){myField.trigger("focus");var startPos=myField[0].selectionStart,endPos=myField[0].selectionEnd;len=startPos,this.endsWith(myValue,"()")&&"Now()"!=myValue&&"CurrentDate()"!=myValue&&endPos-startPos!=0&&(myValue=myValue.substring(0,myValue.length-1)+myField.val().substring(startPos,endPos)+")"),myField.val(myField.val().substring(0,startPos)+myValue+myField.val().substring(endPos,myField.val().length))}else myField.trigger("focus"),myField.val(myField.val()+myValue);this.endsWith(myValue,"()")&&"Now()"!=myValue&&"CurrentDate()"!=myValue?(len+=myValue.length,myField[0].setSelectionRange(len-1,len-1)):(len+=myValue.length,myField[0].setSelectionRange(len,len))}},endsWith:function(str,suffix){return-1!==str.indexOf(suffix,str.length-suffix.length)}};formCustom.constructLookupFormFields=function(jsondata,param,other){Layout.Page.container.find("#lookupPopup [name=showErrorDiv]").remove(),Layout.Page.container.find("select#FormFldName").html("").select2("destroy"),Layout.Page.container.find("select#relatedfields").html("");var iserror=!0,fcDefVal=null;if(jQuery.isEmptyObject(jsondata)||(jsondata=jsondata.lookupFlds,$.each(jsondata,function(key,value){value.onlyForRelatedFields||(Layout.Page.container.find("select#FormFldName").append("<option value="+value.fcId+">"+value.dispName+"</option>"),iserror=!1,null==fcDefVal&&1==value.type&&(fcDefVal=value.fcId)),Layout.Page.container.find("select#relatedfields").append("<option value="+value.fcId+">"+value.dispName+"</option>")})),null!=fcDefVal&&Layout.Page.container.find("#FormFldName").val(fcDefVal),Layout.Page.container.find("#relatedfields").select2(),Layout.Page.container.find("#FormFldName").select2(),iserror)return Layout.Page.container.find("#FormFldName").parents("#ImportData").append('<div class="col-md-10" name="showErrorDiv"></div>'),void errorFunction.errorSpanAttach(ZPI18N.getString("zp.nofields"),Layout.Page.container.find("#ImportForm").parents("#ImportData").find("[name=showErrorDiv]"));if("true"==Layout.Page.container.find("#isPrimLkpChangeAllowed").val()&&other.baseformid==other.formid){var primLkp=Layout.Page.container.find("input#primLkp"),empFormid=Layout.Page.container.find("#empFormid").val();if(param.formid==empFormid){primLkp.parent().show();var isMgr="true"==Layout.Page.container.find("#isMgr").val();primLkp.attr("disabled",!isMgr).prop("checked",!isMgr)}else primLkp.prop("checked",!1).parent().hide()}},formCustom.picklistConstruction=function(jsonData,obj){var parentDiv="",type=jsonData.dispType,jsonOptions=jsonData.UerDefOptions;if($.inArray(type,[fieldType.RADIO,fieldType.CHECKBOXES])>-1){var classname="101"==type?"radio":"checkbox";$.each(jsonOptions,function(key,value){if(!(key<2))return!1;parentDiv+='<div id="picklist"><div class="'+classname+" "+classname+'-primary">',parentDiv+='<label class="MR10"><input type="'+classname+'" class="PR10">'+value.optval+"</label>",parentDiv+="</div></div>"})}else{parentDiv='<div class="input-group" id="picklist"><span class="drop-ar IC-ar-dwn"></span>';parentDiv+='<input class="form-control" type="text" value="----- '+ZPI18N.getString("zp.select")+' -----">',parentDiv+="</div>"}if(""==$(obj).attr("id")){var val=$(obj).val(),inputObj=$(obj).parents("[name=choiceDiv]");$.each(jsonOptions,function(key,value){if(value.optval==val.trim())return $(obj).attr("id",value.optId),($("#EmpSts").length>0&&Layout.Page.container.find("#fieldProperties #EmpSts").hasClass("in")||$("#EmpHelathSts").length>0&&Layout.Page.container.find("#fieldProperties #EmpHealthsSts").hasClass("in"))&&$(obj).closest("[name='choiceDiv']").find("input[type=radio]").attr("name",value.optId),$(inputObj).attr({optid:value.optId}),$(inputObj).find('[name=initialvalue],[name=addIcon],[keyname="code"]').removeProp("disabled"),$(inputObj).attr("seq",value.seqNo),tabAndFormsCustom.forSaveForm.isClick&&formCustom.choiceActions("remove",$(inputObj).find("[name=deleteOption]")),!1})}return tabAndFormsCustom.forSaveForm.isChange=!1,tabAndFormsCustom.forSaveForm.isClick=!1,parentDiv},formCustom.addTableClass=function(fcid,isProperty){var htmlObjdiv="",dataAppendDiv="";isProperty?(htmlObjdiv=Layout.Page.container.find("#fieldProperties #test"+fcid),dataAppendDiv=$(htmlObjdiv).siblings("div#notesdiv").find("[keyname=plainTextvalue]")):(htmlObjdiv=Layout.Page.container.find("#test"+fcid),dataAppendDiv=$(htmlObjdiv).siblings("div#fieldtype"),htmlObjdiv.parents("[name=formcomponentDiv]").addClass("notesection"));var htmlObj=$(htmlObjdiv).html();try{htmlObj=decodeURI(htmlObj)}catch(e){}$(dataAppendDiv).html(formCustom.addClass(htmlObj))},formCustom.addClass=function(htmlObj){var a=0!=htmlObj.indexOf("<div>")?"<div>"+htmlObj+"</div>":htmlObj;return htmlObj=$(a),$(htmlObj).find("table").each(function(){$(this).addClass("table table-responsive table-bordered S13 bgw")}),htmlObj},formCustom.formOperations=function(obj,operation,tabId,optns){errorFunction.removeErrorSpan(Layout.Page.container);var params={method:operation[0]},url="/formOperations.zp",others=optns||{};others.obj=obj;var callback="";if("newForm"==operation[0])void 0==tabId&&null==tabId&&-1==tabId||(others.tabId=tabId),optns&&(params.isZp=!0),callback=operation[1];else{if("deleteForm"==operation[0])return params.formid=$(obj).parents("[name=formLi]").attr("id").match(/[\d]+$/).toString(),tabCustom.param=[url,params,tabCustom.deleteForm,others],void ZPeople.confirm(null,"",ZPI18N.getString("zp.fielddeletemsg",["the form"])+" "+ZPI18N.getString("zp.deleteconfirm"),tabCustom.deleteRequest,!1,!0);if("formCustOperations"==operation[0])params.formid=$(obj).parents("[name=formLi]").attr("id").match(/[\d]+$/).toString(),url="/"+operation[0]+".zp",params.mode=operation[1],"showhideform"==operation[1]&&(params.hidden=!$(obj).is(":checked"),callback=tabCustom.enableDisableForm);else if("customiseHeader"==operation[0]){url="formOperations.zp";var parDiv=$(obj).parents("[name=sectionDiv]"),secid=$(parDiv).attr("secid");params.sectionId=secid,callback=formCustom.customiseHeader,params.formid=$(obj).parents("[secid]").attr("tabformid")}}ZPeople.Request.send(url,params,callback,others,formCustom.failureCallBack)},formCustom.changeLabel=function(obj1,obj2){$(obj1).on("keyup",function(){let text=obj1.val().replace(/[\W]+$/,"");ZPUtil.Validation.isEmpty(text)?obj2.val(""):text.match(/[^\W\_]+/)&&(/^[^\W]+$/.test(text)||(text=text.replace(/[\W]+/g,"_")),text=text.replace(/_+/g,"_"),obj2.val(text.slice(0,97)))})},formCustom.createInputFromTemplate=function(purpose,fieldname){var inputTemp=formCustom.popupFieldTemplate;return inputTemp=(inputTemp=(inputTemp=inputTemp.replace(/\$ERRORCLASS\$/g,'errorDiv="cantbeempty"')).replace(/\$PURPOSE\$/g,purpose)).replace(/\$FIELDNAME\$/g,fieldname)},formCustom.sectionActions=function(obj,operation){var url="/sectionActions.zp",params={method:operation[0]},callback="",others={obj:obj};if("newSection"==operation[0]){$(obj).addClass("disabled");var tabularType=1,isTab=!1,secName=Layout.Page.container.find("[keyname=section-name]").val(),desc=Layout.Page.container.find("#description-text").val();if(desc=desc.trim(),errorFunction.removeErrorSpan(Layout.Page.container.find("#sectionPopup")),$(Layout.Page.container.find("#sectionPopup")).find("[name=errorSpan]").remove(),0==secName.trim().length||desc.length>200)return 0==secName.trim().length&&errorFunction.errorSpanAttach(ZPI18N.getString("zp.sectionnamecannotbeempty"),Layout.Page.container.find("#section-name")),desc.length>200&&errorFunction.errorSpanAttach(ZPI18N.getString("zp.sectiondesclength"),Layout.Page.container.find("#section-desc")),void $(obj).removeClass("disabled");$(obj).parents(".modal-footer");var addSectionDiv=$(obj).parents("#sectionPopup");$(addSectionDiv).find("div#tabularSec").is(":visible")&&(isTab=!0,tabularType=$(addSectionDiv).find("[name=tabtype]:checked").attr("value")),addSectionDiv.modal("hide"),params.formid=Layout.Page.container.attr("id").match(/[\d]+$/).toString(),params.sectionName=secName,params.desc=desc,params.isTabular=isTab,params.tabularType=tabularType,callback=formCustom.addSection}else{var secId=$(obj).parents("[name=sectionDiv]").attr("secId");if(params.sectionId=secId,"disableSection"==operation[0])params.formid=Layout.Page.container.attr("id").match(/[\d]+$/).toString(),callback=formCustom.enableDisableSection;else{if("deleteSection"==operation[0])return tabCustom.param=[url,params,formCustom.deleteSection,others],void ZPeople.confirm(null,"",ZPI18N.getString("zp.deletemessage",["section"]),tabCustom.deleteRequest,!1,!0);"editSection"==operation[0]&&(params.isTab=!0,params.tabularType=$(obj).attr("tabType"),callback=formCustom.sectionEditActions)}}ZPeople.Request.send(url,params,callback,others,formCustom.failureCallBack)},formCustom.responseHandling=function(data,params,others){data&&(data.hasOwnProperty("isSuccess")&&data.isSuccess?(formCustom.emptySectionCheck(),formCustom.removeZPFormFormComponentData("form")):data.hasOwnProperty("msg")?(ZPeople.confirm(null,"",data.msg,"",!0,!0),$("#confirmConfirmationPopup").on("click",function(){others.ui.sender.sortable("cancel"),formCustom.emptySectionCheck()})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.reports.defaulterrormessage")))},formCustom.fieldAction=function(obj,operation){var callback="",params={},others={};if("updField"==operation[0]){var param=operation[1];params.isGrid=param.isGrid,delete param.isGrid,others.obj=param.object,delete param.object,params.reqParams=JSON.stringify(param),"true"==param.isupdate?params.mode="update":params.mode="add",others.params=param,callback=formCustom.updFieldPost}else if("deleteOptions"==operation[0]){param=operation[1];params.isGrid=param.isGrid,delete param.isGrid,others.obj=param.object,delete param.object,params.deleteParams=JSON.stringify(param),params.mode="deleteOptions",others.params=param,callback=formCustom.updFieldPost}else if(params.mode=operation[0],"getformulafields"==operation[0])params.formid=operation[2],callback=formCustom.formulaPopup,others.params=operation[1];else if("disableformfield"==operation[0]){var fcId=$(obj).parent("div").siblings("label").attr("id").match(/[\d]+$/).toString();params.fcid=fcId,params.formid=Layout.Page.container.attr("id").match(/[\d]+$/).toString(),others.obj=obj,callback=formCustom.enableDisableField}else if("fetchlookupfields"==operation[0]){params.formid=operation[2];var par=operation[1];others.params=par,void 0!=par.isFormChange&&null!=par.isFormChange&&par.isFormChange&&(params.isFormChange=par.isFormChange),callback=formCustom.lookupPopup}else if("deletefield"===operation[0]){fcId=$(obj).parents("[div=fielddiv]").find("[id*=dispName]").attr("id").match(/[\d]+$/).toString();params.fcid=fcId,params.formid=Layout.Page.container.attr("id").match(/[\d]+$/).toString(),params.fctype=$(obj).parents("[tabtype=normal]").length>0?$(obj).parents("[name=formcomponentDiv]").attr("type"):$(obj).parents("[name=tabFld]").attr("type"),others.obj=obj,others.method=operation[0],callback=formCustom.fieldActionResponse}ZPeople.Request.send("/fieldActions.zp",params,callback,others,formCustom.failureCallBack)},formCustom.fieldActionResponse=function(data,params,others){var formId=params.formid;if(null!=formId&&void 0!=formId&&""!=formId||(formId=params.formId),"getFormCustomPage"==others.method)$("[id*="+formCustom.singleformLayout+params.formid+"]").find("#zp_page_loading").remove(),$("[id*="+formCustom.singleformLayout+params.formid+"]").find('[name="service_form"]').find("#formBuilder").length>0&&$("[id*="+formCustom.singleformLayout+params.formid+"]").find('[name="service_form"]').find("#formBuilder").remove(),$("[id*="+formCustom.singleformLayout+params.formid+"]").find('[name="service_form"]').append(data),(formId==ZPeople.EMP_HEALTH_FORMID||formId==ZPeople.WFO_FORMID||formId==ZPeople.VISITOR_FORMID||formId==Task.getTaskFormid()&&ZPeople.isTaskRestricted)&&$("[id*="+formCustom.singleformLayout+params.formid+"]").find('[name="service_form"]').find("#formBuilder").addClass("opn"),$("[id*=zp_subtab_admin_formslayout_].active").length<=0&&$("[id="+others.tabid+"]").addClass("active"),formCustom.formid=params.formid,Layout.CustomizedUrl.isService()||$("[id*="+formCustom.singleformLayout+params.formid+"]").find("#formNameHeading").removeClass("DN");else if("checkSyntax"==others.method)if(errorFunction.removeErrorSpan(Layout.Page.container.find("#formulaPopup #formula").parents("[errorDiv=cantbeempty]").parent("div")),0==data.result.localeCompare("No error"))errorFunction.errorSpanAttach(ZPI18N.getString("zp.noerrormsg"),Layout.Page.container.find("#formulaPopup #formula").parent("div"),!0);else{var errMsg=data.result;errorFunction.errorSpanAttach(errMsg.replace(/\n/g,"<br>"),Layout.Page.container.find("#formulaPopup #formula").parent("div"))}else if("deletefield"==others.method)if(data.isLookup){var msg=ZPI18N.getString("zp.referredfielderror",["delete"])+"\n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n',$.each(data,function(key,val){"isLookup"!=key&&(msg+="{"+key+" -> "+val+"}\n")}),setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600),$("#textConfirmationPopupBody p").first().addClass("pspace")}else if(data.hasOwnProperty("fieldMapList")){var fieldMapListMsg=ZPI18N.getString("zp.referredfielderror",["disable"])+"\n\n";setTimeout(function(){ZPeople.confirm(null,"",fieldMapListMsg,"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace"),$("#textConfirmationPopupBody").append($(formCustom.getAutomationFieldActionResponse(data.fieldMapList)))},600)}else if(data.msg.indexOf("success")>=0){if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.deletesuccessful")),LookupFilterRule.ALL_FORM_COMPONENTS.hasOwnProperty(formId)&&delete LookupFilterRule.ALL_FORM_COMPONENTS[formId],Layout.Page.container.find("#formPropertiesTab a").trigger("click"),Layout.Page.container.find("#fieldProperties").html(""),$(others.obj).closest("[isprimary='true']").length>0&&window.location.reload(),formCustom.removeZPFormFormComponentData("field",params.fcid),$(others.obj).parents("li").length>0){var parentLi=$(others.obj).parents("li");$(others.obj).parents("[name=tabularFld]").remove(),formCustom.tabularCss(parentLi)}else $(others.obj).parents("[name=formcomponentDiv]").remove();formCustom.emptySectionCheck(),formCustom.loadUniqFields(formId),formCustom.customValidation[formId].refresh=!0}else if("payrollMappingfield"===data.msg)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.payroll.mappingfield.modifyErrMsg",new Array(data.serviceName)));else if(0!=data.msg.trim().length){var label=$(others.obj).siblings("[dispname]").length>0?$(others.obj).siblings("[dispname]"):$(others.obj).parent("div").siblings("label");if("formula"===data.msg.trim())setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldusedinformulaerror",[label.text(),label.text()]),"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace").append($(msg))},600);else if("dateValidation"===data.msg.trim())setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldusedindatevalidationerror",[label.text(),label.text()]),"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace").append($(msg))},600);else if("systemfield"===data.msg.trim())ZPeople.confirm(null,"","zp.cantdeletesystemfield","",!0);else if("uniqueField"===data.msg.trim())setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.disableUniqFields"),"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace").append($(msg))},600);else if("triggerField"===data.msg.trim())setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldusedintriggerCv",[label.text()]),"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace").append($(msg))},600);else if("isEnableFilter"===data.msg.trim()){msg=ZPI18N.getString("zp.dependentfielderror",["delete"])+"\n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n';for(var i=0;i<data.refforms.length;i++)for(var keys in data.refforms[i])msg+="{"+keys+" -> "+data.refforms[i][keys]+"}\n";setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600),$("#textConfirmationPopupBody p").first().addClass("pspace")}else if("Rule"===data.msg.trim())setTimeout(function(){ZPeople.confirm(null,"","zp.fieldusedinrule","",!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600);else if("datachangedeletefield"===data.msg.trim())setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.transfer.deletefield"),"",!0,!0,ZPI18N.getString("zp.close"))},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace").append($(msg))},600);else if("eSignField"===data.msg.trim()){msg=ZPI18N.getString("zp.cantdisabledeletefieldsection",["field","deleted"]);msg+=ZPI18N.getString("zp.fileandemailfieldmsg"),setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},500)}else if("reportField"===data.msg.trim()){msg=ZPI18N.getString("zp.fieldusedinanalytics")+"\n\n";setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},500);var reportsList="";$.each(data.err,function(index,value){reportsList+="<p>"+(index+1)+'. <a href="#analytics/edit-zprepId:'+value.zpreportid+"/formId:"+value.formid+'" target="_blank">'+value.displayname+"</a></p>"}),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace").append($(reportsList))},600)}else if("blueprintfield"===data.msg.trim())setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.blueprintfield",[label.text(),label.text()]),"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace").append($(msg))},600);else if("onboardingMappingfield"===data.msg.trim()){$(label).text();ZPeople.confirm(null,"",ZPI18N.getString("zp.deletefiledonbmapwarn"),"",!1,!0,ZPI18N.getString("zp.delete"));var alertDiv=$("#confirmConfirmationPopup");$(alertDiv).on("click",function(){$(alertDiv).modal("hide"),params.isConfirm=!0,ZPeople.Request.send("/fieldActions.zp",params,formCustom.fieldActionResponse,others,formCustom.failureCallBack)})}}else setTimeout(function(){ZPeople.confirm(null,"","zp.deletefailed","",!0)},500);else if("editSectionName"==others.method)"success"==(data=JSON.parse(data)).msg.trim()?($(others.obj).siblings("label").find("em").text(params.sectionName),$(others.obj).attr("value",params.sectionName),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))):""!=data.msg.trim()&&ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0);else if("formListingComponentsFetch"==others.method){$("body").find("#dvfrmlstcontent").remove();var formid=Layout.Page.container.attr("id").match(/[\d]+$/);Layout.Page.container.attr("id").endsWith("formlinkname")&&(formid=ZPUtil.Form_Link_Names.getFormLinkName(window.location.href.split(":").pop().toString(),!1)),$("body").append(ZPAdminForm.formListConstruction(data,"dvfrmlstcontent","formcustomization",formid)),Layout.Page.container.find("#dvfrmlisting").data("bs.popover").setContent()}},formCustom.checkDisplayandLabelName=function(obj){var dispName=$(obj).find("[keyname=displayname]").val(),labelName=$(obj).find("[keyname=labelname]").val(),button=$(obj).find("[buttonname=done]");return""==dispName.trim()?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.displaynamecannotbeempty"),$(obj).find("[keyname=displayname]").parent("div")),button.removeClass("disabled"),!1):""==labelName.trim()||/^[^\W]+$/.test(labelName)?dispName.trim().length>255?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.displaynamelength",[255]),$(obj).find("[keyname=displayname]").parent("div")),button.removeClass("disabled"),!1):!(labelName.trim().length>100)||(errorFunction.errorSpanAttach(ZPI18N.getString("zp.labelnamelength"),$(obj).find("[keyname=labelname]").parent("div")),button.removeClass("disabled"),!1):(errorFunction.errorSpanAttach(ZPI18N.getString("zp.labelnamecharactersallowed"),$(obj).find("[keyname=labelname]").parent("div")),button.removeClass("disabled"),!1)},formCustom.checkTabularSectionFieldCount=function(obj){return 15==$(obj).find("[div=fielddiv]").length&&(ZPeople.confirm(null,"","cant add more than 15 fields in tab section","",!0,!0),!0)},formCustom.fieldValidation=function(value,keyname,fieldtype,obj){if("code"==keyname){if(value.trim().length>10)return ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldpropertymaxlength",[ZPI18N.getString("zp.leavetype.code"),10]),"",!0,!0),!0;if(value.trim().length>0&&!/^([a-zA-Z0-9])+$/.test(value.trim()))return ZPeople.confirm(null,"",ZPI18N.getString("zp.codeallowedchars"),"",!0,!0),!0}else if("displayname"==keyname){if(""==value.trim())return ZPeople.confirm(null,"","zp.displaynamecannotbeempty","",!0),!0;if(value.trim().length>255)return ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldpropertymaxlength",["Display name",255]),"",!0,!0),!0}else if("childName"==keyname){if(""==value.trim())return ZPeople.confirm(null,"","zp.displaynamecannotbeempty","",!0),!0;if(value.trim().length>255)return ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldpropertymaxlength",["Sub field display name",255]),"",!0,!0),!0}else if("labelname"==keyname){if(""!=value.trim()&&!/^[^\W]+$/.test(value))return ZPeople.confirm(null,"","zp.labelnamecharactersallowed","",!0),!0;if(value.trim().length>100)return ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldpropertymaxlength",["Label name","100 characters"]),"",!0,!0),!0}else{if("description"==keyname&&value.length>5e3)return ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldpropertymaxlength",["Tooltip","5000 characters"]),"",!0,!0),!0;if(fieldtype!=fieldType.LOOKUP||void 0!=keyname&&"dispFcid"!=keyname&&"separator"!==keyname){if("maxcharacter"==keyname){if(""==value.trim()||isNaN(value.trim()))return ZPeople.confirm(null,"",ZPI18N.getString("zp.validmaxchar"),"",!0,!0),!0;if(5!=fieldtype&&(value>255||value<1))return ZPeople.confirm(null,"",ZPI18N.getString("zp.maximumrangeforfield",["Max characters",1,255]),"",!0,!0),!0}if("mincharacter"==keyname){if(isNaN(value.trim()))return ZPeople.confirm(null,"",ZPI18N.getString("zp.validminchar"),"",!0,!0),!0;if(1==fieldtype&&""!=value.trim()&&(value>255||value<1))return ZPeople.confirm(null,"",ZPI18N.getString("zp.maximumrangeforfield",["Min characters",1,255]),"",!0,!0),!0}if(fieldtype==fieldType.FILE_UPLOAD&&"maxsize"==keyname){var sizeInBytes,li=value.toUpperCase().split(" ");if("MB"==li[1])sizeInBytes=1024*li[0]*1024;else if("KB"==li[1]){if(!/^(\d*)$/.test(li[0]))return ZPeople.confirm(null,"","zp.filesizevalidformat","",!0),!0;sizeInBytes=1024*li[0]}if(sizeInBytes>maxFileSizeBytes)return ZPeople.confirm(null,"",ZPI18N.getString("zp.maxuploadfilesize",[maxFileSize]),"",!0,!0),!0;if(sizeInBytes<=0)return ZPeople.confirm(null,"",ZPI18N.getString("zp.zerouploadfilesize"),"",!0,!0),!0}if(fieldtype==fieldType.NUMBER){var maxChar=parseInt("maxcharacter"==keyname?value:$(obj).parents("#fieldProperties").find("[keyname=maxcharacter]").val()),minVal=parseInt("minimumValue"==keyname?value:$(obj).parents("#fieldProperties").find("[keyname=minimumValue]").val()),maxVal=parseInt("maximumValue"==keyname?value:$(obj).parents("#fieldProperties").find("[keyname=maximumValue]").val()),initialVal=parseInt("initialvalue"==keyname?value:$(obj).parents("#fieldProperties").find("[keyname=initialvalue]").val());if(maxChar>19||maxChar<1)return ZPeople.confirm(null,"",ZPI18N.getString("zp.maximumrangeforfield",["Max digits",1,19]),"",!0,!0),!0;if(!isNaN(maxVal)&&(maxVal+"").length>maxChar||!isNaN(minVal)&&(minVal+"").length>maxChar)return ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldpropertymaxlength",["minimumValue"==keyname?"Min value":"Max value",maxChar+" digits"]),"",!0,!0),!0;if(!(isNaN(minVal)||isNaN(maxVal)||0==minVal&&0==maxVal&&minVal==maxVal)&&minVal>maxVal)return ZPeople.confirm(null,"","zp.entervalidrange","",!0),!0;if(""!=initialVal&&0!=initialVal&&(!isNaN(minVal)&&initialVal<minVal||!isNaN(maxVal)&&initialVal>maxVal))return ZPeople.confirm(null,"","zp.outofrangeinitialvalue","",!0),!0;if(!isNaN(initialVal)&&""!=initialVal&&0!=initialVal&&(initialVal+"").length>maxChar)return ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldpropertymaxlength",["Initial value",maxChar+" digits"]),"",!0,!0),!0}else{if("decimalvalue"==keyname&&(value<0||value>10))return ZPeople.confirm(null,"",ZPI18N.getString("zp.maximumrangeforfield",["Decimal value",0,10]),"",!0,!0),!0;if("initialvalue"==keyname){if(fieldtype==fieldType.SINGLELINE||fieldtype==fieldType.EMAIL){var maxchar=$(obj).parents("#fieldProperties").find("[keyname=maxcharacters]").val();if(value.length>maxchar)return ZPeople.confirm(null,"",ZPI18N.getString("zp.fieldpropertymaxlength",["Initial value",maxchar+" characters"]),"",!0,!0),!0;if(fieldtype==fieldType.EMAIL&&""!=value&&!/^[\w][\w\-\.\+\'\/]*\@[\w\.\-]+\.[a-zA-Z]{2,4}$/.test(value))return ZPeople.confirm(null,"","zp.validinitialemailval","",!0),!0}else if(fieldtype==fieldType.DECIMAL){var decimalDigits=value.split(".").length>1?value.split(".")[1]:"",decimalValue=$(obj).parents("#fieldProperties").find("[keyname=decimalvalue]").val();if(decimalDigits.length>decimalValue)return ZPeople.confirm(null,"",ZPI18N.getString("zp.roundoffinitialvalue",[decimalValue]),"",!0,!0),!0}else if(fieldtype==fieldType.PICKLIST){var options=[],i=0;if($(obj).parents("#fieldProperties").find("[name=choiceDiv]").each(function(){options[i++]=$(this).find("input").val()}),-1==$.inArray(value,options))return ZPeople.confirm(null,"","zp.nosuchoption","",!0),!0}}else if(fieldtype==fieldType.PICKLIST&&void 0==keyname&&$(obj).is("input")&&"initialvalue"!=$(obj).attr("name")&&0==value.length)return ZPeople.confirm(null,"","zp.emptyoption","",!0),!0}}else $(obj).parents("#fieldProperties").find("#displayFields [keyname=separator]").each(function(){if(-1!=$(this).val().indexOf(";"))return ZPeople.confirm(null,"","zp.invalidseparator","",!0),!0})}},formCustom.otherFieldsPopup=function(params,fieldname,fieldType,labelName){var popDiv=ZPeople.createModalPopup("addFieldPopup",ZPI18N.getString("zp.addfield"),"modal-xs",[params.hasOwnProperty("isGrid"),params.fieldtype]);if(popDiv.find("#bodyTag input").length<=0){popDiv.find("#bodyTag").append('<div class="row" id="appendTo"></div>');var displayTemp=formCustom.createInputFromTemplate("displayname",ZPI18N.getString("zp.displayname")),labelTemp=formCustom.createInputFromTemplate("labelname",ZPI18N.getString("zp.labelname"));(labelTemp=$(labelTemp)).find("label").append('<span data-content="'+ZPI18N.getString("zp.labelnamecharactersallowed")+'" data-placement="right" data-trigger="hover" data-toggle="popover" class="ML5"><i class="IC-info"></i></span>'),popDiv.find("#bodyTag #appendTo").append($(displayTemp),labelTemp)}$('[data-toggle="popover"]').popover(),popDiv.find("[keyname=displayname]").val(fieldname),popDiv.find("[keyname=labelname]").val(labelName),formCustom.changeLabel(popDiv.find("[keyname=displayname]"),popDiv.find("[keyname=labelname]")),popDiv.find("[buttonname=done]").off(),popDiv.find("[buttonname=done]").on("click",function(){$(this).addClass("disabled"),errorFunction.removeErrorSpan(popDiv);var dispName=popDiv.find("[keyname=displayname]").val().trim();popDiv.find("[keyname=labelname]").val();0!=formCustom.checkDisplayandLabelName(popDiv)&&(params.displayname=dispName,params.labelname=popDiv.find("[keyname=labelname]").val(),formCustom.fieldAction(null,["updField",params]),popDiv.modal("hide"))})},formCustom.fieldTypeCount=function(fctype,fieldname){for($.inArray(fctype,[stringField.LIST,stringField.CHECKBOXES,stringField.PICK_LIST,stringField.RADIO])>-1&&(fctype=fieldType.PICKLIST),i=1;i<=Layout.Page.container.find("[type="+fctype+"]").length&&0!=Layout.Page.container.find("[type="+fctype+'] label[dispName="'+fieldname+" "+i+'"]').length;i++);return fieldname+" "+i},formCustom.previewForm=function(mode){var loadParams={formId:mode[0],formMode:"ADD",disableUrlTrack:!0,editCallback:formCustom.previewFormCallBack};ZPForm.isRoleBasedPreview=!1,$.inArray(mode[1],Timetracker.constants.tableNames)>-1?(loadParams.onloadCallback=Timetracker.forms.formOnLoadCallback,"P_TimesheetJobsList"===mode[1]?loadParams.createFldFunctions={ClientId:Timetracker.forms.constructFormField,ProjectUsers:Timetracker.forms.constructFormField}:"P_TimesheetJob"===mode[1]?loadParams.createFldFunctions={Assignees:Timetracker.forms.constructFormField,Hours:Timetracker.forms.constructFormField,BillableStatus:Timetracker.forms.constructFormField}:"P_ClientDetails"===mode[1]&&(loadParams.createFldFunctions={Billing_Method:Timetracker.forms.constructFormField})):"P_ApplyLeave"===mode[1]&&(loadParams.fieldFormat=["Employee_ID","Leavetype","From","To","TeamEmailID","Reasonforleave"],loadParams.fieldCallback={Employee_ID:Leave.Form.getApplicable,Leavetype:Leave.Form.getDetails,From:Leave.Form.getDetails,To:Leave.Form.getDetails}),ZPForm.load(loadParams,!0)},formCustom.previewFormCallBack=function(){ZPForm.CURRFORM_PARAM.formMode="EDIT",ZPForm.load(ZPForm.CURRFORM_PARAM)},formCustom.removeZPFormFormComponentData=function(mode,id,editProp){if(void 0!=ZPForm.FORM_COMPONENT_DATA[formCustom.formid])if("form"===mode)delete ZPForm.FORM_COMPONENT_DATA[formCustom.formid];else if("section"==mode){var sections=ZPForm.FORM_COMPONENT_DATA[formCustom.formid].message.formComponentDetails;for(section in sections)if(sections[section].sectionId==id)return sections.splice(section,1),!1}else"field"===mode&&$.each(ZPForm.FORM_COMPONENT_DATA[formCustom.formid].message.formComponentDetails,function(){var column1=this.column1;for(field in column1)if(column1[field].formComponentId==id){if(void 0!=editProp)for(key in editProp)column1[field][key]=editProp[key];else column1.splice(field,1);return!1}var column2=this.column2;for(field in column2)if(column2[field].formComponentId==id){if(void 0!=editProp)for(key in editProp)column2[field][key]=editProp[key];else column2.splice(field,1);return!1}})},formCustom.failureCallBack=function(resultData,params,others){var updateObj=others.obj;if("checkbox"==$(updateObj).attr("type"))$(updateObj).prop("checked",!$(updateObj).is(":checked"));else if($(updateObj).is("select"))$(updateObj).select2();else{var val=void 0!=$(updateObj).attr("savedvalue")?$(updateObj).attr("savedvalue"):"";$(updateObj).val(val)}resultData.hasOwnProperty("responseJSON")&&resultData.responseJSON.hasOwnProperty("error")&&resultData.responseJSON.error.trim().length>0?params.hasOwnProperty("formula")?(errorFunction.errorSpanAttach(resultData.responseJSON.error.trim(),Layout.Page.container.find("#formulaPopup #formula").parent("[errordiv=cantbeempty]")),Layout.Page.container.find("#formulaPopup [buttonname=done]").removeClass("disabled")):ZPeople.Message.showFailureMsg(resultData.responseJSON.error):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"));var fieldtype=104;if(params.hasOwnProperty("reqParams")){var reqParams=JSON.parse(params.reqParams);fieldtype=reqParams.fieldtype,reqParams.hasOwnProperty("displayname")&&"displayname"==$(updateObj).attr("keyname")&&formCustom.showChangeInField(updateObj)}Layout.Page.container.find("#adding"+fieldtype).remove(),$(updateObj).find("[buttonname=save], [buttonname=done]").length>0&&$(updateObj).find("[buttonname=save],[buttonname=done]").removeClass("disabled")},formCustom.enableDisableESigning=function(data,params,others){var obj=others.obj;if(others.hasOwnProperty("forPost")){(params={mode:"enableDisableESigning",formId:Layout.Page.container.attr("id").split("-").pop(),method:"formCustOperations"})[$(obj).attr("keyname")]=$(obj).is(":checked"),ZPeople.Request.send("/formCustOperations.zp",params,formCustom.enableDisableESigning,{obj:obj},formCustom.failureCallBack)}else{var signEnabled=!1;params.hasOwnProperty("isAdobeSignEnabled")?signEnabled=params.isAdobeSignEnabled:params.hasOwnProperty("isDocuSignEnabled")?signEnabled=params.isDocuSignEnabled:params.hasOwnProperty("isZohoSignEnabled")&&(signEnabled=params.isZohoSignEnabled),data.hasOwnProperty("msg")?"success"==data.msg.trim()?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")):(ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0),$(obj).prop("checked",!signEnabled)):data.hasOwnProperty("failure")&&(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")),$(obj).prop("checked",!signEnabled))}};var RelatedFields={url:"/formAction.zp",configtemp:'<div class="modal PopMdModel popRgtModel modal-right" id="relatedconfhead"><div class="modal-dialog"><div class="modal-content" id="relatedconfheadcontend"></div></div></div>',configtempheader:'<div class="modal-header"><a type="button" class="close IC-cls-1px red" data-dismiss="modal"></a><h6 id="reltitle"></h6></div>',configtempbody:'<div class="modal-body"><div class="row"><div class=""></div><table class="table table-responsive table-hover tblrowdrag tblconfdrag"><thead><tr><th width="22"></th><th>'+ZPI18N.getString("zp.formname")+'</th><th width="300">'+ZPI18N.getString("zp.LookupField")+'</th><th width="300">'+ZPI18N.getString("zp.linkedField")+'</th><th width="250">'+ZPI18N.getString("zp.displayname")+'</th><th></th></tr></thead><tbody class="ui-sortable" id="relatedconfigtablebody"></tbody><tfoot><tr><td colspan="6"><a onclick="RelatedFields.addtr()"><i class="IC-add MR5 S12"></i>'+ZPI18N.getString("zp.addnew")+"</a></td></tr></tfoot></table></div></div>",configtempfooter:'<div class="modal-footer"><a class="btn btn-primary" onclick="RelatedFields.saverelatedconfig()">'+ZPI18N.getString("zp.save")+'</a><a class="btn btn-default" data-dismiss="modal" buttonaction="dismiss">'+ZPI18N.getString("zp.close")+"</a></div>",relatedFieldsConfigdata:{},relatedFieldsalreadyConfigdata:{},getrelatedfieldsconfig:function(formId){RelatedFields.formId=formId;var params={formId:formId,mode:"getrelatedformsconfigdetails"};ZPeople.Request.send(RelatedFields.url,params,RelatedFields.getrelatedfieldsconfigdata)},getrelatedfieldsconfigdata:function(data,params){var formId=params.formId;RelatedFields.relatedFieldsConfigdata[formId]=data,$("body").find("#relatedconfhead").remove(),$("body").append(RelatedFields.configtemp),RelatedFields.pageContainer=$("body").find("#relatedconfhead"),RelatedFields.pageContainer.find("#relatedconfheadcontend").append(RelatedFields.configtempheader),RelatedFields.pageContainer.find("#relatedconfheadcontend").append(RelatedFields.configtempbody),RelatedFields.pageContainer.find("#relatedconfheadcontend").append(RelatedFields.configtempfooter);var title=ZPI18N.getString("zp.relatedformconfigurefor")+" "+Layout.Page.container.find("#formName").val();RelatedFields.pageContainer.find("#reltitle").text(title),RelatedFields.pageContainer.modal();var k=0;data.existingconfigdetails.length>0?$.each(data.existingconfigdetails,function(KEY){$.each(data.existingconfigdetails[KEY],function(key,value){RelatedFields.ConstructFields(k);RelatedFields.pageContainer.find("#relconftr_"+k).find("#relatedformlist").select2("destroy"),RelatedFields.pageContainer.find("#relconftr_"+k).find("#relatedformlist").val(key).select2(),RelatedFields.toFillFcList(k,key,value.formCompid,value.linkedformCompid,value.Title),k+=1})}):RelatedFields.ConstructFields(k)},ConstructFields:function(key){var tr='<tr class="ui-sortable-handle" id="relconftr_'+key+'" row = "'+key+'"><td><span class="IC-move dvMove DIB MT6" id="drag"></span></td><td><select class="selectBox" id="relatedformlist" onchange="RelatedFields.toFillFcList('+key+')" style="display: none;"></select></td><td><select class="selectBox" id="relatedfclist" onchange="RelatedFields.getselectedval('+key+')" style="display: none;"></select></td><td><select class="selectBox" id="basefclist"></select></td><td><input class="form-control" id="title"> </td><td><i class="IC-remove red MT5 DIB" onclick="RelatedFields.deleterelfieldscongig(this)"></i></td></tr>';RelatedFields.pageContainer.find("#relatedconfigtablebody").append(tr),RelatedFields.pageContainer.find("#relconftr_"+key).find("#relatedfclist").select2(),RelatedFields.pageContainer.find("#relconftr_"+key).find("#basefclist").select2(),RelatedFields.toFillFormList(key),RelatedFields.getrelatedviewrecordresponse()},getTitleName:function(formId){var title="";return $.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails,function(KEY){$.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails[KEY],function(key,value){$.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails[KEY][key],function(k,v){key==formId&&(title=k)})})}),title},toFillFormList:function(row){var relForms='<option value="-1"> -'+ZPI18N.getString("zp.select")+"- </option>";$.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails,function(KEY){$.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails[KEY],function(key,value){$.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails[KEY][key],function(k,v){var count=0;$.each(v,function(key2,value2){0!==Object.keys(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails[KEY][key][k][key2].FormbasedComponentDetails).length&&0==count&&(relForms+='<option value="'+key+'">'+ZSEC.Encoder.encodeForHTML(k)+"</option>",count+=1)})})})}),RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedformlist").append(relForms),RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedformlist").select2({formatNoMatches:function(){return ZPI18N.getString("zp.nomatchesfound")}}),RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").select2({formatNoMatches:function(){return ZPI18N.getString("zp.nomatchesfound")}})},toFillFcList:function(row,relformId,selvalue,selLinkedFCVal,title){void 0==relformId&&(relformId=RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedformlist").find("option:selected").attr("value"));var relFclists="",relFclists1="";$.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails,function(KEY){$.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails[KEY],function(key,value){relformId==key&&($.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].relcongigdetails[KEY][relformId],function(key1,value1){$.each(value1,function(key2,value2){key2==RelatedFields.formId?(relFclists1+='<optgroup label="'+ZSEC.Encoder.encodeForHTML(value2.basetablename)+'" id="'+key2+'">',$.each(value2.FormbasedComponentDetails,function(k){relFclists1+='<option value="'+value2.FormbasedComponentDetails[k].formComponentId+'">'+ZSEC.Encoder.encodeForHTML(value2.FormbasedComponentDetails[k].formComponentName)+"</option>"}),relFclists1+="</optgroup>"):(relFclists+='<optgroup label="'+ZSEC.Encoder.encodeForHTML(value2.basetablename)+'" id="'+key2+'">',$.each(value2.FormbasedComponentDetails,function(k){relFclists+='<option value="'+value2.FormbasedComponentDetails[k].formComponentId+'">'+ZSEC.Encoder.encodeForHTML(value2.FormbasedComponentDetails[k].formComponentName)+"</option>"}),relFclists+="</optgroup>")})}),void 0==title&&(title=RelatedFields.getTitleName(relformId)),RelatedFields.pageContainer.find("#relconftr_"+row).find("#title").val(title))})}),relFclists=relFclists1+relFclists,RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").select2("destroy"),RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").empty(),RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").append(relFclists),void 0!=selvalue?(RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").val(selvalue),RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").select2()):RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").select2();RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").val();RelatedFields.getselectedval(row,!1,selLinkedFCVal)},saverelatedconfig:function(){var relatedfieldsconfiglists=RelatedFields.pageContainer.find("#relatedconfigtablebody").children(),details=[],isValid=!0,existingVal=[],errorRows=[];if($.each(relatedfieldsconfiglists,function(key){var relateddet={},tr=this,relformId=RelatedFields.pageContainer.find(tr).find("#relatedformlist").find("option:selected").attr("value"),fcId=RelatedFields.pageContainer.find(tr).find("#relatedfclist").find("option:selected").attr("value"),linkedFormCompId=(RelatedFields.pageContainer.find(tr).find("#relatedfclist").find('option[value="'+fcId+'"]').parent().attr("id"),-1);RelatedFields.pageContainer.find(tr).find("#basefclist").attr("disabled")||(linkedFormCompId=RelatedFields.pageContainer.find(tr).find("#basefclist").find("option:selected").attr("value"));var ordern=key,titl=RelatedFields.pageContainer.find(tr).find("#title").val();RelatedFields.pageContainer.find(tr).find("#title").parent().removeClass("has-error"),"-1"!=relformId&&(0==titl.length&&(RelatedFields.pageContainer.find(tr).find("#title").parent().addClass("has-error"),isValid=!1),-1==existingVal.indexOf(fcId+"_"+linkedFormCompId)?(relateddet.linkedFormCompId=-1,existingVal.push(fcId+"_"+linkedFormCompId)):(isValid=!1,errorRows.push(this)),relateddet.linkedFormCompId=linkedFormCompId,relateddet.formCompId=fcId,relateddet.order=ordern,relateddet.title=titl,details.push(relateddet))}),isValid){var params={mode:"saverelatedformcongigdetails",formId:RelatedFields.formId,reledformconfigdetails:JSON.stringify(details)};ZPeople.Request.send(RelatedFields.url,params,RelatedFields.relatedfieldssubmitresponse)}else errorRows.length>0?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.duplicateentriesexist")),$.each(errorRows,function(){})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.relformerrmsg"))},relatedfieldssubmitresponse:function(data,params){data.isSuccess?(void 0!==ZPForm.FORM_COMPONENT_DATA[params.formId]&&(ZPForm.FORM_COMPONENT_DATA[params.formId]=void 0),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.relformaddmsg"))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")),$("#relatedconfhead").modal("hide")},constructrelatedfieldsviewinsiglerecord:function(obj,isFrommultipage){obj=$(obj).parent();var relobj=$(obj).find("a"),viewid=$(relobj).attr("viewId"),formId=$(relobj).attr("formId"),relfcid=$(relobj).attr("fcid"),relformid=ZPForm.CURRFORM_PARAM.formId,recid=ZPForm.CURRFORM_PARAM.recordId,linkedFcid=$(relobj).attr("linkedFcid"),viewObj=$(relobj).parent().parent().find("#zp_dash_rfdata_"+relfcid+'[isrel="true"]');if(!isFrommultipage){if(viewObj.is(":visible"))return void viewObj.slideUp();if($(viewObj).find(".relfield").children().length>0)return void viewObj.slideDown()}viewObj='<div id="zp_dash_rfdata_'+relfcid+'" isrel="true"><div class="label-body table-responsive" id="zp_views_list_container_rel'+relfcid+'"><table class="table table-hover Vlis" id="zp_views_records_table"><thead id="zp_views_recordheader" class="relfield"></thead></table></div></div>',$(relobj).parent().parent().find("#zp_dash_rfdata_"+relfcid).remove(),$(relobj).parent().parent().append(viewObj);var params={mode:"fetchRecords",formId:formId,viewId:viewid,linkedFcid:linkedFcid,isOnload:!0,startInd:1,employeeStatus:"all",isrelatedform:!0,relformfcid:relfcid,relformconfigformid:relformid,relformrecid:recid};ZPView.init(params,!0),$("#zp_views_list_container_rel"+relfcid).find("#zp_views_records_table").addClass("bgc")},constructmultipagerelfields:function(){var viewObj='<div class="table-responsive" id="zp_section_fields_'+ZPForm.CURRFORM_PARAM.formId+'" secid="'+ZPForm.CURRFORM_PARAM.formId+'">';$.each(ZPForm.relformComp.relatedFields,function(index){var relatedfield=ZPForm.relformComp.relatedFields[index];if(void 0!=relatedfield.group){if(ZPForm.FORM_DETAILS[ZPForm.CURRFORM_PARAM.formId].isAdobeSigninEnabled||ZPForm.FORM_DETAILS[ZPForm.CURRFORM_PARAM.formId].isZohoSigninEnabled||ZPForm.FORM_DETAILS[ZPForm.CURRFORM_PARAM.formId].isDocuSigninEnabled){var esignDocumentmethod="",recorddetails=Layout.Page.container.find("#zp_view_record_"+ZPForm.CURRFORM_PARAM.recordId).closest("tr")[0],recordid=ZPForm.CURRFORM_PARAM.recordId,aggreeID="";null!=(aggreeID=void 0==recorddetails&&void 0!=ZPView.newRecordDetails.agreeid?ZPView.newRecordDetails.agreeid:void 0!=Layout.Page.container.find("#zp_view_record_"+ZPForm.CURRFORM_PARAM.recordId).closest("tr")[0]?Layout.Page.container.find("#zp_view_record_"+ZPForm.CURRFORM_PARAM.recordId).closest("tr")[0].getAttribute("agreeId"):null)&&"null"!=aggreeID&&"undefined"!=aggreeID&&void 0!=aggreeID?(void 0==recorddetails&&void 0!=ZPView.newRecordDetails.module?ZPView.newRecordDetails.module:void 0!=Layout.Page.container.find("#zp_view_record_"+ZPForm.CURRFORM_PARAM.recordId).closest("tr")[0]?Layout.Page.container.find("#zp_view_record_"+ZPForm.CURRFORM_PARAM.recordId).closest("tr")[0].getAttribute("module"):null,viewObj+='<div><div class="label-main ZPExpCl"><div class="label-head PL0I"><a id="anchor_single_doc_list" data-toggle="collapse" onclick="Zohosign.getsingleRecordconst(this)" esignmodule = '+relatedfield.esignmodule+' data-target="#zp_dash_rfdata_'+recordid+"_"+relatedfield.esignmodule+'" aria-expanded="false" class="collapsed" fcid="'+relatedfield.formCompid+'" viewId="'+relatedfield.viewId+'" formId="'+relatedfield.formId+'" linkedFcid="'+relatedfield.linked_fcid+'" order="'+relatedfield.order+'">'+relatedfield.title+"</a></div></div></div>"):(2==relatedfield.esignmodule?(esignDocumentmethod='ZPView.sendForSignDocs("adobe")',Zohosign.esignmodule="2"):4==relatedfield.esignmodule?(esignDocumentmethod='ZPView.sendForSignDocs("")',Zohosign.esignmodule="4"):(esignDocumentmethod='ZPView.sendForSignDocs("zsign","true")',Zohosign.esignmodule="6"),viewObj+='<div><div class="label-main ZPExpCl"><div class="label-head PL0I"><a id="anchor_single_doc_list" data-toggle="collapse" onclick="Zohosign.getsingleRecordconst(this)" esignmodule = '+relatedfield.esignmodule+' data-target="#zp_dash_rfdata_'+relatedfield.formCompid+'" aria-expanded="false" class="collapsed" fcid="'+relatedfield.formCompid+'" viewId="'+relatedfield.viewId+'" formId="'+relatedfield.formId+'" linkedFcid="'+relatedfield.linked_fcid+'" order="'+relatedfield.order+'">'+relatedfield.title+"</a>"+(relatedfield.isLocAdmin||0!==relatedfield.addPerm&&(4!==relatedfield.addPerm||0!==ZPeople.getSubUsers().length)?'<div class="IC-plus-big togg-plus" id="bigPlusforSign" linkedFcid="'+relatedfield.linked_fcid+'" onclick='+esignDocumentmethod+"></div>":"")+"</div></div></div>")}}else viewObj+='<div><div class="label-main ZPExpCl"><div class="label-head PL0I"><a data-toggle="collapse"  onclick="RelatedFields.constructrelatedfieldsviewinsiglerecord(this)" data-target="#zp_dash_rfdata_'+relatedfield.formCompid+'" aria-expanded="false" class="collapsed" fcid="'+relatedfield.formCompid+'" viewId="'+relatedfield.viewId+'" formId="'+relatedfield.formId+'" linkedFcid="'+relatedfield.linked_fcid+'" order="'+relatedfield.order+'">'+relatedfield.title+"</a>"+(relatedfield.isLocAdmin||0!==relatedfield.addPerm&&(4!==relatedfield.addPerm||0!==ZPeople.getSubUsers().length)?'<div class="IC-plus-big togg-plus" linkedFcid="'+relatedfield.linked_fcid+'" onclick='+(-1===relatedfield.linked_fcid?"Task.showQuickTask(this)":"RelatedFields.addRecordPage(this)")+"></div>":"")+"</div></div></div>"}),viewObj+="</div>",ZPForm.LAYOUT.find("#zp_form_body").children().first().find("#zp_section_fields_"+ZPForm.CURRFORM_PARAM.formId).remove(),ZPForm.LAYOUT.find("#zp_form_body").children().first().append(viewObj),ZPForm.LAYOUT.find("#zp_section_fields_"+ZPForm.CURRFORM_PARAM.formId).siblings("[id^=zp_section_fields_]").addClass("DN").prev("h6").addClass("DN"),ZPForm.showSection(ZPForm.CURRFORM_PARAM.formId)},addtr:function(){var row=parseInt(RelatedFields.pageContainer.find("#relatedconfigtablebody").children().last().attr("row"));row+=1,RelatedFields.ConstructFields(row)},getrelatedviewrecordresponse:function(data,params){var a=RelatedFields.pageContainer.find("#relatedconfigtablebody").find("tr").find("#drag");RelatedFields.pageContainer.find("#relatedconfigtablebody").sortable({handle:$(a)})},deleterelfieldscongig:function(obj){var row=RelatedFields.pageContainer.find(obj).closest("tr").attr("row");RelatedFields.getselectedval(row,!0),RelatedFields.pageContainer.find(obj).closest("tr").remove(),0==RelatedFields.pageContainer.find("#relatedconfigtablebody").children().length&&RelatedFields.ConstructFields(0)},getselectedval:function(row,isfromrowdelete,selLinkedFCVal){var relformId=RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedformlist").find("option:selected").attr("value");if(-1!=relformId){var fcval=RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").val(),parentformid=RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").find('option[value="'+fcval+'"]').parent().attr("id");if(void 0!=RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").data("val")&&(RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").data("parentformid"),RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").data("baseformid")),void 0!=RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].refconfig[parentformid]&&"-1"!==selLinkedFCVal){var baseFieldOptHtml="";$.each(RelatedFields.relatedFieldsConfigdata[RelatedFields.formId].refconfig[parentformid],function(key,val){baseFieldOptHtml+='<option value="'+key+'">'+ZSEC.Encoder.encodeForHTML(val)+"</option>"}),RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").select2("destroy"),RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").attr("disabled",!1),RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").empty(),RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").append(baseFieldOptHtml),void 0!=selLinkedFCVal?(RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").val(selLinkedFCVal),RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").select2()):RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").select2()}else RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").select2("destroy"),RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").empty(),RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").attr("disabled",!0),RelatedFields.pageContainer.find("#relconftr_"+row).find("#basefclist").select2();RelatedFields.relatedFieldsalreadyConfigdata[fcval]={},RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").data("val",fcval),RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").data("parentformid",parentformid),RelatedFields.pageContainer.find("#relconftr_"+row).find("#relatedfclist").data("baseformid",relformId)}},addRecordPage:function(obj){0!=ZPForm.formid&&void 0!=ZPForm.formid||(ZPForm.formid=ZPForm.CURRFORM_PARAM.formId);var ele=$(obj).siblings("a"),formId=$(ele).attr("formid"),fcId=$(ele).attr("fcid"),linkedfcid=$(ele).attr("linkedfcid"),formC=ZPForm.Field.getFieldValueData(linkedfcid),selValue=ZPForm.CURRFORM_PARAM.recordId;ZPForm.fcId=fcId,void 0!=formC&&(selValue=formC.componentValue_ID),ZPForm.load({formId:formId,formMode:"ADD",relfcId:fcId,selValue:selValue,isfromrelfields:!0}),ZPForm.toggleFormPage(!1,Layout.Page.container.find("#zp_addedit_record_"+ZPForm.formid))}},CustomFunctionValidation={isCFFromValidation:!1,CFIDLIST:{},cfId:"",MODE:"formBuilder",enabledisable:function(formId,obj){CustomFunctionValidation.formId=formId;var cfid=Layout.Page.container.find(obj).attr("cfid");CustomFunctionValidation.cfId=cfid;var enabledisable="";$(obj).prop("checked")?0==cfid?(NewWorkFlow.createNewWorkflow("customfunction"),Layout.Page.container.find(".workflow-decl").find("#custFnRtnType").html("Map")):enabledisable="1":enabledisable="0",""!=enabledisable&&$.ajax({type:"POST",async:!1,url:"/formAction.zp",data:{mode:"enablediableCustomFunction",formId:formId,enabledisable:enabledisable,conreqcsr:csrfToken},success:function(data){data.Success?"1"==enabledisable?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enblecfvalmsf")),Layout.Page.container.find("#cvTriggerListDiv"+formId).show()):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablecfvalmsf")),0==Layout.Page.container.find("#cvTriggerFields"+formId).select2("val").length&&Layout.Page.container.find("#cvTriggerListDiv"+formId).hide()):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))}})},cfvalidationconfig:function(formId,obj){var cfid=Layout.Page.container.find(obj).attr("cfid");CustomFunctionValidation.formId=formId,CustomFunctionValidation.cfId=cfid,0!=cfid&&(CustomFunctionValidation.isCFFromValidation=!0,$parentPageId().find("#aPageHead").removeClass("DN"),NewCustomFunction.getConfig(cfid,formId)),Layout.Page.container.find(".workflow-decl").find("#custFnRtnType").html("Map")}};formCustom.getPredefinedOptions=function(data,params,others){if(void 0==formCustom.predefinedOptions&&null==data)ZPeople.Request.send("/fieldActions.zp",{mode:"getPredefinedOptions"},formCustom.getPredefinedOptions);else{void 0==formCustom.predefinedOptions&&(formCustom.predefinedOptions=data),$("#predefinedOptions").remove(),Layout.Page.container.find("#predefinedOptions #preOptions").empty();var reorderPopup=ZPeople.createModalPopup("predefinedOptions",ZPI18N.getString("zp.addbulkoptions"),"modal-md");reorderPopup.find(".modal-footer").addClass("DN"),reorderPopup.find("#preOptions").length<=0&&reorderPopup.find("#bodyTag").append("<div id='preOptions'></div>"),reorderPopup.find("a[buttonname=done]").off(),reorderPopup.find("a[buttonname=done]").on("click",function(){$(this).addClass("disabled");var options=reorderPopup.find("[name=rightTab] [tabid]:visible textarea").val().trim().split("\n");options=options.filter(function(e){return e});var updParams={fcid:Layout.Page.container.find("#fieldProperties").attr("currentfcid"),isupdate:"true",pickListOptions:{bulkOptions:options}};reorderPopup.modal("hide"),formCustom.fieldAction(null,["updField",updParams])});var mainDiv=jQuery("<div></div>",{class:"",role:"menu"}).append(jQuery("<div></div>",{class:"tabvertical bttop dvbulkhgt"}).append(jQuery("<div></div>",{class:"lfttab",name:"leftTab"}).append(jQuery("<ul></ul>",{class:"nav nav-pills nav-stacked ",role:"tablist"})).append(jQuery("<div></div>",{class:"tabconffxd"}).append(jQuery("<a></a>",{class:"btn btn-danger MR5 btn-sm",onclick:"formCustom.deleteTemplate(null,null,{obj:this,forPost:true})",buttonname:"done"}).append(ZPI18N.getString("zp.confirm"))).append(jQuery("<a></a>",{class:"btn btn-default MR5 btn-sm",onclick:"formCustom.hide(event)",buttonname:"done"}).append(ZPI18N.getString("zp.cancel"))))).append(jQuery("<div></div>",{class:"rhtlstsrl",name:"rightTab"}).append(jQuery("<div></div>",{class:"tab-content ulItemrec PT10 PB10",name:"rightTabDiv"}))));formCustom.constructTemplate({groupId:"addNew",groupName:ZPI18N.getString("zp.addoptions"),optionsArr:[],groupType:2},mainDiv),$(mainDiv).find("[tabid=addNew]").addClass("active"),$(mainDiv).find(".tabconffxd").hide(),$.each(formCustom.predefinedOptions,function(i,item){formCustom.constructTemplate(item,mainDiv)}),reorderPopup.find("#bodyTag #preOptions").append(mainDiv)}},formCustom.swapToSave=function(obj,event){var idAttr=$(obj).attr("name"),parentDiv=$(obj).parents("[name=groupOptions]"),findPath="",val="";"importOptions"==idAttr&&""!=parentDiv.find("#groupName").attr("groupid").trim()?val="addNew"==Layout.Page.container.find("[name=leftTab] [tabid].active").attr("tabid")?"":Layout.Page.container.find("[name=leftTab] [tabid].active a").text():(parentDiv=Layout.Page.container,findPath="#predefinedOptions [name=rightTab]",idAttr="saveTemplate",errorFunction.removeErrorSpan(Layout.Page.container.find("#predefinedOptions"))),parentDiv.find("#groupName").val(val),parentDiv.find(findPath+" #"+idAttr).hide(),parentDiv.find(findPath+" [name=toggleDiv]").not("#"+idAttr).show(),formCustom.hide(event)},formCustom.deleteTemplate=function(data,params,others){var obj=others.obj;if(others.hasOwnProperty("forPost")){errorFunction.removeErrorSpan(Layout.Page.container.find("#predefinedOptions")),$(obj).addClass("disabled");var template={groupId:Layout.Page.container.find("[name=leftTab] [tabid].active").attr("tabid").match(/[\d]+$/).toString()};delete others.forPost;params={delPredefinedOptions:JSON.stringify(template),mode:"delPredefinedOptions"};ZPeople.Request.send("/fieldActions.zp",params,formCustom.deleteTemplate,{obj:obj})}else{if(data.msg==zpconst.CommonMessages.SUCCESSMSG){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.templatedeletedsuccessfully"));for(var tabId,option=data.predefinedOptions.toString(),length=formCustom.predefinedOptions.length-1,i=0;i<=length;i++)if(formCustom.predefinedOptions[i].groupId==option){tabId=length>i?formCustom.predefinedOptions[i+1].groupId:formCustom.predefinedOptions[i-1].groupId,formCustom.predefinedOptions.splice(i,1);break}$("[tabid="+tabId+"]").children().click(),$("[tabid="+option+"]").remove()}else ZPeople.Message.showFailureMsg(data.msg.trim());$(obj).removeClass("disabled"),$("div[name=leftTab]").find(".tabconffxd").hide(),$("div[name=rightTab]").removeClass("disabled"),$("div[name=leftTab]").find("ul").removeClass("disabled")}},formCustom.deletepre=function(event){$("div[name=leftTab]").find(".tabconffxd").show(),$("div[name=rightTab]").addClass("disabled")},formCustom.hide=function(event){"deleteTempIcon"!=$(event.target).attr("id")&&($(".tabconffxd").hide(),$("div[name=rightTab]").removeClass("disabled"),$("div[name=leftTab]").find("ul").removeClass("disabled"))},formCustom.saveTemplate=function(data,params,others){var obj=others.obj;if(others.hasOwnProperty("forPost")){errorFunction.removeErrorSpan(Layout.Page.container.find("#predefinedOptions")),$(obj).addClass("disabled");var parentDiv=$(obj).parents("[name=groupOptions]"),options=parentDiv.find("textarea").val().trim().split("\n"),success=!0;if(0==(options=options.filter(function(e){return e})).length)return errorFunction.errorSpanAttach("Enter atleast one option to save",$(parentDiv).find("textarea").parent("[errorDiv]")),void $(obj).removeClass("disabled");$.each(options,function(i,item){return item.length>255?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.optionlength",[255]),$(parentDiv).find("textarea").parent("[errorDiv]")),$(obj).removeClass("disabled"),success=!1):$.inArray(item,options)!=i?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.duplicateentriesexist"),$(parentDiv).find("textarea").parent("[errorDiv]")),$(obj).removeClass("disabled"),success=!1):void 0});var templateName=$(obj).parents("#saveTemplate").find("#groupName").val();if(""==templateName.trim())return errorFunction.errorSpanAttach("Enter valid template name",$(obj).parents("#saveTemplate").find("#groupName").parent("[errorDiv]")),void $(obj).removeClass("disabled");var groupId=Layout.Page.container.find("[name=leftTab] [tabid].active").attr("tabid").match(/[\d]+$/),template={groupName:templateName,optionsArr:options};if(null!=groupId){if(2!=$(obj).parents("#predefinedOptions").find("[name=leftTab] li.active").attr("grouptype"))return errorFunction.errorSpanAttach("Cannot edit this template",$(parentDiv).find("textarea").parent("[errorDiv]")),void $(obj).removeClass("disabled");template.groupId=groupId[0].toString()}if(success){delete others.forPost;params={addPredefinedOptions:JSON.stringify(template),mode:"addPredefinedOptions"};ZPeople.Request.send("/fieldActions.zp",params,formCustom.saveTemplate,{obj:obj})}}else{if(errorFunction.removeErrorSpan(Layout.Page.container.find("#predefinedOptions")),data.msg==zpconst.CommonMessages.SUCCESSMSG){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"));var predefinedOptions=data.predefinedOptions,index=formCustom.findKeyValue(formCustom.predefinedOptions,"groupId",predefinedOptions.groupId);null==index&&(index=formCustom.predefinedOptions.length),formCustom.predefinedOptions[index]=predefinedOptions;var updParams={fcid:Layout.Page.container.find("#fieldProperties").attr("currentfcid"),isupdate:"true",pickListOptions:{bulkOptions:predefinedOptions.optionsArr}};formCustom.fieldAction(null,["updField",updParams]),Layout.Page.container.find("#predefinedOptions").modal("hide")}else if(data.msg.indexOf(zpconst.CommonMessages.FAILUREMSG)>-1){var id=data.msg.split(zpconst.CommonMessages.FAILUREMSG)[1],errorObj=Layout.Page.container.find("[name=rightTab] [tabid].active #"+("options"==id?"preOptions":id)).parent("[errordiv]");errorFunction.errorSpanAttach(data[id],errorObj)}else""!=data.msg.trim()&&ZPeople.Message.showFailureMsg(data.msg.trim());$(obj).removeClass("disabled")}},formCustom.constructTemplate=function(item,mainDiv){2!=item.groupType||"addNew"==item.groupId?$(mainDiv).find("div[name=leftTab] ul").append(jQuery("<li></li>",{role:"presentation",tabId:item.groupId,grouptype:item.groupType}).append(jQuery("<a></a>",{href:"#dv"+item.groupId,role:"tab","data-toggle":"tab",onclick:"formCustom.swapToSave(this,event)"}).append(ZPeople.decodeTxt(item.groupName)))):$(mainDiv).find("div[name=leftTab] ul").append(jQuery("<li></li>",{role:"presentation",tabId:item.groupId,grouptype:item.groupType}).append(jQuery("<a></a>",{href:"#dv"+item.groupId,role:"tab","data-toggle":"tab",onclick:"formCustom.swapToSave(this,event)"}).append(jQuery("<i></i>",{class:"CR-delete FR S13",onclick:"formCustom.deletepre(event)",id:"deleteTempIcon"})).append(jQuery("<span></span>",{text:ZPeople.decodeTxt(item.groupName)})))),$(mainDiv).find("div[name=rightTab] div[name=rightTabDiv]").append(jQuery("<div></div>",{role:"tabpanel",class:"tab-pane",id:"dv"+item.groupId,tabId:item.groupId}).append(jQuery("<div></div>",{class:"col-md-12",name:"groupOptions"})));var optionsArr=item.optionsArr,options="";$.each(optionsArr,function(j,option){options+=option,j+1<optionsArr.length&&(options+="\n")});var importButtons="";2==item.groupType&&(importButtons+='<div class="col-md-12 PL0 PT8 DN" id="saveTemplate" name="toggleDiv"><div class="col-md-7 PL0" errordiv="cantbeempty"><input id="groupName" groupid="$GROUPID$" placeholder="'+ZPI18N.getString("zp.entergroupname")+'" class="form-control"></div><div class="col-md-5 MT2 PL0 PR0"><a class="btn btn-primary MR5" onclick="formCustom.saveTemplate(null,null,{obj:this, forPost:true})">'+ZPI18N.getString("zp.save")+" "+ZPI18N.getString("zp.and",[" "+ZPI18N.getString("zp.import")])+"</a></div></div>"),importButtons+='<div class="col-md-12 PL0 PT8" id="importOptions" name="toggleDiv"><a class="btn btn-primary MR5" buttonname="done">'+ZPI18N.getString("zp.import")+"</a>",2==item.groupType&&(importButtons+='<a class="btn btn-default MR5" onclick="formCustom.swapToSave(this,event)" name="importOptions">'+ZPI18N.getString("zp.saveastemplate")+"</a>"),importButtons+="</div>",$(mainDiv).find("div[name=rightTab] div#dv"+item.groupId).find("[name=groupOptions]").append(jQuery("<div></div>",{errorDiv:"cantbeempty"}).append('<textarea class="form-control" id="preOptions" rows="13" placeholder="'+ZPI18N.getString("zp.enteroptionsplaceholder")+'">'+options+"</textarea>")).append(importButtons.replace("$GROUPID$",item.groupId)),$(mainDiv).find("div[name=rightTab] div#dv"+item.groupId+" [name=groupOptions] a[buttonname=done]").on("click",function(){if($(this).addClass("disabled"),errorFunction.removeErrorSpan(Layout.Page.container.find("#predefinedOptions")),0==$(mainDiv).find("[name=rightTab] [tabid]:visible textarea").val().trim().length)return errorFunction.errorSpanAttach("Enter atleast one option to save",$(mainDiv).find("[name=rightTab] [tabid]:visible textarea").parent("[errorDiv]")),void $(this).removeClass("disabled");var options=$(mainDiv).find("[name=rightTab] [tabid]:visible textarea").val().trim().split("\n");options=options.filter(function(e){return e});var success=!0;if($.each(options,function(i,item){return item.length>255?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.optionlength",[255]),mainDiv.find("textarea").parent("[errorDiv]")),mainDiv.find("[buttonname=done]").removeClass("disabled"),success=!1):$.inArray(item,options)!=i?(mainDiv.find("[buttonname=done]").removeClass("disabled"),errorFunction.errorSpanAttach(ZPI18N.getString("zp.duplicateentriesexist"),mainDiv.find("textarea").parent("div")),success=!1):void 0}),success){Layout.Page.container.find("#fieldProperties").attr("currentfcid");var updParams={fcid:Layout.Page.container.find("#fieldProperties").attr("currentfcid"),isupdate:"true",pickListOptions:{bulkOptions:options}};Layout.Page.container.find("#predefinedOptions").modal("hide"),formCustom.fieldAction(null,["updField",updParams])}})},formCustom.findKeyValue=function(array,key,value){var index=null;return $.each(array,function(i,item){if(item[key]==value)return index=i,!1}),index},formCustom.dateValidationFieldsConstruct=function(customFields,customAllowFuture,customAllowPast){customFields=JSON.parse(customFields);var opthtml='<option value="0">'+ZPI18N.getString("zp.select")+"</option>";$.each(customFields[0],function(key,val){opthtml+="<option value="+val.fcid+">"+val.dispName+"</option>"}),customFields[1]&&(opthtml+='<optgroup label="'+ZPI18N.getString("zp.employee")+'">',$.each(customFields[1],function(key,val){opthtml+="<option value="+val.fcid+">"+val.dispName+"</option>"}),opthtml+="</optgroup>"),Layout.Page.container.find("#fieldProperties #allowFutureCustomValidation select").append(opthtml).select2(),Layout.Page.container.find("#fieldProperties #allowFutureCustomValidation select").select2("val",customAllowFuture),Layout.Page.container.find("#fieldProperties #allowPastCustomValidation select").append(opthtml).select2(),Layout.Page.container.find("#fieldProperties #allowPastCustomValidation select").select2("val",customAllowPast)},formCustom.editCustomDateField=function(obj){var name=$(obj).attr("name"),toShow=$(obj).parent().parent().find("select[name="+name+"]");$(obj).prop("checked")?$(toShow).removeClass("DN"):($(toShow).addClass("DN"),$(toShow).select2("val","0"),formCustom.editField(toShow))},formCustom.uniqueFieldsConstruct=function(uniqueFields,saveduniqueFields,formId){var opthtml="";if(uniqueFields.length>0){for(var i=0;i<uniqueFields.length;i++){var fields=uniqueFields[i];opthtml+="<option value="+fields.formCompId+">"+ZSEC.Encoder.encodeForHTML(fields.dispname)+"</option>"}Layout.Page.container.find("#uniqueFields"+formId).html(opthtml)}formCustom.existuniqfields=saveduniqueFields,$.each(saveduniqueFields,function(key){Layout.Page.container.find("#uniqueFields"+formId).find('option[value="'+saveduniqueFields[key]+'"]').length>0&&Layout.Page.container.find("#uniqueFields"+formId).find('option[value="'+saveduniqueFields[key]+'"]').attr("selected","")}),Layout.Page.container.find("#uniqueFields"+formId).select2()},formCustom.parseToSelect2Structure=function(triggerListCv,formId){formCustom.customValidation[formId]={triggerList:[],selectedList:[],refresh:!0},Object.keys(triggerListCv).forEach(section=>{let sectionContainer={text:triggerListCv[section].name,children:[]};Object.keys(triggerListCv[section].children).forEach(child=>{sectionContainer.children.push({id:child,text:triggerListCv[section].children[child][0]}),triggerListCv[section].children[child][1]&&formCustom.customValidation[formId].selectedList.push(child)}),formCustom.customValidation[formId].triggerList.push(sectionContainer)})},formCustom.triggerListCvConstruct=function(triggerList,formId){let termBasedCvList={};formCustom.parseToSelect2Structure(triggerList,formId);let cvTriggerListDiv=Layout.Page.container.find("#cvTriggerListDiv"+formId);cvTriggerListDiv.html('<label class="control-label">'+ZPI18N.getString("zp.cvEnabledFieldsLabel")+'</label><input type = "hidden" class="selectTag select2-offscreen" multiple="multiple" id="cvTriggerFields'+formId+'" keyname="cvTriggerFields"  onchange="formCustom.editCvTriggerField(this, \''+formId+'\')" placeholder="'+ZPI18N.getString("zp.allfields")+'" tabindex="-1">');let cvTriggerFields=Layout.Page.container.find("#cvTriggerFields"+formId);cvTriggerFields.select2({formatNoMatches:function(){return ZPI18N.getString("zp.nomatchesfound")},formatSearching:function(){return ZPI18N.getString("zp.searching")},query:function(query){if(1==formCustom.customValidation[formId].refresh)termBasedCvList={},$.ajax({type:"POST",async:!0,url:"/formAction.zp",data:{mode:"getMappingFieldsForTriggerCv",conreqcsr:csrfToken,formId:formId},success:function(response){response.isSuccess&&(formCustom.parseToSelect2Structure(response.triggerListCv,formId),query.callback({results:formCustom.customValidation[formId].triggerList}),query.element.select2("val",formCustom.customValidation[formId].selectedList),formCustom.customValidation[formId].refresh=!1)}});else if(query.term){if(!termBasedCvList[query.term]){let queryLower=query.term.toLowerCase(),genSection=[];formCustom.customValidation[formId].triggerList.forEach(section=>{let genChildren=[];section.children.forEach(child=>{child.text.toLowerCase().includes(queryLower)&&genChildren.push({id:child.id,text:child.text})}),0!=genChildren.length&&genSection.push({children:genChildren,text:section.text})}),termBasedCvList[query.term]=genSection}query.callback({results:termBasedCvList[query.term]})}else query.callback({results:formCustom.customValidation[formId].triggerList})},initSelection:function(element,callback){let data=[];$(element.val().split(",")).each((index,val)=>{formCustom.customValidation[formId].triggerList.forEach(parent=>{let obj=parent.children.find(itr=>{if(itr.id==val)return!0});void 0!=obj&&data.push(obj)})}),callback(data)},multiple:!0}),cvTriggerFields.select2("val",formCustom.customValidation[formId].selectedList),Layout.Page.container.find("#enablecfvalid"+formId).prop("checked")||0!=cvTriggerFields.select2("val").length||cvTriggerListDiv.hide()},formCustom.editUniqueField=function(obj,formId){var values=Layout.Page.container.find(obj).val();if(null==values&&(values=[]),values.length>5)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxlimituniqfields")),Layout.Page.container.find("#uniqueFields"+formId).select2("destroy"),Layout.Page.container.find("#uniqueFields"+formId).val(formCustom.existuniqfields),void Layout.Page.container.find("#uniqueFields"+formId).select2();values=JSON.stringify(values),$.ajax({type:"POST",async:!0,url:"/formAction.zp",data:{mode:"saveFieldsForUniqueFieldsMapping",conreqcsr:csrfToken,formId:formId,formCompArray:values},success:function(data){data.isSuccess?(formCustom.existuniqfields=JSON.parse(values),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.uniqueFieldsUpdatemsg"))):(void 0!=data.code?data.code==zpconst.UniqueFields.CANDIDATE_KEY_ALREADY_CHECKED_NO_DUPLICATE&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.uniqueFieldDupError",["'"+data.errors[0]+"'"])):"max_limit_reach"==data.message?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxlimituniqfields")):"extensionform"==data.message?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.extensionformnoedit")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")),Layout.Page.container.find("#uniqueFields"+formId).select2("destroy"),Layout.Page.container.find("#uniqueFields"+formId).val(formCustom.existuniqfields),Layout.Page.container.find("#uniqueFields"+formId).select2())}})},formCustom.loadUniqFields=function(formId){$.ajax({type:"POST",async:!0,url:"/formAction.zp",data:{mode:"getFieldsForUniqueFieldsMapping",conreqcsr:csrfToken,formId:formId},success:function(data){if(data.isSuccess){var fields=data.fcDetails,uniqFields=data.uniqFcDetails;Layout.Page.container.find("#uniqueFields"+formId).select2("destroy");var opthtml="";if(fields.length>0){for(var i=0;i<fields.length;i++){var fields1=fields[i];opthtml+="<option value="+fields1.formCompId+">"+fields1.dispname+"</option>"}Layout.Page.container.find("#uniqueFields"+formId).html(opthtml)}Layout.Page.container.find("#uniqueFields"+formId).val(uniqFields),Layout.Page.container.find("#uniqueFields"+formId).select2()}}})},formCustom.editCvTriggerField=function(obj,formId){let cvTriggerFields=Layout.Page.container.find(obj),values=[];cvTriggerFields.val()&&(values=cvTriggerFields.val().split(",")),$.ajax({type:"POST",async:!0,url:"/formAction.zp",data:{mode:"saveTriggerFieldsForCustomValidation",conreqcsr:csrfToken,formId:formId,formCompArray:JSON.stringify(values)},success:function(response){response.isSuccess?(formCustom.customValidation[formId].selectedList=values,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.cvFieldsUpdateMsg"))):(response.code==zpconst.TriggerFields.CUSTOM_VALIDATION_NOT_ENABLED?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.CustomValidationNotEnabled")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")),cvTriggerFields.select2("val",formCustom.customValidation[formId].selectedList))}})},formCustom.exportConfig=function(formid){var form=$("#zp_conf_export_form");0==form.length&&((form=jQuery("<form></form>",{id:"zp_conf_export_form",method:"post",action:"configExport.zp"})).append(jQuery("<input>",{type:"hidden",name:"conreqcsr",value:csrfToken})),form.append(jQuery("<input>",{type:"hidden",name:"formIds",value:formid})),$("body").append(form)),form.find('[name="formIds"]').val(formid),form.trigger("submit")},formCustom.importConfig=function(formid){if(""==(imp=$("#formConfigImport")).html()||void 0==imp.html()){var imp=jQuery('<div class="modal  popRgtModel" id="formConfigImport"> <div class="modal-dialog" role="document"> <div class="modal-content"><div class="ZPNxtStep"><div class="modal-header"><ol class="breadcrumb ZPbcrumb"><li class="active"><a >'+ZPI18N.getString("zp.uploadfile")+'</a></li></ol><button aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div><div class="modal-body"><form class="form-horizontal pad"><input type="hidden" name="conreqcsr" value="'+csrfToken+'"><input type="hidden" name="formId" value=""><input type="hidden" name="mode" value="configimport"><div class="ZPfileBox text-center PT30 PB30"><i class="IC-imprt S22 MB8 DIB blu"></i><p class="ZPbold">'+ZPI18N.getString("zp.fileimported")+'</p><p class="gry"><small>'+ZPI18N.getString("zp.fomtsupportjson")+"</small><br><small>"+ZPI18N.getString("zp.maxfilesize")+'</small></p><div class="btn btn-primary ZPbtnDefault"><span>'+ZPI18N.getString("zp.importfile")+'</span><input type="file" accept=".json" class="ZPFfile" name="configfile" onchange="formCustom.fileImportChange()" id="configimportFileName"></div></div></form></div><div class="modal-footer text-left"><button id="fileconfigSubmit" style="display:none" onclick="formCustom.fileImportSubmitHanlde()" class="btn btn-primary  btn-md MR10 FR" type="button">'+ZPI18N.getString("zp.submit")+'</button><button class="btn btn-default btn-md FL" type="button" data-dismiss="modal">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div></div></div>");$("#wrapper").append(imp)}imp.find('[name="formId"]').val(formid),imp.find('[name="theFile"]').val(""),imp.find("#fileconfigSubmit").hide(),$(imp).modal("show")},formCustom.fileImportChange=function(){$("#formConfigImport #fileconfigSubmit").removeClass("disabled").show()},formCustom.fileImportSubmitHanlde=function(){$("#formConfigImport #fileconfigSubmit").addClass("disabled");var formData=new FormData($("#formConfigImport").find("form")[0]);ZPeople.Request.sendFormData("/formAction.zp",formData,formCustom.ImportSubmitRespHandle)},formCustom.ImportSubmitRespHandle=function(data){$("#formConfigImport #fileconfigSubmit").removeClass("disabled"),data.isSuccess?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.holiday.success")),$("#formConfigImport").modal("hide")):ZPeople.Message.showFailureMsg(data.message)},formCustom.changeEmpStatusType=function(radioButton){var radio=$(radioButton),selectedValue=radio.val(),sysval=radio.closest("[name='choiceDiv']").attr("sysval"),isActive=1==sysval||-1==sysval||6==sysval||7==sysval;if(sysval>0)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.systemoptionmodify")),$("[name='"+radio.attr("name")+"'][status='"+(isActive?"Active":"Inactive")+"']").prop("checked",!0);else if(-1==selectedValue&&!isActive||0==selectedValue&&isActive){var params={method:"changeEmpStatusType",fieldOptionId:$(radioButton).attr("name"),selectValue:selectedValue};ZPeople.Request.send("/changeEmpStatusType.zp",params,function(data){"success"===data.status?(radio.closest("[name='choiceDiv']").attr("sysval",selectedValue),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))):(ZPeople.Message.showFailureMsg(data.msg),$("[name='"+radio.attr("name")+"'][status='"+(isActive?"Active":"Inactive")+"']").prop("checked",!0))})}},formCustom.showInput=function(divElement,action){var div=$(divElement);"show"===action?(div.find("span").hide(),div.find("input").removeClass("hide").trigger("focus")):"hide"===action&&(div.addClass("hide"),div.siblings().show().text(div.val()))},formCustom.onloadEmpSts=function(){$("#fieldProperties").attr("name","fieldProperties").removeAttr("id"),$("[name='tempDiv']").attr("id","fieldProperties"),$("#EmpSts").modal(),$("#EmpSts").on("hidden.bs.modal",function(){$("[name='tempDiv']").removeAttr("id"),Layout.Page.container.find('#formPropertiesTab [role="tab"]').trigger("click"),$("[name='fieldProperties']").attr("id","fieldProperties").removeAttr("name"),$("[name='tempDiv']").remove()})},formCustom.onloadEmpHealthSts=function(){$("#fieldProperties").attr("name","fieldProperties").removeAttr("id"),$("[name='tempDiv']").attr("id","fieldProperties"),$("#EmpHealthSts").modal(),$("#EmpHealthSts").on("hidden.bs.modal",function(){$("[name='tempDiv']").removeAttr("id"),$("[name='fieldProperties']").attr("id","fieldProperties").html(""),$("[name='tempDiv']").remove(),EmployeeHealthData.widgetStatusRefresh()})};var tabAndFormsCustom={TAB_OUTER_TEMPLATE:'<div class="ZPTscrlcont" id="customiseMainTabs"><div class="clearfix MT30 ML15 MR15"><div class="row" id="$PAGEDIVID$"></div></div></div>',TABCOLUMN_TEMPLATE:'<div class="col-md-6 $SIDECLASS$" name="tabColumn"></div>',FORMDIV_STATIC_TEMPLATE:'<li class="list-group-item" name="fixedLi"> <span class="IC-switch S14"></span><span>$FORMNAME$</span></li>',FORMDIV_CUSTOM_TEMPLATE:'<li name="formLi" id="$ID$" switch="$SWITCH$" class="list-group-item $MOVECLASS$ $DISABLED$" custom="$ISCUSTOM$" isPortal="$ISPORTAL$">',tabDeleteMethod:"tabCustom.tabOperations(this,['deleteTab'])",tabEnableMethod:"tabCustom.tabOperations(this,['updateTab','showhidetab'])",formDeleteMethod:"formCustom.formOperations(this,['deleteForm'])",formEnableMethod:"formCustom.formOperations(this,['formCustOperations','showhideform'])",switchInfo:{isSwitch:!1},url:"/getFormAndTabs.zp",forSaveForm:{isClick:!1,isChange:!1},holiday_displayname:ZPI18N.getString("zp.holiday"),init:function(data){$("#accordion:visible #zp_page_loading").show(),ZPeople.Request.send(tabAndFormsCustom.url,{method:"formsAndTabsPage"},tabAndFormsCustom.getformTabsPage,"")},getformTabsPage:function(resultData){resultData.hasOwnProperty("tabList")?(tabAndFormsCustom.holiday_displayname=resultData.hasOwnProperty("holiday_displayname")?resultData.holiday_displayname:tabAndFormsCustom.holiday_displayname,tabAndFormsCustom.hrfiles_displayname=ZPeople.isZPNewUI()?ZPI18N.getString("zp.newemployeefiles"):ZPI18N.getString("zp.hrfiles"),tabAndFormsCustom.companyfiles_displayname=ZPeople.isZPNewUI()?ZPI18N.getString("zp.organizationfiles"):ZPI18N.getString("zp.companyfiles"),tabAndFormsCustom.hrfiles_displayname=resultData.hasOwnProperty("hrfiles_displayname")?resultData.hrfiles_displayname:tabAndFormsCustom.hrfiles_displayname,tabAndFormsCustom.companyfiles_displayname=resultData.hasOwnProperty("companyfiles_displayname")?resultData.companyfiles_displayname:tabAndFormsCustom.companyfiles_displayname,resultData=resultData.tabList,$("#accordion:visible").siblings("#zp_page_loading").hide(),$("#accordion:visible").append(tabAndFormsCustom.tabsPageConstruction.Construct(resultData)),formCustom.minimiseTab(!1),tabCustom.sortForms(),tabCustom.columnHeightAdjust()):""!=resultData.msg.trim()&&ZPeople.Message.showFailureMsg(resultData.msg.trim())},tabsPageConstruction:{tabHeader:function(tabName,switchInfo){var headerTab='<li class="list-group-item active"><div class="form-group M0">';return switchInfo.isSwitch&&(headerTab+=this.dvswitchConstruction(switchInfo)),headerTab+='<div class="input-group"> <b class="IC-move S14 invisible" name="dragIcon"></b><span class="ZPbold" name="tabname">'+tabName+"</span>","Employee Engagement"==tabName||!switchInfo.isSwitch||switchInfo.hasOwnProperty("isExtensionTab")&&switchInfo.isExtensionTab||(headerTab+='<i class="IC-pen" onclick="tabCustom.toggleEditMode(this);"></i><input type="text" class="form-control" style="display:none;" onblur="tabCustom.toggleEditMode(this);" onchange="tabCustom.tabOperations(this,[\'custOperations\',\'renameTab\']);" value="'+tabName+'">'),headerTab+="</div>",headerTab+="</div></li>"}}};tabAndFormsCustom.tabsPageConstruction.Construct=function(resultData){var i=0,tabOuter=tabAndFormsCustom.TAB_OUTER_TEMPLATE.replace(/\$PAGEDIVID\$/g,"tabsPageDiv");tabOuter=$(tabOuter);var tabColumn=tabAndFormsCustom.TABCOLUMN_TEMPLATE;tabColumn=tabColumn.replace(/\$SIDECLASS\$/g,"PRO"),tabColumn=$(tabColumn);var switchInfo=tabAndFormsCustom.switchInfo;switchInfo.name="",switchInfo.isSwitch=!1;var count=1;for(isPlatformOrg||$(tabColumn).append(this.staticTab(ZPI18N.getString("zp.selfservice"),switchInfo,count)),i=1;i<resultData.length;i+=2)count+=2,switchInfo.isSwitch=!0,switchInfo.deletemethod=tabAndFormsCustom.tabDeleteMethod,switchInfo.enablemethod=tabAndFormsCustom.tabEnableMethod,switchInfo.switchId="showhide_"+resultData[i].tabId,switchInfo.isHidden=resultData[i].isHidden,switchInfo.isCustom=resultData[i].isCustom,switchInfo.isExtensionTab=resultData[i].isExtensionTab,$(tabColumn).append(this.tabDiv(count,resultData[i],switchInfo));for($(tabOuter).find("#tabsPageDiv").append(tabColumn),tabColumn=(tabColumn=tabAndFormsCustom.TABCOLUMN_TEMPLATE).replace("$SIDECLASS$","PLO"),tabColumn=$(tabColumn),switchInfo.isSwitch=!1,count=0,i=0;i<resultData.length;i+=2)count+=2,switchInfo.isSwitch=!0,switchInfo.deletemethod=tabAndFormsCustom.tabDeleteMethod,switchInfo.enablemethod=tabAndFormsCustom.tabEnableMethod,switchInfo.switchId="showhide_"+resultData[i].tabId,switchInfo.isHidden=resultData[i].isHidden,switchInfo.isCustom=resultData[i].isCustom,switchInfo.isExtensionTab=resultData[i].isExtensionTab,$(tabColumn).append(this.tabDiv(count,resultData[i],switchInfo));return $(tabOuter).find("#tabsPageDiv").append(tabColumn),tabOuter},tabAndFormsCustom.tabsPageConstruction.staticTab=function(tabName,switchInfo,count){var tabDiv='<div class="col-md-12" name="static"> <span name="countNum" class="rounded nomove">'+count+'</span><ul class="list-group">';return tabDiv+=this.tabHeader(tabName,switchInfo),tabDiv+=this.addStaticForms(tabName),tabDiv+="</ul></div>"},tabAndFormsCustom.tabsPageConstruction.tabDiv=function(tabNum,tabDtls,switchInfo){var disClass="";switchInfo.chkAttr="",tabDtls.isHidden?disClass=" disabled":switchInfo.chkAttr=" checked";let isNew="";tabDtls&&tabDtls.isNew&&(isNew='isNew="true"');var tabDiv='<div class="col-md-12" '+isNew+' name="tabDiv" tablabel="'+tabDtls.tabName+'"> <span class="rounded" name="countNum">'+tabNum+'</span><ul isLink="'+tabDtls.isLink+'" id="Tab_'+tabDtls.tabId+'" class="list-group'+disClass+'">';return tabDiv+=this.tabHeader(tabDtls.tabDisplayName,switchInfo),tabDiv+=this.addStaticForms(tabDtls.tabName),tabDtls.formDetailsMap.length>0?tabDiv+=this.formsListConstruction(tabDtls.formDetailsMap):0==tabDtls.isLink&&"Timetracker"!=tabDtls.tabName&&"Leavetracker"!=tabDtls.tabName&&"Attendance"!=tabDtls.tabName&&"Files"!=tabDtls.tabName&&"Announcements"!=tabDtls.tabName&&"OfficeReadiness"!=tabDtls.tabName&&(tabDiv+=this.emptyTabDiv()),tabDiv+="</ul></div>"},tabAndFormsCustom.tabsPageConstruction.addStaticForms=function(tabName){var staticFormsDiv="",formLi=tabAndFormsCustom.FORMDIV_STATIC_TEMPLATE;return"Timetracker"==tabName?(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.timelogs")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.projectsjobs")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.reports"))):"Leavetracker"==tabName?(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.leaveview")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.reports")),staticFormsDiv+='<li class="list-group-item" name="fixedLi"> <span class="IC-switch S14"></span><span id="Holiday_LT" class="Header">'+tabAndFormsCustom.holiday_displayname+'</span><i class="IC-pen Header" onclick="Holiday.View.renameInit()"></i><input type="text" id="Holiday_LT" name="holiday_disname" class="form-control DN MT5 Editable-Header" onblur="Holiday.View.saveName(\'holiday_disname\')" onchange="Holiday.View.saveName(\'holiday_disname\')" value="'+tabAndFormsCustom.holiday_displayname+'"></li>'):"Files"==tabName?(staticFormsDiv+='<li class="list-group-item" name="fixedLi"> <span class="IC-switch S14"></span><span class="Header">'+tabAndFormsCustom.companyfiles_displayname+'</span><i class="IC-pen Header" onclick="Holiday.View.renameInit(this,\'files\')"></i><input type="text" name="companyfile_dispname" class="form-control DN MT5 Editable-Header" onchange="Holiday.View.saveName(\'companyfile_dispname\')"  value="'+tabAndFormsCustom.companyfiles_displayname+'"></li>',staticFormsDiv+='<li class="list-group-item" name="fixedLi"> <span class="IC-switch S14"></span><span class="Header">'+tabAndFormsCustom.hrfiles_displayname+'</span><i class="IC-pen Header" onclick="Holiday.View.renameInit(this,\'files\')"></i><input type="text" name="hrfile_dispname" class="form-control DN MT5 Editable-Header" onchange="Holiday.View.saveName(\'hrfile_dispname\')"  value="'+tabAndFormsCustom.hrfiles_displayname+'"></li>',staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.settings"))):"Attendance"==tabName?(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.entry")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.report")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.settings"))):"Self-service"==tabName?(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.profile")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.feeds")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.goals")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.leave")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.relatedforms")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.approvals"))):"Organization"==tabName?staticFormsDiv="":"Announcements"==tabName?staticFormsDiv="":"OfficeReadiness"==tabName&&(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.workpremises"))),staticFormsDiv},tabAndFormsCustom.tabsPageConstruction.emptyTabDiv=function(){var emptytabdiv='<li class="list-group-item text-center" name="dummy">';return emptytabdiv+='<div class="P20 PB10">',emptytabdiv+="<p>"+ZPI18N.getString("zp.noformsinservicealert")+"</p>",emptytabdiv+='<div class="btn btn-default MT5" onclick="tabCustom.addNewForm(this,true);">'+ZPI18N.getString("zp.addnewform")+"</div>",emptytabdiv+="</div></li>"},tabAndFormsCustom.tabsPageConstruction.formsListConstruction=function(formDetailsMap,parentTab){var formDiv="",formDisable="",chkAttr="",switchInfo=tabAndFormsCustom.switchInfo;return switchInfo.deletemethod=tabAndFormsCustom.formDeleteMethod,switchInfo.enablemethod=tabAndFormsCustom.formEnableMethod,switchInfo.name="forCustom",$.each(formDetailsMap,function(i,item){if(item.isHidden?(formDisable=" disabled",chkAttr=""):(formDisable="",chkAttr=" checked"),switchInfo.chkAttr=chkAttr,switchInfo.isCustom=item.isCustom,switchInfo.isExtensionForm=item.isExtensionForm,switchInfo.switchId="projects_"+item.formId,switchInfo.isHidden=item.isHidden,-1!=$.inArray(item.tablename,["P_ClientDetails","P_TimesheetJobsList","P_TimesheetJob","P_Timesheet","P_EmployeeJobs","P_Task","P_Candidate","P_Compensatory"])&&item.hasOwnProperty("tablename"))formDiv+='<li custom="'+item.isCustom+'" class="list-group-item" switch="false" id='+item.formId+' name="formLi">';else{var formLi=tabAndFormsCustom.FORMDIV_CUSTOM_TEMPLATE;$.inArray(item.tablename,["P_Employee","P_Department","P_Designation"])>=0?(formLi=(formLi=(formLi=(formLi=(formLi=(formLi=formLi.replace("$ID$",item.formId)).replace("$ISCUSTOM$",item.isCustom)).replace("$DISABLED$",formDisable)).replace("$MOVECLASS$",ZPeople.isDeptDesgRestricted?"":"spnmov-item")).replace("$SWITCH$","false")).replace(">","P_Employee"==item.tablename?" employeeForm=true>":">"),formDiv+=formLi):!item.hasOwnProperty("tablename")||"P_EmployeeLeave"!=item.tablename&&$.inArray(item.componentName,["P_PerformanceAppraisal","P_SelfAppraisal","P_AppraiseeList","P_Goals","P_EmployeeSalary","P_Workplace_Readiness"])<0?("P_Visitor"==item.tablename&&(formLi='<li name="formLi" id="$ID$" switch="$SWITCH$" class="list-group-item $DISABLED$" custom="$ISCUSTOM$" isPortal="$ISPORTAL$">'),($.inArray(item.tablename,["P_VaccinationStatus","P_EmployeeHealthData"])>=0||item.isExtensionForm)&&(formLi=formLi.replace("$MOVECLASS$","")),formLi=(formLi=(formLi=(formLi=(formLi=(formLi=formLi.replace("$ID$",item.formId)).replace("$ISCUSTOM$",item.isCustom)).replace("$DISABLED$",formDisable)).replace("$MOVECLASS$","spnmov-item")).replace("$SWITCH$","true")).replace("$ISPORTAL$",item.isPortal),formDiv+=formLi,formDiv+=tabAndFormsCustom.tabsPageConstruction.dvswitchConstruction(switchInfo)):item.isHidden?(formDiv+='<li custom="'+item.isCustom+'" class="list-group-item'+formDisable+'" id='+item.formId+' switch="true" name="formLi" onlyDisable=true empLeave = '+("P_EmployeeLeave"==item.tablename)+">",formDiv+=tabAndFormsCustom.tabsPageConstruction.dvswitchConstruction(switchInfo)):formDiv+='<li custom="'+item.isCustom+'" class="list-group-item'+formDisable+'" id='+item.formId+' switch="false" name="formLi" onlyDisable=true empLeave = '+("P_EmployeeLeave"==item.tablename)+">"}formDiv+='<span class="IC-switch S14" name="dragIcon"></span>',void 0==parentTab||"P_VaccinationStatus"==item.tablename&&item.isExtensionForm?"P_VaccinationStatus"==item.tablename||item.isExtensionForm?(formDiv+="<span>"+item.formName+"</span>",$(parentTab).append(formDiv)):"P_Compensatory"==item.tablename?formDiv+='<span id="Compoff_LT" class="Header">'+item.formName+'</span><i class="IC-pen Header" onclick="Leave.Compensatory.Form.initRename()"></i><input type="text" name="comp_disname" id="Compoff_LT" class="form-control DN MT5 Editable-Header" onblur="Leave.Compensatory.Form.saveName()" onchange="Leave.Compensatory.Form.saveName()" value="'+(item.formName?item.formName:"Compensatory Request")+'">':ZPeople.isDeptDesgRestricted&&$.inArray(item.tablename,["P_Department","P_Designation"])>=0?formDiv+='<span name="formDispName_'+item.tablename+'" class="Header">'+item.formName+'</span><i class="IC-pen Header" onclick="tabAndFormsCustom.tabsPageConstruction.initRenameform(this)"></i><input type="text" name="'+item.tablename+'_Name" id="'+item.tablename+'_rninputDiv" class="form-control DN MT5 Editable-Header" onblur="tabAndFormsCustom.tabsPageConstruction.renameForm(this,\''+item.formId+'\')" value="'+item.formName+'">':formDiv+='<a class="ulnk" href="#admin/formslayout/formedit-'+item.formId+'" ><span>'+item.formName+"</span></a>":(ZPeople.isDeptDesgRestricted&&$.inArray(item.tablename,["P_Department","P_Designation"])>=0?formDiv+='<span class="Header">'+item.formName+'</span><i class="IC-pen Header" onclick="tabAndFormsCustom.tabsPageConstruction.initRenameform(this)"></i><input type="text" name="'+item.tablename+'_Name" id="'+item.tablename+'_rninputDiv" class="form-control DN MT5 Editable-Header" onblur="tabAndFormsCustom.tabsPageConstruction.renameForm(this,\''+item.formId+'\')" value="'+item.formName+'">':formDiv+='<a class="ulnk" href="#admin/formslayout/formedit-'+item.formId+'" ><span></span></a>',$(parentTab).append(formDiv),$(parentTab).find("a[href*="+item.formId+"] span").text(ZPeople.decodeTxt(item.formName)))}),formDiv},tabAndFormsCustom.tabsPageConstruction.initRenameform=function(obj){$(obj).siblings(".Header").addClass("DN"),$(obj).siblings(".Editable-Header").removeClass("DN"),$(obj).siblings("input")[0].focus()},tabAndFormsCustom.tabsPageConstruction.renameForm=function(obj,formId){var dispName=$(obj).val();if(dispName&&dispName.trim().length>0&&dispName.length<50){var params={},others={};others.obj=obj,params.formid=formId,params.method="formCustOperations",params.mode="changeFormDispName",params.dispName=dispName,ZPeople.Request.send("/formCustOperations.zp",params,function(response,params,others){$(others.obj).siblings("[name^=formDispName_]").text(params.dispName),$(others.obj).val(params.dispName),$(others.obj).siblings(".Header").removeClass("DN"),$(others.obj).addClass("DN"),response.hasOwnproperty("error")?"nochangesfound"==response.error?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.namechangeerrormsg")):ZPeople.Message.showFailureMsg(response.error):"Success"==response.msg?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},others)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.entervalidinput"))},tabAndFormsCustom.tabsPageConstruction.dvswitchConstruction=function(switchInfo){var dvswitch="";return switchInfo.hasOwnProperty("isExtensionForm")&&switchInfo.isExtensionForm||switchInfo.hasOwnProperty("isExtensionTab")&&switchInfo.isExtensionTab||(dvswitch='<div class="dvswitch" name="'+switchInfo.name+'">',switchInfo.isCustom&&(dvswitch+='<a class="IC-delete S13 MR25 ZPtitle" onclick="'+switchInfo.deletemethod+'"></a>'),dvswitch+='<div class="btnactive">',dvswitch+='<input type="checkbox" name="enableDisableSwitch" class="cmn-toggle-small cmn-toggle-round-small" '+switchInfo.chkAttr+' id="'+switchInfo.switchId+'" onclick="'+switchInfo.enablemethod+'">',dvswitch+='<label for="'+switchInfo.switchId+'"></label>',dvswitch+="</div></div>"),dvswitch};var tabCustom={param:[],addNewTabEntry:function(tabId,tabName){var tabSelectObj=$("#addFormSlider").find("[keyname=tabId]");tabSelectObj.append('<option value="'+tabId+'" selected="selected">'+tabName+"</option>"),tabSelectObj.val(tabId),$(tabSelectObj).select2()},sortForms:function(){var parent=$("#accordion"),formDiv=$(parent).find("[name=tabDiv] ul[id*=Tab_]").not(".disabled"),isSorted=!1;$(parent).find("[name=tabColumn]").sortable({items:"[name=tabDiv]",handle:$(parent).find("[name=dragIcon]"),connectWith:"[name=tabColumn]",placeholder:"col-md-12 placeholder",start:function(){isSorted=!1},update:function(){var $sortable=$(this);if(!isSorted){var tabIds=[],obj=$(parent).find("#tabsPageDiv [name=tabDiv] span.rounded");tabCustom.tabNumberUpdate(),obj.each(function(){var txt=parseInt($(this).html());tabIds[txt-2]=$(this).siblings("ul").attr("id").match(/[\d]+$/).toString()}),tabIds=tabIds.flat();var params={tabIds:JSON.stringify(tabIds),method:"reorderTab"};ZPeople.Request.send("/tabOperations.zp",params,tabCustom.updateSort,{obj:$sortable,isTab:!0},formCustom.failureCallBack)}isSorted=!0}}),$(formDiv).sortable({handle:$(formDiv).find("li[name=formLi] [name=dragIcon]"),items:"li[name=formLi]",connectWith:"ul[id*=Tab_][isLink=false]:not(.disabled)",placeholder:"filedplace",start:function(event,ui){isSorted=!1},update:function(event,ui){var sortableItem=$(this);if(!isSorted){$(ui.item).siblings("[name=dummy]").hide();$(ui.item).attr("id");var parentUl=$(ui.item).parent("ul");if("1"===ui.item.attr("isPortal")&&$(parentUl).attr("id")!==$(sortableItem).attr("id"))return sortableItem.sortable("cancel"),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.movecportalformnotallowed"));var formIds=[];$(parentUl).find("li[name=formLi]").each(function(){formIds.push($(this).attr("id"))});var params={parenttabid:$(parentUl).attr("id").match(/[\d]+$/).toString(),formIds:JSON.stringify(formIds),mode:"reorderform",method:"formCustOperations"};ZPeople.Request.send("/formCustOperations.zp",params,tabCustom.updateSort,{obj:sortableItem,isTab:!1},formCustom.failureCallBack)}isSorted=!0}})},updateSort:function(data,params,others){if("success"==data.msg.trim())others.iTab||(tabCustom.emptyTabCheck(),$("#admin-formslayout-formslist, #dvfrmlstcontent").remove(),$("zp_hometabs").attr("isloaded",!1)),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),Layout.CustomizedUrl.refreshService();else if(""!=data.msg.trim()){others.obj.sortable("cancel"),others.isTab&&tabCustom.tabNumberUpdate();let msg=data.msg.trim();"MOVE_RESTRICTED"==data.msg.trim()?msg=ZPI18N.getString("zp.cannotmoveformtothisservice"):"extensionservice"==data.msg.trim()&&(msg=ZPI18N.getString("zp.extensionservicenoedit")),ZPeople.confirm(null,"",msg,"",!0,!0)}},emptyTabCheck:function(){$("#accordion li[name=dummy]").fadeOut("fast"),$("#accordion a[name=deleteIcon]").fadeOut("fast"),$("ul[id*=Tab_][isLink=false]").each(function(){0==$(this).find("li[name=formLi]").length&&0==$(this).find("li[name=fixedLi]").length&&($(this).append(tabAndFormsCustom.tabsPageConstruction.emptyTabDiv()),$(this).find("[name=tabNameLi] [name=forCustom]").append($('<a class="IC-delete S13 MR25 ZPtitle" name="deleteIcon" title="" data-original-title="Delete" onclick="tabCustom.tabOperations(this,[\'deleteTab\'])"></a>')))}),tabCustom.columnHeightAdjust()},columnHeightAdjust:function(){var div1=$("[name=tabColumn]").first(),div2=$("[name=tabColumn]").last(),div=div1.innerHeight()>div2.innerHeight()?div1.css("min-height","auto"):div2.css("min-height","auto");$("[name=tabColumn]").css("min-height",div.innerHeight())},openNewTab:function(obj){var newTab=ZPeople.createModalPopup("newTabPopup",ZPI18N.getString("zp.addnewservice"),"modal-xs");newTab.find("#bodyTag input").length<=0&&newTab.find("#bodyTag").append('<div class="row"><div class="form-group"><div class="col-md-10" errorDiv="cantbeempty"><label>'+ZPI18N.getString("zp.hrservicename")+'</label><input elem="tabName" type="text" placeholder="'+ZPI18N.getString("zp.newservicename")+'" class="form-control"></div><div class="col-md-10" errorDiv="cantbeempty"><label>'+ZPI18N.getString("zp.description")+'</label><input elem="tabDesc" type="text" placeholder="'+ZPI18N.getString("zp.enterdesc")+'" class="form-control"></div></div></div>'),newTab.find("input").val(""),newTab.find("[elem=tabName]").trigger("select"),newTab.find("[buttonname=done]").off(),newTab.find("[buttonname=done]").on("click",function(){tabCustom.tabOperations(this,["addTab"])})},fillViewName:function(obj){if(""!=$(obj).val()&&$(obj).val().match(/^[a-zA-Z0-9\s.\-\_\$\:\/\/\+\'\!\;,. ]+$/)){var val=$(obj).val();$(obj).parents("[name=addFormFields]").siblings("#formlinkname").find("input").val(val)}},createTab:function(data,params,others){if(data.hasOwnProperty("securityError"))$("#newTabPopup").modal("hide"),ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0);else if("duplicate"==data.msg.trim())errorFunction.errorSpanAttach(ZPI18N.getString("zp.servicenameduplicateerror"),others.obj);else if("Success"==data.msg.trim()){$("#newTabPopup").modal("hide");var tabDtls={tabDisplayName:data.tabDisplayName,tabName:data.tabName,tabId:data.tabId,formDetailsMap:[],isLink:!1},switchInfo={isSwitch:!0,switchId:"showhide_"+data.tabId,isHidden:!1,isCustom:!0,deletemethod:tabAndFormsCustom.tabDeleteMethod,enablemethod:tabAndFormsCustom.tabEnableMethod,title:ZPI18N.getString("zp.deleteservice"),name:""},tabLen=$("#accordion").find("#tabsPageDiv [name=tabDiv],[name=static]").length,last=$("#accordion").find("#tabsPageDiv [name=tabDiv] span:contains("+tabLen+")").last();last=$(last).parents("[name=tabDiv]"),tabDtls.isNew=!0,$(last).parents("[name=tabColumn]").siblings("[name=tabColumn]").append(tabAndFormsCustom.tabsPageConstruction.tabDiv(tabLen+1,tabDtls,switchInfo)),delete tabDtls.isNew,$("#accordion").find("[isNew=true]")[0].scrollIntoView(),$("#accordion").find("[isNew=true]").attr("isNew",!1),tabCustom.sortForms(),tabCustom.emptyTabCheck(),$("#dvaddform [keyname=tabId]").append("<option value="+data.tabId+">"+params.tabName+"</option>"),Layout.Page.container.not("#addFields").find("[istooltip=true]").not("[data-original-title]").tooltip(),Layout.CustomizedUrl.refreshService()}else""!=data.msg.trim()&&errorFunction.errorSpanAttach(data.msg.trim(),others.obj)},saveForm:function(obj,others){if(tabAndFormsCustom.forSaveForm.isChange)tabAndFormsCustom.forSaveForm.isClick=!0;else{var parentDiv=$(obj).parents("#dvaddform"),tabNameDiv=$(parentDiv).find("#newTab input");errorFunction.removeErrorSpan(parentDiv,"[test=newTab]");var keyname,keyval,formData=new FormData,error=void 0!=$(tabNameDiv).attr("isDup")?$(tabNameDiv).attr("isDup"):"false";$(parentDiv).find("[name=addFormFields]:visible, [tip=tabdiv]").each(function(){var inputDiv=$(this).find("input:visible ,  [keyname=tabId], select , textarea:visible");if($(inputDiv).parents("[name=addFormFields]").removeClass("zp-err"),$(inputDiv).length>1)$.each(inputDiv,function(){if(keyname=$(this).attr("keyname"),keyval=$(this).val().trim(),void 0!=keyname&&""!=keyname){if("tabId"==keyname)"-1"==keyval&&(errorFunction.errorSpanAttach(ZPI18N.getString("zp.servicenamenotemptyerror"),$(this).parent("div")),error="true");else{if("selformId"==keyname||"configfile"==keyname)return;if("formtype"==keyname)if("template"==keyval)formData.set("selformId",parentDiv.find("#selectForm select").val());else if("import"==keyval){var fileEle=parentDiv.find("#chooseFileForAddForm input")[0],file=fileEle.files[0];void 0==file||""==file?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.choosefile"),$(fileEle).parent("div")),$(fileEle).parents("[errorDiv=cantbeempty]").attr("test","formname"),$(fileEle).parents("[errorDiv=cantbeempty]").find(".red").attr("test","formname"),error="true"):formData.set("configfile",file)}}"autoNumberFieldName"===keyname&&""===keyval&&$(parentDiv).find("[keyname=enableAutoNumber]").is(":checked")&&(errorFunction.errorSpanAttach(ZPI18N.getString("zp.autonumbernamecantbeemptyerror"),$(this).parent("div"),!1,!0),$(inputDiv).parents("[errorDiv=cantbeempty]").attr("test","formname"),$(inputDiv).parents("[errorDiv=cantbeempty]").find(".red").attr("test","formname"),error="true"),formData.set(keyname,keyval)}});else{if(keyname=$(inputDiv).attr("keyname"),keyval=$(inputDiv).val(),"selformId"==keyname||"configfile"==keyname)return;"checkbox"==$(inputDiv).attr("type")?"formtype"!=keyname&&(keyval=$(inputDiv).is(":checked").toString()):"formname"==keyname&&""==keyval.trim()?(errorFunction.errorSpanAttach(ZPI18N.getString("zp."+keyname+"notemptyerror"),$(inputDiv).parent("div"),!1,!0),$(inputDiv).parents("[errorDiv=cantbeempty]").attr("test","formname"),$(inputDiv).parents("[errorDiv=cantbeempty]").find(".red").attr("test","formname"),error="true"):"formname"==keyname&&keyval.trim().length>100?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.displaynamelength",[100]),$(inputDiv).parent("div"),!1,!0),$(inputDiv).parents("[name=addFormFields]").addClass("zp-err"),error="true"):"formlinkname"==keyname&&keyval.trim().length>100?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.labelnamelength"),$(inputDiv).parent("div"),!1,!0),$(inputDiv).parent("div").attr("errorDiv","cantbeempty").attr("name","addFormFields"),$(inputDiv).parents("[name=addFormFields]").addClass("zp-err"),error="true"):"desc"==keyname&&keyval.trim().length>100&&(errorFunction.errorSpanAttach(ZPI18N.getString("zp.formdescplaceholder"),$(inputDiv).parent("div"),!1,!0),$(inputDiv).parents("[name=addFormFields]").addClass("zp-err"),error="true"),formData.set(keyname,keyval)}}),0!=$(parentDiv).find("#portalType").val()&&formData.set("portalType",$(parentDiv).find("#portalType").val()),"false"==error&&(others||(others={}),others.obj=parentDiv,$(parentDiv).find("[buttonname=done]").addClass("disabled"),ZPeople.Request.sendFormData("/formOperations.zp?method=addForm",formData,tabCustom.saveSuccess,others,(data,params,others)=>{formCustom.failureCallBack(data,params,others),$(parentDiv).find("[buttonname=done]").removeClass("disabled")}))}},enableDisableTab:function(data,params,others){if("Success"==data.msg.trim()){if(params.hidden){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablesuccessful")),$(others.obj).parents("ul").addClass("disabled"),tabCustom.dvfrmlstcontentEntry(params.tabid,!1,!1);var formliObject=$(others.obj).parents("ul").find("li[name=formLi]");$(formliObject).length>0&&$(formliObject).each(function(){"true"===$(this).attr("switch")&&($("[id="+$(this).attr("id")+"]").addClass("disabled"),tabCustom.dvfrmlstcontentEntry($(this).attr("id"),!0,!1),$("#dvaddform [keyname=selformId] option[value="+$(this).attr("id")+"]").remove(),$("#formDisable_"+$(this).attr("id")+", #projects_"+$(this).attr("id")).prop("checked",!1))}),$("#tabNameList option[value="+params.tabid+"]").is(":selected")&&$("#formsListingHeader #tabNameList").select2("val",0).trigger("change"),$("#tabNameList option[value="+params.tabid+"], #tabSpecificForms_"+params.tabid).remove(),$("#dvaddform [keyname=tabId] option[value="+params.tabid+"]").addClass("hide"),others.hasOwnProperty("tabName")&&"HRCase"==others.tabName&&$("#zp_askus").remove()}else if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enablesuccessful")),$(others.obj).parents("ul").removeClass("disabled"),ZPeople.isNewZp?(appOperations.dvfrmlstcontentEntry(params.tabid,!1,!0),$(others.obj).attr("checked",!0)):($(others.obj).parents("ul").find("li[id],li[form] input[name=enableDisableSwitch]").each(function(){$(this).parents("li").addClass("disabled"),$(this).parent("div").siblings("a").addClass("disabled"),$(this).attr("checked",!1)}),$(others.obj).parents("ul").find("li a").not(".disabled").length>0&&$("#admin-formslayout-formslist").remove(),tabCustom.dvfrmlstcontentEntry(params.tabid,!1,!0)),$("#dvaddform [keyname=tabId] option[value="+params.tabid+"]").removeClass("hide"),others.hasOwnProperty("tabName")&&"HRCase"==others.tabName){var htmlbutton='<li id="zp_askus"><a class="ZPtitle" title="" data-placement="bottom" href="#hrcase/home"  data-toggle="tooltip"  data-original-title="'+ZPI18N.getString("zp.askaquestion")+'"><span><i class="IC-hrc"></i></span></a></li>';$("#zp_feeds_notifications").length>0&&$(htmlbutton).insertBefore("#zp_feeds_notifications")}tabCustom.sortForms(),Layout.CustomizedUrl.refreshService()}else""!=data.msg.trim()&&(ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0),$(others.obj).attr("checked",!$(obj).is(":checked")))},deleteTab:function(data,params,others){"Success"==data.msg.trim()?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.deletesuccessful")),$("#Tab_"+params.tabid).parent("[name=tabDiv]").remove(),$("#formsCount").show().siblings("#totalForms").hide(),$("#dvaddform [keyname=tabId] option[value="+params.tabid+"]").remove(),appOperations.dvfrmlstcontentEntry(params.tabid,!1,!0),location.reload()):""!=data.msg.trim()&&("systemservice"==data.msg.trim()?setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.systemservicedelete"),"",!0,!0)},500):"extensionservice"==data.msg.trim()?setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.extensionservicenoedit"),"",!0,!0)},500):setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.sorryservererror"),"",!0,!0)},500))},toggleEditMode:function(obj){var serviceLName=$(obj).closest("[name=tabDiv]").attr("tablabel");"Onboarding"===serviceLName?ZPOnboarding.serviceViewPage(!0):ZPUtil.Validation.isEmpty(serviceLName)||ZPUtil.checkIsExistInArray(zpconst.systemServices,serviceLName.toLowerCase())||"Task"===serviceLName||"Reports"===serviceLName||"HRCase"===serviceLName||"LMS"==serviceLName?$(obj).is("input")?$(obj).hide():($(obj).siblings("input").show(),$(obj).siblings("input").trigger("select")):"true"!=is5_0Enabled&&(window.location.href="#"+serviceLName.toLowerCase()+"/generalsettings")},renameTab:function(data,params,others){"Success"==data.msg.trim()?($(others.obj).siblings("span").text(params.tabName),$(others.obj).attr("value",params.tabName),$(others.obj).hide(),$("#dvfrmlstcontent a[href=#dv"+params.tabid+"]").text(params.tabName),$("#zp_hometabs li[tabid="+params.tabid+"] a[href] span").text(params.tabName),$("#formsListingHeader #tabNameList option[value="+params.tabid+"]").text(params.tabName),$("#formsListingHeader #tabNameList").val()==params.tabid&&$("#formsListingHeader #tabNameList").select2(),$("#formsListingHeader #tabSpecificForms_"+params.tabid+" tr td#tabname").text(params.tabName),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),Layout.CustomizedUrl.refreshService()):""!=data.msg.trim()&&($(others.obj).val($(others.obj).siblings("span").text()),ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0))},deleteForm:function(data,params,others){if(data.isLookup){var msg=ZPI18N.getString("zp.referredfieldserror",["form","delete","form"])+" \n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n',$.each(data,function(key,val){"isLookup"!=key&&(msg+="{"+key+" -> "+val+"}\n")}),setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600),$("#textConfirmationPopupBody p").first().addClass("pspace")}else{if(data.isAnRepsConfig){var searchElem=Layout.Page.container;return ZPeople.BSModal.get({id:"reportDeleteAlert",type:3,header:ZPI18N.getString("zp.alert"),closeOnSubmit:!0,removeModalClass:"DelMdl",iconParenClass:"orgbgi",iconClass:"IC-alert",bodyClass:"dvExecutescript",buttonValue:ZPI18N.getString("zp.close"),successCallback:function(){}}),searchElem.find("#reportDeleteAlert .modal-body").html('<div class="row"><div class="col-md-12"><div id="reportDeleteAlertBody" class="dvinfo"><p>'+ZPI18N.getString("zp.reports.removeformfieldsfromreports")+"</p></div></div></div>"),$.each(data.depReps,function(index,depRepObj){searchElem.find("#reportDeleteAlertBody").append("<p>"+(index+1)+". "+ZSEC.Encoder.encodeForHTML(depRepObj.ZPREPORTDISPLAYNAME)+"</p>")}),searchElem.find("#reportDeleteAlert #zp_modal_blubtn").siblings().remove(),void searchElem.find("#reportDeleteAlert").modal("show")}if("Success"==data.msg.trim()){if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.deletesuccessful")),$("#formsListingHeader").length>0&&0==$("tr[id="+params.formid+"]").siblings("tr").length){var id=$("tr[id="+params.formid+"]").parent("[id*=tabSpecificForms_]").attr("id").match(/[\d]+$/).toString();$("#formsListingHeader #tabNameList").val()==id&&($("#formsListingHeader #tabNameList").val(0).trigger("change"),$("#formsListingHeader #tabNameList").select2()),$("[id=tabSpecificForms_"+id+"], #tabNameList option[value="+id+"]").remove()}$('[formid="'+params.formid+'"]').remove(),$("[id$=admin-formslayout-formedit-"+params.formid+"]").remove(),$("[id="+params.formid+"]").remove(),$("#formsCount").show().siblings("#totalForms").hide(),$("#admin-formslayout-formedit-"+params.formId).remove(),$("#dvaddform [keyname=selformId] option[value="+data.formId+"]").remove(),formsListCustom.showHideNoData(),tabCustom.dvfrmlstcontentEntry(params.formid,!0,!1),tabCustom.emptyTabCheck(),tabAndFormsCustom.hasOwnProperty("FormCount")&&++tabAndFormsCustom.FormCount,AppsCustom.hasOwnProperty("appCount")&&++AppsCustom.appCount,AccessControl.Permissions.remove(),ZPTabs.currMainTab==Compensation.CONSTANTS.SERVICENAME&&(Layout.CustomizedUrl.refreshTab(!0),0==Layout.Page.container.find("#serviceView").find("#sfrmList>div").length&&Layout.Page.container.find("#serviceView").find("#sfrmList").html('<div class="ZPNdata" style="align-items: flex-start;"><h5>'+ZPI18N.getString("zp.compensation.noFormData")+"</h5></div>")),others&&"function"==typeof others.callback?others.callback(data,params):Layout.CustomizedUrl.refreshService()}else""!=data.msg.trim()&&setTimeout(function(){ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0)},500)}},enableDisableForm:function(data,params,others){var formName=$(others.obj).parents("li").find("a").text();if(data.isLookup){var msg=ZPI18N.getString("zp.referredfieldserror",["form","disable","form"])+"\n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n',$.each(data,function(key,val){"isLookup"!=key&&"isSuccess"!=key&&(msg+="{"+key+" -> "+val+"}\n")}),ZPeople.confirm(null,"",msg,"",!0,!0),$("#textConfirmationPopupBody p").first().addClass("pspace"),$(others.obj).prop("checked",!0)}else"Success"==data.msg.trim()?(params.hidden?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablesuccessful"),!0),$("[id="+params.formid+"]").addClass("disabled"),tabCustom.dvfrmlstcontentEntry(params.formid,!0,!1),$("#dvaddform [keyname=selformId] option[value="+params.formid+"]").remove(),$("#formDisable_"+params.formid+", #projects_"+params.formid).prop("checked",!1)):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enablesuccessful")),$("[id="+params.formid+"]").removeClass("disabled"),tabCustom.dvfrmlstcontentEntry(params.formid,!0,!0),0!=(parentObj=$(others.obj).parents("[onlyDisable=true]")).length&&$(parentObj).find("[name=forCustom]").remove(),$("tr[id="+params.formid+"]").length<=0&&$("#admin-formslayout-formslist").remove(),$("#dvaddform [keyname=selformId]").append("<option value="+params.formid+">"+formName+"</option>"),$("#formDisable_"+params.formid+", #projects_"+params.formid).prop("checked",!0)),ZPTabs.currMainTab==Compensation.CONSTANTS.SERVICENAME&&Layout.CustomizedUrl.refreshTab(!0),"function"==typeof others.successCallback?others.successCallback(data,others,params):Layout.CustomizedUrl.refreshService()):"Denied"==data.msg.trim()&&"P_EmployeeHealthData"==data.tableName?(ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.disablehealthformwarningmsg")),$("[id="+params.formid+"]").removeClass("disabled"),tabCustom.dvfrmlstcontentEntry(params.formid,!0,!0),0!=(parentObj=$(others.obj).parents("[onlyDisable=true]")).length&&$(parentObj).find("[name=forCustom]").remove(),$("tr[id="+params.formid+"]").length<=0&&$("#admin-formslayout-formslist").remove(),$("#dvaddform [keyname=selformId]").append("<option value="+params.formid+">"+formName+"</option>"),$("#formDisable_"+params.formid+", #projects_"+params.formid).prop("checked",!0)):""!=data.msg.trim()&&(ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0),$(others.obj).prop("checked",!$(others.obj).is(":checked")))},tabNumberUpdate:function(){let cnt=1,colDiv=$("#accordion").find("#tabsPageDiv [name=tabColumn]"),length1=$(colDiv).first().find("[name=static],[name=tabDiv]").length,length2=$(colDiv).last().find("[name=static],[name=tabDiv]").length,referehCount=(colDiv,length)=>{$(colDiv).find("[name=static],[name=tabDiv]").each(function(index,item){0!=index&&index>length?cnt+=1:0!=index&&(cnt+=2),$(item).find("span[name=countNum]").text(cnt)})};referehCount($(colDiv).first(),length2),cnt=2,referehCount($(colDiv).last(),length1-1)},dvfrmlstcontentEntry:function(id,isform,isadd){if(isadd){if(isform){var tabid=$("#accordion").length>0?$("#accordion li#"+id).parent("ul").attr("id").match(/[\d]+$/).toString():$("#formsListingHeader tr#"+id).length>0?$("#formsListingHeader tr#"+id).parent("tbody").attr("id").match(/[\d]+$/).toString():"";if($("#dvfrmlstcontent").find("div#dv"+tabid).length>0){var formname=$("#accordion").find("li#"+id+" a").text();$("#dvfrmlstcontent").find("div#dv"+tabid+" ul").append(jQuery("<li></li>").append(jQuery("<a></a>",{href:"#admin/formslayout/formedit-"+id,text:formname})))}else $("body").find("#dvfrmlstcontent").remove()}else $("ul#Tab_"+id+" li[id]").not(".disabled").length>0&&$("body").find("#dvfrmlstcontent").remove();"function"==typeof ZPTabs.refresh&&ZPTabs.refresh(),ZPUtil.Form_Link_Names.reload()}else{var tabindex=isform?$("#zp_subtab_"+id).parents("[tabid]").index():$("#zp_maintab_"+id).index();if(isform){var formEntry=$("#dvfrmlstcontent").find('a[href="#admin/formslayout/formedit-'+id+'"]').parent("li");1==$(formEntry).parent("ul").find("li").length?(tabdvId=$(formEntry).parents("[tabid]").attr("id"),$("#dvfrmlstcontent").find("a[href=#"+tabdvId+"]").parent("li").remove(),$(formEntry).parents("div#"+tabdvId).remove()):$(formEntry).remove();var formindex=$("#zp_subtab_"+id).index();if($("#zp_hometabs li[id*="+id+"]").siblings("li").length>0){var hrefTag=$("#zp_hometabs li[id*="+id+"]").parents("[id*=zp_maintab_]").find("a");$(hrefTag).attr("href")==$("#zp_hometabs li[id*="+id+"] a[href]").attr("href")&&$(hrefTag).attr("href",$("#zp_hometabs li[id*="+id+"]").siblings("li").first().find("a").attr("href")),$("#zp_hometabs li[id*="+id+"]").hasClass("active")&&(Layout.Page.prevHomeAdminUrl=$("#zp_hometabs li[id*="+id+"]").siblings("li").first().find("a").attr("href"),$("#zp_hometabs li[id*="+id+"]").siblings("li").first().addClass("active")),null!=ZPTabs.JSON&&delete ZPTabs.JSON[tabindex].formArr[formindex],$("#zp_hometabs li[id*="+id+"]").remove()}else $("#zp_hometabs li[id*="+id+"]").hasClass("active")&&(Layout.Page.prevHomeAdminUrl="#home/feeds",$("#zp_maintab_home").addClass("active")),$("#zp_hometabs li[id*="+id+"]").parents("[id*=zp_maintab_]").remove(),null!=ZPTabs.JSON&&delete ZPTabs.JSON[tabindex];$("#zp-contwrap-form-listview #form-listview-formId-"+id).remove(),delete ZPView.LIST_VIEW_PARAMS[id+""]}else $("#dvfrmlstcontent").find("a[href=#dv"+id+"]").parent("li").remove(),$("#dvfrmlstcontent").find("div#dv"+id).remove(),$("#zp_hometabs [id*=zp_maintab_"+id+"] ul li").each(function(){var fid=$(this).attr("id").match(/[\d]+$/).toString();$("#page-wrapper #form-listview-formId-"+fid).remove(),delete ZPView.LIST_VIEW_PARAMS[fid+""],$("#zp_hometabs li[id*="+fid+"]").hasClass("active")&&(Layout.Page.prevHomeAdminUrl="#home/feeds",$("#zp_maintab_home").addClass("active"))}),$("#zp_hometabs [id*=zp_maintab_"+id+"]").remove()}},showHideAddFormFields:function(obj,id){var showHideDiv=$(obj).parents("[name=addFormFields]").siblings("#"+id);$(obj).is(":checked")?$(showHideDiv).fadeIn():$(showHideDiv).fadeOut()},toggleFormType:function(obj){var type=$(obj).val(),parentDiv=$(obj).closest("#dvaddform");parentDiv.find("#selectForm,#chooseFileForAddForm").hide(),"template"==type?parentDiv.find("#selectForm").show():"import"==type&&parentDiv.find("#chooseFileForAddForm").show()},toggleNewTab:function(obj){"add"==$(obj).attr("id")?($(obj).parents("[name=addFormFields]").children("div").not("#newTab").hide(),$(obj).parents("[name=addFormFields]").children("div#newTab").show()):($(obj).parents("[name=addFormFields]").children("div").not("#newTab").show(),$(obj).parents("[name=addFormFields]").children("div#newTab").hide())},tabOperations:function(obj,operation){errorFunction.removeErrorSpan(Layout.Page.container,"[for=formname]"),errorFunction.removeErrorSpan($("[id=addFormSlider]"),"[for=formname]",!0);var otherDtls={obj:obj},url="/tabOperations.zp",params={},callbackFn="";if(params.method=operation[0],"custOperations"==operation[0]){if(params.operation=operation[1],"checkTabNameDuplicate"==operation[1]){var tabName=$(obj).val().trim();params.tabName=tabName,callbackFn=tabCustom.checkTabNameDuplicate,tabAndFormsCustom.forSaveForm.isChange=!0}else if(params.tabid=$(obj).parents("ul").attr("id").match(/[\d]+$/).toString(),"showhidetab"==operation[1])params.hidden=!$(obj).is(":checked"),otherDtls.tabName=$(obj).closest("[tablabel]").attr("tablabel"),callbackFn=tabCustom.enableDisableTab;else if("renameTab"==operation[1]){tabName=$(obj).val().trim();var results=[],excludeName=$(obj).siblings("span").text();if(tabName.toLowerCase()==excludeName.toLowerCase())return void $(obj).val($(obj).siblings("span").text());if((results=$.grep(ZPServices.SERVICE_JSON,function(ele){return decodeHTML(ele.dispName.toLowerCase())==tabName.toLowerCase()})).length>0||""==tabName||tabName.length>50){var errorMsg="zp.servicenameduplicateerror";return""==tabName?errorMsg="zp.servicenamenotemptyerror":tabName.length>50&&(errorMsg="zp.servicenamelengthmax"),ZPeople.confirm(null,"",errorMsg,"",!0,!1),void $(obj).val($(obj).siblings("span").text())}params.tabName=tabName,callbackFn=tabCustom.renameTab,otherDtls.obj=obj}}else if("addTab"==operation[0]){$(obj).parents("#newTabPopup").find("[buttonname=done]").addClass("disabled");let tabNameInput=$(obj).parents("#newTabPopup").find("[elem=tabName]"),tabDescInput=$(obj).parents("#newTabPopup").find("[elem=tabDesc]"),tabName=tabNameInput.val().trim(),tabDesc=tabDescInput.val().trim();results=[];results=$.grep(ZPServices.SERVICE_JSON,function(ele){return decodeHTML(ele.dispName.toLowerCase())==tabName.toLowerCase()});var errorDiv=$(obj).parents("#newTabPopup").find("#bodyTag input").parent();errorMsg="";if((results.length>0||""==tabName||tabName.length>50)&&(errorMsg=ZPI18N.getString("zp.servicenameduplicateerror"),""==tabName?errorMsg=ZPI18N.getString("zp.servicenamenotemptyerror"):tabName.length>50&&(errorMsg=ZPI18N.getString("zp.servicenamelengthmax")),errorFunction.errorSpanAttach(errorMsg,tabNameInput.parent())),(""==tabDesc||tabDesc.length>250)&&(""==tabDesc?errorMsg=ZPI18N.getString("zp.servicedesc"):tabDesc.length>250&&(errorMsg=ZPI18N.getString("zp.desclength")),errorFunction.errorSpanAttach(errorMsg,tabDescInput.parent())),""!=errorMsg)return void $(obj).parents("#newTabPopup").find("[buttonname=done]").removeClass("disabled");$(obj).parents("#newTabPopup").find("[buttonname=done]").addClass("disabled"),params.tabName=tabName,params.tabDesc=tabDesc,params.fromaddform=!1,otherDtls.obj=errorDiv,callbackFn=tabCustom.createTab}else if("deleteTab"==operation[0]){var ulDiv=$(obj).parents("ul"),formsLi=$(ulDiv).find("li[name=formLi]");if(iserror=!0,0!=formsLi.length)return void ZPeople.confirm(null,"","zp.emptyservicedeleteerror","",!0);params.tabid=$(obj).parents("ul").attr("id").match(/[\d]+$/).toString(),otherDtls.obj=ulDiv,tabCustom.param=[url,params,tabCustom.deleteTab,otherDtls];var deleteMsg=ZPI18N.getString("zp.deletemessage",["tab"]),serviceObj=(tabName=$(obj).closest("[tablabel]").attr("tablabel"),ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",tabName,!0));return deleteMsg=ZPI18N.getString("zp.deletemessage",[ZPI18N.getString("zp.service")]),!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))&&void 0!=serviceObj&&serviceObj.enable_hrcase&&(deleteMsg=ZPI18N.getString("zp.delserviceconfirm")),void ZPeople.confirm(null,"",deleteMsg,tabCustom.deleteRequest,!1,!0)}ZPeople.Request.send(url,params,callbackFn,otherDtls,formCustom.failureCallBack)},checkTabNameDuplicate:function(resultData,params,others){tabAndFormsCustom.forSaveForm.isChange=!1,"true"==resultData.msg.trim()&&(errorFunction.errorSpanAttach(ZPI18N.getString("zp.servicenameduplicateerror"),$(others.obj).parent("div"),!1,!0),$(others.obj).parents("[errorDiv=cantbeempty]").attr("test","newTab"),$(others.obj).parents("[errorDiv=cantbeempty]").find(".red").attr("test","newTab")),$(others.obj).attr("isDup",resultData.msg.trim()),tabAndFormsCustom.forSaveForm.isClick&&tabCustom.saveForm($(others.obj).parents("#dvaddform").find("[buttonname=done]")),tabAndFormsCustom.forSaveForm.isClick=!1},deleteRequest:function(){ZPeople.Request.send(tabCustom.param[0],tabCustom.param[1],tabCustom.param[2],tabCustom.param[3]),tabCustom.param=[]},saveSuccess:function(data,params,others){if("Success"==data.msg.trim()){if($(others.obj).modal("hide"),data.hasOwnProperty("formId")){if(AppsCustom.hasOwnProperty("appCount")&&--AppsCustom.appCount,"function"==typeof others.successCallback)others.successCallback(data,others);else{window.location.href="#admin/formslayout/formedit-"+data.formId;var formDtls=[{isHidden:!1,isCustom:!0,formId:data.formId,formName:data.formName}];if(data.hasOwnProperty("tabId")){var len=parseInt($("#tabsPageDiv [name=tabColumn] [name=tabDiv]").length)+1,tabDtls={tabDisplayName:data.tabDisplayName,tabName:data.tabName,tabId:data.tabId,formDetailsMap:formDtls,isLink:!1},switchInfo={isSwitch:!0,switchId:"showhide_"+data.tabId,isHidden:!1,isCustom:!0,deletemethod:"tabCustom.tabOperations(this,['deleteTab'])",enablemethod:"tabCustom.tabOperations(this,['custOperations','showhidetab'])",title:ZPI18N.getString("zp.deleteservice"),name:""},last=$("#accordion").find("#tabsPageDiv [name=tabDiv] span:contains("+len+")").last();last=$(last).parents("[name=tabDiv]"),$(last).parents("[name=tabColumn]").siblings("[name=tabColumn]").append(tabAndFormsCustom.tabsPageConstruction.tabDiv(len+1,tabDtls,switchInfo)),Layout.CustomizedUrl.refreshService()}else tabAndFormsCustom.tabsPageConstruction.formsListConstruction(formDtls,$("#accordion").find("ul#Tab_"+params.tabId));if(AccessControl.Permissions.remove(),tabCustom.sortForms(),tabCustom.emptyTabCheck(),$("#dvaddform [keyname=selformId]").append("<option value="+data.formId+">"+data.formName+"</option>"),data.hasOwnProperty("tabId")&&$("#dvaddform [keyname=tabId]").append("<option value="+data.tabId+">"+data.tabDisplayName+"</option>"),$("#tabNameList option[value="+params.tabId+"]").length<=0)$("#admin-formslayout-formslist").remove();else{var formsList=formsListCustom.formsListPageConstruction.SINGLEFORMTEMPLATE;formsList=(formsList=(formsList=(formsList=(formsList=formsList.replace(/\$DISABLECLASS\$/g,"")).replace(/\$FORMLINK\$/g,data.formId)).replace(/\$FORMNAME\$/g,data.formName)).replace(/\$TABNAME\$/g,$("#formsListingHeader #tabSpecificForms_"+params.tabId).find("[id=tabname]").html())).replace(/\$FORMID\$/g,data.formId);var enableDisableTemplate="";enableDisableTemplate=(enableDisableTemplate=(enableDisableTemplate=formsListCustom.formsListPageConstruction.ENABLEDISABLETEMPLATE).replace(/\$CHECKED\$/g,"checked")).replace(/\$FORMID\$/g,data.formId),formsList=(formsList=formsList.replace(/\$ENABLEDISABLEICON\$/g,enableDisableTemplate)).replace(/\$RULECONFIGURE\$/g,'<a class="btn btn-default btnfrmconfig" onclick="ZPFRules.addRule(\''+data.formId+"')\">"+ZPI18N.getString("zp.configure")+"</a>");var deleteDiv='<a class="IC-delete ML20" buttonname="delete" onclick="'+tabAndFormsCustom.formDeleteMethod+'"></a>';formsList=formsList.replace(/\$DELETEICON\$/g,deleteDiv),$("#tabSpecificForms_"+params.tabId).append(formsList),$("#formsCount").show().siblings("#totalForms").hide()}tabAndFormsCustom.hasOwnProperty("FormCount")&&--tabAndFormsCustom.FormCount,tabCustom.dvfrmlstcontentEntry(data.formId,!0,!0),ZPServices.addFormInService([{pcId:data.formId,dispName:data.formName,label:data.labelName,viewId:data.viewId}],!0,void 0,void 0,data.serviceId),Layout.CustomizedUrl.refreshTab()}void 0!=others.otherActions&&"function"==typeof others.otherActions&&others.otherActions()}}else(data.hasOwnProperty("error")||""!=data.msg.trim())&&(ZPeople.Message.showFailureMsg(data.msg.trim()),$("#dvaddform [buttonname=done]").removeClass("disabled"))},addNewForm:function(obj,fromTab,optns){var tabid=null;$("#addFormSlider");fromTab&&($(obj).parents("ul").length>0?tabid=$(obj).parents("ul").attr("id").match(/[\d]+$/).toString():0!=$("#formsListingHeader:visible #tabNameList").val()&&(tabid=$("#formsListingHeader:visible #tabNameList").val())),optns||(optns={tabshow:!0},null!=tabid&&(optns.tabid=tabid)),AppsCustom.addNewApp(obj,optns)}},formsListCustom={url:"/getFormsListing.zp",init:function(){$("#formsListingHeader:visible #zp_page_loading").show(),ZPeople.Request.send(formsListCustom.url,{method:"formsListPage"},formsListCustom.getformsListPage,"")},getformsListPage:function(resultData){resultData.hasOwnProperty("tabFormDetails")?(resultData=resultData.tabFormDetails,$("#formsListingHeader:visible #zp_page_loading").remove(),$("#formsListingHeader:visible").append(formsListCustom.formsListPageConstruction.Construct(resultData)),$("#formsListingHeader #tabNameList").off(),$("#formsListingHeader #tabNameList").on("change",function(){$("#tabSpecificForms_"+$(this).val()).show().siblings("[id*=tabSpecificForms_]").hide(),0==$(this).val()&&$("[id*=tabSpecificForms_]").show(),$("#formsCount").show().siblings("#totalForms").hide()}),formCustom.minimiseTab(!1)):""!=resultData.msg.trim()&&ZPeople.Message.showFailureMsg(resultData.msg.trim())}};formsListCustom.formsListPageConstruction={initConstants:function(){this.FORMSLISTTEMPLATE='<div class="ZPTscrlcont"><table id="appendFormsBody" class="table table-hover table-responsive tblfrmlst"><thead><tr><th width="20" class=""></th><th width="30%"><span>'+ZPI18N.getString("zp.formname")+'</span></th><th width="20%"><span>'+ZPI18N.getString("zp.hrservicename")+"</span></th><th><span>"+ZPI18N.getString("zp.status")+"</span></th><th><span>"+ZPI18N.getString("zp.rule")+'</span></th><th width="15%"><span></span></th></tr></thead></table></div>',this.SINGLEFORMTEMPLATE='<tr $DISABLECLASS$ name="formLi" id="$FORMID$" onlydisable="$ISONLYDISABLE$"><td></td><td><div><a href="#admin/formslayout/formedit-$FORMLINK$" class="ulnk" >$FORMNAME$</a></div></td><td id="tabname">$TABNAME$</td><td>$ENABLEDISABLEICON$</td><td>$RULECONFIGURE$</td><td>$DELETEICON$</td></tr>',this.SINGLEFORMWITHOUTCUSTOMTEMPLATE='<tr $DISABLECLASS$ name="formLi" id="$FORMID$" onlydisable="$ISONLYDISABLE$"><td></td><td><div>$FORMNAME$</div></td><td id="tabname">$TABNAME$</td><td>$ENABLEDISABLEICON$</td><td></td><td>$DELETEICON$</td></tr>',this.ENABLEDISABLETEMPLATE='<div class="btnactive" name="forCustom"><input id="formDisable_$FORMID$" $CHECKED$ class="cmn-toggle-small cmn-toggle-round-small" type="checkbox" onclick="'+tabAndFormsCustom.formEnableMethod+'"><label for="formDisable_$FORMID$" class="M0"></label></div>'}},formsListCustom.formsListPageConstruction.Construct=function(resultData){var formsListOuter=formsListCustom.formsListPageConstruction.FORMSLISTTEMPLATE;return formsListOuter=$(formsListOuter),$.each(resultData,function(tabIndex,tabValue){if(!tabValue.isHidden&&tabValue.formDetailsMap.length>0){var formsList="";$.each(tabValue.formDetailsMap,function(formIndex,formValue){if((!ZPeople.isDeptDesgRestricted||"P_Department"!=formValue.componentName&&"P_Designation"!=formValue.componentName)&&!formValue.isExtensionForm){$.inArray(formValue.tablename,["P_VaccinationStatus"])>=0?formsList+=formsListCustom.formsListPageConstruction.SINGLEFORMWITHOUTCUSTOMTEMPLATE:formsList+=formsListCustom.formsListPageConstruction.SINGLEFORMTEMPLATE;var checked="",disableClass='class = "disabled"';0==formValue.isHidden&&(checked="checked",disableClass=""),formsList=(formsList=(formsList=(formsList=(formsList=formsList.replace(/\$DISABLECLASS\$/g,disableClass)).replace(/\$FORMLINK\$/g,formValue.formId)).replace(/\$FORMNAME\$/g,formValue.formName)).replace(/\$TABNAME\$/g,tabValue.tabDisplayName)).replace(/\$FORMID\$/g,formValue.formId);var enableDisableTemplate="";isPlatformOrg&&!formValue.isCustom||((!formValue.hasOwnProperty("tablename")||$.inArray(formValue.tablename,["P_Employee","P_EmployeeLeave","P_ClientDetails","P_TimesheetJobsList","P_TimesheetJob","P_Timesheet","P_EmployeeJobs","P_Goals","P_SelfAppraisal","P_PerformanceAppraisal","P_Workplace_Readiness"])<0)&&$.inArray(formValue.componentName,["P_AppraiseeList"])<0?enableDisableTemplate=(enableDisableTemplate=(enableDisableTemplate=formsListCustom.formsListPageConstruction.ENABLEDISABLETEMPLATE).replace(/\$CHECKED\$/g,checked)).replace(/\$FORMID\$/g,formValue.formId):$.inArray(formValue.tablename,["P_EmployeeLeave"])>=0&&1==formValue.isHidden&&(enableDisableTemplate=(enableDisableTemplate=(enableDisableTemplate=formsListCustom.formsListPageConstruction.ENABLEDISABLETEMPLATE).replace(/\$CHECKED\$/g,checked)).replace(/\$FORMID\$/g,formValue.formId),formsList=formsList.replace(/\$ISONLYDISABLE\$/g,!0)),$.inArray(formValue.tablename,["P_EmployeeHealthData","P_Workplace_Readiness","P_Visitor"])>=0&&(formsList=formsList.replace(/\$RULECONFIGURE\$/g,""))),formsList=(formsList=(formsList=formsList.replace(/\$ISONLYDISABLE\$/g,!1)).replace(/\$ENABLEDISABLEICON\$/g,enableDisableTemplate)).replace(/\$RULECONFIGURE\$/g,'<a class="btn btn-default btnfrmconfig" onclick="ZPFRules.addRule(\''+formValue.formId+"')\">"+ZPI18N.getString("zp.configure")+"</a>");var deleteDiv=formValue.isCustom?'<a class="IC-delete ML20" buttonname="delete" onclick="'+tabAndFormsCustom.formDeleteMethod+'"></a>':"";formsList=formsList.replace(/\$DELETEICON\$/g,deleteDiv)}}),(formsList=$(formsList)).length>0&&($("#formsListingHeader #tabNameList").append('<option value="'+tabValue.tabId+'">'+tabValue.tabDisplayName+"</option>"),formsListOuter.find("#appendFormsBody").append(jQuery("<tbody></tbody>",{id:"tabSpecificForms_"+tabValue.tabId}).append(formsList)))}}),formsListCustom.showHideNoData(formsListOuter),formsListOuter},formsListCustom.showHideNoData=function(formsListOuter){let formsCont=formsListOuter?formsListOuter.find("#appendFormsBody"):Layout.Page.container.find("#appendFormsBody");formsCont.length>0&&(0==formsCont.find("tr[name=formLi]").length?formsCont.parent().append('<i elem="formListEmptyDivCont">'+ZPUtil.newNoDataHTML("CR-nodata",8,ZPI18N.getString("zp.noformsavailable"),"","","")+"</i>"):formsCont.siblings("[elem=formListEmptyDivCont]").remove())},formsListCustom.formsListCount=function(obj){var count=$("#appendFormsBody tr[name=formLi]:visible").length;$(obj).hide(),$(obj).siblings("#totalForms").text(count).show()};