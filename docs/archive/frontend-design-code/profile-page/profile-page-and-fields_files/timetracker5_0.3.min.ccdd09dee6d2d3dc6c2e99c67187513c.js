Timetracker.genSettings={init:function(){Timetracker.initSetup(),Timetracker.genSettings.initComponents()},initComponents:function(){var currentPage=settingsUrlProps.niceUrlArr[settingsUrlProps.niceUrlArr.length-1];["timetracker","timelogs","timesheets","jobscheduling","additionaloptions"].includes(currentPage)&&Timetracker.generalSettings.getSyncTimesheetSettings(),"timetracker"!==currentPage&&"timelogs"!==currentPage||Timetracker.setWorkitemCache()},permissionCheck:function(container){return!!Timetracker.isSettingsAdmin()||((container=container||settingsPage.container).html("<div class='zpl_rgtcnt'></div>"),Timetracker.Util.showHideNoData({div:container,msg:ZPI18N.getString("zp.notallowed")}),!1)},updateCache:function(response){response&&response.hasOwnProperty("refreshWorkItem")?Timetracker.generalSettings.settingDetails.refreshWorkItem=response.refreshWorkItem:Timetracker.generalSettings.settingDetails=response},addCheckBxEventLsnr:function(pageContainer){(pageContainer=pageContainer||settingsPage.container).find("div[name='hierarchyChk']").find("input[type=checkbox]").off("click").on("click",function(){$(this).prop("checked")?$(this).parent().prevAll().find("input:not(:disabled)").prop("checked",!0):$(this).parent().nextAll().find("input:not(:disabled)").prop("checked",!1)})},addEventListner:function(Id,eventType,callBack,rmPrevLsnr){var layout=Id?settingsPage.container.find("#"+Id):settingsPage.container;rmPrevLsnr?layout.off().on(eventType,callBack):layout.on(eventType,callBack)},addEvntLsnrforChange:function(callBack,pageContainer){(pageContainer=pageContainer||settingsPage.container).find("input:text").length>0&&pageContainer.find("input:text").off("keyup",void 0,callBack).on("keyup",callBack),pageContainer.find("input:not(:text)").length>0&&pageContainer.find("input:not(:text)").off("change",void 0,callBack).on("change",callBack),pageContainer.find(".PI_delete").length>0&&pageContainer.find(".PI_delete").off("click",void 0,callBack).on("click",callBack),pageContainer.find("select").length>0&&pageContainer.find("select").off("zselectchange",void 0,callBack).on("zselectchange",callBack),pageContainer.find("z-toggleswitch").length>0&&pageContainer.find("z-toggleswitch").off("ztoggleswitchchange",void 0,callBack).on("ztoggleswitchchange",callBack)},loadingTextChange:function(compDiv,running){var loadingDiv=(compDiv?$(compDiv).closest(".zpl_crd"):settingsPage.container).find("#loadingId");1==running?(loadingDiv.find(".zpl_atocnt").removeClass("svd"),loadingDiv.find("#textspan").html(ZPI18N.getString("zp.saving"))):(loadingDiv.find(".zpl_atocnt").addClass("svd"),loadingDiv.find("#textspan").html(ZPI18N.getString("zp.saved")))},showHideSaveReset:function(compDiv,type){type=type||TimelySettings.SHOWNOTHING;var pageContainer=compDiv?$(compDiv).closest(".zpl_crd"):settingsPage.container;type===TimelySettings.SHOWSAVING||type===TimelySettings.SHOWSAVED?(Timetracker.genSettings.loadingTextChange(compDiv,type===TimelySettings.SHOWSAVING),pageContainer.find("#loadingId").show(),pageContainer.find("#saveResetId").hide(),type===TimelySettings.SHOWSAVED&&pageContainer.find("#loadingId").fadeOut(1500)):type===TimelySettings.SHOWSAVERESET?(pageContainer.find("#saveResetId").show(),pageContainer.find("#loadingId").hide()):type===TimelySettings.SHOWNOTHING&&pageContainer.find("#loadingId,#saveResetId").hide()},addSaveResetButton:function(clickResetFn,clickSaveFn,part){return'<div id="saveResetId"  style="display: none;"><button type="button" id="resetBt" class="zlabel zlabel--outline zlabel--medium" onclick='+clickResetFn+">"+ZPI18N.getString("zp.reset")+'</button><button type="button" id="saveBt" class="zlabel zlabel--blue zlabel--medium" onclick='+clickSaveFn+">"+ZPI18N.getString("zp.save")+'</button></div><div id="loadingId" class="zpl_atosv" style="display: none;"><div class="zpl_atocnt"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i><span id="textspan">'+ZPI18N.getString("zp.saving")+"</span></div></div>"},removeTopButton:function(pageContainer){pageContainer.find("#topSettMenu").remove()},isHtmlConstructed:function(pageContainer){return(pageContainer=pageContainer||settingsPage.container).html()&&0!==pageContainer.html().length},addTablFxdCls:function(pageContainer){(pageContainer=pageContainer||settingsPage.container).addClass("zpl_tblfxd")},scrollToFirstErr:function(pageContainer){let errDiv=(pageContainer=pageContainer||settingsPage.container).find(".ztextbox--error__label:first");errDiv.length&&errDiv[0].scrollIntoView({behavior:"smooth",block:"center"})},getHeaderBandHtml:function(details){return`<div class="zpl_crd ${details.headerExtraClass||""}"><div class="zpl_crdhdr"><div>\n\t\t\t\t\t\t\t<h4>${details.header}</h4>\n\t\t\t\t\t\t\t<p>${details.description}</p>\n\t\t\t\t\t</div></div></div>`},isPageDataChanged:function(leftTabChange){if(settingsPage.container.find("#saveResetId").is(":visible")){var infoAlertMessage=new InfoAlertMessage;infoAlertMessage.title="",infoAlertMessage.despcription=ZPI18N.getString("zp.cancelconfmsg"),infoAlertMessage.yesButtonText=ZPI18N.getString("zp.proceed"),infoAlertMessage.callback=function(obj){leftTabChange()},infoAlertMessage.show()}else leftTabChange()}},Timetracker.timeLogSettings={init:function(){Timetracker.genSettings.init();var pageContainer=settingsPage.container;Timetracker.genSettings.removeTopButton(pageContainer),Timetracker.genSettings.permissionCheck()&&(Timetracker.timeLogSettings.constructHtml(),Timetracker.timeLogSettings.intializeEventListeners(),Timetracker.timeLogSettings.setData(Timetracker.generalSettings.settingDetails),Timetracker.timeLogSettings.intializeEventListeners(!0),TimelyZComp.toolTip.intiliaze())},intializeEventListeners:function(post){post?Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timeLogSettings.showHideSaveResetbn):(Timetracker.genSettings.addCheckBxEventLsnr(),settingsPage.container.find("input[name=restrictmaxloghours]").on("click",function(){let value=Timetracker.generalSettings.getMaxLogHoursRestrictType();value="0"!==value?value:"1",Timetracker.timeLogSettings.getMaxLogHours("settings-service-timetracker-timelogs",$(this).is(":checked")?value:"0",Timetracker.generalSettings.settingDetails)}),settingsPage.container.find("#tls_pastlog").off("click").on("click",function(){Timetracker.timeLogSettings.showHidePastDays("settings-service-timetracker-timelogs",$(this).is(":checked"),Timetracker.generalSettings.settingDetails)}),settingsPage.container.find("#tls_timeentryoverlap_allow, #tls_timeentryoverlap_restrict").off("change").on("change",function(){Timetracker.timeLogSettings.showHideTLOverlapWarning(this,Timetracker.generalSettings.settingDetails)}))},constructHtml:function(){if(!Timetracker.genSettings.isHtmlConstructed()){var html=Timetracker.genSettings.getHeaderBandHtml({header:ZPI18N.getString("zp.timelogs"),description:ZPI18N.getString("zp.tt.timelogsettings.topbandtext")});html+=Timetracker.timeLogSettings.getBasicTimelogsHtml(),html+=Timetracker.timeLogSettings.getRestPermHtml(),html+=Timetracker.timeLogSettings.getTimelogCustPreferenceHtml(),settingsPage.container.html(html)}},getBasicTimelogsHtml:function(){var html="";return html+='<div class="zpl_rgtcnt"><div class="zpl_crd" cardId="tls_timelogTypeCard"><div class="zpl_crdhdr" ><div><h4>'+ZPI18N.getString("zp.tt.timelogsettings.basictimelogsettings")+"</h4><p>"+ZPI18N.getString("zp.tt.timelogsettings.basictimelogsettingsdesc")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.timeLogSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.timeLogSettings.updateData(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h4>'+ZPI18N.getString("zp.tt.timelogsettings.timecanbeloggedby",[""])+'</h4></div><div id="tls_logtype"><div class="zcheckbox"><input id="tls_timestamp_manual" type="checkbox" name="timelogType"  class="zcheckbox__helper" checked=""><label for="tls_timestamp_manual" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.totalhours")+'</label></div><div class="zcheckbox"><input id="tls_timestamp_fromtolog" type="checkbox" name="timelogType" class="zcheckbox__helper"><label for="tls_timestamp_fromtolog" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.startandendtime")+'</label></div><div class="zcheckbox"><input id="tls_timestamp_automatic" type="checkbox" name="timelogType" class="zcheckbox__helper"><label for="tls_timestamp_automatic" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.Timer")+'</label></div></div></div><div class="zpl_secn"><div class="zpl_info"><ul><li>'+ZPI18N.getString("zp.tt.timelogsettings.link1",["#settings/service/timetracker/reminders"])+"</li><li>"+ZPI18N.getString("zp.tt.timelogsettings.link2",["#settings/service/timetracker/iprestriction","#settings/service/timetracker/georestriction"])+"</li></ul></div></div></div></div>"},getRestPermHtml(){var html="";return html+='<div class="zpl_crd" cardId="tls_restPermCard"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.leavetype.v2.restrictions")+"</h4><p>"+ZPI18N.getString("zp.tt.timelogsettings.restlabel")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.timeLogSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.timeLogSettings.updateData(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.tt.timelogsettings.donotallowtimelogsfor",[""])+'</h5></div><div><div class="zcheckbox"><input id="tls_futurelog" type="checkbox"  class="zcheckbox__helper" checked=""><label for="tls_futurelog" class="zcheckbox__label">'+ZPI18N.getString("zp.restrictFutureLog")+'</label></div><div class="zcheckbox"><input id="tls_pastlog" type="checkbox"  class="zcheckbox__helper" checked=""><label for="tls_pastlog" class="zcheckbox__label">'+ZPI18N.getString("zp.restrictPastLog")+'</label></div><div class="zpl_gbox"  id="tls_pastlogdaysdiv"><div class="zpl_idiv"><div class="zradiobutton zradiobutton--horizontal w100"><input id="tls_pastlog_alldays" type="radio" name="pastlogdays" class="zradiobutton__helper" checked="" value="0"><label for="tls_pastlog_alldays"class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.alldays")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input type="radio" id="tls_pastlog_pastdays" name="pastlogdays" class="zradiobutton__helper" value="1"><label for="tls_pastlog_pastdays"  class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.before")+'</span> </label></div><input type="text" class="ztextbox w60 is-disabled" value="2" id="tls_pastlog_pastdaysvalue" placeholder="e.g. 2" disabled> <em>'+ZPI18N.getString("zp.leavetype.smalldays")+'</em></div></div><div class="zcheckbox"><input id="tls_include_weekend" type="checkbox"   class="zcheckbox__helper"><label for="tls_include_weekend" class="zcheckbox__label"> '+ZPI18N.getString("zp.weekend(s)")+'</label></div><div class="zcheckbox"><input id="tls_include_holiday" type="checkbox"   class="zcheckbox__helper"><label for="tls_include_holiday" class="zcheckbox__label">'+holiday_disName+'</label></div><div class="zcheckbox"><input id="tls_include_unpaid" type="checkbox"   class="zcheckbox__helper"><label for="tls_include_unpaid" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.unpaidleave")+'</label></div><div class="zcheckbox"><input id="tls_include_paid" type="checkbox"  class="zcheckbox__helper"><label for="tls_include_paid" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.paidleave")+" / "+ZPI18N.getString("zp.tt.compensatoryoff")+'</label></div></div></div><div class="zpl_secn"><div> <h5>'+ZPI18N.getString("zp.tt.timeentryoverlapis",[""])+'</h5> </div><div class="zpl_idiv zradiobutton" id="timeentryoverlap"><div class="zradiobutton zradiobutton--horizontal"><input id="tls_timeentryoverlap_allow" type="radio" value="0" name="timeentryoverlap" class="zradiobutton__helper"><label for="tls_timeentryoverlap_allow" class="zradiobutton__label"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.allow")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tls_timeentryoverlap_restrict" type="radio" value="2" name="timeentryoverlap" class="zradiobutton__helper"><label for="tls_timeentryoverlap_restrict" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.restricted")+'</span></label></div></div><div id="tls_timeentryoverlap_warndiv" class="zpl_gbox"><div class="zcheckbox zcheckbox--horizontal"><input id="tls_timeentryoverlap_warn" type="checkbox" name="check"  class="zcheckbox__helper" checked=""><label for="tls_timeentryoverlap_warn" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.allowedwarningmsg")+'</label></div></div></div><div id="tls_maxloghrs" class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tls_maxloghrs_none" type="checkbox" name="restrictmaxloghours" value="0" class="zcheckbox__helper"><label for="tls_maxloghrs_none" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.restrictmaxloghrs",["#settings/service/timetracker/overtimepolicy"])+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timesheetsettings.restrictmaxloghrsdesc")+'</span></div><div class="zpl_tbox" id="tls_maxBillableLogHoursDiv"></div></div><div class="zpl_secn"><div><div class="chkdectxt"><div class="zcheckbox"><input id="tls_estimated_hours" type="checkbox" name="estimatedHoursRestriction" class="zcheckbox__helper"><label for="tls_estimated_hours" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogesthours")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogesthoursdesc")+'</span></div></div></div><div class="zpl_secn"><div><div class="chkdectxt"><div class="zcheckbox"><input id="tls_24_hours_rest" type="checkbox" name="24HoursRestriction" class="zcheckbox__helper"><label for="tls_24_hours_rest" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogsto24hours")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogsto24hoursdesc")+'</span></div></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tls_att_timelog" type="checkbox" class="zcheckbox__helper" onclick="Timetracker.timeLogSettings.disableTimeLogsinAttHrs(this,true);" ><label for="tls_att_timelog" class="zcheckbox__label">'+ZPI18N.getString("zp.attHourslimittimelog")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogattdesc")+"</span></div></div>",Timetracker.generalSettings.isTimerAttCheckInConfigured()&&(html+='<div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tls_att_timer_checkin" type="checkbox" class="zcheckbox__helper" onclick="Timetracker.timeLogSettings.disableTimeLogsinAttHrs(this,true);" ><label for="tls_att_timer_checkin" class="zcheckbox__label">'+ZPI18N.getString("zp.attcheckinlimittimer")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogattdesc")+"</span></div></div>"),html+='<div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tls_zeroHours_timelog" type="checkbox"  checked="" class="zcheckbox__helper"><label for="tls_zeroHours_timelog" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.restricttimelogsnoduration")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogzerodesc")+'</span></div></div><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.restricttljobdates",[""])+'</h5></div><div><div class="zcheckbox"><input id="tls_timelogdate" type="checkbox"  class="zcheckbox__helper" checked=""><label for="tls_timelogdate" class="zcheckbox__label small_case singluar_name" id="span_tldate"></label></div><div class="zcheckbox"><input id="tls_presentdate" type="checkbox" class="zcheckbox__helper"><label for="tls_presentdate" class="zcheckbox__label small_case singluar_name" id="span_presentdate"></label></div></div><div class="zpl_info" id="restrictjobdesc"></div></div></div></div><div class="zpl_crd" cardId="tls_PermissionsCard"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.permissions")+"</h4><p>"+ZPI18N.getString("zp.tt.timelogsettings.timelogpermissionsdesc")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.timeLogSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.timeLogSettings.updateData(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.tt.timelogsettings.timereditedby",[""])+'</h5></div><div name="hierarchyChk"><div class="zcheckbox zcheckbox--horizontal"><input id="tls_timereditmanager" type="checkbox" name="timeredit"  class="zcheckbox__helper" checked=""><label for="tls_timereditmanager" class="zcheckbox__label">'+ZPI18N.getString("zp.srepman")+'</label></div><div class="zcheckbox zcheckbox--horizontal"><input id="tls_timereditself" type="checkbox" name="timeredit"  class="zcheckbox__helper" checked=""><label for="tls_timereditself" class="zcheckbox__label">'+ZPI18N.getString("zp.local.employeesself")+"</label></div></div></div></div></div>"},getTimelogCustPreferenceHtml:function(){var html="";return html+='<div class="zpl_crd" cardId="tls_timelogCustCard"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.tt.timelogfields")+"</h4><p>"+ZPI18N.getString("zp.tt.timelogsettings.timelogcustdesc")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.timeLogSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.timeLogSettings.updateData(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_tblres"><table class="zpl_tbl zpl_tblcntr tt_clog"><thead><tr><th width="300">'+ZPI18N.getString("zp.fields")+'</th><th width="100">'+ZPI18N.getString("zp.show")+'</th><th width="100">'+ZPI18N.getString("zp.lms.mandatory")+'</th></tr></thead><tbody><tr><td class="form_clientname"><span>'+ZPI18N.getString("zp.tt.clientname")+'</span></td><td><div class="zcheckbox" ><input id="tls_clientname_show" type="checkbox"  name="client_show" onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'show\')" class="zcheckbox__helper" checked=""><label class="zcheckbox__label" for="tls_clientname_show"></label></div></td><td><div class="zcheckbox" ><input id="tls_clientname_mand" type="checkbox"  name="client_mand" onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'mand\')" class="zcheckbox__helper" checked=""><label class="zcheckbox__label"  for="tls_clientname_mand"></label></div></td></tr><tr><td class="form_projectname"><span>'+ZPI18N.getString("zp.tt.projectname")+'</span></td><td><div class="zcheckbox" > <input id="tls_projectname_show" type="checkbox"   name="project_show" onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'show\')" class="zcheckbox__helper" checked=""><label class="zcheckbox__label" for="tls_projectname_show"></label></div></td><td><div class="zcheckbox"  ><input id="tls_projectname_mand" type="checkbox"  name="project_mand" onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'mand\')" class="zcheckbox__helper"><label class="zcheckbox__label" for="tls_projectname_mand"></label></div></td></tr><tr><td class="form_jobname"><span>'+ZPI18N.getString("zp.tt.jobname")+'</span></td><td><div class="zcheckbox" title="'+ZPI18N.getString("zp.local.systemmandatory")+'"><input id="tls_jobname_show" type="checkbox"  name="job_show" class="zcheckbox__helper" disabled="" checked="checked"><label class="zcheckbox__label" for="tls_jobname_show"></label></div></td><td><div class="zcheckbox" title="'+ZPI18N.getString("zp.local.systemmandatory")+'"><input id="tls_jobname_mand" type="checkbox"  name="job_mand" class="zcheckbox__helper" disabled=""  checked="checked"><label class="zcheckbox__label" for="tls_jobname_mand"></label></div></td></tr><tr><td><div id="tls_workItemMain_div" class="d-flexC d-flexclmcap5"><span id="workitem_name">'+ZPI18N.getString("zp.workitem")+'</span><div class="zpl_hvr zpl_hvrsw"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" onclick="Timetracker.timeLogSettings.showHideInputDiv(this,true,\'workitem\');"></i></div></div><div class="d-flexC d-flexclmcap5" id="tls_workItemEdit_div"><input type="text" id="workitem_name_editval" class="ztextbox" name="workitem" nvalue="Work Items"><div class="zpl_hvr zpl_hvrsw"> <i class="PI_tick grn" title="'+ZPI18N.getString("zp.save")+'" name="workitem" onclick="Timetracker.timeLogSettings.updateDataCustTimelogInp(this)"></i><i class="PI_cls red" title="'+ZPI18N.getString("zp.cancel")+'" onclick="Timetracker.timeLogSettings.showHideInputDiv(this,false,\'workitem\');"></i></div></div></td><td><div class="zcheckbox"><input type="checkbox" id="tls_workitemname_show" name="workitem_show" onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'show\')"  class="zcheckbox__helper"><label class="zcheckbox__label" for="tls_workitemname_show"></label></div></td><td><div class="zcheckbox"><input type="checkbox" id="tls_workitemname_mand" name="workitem_mand" onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'mand\')"  class="zcheckbox__helper"><label class="zcheckbox__label" for="tls_workitemname_mand"></label></div></td></tr><tr><td><span>'+ZPI18N.getString("zp.tt.schedlersettings.billablestatus")+'</span></td><td><div class="zcheckbox"><input type="checkbox" id="tls_billablename_show" name="billablename_show"  class="zcheckbox__helper"  onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'show\')" checked="checked"><label class="zcheckbox__label" for="tls_billablename_show"></label></div><td><div class="zcheckbox" title="'+ZPI18N.getString("zp.local.systemmandatory")+'"><input type="checkbox" id="tls_billablename_mand" disabled="" name="billablename_mand" class="zcheckbox__helper"  checked="checked"><label class="zcheckbox__label"></label></div></td></tr><tr><td><div id="tls_descMain_div" class="d-flexC d-flexclmcap5"><span id="desc_name">'+ZPI18N.getString("zp.description")+'</span><div class="zpl_hvr zpl_hvrsw"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" onclick="Timetracker.timeLogSettings.showHideInputDiv(this,true,\'description\');"></i></div></div><div class="d-flexC d-flexclmcap5" id="tls_descEdit_div"><input type="text" id="desc_name_editval" class="ztextbox" name="description" value="Description"><div class="zpl_hvr zpl_hvrsw"> <i class="PI_tick grn" title="'+ZPI18N.getString("zp.save")+'" name="description" onclick="Timetracker.timeLogSettings.updateDataCustTimelogInp(this)"></i><i class="PI_cls red" title="'+ZPI18N.getString("zp.cancel")+'" onclick="Timetracker.timeLogSettings.showHideInputDiv(this,false,\'description\');"></i></div></div></td><td><div class="zcheckbox" ><input type="checkbox" id="tls_descname_show" name="description_show"  onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'show\')" class="zcheckbox__helper" checked=""><label class="zcheckbox__label" for="tls_descname_show"></label></div></td><td><div class="zcheckbox" ><input type="checkbox" id="tls_descname_mand" name="description_mand"  onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'mand\')" class="zcheckbox__helper"><label class="zcheckbox__label" for="tls_descname_mand"></label></div></td></tr><tr><td><span>'+ZPI18N.getString("zp.hourslog")+'</span></td><td><div class="zcheckbox" title="'+ZPI18N.getString("zp.local.systemmandatory")+'"><input type="checkbox" id="tls_hoursname_show" name="hours_show" class="zcheckbox__helper" disabled checked="checked"><label class="zcheckbox__label"></label></div></td><td><div class="zcheckbox" title="'+ZPI18N.getString("zp.local.systemmandatory")+'"><input type="checkbox" id="tls_hoursname_mand" name="hours_mand" disabled class="zcheckbox__helper"  checked="checked"><label class="zcheckbox__label"></label></div></td></tr><tr><td><div id="tls_attachMain_div" class="d-flexC d-flexclmcap5"><span id="attach_name">'+ZPI18N.getString("zp.attachment")+'</span><div class="zpl_hvr zpl_hvrsw"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" onclick="Timetracker.timeLogSettings.showHideInputDiv(this,true,\'attachment\');"></i></div></div><div class="d-flexC d-flexclmcap5" id="tls_attachEdit_div"><input type="text" id="attach_name_editval" class="ztextbox" name="attachment" value="Attachment"><div class="zpl_hvr zpl_hvrsw"> <i class="PI_tick grn" title="'+ZPI18N.getString("zp.save")+'" name="attachment" onclick="Timetracker.timeLogSettings.updateDataCustTimelogInp(this)"></i><i class="PI_cls red" title="'+ZPI18N.getString("zp.cancel")+'" onclick="Timetracker.timeLogSettings.showHideInputDiv(this,false,\'attachment\');"></i></div></div></td><td><div class="zcheckbox"><input type="checkbox" id="tls_attachname_show" name="attachment_show"  onchange="Timetracker.timeLogSettings.changeShowMandSetting(this,\'show\')" class="zcheckbox__helper" checked=""><label class="zcheckbox__label" for="tls_attachname_show"></label></div></td><td><div class="zcheckbox" title="'+ZPI18N.getString("zp.tt.entitynotmandat",[ZPI18N.getString("zp.attachment")])+'" id="attachment_mndt"><input type="checkbox" class="zcheckbox__helper" disabled><label class="zcheckbox__label"></label></div></td></tr></tbody></table></div></div></div></div><div class="zpl_crd" cardId="tls_PreferencesCard"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.gtpreferences")+"</h4><p>"+ZPI18N.getString("zp.tt.timelogsettings.preferencesdesc")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.timeLogSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.timeLogSettings.updateData(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.defaulttimelogbillingstatus")+"</h5><p>"+ZPI18N.getString("zp.tt.timelogsettings.billingstatusdesc")+'</p></div><div id="tus_billingStatus_div"><div class="zradiobutton zradiobutton--horizontal"><input id="tls_billingstatus" type="radio" name="billingStatusType" class="zradiobutton__helper" value="0"><label class="zradiobutton__label" for="tls_billingstatus"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.billable")+' </span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tls_nonbillingstatus" type="radio" name="billingStatusType" class="zradiobutton__helper" value="1"><label class="zradiobutton__label" for="tls_nonbillingstatus"><span class="zradiobutton__text">'+ZPI18N.getString("zp.nonbillable")+'</span></label></div></div></div><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.tt.timelogsettings.timelogview")+"</h5><p>"+ZPI18N.getString("zp.tt.timelogsettings.timelogviewdesc")+'</p></div><div id="timelogviewtype"><div class="zradiobutton zradiobutton--horizontal"><input id="tls_dailyview" type="radio" name="timelogviewtype" value="0" class="zradiobutton__helper" checked=""><label class="zradiobutton__label" for="tls_dailyview"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.tt.timelogsettings.dayview")+' </span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tls_weeklyview" type="radio" name="timelogviewtype" value="1" class="zradiobutton__helper"><label class="zradiobutton__label" for="tls_weeklyview" ><span class="zradiobutton__text">'+ZPI18N.getString("zp.tt.timelogsettings.weekview")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tls_monthlyview" type="radio" name="timelogviewtype" value="2" class="zradiobutton__helper"><label class="zradiobutton__label" for="tls_monthlyview" ><span class="zradiobutton__text">'+ZPI18N.getString("zp.tt.timelogsettings.monthview")+'</span></label></div></div></div><div class="zpl_secn"><div><div class="chkdectxt"><div class="zcheckbox"><input id="tls_showtimeloglocation" type="checkbox"  checked="" class="zcheckbox__helper"><label for="tls_showtimeloglocation" class="zcheckbox__label"> '+ZPI18N.getString("zp.tt.timelogsettings.tracktimeloglocation")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.timeloglocationdesc")+'</span></div></div></div></div></div></div><div class="zpl_crd" cardId="tls_workItemsCard"><div class="zpl_crdhdr"><div><h4 id="defWorkitem"></h4><p></p></div>'+Timetracker.genSettings.addSaveResetButton("Timetracker.timeLogSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.timeLogSettings.updateData(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><div><div class="zpl_gbox mxhgt" id="workitems_body"></div></div></div></div></div></div>'},setData:function(data,cardDiv,pageContainer){pageContainer=pageContainer||settingsPage.container;var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");Timetracker.util.removeErrorMsg(void 0,pageContainer),(null!==data&&data.hasOwnProperty("refreshWorkItem")||!cardDivId||"tls_workItemsCard"===cardDivId)&&(Timetracker.timeLogSettings.workItems.initWorkitems(data.refreshWorkItem,{showCommonWorkitems:!0}),delete data.refreshWorkItem),cardDivId&&"tls_workItemsCard"!==cardDivId||(Timetracker.generalSettings.deletedWorkitems=""),void 0!==data.TS_defaultbillingType&&(Timetracker.util.defaultbillingType=Timetracker.generalSettings.getDefaultBillableStatus()),cardDivId&&"tls_timelogTypeCard"!==cardDivId||(pageContainer.find("#tls_timestamp_automatic").prop("checked","true"===data.TS_automaticLog),pageContainer.find("#tls_timestamp_fromtolog").prop("checked","true"===data.TS_fromToTimeLog),pageContainer.find("#tls_timestamp_manual").prop("checked","true"===data.TS_manualLog),Timetracker.timeLogSettings.disableTimeLogsinAttHrs());var dateNameJson=Timetracker.util.getStartAndEnddateDisplayName(!0),sdatename=dateNameJson.sdatename,edatename=dateNameJson.edatename;cardDivId&&"tls_restPermCard"!==cardDivId||(pageContainer.find("#tls_estimated_hours").prop("checked","1"===data.TS_estimatedHoursRestriction),pageContainer.find("#tls_24_hours_rest").prop("checked","1"===data.TS_restrict24hrsLogPerDay),pageContainer.find("#tls_maxloghrs").find("input[value="+(void 0!==data.TS_maxLogHoursRestriction?data.TS_maxLogHoursRestriction:"0")+"]").prop("checked",!0),Timetracker.timeLogSettings.getMaxLogHours(pageContainer.attr("id"),data.TS_maxLogHoursRestriction,data,pageContainer),pageContainer.find("input[name=maxloghours]").off("change").on("change",function(){Timetracker.timeLogSettings.getMaxLogHours(pageContainer.attr("id"),$(this).val(),data)}),Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timeLogSettings.showHideSaveResetbn,pageContainer.find("#tls_maxBillableLogHoursDiv")),Timetracker.generalSettings.isTimerAttCheckInConfigured()?pageContainer.find("#tls_att_timer_checkin").prop("checked","1"===data.TS_attTimerEntryRestrection):pageContainer.find("#tls_att_timer_checkin").closest("div.zpl_secn").remove(),pageContainer.find("#span_presentdate").html(ZPI18N.getString("zp.tlrestrictjoboptions",[ZPI18N.getString("zp.thepresentdate"),Timetracker.util.getJobDisplayName(void 0,!0),sdatename,edatename])),pageContainer.find("#span_tldate").html(ZPI18N.getString("zp.tlrestrictjoboptions",[ZPI18N.getString("zp.tldate"),Timetracker.util.getJobDisplayName(void 0,!0),sdatename,edatename])),pageContainer.find("#tls_pastlog").prop("checked","1"===data.TS_pastLogRestriction),Timetracker.timeLogSettings.showHidePastDays(pageContainer.attr("id"),"1"===data.TS_pastLogRestriction,data),pageContainer.find("#tls_futurelog").prop("checked","1"===data.TS_futureLogRestriction),pageContainer.find("#tls_include_holiday").prop("checked","1"===data.TS_holidayLogRestriction),pageContainer.find("#tls_include_weekend").prop("checked","1"===data.TS_weekendLogRestriction),pageContainer.find("#tls_include_unpaid").prop("checked","1"===data.TS_unpaidLeaveTLRestriction),pageContainer.find("#tls_include_paid").prop("checked","1"===data.TS_paidLeaveTLRestriction),pageContainer.find("#tls_att_timelog").prop("checked","1"===data.TS_attendanceHrsLogRestrict),Timetracker.timeLogSettings.disableTimeLogsinAttHrs(),pageContainer.find("#tls_zeroHours_timelog").prop("checked","1"===data.TS_zeroHoursRestriction),pageContainer.find("#tls_timelogdate").prop("checked","1"===data.TS_timelogDateWithinJobPerid),pageContainer.find("#tls_presentdate").prop("checked","1"===data.TS_presentDateWithinJobPerid),"1"==data.TS_timeEntriesOverlap?(pageContainer.find("#tls_timeentryoverlap_warn").prop("checked",!0),pageContainer.find("#timeentryoverlap").find("input[value=0]").prop("checked",!0)):(pageContainer.find("#tls_timeentryoverlap_warn").prop("checked",!1),pageContainer.find("#timeentryoverlap").find("input[value="+(void 0!==data.TS_timeEntriesOverlap?data.TS_timeEntriesOverlap:"0")+"]").prop("checked",!0)),"1"==data.TS_timeEntriesOverlap||"0"==data.TS_timeEntriesOverlap?pageContainer.find("#tls_timeentryoverlap_warndiv").show():pageContainer.find("#tls_timeentryoverlap_warndiv").hide()),cardDivId&&"tls_PermissionsCard"!==cardDivId||(pageContainer.find("#tls_timereditmanager,#tls_timereditself").prop("checked",!1),"1"===data.TS_timerEdit?pageContainer.find("#tls_timereditmanager").prop("checked",!0):"0"===data.TS_timerEdit&&pageContainer.find("#tls_timereditmanager,#tls_timereditself").prop("checked",!0)),cardDivId&&"tls_timelogCustCard"!==cardDivId||Timetracker.timeLogSettings.setCustSettingData(pageContainer,data,cardDiv),cardDivId&&"tls_PreferencesCard"!==cardDivId||(pageContainer.find("#"+("0"===data.TS_defaultbillingType?"tls_billingstatus":"tls_nonbillingstatus")).prop("checked",!0),pageContainer.find("[cardId=tls_PreferencesCard]").find('input[name="timelogviewtype"][value='+(void 0!==data.TS_DefaultView?data.TS_DefaultView:"0")+"]").prop("checked",!0),pageContainer.find("#tls_showtimeloglocation").prop("checked",!data.TS_showTimelogLocation||"1"===data.TS_showTimelogLocation));var helpUrl=Timetracker.generalSettings.constructHelpUrl("timesheet-settings.html#ts1job");let workitem_Dispname=ZPeople.decodeTxt(Timetracker.util.getWorkItemDispName(!1,!0)),job_Dispname=ZPeople.decodeTxt(Timetracker.util.getJobDisplayName(!0,!0));pageContainer.find("#restrictjobdesc").html(ZPI18N.getString("zp.settingNoteJobPeriod",[sdatename,edatename,Timetracker.util.getJobDisplayName(),helpUrl])),pageContainer.find("#defWorkitem").text(ZPI18N.getString("zp.defaultworkitem",[ZPeople.decodeTxt(Timetracker.util.getWorkItemDispName(void 0,!0))])),pageContainer.find("#defWorkitem").siblings("p").text(ZPI18N.getString("zp.tt.timelogsettings.workitemsdesc",[job_Dispname,workitem_Dispname,workitem_Dispname,workitem_Dispname])),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING)},updateData:function(cardDiv){var params={mode:"updateTimetrackerSettings",conreqcsr:csrfToken,subMode:Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS};if(null!=(params=Timetracker.timeLogSettings.getParamsForUpdateSettings(params,Timetracker.generalSettings.settingDetails,cardDiv))&&(params.fetchUpdatedSetings=!0),null!=params){if(params.isError||params.hasOwnProperty("errMsg"))return;Timetracker.util.removeErrorMsg(void 0,$(cardDiv).closest(".zpl_crd")),!1===params.automaticLog||!1===params.fromToTimeLog||"0"==params.timeentryOverlap||"1"==params.timeentryOverlap?Timetracker.timeLogSettings.confirmDisablingPushToAttendance(params,cardDiv):Timetracker.timeLogSettings.sendRequest(params,cardDiv)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"))},updateDataCustTimelogInp:function(cardDiv){Timetracker.util.removeErrorMsg(void 0,$(cardDiv).closest("tr"));let name=$(cardDiv).attr("name");var params={mode:"updateTimetrackerSettings",conreqcsr:csrfToken,subMode:Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS};(params=Timetracker.timeLogSettings.gettlcustTimelogInFldDispParams(params,name)).hasOwnProperty("isError")||(Timetracker.timeLogSettings.isSettingValueChanged(params,Timetracker.generalSettings.settingDetails,cardDiv)?ZPeople.Request.send(Timetracker.constants.URL,params,function(response){null!=params&&(params.fetchUpdatedSetings=!0),Timetracker.genSettings.updateCache(response),Timetracker.timeLogSettings.setCustSettingData(settingsPage.container,response,cardDiv),Timetracker.util.showAlert(2,ZPI18N.getString("zp.advan.selsavesuccess"))},{},Timetracker.Util.generalFailureCallback):Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")))},sendRequest:function(params,cardDiv){Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVING),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){0!==response.res?(Timetracker.genSettings.updateCache(response),Timetracker.timeLogSettings.setData(Timetracker.generalSettings.settingDetails,cardDiv),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVED)):response.message&&response.label?settingsPage.container.find("[label='"+response.label+"']").append('<span class="ztextbox--error__label">'+response.message+"</span>"):Timetracker.util.showAlert(0,response.message?response.message:ZPI18N.getString("zp.ttfailuremsg"))},{},Timetracker.Util.generalFailureCallback)},getParamsForUpdateSettings:function(params,data,cardDiv,pageContainer){pageContainer=pageContainer||$(cardDiv).closest(".zpl_crd");var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");switch(Timetracker.util.removeErrorMsg(void 0,pageContainer),cardDivId){case"tls_timelogTypeCard":if(params.automaticLog=!!pageContainer.find("#tls_timestamp_automatic").is(":checked"),params.fromToTimeLog=!!pageContainer.find("#tls_timestamp_fromtolog").is(":checked"),params.manualLog=!!pageContainer.find("#tls_timestamp_manual").is(":checked"),Timetracker.generalSettings.isPushTimerToAttendanceEnabled()&&!params.automaticLog&&(params.attendanceInteg="0"),Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled()&&!params.fromToTimeLog&&(params.attendanceIntegStartEnd="0"),Timetracker.generalSettings.isTimerAttCheckInRestrict()&&!params.automaticLog&&(params.attTimerRestriction="0"),!Timetracker.timeLogSettings.isFmFieldEvnt&&!(params.manualLog||params.fromToTimeLog||params.automaticLog))return Timetracker.Util.mandOptnErrMsg("tls_logtype",pageContainer);break;case"tls_restPermCard":if(params.estimatedHoursRestriction=pageContainer.find("#tls_estimated_hours").is(":checked")?"1":"0",params.restrict24HrsLog=pageContainer.find("#tls_24_hours_rest").is(":checked")?"1":"0",params.futureLog=pageContainer.find("#tls_futurelog").is(":checked")?"1":"0",params.isWeekendLogRestricted=pageContainer.find("#tls_include_weekend").is(":checked")?"1":"0",params.isHolidayLogRestricted=pageContainer.find("#tls_include_holiday").is(":checked")?"1":"0",params.isUnpaidLogRestricted=pageContainer.find("#tls_include_unpaid").is(":checked")?"1":"0",params.isPaidLogRestricted=pageContainer.find("#tls_include_paid").is(":checked")?"1":"0",params.attendanceTimelog=pageContainer.find("#tls_att_timelog").is(":checked")?"1":"0",params.zeroHoursTimelog=pageContainer.find("#tls_zeroHours_timelog").is(":checked")?"1":"0",params.tlrestrictTimelogDate=pageContainer.find("#tls_timelogdate").is(":checked")?"1":"0",params.tlrestrictPresentDate=pageContainer.find("#tls_presentdate").is(":checked")?"1":"0",params.timeentryOverlap=pageContainer.find("input[type='radio'][name='timeentryoverlap']:checked").val(),"0"===params.timeentryOverlap&&pageContainer.find("#tls_timeentryoverlap_warn").is(":checked")&&(params.timeentryOverlap="1"),"0"!==params.timeentryOverlap&&"1"!==params.timeentryOverlap||(params.attendanceIntegStartEnd="0"),Timetracker.generalSettings.isTimerAttCheckInConfigured()&&(params.attTimerRestriction=pageContainer.find("#tls_att_timer_checkin").is(":checked")?"1":"0"),(params=Timetracker.timeLogSettings.getParamsForPastLogs(params,pageContainer)).hasOwnProperty("isError"))return params;if((params=Timetracker.timeLogSettings.getParamsForMaxLogHours(params,pageContainer,{})).hasOwnProperty("isError"))return params;break;case"tls_PermissionsCard":params.timeredit="2",pageContainer.find("#tls_timereditself").is(":checked")?params.timeredit="0":pageContainer.find("#tls_timereditmanager").is(":checked")&&(params.timeredit="1");break;case"tls_timelogCustCard":if(null==(params=Timetracker.timeLogSettings.gettlcustSettingParams(params)))return{isError:!0};break;case"tls_PreferencesCard":params.defaultbillingType=pageContainer.find("input[type='radio'][name='billingStatusType']:checked").val(),params.defaultview=pageContainer.find("input[type='radio'][name='timelogviewtype']:checked").val(),params.showTimelogLocation=pageContainer.find("#tls_showtimeloglocation").is(":checked")?"1":"0";break;case"tls_workItemsCard":if((params=Timetracker.timeLogSettings.workItems.updateWorkitemParams(params)).hasOwnProperty("errMsg"))return params}return Timetracker.timeLogSettings.isSettingValueChanged(params,data,cardDiv)?params:null},getParamsForPastLogs:function(params,pageContainer){params.pastLog="0";var divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)?"tls":"tus";if(!0===pageContainer.find("#"+divId+"_pastlog").is(":checked")){params.pastLog="1",params.pastLogAllowDays="0";var pastLogDiv=pageContainer.find("#"+divId+"_pastlogdaysdiv");if(selected=pastLogDiv.find("input[type='radio'][name='pastlogdays']:checked").val(),"1"===selected){var allowDays=pastLogDiv.find("#"+divId+"_pastlog_pastdaysvalue").val().trim();if(!Timetracker.timeLogSettings.isFmFieldEvnt&&(ZPUtil.Validation.isEmpty(allowDays)||!ZPUtil.Validation.isNumber(allowDays)||allowDays<=0||allowDays>365))return pastLogDiv.find("#"+divId+"_pastlog_pastdaysvalue").addClass("ztextbox__error"),Timetracker.Util.appenErrorMsgForElem({obj:pastLogDiv,msg:ZPI18N.getString("zp.entervalinrange",[1,365]),appendTo:pastLogDiv.closest(".zpl_gbox")}),{isError:!0};params.pastLogAllowDays=allowDays}}return params},getParamsForMaxLogHours:function(params,pageContainer,extraDtls){extraDtls=extraDtls||{};var divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)?"tls":"tus",selected=pageContainer.find("input[type='radio'][name='maxloghours']:checked"),isChecked=pageContainer.find("#"+divId+"_maxloghrs_none").is(":checked");if(selected.length>0&&isChecked){let isError=!1;params.maxLogHoursRestriction=selected.val();let value=pageContainer.find("#"+divId+"_max_hrs_val").val();if(params.hoursperday=params.hoursperweek=0,"1"===params.maxLogHoursRestriction||"2"===params.maxLogHoursRestriction){let regexForValidation="2"===params.maxLogHoursRestriction?Timetracker.util.maxWeekHrsRegex:Timetracker.util.maxhrsRegex;Timetracker.timeLogSettings.isFmFieldEvnt||value.match(regexForValidation)||(Timetracker.Util.appenErrorMsgForElem({obj:pageContainer.find("#"+divId+"_max_hrs_val"),msg:ZPI18N.getString("zp.invalidinput"),appendTo:pageContainer.find("#"+divId+"_max_hrs_val").closest(".zpl_gbox")}),isError=!0);let maxBillableHrsPerDay,maxBillableHrsPerWeek,billMax=pageContainer.find("#"+divId+"_maxloghrs_bill").is(":checked"),nbillMax=pageContainer.find("#"+divId+"_maxloghrs_nonbill").is(":checked");if(billMax||nbillMax){let val=0;billMax&&(val=1),nbillMax&&(val=2),billMax&&nbillMax&&(val=3),params.maxLogHoursRestrictionTLType=val}else Timetracker.Util.appenErrorMsgForElem({obj:pageContainer.find("#"+divId+"_maxloghrs_bill"),msg:ZPI18N.getString("zp.maperror",[ZPI18N.getString("zp.billablestatus")]),appendTo:pageContainer.find("#"+divId+"_max_hrs_val").closest(".zpl_gbox")}),isError=!0;"1"===(Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)?params.restrict24HrsLog:Timetracker.generalSettings.is24HoursTimelogRestrictionEnabled())?(maxBillableHrsPerDay=1440,maxBillableHrsPerWeek=10080):(maxBillableHrsPerDay=Timetracker.constants.MAX_LOGHRS_PERDAY,maxBillableHrsPerWeek=Timetracker.constants.MAX_LOGHRS_PERWEEK);let logHrs=Timetracker.DateTime.convertToMins(value),isErr=!1;"1"===params.maxLogHoursRestriction?isErr=logHrs>maxBillableHrsPerDay:"2"===params.maxLogHoursRestriction&&(isErr=logHrs>maxBillableHrsPerWeek),params.maxLogHoursRestrictionHours=value,!Timetracker.timeLogSettings.isFmFieldEvnt&&isErr&&(pageContainer.find("#"+divId+"_max_hrs_val,#"+divId+"_singlepayot_val,#"+divId+"_doublepayot_val").addClass("ztextbox__error"),Timetracker.Util.appenErrorMsgForElem({obj:pageContainer.find("#"+divId+"_max_hrs_val"),msg:ZPI18N.getString("zp.maxhrserror",[Timetracker.Hours.convertMinsToHrs(maxBillableHrsPerDay,0),Timetracker.Hours.convertMinsToHrs(maxBillableHrsPerWeek,0)]),appendTo:pageContainer.find("#"+divId+"_max_hrs_val").closest(".zpl_gbox")}),isError=!0),value=void 0===value?0:value}if(isError)return{isError:!0}}else params.maxLogHoursRestriction="0",params.hoursperday=params.hoursperweek=0;return params},gettlcustTimelogInFldDispParams:function(params,name){const pageContainer=settingsPage.container;var tlCustJson={};if("workitem"===name){let workitemInpDom=pageContainer.find("#workitem_name_editval"),workitemInp=workitemInpDom.val(),tlSettDtls={tlFieldType:"text",errorClass:"zp-err-msg",tlValue:workitemInp,fldDispName:Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM),skipMandCheck:!0,fldLength:250,allowEmptyCheck:!0,fromTimlogSettCust:!0},res=Timetracker.timelogs.util.createErrorTextInputFields(tlSettDtls,!1);Timetracker.timeLogSettings.isFmFieldEvnt||"valid"===res?tlCustJson.tlc_workitem_name=workitemInp:(workitemInpDom.find("#error_message").remove(),Timetracker.Util.appenErrorMsgForElem({obj:workitemInpDom,msg:res,appendTo:workitemInpDom.closest("td")}),params.hasFieldError=!0)}if("description"===name){let descInpDom=pageContainer.find("#desc_name_editval"),descInp=descInpDom.val();fldDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC),tlSettDtls={tlFieldType:"text",tlValue:descInp,errorClass:"zp-err-msg",fldDispName:fldDispName,skipMandCheck:!0,fldLength:250,allowEmptyCheck:!0},res=Timetracker.timelogs.util.createErrorTextInputFields(tlSettDtls,!1),Timetracker.timeLogSettings.isFmFieldEvnt||"valid"===res?tlCustJson.tlc_desc_name=descInp:(descInpDom.find("#error_message").remove(),Timetracker.Util.appenErrorMsgForElem({obj:descInpDom,msg:res,appendTo:descInpDom.closest("td")}),params.hasFieldError=!0)}if("attachment"===name){let attachInpDom=pageContainer.find("#attach_name_editval"),attachInp=attachInpDom.val();fldDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.ATTACHMENT),tlSettDtls={tlFieldType:"text",tlValue:attachInp,errorClass:"zp-err-msg",fldDispName:fldDispName,skipMandCheck:!0,fldLength:250,allowEmptyCheck:!0},res=Timetracker.timelogs.util.createErrorTextInputFields(tlSettDtls,!1),Timetracker.timeLogSettings.isFmFieldEvnt||"valid"===res?tlCustJson.tlc_attachment_name=attachInp:(attachInpDom.find("#error_message").remove(),Timetracker.Util.appenErrorMsgForElem({obj:attachInpDom,msg:res,appendTo:attachInpDom.closest("td")}),params.hasFieldError=!0)}return params.hasOwnProperty("hasFieldError")?{isError:!0}:(params.tlCustParams=JSON.stringify(tlCustJson),params)},gettlcustSettingParams:function(params){const pageContainer=settingsPage.container;var tlCustJson={};return tlCustJson.tlc_clients=!0===pageContainer.find("#tls_clientname_show").is(":checked")?"1":"0",tlCustJson.tlc_projects=!0===pageContainer.find("#tls_projectname_show").is(":checked")?"1":"0",tlCustJson.tlc_workitems=!0===pageContainer.find("#tls_workitemname_show").is(":checked")?"1":"0",tlCustJson.tlc_desc=!0===pageContainer.find("#tls_descname_show").is(":checked")?"1":"0",tlCustJson.tlc_desc_mand=!0===pageContainer.find("#tls_descname_mand").is(":checked")?"1":"0",tlCustJson.tlc_billableSt=!0===pageContainer.find("#tls_billablename_show").is(":checked")?"1":"0",tlCustJson.tlc_client_mand=!0===pageContainer.find("#tls_clientname_mand").is(":checked")?"1":"0",tlCustJson.tlc_project_mand=!0===pageContainer.find("#tls_projectname_mand").is(":checked")?"1":"0",tlCustJson.tlc_workitem_mand=!0===pageContainer.find("#tls_workitemname_mand").is(":checked")?"1":"0",tlCustJson.tlc_attachment=!0===pageContainer.find("#tls_attachname_show").is(":checked")?"1":"0",params.tlCustParams=JSON.stringify(tlCustJson),params},isSettingValueChanged:function(params,data,cardDiv){var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");if(null==params)return!1;switch(cardDivId){case"tls_timelogTypeCard":if(data.TS_manualLog!==String(params.manualLog)||data.TS_fromToTimeLog!==String(params.fromToTimeLog)||data.TS_automaticLog!==String(params.automaticLog))return!0;break;case"tls_restPermCard":if(params.maxLogHoursRestriction&&"0"!==params.maxLogHoursRestriction&&data.TS_maxLogHoursRestriction===params.maxLogHoursRestriction){let value=params.maxLogHoursRestrictionHours;if(""+Timetracker.DateTime.convertToMins(value)!=data.TS_maxLogHoursRestriction_Hours||params.maxLogHoursRestrictionTLType!=data.TS_maxLogHoursRestriction_TLType)return!0}if(params.allowOT===data.TS_allowOT&&(void 0!==params.singlepayhours&&data.TS_singlePayHours!==""+Timetracker.DateTime.convertToMins(params.singlepayhours)||void 0!==params.doublepayhours&&data.TS_doublePayHours!==""+Timetracker.DateTime.convertToMins(params.doublepayhours)))return!0;if(data.TS_maxLogHoursRestriction!==params.maxLogHoursRestriction||data.TS_estimatedHoursRestriction!==params.estimatedHoursRestriction||data.TS_restrict24hrsLogPerDay!==params.restrict24HrsLog||data.TS_pastLogRestriction!==params.pastLog||void 0!==params.pastLogAllowDays&&data.TS_pastLogAllowDays!==params.pastLogAllowDays||data.TS_futureLogRestriction!==params.futureLog||data.TS_weekendLogRestriction!==params.isWeekendLogRestricted||data.TS_holidayLogRestriction!==params.isHolidayLogRestricted||data.TS_paidLeaveTLRestriction!==params.isPaidLogRestricted||data.TS_unpaidLeaveTLRestriction!==params.isUnpaidLogRestricted||data.TS_attendanceHrsLogRestrict!==params.attendanceTimelog||data.TS_zeroHoursRestriction!==params.zeroHoursTimelog||data.TS_presentDateWithinJobPerid!==params.tlrestrictPresentDate||data.TS_timelogDateWithinJobPerid!==params.tlrestrictTimelogDate||void 0!==params.timeentryOverlap&&data.TS_timeEntriesOverlap!==params.timeentryOverlap||void 0!==params.attTimerRestriction&&data.TS_attTimerEntryRestrection!==params.attTimerRestriction)return!0;break;case"tls_PermissionsCard":return data.TS_timerEdit!==params.timeredit;case"tls_timelogCustCard":let param=JSON.parse(params.tlCustParams),name=$(cardDiv).attr("name");if("workitem"===name||"description"===name||"attachment"===name)return void 0!==param.tlc_workitem_name&&ZPeople.decodeTxt(data.TLC_Workitem_Name)!==param.tlc_workitem_name||void 0!==param.tlc_desc_name&&ZPeople.decodeTxt(data.TLC_Desc_Name)!==param.tlc_desc_name||void 0!==param.tlc_attachment_name&&ZPeople.decodeTxt(data.TLC_Attachment_Name)!==param.tlc_attachment_name;if(param.tlc_clients!==data.TLC_Clients||param.tlc_client_mand!==data.TLC_Clients_Mandatory||param.tlc_projects!==data.TLC_Projects||param.tlc_project_mand!==data.TLC_Projects_Mandatory||param.tlc_desc!==data.TLC_Desc||param.tlc_desc_mand!==data.TLC_Desc_Mandatory||param.tlc_attachment!==data.TLC_Attachment_Show||param.tlc_workitems!==data.TLC_Workitem||param.tlc_workitem_mand!==data.TLC_Workitem_Mandatory||param.tlc_billableSt!==data.TLC_Billable_Show)return!0;break;case"tls_PreferencesCard":return params.defaultbillingType!==data.TS_defaultbillingType||data.TS_showTimelogLocation!==params.showTimelogLocation||params.defaultview!==data.TS_DefaultView;case"tls_workItemsCard":if(Timetracker.timeLogSettings.workItems.checkIfWorkitemChanged(!1,params))return!0}return!1},setCustSettingData:function(layout,data,cardDiv){let name=$(cardDiv).attr("name");if(!cardDiv||"workitem"===name){layout.find("#tls_workItemEdit_div").hide();let dispName=Timetracker.util.gettlFieldDispName(data,Timetracker.constants.WORKITEM);if(layout.find("#workitem_name").html(dispName),layout.find("#workitem_name_editval").val(ZPeople.decodeTxt(dispName)),layout.find("#tls_workItemMain_div").show(),"workitem"===name){Timetracker.util.workitemDispName=dispName;let workItemsCard=layout.find("[cardid=tls_workItemsCard]"),job_Dispname=ZPeople.decodeTxt(Timetracker.util.getJobDisplayName(!0,!0)),witem_Dispname=ZPeople.decodeTxt(Timetracker.util.getWorkItemDispName(!0,!0));workItemsCard.find("#defWorkitem").text(ZPI18N.getString("zp.defaultworkitem",[ZPeople.decodeTxt(Timetracker.util.getWorkItemDispName(void 0,!0))])),workItemsCard.find("#defWorkitem").siblings("p").text(ZPI18N.getString("zp.tt.timelogsettings.workitemsdesc",[job_Dispname,witem_Dispname,witem_Dispname,witem_Dispname])),workItemsCard.find("#add_workitem").text(ZPI18N.getString("zp.tt.addentity",[Timetracker.util.getWorkItemDispName(void 0,!0)])),workItemsCard.find("#workitems_body").find("input").prop("placeholder",ZPI18N.getString("zp.workitemplaceholder",[ZPeople.decodeTxt(dispName)]))}}cardDiv&&"description"!==name||(layout.find("#tls_descEdit_div").hide(),dispName=Timetracker.util.gettlFieldDispName(data,Timetracker.constants.DESC),layout.find("#desc_name").html(dispName),layout.find("#desc_name_editval").val(ZPeople.decodeTxt(dispName)),layout.find("#tls_descMain_div").show()),cardDiv&&"attachment"!==name||(layout.find("#tls_attachEdit_div").hide(),dispName=Timetracker.util.gettlFieldDispName(data,Timetracker.constants.ATTACHMENT),layout.find("#attach_name").html(dispName),layout.find("#attach_name_editval").val(ZPeople.decodeTxt(dispName)),layout.find("#tls_attachMain_div").show(),layout.find("#attachment_mndt").attr("title",ZPI18N.getString("zp.tt.entitynotmandat",[ZPeople.decodeTxt(dispName)]))),cardDiv&&name||(layout.find("#tls_clientname_show").prop("checked","1"===data.TLC_Clients),layout.find("#tls_clientname_mand").prop("checked","1"===data.TLC_Clients_Mandatory),layout.find("#tls_projectname_show").prop("checked","1"===data.TLC_Projects),layout.find("#tls_projectname_mand").prop("checked","1"===data.TLC_Projects_Mandatory),layout.find("#tls_workitemname_show").prop("checked","1"===data.TLC_Workitem),layout.find("#tls_workitemname_mand").prop("checked","1"===data.TLC_Workitem_Mandatory),layout.find("#tls_descname_show").prop("checked","1"===data.TLC_Desc),layout.find("#tls_descname_mand").prop("checked","1"===data.TLC_Desc_Mandatory),layout.find("#tls_billablename_show").prop("checked","1"===data.TLC_Billable_Show),layout.find("#tls_attachname_show").prop("checked","1"===data.TLC_Attachment_Show))},showHideTLOverlapWarning:function(obj,data){let divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)?"tls":"tus",element=settingsPage.container.find("#"+divId+"_timeentryoverlap_warndiv");"0"===$(obj).val()?(element.find("#"+divId+"_timeentryoverlap_warn").prop("checked","1"===Timetracker.generalSettings.getTimelogOverlapType(null,null,data)),element.show()):element.hide()},getMaxLogHours:function(id,maxlogHrsType,data,pageContainer){pageContainer=pageContainer||settingsPage.container;var divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)?"tls":"tus";if(Timetracker.util.removeErrorMsg(id,pageContainer),"1"===maxlogHrsType||"2"===maxlogHrsType){if(0===pageContainer.find("#"+divId+"_maxBillableLogHoursDiv").html().length){let txt='<div class="zpl_gbox"><div class="zpl_idiv"><div class="zradiobutton zradiobutton--horizontal"><input id="'+divId+'_maxloghrs_day" value="1" type="radio" name="maxloghours" class="zradiobutton__helper" checked=""><label class="zradiobutton__label" for="'+divId+'_maxloghrs_day"><span class="zradiobutton__text">'+ZPI18N.getString("zp.smallperday")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="'+divId+'_maxloghrs_week" value="2" type="radio" name="maxloghours" class="zradiobutton__helper"><label class="zradiobutton__label" for="'+divId+'_maxloghrs_week"><span class="zradiobutton__text">'+ZPI18N.getString("zp.smallperweek")+'</span></label></div></div><div class="zpl_idiv"><input type="text" id="'+divId+'_max_hrs_val" maxlength="7" class="ztextbox w80"><em>'+ZPI18N.getString("zp.gracehour")+'</em></div><div class="zpl_idiv"><p>'+ZPI18N.getString("zp.lms.applicableto")+'</p><div><div class="zcheckbox"><input id="'+divId+'_maxloghrs_bill" type="checkbox" name="check" class="zcheckbox__helper"><label for="'+divId+'_maxloghrs_bill" class="zcheckbox__label">'+ZPI18N.getString("zp.cbillablehours")+'</label></div></div><div><div class="zcheckbox"><input id="'+divId+'_maxloghrs_nonbill" type="checkbox" name="check" class="zcheckbox__helper"><label for="'+divId+'_maxloghrs_nonbill" class="zcheckbox__label">'+ZPI18N.getString("zp.cnonbillablehours")+'</label></div></div></div></div><div class="zpl_info">'+ZPI18N.getString("zp.tt.timesheetsettings.restrictmaxloghrsovertime",["#settings/service/timetracker/overtimepolicy"])+"</div>";pageContainer.find("#"+divId+"_maxBillableLogHoursDiv").append(txt),pageContainer.find("input[name=maxloghours]").on("change",function(){Timetracker.timeLogSettings.getMaxLogHours(id,$(this).val(),data)}),Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)&&Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timeLogSettings.showHideSaveResetbn,pageContainer.find("#"+divId+"_maxBillableLogHoursDiv"))}pageContainer.find("#"+divId+"_maxloghrs_none").prop("checked",!0);let value=data.TS_maxLogHoursRestriction_Hours;value=void 0===value?0:value,pageContainer.find("#"+divId+"_max_hrs_val").val(Calendar.minstohrs(value)),pageContainer.find("#"+divId+"_maxloghrs").find("input[value="+maxlogHrsType+"]").prop("checked",!0),pageContainer.find("#"+divId+"_maxBillableLogHoursDiv").removeClass("DNI"),3==data.TS_maxLogHoursRestriction_TLType?(pageContainer.find("#"+divId+"_maxloghrs_bill").prop("checked",!0),pageContainer.find("#"+divId+"_maxloghrs_nonbill").prop("checked",!0)):2==data.TS_maxLogHoursRestriction_TLType?(pageContainer.find("#"+divId+"_maxloghrs_bill").prop("checked",!1),pageContainer.find("#"+divId+"_maxloghrs_nonbill").prop("checked",!0)):1==data.TS_maxLogHoursRestriction_TLType?(pageContainer.find("#"+divId+"_maxloghrs_bill").prop("checked",!0),pageContainer.find("#"+divId+"_maxloghrs_nonbill").prop("checked",!1)):(pageContainer.find("#"+divId+"_maxloghrs_bill").prop("checked",!1),pageContainer.find("#"+divId+"_maxloghrs_nonbill").prop("checked",!1))}else pageContainer.find("#"+divId+"_maxBillableLogHoursDiv").addClass("DNI"),pageContainer.find("#"+divId+"_maxloghrs_none").prop("checked",!1)},confirmDisablingPushToAttendance:function(params,cardDiv){let isTimerEntryNotAllowed=!1===params.automaticLog&&Timetracker.generalSettings.isPushTimerToAttendanceEnabled(),isLogTimeStartAndndLogNotAllowed=!1===params.fromToTimeLog&&Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled(),isOverLapStartAndndLogNotAllowed=("0"==params.timeentryOverlap||"1"==params.timeentryOverlap)&&Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled(),isTimerAttCheckInNotAllowed=!1===params.automaticLog&&Timetracker.generalSettings.isTimerAttCheckInRestrict();if(isTimerEntryNotAllowed||isLogTimeStartAndndLogNotAllowed||isOverLapStartAndndLogNotAllowed||isTimerAttCheckInNotAllowed){let body="";isTimerEntryNotAllowed&&isLogTimeStartAndndLogNotAllowed?body=ZPI18N.getString("zp.tt.timelogsettings.disableatt.info1"):isLogTimeStartAndndLogNotAllowed&&isTimerAttCheckInNotAllowed?body=ZPI18N.getString("zp.tt.timelogsettings.disableatt.info6"):Timetracker.generalSettings.isTimerAttCheckInConfigured()&&isTimerAttCheckInNotAllowed?body=ZPI18N.getString("zp.tt.timelogsettings.disableatt.info5"):isTimerEntryNotAllowed?body=ZPI18N.getString("zp.tt.timelogsettings.disableatt.info3"):isLogTimeStartAndndLogNotAllowed?body=ZPI18N.getString("zp.tt.timelogsettings.disableatt.info2"):isOverLapStartAndndLogNotAllowed&&(body=ZPI18N.getString("zp.tt.timelogsettings.disableatt.info4")),ModuleComp.Modal.setup({id:"tls_timelogType_div_dis",type:2,header:ZPI18N.getString("zp.tt.timelogsettings.attintegimpactinfomsg"),iconClass:"ico info",removeConfirmButtonClass:"zlabel--blue",confirmButtonClass:"zlabel--yellow",body:body,closeOnSubmit:!0,isConfirm:!1,buttonValue:ZPI18N.getString("zp.proceed"),successCallback:function(){Timetracker.timeLogSettings.sendRequest(params,cardDiv)}})}else Timetracker.timeLogSettings.sendRequest(params,cardDiv)},disableTimeLogsinAttHrs:function(obj,isAlertMsgNeeded){let eleId=$(obj).attr("id"),divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)?"tls":"tus";if(!eleId||eleId===divId+"_att_timelog"){let disableTimelogsWithInAtt=Timetracker.generalSettings.isPushTimerToAttendanceEnabled()||Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled(),attHrsTimelogRestrictDom=settingsPage.container.find("#"+divId+"_att_timelog");disableTimelogsWithInAtt?(isAlertMsgNeeded&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.tt.timelogsettings.disabledattendance4")),attHrsTimelogRestrictDom.prop("checked",!1),attHrsTimelogRestrictDom.prop("disabled",!0),attHrsTimelogRestrictDom.parent().attr("title",ZPI18N.getString("zp.tt.timelogsettings.disabledattendance4")),attHrsTimelogRestrictDom.parent().ztooltip()):(attHrsTimelogRestrictDom.prop("disabled",!1),attHrsTimelogRestrictDom.parent().attr("title",""))}if(!eleId||eleId===divId+"_att_timer_checkin"||eleId===divId+"_timestamp_automatic"){let attHrsTimerlogRestrictDom=settingsPage.container.find("#"+divId+"_att_timer_checkin"),errMsg="";eleId===divId+"_timestamp_automatic"&&!$(obj).is(":checked")&&settingsPage.container.find("#"+divId+"_att_timer_checkin").is(":checked")&&(Timetracker.util.showAlert(1,ZPI18N.getString("zp.disabledatt3")),errMsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance14")),""===errMsg&&(Timetracker.generalSettings.isPushTimerToAttendanceEnabled()?errMsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance4"):Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)?errMsg=Timetracker.generalSettings.isAutomaticLogAllowed()?"":ZPI18N.getString("zp.tt.timelogsettings.disabledattendance14"):settingsPage.container.find("#tus_timestamp_automatic").is(":checked")||(errMsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance14"))),""!==errMsg?(isAlertMsgNeeded&&Timetracker.util.showAlert(1,errMsg),attHrsTimerlogRestrictDom.prop("checked",!1),attHrsTimerlogRestrictDom.prop("disabled",!0),attHrsTimerlogRestrictDom.parent().attr("title",errMsg),attHrsTimerlogRestrictDom.parent().ztooltip()):(attHrsTimerlogRestrictDom.prop("disabled",!1),attHrsTimerlogRestrictDom.parent().attr("title",""))}},changeShowMandSetting:function(inpObj,showMandStr){var isFromShow="show"===showMandStr,isFromMand="mand"===showMandStr,isInpChecked=$(inpObj).is(":checked"),inpId=$(inpObj).attr("id");const tableLayout=settingsPage.container.find('[cardId="tls_timelogCustCard"]');isInpChecked?(isFromShow&&-1!==inpId.indexOf("client")&&tableLayout.find("#tls_projectname_show").prop("checked",!0),isFromMand&&(-1!==inpId.indexOf("client")&&tableLayout.find("#tls_clientname_show,#tls_projectname_show,#tls_projectname_mand").prop("checked",!0),-1!==inpId.indexOf("project")&&tableLayout.find("#tls_projectname_show").prop("checked",!0),-1!==inpId.indexOf("workitem")&&tableLayout.find("#tls_workitemname_show").prop("checked",!0),-1!==inpId.indexOf("desc")&&tableLayout.find("#tls_descname_show").prop("checked",!0))):(isFromShow&&(-1!==inpId.indexOf("project")&&tableLayout.find("#tls_projectname_mand,#tls_clientname_show,#tls_clientname_mand").prop("checked",!1),-1!==inpId.indexOf("client")&&tableLayout.find("#tls_clientname_mand").prop("checked",!1),-1!==inpId.indexOf("workitem")&&tableLayout.find("#tls_workitemname_mand").prop("checked",!1),-1!==inpId.indexOf("desc")&&tableLayout.find("#tls_descname_mand").prop("checked",!1)),isFromMand&&-1!==inpId.indexOf("project")&&tableLayout.find("#tls_clientname_mand").prop("checked",!1))},showHideInputDiv:function(editObj,isShowInput,tlField){const pageContainer=$(editObj).closest("tr");var inputDomId="",mainDomId="",dispName="";"workitem"===tlField?(inputDomId="tls_workItemEdit_div",mainDomId="tls_workItemMain_div",dispInpDiv="workitem_name_editval",dispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM)):"description"===tlField?(inputDomId="tls_descEdit_div",mainDomId="tls_descMain_div",dispInpDiv="desc_name_editval",dispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC)):"attachment"===tlField&&(inputDomId="tls_attachEdit_div",mainDomId="tls_attachMain_div",dispInpDiv="attach_name_editval",dispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.ATTACHMENT)),Timetracker.util.removeErrorMsg(void 0,pageContainer),pageContainer.find("#"+dispInpDiv).val(ZPeople.decodeTxt(dispName)),isShowInput?(pageContainer.find("#"+inputDomId).find("#error_message").remove(),pageContainer.find("#"+inputDomId).show().focus(),pageContainer.find("#"+dispInpDiv).focus(),pageContainer.find("#"+mainDomId).hide()):(pageContainer.find("#"+inputDomId).hide(),pageContainer.find("#"+mainDomId).show())},showHidePastDays:function(id,isChecked,data){var divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)?"tls":"tus";Timetracker.util.removeErrorMsg(id);var pastLogDiv=settingsPage.container.find("#"+divId+"_pastlogdaysdiv");if(pastLogDiv.find("input[name=pastlogdays]").off("change"),isChecked){Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timeLogSettings.showHideSaveResetbn,pastLogDiv),pastLogDiv.find("input[name=pastlogdays]").on("change",function(){Timetracker.timeLogSettings.showHidePastLogInput(id,pastLogDiv,$(this).val(),data)});var isAllDays=data.TS_pastLogAllowDays&&data.TS_pastLogAllowDays>0?"1":"0";pastLogDiv.find("input[name=pastlogdays][value="+isAllDays+"]").prop("checked",!0).trigger("change"),pastLogDiv.show()}else pastLogDiv.hide()},showHidePastLogInput:function(id,pastLogDiv,enabledVal,data){var divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS)?"tls":"tus";if(Timetracker.util.removeErrorMsg(id),"0"===enabledVal)pastLogDiv.find("#"+divId+"_pastlog_pastdaysvalue").val("").addClass("is-disabled").prop("disabled",!0);else{var pastLogAllowDays=data.TS_pastLogAllowDays&&0!=data.TS_pastLogAllowDays?data.TS_pastLogAllowDays:"";pastLogDiv.find("#"+divId+"_pastlog_pastdaysvalue").val(pastLogAllowDays).removeClass("is-disabled").prop("disabled",!1).keyup()}},workItems:{DEFAULT_WORKITEM_FIRESCROLL_LIMIT:200,FIRESCROLL_MODE:"default_workitem_firescroll_mode",initWorkitems:function(refreshData,extraDetails){let isFromForm=!(!extraDetails||void 0===extraDetails.isFromForm)&&extraDetails.isFromForm;const pageContainer=isFromForm&&extraDetails.layout?extraDetails.layout:settingsPage.container;let showCommonWorkitems=void 0!==extraDetails&&void 0!==extraDetails.showCommonWorkitems&&extraDetails.showCommonWorkitems,workItemsBody=pageContainer.find("#workitems_body");Timetracker.util.workitemDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM);let workItemTxt=ZPI18N.getString("zp.tt.addentity",[Timetracker.util.getWorkItemDispName(void 0,!0)]),result=null;if(void 0!==refreshData&&refreshData&&!isFromForm&&Timetracker.timelogs.workItem.resetWorkitemCache("allWorkitemUnmapped"),Timetracker.setWorkitemCache(),!isFromForm&&showCommonWorkitems?result=Timetracker.timelogs.workItem.getWorkitemData("allWorkitemUnmapped"):isFromForm&&(void 0!==extraDetails&&extraDetails.isEditMode?result=Timetracker.timelogs.workItem.getWorkitemData(extraDetails.jobId):void 0!==extraDetails&&(extraDetails.isAddMode||extraDetails.isPreviewForm)&&(result=null)),workItemsBody.html(""),null===result||0===result.length||""===result){let txt='<div class="zpl_idiv zpl_erorbx"><div><input type="text" class="ztextbox w300" onkeyup="Timetracker.timeLogSettings.workItems.validateWorkitemLength(this);" placeholder="'+ZPI18N.getString("zp.componentErrMsg.Invalid_empty3",[Timetracker.util.getWorkItemDispName(void 0,!0)])+'"></div>';txt+='<div ><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+' onclick="Timetracker.timeLogSettings.workItems.deleteWorkitemRows(this);"></i></div></div>',txt+='<div class="zpl_idiv"><a id="add_workitem" class="zpl_lnkbg" onclick="Timetracker.timeLogSettings.workItems.addWorkitemRows('+isFromForm+');">'+workItemTxt+"</a></div>",workItemsBody.append(txt),workItemsBody.find("div .PI_delete").hide()}else Timetracker.timeLogSettings.workItems.constructWorkitems(result,extraDetails);TimelyZComp.toolTip.intiliaze(workItemsBody),isFromForm||Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timeLogSettings.showHideSaveResetbn,workItemsBody),!isFromForm&&showCommonWorkitems&&(Timetracker.FireScroll.resetDataOnLoad(Timetracker.timeLogSettings.workItems.FIRESCROLL_MODE),Timetracker.FireScroll.initFireScroll(Timetracker.timeLogSettings.workItems.FIRESCROLL_MODE,Timetracker.constants.URL,Timetracker.timelogs.workItem.getWorkItemparams(),Timetracker.timeLogSettings.workItems.loadMoreDefaultWorkItems,"",{scrollDiv:workItemsBody}),Timetracker.FireScroll.setFetchCount(Timetracker.timeLogSettings.workItems.FIRESCROLL_MODE,result),Timetracker.FireScroll.setMaxFetchCount(Timetracker.timeLogSettings.workItems.FIRESCROLL_MODE,Timetracker.timeLogSettings.workItems.DEFAULT_WORKITEM_FIRESCROLL_LIMIT),ZPeople.FireScroll.getFireScrollPropertie(Timetracker.timeLogSettings.workItems.FIRESCROLL_MODE).triggered=!Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.isLoadMore)},constructWorkitems:function(result,extraDetails){if(null!==result||0!==result.length){let isFromForm=!(!extraDetails||void 0===extraDetails.isFromForm)&&extraDetails.isFromForm;let workItemsBody=(isFromForm&&extraDetails.layout?extraDetails.layout:settingsPage.container).find("#workitems_body"),workItemTxt=ZPI18N.getString("zp.tt.addentity",[Timetracker.util.getWorkItemDispName(void 0,!0)]),txt="";$.each(result,function(index,data){txt+='<div class="zpl_idiv zpl_erorbx"><div><input type="text" class="ztextbox w300" onkeyup="Timetracker.timeLogSettings.workItems.validateWorkitemLength(this);" placeholder="'+ZPI18N.getString("zp.componentErrMsg.Invalid_empty3",[Timetracker.util.getWorkItemDispName(void 0,!0)])+'" title="'+data.wiName+'" value="'+data.wiName+'" wiId="'+data.wiId+'"></div>',txt+='<div><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+' onclick="Timetracker.timeLogSettings.workItems.deleteWorkitemRows(this);"></i></div></div>'}),!isFromForm&&extraDetails.isFromScroll?0===workItemsBody.find('div[name="workitemAdd"]').length?workItemsBody.children("div:last").before(txt):(workItemsBody.find('div[name="workitemAdd"]:first').before(txt),workItemsBody.scrollTop(workItemsBody[0].scrollHeight)):(txt+='<div class="zpl_idiv" onclick="Timetracker.timeLogSettings.workItems.addWorkitemRows('+isFromForm+');"><a id="add_workitem" class="zpl_lnkbg"></i>'+workItemTxt+"</a></div>",workItemsBody.append(txt),workItemsBody.scrollTop(0)),isFromForm||Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timeLogSettings.showHideSaveResetbn,workItemsBody)}},loadMoreDefaultWorkItems:function(response,params,otherDtls){response&&"1"===response.res&&response.workitemListing&&(Timetracker.timelogs.workItem.setWorkItemData(response.workitemListing,params),Timetracker.timeLogSettings.workItems.constructWorkitems(response.workitemListing.allWorkitemUnmapped,{isFromScroll:!0}),Timetracker.FireScroll.setFetchCount(Timetracker.timeLogSettings.workItems.FIRESCROLL_MODE,response.workitemListing.allWorkitemUnmapped))},validateWorkitemLength:function(obj){var currentDom=$(obj),value=$(obj).val(),isWithinMaxLength=value.length;currentDom.attr("title",value),currentDom.hasClass("ztextbox__error")&&currentDom.removeClass("ztextbox__error"),currentDom.parent().find(".ztextbox--error__label").length>0&&currentDom.parent().find(".ztextbox--error__label").remove(),isWithinMaxLength>500&&Timetracker.Util.appenErrorMsgForElem({obj:currentDom,msg:ZPI18N.getString("zp.namecharlimit",["Work Item","500"]),errorDivId:"wiLenErr"})},addWorkitemRows:function(isFromForm){let workItemsBody=settingsPage.container.find("#workitems_body"),txt="";workItemsBody.children("div:not(:last)").length>=1&&(isFromForm?(txt='<div class="zpl_idiv zpl_erorbx"><div><input type="text" class="ztextbox w300" onkeyup="Timetracker.timeLogSettings.workItems.validateWorkitemLength(this);" placeholder="'+ZPI18N.getString("zp.componentErrMsg.Invalid_empty3",[Timetracker.util.getWorkItemDispName(void 0,!0)])+'" ></div>',txt+='<div><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+' onclick="Timetracker.timeLogSettings.workItems.deleteWorkitemRows(this);"></i></div></div>',workItemsBody.children("div:last").before(txt)):(txt='<div class="zpl_idiv zpl_erorbx" name="workitemAdd" ><div><input type="text" class="ztextbox w300" onkeyup="Timetracker.timeLogSettings.workItems.validateWorkitemLength(this);" placeholder="'+ZPI18N.getString("zp.componentErrMsg.Invalid_empty3",[Timetracker.util.getWorkItemDispName(void 0,!0)])+'" ></div>',txt+='<div><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+' onclick="Timetracker.timeLogSettings.workItems.deleteWorkitemRows(this);"></i></div></div>',workItemsBody.children("div:last").before(txt),Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timeLogSettings.showHideSaveResetbn,workItemsBody.children("div:last").prev())),workItemsBody.scrollTop(workItemsBody[0].scrollHeight),workItemsBody.find("div .PI_delete").show())},deleteWorkitemRows:function(obj){var pageContainer=settingsPage.container;let isFromForm=Timetracker.Page.isJobForm("edit");isFromForm&&(pageContainer=$(obj).closest(".zpl_secn"));let workItemsBody=pageContainer.find("#workitems_body");var siblingsArray=$(obj).parent().siblings(),wiId=$(siblingsArray[0]).find("input").attr("wiId");if(wiId&&(Timetracker.generalSettings.deletedWorkitems+=wiId+","),$(obj).parent().parent().remove(),0===workItemsBody.children("div:not(:last)").length){var extraDetails={isFromForm:isFromForm};extraDetails.layout=pageContainer,Timetracker.timeLogSettings.workItems.initWorkitems(!1,extraDetails)}!isFromForm&&void 0!==workItemsBody[0]&&workItemsBody[0].scrollHeight<=workItemsBody[0].clientHeight&&Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.isLoadMore&&Timetracker.FireScroll.loadMoreData(Timetracker.FireScroll.getFirescrollDtls(Timetracker.timeLogSettings.workItems.FIRESCROLL_MODE)),Timetracker.timeLogSettings.showHideSaveResetbn(workItemsBody)},removeDeletedWorkitemsFromCache:function(cache){var deletedArr=0!==Timetracker.generalSettings.deletedWorkitems.length?Timetracker.generalSettings.deletedWorkitems.split(","):null;if(null!==deletedArr)for(var i=0;i<deletedArr.length-1;i++){let index=Timetracker.timelogs.workItem.findJSONArrayIndexForWorkitem(cache,deletedArr[i],"wiId");cache.splice(index,1)}return cache},updateWorkitemParams:function(params,pageContainer){pageContainer=pageContainer||settingsPage.container;var workitemArr=new Array,errorFlag=!1,counter=0,existingWorkitemNames={},noOf_new_edit_workitems=0,itrWorkitemData=null,workitemData=Timetracker.timelogs.workItem.getWorkitemData("allWorkitemUnmapped");if(Timetracker.Page.isJobForm("edit")&&(workitemData=Timetracker.timelogs.workItem.getWorkitemData(params.zp_recordId)),null!=workitemData){let cache=JSON.parse(JSON.stringify(workitemData));itrWorkitemData=Timetracker.timeLogSettings.workItems.removeDeletedWorkitemsFromCache(cache)}var errJson={};if(pageContainer.find("#workitems_body > div:not(:last)").each(function(){let textChildren=$(this).children(),wiId=$(textChildren[0]).find("input").attr("wiId"),wiName=$(textChildren[0]).find("input").val().trim();if(Timetracker.Validations.isEmpty(wiName))if(wiId&&""==wiName&&!Timetracker.timeLogSettings.isFmFieldEvnt){Timetracker.generalSettings.deletedWorkitems+=wiId+",";let cach=JSON.parse(JSON.stringify(workitemData));itrWorkitemData=Timetracker.timeLogSettings.workItems.removeDeletedWorkitemsFromCache(cach)}else wiId&&""===wiName&&Timetracker.timeLogSettings.isFmFieldEvnt&&workitemArr.push({wiName:wiId,wiId:""});else!Timetracker.timeLogSettings.isFmFieldEvnt&&existingWorkitemNames[wiName]?($(textChildren[0]).find("#wiDuplicate").remove(),Timetracker.Util.appenErrorMsgForElem({obj:$(textChildren[0]).find("input"),msg:ZPI18N.getString("zp.duplicateWorkitem",[Timetracker.util.workitemDispName]),errorDivId:"wiDuplicate"}),errorFlag=!0,errJson={errMsg:"duplicate"}):existingWorkitemNames[wiName]="exists",!Timetracker.timeLogSettings.isFmFieldEvnt&&wiName.length>500&&(errorFlag=!0,$(textChildren[0]).parent().find("#wiLenErr").remove(),Timetracker.Util.appenErrorMsgForElem({obj:$(textChildren[0]).find("input"),msg:ZPI18N.getString("zp.namecharlimit",["Work Item","500"]),errorDivId:"wiLenErr"}),errJson={errMsg:"exceedlength"}),wiId&&!errorFlag?(null!==itrWorkitemData&&itrWorkitemData[counter]&&wiName===ZPeople.decodeTxt(itrWorkitemData[counter].wiName)||""!==wiName&&(workitemArr.push({wiName:wiName,wiId:wiId}),noOf_new_edit_workitems++),counter++):errorFlag||""!==wiName.trim()&&(workitemArr.push({wiName:wiName}),noOf_new_edit_workitems++)}),noOf_new_edit_workitems>500)return errJson={errMsg:"workitemCountExceed"};if(errorFlag){if(1!==pageContainer.find("#workitems_body > div:not(:last)").length)return errJson;{let textChildren=$(this).children(),wiId=$(textChildren[0]).find("input").attr("wiId"),wiName=$(textChildren[0]).find("input").val();if(void 0!==wiId||void 0!==wiName)return!1;if(errJson.hasOwnProperty("errMsg"))return errJson}}return params.workitemArr=JSON.stringify(workitemArr),params.deletedWorkitems=Timetracker.generalSettings.deletedWorkitems,params},checkIfWorkitemChanged:function(settingsChanged,params){if(void 0!==params.workitemArr&&0!==params.workitemArr.length){let noEdit=!1,workitemArr=params.workitemArr;return(JSON.parse(workitemArr).length>0||""!==Timetracker.generalSettings.deletedWorkitems)&&(noEdit=!0),noEdit}return settingsChanged}},showHideSaveResetbn:function(cardDiv){Timetracker.timeLogSettings.isFmFieldEvnt=!0,cardDiv=cardDiv.target?cardDiv.target:cardDiv;var key=TimelySettings.SHOWNOTHING;null!==Timetracker.timeLogSettings.getParamsForUpdateSettings({isFmFieldChEvnt:!0},Timetracker.generalSettings.settingDetails,cardDiv)&&(key=TimelySettings.SHOWSAVERESET),Timetracker.genSettings.showHideSaveReset(cardDiv,key),Timetracker.timeLogSettings.isFmFieldEvnt=!1},disableTimerRelatedSettings:function(element){Timetracker.timeLogSettings.disableTimeLogsinAttHrs()},disableAttCheckinTimerRestrict:function(data){var attCheckInTimerDom=Layout.Page.container.find("#tssettings_att_timer_checkin"),isPushTimerEnabled=0!=Layout.Page.container.find("#tssettings_attendance_timer").length?Layout.Page.container.find("#tssettings_attendance_timer").is(":checked"):data&&"1"===data.TS_attendance;attCheckInTimerDom.prop("disabled",!1),attCheckInTimerDom.parent().removeClass("lbl_disbld").attr("title",""),Layout.Page.container.find("#tssettings_timestamp_automatic").is(":checked")?isPushTimerEnabled&&(attCheckInTimerDom.prop("checked",!1),attCheckInTimerDom.prop("disabled",!0),attCheckInTimerDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.attCheckinLogTimerNote"))):attCheckInTimerDom.is(":checked")&&(attCheckInTimerDom.prop("checked",!1),attCheckInTimerDom.prop("disabled",!0),Timetracker.util.showAlert(1,ZPI18N.getString("zp.disabledatt3")),attCheckInTimerDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.disabledattendance")))}},Timetracker.timesheetSettings={init:function(){Timetracker.genSettings.init(),Timetracker.genSettings.removeTopButton(settingsPage.container),Timetracker.genSettings.permissionCheck()&&(Timetracker.timesheetSettings.constructHtml(),Timetracker.timesheetSettings.intializeEventListeners(),Timetracker.timesheetSettings.setData(Timetracker.generalSettings.settingDetails),Timetracker.timesheetSettings.intializeEventListeners(!0),Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timesheetSettings.showHideSaveResetbn),TimelyZComp.toolTip.intiliaze())},constructHtml:function(){if(!Timetracker.genSettings.isHtmlConstructed()){var html=Timetracker.genSettings.getHeaderBandHtml({header:ZPI18N.getString("zp.timesheets"),description:ZPI18N.getString("zp.tt.timesheetsettings.topbandtext")});html+='<div class="zpl_rgtcnt"><div class="zpl_crd" cardId="tss_restrictionsCard"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.leavetype.v2.restrictions")+"</h4><p>"+ZPI18N.getString("zp.tt.timesheetsettings.restrictionsdesc")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.timesheetSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.timesheetSettings.updateData(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tss_restricttsPeriod" type="checkbox" checked="" value="-1" class="zcheckbox__helper"><label for="tss_restricttsPeriod" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.restricttimesheet",[""])+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timesheetsettings.restricttimesheetdesc")+'</span></div><div class="zpl_tbox" id="tss_tsPeriodRestrictDiv"><div class="zpl_idiv" id="tss_tsPeriod"><div class="zradiobutton zradiobutton--horizontal"><input id="tss_tsPeriod_day" type="radio" name="tsPeriod"  value="0" class="zradiobutton__helper"><label class="zradiobutton__label" for="tss_tsPeriod_day"><span class="zradiobutton__text">'+ZPI18N.getString("zp.cday")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tss_tsPeriod_week" type="radio" name="tsPeriod" value="1" class="zradiobutton__helper"><label class="zradiobutton__label" for="tss_tsPeriod_week"><span class="zradiobutton__text">'+ZPI18N.getString("zp.week")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tss_tsPeriod_month" type="radio" name="tsPeriod" value="2" class="zradiobutton__helper"><label class="zradiobutton__label" for="tss_tsPeriod_month"><span class="zradiobutton__text">'+ZPI18N.getString("zp.month")+'</span></label></div></div><div id="tss_tssubmission_div"><div class="zcheckbox " id="tss_tsRestrict"><input id="tss_restricttimesheetsubmission" type="checkbox" class="zcheckbox__helper"><label for="tss_restricttimesheetsubmission" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.restrictsubmission")+'</label></div><div class="zpl_gbox" id="tss_tsSpan"><table class="zpl_itbl zpl_erorbx"><tbody><tr><td><span>'+ZPI18N.getString("zp.from")+'</span></td><td width="150px"><div><select id="tss_from_day" elemType="select"></select></div></td><td class="showhide_tsrange"><span>'+ZPI18N.getString("zp.of")+'</span></td><td class="showhide_tsrange"><div><select id="tss_from_range" elemType="select"></select></div></td></tr><tr><td><span>'+ZPI18N.getString("zp.to")+'</span></td><td width="150px"><div><select id="tss_to_day" elemType="select"></select></div></td><td class="showhide_tsrange"><span>'+ZPI18N.getString("zp.of")+'</span></td><td class="showhide_tsrange"><div><select id="tss_to_range" elemType="select"></select></div></td></tr><tr><td colspan="4" id="tss_tsSpan_errmsg"></td></tr></tbody></table></div></div></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tss_RestrictBillingStatus" type="checkbox" name="billingStatus" class="zcheckbox__helper"><label for="tss_RestrictBillingStatus" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.tsincludetimelogs")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timesheetsettings.timesheetsubmissiondesc")+'</span><div class="zpl_gbox" id="tss_billingStatus_div"><div><div class="zradiobutton zradiobutton--horizontal"><input id="tss_BillingStatus_billable" type="radio" name="billingtimesheetType" value="1" class="zradiobutton__helper"><label for="tss_BillingStatus_billable" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.billable")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tss_BillingStatus_nonbillable" type="radio" name="billingtimesheetType" value="2" checked="true" class="zradiobutton__helper"><label for="tss_BillingStatus_nonbillable" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.nonbillable")+'</span></label></div></div></div></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tss_timesheetClients_internal" type="checkbox"  checked="" class="zcheckbox__helper"><label for="tss_timesheetClients_internal" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.timelogsexclude",[Timetracker.util.getClientDisplayName(!1,!0)])+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timesheetsettings.timelogsexcludedesc",[Timetracker.util.getProjectDisplayName(!1,!0),Timetracker.util.getClientDisplayName(!1,!0)])+'</span></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tss_timesheetOverLap" type="checkbox"  checked="" class="zcheckbox__helper"><label for="tss_timesheetOverLap" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.timesheetoverlappingdts")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timesheetsettings.timesheetoverlappingdtsdesc")+'</span></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox" id="tss_min_hrs_div"><input id="tss_min_hrs" type="checkbox" name="restrictmin" checked="" class="zcheckbox__helper"><label for="tss_min_hrs" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.minhrssettingname")+'</label><i class="PI_info tooltip-js" data-title-position="right" title="'+ZPI18N.getString("zp.minhrsettingsinfo")+'"></i></div><div class="zpl_gbox" id="min_hrs_value_box"><table class="zpl_itbl zpl_erorbx"><tbody><tr><td><div class="zcheckbox"><input id= "minhrsperday_chkbox" type="checkbox" name="min_hours"   class="zcheckbox__helper"><label for="minhrsperday_chkbox" class="zcheckbox__label">'+ZPI18N.getString("zp.perday")+'</label></div></td><td><input id="min_per_day" type="text" class="ztextbox w100" value="00:00" onkeyup="Timetracker.timesheetSettings.validateCriHrs(this)"><em>'+ZPI18N.getString("zp.gracehour")+'</em><i class="C-info1"></i></td></tr><tr><td><div class="zcheckbox "><input id="minhrsperweek_chkbox" type="checkbox" name="min_hours"   class="zcheckbox__helper"><label for="minhrsperweek_chkbox" class="zcheckbox__label">'+ZPI18N.getString("zp.perweek")+'</label></div></td><td><input id="min_per_week" type="text" class="ztextbox w100" value="00:00" onkeyup="Timetracker.timesheetSettings.validateCriHrs(this)"><em>'+ZPI18N.getString("zp.gracehour")+'</em><i class="C-info1"></i></td></tr><tr><td id="min_err" colspan="4"></td></tr></tbody></table></div><div class="zcheckbox " id="tss_max_hrs_div"><input id="tss_max_hrs" type="checkbox" name="restrictmax"  class="zcheckbox__helper"><label for="tss_max_hrs" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.maxhrssettingname")+'</label><i class="PI_info tooltip-js" data-title-position="right" title="'+ZPI18N.getString("zp.minhrsettingsinfo")+'"></i></div><div class="zpl_gbox" id="max_hrs_value_box"><table class="zpl_itbl zpl_erorbx"><tbody><tr><td><div class="zcheckbox"><input id="maxhrsperday_chkbox" type="checkbox" name="max_hrs"   class="zcheckbox__helper"><label for="maxhrsperday_chkbox" class="zcheckbox__label">'+ZPI18N.getString("zp.perday")+'</label></div></td><td><input id="max_per_day" type="text" class="ztextbox w100" value="00:00" onkeyup="Timetracker.timesheetSettings.validateCriHrs(this)"><em>'+ZPI18N.getString("zp.gracehour")+'</em><i class="C-info1"></i></td></tr><tr><td><div class="zcheckbox"><input id="maxhrsperweek_chkbox" type="checkbox" name="max_hrs"   class="zcheckbox__helper"><label for="maxhrsperweek_chkbox" class="zcheckbox__label">'+ZPI18N.getString("zp.perweek")+'</label></div></td><td><input id="max_per_week" type="text" class="ztextbox w100" value="00:00" onkeyup="Timetracker.timesheetSettings.validateCriHrs(this)"><em>'+ZPI18N.getString("zp.gracehour")+'</em><i class="C-info1"></i></td></tr><tr><td id="max_err" colspan="4"></td></tr></tbody></table></div></div></div></div></div><div class="zpl_crd" cardId="tss_PermissionsCard"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.permissions")+"</h4><p>"+ZPI18N.getString("zp.tt.timesheetsettings.timesheetpermissionsdesc")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.timesheetSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.timesheetSettings.updateData(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><h5>'+ZPI18N.getString("zp.tt.timesheetsettings.whocreatetimesheet",[""])+'</h5><div name="hierarchyChk"><div class="zcheckbox zcheckbox--horizontal"><input id="tss_tsCreation_rm" type="checkbox" name="tsCreator"  class="zcheckbox__helper"><label for="tss_tsCreation_rm" class="zcheckbox__label">'+ZPI18N.getString("zp.srepman")+'</label></div><div class="zcheckbox zcheckbox--horizontal"><input id="tss_tsCreation_self" type="checkbox" name="tsCreator"  class="zcheckbox__helper"><label for="tss_tsCreation_self" class="zcheckbox__label">'+ZPI18N.getString("zp.local.employeesself")+'</label></div></div></div><div class="zpl_secn"><div class="zpl_info"><ul><li>'+ZPI18N.getString("zp.tt.timesheetsettings.link1",["#settings/service/timetracker/reminders"])+"</li><li>"+ZPI18N.getString("zp.tt.timesheetsettings.link2",["#settings/service/timetracker/timesheetscheduler"])+"</li><li>"+ZPI18N.getString("zp.tt.timesheetsettings.link3",["#settings/service/timetracker/approval"])+'</li></ul></div></div><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.tt.timesheetsettings.displayrph",[""])+'</h5></div><div><div class="zcheckbox zcheckbox--horizontal"><input id="tss_isApprover" type="checkbox" name="includetimelogs" class="zcheckbox__helper"><label for="tss_isApprover" class="zcheckbox__label">'+ZPI18N.getString("zp.approver")+'</label></div><div class="zcheckbox zcheckbox--horizontal"><input id="tss_isReportingto" type="checkbox" name="includetimelogs" class="zcheckbox__helper"><label for="tss_isReportingto" class="zcheckbox__label">'+ZPI18N.getString("zp.srepman")+'</label></div><div class="zcheckbox zcheckbox--horizontal"><input id="tss_isEmployee" type="checkbox" name="includetimelogs"  class="zcheckbox__helper"><label for="tss_isEmployee" class="zcheckbox__label">'+ZPI18N.getString("zp.local.employeesself")+'</label></div></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tss_isApproverLogsEdit" type="checkbox" name="approvalEdit" checked="" class="zcheckbox__helper"><label for="tss_isApproverLogsEdit" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.approvereditlogs")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timesheetsettings.approvereditlogsdesc")+'</span></div></div></div></div><div class="zpl_crd" cardId="tss_currenciesCard"><div class="zpl_crdhdr"><div><h4> '+ZPI18N.getString("zp.currency")+"</h4><p>"+ZPI18N.getString("zp.tt.bilingsettings.currencydesc")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.timesheetSettings.setData(Timetracker.generalSettings.settingDetails,this,undefined,true)","Timetracker.timesheetSettings.updateData(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><div id="currencies_body"></div></div></div></div><div><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><h4>'+ZPI18N.getString("zp.tt.timesheetsettings.emailtemplatecust")+"</h4> <p>"+ZPI18N.getString("zp.tt.timesheetsettings.emailtemplatedesc")+' </p></div></div><div class="zpl_secn"><a onclick="Timetracker.mailAlert.openAlert(true)" class="zpl_lnkbg">'+ZPI18N.getString("zp.tt.timesheetsettings.custmailtemp")+"</a></div></div></div></div></div></div></div>",settingsPage.container.html(html)}},intializeEventListeners:function(post){const pageContainer=settingsPage.container;post?(TimelyZComp.toolTip.intiliaze(),pageContainer.find("#tss_min_hrs_div input[name=restrictmin]").off().on("click",function(){Timetracker.timesheetSettings.showHideMinMaxHrsInput(pageContainer.attr("id"),$(this).prop("checked"),Timetracker.generalSettings.settingDetails,"min")}),pageContainer.find("#tss_max_hrs_div input[name=restrictmax]").off().on("click",function(){Timetracker.timesheetSettings.showHideMinMaxHrsInput(pageContainer.attr("id"),$(this).prop("checked"),Timetracker.generalSettings.settingDetails,"max")}),pageContainer.find("#tss_RestrictBillingStatus").off().on("click",function(){if($(this).is(":checked")){pageContainer.find("#tss_billingStatus_div").removeClass("zpl_DNI");let value=Timetracker.generalSettings.getTSBillableSetting();value="0"!==value?value:"1",pageContainer.find("[name=billingtimesheetType][value="+value+"]").prop("checked",!0)}else pageContainer.find("#tss_billingStatus_div").addClass("zpl_DNI")}),pageContainer.find("#minhrsperday_chkbox, #minhrsperweek_chkbox, #maxhrsperday_chkbox, #maxhrsperweek_chkbox").off().on("click",function(){Timetracker.timesheetSettings.enableDisableMinMaxHrsInput(this,Timetracker.generalSettings.settingDetails)})):(Timetracker.genSettings.addCheckBxEventLsnr(),pageContainer.find("#tss_restricttsPeriod").off().on("change",function(){if($(this).is(":checked")){pageContainer.find("#tss_tsPeriodRestrictDiv").removeClass("zpl_DNI");let value=Timetracker.generalSettings.getTSPeriod();value=value!==Timetracker.constants.TS_PERIOD.ANY_DATE_RANGE?value:Timetracker.constants.TS_PERIOD.DAY,pageContainer.find("[name=tsPeriod][value="+value+"]").prop("checked",!0).trigger("change")}else pageContainer.find("#tss_tsPeriodRestrictDiv").addClass("zpl_DNI")}),pageContainer.find("#tss_tsPeriod input[name=tsPeriod]").off("change").on("change",function(){Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.onTimesheetPeriodChange(this,Timetracker.generalSettings.settingDetails)}))},setData:function(data,cardDiv,pageContainer,isFromReset){pageContainer=pageContainer||settingsPage.container;var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");cardDivId&&"tss_restrictionsCard"!==cardDivId||(void 0!==data.TS_timesheetPeriod&&data.TS_timesheetPeriod===Timetracker.constants.TS_PERIOD.ANY_DATE_RANGE?pageContainer.find("#tss_restricttsPeriod").prop("checked",!1).trigger("change"):pageContainer.find("#tss_restricttsPeriod").prop("checked",!0).trigger("change"),pageContainer.find("#tss_BillingStatus_billable,#tss_BillingStatus_nonbillable").prop("checked",!1),data.TS_billingtimesheetType&&"0"!==data.TS_billingtimesheetType?(pageContainer.find("#tss_billingStatus_div").removeClass("zpl_DNI"),pageContainer.find("#tss_RestrictBillingStatus").prop("checked",!0),"1"===data.TS_billingtimesheetType?pageContainer.find("#tss_BillingStatus_billable").prop("checked",!0):"2"===data.TS_billingtimesheetType&&pageContainer.find("#tss_BillingStatus_nonbillable").prop("checked",!0)):(pageContainer.find("#tss_RestrictBillingStatus").prop("checked",!1),pageContainer.find("#tss_billingStatus_div").addClass("zpl_DNI")),pageContainer.find("#tss_timesheetClients_internal").prop("checked","2"===data.TS_clienttimesheetType),pageContainer.find("#tss_timesheetOverLap").prop("checked","1"===data.TS_restrictTimesheetOverlap),pageContainer.find("#tss_min_hrs").prop("checked","1"===data.TS_MinHrsEnabled),Timetracker.timesheetSettings.showHideMinMaxHrsInput(pageContainer.attr("id"),"0"!=data.TS_MinHrsEnabled,data,"min",pageContainer),pageContainer.find("#tss_max_hrs").prop("checked","1"===data.TS_MaxHrsEnabled),Timetracker.timesheetSettings.showHideMinMaxHrsInput(pageContainer.attr("id"),"0"!=data.TS_MaxHrsEnabled,data,"max",pageContainer)),cardDivId&&"tss_PermissionsCard"!==cardDivId||(pageContainer.find("#tss_tsCreation_rm,#tss_tsCreation_self").prop("checked",!1),"1"==data.TS_timesheetOwners?pageContainer.find("#tss_tsCreation_rm").prop("checked",!0):"0"==data.TS_timesheetOwners&&pageContainer.find("#tss_tsCreation_rm,#tss_tsCreation_self").prop("checked",!0),pageContainer.find("#tss_isApprover").prop("checked","1"===data.TS_showRPHForApprover),pageContainer.find("#tss_isReportingto").prop("checked","1"===data.TS_showRPHForReportingManager),pageContainer.find("#tss_isEmployee").prop("checked","1"===data.TS_showRPHForEmployee),pageContainer.find("#tss_isApproverLogsEdit").prop("checked","1"===data.TS_isApproverEditLogtime)),cardDivId&&"tss_currenciesCard"!==cardDivId||Timetracker.timesheetSettings.Currency.fetchSetCurrenices(isFromReset),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING)},updateData:function(cardDiv){var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId"),params=null;if(params="tss_currenciesCard"===cardDivId?{mode:"updateLocCurrData"}:{mode:"updateTimetrackerSettings",subMode:Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS},null!=(params=Timetracker.timesheetSettings.getParamsForUpdateSettings(params,Timetracker.generalSettings.settingDetails,cardDiv))&&(params.fetchUpdatedSetings=!0),null!=params){if(params.isError||params.hasOwnProperty("errMsg"))return void("minhrs_day_week_mand"===params.errMsg?Timetracker.util.showAlert(1,ZPI18N.getString("zp.minperdayweekmand")):"maxhrs_day_week_mand"===params.errMsg&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.maxperdayweekmand")));Timetracker.util.removeErrorMsg(void 0,$(cardDiv).closest(".zpl_crd")),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVING),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){cardDivId&&"tss_currenciesCard"===cardDivId||Timetracker.genSettings.updateCache(response),cardDivId&&"tss_currenciesCard"!==cardDivId||Timetracker.timesheetSettings.Currency.updateCache(),Timetracker.timesheetSettings.setData(Timetracker.generalSettings.settingDetails,cardDivId),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVED)},{},Timetracker.Util.generalFailureCallback)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"))},getParamsForUpdateSettings:function(params,data,cardDiv,pageContainer){pageContainer=pageContainer||$(cardDiv).closest(".zpl_crd");var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");params.hasOwnProperty("mode");Timetracker.util.removeErrorMsg(void 0,pageContainer);if(cardDivId&&"tss_PermissionsCard"!==cardDivId||(params.timesheetOwners="2",pageContainer.find("#tss_tsCreation_self").is(":checked")?params.timesheetOwners="0":pageContainer.find("#tss_tsCreation_rm").is(":checked")&&(params.timesheetOwners="1"),params.isApproverEditLogtime=pageContainer.find("#tss_isApproverLogsEdit").is(":checked")?"1":"0",params.showRPHForApprover=pageContainer.find("#tss_isApprover").is(":checked")?"1":"0",params.showRPHForReportingManager=pageContainer.find("#tss_isReportingto").is(":checked")?"1":"0",params.showRPHForEmployee=pageContainer.find("#tss_isEmployee").is(":checked")?"1":"0"),!cardDivId||"tss_restrictionsCard"===cardDivId){var periodjson={};if(pageContainer.find("#tss_restricttsPeriod").is(":checked")){if(params.timesheetPeriod=pageContainer.find("#tss_tsPeriod :checked").val(),params.timesheetPeriod===Timetracker.constants.TS_PERIOD.WEEK||params.timesheetPeriod===Timetracker.constants.TS_PERIOD.MONTH){var ts_submission_period_div=pageContainer.find("#tss_tssubmission_div");if(ts_submission_period_div.find("#tss_restricttimesheetsubmission").is(":checked")){let ts_span=ts_submission_period_div.find("#tss_tsSpan"),from_day=TimelyZComp.select.getValue(ts_span.find("#tss_from_day"));if("-1"!==from_day&&""!==from_day){var from_range=TimelyZComp.select.getValue(ts_span.find("#tss_from_range"));periodjson.from_day=from_day,periodjson.from_range=from_range}let to_day=TimelyZComp.select.getValue(ts_span.find("#tss_to_day"));if("-1"!==to_day&&""!==to_day){var to_range=TimelyZComp.select.getValue(ts_span.find("#tss_to_range"));if(!Timetracker.timeLogSettings.isFmFieldEvnt&&periodjson.from_day&&periodjson.from_range&&(parseInt(periodjson.from_range)>parseInt(to_range)||parseInt(periodjson.from_day)>parseInt(to_day)&&parseInt(periodjson.from_range)===parseInt(to_range)))return ts_span.find("table #tss_tsSpan_errmsg").html('<span class="ztextbox--error__label trRM">'+ZPI18N.getString("zp.tt.timesheetsettings.fromperiodgreaterthanto")+"</span>"),{isError:!0};periodjson.to_day=to_day,periodjson.to_range=to_range}if(!Timetracker.timeLogSettings.isFmFieldEvnt&&0===Object.keys(periodjson).length)return ts_span.find("table #tss_tsSpan_errmsg").append('<span class="ztextbox--error__label trRM">'+ZPI18N.getString("zp.tsinvalidperiod")+"</span>"),{isError:!0}}}}else params.timesheetPeriod=Timetracker.constants.TS_PERIOD.ANY_DATE_RANGE;if(params.timesheetSubmissionPeriod=JSON.stringify(periodjson),pageContainer.find("#tss_RestrictBillingStatus").is(":checked")){let billable=pageContainer.find("#tss_BillingStatus_billable").is(":checked");params.billingtimesheetType=billable?"1":"2"}else params.billingtimesheetType="0";if(params.clienttimesheetType=pageContainer.find("#tss_timesheetClients_internal").is(":checked")?"2":"0",params.restrictTimesheetOverlap=pageContainer.find("#tss_timesheetOverLap").is(":checked")?"1":"0",params=Timetracker.timesheetSettings.getParamsForMinMaxHours(params,pageContainer),!Timetracker.timeLogSettings.isFmFieldEvnt&&params&&!params.isError&&pageContainer.find("input[id='tss_max_hrs']").is(":checked")){if(pageContainer.find("#maxhrsperday_chkbox").is(":checked")&&Timetracker.timesheetSettings.validateCriHrs($(pageContainer.find("#max_per_day"))),!Timetracker.timeLogSettings.isFmFieldEvnt&&0!==pageContainer.find("#error_message_tscri").length)return{isError:!0};pageContainer.find("#maxhrsperweek_chkbox").is(":checked")&&Timetracker.timesheetSettings.validateCriHrs($(pageContainer.find("#max_per_week")))}if(!Timetracker.timeLogSettings.isFmFieldEvnt&&0!==pageContainer.find("#error_message_tscri").length)return{isError:!0};if(params.hasOwnProperty("isError"))return params}return cardDivId&&"tss_currenciesCard"!==cardDivId||(params=Timetracker.timesheetSettings.Currency.getParamsForUpdateSettings(params))&&!params.hasOwnProperty("isError")?!cardDivId||Timetracker.timesheetSettings.isSettingValueChanged(params,data,cardDiv)?params:null:params},getParamsForMinMaxHours:function(params,pageContainer){var isTimesheetSettingsPage=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS),idPrefix_min=isTimesheetSettingsPage?"min":"tus_min",idPrefix_max=isTimesheetSettingsPage?"max":"tus_max",divId=isTimesheetSettingsPage?"tss":"tus",isError=!1;if(pageContainer.find("#"+divId+"_min_hrs").is(":checked")){let is_minSel_day=pageContainer.find("input[id='"+idPrefix_min+"hrsperday_chkbox']").is(":checked"),is_minSel_week=pageContainer.find("input[id='"+idPrefix_min+"hrsperweek_chkbox']").is(":checked");if(!is_minSel_day&&!is_minSel_week)return{isError:!0,errMsg:"minhrs_day_week_mand"};if(is_minSel_day){let hrs=pageContainer.find("#"+idPrefix_min+"_hrs_value_box").find("#"+idPrefix_min+"_per_day").val();Timetracker.timeLogSettings.isFmFieldEvnt||hrs.match(Timetracker.util.maxhrsRegex)||(Timetracker.Util.appenErrorMsgForElem({obj:pageContainer.find("#"+idPrefix_min+"_per_day"),msg:ZPI18N.getString("zp.invalidinput")}),isError=!0),params.minHrsPerDay=hrs,params.minHrsType="0"}if(is_minSel_week){let hrs=pageContainer.find("#"+idPrefix_min+"_hrs_value_box").find("#"+idPrefix_min+"_per_week").val();Timetracker.timeLogSettings.isFmFieldEvnt||hrs.match(Timetracker.util.maxWeekHrsRegex)?params.minHrsPerWeek=hrs:(Timetracker.Util.appenErrorMsgForElem({obj:pageContainer.find("#"+idPrefix_min+"_per_week"),msg:ZPI18N.getString("zp.invalidinput")}),isError=!0),params.minHrsType="1"}is_minSel_day&&is_minSel_week&&(params.minHrsType="2"),params.minHrsEnabled="1"}else params.minHrsEnabled="0";if(pageContainer.find("#"+divId+"_max_hrs").is(":checked")){let is_maxSel_day=pageContainer.find("input[id='"+idPrefix_max+"hrsperday_chkbox']").is(":checked"),is_maxSel_week=pageContainer.find("input[id='"+idPrefix_max+"hrsperweek_chkbox']").is(":checked");if(!is_maxSel_day&&!is_maxSel_week)return{isError:!0,errMsg:"maxhrs_day_week_mand"};if(is_maxSel_day){let hrs=pageContainer.find("#"+idPrefix_max+"_hrs_value_box").find("#"+idPrefix_max+"_per_day").val();Timetracker.timeLogSettings.isFmFieldEvnt||hrs.match(Timetracker.util.maxhrsRegex)||(Timetracker.Util.appenErrorMsgForElem({obj:pageContainer.find("#"+idPrefix_max+"_per_day"),msg:ZPI18N.getString("zp.invalidinput")}),isError=!0),params.maxHrsPerDay=hrs,params.maxHrsType="0"}if(is_maxSel_week){let hrs=pageContainer.find("#"+idPrefix_max+"_hrs_value_box").find("#"+idPrefix_max+"_per_week").val();Timetracker.timeLogSettings.isFmFieldEvnt||hrs.match(Timetracker.util.maxWeekHrsRegex)?params.maxHrsPerWeek=hrs:(Timetracker.Util.appenErrorMsgForElem({obj:pageContainer.find("#"+idPrefix_max+"_per_week"),msg:ZPI18N.getString("zp.invalidinput")}),isError=!0),params.maxHrsType="1"}is_maxSel_day&&is_maxSel_week&&(params.maxHrsType="2"),params.maxHrsEnabled="1"}else params.maxHrsEnabled="0";return isError?{isError:!0}:params},showHideSaveResetbn:function(cardDiv){cardDiv=cardDiv.target?cardDiv.target:cardDiv,Timetracker.timeLogSettings.isFmFieldEvnt=!0,null!==Timetracker.timesheetSettings.getParamsForUpdateSettings({},Timetracker.generalSettings.settingDetails,cardDiv)?Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVERESET):Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING),Timetracker.timeLogSettings.isFmFieldEvnt=!1},isSettingValueChanged:function(params,data,cardDiv){switch($(cardDiv).closest(".zpl_crd").attr("cardId")){case"tss_restrictionsCard":var periodjson=JSON.parse(params.timesheetSubmissionPeriod);if(data.TS_timesheetPeriod!==params.timesheetPeriod||(params.timesheetPeriod===Timetracker.constants.TS_PERIOD.WEEK||params.timesheetPeriod===Timetracker.constants.TS_PERIOD.MONTH)&&(data.TS_timesheetSubmissionPeriod.to_day!=periodjson.to_day||data.TS_timesheetSubmissionPeriod.from_day!=periodjson.from_day||data.TS_timesheetSubmissionPeriod.to_range!==periodjson.to_range||data.TS_timesheetSubmissionPeriod.from_range!==periodjson.from_range))return!0;if(void 0!==params.billingtimesheetType&&data.TS_billingtimesheetType!==params.billingtimesheetType||data.TS_restrictTimesheetOverlap!==params.restrictTimesheetOverlap||data.TS_clienttimesheetType!==params.clienttimesheetType||params.minHrsEnabled!=data.TS_MinHrsEnabled||"1"===params.minHrsEnabled&&(params.minHrsType!==data.TS_MinHrsType||void 0!==params.minHrsPerDay&&Timetracker.DateTime.convertToMins(params.minHrsPerDay)!=data.TS_MinHrsPerDay||void 0!==params.minHrsPerWeek&&params.minHrsPerWeek!=Calendar.minstohrs(data.TS_MinHrsPerWeek))||params.maxHrsEnabled!=data.TS_MaxHrsEnabled||"1"===params.maxHrsEnabled&&(params.maxHrsType!==data.TS_MaxHrsType||void 0!==params.maxHrsPerDay&&Timetracker.DateTime.convertToMins(params.maxHrsPerDay)!=data.TS_MaxHrsPerDay||void 0!==params.maxHrsPerWeek&&params.maxHrsPerWeek!=Calendar.minstohrs(data.TS_MaxHrsPerWeek)))return!0;break;case"tss_PermissionsCard":return void 0!==params.timesheetOwners&&data.TS_timesheetOwners!==params.timesheetOwners||data.TS_showRPHForApprover!==params.showRPHForApprover||data.TS_showRPHForEmployee!==params.showRPHForEmployee||data.TS_showRPHForReportingManager!==params.showRPHForReportingManager||data.TS_isApproverEditLogtime!==params.isApproverEditLogtime;case"tss_currenciesCard":if(params&&(params.currencyArray||params.deletedCurrencies))return!0}return!1},showHideRestrictTSSubmissionPeriod:{onTimesheetPeriodChange:function(obj,settings,pageContainer){var divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)?"tss":"tus";pageContainer=pageContainer||settingsPage.container;var tsPeriod=Timetracker.generalSettings.getTSPeriod(null,null,settings),ts_period=$(obj).val(),submissionDiv=pageContainer.find("#"+divId+"_tssubmission_div");if(submissionDiv.addClass("zpl_DNI"),submissionDiv.find("#"+divId+"_tsRestrict").addClass("zpl_DNI"),submissionDiv.find("#"+divId+"_tsSpan").addClass("zpl_DNI"),submissionDiv.find("#"+divId+"_period_note").remove(),(ts_period===Timetracker.constants.TS_PERIOD.WEEK||ts_period===Timetracker.constants.TS_PERIOD.MONTH)&&(submissionDiv.removeClass("zpl_DNI"),submissionDiv.find("#"+divId+"_tsRestrict").removeClass("zpl_DNI"),submissionDiv.find("#"+divId+"_tsRestrict").off("click").on("click",function(){Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.onRestrictEnableDisable(this,settings,pageContainer)}),submissionDiv.find("#"+divId+"_restricttimesheetsubmission").prop("checked",!1),tsPeriod===ts_period)){let tsSubmissionPeriod=Timetracker.generalSettings.getTSSubmissionPeriod(null,null,settings);tsSubmissionPeriod&&0!==Object.keys(tsSubmissionPeriod).length&&(submissionDiv.find("#"+divId+"_restricttimesheetsubmission").prop("checked",!0),submissionDiv.find("#"+divId+"_tsRestrict").trigger("click"))}},onRestrictEnableDisable:function(obj,settings,pageContainer){var divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)?"tss":"tus";pageContainer=pageContainer||settingsPage.container;var tsPeriod=Timetracker.generalSettings.getTSPeriod(null,null,settings),isEnabled=$(obj).find("input").is(":checked"),ts_submission_period_div=$(obj).closest("#"+divId+"_tssubmission_div"),ts_spanDiv=ts_submission_period_div.find("#"+divId+"_tsSpan");if(ts_spanDiv.addClass("zpl_DNI"),ts_spanDiv.find(".showhide_tsrange").hide(),ts_submission_period_div.find(".ztextbox--error__label").remove(),ts_submission_period_div.find("#"+divId+"_period_note").remove(),isEnabled){let ts_period=pageContainer.find("#"+divId+"_tsPeriod").find('input[name="tsPeriod"]:checked').val();if(ts_period===Timetracker.constants.TS_PERIOD.WEEK||ts_period===Timetracker.constants.TS_PERIOD.MONTH){let rangeoptions,dayoptions=[];ts_period===Timetracker.constants.TS_PERIOD.WEEK?(dayoptions=Timetracker.DateTime.constructDayOfWeekOptions(!0,!0),rangeoptions=[{label:ZPI18N.getString("zp.scurrentweek"),value:"0"},{label:ZPI18N.getString("zp.snextweek"),value:"1"}]):(dayoptions=Timetracker.DateTime.constructDayOfMonthOptions(void 0,!0,!0),rangeoptions=[{label:ZPI18N.getString("zp.scurrentmonth"),value:"0"},{label:ZPI18N.getString("zp.snextmonth"),value:"1"}]),ZPeopleComponents.isComponent("#"+divId+"_from_day")&&TimelyZComp.select.removeAllOptions(void 0,ts_submission_period_div),pageContainer.find("#"+divId+"_tsSpan").find("select").each(function(ind,ele){ZPeopleComponents.isComponent(ele)&&TimelyZComp.select.destroy(ele)});let appendTo=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)?pageContainer:pageContainer.find(".zpl_mcnt"),fromday=TimelyZComp.select.intialize(pageContainer.find("#"+divId+"_from_day"),{options:dayoptions,change:Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.onDayChange,dropdownList:{appendTo:appendTo}}),today=TimelyZComp.select.intialize(pageContainer.find("#"+divId+"_to_day"),{options:dayoptions,change:Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.onDayChange,dropdownList:{appendTo:appendTo}}),fromrange=TimelyZComp.select.intialize(pageContainer.find("#"+divId+"_from_range"),{options:rangeoptions,selectedValue:"0",change:Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.appendNote,dropdownList:{appendTo:appendTo}}),torange=TimelyZComp.select.intialize(pageContainer.find("#"+divId+"_to_range"),{options:rangeoptions,selectedValue:"0",change:Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.appendNote,dropdownList:{appendTo:appendTo}});if(fromrange.setValue("0"),torange.setValue("0"),ts_spanDiv.find("#from_range_span,#to_range_span").addClass("zpl_DNI"),tsPeriod===ts_period){var tsSubmissionPeriod=Timetracker.generalSettings.getTSSubmissionPeriod(null,null,settings);tsSubmissionPeriod&&0!==Object.keys(tsSubmissionPeriod).length&&(void 0!==tsSubmissionPeriod.from_day?(fromday.setValue(tsSubmissionPeriod.from_day),fromrange.setValue(tsSubmissionPeriod.from_range)):fromrange.deselectAllOptions(),void 0!==tsSubmissionPeriod.to_day?(today.setValue(tsSubmissionPeriod.to_day),torange.setValue(tsSubmissionPeriod.to_range)):torange.deselectAllOptions())}ts_spanDiv.removeClass("zpl_DNI")}}},onDayChange:function(event){var ele,divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)?"tss":"tus",day=$(this).val();event.target[0].id===divId+"_from_day"?ele=$(this).closest("#"+divId+"_tsSpan").find("#"+divId+"_from_range"):event.target[0].id===divId+"_to_day"&&(ele=$(this).closest("#"+divId+"_tsSpan").find("#"+divId+"_to_range")),ele&&void 0!=ele.data("zselect")&&(Timetracker.Validations.isDefiniteValue(day)&&"-1"!==day?$(this).closest("tr").find(".showhide_tsrange").show():$(this).closest("tr").find(".showhide_tsrange").hide()),Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.appendNote()},appendNote:function(event){var divId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)?"tss":"tus",ts_period=$("#"+divId+"_tsPeriod").find('input[name="tsPeriod"]:checked').val(),ts_submission_period_div=$("#"+divId+"_tssubmission_div"),ts_spanDiv=ts_submission_period_div.find("#"+divId+"_tsSpan");ts_submission_period_div.find(".ztextbox--error__label").remove(),ts_submission_period_div.find("#"+divId+"_period_note").remove();var note_content,from_day=TimelyZComp.select.getValue(ts_spanDiv.find("#"+divId+"_from_day"))||"-1",from_range=TimelyZComp.select.getValue(ts_spanDiv.find("#"+divId+"_from_range")),to_day=TimelyZComp.select.getValue(ts_spanDiv.find("#"+divId+"_to_day"))||"-1",to_range=TimelyZComp.select.getValue(ts_spanDiv.find("#"+divId+"_to_range")),msg_key=ts_period===Timetracker.constants.TS_PERIOD.WEEK?"week":ts_period===Timetracker.constants.TS_PERIOD.MONTH?"month":null,from_range_key=null!==from_range?"0"===from_range?"cur":"1"===from_range?"nxt":null:null,to_range_key=null!==to_range?"0"===to_range?"cur":"1"===to_range?"nxt":null:null;if(null!=msg_key)if("-1"!==from_day&&"-1"!==to_day){if(parseInt(from_range)>parseInt(to_range)||parseInt(from_day)>parseInt(to_day)&&parseInt(from_range)===parseInt(to_range))return void ts_spanDiv.find("table #tss_tsSpan_errmsg").html('<span class="ztextbox--error__label trRM">'+ZPI18N.getString("zp.tt.timesheetsettings.fromperiodgreaterthanto")+"</span>");note_content=from_day===to_day&&from_range===to_range?ZPI18N.getString("zp.tsperiod"+msg_key+from_range_key+"on",[Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,from_day)]):ZPI18N.getString("zp.tsperiod"+msg_key+from_range_key+to_range_key+"range",[Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,from_day),Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,to_day)])}else"-1"!==from_day&&"-1"===to_day?note_content=ZPI18N.getString("zp.tsperiod"+msg_key+from_range_key+"from",[Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,from_day)]):"-1"===from_day&&"-1"!==to_day&&(note_content=ZPI18N.getString("zp.tsperiod"+msg_key+to_range_key+"to",[Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,to_day)]));note_content&&(ts_submission_period_div.append('<div class="zpl_secn" id ="'+divId+'_period_note"><div class="zpl_info"><i class="PI_info"></i>'+note_content+"</div> </div>"),TimelyZComp.toolTip.intiliaze(ts_submission_period_div))},getPeriodValueForNote:function(ts_period,val){return ts_period===Timetracker.constants.TS_PERIOD.WEEK?Timetracker.DateTime.getDayOfWeek(parseInt(val)):ts_period===Timetracker.constants.TS_PERIOD.MONTH?Timetracker.DateTime.getDayOfMonth(parseInt(val),!0):val}},validateCriHrs:function(eventObj){const pageContainer=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)?settingsPage.container:settingsPage.container.find("#ttAddUserSettings");var hrsTime=$(eventObj).val(),hrsTime_mins=Timetracker.DateTime.convertToMins(hrsTime),inpId=$(eventObj).attr("id"),parentEventObj=$(eventObj).parent();Timetracker.util.removeErrorMsg(void 0,$(parentEventObj).closest("table"));var smallcasemin=ZPI18N.getString("zp.smallcasemin"),smallcasemax=ZPI18N.getString("zp.smallcasemax"),smallcaseperday=ZPI18N.getString("zp.smallcaseperday"),smallcaseperweek=ZPI18N.getString("zp.smallcaseperweek"),smallgreater=ZPI18N.getString("zp.smallgreater"),smalllesser=ZPI18N.getString("zp.smalllesser"),maxstr=ZPI18N.getString("zp.maximum"),minstr=ZPI18N.getString("zp.minimum"),errMsg="",hasError=!1,idPrefix_min=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)?"min":"tus_min",idPrefix_max=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)?"max":"tus_max";if(-1!==inpId.indexOf("min")){var selected=pageContainer.find("input[type='checkbox'][name='restrictmax']").is(":checked");if(selected){if(-1!==inpId.indexOf("day")){if(pageContainer.find("input[id='"+idPrefix_max+"hrsperday_chkbox']").is(":checked")){let hrsMax=pageContainer.find("#"+idPrefix_max+"_hrs_value_box").find("#"+idPrefix_max+"_per_day").val();hrsTime_mins>Timetracker.DateTime.convertToMins(hrsMax)&&(errMsg=ZPI18N.getString("zp.hrscrisubmiterrTS",[minstr,smallcaseperday,smallgreater,smallcasemax,smallcaseperday]),hasError=!0)}}else if(-1!==inpId.indexOf("week")){if(pageContainer.find("input[id='"+idPrefix_max+"hrsperweek_chkbox']").is(":checked")){let hrsMax=pageContainer.find("#"+idPrefix_max+"_hrs_value_box").find("#"+idPrefix_max+"_per_week").val();hrsTime_mins>Timetracker.DateTime.convertToMins(hrsMax)&&(errMsg=ZPI18N.getString("zp.hrscrisubmiterrTS",[minstr,smallcaseperweek,smallgreater,smallcasemax,smallcaseperweek]),hasError=!0)}}hasError&&($(parentEventObj).closest("table").find("#min_err").append('<span id="error_message_tscri" class="ztextbox--error__label trRm">'+errMsg+"</span>"),$(parentEventObj).closest("table").find("#min_err")[0].scrollIntoView({block:"center"}))}}else if(-1!==inpId.indexOf("max")&&(selected=pageContainer.find("input[type='checkbox'][name='restrictmin']").is(":checked"))){if(-1!==inpId.indexOf("day")){if(pageContainer.find("input[id='"+idPrefix_min+"hrsperday_chkbox']").is(":checked")){let hrsMin=pageContainer.find("#"+idPrefix_min+"_hrs_value_box").find("#"+idPrefix_min+"_per_day").val(),hrsMin_mins=Timetracker.DateTime.convertToMins(hrsMin);(isNaN(hrsMin_mins)||isNaN(hrsTime_mins)||hrsTime_mins<hrsMin_mins)&&(errMsg=ZPI18N.getString("zp.hrscrisubmiterrTS",[maxstr,smallcaseperday,smalllesser,smallcasemin,smallcaseperday]),hasError=!0)}}else if(-1!==inpId.indexOf("week")){if(pageContainer.find("input[id='"+idPrefix_min+"hrsperweek_chkbox']").is(":checked")){let hrsMin=pageContainer.find("#"+idPrefix_min+"_hrs_value_box").find("#"+idPrefix_min+"_per_week").val(),hrsMin_mins=Timetracker.DateTime.convertToMins(hrsMin);(isNaN(hrsTime_mins)||isNaN(hrsMin_mins)||hrsTime_mins<hrsMin_mins)&&(errMsg=ZPI18N.getString("zp.hrscrisubmiterrTS",[maxstr,smallcaseperweek,smalllesser,smallcasemin,smallcaseperweek]),hasError=!0)}}hasError&&($(parentEventObj).closest("table").find("#max_err").append('<span id="error_message_tscri" class="ztextbox--error__label trRm">'+errMsg+"</span>"),$(parentEventObj).closest("table").find("#max_err")[0].scrollIntoView({block:"center"}))}},showHideMinMaxHrsInput:function(id,enabledVal,data,type,pageContainer){pageContainer=pageContainer||settingsPage.container,Timetracker.util.removeErrorMsg(id,pageContainer);var idPrefix="min"===type?"min":"max";if(Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)||(idPrefix="min"===type?"tus_min":"tus_max"),enabledVal){pageContainer.find("#"+idPrefix+"_hrs_value_box").removeClass("zpl_DNI"),pageContainer.find("#"+idPrefix+"_per_day").removeClass("zpl_DNI"),pageContainer.find("#"+idPrefix+"_per_week").removeClass("zpl_DNI");let hrsType="min"===type?data.TS_MinHrsType:data.TS_MaxHrsType;pageContainer.find("#"+idPrefix+"hrsperday_chkbox, #"+idPrefix+"hrsperweek_chkbox").prop("checked",!1),pageContainer.find("#"+idPrefix+"_per_day, #"+idPrefix+"_per_week").addClass("is-disabled").prop("disabled",!0),"0"===hrsType?(pageContainer.find("#"+idPrefix+"hrsperday_chkbox").prop("checked","checked"),pageContainer.find("#"+idPrefix+"_per_day").removeClass("is-disabled").prop("disabled",!1)):"1"===hrsType?(pageContainer.find("#"+idPrefix+"hrsperweek_chkbox").prop("checked","checked"),pageContainer.find("#"+idPrefix+"_per_week").removeClass("is-disabled").prop("disabled",!1)):"2"===hrsType&&(pageContainer.find("#"+idPrefix+"hrsperday_chkbox, #"+idPrefix+"hrsperweek_chkbox").prop("checked","checked"),pageContainer.find("#"+idPrefix+"_per_day, #"+idPrefix+"_per_week").removeClass("is-disabled").prop("disabled",!1));let hours=0;hours="min"===type?void 0===data.TS_MinHrsPerDay?0:data.TS_MinHrsPerDay:void 0===data.TS_MaxHrsPerDay?0:data.TS_MaxHrsPerDay,pageContainer.find("#"+idPrefix+"_hrs_value_box").find("#"+idPrefix+"_per_day"),pageContainer.find("#"+idPrefix+"_hrs_value_box").find("#"+idPrefix+"_per_day").val(Calendar.minstohrs(hours)),hours="min"===type?void 0===data.TS_MinHrsPerWeek?0:data.TS_MinHrsPerWeek:void 0===data.TS_MaxHrsPerWeek?0:data.TS_MaxHrsPerWeek,pageContainer.find("#"+idPrefix+"_hrs_value_box").find("#"+idPrefix+"_per_day"),pageContainer.find("#"+idPrefix+"_hrs_value_box").find("#"+idPrefix+"_per_week").val(Calendar.minstohrs(hours))}else pageContainer.find("#"+idPrefix+"_hrs_value_box").addClass("zpl_DNI"),pageContainer.find("#"+idPrefix+"_per_day").addClass("zpl_DNI"),pageContainer.find("#"+idPrefix+"_per_week").addClass("zpl_DNI")},enableDisableMinMaxHrsInput:function(element,data){let type=$(element).attr("name"),isElementChecked=$(element).is(":checked"),inputFieldId=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS)?"":"tus_",hours=0;$(element).attr("id").includes("day")?"min_hours"===type?(hours=isElementChecked&&Timetracker.Validations.isDefiniteValue(data.TS_MinHrsPerDay)?data.TS_MinHrsPerDay:0,inputFieldId+="min_per_day"):(hours=isElementChecked&&Timetracker.Validations.isDefiniteValue(data.TS_MaxHrsPerDay)?data.TS_MaxHrsPerDay:0,inputFieldId+="max_per_day"):"min_hours"===type?(hours=isElementChecked&&Timetracker.Validations.isDefiniteValue(data.TS_MinHrsPerWeek)?data.TS_MinHrsPerWeek:0,inputFieldId+="min_per_week"):(hours=isElementChecked&&Timetracker.Validations.isDefiniteValue(data.TS_MaxHrsPerWeek)?data.TS_MaxHrsPerWeek:0,inputFieldId+="max_per_week"),isElementChecked?settingsPage.container.find("#"+inputFieldId).removeClass("is-disabled").prop("disabled",!1):settingsPage.container.find("#"+inputFieldId).addClass("is-disabled").prop("disabled",!0),settingsPage.container.find("#"+inputFieldId).val(Calendar.minstohrs(hours))},Currency:{currencyData:null,locationData:null,deletedCurrencies:"",currenciesData:null,fetchSetCurrenices:function(isFromReset){Timetracker.util.removeErrorMsg(),null===Timetracker.timesheetSettings.Currency.currenciesData?ZPeople.Request.send(Timetracker.constants.URL,{mode:"getLocCurrData"},function(resultData){Timetracker.timesheetSettings.Currency.updateCache(),Timetracker.timesheetSettings.Currency.constructCurLocOption(resultData.currenciesList,"currency"),Timetracker.timesheetSettings.Currency.constructCurLocOption(resultData.locArr,"locations"),Timetracker.timesheetSettings.Currency.currenciesData=resultData.currenciesData,Timetracker.timesheetSettings.Currency.setData(isFromReset),Timetracker.util.removeLoading()}):Timetracker.timesheetSettings.Currency.setData(isFromReset)},setData:function(isFromReset){isFromReset&&(Timetracker.timesheetSettings.Currency.deletedCurrencies=""),Timetracker.timesheetSettings.Currency.constructCurrencies(Timetracker.timesheetSettings.Currency.currenciesData)},constructCurrencies:function(result){var pageContainer=settingsPage.container,txt="";TimelyZComp.select.destroyAll(void 0,pageContainer.find("#currencies_body"));txt+='<div class="zpl_idiv"><div class="w200"><h5>'+ZPI18N.getString("zp.currency")+'</h5></div><div class="w200"><h5>'+ZPI18N.getString("zp.location")+"</h5></div></div>";for(var index=0;index<result.length;index++)result[index].hasOwnProperty("locationId")?txt+='<div class="zpl_idiv zpl_erorbx cur_loc_div"><div><select  elemType="select"><option value="0">'+ZPI18N.getString("zp.selectcurrency")+"</option>"+Timetracker.timesheetSettings.Currency.currencyData+'</select></div><div><select id="loc_option'+index+'" disabled="disabled"><option value="0">'+ZPI18N.getString("zp.selectlocation")+"</option>"+Timetracker.timesheetSettings.Currency.locationData+'</select></div><div><i class="PI_delete"  title='+ZPI18N.getString("zp.delete")+' onclick="Timetracker.timesheetSettings.Currency.deleteCurrencyRows(this);"></i></div></div>':result[index].locationName===ZPI18N.getString("zp.default")&&(txt+='<div class="zpl_idiv zpl_erorbx cur_loc_div"><div><select id="defaultCurrencyRow" elemType="select">'+Timetracker.timesheetSettings.Currency.currencyData+'</select></div><div><input type="text" class="ztextbox w200 is-disabled" disabled value="'+ZPI18N.getString("zp.default")+'"/></div></div>',index);txt+='<div class="zpl_idiv"><a class="zpl_lnkbg" onclick="Timetracker.timesheetSettings.Currency.addCurrencyRows()">'+ZPI18N.getString("zp.currencies.addcurrency")+"</a></div>",pageContainer.find("#currencies_body").html(txt);var count=0;pageContainer.find("#currencies_body > div.cur_loc_div").each(function(){$(this).attr("currencyId",result[count].currencyId);let textChildren=$(this).children();result[count].hasOwnProperty("locationId")&&TimelyZComp.select.intialize($(textChildren[1]).find("select"),{randomDropdownListId:!0,selectedValue:result[count].locationId,showSearchField:!0,lazyLoading:!0}),TimelyZComp.select.intialize($(textChildren[0]).find("select"),{randomDropdownListId:!0,selectedValue:result[count].currencyCode,showSearchField:!0,lazyLoading:!0}),count++}),Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timesheetSettings.showHideSaveResetbn,pageContainer.find("#currencies_body"))},getParamsForUpdateSettings:function(params){var pageContainer=settingsPage.container;Timetracker.util.removeErrorMsg();var cardDivId=pageContainer.find("#currencies_body"),isFromValCh=!(Object.keys(params).length>0),errorFlag=!1,currencyRepeat=!1,counter=0;let locationIdArray=[];var currencyArray=new Array;return errorFlag=!1,counter=0,pageContainer.find("#currencies_body > div.cur_loc_div").each(function(){let textChildren=$(this).children(),currencyId=$(this).attr("currencyId"),currencyValue=TimelyZComp.select.getValue($(textChildren[0]).find("select")),locationvalue=1===$(textChildren[1]).find("select").length?TimelyZComp.select.getValue($(textChildren[1]).find("select")):void 0;isFromValCh||"0"!==currencyValue||(Timetracker.Util.appenErrorMsgForElem({obj:$(textChildren[0]).find("select"),msg:ZPI18N.getString("zp.selectacur")}),errorFlag=!0),isFromValCh||"0"!==locationvalue||(Timetracker.Util.appenErrorMsgForElem({obj:$(textChildren[1]).find("select"),msg:ZPI18N.getString("zp.selectaloc")}),errorFlag=!0),locationIdArray.includes(locationvalue)?(currencyRepeat=!0,!errorFlag&&!isFromValCh&&Timetracker.Util.addError($(textChildren[1]).find("select"))):locationvalue&&locationIdArray.push(locationvalue),currencyId?TimelyZComp.select.getValue($(textChildren[0]).find("select"))===Timetracker.timesheetSettings.Currency.currenciesData[counter].currencyCode||Number(locationvalue)===Timetracker.timesheetSettings.Currency.currenciesData[counter].locationId||isNaN(Number(locationvalue)===Timetracker.timesheetSettings.Currency.currenciesData[counter].locationId)||currencyArray.push({currencyId:currencyId,currencyCode:currencyValue,locationCode:locationvalue!==ZPI18N.getString("zp.default")?locationvalue:void 0}):currencyArray.push({currencyCode:currencyValue,locationCode:locationvalue}),counter++}),isFromValCh||errorFlag||!currencyRepeat||(pageContainer.find("#currencies_body .zpl_idiv:last").before('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.tt.timesheetsettings.currencylocerror")+"</span>"),errorFlag=!0),!errorFlag&&(currencyArray.length>0||""!==Timetracker.timesheetSettings.Currency.deletedCurrencies)?(params.currencyArray=JSON.stringify(currencyArray),""!==Timetracker.timesheetSettings.Currency.deletedCurrencies&&(params.deletedCurrencies=Timetracker.timesheetSettings.Currency.deletedCurrencies),params):errorFlag?{isError:!0}:Timetracker.timesheetSettings.isSettingValueChanged(params,cardDivId)?params:null},addCurrencyRows:function(){var pageContainer=settingsPage.container,txt='<div class="zpl_idiv zpl_erorbx cur_loc_div"><div><select  elemType="select" style="display: none;"><option value="0">'+ZPI18N.getString("zp.selectcurrency")+"</option>"+Timetracker.timesheetSettings.Currency.currencyData+'</select></div><div><select style="display: none;"><option value="0">'+ZPI18N.getString("zp.selectlocation")+"</option>"+Timetracker.timesheetSettings.Currency.locationData+'</select></div><div><i class="PI_delete"  title='+ZPI18N.getString("zp.delete")+' onclick="Timetracker.timesheetSettings.Currency.deleteCurrencyRows(this);"></i></div></div>';pageContainer.find("#currencies_body > div:last").before(txt);var textChildren=pageContainer.find("#currencies_body > div:last").prev().children();TimelyZComp.select.intialize($(textChildren[0]).find("select"),{randomDropdownListId:!0,showSearchField:!0}),TimelyZComp.select.intialize($(textChildren[1]).find("select"),{randomDropdownListId:!0,showSearchField:!0}),Timetracker.genSettings.addEvntLsnrforChange(Timetracker.timesheetSettings.showHideSaveResetbn,textChildren)},deleteCurrencyRows:function(obj){var pageContainer=settingsPage.container;if(pageContainer.find("#currencies_body").parent().find(".ERR").remove(),1!==pageContainer.find("#currencies_body > div.cur_loc_div").length){let currencyId=$(obj).parent().parent().attr("currencyId");currencyId&&(Timetracker.timesheetSettings.Currency.deletedCurrencies+=currencyId+",");let textChildren=$(obj).parent().siblings();TimelyZComp.select.destroyAll(void 0,textChildren),$(obj).closest(".zpl_idiv").remove(),1===pageContainer.find("#currencies_body > div.cur_loc_div").length&&pageContainer.find("#currencies_body > div:not(:last)").find(".PI_delete").parent().hide()}Timetracker.timesheetSettings.showHideSaveResetbn(pageContainer.find("#currencies_body"))},constructCurLocOption:function(List,type){for(var varKey="currency"===type?"curCode":"locationId",nameKey="currency"===type?"curName":"locationName",id="currency"===type?"currency_info":"location_info",txt="",i=0;i<List.length;i++){List[i];txt+='<option value="'+List[i][varKey]+'">'+List[i][nameKey]+"</option>"}settingsPage.container.find("#"+("currency"===type?"tss_currenciesCard":"tbs_taxCard")).data(id,txt),"currency"===type?Timetracker.timesheetSettings.Currency.currencyData=txt:Timetracker.timesheetSettings.Currency.locationData=txt},updateCache:function(){Timetracker.timesheetSettings.Currency.deletedCurrencies="",Timetracker.timesheetSettings.Currency.currenciesData=null}}},Timetracker.jobScheduleSettings={init:function(){if(Timetracker.genSettings.init(),!Timetracker.genSettings.permissionCheck()||!Timetracker.jobSchedule.isJobScheduleEnabled())return;const pageContainer=settingsPage.container;Timetracker.genSettings.removeTopButton(pageContainer),Timetracker.jobScheduleSettings.constructHtml(),Timetracker.jobScheduleSettings.intializeEventListeners(),Timetracker.jobScheduleSettings.setData(Timetracker.generalSettings.settingDetails)},constructHtml:function(){const pageContainer=settingsPage.container;if(!Timetracker.genSettings.isHtmlConstructed()){var html=Timetracker.genSettings.getHeaderBandHtml({header:ZPI18N.getString("zp.jobschedule"),description:ZPI18N.getString("zp.tt.jssettings.topbandtext")});html+=`<div class="zpl_rgtcnt">\n\t\t\t\t\t\t\t<div class="zpl_crd" cardId="jss_PermissionsCard">\n\t\t\t\t\t     \t   \t<div class="zpl_crdhdr"><div><h4>${ZPI18N.getString("zp.tt.jssettings.jobschedulepermissions")}</h4><p>${ZPI18N.getString("zp.tt.jssettings.jobscheduledesc",[""])}</p></div>${Timetracker.genSettings.addSaveResetButton("Timetracker.jobScheduleSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.jobScheduleSettings.updateData(this)")}</div> \n\t\t\t\t\t     \t    <div class="zpl_crdcnt"><div class="zpl_secn">`+`<div class="zpl_tblres">\n\t\t  \t\t\t\t\t\t\t\t<table class="zpl_tbl zpl_tblcntr">\n\t\t  \t\t\t\t\t\t\t\t\t<thead><tr><th>${ZPI18N.getString("zp.lms.permissions")}</th><th>${ZPI18N.getString("zp.srepman")}</th><th>${ZPI18N.getString("zp.local.employeesself")}</th></tr></thead>\n\t\t  \t\t\t\t\t\t\t\t\t<tbody>\n\t\t  \t\t\t\t\t\t\t\t\t\t<tr name="hierarchyChk">\n\t\t  \t\t\t\t\t\t\t\t\t\t\t<td><span>${ZPI18N.getString("zp.tt.jssettings.jobscheduleviewby",[""])}</span></td>\n\t\t\t\t\t\t\t                        <td><div class="zcheckbox"><input id="jss_jobschd_view_settings_rm" type="checkbox" name="js_viewpermission"  class="zcheckbox__helper"><label for="jss_jobschd_view_settings_rm" class="zcheckbox__label"></label></div></td>`+'<td><div class="zcheckbox"><input id="jss_jobschd_view_settings_users" type="checkbox" name="js_viewpermission"class="zcheckbox__helper"><label for="jss_jobschd_view_settings_users" class="zcheckbox__label"></label></div></td>'+`</tr>\n\t\t\t\t\t\t\t                     <tr name="hierarchyChk">\n\t\t\t\t\t\t\t                        <td><span>${ZPI18N.getString("zp.tt.jssettings.jobscheduleeditby",[""])}</span></td>\n\t\t\t\t\t\t\t                        <td><div class="zcheckbox"><input id="jss_jobschd_edit_settings_rm" type="checkbox" name="js_editpermission"  class="zcheckbox__helper"><label for="jss_jobschd_edit_settings_rm" class="zcheckbox__label"></label></div></td>`+`<td><div class="zcheckbox"><input id="jss_jobschd_edit_settings_users" type="checkbox" name="js_editpermission"  class="zcheckbox__helper"><label for="jss_jobschd_edit_settings_users" class="zcheckbox__label"></label></td> \n\t\t\t\t\t\t\t                      </tr>\n\t\t\t\t\t\t                    </tbody>\n\t\t\t\t\t\t                 </table>\n\t\t\t\t\t\t              </div>\n\t\t\t\t\t\t\t\t   </div>\n\t\t\t\t  \t\t\t\t</div></div>\n\t\t\t\t  \t\t\t</div>\n\t\t\t\t  \t\t</div>\n\t\t\t\t\t\t<div class="zpl_crd" cardId="jss_RestrictionsCard">\n\t\t\t\t  \t\t\t<div class="zpl_crdhdr"><div><h4>${ZPI18N.getString("zp.tt.jssettings.jobschedulerestrictions")}</h4><p>${ZPI18N.getString("zp.tt.jssettings.jobschedulerestrictionsdesc")}</p></div>${Timetracker.genSettings.addSaveResetButton("Timetracker.jobScheduleSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.jobScheduleSettings.updateData(this)")}</div>\n\t\t\t\t\t\t    <div class="zpl_crdcnt">\n\t\t\t\t\t              <div class="zpl_secn">\n\t\t\t\t\t                 <div><h5>${ZPI18N.getString("zp.jobschdweekendholsetting",[""])}</h5></div> \n\t\t\t\t\t                 <div>\n\t\t\t\t\t\t\t\t\t\t<div class="zcheckbox"><input id="jss_jobschd_exclude_weekend" type="checkbox" name="js_exclude_series" class="zcheckbox__helper" checked=""><label for="jss_jobschd_exclude_weekend" class="zcheckbox__label">${ZPI18N.getString("zp.weekends")}</label></div>\n\t\t\t\t\t\t\t\t\t\t<div class="zcheckbox"><input id="jss_jobschd_exclude_holiday" type="checkbox" name="js_exclude_series" class="zcheckbox__helper" checked=""><label for="jss_jobschd_exclude_holiday" class="zcheckbox__label">${holiday_disName}</label></div>\n\t\t\t\t\t\t\t\t\t\t<div class="zcheckbox"><input id="jss_jobschd_exclude_leave" type="checkbox" name="js_exclude_series" class="zcheckbox__helper"><label for="jss_jobschd_exclude_leave" class="zcheckbox__label">${ZPI18N.getString("zp.leave")}</label></div>\n\t\t\t\t\t                 </div>\n\t\t\t\t\t              </div>\n\t\t\t\t\t              <div class="zpl_secn">\n\t\t\t\t\t                <div><h5>${ZPI18N.getString("zp.tt.jssettings.hideinview")}</h5></div> \n\t\t\t\t\t                <div>\n\t\t\t\t\t                  \t<div class="zcheckbox"> <input id="jss_jobschd_hide_weekend" type="checkbox" name="js_hide" class="zcheckbox__helper"><label for="jss_jobschd_hide_weekend" class="zcheckbox__label">${ZPI18N.getString("zp.weekends")}</label></div>\n\t\t\t\t\t\t\t\t\t\t<div class="zcheckbox"> <input id="jss_jobschd_hide_holiday" type="checkbox" name="js_hide" class="zcheckbox__helper"><label for="jss_jobschd_hide_holiday" class="zcheckbox__label">${holiday_disName}</label></div>\n\t\t\t\t\t\t\t\t\t\t<div class="zcheckbox"><input id="jss_jobschd_hide_leave" type="checkbox" name="js_hide" class="zcheckbox__helper"><label for="jss_jobschd_hide_leave" class="zcheckbox__label">${ZPI18N.getString("zp.leave")}</label></div>\n\t\t\t\t\t                </div>\n\t\t\t\t\t              </div>\n\t\t\t\t\t            </div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t    </div>\n\t\t\t\t\t\t<div class="zpl_crd" cardId="jss_NotifyCard"> \n\t\t\t\t\t\t\t<div class="zpl_crdhdr">\n\t\t\t\t\t\t\t    <div><h4>${ZPI18N.getString("zp.tt.jssettings.publishedschedulenotify",[""])}</h4><p>${ZPI18N.getString("zp.tt.jssettings.feedsnotificationdesc")}</p></div>${Timetracker.genSettings.addSaveResetButton("Timetracker.jobScheduleSettings.setData(Timetracker.generalSettings.settingDetails,this)","Timetracker.jobScheduleSettings.updateData(this)")}</div>`+`<div class="zpl_crdcnt">\n\t\t\t\t\t\t          <div class="zpl_secn">\n\t\t\t\t\t\t              <div>\n\t\t\t\t\t\t                <div class="zcheckbox zcheckbox--horizontal"><input id="tt_jobschd_mailnotify" type="checkbox" name="tt_jobschd_mailnotify_settings" class="zcheckbox__helper"><label for="tt_jobschd_mailnotify" class="zcheckbox__label">${ZPI18N.getString("zp.mail")}</label></div>`+`<div class="zcheckbox zcheckbox--horizontal"><input id="tt_jobschd_feednotify" type="checkbox" name="tt_jobschd_feednotify_settings" class="zcheckbox__helper"><label for="tt_jobschd_feednotify" class="zcheckbox__label">${ZPI18N.getString("zp.tt.jssettings.feedsnotification")}</label></div>`+"</div> \n\t\t\t\t\t\t          </div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t    </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>",pageContainer.html(html)}},intializeEventListeners:function(){Timetracker.jobScheduleSettings.addCheckBxEventLsnr(),Timetracker.genSettings.addEvntLsnrforChange(Timetracker.jobScheduleSettings.showHideSaveResetbn)},setData:function(settingsData,cardDiv){if(Timetracker.jobSchedule.isJobScheduleEnabled()){Timetracker.generalSettings.settingDetails;const pageContainer=cardDiv&&$(cardDiv).closest(".zpl_crd")||settingsPage.container;let cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");if(!cardDivId||"jss_PermissionsCard"===cardDivId){let jobSchedViewPerm=settingsData.TS_jobScheduleView?settingsData.TS_jobScheduleView:2;pageContainer.find("#jss_jobschd_view_settings_rm,#jss_jobschd_view_settings_users").prop("checked",!1),"2"===jobSchedViewPerm?pageContainer.find("#jss_jobschd_view_settings_rm,#jss_jobschd_view_settings_users").prop("checked",!0):"1"===jobSchedViewPerm&&pageContainer.find("#jss_jobschd_view_settings_rm").prop("checked",!0);let jobSchedEditPerm=settingsData.TS_jobScheduleEdit?settingsData.TS_jobScheduleEdit:2;pageContainer.find("#jss_jobschd_edit_settings_rm,#jss_jobschd_edit_settings_users").prop("checked",!1),"2"===jobSchedEditPerm?pageContainer.find("#jss_jobschd_edit_settings_rm,#jss_jobschd_edit_settings_users").prop("checked",!0):"1"===jobSchedEditPerm&&pageContainer.find("#jss_jobschd_edit_settings_rm").prop("checked",!0)}cardDivId&&"jss_RestrictionsCard"!==cardDivId||(pageContainer.find("#jss_jobschd_exclude_weekend").prop("checked","1"===settingsData.TS_excludeJobSchdOnWeekEnds),pageContainer.find("#jss_jobschd_exclude_holiday").prop("checked","1"===settingsData.TS_excludeJobSchdOnHolidays),pageContainer.find("#jss_jobschd_exclude_leave").prop("checked","1"===settingsData.TS_excludeJobSchdOnLeave),pageContainer.find("#jss_jobschd_hide_weekend").prop("checked","1"===settingsData.TS_hideWeekEndsInJobSchd),pageContainer.find("#jss_jobschd_hide_holiday").prop("checked","1"===settingsData.TS_hideHolidaysInJobSchd),pageContainer.find("#jss_jobschd_hide_leave").prop("checked","1"===settingsData.TS_hideLeaveInJobSchd)),cardDivId&&"jss_NotifyCard"!==cardDivId||(pageContainer.find("#tt_jobschd_mailnotify").prop("checked",settingsData.TS_jobSchdPublishMailNotify&&"1"===settingsData.TS_jobSchdPublishMailNotify),pageContainer.find("#tt_jobschd_feednotify").prop("checked",settingsData.TS_jobSchdPublishFeedNotify&&"1"===settingsData.TS_jobSchdPublishFeedNotify))}else pageContainer.find(".ZP_JobSchd").remove();Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING)},addCheckBxEventLsnr:function(pageContainer){(pageContainer=pageContainer||settingsPage.container).find("tr[name='hierarchyChk'] input[type=checkbox]").off("click").on("click",function(){let div=$(this).closest("table"),isChecked=$(this).prop("checked"),id=$(this).attr("id");isChecked?"jss_jobschd_edit_settings_users"===id?div.find("input[name='js_viewpermission'],[name='js_editpermission']").prop("checked",isChecked):"jss_jobschd_edit_settings_rm"!==id&&"jss_jobschd_view_settings_users"!==id||div.find("#jss_jobschd_view_settings_rm").prop("checked",isChecked):"jss_jobschd_view_settings_rm"===id?div.find("input[name='js_viewpermission'],[name='js_editpermission']").prop("checked",isChecked):"jss_jobschd_edit_settings_rm"!==id&&"jss_jobschd_view_settings_users"!==id||div.find("#jss_jobschd_edit_settings_users").prop("checked",isChecked)})},getJobSchedulePermission:function(params){const pageContainer=settingsPage.container;var viewPerm="0",editPerm="0";return pageContainer.find("#jss_jobschd_view_settings_users").is(":checked")?viewPerm="2":pageContainer.find("#jss_jobschd_view_settings_rm").is(":checked")&&(viewPerm="1"),pageContainer.find("#jss_jobschd_edit_settings_users").is(":checked")?editPerm="2":pageContainer.find("#jss_jobschd_edit_settings_rm").is(":checked")&&(editPerm="1"),viewPerm<editPerm?(Timetracker.util.showAlert(0,ZPI18N.getString("zp.tt.jssettings.editpermerr")),!1):(viewPerm&&editPerm&&(params.jobScheduleView=viewPerm,params.jobScheduleEdit=editPerm),!0)},updateData:function(cardDiv){settingsPage.container;var params={mode:"updateTimetrackerSettings",conreqcsr:csrfToken,subMode:Timetracker.constants.SETTINGS.MODE.JOBSCHEDULESETTINGS};null!=(params=Timetracker.jobScheduleSettings.getParamsForUpdateSettings(params,Timetracker.generalSettings.settingDetails,cardDiv))&&(params.fetchUpdatedSetings=!0),null!=params&&params.hasOwnProperty("isError")||(null==params||params.hasOwnProperty("isError")?Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")):(Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVING),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){Timetracker.genSettings.updateCache(response),Timetracker.jobScheduleSettings.setData(Timetracker.generalSettings.settingDetails,cardDiv),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVED)},{},Timetracker.Util.generalFailureCallback)))},getParamsForUpdateSettings:function(params,settingsData,cardDiv){const pageContainer=$(cardDiv).closest(".zpl_crd")||settingsPage.container.find(".zpl_crd");var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");switch(Timetracker.util.removeErrorMsg(),cardDivId){case"jss_PermissionsCard":if(!Timetracker.jobScheduleSettings.getJobSchedulePermission(params))return{isError:!0};break;case"jss_RestrictionsCard":params.excludeJobSchdOnWeekEnds=pageContainer.find("#jss_jobschd_exclude_weekend").is(":checked")?"1":"0",params.excludeJobSchdOnHolidays=pageContainer.find("#jss_jobschd_exclude_holiday").is(":checked")?"1":"0",params.excludeJobSchdOnLeave=pageContainer.find("#jss_jobschd_exclude_leave").is(":checked")?"1":"0",params.hideWeekEndsInJobSchd=pageContainer.find("#jss_jobschd_hide_weekend").is(":checked")?"1":"0",params.hideHolidaysInJobSchd=pageContainer.find("#jss_jobschd_hide_holiday").is(":checked")?"1":"0",params.hideLeaveInJobSchd=pageContainer.find("#jss_jobschd_hide_leave").is(":checked")?"1":"0";break;case"jss_NotifyCard":params.jobSchdPubMailNotification=pageContainer.find("#tt_jobschd_mailnotify").is(":checked")?"1":"0",params.jobSchdPubFeedNotification=pageContainer.find("#tt_jobschd_feednotify").is(":checked")?"1":"0"}return Timetracker.jobScheduleSettings.isSettingValueChanged(params,settingsData,cardDiv)?params:null},showHideSaveResetbn:function(cardDiv){cardDiv=cardDiv.target?cardDiv.target:cardDiv,null!==Timetracker.jobScheduleSettings.getParamsForUpdateSettings({},Timetracker.generalSettings.settingDetails,cardDiv)?Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVERESET):Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING)},isSettingValueChanged:function(params,settingsData,cardDiv){$(cardDiv).closest(".zpl_crd")||settingsPage.container.find(".zpl_crd");var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");switch(Timetracker.util.removeErrorMsg(),cardDivId){case"jss_PermissionsCard":return void 0!==params.jobScheduleView&&settingsData.TS_jobScheduleView!==params.jobScheduleView||void 0!==params.jobScheduleEdit&&settingsData.TS_jobScheduleEdit!==params.jobScheduleEdit;case"jss_RestrictionsCard":return void 0!==params.excludeJobSchdOnWeekEnds&&settingsData.TS_excludeJobSchdOnWeekEnds!==params.excludeJobSchdOnWeekEnds||void 0!==params.excludeJobSchdOnHolidays&&settingsData.TS_excludeJobSchdOnHolidays!==params.excludeJobSchdOnHolidays||void 0!==params.excludeJobSchdOnLeave&&settingsData.TS_excludeJobSchdOnLeave!==params.excludeJobSchdOnLeave||void 0!==params.hideWeekEndsInJobSchd&&settingsData.TS_hideWeekEndsInJobSchd!==params.hideWeekEndsInJobSchd||void 0!==params.hideHolidaysInJobSchd&&settingsData.TS_hideHolidaysInJobSchd!==params.hideHolidaysInJobSchd||void 0!==params.hideLeaveInJobSchd&&settingsData.TS_hideLeaveInJobSchd!==params.hideLeaveInJobSchd;case"jss_NotifyCard":return void 0!==params.jobSchdPubMailNotification&&settingsData.TS_jobSchdPublishMailNotify!==params.jobSchdPubMailNotification||void 0!==params.jobSchdPubFeedNotification&&settingsData.TS_jobSchdPublishFeedNotify!==params.jobSchdPubFeedNotification}return!1}},Timetracker.employeeRPH={editMode:!1,editData:{},userRatingArray:new Array,fetchUserRate:!0,init:function(){Timetracker.genSettings.init(),Timetracker.permissionCheckForOperPages()&&Timetracker.employeeRPH.getUserRating()},getUserRating:function(fetchUserRate){ModuleComp.Modal.hide("ttAddUserRating"),fetchUserRate&&(Timetracker.employeeRPH.fetchUserRate=fetchUserRate),Timetracker.util.appendLoading(void 0,{fullPageModal:!0}),Timetracker.employeeRPH.fetchUserRate?ZPeople.Request.send(Timetracker.constants.URL,{mode:"getUserRating"},function(resultData){Timetracker.employeeRPH.constructUserRating(resultData),Timetracker.employeeRPH.userRatingArray=resultData,Timetracker.employeeRPH.fetchUserRate=!1,TimelyZComp.toolTip.intiliaze()}):(Timetracker.employeeRPH.constructUserRating(Timetracker.employeeRPH.userRatingArray),TimelyZComp.toolTip.intiliaze())},constructUserRatingPage:function(){const pageContainer=settingsPage.container;var html=Timetracker.genSettings.getHeaderBandHtml({header:ZPI18N.getString("zp.tt.emloyeeRPH.employeerate"),description:ZPI18N.getString("zp.tt.emloyeeRPH.popupinfo"),headerExtraClass:"zpl_topcrdhdr"})+'<div class="zpl_btnmnu"><div class="zpl_rgt"><button class="zlabel zlabel--blue zlabel--medium" data-popup-open="addemprate" onclick="Timetracker.employeeRPH.showAddUserRating()" ref="addRPH">'+ZPI18N.getString("zp.adduserrate")+'</button><i class="zpl_ibg PI_more" title='+ZPI18N.getString("zp.more")+' ref="more" id="employeeRPHMoreOptionsBtn"></i></div></div><div class="zpl_rgtcnt"><div class="zpl_tblres" id="empRPHList"><table class="zpl_tbl clm40"><thead><tr><th>'+ZPI18N.getString("zp.leave.operations.employeename")+"</th><th>"+ZPI18N.getString("zp.tt.emloyeeRPH.rateperhour")+"</th><th>"+ZPI18N.getString("zp.tt.emloyeeRPH.otrateperhour")+"</th><th>"+ZPI18N.getString("zp.tt.emloyeeRPH.extendedotrateperhour")+'</th><th width="80"></th></tr></thead><tbody id="tsoperations-ratetbody"></tbody></table></div><div id="zp_empty_data"/></div></div>';pageContainer.html(html);var moreOpt=[{id:"emploeeRPHImportIcon",name:ZPI18N.getString("zp.import"),callback:"Timetracker.employeeRPH.Import.construct",iClass:"PI_imprt"}];Timetracker.Util.constructMoreOption(moreOpt,"employeeRPHMoreOptions"),Timetracker.genSettings.addTablFxdCls()},constructUserRating:function(result){const pageContainer=settingsPage.container;if(0===pageContainer.find("#empRPHList").length&&Timetracker.employeeRPH.constructUserRatingPage(),pageContainer.find("#zp_empty_data,#empRPHList").hide(),pageContainer.find("#tsoperations-ratetbody").html(""),0===result.length||""===result)Timetracker.util.removeLoading(),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.tt.emloyeeRPH.noemployeerateadded"),buttonName:ZPI18N.getString("zp.adduserrate"),buttonCallBack:Timetracker.employeeRPH.showAddUserRating,desc:ZPI18N.getString("zp.tt.emloyeeRPH.popupinfo")}),pageContainer.find("[ref=addRPH]").addClass("DNI"),pageContainer.find("#zp_empty_data").show();else{Timetracker.Util.showHideNoData({remove:!0}),pageContainer.find("[ref=addRPH]").removeClass("DNI");let docFrag=document.createDocumentFragment(),rateBody=pageContainer.find("#tsoperations-ratetbody");$.each(result,function(index,data){let txt='<tr id="userrate_'+data.erecno+'">';txt+='<td><div class="zpl_em"><div class="zpl_emimg"><img class="FL" src="'+data.EMPLOYEEPHOTO+'"></div><div class="zpl_emdts"><div><em>'+data.empId+" -</em><b>"+data.empName+"</b></div></div></div></td>",txt+="<td><span>"+data.rateperhour+"</span></td>",txt+="<td><span>"+(data.ot_singlerateperhour?data.ot_singlerateperhour:0)+"</span></td>",txt+="<td><span>"+(data.ot_doublerateperhour?data.ot_doublerateperhour:0)+"</span></td>",txt+='<td><div class="zpl_hvr" ref="delete"><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+' ref="delete"></i></div></td>',txt+="</tr>",(txt=$(txt)).data(data),txt.on("click","td:not(:last-child)",function(){Timetracker.employeeRPH.showEditUserRating(data)}),txt.find("i.PI_delete").on("click",function(){var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.tt.emloyeeRPH.semployeerate")]),body:ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.tt.emloyeeRPH.semployeerate")]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(data.ratingId,Timetracker.employeeRPH.deleteUserRating,data,0,extraDtls)}),docFrag.append(txt[0])}),rateBody.append(docFrag),pageContainer.find("#empRPHList").fadeIn(200),Timetracker.util.removeLoading()}},showAddUserRating:function(){Timetracker.employeeRPH.editMode=!1,Timetracker.employeeRPH.showAddEditUserRating()},showEditUserRating:function(data){Timetracker.employeeRPH.editMode=!0,Timetracker.employeeRPH.editData=data,Timetracker.employeeRPH.showAddEditUserRating()},showAddEditUserRating:function(){var modal=settingsPage.container.find("#ttAddUserRating");0==modal.length?modal=Timetracker.employeeRPH.constructUserRatingPopup():(Timetracker.util.removeErrorMsg("adduserrating"),ModuleComp.Modal.show(modal)),TimelyZComp.toolTip.customMsgIntz(modal,[{class:"PI_cls",title:ZPI18N.getString("zp.close")}]),Timetracker.employeeRPH.resetUserRatingPopup(modal)},constructUserRatingPopup:function(){var body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.leave.operations.employeename")+'</font></label></div><div><select id="tsoperations_rphuser" elemType="select"></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.tt.emloyeeRPH.rateperhour")+'</font></label></div><div><input type="text" class="ztextbox" id="tsoperations-rate" value="0"></div></div><div class="zpl_secn"><div><label><font>'+ZPI18N.getString("zp.tt.emloyeeRPH.otrateperhour")+'</font></label></div><div><input type="text" class="ztextbox" id="tsoperations_ot_srate" value="0" ></div></div><div class="zpl_secn"><div><label><font>'+ZPI18N.getString("zp.tt.emloyeeRPH.extendedotrateperhour")+'</font></label></div><div><input type="text" class="ztextbox" id="tsoperations_ot_drate" value="0"></div></div></div></div>';ModuleComp.Modal.setup({id:"ttAddUserRating",type:1,header:Timetracker.employeeRPH.editMode?ZPI18N.getString("zp.tt.emloyeeRPH.editemployeerate"):ZPI18N.getString("zp.tt.emloyeeRPH.addemployeerate"),body:body,backdrop:!1,deleteOnHide:!0,closeOnSubmit:!1,buttonValue:ZPI18N.getString("zp.save"),hiddenCallback:TimelyZComp.destroy,successCallback:Timetracker.employeeRPH.addModifyUserRating,closeonEsc:!0,LayerId:settingsPage.container[0].id});return settingsPage.container.find("#ttAddUserRating")},resetUserRatingPopup:function(modal){if(Timetracker.employeeRPH.editMode){modal.find("#adduserrating").find("#zp_modal_header").text(ZPI18N.getString("zp.tt.emloyeeRPH.editemployeerate"));let data=Timetracker.employeeRPH.editData;Timetracker.Search.populateZCompUsers("tsoperations_rphuser",{id:data.erecno,text:ZPeople.decodeTxt(data.empId+" "+data.empName),html:data.empId+" "+data.empName,photo:data.EMPLOYEEPHOTO},{submode:"TIMETRACKER_SETTINGS",placeHolder:ZPI18N.getString("zp.selectemployee"),useDefaultValuesCache:!0},!1,modal),modal.find("#tsoperations-rate").val(data.rateperhour),modal.find("#tsoperations_ot_srate").val(data.ot_singlerateperhour),modal.find("#tsoperations_ot_drate").val(data.ot_doublerateperhour)}else modal.find("#adduserrating").find("#zp_modal_header").text(ZPI18N.getString("zp.tt.emloyeeRPH.addemployeerate")),modal.find("#tsoperations-rate").val(0),modal.find("#tsoperations_ot_srate,#tsoperations_ot_drate").val(0),Timetracker.Search.populateZCompUsers("tsoperations_rphuser",void 0,{submode:"TIMETRACKER_SETTINGS",placeHolder:ZPI18N.getString("zp.selectemployee"),useDefaultValuesCache:!0},!1,modal);modal.find("#tsoperations_rphuser").on("zselectchange",Timetracker.employeeRPH.userRatingChange)},addModifyUserRating:function(modalContainer){const pageContainer=settingsPage.container,submitButton=modalContainer.find("#zp_modal_blubtn");submitButton.prop("disabled",!0),Timetracker.util.removeErrorMsg("adduserrating",modalContainer);var ratinguser=TimelyZComp.select.getValue(modalContainer.find("#tsoperations_rphuser"));if("-1"===ratinguser||"0"===ratinguser||""===ratinguser)return Timetracker.Util.appenErrorMsgForElem({obj:modalContainer.find("#tsoperations_rphuser"),msg:ZPI18N.getString("zp.selectemptoaddrate")}),submitButton.prop("disabled",!1),!1;var rateperhour=modalContainer.find("#tsoperations-rate").val().trim();if(Timetracker.Validations.isEmpty(rateperhour))return Timetracker.Util.appenErrorMsgForElem({obj:modalContainer.find("#tsoperations-rate"),msg:ZPI18N.getString("zp.tt.emloyeeRPH.employeerateemptyerrmsg")}),submitButton.prop("disabled",!1),!1;if(!Timetracker.Validations.isDecimal(rateperhour))return Timetracker.Util.appenErrorMsgForElem({obj:modalContainer.find("#tsoperations-rate"),msg:ZPI18N.getString("zp.tt.emloyeeRPH.employeerateinvaliderrmsg")}),submitButton.prop("disabled",!1),!1;var ot_srateperhour=modalContainer.find("#tsoperations_ot_srate").val().trim();if(""===ot_srateperhour&&(ot_srateperhour="0"),!Timetracker.Validations.isDecimal(ot_srateperhour))return Timetracker.Util.appenErrorMsgForElem({obj:modalContainer.find("#tsoperations_ot_srate"),msg:ZPI18N.getString("zp.tt.emloyeeRPH.employeerateinvaliderrmsg")}),submitButton.prop("disabled",!1),!1;var ot_drateperhour=modalContainer.find("#tsoperations_ot_drate").val().trim();if(""===ot_drateperhour&&(ot_drateperhour="0"),!Timetracker.Validations.isDecimal(ot_drateperhour))return Timetracker.Util.appenErrorMsgForElem({obj:modalContainer.find("#tsoperations_ot_drate"),msg:ZPI18N.getString("zp.tt.emloyeeRPH.employeerateinvaliderrmsg")}),submitButton.prop("disabled",!1),!1;var noEdit=!1;if(pageContainer.find("#userrate_"+ratinguser).length>0){var data=pageContainer.find("#userrate_"+ratinguser).closest("tr").data();data.rateperhour==Number(rateperhour)&&data.ot_singlerateperhour==Number(ot_srateperhour)&&data.ot_doublerateperhour==Number(ot_drateperhour)&&(noEdit=!0)}if(noEdit)Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"));else{var params={mode:"addUserRating",userErecNo:ratinguser,rateperhour:rateperhour,ot_singlerateperhour:ot_srateperhour,ot_doublerateperhour:ot_drateperhour};pageContainer.find("#zp_empty_data,#empRPHList").hide(),Timetracker.util.appendLoading(),ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){Timetracker.employeeRPH.fetchUserRate=!0,Timetracker.timesheet.userRates=null,Timetracker.employeeRPH.getUserRating(),Timetracker.employeeRPH.editMode?Timetracker.util.showAlert(2,ZPI18N.getString("zp.tt.emloyeeRPH.editmsg")):Timetracker.util.showAlert(2,ZPI18N.getString("zp.tt.emloyeeRPH.addedmsg"))})}submitButton.prop("disabled",!1),ModuleComp.Modal.hide("ttAddUserRating")},userRatingChange:function(obj){Timetracker.util.removeErrorMsg("adduserrating");const ModelContainer=settingsPage.container.find("#ttAddUserRating"),pageContainer=settingsPage.container;var selectValue=obj&&obj.detail?obj.detail.selectedValue:null;if(pageContainer.find("#userrate_"+selectValue).length>0){let data=pageContainer.find("#userrate_"+selectValue).closest("tr").data();ModelContainer.find("#tsoperations-rate").val(data.rateperhour),ModelContainer.find("#tsoperations_ot_srate").val(data.ot_singlerateperhour),ModelContainer.find("#tsoperations_ot_drate").val(data.ot_doublerateperhour)}else ModelContainer.find("#tsoperations-rate").val(""),ModelContainer.find("#tsoperations_ot_srate,#tsoperations_ot_drate").val(0)},deleteUserRating:function(data){data.ratingId&&data.erecno&&(settingsPage.container.find("#zp_empty_data,#empRPHList").hide(),Timetracker.util.appendLoading(),ZPeople.Request.send(Timetracker.constants.URL,{mode:"deleteUserRating",rateId:data.ratingId,userErecNo:data.erecno,conreqcsr:csrfToken},function(resultData){Timetracker.util.showAlert(2,ZPI18N.getString("zp.tt.emloyeeRPH.deletemsg")),Timetracker.employeeRPH.fetchUserRate=!0,Timetracker.timesheet.userRates=null,Timetracker.employeeRPH.getUserRating()}))},destroyZComp:function(){var modal=settingsPage.container.find("#ttAddUserRating");TimelyZComp.select.destroy(modal.find("#tsoperations_rphuser"))},Import:{construct:function(){Timetracker.Import.dtls={},Timetracker.Import.fileType=["xls","xlsx","csv"],Timetracker.Import.acceptFiles=".xls,.xlsx,.csv",Timetracker.Import.dtls.noteArr=[ZPI18N.getString("zp.firstrowmsg"),ZPI18N.getString("zp.unexpectederrormsg"),ZPI18N.getString("zp.tt.emloyeeRPH.tsimpempformat")],Timetracker.Import.dtls.fileSlider=Timetracker.Import.getImportSlider,Timetracker.Import.dtls.fileUploading=Timetracker.employeeRPH.Import.fileUploading,Timetracker.Import.dtls.getMappingSliderHtml=Timetracker.employeeRPH.Import.getMappingSliderHtml,Timetracker.Import.dtls.getVerifySliderHtml=Timetracker.employeeRPH.Import.getVerifySliderHtml,Timetracker.Import.dtls.getImportSummaryHtml=Timetracker.employeeRPH.Import.getImportSummaryHtml,Timetracker.Import.dtls.inputFileVerify=Timetracker.employeeRPH.Import.inputFileVerify,Timetracker.Import.dtls.autoMappingFields=Timetracker.employeeRPH.Import.autoMappingFields,Timetracker.Import.dtls.viewRecords=Timetracker.employeeRPH.getUserRating,Timetracker.Import.dtls.importTemplate=Timetracker.employeeRPH.Import.importTemplate,Timetracker.Import.construct()},fileUploading:function(fileObj){var cont=Timetracker.Import.importfileUpContiner;cont.find("#importFileDiv1").addClass("zpl_DNI"),cont.find("#loadingImportDiv").show(),cont.find("#loadingImportDiv").html(ZPeople.LOADING_HTML);var formData=new FormData;fileObj&&formData.append("importFile",fileObj),formData.append("module","TimesheetPayrollSetting"),formData.append("conreqcsr",csrfToken),$.ajax({url:"/timeSheetImport.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){1===response.res?(Timetracker.Import.fileData=response,Timetracker.Import.constructImportDiv()):(void 0!=response.errorCode?Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(response.errorCode)):void 0!=response.errMsg?Timetracker.Util.displayFailureMessage(response.errMsg):Timetracker.Util.displayFailureMessage(ZPI18N.getString("zp.tspaysettingimperror")),Timetracker.Import.importfileUpObj.close())}})},getMappingSliderHtml:function(){return'<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li elem="mapUnMapDiv" value="allFields" class="zpl_act">'+ZPI18N.getString("zp.all")+'</li><li elem="mapUnMapDiv" value="mappedFields">'+ZPI18N.getString("zp.mapping")+' <div id="mappedNo"><b class="zbadges DNI"></b></div></li><li elem="mapUnMapDiv" value="unMappedFields">'+ZPI18N.getString("zp.unmapped")+' <div id="unMappedNo"><b class="zbadges columnIndex DNI"></b></div></li></ul></div><div class="zpl_rgt"><button class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields(true);">'+ZPI18N.getString("zp.resetfields")+'</button><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields();">'+ZPI18N.getString("zp.automapfields")+'</button></div></div><div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd" elem="collapseMainDiv"><div class="zpl_crdcnt zpl_colpanls"  data-toggle-button-position="right" aria-multiselectable="true"><div id="ttimport_mapping_collapseDiv" elem="collapsibleSectionPanel"><div><div <h4="">'+ZPI18N.getString("zp.tt.emloyeeRPH.employeerate")+'</div> </div><div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.leave.operations.employeename")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_empId_map" elemType="select"></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.tt.emloyeeRPH.rateperhour")+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_rateperhr_map" elemType="select"></select></div></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label>'+ZPI18N.getString("zp.tt.emloyeeRPH.otrateperhour")+' <b class="zbadges columnIndex DNI"></b></label><select id="imp_ot_srateperhr_map"  elemType="select"></select></div></div><div><div elem="mappingFieldDiv"><label>'+ZPI18N.getString("zp.tt.emloyeeRPH.extendedotrateperhour")+' <b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_ot_drateperhr_map" elemType="select"></select></div></div></div></div></div></div></div></div><div id="zp_empty_data"/></div></div>'},getVerifySliderHtml:function(){return'<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd" elem="collapseMainDiv"><div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true"><div id="ttimport_verify_collapseDiv" elem="collapsibleSectionPanel"><div><div><h4="">'+ZPI18N.getString("zp.tt.emloyeeRPH.employeerate")+'</div></div><div><div class="zpl_secn zpl_twoclum"><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.leave.operations.employeename")+'</font><b class="zbadges columnIndex DNI"></b></label><select   id="imp_empId"></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.tt.emloyeeRPH.rateperhour")+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_rateperhr"></select></div></div></div></div><div class="zpl_secn zpl_twoclum"><div><div elem="mappingFieldDiv"><label>'+ZPI18N.getString("zp.tt.emloyeeRPH.otrateperhour")+'<b class="zbadges columnIndex DNI"></b></label><select id="imp_ot_srateperhr"></select></div></div><div><div elem="mappingFieldDiv"><label>'+ZPI18N.getString("zp.tt.emloyeeRPH.extendedotrateperhour")+'<b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_ot_drateperhr"></select></div></div></div></div></div></div></div></div></div>'},getImportSummaryHtml:function(resultData){var html='<div class="zpl_imprtrecordvw"><div class="zpl_secn"><div><div class="zpl_imprtrecord"><div><i class="PI_tick2_fil grn"></i>'+ZPI18N.getString("zp.importSuccess",[""])+'</div><button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="Timetracker.Import.viewRecords()">'+ZPI18N.getString("zp.viewRecords")+'</button></div></div></div></div><div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li style="cursor: default;">'+ZPI18N.getString("zp.noOfAdd")+"<b>"+resultData.addedCount+'</b></li><li style="cursor: default;">'+ZPI18N.getString("zp.noOfUpdate")+"<b>"+resultData.updatedCount+'</b></li><li style="cursor: default;">'+ZPI18N.getString("zp.noOfSkip")+"<b>"+(resultData.errorcount?resultData.errorcount:"0")+'</b></li><li style="cursor: default;">'+ZPI18N.getString("zp.noOfErr")+"<b>"+(resultData.errorcount?resultData.errorcount:"0")+"</b></li></ul></div></div>";if(resultData.errorcount){var keys=new Array;for(var k in resultData.errors)keys.push(k);keys.sort();var len=keys.length;html+=' <div class="zpl_rgtcnt"><div class="zpl_tblres"> <table class="zpl_tbl">  <thead><tr><th>Key</th><th>'+ZPI18N.getString("zp.error")+"</th></tr></thead><tbody>";for(var tempI=0;tempI<len;tempI++){var key=keys[tempI],split=resultData.errors[key].split(":");html+="<tr><td><span>"+split[0]+"</td><td>"+split[1]+"</span></td></tr>"}html+="</tbody></table></div></div>"}return html},inputFileVerify:function(){var container=Timetracker.Import.importContainer.find("#ttimport_verify_card"),map_Employee=TimelyZComp.select.getValue(container.find("#imp_empId")),map_RatePerHour=TimelyZComp.select.getValue(container.find("#imp_rateperhr")),map_OT_SRatePerHour=TimelyZComp.select.getValue(container.find("#imp_ot_srateperhr")),map_OT_DRatePerHour=TimelyZComp.select.getValue(container.find("#imp_ot_drateperhr"));if("-1"!==map_Employee&&""!==map_Employee&&"-1"!==map_RatePerHour&&""!==map_RatePerHour){""==map_OT_SRatePerHour&&(map_OT_SRatePerHour=-1),""==map_OT_DRatePerHour&&(map_OT_DRatePerHour=-1),Timetracker.Import.importContainer.find("#ttimport_summary_card").html(ZPeople.LOADING_HTML);var params={mode:"importTSPayrollSettings",employee:map_Employee,rateperhour:map_RatePerHour,ot_srateperhour:map_OT_SRatePerHour,ot_drateperhour:map_OT_DRatePerHour,fileFormat:Timetracker.Import.fileFormat,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){Timetracker.Import.importSummary(response)},{},Timetracker.Util.generalFailureCallback)}else Timetracker.Import.importObj.showTab(2)},autoMappingFields:function(cont){TimelyZComp.select.setValue(cont.find("#imp_empId_map"),Timetracker.Import.headerHash.employee),TimelyZComp.select.setValue(cont.find("#imp_rateperhr_map"),Timetracker.Import.headerHash["rate per hour"]),TimelyZComp.select.setValue(cont.find("#imp_ot_srateperhr_map"),Timetracker.Import.headerHash["ot rate per hour"]),TimelyZComp.select.setValue(cont.find("#imp_ot_drateperhr_map"),Timetracker.Import.headerHash["extended ot rate per hour"])},importTemplate:function(){var formObj=$("<form id='employeeRPH_imp_form' action='timeSheetImport.zp?mode=timesheetImportTemplate' method='post' target='exportresp1' style='display:none'/>").html("");formObj.append('<input type="hidden" value="'+csrfToken+'" name="conreqcsr"/>'),formObj.append('<input type="hidden" value="TimesheetPayrollSetting" name="module"/>'),$("body").append(formObj),formObj.trigger("submit")}},isemployeeRPHPage:function(){return-1!==settingsUrlProps.niceUrl.indexOf(Timetracker.constants.SETTINGS.MODE.EMPLOYEERPH.toLowerCase())}},Timetracker.billingSetting={init:function(){Timetracker.genSettings.init(),Timetracker.genSettings.permissionCheck()&&(Timetracker.genSettings.removeTopButton(settingsPage.container),Timetracker.genSettings.isHtmlConstructed()||(Timetracker.billingSetting.constructHtml(),settingsPage.container.find("#tt_billingDiv").hide(),Timetracker.util.appendLoading(void 0,{fullPageModal:!0})),Timetracker.billingSetting.getBillingSettings())},constructHtml:function(){var html=Timetracker.genSettings.getHeaderBandHtml({header:ZPI18N.getString("zp.billing"),description:ZPI18N.getString("zp.generatebillinfo")});html+='<div class="zpl_rgtcnt"><div id="tt_billingDiv"><div class="zpl_crd" cardId="tbs_billAutoManCard"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.billno")+"</h4><p>"+ZPI18N.getString("zp.tt.bilingsettings.billdesc")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.billingSetting.setBillingData(this,true)","Timetracker.billingSetting.updateDataBilling(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn" ><div class="chkdectxt"><div class="zradiobutton"><input type="radio" id="tbs_manual" name="billnoauto" value="0" class="zradiobutton__helper" checked="" ><label for="tbs_manual" class="zradiobutton__label"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.manually")+'</span></label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.bilingsettings.manaulbilldesc")+'</span></div></div><div class="zpl_secn" ><div class="radiodectxt"><div class="zradiobutton"><input type="radio" id="tbs_auto" name="billnoauto" value="1" class="zradiobutton__helper"><label class="zradiobutton__label" for="tbs_auto" ><span class="zradiobutton__text"> '+ZPI18N.getString("zp.automatically")+'</span></label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.bilingsettings.autobilldesc")+'</span><div class="zpl_gbox wd50_per" id="tbs-billautodiv_view"><div class="zpl_secn zpl_idivingrp"><div><div><label>'+ZPI18N.getString("zp.tt.bilingsettings.billprefix")+'</label><label class="zpl_mtry">'+ZPI18N.getString("zp.tt.bilingsettings.startingnumber")+'</label></div></div><div><div><input id="tbs_billnoprefix" type="text" placeholder="e.g. ZY" class="ztextbox" value="BILL_"><input id="tbs_billnostarts" type="text" placeholder="e.g. 001" class="ztextbox" value="1"></div><div id="error_billDiv"></div></div></div></div></div></div></div></div><div class="zpl_crd" cardId="tbs_taxCard"><div class="zpl_crdhdr"><div><h4> '+ZPI18N.getString("zp.taxes")+"</h4><p>"+ZPI18N.getString("zp.tt.bilingsettings.taxesdesc")+"</p></div>"+Timetracker.genSettings.addSaveResetButton("Timetracker.billingSetting.setBillingData(this,true)","Timetracker.billingSetting.updateDataBilling(this)")+'</div><div class="zpl_crdcnt"><div class="zpl_secn"><div id="tax_body"></div></div></div></div></div>',settingsPage.container.html(html),settingsPage.container.find("[cardid=tbs_billAutoManCard]").find("input[type=radio]").off("change").on("change",function(){Timetracker.billingSetting.showHideBillNo(this)})},getBillingSettings:function(cardDiv){Timetracker.util.removeErrorMsg(),Timetracker.billingSettings.currencyRepeat=!1,null===Timetracker.billingSettings.taxData?ZPeople.Request.send(Timetracker.constants.URL,{mode:"getBillingSettings"},function(resultData){Timetracker.billingSettings.taxData=resultData.taxData,Timetracker.generalSettings.settingDetails=resultData.billNumberSettings,Timetracker.billingSetting.setBillingData(cardDiv),Timetracker.util.removeLoading()}):(Timetracker.billingSetting.setBillingData(cardDiv),Timetracker.util.removeLoading())},setBillingData:function(cardDiv,isFromReset){Timetracker.util.removeErrorMsg();var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");cardDivId&&"tbs_billAutoManCard"!==cardDivId||Timetracker.billingSetting.setBillingSettings(),cardDivId&&"tbs_taxCard"!==cardDivId||(isFromReset&&(Timetracker.billingSettings.deletedTaxes=""),Timetracker.billingSetting.constructTaxes(Timetracker.billingSettings.taxData)),Timetracker.genSettings.addEvntLsnrforChange(Timetracker.billingSetting.showHideSaveResetbn),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING),settingsPage.container.find("#tt_billingDiv").show(),TimelyZComp.toolTip.intiliaze()},setBillingSettings:function(){var pageContainer=settingsPage.container;"1"===Timetracker.generalSettings.getAutoBillNo()?(pageContainer.find("#tbs-billautodiv_view").show(),pageContainer.find("#tbs_billnoprefix").val(Timetracker.generalSettings.getBillNoPrefix()),pageContainer.find("#tbs_billnostarts").val(Timetracker.generalSettings.getBillStartNo())):(Timetracker.generalSettings.settingDetails.TS_BillnoAuto="0",pageContainer.find("#tbs-billautodiv_view").hide(),pageContainer.find("#tbs_billnoprefix").val(""),pageContainer.find("#tbs_billnostarts").val("")),pageContainer.find("input[type='radio'][name='billnoauto'][value='"+Timetracker.generalSettings.getAutoBillNo()+"']").prop("checked",!0)},showHideBillNo:function(obj){"1"===$(obj).val()?(settingsPage.container.find("#tbs_billnoprefix").val("1"===Timetracker.generalSettings.getAutoBillNo()?Timetracker.generalSettings.getBillNoPrefix():""),settingsPage.container.find("#tbs_billnostarts").val("1"===Timetracker.generalSettings.getAutoBillNo()?Timetracker.generalSettings.getBillStartNo():""),settingsPage.container.find("#tbs-billautodiv_view").show()):settingsPage.container.find("#tbs-billautodiv_view").hide()},constructTaxes:function(result){var pageContainer=settingsPage.container,txt="";pageContainer.find("#tax_body").html(""),0===result.length||""===result?(txt='<div class="zpl_idiv"><div class="w200"><h5>'+ZPI18N.getString("zp.taxname")+'</h5></div><div class="w200"><h5>'+ZPI18N.getString("zp.tt.bilingsettings.taxpercentage")+'</h5></div></div><div class="zpl_idiv zpl_erorbx tax_perc_div"><div><input type="text" class="ztextbox w200" placeholder="'+ZPI18N.getString("zp.name")+'"></div><div><div class="ztextbox--group ztextbox--zicon zpl_inpticfild"><span class="ztextbox__icon">%</span><input type="text" class="ztextbox w100"></div></div><div id="taxDelDiv"><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+' onclick="Timetracker.billingSetting.deleteTaxRows(this);"></i></div></div>',txt+='<div class="zpl_idiv"><a class="zpl_lnkbg" onclick="Timetracker.billingSetting.addTaxRows();">'+ZPI18N.getString("zp.tt.bilingsettings.addtax")+"</a></div>",pageContainer.find("#tax_body").append(txt),pageContainer.find("#tax_body > div:not(:last)").find("#taxDelDiv").hide()):(txt='<div class="zpl_idiv"><div class="w200"><h5>'+ZPI18N.getString("zp.taxname")+'</h5></div><div class="w200"><h5>'+ZPI18N.getString("zp.tt.bilingsettings.taxpercentage")+"</h5></div></div>",$.each(result,function(index,data){txt+='<div class="zpl_idiv zpl_erorbx tax_perc_div"><div><input type="text" class="ztextbox w200" value="'+data.taxName+'" taxId="'+data.taxId+'" placeholder="'+ZPI18N.getString("zp.name")+'"></div><div><div class="ztextbox--group ztextbox--zicon zpl_inpticfild"><span class="ztextbox__icon">%</span><input type="text" class="ztextbox w100" type="text" placeholder="e.g. 2" class="ztextbox" value="'+data.taxPerCent+'"></div></div><div id="taxDelDiv"><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+' onclick="Timetracker.billingSetting.deleteTaxRows(this);"></i></div></div>'}),txt+='<div class="zpl_idiv"><a class="zpl_lnkbg" onclick="Timetracker.billingSetting.addTaxRows();">'+ZPI18N.getString("zp.tt.bilingsettings.addtax")+"</a></div>",pageContainer.find("#tax_body").append(txt))},addTaxRows:function(){var pageContainer=settingsPage.container,txt="";settingsPage.container.find("#tax_body > div.tax_perc_div").length>=1&&(pageContainer.find("#tax_body > div:not(:last)").find("#taxDelDiv").show(),txt='<div class="zpl_idiv zpl_erorbx tax_perc_div"><div><input type="text" class="ztextbox w200" placeholder="'+ZPI18N.getString("zp.name")+'"></div><div><div class="ztextbox--group ztextbox--zicon zpl_inpticfild"><span class="ztextbox__icon">%</span><input type="text" class="ztextbox w100" placeholder="e.g. 2"></div></div><div id="taxDelDiv"><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+' onclick="Timetracker.billingSetting.deleteTaxRows(this);"></i></div>',pageContainer.find("#tax_body > div:last").before(txt),Timetracker.genSettings.addEvntLsnrforChange(Timetracker.billingSetting.showHideSaveResetbn,pageContainer.find("#tax_body >  div:last").prev()))},deleteTaxRows:function(obj){var pageContainer=settingsPage.container;let siblingsArray=$(obj).parent().siblings(),taxId=$(siblingsArray[0]).find("input").attr("taxId");taxId&&(Timetracker.billingSettings.deletedTaxes+=taxId+","),$(obj).closest(".zpl_idiv").remove(),0===pageContainer.find("#tax_body > div.tax_perc_div").length&&(Timetracker.billingSetting.constructTaxes(""),Timetracker.genSettings.addEvntLsnrforChange(Timetracker.billingSetting.showHideSaveResetbn,pageContainer.find("#tax_body >  div:last").prev())),Timetracker.billingSetting.showHideSaveResetbn(pageContainer.find("#tax_body"))},updateDataBilling:function(cardDiv){settingsPage.container;var params={mode:"updateBillingSettings",conreqcsr:csrfToken};(params=Timetracker.billingSetting.getParamsForUpdateSettings(params,cardDiv)).isError||(Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVING),null!=params?ZPeople.Request.send(Timetracker.constants.URL,params,function(){Timetracker.billingSetting.updateSuccessCallback(cardDiv)},{},Timetracker.Util.generalFailureCallback):(Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")),Timetracker.billingSetting.getBillingSettings(!0),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING)))},getParamsForUpdateSettings:function(params,cardDiv){var pageContainer=settingsPage.container;Timetracker.util.removeErrorMsg();var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId"),isFromValCh=!(Object.keys(params).length>0),errorFlag=!1,counter=0;switch(cardDivId){case"tbs_billAutoManCard":let billnoauto=pageContainer.find("input[type='radio'][name='billnoauto']:checked").val(),billnoprefix=pageContainer.find("#tbs_billnoprefix").val(),billnostarts=pageContainer.find("#tbs_billnostarts").val();"1"===billnoauto&&(isFromValCh||(Timetracker.Validations.isEmpty(billnostarts)?(pageContainer.find("#error_billDiv").append('<span class="zpl_op0 ztextbox--error__label"></span>'),Timetracker.Util.appenErrorMsgForElem({obj:pageContainer.find("#tbs_billnostarts"),msg:ZPI18N.getString("zp.billstartingnumberempty"),appendTo:pageContainer.find("#error_billDiv")}),errorFlag=!0):Timetracker.Validations.isNumber(billnostarts)||(pageContainer.find("#error_billDiv").append('<span class="zpl_op0 ztextbox--error__label"></span>'),Timetracker.Util.appenErrorMsgForElem({obj:pageContainer.find("#tbs_billnostarts"),msg:ZPI18N.getString("zp.fieldupdate.numbererror"),appendTo:pageContainer.find("#error_billDiv")}),errorFlag=!0))),errorFlag||(params.billnoprefix=billnoprefix,params.billnostarts=billnostarts,params.billnoauto=billnoauto);break;case"tbs_taxCard":let existingTaxNames={},taxArray=new Array;if(pageContainer.find("#tax_body > div.tax_perc_div").each(function(){let textChildren=$(this).children(),taxId=$(textChildren[0]).find("input").attr("taxId"),taxName=$(textChildren[0]).find("input").val(),taxpercent=$(textChildren[1]).find("input").val();if(!isFromValCh){if(!taxId&&""===taxName.trim()&&""===taxpercent.trim())return;Timetracker.Validations.isEmpty(taxName)&&(Timetracker.Util.appenErrorMsgForElem({obj:$(textChildren[0]).children(),msg:ZPI18N.getString("zp.specifyvalue")}),errorFlag=!0),(Timetracker.Validations.isEmpty(taxpercent)||!Timetracker.Validations.isDecimal(taxpercent.trim())||taxpercent<0||taxpercent>100)&&(Timetracker.Util.appenErrorMsgForElem({obj:$(textChildren[1]).children(),msg:ZPI18N.getString(Timetracker.Validations.isEmpty(taxpercent)?"zp.specifyvalue":"zp.invalidpercent")}),errorFlag=!0),existingTaxNames[taxName]?(Timetracker.Util.appenErrorMsgForElem({obj:$(textChildren[0]).children(),msg:ZPI18N.getString("zp.duplicatename")}),errorFlag=!0):""!==taxName.trim()&&(existingTaxNames[taxName]="exists")}taxId&&!errorFlag?taxName===decodeHTML(Timetracker.billingSettings.taxData[counter].taxName)&&Number(taxpercent)===Timetracker.billingSettings.taxData[counter].taxPerCent||""!==taxName.trim()&&""!==taxpercent.trim()&&taxArray.push({taxName:taxName,taxPercent:taxpercent,taxId:taxId}):errorFlag||""!==taxName.trim()&&""!==taxpercent.trim()&&taxArray.push({taxName:taxName,taxPercent:taxpercent}),counter++}),!errorFlag&&(taxArray.length>0||""!==Timetracker.billingSettings.deletedTaxes))return params.taxArray=JSON.stringify(taxArray),""!==Timetracker.billingSettings.deletedTaxes&&(params.deletedTaxes=Timetracker.billingSettings.deletedTaxes),params}return errorFlag?{isError:!0}:Timetracker.billingSetting.isSettingValueChanged(params,cardDivId)?params:null},showHideSaveResetbn:function(cardDiv){cardDiv=cardDiv.target?cardDiv.target:cardDiv,null!==Timetracker.billingSetting.getParamsForUpdateSettings({},cardDiv)?Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVERESET):Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING)},isSettingValueChanged:function(params,cardDivId){switch(cardDivId){case"tbs_billAutoManCard":return params.billnoauto!==String(Timetracker.generalSettings.getAutoBillNo())||"1"===params.billnoauto&&(params.billnoprefix.trim()!==String(Timetracker.generalSettings.getBillNoPrefix()).trim()||params.billnostarts.trim()!==String(Timetracker.generalSettings.getBillStartNo()).trim())}return!1},updateSuccessCallback:function(cardDiv){Timetracker.billingSettings.deletedTaxes="",Timetracker.billingSettings.taxData=null,Timetracker.billingSetting.getBillingSettings(cardDiv),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVED)}},Timetracker.overTimePolicy={overTimePolicyApp:{USER_SPECIFIC:{key:0,appKey:"userAppArr"},EMP_TYPE_SPECIFIC:{key:1,appKey:"empTypeAppArr"},LOCATION_SPECIFIC:{key:2,appKey:"locationAppArr"},DEPT_SPECIFIC:{key:3,appKey:"departmentAppArr"}},appList:{},settingList:[],mappedAppList:[],init:function(){if(Timetracker.genSettings.init(),Timetracker.genSettings.permissionCheck()){let html='<div class="zpl_rgtcnt">';html+='<div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.tt.overtimepolicies")+"</h4><p>"+ZPI18N.getString("zp.tt.overtimepolicies.desc")+"</p></div></div></div>",html+='<div class="zpl_btnmnu"><div class="search-cmn"><i class="PI_lens"></i><input type="text" class="ztextbox" id="suggestFieldId" placeholder="'+ZPI18N.getString("zp.searchdata")+'"><i class="PI_cls" onclick="clssearch(this)"></i> </div><div class="zpl_rgt"><ul class="zpl_grpmnu"><li class="zpl_act" onclick="Timetracker.overTimePolicy.onViewSwitch(this, true)">'+ZPI18N.getString("zp.all")+'</li><li class="" onclick="Timetracker.overTimePolicy.onViewSwitch(this, false)">'+ZPI18N.getString("zp.tt.overtimepolicies.overtimecompliancelibrary")+'</li></ul><button class="zlabel zlabel--blue zlabel--medium" data-popup-open="" id="addOtPolicy" onclick="Timetracker.overTimePolicy.constructAddPopUp()">'+ZPI18N.getString("zp.addotbtn")+'</button><i class="zpl_ibg PI_lens" id="ot_search" aria-label="Lens" role="button" aria-haspopup="dialog" tabindex="0"></i></div></div>',html+='<div class="zpl_tblres" id="otsetting_list" data-tab="activtbl"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.tt.overtimepolicies.policyname")+'</th><th width="100">'+ZPI18N.getString("zp.status")+'</th><th width="100">'+ZPI18N.getString("zp.fileactions")+'</th></tr></thead> <tbody id="ts-otpolicybody"> </tbody></table></div>',html+='<div id="ottemplate_list" ></div>',html+='<div id="ttot_loading_div"></div>',html+='<div id="zp_empty_data"/>',html+="</div>",settingsPage.container.html(html),Timetracker.overTimePolicy.fetchOtPolicyList()}},fetchOtPolicyList:async function(){Timetracker.overTimePolicy.mappedAppList={},Timetracker.overTimePolicy.appList=[],settingsPage.container.find("#zp_page_loading").remove(),settingsPage.container.find("#zp_empty_data,#otsetting_list,#ottemplate_list").hide(),TimelySettings.showHideLoadingPage(!0,void 0,"ttot_loading_div");var pageContainer=settingsPage.container;const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(Timetracker.overTimePolicy.getUrl(),{},void 0,"GET");AppExc.getApplicableIds(),Timetracker.overTimePolicy.constructOtPolicyList(response,pageContainer)},onViewSwitch:function(obj,isRecordView){settingsPage.container.find("#zp_empty_data").hide(),$(obj).siblings().removeClass("zpl_act"),isRecordView?(settingsPage.container.find("#otsetting_list").show(),settingsPage.container.find("#ottemplate_list").hide(),$(obj).addClass("zpl_act"),Timetracker.overTimePolicy.fetchOtPolicyList()):($(obj).addClass("zpl_act"),settingsPage.container.find("#otsetting_list").hide(),settingsPage.container.find("#ottemplate_list").show(),Timetracker.overTimePolicy.template.fetchOtTemplateList())},constructOtPolicyList:function(response,pageContainer){if(0===response.status&&(response.hasOwnProperty("message")&&Timetracker.util.showAlert(0,response.message),"PERMISSION_DENIED_ERROR"===response.code))return layout.find("#timetrackerTimelogReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),void layout.find(".lt_nav").addClass("DN");var isEmpty=0===response.status||0===Object.keys(response.data).length||0===Object.keys(response.data.dataArr).length;if(0===response.status&&(response.hasOwnProperty("message")&&Timetracker.util.showAlert(0,response.message),"PERMISSION_DENIED_ERROR"===data.code))return layout.find("#timetrackerTimelogReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),void layout.find(".lt_nav").addClass("DN");response=response.data&&response.data.dataArr||[],Timetracker.genSettings.addTablFxdCls(),Timetracker.overTimePolicy.initiateSearch(pageContainer.find("#ot_search")),isEmpty?(Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.tt.overtimepolicies.nodatamessage"),buttonName:ZPI18N.getString("zp.addotbtn"),buttonCallBack:Timetracker.overTimePolicy.constructAddPopUp,desc:ZPI18N.getString("zp.tt.overtimepolicies.nodatamessagedesc")}),pageContainer.find("#addOtPolicy").hide(),pageContainer.find("#zp_empty_data").fadeIn(200)):(settingsPage.container.find("#ts-otpolicybody").html(""),pageContainer.find("#addOtPolicy").show(),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.overTimePolicy.constructOtPolicyListRows(response),pageContainer.find("#otsetting_list").fadeIn(200),TimelyZComp.toolTip.intiliaze()),TimelySettings.showHideLoadingPage()},constructOtPolicyListRows:function(configArr){let div=settingsPage.container.find("#ts-otpolicybody");$.each(configArr,function(index,configObj){configObj.otpolicy_template?Timetracker.overTimePolicy.template.constructTemplateRowNew(configObj,div):Timetracker.overTimePolicy.constructRow(configObj)})},constructRow:function(configObj){var txt='<tr id="'+configObj.otpolicy_id+'"><td name="otpolicy_name" onclick="Timetracker.overTimePolicy.constructEditPopUp($(this).closest(\'tr\'));"><span>'+configObj.otpolicy_name+'</span></td><td><span><input class="togbutton-js" id="toggle_'+configObj.otpolicy_id+'" checked="" style="display: none;"></span></td><td><div class="zpl_hvr"> <i class="PI_clone" title='+ZPI18N.getString("zp.clone")+" onclick=\"Timetracker.overTimePolicy.cloneOverTimePolicy('"+configObj.otpolicy_id+'\')"></i><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+" onclick=\"Timetracker.Util.confirmpopUp('"+configObj.otpolicy_id+"',  Timetracker.overTimePolicy.deleteOverTimePolicy,'"+configObj.otpolicy_id+"',0,{header :'"+ZPI18N.getString("zp.delotpol?")+"', body :'"+ZPI18N.getString("zp.tt.overtimepolicies.deleteovertimepolicy.desc")+"'});\"></i></div></td></tr>";txt=$(txt).data("configInfo",configObj),settingsPage.container.find("#ts-otpolicybody").append(txt);let toogleDiv=settingsPage.container.find("#toggle_"+configObj.otpolicy_id);ZPeopleComponents.toggleswitch(toogleDiv),configObj.otpolicy_isenabled?ZPeopleComponents.toggleswitch(toogleDiv).switchOn():ZPeopleComponents.toggleswitch(toogleDiv).switchOff(),toogleDiv.on("ztoggleswitchchange",Timetracker.overTimePolicy.toggleBreakStatus);let keyName=Timetracker.overTimePolicy.getAppKeyByKey(configObj.otpolicy_app_type),appArrList=configObj.appArr[keyName];if(Timetracker.overTimePolicy.mappedAppList[keyName]=Timetracker.overTimePolicy.mappedAppList[keyName]||[],Timetracker.overTimePolicy.mappedAppList[configObj.otpolicy_id]=Timetracker.overTimePolicy.mappedAppList[configObj.otpolicy_id]||[],Timetracker.overTimePolicy.mappedAppList[configObj.otpolicy_id]){let mapList=Timetracker.overTimePolicy.mappedAppList[configObj.otpolicy_id];for(var key in mapList){var val=mapList[key];const index=Timetracker.overTimePolicy.mappedAppList[keyName].indexOf(val);index>-1&&Timetracker.overTimePolicy.mappedAppList[keyName].splice(index,1)}}else{const index=Timetracker.overTimePolicy.mappedAppList[keyName].indexOf("0");index>-1&&Timetracker.overTimePolicy.mappedAppList[keyName].splice(index,1)}if(0!=appArrList.length)for(var key in appArrList){val=appArrList[key];Timetracker.overTimePolicy.mappedAppList[keyName].push(val.ID+""),Timetracker.overTimePolicy.mappedAppList[configObj.otpolicy_id].push(val.ID+"")}else Timetracker.overTimePolicy.mappedAppList[keyName].push("0"),Timetracker.overTimePolicy.mappedAppList[configObj.otpolicy_id].push("0")},constructAddPopUp:function(){Timetracker.overTimePolicy.constructaddEditOtPolicy({mode:Timetracker.constants.ADD}),ZPeopleComponents.select(pageContainer.find("#policyApplicability")).setValue("0")},constructEditPopUp:function(thisObj){var config=$.extend(!0,{},$(thisObj).data("configInfo"));void 0!==config.otTemplateId?(Timetracker.overTimePolicy.template.constructMapTemplatePopUp(config,{mode:Timetracker.constants.EDIT}),settingsPage.container.find("#ttAddOTPolicySettings").find("#zp_modal_blubtn").removeClass("disabled").off("click").on("click",function(){Timetracker.overTimePolicy.addEditOtPolicySettings({mode:Timetracker.constants.EDIT,config:config})})):(Timetracker.overTimePolicy.constructaddEditOtPolicy({mode:Timetracker.constants.EDIT},config),Timetracker.overTimePolicy.setData(config))},constructaddEditOtPolicy:function(json,config){Timetracker.overTimePolicy.constructOtSettPopUp(json,config),settingsPage.container.find("#ttAddOTPolicySettings").find("#zp_modal_blubtn").removeClass("disabled").off("click").on("click",function(){Timetracker.overTimePolicy.addEditOtPolicySettings({mode:json.mode,config:config})})},addEditOtPolicySettings:async function(json){var modal=settingsPage.container.find("#ttAddOTPolicySettings");modal.find("#zp_modal_blubtn").prop("disabled",!0),Timetracker.util.removeErrorMsg(void 0,modal);let config=json.config;if(config&&void 0!==config.otTemplateId)params.mode="editTemplatePolicyRecord";else{var params={otPolicyInputData:{}};if(params.otPolicyInputData.policyName=modal.find("#ts_overtimepolicy_name").val(),Timetracker.Validations.isEmpty(params.otPolicyInputData.policyName))return Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#ts_overtimepolicy_name"),msg:ZPI18N.getString("zp.tt.overtimepolicies.enternameforovertimepolicy")}),void modal.find("#zp_modal_blubtn").prop("disabled",!1);let policyApplicable=ZPeopleComponents.select(modal.find("#policyApplicability")).getValue();if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.USER_SPECIFIC.key){let userList=TimelyZComp.tokenField.getValues(modal.find("#userSelect"));if(userList&&0!=userList.length){if(Timetracker.overTimePolicy.mappedAppList.userAppArr){let mappedList=new Array;if(json.mode==Timetracker.constants.EDIT&&config.appArr.userAppArr&&(mappedList=0==config.appArr.userAppArr.length?["0"]:config.appArr.userAppArr.map(obj=>obj.ID)),Timetracker.overTimePolicy.mappedAppList.userAppArr.some(val=>userList.includes(val)&&!mappedList.includes(val)))return Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#groupGBox"),msg:"Already Mapped"}),void modal.find("#zp_modal_blubtn").prop("disabled",!1)}userList.includes("0")&&(userList=[]),params.otPolicyInputData.appArr={userAppArr:userList}}}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.LOCATION_SPECIFIC.key){let locationList=TimelyZComp.tokenField.getValues(modal.find("#locationSelect"));locationList&&0!=locationList.length&&(locationList.includes("0")&&(locationList=[]),params.otPolicyInputData.appArr={locationAppArr:locationList})}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.EMP_TYPE_SPECIFIC.key){let empTypeList=TimelyZComp.tokenField.getValues(modal.find("#empTypeSelect"));empTypeList&&0!=empTypeList.length&&(empTypeList.includes("0")&&(empTypeList=[]),params.otPolicyInputData.appArr={empTypeAppArr:empTypeList})}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.DEPT_SPECIFIC.key){let departmentList=TimelyZComp.tokenField.getValues(modal.find("#departmentSelect"));departmentList&&0!=departmentList.length&&(departmentList.includes("0")&&(departmentList=[]),params.otPolicyInputData.appArr={departmentAppArr:departmentList})}if(Timetracker.Validations.isEmpty(params.otPolicyInputData.appArr))return Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#groupGBox"),msg:ZPI18N.getString("zp.tt.selectonecriteria")}),void modal.find("#zp_modal_blubtn").prop("disabled",!1);params.otPolicyInputData.otPolicyConfig={};let dailyOverTimePolicy={};dailyOverTimePolicy.enableOverTimePolicy=ZPeopleComponents.toggleswitch(document.getElementById("tot_daily_overtimetoggle")).getState()?"1":"0",dailyOverTimePolicy.overTimePolicy={otCon:{},dOtCon:{}};let otPolicyObj=dailyOverTimePolicy.overTimePolicy;if("1"===dailyOverTimePolicy.enableOverTimePolicy){if(otPolicyObj.otCon=Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#daily_Ot"),!1,settingsPage.container.find("[name='daily_payrate']:checked")),otPolicyObj.otCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(otPolicyObj.dOtCon=settingsPage.container.find("#daily_DoubleOt").hasClass("DNI")?{}:Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#daily_DoubleOt"),!1,settingsPage.container.find("[name='daily_payrateDoubleOt']:checked")),otPolicyObj.dOtCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(void 0!=otPolicyObj.otCon.hrsExcd&&void 0!=otPolicyObj.dOtCon.hrsExcd&&Timetracker.DateTime.convertToMins(otPolicyObj.otCon.hrsExcd)>Timetracker.DateTime.convertToMins(otPolicyObj.dOtCon.hrsExcd))return Timetracker.Util.appenErrorMsgForElem({obj:settingsPage.container.find("#daily_DoubleOt").find("#hrsExcd"),msg:ZPI18N.getString("zp.tt.overtimepolicies.hoursgreaterthanerror"),appendTo:settingsPage.container.find("#daily_DoubleOt #hrsExcd").closest(".zpl_idiv").parent()}),void modal.find("#zp_modal_blubtn").prop("disabled",!1);params.otPolicyInputData.otPolicyConfig.dailyOverTimePolicy=dailyOverTimePolicy}let weeklyOverTimePolicy={};if(weeklyOverTimePolicy.enableOverTimePolicy=ZPeopleComponents.toggleswitch(document.getElementById("tot_weekly_overtimetoggle")).getState()?"1":"0",weeklyOverTimePolicy.overTimePolicy={otCon:{},dOtCon:{}},otPolicyObj=weeklyOverTimePolicy.overTimePolicy,"1"===weeklyOverTimePolicy.enableOverTimePolicy){if(otPolicyObj.otCon=Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#weekly_Ot"),!0,settingsPage.container.find("[name='weekly_payrate']:checked")),otPolicyObj.otCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(otPolicyObj.dOtCon=settingsPage.container.find("#weekly_DoubleOt").hasClass("DNI")?{}:Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#weekly_DoubleOt"),!1,settingsPage.container.find("[name='weekly_payrateDoubleOt']:checked")),otPolicyObj.dOtCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(void 0!=otPolicyObj.otCon.hrsExcd&&void 0!=otPolicyObj.dOtCon.hrsExcd&&Timetracker.DateTime.convertToMins(otPolicyObj.otCon.hrsExcd)>Timetracker.DateTime.convertToMins(otPolicyObj.dOtCon.hrsExcd))return Timetracker.Util.appenErrorMsgForElem({obj:settingsPage.container.find("#weekly_DoubleOt").find("#hrsExcd"),msg:ZPI18N.getString("zp.tt.overtimepolicies.hoursgreaterthanerror"),appendTo:settingsPage.container.find("#weekly_DoubleOt #hrsExcd").closest(".zpl_idiv").parent()}),void modal.find("#zp_modal_blubtn").prop("disabled",!1);params.otPolicyInputData.otPolicyConfig.weeklyOverTimePolicy=weeklyOverTimePolicy}let weekendOverTimePolicy={};if(weekendOverTimePolicy.enableOverTimePolicy=ZPeopleComponents.toggleswitch(document.getElementById("tot_weekend_overtimetoggle")).getState()?"1":"0",weekendOverTimePolicy.overTimePolicy={otCon:{},dOtCon:{}},otPolicyObj=weekendOverTimePolicy.overTimePolicy,"1"===weekendOverTimePolicy.enableOverTimePolicy){if(otPolicyObj.otCon=Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#weekend_Ot"),!1,settingsPage.container.find("[name='weekend_payrate']:checked")),otPolicyObj.otCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(otPolicyObj.dOtCon=settingsPage.container.find("#weekend_DoubleOt").hasClass("DNI")?{}:Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#weekend_DoubleOt"),!1,settingsPage.container.find("[name='weekend_payrateDoubleOt']:checked")),otPolicyObj.dOtCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(void 0!=otPolicyObj.otCon.hrsExcd&&void 0!=otPolicyObj.dOtCon.hrsExcd&&Timetracker.DateTime.convertToMins(otPolicyObj.otCon.hrsExcd)>Timetracker.DateTime.convertToMins(otPolicyObj.dOtCon.hrsExcd))return Timetracker.Util.appenErrorMsgForElem({obj:settingsPage.container.find("#weekend_DoubleOt").find("#hrsExcd"),msg:ZPI18N.getString("zp.tt.overtimepolicies.hoursgreaterthanerror"),appendTo:settingsPage.container.find("#weekend_DoubleOt #hrsExcd").closest(".zpl_idiv").parent()}),void modal.find("#zp_modal_blubtn").prop("disabled",!1);params.otPolicyInputData.otPolicyConfig.weekendOverTimePolicy=weekendOverTimePolicy}let holidayOverTimePolicy={};if(holidayOverTimePolicy.enableOverTimePolicy=ZPeopleComponents.toggleswitch(document.getElementById("tot_holiday_overtimetoggle")).getState()?"1":"0",holidayOverTimePolicy.overTimePolicy={otCon:{},dOtCon:{}},otPolicyObj=holidayOverTimePolicy.overTimePolicy,"1"===holidayOverTimePolicy.enableOverTimePolicy){if(otPolicyObj.otCon=Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#holiday_Ot"),!1,settingsPage.container.find("[name='holiday_payrate']:checked")),otPolicyObj.otCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(otPolicyObj.dOtCon=settingsPage.container.find("#holiday_DoubleOt").hasClass("DNI")?{}:Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#holiday_DoubleOt"),!1,settingsPage.container.find("[name='holiday_payrateDoubleOt']:checked")),otPolicyObj.dOtCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(void 0!=otPolicyObj.otCon.hrsExcd&&void 0!=otPolicyObj.dOtCon.hrsExcd&&Timetracker.DateTime.convertToMins(otPolicyObj.otCon.hrsExcd)>Timetracker.DateTime.convertToMins(otPolicyObj.dOtCon.hrsExcd))return Timetracker.Util.appenErrorMsgForElem({obj:settingsPage.container.find("#holiday_DoubleOt").find("#hrsExcd"),msg:ZPI18N.getString("zp.tt.overtimepolicies.hoursgreaterthanerror"),appendTo:settingsPage.container.find("#holiday_DoubleOt #hrsExcd").closest(".zpl_idiv").parent()}),void modal.find("#zp_modal_blubtn").prop("disabled",!1);params.otPolicyInputData.otPolicyConfig.holidayOverTimePolicy=holidayOverTimePolicy}let consecutiveOverTimePolicy={};if(consecutiveOverTimePolicy.enableOverTimePolicy=ZPeopleComponents.toggleswitch(document.getElementById("tot_consecutive_overtimetoggle")).getState()?"1":"0",consecutiveOverTimePolicy.overTimePolicy={otCon:{},dOtCon:{}},otPolicyObj=consecutiveOverTimePolicy.overTimePolicy,"1"===consecutiveOverTimePolicy.enableOverTimePolicy){if(otPolicyObj.otCon=Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#consecutive_Ot"),!1,settingsPage.container.find("[name='consecutive_payrate']:checked")),otPolicyObj.otCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(otPolicyObj.dOtCon=settingsPage.container.find("#consecutive_DoubleOt").hasClass("DNI")?{}:Timetracker.overTimePolicy.fetchOverTimePolicyConfig(settingsPage.container.find("#consecutive_DoubleOt"),!1,settingsPage.container.find("[name='consecutive_payrateDoubleOt']:checked")),otPolicyObj.dOtCon.isError)return void modal.find("#zp_modal_blubtn").prop("disabled",!1);if(void 0!=otPolicyObj.otCon.hrsExcd&&void 0!=otPolicyObj.dOtCon.hrsExcd&&Timetracker.DateTime.convertToMins(otPolicyObj.otCon.hrsExcd)>Timetracker.DateTime.convertToMins(otPolicyObj.dOtCon.hrsExcd))return Timetracker.Util.appenErrorMsgForElem({obj:settingsPage.container.find("#consecutive_DoubleOt").find("#hrsExcd"),msg:ZPI18N.getString("zp.tt.overtimepolicies.hoursgreaterthanerror"),appendTo:settingsPage.container.find("#consecutive_DoubleOt #hrsExcd").closest(".zpl_idiv").parent()}),void modal.find("#zp_modal_blubtn").prop("disabled",!1);params.otPolicyInputData.otPolicyConfig.consecutiveOverTimePolicy=consecutiveOverTimePolicy}if(Timetracker.Validations.isEmpty(params.otPolicyInputData.otPolicyConfig))return Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#tot_daily_overtime"),msg:ZPI18N.getString("zp.tt.overtimepolicies.enableatleastoneovertime")}),void modal.find("#zp_modal_blubtn").prop("disabled",!1);let payRateType=modal.find("[name='payrateType']:checked").val();params.otPolicyInputData.otPolicyConfig.payRateType=payRateType,"0"==payRateType&&(params.otPolicyInputData.otPolicyConfig.payRateOt=ZPeopleComponents.select(modal.find("#empRphOtSel")).getValue(),settingsPage.container.find("#empRphDoubleOtSelDiv").is(":hidden")||(params.otPolicyInputData.otPolicyConfig.payRateDoubleOt=ZPeopleComponents.select(modal.find("#empRphDoubleOtSel")).getValue())),params.otPolicyInputData=JSON.stringify(params.otPolicyInputData)}let url=Timetracker.overTimePolicy.getUrl(),method="POST";json.mode==Timetracker.constants.EDIT&&config.otpolicy_id&&(url+="/"+json.config.otpolicy_id,method="PUT");const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(url,params,void 0,method);Timetracker.overTimePolicy.addEditOtPolicySettingsCallBack(response,params,json)},addEditOtPolicySettingsCallBack:function(response,params,json){settingsPage.container.find("#ttAddOTPolicySettings").find("#zp_modal_blubtn").prop("disabled",!1);let data=0!==response.status?response.data:response.errors;0!==response.status?(Timetracker.util.showAlert(2,ZPI18N.getString(json.mode==Timetracker.constants.EDIT?"zp.specpolicysaved":"zp.poladded")),json.mode==Timetracker.constants.EDIT&&json.config.otpolicy_id&&settingsPage.container.find("tr#"+json.config.otpolicy_id).remove(),data=response.data&&response.data.dataArr&&!$.isEmptyObject(response.data)&&response.data.dataArr[0],0===settingsPage.container.find("#ts-otpolicybody").find("tr").length&&(Timetracker.Util.showHideNoData({remove:!0}),pageContainer.find("#addOtPolicy").show(),settingsPage.container.find("#otsetting_list").show()),Timetracker.overTimePolicy.constructRow(data),Timetracker.overTimePolicy.destroyZComp(),ModuleComp.Modal.hide("ttAddOTPolicySettings")):data.hasOwnProperty("message")&&Timetracker.util.showAlert(0,data.message)},deleteOverTimePolicy:async function(settingsId){const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(Timetracker.overTimePolicy.getUrl()+"/"+settingsId,{},void 0,"DELETE");Timetracker.overTimePolicy.deleteOverTimePolicyCallback(response,{})},deleteOverTimePolicyCallback:function(response,params){settingsPage.container.find("#ttAddOTPolicySettings").find("#zp_modal_blubtn").prop("disabled",!1);let data=0!==response.status?response.data:response.errors;0!==response.status?(settingsPage.container.find("#"+data.dataObj.otpolicy_id).remove(),Timetracker.util.showAlert(2,ZPI18N.getString("zp.specpolicydeleted")),Timetracker.overTimePolicy.fetchOtPolicyList()):data.hasOwnProperty("message")&&Timetracker.util.showAlert(0,data.message)},cloneOverTimePolicy:async function(settingsId){const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(Timetracker.overTimePolicy.getUrl()+"/"+settingsId,{},void 0,"GET");Timetracker.overTimePolicy.cloneOverTimePolicyCallback(response,!1)},cloneOverTimePolicyCallback:function(response,isTemplate){let data=0!==response.status?response.data:response.errors;0!==response.status?(Timetracker.overTimePolicy.constructAddPopUp(),Timetracker.overTimePolicy.setData(response.data.dataArr[0],{mode:"clone",isTemplate:isTemplate})):data.hasOwnProperty("message")&&Timetracker.util.showAlert(0,data.message)},toggleBreakStatus:async function(event){if(event.detail.fromUI){let policyId=event.detail.element.closest("tr")[0].id,params={mode:"toggleStatus"};const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(Timetracker.overTimePolicy.getUrl()+"/"+policyId,params,void 0,"PATCH");let data=0!==response.status?response.data:response.errors;if(0===response.status)return void(data.hasOwnProperty("message")&&Timetracker.util.showAlert(0,data.message));data.dataObj.state?(ZPeopleComponents.toggleswitch(settingsPage.container.find("#toggle_"+policyId)).switchOn(),successMsg=ZPI18N.getString("zp.polenabled")):(ZPeopleComponents.toggleswitch(settingsPage.container.find("#toggle_"+policyId)).switchOff(),successMsg=ZPI18N.getString("zp.poldisabled")),ModuleComp.Msg.showSuccessMsg(successMsg)}},fetchOverTimePolicyConfig:function(cardDiv,weekValidation,payRateDiv){var configObj={};configObj.hrsExcd=cardDiv.find("#hrsExcd").val();let regexForValidation=weekValidation?Timetracker.util.maxWeekHrsRegex:Timetracker.util.maxhrsRegex;return configObj.hrsExcd.match(regexForValidation)||(Timetracker.Util.appenErrorMsgForElem({obj:cardDiv.find("#hrsExcd"),msg:ZPI18N.getString("zp.tt.entervalidinput"),appendTo:cardDiv.find("#hrsExcd").closest(".zpl_idiv").parent()}),configObj.isError=!0),configObj},setData:function(data,json){let config=data.otpolicy_config,policyName=data.otpolicy_name;if(json&&"clone"==json.mode&&(policyName+="(Clone)"),pageContainer.find("#ts_overtimepolicy_name").val(policyName),pageContainer.find("#payRateTypeDiv").find("input[value="+(void 0!==config.payRateType?config.payRateType:"0")+"]").prop("checked",!0).click(),"0"==config.payRateType&&(ZPeopleComponents.select(settingsPage.container.find("#empRphOtSel")).setValue(config&&config.payRateOt||"1.5"),ZPeopleComponents.select(settingsPage.container.find("#empRphDoubleOtSel")).setValue(config&&config.payRateDoubleOt||"1.5"),void 0===config.payRateDoubleOt?settingsPage.container.find("#empRphDoubleOtSelDiv").hide():settingsPage.container.find("#empRphDoubleOtSelDiv").show()),ZPeopleComponents.toggleswitch(document.getElementById("tot_daily_overtimetoggle")).setAttribute("on",config.dailyOverTimePolicy&&"1"===config.dailyOverTimePolicy.enableOverTimePolicy),config.dailyOverTimePolicy&&"1"===config.dailyOverTimePolicy.enableOverTimePolicy&&(Timetracker.overTimePolicy.setOverTimePolicyConfig(pageContainer.find("#tot_daily_overtime  #daily_Ot"),config.dailyOverTimePolicy.overTimePolicy&&config.dailyOverTimePolicy.overTimePolicy.otCon,settingsPage.container.find("[name='daily_payrate']"),json),config.dailyOverTimePolicy.overTimePolicy&&config.dailyOverTimePolicy.overTimePolicy.dOtCon&&!$.isEmptyObject(config.dailyOverTimePolicy.overTimePolicy.dOtCon)?(Timetracker.overTimePolicy.setOverTimePolicyConfig(pageContainer.find("#tot_daily_overtime #daily_DoubleOt"),config.dailyOverTimePolicy.overTimePolicy&&config.dailyOverTimePolicy.overTimePolicy.dOtCon,settingsPage.container.find("[name='daily_payrateDoubleOt']"),json),pageContainer.find("#tot_daily_overtime #daily_DoubleOt").removeClass("DNI"),pageContainer.find("#tot_daily_overtime #daily_AddRule").addClass("DNI")):(pageContainer.find("#tot_daily_overtime #daily_AddRule").removeClass("DNI"),pageContainer.find("#tot_daily_overtime #daily_DoubleOt").addClass("DNI"))),ZPeopleComponents.toggleswitch(document.getElementById("tot_weekly_overtimetoggle")).setAttribute("on",config.weeklyOverTimePolicy&&"1"===config.weeklyOverTimePolicy.enableOverTimePolicy),config.weeklyOverTimePolicy&&"1"===config.weeklyOverTimePolicy.enableOverTimePolicy&&(Timetracker.overTimePolicy.setOverTimePolicyConfig(settingsPage.container.find("#tot_weekly_overtime #weekly_Ot"),config.weeklyOverTimePolicy.overTimePolicy&&config.weeklyOverTimePolicy.overTimePolicy.otCon,settingsPage.container.find("[name='weekly_payrate']"),json),config.weeklyOverTimePolicy.overTimePolicy&&config.weeklyOverTimePolicy.overTimePolicy.dOtCon&&!$.isEmptyObject(config.weeklyOverTimePolicy.overTimePolicy.dOtCon)?(Timetracker.overTimePolicy.setOverTimePolicyConfig(settingsPage.container.find("#tot_weekly_overtime #weekly_DoubleOt"),config.weeklyOverTimePolicy.overTimePolicy&&config.weeklyOverTimePolicy.overTimePolicy.dOtCon,settingsPage.container.find("[name='weekly_payrateDoubleOt']"),json),pageContainer.find("#tot_weekly_overtime #weekly_DoubleOt").removeClass("DNI"),pageContainer.find("#tot_weekly_overtime #weekly_AddRule").addClass("DNI")):(pageContainer.find("#tot_weekly_overtime #weekly_AddRule").removeClass("DNI"),pageContainer.find("#tot_weekly_overtime #weekly_DoubleOt").addClass("DNI"))),ZPeopleComponents.toggleswitch(document.getElementById("tot_weekend_overtimetoggle")).setAttribute("on",config.weekendOverTimePolicy&&"1"===config.weekendOverTimePolicy.enableOverTimePolicy),config.weekendOverTimePolicy&&"1"===config.weekendOverTimePolicy.enableOverTimePolicy&&(Timetracker.overTimePolicy.setOverTimePolicyConfig(settingsPage.container.find("#tot_weekend_overtime #weekend_Ot"),config.weekendOverTimePolicy.overTimePolicy&&config.weekendOverTimePolicy.overTimePolicy.otCon,settingsPage.container.find("[name='weekend_payrate']"),json),config.weekendOverTimePolicy.overTimePolicy&&config.weekendOverTimePolicy.overTimePolicy.dOtCon&&!$.isEmptyObject(config.weekendOverTimePolicy.overTimePolicy.dOtCon)?(Timetracker.overTimePolicy.setOverTimePolicyConfig(settingsPage.container.find("#tot_weekend_overtime #weekend_DoubleOt"),config.weekendOverTimePolicy.overTimePolicy&&config.weekendOverTimePolicy.overTimePolicy.dOtCon,settingsPage.container.find("[name='weekend_payrateDoubleOt']"),json),pageContainer.find("#tot_weekend_overtime #weekend_DoubleOt").removeClass("DNI"),pageContainer.find("#tot_weekend_overtime #weekend_AddRule").addClass("DNI")):(pageContainer.find("#tot_weekend_overtime #weekend_AddRule").removeClass("DNI"),pageContainer.find("#tot_weekend_overtime #weekend_DoubleOt").addClass("DNI"))),ZPeopleComponents.toggleswitch(document.getElementById("tot_holiday_overtimetoggle")).setAttribute("on",config.holidayOverTimePolicy&&"1"===config.holidayOverTimePolicy.enableOverTimePolicy),config.holidayOverTimePolicy&&"1"===config.holidayOverTimePolicy.enableOverTimePolicy&&(Timetracker.overTimePolicy.setOverTimePolicyConfig(settingsPage.container.find("#tot_holiday_overtime #holiday_Ot"),config.holidayOverTimePolicy.overTimePolicy&&config.holidayOverTimePolicy.overTimePolicy.otCon,settingsPage.container.find("[name='holiday_payrate']"),json),config.holidayOverTimePolicy.overTimePolicy&&config.holidayOverTimePolicy.overTimePolicy.dOtCon&&!$.isEmptyObject(config.holidayOverTimePolicy.overTimePolicy.dOtCon)?(Timetracker.overTimePolicy.setOverTimePolicyConfig(settingsPage.container.find("#tot_holiday_overtime #holiday_DoubleOt"),config.holidayOverTimePolicy.overTimePolicy&&config.holidayOverTimePolicy.overTimePolicy.dOtCon,settingsPage.container.find("[name='holiday_payrateDoubleOt']"),json),pageContainer.find("#tot_holiday_overtime #holiday_DoubleOt").removeClass("DNI"),pageContainer.find("#tot_holiday_overtime #holiday_AddRule").addClass("DNI")):(pageContainer.find("#tot_holiday_overtime #holiday_AddRule").removeClass("DNI"),pageContainer.find("#tot_holiday_overtime #holiday_DoubleOt").addClass("DNI"))),ZPeopleComponents.toggleswitch(document.getElementById("tot_consecutive_overtimetoggle")).setAttribute("on",config.consecutiveOverTimePolicy&&"1"===config.consecutiveOverTimePolicy.enableOverTimePolicy),config.consecutiveOverTimePolicy&&"1"===config.consecutiveOverTimePolicy.enableOverTimePolicy&&(Timetracker.overTimePolicy.setOverTimePolicyConfig(settingsPage.container.find("#tot_consecutive_overtime #consecutive_Ot"),config.consecutiveOverTimePolicy.overTimePolicy&&config.consecutiveOverTimePolicy.overTimePolicy.otCon,settingsPage.container.find("[name='consecutive_payrate']"),json),config.consecutiveOverTimePolicy.overTimePolicy&&config.consecutiveOverTimePolicy.overTimePolicy.dOtCon&&!$.isEmptyObject(config.consecutiveOverTimePolicy.overTimePolicy.dOtCon)?(Timetracker.overTimePolicy.setOverTimePolicyConfig(settingsPage.container.find("#tot_consecutive_overtime #consecutive_DoubleOt"),config.consecutiveOverTimePolicy.overTimePolicy&&config.consecutiveOverTimePolicy.overTimePolicy.dOtCon,settingsPage.container.find("[name='consecutive_payrateDoubleOt']"),json),pageContainer.find("#tot_consecutive_overtime #consecutive_DoubleOt").removeClass("DNI"),pageContainer.find("#tot_consecutive_overtime #consecutive_AddRule").addClass("DNI")):(pageContainer.find("#tot_consecutive_overtime #consecutive_AddRule").removeClass("DNI"),pageContainer.find("#tot_consecutive_overtime #consecutive_DoubleOt").addClass("DNI"))),!json||"clone"!=json.mode){ZPeopleComponents.select(pageContainer.find("#policyApplicability")).setValue(data.otpolicy_app_type);let keyname=Timetracker.overTimePolicy.getAppKeyByKey(data.otpolicy_app_type),appArr=[],appArrList=data.appArr[keyname],arrList=Timetracker.overTimePolicy.appList[keyname];if(data.otpolicy_app_type!=Timetracker.overTimePolicy.overTimePolicyApp.USER_SPECIFIC.key){if(0!=appArrList.length)for(var key in appArrList){var val=arrList[appArrList[key].ID];appArr.push({value:val.recID+"",text:val.recName,label:val.recName})}else appArr.push({value:"0",text:"ALL",label:"ALL"});data.otpolicy_app_type==Timetracker.overTimePolicy.overTimePolicyApp.LOCATION_SPECIFIC.key?TimelyZComp.tokenField.addValues(pageContainer.find("#locationSelect"),appArr):data.otpolicy_app_type==Timetracker.overTimePolicy.overTimePolicyApp.EMP_TYPE_SPECIFIC.key?TimelyZComp.tokenField.addValues(pageContainer.find("#empTypeSelect"),appArr):data.otpolicy_app_type==Timetracker.overTimePolicy.overTimePolicyApp.DEPT_SPECIFIC.key&&TimelyZComp.tokenField.addValues(pageContainer.find("#departmentSelect"),appArr)}}},setOverTimePolicyConfig:function(cardDiv,data,payRateDiv,json){json&&"clone"==json.mode&&json.isTemplate?cardDiv.find("#hrsExcd").val(data&&data.hrsExcd||"00:00"):cardDiv.find("#hrsExcd").val(Calendar.minstohrs(data&&data.hrsExcd||"0"))},constructOtSettPopUp:function(json,config){json=json||{};var html='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.tt.overtimepolicies.policyname")+'</label></div><div><input type="text" class="ztextbox" placeholder="Enter policy name" id="ts_overtimepolicy_name"></div></div><div class="zpl_secn" id="appToSec"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.applicableto",[""])+'</label></div><div class="zpl_cndor wd100_per"><div class="zpl_gbox" id="groupGBox"><div class="zpl_idiv"><select class="select-js" style="display: none;" id="policyApplicability"></select><span>'+ZPI18N.getString("zp.lookup.is")+'</span><textarea elemType="tokenfield" id="userSelect"></textarea><textarea elemType="tokenfield" id="empTypeSelect"></textarea><textarea elemType="tokenfield"id="locationSelect" ></textarea><textarea elemType="tokenfield" id="departmentSelect"></textarea>\t</div></div></div><div class="zpl_info">'+ZPI18N.getString("zp.tt.overtimepolicies.applicabletodesc")+"</span></div></div></div></div></div>";html+='<div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.tt.overtimepolicies.overtimepayrates")+"</h4><p>"+ZPI18N.getString("zp.tt.overtimepolicies.overtimepayratesdesc")+'</p></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.tt.overtimepolicies.calcualteovertimepay")+'</h5></div><div id="payRateTypeDiv" class="zpl_pl6 zpl_mt4"><div class="zradiobutton zradiobutton--horizontal"><input id="ratemultiplerRph" value="0" type="radio" name="payrateType" class="zradiobutton__helper"><label for="ratemultiplerRph" class="zradiobutton__label"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.tt.overtimepolicies.inmultiplesofrph")+' </span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="fixedRph" value="1" type="radio" name="payrateType" class="zradiobutton__helper" checked><label for="fixedRph" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.tt.overtimepolicies.basedonwagerate")+'</span></label></div></div><div class="zpl_pl4 zpl_ml6  zpl_gbox" id="rph_fixedrate"><div class="zpl_secn"><div class="zpl_idiv zpl_mt1"><div class="zpl_w120"><h5 class="zpl_mt0">'+ZPI18N.getString("zp.tt.overtimepolicies.overtimerate")+'</h5></div><em>-</em><div class="zpl_flexaligngap2"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.employeeovertimerph")+'</span></div></div><div class="zpl_idiv"><div class="zpl_w120"><h5 class="zpl_mt0">'+ZPI18N.getString("zp.tt.overtimepolicies.doubletimerate")+'</h5></div><em>-</em><div class="zpl_flexaligngap2"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.employeeextendedovertime")+'</span></div></div><div class="zpl_info zpl_mb0">'+ZPI18N.getString("zp.tt.overtimepolicies.viewconfigureemprphdesc",["#operations/timetracker/payroll"])+'</div></div></div><div class="zpl_pl4 zpl_ml6  zpl_gbox" id="rph_multipler"><div class="zpl_secn"><div class="zpl_idiv zpl_mt1"><div class="zpl_w120"><h5 class="zpl_mt0">'+ZPI18N.getString("zp.tt.overtimepolicies.overtimerate")+'</h5></div><em>-</em><div class="zpl_flexaligngap2"><div><select id="empRphOtSel" elemType="select" class="select-js" style="display: none;"><option value="1.5" selected>1.5</option><option value="2" >2</option></select></div><span>'+ZPI18N.getString("zp.tt.overtimepolicies.regularrateperhour")+'</span></div></div><div class="zpl_idiv" id="empRphDoubleOtSelDiv"><div class="zpl_w120"><h5 class="zpl_mt0">'+ZPI18N.getString("zp.tt.overtimepolicies.doubletimerate")+'</h5></div><em>-</em><div class="zpl_flexaligngap2"><div><select id="empRphDoubleOtSel" elemType="select" class="select-js" style="display: none;"><option value="1.5">1.5</option><option value="2" selected>2</option></select></div><span>'+ZPI18N.getString("zp.tt.overtimepolicies.regularrateperhour")+'</span></div></div><div class="zpl_info zpl_mb0">'+ZPI18N.getString("zp.tt.overtimepolicies.viewconfigureemprphdesc",["#operations/timetracker/payroll"])+"</div></div></div></div></div></div>",html+='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><h4>'+ZPI18N.getString("zp.otrules")+"</h4></div></div>",html+='<div class="zpl_secn" id="tot_daily_overtime"><div class="zpl_tgsprt"><h5 class="zpl_tgl zpl_mt0"><input id="tot_daily_overtimetoggle" elemType="toggleswitch" class="togbutton-js" style="display: none;">'+ZPI18N.getString("zp.dailyot")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.dailyovertime.desc")+'</p></div><div class="zpl_mt0 zpl_tbox DNI"><div class="zpl_gbox"><div class="zpl_crdlst zpl_mb0"><div class="zpl_catlst" name="ot" id="daily_Ot"><div><h5>'+ZPI18N.getString("zp.ot_")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.dailyovertime.overtime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input type="text" id="hrsExcd" class="ztextbox w80 zpl_mr1" placeholder="hh:mm"></div><span>'+ZPI18N.getString("zp.hrsperday")+'</span></div></div></div></div><div class="zpl_catlst DNI" name="doubleOt" id="daily_DoubleOt"><div><h5>'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.dailyovertime.doubleovertime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input id="hrsExcd" type="text" class="ztextbox w80 zpl_mr1" placeholder="hh:mm"></div><span>'+ZPI18N.getString("zp.hrsperday")+'</span></div></div></div><div class="zpl_flex-0"><div class="zpl_hvr"><i onclick="Timetracker.overTimePolicy.deleteDoubleOtConfig(this)" class="PI_delete"></i></div></div></div><div class="zpl_idiv" name="addRule" id="daily_AddRule" onclick="Timetracker.overTimePolicy.showDoubleOtConfig(this)"><a class="zpl_lnkbg" >'+ZPI18N.getString("zp.tt.overtimepolicies.adddoubletime")+'</a></div></div></div></div></div><div class="zpl_secn" id="tot_weekly_overtime"><div class="zpl_tgsprt"><div class="zpl_flex-a-c"><h5 class="zpl_tgl zpl_mt0"><input id="tot_weekly_overtimetoggle" elemType="toggleswitch" class="togbutton-js" style="display: none;">'+ZPI18N.getString("zp.wklyot")+'</h5><i class="PI_info tooltip-js" title="'+ZPI18N.getString("zp.calascalwk")+'"></i></div><p>'+ZPI18N.getString("zp.tt.overtimepolicies.weeklyovertime.desc")+'</p></div><div class="zpl_mt0 zpl_tbox DNI"><div class="zpl_gbox"><div class="zpl_crdlst zpl_mb0"><div class="zpl_catlst" name="ot" id="weekly_Ot"><div><h5>'+ZPI18N.getString("zp.ot_")+"</h5><p> "+ZPI18N.getString("zp.tt.overtimepolicies.weeklyovertime.overtime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input type="text" id="hrsExcd" class="ztextbox w80 zpl_mr1" placeholder="hh:mm"></div><span>'+ZPI18N.getString("zp.othrsperweek")+'</span></div></div></div></div><div class="zpl_catlst DNI" name="doubleOt" id="weekly_DoubleOt"><div><h5>'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.weeklyovertime.doubleovertime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input id="hrsExcd" type="text" class="ztextbox w80 zpl_mr1" placeholder="hh:mm"></div><span>'+ZPI18N.getString("zp.othrsperweek")+'</span></div></div></div><div class="zpl_flex-0"><div class="zpl_hvr"><i onclick="Timetracker.overTimePolicy.deleteDoubleOtConfig(this)" class="PI_delete"></i></div></div></div><div class="zpl_idiv" name="addRule" id="weekly_AddRule" onclick="Timetracker.overTimePolicy.showDoubleOtConfig(this)"><a class="zpl_lnkbg">'+ZPI18N.getString("zp.tt.overtimepolicies.adddoubletime")+'</a></div></div></div></div></div><div  class="zpl_secn" id="tot_weekend_overtime"><div class="zpl_tgsprt"><h5 class="zpl_tgl zpl_mt0"><input id="tot_weekend_overtimetoggle" elemType="toggleswitch" class="togbutton-js" style="display: none;">'+ZPI18N.getString("zp.tt.overtimepolicies.weekendovertime")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.weekendovertime.desc")+'</p></div><div class="zpl_tbox zpl_mt0 DNI"><div class="zpl_gbox"><div class="zpl_crdlst zpl_mb0"><div class="zpl_catlst" name="ot" id="weekend_Ot"><div><h5>'+ZPI18N.getString("zp.ot_")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.weekendovertime.overtime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input id="hrsExcd" type="text" class="ztextbox w80 zpl_mr1" placeholder="hh:mm"></div><span>'+ZPI18N.getString("zp.hrsperday")+'</span></div></div></div></div><div class="zpl_catlst DNI"  name="doubleOt" id="weekend_DoubleOt"><div><h5>'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.weekendovertime.doubleovertime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input id="hrsExcd" type="text" class="ztextbox w80 zpl_mr1" placeholder="hh:mm"></div><span>'+ZPI18N.getString("zp.hrsperday")+'</span></div></div></div><div class="zpl_flex-0"><div class="zpl_hvr"><i onclick="Timetracker.overTimePolicy.deleteDoubleOtConfig(this)" class="PI_delete"></i></div></div></div><div class="zpl_idiv" name="addRule" id="weekend_AddRule" onclick="Timetracker.overTimePolicy.showDoubleOtConfig(this)"><a id="add_weekend_rule" class="zpl_lnkbg">'+ZPI18N.getString("zp.tt.overtimepolicies.adddoubletime")+'</a></div></div></div></div></div><div class="zpl_secn" id="tot_holiday_overtime"><div class="zpl_tgsprt"><h5 class="zpl_tgl zpl_mt0"><input id="tot_holiday_overtimetoggle" elemType="toggleswitch" class="togbutton-js" style="display: none;">'+ZPI18N.getString("zp.tt.overtimepolicies.holidayovertime")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.holidayovertime.desc")+'</p></div><div class="zpl_tbox zpl_mt0 DNI"><div class="zpl_gbox"><div class="zpl_crdlst zpl_mb0"><div class="zpl_catlst" name="ot" id="holiday_Ot"><div><h5>'+ZPI18N.getString("zp.ot_")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.holidayovertime.overtime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input type="text" id="hrsExcd" class="ztextbox w80 zpl_mr1" placeholder="hh:mm"></div><span>'+ZPI18N.getString("zp.hrsperday")+'</span></div></div></div></div><div class="zpl_catlst DNI" name="doubleOt" id="holiday_DoubleOt"><div><h5>'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.holidayovertime.doubleovertime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input id="hrsExcd" type="text" class="ztextbox w80 zpl_mr1" placeholder="hh:mm"></div><span>'+ZPI18N.getString("zp.hrsperday")+'</span></div></div></div><div class="zpl_flex-0"><div class="zpl_hvr"><i class="PI_delete" onclick="Timetracker.overTimePolicy.deleteDoubleOtConfig(this)"></i></div></div></div><div class="zpl_idiv" name="addRule" id="holiday_AddRule" onclick="Timetracker.overTimePolicy.showDoubleOtConfig(this)"><a class="zpl_lnkbg">'+ZPI18N.getString("zp.tt.overtimepolicies.adddoubletime")+'</a></div></div></div></div></div><div class="zpl_secn" id="tot_consecutive_overtime"><div class="zpl_tgsprt"><h5 class="zpl_tgl zpl_mt0"><input id="tot_consecutive_overtimetoggle" elemType="toggleswitch" class="togbutton-js" style="display: none;">'+ZPI18N.getString("zp.tt.overtimepolicies.consecutiveovertime")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.consecutiveovertime.desc")+'</p></div><div class="zpl_tbox zpl_mt0 DNI"><div class="zpl_gbox"><div class="zpl_crdlst zpl_mb0"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.consecutiveovertime.consectutive.desc")+'</span></div><div class="zpl_catlst" name="ot" id="consecutive_Ot"><div><h5>'+ZPI18N.getString("zp.ot_")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.consecutiveovertime.overtime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input type="text" id="hrsExcd"  class="ztextbox w80 zpl_mr1" placeholder="hh:mm"></div><span>'+ZPI18N.getString("zp.hrsperday")+'</span></div></div></div></div><div class="zpl_catlst  DNI" name="doubleOt" id="consecutive_DoubleOt"><div><h5>'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+"</h5><p>"+ZPI18N.getString("zp.tt.overtimepolicies.consecutiveovertime.doubleovertime.desc")+'</p><div class="zpl_mt3"><div class="zpl_idiv"><span class="">'+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+'</span><div><input type="text" id="hrsExcd"  class="ztextbox w80 zpl_mr1" placeholder="10:00"></div><span>hours/days</span></div></div></div><div class="zpl_flex-0"><div class="zpl_hvr"><i class="PI_delete" onclick="Timetracker.overTimePolicy.deleteDoubleOtConfig(this)"></i></div></div></div><div class="zpl_idiv" name="addRule"  id="consecutive_AddRule" onclick="Timetracker.overTimePolicy.showDoubleOtConfig(this)"><a class="zpl_lnkbg">'+ZPI18N.getString("zp.tt.overtimepolicies.adddoubletime")+"</a></div></div></div></div></div></div>";var modal=ModuleComp.Modal.setup({id:"ttAddOTPolicySettings",type:1,header:json.mode===Timetracker.constants.EDIT?ZPI18N.getString("zp.editot"):ZPI18N.getString("zp.addotbtn"),body:html,backdrop:!1,deleteOnHide:!0,buttonValue:json.mode===Timetracker.constants.EDIT?ZPI18N.getString("zp.save"):ZPI18N.getString("zp.add"),hiddenCallback:Timetracker.overTimePolicy.destroyZComp,closeonEsc:!0,LayerId:settingsPage.container[0].id});modal.find(".zpl_mcnt").attr("id","moduleCards"),modal.addClass("zpl_mmd"),TimelyZComp.toolTip.customMsgIntz(modal,[{class:"PI_cls",title:ZPI18N.getString("zp.close")}]),Timetracker.overTimePolicy.intializeZcomp();let extraDtls={dropdownList:{className:"zpl_ddoptnrml",fitForElement:!0,closeOnScroll:!0,closeOnSelect:!1,hideItemOnSelect:!0}};Timetracker.Search.populateZCompUsers("userSelect",null,{submode:"TIMETRACKER_SETTINGS",skipDefaultValues:!0,defaultOptionNeeded:!0,extraParams:{projectManagerPerm:!0},placeHolder:ZPI18N.getString("zp.select"),useDefaultValuesCache:!0},!0,modal),TimelyZComp.tokenField.intialize(modal.find("#locationSelect"),extraDtls,!0),TimelyZComp.tokenField.intialize(modal.find("#empTypeSelect"),extraDtls,!0),TimelyZComp.tokenField.intialize(modal.find("#departmentSelect"),extraDtls,!0),ZPeopleComponents.select(modal.find("#policyApplicability"),{change:function(){Timetracker.overTimePolicy.toggleApplicabilitySel(json,config)},width:"200px",dropdownList:{fitForElement:!0,className:"zpl_ddoptnrml",closeOnScroll:!0}}),ZPeopleComponents.select(modal.find("#policyApplicability")).addOption([{value:Timetracker.overTimePolicy.overTimePolicyApp.USER_SPECIFIC.key,label:ZPI18N.getString("zp.user")},{value:Timetracker.overTimePolicy.overTimePolicyApp.EMP_TYPE_SPECIFIC.key,label:ZPI18N.getString("zp.local.Employmenttype")},{value:Timetracker.overTimePolicy.overTimePolicyApp.LOCATION_SPECIFIC.key,label:ZPI18N.getString("zp.location")},{value:Timetracker.overTimePolicy.overTimePolicyApp.DEPT_SPECIFIC.key,label:ZPI18N.getString("zp.department")}]),modal.find('[name="payrateType"]').on("click",function(div){"0"==$(div.target).attr("value")?(modal.find("#rph_fixedrate").hide(),modal.find("#rph_multipler").show()):(modal.find("#rph_fixedrate").show(),modal.find("#rph_multipler").hide())}),pageContainer.find("#payRateTypeDiv input[value='0']").trigger("click")},toggleApplicabilitySel:function(json,config){var modal=settingsPage.container.find("#ttAddOTPolicySettings"),isEdit=json.mode==Timetracker.constants.EDIT;let policyApplicable=ZPeopleComponents.select(modal.find("#policyApplicability")).getValue();if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.LOCATION_SPECIFIC.key){modal.find("#locationSelect").next().show(),modal.find("#userSelect,#departmentSelect,#empTypeSelect").next().hide();let mappedList=new Array;isEdit&&config.appArr.locationAppArr&&(mappedList=0==config.appArr.locationAppArr.length?["0"]:config.appArr.locationAppArr.map(obj=>obj.ID)),Timetracker.overTimePolicy.constructOptionsList(policyApplicable,mappedList,modal)}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.USER_SPECIFIC.key){modal.find("#userSelect").next().show(),modal.find("#locationSelect,#departmentSelect,#empTypeSelect").next().hide();let mappedList=new Array;if(isEdit&&config.appArr.userAppArr){let values=[];if(1==(mappedList=0==config.appArr.userAppArr.length?["0"]:config.appArr.userAppArr.map(obj=>obj.ID)).length&&"0"==mappedList[0])values.push({id:"0"," ":ZPI18N.getString("zp.allemployees"),html:ZPI18N.getString("zp.allemployees"),photo:ZPeople.getDefaultUserImagePath()});else{let userList=ZPeople.getUserDetailsByIds(mappedList,!1);for(var i in mappedList){var id=mappedList[i],userDtl=ZPeople.getUserDetailsByIdInList(id,userList);userDtl&&userDtl.name&&values.push({id:id,text:ZPeople.decodeTxt(userDtl.empid+" "+userDtl.name),html:userDtl.empid+" "+userDtl.name,photo:userDtl.avatar})}}TimelyZComp.tokenField.addValues(modal.find("#userSelect"),values)}modal.find("#userSelect").on("ztokenfieldbeforetokenadd",function(obj){Timetracker.overTimePolicy.getZtokenFieldOnchangeForApp(obj,modal.find("#userSelect"))})}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.EMP_TYPE_SPECIFIC.key){modal.find("#empTypeSelect").next().show(),modal.find("#locationSelect,#departmentSelect,#userSelect").next().hide();let mappedList=new Array;isEdit&&config.appArr.empTypeAppArr&&(mappedList=0==config.appArr.empTypeAppArr.length?["0"]:config.appArr.empTypeAppArr.map(obj=>obj.ID)),Timetracker.overTimePolicy.constructOptionsList(policyApplicable,mappedList,modal)}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.DEPT_SPECIFIC.key){modal.find("#departmentSelect").next().show(),modal.find("#locationSelect,#empTypeSelect,#userSelect").next().hide();let mappedList=new Array;isEdit&&config.appArr.departmentAppArr&&(mappedList=0==config.appArr.departmentAppArr.length?["0"]:config.appArr.departmentAppArr.map(obj=>obj.ID)),Timetracker.overTimePolicy.constructOptionsList(policyApplicable,mappedList,modal)}},constructOptionsList:function(policyApplicable,curSettMappedList,modal){let options=[],keyName=Timetracker.overTimePolicy.getAppKeyByKey(policyApplicable);if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.LOCATION_SPECIFIC.key){Timetracker.overTimePolicy.appList.locationAppArr=Timetracker.overTimePolicy.appList.locationAppArr||AppExc.appElements.locationList;let optionsObj={label:"ALL",label:"ALL",value:"0"};for(var locationId in options.push(optionsObj),Timetracker.overTimePolicy.mappedAppList[keyName]&&Timetracker.overTimePolicy.mappedAppList[keyName].includes("0")&&!curSettMappedList.includes("0")&&(optionsObj.disabled=!0,optionsObj.title="Mapped to other Policy"),Timetracker.overTimePolicy.appList.locationAppArr){let location=Timetracker.overTimePolicy.appList.locationAppArr[locationId];(optionsObj={}).value=location.recID,optionsObj.text=optionsObj.label=decodeHTML(location.recName),Timetracker.overTimePolicy.mappedAppList[keyName]&&Timetracker.overTimePolicy.mappedAppList[keyName].includes(location.recID)&&!curSettMappedList.includes(location.recID)&&(optionsObj.disabled=!0,optionsObj.title="Mapped to other Policy"),options.push(optionsObj)}TimelyZComp.tokenField.addOptions(modal.find("#locationSelect"),options),modal.find("#userSelect,#empTypeSelect,#departmentSelect").addClass("DNI"),modal.find("#locationSelect").on("ztokenfieldbeforetokenadd",function(obj){Timetracker.overTimePolicy.getZtokenFieldOnchangeForApp(obj,modal.find("#locationSelect"))})}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.EMP_TYPE_SPECIFIC.key){Timetracker.overTimePolicy.appList.empTypeAppArr=Timetracker.overTimePolicy.appList.empTypeAppArr||AppExc.appElements.empTypeList;let optionsObj={label:"ALL",label:"ALL",value:"0"};for(var empTypeId in options.push(optionsObj),Timetracker.overTimePolicy.mappedAppList[keyName]&&Timetracker.overTimePolicy.mappedAppList[keyName].includes("0")&&!curSettMappedList.includes("0")&&(optionsObj.disabled=!0,optionsObj.title="Mapped to other Policy"),Timetracker.overTimePolicy.appList.empTypeAppArr){let empType=Timetracker.overTimePolicy.appList.empTypeAppArr[empTypeId];(optionsObj={}).value=empType.recID,optionsObj.text=optionsObj.label=decodeHTML(empType.recName),Timetracker.overTimePolicy.mappedAppList[keyName]&&Timetracker.overTimePolicy.mappedAppList[keyName].includes(empType.recID)&&!curSettMappedList.includes(empType.recID)&&(optionsObj.disabled=!0,optionsObj.title="Mapped to other Policy"),options.push(optionsObj)}TimelyZComp.tokenField.addOptions(modal.find("#empTypeSelect"),options),modal.find("#locationSelect,#empTypeSelect,#departmentSelect").addClass("DNI"),modal.find("#empTypeSelect").on("ztokenfieldbeforetokenadd",function(obj){Timetracker.overTimePolicy.getZtokenFieldOnchangeForApp(obj,modal.find("#empTypeSelect"))})}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.DEPT_SPECIFIC.key){Timetracker.overTimePolicy.appList.departmentAppArr=Timetracker.overTimePolicy.appList.departmentAppArr||AppExc.appElements.departmentList;let optionsObj={label:"ALL",label:"ALL",value:"0"};for(var departmentId in options.push(optionsObj),Timetracker.overTimePolicy.mappedAppList[keyName]&&Timetracker.overTimePolicy.mappedAppList[keyName].includes("0")&&!curSettMappedList.includes("0")&&(optionsObj.disabled=!0,optionsObj.title="Mapped to other Policy"),Timetracker.overTimePolicy.appList.departmentAppArr){let department=Timetracker.overTimePolicy.appList.departmentAppArr[departmentId];(optionsObj={}).value=department.recID,optionsObj.text=optionsObj.label=decodeHTML(department.recName),Timetracker.overTimePolicy.mappedAppList[keyName]&&Timetracker.overTimePolicy.mappedAppList[keyName].length>0&&Timetracker.overTimePolicy.mappedAppList[keyName].includes(department.recID)&&!curSettMappedList.includes(department.recID)&&(optionsObj.disabled=!0,optionsObj.title="Mapped to other Policy"),options.push(optionsObj)}TimelyZComp.tokenField.addOptions(modal.find("#departmentSelect"),options),modal.find("#locationSelect,#empTypeSelect,#userSelect").addClass("DNI"),modal.find("#departmentSelect").on("ztokenfieldbeforetokenadd",function(obj){Timetracker.overTimePolicy.getZtokenFieldOnchangeForApp(obj,modal.find("#departmentSelect"))})}},getZtokenFieldOnchangeForApp:function(obj,ele){$(obj)[0].originalEvent&&$(obj)[0].originalEvent.detail.fromUI&&("0"===obj.detail.tokenData.value?TimelyZComp.tokenField.deSelectAll(ele):TimelyZComp.tokenField.deSelect(ele,["0"]))},intializeZcomp:function(pageContainer){(pageContainer=pageContainer||settingsPage.container).find("[elemType=select]").each(function(){ZPeopleComponents.select(pageContainer.find("#"+$(this).attr("id")))}),Timetracker.overTimePolicy.setToggle()},setToggle:function(){pageContainer=settingsPage.container,pageContainer.find("[elemType=toggleswitch]").each(function(){let toggleDiv=pageContainer.find("#"+$(this).attr("id"));ZPeopleComponents.isComponent(toggleDiv)||ZPeopleComponents.toggleswitch(toggleDiv,{on:!1,change:function(){ZPeopleComponents.toggleswitch(toggleDiv).getState()?$(toggleDiv).parents(".zpl_secn").find(".zpl_tbox").removeClass("DNI"):$(toggleDiv).parents(".zpl_secn").find(".zpl_tbox").addClass("DNI")}})})},showDoubleOtConfig:function(div,key){$(div).siblings('[name="doubleOt"]').removeClass("DNI"),$(div).parents(".zpl_secn").find("[name='addRule']").addClass("DNI")},deleteDoubleOtConfig:function(div){$(div).closest('[name="doubleOt"]').addClass("DNI"),$(div).parents(".zpl_secn").find("[name='addRule']").removeClass("DNI")},destroyZComp:function(){var modal=settingsPage.container.find("#ttAddOTPolicySettings");modal.find("select").each(function(){TimelyZComp.select.destroy($(this))}),modal.find("textarea").each(function(){TimelyZComp.tokenField.destroy($(this))}),pageContainer.find("[elemType=select]").each(function(){TimelyZComp.select.destroy(this)}),pageContainer.find("[elemType=toggleswitch]").each(function(){ZPeopleComponents.toggleswitch(this).destroy()}),pageContainer.find("[elemType=tokenfield]").each(function(){TimelyZComp.tokenField.destroy($(this))}),TimelyZComp.select.destroy(modal.find("#policyApplicability"))},getAppKeyByKey:function(key){for(const policyName in Timetracker.overTimePolicy.overTimePolicyApp)if(Timetracker.overTimePolicy.overTimePolicyApp[policyName].key==key)return Timetracker.overTimePolicy.overTimePolicyApp[policyName].appKey;return null},getUrl:function(){return"/timetracker/settings/otpolicy"},initiateSearch:function(obj){new searchFilter(obj).setSearchProp({mode:"TimesheetOT",id:"id"})},template:{fetchOtTemplateList:async function(){Timetracker.overTimePolicy.appList=[],settingsPage.container.find("#zp_page_loading").remove(),settingsPage.container.find("#zp_empty_data,#otsetting_list,#ottemplate_list").hide(),TimelySettings.showHideLoadingPage(!0,void 0,"ttot_loading_div");var pageContainer=settingsPage.container;const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(Timetracker.overTimePolicy.template.getUrl(),{},void 0,"GET");AppExc.getApplicableIds(),Timetracker.overTimePolicy.template.constructOtTemplateList(response,pageContainer)},constructOtTemplateList:function(response,pageContainer){if(0===response.status&&(response.hasOwnProperty("message")&&Timetracker.util.showAlert(0,response.message),"PERMISSION_DENIED_ERROR"===response.code))return layout.find("#timetrackerTimelogReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),void layout.find(".lt_nav").addClass("DN");var isEmpty=0===response.status||0===Object.keys(response.data).length||0===Object.keys(response.data.dataArr).length;response=response.data&&response.data.dataArr||[],Timetracker.genSettings.addTablFxdCls(),Timetracker.overTimePolicy.initiateSearch(pageContainer.find("#ot_search")),isEmpty?(Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.tt.overtimepolicies.nodatamessage"),buttonName:ZPI18N.getString("zp.addotbtn"),buttonCallBack:Timetracker.overTimePolicy.constructAddPopUp,desc:ZPI18N.getString("zp.tt.overtimepolicies.nodatamessagedesc")}),pageContainer.find("#addOtPolicy").hide(),pageContainer.find("#zp_empty_data").fadeIn(200)):(settingsPage.container.find("#ottemplate_list").html(""),pageContainer.find("#addOtPolicy").show(),Timetracker.overTimePolicy.template.constructOtTemplateListRows(response,pageContainer),pageContainer.find("#ottemplate_list").fadeIn(200),TimelyZComp.toolTip.intiliaze()),TimelySettings.showHideLoadingPage()},constructOtTemplateListRows:function(configArr,pageContainer){const colors=["zpl_seclrgr","zpl_seclryl","zpl_seclrlvd","zpl_seclrgy"];$.each(configArr,function(index,configObj){Timetracker.overTimePolicy.template.constructTemplateRow(configObj,colors[index%4],pageContainer)})},constructTemplateRow:function(configObj,colorClass,pageContainer){let policyId=configObj.otpolicy_state_code;div=pageContainer.find("#ottemplate_list");let txt='<div class="zpl_msplst" id="'+policyId+'"><div class="aCard_bdr '+colorClass+'"><div class="zpl_msp-dts" name="ottemplate_name" onclick="Timetracker.overTimePolicy.template.constructTemplate($(this).closest(\'.zpl_msplst\'));"><b>'+configObj.otpolicy_name+'</b></div><div class="zpl_w140"><em>'+configObj.otpolicy_state+'</em></div><div class="zpl_w140"><div class="zpl_flexaligngap2"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"usflag.png")+'" class=""><span>'+configObj.otpolicy_country+'</span></div></div><div><span><input class="togbutton-js" id="toggle_'+policyId+'" checked="" style="display: none;"></span></div><div class="zpl_msp-act"><div class="zpl_hvr"> <i class="PI_clone" title='+ZPI18N.getString("zp.clone")+" onclick=\"Timetracker.overTimePolicy.template.cloneOverTimeTemplate('"+policyId+"')\"></i></div></div></div></div>";txt=$(txt).data("configInfo",configObj),div.append(txt);let toogleDiv=div.find("#toggle_"+policyId);configObj.otpolicy_isenabled?ZPeopleComponents.toggleswitch(toogleDiv).switchOn():ZPeopleComponents.toggleswitch(toogleDiv).switchOff(),toogleDiv.on("ztoggleswitchchange",Timetracker.overTimePolicy.template.toggleBreakStatus)},constructTemplateRowNew:function(configObj,div){let policyId=configObj.otpolicy_state_code;div=div||settingsPage.container.find("#ottemplate_list");var txt='<tr id="'+policyId+'"><td name="ottemplate_name" onclick="Timetracker.overTimePolicy.template.constructTemplate($(this).closest(\'tr\'));"><span>'+configObj.otpolicy_name+'</span></td><td><span><input class="togbutton-js" id="toggle_'+policyId+'" checked="" style="display: none;"></span></td><td><div class="zpl_hvr"> <i class="PI_clone" title='+ZPI18N.getString("zp.clone")+" onclick=\"Timetracker.overTimePolicy.template.cloneOverTimeTemplate('"+policyId+"')\"></i></div></td></tr>";txt=$(txt).data("configInfo",configObj),div.append(txt);let toogleDiv=div.find("#toggle_"+policyId);configObj.otpolicy_isenabled?ZPeopleComponents.toggleswitch(toogleDiv).switchOn():ZPeopleComponents.toggleswitch(toogleDiv).switchOff(),toogleDiv.on("ztoggleswitchchange",Timetracker.overTimePolicy.template.toggleBreakStatus)},constructTemplate:function(thisObj){var config=$.extend(!0,{},$(thisObj).data("configInfo"));Timetracker.overTimePolicy.template.constructTemplatePopUp({mode:Timetracker.constants.EDIT},config),settingsPage.container.find("#ttAddOTTemplateSettings").find("#zp_modal_blubtn").addClass("DNI")},constructMoreOption:function(moreopt,Id){if(Object.keys(moreopt).length>0){var mhtml='<div id="'+Id+'" class="zpl_drpdwn zpl_tagdrpdwn zmenu zposition--bottomright zh-radiustopright" data-type="list"><ul data-body="true" style="height: auto;">';let count=0;$.each(moreopt,function(key,name){count>0&&(mhtml+='<li data-item-type="custom"><div class="zpl_tg"><span>'+name+"</span></div></li>"),count++});let forElementId=Id+"Btn";mhtml+="</ul></div>",$(settingsPage.mainWrapId).append(mhtml),ZPeopleComponents.menu("#"+Id,{forElement:"#"+forElementId}),settingsPage.container.find("#"+forElementId).off().on("click",e=>{e.stopPropagation(),ZPeopleComponents.menu("#"+Id).show()})}},constructTemplatePopUp:function(json,config){let otpolicy_config=config.otpolicy_config||{},dailyOverTimePolicy=otpolicy_config.dailyOverTimePolicy||{},weeklyOverTimePolicy=otpolicy_config.weeklyOverTimePolicy||{},weekendOverTimePolicy=otpolicy_config.weekendOverTimePolicy||{},holidayOverTimePolicy=otpolicy_config.holidayOverTimePolicy||{},consecutiveOverTimePolicy=otpolicy_config.consecutiveOverTimePolicy||{};otpolicy_config.payRateOt,otpolicy_config.payRateDoubleOt;json=json||{};var html='<div class="zpl_btnmnu"><div class="zpl_idiv"><h5>'+ZPI18N.getString("zp.tt.overtimepolicies.compliancelocation")+'</h5>:<div class="zpl_tg"><span class="zpl_mxw300"><em>'+config.otpolicy_state+', <img src="'+ZPeople.getResourceURL(newUIImageUrl+"usflag.png")+'"> '+config.otpolicy_country+"</em></span></div>";if(config.otpolicy_applocationarr&&0!==config.otpolicy_applocationarr.length){if(html+='<div class="zpl_msp-splt">|</div>',html+='<div class="zpl_flexaligngap2"><h5>'+ZPI18N.getString("zp.payperiod.applicablelocations")+'</h5>:<div class="zpl_tg"><span><em>',config.otpolicy_applocationarr.length>1){html+=config.otpolicy_applocationarr[0]}else{let appLocations="";config.otpolicy_applocationarr.forEach(element=>appLocations+=" "+element),html+=appLocations}html+="</em></span></div>",config.otpolicy_applocationarr&&config.otpolicy_applocationarr.length>1&&(html+='<div class="zpl_tg"><a id="lOtMoreOptions_'+config.otpolicy_id+'Btn" class="zpl_drpdwn-js">+'+(config.otpolicy_applocationarr.length-1)+"</a></div>"),html+='<i class="PI_info tooltip-js" title="'+ZPI18N.getString("zp.tt.overtimepolicies.alladdedlocations",[config.otpolicy_state])+'"></i></div>'}html+="</div></div>",html+='<form><div class="zpl_crd"><div class="zpl_crdcnt">',html+='<div class="zpl_secn">',html+="<div><h4>"+ZPI18N.getString("zp.tt.overtimepolicies.overtimeconfiguration")+"</h4></div>",html+='<div><table class="zpl_tbl zpl_w-100">',html+="<thead><tr><th>"+ZPI18N.getString("zp.otrules")+"</th><th>"+ZPI18N.getString("zp.tt.overtimepolicies.threshold")+"</th><th>"+ZPI18N.getString("zp.tt.overtimepolicies.payrate")+"</th></tr></thead>",html+="<tbody>","1"===dailyOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td>"+ZPI18N.getString("zp.dailyot")+"</td><td><span>"+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+" "+dailyOverTimePolicy.overTimePolicy.otCon.hrsExcd+" "+ZPI18N.getString("zp.hrsperday")+'</span></td><td><div class="zpl_tg jc7"><span>'+ZPI18N.getString("zp.ot_")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["1.5x"])+"</span></div></td></tr>",dailyOverTimePolicy.overTimePolicy.dOtCon&&void 0!==dailyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td>"+ZPI18N.getString("zp.tt.overtimepolicies.dailydoubletime")+"</td><td><span>"+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+" "+dailyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" "+ZPI18N.getString("zp.hrsperday")+'</span></td><td><div class="zpl_tg jc6"><span class="zpl_mxw240">'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["2.0x"])+"</span></div></td></tr>")),"1"===weeklyOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td>"+ZPI18N.getString("zp.wklyot")+"</td><td><span>"+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+" "+weeklyOverTimePolicy.overTimePolicy.otCon.hrsExcd+" "+ZPI18N.getString("zp.othrsperweek")+'</span></td><td><div class="zpl_tg jc7"><span>'+ZPI18N.getString("zp.ot_")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["1.5x"])+"</span></div></td></tr>",weeklyOverTimePolicy.overTimePolicy.dOtCon&&void 0!==weeklyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td><b>"+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+"</td><td><span>"+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+" "+weeklyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" "+ZPI18N.getString("zp.othrsperweek")+'</span></td><td><div class="zpl_tg jc7"><span class="zpl_mxw240">'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["2.0x"])+"</span></div></td></tr>")),"1"===weekendOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td>"+ZPI18N.getString("zp.ot_")+"</td><td><span>"+weekendOverTimePolicy.overTimePolicy.otCon.hrsExcd+" "+ZPI18N.getString("zp.hrsperday")+'</span></td><td><span><div class="zpl_tg jc7"><span>'+ZPI18N.getString("zp.ot_")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["1.5x"])+"</span></div></td></tr>",weekendOverTimePolicy.overTimePolicy.dOtCon&&void 0!==weekendOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td>"+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+"</td><td><span>"+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+" "+weekendOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" "+ZPI18N.getString("zp.hrsperday")+'</span></td><td><div class="zpl_tg jc6"><span class="zpl_mxw240">'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["2.0x"])+"</span></div></td></tr>")),"1"===holidayOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td>"+ZPI18N.getString("zp.ot_")+"<p></td><td><span>"+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+" "+holidayOverTimePolicy.overTimePolicy.otCon.hrsExcd+" "+ZPI18N.getString("zp.hrsperday")+'</span></td><td><div class="zpl_tg jc7"><span>'+ZPI18N.getString("zp.ot_")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["1.5x"])+"</span></div></td></tr>",holidayOverTimePolicy.overTimePolicy.dOtCon&&void 0!==holidayOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td>"+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+"</td><td><span>"+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+" "+holidayOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" "+ZPI18N.getString("zp.hrsperday")+'</span></td><td><div class="zpl_tg jc6"><span class="zpl_mxw240">'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["2.0x"])+"</span></div></td></tr>")),"1"===consecutiveOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td>"+ZPI18N.getString("zp.tt.overtimepolicies.sevenconsecutiveovertime")+"</td><td><span>"+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+" "+consecutiveOverTimePolicy.overTimePolicy.otCon.hrsExcd+" "+ZPI18N.getString("zp.hrsperday")+'</span></td><td><span><div class="zpl_tg jc7"><span>'+ZPI18N.getString("zp.ot_")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["1.5x"])+"</span></div></td></tr>",consecutiveOverTimePolicy.overTimePolicy.dOtCon&&void 0!==consecutiveOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td>"+ZPI18N.getString("zp.tt.overtimepolicies.sevenconsecutivedoubleovertime")+"</td><td><span>"+ZPI18N.getString("zp.tt.overtimepolicies.timelogexceeding")+" "+consecutiveOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" "+ZPI18N.getString("zp.hrsperday")+'</span></td><td><div class="zpl_tg jc6"><span class="zpl_mxw240">'+ZPI18N.getString("zp.tt.overtimepolicies.doubletime")+" - "+ZPI18N.getString("zp.tt.overtimepolicies.regularph",["2.0x"])+"</span></div></td></tr>")),html+="<tbody>",html+="</tbody>",html+="</div></table>",html+="</div></div></div></div>",html+='<div class="zpl_info"><h6>'+ZPI18N.getString("zp.note")+"</h6><ul><li>"+ZPI18N.getString("zp.tt.overtimepolicies.emprphnote")+"</li><li>"+ZPI18N.getString("zp.tt.overtimepolicies.viewconfigureemprphdesc",["#operations/timetracker/payroll"])+"</li></div></form>";var modal=ModuleComp.Modal.setup({id:"ttAddOTTemplateSettings",type:4,header:ZPI18N.getString("zp.tt.overtimepolicies.overtimepolicyrules",[config.otpolicy_state]),body:html,backdrop:!1,deleteOnHide:!0,buttonValue:ZPI18N.getString("zp.save"),closeonEsc:!0,LayerId:settingsPage.container[0].id});config.otpolicy_applocationarr&&config.otpolicy_applocationarr.length>1&&Timetracker.overTimePolicy.template.constructMoreOption(config.otpolicy_applocationarr,"lOtMoreOptions_"+config.otpolicy_id),modal.find(".zpl_mcnt").attr("id","moduleCards"),modal.addClass("zpl_mmd"),TimelyZComp.toolTip.customMsgIntz(modal,[{class:"PI_cls",title:ZPI18N.getString("zp.close")}])},cloneOverTimeTemplate:async function(settingsId){const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(Timetracker.overTimePolicy.template.getUrl()+"/"+settingsId,{},void 0,"GET");Timetracker.overTimePolicy.cloneOverTimePolicyCallback(response,!0)},mapOverTimeTemplate:async function(settingsId){const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(Timetracker.overTimePolicy.template.getUrl()+"/"+settingsId,{},void 0,"GET");Timetracker.overTimePolicy.template.mapOverTimePolicyCallback(response,{})},mapOverTimePolicyCallback:function(response,params){let data=0!==response.status?response.data:response.errors;if(0!==response.status){Timetracker.overTimePolicy.template.constructMapTemplatePopUp(response.data.dataArr[0]);var modal=settingsPage.container.find("#ttAddOTPolicySettings");ZPeopleComponents.select(modal.find("#policyApplicability")).setValue("2"),modal.find("#zp_modal_blubtn").removeClass("disabled").off("click").on("click",function(){Timetracker.overTimePolicy.template.addTemplateMappingRecord(response.data.dataArr[0])})}else data.hasOwnProperty("message")&&Timetracker.util.showAlert(0,data.message)},addTemplateMappingRecord:async function(config){var modal=settingsPage.container.find("#ttAddOTPolicySettings");modal.find("#zp_modal_blubtn").prop("disabled",!1);var params={otPolicyInputData:{}};params.otPolicyInputData.policyName=modal.find("#ts_overtimepolicy_name").val();let policyApplicable=ZPeopleComponents.select(modal.find("#policyApplicability")).getValue();if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.USER_SPECIFIC.key){let userList=TimelyZComp.tokenField.getValues(modal.find("#userSelect"));userList.includes("0")&&(userList=[]),params.otPolicyInputData.appArr={userAppArr:userList}}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.LOCATION_SPECIFIC.key){let locationList=TimelyZComp.tokenField.getValues(modal.find("#locationSelect"));locationList.includes("0")&&(locationList=[]),params.otPolicyInputData.appArr={locationAppArr:locationList}}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.EMP_TYPE_SPECIFIC.key){let empTypeList=TimelyZComp.tokenField.getValues(modal.find("#empTypeSelect"));empTypeList.includes("0")&&(empTypeList=[]),params.otPolicyInputData.appArr={empTypeAppArr:empTypeList}}else if(policyApplicable==Timetracker.overTimePolicy.overTimePolicyApp.DEPT_SPECIFIC.key){let departmentList=TimelyZComp.tokenField.getValues(modal.find("#departmentSelect"));departmentList.includes("0")&&(departmentList=[]),params.otPolicyInputData.appArr={departmentAppArr:departmentList}}params.otPolicyInputData=JSON.stringify(params.otPolicyInputData);let url=Timetracker.overTimePolicy.template.getUrl()+"/"+config.otpolicy_state_code+"/clone";const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(url,params,void 0,"POST");let data=0!==response.status?response.data:response.errors;0!==response.status?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.rebrandaddsuccess")),Timetracker.overTimePolicy.destroyZComp(),ModuleComp.Modal.hide("ttAddOTPolicySettings")):data.hasOwnProperty("message")&&Timetracker.util.showAlert(0,data.message)},constructMapTemplatePopUp:function(config){Timetracker.overTimePolicy.template.constructAddEditMapTemplatePopUp(config),ZPeopleComponents.select(pageContainer.find("#policyApplicability")).setValue("2")},constructAddEditMapTemplatePopUp:function(config){Timetracker.overTimePolicy.template.constructMapTemplatePopUp(config)},constructMapTemplatePopUp:function(config,json){let otpolicy_config=config.otpolicy_config||{},dailyOverTimePolicy=otpolicy_config.dailyOverTimePolicy||{},weeklyOverTimePolicy=otpolicy_config.weeklyOverTimePolicy||{},weekendOverTimePolicy=otpolicy_config.weekendOverTimePolicy||{},holidayOverTimePolicy=otpolicy_config.holidayOverTimePolicy||{},consecutiveOverTimePolicy=otpolicy_config.consecutiveOverTimePolicy||{};json=json||{};var html='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">Overtime policy name</label></div><div><input type="text" class="ztextbox" placeholder="Enter policy name" id="ts_overtimepolicy_name"></div></div><div class="zpl_secn" id="appToSec"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.applicableto",[""])+'</label></div><div class="zpl_cndor wd100_per"><div class="zpl_gbox" id="groupGBox"><div class="zpl_idiv"><select class="select-js" style="display: none;" id="policyApplicability"></select><span>'+ZPI18N.getString("zp.lookup.is")+'</span><textarea elemType="tokenfield" id="userSelect"></textarea><textarea elemType="tokenfield" id="empTypeSelect"></textarea><textarea elemType="tokenfield"id="locationSelect" ></textarea><textarea elemType="tokenfield" id="departmentSelect"></textarea></div></div></div></div></div></div>';html+='<div class="zpl_crd"><div class="zpl_crdcnt">',html+='<div class="zpl_secn">',html+="<div><h4>Pay Rule Details</h4></div>",html+='<div><table class="zpl_tbl zpl_w-100">',html+="<thead><tr><th></th><th>Threshold limits</th><th>Pay rate</th></tr></thead>",html+="<tbody>","1"===dailyOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td><b>Daily Overtime :</b><p>Hours greater than "+dailyOverTimePolicy.overTimePolicy.otCon.hrsExcd+(dailyOverTimePolicy.overTimePolicy.dOtCon&&void 0!==dailyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd?" (upto "+dailyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" hours)":"")+" that are worked in a single workday</p></td><td><span>"+dailyOverTimePolicy.overTimePolicy.otCon.hrsExcd+" hours/day</span></td><td><span>"+dailyOverTimePolicy.overTimePolicy.otCon.payRate+" x Regular Rate Per Hour</span></td></tr>",dailyOverTimePolicy.overTimePolicy.dOtCon&&void 0!==dailyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td><b>Daily Extended Overtime :</b><p>Hours greater than "+dailyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" that are worked in a single workday</p></td><td><span>"+dailyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" hours/day</span></td><td><span>"+dailyOverTimePolicy.overTimePolicy.dOtCon.payRate+" x Regular Rate Per Hour</span></td></tr>")),"1"===weeklyOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td><b>Weekly Overtime :</b><p>Hours greater than "+weeklyOverTimePolicy.overTimePolicy.otCon.hrsExcd+" that are worked in a single work week</p></td><td><span>40 hours/week</span></td><td><span>"+weeklyOverTimePolicy.overTimePolicy.otCon.payRate+" x Regular Rate Per Hour</span></td></tr>",weeklyOverTimePolicy.overTimePolicy.dOtCon&&void 0!==weeklyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td><b>Weekly Extended Overtime :</b><p>Hours greater than "+weeklyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" that are worked in a single work week</p></td><td><span>"+weeklyOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" hours/day</span></td><td><span>"+weeklyOverTimePolicy.overTimePolicy.dOtCon.payRate+" x Regular Rate Per Hour</span></td></tr>")),"1"===weekendOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td><b>Weekend Overtime :</b><p>Hours greater than "+weekendOverTimePolicy.overTimePolicy.otCon.hrsExcd+(weekendOverTimePolicy.overTimePolicy.dOtCon&&void 0!==weekendOverTimePolicy.overTimePolicy.dOtCon.hrsExcd?" (upto "+weekendOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" hours)":"")+" that are worked in a single Weekend</p></td><td><span>"+weekendOverTimePolicy.overTimePolicy.otCon.hrsExcd+" hours/day</span></td><td><span>"+weekendOverTimePolicy.overTimePolicy.otCon.payRate+" x Regular Rate Per Hour</span></td></tr>",void 0!==weekendOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td><b>Weekend Extended Overtime :</b><p>Hours greater than "+weekendOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" that are worked in a single workday</p></td><td><span>"+weekendOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" hours/day</span></td><td><span>"+weekendOverTimePolicy.overTimePolicy.dOtCon.payRate+" x Regular Rate Per Hour</span></td></tr>")),"1"===holidayOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td><b>Holiday Overtime :</b><p>Hours greater than "+holidayOverTimePolicy.overTimePolicy.otCon.hrsExcd+(holidayOverTimePolicy.overTimePolicy.dOtCon&&void 0!==holidayOverTimePolicy.overTimePolicy.dOtCon.hrsExcd?" (upto "+holidayOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" hours)":"")+" that are worked in a single Holiday</p></td><td><span>"+holidayOverTimePolicy.overTimePolicy.otCon.hrsExcd+" hours/day</span></td><td><span>"+holidayOverTimePolicy.overTimePolicy.otCon.payRate+" x Regular Rate Per Hour</span></td></tr>",holidayOverTimePolicy.overTimePolicy.dOtCon&&void 0!==holidayOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td><b>Holiday Extended Overtime :</b><p>Hours greater than "+holidayOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" that are worked in a single workday</p></td><td><span>"+holidayOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" hours/day</span></td><td><span>"+holidayOverTimePolicy.overTimePolicy.dOtCon.payRate+" x Regular Rate Per Hour</span></td></tr>")),"1"===consecutiveOverTimePolicy.enableOverTimePolicy&&(html+="<tr><td><b>7th consecutive day Overtime :</b><p>Hours greater than "+consecutiveOverTimePolicy.overTimePolicy.otCon.hrsExcd+(consecutiveOverTimePolicy.overTimePolicy.dOtCon&&void 0!==consecutiveOverTimePolicy.overTimePolicy.dOtCon.hrsExcd?" (upto "+consecutiveOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" hours)":"")+" that are worked in a single workday</p></td><td><span>"+consecutiveOverTimePolicy.overTimePolicy.otCon.hrsExcd+" hours/day</span></td><td><span>"+consecutiveOverTimePolicy.overTimePolicy.otCon.payRate+" x Regular Rate Per Hour</span></td></tr>",consecutiveOverTimePolicy.overTimePolicy.dOtCon&&void 0!==consecutiveOverTimePolicy.overTimePolicy.dOtCon.hrsExcd&&(html+="<tr><td><b>7th consecutive day Extended Overtime :</b><p>Hours greater than "+consecutiveOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" that are worked in a single workday</p></td><td><span>"+consecutiveOverTimePolicy.overTimePolicy.dOtCon.hrsExcd+" hours/day</span></td><td><span>"+consecutiveOverTimePolicy.overTimePolicy.dOtCon.payRate+" x Regular Rate Per Hour</span></td></tr>")),html+="<tbody>",html+="</tbody>",html+="</div></table>",html+="</div></div></div>";var modal=ModuleComp.Modal.setup({id:"ttAddOTPolicySettings",type:4,header:json.mode===Timetracker.constants.EDIT?ZPI18N.getString("zp.editspecpolicy"):ZPI18N.getString("zp.addspecpolicy"),body:html,backdrop:!1,deleteOnHide:!0,hiddenCallback:Timetracker.overTimePolicy.destroyZComp,buttonValue:ZPI18N.getString("zp.save"),closeonEsc:!0,LayerId:settingsPage.container[0].id});modal.find(".zpl_mcnt").attr("id","moduleCards"),modal.addClass("zpl_mmd"),TimelyZComp.toolTip.customMsgIntz(modal,[{class:"PI_cls",title:ZPI18N.getString("zp.close")}]),Timetracker.overTimePolicy.intializeZcomp(),modal.find("#ts_overtimepolicy_name").val(config.otpolicy_name);let extraDtls={dropdownList:{className:"zpl_ddoptnrml",fitForElement:!0,closeOnScroll:!0,closeOnSelect:!1,hideItemOnSelect:!0}};if(TimelyZComp.tokenField.intialize(modal.find("#locationSelect"),extraDtls,!0),TimelyZComp.tokenField.intialize(modal.find("#empTypeSelect"),extraDtls,!0),TimelyZComp.tokenField.intialize(modal.find("#departmentSelect"),extraDtls,!0),Timetracker.Search.populateZCompUsers("userSelect",null,{submode:"TIMETRACKER_SETTINGS",defaultOptionNeeded:!0,extraParams:{projectManagerPerm:!0},placeHolder:ZPI18N.getString("zp.select"),useDefaultValuesCache:!0},!0,modal),ZPeopleComponents.select(modal.find("#policyApplicability"),{change:function(){Timetracker.overTimePolicy.toggleApplicabilitySel(json,config)},width:"200px",dropdownList:{fitForElement:!0,className:"zpl_ddoptnrml",closeOnScroll:!0}}),ZPeopleComponents.select(modal.find("#policyApplicability")).addOption([{value:Timetracker.overTimePolicy.overTimePolicyApp.USER_SPECIFIC.key,label:ZPI18N.getString("zp.user")},{value:Timetracker.overTimePolicy.overTimePolicyApp.EMP_TYPE_SPECIFIC.key,label:ZPI18N.getString("zp.employeeType")},{value:Timetracker.overTimePolicy.overTimePolicyApp.LOCATION_SPECIFIC.key,label:ZPI18N.getString("zp.location")},{value:Timetracker.overTimePolicy.overTimePolicyApp.DEPT_SPECIFIC.key,label:ZPI18N.getString("zp.department")}]),json.mode===Timetracker.constants.EDIT){ZPeopleComponents.select(pageContainer.find("#policyApplicability")).setValue(config.otpolicy_app_type);let keyname=Timetracker.overTimePolicy.getAppKeyByKey(config.otpolicy_app_type),appArr=[],appArrList=config.appArr[keyname],arrList=Timetracker.overTimePolicy.appList[keyname];if(0!=appArrList.length)for(var key in appArrList){var val=arrList[appArrList[key].ID];appArr.push({value:val.recID+"",text:val.recName,label:val.recName})}else appArr.push({value:"0",text:"ALL",label:"ALL"});config.otpolicy_app_type==Timetracker.overTimePolicy.overTimePolicyApp.LOCATION_SPECIFIC.key?TimelyZComp.tokenField.addValues(pageContainer.find("#locationSelect"),appArr):config.otpolicy_app_type==Timetracker.overTimePolicy.overTimePolicyApp.EMP_TYPE_SPECIFIC.key?TimelyZComp.tokenField.addValues(pageContainer.find("#empTypeSelect"),appArr):config.otpolicy_app_type==Timetracker.overTimePolicy.overTimePolicyApp.DEPT_SPECIFIC.key&&TimelyZComp.tokenField.addValues(pageContainer.find("#departmentSelect"),appArr)}},toggleBreakStatus:async function(event){if(event.detail.fromUI){let divId=event.detail.element.closest(".zpl_msplst");0===divId.length&&(divId=event.detail.element.closest("tr"));let policyId=divId[0].id,params={mode:"toggleStatus"},url=Timetracker.overTimePolicy.template.getUrl()+"/"+policyId;const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(url,params,void 0,"PATCH");let data=0!==response.status?response.data:response.errors;if(0===response.status)return void(data.hasOwnProperty("message")&&Timetracker.util.showAlert(0,data.message));data.dataObj.state?(ZPeopleComponents.toggleswitch(settingsPage.container.find("#toggle_"+policyId)).switchOn(),successMsg=ZPI18N.getString("zp.polenabled")):(ZPeopleComponents.toggleswitch(settingsPage.container.find("#toggle_"+policyId)).switchOff(),successMsg=ZPI18N.getString("zp.poldisabled")),ModuleComp.Msg.showSuccessMsg(successMsg)}},getUrl:function(){return"/timetracker/settings/ottemplate"}}},Timetracker.userSpecificSettings={APPLICABLE_FOR_KEYS:["loc"],init:function(){if(Timetracker.genSettings.init(),Timetracker.genSettings.permissionCheck()){let html=Timetracker.genSettings.getHeaderBandHtml({header:ZPI18N.getString("zp.tt.specificpolicy"),description:ZPI18N.getString("zp.tt.specificpolicies.topbandtext"),headerExtraClass:"zpl_topcrdhdr"});html+='<div class="zpl_rgtcnt">',html+='<div class="zpl_btnmnu" id="topSettMenu"><div class="zpl_rgt"><button type="addbutton" id="addSpecficPolicy" class="zlabel zlabel--blue zlabel--medium" data-popup-open="addpolicy" onclick="Timetracker.userSpecificSettings.loadAddUserSpcSettings()">'+ZPI18N.getString("zp.addspecpolicy")+'</button></div></div><div class="zpl_tblres" id="usersettings_list" scroll="enabled"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.tt.specificpolicies.specificpolicyname")+'</th><th width="100"></th></tr></thead><tbody id="ts-usertbody"></tbody></table></div><div id="zp_empty_data"/>',settingsPage.container.html(html),Timetracker.userSpecificSettings.getUserSpcSettings()}},getUserSpcSettings:function(){settingsPage.container.find("#zp_empty_data,#usersettings_list").hide(),TimelySettings.showHideLoadingPage(!0),Timetracker.userTSSettings.applicable_for_list=Timetracker.userTSSettings.location_app_for_list=[],Timetracker.FireScroll.resetDataOnLoad(Timetracker.userSpecificSettings.Firescroll.mode),ZPeople.Request.send(Timetracker.constants.URL,Timetracker.userSpecificSettings.getParamsForUserSpcSettings(),Timetracker.userSpecificSettings.constructUserSpcSettingsList,{},Timetracker.Util.generalFailureCallback),AppExc.getApplicableIds()},constructUserSpcSettingsList:function(result,params){const pageContainer=settingsPage.container;var isEmpty=void 0===result||null===result||0===Object.keys(result).length;if(!isEmpty){isEmpty=void 0===result.configInfo||0===result.configInfo.length;let error_code=result.errorCode;if(error_code){let error_msg=Timetracker.Util.getFailureMessageByCode(error_code);Timetracker.util.showAlert(0,error_msg)}}if(Timetracker.genSettings.addTablFxdCls(),isEmpty)Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.tt.specificpolicies.nodatamessage"),buttonName:ZPI18N.getString("zp.addspecpolicy"),buttonCallBack:Timetracker.userSpecificSettings.loadAddUserSpcSettings,desc:ZPI18N.getString("zp.tt.specificpolicies.topbandtext")}),pageContainer.find("#addSpecficPolicy").closest(".zpl_btnmnu").addClass("zpl_DNI"),pageContainer.find("#zp_empty_data").fadeIn(200);else{pageContainer.find("#addSpecficPolicy").closest(".zpl_btnmnu").removeClass("zpl_DNI"),Timetracker.Util.showHideNoData({remove:!0});let txt=Timetracker.userSpecificSettings.constructUserSpcSettingsRows(result.configInfo);pageContainer.find("#ts-usertbody").html($(txt).children()),Timetracker.FireScroll.initFireScroll(Timetracker.userSpecificSettings.Firescroll.mode,Timetracker.constants.URL,params,Timetracker.userSpecificSettings.Firescroll.loadMoreData,"",{params:params,isFromFireScroll:!0}),Timetracker.FireScroll.setFetchCount(Timetracker.userSpecificSettings.Firescroll.mode,result.configInfo),pageContainer.find("#usersettings_list").fadeIn(200),TimelyZComp.toolTip.intiliaze()}TimelySettings.showHideLoadingPage()},getParamsForUserSpcSettings:function(){var params={mode:"getUserTimesheetSettingsList",sIndex:0};return params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,params},resetTSSettings:function(settingsId){settingsId?delete Timetracker.userTSSettings.settingDetails[settingsId]:Timetracker.userTSSettings.settingDetails={}},constructUserSpcSettingsRows:function(configArr){return txt=$("<div/>"),$.each(configArr,function(index,configObj){$(txt).append(Timetracker.userSpecificSettings.constructRow(configObj))}),txt},constructRow:function(configObj){var txt='<tr id="'+configObj.settingsId+'"><td onclick="Timetracker.userSpecificSettings.loadEditUserSpcSettings($(this).closest(\'tr\'));"><span>'+configObj.settingsName+'</span></td><td><div class="zpl_hvr"><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+" onclick=\"Timetracker.Util.confirmpopUp('"+configObj.settingsId+"',Timetracker.userSpecificSettings.deleteUserSpcSettings,'"+configObj.settingsId+"',0,{header :'"+ZPI18N.getString("zp.tt.specificpolicies.deletespecificpolicy")+"'});\"></i></div></td></tr>";txt=$(txt).data("configInfo",configObj);var current_app_for_list=configObj.applicableForIds?configObj.applicableForIds.split(";"):[];Timetracker.userTSSettings.applicable_for_list=ZPUtil.removeDuplicatesFromArray(Timetracker.userTSSettings.applicable_for_list.concat(current_app_for_list));var current_loc_app_for_list=configObj.locAppForIds?configObj.locAppForIds.split(";"):[];return Timetracker.userTSSettings.location_app_for_list=ZPUtil.removeDuplicatesFromArray(Timetracker.userTSSettings.location_app_for_list.concat(current_loc_app_for_list)),Timetracker.userTSSettings.settingDetails[configObj.settingsId]=configObj,txt},constructUserSpcSettPopUp:function(json){var html='<div class="zpl_crd" id="tus_restPerm_div"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.tt.specificpolicies.specificpolicyname")+'</label></div><div><input type="text" class="ztextbox" placeholder="'+ZPI18N.getString("zp.tt.specificpolicies.enterpolicyname")+'"  id="ts_usersettings_name"></div></div>';html+=AppExc.returnApplicableHtml("appToSec"),html+='</div></div></div><h4 class="zpl_hdrbwcrd">'+ZPI18N.getString("zp.local.TimeLog")+'</h4><div class="zpl_crd" cardId="tus_timelogTypeCard"><div class="zpl_crdhdr" ><div><h4>'+ZPI18N.getString("zp.tt.timelogsettings.basictimelogsettings")+"</h4><p>"+ZPI18N.getString("zp.tt.timelogsettings.basictimelogsettingsdesc")+'</p></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h4>'+ZPI18N.getString("zp.tt.timelogsettings.timecanbeloggedby",[""])+'</h4></div><div id="tus_logtype"><div class="zcheckbox"><input id="tus_timestamp_manual" type="checkbox" name="timelogType"  class="zcheckbox__helper" checked=""><label for="tus_timestamp_manual" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.totalhours")+'</label></div><div class="zcheckbox"><input id="tus_timestamp_fromtolog" type="checkbox" name="timelogType"  class="zcheckbox__helper"><label for="tus_timestamp_fromtolog" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.startandendtime")+'</label></div><div class="zcheckbox"><input id="tus_timestamp_automatic" type="checkbox" name="timelogType"  class="zcheckbox__helper"><label for="tus_timestamp_automatic" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.Timer")+'</label></div></div></div><div class="zpl_secn"><div class="zpl_info"><ul><li>'+ZPI18N.getString("zp.tt.timelogsettings.link1",["#settings/service/timetracker/reminders"])+"</li><li>"+ZPI18N.getString("zp.tt.timelogsettings.link2",["#settings/service/timetracker/iprestriction","#settings/service/timetracker/georestriction"])+'</li></ul></div></div></div></div><div class="zpl_crd" id="tus_restPerm_div"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.leavetype.v2.restrictions")+"</h4><p>"+ZPI18N.getString("zp.tt.timelogsettings.restlabel")+'</p></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.restrictheader",[""])+'</h5></div><div><div class="zcheckbox"><input id="tus_futurelog" type="checkbox"  class="zcheckbox__helper" checked=""><label for="tus_futurelog" class="zcheckbox__label">'+ZPI18N.getString("zp.restrictFutureLog")+'</label></div><div class="zcheckbox"><input id="tus_pastlog" type="checkbox"  class="zcheckbox__helper" checked=""><label for="tus_pastlog" class="zcheckbox__label">'+ZPI18N.getString("zp.restrictPastLog")+'</label></div><div class="zpl_gbox"  id="tus_pastlogdaysdiv"><div class="zpl_idiv"><div class="zradiobutton zradiobutton--horizontal w100"><input id="tus_pastlog_alldays" type="radio" name="pastlogdays" class="zradiobutton__helper" checked="" value="0"><label for="tus_pastlog_alldays"class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.alldays")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input type="radio" id="tus_pastlog_pastdays" name="pastlogdays" class="zradiobutton__helper" value="1"><label for="tus_pastlog_pastdays"  class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.before")+'</span> </label></div><input type="text" class="ztextbox w60 is-disabled" value="2" id="tus_pastlog_pastdaysvalue" placeholder="e.g. 2" disabled> <em>'+ZPI18N.getString("zp.leavetype.smalldays")+'</em></div></div><div class="zcheckbox"><input id="tus_include_weekend" type="checkbox"   class="zcheckbox__helper"><label for="tus_include_weekend" class="zcheckbox__label"> '+ZPI18N.getString("zp.weekend(s)")+'</label></div><div class="zcheckbox"><input id="tus_include_holiday" type="checkbox"   class="zcheckbox__helper"><label for="tus_include_holiday" class="zcheckbox__label">'+holiday_disName+'</label></div><div class="zcheckbox"><input id="tus_include_unpaid" type="checkbox"   class="zcheckbox__helper"><label for="tus_include_unpaid" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.unpaidleave")+'</label></div><div class="zcheckbox"><input id="tus_include_paid" type="checkbox"  class="zcheckbox__helper"><label for="tus_include_paid" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.paidleave")+" / "+ZPI18N.getString("zp.tt.compensatoryoff")+'</label></div></div></div><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.tt.timeentryoverlapis",[""])+'</h5> </div><div class="zpl_idiv zradiobutton" id="timeentryoverlap"><div class="zradiobutton zradiobutton--horizontal"><input id="tus_timeentryoverlap_allow" type="radio" value="0" name="timeentryoverlap" class="zradiobutton__helper"><label for="tus_timeentryoverlap_allow" class="zradiobutton__label"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.allow")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tus_timeentryoverlap_restrict" type="radio" value="2" name="timeentryoverlap" class="zradiobutton__helper"><label for="tus_timeentryoverlap_restrict" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.restricted")+'</span></label></div></div><div id="tus_timeentryoverlap_warndiv" class="zpl_gbox"><div class="zcheckbox zcheckbox--horizontal"><input id="tus_timeentryoverlap_warn" type="checkbox" name="check"  class="zcheckbox__helper" checked=""><label for="tus_timeentryoverlap_warn" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.allowedwarningmsg")+'</label></div></div></div><div id="tus_maxloghrs" class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tus_maxloghrs_none" type="checkbox" name="restrictmaxloghours" value="0" class="zcheckbox__helper"><label for="tus_maxloghrs_none" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.restrictmaxloghrs",["#settings/service/timetracker/overtimepolicy"])+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timesheetsettings.restrictmaxloghrsdesc")+'</span></div><div class="zpl_tbox" id="tus_maxBillableLogHoursDiv"></div></div><div class="zpl_secn"><div><div class="chkdectxt"><div class="zcheckbox"><input id="tus_estimated_hours" type="checkbox" name="estimatedHoursRestriction" class="zcheckbox__helper"><label for="tus_estimated_hours" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogesthours")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogesthoursdesc")+'</span></div></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tus_att_timelog" type="checkbox"   class="zcheckbox__helper"><label for="tus_att_timelog" class="zcheckbox__label">'+ZPI18N.getString("zp.attHourslimittimelog")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogattdesc")+"</span></div></div>",Timetracker.generalSettings.isTimerAttCheckInConfigured()&&(html+='<div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tus_att_timer_checkin" type="checkbox" class="zcheckbox__helper" onclick="Timetracker.timeLogSettings.disableTimeLogsinAttHrs(this,true);" ><label for="tus_att_timer_checkin" class="zcheckbox__label">'+ZPI18N.getString("zp.attcheckinlimittimer")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogattdesc")+"</span></div></div>"),html+='<div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tus_zeroHours_timelog" type="checkbox"  checked="" class="zcheckbox__helper"><label for="tus_zeroHours_timelog" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.restricttimelogsnoduration")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.restricttimelogzerodesc")+'</span></div></div><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.restricttljobdates",[""])+'</h5></div><div><div class="zcheckbox"><input id="tus_timelogdate" type="checkbox" class="zcheckbox__helper" checked=""><label for="tus_timelogdate" class="zcheckbox__label small_case singluar_name" id="span_tusdate"></label></div><div class="zcheckbox"><input id="tus_presentdate" type="checkbox"  class="zcheckbox__helper"><label for="tus_presentdate" class="zcheckbox__label small_case singluar_name" id="span_tuspresentdate"></label></div><div class="zpl_info" id="tus_restrictjobdesc"></div></div></div></div></div><div class="zpl_crd" cardId="tus_PermissionsCard"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.permissions")+"</h4><p>"+ZPI18N.getString("zp.tt.timelogsettings.timelogpermissionsdesc")+'</p></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.tt.timelogsettings.timereditedby",[""])+'</h5></div><div name="hierarchyChk"><div class="zcheckbox zcheckbox--horizontal"><input id="tus_timereditmanager" type="checkbox" name="timeredit"  class="zcheckbox__helper" checked=""><label for="tus_timereditmanager" class="zcheckbox__label">'+ZPI18N.getString("zp.srepman")+'</label></div><div class="zcheckbox zcheckbox--horizontal"><input id="tus_timereditself" type="checkbox" name="timeredit"  class="zcheckbox__helper" checked=""><label for="tus_timereditself" class="zcheckbox__label">'+ZPI18N.getString("zp.local.employeesself")+'</label></div></div></div></div></div></div><div class="zpl_crd" cardId="tus_PreferencesCard"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.gtpreferences")+"</h4><p>"+ZPI18N.getString("zp.tt.timelogsettings.preferencesdesc")+'</p></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.defaulttimelogbillingstatus")+"</h5><p>"+ZPI18N.getString("zp.tt.timelogsettings.billingstatusdesc")+'</p></div><div id="tus_billingStatus_div"><div class="zradiobutton zradiobutton--horizontal"><input id="tus_billingstatus" type="radio" name="billingStatusType" class="zradiobutton__helper" value="0"><label class="zradiobutton__label" for="tus_billingstatus"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.billable")+' </span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tus_nonbillingstatus" type="radio" name="billingStatusType" class="zradiobutton__helper" value="1"><label class="zradiobutton__label" for="tus_nonbillingstatus"><span class="zradiobutton__text">'+ZPI18N.getString("zp.nonbillable")+'</span></label></div></div></div><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.tt.timelogsettings.timelogview")+"</h5><p>"+ZPI18N.getString("zp.tt.timelogsettings.timelogviewdesc")+'</p></div><div id="timelogviewtype"><div class="zradiobutton zradiobutton--horizontal"><input id="tus_dailyview" type="radio" name="timelogviewtype" value="0" class="zradiobutton__helper" checked=""><label class="zradiobutton__label" for="tus_dailyview"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.tt.timelogsettings.dayview")+' </span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tus_weeklyview" type="radio" name="timelogviewtype" value="1" class="zradiobutton__helper"><label class="zradiobutton__label" for="tus_weeklyview" ><span class="zradiobutton__text">'+ZPI18N.getString("zp.tt.timelogsettings.weekview")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tus_monthlyview" type="radio" name="timelogviewtype" value="2" class="zradiobutton__helper"><label class="zradiobutton__label" for="tus_monthlyview" ><span class="zradiobutton__text">'+ZPI18N.getString("zp.tt.timelogsettings.monthview")+'</span></label></div></div></div><div class="zpl_secn"><div><div class="chkdectxt"><div class="zcheckbox"><input id="tus_showtimeloglocation" type="checkbox"  checked="" class="zcheckbox__helper"><label for="tus_showtimeloglocation" class="zcheckbox__label"> '+ZPI18N.getString("zp.tt.timelogsettings.tracktimeloglocation")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timelogsettings.timeloglocationdesc")+'</span></div></div></div></div></div></div><h4 class="zpl_hdrbwcrd">'+ZPI18N.getString("zp.timesheet")+'</h4><div class="zpl_crd" id="tus_restPerm_div"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.leavetype.v2.restrictions")+"</h4><p>"+ZPI18N.getString("zp.tt.timesheetsettings.restrictionsdesc")+'</p></div></div><div class="zpl_crdcnt" ><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tus_restricttsPeriod" type="checkbox" checked="" value="-1" class="zcheckbox__helper"><label for="tus_restricttsPeriod" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.restricttimesheet",[""])+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timesheetsettings.restricttimesheetdesc")+'</span></div><div class="zpl_tbox" id="tus_tsPeriodRestrictDiv"><div class="zpl_idiv" id="tus_tsPeriod"><div class="zradiobutton zradiobutton--horizontal"><input id="tus_tsPeriod_day" type="radio" name="tsPeriod"  value="0" class="zradiobutton__helper"><label class="zradiobutton__label" for="tus_tsPeriod_day"><span class="zradiobutton__text">'+ZPI18N.getString("zp.cday")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tus_tsPeriod_week" type="radio" name="tsPeriod" value="1" class="zradiobutton__helper"><label class="zradiobutton__label" for="tus_tsPeriod_week"><span class="zradiobutton__text">'+ZPI18N.getString("zp.week")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tus_tsPeriod_month" type="radio" name="tsPeriod" value="2" class="zradiobutton__helper"><label class="zradiobutton__label" for="tus_tsPeriod_month"><span class="zradiobutton__text">'+ZPI18N.getString("zp.month")+'</span></label></div></div><div id="tus_tssubmission_div"><div class="zcheckbox " id="tus_tsRestrict"><input id="tus_restricttimesheetsubmission" type="checkbox" class="zcheckbox__helper"><label for="tus_restricttimesheetsubmission" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.restrictsubmission")+'</label></div><div class="zpl_gbox" id="tus_tsSpan"><table class="zpl_itbl zpl_erorbx"><tbody><tr><td><span>'+ZPI18N.getString("zp.from")+'</span></td><td width="150px"><div><select id="tus_from_day" elemType="select"></select></div></td><td class="showhide_tsrange"><span>'+ZPI18N.getString("zp.of")+'</span></td><td class="showhide_tsrange"><div><select id="tus_from_range" elemType="select"></select></div></td></tr><tr><td><span>'+ZPI18N.getString("zp.to")+'</span></td><td width="150px"><div><select id="tus_to_day" elemType="select"></select></div></td><td class="showhide_tsrange"><span>'+ZPI18N.getString("zp.of")+'</span></td><td class="showhide_tsrange"><div><select id="tus_to_range" elemType="select"></select></div></td></tr><tr><td colspan="4" id="tus_tsSpan_errmsg"></td></tr></tbody></table></div></div></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tus_timesheetOverLap" type="checkbox" checked="" class="zcheckbox__helper"><label for="tus_timesheetOverLap" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.timesheetoverlappingdts")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.timesheetsettings.timesheetoverlappingdtsdesc")+'</span></div></div><div class="zpl_secn"><div><div class="zcheckbox" id="tus_min_hrs_div"><input id="tus_min_hrs" type="checkbox" name="restrictmin" checked="" class="zcheckbox__helper"><label for="tus_min_hrs" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.minhrssettingname")+'</label><i class="PI_info tooltip-js" title="'+ZPI18N.getString("zp.minhrsettingsinfo")+'" data-title-position="right"></i></div><div class="zpl_gbox" id="tus_min_hrs_value_box"><table class="zpl_itbl zpl_erorbx"><tbody><tr><td><div class="zcheckbox"><input id= "tus_minhrsperday_chkbox" type="checkbox" name="min_hours"   class="zcheckbox__helper"><label for="tus_minhrsperday_chkbox" class="zcheckbox__label">'+ZPI18N.getString("zp.perday")+'</label></div></td><td><input id="tus_min_per_day" type="text" class="ztextbox w100" value="00:00" onkeyup="Timetracker.timesheetSettings.validateCriHrs(this)" ><em>'+ZPI18N.getString("zp.gracehour")+'</em><i class="C-info1"></i></td></tr><tr><td><div class="zcheckbox "><input id="tus_minhrsperweek_chkbox" type="checkbox" name="min_hours"   class="zcheckbox__helper"><label for="tus_minhrsperweek_chkbox" class="zcheckbox__label">'+ZPI18N.getString("zp.perweek")+'</label></div></td><td><input id="tus_min_per_week" type="text" class="ztextbox w100" value="00:00" onkeyup="Timetracker.timesheetSettings.validateCriHrs(this)"><em>'+ZPI18N.getString("zp.gracehour")+'</em><i class="C-info1"></i></td></tr><tr><td id="min_err" colspan="4"></td></tr></tbody></table></div><div class="zcheckbox" id="tus_max_hrs_div"><input id="tus_max_hrs" type="checkbox" name="restrictmax"  class="zcheckbox__helper"><label for="tus_max_hrs" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.timesheetsettings.maxhrssettingname")+'</label><i class="PI_info tooltip-js" title="'+ZPI18N.getString("zp.minhrsettingsinfo")+'" data-title-position="right"></i></div><div class="zpl_gbox" id="tus_max_hrs_value_box"><table class="zpl_itbl zpl_erorbx"><tbody><tr><td><div class="zcheckbox"><input id="tus_maxhrsperday_chkbox" type="checkbox" name="max_hrs"   class="zcheckbox__helper"><label for="tus_maxhrsperday_chkbox" class="zcheckbox__label">'+ZPI18N.getString("zp.perday")+'</label></div></td><td><input id="tus_max_per_day" type="text" class="ztextbox w100" value="00:00" onkeyup="Timetracker.timesheetSettings.validateCriHrs(this)"><em>'+ZPI18N.getString("zp.gracehour")+'</em><i class="C-info1"></i></td></tr><tr><td><div class="zcheckbox"><input id="tus_maxhrsperweek_chkbox" type="checkbox" name="max_hrs"   class="zcheckbox__helper"><label for="tus_maxhrsperweek_chkbox" class="zcheckbox__label">'+ZPI18N.getString("zp.perweek")+'</label></div></td><td><input id="tus_max_per_week" type="text" class="ztextbox w100" value="00:00" onkeyup="Timetracker.timesheetSettings.validateCriHrs(this)"><em>'+ZPI18N.getString("zp.gracehour")+'</em><i class="C-info1"></i></td></tr><tr><td id="max_err" colspan="4"></td></tr></tbody></table></div></div></div></div></div><div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.tt.othersettings.paypreferences")+"</h4><p>"+ZPI18N.getString("zp.tt.othersettings.paypreferencesDef")+'</p></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="tus_isNBlogforPayable" type="checkbox" name="check" class="zcheckbox__helper"><label for="tus_isNBlogforPayable" class="zcheckbox__label">'+ZPI18N.getString("zp.tt.othersettings.allowndhoursints")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.tt.othersettings.allowndhoursintsdesc")+"</span></div></div></div></div></div>";var modal=ModuleComp.Modal.setup({id:"ttAddUserSettings",type:1,header:json.mode===Timetracker.constants.EDIT?ZPI18N.getString("zp.editspecpolicy"):ZPI18N.getString("zp.addspecpolicy"),body:html,backdrop:!1,deleteOnHide:!0,buttonValue:ZPI18N.getString("zp.save"),hiddenCallback:TimelyZComp.destroy,closeonEsc:!0,LayerId:settingsPage.container[0].id});modal.find(".zpl_mcnt").attr("id","moduleCards"),modal.addClass("zpl_mmd"),TimelyZComp.toolTip.customMsgIntz(modal,[{class:"PI_cls",title:ZPI18N.getString("zp.close")}])},loadAddUserSpcSettings:function(){Timetracker.userSpecificSettings.constructUserSpcSettPopUp({mode:Timetracker.constants.ADD}),Timetracker.userSpecificSettings.constructaddEditUserSpcSettings(Timetracker.constants.ADD);var modal=settingsPage.container.find("#ttAddUserSettings");modal.find("input[name=setting_type]").val("0"),Timetracker.userSpecificSettings.appElementsIndex=[0],AppExc.setAppIndex(Timetracker.userSpecificSettings.appElementsIndex,!1),AppExc.addNewConditionRow(void 0,"appToSec"),modal.find("#ts_usersettings_name").val("").focus()},loadEditUserSpcSettings:function(thisObj){Timetracker.userSpecificSettings.constructUserSpcSettPopUp({mode:Timetracker.constants.EDIT});var config=$.extend(!0,{},$(thisObj).data("configInfo"));Timetracker.userSpecificSettings.constructaddEditUserSpcSettings(Timetracker.constants.EDIT,config);var modal=settingsPage.container.find("#ttAddUserSettings");modal.find("input[name=setting_type]").val(config.settingsType),Timetracker.userSpecificSettings.appElementsIndex=[0],AppExc.setAppIndex(Timetracker.userSpecificSettings.appElementsIndex,!1),Timetracker.userSpecificSettings.constructApplicability("user",Timetracker.Validations.isEmpty(config.applicableForIds)?[]:config.applicableForIds.split(";"),"1"),Timetracker.userSpecificSettings.constructApplicability("loc",Timetracker.Validations.isEmpty(config.locAppForIds)?[]:config.locAppForIds.split(";"),"0"),modal.find("#ts_usersettings_name").val(ZPeople.decodeTxt(config.settingsName)).focus()},constructaddEditUserSpcSettings:function(mode,config){var modal=settingsPage.container.find("#ttAddUserSettings");return modal.find("#zp_modal_blubtn").removeClass("disabled").off("click").on("click",function(){Timetracker.userSpecificSettings.addEditUserSpcSettings({mode:mode,config:config})}),modal.find("#tus_timestamp_automatic").off("change").on("change",function(){Timetracker.userSpecificSettings.checkSpecificSettingsBasedOnAttIntg(this,modal),Timetracker.timeLogSettings.disableTimeLogsinAttHrs(this)}),Timetracker.userSpecificSettings.resetDataOnaddEditUserSpcSettings(modal,config),Timetracker.genSettings.addCheckBxEventLsnr(modal),modal},resetDataOnaddEditUserSpcSettings:function(modal,config){void 0===config&&Timetracker.generalSettings.getSyncTimesheetSettings();var settingsData=config||Timetracker.generalSettings.settingDetails;modal.find("#tus_restricttsPeriod").off().on("change",function(){if($(this).is(":checked")){modal.find("#tus_tsPeriodRestrictDiv").removeClass("zpl_DNI");let value=Timetracker.generalSettings.getTSPeriod(void 0,void 0,settingsData);value=value!==Timetracker.constants.TS_PERIOD.ANY_DATE_RANGE?value:Timetracker.constants.TS_PERIOD.DAY,modal.find("[name=tsPeriod][value="+value+"]").prop("checked",!0).trigger("change")}else modal.find("#tus_tsPeriodRestrictDiv").addClass("zpl_DNI")}),modal.find("#tus_pastlog").off("click").on("click",function(){Timetracker.timeLogSettings.showHidePastDays("ttAddUserSettings",$(this).is(":checked"),settingsData)}),modal.find("#tus_timeentryoverlap_allow").off("change").on("change",function(){Timetracker.timeLogSettings.showHideTLOverlapWarning(this,settingsData),Timetracker.userSpecificSettings.checkSpecificSettingsBasedOnAttIntg(this,modal)}),modal.find("#tus_timeentryoverlap_restrict").off("change").on("change",function(){Timetracker.timeLogSettings.showHideTLOverlapWarning(this,settingsData)}),modal.find("input[name=tsPeriod]").off("change").on("change",function(){Timetracker.timesheetSettings.showHideRestrictTSSubmissionPeriod.onTimesheetPeriodChange(this,settingsData,modal)}),Timetracker.util.removeErrorMsg(void 0,modal),Timetracker.userSpecificSettings.setGeneralSettings(modal,settingsData),modal.find("input[name=restrictmaxloghours]").on("click",function(){let value=Timetracker.generalSettings.getMaxLogHoursRestrictType(null,null,settingsData);value="0"!==value?value:"1",Timetracker.timeLogSettings.getMaxLogHours("ttAddUserSettings",$(this).is(":checked")?value:"0",settingsData)}),modal.find("input[name=restrictmin]").off("click").on("click",function(){Timetracker.timesheetSettings.showHideMinMaxHrsInput("ttAddUserSettings",$(this).prop("checked"),settingsData,"min",modal)}),modal.find("input[name=restrictmax]").off("click").on("click",function(){Timetracker.timesheetSettings.showHideMinMaxHrsInput("ttAddUserSettings",$(this).prop("checked"),settingsData,"max",modal)}),modal.find("#tus_RestrictBillingStatus").off().on("click",function(){if($(this).is(":checked")){pageContainer.find("#tus_billingStatus_div").removeClass("zpl_DNI");let value=Timetracker.generalSettings.getTSBillableSetting(void 0,void 0,settingsData);value="0"!==value?value:"2",modal.find("[name=billingtimesheetType][value="+value+"]").prop("checked",!0)}else modal.find("#tus_billingStatus_div").addClass("zpl_DNI")}),modal.find("#tus_timestamp_fromtolog, #tus_att_timelog, #tus_timeentryoverlap_warn").off("click").on("click",function(){Timetracker.userSpecificSettings.checkSpecificSettingsBasedOnAttIntg(this,modal)}),modal.find("#tus_minhrsperday_chkbox, #tus_minhrsperweek_chkbox, #tus_maxhrsperday_chkbox, #tus_maxhrsperweek_chkbox").off().on("click",function(){Timetracker.timesheetSettings.enableDisableMinMaxHrsInput(this,settingsData)})},setData:function(data,pageContainer){pageContainer=pageContainer||settingsPage.container,Timetracker.util.removeErrorMsg(void 0,pageContainer),pageContainer.find("#tus_timestamp_automatic").prop("checked","true"===data.TS_automaticLog),pageContainer.find("#tus_timestamp_fromtolog").prop("checked","true"===data.TS_fromToTimeLog),pageContainer.find("#tus_timestamp_manual").prop("checked","true"===data.TS_manualLog),pageContainer.find("#tus_billingStatus_div").find('input[name="billingStatusType"][value='+(void 0!==data.TS_defaultbillingType?data.TS_defaultbillingType:"1")+"]").prop("checked",!0),pageContainer.find("#timelogviewtype").find("input[value="+(void 0!==data.TS_DefaultView?data.TS_DefaultView:"0")+"]").prop("checked",!0),void 0!==data.TS_timesheetPeriod&&data.TS_timesheetPeriod===Timetracker.constants.TS_PERIOD.ANY_DATE_RANGE?pageContainer.find("#tus_restricttsPeriod").prop("checked",!1).trigger("change"):pageContainer.find("#tus_restricttsPeriod").prop("checked",!0).trigger("change"),pageContainer.find("#tus_estimated_hours").prop("checked","1"===data.TS_estimatedHoursRestriction),pageContainer.find("#tus_maxloghrs").find("input[value="+(void 0!==data.TS_maxLogHoursRestriction?data.TS_maxLogHoursRestriction:"0")+"]").prop("checked",!0),Timetracker.timeLogSettings.getMaxLogHours(pageContainer.attr("id"),data.TS_maxLogHoursRestriction,data,pageContainer),pageContainer.find("#tus_pastlog").prop("checked","1"===data.TS_pastLogRestriction),Timetracker.timeLogSettings.showHidePastDays(pageContainer.attr("id"),"1"===data.TS_pastLogRestriction,data);var dateNameJson=Timetracker.util.getStartAndEnddateDisplayName(!0),sdatename=dateNameJson.sdatename,edatename=dateNameJson.edatename;pageContainer.find("#span_tuspresentdate").html(ZPI18N.getString("zp.tlrestrictjoboptions",[ZPI18N.getString("zp.thepresentdate"),Timetracker.util.getJobDisplayName(void 0,!0),sdatename,edatename])),pageContainer.find("#span_tusdate").html(ZPI18N.getString("zp.tlrestrictjoboptions",[ZPI18N.getString("zp.tldate"),Timetracker.util.getJobDisplayName(void 0,!0),sdatename,edatename])),pageContainer.find("#tus_futurelog").prop("checked","1"===data.TS_futureLogRestriction),pageContainer.find("#tus_include_weekend").prop("checked","1"===data.TS_weekendLogRestriction),pageContainer.find("#tus_include_holiday").prop("checked","1"===data.TS_holidayLogRestriction),pageContainer.find("#tus_include_unpaid").prop("checked","1"===data.TS_unpaidLeaveTLRestriction),pageContainer.find("#tus_include_paid").prop("checked","1"===data.TS_paidLeaveTLRestriction),pageContainer.find("#tus_att_timelog").prop("checked","1"===data.TS_attendanceHrsLogRestrict),pageContainer.find("#tus_zeroHours_timelog").prop("checked","1"===data.TS_zeroHoursRestriction),pageContainer.find("#tus_timelogdate").prop("checked","1"===data.TS_timelogDateWithinJobPerid),pageContainer.find("#tus_presentdate").prop("checked","1"===data.TS_presentDateWithinJobPerid);var helpUrl=Timetracker.generalSettings.constructHelpUrl("timesheet-settings.html#ts1job");pageContainer.find("#tus_restrictjobdesc").html('<i class="PI_info"></i>'+ZPI18N.getString("zp.settingNoteJobPeriod",[sdatename,edatename,Timetracker.util.getJobDisplayName(),helpUrl])),"1"==data.TS_timeEntriesOverlap?(pageContainer.find("#tus_timeentryoverlap_warn").prop("checked",!0),pageContainer.find("#timeentryoverlap").find("input[value=0]").prop("checked",!0)):(pageContainer.find("#tus_timeentryoverlap_warn").prop("checked",!1),pageContainer.find("#timeentryoverlap").find("input[value="+(void 0!==data.TS_timeEntriesOverlap?data.TS_timeEntriesOverlap:"0")+"]").prop("checked",!0)),"1"==data.TS_timeEntriesOverlap||"0"==data.TS_timeEntriesOverlap?pageContainer.find("#tus_timeentryoverlap_warndiv").show():pageContainer.find("#tus_timeentryoverlap_warndiv").hide(),Timetracker.generalSettings.isTimerAttCheckInConfigured()?pageContainer.find("#tus_att_timer_checkin").prop("checked","1"===data.TS_attTimerEntryRestrection):pageContainer.find("#tus_att_timer_checkin").closest("div.zpl_secn").remove(),Timetracker.timeLogSettings.disableTimeLogsinAttHrs(),pageContainer.find("#tus_timereditmanager,#tus_timereditself").prop("checked",!1),"1"===data.TS_timerEdit?pageContainer.find("#tus_timereditmanager").prop("checked",!0):"0"===data.TS_timerEdit&&pageContainer.find("#tus_timereditmanager,#tus_timereditself").prop("checked",!0),pageContainer.find("#tus_showtimeloglocation").prop("checked",!data.TS_showTimelogLocation||"1"===data.TS_showTimelogLocation),pageContainer.find("#tus_tsCreation_admin,#tus_tsCreation_rm,#tus_tsCreation_self").prop("checked",!1),data.TS_timesheetOwners&&"2"!=data.TS_timesheetOwners?"1"==data.TS_timesheetOwners?pageContainer.find("#tus_tsCreation_admin,#tus_tsCreation_rm").prop("checked",!0):"0"==data.TS_timesheetOwners&&pageContainer.find("#tus_tsCreation_admin,#tus_tsCreation_rm,#tus_tsCreation_self").prop("checked",!0):pageContainer.find("#tus_tsCreation_admin").prop("checked",!0),pageContainer.find("#tus_timesheetOverLap").prop("checked","1"===data.TS_restrictTimesheetOverlap),pageContainer.find("#tus_min_hrs").prop("checked",data.TS_MinHrsEnabled&&"1"===data.TS_MinHrsEnabled),Timetracker.timesheetSettings.showHideMinMaxHrsInput(pageContainer.attr("id"),"0"!=data.TS_MinHrsEnabled,data,"min",pageContainer),pageContainer.find("#tus_max_hrs").prop("checked","1"===data.TS_MaxHrsEnabled),Timetracker.timesheetSettings.showHideMinMaxHrsInput(pageContainer.attr("id"),"0"!=data.TS_MaxHrsEnabled,data,"max",pageContainer),pageContainer.find("#tus_isNBlogforPayable").prop("checked","1"===data.TS_NonBillableTLforPayableHours)},setGeneralSettings:function(pageContainer,data){Timetracker.userSpecificSettings.setData(data,pageContainer)},addEditUserSpcSettings:function(json){var mode=json.mode,layout=settingsPage.container.find("#ttAddUserSettings");if(0===layout.find("#error_message_tscri").length){Timetracker.util.removeErrorMsg(void 0,layout),Timetracker.util.freezeSubmit(void 0,"zp_modal_blubtn",layout);var params=Timetracker.userSpecificSettings.getParamsForUserSpecSett(json);if(null!=params&&!params.isError&&layout.find("input[id='tus_max_hrs']").is(":checked")&&(layout.find("#tus_maxhrsperday_chkbox").is(":checked")&&Timetracker.timesheetSettings.validateCriHrs($(layout.find("#tus_max_per_day"))),0!==layout.find("#error_message_tscri").length&&(null==params?params={isError:!0}:params.isError=!0),null!=params&&params.isError||!layout.find("#tus_maxhrsperweek_chkbox").is(":checked")||Timetracker.timesheetSettings.validateCriHrs($(layout.find("#tus_max_per_week")))),0!==layout.find("#error_message_tscri").length&&(null==params?params={isError:!0}:params.isError=!0),params){if(params.isError)return Timetracker.util.unfreezeSubmit(void 0,"zp_modal_blubtn",layout),void(params.hasOwnProperty("errMsg")&&("minhrs_day_week_mand"===params.errMsg?Timetracker.util.showAlert(1,ZPI18N.getString("zp.minperdayweekmand")):"maxhrs_day_week_mand"===params.errMsg&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.maxperdayweekmand"))));ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.userSpecificSettings.addEditUserSpcSettingsCallback,{mode:mode,getUserSettingsDependency:params.getUserSettingsDependency},Timetracker.Util.generalFailureCallback)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")),layout.find("#zp_modal_blubtn").removeClass("disabled")}},getParamsForUserSpecSett:function(json){var layout=settingsPage.container.find("#ttAddUserSettings"),params={mode:"updateUserTimesheetSettings"},isError=!1,settingsNameObj=layout.find("#ts_usersettings_name"),settingsName=settingsNameObj.val();Timetracker.util.removeErrorMsg("ttAddUserSettings"),Timetracker.Validations.isEmpty(settingsName)?(isError=!0,Timetracker.Util.appenErrorMsgForElem({obj:settingsNameObj,msg:ZPI18N.getString("zp.pleaseentersettingname")})):params.settingsName=settingsName;var settingsTypeObj=layout.find("input[name=setting_type]:checked"),settingsType=settingsTypeObj.val()?settingsTypeObj.val():"0";Timetracker.Validations.isEmpty(settingsType)?(isError=!0,Timetracker.Util.appenErrorMsgForElem({obj:layout.find("input[name=setting_type]").parent("label"),msg:ZPI18N.getString("zp.pleaseselectsettingtype")})):params.settingsType=settingsType;var appFor=[],existing_appFor_cnt=0,previous_appfor="",config=json.config?$.extend(!0,{},json.config):Timetracker.generalSettings.settingDetails;params.appfor=AppExc.constructAppValues(layout,"#appToSec",["loc"]);let isEmpty=!0;var selectedUsers;if($.each(params.appfor,function(ind,param){0!=param.length&&(isEmpty=!1)}),isEmpty&&(Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#appToSec"),msg:ZPI18N.getString("zp.selectonecri")}),isError=!0),params.settingsType&&"0"===params.settingsType){selectedUsers=(selectedUsers=params.appfor.user)||[],previous_appfor=config.applicableForIds?config.applicableForIds:"";for(var i=0;i<selectedUsers.length;i++)-1===previous_appfor.indexOf(selectedUsers[i])&&-1!==Timetracker.userTSSettings.applicable_for_list.indexOf(selectedUsers[i])&&existing_appFor_cnt++}appFor=selectedUsers;layout.find("#modToGrp");existing_appFor_cnt>0&&(isError=!0,Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#appToSec"),msg:ZPI18N.getString("zp.useralreadymappedsett",[existing_appFor_cnt])}));var locAppFor=[],existing_locappFor_cnt=0,selectedLoc=params.appfor.loc;locAppFor=selectedLoc=selectedLoc||[];var previous_locappfor=config.locAppForIds?config.locAppForIds:"";for(i=0;i<selectedLoc.length;i++)-1===previous_locappfor.indexOf(selectedLoc[i])&&-1!==Timetracker.userTSSettings.location_app_for_list.indexOf(selectedLoc[i])&&existing_locappFor_cnt++;if(existing_locappFor_cnt>0&&(isError=!0,Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#appToSec"),msg:ZPI18N.getString("zp.alreadymappedsett",[existing_locappFor_cnt,ZPI18N.getString("zp.multiplelocation")])})),isError||(params.appfor=JSON.stringify(params.appfor)),(params=Timetracker.userSpecificSettings.getTimelogTimesheetParams(params,config,layout)).hasOwnProperty("isError")&&(isError=!0),isError)return Timetracker.genSettings.scrollToFirstErr(layout),params.hasOwnProperty("errMsg")?params:{isError:!0};if(json.mode===Timetracker.constants.EDIT&&config.settingsId&&(params.settingsId=config.settingsId),json.mode!==Timetracker.constants.EDIT||locAppFor.join(";")!==previous_locappfor||appFor.join(";")!==previous_appfor||Timetracker.userSpecificSettings.isSettingValueChanged(params,config)){let settingsMapObj={TS_fromToTimeLog:"fromToTimeLog",TS_automaticLog:"automaticLog",TS_attTimerEntryRestrection:"attTimerRestriction",TS_timeEntriesOverlap:"timeentryOverlap",TS_attendanceHrsLogRestrict:"attendanceTimelog"};for(const key in settingsMapObj)if(void 0!==String(params[settingsMapObj[key]])&&String(config[key])!==String(params[settingsMapObj[key]])){params.getUserSettingsDependency=!0;break}return params}return null},getTimelogTimesheetParams:function(params,data,layout){var selected,isError=!1;if(params.automaticLog=!!layout.find("#tus_timestamp_automatic").is(":checked"),params.fromToTimeLog=!!layout.find("#tus_timestamp_fromtolog").is(":checked"),params.manualLog=!!layout.find("#tus_timestamp_manual").is(":checked"),!(params.manualLog||params.fromToTimeLog||params.automaticLog))return Timetracker.Util.mandOptnErrMsg("tus_logtype",layout);(selected=layout.find("input[type='radio'][name='billingStatusType']:checked")).length>0&&(params.defaultbillingType=selected.val()),(selected=layout.find("input[type='radio'][name='timelogviewtype']:checked")).length>0&&(params.defaultview=selected.val()),params.estimatedHoursRestriction=layout.find("#tus_estimated_hours").is(":checked")?"1":"0",params.futureLog=layout.find("#tus_futurelog").is(":checked")?"1":"0",params.isWeekendLogRestricted=layout.find("#tus_include_weekend").is(":checked")?"1":"0",params.isHolidayLogRestricted=layout.find("#tus_include_holiday").is(":checked")?"1":"0",params.isUnpaidLogRestricted=layout.find("#tus_include_unpaid").is(":checked")?"1":"0",params.isPaidLogRestricted=layout.find("#tus_include_paid").is(":checked")?"1":"0",params.attendanceTimelog=layout.find("#tus_att_timelog").is(":checked")?"1":"0",params.zeroHoursTimelog=layout.find("#tus_zeroHours_timelog").is(":checked")?"1":"0",params.tlrestrictTimelogDate=layout.find("#tus_timelogdate").is(":checked")?"1":"0",params.tlrestrictPresentDate=layout.find("#tus_presentdate").is(":checked")?"1":"0",params.showTimelogLocation=layout.find("#tus_showtimeloglocation").is(":checked")?"1":"0",params.timeentryOverlap=layout.find("input[type='radio'][name='timeentryoverlap']:checked").val(),"0"===params.timeentryOverlap&&layout.find("#tus_timeentryoverlap_warn").is(":checked")&&(params.timeentryOverlap="1"),Timetracker.generalSettings.isTimerAttCheckInConfigured()&&(params.attTimerRestriction=layout.find("#tus_att_timer_checkin").is(":checked")?"1":"0"),(params=Timetracker.timeLogSettings.getParamsForPastLogs(params,layout)).hasOwnProperty("isError")&&(isError=!0),(params=Timetracker.timeLogSettings.getParamsForMaxLogHours(params,layout)).hasOwnProperty("isError")&&(isError=!0),params.timeredit="2",layout.find("#tus_timereditself").is(":checked")?params.timeredit="0":layout.find("#tus_timereditmanager").is(":checked")&&(params.timeredit="1");let periodjson={};if(layout.find("#tus_restricttsPeriod").is(":checked")){if(params.timesheetPeriod=layout.find("#tus_tsPeriod :checked").val(),params.timesheetPeriod===Timetracker.constants.TS_PERIOD.WEEK||params.timesheetPeriod===Timetracker.constants.TS_PERIOD.MONTH){let ts_submission_period_div=layout.find("#tus_tssubmission_div");if(ts_submission_period_div.find("#tus_restricttimesheetsubmission").is(":checked")){let ts_span=ts_submission_period_div.find("#tus_tsSpan"),from_day=TimelyZComp.select.getValue(ts_span.find("#tus_from_day"));if("-1"!==from_day&&""!==from_day){let from_range=TimelyZComp.select.getValue(ts_span.find("#tus_from_range"));periodjson.from_day=from_day,periodjson.from_range=from_range}let to_day=TimelyZComp.select.getValue(ts_span.find("#tus_to_day"));if("-1"!==to_day&&""!==to_day){let to_range=TimelyZComp.select.getValue(ts_span.find("#tus_to_range"));periodjson.from_day&&periodjson.from_range&&(parseInt(periodjson.from_range)>parseInt(to_range)||parseInt(periodjson.from_day)>parseInt(to_day)&&parseInt(periodjson.from_range)===parseInt(to_range))&&(ts_span.find("table #tus_tsSpan_errmsg").html('<span class="ztextbox--error__label trRM">'+ZPI18N.getString("zp.tt.timesheetsettings.fromperiodgreaterthanto")+"</span>"),isError=!0),periodjson.to_day=to_day,periodjson.to_range=to_range}0===Object.keys(periodjson).length&&(ts_span.find("table #tus_tsSpan_errmsg").append('<span class="ztextbox--error__label trRM">'+ZPI18N.getString("zp.tsinvalidperiod")+"</span>"),isError=!0)}}}else params.timesheetPeriod=Timetracker.constants.TS_PERIOD.ANY_DATE_RANGE;return(params=Timetracker.timesheetSettings.getParamsForMinMaxHours(params,layout)).timesheetSubmissionPeriod=JSON.stringify(periodjson),params.restrictTimesheetOverlap=layout.find("#tus_timesheetOverLap").is(":checked")?"1":"0",params.isNonBillLogsforPayable=layout.find("#tus_isNBlogforPayable").is(":checked")?"1":"0",isError?{isError:!0}:params},isSettingValueChanged:function(params,data){if(params.settingsName!==data.settingsName)return!0;if(data.TS_manualLog!==String(params.manualLog)||data.TS_fromToTimeLog!==String(params.fromToTimeLog)||data.TS_automaticLog!==String(params.automaticLog)||params.defaultbillingType!==data.TS_defaultbillingType||params.defaultview!==data.TS_DefaultView)return!0;if(params.maxLogHoursRestriction){if(params.maxLogHoursRestriction!==data.TS_maxLogHoursRestriction)return!0;if("0"!==params.maxLogHoursRestriction){if(data.TS_maxLogHoursRestriction_TLType!=params.maxLogHoursRestrictionTLType)return!0;let value=params.maxLogHoursRestrictionHours;if(""+Timetracker.DateTime.convertToMins(value)!==data.TS_maxLogHoursRestriction_Hours)return!0}}if(params.allowOT===data.TS_allowOT&&(void 0!==params.singlepayhours&&data.TS_singlePayHours!==""+Timetracker.DateTime.convertToMins(params.singlepayhours)||void 0!==params.doublepayhours&&data.TS_doublePayHours!==""+Timetracker.DateTime.convertToMins(params.doublepayhours)))return!0;if(data.TS_maxLogHoursRestriction!==params.maxLogHoursRestriction||data.TS_estimatedHoursRestriction!==params.estimatedHoursRestriction||data.TS_futureLogRestriction!==params.futureLog||data.TS_pastLogRestriction!==params.pastLog||void 0!==params.pastLogAllowDays&&data.TS_pastLogAllowDays!==params.pastLogAllowDays||data.TS_weekendLogRestriction!==params.isWeekendLogRestricted||data.TS_holidayLogRestriction!==params.isHolidayLogRestricted||data.TS_paidLeaveTLRestriction!==params.isPaidLogRestricted||data.TS_unpaidLeaveTLRestriction!==params.isUnpaidLogRestricted||data.TS_showTimelogLocation!==params.showTimelogLocation||data.TS_attendanceHrsLogRestrict!==params.attendanceTimelog||data.TS_zeroHoursRestriction!==params.zeroHoursTimelog||data.TS_presentDateWithinJobPerid!==params.tlrestrictPresentDate||data.TS_timelogDateWithinJobPerid!==params.tlrestrictTimelogDate||data.TS_timerEdit!==params.timeredit||void 0!==params.timeentryOverlap&&data.TS_timeEntriesOverlap!==params.timeentryOverlap||void 0!==params.attTimerRestriction&&data.TS_attTimerEntryRestrection!==params.attTimerRestriction)return!0;var periodjson=JSON.parse(params.timesheetSubmissionPeriod);return data.TS_timesheetPeriod!==params.timesheetPeriod||!(params.timesheetPeriod!==Timetracker.constants.TS_PERIOD.WEEK&&params.timesheetPeriod!==Timetracker.constants.TS_PERIOD.MONTH||data.TS_timesheetSubmissionPeriod.to_day==periodjson.to_day&&data.TS_timesheetSubmissionPeriod.from_day==periodjson.from_day&&data.TS_timesheetSubmissionPeriod.to_range===periodjson.to_range&&data.TS_timesheetSubmissionPeriod.from_range===periodjson.from_range)||(data.TS_restrictTimesheetOverlap!==params.restrictTimesheetOverlap||params.minHrsEnabled!=data.TS_MinHrsEnabled||"1"===params.minHrsEnabled&&(params.minHrsType!==data.TS_MinHrsType||void 0!==params.minHrsPerDay&&Timetracker.DateTime.convertToMins(params.minHrsPerDay)!=data.TS_MinHrsPerDay||void 0!==params.minHrsPerWeek&&params.minHrsPerWeek!=Calendar.minstohrs(data.TS_MinHrsPerWeek))||params.maxHrsEnabled!=data.TS_MaxHrsEnabled||"1"===params.maxHrsEnabled&&(params.maxHrsType!==data.TS_MaxHrsType||void 0!==params.maxHrsPerDay&&Timetracker.DateTime.convertToMins(params.maxHrsPerDay)!=data.TS_MaxHrsPerDay||void 0!==params.maxHrsPerWeek&&params.maxHrsPerWeek!=Calendar.minstohrs(data.TS_MaxHrsPerWeek))||(data.TS_NonBillableTLforPayableHours!=params.isNonBillLogsforPayable||void 0))},checkSpecificSettingsBasedOnAttIntg:function(element,layout){var eleId=$(element).attr("id");"tus_timestamp_fromtolog"===eleId&&!$(element).is(":checked")&&Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled()?($(element).prop("checked",!0),Timetracker.util.showAlert(1,ZPI18N.getString("zp.tt.timelogsettings.disabledattendance10"))):"tus_timestamp_automatic"===eleId&&!$(element).is(":checked")&&Timetracker.generalSettings.isPushTimerToAttendanceEnabled()?($(element).prop("checked",!0),Timetracker.util.showAlert(1,ZPI18N.getString("zp.tt.timelogsettings.disabledattendance10"))):"tus_att_timelog"===eleId&&$(element).is(":checked")&&(Timetracker.generalSettings.isPushTimerToAttendanceEnabled()||Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled())?($(element).prop("checked",!1),$(element).prop("disabled",!0),Timetracker.util.showAlert(1,ZPI18N.getString("zp.tt.timelogsettings.disabledattendance4")),$(element).parent().attr("title",ZPI18N.getString("zp.tt.timelogsettings.disabledattendance4")),$(element).parent().ztooltip()):"tus_timeentryoverlap_allow"!==eleId&&"tus_timeentryoverlap_warn"!==eleId||!layout.find("#tus_timeentryoverlap_restrict").is(":checked")&&Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled()&&(layout.find("#tus_timeentryoverlap_allow").prop("checked",!1),layout.find("#tus_timeentryoverlap_warn").prop("checked",!1),layout.find("#tus_timeentryoverlap_restrict").prop("checked",!0).change(),Timetracker.util.showAlert(1,ZPI18N.getString("zp.tt.timelogsettings.disabledattendance13")))},addEditUserSpcSettingsCallback:function(result,params,extraDtls){settingsPage.container.find("#ttAddUserSettings").find("#zp_modal_blubtn").removeClass("disabled");var error_msg,isError=!Timetracker.Validations.isDefiniteValue(result)||0===Object.keys(result).length;if(isError)error_msg=Timetracker.Util.getFailureMessageByCode();else{let error_code=result.errorCode;error_code?(isError=!0,error_msg=Timetracker.Util.getFailureMessageByCode(error_code,result.extra_dtls)):0===result.res&&result.message&&(isError=!0,error_msg=result.message)}if(isError)Timetracker.util.showAlert(0,error_msg);else if(result.success)if(Timetracker.util.showAlert(2,extraDtls&&"edit"===extraDtls.mode?ZPI18N.getString("zp.tt.specificpolicies.editedmsg"):ZPI18N.getString("zp.tt.specificpolicies.addedmsg")),TimelyZComp.destroy(),ModuleComp.Modal.hide("ttAddUserSettings"),result.extra_dtls&&result.extra_dtls.configObj){let configObj=result.extra_dtls.configObj,txt=Timetracker.userSpecificSettings.constructRow(configObj),listLayout=settingsPage.container.find(".zpl_rgtcnt"),settingsId=$(txt).attr("id"),settingObj=listLayout.find("tr#"+settingsId);if(settingObj&&0!==settingObj.length){var configInfo=settingObj.data("configInfo");if(configInfo){if(configInfo.applicableForIds!==configObj.applicableForIds){let previous_appFor_ids=configInfo.applicableForIds.split(";"),current_appFor_ids=configObj.applicableForIds.split(";"),remove_appFor_ids=ZPUtil.getDistinctElementsInArrays(previous_appFor_ids,current_appFor_ids);0!==remove_appFor_ids.length&&(Timetracker.userTSSettings.applicable_for_list=ZPUtil.getDistinctElementsInArrays(Timetracker.userTSSettings.applicable_for_list,remove_appFor_ids))}if(configInfo.locAppForIds!==configObj.locAppForIds){let previous_appFor_ids=configInfo.locAppForIds.split(";"),current_appFor_ids=configObj.locAppForIds.split(";"),remove_appFor_ids=ZPUtil.getDistinctElementsInArrays(previous_appFor_ids,current_appFor_ids);0!==remove_appFor_ids.length&&(Timetracker.userTSSettings.location_app_for_list=ZPUtil.getDistinctElementsInArrays(Timetracker.userTSSettings.location_app_for_list,remove_appFor_ids))}}settingObj.replaceWith(txt),Timetracker.userSpecificSettings.resetUserSpcSettings()}else{let trCnt=listLayout.find("#ts-usertbody").find("tr").length;listLayout.find("#ts-usertbody").append(txt),0===trCnt?(Timetracker.Util.showHideNoData({remove:!0}),settingsPage.container.find("#addSpecficPolicy").closest(".zpl_btnmnu").removeClass("zpl_DNI"),listLayout.find("#usersettings_list").show()):Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.USER_TS_SETTINGS,[])}Timetracker.userSpecificSettings.updateAttIntgFlags(extraDtls,result.extra_dtls)}else Timetracker.userSpecificSettings.getUserSpcSettings(),Timetracker.userSpecificSettings.resetUserSpcSettings()},resetUserSpcSettings:function(){Timetracker.userTSSettings.userSettingDetails={}},deleteUserSpcSettings:function(settingsId){let data=Timetracker.userTSSettings.settingDetails[settingsId],getUserSettingsDependency=!1;"false"!==data.TS_automaticLog&&"false"!==data.TS_fromToTimeLog&&"1"!==data.TS_attTimerEntryRestrection&&"1"!==data.TS_attendanceHrsLogRestrict&&"2"===data.TS_timeEntriesOverlap||(getUserSettingsDependency=!0),ZPeople.Request.send(Timetracker.constants.URL,{mode:"deleteUserTimesheetSettings",settingsId:settingsId,getUserSettingsDependency:getUserSettingsDependency},Timetracker.userSpecificSettings.deleteUserSpcSettingsCallback,{settingsId:settingsId,getUserSettingsDependency:getUserSettingsDependency},Timetracker.Util.generalFailureCallback)},deleteUserSpcSettingsCallback:function(result,params,extraDtls){var error_msg,isError=!Timetracker.Validations.isDefiniteValue(result)||0===Object.keys(result).length;if(isError)error_msg=Timetracker.Util.getFailureMessageByCode();else{let error_code=result.errorCode;error_code&&(isError=!0,error_msg=Timetracker.Util.getFailureMessageByCode(error_code))}if(isError)Timetracker.util.showAlert(0,error_msg);else if(result.success){let pageContainer=settingsPage.container;Timetracker.util.showAlert(2,ZPI18N.getString("zp.tt.specificpolicies.deletedmsg"));let listLayout=pageContainer.find(".zpl_rgtcnt"),trObj=listLayout.find("tr#"+params.settingsId),configInfo=trObj.data("configInfo");trObj.remove();let current_applicablefor=configInfo&&configInfo.applicableForIds?configInfo.applicableForIds.split(";"):[];Timetracker.userTSSettings.applicable_for_list=ZPUtil.getDistinctElementsInArrays(Timetracker.userTSSettings.applicable_for_list,current_applicablefor);let current_locAppfor=configInfo&&configInfo.locAppForIds?configInfo.locAppForIds.split(";"):[];Timetracker.userTSSettings.location_app_for_list=ZPUtil.getDistinctElementsInArrays(Timetracker.userTSSettings.location_app_for_list,current_locAppfor),0===listLayout.find("#ts-usertbody").find("tr").length&&(listLayout.find("#usersettings_list").hide(),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.tt.specificpolicies.nodatamessage"),buttonName:ZPI18N.getString("zp.addspecpolicy"),buttonCallBack:Timetracker.userSpecificSettings.loadAddUserSpcSettings,desc:ZPI18N.getString("zp.tt.specificpolicies.topbandtext")}),pageContainer.find("#addSpecficPolicy").closest(".zpl_btnmnu").addClass("zpl_DNI"),pageContainer.find("#zp_empty_data").show()),Timetracker.userSpecificSettings.resetUserSpcSettings(),Timetracker.userSpecificSettings.resetTSSettings(extraDtls.settingsId),Timetracker.userSpecificSettings.updateAttIntgFlags(extraDtls,result.extra_dtls)}},updateAttIntgFlags:function(extraDtls,data){extraDtls&&extraDtls.getUserSettingsDependency&&(Timetracker.generalSettings.settingDetails.specificSettings||(Timetracker.generalSettings.settingDetails.specificSettings={}),Timetracker.generalSettings.settingDetails.specificSettings.startEndAttIntgFlag=data.startEndAttIntgFlag,Timetracker.generalSettings.settingDetails.specificSettings.timerAttIntgFlag=data.timerAttIntgFlag)},destroyZComp:function(){var modal=settingsPage.container.find("#ttAddUserSettings");modal.find("select").each(function(){TimelyZComp.select.destroy($(this))}),modal.find("textarea").each(function(){TimelyZComp.tokenField.destroy($(this))})},Firescroll:{mode:"TT_USERSPECIFICSETTINGS_FIRESCROLL",loadMoreData:function(result,params,otherDetails){let configInfo=result.configInfo||[],txt=Timetracker.userSpecificSettings.constructUserSpcSettingsRows(configInfo);settingsPage.container.find("#ts-usertbody").append($(txt).children()),Timetracker.FireScroll.setFetchCount(Timetracker.userSpecificSettings.Firescroll.mode,configInfo)}},constructApplicability:function(key,appFor,index){appFor.length>0&&("user"===key?AppExc.addEmpConditionRow(void 0,"appToSec",appFor):AppExc.addNewConditionRow(void 0,"appToSec",index,appFor))}},Timetracker.schedRemindSettings={init:function(){Timetracker.genSettings.init(),Timetracker.genSettings.permissionCheck()&&Timetracker.schedRemindSettings.fetchData()},fetchData:function(){var type=Timetracker.schedulerReminderSettings.TIMESHEET_SCHEDULER_TYPE,resultData=Timetracker.schedulerReminderSettings.scheduleObj;if(Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER)&&(type=Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE,resultData=Timetracker.schedulerReminderSettings.reminderObj),AppExc.getApplicableIds(),Timetracker.schedulerReminderSettings.fetchData=null===resultData,Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(void 0,{fullPageModal:!0}),settingsPage.container.find("#ttsettings-remindertbody,#ttsettings-schtbody").hide(),Timetracker.schedulerReminderSettings.fetchData){let params={mode:"getAutoSchedule",type:type,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){Timetracker.schedRemindSettings.constructHtml(resultData,type),type?Timetracker.schedulerReminderSettings.reminderObj=resultData:Timetracker.schedulerReminderSettings.scheduleObj=resultData},{},Timetracker.Util.generalFailureCallback)}else Timetracker.schedRemindSettings.constructHtml(resultData,type)},constructHtml:function(resultData,type){void 0!==type&&null!==type||(type=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER)?Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE:Timetracker.schedulerReminderSettings.TIMESHEET_SCHEDULER_TYPE);let isReminder=type===Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE;var pageContainer=settingsPage.container;pageContainer.hasClass("zpl_tblfxd")||Timetracker.genSettings.addTablFxdCls(pageContainer);var tbodyId=isReminder?"ttsettings-remindertbody":"ttsettings-schtbody",html=Timetracker.genSettings.getHeaderBandHtml({header:isReminder?ZPI18N.getString("zp.reminders"):ZPI18N.getString("zp.scheduler"),description:isReminder?ZPI18N.getString("zp.tt.remaindersettings.topbandtext"):ZPI18N.getString("zp.tt.schedlersettings.topbandtext"),headerExtraClass:"zpl_topcrdhdr"});html+='<div class="zpl_rgtcnt">',html+='<div class="zpl_btnmnu"><div class="zpl_rgt"><button id="addSchdRemdButton" class="zlabel zlabel--blue zlabel--medium"  onclick="Timetracker.schedRemindSettings.showScheduleAndReminderAddPopup('+type+');">'+(isReminder?ZPI18N.getString("zp.addreminder"):ZPI18N.getString("zp.addscheduler"))+"</button></div></div>",html+=isReminder?'<div class="zpl_tblres" id="reminderlist"><table class="zpl_tbl"><thead><tr class=""><th width="250">'+ZPI18N.getString("zp.tt.remaindersettings.reminder.remindername")+"</th><th>"+ZPI18N.getString("zp.type")+"</th><th>"+ZPI18N.getString("zp.frequency")+'</th><th width="28%">'+ZPI18N.getString("zp.timeofsch")+'</th><th width="100"></th></tr></thead>':'<div class="zpl_tblres" id="schedulinglist"><table class="zpl_tbl"><thead><tr class=""><th width="250">'+ZPI18N.getString("zp.tt.schedlersettings.schedulename")+"</th><th>"+ZPI18N.getString("zp.frequency")+"</th><th>"+ZPI18N.getString("zp.timeofsch")+'</th><th width="28%">'+ZPI18N.getString("zp.tt.schedlersettings.billablestatus")+'</th><th width="100"></th></tr></thead>',html+='<tbody id="'+tbodyId+'"></tbody></table></div><div id="zp_empty_data"/></div>',pageContainer.html(html);var frequency=new Array(ZPI18N.getString("zp.daily"),ZPI18N.getString("zp.weekly"),ZPI18N.getString("zp.monthly")),billstatus=new Array(ZPI18N.getString("zp.all"),ZPI18N.getString("zp.billable"),ZPI18N.getString("zp.nonbillable"));if(resultData&&0!==resultData.length&&""!==resultData){Timetracker.Util.showHideNoData({remove:!0}),pageContainer.find("#addSchdRemdButton").closest(".zpl_btnmnu").removeClass("zpl_DNI");var docFrag=document.createDocumentFragment();$.each(resultData,function(index,data){let reminderType;data.type===Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE?reminderType=ZPI18N.getString("zp.timesheets"):data.type===Timetracker.schedulerReminderSettings.TIMELOG_REMINDER_TYPE?reminderType=ZPI18N.getString("zp.timelogs"):data.type==Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE&&(reminderType=ZPI18N.getString("zp.tologwithinatthours"));var txt="<tr><td><span>"+data.scheduleName+"</span></td>";data.type!==Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE&&data.type!==Timetracker.schedulerReminderSettings.TIMELOG_REMINDER_TYPE&&data.type!==Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE||(txt+="<td>"+reminderType+"</td>"),data.type===Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE?(txt+="<td></td>",txt+="<td></td>"):(txt+="<td><span>"+frequency[data.frequency]+"</span></td>",txt+="<td><span>"+Calendar.minstotime(data.time)+"</span></td>"),isReminder||(txt+="<td>"+billstatus[data.billStatus+1]+"</td>"),txt+='<td><div class="zpl_hvr"><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+" onclick=\"Timetracker.Util.confirmpopUp('"+data.scheduleId+"',Timetracker.schedRemindSettings.deleteSchdRemdRecord,'"+data.scheduleId+"',0,{ header:'"+(Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSCHEDULER)?ZPI18N.getString("zp.tt.remaindersettings.deletescheduler"):ZPI18N.getString("zp.tt.remaindersettings.deletereminder"))+"'});\"></i></div></td></tr>",(txt=$(txt)).data(data),docFrag.append(txt[0]),txt.on("click","td:not(:last-child)",function(){Timetracker.schedRemindSettings.loadScheduleAndReminderEditSettings(this,1,data.type)})}),pageContainer.find("#"+tbodyId).append(docFrag),isReminder?(pageContainer.find("#ttsettings-remindertbody").fadeIn(200),pageContainer.find("#zp_empty_data").fadeOut(200)):(pageContainer.find("#ttsettings-schtbody").fadeIn(200),pageContainer.find("#zp_empty_data").fadeOut(200))}else isReminder?(Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.tt.remaindersettings.noremaindersettconfigured"),buttonName:ZPI18N.getString("zp.addreminder"),buttonCallBack:Timetracker.schedRemindSettings.showScheduleAndReminderAddPopup,desc:ZPI18N.getString("zp.tt.remaindersettings.topbandtext")}),pageContainer.find("#reminderlist").hide()):(Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.tt.schedlersettings.nottsschedulersettconfigured"),buttonName:ZPI18N.getString("zp.addscheduler"),buttonCallBack:Timetracker.schedRemindSettings.showScheduleAndReminderAddPopup,desc:ZPI18N.getString("zp.tt.schedlersettings.topbandtext")}),pageContainer.find("#schedulinglist").hide()),pageContainer.find("#addSchdRemdButton").closest(".zpl_btnmnu").addClass("zpl_DNI");TimelyZComp.toolTip.intiliaze(),Timetracker.util.removeLoading()},deleteSchdRemdRecord:function(scheduleId){ZPeople.Request.send(Timetracker.constants.URL,{mode:"deleteAutoSchedule",scheduleId:scheduleId,conreqcsr:csrfToken},function(resultData){-1!==settingsUrlProps.niceUrl.indexOf("service/timetracker/reminders")?(Timetracker.schedulerReminderSettings.reminderObj=null,Timetracker.util.showAlert(2,ZPI18N.getString("zp.reminderdeleted"))):(Timetracker.schedulerReminderSettings.scheduleObj=null,Timetracker.util.showAlert(2,ZPI18N.getString("zp.lms.batches.deleteRepeatSucc"))),Timetracker.schedRemindSettings.fetchData()},{},Timetracker.Util.generalFailureCallback)},showScheduleAndReminderAddPopup:function(flag){flag=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER)?Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE:Timetracker.schedulerReminderSettings.TIMESHEET_SCHEDULER_TYPE;Timetracker.schedulerReminderSettings.editMode=!1,Timetracker.schedulerReminderSettings.editData=null,Timetracker.schedRemindSettings.showScheduleAndReminderAddEditPopup(flag)},showScheduleAndReminderAddEditPopup:function(flag){Timetracker.schedulerReminderSettings.tabId="1"===String(flag)||"2"===String(flag)||"42"===String(flag)?"tssettings-addreminderdiv":"tssettings-addschdiv";var modal=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId);if(Timetracker.schedRemindSettings.appElements=[0,1,2,3,4],AppExc.setAppIndex(Timetracker.schedRemindSettings.appElements,!0),0==modal.length)modal=Timetracker.schedRemindSettings.contructSchedRemindSettingsPopup(flag);else{var header="";header=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER)?Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.tt.remaindersettings.editreminder"):ZPI18N.getString("zp.tt.remaindersettings.addreminder"):Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.tt.remaindersettings.editscheduler"):ZPI18N.getString("zp.tt.remaindersettings.addscheduler"),modal.find("#zp_modal_header").text(header),Timetracker.util.unfreezeSubmit(void 0,"zp_modal_blubtn",modal),Timetracker.util.removeErrorMsg(void 0,modal),ModuleComp.Modal.show(modal)}Timetracker.schedRemindSettings.resetSchedulerReminderSettingsPopup(flag),TimelyZComp.toolTip.customMsgIntz(modal,[{class:"PI_cls",title:ZPI18N.getString("zp.close")}])},contructSchedRemindSettingsPopup:function(flag){var isTSScheduler=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSCHEDULER),isTSReminder=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER),header="";header=isTSReminder?Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.tt.remaindersettings.editreminder"):ZPI18N.getString("zp.addreminder"):Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.tt.remaindersettings.editscheduler"):ZPI18N.getString("zp.addscheduler");var body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry" id="tssettings-schedule-label-name">'+(isTSReminder?ZPI18N.getString("zp.tt.remaindersettings.reminder.remindername"):ZPI18N.getString("zp.tt.schedlersettings.schedulename"))+'</label></div><div><input id="tssettings-schdulename" type="text" placeholder="'+ZPI18N.getString(isTSReminder?"zp.tt.remaindersettings.enterremindername":"zp.tt.schedlersettings.enterschedulename")+'" class="ztextbox"></div></div>';isTSReminder&&(body+='<div class="zpl_secn w400"><div><label id="tssettings-schedule-remindertype">'+ZPI18N.getString("zp.type")+'</label></div><div><select elemType="select" id="tssettings-remindertype"><option value="1">'+ZPI18N.getString("zp.timelogs")+'</option><option value="0">'+ZPI18N.getString("zp.timesheets")+"</option>",Timetracker.generalSettings.isCustomReminderLogTimeWithInAttHours()&&(body+='<option value="42">'+ZPI18N.getString("zp.tologwithinatthours")+"</option>"),body+="</select></div></div>"),body+='<div class="zpl_secn w400"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.frequency")+'</label></div><div><select elemType="select" id="tssettings-frequency"><option value="0">'+ZPI18N.getString("zp.daily")+'</option><option value="1">'+ZPI18N.getString("zp.weekly")+'</option><option value="2">'+ZPI18N.getString("zp.monthly")+'</option></select></div><div id="tssettings-dayofweek" class="zpl_idiv" style="display: none"><select elemType="select" data-width="200" id="tssettings-dayweek"><option value="0">'+ZPI18N.getString("zp.sunday")+'</option><option value="1">'+ZPI18N.getString("zp.monday")+'</option><option value="2">'+ZPI18N.getString("zp.tuesday")+'</option><option value="3">'+ZPI18N.getString("zp.wednesday")+'</option><option value="4">'+ZPI18N.getString("zp.thursday")+'</option><option value="5">'+ZPI18N.getString("zp.friday")+'</option><option value="6">'+ZPI18N.getString("zp.saturday")+"</option></select><em>"+ZPI18N.getString("zp.everyweek/month",[ZPI18N.getString("zp.sweek")])+'</em></div><div><div id="tssettings-dayofmonth" class="zpl_idiv" style="display: none"><select elemType="select" data-width="100" id="tssettings-daymonth">';for(var monthFreqDays=31,i=1;i<=monthFreqDays;i++)body+='<option value="'+i+'">'+i+Timetracker.DateTime.getNumberSuffix(i)+"</option>";return body+='<option value="'+(monthFreqDays=parseInt(monthFreqDays)+1)+'">'+ZPI18N.getString("zp.lastday")+"</option></select><em>"+ZPI18N.getString("zp.everyweek/month",[ZPI18N.getString("zp.smonth")])+"</em></div></div></div>",body+='<div class="zpl_secn w400"><div><label>'+ZPI18N.getString("zp.processdataof",[""])+'</label></div><div id="tssettings_processperiod_layout"><select elemType="select" id="tssettings_processperiod"></select></div></div><div class="zpl_secn w400"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.timeofsch")+'</label></div><div><input type="text" elemType="timefield" id="tssettings-time" class="ztextbox"></div></div>',isTSScheduler?body+='<div class="zpl_secn w400" id="tssettings-schedule-billing-row"><div><label>'+ZPI18N.getString("zp.tt.schedlersettings.billablestatus")+'</label></div><div><select elemType="select" id="tssettings-billstatus"><option value="-1">'+ZPI18N.getString("zp.all")+'</option><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select></div></div>":(body+='<div id="ts_summary" class="zpl_secn"><div id="TS_notifyWhenTLog"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.notifywhenempolyees")+'</h5></div><div class="zpl_secn"><div><div class="zpl_idiv"><div class="zradiobutton"><input type="radio" name="NotifyWhenEmpTL" id="TLnotSubmit" value="0" class="zradiobutton__helper" checked><label for="TLnotSubmit" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.hnotloggedtime")+'</span></label></div></div><div class="zpl_idiv zpl_erorbx"><div><div class="zradiobutton"><input type="radio" name="NotifyWhenEmpTL" id="TLlessSubmit" value="1" class="zradiobutton__helper"><label for="TLlessSubmit"class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.hloggedlessthan",[""])+' </span></label></div></div><div><input id="timeLimitToNotify" type="text" value="00:00" class="ztextbox w100"></div>'+ZPI18N.getString("zp.gracehour")+"</div></div></div></div></div>",body+='<div id="TS_notifyWhenTSheet"><div class="zpl_secn" ><div><h5>'+ZPI18N.getString("zp.notifywhenempolyees")+'</h5></div><div class="zpl_secn"><div><div class="zpl_idiv"><div class="zradiobutton"><input type="radio" name="NotifyWhenEmpTS" id="TSnotSubmit" value="0" class="zradiobutton__helper" checked><label for="TSnotSubmit" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.hnotsubmittedtimesheet")+'</span></label></div></div><div class="zpl_idiv"><div><div class="zradiobutton"><input type="radio" name="NotifyWhenEmpTS" id="TSlessSubmit" value="1" class="zradiobutton__helper"><label for="TSlessSubmit"class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.hsubmittedlessthan",[""])+'</span></label></div></div><div><input id="timeLimitToNotify" type="text" value="00:00" class="ztextbox w100"></div>'+ZPI18N.getString("zp.hoursforapproval")+"</div></div></div></div></div></div>"),body+=AppExc.returnApplicableHtml("appToSec",!1,isTSReminder),isTSReminder&&(body+=AppExc.returnExemptionButton(void 0,!0)),isTSReminder&&(body+='<div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.notifyviamail")+'</h5></div><div class="chkdectxt"><div class="zcheckbox"><input id="notifyToEmp" type="checkbox" name="notifyviamail" checked class="zcheckbox__helper"><label for="notifyToEmp" class="zcheckbox__label">'+ZPI18N.getString("zp.local.employeesself")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.applicableemployees")+'</span></div><div class="chkdectxt"><div class="zcheckbox"><input id="notifyToReporting" type="checkbox" name="notifyviamail" class="zcheckbox__helper"><label for="notifyToReporting" class="zcheckbox__label">'+ZPI18N.getString("zp.srepman")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.notifytoreportingmanager")+'</span></div><div class="chkdectxt"><div class="zcheckbox"><input id="notifyToSEmp" type="checkbox" name="notifyviamail"  class="zcheckbox__helper"><label for="notifyToSEmp" class="zcheckbox__label">'+ZPI18N.getString("zp.survey.specificemployees")+'</label></div> <span class="dectxt">'+ZPI18N.getString("zp.notifytoselectedemployees")+'</span></label><div class="zpl_gbox"  id="notifEmpDiv"><div><textarea elemType="tokenfield" id="notifyToSEmpUsers"></textarea></div></div></div></div>'),body+='<div class="zpl_secn" id="cycle_details"><div class="zpl_info"><h6><span>'+ZPI18N.getString("zp.summary")+'</span></h6><ul id="ts_schedule_summary"></ul></div>',body+="</div></div>",ModuleComp.Modal.setup({id:Timetracker.schedulerReminderSettings.tabId,type:1,header:header,body:body,footer:"",deleteOnHide:!1,closeOnSubmit:!1,buttonValue:ZPI18N.getString("zp.save"),hiddenCallback:Timetracker.schedRemindSettings.destroyZComp,successCallback:Timetracker.schedRemindSettings.updateScheduleSettings,LayerId:settingsPage.container[0].id})},resetSchedulerReminderSettingsPopup:function(flag){const layout=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId);Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSCHEDULER);var notifyData,isTSReminder=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER);if(layout.find("#zp_modal_blubtn").prop("disabled",!1),layout.find("#tssettings-dayofweek,#tssettings-dayofmonth").hide(),TimelyZComp.select.intialize(layout.find("#tssettings-remindertype")),TimelyZComp.select.intialize(layout.find("#tssettings-billstatus")),Timetracker.schedulerReminderSettings.editMode){var data=$.extend({},Timetracker.schedulerReminderSettings.editData,!0);if("42"!==String(flag)&&TimelyZComp.select.intialize(layout.find("#tssettings-frequency"),{selectedValue:data.frequency,change:function(){Timetracker.schedRemindSettings.changeTSfrequency($(this))}}),void 0==data.schedulerConf||"1"!==String(flag)&&"2"!==String(flag))"1"!==String(flag)&&"2"!==String(flag)||(layout.find("#notifyToEmp")[0].checked=1,layout.find("#notifyToReporting")[0].checked=0,layout.find("#notifyToSEmp")[0].checked=0,Timetracker.Search.populateZCompUsers("notifyToSEmpUsers",null,{submode:"TIMETRACKER_SETTINGS",extraParams:{projectManagerPerm:!0},placeHolder:ZPI18N.getString("zp.select"),useDefaultValuesCache:!0},!0,layout));else if(notifyData=JSON.parse(decodeHTML(data.schedulerConf)),layout.find("#notifyToEmp")[0].checked=parseInt(notifyData.isNotifyEmployee),layout.find("#notifyToReporting")[0].checked=parseInt(notifyData.isNotifyRepMan),0!=notifyData.notifySpecificUsers.length){layout.find("#notifyToSEmp")[0].checked=1;let userList=ZPeople.getUserDetailsByIds(notifyData.notifySpecificUsers,!1),values=[];for(var i in notifyData.notifySpecificUsers){var id=notifyData.notifySpecificUsers[i],userDtl=ZPeople.getUserDetailsByIdInList(id,userList);userDtl&&userDtl.name&&values.push({id:id,text:ZPeople.decodeTxt(userDtl.empid+" "+userDtl.name),html:userDtl.empid+" "+userDtl.name,photo:userDtl.avatar})}Timetracker.Search.populateZCompUsers("notifyToSEmpUsers",values,{submode:"TIMETRACKER_SETTINGS",extraParams:{projectManagerPerm:!0},placeHolder:ZPI18N.getString("zp.select"),useDefaultValuesCache:!0},!0,layout),TimelyZComp.tokenField.addValues(layout.find("#notifyToSEmpUsers"),values)}else layout.find("#notifyToSEmp")[0].checked=0,Timetracker.Search.populateZCompUsers("notifyToSEmpUsers",null,{submode:"TIMETRACKER_SETTINGS",extraParams:{projectManagerPerm:!0},placeHolder:ZPI18N.getString("zp.select"),useDefaultValuesCache:!0},!0,layout);"1"===String(flag)||"2"===String(flag)||"42"===String(flag)?data.type===Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE?TimelyZComp.select.setValue(layout.find("#tssettings-remindertype"),"0"):data.type===Timetracker.schedulerReminderSettings.TIMELOG_REMINDER_TYPE?TimelyZComp.select.setValue(layout.find("#tssettings-remindertype"),"1"):data.type===Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE&&TimelyZComp.select.setValue(layout.find("#tssettings-remindertype"),"42"):TimelyZComp.select.setValue(layout.find("#tssettings-billstatus"),data.billStatus),TimelyZComp.timeField.setValue(layout.find("#tssettings-time"),Calendar.minstotime(data.time)),"1"===String(data.frequency)?(TimelyZComp.select.setValue(layout.find("#tssettings-dayweek"),data.day),layout.find("#tssettings-dayofweek").show()):"2"===String(data.frequency)&&(TimelyZComp.select.setValue(layout.find("#tssettings-daymonth"),data.day),layout.find("#tssettings-dayofmonth").show()),Timetracker.schedRemindSettings.changeTSfrequency(layout.find("#tssettings-frequency")[0],data),Timetracker.schedRemindSettings.updateEditOptions(),layout.find("#tssettings-schdulename").val(ZPeople.decodeTxt(data.scheduleName)).focus()}else layout.find("#tssettings-schdulename").trigger("focus"),TimelyZComp.select.intialize(layout.find("#tssettings-frequency"),{selectedValue:"0",change:function(){Timetracker.schedRemindSettings.changeTSfrequency($(this))}}),Timetracker.schedRemindSettings.changeTSfrequency(layout.find("#tssettings-frequency")[0]),layout.find("#tssettings-schdulename").val(""),layout.find("#tssettings-billstatus").val("-1"),TimelyZComp.timeField.destroy(layout.find("#tssettings-time")),TimelyZComp.timeField.intialize(layout.find("#tssettings-time")),"1"===String(flag)&&(layout.find("#tssettings-remindertype").val(1),layout.find("#notifyToEmp")[0].checked=1,layout.find("#notifyToReporting")[0].checked=0,layout.find("#notifyToSEmp")[0].checked=0,Timetracker.Search.populateZCompUsers("notifyToSEmpUsers",null,{submode:"TIMETRACKER_SETTINGS",extraParams:{projectManagerPerm:!0},placeHolder:ZPI18N.getString("zp.select"),useDefaultValuesCache:!0},!0,layout)),AppExc.addNewConditionRow(void 0,"appToSec"),layout.find("#tssettings-schdulename").trigger("focus");isTSReminder&&(Timetracker.schedulerReminderSettings.editMode&&Timetracker.Validations.isDefiniteValue(data)&&Timetracker.Validations.isDefiniteValue(notifyData)&&(notifyData.reminderType=data.type===Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE?"0":"1"),layout.find("#ts_summary").find("input[type=radio]").off("change").on("change",function(){Timetracker.schedRemindSettings.enableDisableHoursField(notifyData),Timetracker.schedRemindSettings.tsScheduleSummary(this)}),layout.find("#ts_summary").find("input[type=text]").off("change").on("change",function(){Timetracker.schedRemindSettings.tsScheduleSummary(this)}),layout.find("#tssettings-remindertype").off().on("zselectchange",function(){Timetracker.schedRemindSettings.tsScheduleSummary(this);let currentReminderType=layout.find("#tssettings-remindertype").val();currentReminderType==Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE?(layout.find("#tssettings-frequency,#tssettings_processperiod,#tssettings-time,#notifyToReporting,#TS_notifyWhenTLog,#TLnotSubmit,#TSnotSubmit").closest(".zpl_secn").hide(),TimelyZComp.select.setValue(layout.find("#tssettings-frequency"),0)):(layout.find("#tssettings-frequency,#tssettings_processperiod,#tssettings-time,#notifyToReporting,#TS_notifyWhenTLog,#TLnotSubmit,#TSnotSubmit").closest(".zpl_secn").show(),"1"==currentReminderType?(Timetracker.Validations.isDefiniteValue(notifyData)&&notifyData.reminderType===currentReminderType&&"1"===notifyData.notifyCondition?layout.find("#TLlessSubmit").prop("checked",!0).change():layout.find("#TLnotSubmit").prop("checked",!0).change(),layout.find("#TS_notifyWhenTSheet").hide(),layout.find("#TS_notifyWhenTLog").show()):(Timetracker.Validations.isDefiniteValue(notifyData)&&notifyData.reminderType===currentReminderType&&"1"===notifyData.notifyCondition?layout.find("#TSlessSubmit").prop("checked",!0).change():layout.find("#TSnotSubmit").prop("checked",!0).change(),layout.find("#TS_notifyWhenTSheet").show(),layout.find("#TS_notifyWhenTLog").hide()))}),layout.find("#notifyToSEmp").on("change",function(){layout.find("#notifyToSEmp").is(":checked")?layout.find("#notifEmpDiv").show():layout.find("#notifEmpDiv").hide()}),layout.find("#notifyToSEmp").trigger("change"),layout.find("#tssettings-remindertype").trigger("zselectchange"),AppExc.showHideAddMoreEle(layout,AppExc.appElementsIndex)),layout.find("#tssettings-frequency,#tssettings-dayweek,#tssettings-daymonth").off("zselectchange").on("zselectchange",function(){Timetracker.schedRemindSettings.tsScheduleSummary(this)}),layout.find("#tssettings-time").off("ztimefieldspinend").on("ztimefieldspinend",function(){Timetracker.schedRemindSettings.tsScheduleSummary(this)}),Timetracker.schedRemindSettings.tsScheduleSummary(layout)},enableDisableHoursField:function(reminderDetails){const layout=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId);let currentReminderType=layout.find("#tssettings-remindertype").val(),notifyDiv="1"===currentReminderType?"#TS_notifyWhenTLog":"#TS_notifyWhenTSheet",element=layout.find(notifyDiv).find("#timeLimitToNotify");if("0"===layout.find(notifyDiv).find("input:checked").val())element.addClass("is-disabled").prop("disabled",!0),element.val(Calendar.minstohrs(0));else{let hours=Timetracker.Validations.isDefiniteValue(reminderDetails)&&reminderDetails.reminderType===currentReminderType&&"1"===reminderDetails.notifyCondition?reminderDetails.minHrsReq:0;element.removeClass("is-disabled").prop("disabled",!1),element.val(Calendar.minstohrs(hours))}},constructApplicableForEdit:function(layout,data){data||(data=Timetracker.schedulerReminderSettings.editData);var appFor={user:data.user?data.user:[],dept:data.dept?data.dept:[],desg:data.desg?data.desg:[],role:data.role?data.role:[],loc:data.loc?data.loc:[],group:data.group?data.group:[]};ModuleComp.ZPPickList.consAppData(appFor,layout)},returnParamsForRoleDeptDesignationForSchedules:function(params){if(params.isValid=!0,Timetracker.schedulerReminderSettings.editMode){if(appfor=JSON.parse(params.appfor),JSON.stringify(appfor.role)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.role)&&JSON.stringify(appfor.dept)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.dept)&&JSON.stringify(appfor.desg)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.desg)&&JSON.stringify(appfor.loc)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.loc)&&JSON.stringify(appfor.user)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.user)&&JSON.stringify(appfor.group)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.group)&&(params.isValid=!1),params.isValid)return params;Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER)&&(appfor=JSON.parse(params.exceptfor),JSON.stringify(appfor.role)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.exceptrole)&&JSON.stringify(appfor.dept)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.exceptdept)&&JSON.stringify(appfor.desg)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.exceptdesg)&&JSON.stringify(appfor.loc)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.exceptloc)&&JSON.stringify(appfor.user)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.exceptuser)&&JSON.stringify(appfor.group)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.exceptgroup)?params.isValid=!1:params.isValid=!0)}return params},APPLICABLE_FOR_KEYS:["loc","dept","desg","role","group","user"],EXCEPTION_FOR_KEYS:["exceptloc","exceptdept","exceptdesg","exceptrole","exceptgroup","exceptuser"],updateEditOptions:function(){Timetracker.schedRemindSettings.setApplData(!0),Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER)&&Timetracker.schedRemindSettings.setApplData(!1)},setApplData:function(appFor){var modal=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId),isExemtionNeeded=!0;modal.find("#oldVersionDiv").hide(),modal.find("#excToSec").show();var data=Timetracker.schedulerReminderSettings.editData,fields=Timetracker.schedRemindSettings.APPLICABLE_FOR_KEYS,idDiv="appToSec";appFor||(idDiv="excToSec",fields=Timetracker.schedRemindSettings.EXCEPTION_FOR_KEYS);for(var indx in fields){var field=fields[indx],obj=data[field],arr=_.isArray(obj)?obj:[];0!=arr.length&&(!appFor&&isExemtionNeeded&&(Timetracker.schedRemindSettings.addExemptions(),isExemtionNeeded=!1),"user"==field||"exceptuser"==field?(modal.find("#users_field").prev().removeClass("zpl_DNI"),AppExc.addEmpConditionRow(void 0,idDiv,arr)):arr&&AppExc.addNewConditionRow(void 0,idDiv,fields.indexOf(field),arr))}},addExemptions:function(undefined,undefined,addEmptyCondRow){var modal=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId);modal.find("#excToButSec").hide(),modal.find(".zpl_crdcnt #excToButSec").after(AppExc.returnApplicableHtml("excToSec",!1,!0)),Timetracker.schedRemindSettings.appElements=[0,1,2,3,4],AppExc.showHideAddMoreEle(modal,Timetracker.schedRemindSettings.appElements),addEmptyCondRow&&AppExc.addNewConditionRow(undefined,"excToSec")},loadScheduleAndReminderEditSettings:function(obj,flag,scheduleType){var data=$(obj).parent().data();void 0===data&&(data=$(obj).parents(":nth(2)").data()),Timetracker.schedulerReminderSettings.editMode=!0,Timetracker.schedulerReminderSettings.editData=data,Timetracker.schedRemindSettings.showScheduleAndReminderAddEditPopup(scheduleType)},changeTSfrequency:function(obj,scheduleInfo){var outerAddLayoutId=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId);outerAddLayoutId.find("#tssettings-dayofweek").hide(),outerAddLayoutId.find("#tssettings-dayofmonth").hide(),obj=obj.target?obj.target:obj,"1"===$(obj).val()?(TimelyZComp.select.intialize(outerAddLayoutId.find("#tssettings-dayweek")),outerAddLayoutId.find("#tssettings-dayofweek").show()):"2"===$(obj).val()&&(TimelyZComp.select.intialize(outerAddLayoutId.find("#tssettings-daymonth")),outerAddLayoutId.find("#tssettings-dayofmonth").show());var options,process_period_layout=outerAddLayoutId.find("div#tssettings_processperiod_layout"),process_period_select=process_period_layout.find("select#tssettings_processperiod");if("1"===$(obj).val())options='<option value="0">'+ZPI18N.getString("zp.calprevweek")+'</option><option value="1">'+ZPI18N.getString("zp.calcurrweek")+'</option><option value="2">'+ZPI18N.getString("zp.local.customweek")+"</option>";else if("2"===$(obj).val())options='<option value="0">'+ZPI18N.getString("zp.calprevmonth")+'</option><option value="1">'+ZPI18N.getString("zp.local.currentmonth")+'</option><option value="2">'+ZPI18N.getString("zp.local.custommonth")+"</option>";else{options='<option value="0">'+ZPI18N.getString("zp.local.currentday")+"</option>";for(var i=1;i<6;i++)options+='<option value="'+i+'">'+i+" "+(1===i?ZPI18N.getString("zp.daybefore",[""]):ZPI18N.getString("zp.daysbefore",[""]))+"</option>"}TimelyZComp.select.destroyAll(void 0,process_period_layout),process_period_select.html(options),process_period_select.siblings().remove();var process_period="0";if(scheduleInfo&&(process_period="1"===$(obj).val()||"2"===$(obj).val()?"2":"0",scheduleInfo.schedulerConf)){let conf=JSON.parse(decodeHTML(scheduleInfo.schedulerConf));conf&&void 0!==conf.process_period&&(process_period=""+conf.process_period)}ZPeopleComponents.isComponent(process_period_select)||TimelyZComp.select.intialize(process_period_select,{dropdownList:{appendTo:outerAddLayoutId.find(".zpl_mcnt")}}),TimelyZComp.select.setValue(process_period_select,process_period),process_period_select.off("zselectchange").on("zselectchange",function(){Timetracker.schedRemindSettings.onProcessPeriodChange(this,scheduleInfo),Timetracker.schedRemindSettings.tsScheduleSummary(this)}),process_period_select.trigger("zselectchange")},onProcessPeriodChange:function(obj,scheduleInfo){var outer_layout=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId),process_period=$(obj).val(),process_period_layout=outer_layout.find("div#tssettings_processperiod_layout"),frequency=TimelyZComp.select.getValue(outer_layout.find("#tssettings-frequency"));if(TimelyZComp.select.destroyAll(void 0,process_period_layout.find("#tssettings_processperiod_custom")),process_period_layout.find("#tssettings_processperiod_custom").remove(),("1"===frequency||"2"===frequency)&&"2"===process_period){var custom_period_layout=$('<div id="tssettings_processperiod_custom" class="zpl_secn"><div class="zpl_idiv"><em>'+ZPI18N.getString("zp.from")+'</em><select id="from_day"   data-width="100" disabled></select><em id="from_range_span"></em></div><div class="zpl_idiv"><em>'+ZPI18N.getString("zp.to")+'</em><select id="to_day" data-width="100"></select><em id="to_range_span"></em></div></div>');let from_range_span=" "+ZPI18N.getString("zp.soflastweek"),to_range_span=" "+ZPI18N.getString("zp.sofcurrentweek"),options=Timetracker.DateTime.constructDayOfWeekOptions(!0),process_period_to=outer_layout.find("select#tssettings-dayweek").val()||"0";if("2"==frequency&&(from_range_span=" "+ZPI18N.getString("zp.soflastmonth"),to_range_span=" "+ZPI18N.getString("zp.sofcurrentmonth"),options=Timetracker.DateTime.constructDayOfMonthOptions(32,!0),process_period_to=outer_layout.find("select#tssettings-daymonth").val()||"1"),scheduleInfo&&scheduleInfo.schedulerConf){var conf=JSON.parse(decodeHTML(scheduleInfo.schedulerConf));conf&&void 0!==conf.process_period_to&&(process_period_to=""+conf.process_period_to)}custom_period_layout.find("#from_range_span").text(from_range_span),custom_period_layout.find("#to_range_span").text(to_range_span),process_period_layout.append(custom_period_layout),custom_period_layout=process_period_layout.find("#tssettings_processperiod_custom"),TimelyZComp.select.intialize(custom_period_layout.find("#from_day"),{options:options}),TimelyZComp.select.intialize(custom_period_layout.find("#to_day"),{options:options,selectedValue:process_period_to}),custom_period_layout.find("#to_day").off("zselectchange").on("zselectchange",function(){Timetracker.schedRemindSettings.onProcessPeriodCustomDateChange(this,frequency),Timetracker.schedRemindSettings.tsScheduleSummary(this)}),TimelyZComp.select.setValue(custom_period_layout.find("#to_day"),process_period_to),custom_period_layout.find("#to_day").trigger("zselectchange")}},onProcessPeriodCustomDateChange:function(obj,frequency){var outer_layout=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId),process_period_to=TimelyZComp.select.getValue(outer_layout.find("#"+obj.id)),custom_process_period_layout=outer_layout.find("div#tssettings_processperiod_custom"),process_period_from="6"===process_period_to?"0":""+(parseInt(process_period_to)+1);"2"===frequency&&(process_period_from="31"===process_period_to||"32"===process_period_to?"1":""+(parseInt(process_period_to)+1),custom_process_period_layout.find("#from_range_span").text(" "+ZPI18N.getString("1"===process_period_from?"zp.sofcurrentmonth":"zp.soflastmonth"))),TimelyZComp.select.setValue(custom_process_period_layout.find("#from_day"),process_period_from)},tsScheduleSummary:function(obj){var layout=$(obj).attr("id")&&$(obj).attr("id")===Timetracker.schedulerReminderSettings.tabId?obj:$(obj).closest("#"+Timetracker.schedulerReminderSettings.tabId);if(0!==layout.find("#ts_schedule_summary").length){Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSCHEDULER);var isTSReminder=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER),atTime=TimelyZComp.timeField.getValue(layout.find("#tssettings-time"));if(atTime){var condStatement,hrs=atTime.split(/(\s+)/)[0],ampm=atTime.split(/(\s+)/)[2].toLowerCase(),frequency=(Calendar.timetomins(hrs,0,ampm),TimelyZComp.select.getValue(layout.find("#tssettings-frequency"))),process_period=TimelyZComp.select.getValue(layout.find("#tssettings_processperiod"));process_period=parseInt(process_period);var summary="";if(isTSReminder){let remType=TimelyZComp.select.getValue(layout.find("#tssettings-remindertype")),regexForValidation=Timetracker.util.maxWeekHrsRegex;if("1"==remType){let condition=layout.find("#TS_notifyWhenTLog").find("input:checked").val(),minh=layout.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").val();minh.match(regexForValidation)||(minh="00:00",layout.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").val(minh)),condStatement=0==condition?ZPI18N.getString("zp.notloggedtime"):ZPI18N.getString("zp.loggedlessthan",[minh])+" "+ZPI18N.getString("zp.gracehour")}else{if("42"==remType)return summary=ZPI18N.getString("zp.timercustomreminderhelpnote"),void layout.find("#ts_schedule_summary").html(summary);{let condition=layout.find("#TS_notifyWhenTSheet").find("input:checked").val(),minh=layout.find("#TS_notifyWhenTSheet").find("#timeLimitToNotify").val();minh.match(regexForValidation)||(minh="00:00",layout.find("#TS_notifyWhenTSheet").find("#timeLimitToNotify").val(minh)),condStatement=0==condition?ZPI18N.getString("zp.notsubmittedtimesheet"):ZPI18N.getString("zp.submittedlessthan",[minh])+" "+ZPI18N.getString("zp.hoursforapproval")}}}if("0"===frequency)summary=process_period>1?isTSReminder?ZPI18N.getString("zp.tsreminderdaybeforesummary",[ZPeople.escapeHtml(atTime),condStatement,process_period]):ZPI18N.getString("zp.tsschddaybeforesummary",[process_period,ZPeople.escapeHtml(atTime)]):1===process_period?isTSReminder?ZPI18N.getString("zp.tsreminderdayyestsummary",[ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschdayyestsummary",[ZPeople.escapeHtml(atTime)]):isTSReminder?ZPI18N.getString("zp.tsreminderdaycurrsummary",[ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschdaycurrsummary",[ZPeople.escapeHtml(atTime)]);else if("1"===frequency){let sch_day=TimelyZComp.select.getValue(layout.find("#tssettings-dayweek"));if(sch_day=parseInt(sch_day),0===process_period)summary=isTSReminder?ZPI18N.getString("zp.tsreminderweeklastsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschweeklastsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime)]);else if(1===process_period)summary=isTSReminder?ZPI18N.getString("zp.tsreminderweekcurrsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschweekcurrsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime)]);else if(2===process_period){let process_period_to=0!=layout.find("#tssettings_processperiod_custom").find("#to_day").length?TimelyZComp.select.getValue(layout.find("#tssettings_processperiod_custom").find("#to_day")):null,process_period_from=6===(process_period_to=parseInt(process_period_to))?0:process_period_to+1;summary=isTSReminder?ZPI18N.getString("zp.tsreminderweekcustsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime),condStatement,Timetracker.DateTime.getDayOfWeek(process_period_from),Timetracker.DateTime.getDayOfWeek(process_period_to)]):ZPI18N.getString("zp.tsschweekcustsummary",[Timetracker.DateTime.getDayOfWeek(process_period_from),Timetracker.DateTime.getDayOfWeek(process_period_to),Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime)])}}else if("2"===frequency){let sch_day=TimelyZComp.select.getValue(layout.find("#tssettings-daymonth"));if(sch_day=parseInt(sch_day),0===process_period)summary=isTSReminder?ZPI18N.getString("zp.tsremindermonlastsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschmonlastsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime)]);else if(1===process_period)summary=isTSReminder?ZPI18N.getString("zp.tsremindermoncurrsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschmoncurrsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime)]);else if(2===process_period){let process_period_to=TimelyZComp.select.getValue(layout.find("#tssettings_processperiod_custom").find("#to_day"));var process_period_from=31===(process_period_to=parseInt(process_period_to))||32===process_period_to?1:process_period_to+1;summary=isTSReminder?ZPI18N.getString(31===process_period_to||32===process_period_to?"zp.tsremindermoncustcurrsummary":"zp.tsremindermoncustsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime),condStatement,Timetracker.DateTime.getDayOfMonth(process_period_from,!0),Timetracker.DateTime.getDayOfMonth(process_period_to,!0)]):ZPI18N.getString(31===process_period_to||32===process_period_to?"zp.tsschmoncustcurrsummary":"zp.tsschmoncustsummary",[Timetracker.DateTime.getDayOfMonth(process_period_from,!0),Timetracker.DateTime.getDayOfMonth(process_period_to,!0),Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime)])}}layout.find("#ts_schedule_summary").html("<li><em>"+summary+"</li></em>")}}},updateTimerReminderSettings:function(params){if((!Timetracker.schedulerReminderSettings.editMode||Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE!=Timetracker.schedulerReminderSettings.editData.type)&&Timetracker.schedulerReminderSettings.reminderObj){var isCustomReminderExist=!1;Timetracker.schedulerReminderSettings.reminderObj.forEach(remdObj=>{if(remdObj&&remdObj.type===Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.timercustomremindererrormsg")),void(isCustomReminderExist=!0)})}if(isCustomReminderExist)return Timetracker.util.unfreezeSubmit(void 0,"zp_modal_blubtn",settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId)),void Timetracker.util.removeErrorMsg(void 0,settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId));var isValid=!0;if(Timetracker.schedulerReminderSettings.editMode&&(params.scheduleName===Timetracker.schedulerReminderSettings.editData.scheduleName&&params.type!=Timetracker.schedulerReminderSettings.editData.type&&(isValid=!1),isValid=isValid||Timetracker.schedRemindSettings.returnParamsForRoleDeptDesignationForSchedules(params).isValid),!isValid)return Timetracker.schedRemindSettings.destroyZComp(),ModuleComp.Modal.hide(Timetracker.schedulerReminderSettings.tabId),void Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"));Timetracker.schedulerReminderSettings.reminderObj=null,Timetracker.schedulerReminderSettings.editMode&&(params.mode="modifyAutoSchedule",params.scheduleId=Timetracker.schedulerReminderSettings.editData.scheduleId),params.type=Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE,ZPeople.Request.send(Timetracker.constants.URL,params,function(){var message=Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.remedited"):ZPI18N.getString("zp.remconfig");Timetracker.util.showAlert(2,message),Timetracker.schedRemindSettings.destroyZComp(),ModuleComp.Modal.hide(Timetracker.schedulerReminderSettings.tabId),Timetracker.schedRemindSettings.fetchData()})},updateScheduleSettings:function(){const layout=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId);Timetracker.util.freezeSubmit(void 0,"zp_modal_blubtn",layout),Timetracker.util.removeErrorMsg(void 0,layout);Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.TIMESHEETSCHEDULER);var isTSReminder=Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER),scheduleName=layout.find("#tssettings-schdulename").val(),frequency=TimelyZComp.select.getValue(layout.find("#tssettings-frequency")),dayofweek=TimelyZComp.select.getValue(layout.find("#tssettings-dayweek")),dayofmonth=TimelyZComp.select.getValue(layout.find("#tssettings-daymonth")),time=TimelyZComp.timeField.getValue(layout.find("#tssettings-time")),isError=!1;if(time){var hrs=time.split(/(\s+)/)[0],ampm=time.split(/(\s+)/)[2].toLowerCase();time=Calendar.timetomins(hrs,0,ampm)}else Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#tssettings-time"),msg:ZPI18N.getString("zp.enteravalidtime")}),isError=!0;var billstatus=layout.find("#tssettings-billstatus").val();if(Timetracker.Validations.isEmpty(scheduleName)){let errorStr=ZPI18N.getString("zp.cannotbeempty",[ZPI18N.getString("zp.tt.schedlersettings.schedulename")]);isTSReminder&&(errorStr=ZPI18N.getString("zp.cannotbeempty",[ZPI18N.getString("zp.tt.remaindersettings.reminder.remindername")])),Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#tssettings-schdulename"),msg:errorStr}),isError=!0}var params={mode:"createAutoSchedule",scheduleName:scheduleName,type:Timetracker.schedulerReminderSettings.TIMESHEET_SCHEDULER_TYPE};params.appfor=AppExc.constructAppValues(layout,"#appToSec",["loc","dept","desg","role","group"]);let isEmpty=!0;if($.each(params.appfor,function(ind,param){0!=param.length&&(isEmpty=!1)}),params.appfor=JSON.stringify(params.appfor),isTSReminder&&(params.exceptfor=AppExc.constructAppValues(layout,"#excToSec",["loc","dept","desg","role","group"]),isEmpty&&$.each(params.exceptfor,function(ind,param){0!=param.length&&(isEmpty=!1)}),params.exceptfor=JSON.stringify(params.exceptfor)),isEmpty&&(Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#appToSec").find(".zpl_cndor"),msg:ZPI18N.getString("zp.selectonecri")}),isError=!0),isTSReminder&&TimelyZComp.select.getValue(layout.find("#tssettings-remindertype"))==Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE)return isError?void Timetracker.util.unfreezeSubmit(void 0,"zp_modal_blubtn",layout):void Timetracker.schedRemindSettings.updateTimerReminderSettings(params);params.frequency=frequency,params.time=time&&time.tottime||0,params.billstatus=billstatus;var day,pushConfig={};if(isTSReminder){let div,remindertype=TimelyZComp.select.getValue(layout.find("#tssettings-remindertype"));if(params.type=Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE,"1"===remindertype||1===remindertype?(params.type=Timetracker.schedulerReminderSettings.TIMELOG_REMINDER_TYPE,div=layout.find("#TS_notifyWhenTLog"),pushConfig.notifyCondition=parseInt(div.find("input:checked").val())):(div=layout.find("#TS_notifyWhenTSheet"),pushConfig.notifyCondition=parseInt(div.find("input:checked").val())),1==pushConfig.notifyCondition){pushConfig.minHrsReq=div.find("#timeLimitToNotify").val();let regexForValidation=Timetracker.util.maxWeekHrsRegex;pushConfig.minHrsReq.match(regexForValidation)?pushConfig.minHrsReq=Timetracker.DateTime.convertToMins(pushConfig.minHrsReq):(Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#timeLimitToNotify"),msg:ZPI18N.getString("zp.entervalidinput")}),isError=!0)}pushConfig.isNotifyEmployee=0|layout.find("#notifyToEmp")[0].checked,pushConfig.isNotifyRepMan=0|layout.find("#notifyToReporting")[0].checked;let users=TimelyZComp.tokenField.getValues(layout.find("#notifyToSEmpUsers"));!layout.find("#notifyToSEmp")[0].checked||users&&0!=users.length||(Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#notifyToSEmpUsers"),msg:ZPI18N.getString("zp.local.selectatleastoneemployee")}),isError=!0),pushConfig.notifySpecificUsers=""!=users[0]&&layout.find("#notifyToSEmp")[0].checked?users:[],pushConfig.isNotifyEmployee+pushConfig.isNotifyRepMan+(0|layout.find("#notifyToSEmp")[0].checked)<1&&(layout.find("#notifEmpDiv").parent().append('<div class="ztextbox--error__label">'+ZPI18N.getString("zp.maperror",["options"])+"</div>"),isError=!0),params.pushConfig=JSON.stringify(pushConfig)}if(isError)return Timetracker.genSettings.scrollToFirstErr(layout),Timetracker.util.unfreezeSubmit(void 0,"zp_modal_blubtn",layout),!1;"1"===frequency?day=params.dayofweek=dayofweek:"2"===frequency&&(day=params.dayofmonth=dayofmonth);var process_period_config={},process_period=layout.find("select#tssettings_processperiod").val();if(process_period=parseInt(""+process_period),"0"===frequency)process_period>=0&&process_period<6&&(process_period_config.process_period=process_period);else if("1"===frequency){if(0!==process_period&&1!==process_period&&2!==process_period||(process_period_config.process_period=process_period),2===process_period){var process_period_to=layout.find("div#tssettings_processperiod_custom").find("#to_day").val();(process_period_to=parseInt(""+process_period_to))>=0&&process_period_to<7&&(process_period_config.process_period_to=process_period_to)}}else if("2"===frequency&&(0!==process_period&&1!==process_period&&2!==process_period||(process_period_config.process_period=process_period),2===process_period)){let process_period_to=layout.find("div#tssettings_processperiod_custom").find("#to_day").val();(process_period_to=parseInt(""+process_period_to))>=0&&process_period_to<=32&&(process_period_config.process_period_to=process_period_to)}params.process_period_config=JSON.stringify(process_period_config),Timetracker.schedulerReminderSettings.editMode&&(params.mode="modifyAutoSchedule",params.scheduleId=Timetracker.schedulerReminderSettings.editData.scheduleId);var isValid=!0;if(Timetracker.schedulerReminderSettings.editMode){let schedule_conf=void 0!=Timetracker.schedulerReminderSettings.editData.schedulerConf?JSON.parse(decodeHTML(Timetracker.schedulerReminderSettings.editData.schedulerConf)):{};params.scheduleName!=Timetracker.schedulerReminderSettings.editData.scheduleName||params.frequency!=Timetracker.schedulerReminderSettings.editData.frequency||void 0!==day&&day!=Timetracker.schedulerReminderSettings.editData.day||params.time!=Timetracker.schedulerReminderSettings.editData.time||void 0!=params.billstatus&&params.billstatus!=Timetracker.schedulerReminderSettings.editData.billStatus||params.type!=Timetracker.schedulerReminderSettings.editData.type||schedule_conf.notifyCondition!=pushConfig.notifyCondition||schedule_conf.isNotifyEmployee!=pushConfig.isNotifyEmployee||schedule_conf.isNotifyRepMan!=pushConfig.isNotifyRepMan||!_.isEqual(schedule_conf.notifySpecificUsers,pushConfig.notifySpecificUsers)||schedule_conf.process_period!==process_period_config.process_period||schedule_conf.process_period_to!==process_period_config.process_period_to||(1==pushConfig.notifyCondition?schedule_conf.minHrsReq==pushConfig.minHrsReq&&(isValid=!1):isValid=!1),isValid=isValid||Timetracker.schedRemindSettings.returnParamsForRoleDeptDesignationForSchedules(params).isValid}isValid?(delete params.isValid,isTSReminder?Timetracker.schedulerReminderSettings.reminderObj=null:Timetracker.schedulerReminderSettings.scheduleObj=null,ZPeople.Request.send(Timetracker.constants.URL,params,function(){var message=Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.tt.schedlersettings.schedulereditmsg"):ZPI18N.getString("zp.tt.schedlersettings.scheduleraddedmsg");Timetracker.Util.isCurrentPage(Timetracker.constants.SETTINGS.MODE.REMAINDER)&&(message=Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.tt.schedlersettings.remindereditmsg"):ZPI18N.getString("zp.tt.schedlersettings.reminderaddedmsg")),Timetracker.util.showAlert(2,message),Timetracker.schedRemindSettings.destroyZComp(),ModuleComp.Modal.hide(Timetracker.schedulerReminderSettings.tabId),Timetracker.schedRemindSettings.fetchData()})):(Timetracker.schedRemindSettings.destroyZComp(),ModuleComp.Modal.hide(Timetracker.schedulerReminderSettings.tabId),Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")))},destroyZComp:function(){const modal=settingsPage.container.find("#"+Timetracker.schedulerReminderSettings.tabId);modal.find("select").each(function(){TimelyZComp.select.destroy($(this))}),modal.find('[elemtype="tokenfield"]').each(function(){TimelyZComp.tokenField.destroy($(this))}),modal.find("#appToSec").find("select").each(function(){$(this).parent().remove()});var excDiv=modal.find("#excToSec");excDiv.find("select").each(function(){$(this).parent().remove()}),excDiv.remove()}},Timetracker.otherSettings={init:function(){Timetracker.genSettings.init(),Timetracker.genSettings.permissionCheck()&&(Timetracker.genSettings.removeTopButton(settingsPage.container),Timetracker.otherSettings.constructHtml(),Timetracker.otherSettings.intializeEventListeners(),Timetracker.otherSettings.setData())},intializeEventListeners:function(){Timetracker.genSettings.addEvntLsnrforChange(Timetracker.otherSettings.showHideSaveResetbn)},constructHtml:function(){const pageContainer=settingsPage.container;if(!Timetracker.genSettings.isHtmlConstructed()){var html=`<div class="zpl_rgtcnt">\n\t\t\t\t \t\t<div class="zpl_crd" cardId="ots_ReportsCard"> \n\t\t\t\t       \t\t<div class="zpl_crdhdr"><div><h4>${ZPI18N.getString("zp.tt.othersettings.paypreferences")}</h4><p>${ZPI18N.getString("zp.tt.othersettings.paypreferencesDef")}</p></div>${Timetracker.genSettings.addSaveResetButton("Timetracker.otherSettings.setData(this)","Timetracker.otherSettings.updateData(this)")}</div> \n\t\t\t\t         \t<div class="zpl_crdcnt">\n\t\t\t\t           \t\t<div class="zpl_secn">\n\t\t\t\t                \t<div class="chkdectxt">\n\t\t\t\t                   \t\t<div class="zcheckbox"><input id="ots_paidleave_payroll" type="checkbox" class="zcheckbox__helper"><label for="ots_paidleave_payroll" class="zcheckbox__label">${ZPI18N.getString("zp.tt.othersettings.incudeleavepayroll")}</label></div> \n\t\t\t\t                   \t\t<span class="dectxt">${ZPI18N.getString("zp.tt.othersettings.incudeleavepayrolldesc")}</span>\n\t\t\t\t                  \t</div>\n            \n\t\t\t\t             \t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t<div class="chkdectxt">\n\t\t\t\t\t\t\t\t\t\t<div class="zcheckbox"><input id="ots_isNBlogforPayable" type="checkbox" name="nblogsInPayable" checked="" class="zcheckbox__helper"><label for="ots_isNBlogforPayable" class="zcheckbox__label">${ZPI18N.getString("zp.tt.othersettings.allowndhoursints")}</label></div>\n\t\t\t\t\t\t\t\t\t\t<span class="dectxt">${ZPI18N.getString("zp.tt.othersettings.allowndhoursintsdesc")}</span>\n\t\t\t\t\t\t\t\t\t</div>\n            \t\t\t</div>`;Timetracker.generalSettings.isPayRollPayPeriodFormFiltersHiding()&&(html+=`<div class="chkdectxt">\n\t\t\t                <div class="zcheckbox"><input id="ots_payroll_approvalstatus" type="checkbox" class="zcheckbox__helper"><label for="ots_payroll_approvalstatus" class="zcheckbox__label">${ZPI18N.getString("zp.tt.othersettings.approvalsetting")}</label></div>\n\t\t\t                <span class="dectxt">${ZPI18N.getString("zp.tt.othersettings.approvalsettingdesc")}</span>\n\t\t\t                </div>`),html+=`</div>\n\t\t\t\t\t\t\t         \t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="zpl_crd" cardId="ots_PswdProtectCard">\n\t\t\t\t\t\t\t       \t\t<div class="zpl_crdhdr"><div><h4>${ZPI18N.getString("zp.tt.othersettings.filexport")}</h4><p>${ZPI18N.getString("zp.tt.othersettings.filexportinfo")}</p><div class="zpl_hdcnt"><div class="zpl_tgl"><z-toggleswitch id="ots_export" orientation="String"></z-toggleswitch>${ZPI18N.getString("zp.enablepasswordforexport")}</div></div></div>${Timetracker.genSettings.addSaveResetButton("Timetracker.otherSettings.setData(this)","Timetracker.otherSettings.updateData(this)")}</div> \t\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="zpl_crd" cardId="ots_IntegWithAttCard">\n\t\t\t\t\t\t\t       \t\t<div class="zpl_crdhdr"><div><h4>${ZPI18N.getString("zp.integrations")}</h4><p>${ZPI18N.getString("zp.tt.othersettings.integrationsinfo")}</p></div>${Timetracker.genSettings.addSaveResetButton("Timetracker.otherSettings.setData(this)","Timetracker.otherSettings.updateData(this)")}</div> \n\t\t\t\t\t\t\t         \t<div class="zpl_crdcnt">\n\t\t\t\t\t\t\t             \t<div class="zpl_secn">\n\t\t\t\t\t\t\t                   <div><h5>${ZPI18N.getString("zp.tt.othersettings.attendanceintegrationinfo")}</h5></div>  \n\t\t\t\t\t\t\t               \t   <div>\n\t\t\t\t\t\t\t                   \t  <div class="zcheckbox"><input id="ots_attendance_timer" name="timerpushtoatt" type="checkbox" class="zcheckbox__helper" onclick="Timetracker.otherSettings.disableAttendanceInteg(this,true);" ><label for="ots_attendance_timer" class="zcheckbox__label">${ZPI18N.getString("zp.tt.othersettings.logtimer")}</label></div> \n\t\t\t\t\t\t\t                   \t  <div class="zcheckbox"><input id="ots_attendance_startend" name="fromtotimepushtoatt" type="checkbox" class="zcheckbox__helper" onclick="Timetracker.otherSettings.disableAttendanceInteg(this,true);" ><label for="ots_attendance_startend" class="zcheckbox__label">${ZPI18N.getString("zp.tt.othersettings.logstartandendtime")}</label></div> \n\t\t\t\t\t\t\t                   </div>\n\t\t\t\t\t\t\t             \t</div>\n\t\t\t\t\t\t\t         \t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zpl_crd" cardId="ots_PermissionsCard"> \n\t\t\t\t            <div class="zpl_crdhdr">\n\t\t\t\t              <div><h4>${ZPI18N.getString("zp.tt.othersettings.employeerphpermissions")}</h4><p>${ZPI18N.getString("zp.tt.othersettings.employeerphpermissionsdesc")}</p></div>${Timetracker.genSettings.addSaveResetButton("Timetracker.otherSettings.setData(this)","Timetracker.otherSettings.updateData(this)")}</div> \n\t\t\t\t              <div class="zpl_crdcnt">\n\t\t\t\t              \t <div class="zpl_secn">\n\t\t\t\t                \t<div><h5>${ZPI18N.getString("zp.tt.othersettings.vieweditemprph")}</h5></div>\n\t\t\t\t                \t<div><select id="ots_rphForm" class="select-js zpl_w-50" style="display: none;">\n                 \t\t\t\t\t\t <option value="3">${ZPI18N.getString("zp.tt.othersettings.alluseroption")}</option>\n                  \t\t\t\t\t\t <option value="2">${ZPI18N.getString("zp.tt.othersettings.mysubtoption")}</option>\n                  \t\t\t\t\t\t <option value="0">${ZPI18N.getString("zp.tt.othersettings.adminoption")}</option>\n                \t\t\t\t\t</select></div>\n\t\t\t\t             \t\t<div class="zpl_info"><b>${ZPI18N.getString("zp.note")}:</b> ${ZPI18N.getString("zp.tt.othersettings.pmnote")}; ${ZPI18N.getString("zp.tt.othersettings.phnote")}</div>\n\t\t\t\t             \t</div>\n\t\t\t\t             \t\t</div>\n\t\t\t\t             \t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t        </div>`,pageContainer.html(html)}},setData:function(cardDiv){const settingData=Timetracker.generalSettings.settingDetails,pageContainer=cardDiv&&$(cardDiv).closest(".zpl_crd")||settingsPage.container;var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");cardDivId&&"ots_ReportsCard"!==cardDivId||(pageContainer.find("#ots_paidleave_payroll").prop("checked","1"===settingData.TS_includePaidLeaveInPayroll),pageContainer.find("#ots_isNBlogforPayable").prop("checked","1"===settingData.TS_NonBillableTLforPayableHours),pageContainer.find("#ots_payroll_approvalstatus").prop("checked","1"===settingData.TS_PayrollApprovalFilter_DefaultValue)),cardDivId&&"ots_PswdProtectCard"!==cardDivId||ZPeopleComponents.toggleswitch(pageContainer.find("#ots_export")).setAttribute("on","1"===settingData.TS_isPasswordProtected),cardDivId&&"ots_IntegWithAttCard"!==cardDivId||(pageContainer.find("#ots_attendance_timer").prop("checked","1"===settingData.TS_attendance),pageContainer.find("#ots_attendance_startend").prop("checked","1"===settingData.TS_attendance_startEnd),pageContainer.find("#ots_attendance_timer,#ots_attendance_startend").prop("disabled",!1),pageContainer.find("#ots_attendance_timer,#ots_attendance_startend").parent().removeAttr("title"),Timetracker.otherSettings.disableAttendanceInteg()),cardDivId&&"ots_PermissionsCard"!==cardDivId||TimelyZComp.select.setValue(pageContainer.find("#ots_rphForm"),settingData.TS_formRPHRestriction||"0"),Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING)},updateData:function(cardDiv){var params={mode:"updateTimetrackerSettings",conreqcsr:csrfToken,subMode:Timetracker.constants.SETTINGS.MODE.OTHERSETTINGS};params=Timetracker.otherSettings.getParamsForUpdateSettings(params,Timetracker.generalSettings.settingDetails,cardDiv),Timetracker.util.removeErrorMsg(),null!=params&&(params.fetchUpdatedSetings=!0),null!=params?(Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVING),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){0===response.res?ZPeople.Message.showFailureMsg(response.message?response.message:ZPI18N.getString("zp.ttfailuremsg")):Timetracker.genSettings.updateCache(response),Timetracker.otherSettings.setData(cardDiv),Timetracker.genSettings.showHideSaveReset(cardDiv,0!==response.res?TimelySettings.SHOWSAVED:void 0)},{},Timetracker.Util.generalFailureCallback)):Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"))},getParamsForUpdateSettings:function(params,settingsData,cardDiv){if(cardDiv){const pageContainer=$(cardDiv).closest(".zpl_crd")||settingsPage.container.find(".zpl_crd");var cardDivId=$(cardDiv).closest(".zpl_crd").attr("cardId");switch(Timetracker.util.removeErrorMsg(),cardDivId){case"ots_ReportsCard":params.includePaidLeaveInPayroll=pageContainer.find("#ots_paidleave_payroll").is(":checked")?"1":"0",params.isNonBillLogsforPayable=pageContainer.find("#ots_isNBlogforPayable").is(":checked")?"1":"0",Timetracker.generalSettings.isPayRollPayPeriodFormFiltersHiding()&&(params.payrollApprovalStatus=pageContainer.find("#ots_payroll_approvalstatus").is(":checked")?"1":"0");break;case"ots_PswdProtectCard":params.isPasswordProtected=!0===ZPeopleComponents.toggleswitch(document.getElementById("ots_export")).getState()?"1":"0";break;case"ots_IntegWithAttCard":params.attendanceIntegStartEnd=pageContainer.find("#ots_attendance_startend").is(":checked")?"1":"0",params.attendanceInteg=pageContainer.find("#ots_attendance_timer").is(":checked")?"1":"0";break;case"ots_PermissionsCard":params.rphFormRestriction=TimelyZComp.select.getValue(pageContainer.find("#ots_rphForm"))}if(Timetracker.otherSettings.isSettingValueChanged(params,settingsData,cardDiv))return params}return null},showHideSaveResetbn:function(cardDiv){cardDiv=cardDiv.target||cardDiv,null!==Timetracker.otherSettings.getParamsForUpdateSettings({},Timetracker.generalSettings.settingDetails,cardDiv)?Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWSAVERESET):Timetracker.genSettings.showHideSaveReset(cardDiv,TimelySettings.SHOWNOTHING)},isSettingValueChanged:function(params,settingsData,cardDiv){switch($(cardDiv).closest(".zpl_crd").attr("cardId")){case"ots_ReportsCard":return!(!Timetracker.generalSettings.isPayRollPayPeriodFormFiltersHiding()||void 0===params.payrollApprovalStatus||settingsData.TS_PayrollApprovalFilter_DefaultValue===params.payrollApprovalStatus)||(void 0!==params.includePaidLeaveInPayroll&&settingsData.TS_includePaidLeaveInPayroll!==params.includePaidLeaveInPayroll||settingsData.TS_NonBillableTLforPayableHours!==params.isNonBillLogsforPayable);case"ots_PswdProtectCard":return settingsData.TS_isPasswordProtected!==params.isPasswordProtected;case"ots_IntegWithAttCard":return settingsData.TS_attendance!==params.attendanceInteg||settingsData.TS_attendance_startEnd!==params.attendanceIntegStartEnd;case"ots_PermissionsCard":return void 0!==params.rphFormRestriction&&settingsData.TS_formRPHRestriction!==params.rphFormRestriction}return!1},disableAttendanceInteg:function(obj,isAlertMsgReqd){const pageContainer=obj?$(obj):settingsPage.container.find("[cardId='ots_IntegWithAttCard']");let isTimerPush=!obj||"timerpushtoatt"===$(obj).attr("name"),isFromToTimelogPush=!obj||"fromtotimepushtoatt"===$(obj).attr("name");if(isTimerPush){let disableTimerPushToAtt=!Timetracker.generalSettings.isAutomaticLogAllowed()||Timetracker.generalSettings.isTimelogAttendanceRestrict()||!Timetracker.generalSettings.isTimerAttIntgAllowed()||Timetracker.generalSettings.isTimerAttCheckInRestrict(),timerPushToAttDom=pageContainer.find("#ots_attendance_timer");if(disableTimerPushToAtt){timerPushToAttDom.prop("checked",!1),timerPushToAttDom.prop("disabled",!0);let errmsg="";Timetracker.generalSettings.isTimelogAttendanceRestrict()?errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance5"):Timetracker.generalSettings.isAutomaticLogAllowed()?Timetracker.generalSettings.isTimerAttIntgAllowed()?Timetracker.generalSettings.isTimerAttCheckInRestrict()&&(errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance11")):Timetracker.generalSettings.isTimerAttIntgAllowed("isTimerLogdisabled")?Timetracker.generalSettings.isTimerAttIntgAllowed("isRestrictTLInAttHrs")?Timetracker.generalSettings.isTimerAttIntgAllowed("isRestrictTimerWhenNotCheckIn")||(errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance12")):errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance7"):errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance6"):errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance2"),timerPushToAttDom.parent().attr("title",errmsg),timerPushToAttDom.parent().ztooltip(),isAlertMsgReqd&&Timetracker.util.showAlert(1,ZPI18N.getString(errmsg))}else timerPushToAttDom.prop("disabled",!1),timerPushToAttDom.parent().attr("title","")}if(isFromToTimelogPush){let disableFromToTimePushToAtt=!Timetracker.generalSettings.isFromToTimeLogAllowed()||Timetracker.generalSettings.isTimelogAttendanceRestrict()||!Timetracker.generalSettings.isStartEndAttIntgAllowed()||"2"!==Timetracker.generalSettings.getTimelogOverlapType();var fromtotimePushToAttDom=pageContainer.find("#ots_attendance_startend");if(disableFromToTimePushToAtt){fromtotimePushToAttDom.prop("checked",!1),fromtotimePushToAttDom.prop("disabled",!0);let errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance");Timetracker.generalSettings.isTimelogAttendanceRestrict()?errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance5"):"2"!==Timetracker.generalSettings.getTimelogOverlapType()?errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance3"):Timetracker.generalSettings.isStartEndAttIntgAllowed()||(errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance7"),Timetracker.generalSettings.isStartEndAttIntgAllowed("isStartEndLogdisabled")?Timetracker.generalSettings.isStartEndAttIntgAllowed("isTLOverlapAllowed")||(errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance9")):errmsg=ZPI18N.getString("zp.tt.timelogsettings.disabledattendance8")),fromtotimePushToAttDom.parent().attr("title",errmsg),fromtotimePushToAttDom.parent().ztooltip(),isAlertMsgReqd&&Timetracker.util.showAlert(1,ZPI18N.getString(errmsg))}else fromtotimePushToAttDom.prop("disabled",!1),fromtotimePushToAttDom.parent().attr("title","")}}},Timetracker.Breaks={fireScrollMode:"TIMETRACKER_BREAK",init:function(){Timetracker.generalSettings.isBreakEnabled()&&Timetracker.genSettings.permissionCheck()&&(Attendance.timeFormatIs12hr="hh:mm a"===timeFormat,Timetracker.Breaks.consBreakPage())},consBreakPage:function(){BreakConfig.init()},isTTBreakPage:function(){return-1!==settingsUrlProps.niceUrl.indexOf("timetracker/break")},updateBreakParams:function(reqParams){reqParams.mode="getBreaks"},displayBreakErrorMessages:function(rdata){var modal=settingsPage.container.find("#addBreak"),gBoxId="#autoGBoxErr";if(modal.find("#breakModeMan")[0].checked&&(gBoxId="#manGBoxErr"),rdata.hasOwnProperty("errors")){let errObj=rdata.errors,errCode=void 0!==errObj.errorCode?errObj.errorCode:null,errMsg=void 0!==errObj.errorMsg?errObj.errorMsg:ZPI18N.getString("zp.ttfailuremsg");switch(errCode){case"breakNameEmpty":modal.find("#brkNameErr").show(),modal.find("#breakName").addClass("ztextbox__error");break;case"breakTimeInValid":modal.find("#allowedDuration").next().addClass("ztextbox__error"),modal.find("#allowedDuration").next().next().show();break;case"applicableLocationsEmpty":modal.find("#breakAppTTLocs").next().addClass("ztextbox__error"),modal.find("#breakAppTTLocs").next().next().show();break;case"restTimeError":case"intervalsBreakTimeMismatch":case"intervalsBreakTimeExceeded":case"invalid From and To":case"breakTimeCantBeMoreThan10Hr":$(modal.find(gBoxId)[0]).html(errMsg).show();break;case"manualBreakLimitExceeded":case"autoBreakLimitExceeded":case Timetracker.constants.ERROR_CODES.TAB_DISABLED:case Timetracker.constants.ERROR_CODES.NO_PERM_CODE:ZPeople.Message.showFailureMsg(errMsg);break;case"breakOverlapsBreak":case"sameBreakOverlapped":var ftime=errObj.fromTime,ttime=errObj.toTime;Attendance.Break.iterateAndShowError("breakOverlapsBreak",ftime,ttime),$(modal.find(gBoxId)[0]).html(errMsg).show();break;default:Timetracker.util.showAlert(0,errMsg)}}else Timetracker.util.showAlert(0,errMsg)}};class searchFilter{constructor(obj){this.obj=obj}setSearchProp(prop){$(this.obj).parent().siblings();this.initOpenSearch(),this.initCloseSearch(prop),this.initSearch(prop)}initOpenSearch(){$(this.obj).on("click",function(){var searchBox=$(this).parent().siblings();searchBox.addClass("opn"),searchBox.find("input").focus()})}initCloseSearch(prop){$(this.obj).parent().siblings().find(".PI_cls").on("click",()=>{this.closeSearch(prop)})}closeSearch(prop){var searchBox=$(this.obj).parent().siblings();this.searchRows(prop,""),searchBox.removeClass("opn"),searchBox.find("input").val("")}initSearch(prop){$(this.obj).parent().siblings().find("input").on("keyup",e=>{var searchTxt=$(e.currentTarget).val();(13===e.keyCode||$.inArray(e.keyCode,ZPA_Common.splKeys)<=-1)&&this.searchRows(prop,searchTxt),27==e.keyCode&&(closeSearch(prop),e.preventDefault())})}searchRows(prop,searchTxt){const pageId=$(this.obj).closest(".zpl_rgtcnt").find("[id$='_list']:visible");let rows=pageId.find("tbody").find("tr");if(0==rows.length&&(rows=pageId.find("div.zpl_msplst")),!(rows.length<=0)){var id="",rowText="",desc="",isMatch=!1,isWorkflow=prop.mode==ZP_Automation_Mode.WORKFLOW,isApproval=prop.mode==ZP_Automation_Mode.APPROVAL,isCustomAction=prop.mode==ZP_Automation_Mode.CUSTOMACTION;pageId.find("#nodataImg").remove(),$.each(rows,function(index,row){id=$(row).attr(prop.id),rowText=$(row).find("[name$='_name']").text(),desc=isWorkflow||isApproval?ZPA_Common.DESCOBJLIST[prop.mode][id]:"",$.trim(rowText.toUpperCase()).includes($.trim(searchTxt.toUpperCase()))||void 0!=desc&&desc.toUpperCase().includes(searchTxt.toUpperCase())?($(row).show(),isMatch=!0):$(row).hide()}),isMatch?pageId.find("#nodataImg").remove():pageId.append(ZPUtil.noDataImg("","",isWorkflow?ZPI18N.getString("zp.wfsearchnodata"):isApproval?ZPI18N.getString("zp.apprsearchnodata"):isCustomAction?ZPI18N.getString("zp.casearchnodata"):ZPI18N.getString("zp.nodatafound")))}}}TimetrackerOperations.init=function(){Timetracker.initSetup();var prevDiv=settingsPage.container.siblings(".zpl_fltr_flt");prevDiv.find("[compname='filterDiv']").addClass("zpl_DNI"),prevDiv.removeClass("zpl_fltr_flt")},TimetrackerOperations.Filters={cache:{},searchCache:{},filterId:void 0,constructFilterDiv:async function(filteropt,extraParams){var id=extraParams&&extraParams.id?extraParams.id:"filterDiv",fHtml='<div class="zpl_fltr zpl_DNI" id="'+id+'" filterClassDivId="'+(extraParams&&extraParams.filterClassDivId?extraParams.filterClassDivId:"")+'" compname="filterDiv" style="bottom: 0px;">';fHtml+='<div> <div class="zpl_fltrhd"> <h5>'+ZPI18N.getString("zp.filter")+'</h5> <i class="PI_cls" title="'+ZPI18N.getString("zp.close")+'" onclick="TimetrackerOperations.Filters.toggleFilter(\''+id+"');\"></i> </div>",fHtml+='</div><div class="zpl_fltrcnt"><div> ',fHtml+='<div class="zpl_fltclps fltopn sel_postion" style="position: relative;"><div class="zpl_fltrlst">',filteropt&&$.each(filteropt,function(key,value){fHtml+='<div class="zpl_secn">',value.label&&(fHtml+="<div> <label>"+value.label+"</label> </div>"),void 0==value.type?-1!=key.indexOf("employee")?value.tokenField?fHtml+='<div><textarea compname="'+key+'" id="'+(value.id?value.id:"")+'" type="tokenField"></textarea><span class="ztextbox--error__label zpl_DNI"></span> </div>':fHtml+='<div><select class="select-js" compname="'+key+'"'+(value.single?" ":"multiple")+' searchmode="'+(value.searchmode?value.searchmode:"")+'" id="'+(value.id?value.id:"")+'"></select><span class="ztextbox--error__label zpl_DNI"></span> </div>':value.tokenField?(fHtml+='<div><textarea compname="'+key+'" type="tokenField" '+(value.load?"load="+value.load:"")+' id="'+(value.id?value.id:"")+'" '+(value.attr?value.attr:"")+" >",fHtml+='</textarea><span class="ztextbox--error__label zpl_DNI"></span> </div>'):(fHtml+='<div><select class="select-js" compname="'+key+'"'+(value.single?" ":"multiple")+" "+(value.load?"load="+value.load:"")+' id="'+(value.id?value.id:"")+'">',fHtml+='</select><span class="ztextbox--error__label zpl_DNI"></span> </div>'):"input"==value.type?fHtml+='<div> <input class="'+(value.className?value.className:"")+'" compname='+key+" "+(value.disabled?"disabled":"")+' id="'+(value.id?value.id:"")+'"></div>':"checkbox"==value.type&&(fHtml+='<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" compname="'+key+'" '+(value.checked?"checked":"")+' value="" class="zcheckbox__helper" id="'+(value.id?value.id:"")+'"><label class="zcheckbox__label">'+value.checkLabel+"</label></div>"),fHtml+=" </div>"}),fHtml+="</div> </div> ",fHtml+="</div> </div> ",fHtml+='<div id="filter_footer">',fHtml+='<button compname="applyFilter" type="button" class="zlabel zlabel--blue zlabel--medium" ref="applyFilter">'+ZPI18N.getString("zp.apply")+"</button>",fHtml+='<button compname="resetFilter"  type="button" class="zlabel zlabel--outline zlabel--medium" ref="resetFilter">'+ZPI18N.getString("zp.reset")+"</button>",fHtml+="</div></div>";var divId=extraParams&&extraParams.filterDivId?extraParams.filterDivId:void 0;divId&&0!=settingsPage.container.find("#"+divId).length?settingsPage.container.find("#"+divId).append(fHtml):settingsPage.container.append(fHtml),await TimetrackerOperations.Filters.loadDataAndSetDefFilVal(filteropt,id)},getFilterDiv:function(divId){return void 0!=divId?settingsPage.container.find("#"+divId):settingsPage.container.find("#filterDiv")},toggleFilter:function(divId){var filterDiv=TimetrackerOperations.Filters.getFilterDiv(divId),filterClassDivId=filterDiv.attr("filterClassDivId"),filterClassDiv=filterClassDivId?settingsPage.container.find("#"+filterClassDivId):settingsPage.container;filterDiv.length>0?filterDiv.hasClass("zpl_DNI")?(filterDiv.removeClass("zpl_DNI"),filterClassDiv.addClass("zpl_fltr_flt")):(filterDiv.addClass("zpl_DNI"),filterClassDiv.removeClass("zpl_fltr_flt")):filterClassDiv.removeClass("zpl_fltr_flt")},openFilter:function(divId){TimetrackerOperations.Filters.isFilterOpen(divId)||TimetrackerOperations.Filters.toggleFilter(divId)},isFilterOpen:function(divId){var filterDiv=TimetrackerOperations.Filters.getFilterDiv(divId);return settingsPage.container.hasClass("zpl_fltr_flt")||0!=filterDiv.length&&!filterDiv.hasClass("zpl_DNI")},loadDataAndSetDefFilVal:async function(filteropt,divId){filteropt.hasOwnProperty("department")?(await TimetrackerOperations.Filters.getCommonData(),TimetrackerOperations.Filters.setDefFilVal(filteropt,divId)):TimetrackerOperations.Filters.setDefFilVal(filteropt,divId)},setDefFilVal:function(filteropt,divId){var filterDiv=TimetrackerOperations.Filters.getFilterDiv(divId);filterDiv.data("data",filteropt),filteropt&&$.each(filteropt,function(key,value){var ele=filterDiv.find("[compname="+key+"]"),details={};if(details.element=ele,-1!=["employee","assignedto","projectManager","projectHead"].indexOf(key)){var initalSelection,extraDtls={submode:"TIMETRACKER_DATA"};value.currentUser&&(extraDtls.initCurrentUser=!0),value.extraParams&&(extraDtls.extraParams=value.extraParams),value.filterCallback&&(extraDtls.changeCallback=TimetrackerOperations.Filters.filterOnChangeCallback),value.defaultOptionNeeded&&(extraDtls.defaultOptionNeeded=!0),value.initalSelection&&(initalSelection=value.initalSelection),extraDtls.pModal=ele.parents(".sel_postion").length>0?ele.parents(".sel_postion"):void 0;var pageMode=Timetracker.Page.getPageMode(),customAdmin=void 0;"ts_operations"==pageMode&&(customAdmin=Timetracker.constants.TTCustomAdmin.EntryView),"ts_operations"!=pageMode&&"ts_team"!=pageMode||("ts_operations"==pageMode&&Timetracker.Page.Timesheet.isListView()?extraDtls.extraParams={employeeStatusarr:["18","-2","19"]}:extraDtls.projectManagerPerm=!0),value.tokenField?(extraDtls.inpFormat="token",extraDtls.maxAllowedValues=10,Timetracker.Search.populateZCompUsers(value.id,initalSelection,extraDtls,!value.single,void 0,customAdmin)):Timetracker.Search.populateZCompUsers(value.id,initalSelection,extraDtls,!value.single,void 0,customAdmin)}else if("client"==key)details.key=key,details.mapping={value:"clientId",label:"clientName"},details.placeholder=ZPI18N.getString("zp.AllOrgStructureElements",[ZPeople.decodeTxt(Timetracker.util.getClientDisplayName())]),details.tokenField=value.tokenField,void 0!=divId&&(details.extraDtls={filterDiv:filterDiv}),TimetrackerOperations.Filters.constructTTFormFilters(details);else if("project"==key)details.key=key,details.mapping={value:"projectId",label:"projectName"},details.placeholder=ZPI18N.getString("zp.AllOrgStructureElements",[ZPeople.decodeTxt(Timetracker.util.getProjectDisplayName())]),details.tokenField=value.tokenField,void 0!=divId&&(details.extraDtls={filterDiv:filterDiv}),TimetrackerOperations.Filters.constructTTFormFilters(details);else if("job"==key)details.key=key,details.mapping={value:"jobId",label:"jobName"},details.placeholder=ZPI18N.getString("zp.AllOrgStructureElements",[ZPeople.decodeTxt(Timetracker.util.getJobDisplayName())]),details.tokenField=value.tokenField,void 0!=divId&&(details.extraDtls={filterDiv:filterDiv}),TimetrackerOperations.Filters.constructTTFormFilters(details);else if("jobName"==key||"projectName"==key)options=[{label:ZPI18N.getString("zp.all"),value:0},{label:ZPI18N.getString("zp.is"),value:1},{label:ZPI18N.getString("zp.isnot"),value:2},{label:ZPI18N.getString("zp.StartsWith"),value:3},{label:ZPI18N.getString("zp.endswith"),value:4},{label:ZPI18N.getString("zp.contains"),value:5},{label:ZPI18N.getString("zp.notcontains"),value:6}],details.data=options,details.defaultOpt=0,TimetrackerOperations.Filters.createSelectFieldComponent(details),ele.on("zselectchange",function(event){var value=ZPeopleComponents.select(ele).getValue(),nameInput=filterDiv.find("[compname="+key+"Input]");nameInput.removeClass("ztextbox__error"),nameInput.siblings().remove(),0==value?nameInput.addClass("zpl_DNI"):nameInput.removeClass("zpl_DNI")});else if("status"==key)options=[{label:ZPI18N.getString("zp.all"),value:-1},{label:ZPI18N.getString("zp.inprogress"),value:0},{label:ZPI18N.getString("zp.completed"),value:1}],details.data=options,details.defaultOpt=0,TimetrackerOperations.Filters.createSelectFieldComponent(details);else if("pubStatus"==key)options=[{label:ZPI18N.getString("zp.all"),value:0},{label:ZPI18N.getString("zp.published"),value:1},{label:ZPI18N.getString("zp.unpublished"),value:2}],details.data=options,details.defaultOpt=0,TimetrackerOperations.Filters.createSelectFieldComponent(details);else if("billableStatus"==key)options=[{label:ZPI18N.getString("zp.all"),value:-1},{label:ZPI18N.getString("zp.billable"),value:0},{label:ZPI18N.getString("zp.nonbillable"),value:1}],details.data=options,details.defaultOpt=-1,TimetrackerOperations.Filters.createSelectFieldComponent(details);else if("approvalStatus"==key)options=[{label:ZPI18N.getString("zp.all"),value:0},{label:ZPI18N.getString("zp.approved"),value:1},{label:ZPI18N.getString("zp.unapproved"),value:2}],details.data=options,details.defaultOpt=0,TimetrackerOperations.Filters.createSelectFieldComponent(details);else if("tsapprovalStatus"==key)options=[{label:ZPI18N.getString("zp.all"),value:-3},{label:ZPI18N.getString("zp.draft"),value:-2},{label:ZPI18N.getString("zp.pending"),value:-1},{label:ZPI18N.getString("zp.approved"),value:1},{label:ZPI18N.getString("zp.rejected"),value:0}],details.data=options,details.defaultOpt=0,TimetrackerOperations.Filters.createSelectFieldComponent(details);else if("period"==key)options=[{label:ZPI18N.getString("zp.today"),value:0},{label:ZPI18N.getString("zp.thisweek"),value:1},{label:ZPI18N.getString("zp.tt_thismonth"),value:2},{label:ZPI18N.getString("zp.yesterday"),value:3},{label:ZPI18N.getString("zp.lastweek"),value:4},{label:ZPI18N.getString("zp.lastmonth"),value:5},{label:ZPI18N.getString("zp.custom"),value:6}],details.data=options,details.defaultOpt=0,TimetrackerOperations.Filters.createSelectFieldComponent(details);else if("employeeStatus"==key)options=[{label:ZPI18N.getString("zp.activeusers"),value:19},{label:ZPI18N.getString("zp.activeprofiles"),value:-2},{label:ZPI18N.getString("zp.exemployees"),value:18},{label:ZPI18N.getString("zp.logindisabledemp"),value:17}],details.data=options,details.placeholder=ZPI18N.getString("zp.userandemployeeprofile"),details.tokenField=value.tokenField,details.dataMapping={value:"value",label:"label"},TimetrackerOperations.Filters.createSelectFieldComponent(details),ele.on("ztokenfieldchange",function(event){let employeeStatusarr=TimelyZComp.tokenField.getValues(ele);employeeStatusarr&&0!=employeeStatusarr.length||(employeeStatusarr=["18","-2","19"]);let json=ModuleComp.Search.Configuration.getJSON();json.extraparam&&json.extraparam.employeeStatusarr&&(json.extraparam.employeeStatusarr=employeeStatusarr,ModuleComp.Search.Configuration.setJSON(json)),ModuleComp.Search.reset(json,!0),ZPeopleComponents.tokenfield(filterDiv.find("[compname=employee]")).refresh()});else if("department"==key){if(0==Timetracker.Department.dept_List.length)return void ele.closest(".zpl_secn").addClass("zpl_DNI");details.placeholder=ZPI18N.getString("zp.alldepartment"),details.data=Timetracker.Department.dept_List,details.tokenField=value.tokenField,details.dataMapping={value:"dept_ID",label:"dept_Name"},details.search={by:"dept_Name"},TimetrackerOperations.Filters.createSelectFieldComponent(details)}else if("location"==key){if(0==Timetracker.Location.loc_List.length)return void ele.closest(".zpl_secn").addClass("zpl_DNI");details.placeholder=ZPI18N.getString("zp.alllocaction"),details.data=Timetracker.Location.loc_List,details.tokenField=value.tokenField,details.dataMapping={value:"locationId",label:"locationName"},details.search={by:"locationName"},TimetrackerOperations.Filters.createSelectFieldComponent(details)}else if("orgTag"==key){if(!Timetracker.generalSettings.isOrgTagEnabled()||0===Timetracker.organizationTags.orgTagList.length)return void ele.closest(".zpl_secn").addClass("zpl_DNI");details.placeholder=ZPI18N.getString("zp.orgTag"),details.data=Timetracker.organizationTags.orgTagList,details.tokenField=value.tokenField,details.dataMapping={value:"ORGANIZATION_TAG_ID",label:"NAME"},details.search={by:"NAME"},TimetrackerOperations.Filters.createSelectFieldComponent(details)}else if("designation"==key){if(0==Timetracker.Designation.desg_List.length)return void ele.closest(".zpl_secn").addClass("zpl_DNI");details.placeholder=ZPI18N.getString("zp.alldesignation"),details.data=Timetracker.Designation.desg_List,details.tokenField=value.tokenField,details.dataMapping={value:"desg_ID",label:"desg_Name"},details.search={by:"desg_Name"},TimetrackerOperations.Filters.createSelectFieldComponent(details)}else if("legalEntity"==key){if(0==Timetracker.LegalEntity.legalEntityList.length)return void ele.closest(".zpl_secn").addClass("zpl_DNI");details.placeholder=ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(ZPeople.orgStructureDispNameMap.entity),details.data=Timetracker.LegalEntity.legalEntityList,details.tokenField=value.tokenField,details.dataMapping={value:"EntityID",label:"Name"},details.search={by:"Name"},TimetrackerOperations.Filters.createSelectFieldComponent(details)}else if("businessUnit"==key){if(0==Timetracker.BusinessUnit.businessUnitList.length)return void ele.closest(".zpl_secn").addClass("zpl_DNI");details.placeholder=ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(ZPeople.orgStructureDispNameMap.unit),details.data=Timetracker.BusinessUnit.businessUnitList,details.tokenField=value.tokenField,details.dataMapping={value:"UnitID",label:"Name"},details.search={by:"Name"},TimetrackerOperations.Filters.createSelectFieldComponent(details)}else if("division"==key){if(0==Timetracker.Division.divisionList.length)return void ele.closest(".zpl_secn").addClass("zpl_DNI");details.placeholder=ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(ZPeople.orgStructureDispNameMap.division),details.data=Timetracker.Division.divisionList,details.tokenField=value.tokenField,details.dataMapping={value:"DivisionID",label:"Name"},details.search={by:"Name"},TimetrackerOperations.Filters.createSelectFieldComponent(details)}else value.details?($.extend(details,value.details),TimetrackerOperations.Filters.createSelectFieldComponent(details)):value.tokenField&&(details.tokenField=value.tokenField,details.data=[],details.dataMapping={value:"value",label:"label"},details.search={by:"label"},TimetrackerOperations.Filters.createSelectFieldComponent(details))}),$(filterDiv.find(".zcheckbox")).on("click",function(){let swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"))})},getCommonData:async function(){var params={};if(Timetracker.Department.dept_List.load&&(params.deptfetch=!0),Timetracker.Designation.desg_List.load&&(params.desgfetch=!0),Timetracker.Location.loc_List.load&&(params.locfetch=!0),Timetracker.generalSettings.isOrgTagEnabled()&&Timetracker.organizationTags.reports_orgTagList.refresh&&(params.fecthOrgTags=!0),isOrgStructureEnabled&&(Timetracker.Division.divisionList.refresh&&(params.fetchDivisions=!0),Timetracker.BusinessUnit.businessUnitList.refresh&&(params.fetchBusinessUnits=!0),Timetracker.LegalEntity.legalEntityList.refresh&&(params.fetchLegalEntities=!0)),Object.keys(params).length>0){Timetracker.isTTCustomAdminForAny()&&(params.submode=Timetracker.constants.Perm.DATA),params.mode="getDeptAndLocList",params.conreqcsr=csrfToken;var[response]=await ZPeople.Request.sendRequestAsPromise(Timetracker.constants.URL,params);Timetracker.Filters.setCacheForFilterValues(response,params)}},createSelectFieldComponent:function(details){var mapping=details.dataMapping?details.dataMapping:{label:"label",value:"value"},ele=details.element;details.tokenField&&(mapping={value:mapping.value,text:mapping.label,id:mapping.value,informativeText:mapping.label,titleText:mapping.label});var options={options:details.data,contentType:"text",dataMapping:mapping,allowDuplicateValues:!1,sort:!1,placeholder:void 0!=details.placeholder?details.placeholder:ZPI18N.getString("zp.select"),search:{showNoResultsMessage:!0},messages:{noResults:ZPI18N.getString("zp.nomatchesfound")},dropdownList:{isTextHTMLEncoded:!0,itemType:"checkbox",appendTo:ele.parents(".sel_postion").length>0?ele.parents(".sel_postion"):void 0,fitForElement:!0}};if(details.search?(options.search=details.search,options.search.showNoResultsMessage=!0):options.showSearchField=!1,details.maxAllowedValues&&(options.maxAllowedValues=details.maxAllowedValues),details.tokenField){let tokenObj={contentType:"text"};options.tokens=tokenObj,options.allowDuplicateValues=!1,options.data=details.data,options.maxAllowedValues=10,options.dropdownList={isTextHTMLEncoded:!0,closeOnSelect:!1,hideItemOnSelect:!0,appendTo:ele.parents(".sel_postion").length>0?ele.parents(".sel_postion"):void 0,fitForElement:!0},options.isLabelHTMLEncoded=!0,TimelyZComp.tokenField.intialize(ele,options)}else selectComp=ZPeopleComponents.select(ele,options),void 0!=details.defaultOpt&&selectComp.setValue(details.defaultOpt)},constructTTFormFilters:function(details){var key=details.key,ele=details.element,placeholder=details.placeholder?details.placeholder:ZPI18N.getString("zp.all"),mapping=details.mapping?details.mapping:{label:"text",value:"id"};details.tokenField&&(mapping={value:mapping.value,text:mapping.label,id:mapping.value,informativeText:mapping.label,titleText:mapping.label});var callback=details.callback?details.callback:TimetrackerOperations.Filters.filterOnChangeCallback;let props={dataSource:{search:function(params){return new Promise(async function(search,reject){params.query,params.pages;var data={isFromOperations:!0};data.entity=key,data.extraDtls=details.extraDtls;var count=(params.pages-1)*Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,options=await TimetrackerOperations.Filters.getOptionsForFilter(data,params.query,count);respObj={results:options,more:25==options.length},search(respObj)})},paginated:!0},search:{searchIncrementsInCache:!1,showNoResultsMessage:!0},isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0,appendTo:ele.parents(".sel_postion").length>0?ele.parents(".sel_postion"):void 0,fitForElement:!0},serverSearch:!0,cacheData:!1,lazyLoading:!0,showSearchField:!0,placeholder:placeholder,messages:{noResults:ZPI18N.getString("zp.nomatchesfound")},viewPerPage:25,dataMapping:mapping};if(details.tokenField){let tokenObj={contentType:"text"};props.tokens=tokenObj,props.tokenremove=callback,props.tokenadd=callback,props.allowDuplicateValues=!1,props.dropdownList={isTextHTMLEncoded:!0,closeOnSelect:!1,hideItemOnSelect:!0,appendTo:ele.parents(".sel_postion").length>0?ele.parents(".sel_postion"):void 0,fitForElement:!0},props.maxAllowedValues=10,TimelyZComp.tokenField.intialize(ele,props)}else props.change=callback,ZPeopleComponents.select(ele,props)},addOption:function(keyDiv,options){ZPeopleComponents.select(keyDiv).addOption(options)},getFilterValues:function(params,divId){var filterDiv=TimetrackerOperations.Filters.getFilterDiv(divId),filterData=filterDiv.data("data");filterData&&$.each(filterData,function(key,data){if(data.paramId)if(keyDiv=filterDiv.find('[compname="'+key+'"]'),void 0==data.type){var isMultiple=keyDiv[0].hasAttribute("multiple");if(data.tokenField)params[data.paramId]=TimetrackerOperations.Filters.gettokenFieldValues(keyDiv);else if(isMultiple){var values=ZPeopleComponents.select(keyDiv).getValues();values&&values.length>0?params[data.paramId]=values.join():params[data.paramId]="0"}else{var value=ZPeopleComponents.select(keyDiv).getValue();(value||""!=value)&&(params[data.paramId]=value)}}else if("input"==data.type){let value=keyDiv.val();"searchJobName"!==data.paramId&&"searchProjectName"!==data.paramId||value&&value.length>255&&(value=value.substring(0,255)),params[data.paramId]=value}else"checkbox"==data.type&&(params[data.paramId]=keyDiv.prop("checked"))})},getSelectFilterValues:function(keyDiv){if(keyDiv[0].hasAttribute("multiple"))return values=ZPeopleComponents.select(keyDiv).getValues(value),values&&values.length>0?values.join():"0";var value=ZPeopleComponents.select(keyDiv).getValue();return value||""!=value?value:void 0},gettokenFieldValues:function(keyDiv){var values=TimelyZComp.tokenField.getValues(keyDiv);return values&&values.length>0?values.join():"0"},filterHeaderHtml:'<div class="zpl_fltrvw timetracker zpl_DNI" id="tt_filterResultsHeader"><div><ul class="zpl_fltrvwlst" id="filterResults"></ul></div><div class="d-flexcap MLauto"><a class="zpl_link" id="clearFilterResults">'+ZPI18N.getString("zp.reset")+"</a></div></div>",getFilterValuesForHeader:function(divId){var resData=[],filterDiv=TimetrackerOperations.Filters.getFilterDiv(divId),filterData=filterDiv.data("data");return filterData&&$.each(filterData,function(key,data){var resObj={};if((data.paramId||"checkbox"==data.type||1==data.showHeader)&&0!=data.showHeader){resObj.key=key,resObj.label=data.label;if(keyDiv=filterDiv.find('[compname="'+key+'"]'),void 0==data.type)if(data.tokenField){if(dataArray=ZPeopleComponents.tokenfield(keyDiv).getAllValues(),0==dataArray.length)return;resObj.val=dataArray[0].decodedItemText;var addOpt=[];$.each(dataArray,function(ind,obj){0!=ind&&addOpt.push({name:obj.decodedItemText})}),0!=addOpt.length&&(resObj.moreOpt=addOpt,resObj.count=addOpt.length)}else{var value=ZPeopleComponents.select(keyDiv).getValue();if(void 0!=data.defValue&data.defValue==value)return;ZPeopleComponents.select(keyDiv).getOptions().forEach(function(currOption){currOption.value===value&&(resObj.val=currOption.label)})}else if("checkbox"==data.type){value=$(keyDiv).is(":checked");if(void 0!=data.defValue&data.defValue==value)return;resObj.label=data.checkLabel,resObj.val=1==value?ZPI18N.getString("zp.yes"):ZPI18N.getString("zp.no")}resData.push(resObj)}}),resData},setFilterHeader:function(removeCallback,filterDivId,container){var layout=void 0==container?settingsPage.container.find("#tt_filterResultsHeader.timetracker"):container.find("#tt_filterResultsHeader.timetracker"),resData=TimetrackerOperations.Filters.getFilterValuesForHeader(filterDivId);if(layout.find('[comp="menu"]').each(function(){var id=$(this).attr("buttonId");ZPeopleComponents.isComponent("#"+id+"_opt")&&ZPeopleComponents.menu("#"+id+"_opt").destroy()}),layout.find("#filterResults").html(""),0!=resData.length){layout.removeClass("zpl_DNI"),layout.show();var onClickeve=void 0!=filterDivId?"TimetrackerOperations.Filters.openFilterField(this, '"+filterDivId+"');":"TimetrackerOperations.Filters.openFilterField(this);";$.each(resData,function(index,data){resultHtml='<li filterno="'+data.key+'"><label class="zpl_ellipsis200" onclick="'+onClickeve+'">'+data.label+'&nbsp;:&nbsp;</label><span title="'+data.val+'" onclick="'+onClickeve+'">'+data.val+"</span>",data.moreOpt&&(resultHtml+='<sub id="'+data.key+'_optBtn" buttonId="'+data.key+'" comp="menu" onclick="TimetrackerOperations.Filters.constructHeaderOptList(this)">+ '+data.count+"</sub>"),resultHtml+='<a class="PI_cls" id="viewFilterResultsClose"></a></li>',resultHtml=$(resultHtml),resultHtml.data("OptionData",data);var pageWidth=layout.outerWidth(),clearBtnWidth=layout.find("#clearFilterResults").outerWidth()+500;if(0==layout.find('[filterno="jobName"]').length&&0==layout.find('[filterno="projectName"]').length||(clearBtnWidth+=100),layout.find("#filterResults").outerWidth()+clearBtnWidth<pageWidth)layout.find("#filterResults").append(resultHtml);else if(0==layout.find("#filterresultsmore").length)return layout.find("#filterResults").append('<li id="filterresultsmore" class="zpl_mre zpl_drpdwn-js" onclick="'+onClickeve+'"><i id="showsearch"class="PI_more d-flex"></i></li>'),!1}),layout.find("[type='moreOpt']").off().on("click",event=>{TimetrackerOperations.Filters.constructHeaderOptList(event.target)}),"function"==typeof removeCallback&&(layout.find("#filterResults").find("[id=viewFilterResultsClose]").on("click",event=>{layout.siblings('[comp="menu"]').each(function(){var id=$(this).attr("buttonId");ZPeopleComponents.isComponent("#"+id+"_opt")&&ZPeopleComponents.menu("#"+id+"_opt").destroy()}),removeCallback(event)}),layout.find("#clearFilterResults").off().on("click",event=>{layout.find('[comp="menu"]').each(function(){var id=$(this).attr("buttonId");ZPeopleComponents.isComponent("#"+id+"_opt")&&ZPeopleComponents.menu("#"+id+"_opt").destroy()}),removeCallback(event,!0)}))}else layout.addClass("zpl_DNI")},constructHeaderOptList:function(ele){var data=$(ele).closest("li").data("OptionData");data&&(data.menuCreated||(TimetrackerOperations.Filters.constructMoreOption(data.moreOpt,data.key+"_opt"),ZPeopleComponents.menu("#"+data.key+"_opt").show(),data.menuCreated=!0))},constructMoreOption:function(moreopt,Id,forElementId,isCustomView,extraDtls){if(moreopt.length>0){var container,mhtml='<div id="'+Id+'" class="zpl_drpdwn zmenu zpl_fltrvwlst" data-type="list" ';mhtml+=' role="menu"><ul data-body="true" class="zmenu__body">',$.each(moreopt,function(indx,value){mhtml+='<li id="'+value.id+'" class="zmenu__item" data-action="'+value.callback+'"><span class="zmenu__text">'+value.name+"</span></li>"}),mhtml+="</ul></div>",isCustomView?container=Timetracker.Util.getLayout():(container=Timetracker.Util.getLayout(),forElementId=Id+"Btn"),container.find("#"+Id).remove(),container.append(mhtml),ZPeopleComponents.menu("#"+Id,{forElement:"#"+forElementId,appendTo:Timetracker.Util.getLayout()}),container.find("#"+forElementId).off().on("click",()=>{ZPeopleComponents.menu("#"+Id).show()}),extraDtls&&extraDtls.direction&&ZPeopleComponents.menu(container.find("#"+Id)).setAttribute("direction",extraDtls.direction),extraDtls&&extraDtls.title&&settingsPage.container.find("#"+forElementId).attr("title",extraDtls.title)}},clearFilters:function(divId){var filterDiv=TimetrackerOperations.Filters.getFilterDiv(divId),data=filterDiv.data("data");data&&$.each(data,function(key,value){void 0==value.type?value.tokenField?TimelyZComp.tokenField.removeAllTokens(filterDiv.find('[compname="'+key+'"]')):ZPeopleComponents.select(filterDiv.find('[compname="'+key+'"]')).deselectAllOptions():"input"==value.type?filterDiv.find('[compname="'+key+'"]').val(""):"checkbox"==value.type&&filterDiv.find('[compname="'+key+'"]').prop("checked",!1)})},openFilterField:function(ele,divId){var filterDiv=TimetrackerOperations.Filters.getFilterDiv(divId),entity=$(ele).closest("li").attr("filterno");TimetrackerOperations.Filters.openFilter(divId),0!=filterDiv.find('[compname="'+entity+'"]').length&&filterDiv.find('[compname="'+entity+'"]').parent().parent().get(0).scrollIntoView({behavior:"smooth"})},getAdditionalParams:function(data,params){var extraDtls=data.extraDtls?data.extraDtls:{};if("client"===data.entity||"project"===data.entity||"job"===data.entity){var values,userErecNo="0",clientId="0",projectId="0",pageMode=Timetracker.Page.getPageMode();"ts_mydata"==pageMode?userErecNo=erecno:Timetracker.Page.isSelectedUser(pageMode)&&(userErecNo=Timetracker.Team.getSelectedUser());var filterDiv=extraDtls.filterDiv?extraDtls.filterDiv:TimetrackerOperations.Filters.getFilterDiv();if(0==filterDiv.length&&(filterDiv=settingsPage.container.find(".zpl_mdl").find("#filterDiv")),data.container&&(filterDiv=data.container),0!=filterDiv.find("[compname=employee]").length&&filterDiv.find("[compname=employee]").parent().parent().is(":visible")){var empFitler=filterDiv.find("[compname=employee]");(values="tokenField"==empFitler.attr("type")?TimetrackerOperations.Filters.gettokenFieldValues(empFitler):TimetrackerOperations.Filters.getSelectFilterValues(empFitler))&&values.length>0&&(userErecNo=values)}else extraDtls.userErecNo&&(userErecNo=extraDtls.userErecNo);if("client"===data.entity)"0"!==userErecNo&&(params.assignedTo=userErecNo);else if("project"===data.entity||"job"===data.entity){var clientFilter=filterDiv.find('[compname="client"]');if(0!=clientFilter.length)if("tokenField"==clientFilter.attr("type"))clientId=TimetrackerOperations.Filters.gettokenFieldValues(clientFilter);else{var clientFitlerComp=ZPeopleComponents.select(clientFilter);if(clientFitlerComp.multiple)(values=clientFitlerComp.getValues())&&values.length>0&&(clientId=values.join());else{var cid=clientFitlerComp.getValue();cid&&(clientId=cid)}}if("project"===data.entity)params.proAssignedTo=userErecNo,params.clientId=clientId;else if("job"===data.entity){var projectFilter=filterDiv.find('[compname="project"]');"tokenField"==projectFilter.attr("type")?projectId=TimetrackerOperations.Filters.gettokenFieldValues(projectFilter):(values=ZPeopleComponents.select(projectFilter).getValues())&&values.length>0&&(projectId=values.join()),params.erecno=userErecNo,"0"!==clientId&&(params.clientId=clientId),params.projectId=projectId}}}return params},filterOnChangeCallback:function(event){var entity,filterId;null==event||"string"==typeof event?entity=this.ele.attr("compname"):(entity=$(event.target).attr("compname"),filterId=$(event.target).closest(".zpl_fltr").attr("id"));var filterDiv,container=TimetrackerOperations.Filters.getFilterDiv(filterId);switch(0==container.length&&(container=settingsPage.container.find(".zpl_mdl").find("#filterDiv")),entity){case"employee":var values=[];if("tokenField"==(filterDiv=container.find('[compname="employee"]')).attr("type"))values=TimelyZComp.tokenField.getValues(container.find('[compname="employee"]'));else{var keydiv=container.find('[compname="employee"]');0!=keydiv.length&&(values=TimelyZComp.select.getValue(keydiv,keydiv[0].hasAttribute("multiple")))}var sub_input=container.find('[compname="directReportees"]'),dataSel=settingsPage.container.find('[compname="dataSelect"]');if(values&&0===values.length&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?(sub_input.closest(".zpl_secn").removeClass("zpl_DNI"),dataSel.removeClass("zpl_DNI")):(sub_input.closest(".zpl_secn").addClass("zpl_DNI"),dataSel.addClass("zpl_DNI")),sub_input.prop("checked",!1),TimetrackerOperations.Filters.clearCache(!1,"client"),filterDiv=container.find('[compname="client"]'),!ZPeopleComponents.isComponent(filterDiv))return;filterDiv&&filterDiv.length&&("tokenField"==filterDiv.attr("type")?TimelyZComp.tokenField.removeAllTokens(filterDiv):(TimelyZComp.select.removeAllOptions(filterDiv),TimelyZComp.select.deselectAllOptions(filterDiv)));case"client":TimetrackerOperations.Filters.clearCache(!1,"project"),(filterDiv=container.find('[compname="project"]'))&&filterDiv.length&&("tokenField"==filterDiv.attr("type")?TimelyZComp.tokenField.removeAllTokens(filterDiv):(TimelyZComp.select.removeAllOptions(filterDiv),TimelyZComp.select.deselectAllOptions(filterDiv)));case"project":TimetrackerOperations.Filters.clearCache(!1,"job"),(filterDiv=container.find('[compname="job"]'))&&filterDiv.length&&("tokenField"==filterDiv.attr("type")?TimelyZComp.tokenField.removeAllTokens(filterDiv):(TimelyZComp.select.removeAllOptions(filterDiv),TimelyZComp.select.deselectAllOptions(filterDiv)))}},getOptionsForFilter:async function(data,searchText,fetchedRecordCount){fetchedRecordCount=fetchedRecordCount||0;var options=[],result=TimetrackerOperations.Filters.getOptionsFromCache(data,searchText,fetchedRecordCount);if(result.makeRequest){var entity=data.entity,url=Timetracker.constants.URL;if("client"===entity)var params={mode:"getClientList",isFromFilter:!0,sortType:"0",isAscending:!0,conreqcsr:csrfToken};else if("project"===entity)params={mode:"getTimesheetProjectList",projectStatus:"-1",isFromFilter:!0,includeDeptProjects:!1,sortType:"0",isAscending:!0,conreqcsr:csrfToken};else if("job"===entity){params={mode:"getJobs",isFromFilter:!0,includeDeptJobs:!1,isClientDetailsNeeded:!1,jobStatus:"-1",conreqcsr:csrfToken};url="/timesheet.zp"}params=TimetrackerOperations.Filters.getAdditionalParams(data,params),searchText&&""!==searchText&&(params.searchKey=searchText),params.sIndex=fetchedRecordCount>0?fetchedRecordCount+1:0,params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT;var[response]=await ZPeople.Request.sendRequestAsPromise(url,params);response&&("client"===entity&&response.res&&response.clientArr&&response.clientArr.length>0||response.length>0)&&(options="client"===entity?response.clientArr:response),searchText&&""!==searchText?TimetrackerOperations.Filters.searchCache[entity][searchText]?TimetrackerOperations.Filters.searchCache[entity][searchText]=TimetrackerOperations.Filters.searchCache[entity][searchText].concat(options):TimetrackerOperations.Filters.searchCache[entity][searchText]=options:void 0!==TimetrackerOperations.Filters.cache[entity]?TimetrackerOperations.Filters.cache[entity]=TimetrackerOperations.Filters.cache[entity].concat(options):TimetrackerOperations.Filters.cache[entity]=options}else options=result.options;return options},getOptionsFromCache:function(data,searchText,fetchedRecordCount){var makeRequest=!0,entity=data.entity,maxFetchLimit=data.firescrollDtls?data.firescrollDtls.maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,options=[];if(searchText&&""!==searchText){if(void 0===TimetrackerOperations.Filters.searchCache[entity]&&(TimetrackerOperations.Filters.searchCache[entity]={}),void 0!==TimetrackerOperations.Filters.searchCache[entity][searchText])if(0===TimetrackerOperations.Filters.searchCache[entity][searchText].length)makeRequest=!1;else if(TimetrackerOperations.Filters.searchCache[entity][searchText].length>fetchedRecordCount){for(var itr=fetchedRecordCount;itr<TimetrackerOperations.Filters.searchCache[entity][searchText].length&&options.length<maxFetchLimit;itr++)options.push(TimetrackerOperations.Filters.searchCache[entity][searchText][itr]);makeRequest=!1}}else if(void 0!==TimetrackerOperations.Filters.cache[entity])if(0===TimetrackerOperations.Filters.cache[entity].length)makeRequest=!1;else if(TimetrackerOperations.Filters.cache[entity].length>fetchedRecordCount){for(itr=fetchedRecordCount;itr<TimetrackerOperations.Filters.cache[entity].length&&options.length<maxFetchLimit;itr++)options.push(TimetrackerOperations.Filters.cache[entity][itr]);makeRequest=!1}return{makeRequest:makeRequest,options:options}},clearCache:function(clearAll,entity){clearAll?(TimetrackerOperations.Filters.cache={},TimetrackerOperations.Filters.searchCache={}):entity&&(void 0!==TimetrackerOperations.Filters.cache[entity]&&(TimetrackerOperations.Filters.cache[entity]=void 0),void 0!==TimetrackerOperations.Filters.searchCache[entity]&&(TimetrackerOperations.Filters.searchCache[entity]=void 0))},getFormToDatefromPeriodFilter:function(params,filterDiv,fromDateId,toDateId,defPeriod){var fromDate,toDate,crperiod=defPeriod||"2";if(0!=filterDiv.length&&(crperiod=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find("[compname=period]"))),"0"===crperiod)d=Calendar.getCurrentDay(),fromDate=Calendar.formatDate(d.day),toDate=Calendar.formatDate(d.day);else if("1"===crperiod)d=Calendar.getCurrentWeek(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("2"===crperiod)d=Calendar.getCurrentMonth(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("3"===crperiod)d=Calendar.getCurrentDay(),d=Calendar.getPreviousDay(),fromDate=Calendar.formatDate(d.day),toDate=Calendar.formatDate(d.day);else if("4"===crperiod)d=Calendar.getCurrentWeek(),d=Calendar.getPreviousWeek(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("5"===crperiod)d=Calendar.getCurrentMonth(),d=Calendar.getPreviousMonth(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("6"===crperiod){if(fromDate=ZPeopleComponents.datefield(filterDiv.find("#"+fromDateId)).getValue().dateString,toDate=ZPeopleComponents.datefield(filterDiv.find("#"+toDateId)).getValue().dateString,Timetracker.util.removeErrorMsg(void 0,filterDiv),void 0==fromDate)return void Timetracker.Util.appenErrorMsgForElem({obj:filterDiv.find("#"+fromDateId),msg:ZPI18N.getString("zp.emptyfromdate")});if(void 0==toDate)return void Timetracker.Util.appenErrorMsgForElem({obj:filterDiv.find("#"+toDateId),msg:ZPI18N.getString("zp.emptytodate")});if(void 0!==fromDate&&!Calendar.isvalidDate(fromDate))return void Timetracker.Util.appenErrorMsgForElem({obj:filterDiv.find("#"+fromDateId),msg:ZPI18N.getString("zp.invalidfromdate")});if(void 0!==toDate&&!Calendar.isvalidDate(toDate))return void Timetracker.Util.appenErrorMsgForElem({obj:filterDiv.find("#"+toDateId),msg:ZPI18N.getString("zp.invalidtodate")});if(void 0!=fromDate&&void 0!=toDate){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);if(fdate>tdate)return void Timetracker.Util.appenErrorMsgForElem({obj:filterDiv.find("#"+toDateId),msg:ZPI18N.getString("zp.greaterfromdate")});if(Timetracker.DateTime.getDateDiff(fdate,tdate)>31)return void Timetracker.Util.appenErrorMsgForElem({obj:filterDiv.find("#"+fromDateId),msg:ZPI18N.getString("zp.datewithindays",["31"])})}}void 0!=fromDate&&void 0!=toDate&&(params.fromDate=fromDate,params.toDate=toDate)},setSelectedPeriodDetails:function(filterDiv,fromDateId,toDateId){if(0!==filterDiv.length){let periodValue=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find("[compname=period]"));if(filterDiv.find("[compname=period]").attr("viewPeriodType",periodValue),"6"===periodValue){let fromDate=ZPeopleComponents.datefield(filterDiv.find("#"+fromDateId)).getValue().dateString,toDate=ZPeopleComponents.datefield(filterDiv.find("#"+toDateId)).getValue().dateString;filterDiv.find("#"+fromDateId).data("appliedDate",fromDate),filterDiv.find("#"+toDateId).data("appliedDate",toDate)}}},resetFromToDate:function(filterDiv,fromDateId,toDateId){Timetracker.util.removeErrorMsg(filterDiv.attr("id"));let fromDateContainer=filterDiv.find("#"+fromDateId),toDateContainer=filterDiv.find("#"+toDateId);"6"!==filterDiv.find('[compname="period"]').attr("viewPeriodType")?(ZPeopleComponents.datefield(fromDateContainer).clear(),ZPeopleComponents.datefield(toDateContainer).clear()):(ZPeopleComponents.datefield(fromDateContainer).setValue(fromDateContainer.data("appliedDate")),ZPeopleComponents.datefield(toDateContainer).setValue(toDateContainer.data("appliedDate")))}},TimetrackerOperations.timelogs={init:function(){TimetrackerOperations.init(),Timetracker.permissionCheckForOperPages()&&TimetrackerOperations.timelogs.getTimelogsPage()},getTimelogsPage:function(){0==settingsPage.container.find("#timelogPage").length&&(TimetrackerOperations.timelogs.constructTLPage(),TimelyZComp.toolTip.intiliaze()),TimetrackerOperations.timelogs.resetPage(!0)},constructTLPage:function(){var html='<div class="zpl_rgtcnt h100_per d-flex j-cnt-btwen zpl_imptexptcrd" style="gap: 10px;" id="timelogPage"><div class="zpl_crd h100_per wd50_per"><div class="zpl_crdcnt"><div class="zpl_btnmnu"><div class="zpl_lft"><h4>'+ZPI18N.getString("zp.import")+'</h4></div></div><div class="zpl_Emptydata"><div><div class="zpl_mdimprtimg"></div><h4>'+ZPI18N.getString("zp.fileimported")+'</h4><em class="DB">'+ZPI18N.getString("zp.formfomtsupportxlscsv")+"</em><em>"+ZPI18N.getString("zp.maxfilesize")+'</em><div class="zpl_secn"><button class="zlabel zlabel--blue zlabel--medium" onclick="Timetracker.timelogs.Import.construct()">'+ZPI18N.getString("zp.importfile")+'</button></div></div> </div></div></div><div class="zpl_crd h100_per wd50_per zpl_ttlogfltr"><div class="zpl_crdcnt" id="exportDiv"><div class="zpl_btnmnu"><div class="zpl_lft"><h4>'+ZPI18N.getString("zp.export")+'</h4></div><div class="zpl_rgt"><i class="zpl_ibg PI_fltr zpl_act" title="'+ZPI18N.getString("zp.filter")+'" onclick="TimetrackerOperations.timelogs.constructFilter()"></i></div></div><div class="zpl_Emptydata"><div><div class="zpl_mdexprtimg"></div><h4>'+ZPI18N.getString("zp.exportas",[""])+'</h4> <div class="zpl_secn"><div><div class="zradiobutton zradiobutton--horizontal"><input id="tt_xls" type="radio" name="exportType" checked="true" class="zradiobutton__helper" value="xls"><label for="tt_xls" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.xls")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tt_xlsx" type="radio" name="exportType" class="zradiobutton__helper" value="xlsx"><label for="tt_xlsx" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.xlsx")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tt_csv" type="radio" name="exportType" class="zradiobutton__helper" value="csv"><label for="tt_csv" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.csv")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="tt_tsv" type="radio" name="exportType" class="zradiobutton__helper" value="tsv"><label for="tt_tsv" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.tsv")+'</span></label></div></div></div><div class="zpl_secn" style="text-align: left;" elem="exportAdditionalContainer"></div><div class="zpl_secn"><button id="tt_export" class="zlabel zlabel--blue zlabel--medium" onclick="TimetrackerOperations.timelogs.timelogExport()">'+ZPI18N.getString("zp.export")+"</button></div></div></div></div></div></div></div>";settingsPage.container.append(html);let additionalEmpFieldsDiv=settingsPage.container.find("#exportDiv").find("[elem=exportAdditionalContainer]"),optns={showOptionsByDefault:!0,skipCacheChecks:!0};optns=Timetracker.ImportExport.showExportDataOptions(optns),additionalEmpFieldsDiv.append(optns.additionalHtml)},constructFilter:function(){if(0==settingsPage.container.find("#filterDiv").length){filterOpt={period:{single:!0,label:ZPI18N.getString("zp.period")},fromdate:{label:ZPI18N.getString("zp.fromdate"),type:"input",id:"tt_fromdate"},todate:{label:ZPI18N.getString("zp.todate"),type:"input",id:"tt_todate"},employee:{single:!0,searchmode:"TIMETRACKER_DATA",label:ZPI18N.getString("zp.employee"),id:"tl_emp",paramId:"userErecNo",filterCallback:!0,initalSelection:Timetracker.Search.getLoggedInUserOption(),extraParams:{projectManagerPerm:!0}},client:{label:Timetracker.util.getClientDisplayName(),paramId:"clientId",tokenField:!0},project:{label:Timetracker.util.getProjectDisplayName(),paramId:"projectId",tokenField:!0},job:{label:Timetracker.util.getJobDisplayName(),paramId:"jobId",tokenField:!0},billableStatus:{single:!0,label:ZPI18N.getString("zp.billablestatus"),paramId:"typeMode"},approvalStatus:{single:!0,label:ZPI18N.getString("zp.approvalstatus"),paramId:"approvalStatus"}},Timetracker.isDataAdminForAllUsers()&&(filterOpt.employee.defaultOptionNeeded=!0),TimetrackerOperations.Filters.constructFilterDiv(filterOpt);var config={calendarIcon:!0,format:dateFmt,picker:!0,spinButtons:"none",clearButton:"none"},filterDiv=settingsPage.container.find("#filterDiv");ZPeopleComponents.datefield(filterDiv.find("#tt_fromdate"),config),ZPeopleComponents.datefield(filterDiv.find("#tt_todate"),config),$(filterDiv).find(".zpl_search").remove(),$(filterDiv).find("#filter_footer").find('[compname="applyFilter"]').remove(),$(filterDiv).find("#filter_footer").find('[compname="resetFilter"]').off().on("click",function(){TimetrackerOperations.timelogs.resetPage(!0)}),filterDiv.find('[compname="period"]').off().on("zselectchange",function(){var container=settingsPage.container.find("#filterDiv"),preiodDiv=container.find('[compname="period"]');6==TimelyZComp.select.getValue(preiodDiv)?(TimetrackerOperations.Filters.resetFromToDate(container,"tt_fromdate","tt_todate"),container.find("#tt_fromdate").parent().parent().removeClass("zpl_DNI"),container.find("#tt_todate").parent().parent().removeClass("zpl_DNI")):(container.find("#tt_fromdate").parent().parent().addClass("zpl_DNI"),container.find("#tt_todate").parent().parent().addClass("zpl_DNI"))}),TimetrackerOperations.timelogs.resetPage()}TimetrackerOperations.Filters.toggleFilter(),TimelyZComp.toolTip.intiliaze(filterDiv)},resetPage:function(resetChkbox){var layout=settingsPage.container,filterDiv=layout.find("#filterDiv");if(0!=filterDiv.length){TimetrackerOperations.Filters.clearFilters(),Timetracker.util.removeErrorMsg("filterDiv",filterDiv),filterDiv.find("#tt_fromdate").parent().parent().addClass("zpl_DNI"),filterDiv.find("#tt_todate").parent().parent().addClass("zpl_DNI");var viewType=Timetracker.generalSettings.getDefaultViewType(Timetracker.timelogs.tserecno);TimelyZComp.select.setValue(filterDiv.find('[compname="period"]'),viewType),TimelyZComp.select.setValue(filterDiv.find('[compname="billableStatus"]'),-1),TimelyZComp.select.setValue(filterDiv.find('[compname="approvalStatus"]'),0),TimelyZComp.select.setValue(filterDiv.find('[compname="employee"]'),erecno)}resetChkbox&&(layout.find("#empFields").is(":checked")&&layout.find("#empFields").trigger("click"),layout.find("#tt_xls").prop("checked",!0))},timelogExport:function(){Timetracker.util.freezeSubmit(void 0,"tt_export",settingsPage.container);var path="",fromDate=null,toDate=null,filterDiv=settingsPage.container.find("#filterDiv"),userErecNo=erecno,billingStatus=-1,clientId=0,jobId="0",projectId="0",approvalStatus="0",crperiod=Timetracker.generalSettings.getDefaultViewType(Timetracker.timelogs.tserecno);0!=filterDiv.length&&(userErecNo=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find("[compname=employee]")),billingStatus=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find("[compname=billableStatus]")),clientId=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find("[compname=client]")),jobId=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find("[compname=job]")),projectId=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find("[compname=project]")),approvalStatus=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find("[compname=approvalStatus]")),crperiod=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find("[compname=period]")));let isError=!1,errmsg="";if("0"===crperiod)d=Calendar.getCurrentDay(),fromDate=Calendar.formatDate(d.day),toDate=Calendar.formatDate(d.day);else if("1"===crperiod)d=Calendar.getCurrentWeek(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("2"===crperiod)d=Calendar.getCurrentMonth(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("3"===crperiod)d=Calendar.getCurrentDay(),d=Calendar.getPreviousDay(),fromDate=Calendar.formatDate(d.day),toDate=Calendar.formatDate(d.day);else if("4"===crperiod)d=Calendar.getCurrentWeek(),d=Calendar.getPreviousWeek(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("5"===crperiod)d=Calendar.getCurrentMonth(),d=Calendar.getPreviousMonth(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("6"===crperiod&&(fromDate=ZPeopleComponents.datefield(filterDiv.find("#tt_fromdate")).getValue().dateString,toDate=ZPeopleComponents.datefield(filterDiv.find("#tt_todate")).getValue().dateString,isError||void 0!=fromDate||(errmsg=ZPI18N.getString("zp.enterfromtodate"),isError=!0),isError||void 0!=toDate||(errmsg=ZPI18N.getString("zp.enterfromtodate"),isError=!0),isError||void 0===fromDate||Calendar.isvalidDate(fromDate)||(errmsg=ZPI18N.getString("zp.invalidfromdate"),isError=!0),isError||void 0===toDate||Calendar.isvalidDate(toDate)||(errmsg=ZPI18N.getString("zp.invalidtodate"),isError=!0),!isError&&void 0!=fromDate&&void 0!=toDate)){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);if(fdate>tdate)errmsg=ZPI18N.getString("zp.greaterfromdate"),isError=!0;else Timetracker.DateTime.getDateDiff(fdate,tdate)>31&&(errmsg=ZPI18N.getString("zp.datewithindays",["31"]),isError=!0)}if(isError)return Timetracker.util.showAlert(1,errmsg),void Timetracker.util.unfreezeSubmit(void 0,"tt_export",settingsPage.container);TimetrackerOperations.Filters.setSelectedPeriodDetails(filterDiv,"tt_fromdate","tt_todate");var downloadType=settingsPage.container.find("input[type='radio'][name='exportType']:checked").val();path=(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+Timetracker.constants.URL+"?mode=exportTimelogs&userErecNo="+userErecNo+"&getfrmDate="+fromDate+"&gettoDate="+toDate+"&getbill="+billingStatus+"&fileType="+downloadType+"&clientId="+clientId+"&jobId="+jobId+"&projectId="+projectId+"&approvalStatus="+approvalStatus;let exportAdditionalInfoContainer=settingsPage.container.find("#exportDiv").find("[elem=exportAdditionalContainer]");exportAdditionalInfoContainer.length>0&&(path+="&designationNeeded="+exportAdditionalInfoContainer.find("#designationExport").is(":checked")+"&locationNeeded="+exportAdditionalInfoContainer.find("#locationExport").is(":checked")+"&reportingToNeeded="+exportAdditionalInfoContainer.find("#reportingToExport").is(":checked")+"&departmentNeeded="+exportAdditionalInfoContainer.find("#departmentExport").is(":checked"),isOrgStructureEnabled&&(path+="&legalEntityNeeded="+exportAdditionalInfoContainer.find("#leaglEntityExport").is(":checked")+"&businessUnitNeeded="+exportAdditionalInfoContainer.find("#businessUnitExport").is(":checked")+"&divisionNeeded="+exportAdditionalInfoContainer.find("#divisionExport").is(":checked")),Timetracker.generalSettings.isOrgTagEnabled()&&(path+="&orgTagNeeded="+exportAdditionalInfoContainer.find("#orgTagExport").is(":checked"))),Timetracker.ImportExport.submiteFormForExport(path),Timetracker.util.unfreezeSubmit(void 0,"tt_export",settingsPage.container)}},TimetrackerOperations.billing={BillEditRow:{data:null,editMode:!1,viewMode:!1},BillingCriteria:{},taxforBill:null,currenciesData:null,qbopushdata:{},isQBOEnabled:!1,isZBEnabled:!1,isZIEnabled:!1,isPushBillEnabled:!1,isBooksInteg:!1,init:function(){TimetrackerOperations.init(),Timetracker.permissionCheckForOperPages()&&TimetrackerOperations.billing.getBillingPage()},clickHandler:function(billRowObj,data){billRowObj.find("[ref=viewBill]").click(function(){TimetrackerOperations.billing.viewBill(data,this)}),billRowObj.find("[ref=zinvoice]").click(function(){TimetrackerOperations.billing.pushToService.pushToInvoice(data.billingId,data.isPushedToInvoice)}),billRowObj.find("[ref=zbooks]").click(function(){TimetrackerOperations.billing.pushToService.pushToInvoice(data.billingId,data.isPushedToBooks,void 0,1)}),billRowObj.find("[ref=qbooks]").click(function(){TimetrackerOperations.billing.pushToService.pushToQBO(data.billingId,data.isPushedToQBO)}),billRowObj.find("[ref=mail]").click(function(){TimetrackerOperations.billing.mail.showSendMailPopup(data.billingId,this)}),billRowObj.find("[ref=delete]").click(function(){var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.smallbill")]),body:ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.smallbill")]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(data.billingId,TimetrackerOperations.billing.deleteBill,data.billingId,0,extraDtls)})},getBillingPage:function(){0==settingsPage.container.find("#timetrackerBilling").length&&(TimetrackerOperations.billing.constructBillingPage(),TimetrackerOperations.billing.loadBills(),TimelyZComp.toolTip.intiliaze())},constructBillingPage:function(){var html=Timetracker.genSettings.getHeaderBandHtml({header:ZPI18N.getString("zp.generateandviewbills"),description:ZPI18N.getString("zp.generatebillinfo"),headerExtraClass:"zpl_topcrdhdr"})+'<div class="zpl_btnmnu"><div class="zpl_rgt"><button class="zlabel zlabel--blue zlabel--medium" id="generateBillBtn" onclick="TimetrackerOperations.billing.showAddPage()">'+ZPI18N.getString("zp.generatebill")+'</button></div></div><div class="zpl_rgtcnt"><div class="zpl_tblres" id="timetrackerBilling"><table class="zpl_tbl clm40 zpl_nocrsor" id="timetrackerBillingTable"><thead><tr><th>'+ZPI18N.getString("zp.billno")+"</th><th>"+ZPI18N.getString("zp.tt.clientname")+"</th><th>"+ZPI18N.getString("zp.billdate")+"</th><th>"+ZPI18N.getString("zp.sduedate")+"</th><th>"+ZPI18N.getString("zp.amount")+'</th><th id="pushBills">'+ZPI18N.getString("zp.pushto")+"</th><th>"+ZPI18N.getString("zp.mailinvoice")+'</th><th width="80"></th></tr></thead><tbody id="billing-listtbody"></tbody></table></div></div></div>';settingsPage.container.append(html),settingsPage.container.addClass("zpl_tblfxd zpl_crdwthful")},getParams:function(){var params={mode:"getBills",conreqcsr:csrfToken,sIndex:0};return params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,params},loadBills:function(){var layout=settingsPage.container;Timetracker.FireScroll.resetDataOnLoad(TimetrackerOperations.billing.Firescroll.mode),layout.find("#timetrackerBilling").scrollTop(0),Timetracker.Util.showHideNoData({remove:!0}),layout.find("#generateBillBtn").closest(".zpl_btnmnu").removeClass("DNI"),layout.find("#timetrackerBilling").before(ZPeople.LOADING_HTML),layout.find("#timetrackerBilling").addClass("zpl_DNI"),layout.find("#timetrackerBilling").find("#pushBills").addClass("zpl_DNI");var params=TimetrackerOperations.billing.getParams();ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){layout.find("[id=zp_page_loading]").fadeOut(200).remove(),response&&(response.isZBEnabled&&(TimetrackerOperations.billing.isZBEnabled=response.isZBEnabled),response.isZIEnabled&&(TimetrackerOperations.billing.isZIEnabled=response.isZIEnabled),response.isQBOEnabled&&(TimetrackerOperations.billing.isQBOEnabled=response.isQBOEnabled),(TimetrackerOperations.billing.isZBEnabled||TimetrackerOperations.billing.isZIEnabled||TimetrackerOperations.billing.isQBOEnabled)&&(TimetrackerOperations.billing.isPushBillEnabled=!0,layout.find("#timetrackerBilling").find("#pushBills").removeClass("zpl_DNI"))),response=response&&response.billDetails?response.billDetails:null,TimetrackerOperations.billing.construct(response)})},construct:function(result){var layout=settingsPage.container;if(null!=result&&0===result.length)Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.nobillgenerated"),buttonName:ZPI18N.getString("zp.generatebill"),buttonCallBack:TimetrackerOperations.billing.showAddPage,desc:ZPI18N.getString("zp.generatebillinfo")}),layout.find("#generateBillBtn").closest(".zpl_btnmnu").addClass("DNI");else{Timetracker.Util.showHideNoData({remove:!0}),layout.find("#generateBillBtn").closest(".zpl_btnmnu").removeClass("DNI"),layout.find("#timetrackerBilling").removeClass("zpl_DNI");var tableBody=layout.find("#billing-listtbody");tableBody.html(""),$.each(result,function(index,data){tableBody.append(TimetrackerOperations.billing.constructRowHtml(data))})}Timetracker.FireScroll.initFireScroll(TimetrackerOperations.billing.Firescroll.mode,Timetracker.constants.URL,TimetrackerOperations.billing.getParams(),TimetrackerOperations.billing.Firescroll.loadMoreData,""),Timetracker.FireScroll.setFetchCount(TimetrackerOperations.billing.Firescroll.mode,result)},constructRowHtml:function(data){var html='<tr id="'+data.billingId+'"><td ref="viewBill" class="zpl_cp" ><span>'+data.billno+"</span></td><td><span>"+(data.clientName?data.clientName:"")+"</span></td><td><span>"+data.billDate+"</span></td><td><span>"+data.dueDate+"</span></td><td><span>"+Number(data.totalAmount).toFixed(2)+" "+data.currencyCode+"</span></td>";if(TimetrackerOperations.billing.isPushBillEnabled){if(html+="<td>",TimetrackerOperations.billing.isZIEnabled&&(html+='<i class="SP-invoice MR10" ref="zinvoice" data-toggle="tooltip" title="'+ZPI18N.getString("zp.tt.pushtoinvoice")+'"></i>'),TimetrackerOperations.billing.isZBEnabled&&(html+='<i class="SP-books MR10" ref="zbooks" data-toggle="tooltip" title="'+ZPI18N.getString("zp.tt.pushtobooks")+'"></i>'),TimetrackerOperations.billing.isQBOEnabled){var qbclass="zpl_qbookslogo zpl_cp",qbtitle=ZPI18N.getString("zp.tt.qbotimebutpush");data.isPushedToQBO&&(qbclass="zpl_qbookslogo ZPInact",qbtitle=ZPI18N.getString("zp.tt.qbotimebutpushed")),html+='<div class="'+qbclass+'" ref="qbooks" data-toggle="tooltip" title="'+qbtitle+'" ></div>'}html+="</td>"}return html+='<td ref="skip"><div class="zpl_hvr zpl_hvrsw"><i ref="mail" title="'+ZPI18N.getString("zp.tt.seninvoiceviamail")+'" class="PI_mail"></i></div></td>',html+='<td width="80"><div class="zpl_hvr" ref="delete"><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" ref="delete"></i></div></td></tr>',(html=$(html)).data(data),TimetrackerOperations.billing.clickHandler(html,data),html},appendAddedEditedBillRow:function(response,isAdd){let layout=settingsPage.container,billTableBody=layout.find("#billing-listtbody");if(isAdd)0===billTableBody.find("tr").length&&(Timetracker.Util.showHideNoData({remove:!0}),layout.find("#generateBillBtn").closest(".zpl_btnmnu").removeClass("DNI"),layout.find("#timetrackerBilling").removeClass("zpl_DNI")),billTableBody.prepend(TimetrackerOperations.billing.constructRowHtml(response)),Timetracker.FireScroll.increaseFetchedCount(TimetrackerOperations.billing.Firescroll.mode,1);else{let dataBeforeEdit=billTableBody.find("#"+response.billingId).data();["clientName","streetAddr","city","state","pincode","country"].forEach(function(key){dataBeforeEdit.hasOwnProperty(key)&&(response[key]=dataBeforeEdit[key])}),billTableBody.find("#"+response.billingId).remove(),billTableBody.prepend(TimetrackerOperations.billing.constructRowHtml(response))}layout.find("#operations-timetracker-billing").scrollTop(0)},viewBill:function(billData,obj){$(obj).off("click"),TimetrackerOperations.billing.BillEditRow.data=billData,TimetrackerOperations.billing.BillEditRow.editMode=!1,TimetrackerOperations.billing.BillEditRow.viewMode=!0,TimetrackerOperations.billing.getBillDetails(billData)},confirmEditBill:function(billId){var obj=settingsPage.container.find("#billing-listtbody").find("#"+billId),data=$(obj).data();if(TimetrackerOperations.billing.BillEditRow.data=data,TimetrackerOperations.billing.BillEditRow.data.isMailSent){var extraDtls={header:ZPI18N.getString("zp.module.edit",[ZPI18N.getString("zp.smallbill")]),body:ZPI18N.getString("zp.billeditalertbody"),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(billId,TimetrackerOperations.billing.geteditBillDetails,data,1,extraDtls)}else TimetrackerOperations.billing.geteditBillDetails(data)},geteditBillDetails:function(data){TimetrackerOperations.billing.BillEditRow.editMode=!0,TimetrackerOperations.billing.BillEditRow.viewMode=!1,TimetrackerOperations.billing.getBillDetails(data)},getBillDetails:function(data){var result,billId=data.billingId,obj=settingsPage.container.find("#billing-listtbody").find("#"+billId);$(obj).data("details")?(result=$(obj).data("details"),TimetrackerOperations.billing.constructNewBill(result,billId).then(function(){TimetrackerOperations.billing.BillEditRow.viewMode&&$(obj).find("[ref=viewBill]").off("click").click(function(){TimetrackerOperations.billing.viewBill(data,this)})})):$.post("/timesheet.zp",{mode:"getBillsDetails",billId:data.billingId,conreqcsr:csrfToken},function(result){$(obj).data("details",result),result.splice(0,0,data),TimetrackerOperations.billing.constructNewBill(result,billId).then(function(){TimetrackerOperations.billing.BillEditRow.viewMode&&$(obj).find("[ref=viewBill]").off("click").click(function(){TimetrackerOperations.billing.viewBill(data,this)})})})},deleteBill:function(billingId){$.post("/timesheet.zp",{mode:"deleteBill",billId:billingId,conreqcsr:csrfToken},function(){let billingBody=settingsPage.container.find("#billing-listtbody");Timetracker.util.showAlert(2,ZPI18N.getString("zp.deleted.successfully.msg",[ZPI18N.getString("zp.bill")])),billingBody.find("#"+billingId).remove(),Timetracker.FireScroll.checkAndLoadMoreData(TimetrackerOperations.billing.Firescroll.mode,1),0===billingBody.find("tr").length&&(settingsPage.container.find("#timetrackerBilling").addClass("zpl_DNI"),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.nobillgenerated"),buttonName:ZPI18N.getString("zp.generatebill"),buttonCallBack:TimetrackerOperations.billing.showAddPage,desc:ZPI18N.getString("zp.generatebillinfo")}),settingsPage.container.find("#generateBillBtn").closest(".zpl_btnmnu").addClass("DNI"))})},showAddPage:function(){var modal=settingsPage.container.find("#addBillsPage");if(0==modal.length){var ddown={dropdownList:{appendTo:(modal=TimetrackerOperations.billing.constructAddPagePopup()).find(".sel_postion").length>0?modal.find(".sel_postion"):void 0}};TimelyZComp.select.intialize(modal.find("#billingperiod"),ddown),TimelyZComp.select.intialize(modal.find("#billing-approval"),ddown);var extraDtls={submode:"TIMETRACKER_DATA",inpFormat:"token",maxAllowedValues:10};extraDtls.changeCallback=TimetrackerOperations.billing.filterOnChangeCallback,Timetracker.Search.populateZCompUsers("billing-user",void 0,extraDtls,!0,modal);var details={};details.callback=TimetrackerOperations.billing.filterOnChangeCallback,details.element=modal.find("#billing-client"),details.key="client",details.mapping={value:"clientId",label:"clientName"},details.placeholder=ZPI18N.getString("zp.selectclient"),TimetrackerOperations.Filters.constructTTFormFilters(details),ZPeopleComponents.select(details.element).setAttribute("dropdownList",{viewport:".zpl_mcnt.zpl_fm"}),details.element=modal.find('[compname="project"]'),details.key="project",details.tokenField=!0,details.mapping={value:"projectId",label:"projectName"},details.placeholder=ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.getProjectDisplayName()),TimetrackerOperations.Filters.constructTTFormFilters(details),details.element=modal.find('[compname="job"]'),details.key="job",details.tokenField=!0,details.mapping={value:"jobId",label:"jobName"},details.placeholder=ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.getJobDisplayName()),TimetrackerOperations.Filters.constructTTFormFilters(details);var config={calendarIcon:!0,format:dateFmt,picker:!0,spinButtons:"none",clearButton:"none"};ZPeopleComponents.datefield(modal.find("[name=date]"),config)}else ModuleComp.Modal.show(modal),ModuleComp.Modal.hide("billGenerateStep2"),TimelyZComp.select.deselectAllOptions(modal.find('[compname="client"]')),TimelyZComp.tokenField.removeAllTokens(modal.find('[compname="project"]')),TimelyZComp.tokenField.removeAllTokens(modal.find('[compname="job"]')),TimelyZComp.tokenField.removeAllTokens(modal.find('[compname="employee"]')),TimelyZComp.select.setValue(modal.find("#billingperiod"),4),modal.find("#billingperiod").attr("viewPeriodType","4"),TimelyZComp.select.setValue(modal.find("#billing-approval"),0);Timetracker.util.removeErrorMsg(void 0,modal)},constructAddPagePopup:function(){if(0==(modal=settingsPage.container).find("#addBillsPage").length)var body='<form id="filterDiv"><div class="zpl_crd"><div class="zpl_crdcnt sel_postion" style="position: relative;"><div class="zpl_secn w400"><div><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.client")+'</font></label></div><div><input type="text" class="ztextbox" compname="client" id="billing-client" value="0"></div></div><div class="zpl_secn w400"><div><label>'+ZPI18N.getString("zp.period")+'</label></div><div><select id="billingperiod" class="select-js" compname="period" viewPeriodType="4"><option value="1">'+ZPI18N.getString("zp.today")+'</option><option value="0">'+ZPI18N.getString("zp.thisweek")+'</option><option value="4" selected>'+ZPI18N.getString("zp.tt_thismonth")+'</option><option value="3">'+ZPI18N.getString("zp.yesterday")+'</option><option value="2">'+ZPI18N.getString("zp.lastweek")+'</option><option value="5">'+ZPI18N.getString("zp.lastmonth")+'</option><option value="6">'+ZPI18N.getString("zp.custom")+'</option></select></div></div><div class="zpl_secn w400 zpl_idivingrp zpl_DNI" id="customDateDiv"><div><label>'+ZPI18N.getString("zp.fromtodate")+'</label></div><div><div><div><input name="date" class="datepicker-js W100" id="billing-fromdate"></div><div><input name="date" class="datepicker-js W100" id="billing-todate"></div></div><div id="billing-date-error"></div></div></div><div class="zpl_secn w400"><div><label>'+ZPI18N.getString("zp.employee")+'</label></div><div><textarea type="tokenField" compname="employee" id="billing-user"></textarea></div></div><div class="zpl_secn w400"><div><label>'+Timetracker.util.projectDispName+'</label></div><div><textarea type="tokenField" compname="project" id="billing-project"></textarea></div></div><div class="zpl_secn w400"><div><label>'+Timetracker.util.jobDispName+'</label></div><div><textarea type="tokenField" compname="job" id="billing-job"></textarea></div></div><div class="zpl_secn w400"><div><label>'+ZPI18N.getString("zp.leave.operations.approvalstaus")+'</label></div><div><select id="billing-approval" class="select-js"><option value="0">'+ZPI18N.getString("zp.all")+'</option><option value="1">'+ZPI18N.getString("zp.approvedlogs")+'</option><option value="2">'+ZPI18N.getString("zp.unapprovedlogs")+"</option></select></div></div></div></div></form>",modal=ModuleComp.Modal.setup({id:"addBillsPage",type:1,header:ZPI18N.getString("zp.generatebill"),body:body,backdrop:!0,closeOnSubmit:!1,buttonValue:ZPI18N.getString("zp.next"),successCallback:TimetrackerOperations.billing.generateBill,closeonEsc:!0});return modal.find('[compname="period"]').on("zselectchange",TimetrackerOperations.billing.filterOnChangeCallback),modal},constructBillGenerationPopup:function(){var modal=settingsPage.container;if(0!=modal.find("#billGenerateStep2").length)return modal.find("#billGenerateStep2");var body='<form><div class="zpl_crd" id="generate_bill_print"><div class="zpl_crdcnt"><div class="zpl_billview"><div><div class="zpl_secn w400"><div><label>'+ZPI18N.getString("zp.local.Customername")+'</label></div><div><b id="billing-clientName"></b></div></div><div class="zpl_secn w400"><div><label>'+ZPI18N.getString("zp.address")+'</label></div><div><b id="billing-clientAddress"></b></div></div></div><div><div class="zpl_secn zpl_bllfrm w400"><div><label id="billno_label"><font>'+ZPI18N.getString("zp.billno")+'</font></label></div><div><input type="text" class="ztextbox" id="billing-billno"><b id="billing-billno_view"></b></div></div><div class="zpl_secn zpl_bllfrm w400"><div><label id="billdate_label"><font>'+ZPI18N.getString("zp.billdate")+'</font></label></div><div><input type="text" class="ztextbox" name="date" id="billing-billdate"><b id="billing-billdate_view"></b></div></div><div class="zpl_secn zpl_bllfrm w400"><div><label id="duedate_label"><font>'+ZPI18N.getString("zp.sduedate")+'</font></label></div><div><input type="text" class="ztextbox" name="date" id="billing-duedate"><b id="billing-duedate_view"></b></div></div></div></div><div class="zpl_secn"><p id="deletedtaxesindication" class="text-right"><span class="blu ZPstr">**</span> - '+ZPI18N.getString("zp.indicatesdeletedtax")+'</p><div class="zpl_tblres"><table class="zpl_tbl wd100_per zpl_nocrsor"><thead><tr><th>'+ZPI18N.getString("zp.sno")+"</th><th>"+Timetracker.jobs.formDetails.labelDetails.JOBNAME+"</th><th>"+ZPI18N.getString("zp.hourslog")+"</th><th>"+ZPI18N.getString("zp.srateperhour")+"</th><th>"+ZPI18N.getString("zp.discount")+'</th><th width="250">'+ZPI18N.getString("zp.taxes")+"</th><th>"+ZPI18N.getString("zp.amount")+'</th></tr></thead><tbody id="billing-billtbody"></tbody><tfoot><tr><td colspan="5"></td><td><span><b>'+ZPI18N.getString("zp.subtotal")+' (<span id="billing-stotalcur"></span>)</b></span></td><td><span><b id="billing-subtotal"></b></span></td></tr><tr id="billing-totaltbody"><td colspan="5"></td><td><span><b>'+ZPI18N.getString("zp.total")+' (<span id="billing-totalcur"></span>)</b></span></td><td><span><b id="billing-total"></b></span></td></tr></tfoot></table></div></div></div></div></form>',footer='<div class="zpl_mfoter"><div><div class="MRauto"><button type="button" class="zlabel zlabel--blue zlabel--medium" id="generatebill_submit">'+ZPI18N.getString("zp.submit")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" id="generatebill_close">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>";return(modal=ModuleComp.Modal.setup({id:"billGenerateStep2",type:1,headerHtml:'<div class="zpl_mhicn"><a class="clsArw"><i class="PI_back" id="generatebill_back" title="Back"></i></a><h4 id="zp_modal_header"></h4></div><span id="headeropt" class="zpl_mhderrgt"></span> <a class="_cls PI_cls tooltip-js" data-title-position="bottom" title="Close"></a>',body:body,footer:footer,backdrop:!0,closeOnSubmit:!1,deleteOnHide:!0,modalClass:"zpl_mlg",buttonValue:ZPI18N.getString("zp.submit"),hiddenCallback:TimetrackerOperations.billing.destroyZComp,successCallback:TimetrackerOperations.billing.generateBill,closeonEsc:!0})).find("#generatebill_close").on("click",function(){ModuleComp.Modal.hide("billGenerateStep2")}),modal.find("#generatebill_submit").on("click",function(){TimetrackerOperations.billing.createBill()}),modal.find("#generatebill_back").on("click",function(){TimetrackerOperations.billing.showAddPage()}),modal},generateBillForClientReport:function(){TimetrackerOperations.billing.BillEditRow.data=null,TimetrackerOperations.billing.BillEditRow.editMode=!1,TimetrackerOperations.billing.BillEditRow.viewMode=!1,Timetracker.util.removeErrorMsg("addBillsPage");var params={mode:"getBillingByClinet",conreqcsr:csrfToken},clientId=Timetracker.Reports.clientReport.clientId;TimetrackerOperations.billing.BillingCriteria.mode=!1,params.fromClientReport=!0,ZPeople.BSModal.hide("repclientsummary"),params.clientId=clientId,$.post(Timetracker.constants.URL,params,function(result){if(1===result.length)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.nologhours",[ZPI18N.getString("zp.smallbill")])),!1;TimetrackerOperations.billing.constructNewBill(result)})},generateBill:function(){let modal=settingsPage.container.find("#addBillsPage");var layout=modal.find("#filterDiv");Timetracker.util.removeErrorMsg(void 0,layout,!0),TimetrackerOperations.billing.BillingCriteria.mode=!1,TimetrackerOperations.billing.BillEditRow.editMode=!1,TimetrackerOperations.billing.BillEditRow.viewMode=!1;var params={mode:"getBillingByClinet",conreqcsr:csrfToken},clientId=TimelyZComp.select.getValue(layout.find("#billing-client"));if(""!=clientId){params.approvalStatus=TimetrackerOperations.Filters.getSelectFilterValues(layout.find("#billing-approval")),params.projectId=TimetrackerOperations.Filters.gettokenFieldValues(layout.find("[compname='project']")),params.jobId=TimetrackerOperations.Filters.gettokenFieldValues(layout.find("[compname='job']")),params.userErecNo=TimetrackerOperations.Filters.gettokenFieldValues(layout.find("[compname='employee']"));var billcheck=!0,crperiod=TimetrackerOperations.Filters.getSelectFilterValues(layout.find("#billingperiod"));if("0"===crperiod)d=Calendar.getCurrentWeek(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("1"===crperiod)d=Calendar.getCurrentDay(),fromDate=Calendar.formatDate(d.day),toDate=Calendar.formatDate(d.day);else if("2"===crperiod)d=Calendar.getCurrentWeek(),d=Calendar.getPreviousWeek(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("3"===crperiod)d=Calendar.getCurrentDay(),d=Calendar.getPreviousDay(),fromDate=Calendar.formatDate(d.day),toDate=Calendar.formatDate(d.day);else if("4"===crperiod)d=Calendar.getCurrentMonth(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("5"===crperiod)d=Calendar.getCurrentMonth(),d=Calendar.getPreviousMonth(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("6"===crperiod&&(fromDate=ZPeopleComponents.datefield(layout.find("#billing-fromdate")).getValue().dateString,toDate=ZPeopleComponents.datefield(layout.find("#billing-todate")).getValue().dateString,void 0!=fromDate&&void 0!=toDate||(Timetracker.Util.appenErrorMsgForElem({obj:layout.find(void 0==fromDate?"#billing-fromdate":"#billing-todate"),msg:ZPI18N.getString("zp.enterfromtodate")}),billcheck=!1),void 0===fromDate||Calendar.isvalidDate(fromDate)||(Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#billing-fromdate"),msg:ZPI18N.getString("zp.invalidfromdate")}),billcheck=!1),void 0===toDate||Calendar.isvalidDate(toDate)||(Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#billing-todate"),msg:ZPI18N.getString("zp.invalidtodate")}),billcheck=!1),void 0!=fromDate&&void 0!=toDate)){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);if(fdate>tdate)Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#billing-todate"),msg:ZPI18N.getString("zp.greaterfromdate")}),billcheck=!1;else Timetracker.DateTime.getDateDiff(fdate,tdate)>31&&(Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#billing-fromdate"),msg:ZPI18N.getString("zp.datewithindays",["30"])}),Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#billing-todate")}),billcheck=!1)}if(!billcheck)return!1;TimetrackerOperations.Filters.setSelectedPeriodDetails(layout,"billing-fromdate","billing-todate"),params.clientId=clientId,params.fromDate=fromDate,params.toDate=toDate;var tempObj=Object.assign({},params);tempObj.mode=!0,TimetrackerOperations.billing.BillingCriteria=tempObj,modal.find("#zp_modal_blubtn").prop("disabled",!0),$.post(Timetracker.constants.URL,params,function(result){if(modal.find("#zp_modal_blubtn").prop("disabled",!1),1===result.length)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.nologhours",[ZPI18N.getString("zp.smallbill")])),!1;TimetrackerOperations.billing.constructNewBill(result)})}else Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#billing-client"),msg:ZPI18N.getString("zp.chooseclienterror")})},constructNewBill:async function(result,billId){var clientdata,modal=settingsPage.container.find("#billGenerateStep2");0==modal.length?modal=TimetrackerOperations.billing.constructBillGenerationPopup():(ModuleComp.Modal.hide("addBillsPage"),ModuleComp.Modal.show(modal)),Timetracker.util.removeErrorMsg(void 0,modal),0!=modal.find("#billprint").length&&ZPeopleComponents.menu(modal.find("#billprintBtn")).destroy(),modal.find("#billing-billtbody").html(""),modal.find("#billing-billno,#billing-billdate,#billing-duedate").attr("disabled",!1).removeClass("zpl_DNI"),modal.find("#billgenerate_print").remove(),modal.find("#deletedtaxesindication,#billing-billno_view,#billing-billdate_view,#billing-duedate_view").addClass("zpl_DNI");var taxFilterOpt="";if(TimetrackerOperations.billing.BillEditRow.viewMode){var downloadHtml='<div class="zpl_mhderrgt" id="billgenerate_print"><i type="button" class="zpl_ibg zpl_drpdwn-js PI_edt" title="'+ZPI18N.getString("zp.edit")+'" id="editIcon" onclick="TimetrackerOperations.billing.confirmEditBill(\''+billId+"');\"></i>";downloadHtml+='<i type="button" class="zpl_ibg zpl_drpdwn-js PI_more" title="'+ZPI18N.getString("zp.more")+'" id="billprintBtn"></i></div>',modal.find("._cls").before(downloadHtml),modal.find("#billno_label,#billdate_label,#duedate_label").removeClass("zpl_mtry");var moreOpt=[{id:"billDownloadIcon",name:ZPI18N.getString("zp.downloadpdf"),callback:"TimetrackerOperations.billing.exportAsPdf",iClass:"PI_ft_pdf zpl_icnobg"},{id:"billPrintIcon",name:ZPI18N.getString("zp.print"),callback:"TimetrackerOperations.billing.printBill",iClass:"PI_print"}];Timetracker.Util.constructMoreOption(moreOpt,"billprint")}else{if(modal.find("#billno_label,#billdate_label,#duedate_label").addClass("zpl_mtry"),null===Timetracker.billingSettings.taxData){let[data]=await ZPeople.Request.sendRequestAsPromise("/timesheet.zp",{mode:"getTaxes",conreqcsr:csrfToken});Timetracker.billingSettings.taxData=data}$.each(Timetracker.billingSettings.taxData,function(index,data){taxFilterOpt+='<option value="'+data.taxId+'" taxPerCent="'+data.taxPerCent+'">'+data.taxName+" - "+data.taxPerCent+"% </option>"})}var totamt=0;if($.each(result,function(index,data){if(0===index)clientdata=data,modal.data("billData",clientdata);else{var hours=amount=ratePerHour=discount=0,txt="<tr><td><span>"+index+"</span></td>";if(txt+='<td><div class="zpl_cstnmes"><span>'+data.jobName+"</span>",data.empName&&(txt+="<font>.</font><span>"+data.empName+"</span>"),data.projectName&&(txt+="<font>.</font><em>"+data.projectName+"</em>"),txt+="</div></td>",TimetrackerOperations.billing.BillEditRow.viewMode||TimetrackerOperations.billing.BillEditRow.editMode?(hours=data.hours,amount=data.amount,ratePerHour=data.rate,discount=data.discount):(data.totalHours&&(hours=Calendar.minstodecimal(data.totalHours)),data.ratePerHour&&(amount=(hours*data.ratePerHour).toFixed(2),ratePerHour=data.ratePerHour)),ratePerHour=Number(ratePerHour).toFixed(2),discount=Number(discount).toFixed(2),totamt+=Number(amount),TimetrackerOperations.billing.BillEditRow.viewMode)txt+="<td><span>"+hours+"</span></td>",txt+="<td><span>"+ratePerHour+"</span></td>",txt+="<td><span>"+discount+"</span></td>",data.taxName?txt+='<td><div class="viewTax" taxId="'+data.taxId+'" taxPercent="'+data.taxPercent+'"><em>'+data.taxName+"</em> - "+data.taxPercent+"%</div></td>":txt+="<td><span>-</span></td>";else if(txt+='<td><span><input type="text" class="ztextbox w60" value="'+hours+'"  onkeyup="TimetrackerOperations.billing.calculate(this);"/></span></td>',txt+='<td><span><input type="text" class="ztextbox w60" value="'+ratePerHour+'"  onkeyup="TimetrackerOperations.billing.calculate(this);"/></span></td>',txt+='<td><span><input type="text" class="ztextbox w60" value="'+discount+'"  onkeyup="TimetrackerOperations.billing.calculate(this);"/></span></td>',TimetrackerOperations.billing.BillEditRow.editMode)if(!0===data.isActive&&-1===Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.billingSettings.taxData,data.taxId,"taxId")&&(data.isActive=!1),!1===data.isActive)txt+='<td><select data-width="200">'+(taxFilterOpt+'<option value="'+data.taxId+'" taxPerCent="'+data.taxPercent+'">'+data.taxName+" - "+data.taxPercent+"%  ** </option></select>")+"</select></td>",modal.find("#deletedtaxesindication").removeClass("zpl_DNI");else txt+='<td><select data-width="200">'+taxFilterOpt+"</select></td>";else txt+='<td><select data-width="200">'+taxFilterOpt+"</select></td>";txt+='<td><span id="job_total_amt">'+Number(amount).toFixed(2)+"</span></td></tr>";var txtEle=$(txt);txtEle.data(data),modal.find("#billing-billtbody").append(txtEle),TimetrackerOperations.billing.BillEditRow.viewMode||ZPeopleComponents.select(txtEle.find("select"),{placeholder:ZPI18N.getString("zp.selecttax"),change:TimetrackerOperations.billing.calculateTax,dropdownList:{moveOnScroll:!0},clearButton:!0}).deselectAllOptions(),TimetrackerOperations.billing.BillEditRow.editMode&&!TimetrackerOperations.billing.BillEditRow.viewMode&&data.taxId&&TimelyZComp.select.setValue(txtEle.find("select"),data.taxId)}}),"0"===clientdata.currencyCode){if(null===TimetrackerOperations.billing.currenciesData){let[data]=await ZPeople.Request.sendRequestAsPromise("/timesheet.zp",{mode:"getCurrencies",conreqcsr:csrfToken});TimetrackerOperations.billing.currenciesData=data}clientdata.currencyCode=TimetrackerOperations.billing.currenciesData[0].currencyCode}modal.find("#billing-stotalcur,#billing-totalcur").html(clientdata.currencyCode),modal.find("#billing-clientName").html(clientdata.clientName).data("clientId",clientdata.clientId);var address="";if(clientdata.streetAddr&&null!=clientdata.streetAddr&&"null"!=clientdata.streetAddr&&(address+=clientdata.streetAddr),clientdata.city&&null!=clientdata.city&&"null"!=clientdata.city&&(address+="\n"+clientdata.city),clientdata.state&&null!=clientdata.state&&"null"!=clientdata.state&&(address+="\n"+clientdata.state),clientdata.country&&"0"!==clientdata.country&&"null"!==clientdata.country&&(address+="\n"+clientdata.country),clientdata.pincode&&null!=clientdata.pincode&&"null"!=clientdata.pincode&&(address+=" - "+clientdata.pincode),modal.find("#billing-clientAddress").html(address),clientdata.billno&&null!=clientdata.billno?modal.find("#billing-billno").val(ZPeople.decodeTxt(clientdata.billno)):modal.find("#billing-billno").val(""),modal.find("#billing-subtotal,#billing-total").html(totamt.toFixed(2)).data("amount",totamt),modal.find("#zp_modal_header").html(ZPI18N.getString("zp.billfor",[" "])+clientdata.clientName),modal.find("#generatebill_back,#billgeneration_totalsteps,#generatebill_submit").removeClass("zpl_DNI"),modal.find("#generatebill_close").html(ZPI18N.getString("zp.cancel")),modal.find("[id^='billing-billtrow']").remove(),TimetrackerOperations.billing.BillEditRow.viewMode)modal.find("#pdfbillId").val(TimetrackerOperations.billing.BillEditRow.data.billingId),modal.find("#generatebill_submit,#billing-billno,#billing-billdate,#billing-duedate").addClass("zpl_DNI"),modal.find("#generatebill_close").html(ZPI18N.getString("zp.close")),modal.find("#billing-billdate_view").html(clientdata.billDate),modal.find("#billing-duedate_view").html(clientdata.dueDate),modal.find("#billing-billno_view").html(clientdata.billno),modal.find("#billing-billno_view,#billing-billdate_view,#billing-duedate_view").removeClass("zpl_DNI");else{var config={calendarIcon:!0,format:dateFmt,picker:!0,spinButtons:"none",clearButton:"none"};ZPeopleComponents.datefield(modal.find("[name=date]"),config),ZPeopleComponents.datefield(modal.find("#billing-billdate")).setValue(Calendar.formatDate(Calendar.getCurrentDay().day,uidateFormat))}(TimetrackerOperations.billing.BillEditRow.editMode||TimetrackerOperations.billing.BillEditRow.viewMode)&&(TimetrackerOperations.billing.calculateTax(),TimetrackerOperations.billing.BillEditRow.editMode&&(ZPeopleComponents.datefield(modal.find("#billing-billdate")).setValue(clientdata.billDate,uidateFormat),ZPeopleComponents.datefield(modal.find("#billing-duedate")).setValue(clientdata.dueDate,uidateFormat))),(TimetrackerOperations.billing.BillEditRow.editMode||TimetrackerOperations.billing.BillEditRow.viewMode||!TimetrackerOperations.billing.BillingCriteria.mode)&&modal.find("#generatebill_back,#billgeneration_totalsteps").addClass("zpl_DNI"),Timetracker.util.removeErrorMsg("addBillsPage"),ModuleComp.Modal.hide("addBillsPage"),ModuleComp.Modal.show(settingsPage.container.find("#billGenerateStep2"))},calculate:function(obj){obj=$(obj);var modal=settingsPage.container.find("#billGenerateStep2"),subtotal=modal.find("#billing-subtotal").data("amount"),trObj=obj.closest("tr"),inputs=trObj.find("input"),hours=0,rateperhour=0,discount=0;if(""!==$(inputs[0]).val()&&(hours=$(inputs[0]).val()),isNaN(hours)||hours<0)return $(inputs[0]).addClass("ztextbox__error"),!1;if($(inputs[0]).removeClass("ztextbox__error"),""!==$(inputs[1]).val()&&(rateperhour=$(inputs[1]).val()),isNaN(rateperhour)||rateperhour<0)return $(inputs[1]).addClass("ztextbox__error"),!1;if($(inputs[1]).removeClass("ztextbox__error"),""!==$(inputs[2]).val()&&(discount=$(inputs[2]).val()),isNaN(discount)||discount<0||discount>100)return $(inputs[2]).addClass("ztextbox__error"),!1;$(inputs[2]).removeClass("ztextbox__error");var oldamt=trObj.find("#job_total_amt").html(),newamt=hours*rateperhour,diffamt=(newamt=(newamt-=newamt*discount/100).toFixed(2))-(oldamt=(oldamt=Number(oldamt)).toFixed(2));trObj.find("#job_total_amt").html(newamt),subtotal+=diffamt,(isNaN(subtotal)||subtotal<0)&&(subtotal=0),modal.find("#billing-subtotal").html(subtotal.toFixed(2)).data("amount",subtotal),TimetrackerOperations.billing.calculateTax()},calculateTax:function(){var allObj={},modal=settingsPage.container.find("#billGenerateStep2");modal.find("#billing-billtbody").find("tr").each(function(){var trObj=$(this),selectEle=trObj.find("select option:selected"),taxPerCent=selectEle.attr("taxPerCent"),taxName=selectEle.text().trim(),taxId=selectEle.val();if(TimetrackerOperations.billing.BillEditRow.viewMode){var obj=trObj.find(".viewTax");0==obj.length?(taxId=taxName="",taxPerCent=0):(taxPerCent=$(obj).attr("taxPercent"),taxName=$(obj).html(),taxId=$(obj).attr("taxId"))}if(!taxId||""==taxId)return!0;var amount=trObj.find("#job_total_amt").html();""===amount&&(amount=0),amount=Number(amount);allObj[taxId]?allObj[taxId].amount=allObj[taxId].amount+amount:allObj[taxId]={taxId:taxId,taxName:taxName,taxPerCent:taxPerCent,amount:amount}}),modal.find("[id^='billing-billtrow']").remove();var totAmt=0;for(var key in allObj){var name=key,value=allObj[key],taxAmt=0;if(""!==name&&(taxAmt=(taxAmt=value.amount*value.taxPerCent/100).toFixed(2))>0){var tName=value.taxName;if(!TimetrackerOperations.billing.BillEditRow.viewMode){let lastIndex=tName.lastIndexOf("-");tName="<em>"+ZPeople.escapeHtml(tName.substring(0,lastIndex))+"</em>"+ZPeople.escapeHtml(tName.substring(lastIndex))}var txt='<tr id="billing-billtrow-'+value.taxId+'"><td colspan="5"></td><td><span><span><b>'+tName+" :</b></span></span></td><td><span><b>"+taxAmt+"</b></span></td></tr>";modal.find("#billing-totaltbody").before(txt)}totAmt+=Number(taxAmt)}totAmt=modal.find("#billing-subtotal").data("amount")+totAmt,(isNaN(totAmt)||totAmt<0)&&(totAmt=0),modal.find("#billing-total").html(totAmt.toFixed(2)).data("amount",totAmt)},createBill:function(){var modal=settingsPage.container.find("#billGenerateStep2");Timetracker.util.removeErrorMsg(void 0,modal);var clientId=modal.find("#billing-clientName").data().clientId,billno=modal.find("#billing-billno").val().trim(),billDate=ZPeopleComponents.datefield(modal.find("#billing-billdate")).getValue().dateString,dueDate=ZPeopleComponents.datefield(modal.find("#billing-duedate")).getValue().dateString,subTotal=modal.find("#billing-subtotal").data("amount"),totalAmount=modal.find("#billing-total").data("amount"),currencyCode=modal.find("#billing-stotalcur").html().trim(),billcheck=!0;""==billno&&(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#billing-billno"),msg:ZPI18N.getString("zp.billnoempty")}),billcheck=!1),void 0==billDate&&(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#billing-billdate"),msg:ZPI18N.getString("zp.billdateempty")}),billcheck=!1),void 0==dueDate&&(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#billing-duedate"),msg:ZPI18N.getString("zp.duedateempty")}),billcheck=!1);var billingbilldate=ZPeopleComponents.datefield(modal.find("#billing-billdate")).getValue().dateString,billingduedate=ZPeopleComponents.datefield(modal.find("#billing-duedate")).getValue().dateString;(billingbilldate&&!Calendar.isvalidDate(billingbilldate)&&(billcheck=Timetracker.util.validateFunction("billing-billdate",null,ZPI18N.getString("zp.invaliddate"),"span",billcheck)),billingduedate&&!Calendar.isvalidDate(billingduedate)&&(billcheck=Timetracker.util.validateFunction("billing-duedate",null,ZPI18N.getString("zp.invaliddate"),"span",billcheck)),billingbilldate&&""!=billingbilldate&&billingduedate&&""!=billingduedate)&&(Calendar.parseDate(billingbilldate,uidateFormat)>Calendar.parseDate(billingduedate,uidateFormat)&&(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#billing-duedate"),msg:ZPI18N.getString("zp.duedateless")}),billcheck=!1));if(!billcheck)return!1;(isNaN(totalAmount)||totalAmount<0)&&(totalAmount=0);var itemArray=[];if(0===modal.find("#billing-billtbody").find("tr").length)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.nologhours",[ZPI18N.getString("zp.smallbill")])),!1;var editCount=0;if(modal.find("#billing-billtbody").find("tr").each(function(index){var trObj=$(this),data=trObj.data(),inputEle=trObj.find("input"),itemObj={},hours=$(inputEle.get(0)).val().trim(),rate=$(inputEle.get(1)).val().trim(),discount=$(inputEle.get(2)).val().trim(),taxId=trObj.find("select").val();if(""===hours&&(hours=0),(isNaN(hours)||hours<0)&&($(inputEle[0]).addClass("ztextbox__error"),billcheck=!1),""===rate&&(rate=0),(isNaN(rate)||rate<0)&&($(inputEle[1]).addClass("ztextbox__error"),billcheck=!1),""===discount&&(discount=0),(isNaN(discount)||discount<0||discount>100)&&($(inputEle[2]).addClass("ztextbox__error"),billcheck=!1),itemObj.hours=hours,itemObj.rate=rate,itemObj.discount=discount,itemObj.amount=rate*hours-rate*hours*discount/100,itemObj.jobId=data.jobId,data.erecno&&(itemObj.erecno=data.erecno),data.itemId&&(itemObj.itemId=data.itemId),taxId&&""!==taxId&&(itemObj.taxId=taxId),itemArray.push(itemObj),TimetrackerOperations.billing.BillEditRow.editMode){var jobBillingDetails=TimetrackerOperations.billing.BillEditRow.data.details[index+1];jobBillingDetails.hours==itemObj.hours&&jobBillingDetails.rate==itemObj.rate&&jobBillingDetails.discount==itemObj.discount&&jobBillingDetails.taxId==itemObj.taxId&&jobBillingDetails.jobId==itemObj.jobId&&editCount++}}),!billcheck)return!1;var isEdited=!0;if(TimetrackerOperations.billing.BillEditRow.editMode&&TimetrackerOperations.billing.BillEditRow.data.billno==billno&&TimetrackerOperations.billing.BillEditRow.data.billDate==billDate&&TimetrackerOperations.billing.BillEditRow.data.dueDate==dueDate&&editCount===itemArray.length&&(isEdited=!1),isEdited){var params={mode:"createBill",clientId:clientId,billno:billno,billDate:billDate,dueDate:dueDate,itemArray:JSON.stringify(itemArray),subTotal:subTotal,totalAmount:totalAmount,currencyCode:currencyCode,conreqcsr:csrfToken};TimetrackerOperations.billing.BillEditRow.editMode?(params.mode="modifyBill",params.billingId=TimetrackerOperations.billing.BillEditRow.data.billingId):TimetrackerOperations.billing.BillingCriteria.mode&&(params.fromDate=TimetrackerOperations.billing.BillingCriteria.fromDate,params.toDate=TimetrackerOperations.billing.BillingCriteria.toDate,params.jobId=TimetrackerOperations.billing.BillingCriteria.jobId,params.approvalStatus=TimetrackerOperations.billing.BillingCriteria.approvalStatus,params.userErecNo=TimetrackerOperations.billing.BillingCriteria.userErecNo,params.approvalStatus=TimetrackerOperations.billing.BillingCriteria.approvalStatus,params.projectId=TimetrackerOperations.billing.BillingCriteria.projectId),modal.find("#generatebill_submit").prop("disabled",!0),$.post("/timesheet.zp",params,function(resultData){ModuleComp.Modal.hide("billGenerateStep2"),Timetracker.Validations.isDefiniteValue(resultData)&&Timetracker.Validations.isDefiniteValue(resultData.billdetails)?"createBill"===params.mode?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.billgeneratedsuccess")),TimetrackerOperations.billing.appendAddedEditedBillRow(resultData.billdetails,!0)):"modifyBill"===params.mode&&(Timetracker.util.showAlert(2,ZPI18N.getString("zp.billeditsuccess")),TimetrackerOperations.billing.appendAddedEditedBillRow(resultData.billdetails,!1)):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg")),modal.find("#generatebill_submit").prop("disabled",!1)})}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")),ModuleComp.Modal.hide("billGenerateStep2")},printBill:function(){var header=Layout.Page.container.find("#billGenerateStep2").find("#zp_modal_header").text();Timetracker.Print.printPage({divId:"generate_bill_print",header:header})},exportAsPdf:function(){var billId=settingsPage.container.find("#billGenerateStep2").data("billData").billingId;if(void 0!=billId){var requestUrl="timesheet.zp?mode=exportBillsDetails&billId="+billId+"&convertPDF=true";Timetracker.ImportExport.submiteFormForExport(requestUrl)}},filterOnChangeCallback:function(event){var entity;entity=null==event||"string"==typeof event?this.ele.attr("compname"):$(event.target).attr("compname");var container=settingsPage.container.find("#addBillsPage").find("#filterDiv");switch(entity){case"employee":case"client":TimetrackerOperations.Filters.clearCache(!1,"project"),filterDiv=container.find('[compname="project"]'),TimelyZComp.tokenField.removeAllTokens(filterDiv);case"project":TimetrackerOperations.Filters.clearCache(!1,"job"),filterDiv=container.find('[compname="job"]'),TimelyZComp.tokenField.removeAllTokens(filterDiv);break;case"period":filterDiv=container.find('[compname="period"]'),6==TimelyZComp.select.getValue(filterDiv)?(TimetrackerOperations.Filters.resetFromToDate(container,"billing-fromdate","billing-todate"),container.find("#customDateDiv").removeClass("zpl_DNI")):container.find("#customDateDiv").addClass("zpl_DNI")}},mail:{showSendMailPopup:function(billId,obj){var mailDetails=$(obj).closest("tr").data().mailDetails;$(obj).off("click"),void 0===mailDetails||null===mailDetails?$.post("/timesheet.zp",{mode:"getDetailsMailInvoice",billId:billId,conreqcsr:csrfToken},function(resultData){TimetrackerOperations.billing.mail.showSendMailPopupDetails(billId,resultData),$(obj).closest("tr").data("mailDetails",resultData),$(obj).click(function(){TimetrackerOperations.billing.mail.showSendMailPopup(billId,this)})}):(TimetrackerOperations.billing.mail.showSendMailPopupDetails(billId,mailDetails),$(obj).click(function(){TimetrackerOperations.billing.mail.showSendMailPopup(billId,this)}))},showSendMailPopupDetails:function(billId,resultData){var modal=settingsPage.container.find("#mailBill");0==modal.length?modal=TimetrackerOperations.billing.mail.constructSendMailPopup():ModuleComp.Modal.show(modal);var subject=ZPI18N.getString("zp.invoicemailsubject",[resultData.companyName,ZPeople.decodeTxt(resultData.billNo)]);modal.find("#invoice_from").val(resultData.emailId),modal.find("#invoice_subject").val(subject),modal.find("#invoice_to,#invoice_cc").val(""),modal.find("#invoice_attachment").attr("checked",!0),modal.find("#invoice_filename").html("<i class='PI_ft_pdf zpl_icnobg' title='"+ZPI18N.getString("zp.invoice")+"'></i> INV-"+resultData.billNo+".pdf"),modal.find("#zp_modal_blubtn").data("billId",billId).data("billNo",resultData.billNo),ZPA_Editor.createEditor("msgEditor",resultData.bodyContent.replace(/\n\r?/g,"<br />"))},constructSendMailPopup:function(){var body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn zpl_mailtmp"><div><label>'+ZPI18N.getString("zp.from")+'</label></div><div><input id="invoice_from" class="ztextbox"></div></div><div class="zpl_secn zpl_mailtmp"><div><label>'+ZPI18N.getString("zp.to")+'</label></div><div><input id="invoice_to" class="ztextbox"></div></div><div class="zpl_secn zpl_mailtmp"><div><label>'+ZPI18N.getString("zp.cc")+'</label></div><div><input id="invoice_cc" class="ztextbox"></div></div><div class="zpl_secn zpl_mailtmp"><div><label>'+ZPI18N.getString("zp.subject")+'</label></div><div><input id="invoice_subject" class="ztextbox"></div></div><div class="zpl_secn zpl_mailtmp"><div></div><div><div class="zcheckbox zcheckbox--horizontal"><input type="checkbox"  class="zcheckbox__helper" id="invoice_attachment"><label class="zcheckbox__label" for="invoice_attachment" id="invoice_filename"></label></div></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.message")+'</label></div><div id="msgEditor" class="zpl_msgedtr"></div></div>';return ModuleComp.Modal.setup({id:"mailBill",type:1,header:ZPI18N.getString("zp.invoice"),body:body,backdrop:!0,closeOnSubmit:!1,buttonValue:ZPI18N.getString("zp.send"),successCallback:TimetrackerOperations.billing.mail.sendInvoiceMail,closeonEsc:!0})},sendInvoiceMail:function(){var modal=settingsPage.container.find("#mailBill");Timetracker.util.removeErrorMsg("mailBill",modal,!0);var obj=modal.find("#zp_modal_blubtn"),toAddr=modal.find("#invoice_to").val(),ccAddr=modal.find("#invoice_cc").val(),mailSubject=modal.find("#invoice_subject").val(),mailContent=editor.getContent().replace(/\n\r?/g,"<br />"),params={mode:"sendMailInvoice",conreqcsr:csrfToken};if(params.billId=$(obj).data().billId,params.mailAttachment=!1,modal.find("#invoice_attachment").is(":checked")&&(params.mailAttachment=!0),""===toAddr.trim())return Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#invoice_to"),msg:ZPI18N.getString("zp.emptytoaddress")}),!1;if(""!==toAddr.trim()){for(var toAddrs=toAddr.split(","),i=0;i<toAddrs.length;i++)if(!toAddrs[i].match(Timetracker.util.emailRegex))return Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#invoice_to"),msg:ZPI18N.getString("zp.invalidtoaddress")}),!1;params.toAddr=toAddr}if(""!==ccAddr.trim()){var ccAddrs=ccAddr.split(",");for(i=0;i<ccAddrs.length;i++)if(!ccAddrs[i].match(Timetracker.util.emailRegex))return Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#invoice_cc"),msg:ZPI18N.getString("zp.invalidccaddress")}),!1;params.ccAddr=ccAddr}return""===mailSubject.trim()?(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#invoice_subject"),msg:ZPI18N.getString("zp.emptysubject")}),!1):(params.mailSubject=mailSubject,""===mailContent.trim()?(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#msgEditor"),msg:ZPI18N.getString("zp.emptybody")}),!1):(params.mailAttachment?params.mailContent=mailContent:params.mailContent=mailContent.replace("The invoice INV-"+$(obj).data().billNo+" is attached with this email.",""),modal.find("#zp_modal_blubtn").prop("disabled",!0),void ZPeople.Request.send("/timesheet.zp",params,TimetrackerOperations.billing.mail.mailSentSuccess)))},mailSentSuccess:function(resultData){settingsPage.container.find("#mailBill").find("#zp_modal_blubtn").prop("disabled",!1),ModuleComp.Modal.hide("mailBill"),resultData&&("success"===resultData.isSent?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.mailsent")),resultData.isQBOEnabled&&(TimetrackerOperations.billing.isQBOEnabled=resultData.isQBOEnabled),TimetrackerOperations.billing.construct(resultData.billDetails)):Timetracker.util.showAlert(1,ZPI18N.getString("zp.mailnotsent")))}},pushToService:{pushToInvoice:function(billId,isPushedAlready,organisationId,isBooks){if("true"===isPushedAlready)return void 0!==isBooks?Timetracker.util.showAlert(1,ZPI18N.getString("zp.pushedtobooksalready")):Timetracker.util.showAlert(1,ZPI18N.getString("zp.pushedtoinvoicealready")),!1;isBooks?settingsPage.container.find("#"+billId).find("[ref=zbooks]").off("click"):settingsPage.container.find("#"+billId).find("[ref=zinvoice]").off("click"),$.post("/timesheet.zp",{mode:"pushToInvoice",billId:billId,invoiceOrgId:organisationId,isBooks:isBooks,conreqcsr:csrfToken},function(resultData){if(resultData)if(resultData.isQBOEnabled&&(TimetrackerOperations.billing.isQBOEnabled=resultData.isQBOEnabled),TimetrackerOperations.billing.construct(resultData.billDetails),(resultData=resultData.invoiceResponse).response&&!0===resultData.response)void 0!==isBooks?Timetracker.util.showAlert(2,ZPI18N.getString("zp.bookspushedsuccess")):Timetracker.util.showAlert(2,ZPI18N.getString("zp.invoicepushedsuccess"));else if("authError"===resultData.message)Timetracker.util.showAlert(0,ZPI18N.getString("zp.invoiceautherror"));else if("orgError"===resultData.message){var orgArray=resultData.orgArray;0==orgArray.length?void 0!==isBooks?Timetracker.util.showAlert(0,ZPI18N.getString("zp.nobooksorgfound")):Timetracker.util.showAlert(0,ZPI18N.getString("zp.noinvoiceorgfound")):(TimetrackerOperations.billing.isBooksInteg=void 0!==isBooks,TimetrackerOperations.billing.pushToService.showInvoiceOrgdetails(billId,orgArray))}else Timetracker.util.showAlert(0,resultData.message)})},pushToQBO:function(billId,isPushedAlready){if(isPushedAlready)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.tt.qboinvoicepushedalready")),!1;TimetrackerOperations.billing.qbopushdata&&TimetrackerOperations.billing.qbopushdata.isAPICalled?Timetracker.util.showAlert(1,ZPI18N.getString("zp.tt.qboinvoicebeingpushed")):(TimetrackerOperations.billing.qbopushdata.billId=billId,TimetrackerOperations.billing.qbopushdata.isAPICalled=!0,Timetracker.util.showAlert(2,ZPI18N.getString("zp.tt.qboinvoicebeingpushed")),$.post("/quickbooks/pushToQBO",{billId:billId,conreqcsr:csrfToken},function(resultData){if(TimetrackerOperations.billing.qbopushdata.isAPICalled=!1,resultData&&(resultData.isQBOEnabled&&(TimetrackerOperations.billing.isQBOEnabled=resultData.isQBOEnabled),TimetrackerOperations.billing.construct(resultData.billDetails),resultData.qboResponse)){var msg=resultData.qboResponse.msg;msg&&"success"==msg?Timetracker.util.showAlert(2,ZPI18N.getString("zp.tt.qboinvoicesuccessful")):msg&&"failed"==msg&&resultData.qboResponse.errmsg?Timetracker.util.showAlert(0,resultData.qboResponse.errmsg):Timetracker.util.showAlert(0,ZPI18N.getString("zp.tt.qboinvoicefail"))}}))},showInvoiceOrgdetails:function(billId,orgArray){for(var header='<h4 id="zp_modal_header" class="modal-title">'+ZPI18N.getString("zp.chooseyourorganization")+"</h4>",body='<div class="container-fluid"><p class="text-center LH20">You belong to the following organization.<br>Please Select the organization to which the data is to be pushed</p><div class="org-main">',i=0;i<orgArray.length;i++){var orgobj=orgArray[i];body+=0===i?'<div class="org-box active MT10"':'<div class="org-box MT10"',body+=' id="org_'+orgobj.organization_id+'" billId="'+billId+'" orgId="'+orgobj.organization_id+'" onclick="TimetrackerOperations.billing.pushToService.changeOrgSelection(\''+orgobj.organization_id+"');\"><h5>"+orgobj.name+'</h5><p class="gry"><label>Created Date :</label><span>'+orgobj.account_created_date_formatted+'</span></p><p class="gry"><label>Currency Type:</label><span>'+orgobj.currency_code+"</span></p></div>"}body+="</div></div>",ZPeople.BSModal.get({id:"billing-alert-multipleOrg-Invoice",type:1,body:body,deleteOnHide:!0,closeOnSubmit:!0,buttonValue:ZPI18N.getString("zp.submit"),successCallback:TimetrackerOperations.billing.pushToService.onChoosingOrganisation}),Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".modal-header").find("#zp_modal_header").remove(),0==Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".modal-header").find(".Icn.orgbg").length&&Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".modal-header").prepend('<div class="Icn orgbgi"><i class="IC-org-l whi S24"></i></div>'),Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".modal-header").append(header),ZPeople.BSModal.show(Layout.Page.container.find("#billing-alert-multipleOrg-Invoice"))},changeOrgSelection:function(orgId){Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".org-main").find(".active").removeClass("active"),Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find("#org_"+orgId).addClass("active")},onChoosingOrganisation:function(){var billId=Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".active").attr("billId"),invoiceOrgId=Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".active").attr("orgId");TimetrackerOperations.billing.isBooksInteg?TimetrackerOperations.billing.pushToService.pushToInvoice(billId,!1,invoiceOrgId,"1"):TimetrackerOperations.billing.pushToService.pushToInvoice(billId,!1,invoiceOrgId)}},destroyZComp:function(modal,extraDtls){"billGenerateStep2"==(void 0!=modal?modal.attr("id"):"addBillsPage")&&(modal=modal||$(settingsPage.mainWrapId).find("#billGenerateStep2"),ZPeopleComponents.datefield(modal.find("#billing-billdate")).destroy(),ZPeopleComponents.datefield(modal.find("#billing-duedate")).destroy(),TimetrackerOperations.billing.BillEditRow.viewMode||modal.find("#billing-billtbody").find("tr").each(function(){var trObj=$(this);TimelyZComp.select.destroy(trObj.find("select"))}))},Firescroll:{mode:"TTOP_BILLING_FIRESCROLL",loadMoreData:function(response){if((response=response&&response.billDetails?response.billDetails:null)&&response.length>0){var tableBody=Layout.Page.container.find("#billing-listtbody");$.each(response,function(index,data){tableBody.append(TimetrackerOperations.billing.constructRowHtml(data))})}Timetracker.FireScroll.setFetchCount(TimetrackerOperations.billing.Firescroll.mode,response)}}},TimetrackerOperations.integrations={serviceList:null,mode:"TT_INTEGRATIONS",isAlreadyStarted:!1,init:function(){TimetrackerOperations.init(),Timetracker.permissionCheckForOperPages()&&(TimetrackerOperations.integrations.getReportPage(),TimetrackerOperations.Filters.clearCache(!0))},clickHandler:function(event){var ele=event.target,ref=$(ele).attr("ref");if(0!=$(ele).closest("tr").length){var data=$(ele).closest("tr").data("rowdata");if(void 0===data)return;if("push"==ref){var service=TimelyZComp.select.getValue(settingsPage.container.find("#integServiceChanger"),!1);TimetrackerOperations.integrations.pushTimelogs(ele,service,data.fromDate,data.toDate,data.billStatus,data.isPushedAlready)}}else"changeView"==ref?TimetrackerOperations.integrations.changeView(ele):"toggleFilter"==ref?TimetrackerOperations.integrations.consturctFilter():"applyFilter"==ref?TimetrackerOperations.integrations.applyFilter():"resetFilter"==ref&&TimetrackerOperations.integrations.resetFilter()},getReportPage:function(){0==settingsPage.container.find("#timetrackerIntegrationReport").length&&TimetrackerOperations.integrations.constructIntegPage(),TimetrackerOperations.integrations.getIntegPage(),TimelyZComp.toolTip.intiliaze()},constructIntegPage:function(){var html='<div class="zpl_btnmnu"><div><select  id="integServiceChanger" class="select-js" style="display: none;"></select></div><div class="zpl_cntrdv"><div class="zpl_inav"><i class="PI_alft" title="'+ZPI18N.getString("zp.previous")+'" id="goToPreviousBtn"></i><i class="PI_monthly" id="tl_datePicker"></i><i class="PI_argt" title="'+ZPI18N.getString("zp.next")+'" id="goToNextBtn"></i></div><b id="dateNavigatorText"></b></div><div class="zpl_rgt"><ul class="zpl_grpmnu" id="periodType"><li id="view_week" periodtype="daily" ref="changeView">'+ZPI18N.getString("zp.cday")+'</li><li ref="changeView" periodtype="weekly"  class="zpl_act" id="view_day">'+ZPI18N.getString("zp.week")+'</li></ul><i class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" ref="toggleFilter"></i></div></div>'+TimetrackerOperations.Filters.filterHeaderHtml+'<div class="zpl_rgtcnt"><div class="zpl_tblres" id="timetrackerIntegrationReport"><table class="zpl_tbl clm40 zpl_nocrsor" id="timetrackerIntegrationReportTable"><thead><tr><th>'+ZPI18N.getString("zp.employee")+"</th><th>"+ZPI18N.getString("zp.client")+"</th><th>"+ZPI18N.getString("zp.project")+"</th><th>"+ZPI18N.getString("zp.job")+"</th><th>"+ZPI18N.getString("zp.approvedhrsSmall")+"</th><th>"+ZPI18N.getString("zp.pushto")+'</th></tr></thead><tbody id="timetrackerIntegrationReportBody"></tbody></table></div></div>';settingsPage.container.append(html),settingsPage.container.addClass("zpl_tblfxd zpl_crdwthful"),Timetracker.Util.addEventListner(null,"click",TimetrackerOperations.integrations.clickHandler,!0)},getIntegPage:function(){TimetrackerOperations.Filters.clearCache(!0),null===TimetrackerOperations.integrations.serviceList&&ZPeople.Request.send(Timetracker.constants.URL,{mode:"getIntegrationDtlsForReport",conreqcsr:csrfToken},function(response){if(TimetrackerOperations.integrations.serviceList=response&&response.length>0?response:[],response&&response.length>0){TimetrackerOperations.integrations.serviceList=response;var txt="";$.each(response,function(index,service){txt+='<option value="'+service+'" id="'+service+'">'+service+"</option>"}),settingsPage.container.find("#integServiceChanger").append(txt),TimelyZComp.select.intialize(settingsPage.container.find("#integServiceChanger"),{change:function(){TimetrackerOperations.integrations.generateReport()}})}else TimetrackerOperations.integrations.serviceList=[];TimetrackerOperations.integrations.serviceList.length>0&&TimetrackerOperations.integrations.generateReport()});var dateNavigationDtls={};dateNavigationDtls.mode=TimetrackerOperations.integrations.mode,dateNavigationDtls.containerId=settingsPage.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.displayDateAsText=!0,dateNavigationDtls.unbindEventOnClick=!0,dateNavigationDtls.navigationCallback=TimetrackerOperations.integrations.generateReport,ZPCommonUtil.DateNavigator.init(dateNavigationDtls),ZPCommonUtil.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPCommonUtil.DateNavigator.TYPE.WEEKLY,ZPCommonUtil.DateNavigator.TENSE.CURRENT);var callback=function(dateVal,obj,data){settingsPage.container.find("#tl_datePicker").html("");var selPeriod="weekly"==settingsPage.container.find('[id="periodType"]').find(".zpl_act").attr("periodtype")?{from:data.fromDate,to:data.toDate,type:ZPCommonUtil.DateNavigator.TYPE.WEEKLY}:{day:dateVal,type:ZPCommonUtil.DateNavigator.TYPE.DAILY};ZPCommonUtil.DateNavigator.setPeriod(dateNavigationDtls.mode,selPeriod.type,void 0,!1,selPeriod),TimetrackerOperations.integrations.generateReport()};settingsPage.container.find("#tl_datePicker").off().on("click",function(event){var viewType=settingsPage.container.find('[id="periodType"]').find(".zpl_act").attr("periodtype");"weekly"==viewType?Calendar.setUpCalendar(event,this,void 0,void 0,callback,void 0,{weekselection:!0,constructOnWeekstarts:!0}):"daily"==viewType&&Calendar.setUpCalendar(event,this,0,void 0,callback,void 0,{constructOnWeekstarts:!0})})},generateReport:function(){TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter();var layout=settingsPage.container;layout.find("#timetrackerIntegrationReport").scrollTop(0),Timetracker.Util.showHideNoData({remove:!0}),layout.find("#tt_filterResultsHeader.timetracker").addClass("zpl_DNI"),layout.find("[id=zp_page_loading]").remove(),layout.find("#timetrackerIntegrationReport").before(ZPeople.LOADING_HTML),layout.find("#timetrackerIntegrationReport").addClass("zpl_DNI"),Timetracker.FireScroll.resetDataOnLoad(TimetrackerOperations.integrations.Firescroll.mode);var params=TimetrackerOperations.integrations.getParamsForReport();ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){if(Timetracker.Util.showHideNoData({remove:!0}),layout.find("[id=zp_page_loading]").remove(),response&&"permissionDenied"===response.error){var val='<div class="ZPNdata"><div id="noaccess"></div><h5>'+ZPI18N.getString("zp.permissiondeniedtoaccessthispage")+'</h5><p class="no-para"></p></div>';layout.find("#timetrackerIntegrationReport").before(val),Timetracker.Util.showHideNoData()}else if(response&&response.length>0){layout.find("#timetrackerIntegrationReport").removeClass("zpl_DNI");var tableBody=layout.find("#timetrackerIntegrationReportBody");tableBody.html(""),$.each(response,function(index,data){tableBody.append(TimetrackerOperations.integrations.constructReportRowHtml(data,params))}),TimelyZComp.toolTip.intiliaze(layout),Timetracker.FireScroll.initFireScroll(TimetrackerOperations.integrations.Firescroll.mode,Timetracker.constants.URL,params,TimetrackerOperations.integrations.Firescroll.loadMoreData,""),Timetracker.FireScroll.setFetchCount(TimetrackerOperations.integrations.Firescroll.mode,response)}else Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.prjctsync.nodatamsg"),layout:layout});TimetrackerOperations.Filters.setFilterHeader(TimetrackerOperations.integrations.removeTopFilter),ZPCommonUtil.DateNavigator.bindEvent(TimetrackerOperations.integrations.mode)})},constructReportRowHtml:function(data,params){var layout=settingsPage.container,service=TimelyZComp.select.getValue(layout.find("#integServiceChanger"),!1),clientName="---";void 0!==data.CLIENTNAME&&(clientName=data.CLIENTNAME);var projectName="---";void 0!==data.PROJECTNAME&&(projectName=data.PROJECTNAME);var pushedtime=data.pushedHrs||0,unpushedtime=data.unpushedHrs||0,totalapprovedhrs=data.totalHrs||0;data.fromDate=params.fromDate,data.toDate=params.toDate,data.billStatus=params.billStatus;var html='<tr class="ZPLRow">';html+='<td title="'+data.EMPNAME+'">'+data.EMPLOYEEID+" "+data.EMPNAME+"</td>",html+='<td title="'+clientName+'">'+clientName+"</td>",html+='<td title="'+projectName+'">'+projectName+"</td>",html+='<td title="'+data.JOBNAME+'">'+data.JOBNAME+"</td>",html+="<td>"+Calendar.minstohrs(totalapprovedhrs)+"</td>";var title_html="<ul><li class='ML10 MT5 MB5'><span class='S13'><i class='MR2 gry'></i> "+ZPI18N.getString("zp.tt.qbohourspushed")+" : "+Calendar.minstohrs(pushedtime)+"</span></li><li class='ML10 MT5 MB5'><span class='S13'><i class='MR2 gry'></i> "+ZPI18N.getString("zp.tt.qbohoursunpushed")+" : "+Calendar.minstohrs(unpushedtime)+"</span></li></ul>";return html+='<td><button ref="push" id="pushIcon_'+data.ERECNO+"_"+data.PROJECTID+'" title=" " class="zlabel zlabel--outline zlabel--small'+(data.isPushedAlready?"":" zlabel--blue")+'">'+service+"</button></td>",html+="</tr>",(html=$(html)).find("#pushIcon_"+data.ERECNO+"_"+data.PROJECTID).attr("data-title-inner-html",title_html),html.data({rowdata:data}),html},changeView:function(element){var selectedView=$(element).attr("periodtype");selectedView!==ZPCommonUtil.DateNavigator.getType(TimetrackerOperations.integrations.mode)&&(ZPCommonUtil.DateNavigator.TYPE.DAILY,$(element).addClass("zpl_act"),$(element).siblings().removeClass("zpl_act"),ZPCommonUtil.DateNavigator.setPeriod(TimetrackerOperations.integrations.mode,selectedView,ZPCommonUtil.DateNavigator.TENSE.CURRENT),TimetrackerOperations.integrations.generateReport())},consturctFilter:async function(){var layout=settingsPage.container;if(0==layout.find("#filterDiv").length){var extraParams={peopleLiteReportType:"orgReport",ignoreReportees:!0,peopleLiteReportType:"orgReport"};Timetracker.isDataAdminForAllUsers()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)&&(extraParams.customAdminAction=Timetracker.constants.TTCustomAdmin.ReportView),filterOpt={employee:{label:ZPI18N.getString("zp.employee"),id:"integ_emp",paramId:"userErecNo",extraParams:extraParams,filterCallback:!0,tokenField:!0},client:{label:Timetracker.util.getClientDisplayName(),paramId:"clientId",tokenField:!0},project:{label:Timetracker.util.getProjectDisplayName(),paramId:"projectId",tokenField:!0},job:{label:Timetracker.util.getJobDisplayName(),paramId:"jobId",tokenField:!0},billableStatus:{single:!0,label:ZPI18N.getString("zp.billablestatus"),paramId:"billStatus",defValue:-1},department:{label:ZPI18N.getString("zp.department"),paramId:"departmentId",tokenField:!0},location:{label:ZPI18N.getString("zp.location"),paramId:"locationId",tokenField:!0},designation:{label:ZPI18N.getString("zp.designation"),paramId:"designationId",tokenField:!0}},isOrgStructureEnabled&&(filterOpt.division={label:ZPeople.orgStructureDispNameMap.division,paramId:"divisionId",tokenField:!0},filterOpt.businessUnit={label:ZPeople.orgStructureDispNameMap.unit,paramId:"businessUnitId",tokenField:!0},filterOpt.legalEntity={label:ZPeople.orgStructureDispNameMap.entity,paramId:"legalEntityId",tokenField:!0}),await TimetrackerOperations.Filters.constructFilterDiv(filterOpt),TimelyZComp.select.setValue(layout.find("#filterDiv [compname='billableStatus']"),-1,!1),TimelyZComp.toolTip.intiliaze(layout.find("#filterDiv"))}TimetrackerOperations.Filters.toggleFilter()},setDefaultFilterParams:function(){TimetrackerOperations.Filters.clearFilters();var filterDiv=settingsPage.container.find("#filterDiv");TimelyZComp.select.setValue(filterDiv.find('[compname="billableStatus"]'),-1,!1)},resetFilter:function(){TimetrackerOperations.integrations.setDefaultFilterParams()},applyFilter:function(){TimetrackerOperations.integrations.generateReport()},getDefaultParams:function(){return{mode:"getIntegReportTimesheet",userErecNo:"0",clientId:"0",projectId:"0",jobId:"0",departmentId:"0",locationId:"0",designationId:"0",legalEntityId:"0",businessUnitId:"0",divisionId:"0",repType:"adminReports",conreqcsr:csrfToken}},getParamsForReport:function(){var params=TimetrackerOperations.integrations.getDefaultParams(),selectedService=TimelyZComp.select.getValue(settingsPage.container.find("#integServiceChanger"),!1);selectedService&&(selectedService===Timetracker.constants.integration.qb?params.service="quickBooks":selectedService===Timetracker.constants.integration.zb?params.service="ZBooks":selectedService===Timetracker.constants.integration.zi?params.service="ZInvoice":selectedService===Timetracker.constants.integration.zprjct&&(params.service="Zoho Projects")),0!=settingsPage.container.find("#filterDiv").length&&TimetrackerOperations.Filters.getFilterValues(params);var datePeriod=ZPCommonUtil.DateNavigator.getPeriod(TimetrackerOperations.integrations.mode);return void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(params.fromDate=Calendar.formatDate(datePeriod.from),params.toDate=Calendar.formatDate(datePeriod.to)):(params.fromDate=Calendar.formatDate(datePeriod.day),params.toDate=Calendar.formatDate(datePeriod.day))),params.sIndex=0,params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,params},removeTopFilter:function(event,clearAll){if(clearAll)TimetrackerOperations.integrations.resetFilter();else{var ele=event.target,entity=$(ele).closest("li").attr("filterno");filterDiv=settingsPage.container.find("#filterDiv"),"billableStatus"==entity?TimelyZComp.select.setValue(filterDiv.find('[compname="'+entity+'"]'),-1,!1):TimelyZComp.tokenField.removeAllTokens(filterDiv.find('[compname="'+entity+'"]'))}TimetrackerOperations.integrations.applyFilter()},pushTimelogs:function(th,service,fromDate,toDate,billStatus,isPushedAlready){if(isPushedAlready)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.zbtimelogpushedalready")),!1;service!==Timetracker.constants.integration.qb&&service!==Timetracker.constants.integration.zb&&service!==Timetracker.constants.integration.zi||(TimetrackerOperations.integrations.isAlreadyStarted?Timetracker.util.showAlert(1,ZPI18N.getString("zp.zbtimelogbeingpushed",service)):TimetrackerOperations.integrations.isAlreadyStarted=!0);var rowData=$(th).parent().parent().data().rowdata,userErecNo=rowData.ERECNO||"0",jobId=rowData.JOBID||"0",params={clientId:rowData.CLIENTID||"0",projectId:rowData.PROJECTID||"0",jobId:jobId,fromDate:fromDate,toDate:toDate,jobStatus:settingsPage.container.find("#qbrjobstatus").val(),billStatus:billStatus,conreqcsr:csrfToken};if(service===Timetracker.constants.integration.qb)params.erecno=userErecNo,Timetracker.util.showAlert(2,ZPI18N.getString("zp.tt.qbotimesheetebeingpushed")),$.post("/quickbooks/pushReportTimeActivityToQBO",params,function(resultData){resultData.qboResponse&&(TimetrackerOperations.integrations.isAlreadyStarted=!1,resultData.qboResponse.msg&&"success"==resultData.qboResponse.msg?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.tt.qbotimesheetsuccessful")),TimetrackerOperations.integrations.generateReport()):resultData.qboResponse.msg&&"failed"==resultData.qboResponse.msg&&resultData.qboResponse.errmsg?Timetracker.util.showAlert(0,resultData.qboResponse.errmsg,!0):Timetracker.util.showAlert(0,ZPI18N.getString("zp.tt.qbotimesheetfail")))});else if(params.mode="pushTimelogsToOtherService",params.userErecNo=userErecNo,params.service=service,service===Timetracker.constants.integration.zprjct){var objID="#pushIcon_"+rowData.ERECNO+"_"+rowData.PROJECTID;params.zProjectsPortalId=rowData.PORTALID,Timetracker.ZOHOPROJECTS.pushTimelogsToZProjects(params,objID,!0,settingsPage.container)}else settingsPage.container.find("#timetrackerIntegrationReport").addClass("zpl_DNI"),Timetracker.util.appendLoading(),$.post(Timetracker.constants.URL,params,function(result){TimetrackerOperations.integrations.isAlreadyStarted=!1,null!=result&&result.message?result.isSuccess?(Timetracker.util.showAlert(2,result.message),TimetrackerOperations.integrations.generateReport()):(Timetracker.util.showAlert(0,result.message),result.isReload&&!0===result.isReload?TimetrackerOperations.integrations.generateReport():settingsPage.container.find("#timetrackerIntegrationReport").removeClass("zpl_DNI")):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg")),Timetracker.util.removeLoading()})},Firescroll:{mode:"TTOP_INTEGRATIONS_FIRESCROLL",loadMoreData:function(response,params){var layout=settingsPage.container;if(response&&"permissionDenied"===response.error){var val='<div class="ZPNdata"><div id="noaccess"></div><h5>'+ZPI18N.getString("zp.permissiondeniedtoaccessthispage")+'</h5><p class="no-para"></p></div>';layout.find("#timetrackerIntegrationReport").before(val),Timetracker.Util.showHideNoData()}else if(response&&response.length>0){var tableBody=layout.find("#timetrackerIntegrationReportBody");$.each(response,function(index,data){tableBody.append(TimetrackerOperations.integrations.constructReportRowHtml(data,params))})}else 0==layout.find("#timetrackerIntegrationReport").find("tr").length&&Timetracker.Util.showHideNoData();Timetracker.FireScroll.setFetchCount(TimetrackerOperations.integrations.Firescroll.mode,response)}}};