var ZPExport={ALLOWED_FORMAT:new Array("xls","xlsx","tsv","csv"),exportContainer:'<div class="modal fade ZPmdl" id="zp_export_container"><div class="modal-dialog"><div class="modal-content"><div class="modal-header PR"><div class="Icn Tbc"><i class="IC-exprt whi S24"></i></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span><div class="IC-cls-1px red S21 CP"></div></span></button><h4 class="modal-title">'+ZPI18N.getString("zp.exportas",[""])+'</h4></div><div class="modal-body"><div class="container-fluid" id="zp_export_body"><div class="row PT10 PB10" id="zp_export_ftype"><div class="col-md-12 TC"><label id="zp_export_xls" class="tagbg radio"><input  value="xls" type="radio" checked="checked" name="zp_ftype"/><span>'+ZPI18N.getString("zp.xls")+'</span></label><label id="zp_export_xlsx" class="tagbg radio"><input  value="xlsx" type="radio" name="zp_ftype"/><span>'+ZPI18N.getString("zp.xlsx")+'</span></label><label id="zp_export_csv" class="tagbg radio"><input  value="csv" type="radio" name="zp_ftype"/><span>'+ZPI18N.getString("zp.csv")+'</span></label><label id="zp_export_tsv" class="tagbg radio"><input  value="tsv" type="radio" name="zp_ftype"/><span>'+ZPI18N.getString("zp.tsv")+'</span></label></div></div><div class="ZPwf FL MT20" id="zp_export_includerecordusers"><label class="checkbox DIB"><input type="checkbox"><span id="zp_export_includerecordusers_text">'+ZPI18N.getString("zp.includeusers")+'</span></label></div><div class="ZPwf FL MT20" id="zp_export_inctabularsec"><label class="checkbox DIB"><input type="checkbox"><span>'+ZPI18N.getString("zp.includetabulardata")+'</span></label></div><div class="ZPwf FL MT20" id="zp_export_sheetType"><div class="col-md-12 TC"><label id="zp_export_single" class="tagbg radio"><input value="single" type="radio" checked="checked" name="zp_sheetType"><span>'+ZPI18N.getString("zp.singlefile")+'</span></label><label id="zp_export_Separate" class="tagbg radio"><input value="separate" type="radio" name="zp_sheetType"><span>'+ZPI18N.getString("zp.multiplefiles")+'</span></label></div></div><div class="ZPwf FL MT20" id="zp_export_incAttachements" style="display: none"><label class="checkbox DIB"><input type="checkbox"><span>'+ZPI18N.getString("zp.includeAttachements")+'</span></label></div><div class="ZPwf FL MT20 scr-nte" id="zp_export_notes" style="display:none;">'+ZPI18N.getString("zp.appraisalcycleexport")+'</div></div></div><div class="modal-footer"><button type="button" class="btn btn-primary" id="zp_export_submit">'+ZPI18N.getString("zp.export")+'</button><button type="button" class="btn btn-default" data-dismiss="modal">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div></div>",handleExportResponse:function(json){json.isSuccess&&json.isScheduled?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.ExportScheduled")):json.UnConfirmedAccount?ZPeople.showErrorMessageForUnconfirmedAcc():json.RestrictMobileUser?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.mobileUsersInvalidOperation")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},hiddenInit:!1,exportData:function(){if(Layout.UrlConf.isModuleForm()&&ZPView.isSystemView())ZPComponents.SystemView.exportData();else{var userStatus,searchByEmpStatus,formObj=$("#zp_export_form").html(""),exportCont=$("#zp_export_container"),ftype=exportCont.find("[name=zp_ftype]:checked").val(),isSingleSheet=!1;$("#zp_export_container").find("#zp_export_sheetType").is(":visible")&&(isSingleSheet="single"==exportCont.find("[name=zp_sheetType]:checked").val());var bool=!1,check=Layout.Page.currentmode.split("/")[2];if(bool="leavetracker/reports/user"!=Layout.Page.currentmode&&("user"==check||"employeeprofile"==check)){var searchVal=User.searchVal,searchType=User.searchType;null==searchType&&(searchType=0),"All Status"!==User.variables[check].filterParams.userStatus&&(userStatus=User.variables[check].filterParams.userStatus),""!==User.variables[check].filterParams.searchByEmpStatus&&"All Status"!==User.variables[check].filterParams.searchByEmpStatus&&(searchByEmpStatus=User.variables[check].filterParams.searchByEmpStatus);var roleVal=User.variables[check].filterParams.searchByRole,locationVal=User.variables[check].filterParams.searchByLoc,deptVal=User.variables[check].filterParams.searchByDept}if(void 0!==ftype&&""!==ftype.trim()||(ftype=ZPUtil.checkValueInArray(ZPExport.ALLOWED_FORMAT,ftype,"xls")),formObj.append('<input type="hidden" value="'+ftype+'" name="ftype"/>'),formObj.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),"admin/employeerecords/user"==Layout.Page.currentmode?(bool=!0,formObj.append('<input type="hidden" value="user" name="modeCheck"/>')):"admin/employeerecords/employeeprofile"==Layout.Page.currentmode?(bool=!0,formObj.append('<input type="hidden" value="profile" name="modeCheck"/>')):"admin/organization/designationdetails/streams"==Layout.Page.currentmode&&(searchType=0,bool=!0,formObj.append('<input type="hidden" value="stream" name="modeCheck"/>')),Layout.UrlConf.isForm()||bool){var incTabSec=exportCont.find("#zp_export_inctabularsec").find("[type=checkbox]").is(":checked"),incAttach=exportCont.find("#zp_export_incAttachements").find("[type=checkbox]").is(":checked"),typeOfView="all";if(Layout.Page.urlparam.typeOfView?typeOfView=Layout.Page.urlparam.typeOfView:Layout.Page.container.find("#zp_views_typeofviews").length>0?typeOfView=Layout.Page.container.find("#zp_views_typeofviews").val():Layout.Page.pageId.includes("admin-employeerecords")&&(typeOfView=isadmin?"all":""),formObj.append('<input type="hidden" value="'+typeOfView+'" name="typeOfView"/>'),formObj.append('<input type="hidden" value="'+(void 0!==Layout.Page.urlparam.approval?Layout.Page.urlparam.approval:"all")+'" name="approvalStatus"/>'),!bool){formObj.append('<input type="hidden" value="'+(void 0!==Layout.Page.urlparam.empstatus?Layout.Page.urlparam.empstatus:void 0!==ZPView.CURR_VIEWPARAMS.employeeStatus?ZPView.CURR_VIEWPARAMS.employeeStatus:"P_EmployeeLeave"==ZPForm.getTableName()?"all":"activeemprecord")+'" name="employeeStatus"/>');var viewProp=ZPView.getViewPropertie();viewProp.searchBy&&(formObj.append('<input type="hidden" value="" name="searchBy"/>'),formObj.find("input[name=searchBy]").val(JSON.stringify(viewProp.searchBy))),viewProp.orgStructureFilter&&(formObj.append('<input type="hidden" value="" name="orgStructureFilter"/>'),formObj.find("input[name=orgStructureFilter]").val(JSON.stringify(viewProp.orgStructureFilter)))}formObj.append('<input type="hidden" value="'+incTabSec+'" name="includeTabular"/>'),formObj.append('<input type="hidden" value="'+(exportCont.find("#zp_export_incapprovaldata").length>0&&exportCont.find("#zp_export_incapprovaldata").find("[type=checkbox]").is(":checked"))+'" name="includeApproval"/>'),formObj.append('<input type="hidden" value="'+incAttach+'" name="includeFiles"/>'),null==Layout.Page.urlparam.viewId?"designationdetails"==check&&"admin/organization/designationdetails/streams"==Layout.Page.currentmode?formObj.append('<input type="hidden" value="'+Organization.ManageOrgs.viewId+'" name="viewID"/>'):formObj.append('<input type="hidden" value="'+User.viewId+'" name="viewID"/>'):formObj.append('<input type="hidden" value="'+Layout.Page.urlparam.viewId+'" name="viewID"/>'),null!=userStatus&&userStatus.length>0&&formObj.append('<input type="hidden" value="'+userStatus+'" name="userStatus"/>'),null!=searchByEmpStatus&&searchByEmpStatus.length>0&&(formObj.append('<input type="hidden" value="'+searchByEmpStatus+'" name="Employeestatus"/>'),formObj.append('<input type="hidden" value="28" name="Employeestatus_op"/>')),null!=roleVal&&roleVal.length>0&&formObj.append('<input type="hidden" value="'+roleVal+'" name="roleVal"/>'),null!=locationVal&&locationVal.length>0&&formObj.append('<input type="hidden" value="'+locationVal+'" name="locationVal"/>'),null!=deptVal&&deptVal.length>0&&formObj.append('<input type="hidden" value="'+deptVal+'" name="deptVal"/>'),null!=searchVal&&searchVal.length>0&&formObj.append('<input type="hidden" value="'+searchVal+'" name="searchVal"/>'),bool&&formObj.append('<input type="hidden" value="'+searchType+'" name="searchType"/>'),formObj.append('<input type="hidden" value="'+isSingleSheet+'" name="isSingleSheetExport"/>')}formObj.submit()}},exportResponse:function(data){data.isSuccess||ZPeople.Message.showFailureMsg(data.message)},historyData:function(mode,params){var ftype=$("#zp_export_container").find("[name=zp_ftype]:checked").val();void 0!==ftype&&""!==ftype.trim()||(ftype=ZPUtil.checkValueInArray(ZPExport.ALLOWED_FORMAT,ftype,"all"));var formObj=$("#zp_history_export_form").html("");formObj.append('<input type="hidden" value="'+ftype+'" name="ftype"/>'),formObj.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),formObj.append('<input type="hidden" value="'+ZPView.CURR_VIEWPARAMS.formId+'" name="formID"/>'),formObj.append('<input type="hidden" value="'+(void 0!==Layout.Page.urlparam.typeOfView?Layout.Page.urlparam.typeOfView:"all")+'" name="typeOfView"/>'),formObj.append('<input type="hidden" value="'+(void 0!==Layout.Page.urlparam.approval?Layout.Page.urlparam.approval:"all")+'" name="approvalStatus"/>'),formObj.append('<input type="hidden" value="'+(void 0!==Layout.Page.urlparam.empstatus?void 0!==ZPView.CURR_VIEWPARAMS.employeeStatus?ZPView.CURR_VIEWPARAMS.employeeStatus:Layout.Page.urlparam.empstatus:"activeemprecord")+'" name="employeeStatus"/>'),formObj.append('<input type="hidden" value="'+Layout.Page.urlparam.viewId+'" name="viewID"/>'),formObj.append('<input type="hidden" value="'+params.from+'" name="from"/>'),formObj.append('<input type="hidden" value="'+params.to+'" name="to"/>'),formObj.submit()},showExportContainer:function(callback,mode,message,optns){0==$("#zp_export_container").length&&$("#wrapper").append(ZPExport.exportContainer),$("#zp_export_container").find("#zp_export_sheetType").hide(),$("#zp_export_container").find("#zp_export_includerecordusers").hide(),$("#zp_export_container").find("#zp_export_notes").hide(),$("#zp_export_container").find("#zp_export_paalluserexport").hide(),$("#zp_export_container").find("#zp_pauserexport_filters").hide();var zplType=void 0;if("teamReports"==ZPLite.Reports.selectedTab)zplType="team";else"teamReports"!==ZPLite.Reports.selectedTab&&"myReports"!==ZPLite.Reports.selectedTab?zplType="admin":"myReports"!==ZPLite.Reports.selectedTab&&(zplType="my");(-1===Layout.Page.pageId.indexOf("attendance-report-userreport")&&void 0==zplType||-1===Layout.Page.pageId.indexOf("reports-"+zplType+"-attendance-user"))&&$("#zp_export_container").find("#zp_userexport_include_all_entries").remove();var check=Layout.Page.currentmode.split("/")[2],bool="leavetracker/reports/user"!=Layout.Page.currentmode&&("user"==check||"employeeprofile"==check);if(bool&&User.ListUsers.getUserList(null,null,"click"),bool&&"disperror"==User.disperr)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.disp_exporterror"));else{var formdtl=ZPForm.FORM_DETAILS[Layout.Page.urlparam.formId];void 0!=formdtl&&formdtl.hasTabularSection&&"historyData"!==callback?($("#zp_export_container").find("#zp_export_inctabularsec").show(),$("#zp_export_container").find("#zp_export_inctabularsec input").bind("change",function(){$(this).prop("checked")?($("#zp_export_container").find("input[value='single']").prop("checked","checked"),$("#zp_export_container").find("#zp_export_sheetType").show()):$("#zp_export_container").find("#zp_export_sheetType").hide()})):"project"==mode||"job"==mode||"salary"==mode||"timelog"==mode?ZPView.isSystemView()?($("#zp_export_container").find("#zp_export_inctabularsec").hide(),$("#zp_export_container").find("#zp_export_incAttachements").hide(),$("#zp_export_container").find("#zp_export_includerecordusers").show(),"job"==mode?$("#zp_export_container").find("#zp_export_includerecordusers_text").text(ZPI18N.getString("zp.includeassignees")):"timelog"==mode?Timetracker.isDataAdminForAllUsers()?$("#zp_export_container").find("#zp_export_includerecordusers_text").text(ZPI18N.getString("zp.includealluser")):$("#zp_export_container").find("#zp_export_includerecordusers").hide():$("#zp_export_container").find("#zp_export_includerecordusers_text").text(ZPI18N.getString("zp.includeusers")),$("#zp_export_container").find("#zp_export_includerecordusers").find("input").prop("checked",!1)):"project"==mode&&Timetracker.projects.formDetails.hasTabularSection||"job"==mode&&Timetracker.jobs.formDetails.hasTabularSection||"salary"==mode?$("#zp_export_container").find("#zp_export_inctabularsec").show():$("#zp_export_container").find("#zp_export_inctabularsec").hide():$("#zp_export_container").find("#zp_export_inctabularsec").hide(),Layout.UrlConf.isForm()&&ZPView.getViewPropertie()&&ZPView.getViewPropertie().isFileAvailable&&"historyData"!==callback?$("#zp_export_container").find("#zp_export_incAttachements").show():Layout.UrlConf.isForm()&&ZPView.getViewPropertie()&&0==ZPView.getViewPropertie().isFileAvailable&&"historyData"!==callback?$("#zp_export_container").find("#zp_export_incAttachements").hide():ZPView.isSystemView()||"project"!=mode&&"job"!=mode?$("#zp_export_container").find("#zp_export_incAttachements").hide():"project"==mode&&Timetracker.projects.formDetails.isFileAvailable||"job"==mode&&Timetracker.jobs.formDetails.isFileAvailable?$("#zp_export_container").find("#zp_export_incAttachements").show():$("#zp_export_container").find("#zp_export_incAttachements").hide(),$("#zp_export_container").find("#zp_export_inctabularsec, #zp_export_incAttachements").find("input").prop("checked",!1),optns||(optns={}),"HrCase"!=mode&&"transfer"!=mode&&"officereadiness"!=mode&&"vaccinationstatus"!=mode||(optns.tohide=new Array("tsv")),"timesheet"!=mode&&"appraisalModulesRating"!=mode||(optns.tohide=new Array("csv","tsv")),"timeLogLeaveReport"==mode&&(optns.tohide=new Array("xlsx","tsv"));var isPasswordProtected=!1,passwordProtectCheck=bool;if(Layout.UrlConf.isForm()||passwordProtectCheck)if("leavetracker"==ZPeople.Module.getModuleKey())isPasswordProtected=ZPeople.Module.getData("leavetracker").formConf.isPasswordProtected;else if(bool){User.pwdProtCheck&&(isPasswordProtected=!0)}else isPasswordProtected=ZPForm.CONF.isPasswordProtected;var exportCont=$("#zp_export_container");if(isPasswordProtected&&(!ZPView.isSystemView()||"project"!=mode&&"job"!=mode&&"client"!=mode)?(optns.tohide=new Array("xls","tsv","csv"),$($("#zp_export_container").find("#zp_export_xlsx input")[0]).prop("checked",!0)):$($("#zp_export_container").find("#zp_export_xls input")[0]).prop("checked",!0),$.each(ZPExport.ALLOWED_FORMAT,function(ind,val){$("#zp_export_container").find("#zp_export_"+val).show()}),optns.tohide&&$.each(optns.tohide,function(ind,val){$("#zp_export_container").find("#zp_export_"+val).hide()}),optns.toadd&&$.each(optns.toadd,function(ind,val){var html=`</label><label id="zp_export_${val}" class="tagbg radio"><input value="${val}" type="radio" name="zp_ftype" /><span>${val.toUpperCase()}</span></label>`;0==$("#zp_export_ftype").find(".col-md-12, .TC").find("#zp_export_"+val).length&&$("#zp_export_ftype").find(".col-md-12, .TC").append(html)}),bool){var appendStr=ZPI18N.getString("zp.exportas",[""]),userexportadditionalinfo=ZPI18N.getString("zp.userexportadditionalinfo");$("#zp_export_container").find(".modal-title").html(appendStr+"<div><h6>"+userexportadditionalinfo+"</h6></div>")}if($("#zp_export_container").find("#historyexportcal").remove(),$("#zp_export_container").find("#zp_Export_additionalInfo").remove(),optns.additionalHtml&&($("#zp_export_container").find("#zp_export_body").append('<div id="zp_Export_additionalInfo">'+optns.additionalHtml+"</div>"),optns.processSelect2&&$("#zp_Export_additionalInfo").find("select").select2(),"function"==typeof optns.additionalHtmlCallback&&optns.additionalHtmlCallback(optns)),"historyData"===callback){$("#zp_export_container").find(".modal-body").append('<div id="historyexportcal" class="form-horizontal pad PT20" style=""><div class="form-group "><label class="col-md-4 control-label">From to Date</label><div class="col-md-6"><div class="btnCal"><input caltype="filter" id="historyfromto" class="form-control" onclick="Leave.Util.regPeriod(this,null,false,true)" name="fromto" type="text" maxlength="23"></div></div></div></div>'),Leave.Util.regPeriod($("#historyfromto"),null,!1,!0)}$("#zp_export_container").modal("show"),0==ZPExport.hiddenInit&&($("#zp_export_container").on("hide.bs.modal",function(){$("#zp_export_container").find("#zp_export_incAttachements").hide(),-1!==Layout.Page.pageId.indexOf("attendance-report-userreport")&&$("#zp_export_container").find("#zp_userexport_filters").hide()}),ZPExport.hiddenInit=!0);var msg=ZPI18N.getString("zp.includetabulardata");message&&(msg=message),"function"==typeof callback&&null!==mode&&"null"!==mode&&void 0!==mode&&mode.hasOwnProperty("payrollDrillDown")?$("#zp_export_container").css("z-index","922"):$("#zp_export_container").css("z-index",""),$("#zp_export_container").find("#zp_export_inctabularsec span").text(msg),Layout.UrlConf.isForm()&&!Layout.UrlConf.isModuleForm()&&ZPForm.isApprovalEnabled()&&"historyData"!==callback?$("#zp_export_container #zp_export_body #zp_export_incapprovaldata").length<1?$("#zp_export_container #zp_export_body").append('<div class="ZPwf FL MT20" id="zp_export_incapprovaldata"><label class="checkbox DIB"><input type="checkbox"><span>'+ZPI18N.getString("zp.exportinclappr")+"</span></label></div>"):$("#zp_export_container #zp_export_body #zp_export_incapprovaldata input").prop("checked",!1):$("#zp_export_container #zp_export_body #zp_export_incapprovaldata")&&$("#zp_export_container #zp_export_body #zp_export_incapprovaldata").remove(),$("#zp_export_container").on("shown.bs.modal",function(){void 0===callback?callback=ZPExport.exportData:"historyData"===callback&&(callback=ZPExport.historyData),$(this).find("#zp_export_submit")[0].onclick=function(){if(callback===Holiday.Export){ZPeople.BSModal.hide("zp_export_container"),void 0!==(ftype=exportCont.find("[name=zp_ftype]:checked").val())&&""!==ftype.trim()||(ftype=ZPUtil.checkValueInArray(ZPExport.ALLOWED_FORMAT,ftype,"xls")),callback(ftype)}else{var ftype,params={from:null,to:null};if(callback==ZPExport.historyData){var dateval=$("#historyfromto").val(),dates={},splted=dateval.split("-");ZPSetupCommon.isEmpty(dateval)||(-1==uidateFormat.indexOf("-")?(dates.from=splted[0],dates.to=1==splted.length?void 0:splted[1]):(dates.from=splted[0]+"-"+splted[1]+"-"+splted[2],dates.to=3==splted.length?void 0:splted[3]+"-"+splted[4]+"-"+splted[5]));var fdate=void 0!=dates.from?new Date(Calendar.parseDate(dates.from,uidateFormat)):void 0,tdate=void 0!=dates.to?new Date(Calendar.parseDate(dates.to,uidateFormat)):void 0;if(void 0!=fdate&&void 0!=tdate&&tdate.getTime()<fdate.getTime())return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.fromDateToDateerror"));params.from=dates.from,params.to=dates.to}ZPeople.BSModal.hide("zp_export_container"),void 0!==(ftype=exportCont.find("[name=zp_ftype]:checked").val())&&""!==ftype.trim()||(ftype=ZPUtil.checkValueInArray(ZPExport.ALLOWED_FORMAT,ftype,"xls")),callback(mode,params,ftype)}}})}}},ZPSetupCommon={isEmpty:function(val){return void 0===val||null===val||val.length<=0},showErr:function(msg,obj,className,idd){this.isEmpty(className)&&(className="orgDiv red"),"undefined"!=typeof TemplateList&&(TemplateList.isError=!0);var errDiv=jQuery("<div/>",{class:className,id:idd});$(errDiv).html(msg),className=className.indexOf("dverrormsg")>0?"dverrormsg":className,ZPSetupCommon.isEmpty(idd)?$(obj).find("div."+className).remove():$("#"+idd).remove(),$(obj).append(errDiv)},getSelMassRecordIds:function(){var recIds="";return ZPView.VIEW_CONTAINER.find("tr[id^=zp_view_record_]").find("[id=zp_view_sel_record]:checked").each(function(){recId=$(this).closest("tr").attr("recordId"),isNaN(recId)||(recIds+=recId+",")}),recIds.slice(0,recIds.length-1)}};ZPScript={DRE_URL:null,IS_LOADED:!1,loadDRE:function(callback){if(ZPScript.IS_LOADED||void 0===ZPScript.DRE_URL||null===ZPScript.DRE_URL||"null"===ZPScript.DRE_URL)callback();else{0!==ZPScript.DRE_URL.indexOf("http")&&(ZPScript.DRE_URL="https://"+ZPScript.DRE_URL);var script=document.createElement("script");script.type="text/javascript",script.readyState?script.onreadystatechange=function(){"loaded"!==script.readyState&&"complete"!==script.readyState||(script.onreadystatechange=null,ZPScript.IS_LOADED=!0,callback())}:script.onload=function(){ZPScript.IS_LOADED=!0,this.onload=null,callback()},script.src=ZPScript.DRE_URL+"/js/includeDelugeEditor.js",document.getElementsByTagName("head")[0].appendChild(script)}},FILE_LEN:12,LOADED_JS:0,IS_JSREADY:!1,PRDJS:["acs","prd3","prd4","prd5","prd6","prd7","prd8","prd9","prd10","zpeditor.min"],load:function(){for(var jsCnt=0;jsCnt<ZPScript.PRDJS.length;jsCnt++)document.head.appendChild(ZPScript.getScript(ZPScript.PRD_URL+ZPScript.PRDJS[jsCnt]+".js",ZPScript.markLoaded))},markLoaded:function(){this.onload=null,ZPScript.LOADED_JS+=1,ZPScript.LOADED_JS===ZPScript.FILE_LEN&&(ZPeople.INITIATED?ZPeople.initComponents():ZPScript.IS_JSREADY=!0)},getScript:function(src,onload){var script=document.createElement("script");return script.type="text/javascript",script.src=src,void 0!=onload&&(script.onload=onload),script},loadWms:function(cssurl,jsurl){var css=document.createElement("link");css.type="text/css",css.rel="stylesheet",css.href=cssurl,css.onload=ZPScript.markLoaded,document.head.appendChild(css),document.head.appendChild(ZPScript.getScript(jsurl,ZPScript.markLoaded))}};var Translate={getCurrentUIKey:function(oldUIKey,newUIKey){return ZPeople.isZPNewUI()?newUIKey:oldUIKey}},ZPCommon={isScrollEnd:function(scrollContent){var scrollEnd=!1;return void 0==scrollContent&&(scrollContent=Layout.Page.container.find("#scrollContent")),scrollContent.prop("scrollTop")>0&&(scrollEnd=scrollContent.prop("scrollTop")+scrollContent.innerHeight()+1>=scrollContent.prop("scrollHeight")),scrollEnd}};const deepFreeze=obj=>{const keys=Reflect.ownKeys(obj);for(const key of keys){const c=obj[key];c&&"object"==typeof c&&deepFreeze(c)}return Object.freeze(obj)};var tabAndFormsCustom={TAB_OUTER_TEMPLATE:'<div class="ZPTscrlcont" id="customiseMainTabs"><div class="clearfix MT30 ML15 MR15"><div class="row" id="$PAGEDIVID$"></div></div></div>',TABCOLUMN_TEMPLATE:'<div class="col-md-6 $SIDECLASS$" name="tabColumn"></div>',FORMDIV_STATIC_TEMPLATE:'<li class="list-group-item" name="fixedLi"> <span class="IC-switch S14"></span><span>$FORMNAME$</span></li>',FORMDIV_CUSTOM_TEMPLATE:'<li name="formLi" id="$ID$" switch="$SWITCH$" class="list-group-item $MOVECLASS$ $DISABLED$" custom="$ISCUSTOM$" isPortal="$ISPORTAL$">',tabDeleteMethod:"tabCustom.tabOperations(this,['deleteTab'])",tabEnableMethod:"tabCustom.tabOperations(this,['updateTab','showhidetab'])",formDeleteMethod:"formCustom.formOperations(this,['deleteForm'])",formEnableMethod:"formCustom.formOperations(this,['formCustOperations','showhideform'])",switchInfo:{isSwitch:!1},url:"/getFormAndTabs.zp",forSaveForm:{isClick:!1,isChange:!1},holiday_displayname:ZPI18N.getString("zp.holiday"),init:function(data){$("#accordion:visible #zp_page_loading").show(),ZPeople.Request.send(tabAndFormsCustom.url,{method:"formsAndTabsPage"},tabAndFormsCustom.getformTabsPage,"")},getformTabsPage:function(resultData){resultData.hasOwnProperty("tabList")?(tabAndFormsCustom.holiday_displayname=resultData.hasOwnProperty("holiday_displayname")?resultData.holiday_displayname:tabAndFormsCustom.holiday_displayname,tabAndFormsCustom.hrfiles_displayname=ZPeople.isZPNewUI()?ZPI18N.getString("zp.newemployeefiles"):ZPI18N.getString("zp.hrfiles"),tabAndFormsCustom.companyfiles_displayname=ZPeople.isZPNewUI()?ZPI18N.getString("zp.organizationfiles"):ZPI18N.getString("zp.companyfiles"),tabAndFormsCustom.hrfiles_displayname=resultData.hasOwnProperty("hrfiles_displayname")?resultData.hrfiles_displayname:tabAndFormsCustom.hrfiles_displayname,tabAndFormsCustom.companyfiles_displayname=resultData.hasOwnProperty("companyfiles_displayname")?resultData.companyfiles_displayname:tabAndFormsCustom.companyfiles_displayname,resultData=resultData.tabList,$("#accordion:visible").siblings("#zp_page_loading").hide(),$("#accordion:visible").append(tabAndFormsCustom.tabsPageConstruction.Construct(resultData)),formCustom.minimiseTab(!1),tabCustom.sortForms(),tabCustom.columnHeightAdjust()):""!=resultData.msg.trim()&&ZPeople.Message.showFailureMsg(resultData.msg.trim())},tabsPageConstruction:{tabHeader:function(tabName,switchInfo){var headerTab='<li class="list-group-item active"><div class="form-group M0">';return switchInfo.isSwitch&&(headerTab+=this.dvswitchConstruction(switchInfo)),headerTab+='<div class="input-group"> <b class="IC-move S14 invisible" name="dragIcon"></b><span class="ZPbold" name="tabname">'+tabName+"</span>","Employee Engagement"==tabName||!switchInfo.isSwitch||switchInfo.hasOwnProperty("isExtensionTab")&&switchInfo.isExtensionTab||(headerTab+='<i class="IC-pen" onclick="tabCustom.toggleEditMode(this);"></i><input type="text" class="form-control" style="display:none;" onblur="tabCustom.toggleEditMode(this);" onchange="tabCustom.tabOperations(this,[\'custOperations\',\'renameTab\']);" value="'+tabName+'">'),headerTab+="</div>",headerTab+="</div></li>"}}};tabAndFormsCustom.tabsPageConstruction.Construct=function(resultData){var i=0,tabOuter=tabAndFormsCustom.TAB_OUTER_TEMPLATE.replace(/\$PAGEDIVID\$/g,"tabsPageDiv");tabOuter=$(tabOuter);var tabColumn=tabAndFormsCustom.TABCOLUMN_TEMPLATE;tabColumn=tabColumn.replace(/\$SIDECLASS\$/g,"PRO"),tabColumn=$(tabColumn);var switchInfo=tabAndFormsCustom.switchInfo;switchInfo.name="",switchInfo.isSwitch=!1;var count=1;for(isPlatformOrg||$(tabColumn).append(this.staticTab(ZPI18N.getString("zp.selfservice"),switchInfo,count)),i=1;i<resultData.length;i+=2)count+=2,switchInfo.isSwitch=!0,switchInfo.deletemethod=tabAndFormsCustom.tabDeleteMethod,switchInfo.enablemethod=tabAndFormsCustom.tabEnableMethod,switchInfo.switchId="showhide_"+resultData[i].tabId,switchInfo.isHidden=resultData[i].isHidden,switchInfo.isCustom=resultData[i].isCustom,switchInfo.isExtensionTab=resultData[i].isExtensionTab,$(tabColumn).append(this.tabDiv(count,resultData[i],switchInfo));for($(tabOuter).find("#tabsPageDiv").append(tabColumn),tabColumn=(tabColumn=tabAndFormsCustom.TABCOLUMN_TEMPLATE).replace("$SIDECLASS$","PLO"),tabColumn=$(tabColumn),switchInfo.isSwitch=!1,count=0,i=0;i<resultData.length;i+=2)count+=2,switchInfo.isSwitch=!0,switchInfo.deletemethod=tabAndFormsCustom.tabDeleteMethod,switchInfo.enablemethod=tabAndFormsCustom.tabEnableMethod,switchInfo.switchId="showhide_"+resultData[i].tabId,switchInfo.isHidden=resultData[i].isHidden,switchInfo.isCustom=resultData[i].isCustom,switchInfo.isExtensionTab=resultData[i].isExtensionTab,$(tabColumn).append(this.tabDiv(count,resultData[i],switchInfo));return $(tabOuter).find("#tabsPageDiv").append(tabColumn),tabOuter},tabAndFormsCustom.tabsPageConstruction.staticTab=function(tabName,switchInfo,count){var tabDiv='<div class="col-md-12" name="static"> <span name="countNum" class="rounded nomove">'+count+'</span><ul class="list-group">';return tabDiv+=this.tabHeader(tabName,switchInfo),tabDiv+=this.addStaticForms(tabName),tabDiv+="</ul></div>"},tabAndFormsCustom.tabsPageConstruction.tabDiv=function(tabNum,tabDtls,switchInfo){var disClass="";switchInfo.chkAttr="",tabDtls.isHidden?disClass=" disabled":switchInfo.chkAttr=" checked";let isNew="";tabDtls&&tabDtls.isNew&&(isNew='isNew="true"');var tabDiv='<div class="col-md-12" '+isNew+' name="tabDiv" tablabel="'+tabDtls.tabName+'"> <span class="rounded" name="countNum">'+tabNum+'</span><ul isLink="'+tabDtls.isLink+'" id="Tab_'+tabDtls.tabId+'" class="list-group'+disClass+'">';return tabDiv+=this.tabHeader(tabDtls.tabDisplayName,switchInfo),tabDiv+=this.addStaticForms(tabDtls.tabName),tabDtls.formDetailsMap.length>0?tabDiv+=this.formsListConstruction(tabDtls.formDetailsMap):0==tabDtls.isLink&&"Timetracker"!=tabDtls.tabName&&"Leavetracker"!=tabDtls.tabName&&"Attendance"!=tabDtls.tabName&&"Files"!=tabDtls.tabName&&"Announcements"!=tabDtls.tabName&&"OfficeReadiness"!=tabDtls.tabName&&(tabDiv+=this.emptyTabDiv()),tabDiv+="</ul></div>"},tabAndFormsCustom.tabsPageConstruction.addStaticForms=function(tabName){var staticFormsDiv="",formLi=tabAndFormsCustom.FORMDIV_STATIC_TEMPLATE;return"Timetracker"==tabName?(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.timelogs")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.projectsjobs")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.reports"))):"Leavetracker"==tabName?(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.leaveview")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.reports")),staticFormsDiv+='<li class="list-group-item" name="fixedLi"> <span class="IC-switch S14"></span><span id="Holiday_LT" class="Header">'+tabAndFormsCustom.holiday_displayname+'</span><i class="IC-pen Header" onclick="Holiday.View.renameInit()"></i><input type="text" id="Holiday_LT" name="holiday_disname" class="form-control DN MT5 Editable-Header" onblur="Holiday.View.saveName(\'holiday_disname\')" onchange="Holiday.View.saveName(\'holiday_disname\')" value="'+tabAndFormsCustom.holiday_displayname+'"></li>'):"Files"==tabName?(staticFormsDiv+='<li class="list-group-item" name="fixedLi"> <span class="IC-switch S14"></span><span class="Header">'+tabAndFormsCustom.companyfiles_displayname+'</span><i class="IC-pen Header" onclick="Holiday.View.renameInit(this,\'files\')"></i><input type="text" name="companyfile_dispname" class="form-control DN MT5 Editable-Header" onchange="Holiday.View.saveName(\'companyfile_dispname\')"  value="'+tabAndFormsCustom.companyfiles_displayname+'"></li>',staticFormsDiv+='<li class="list-group-item" name="fixedLi"> <span class="IC-switch S14"></span><span class="Header">'+tabAndFormsCustom.hrfiles_displayname+'</span><i class="IC-pen Header" onclick="Holiday.View.renameInit(this,\'files\')"></i><input type="text" name="hrfile_dispname" class="form-control DN MT5 Editable-Header" onchange="Holiday.View.saveName(\'hrfile_dispname\')"  value="'+tabAndFormsCustom.hrfiles_displayname+'"></li>',staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.settings"))):"Attendance"==tabName?(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.entry")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.report")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.settings"))):"Self-service"==tabName?(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.profile")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.feeds")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.goals")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.leave")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.relatedforms")),staticFormsDiv+=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.approvals"))):"Organization"==tabName?staticFormsDiv="":"Announcements"==tabName?staticFormsDiv="":"OfficeReadiness"==tabName&&(staticFormsDiv=formLi.replace("$FORMNAME$",ZPI18N.getString("zp.workpremises"))),staticFormsDiv},tabAndFormsCustom.tabsPageConstruction.emptyTabDiv=function(){var emptytabdiv='<li class="list-group-item text-center" name="dummy">';return emptytabdiv+='<div class="P20 PB10">',emptytabdiv+="<p>"+ZPI18N.getString("zp.noformsinservicealert")+"</p>",emptytabdiv+='<div class="btn btn-default MT5" onclick="tabCustom.addNewForm(this,true);">'+ZPI18N.getString("zp.addnewform")+"</div>",emptytabdiv+="</div></li>"},tabAndFormsCustom.tabsPageConstruction.formsListConstruction=function(formDetailsMap,parentTab){var formDiv="",formDisable="",chkAttr="",switchInfo=tabAndFormsCustom.switchInfo;return switchInfo.deletemethod=tabAndFormsCustom.formDeleteMethod,switchInfo.enablemethod=tabAndFormsCustom.formEnableMethod,switchInfo.name="forCustom",$.each(formDetailsMap,function(i,item){if(item.isHidden?(formDisable=" disabled",chkAttr=""):(formDisable="",chkAttr=" checked"),switchInfo.chkAttr=chkAttr,switchInfo.isCustom=item.isCustom,switchInfo.isExtensionForm=item.isExtensionForm,switchInfo.switchId="projects_"+item.formId,switchInfo.isHidden=item.isHidden,-1!=$.inArray(item.tablename,["P_ClientDetails","P_TimesheetJobsList","P_TimesheetJob","P_Timesheet","P_EmployeeJobs","P_Task","P_Candidate","P_Compensatory"])&&item.hasOwnProperty("tablename"))formDiv+='<li custom="'+item.isCustom+'" class="list-group-item" switch="false" id='+item.formId+' name="formLi">';else{var formLi=tabAndFormsCustom.FORMDIV_CUSTOM_TEMPLATE;$.inArray(item.tablename,["P_Employee","P_Department","P_Designation"])>=0?(formLi=(formLi=(formLi=(formLi=(formLi=(formLi=formLi.replace("$ID$",item.formId)).replace("$ISCUSTOM$",item.isCustom)).replace("$DISABLED$",formDisable)).replace("$MOVECLASS$",ZPeople.isDeptDesgRestricted?"":"spnmov-item")).replace("$SWITCH$","false")).replace(">","P_Employee"==item.tablename?" employeeForm=true>":">"),formDiv+=formLi):!item.hasOwnProperty("tablename")||"P_EmployeeLeave"!=item.tablename&&$.inArray(item.componentName,["P_PerformanceAppraisal","P_SelfAppraisal","P_AppraiseeList","P_Goals","P_EmployeeSalary","P_Workplace_Readiness"])<0?("P_Visitor"==item.tablename&&(formLi='<li name="formLi" id="$ID$" switch="$SWITCH$" class="list-group-item $DISABLED$" custom="$ISCUSTOM$" isPortal="$ISPORTAL$">'),($.inArray(item.tablename,["P_VaccinationStatus","P_EmployeeHealthData"])>=0||item.isExtensionForm)&&(formLi=formLi.replace("$MOVECLASS$","")),formLi=(formLi=(formLi=(formLi=(formLi=(formLi=formLi.replace("$ID$",item.formId)).replace("$ISCUSTOM$",item.isCustom)).replace("$DISABLED$",formDisable)).replace("$MOVECLASS$","spnmov-item")).replace("$SWITCH$","true")).replace("$ISPORTAL$",item.isPortal),formDiv+=formLi,formDiv+=tabAndFormsCustom.tabsPageConstruction.dvswitchConstruction(switchInfo)):item.isHidden?(formDiv+='<li custom="'+item.isCustom+'" class="list-group-item'+formDisable+'" id='+item.formId+' switch="true" name="formLi" onlyDisable=true empLeave = '+("P_EmployeeLeave"==item.tablename)+">",formDiv+=tabAndFormsCustom.tabsPageConstruction.dvswitchConstruction(switchInfo)):formDiv+='<li custom="'+item.isCustom+'" class="list-group-item'+formDisable+'" id='+item.formId+' switch="false" name="formLi" onlyDisable=true empLeave = '+("P_EmployeeLeave"==item.tablename)+">"}formDiv+='<span class="IC-switch S14" name="dragIcon"></span>',void 0==parentTab||"P_VaccinationStatus"==item.tablename&&item.isExtensionForm?"P_VaccinationStatus"==item.tablename||item.isExtensionForm?(formDiv+="<span>"+item.formName+"</span>",$(parentTab).append(formDiv)):"P_Compensatory"==item.tablename?formDiv+='<span id="Compoff_LT" class="Header">'+item.formName+'</span><i class="IC-pen Header" onclick="Leave.Compensatory.Form.initRename()"></i><input type="text" name="comp_disname" id="Compoff_LT" class="form-control DN MT5 Editable-Header" onblur="Leave.Compensatory.Form.saveName()" onchange="Leave.Compensatory.Form.saveName()" value="'+(item.formName?item.formName:"Compensatory Request")+'">':ZPeople.isDeptDesgRestricted&&$.inArray(item.tablename,["P_Department","P_Designation"])>=0?formDiv+='<span name="formDispName_'+item.tablename+'" class="Header">'+item.formName+'</span><i class="IC-pen Header" onclick="tabAndFormsCustom.tabsPageConstruction.initRenameform(this)"></i><input type="text" name="'+item.tablename+'_Name" id="'+item.tablename+'_rninputDiv" class="form-control DN MT5 Editable-Header" onblur="tabAndFormsCustom.tabsPageConstruction.renameForm(this,\''+item.formId+'\')" value="'+item.formName+'">':formDiv+='<a class="ulnk" href="#admin/formslayout/formedit-'+item.formId+'" ><span>'+item.formName+"</span></a>":(ZPeople.isDeptDesgRestricted&&$.inArray(item.tablename,["P_Department","P_Designation"])>=0?formDiv+='<span class="Header">'+item.formName+'</span><i class="IC-pen Header" onclick="tabAndFormsCustom.tabsPageConstruction.initRenameform(this)"></i><input type="text" name="'+item.tablename+'_Name" id="'+item.tablename+'_rninputDiv" class="form-control DN MT5 Editable-Header" onblur="tabAndFormsCustom.tabsPageConstruction.renameForm(this,\''+item.formId+'\')" value="'+item.formName+'">':formDiv+='<a class="ulnk" href="#admin/formslayout/formedit-'+item.formId+'" ><span></span></a>',$(parentTab).append(formDiv),$(parentTab).find("a[href*="+item.formId+"] span").text(ZPeople.decodeTxt(item.formName)))}),formDiv},tabAndFormsCustom.tabsPageConstruction.initRenameform=function(obj){$(obj).siblings(".Header").addClass("DN"),$(obj).siblings(".Editable-Header").removeClass("DN"),$(obj).siblings("input")[0].focus()},tabAndFormsCustom.tabsPageConstruction.renameForm=function(obj,formId){var dispName=$(obj).val();if(dispName&&dispName.trim().length>0&&dispName.length<50){var params={},others={};others.obj=obj,params.formid=formId,params.method="formCustOperations",params.mode="changeFormDispName",params.dispName=dispName,ZPeople.Request.send("/formCustOperations.zp",params,function(response,params,others){$(others.obj).siblings("[name^=formDispName_]").text(params.dispName),$(others.obj).val(params.dispName),$(others.obj).siblings(".Header").removeClass("DN"),$(others.obj).addClass("DN"),response.hasOwnproperty("error")?"nochangesfound"==response.error?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.namechangeerrormsg")):ZPeople.Message.showFailureMsg(response.error):"Success"==response.msg?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},others)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.entervalidinput"))},tabAndFormsCustom.tabsPageConstruction.dvswitchConstruction=function(switchInfo){var dvswitch="";return switchInfo.hasOwnProperty("isExtensionForm")&&switchInfo.isExtensionForm||switchInfo.hasOwnProperty("isExtensionTab")&&switchInfo.isExtensionTab||(dvswitch='<div class="dvswitch" name="'+switchInfo.name+'">',switchInfo.isCustom&&(dvswitch+='<a class="IC-delete S13 MR25 ZPtitle" onclick="'+switchInfo.deletemethod+'"></a>'),dvswitch+='<div class="btnactive">',dvswitch+='<input type="checkbox" name="enableDisableSwitch" class="cmn-toggle-small cmn-toggle-round-small" '+switchInfo.chkAttr+' id="'+switchInfo.switchId+'" onclick="'+switchInfo.enablemethod+'">',dvswitch+='<label for="'+switchInfo.switchId+'"></label>',dvswitch+="</div></div>"),dvswitch};var tabCustom={param:[],addNewTabEntry:function(tabId,tabName){var tabSelectObj=$("#addFormSlider").find("[keyname=tabId]");tabSelectObj.append('<option value="'+tabId+'" selected="selected">'+tabName+"</option>"),tabSelectObj.val(tabId),$(tabSelectObj).select2()},sortForms:function(){var parent=$("#accordion"),formDiv=$(parent).find("[name=tabDiv] ul[id*=Tab_]").not(".disabled"),isSorted=!1;$(parent).find("[name=tabColumn]").sortable({items:"[name=tabDiv]",handle:$(parent).find("[name=dragIcon]"),connectWith:"[name=tabColumn]",placeholder:"col-md-12 placeholder",start:function(){isSorted=!1},update:function(){var $sortable=$(this);if(!isSorted){var tabIds=[],obj=$(parent).find("#tabsPageDiv [name=tabDiv] span.rounded");tabCustom.tabNumberUpdate(),obj.each(function(){var txt=parseInt($(this).html());tabIds[txt-2]=$(this).siblings("ul").attr("id").match(/[\d]+$/).toString()}),tabIds=tabIds.flat();var params={tabIds:JSON.stringify(tabIds),method:"reorderTab"};ZPeople.Request.send("/tabOperations.zp",params,tabCustom.updateSort,{obj:$sortable,isTab:!0},formCustom.failureCallBack)}isSorted=!0}}),$(formDiv).sortable({handle:$(formDiv).find("li[name=formLi] [name=dragIcon]"),items:"li[name=formLi]",connectWith:"ul[id*=Tab_][isLink=false]:not(.disabled)",placeholder:"filedplace",start:function(event,ui){isSorted=!1},update:function(event,ui){var sortableItem=$(this);if(!isSorted){$(ui.item).siblings("[name=dummy]").hide();$(ui.item).attr("id");var parentUl=$(ui.item).parent("ul");if("1"===ui.item.attr("isPortal")&&$(parentUl).attr("id")!==$(sortableItem).attr("id"))return sortableItem.sortable("cancel"),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.movecportalformnotallowed"));var formIds=[];$(parentUl).find("li[name=formLi]").each(function(){formIds.push($(this).attr("id"))});var params={parenttabid:$(parentUl).attr("id").match(/[\d]+$/).toString(),formIds:JSON.stringify(formIds),mode:"reorderform",method:"formCustOperations"};ZPeople.Request.send("/formCustOperations.zp",params,tabCustom.updateSort,{obj:sortableItem,isTab:!1},formCustom.failureCallBack)}isSorted=!0}})},updateSort:function(data,params,others){if("success"==data.msg.trim())others.iTab||(tabCustom.emptyTabCheck(),$("#admin-formslayout-formslist, #dvfrmlstcontent").remove(),$("zp_hometabs").attr("isloaded",!1)),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),Layout.CustomizedUrl.refreshService();else if(""!=data.msg.trim()){others.obj.sortable("cancel"),others.isTab&&tabCustom.tabNumberUpdate();let msg=data.msg.trim();"MOVE_RESTRICTED"==data.msg.trim()?msg=ZPI18N.getString("zp.cannotmoveformtothisservice"):"extensionservice"==data.msg.trim()&&(msg=ZPI18N.getString("zp.extensionservicenoedit")),ZPeople.confirm(null,"",msg,"",!0,!0)}},emptyTabCheck:function(){$("#accordion li[name=dummy]").fadeOut("fast"),$("#accordion a[name=deleteIcon]").fadeOut("fast"),$("ul[id*=Tab_][isLink=false]").each(function(){0==$(this).find("li[name=formLi]").length&&0==$(this).find("li[name=fixedLi]").length&&($(this).append(tabAndFormsCustom.tabsPageConstruction.emptyTabDiv()),$(this).find("[name=tabNameLi] [name=forCustom]").append($('<a class="IC-delete S13 MR25 ZPtitle" name="deleteIcon" title="" data-original-title="Delete" onclick="tabCustom.tabOperations(this,[\'deleteTab\'])"></a>')))}),tabCustom.columnHeightAdjust()},columnHeightAdjust:function(){var div1=$("[name=tabColumn]").first(),div2=$("[name=tabColumn]").last(),div=div1.innerHeight()>div2.innerHeight()?div1.css("min-height","auto"):div2.css("min-height","auto");$("[name=tabColumn]").css("min-height",div.innerHeight())},openNewTab:function(obj){var newTab=ZPeople.createModalPopup("newTabPopup",ZPI18N.getString("zp.addnewservice"),"modal-xs");newTab.find("#bodyTag input").length<=0&&newTab.find("#bodyTag").append('<div class="row"><div class="form-group"><div class="col-md-10" errorDiv="cantbeempty"><label>'+ZPI18N.getString("zp.hrservicename")+'</label><input elem="tabName" type="text" placeholder="'+ZPI18N.getString("zp.newservicename")+'" class="form-control"></div><div class="col-md-10" errorDiv="cantbeempty"><label>'+ZPI18N.getString("zp.description")+'</label><input elem="tabDesc" type="text" placeholder="'+ZPI18N.getString("zp.enterdesc")+'" class="form-control"></div></div></div>'),newTab.find("input").val(""),newTab.find("[elem=tabName]").trigger("select"),newTab.find("[buttonname=done]").off(),newTab.find("[buttonname=done]").on("click",function(){tabCustom.tabOperations(this,["addTab"])})},fillViewName:function(obj){if(""!=$(obj).val()&&$(obj).val().match(/^[a-zA-Z0-9\s.\-\_\$\:\/\/\+\'\!\;,. ]+$/)){var val=$(obj).val();$(obj).parents("[name=addFormFields]").siblings("#formlinkname").find("input").val(val)}},createTab:function(data,params,others){if(data.hasOwnProperty("securityError"))$("#newTabPopup").modal("hide"),ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0);else if("duplicate"==data.msg.trim())errorFunction.errorSpanAttach(ZPI18N.getString("zp.servicenameduplicateerror"),others.obj);else if("Success"==data.msg.trim()){$("#newTabPopup").modal("hide");var tabDtls={tabDisplayName:data.tabDisplayName,tabName:data.tabName,tabId:data.tabId,formDetailsMap:[],isLink:!1},switchInfo={isSwitch:!0,switchId:"showhide_"+data.tabId,isHidden:!1,isCustom:!0,deletemethod:tabAndFormsCustom.tabDeleteMethod,enablemethod:tabAndFormsCustom.tabEnableMethod,title:ZPI18N.getString("zp.deleteservice"),name:""},tabLen=$("#accordion").find("#tabsPageDiv [name=tabDiv],[name=static]").length,last=$("#accordion").find("#tabsPageDiv [name=tabDiv] span:contains("+tabLen+")").last();last=$(last).parents("[name=tabDiv]"),tabDtls.isNew=!0,$(last).parents("[name=tabColumn]").siblings("[name=tabColumn]").append(tabAndFormsCustom.tabsPageConstruction.tabDiv(tabLen+1,tabDtls,switchInfo)),delete tabDtls.isNew,$("#accordion").find("[isNew=true]")[0].scrollIntoView(),$("#accordion").find("[isNew=true]").attr("isNew",!1),tabCustom.sortForms(),tabCustom.emptyTabCheck(),$("#dvaddform [keyname=tabId]").append("<option value="+data.tabId+">"+params.tabName+"</option>"),Layout.Page.container.not("#addFields").find("[istooltip=true]").not("[data-original-title]").tooltip(),Layout.CustomizedUrl.refreshService()}else""!=data.msg.trim()&&errorFunction.errorSpanAttach(data.msg.trim(),others.obj)},saveForm:function(obj,others){if(tabAndFormsCustom.forSaveForm.isChange)tabAndFormsCustom.forSaveForm.isClick=!0;else{var parentDiv=$(obj).parents("#dvaddform"),tabNameDiv=$(parentDiv).find("#newTab input");errorFunction.removeErrorSpan(parentDiv,"[test=newTab]");var keyname,keyval,formData=new FormData,error=void 0!=$(tabNameDiv).attr("isDup")?$(tabNameDiv).attr("isDup"):"false";$(parentDiv).find("[name=addFormFields]:visible, [tip=tabdiv]").each(function(){var inputDiv=$(this).find("input:visible ,  [keyname=tabId], select , textarea:visible");if($(inputDiv).parents("[name=addFormFields]").removeClass("zp-err"),$(inputDiv).length>1)$.each(inputDiv,function(){if(keyname=$(this).attr("keyname"),keyval=$(this).val().trim(),void 0!=keyname&&""!=keyname){if("tabId"==keyname)"-1"==keyval&&(errorFunction.errorSpanAttach(ZPI18N.getString("zp.servicenamenotemptyerror"),$(this).parent("div")),error="true");else{if("selformId"==keyname||"configfile"==keyname)return;if("formtype"==keyname)if("template"==keyval)formData.set("selformId",parentDiv.find("#selectForm select").val());else if("import"==keyval){var fileEle=parentDiv.find("#chooseFileForAddForm input")[0],file=fileEle.files[0];void 0==file||""==file?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.choosefile"),$(fileEle).parent("div")),$(fileEle).parents("[errorDiv=cantbeempty]").attr("test","formname"),$(fileEle).parents("[errorDiv=cantbeempty]").find(".red").attr("test","formname"),error="true"):formData.set("configfile",file)}}"autoNumberFieldName"===keyname&&""===keyval&&$(parentDiv).find("[keyname=enableAutoNumber]").is(":checked")&&(errorFunction.errorSpanAttach(ZPI18N.getString("zp.autonumbernamecantbeemptyerror"),$(this).parent("div"),!1,!0),$(inputDiv).parents("[errorDiv=cantbeempty]").attr("test","formname"),$(inputDiv).parents("[errorDiv=cantbeempty]").find(".red").attr("test","formname"),error="true"),formData.set(keyname,keyval)}});else{if(keyname=$(inputDiv).attr("keyname"),keyval=$(inputDiv).val(),"selformId"==keyname||"configfile"==keyname)return;"checkbox"==$(inputDiv).attr("type")?"formtype"!=keyname&&(keyval=$(inputDiv).is(":checked").toString()):"formname"==keyname&&""==keyval.trim()?(errorFunction.errorSpanAttach(ZPI18N.getString("zp."+keyname+"notemptyerror"),$(inputDiv).parent("div"),!1,!0),$(inputDiv).parents("[errorDiv=cantbeempty]").attr("test","formname"),$(inputDiv).parents("[errorDiv=cantbeempty]").find(".red").attr("test","formname"),error="true"):"formname"==keyname&&keyval.trim().length>100?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.displaynamelength",[100]),$(inputDiv).parent("div"),!1,!0),$(inputDiv).parents("[name=addFormFields]").addClass("zp-err"),error="true"):"formlinkname"==keyname&&keyval.trim().length>100?(errorFunction.errorSpanAttach(ZPI18N.getString("zp.labelnamelength"),$(inputDiv).parent("div"),!1,!0),$(inputDiv).parent("div").attr("errorDiv","cantbeempty").attr("name","addFormFields"),$(inputDiv).parents("[name=addFormFields]").addClass("zp-err"),error="true"):"desc"==keyname&&keyval.trim().length>100&&(errorFunction.errorSpanAttach(ZPI18N.getString("zp.formdescplaceholder"),$(inputDiv).parent("div"),!1,!0),$(inputDiv).parents("[name=addFormFields]").addClass("zp-err"),error="true"),formData.set(keyname,keyval)}}),0!=$(parentDiv).find("#portalType").val()&&formData.set("portalType",$(parentDiv).find("#portalType").val()),"false"==error&&(others||(others={}),others.obj=parentDiv,$(parentDiv).find("[buttonname=done]").addClass("disabled"),ZPeople.Request.sendFormData("/formOperations.zp?method=addForm",formData,tabCustom.saveSuccess,others,(data,params,others)=>{formCustom.failureCallBack(data,params,others),$(parentDiv).find("[buttonname=done]").removeClass("disabled")}))}},enableDisableTab:function(data,params,others){if("Success"==data.msg.trim()){if(params.hidden){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablesuccessful")),$(others.obj).parents("ul").addClass("disabled"),tabCustom.dvfrmlstcontentEntry(params.tabid,!1,!1);var formliObject=$(others.obj).parents("ul").find("li[name=formLi]");$(formliObject).length>0&&$(formliObject).each(function(){"true"===$(this).attr("switch")&&($("[id="+$(this).attr("id")+"]").addClass("disabled"),tabCustom.dvfrmlstcontentEntry($(this).attr("id"),!0,!1),$("#dvaddform [keyname=selformId] option[value="+$(this).attr("id")+"]").remove(),$("#formDisable_"+$(this).attr("id")+", #projects_"+$(this).attr("id")).prop("checked",!1))}),$("#tabNameList option[value="+params.tabid+"]").is(":selected")&&$("#formsListingHeader #tabNameList").select2("val",0).trigger("change"),$("#tabNameList option[value="+params.tabid+"], #tabSpecificForms_"+params.tabid).remove(),$("#dvaddform [keyname=tabId] option[value="+params.tabid+"]").addClass("hide"),others.hasOwnProperty("tabName")&&"HRCase"==others.tabName&&$("#zp_askus").remove()}else if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enablesuccessful")),$(others.obj).parents("ul").removeClass("disabled"),ZPeople.isNewZp?(appOperations.dvfrmlstcontentEntry(params.tabid,!1,!0),$(others.obj).attr("checked",!0)):($(others.obj).parents("ul").find("li[id],li[form] input[name=enableDisableSwitch]").each(function(){$(this).parents("li").addClass("disabled"),$(this).parent("div").siblings("a").addClass("disabled"),$(this).attr("checked",!1)}),$(others.obj).parents("ul").find("li a").not(".disabled").length>0&&$("#admin-formslayout-formslist").remove(),tabCustom.dvfrmlstcontentEntry(params.tabid,!1,!0)),$("#dvaddform [keyname=tabId] option[value="+params.tabid+"]").removeClass("hide"),others.hasOwnProperty("tabName")&&"HRCase"==others.tabName){var htmlbutton='<li id="zp_askus"><a class="ZPtitle" title="" data-placement="bottom" href="#hrcase/home"  data-toggle="tooltip"  data-original-title="'+ZPI18N.getString("zp.askaquestion")+'"><span><i class="IC-hrc"></i></span></a></li>';$("#zp_feeds_notifications").length>0&&$(htmlbutton).insertBefore("#zp_feeds_notifications")}tabCustom.sortForms(),Layout.CustomizedUrl.refreshService()}else""!=data.msg.trim()&&(ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0),$(others.obj).attr("checked",!$(obj).is(":checked")))},deleteTab:function(data,params,others){"Success"==data.msg.trim()?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.deletesuccessful")),$("#Tab_"+params.tabid).parent("[name=tabDiv]").remove(),$("#formsCount").show().siblings("#totalForms").hide(),$("#dvaddform [keyname=tabId] option[value="+params.tabid+"]").remove(),appOperations.dvfrmlstcontentEntry(params.tabid,!1,!0),location.reload()):""!=data.msg.trim()&&("systemservice"==data.msg.trim()?setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.systemservicedelete"),"",!0,!0)},500):"extensionservice"==data.msg.trim()?setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.extensionservicenoedit"),"",!0,!0)},500):setTimeout(function(){ZPeople.confirm(null,"",ZPI18N.getString("zp.sorryservererror"),"",!0,!0)},500))},toggleEditMode:function(obj){var serviceLName=$(obj).closest("[name=tabDiv]").attr("tablabel");"Onboarding"===serviceLName?ZPOnboarding.serviceViewPage(!0):ZPUtil.Validation.isEmpty(serviceLName)||ZPUtil.checkIsExistInArray(zpconst.systemServices,serviceLName.toLowerCase())||"Task"===serviceLName||"Reports"===serviceLName||"HRCase"===serviceLName||"LMS"==serviceLName?$(obj).is("input")?$(obj).hide():($(obj).siblings("input").show(),$(obj).siblings("input").trigger("select")):"true"!=is5_0Enabled&&(window.location.href="#"+serviceLName.toLowerCase()+"/generalsettings")},renameTab:function(data,params,others){"Success"==data.msg.trim()?($(others.obj).siblings("span").text(params.tabName),$(others.obj).attr("value",params.tabName),$(others.obj).hide(),$("#dvfrmlstcontent a[href=#dv"+params.tabid+"]").text(params.tabName),$("#zp_hometabs li[tabid="+params.tabid+"] a[href] span").text(params.tabName),$("#formsListingHeader #tabNameList option[value="+params.tabid+"]").text(params.tabName),$("#formsListingHeader #tabNameList").val()==params.tabid&&$("#formsListingHeader #tabNameList").select2(),$("#formsListingHeader #tabSpecificForms_"+params.tabid+" tr td#tabname").text(params.tabName),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),Layout.CustomizedUrl.refreshService()):""!=data.msg.trim()&&($(others.obj).val($(others.obj).siblings("span").text()),ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0))},deleteForm:function(data,params,others){if(data.isLookup){var msg=ZPI18N.getString("zp.referredfieldserror",["form","delete","form"])+" \n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n',$.each(data,function(key,val){"isLookup"!=key&&(msg+="{"+key+" -> "+val+"}\n")}),setTimeout(function(){ZPeople.confirm(null,"",msg,"",!0,!0)},500),setTimeout(function(){$("#textConfirmationPopupBody p").first().addClass("pspace")},600),$("#textConfirmationPopupBody p").first().addClass("pspace")}else{if(data.isAnRepsConfig){var searchElem=Layout.Page.container;return ZPeople.BSModal.get({id:"reportDeleteAlert",type:3,header:ZPI18N.getString("zp.alert"),closeOnSubmit:!0,removeModalClass:"DelMdl",iconParenClass:"orgbgi",iconClass:"IC-alert",bodyClass:"dvExecutescript",buttonValue:ZPI18N.getString("zp.close"),successCallback:function(){}}),searchElem.find("#reportDeleteAlert .modal-body").html('<div class="row"><div class="col-md-12"><div id="reportDeleteAlertBody" class="dvinfo"><p>'+ZPI18N.getString("zp.reports.removeformfieldsfromreports")+"</p></div></div></div>"),$.each(data.depReps,function(index,depRepObj){searchElem.find("#reportDeleteAlertBody").append("<p>"+(index+1)+". "+ZSEC.Encoder.encodeForHTML(depRepObj.ZPREPORTDISPLAYNAME)+"</p>")}),searchElem.find("#reportDeleteAlert #zp_modal_blubtn").siblings().remove(),void searchElem.find("#reportDeleteAlert").modal("show")}if("Success"==data.msg.trim()){if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.deletesuccessful")),$("#formsListingHeader").length>0&&0==$("tr[id="+params.formid+"]").siblings("tr").length){var id=$("tr[id="+params.formid+"]").parent("[id*=tabSpecificForms_]").attr("id").match(/[\d]+$/).toString();$("#formsListingHeader #tabNameList").val()==id&&($("#formsListingHeader #tabNameList").val(0).trigger("change"),$("#formsListingHeader #tabNameList").select2()),$("[id=tabSpecificForms_"+id+"], #tabNameList option[value="+id+"]").remove()}$('[formid="'+params.formid+'"]').remove(),$("[id$=admin-formslayout-formedit-"+params.formid+"]").remove(),$("[id="+params.formid+"]").remove(),$("#formsCount").show().siblings("#totalForms").hide(),$("#admin-formslayout-formedit-"+params.formId).remove(),$("#dvaddform [keyname=selformId] option[value="+data.formId+"]").remove(),formsListCustom.showHideNoData(),tabCustom.dvfrmlstcontentEntry(params.formid,!0,!1),tabCustom.emptyTabCheck(),tabAndFormsCustom.hasOwnProperty("FormCount")&&++tabAndFormsCustom.FormCount,AppsCustom.hasOwnProperty("appCount")&&++AppsCustom.appCount,AccessControl.Permissions.remove(),ZPTabs.currMainTab==Compensation.CONSTANTS.SERVICENAME&&(Layout.CustomizedUrl.refreshTab(!0),0==Layout.Page.container.find("#serviceView").find("#sfrmList>div").length&&Layout.Page.container.find("#serviceView").find("#sfrmList").html('<div class="ZPNdata" style="align-items: flex-start;"><h5>'+ZPI18N.getString("zp.compensation.noFormData")+"</h5></div>")),others&&"function"==typeof others.callback?others.callback(data,params):Layout.CustomizedUrl.refreshService()}else""!=data.msg.trim()&&setTimeout(function(){ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0)},500)}},enableDisableForm:function(data,params,others){var formName=$(others.obj).parents("li").find("a").text();if(data.isLookup){var msg=ZPI18N.getString("zp.referredfieldserror",["form","disable","form"])+"\n";msg+='{"Referred form" -> "Referred field"}\n---------------------------------------------\n',$.each(data,function(key,val){"isLookup"!=key&&"isSuccess"!=key&&(msg+="{"+key+" -> "+val+"}\n")}),ZPeople.confirm(null,"",msg,"",!0,!0),$("#textConfirmationPopupBody p").first().addClass("pspace"),$(others.obj).prop("checked",!0)}else"Success"==data.msg.trim()?(params.hidden?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.disablesuccessful"),!0),$("[id="+params.formid+"]").addClass("disabled"),tabCustom.dvfrmlstcontentEntry(params.formid,!0,!1),$("#dvaddform [keyname=selformId] option[value="+params.formid+"]").remove(),$("#formDisable_"+params.formid+", #projects_"+params.formid).prop("checked",!1)):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.enablesuccessful")),$("[id="+params.formid+"]").removeClass("disabled"),tabCustom.dvfrmlstcontentEntry(params.formid,!0,!0),0!=(parentObj=$(others.obj).parents("[onlyDisable=true]")).length&&$(parentObj).find("[name=forCustom]").remove(),$("tr[id="+params.formid+"]").length<=0&&$("#admin-formslayout-formslist").remove(),$("#dvaddform [keyname=selformId]").append("<option value="+params.formid+">"+formName+"</option>"),$("#formDisable_"+params.formid+", #projects_"+params.formid).prop("checked",!0)),ZPTabs.currMainTab==Compensation.CONSTANTS.SERVICENAME&&Layout.CustomizedUrl.refreshTab(!0),"function"==typeof others.successCallback?others.successCallback(data,others,params):Layout.CustomizedUrl.refreshService()):"Denied"==data.msg.trim()&&"P_EmployeeHealthData"==data.tableName?(ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.disablehealthformwarningmsg")),$("[id="+params.formid+"]").removeClass("disabled"),tabCustom.dvfrmlstcontentEntry(params.formid,!0,!0),0!=(parentObj=$(others.obj).parents("[onlyDisable=true]")).length&&$(parentObj).find("[name=forCustom]").remove(),$("tr[id="+params.formid+"]").length<=0&&$("#admin-formslayout-formslist").remove(),$("#dvaddform [keyname=selformId]").append("<option value="+params.formid+">"+formName+"</option>"),$("#formDisable_"+params.formid+", #projects_"+params.formid).prop("checked",!0)):""!=data.msg.trim()&&(ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0),$(others.obj).prop("checked",!$(others.obj).is(":checked")))},tabNumberUpdate:function(){let cnt=1,colDiv=$("#accordion").find("#tabsPageDiv [name=tabColumn]"),length1=$(colDiv).first().find("[name=static],[name=tabDiv]").length,length2=$(colDiv).last().find("[name=static],[name=tabDiv]").length,referehCount=(colDiv,length)=>{$(colDiv).find("[name=static],[name=tabDiv]").each(function(index,item){0!=index&&index>length?cnt+=1:0!=index&&(cnt+=2),$(item).find("span[name=countNum]").text(cnt)})};referehCount($(colDiv).first(),length2),cnt=2,referehCount($(colDiv).last(),length1-1)},dvfrmlstcontentEntry:function(id,isform,isadd){if(isadd){if(isform){var tabid=$("#accordion").length>0?$("#accordion li#"+id).parent("ul").attr("id").match(/[\d]+$/).toString():$("#formsListingHeader tr#"+id).length>0?$("#formsListingHeader tr#"+id).parent("tbody").attr("id").match(/[\d]+$/).toString():"";if($("#dvfrmlstcontent").find("div#dv"+tabid).length>0){var formname=$("#accordion").find("li#"+id+" a").text();$("#dvfrmlstcontent").find("div#dv"+tabid+" ul").append(jQuery("<li></li>").append(jQuery("<a></a>",{href:"#admin/formslayout/formedit-"+id,text:formname})))}else $("body").find("#dvfrmlstcontent").remove()}else $("ul#Tab_"+id+" li[id]").not(".disabled").length>0&&$("body").find("#dvfrmlstcontent").remove();"function"==typeof ZPTabs.refresh&&ZPTabs.refresh(),ZPUtil.Form_Link_Names.reload()}else{var tabindex=isform?$("#zp_subtab_"+id).parents("[tabid]").index():$("#zp_maintab_"+id).index();if(isform){var formEntry=$("#dvfrmlstcontent").find('a[href="#admin/formslayout/formedit-'+id+'"]').parent("li");1==$(formEntry).parent("ul").find("li").length?(tabdvId=$(formEntry).parents("[tabid]").attr("id"),$("#dvfrmlstcontent").find("a[href=#"+tabdvId+"]").parent("li").remove(),$(formEntry).parents("div#"+tabdvId).remove()):$(formEntry).remove();var formindex=$("#zp_subtab_"+id).index();if($("#zp_hometabs li[id*="+id+"]").siblings("li").length>0){var hrefTag=$("#zp_hometabs li[id*="+id+"]").parents("[id*=zp_maintab_]").find("a");$(hrefTag).attr("href")==$("#zp_hometabs li[id*="+id+"] a[href]").attr("href")&&$(hrefTag).attr("href",$("#zp_hometabs li[id*="+id+"]").siblings("li").first().find("a").attr("href")),$("#zp_hometabs li[id*="+id+"]").hasClass("active")&&(Layout.Page.prevHomeAdminUrl=$("#zp_hometabs li[id*="+id+"]").siblings("li").first().find("a").attr("href"),$("#zp_hometabs li[id*="+id+"]").siblings("li").first().addClass("active")),null!=ZPTabs.JSON&&delete ZPTabs.JSON[tabindex].formArr[formindex],$("#zp_hometabs li[id*="+id+"]").remove()}else $("#zp_hometabs li[id*="+id+"]").hasClass("active")&&(Layout.Page.prevHomeAdminUrl="#home/feeds",$("#zp_maintab_home").addClass("active")),$("#zp_hometabs li[id*="+id+"]").parents("[id*=zp_maintab_]").remove(),null!=ZPTabs.JSON&&delete ZPTabs.JSON[tabindex];$("#zp-contwrap-form-listview #form-listview-formId-"+id).remove(),delete ZPView.LIST_VIEW_PARAMS[id+""]}else $("#dvfrmlstcontent").find("a[href=#dv"+id+"]").parent("li").remove(),$("#dvfrmlstcontent").find("div#dv"+id).remove(),$("#zp_hometabs [id*=zp_maintab_"+id+"] ul li").each(function(){var fid=$(this).attr("id").match(/[\d]+$/).toString();$("#page-wrapper #form-listview-formId-"+fid).remove(),delete ZPView.LIST_VIEW_PARAMS[fid+""],$("#zp_hometabs li[id*="+fid+"]").hasClass("active")&&(Layout.Page.prevHomeAdminUrl="#home/feeds",$("#zp_maintab_home").addClass("active"))}),$("#zp_hometabs [id*=zp_maintab_"+id+"]").remove()}},showHideAddFormFields:function(obj,id){var showHideDiv=$(obj).parents("[name=addFormFields]").siblings("#"+id);$(obj).is(":checked")?$(showHideDiv).fadeIn():$(showHideDiv).fadeOut()},toggleFormType:function(obj){var type=$(obj).val(),parentDiv=$(obj).closest("#dvaddform");parentDiv.find("#selectForm,#chooseFileForAddForm").hide(),"template"==type?parentDiv.find("#selectForm").show():"import"==type&&parentDiv.find("#chooseFileForAddForm").show()},toggleNewTab:function(obj){"add"==$(obj).attr("id")?($(obj).parents("[name=addFormFields]").children("div").not("#newTab").hide(),$(obj).parents("[name=addFormFields]").children("div#newTab").show()):($(obj).parents("[name=addFormFields]").children("div").not("#newTab").show(),$(obj).parents("[name=addFormFields]").children("div#newTab").hide())},tabOperations:function(obj,operation){errorFunction.removeErrorSpan(Layout.Page.container,"[for=formname]"),errorFunction.removeErrorSpan($("[id=addFormSlider]"),"[for=formname]",!0);var otherDtls={obj:obj},url="/tabOperations.zp",params={},callbackFn="";if(params.method=operation[0],"custOperations"==operation[0]){if(params.operation=operation[1],"checkTabNameDuplicate"==operation[1]){var tabName=$(obj).val().trim();params.tabName=tabName,callbackFn=tabCustom.checkTabNameDuplicate,tabAndFormsCustom.forSaveForm.isChange=!0}else if(params.tabid=$(obj).parents("ul").attr("id").match(/[\d]+$/).toString(),"showhidetab"==operation[1])params.hidden=!$(obj).is(":checked"),otherDtls.tabName=$(obj).closest("[tablabel]").attr("tablabel"),callbackFn=tabCustom.enableDisableTab;else if("renameTab"==operation[1]){tabName=$(obj).val().trim();var results=[],excludeName=$(obj).siblings("span").text();if(tabName.toLowerCase()==excludeName.toLowerCase())return void $(obj).val($(obj).siblings("span").text());if((results=$.grep(ZPServices.SERVICE_JSON,function(ele){return decodeHTML(ele.dispName.toLowerCase())==tabName.toLowerCase()})).length>0||""==tabName||tabName.length>50){var errorMsg="zp.servicenameduplicateerror";return""==tabName?errorMsg="zp.servicenamenotemptyerror":tabName.length>50&&(errorMsg="zp.servicenamelengthmax"),ZPeople.confirm(null,"",errorMsg,"",!0,!1),void $(obj).val($(obj).siblings("span").text())}params.tabName=tabName,callbackFn=tabCustom.renameTab,otherDtls.obj=obj}}else if("addTab"==operation[0]){$(obj).parents("#newTabPopup").find("[buttonname=done]").addClass("disabled");let tabNameInput=$(obj).parents("#newTabPopup").find("[elem=tabName]"),tabDescInput=$(obj).parents("#newTabPopup").find("[elem=tabDesc]"),tabName=tabNameInput.val().trim(),tabDesc=tabDescInput.val().trim();results=[];results=$.grep(ZPServices.SERVICE_JSON,function(ele){return decodeHTML(ele.dispName.toLowerCase())==tabName.toLowerCase()});var errorDiv=$(obj).parents("#newTabPopup").find("#bodyTag input").parent();errorMsg="";if((results.length>0||""==tabName||tabName.length>50)&&(errorMsg=ZPI18N.getString("zp.servicenameduplicateerror"),""==tabName?errorMsg=ZPI18N.getString("zp.servicenamenotemptyerror"):tabName.length>50&&(errorMsg=ZPI18N.getString("zp.servicenamelengthmax")),errorFunction.errorSpanAttach(errorMsg,tabNameInput.parent())),(""==tabDesc||tabDesc.length>250)&&(""==tabDesc?errorMsg=ZPI18N.getString("zp.servicedesc"):tabDesc.length>250&&(errorMsg=ZPI18N.getString("zp.desclength")),errorFunction.errorSpanAttach(errorMsg,tabDescInput.parent())),""!=errorMsg)return void $(obj).parents("#newTabPopup").find("[buttonname=done]").removeClass("disabled");$(obj).parents("#newTabPopup").find("[buttonname=done]").addClass("disabled"),params.tabName=tabName,params.tabDesc=tabDesc,params.fromaddform=!1,otherDtls.obj=errorDiv,callbackFn=tabCustom.createTab}else if("deleteTab"==operation[0]){var ulDiv=$(obj).parents("ul"),formsLi=$(ulDiv).find("li[name=formLi]");if(iserror=!0,0!=formsLi.length)return void ZPeople.confirm(null,"","zp.emptyservicedeleteerror","",!0);params.tabid=$(obj).parents("ul").attr("id").match(/[\d]+$/).toString(),otherDtls.obj=ulDiv,tabCustom.param=[url,params,tabCustom.deleteTab,otherDtls];var deleteMsg=ZPI18N.getString("zp.deletemessage",["tab"]),serviceObj=(tabName=$(obj).closest("[tablabel]").attr("tablabel"),ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",tabName,!0));return deleteMsg=ZPI18N.getString("zp.deletemessage",[ZPI18N.getString("zp.service")]),!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))&&void 0!=serviceObj&&serviceObj.enable_hrcase&&(deleteMsg=ZPI18N.getString("zp.delserviceconfirm")),void ZPeople.confirm(null,"",deleteMsg,tabCustom.deleteRequest,!1,!0)}ZPeople.Request.send(url,params,callbackFn,otherDtls,formCustom.failureCallBack)},checkTabNameDuplicate:function(resultData,params,others){tabAndFormsCustom.forSaveForm.isChange=!1,"true"==resultData.msg.trim()&&(errorFunction.errorSpanAttach(ZPI18N.getString("zp.servicenameduplicateerror"),$(others.obj).parent("div"),!1,!0),$(others.obj).parents("[errorDiv=cantbeempty]").attr("test","newTab"),$(others.obj).parents("[errorDiv=cantbeempty]").find(".red").attr("test","newTab")),$(others.obj).attr("isDup",resultData.msg.trim()),tabAndFormsCustom.forSaveForm.isClick&&tabCustom.saveForm($(others.obj).parents("#dvaddform").find("[buttonname=done]")),tabAndFormsCustom.forSaveForm.isClick=!1},deleteRequest:function(){ZPeople.Request.send(tabCustom.param[0],tabCustom.param[1],tabCustom.param[2],tabCustom.param[3]),tabCustom.param=[]},saveSuccess:function(data,params,others){if("Success"==data.msg.trim()){if($(others.obj).modal("hide"),data.hasOwnProperty("formId")){if(AppsCustom.hasOwnProperty("appCount")&&--AppsCustom.appCount,"function"==typeof others.successCallback)others.successCallback(data,others);else{window.location.href="#admin/formslayout/formedit-"+data.formId;var formDtls=[{isHidden:!1,isCustom:!0,formId:data.formId,formName:data.formName}];if(data.hasOwnProperty("tabId")){var len=parseInt($("#tabsPageDiv [name=tabColumn] [name=tabDiv]").length)+1,tabDtls={tabDisplayName:data.tabDisplayName,tabName:data.tabName,tabId:data.tabId,formDetailsMap:formDtls,isLink:!1},switchInfo={isSwitch:!0,switchId:"showhide_"+data.tabId,isHidden:!1,isCustom:!0,deletemethod:"tabCustom.tabOperations(this,['deleteTab'])",enablemethod:"tabCustom.tabOperations(this,['custOperations','showhidetab'])",title:ZPI18N.getString("zp.deleteservice"),name:""},last=$("#accordion").find("#tabsPageDiv [name=tabDiv] span:contains("+len+")").last();last=$(last).parents("[name=tabDiv]"),$(last).parents("[name=tabColumn]").siblings("[name=tabColumn]").append(tabAndFormsCustom.tabsPageConstruction.tabDiv(len+1,tabDtls,switchInfo)),Layout.CustomizedUrl.refreshService()}else tabAndFormsCustom.tabsPageConstruction.formsListConstruction(formDtls,$("#accordion").find("ul#Tab_"+params.tabId));if(AccessControl.Permissions.remove(),tabCustom.sortForms(),tabCustom.emptyTabCheck(),$("#dvaddform [keyname=selformId]").append("<option value="+data.formId+">"+data.formName+"</option>"),data.hasOwnProperty("tabId")&&$("#dvaddform [keyname=tabId]").append("<option value="+data.tabId+">"+data.tabDisplayName+"</option>"),$("#tabNameList option[value="+params.tabId+"]").length<=0)$("#admin-formslayout-formslist").remove();else{var formsList=formsListCustom.formsListPageConstruction.SINGLEFORMTEMPLATE;formsList=(formsList=(formsList=(formsList=(formsList=formsList.replace(/\$DISABLECLASS\$/g,"")).replace(/\$FORMLINK\$/g,data.formId)).replace(/\$FORMNAME\$/g,data.formName)).replace(/\$TABNAME\$/g,$("#formsListingHeader #tabSpecificForms_"+params.tabId).find("[id=tabname]").html())).replace(/\$FORMID\$/g,data.formId);var enableDisableTemplate="";enableDisableTemplate=(enableDisableTemplate=(enableDisableTemplate=formsListCustom.formsListPageConstruction.ENABLEDISABLETEMPLATE).replace(/\$CHECKED\$/g,"checked")).replace(/\$FORMID\$/g,data.formId),formsList=(formsList=formsList.replace(/\$ENABLEDISABLEICON\$/g,enableDisableTemplate)).replace(/\$RULECONFIGURE\$/g,'<a class="btn btn-default btnfrmconfig" onclick="ZPFRules.addRule(\''+data.formId+"')\">"+ZPI18N.getString("zp.configure")+"</a>");var deleteDiv='<a class="IC-delete ML20" buttonname="delete" onclick="'+tabAndFormsCustom.formDeleteMethod+'"></a>';formsList=formsList.replace(/\$DELETEICON\$/g,deleteDiv),$("#tabSpecificForms_"+params.tabId).append(formsList),$("#formsCount").show().siblings("#totalForms").hide()}tabAndFormsCustom.hasOwnProperty("FormCount")&&--tabAndFormsCustom.FormCount,tabCustom.dvfrmlstcontentEntry(data.formId,!0,!0),ZPServices.addFormInService([{pcId:data.formId,dispName:data.formName,label:data.labelName,viewId:data.viewId}],!0,void 0,void 0,data.serviceId),Layout.CustomizedUrl.refreshTab()}void 0!=others.otherActions&&"function"==typeof others.otherActions&&others.otherActions()}}else(data.hasOwnProperty("error")||""!=data.msg.trim())&&(ZPeople.Message.showFailureMsg(data.msg.trim()),$("#dvaddform [buttonname=done]").removeClass("disabled"))},addNewForm:function(obj,fromTab,optns){var tabid=null;$("#addFormSlider");fromTab&&($(obj).parents("ul").length>0?tabid=$(obj).parents("ul").attr("id").match(/[\d]+$/).toString():0!=$("#formsListingHeader:visible #tabNameList").val()&&(tabid=$("#formsListingHeader:visible #tabNameList").val())),optns||(optns={tabshow:!0},null!=tabid&&(optns.tabid=tabid)),AppsCustom.addNewApp(obj,optns)}},formsListCustom={url:"/getFormsListing.zp",init:function(){$("#formsListingHeader:visible #zp_page_loading").show(),ZPeople.Request.send(formsListCustom.url,{method:"formsListPage"},formsListCustom.getformsListPage,"")},getformsListPage:function(resultData){resultData.hasOwnProperty("tabFormDetails")?(resultData=resultData.tabFormDetails,$("#formsListingHeader:visible #zp_page_loading").remove(),$("#formsListingHeader:visible").append(formsListCustom.formsListPageConstruction.Construct(resultData)),$("#formsListingHeader #tabNameList").off(),$("#formsListingHeader #tabNameList").on("change",function(){$("#tabSpecificForms_"+$(this).val()).show().siblings("[id*=tabSpecificForms_]").hide(),0==$(this).val()&&$("[id*=tabSpecificForms_]").show(),$("#formsCount").show().siblings("#totalForms").hide()}),formCustom.minimiseTab(!1)):""!=resultData.msg.trim()&&ZPeople.Message.showFailureMsg(resultData.msg.trim())}};formsListCustom.formsListPageConstruction={initConstants:function(){this.FORMSLISTTEMPLATE='<div class="ZPTscrlcont"><table id="appendFormsBody" class="table table-hover table-responsive tblfrmlst"><thead><tr><th width="20" class=""></th><th width="30%"><span>'+ZPI18N.getString("zp.formname")+'</span></th><th width="20%"><span>'+ZPI18N.getString("zp.hrservicename")+"</span></th><th><span>"+ZPI18N.getString("zp.status")+"</span></th><th><span>"+ZPI18N.getString("zp.rule")+'</span></th><th width="15%"><span></span></th></tr></thead></table></div>',this.SINGLEFORMTEMPLATE='<tr $DISABLECLASS$ name="formLi" id="$FORMID$" onlydisable="$ISONLYDISABLE$"><td></td><td><div><a href="#admin/formslayout/formedit-$FORMLINK$" class="ulnk" >$FORMNAME$</a></div></td><td id="tabname">$TABNAME$</td><td>$ENABLEDISABLEICON$</td><td>$RULECONFIGURE$</td><td>$DELETEICON$</td></tr>',this.SINGLEFORMWITHOUTCUSTOMTEMPLATE='<tr $DISABLECLASS$ name="formLi" id="$FORMID$" onlydisable="$ISONLYDISABLE$"><td></td><td><div>$FORMNAME$</div></td><td id="tabname">$TABNAME$</td><td>$ENABLEDISABLEICON$</td><td></td><td>$DELETEICON$</td></tr>',this.ENABLEDISABLETEMPLATE='<div class="btnactive" name="forCustom"><input id="formDisable_$FORMID$" $CHECKED$ class="cmn-toggle-small cmn-toggle-round-small" type="checkbox" onclick="'+tabAndFormsCustom.formEnableMethod+'"><label for="formDisable_$FORMID$" class="M0"></label></div>'}},formsListCustom.formsListPageConstruction.Construct=function(resultData){var formsListOuter=formsListCustom.formsListPageConstruction.FORMSLISTTEMPLATE;return formsListOuter=$(formsListOuter),$.each(resultData,function(tabIndex,tabValue){if(!tabValue.isHidden&&tabValue.formDetailsMap.length>0){var formsList="";$.each(tabValue.formDetailsMap,function(formIndex,formValue){if((!ZPeople.isDeptDesgRestricted||"P_Department"!=formValue.componentName&&"P_Designation"!=formValue.componentName)&&!formValue.isExtensionForm){$.inArray(formValue.tablename,["P_VaccinationStatus"])>=0?formsList+=formsListCustom.formsListPageConstruction.SINGLEFORMWITHOUTCUSTOMTEMPLATE:formsList+=formsListCustom.formsListPageConstruction.SINGLEFORMTEMPLATE;var checked="",disableClass='class = "disabled"';0==formValue.isHidden&&(checked="checked",disableClass=""),formsList=(formsList=(formsList=(formsList=(formsList=formsList.replace(/\$DISABLECLASS\$/g,disableClass)).replace(/\$FORMLINK\$/g,formValue.formId)).replace(/\$FORMNAME\$/g,formValue.formName)).replace(/\$TABNAME\$/g,tabValue.tabDisplayName)).replace(/\$FORMID\$/g,formValue.formId);var enableDisableTemplate="";isPlatformOrg&&!formValue.isCustom||((!formValue.hasOwnProperty("tablename")||$.inArray(formValue.tablename,["P_Employee","P_EmployeeLeave","P_ClientDetails","P_TimesheetJobsList","P_TimesheetJob","P_Timesheet","P_EmployeeJobs","P_Goals","P_SelfAppraisal","P_PerformanceAppraisal","P_Workplace_Readiness"])<0)&&$.inArray(formValue.componentName,["P_AppraiseeList"])<0?enableDisableTemplate=(enableDisableTemplate=(enableDisableTemplate=formsListCustom.formsListPageConstruction.ENABLEDISABLETEMPLATE).replace(/\$CHECKED\$/g,checked)).replace(/\$FORMID\$/g,formValue.formId):$.inArray(formValue.tablename,["P_EmployeeLeave"])>=0&&1==formValue.isHidden&&(enableDisableTemplate=(enableDisableTemplate=(enableDisableTemplate=formsListCustom.formsListPageConstruction.ENABLEDISABLETEMPLATE).replace(/\$CHECKED\$/g,checked)).replace(/\$FORMID\$/g,formValue.formId),formsList=formsList.replace(/\$ISONLYDISABLE\$/g,!0)),$.inArray(formValue.tablename,["P_EmployeeHealthData","P_Workplace_Readiness","P_Visitor"])>=0&&(formsList=formsList.replace(/\$RULECONFIGURE\$/g,""))),formsList=(formsList=(formsList=formsList.replace(/\$ISONLYDISABLE\$/g,!1)).replace(/\$ENABLEDISABLEICON\$/g,enableDisableTemplate)).replace(/\$RULECONFIGURE\$/g,'<a class="btn btn-default btnfrmconfig" onclick="ZPFRules.addRule(\''+formValue.formId+"')\">"+ZPI18N.getString("zp.configure")+"</a>");var deleteDiv=formValue.isCustom?'<a class="IC-delete ML20" buttonname="delete" onclick="'+tabAndFormsCustom.formDeleteMethod+'"></a>':"";formsList=formsList.replace(/\$DELETEICON\$/g,deleteDiv)}}),(formsList=$(formsList)).length>0&&($("#formsListingHeader #tabNameList").append('<option value="'+tabValue.tabId+'">'+tabValue.tabDisplayName+"</option>"),formsListOuter.find("#appendFormsBody").append(jQuery("<tbody></tbody>",{id:"tabSpecificForms_"+tabValue.tabId}).append(formsList)))}}),formsListCustom.showHideNoData(formsListOuter),formsListOuter},formsListCustom.showHideNoData=function(formsListOuter){let formsCont=formsListOuter?formsListOuter.find("#appendFormsBody"):Layout.Page.container.find("#appendFormsBody");formsCont.length>0&&(0==formsCont.find("tr[name=formLi]").length?formsCont.parent().append('<i elem="formListEmptyDivCont">'+ZPUtil.newNoDataHTML("CR-nodata",8,ZPI18N.getString("zp.noformsavailable"),"","","")+"</i>"):formsCont.siblings("[elem=formListEmptyDivCont]").remove())},formsListCustom.formsListCount=function(obj){var count=$("#appendFormsBody tr[name=formLi]:visible").length;$(obj).hide(),$(obj).siblings("#totalForms").text(count).show()};var Agreements={norecElm:'<tr><td class="text-center" colspan="7">'+ZPI18N.getString("zp.norecfound")+"</td></tr>",isFilterCached:!1,isCachedAgrList:!1,adobeCompatibleExtns:["pdf","doc","docx","xls","pdf","xlsx","ppt","pptx","jpg","png","gif","tif","txt","rtf"],fileName:null,fileId:null,isSendAgreement:!1,isCancelAgr:!1,isFilterOpen:!1,emailidfield:{},fileuploadfield:{},isFormCatListCached:!1,isChinaSetup:!1,recordId:null,agreeStartindex:0,agreeFirescroll:!1,selectedRecpForm:null,cloudElm:'<div class="col-sm-6"><div class="ZPUFile" id="err_div"><div class="ZPUlft" id="beforeUpload"><span>Attach from </span><div class="ZPCfile"><span>Desktop</span><input class="ZPFfile form-control" onchange=Files.changeOnUpload($(this).val(),"localUpload") name="envelope" id="uploadfile" type="file"></div></div> <div class="ZPUlft DN" id="afterUpload"><span id="drop_file"><span></span><i class="IC-cls-r red" onclick="Files.toggleFileFieldDisplay()"></i></span></div></div><div class="ZPMxlt PSI" id="maxPopup"></div></div>',add:{header:'<h6 id="agreementHeader" class="addPopTitle">'+ZPI18N.getString("zp.requestsignature")+'</h6><button aria-label="Close" data-dismiss="modal" onclick="Agreements.getAgreementsListPage()" class="close" id="close_btn" type="button"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button>',bodyCont:'<div class="form-horizontal pad"><iframe width="100%" height="100%" src="" name="createAgmntResp" style="min-height:500px; min-width:600px; display:none; overflow:hidden;"></iframe> <form target="createAgmntResp" id="createAgmntForm" enctype="multipart/form-data" method="post" role="form"> <div class="form-group" id="files_list"> <label class="control-label col-sm-3 zp_mdt" id="file_lbl"><font>'+ZPI18N.getString("zp.file")+'</font></label></div> <div class="form-group DN" id="template_grp"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.selecttemplate")+'</font></label><div class="col-sm-6"><div><select id="templates"><option value="0">Select</option></select></div></div></div><div class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.reciepents")+'</font></label> <div class="col-sm-6" id="recp"> <input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="recipients" id="recpList" autocomplete="off" class="form-control"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</label> <div class="col-sm-6"> <input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="email_copies_to" id="copyList" autocomplete="off" class="form-control"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.name")+'</font></label> <div class="col-sm-6"> <input name="agreement_name" id="agmntName" autocomplete="off" class="form-control"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.message")+'</label> <div class="col-sm-6"> <textarea rows="5" class="form-control" name="agreement_message" id="agmntMsg" fieldtype="3"></textarea> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.deadline")+'</label> <div class="col-sm-6"> <div class="btnCal"><input type="text" name="deadline" id="deadline" autocomplete="off" caltype="popup" onclick="Calendar.setUpCalendar(event,this)" class="form-control"></div> </div> </div> <div class="form-group"><label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.folder")+'</font></label> <div class="col-sm-6"><select onchange=Files.clearErrmsg("companycategory_err") placeholder="'+ZPI18N.getString("Select")+'" id="agrselect_Cat" class="" tabindex="-1"></select><input type="name" style="display: none;" class="form-control" id="hrnewCategory" autocomplete="off"></div> <div class="col-sm-3" id="cancel_hrCat_btn" style="display:none"> <a href="javascript:void(0)" onclick="Agreements.cancelnewCategory();" class="btn btn-default btn-sm MT5">'+ZPI18N.getString("zp.cancel")+'</a> </div> </div> <div class="form-group"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" id="reminder_check" onclick="Agreements.showRemindersMode()"><span>'+ZPI18N.getString("zp.reminder")+'</span></label> </div> </div> <div id="remindRecp" style="display:none;" class="form-group"> <label class="control-label col-sm-3"></label> <div class="col-sm-6 PL30 ML2"> <label class="radio DIB MR8"><input type="radio" checked="checked" value="1" name="reminder"><span class="ML2">'+ZPI18N.getString("zp.daily")+'</span></label> <label class="radio DIB MR8"><input type="radio" value="2" name="reminder"><span class="ML2">'+ZPI18N.getString("zp.weekly")+'</span></label> </div> </div> <div class="form-group"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" onclick="Agreements.toggleSignFlowDiv(this)" name="needsendersign" id="senderSign"><span>'+ZPI18N.getString("zp.signthedoc")+'</span></label> </div> </div> <div id="my_sign" style="display:none;" class="form-group"> <label class="control-label col-sm-3"></label> <div id="senderSignFlow" class="col-sm-6 PL30 ML2"> <label class="radio DIB MR8"><input type="radio" checked="checked" value="1" name="signature_flow"><span>'+ZPI18N.getString("zp.first")+'</span></label> <label class="radio DIB MR8"><input type="radio" value="2" name="signature_flow"><span>'+ZPI18N.getString("zp.last")+'</span></label> </div> </div> <div class="form-group"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" id="previewDoc" name="preview_document"><span>'+ZPI18N.getString("zp.previewdoc")+'</span></label> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.language")+'</label> <div class="col-sm-6"> <select id="agrselect_language" name="language"></select> </div> </div> <input type="hidden" value="" id="conreqcsr" name="conreqcsr"> </form> </div>',footer:'<div id="ca_footer" class="modal-footer text-left"><button onclick="Agreements.createAgreement(this)" id="footer_submit" type="button" class="btn btn-primary">'+ZPI18N.getString("zp.send")+'</button><button type="button" onclick="Agreements.getAgreementsListPage()" id="footer_close" data-dismiss="modal" class="btn btn-default">Cancel</button></div>',cloud:'<span class="dgry ML2 MR2">or</span><a onclick="Files.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl, \'AdobeSign\')">Cloud</a>'},view:{header:'<h6 class="addPopTitle" id="agreementHeader">'+ZPI18N.getString("zp.documentdtls")+'</h6><a class="close IC-cls" onclick="Agreements.getAgreementsListPage()" data-dismiss="modal"></a></h6>',bodymainContent:'<div class="Scrcont"><div class="ZPSdiv"><span class="FL"><b id="agName" class="DB MB5"></b><span id="doc_sent_date" class="dgry S12"></span></span><span class="FR"><span id="agOwner"></span><img id="senderProfile" src=""></span></div><div class="ZPSdiv"><span class="FL"><b>'+ZPI18N.getString("zp.status")+'</b></span><span class="FR"><span class="FR"><span class="DB MB5"><b id= "status"></b><i id="taskCompleted"></i></span><span id="completed_date" class="dgry S12"></span></span></span></div><div class="ZPSdiv"><span class="FL"><b>Last Date</b></span><span class="FR"><b id="deadLine"></b></span></div><div class="ZPSdiv"><span class="DB"><b>'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</b></span><span class="DB ML20 MT10"><span class="DB MB5"><b id="mail_copies"></b></span></span></div><div class="ZPSdiv bn"><span class="DB"> <b>'+ZPI18N.getString("zp.message")+'</b> </span> <span class="DB ML20 MT10"> <span class="DB MB5"><b id = "agr_msg"></b></span> </span> </div> <div class="lineHdr"> <b class="DB">'+ZPI18N.getString("zp.attachments")+'</b><div id = "attachmentsData" class="attDiv"></div></div><div class="lineHdr"><div class="boxShLst"><b class="DB">'+ZPI18N.getString("zp.reciepents")+'</b><ul id ="recipientsList"></ul></div></div><div class="lineHdr"><b class="DB MB10">'+ZPI18N.getString("zp.activity")+'</b><div class="aclog_cont"><div class="aclog_detl" id="actDetails"></div></div></div></div></div>',bodyCont:'<div class="form-horizontal pad"> <div style="padding:0" class="dveSignview MB30 clearfix" id="agrmnt_dtlsview"> <h6 class="ZPbold MT0">'+ZPI18N.getString("zp.agreementdtls")+'</h6> <div class="col-md-6"> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.name")+'</label> <div class="col-sm-8"> <span id="agName"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.agreementowner")+'</label> <div class="col-sm-8"> <span id="agOwner"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.datesent",new Array(""))+'</label> <div class="col-sm-8"> <span id="sentDate"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</label> <div class="col-sm-8"> <span id="mail_copies"></span> </div> </div> </div> <div class="col-md-6"> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.status")+'</label> <div class="col-sm-8"> <span id="status"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.datecompleted",new Array(""))+'</label> <div class="col-sm-8"> <span id="completed_date"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.message")+'</label> <div class="col-sm-8"> <span id="agr_msg"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.deadline")+'</label> <div class="col-sm-8"> <span id="deadLine"></span> </div> </div> </div> </div> <h6><span class="ZPbold">'+ZPI18N.getString("zp.attachments")+'</span><div class="clearfix"></div></h6> <table class="table table-hover"> <thead> <tr class="TblGryBg"> <th width="500">'+ZPI18N.getString("zp.filename")+"</th> <th>"+ZPI18N.getString("zp.modifiedtime")+'</th> <th width="150"></th> </tr> </thead> <tbody id="attachments_Info"> </tbody> </table> <h6><span class="ZPbold">'+ZPI18N.getString("zp.reciepents")+'</span><div class="clearfix"></div></h6> <table class="table table-hover"> <thead> <tr class="TblGryBg"> <th>'+ZPI18N.getString("zp.reciepentname")+"</th> <th>"+ZPI18N.getString("zp.mail")+"</th> <th>"+ZPI18N.getString("zp.type")+"</th> <th>"+ZPI18N.getString("zp.reciepentorder")+"</th> <th>"+ZPI18N.getString("zp.status")+"</th> <th>"+ZPI18N.getString("zp.reciepentdelivered")+"</th> <th>"+ZPI18N.getString("zp.datecompleted",new Array(""))+'</th> </tr> </thead> <tbody id="recipientsList"> </tbody> </table> <h6><span class="ZPbold">'+ZPI18N.getString("zp.agreementevents")+'</span><div class="clearfix"></div></h6> <table class="table table-hover Vlis bgc"> <thead> <tr class="TblGryBg"> <th>'+ZPI18N.getString("zp.eventsname")+"</th> <th>"+ZPI18N.getString("zp.description")+"</th> <th>"+ZPI18N.getString("zp.date")+'</th> </tr> </thead> <tbody id="eventsList"> </tbody> </table> </div>',footer:'<div class="modal-footer text-left"><button type="button" id="send_remindBtn" class="btn btn-primary" onclick = "Agreements.sendReminder(this)">'+ZPI18N.getString("zp.sendreminder")+'</button><div class="FR"><button type="button" id="cancelAgreebtn" onclick=Agreements.reasonToCancelAgrPopUp(this)  class="btn btn-default">'+ZPI18N.getString("zp.canceldocument")+'</button><button type="button" class="btn btn-default FR" data-dismiss="modal" onclick="Agreements.getAgreementsListPage()">'+ZPI18N.getString("zp.close")+"</a></button></div>"},openAgreement:function(mode,isFromEmployeeView){Agreements.selectedRecpForm=null,Agreements.isFromEmployeeView=isFromEmployeeView;var file_elm,pageId=Layout.Page.container,searchElm=pageId.find("div#createAgreementModal");if(0===searchElm.length?ZPeople.BSModal.setup({id:"createAgreementModal",type:22,modalClass:"popRgtModel",headerHtml:Agreements.add.header,body:Agreements.add.bodyCont,footer:Agreements.add.footer}):(ZPeople.BSModal.setup({id:"createAgreementModal",type:2,modalClass:"popRgtModel"}),searchElm.removeClass("PopMdxModel l0"),searchElm.find("form#createAgmntForm,div#ca_footer,#close_btn,button#footer_submit").show(),searchElm.find("button#footer_close").text(ZPI18N.getString("zp.cancel")),searchElm.find("input[class='form-control'],textarea#agmntMsg").val(""),searchElm.find("input[type='checkbox']").prop("checked",!1),searchElm.find("div#my_sign,div#remindRecp").hide(),searchElm.find("div#afterUpload").addClass("DN"),searchElm.find("div#beforeUpload").removeClass("DN"),searchElm.find("div#zp_page_loading").remove(),searchElm.find("iframe[name='createAgmntResp']").hide(),searchElm.find("input#uploadfile").val(""),searchElm.find("form#createAgmntForm input[type='text'] textarea").val(""),pageId.find("i#agrm_filterIc").attr("class","IC-filter S18 CP FR ML20 MT5 gry"),searchElm.find("span#errormsg").remove(),searchElm.find("div#cancel_hrCat_btn,input#hrnewCategory").hide(),searchElm.find("div#s2id_agrselect_Cat").find("button#addcat_btn").remove(),(isadmin||1==loginUserRoleCheck||2==loginUserRoleCheck)&&(searchElm.find("select#agrselect_Cat").val("select").select2(),searchElm.find("div#s2id_agrselect_Cat").find("ul").after('<button class="btn btn-primary" onclick="Agreements.shownewCategory(this)" data-toggle="modal" id="addcat_btn">'+ZPI18N.getString("zp.addcat")+"</button>"))),pageId.find("input#previewDoc").closest("label.checkbox").removeClass("disabled"),pageId.find("div#createAgreementModal").find("div#err_div").parent().remove(),pageId.find("div#createAgreementModal").find("select#uploadfile").parent().remove(),pageId.find("div#createAgreementModal").find("span#drop_file").parent().remove(),pageId.find("div#createAgreementModal").find("#recpList").remove(),pageId.find("div#createAgreementModal").find("#recp").empty(),isFromEmployeeView){var formId;formId=null!=Layout.Page.container.attr("id").match(/[\d]+$/)?Layout.Page.container.attr("id").match(/[\d]+$/).toString():ZPForm.CURRFORM_PARAM.formId;var emailidfieldArr={},fileuploadfieldArr={},formCompData=ZPForm.FORM_COMPONENT_DATA[formId];void 0===formCompData&&$.ajax({type:"POST",async:!1,url:"/formAction.zp",data:{mode:"getFormComponents",conreqcsr:csrfToken,formId:formId},success:function(data){formCompData=data}});var formComp=formCompData.message;$.each(formComp.formComponentDetails,function(index){this.isTabular||($.each(this.column1,function(index,fieldData){if(this.fieldType==ZPForm.Field.EMAIL_ADDRESS){var fcId=this.formComponentId;emailidfieldArr[fcId]=this.displayName}else if(this.fieldType==ZPForm.Field.FILE_UPLOAD){fcId=this.formComponentId;fileuploadfieldArr[fcId]=this.displayName}}),$.each(this.column2,function(index,fieldData){if(this.fieldType==ZPForm.Field.EMAIL_ADDRESS){var fcId=this.formComponentId;emailidfieldArr[fcId]=this.displayName}else if(this.fieldType==ZPForm.Field.FILE_UPLOAD){fcId=this.formComponentId;fileuploadfieldArr[fcId]=this.displayName}}))}),Agreements.emailidfield.formId=emailidfieldArr,Agreements.fileuploadfield.formId=fileuploadfieldArr;var option="<option value='select'>Select</option>";Object.keys(Agreements.fileuploadfield.formId).length>0&&$.each(Agreements.fileuploadfield.formId,function(key,value){option+='<option value="'+key+'">'+value+"</option>"}),file_elm='<div class="col-sm-6"> <div class=""> <select id="uploadfile" fieldtype="26" name="file_lbl">'+option+"</select></div> </div>";var multiselin=pageId.find("div#createAgreementModal").find("#recp").find("select"),recpOption="";0!=multiselin.length&&void 0!=multiselin||(Object.keys(Agreements.emailidfield.formId).length>0&&$.each(Agreements.emailidfield.formId,function(key,value){recpOption+='<option value="'+key+'">'+value+"</option>"}),pageId.find("div#createAgreementModal").find("#recp").append('<select multiple placeholder = "Select fields containing Mail IDs" id="recpList" fieldtype="26" name="recipients">'+recpOption+"</select>"));var recList=[];$.each(pageId.find("table#zp_views_records_table tbody").find("input[id='zp_view_sel_record']:checked"),function(index,elm){recList.push($(elm).closest("tr").attr("recordId"))}),0==recList&&recList.push(ZPForm.CURRFORM_PARAM.recordId),pageId.find("div#files_list").show(),pageId.find("div#template_grp").hide(),pageId.find("div#createAgreementModal").data({recList:recList}),pageId.find("input#previewDoc").closest("label.checkbox").addClass("disabled");var hashFormId=Layout.Page.hash.split("formId:")[1];void 0==hashFormId?(hashFormId=ZPForm.CURRFORM_PARAM.formId,pageId.find("div#createAgreementModal").data({formId:hashFormId}),pageId.find("input#previewDoc").closest("label.checkbox").removeClass("disabled")):pageId.find("div#createAgreementModal").data({formId:hashFormId.substring(0,hashFormId.indexOf("/"))})}else-1!==Layout.Page.hash.indexOf("agreementslistview")?(pageId.find("div#createAgreementModal").find("#recp").append('<input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="recipients" id="recpList" autocomplete="off" class="form-control">'),file_elm=Agreements.cloudElm):(pageId.find("div#createAgreementModal").find("#recp").append('<input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="recipients" id="recpList" autocomplete="off" class="form-control">'),file_elm='<div class="col-sm-6"> <div class="ZPFFcus"> <span id="drop_file" class="txttrim">'+ZPI18N.getString("zp.integchoosefile")+'</span> <input name="agmntFile" id="uploadfile" onchange="Agreements.setFIlename(this)" class="ZPFfile form-control"> </div> </div>');if(pageId.find("form#createAgmntForm").find("div#selectDoc,div#file_format").remove(),pageId.find("div#createAgreementModal").find("label#file_lbl").after(file_elm),isFromEmployeeView){pageId.find("div#createAgreementModal").find("label#file_lbl").parent().find("select").select2();var $eventSelect=pageId.find("div#createAgreementModal").find("#recpList").parent().find("select");$eventSelect.select2(),Agreements.selectedRecpForm=[],Agreements.selectedRecpForm=pageId.find("div#createAgreementModal").find("#recpList").val(),$eventSelect.on("change.select2",function(e){if(void 0!=e.added)Agreements.selectedRecpForm.push(e.added.id);else if(void 0!=e.removed){const index=Agreements.selectedRecpForm.indexOf(e.removed.id);index>-1&&Agreements.selectedRecpForm.splice(index,1)}});var docType='<div id="selectDoc" style="" class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.sendfrom",new Array(""))+'</font></label> <div class="col-sm-6"> <label class="radio DIB MR8" onclick="Agreements.showFilesElm()"><input checked="checked" value="1" type="radio" name="esign"><span class="ML2">'+ZPI18N.getString("zp.signoptnfromform")+'</span></label> <label class="radio DIB MR8" onclick="Agreements.showFilesElm()" id="template_list"><input value="2" id="from_mm" type="radio" name="esign"><span class="ML2">'+ZPI18N.getString("zp.mmerge")+'</span></label> </div> </div><div class="form-group DN" id="file_format"><label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.selectformat")+'</font></label> <div class="col-sm-8"><div class="inlRadio"><label class="radio tagbgmail" onclick=MMtemplte.showViewType("1")><input name="1" checked="" id="select_pdf" type="radio"><span>PDF</span></label> <label class="radio tagbgmail" onclick=MMtemplte.showViewType("2")><input name="1" type="radio"><span>DOCX</span></label> </div></div><div></div></div>';pageId.find("form#createAgmntForm").find("div#selectDoc,div#file_format").remove(),pageId.find("form#createAgmntForm").prepend(docType),MMtemplte.constructTemplateList("form",null,null,null,null,!0)}else!isChinaSetup&&Layout.Page.hash.indexOf("agreementslistview-createAgreement")>-1&&pageId.find("div#createAgreementModal").find("input#uploadfile").parent().after(Envelope.add.cloud);var popUpDiv=pageId.find("#maxPopup"),toopTipDiv='<i data-content="<p>'+ZPI18N.getString("zp.maxfileuploadsize",[maxFileSize])+'</p>" data-popover="true" data-html="true" data-toggle="popover" data-placement="bottom" class="IC-info S18 gry form-icon popHover" data-original-title="" title=""></i>';popUpDiv.append(toopTipDiv)},setFIlename:function(thisObj){var fileObj=$(thisObj)[0].files[0];Layout.Page.container.find("div#createAgreementModal").find("span#drop_file").text(fileObj.name)},showFilesElm:function(type){var pageId=Layout.Page.container,modalObj=pageId.find("div#createAgreementModal");"envelope"===type?modalObj=pageId.find("div#createEnvelopeModal"):"document"===type&&(modalObj=pageId.find("div#createDocumentModal")),"1"===modalObj.find("input[name='esign']:checked").val()?(modalObj.find("div#files_list").show(),modalObj.find("div#template_grp").hide(),modalObj.find("div#file_format").addClass("DN")):(modalObj.find("div#files_list").hide(),modalObj.find("div#template_grp").show(),modalObj.find("div#file_format").removeClass("DN"))},openAgrModal:function(mode,thisObj){var returnHash,createAgrModal=Layout.Page.container.find("div#createAgreementModal");if(Agreements.fileName=null,Agreements.fileId=null,"Nbar2F"===$("div#page-wrapper").attr("class")&&(Agreements.isFilterOpen=!0),"agreements"===mode)returnHash=Layout.Page.hash.indexOf("files/fileView/agreementslistview")>-1?"#files/fileView/agreementslistview-createAgreement":"#files/adobesign/agreementslistview-createAgreement",createAgrModal.find("input#uploadfile").attr("type","file");else{var fileId,fileName;fileId=thisObj,fileName=Layout.Page.container.find("div#hr_allfileList").find("ul[fileID="+fileId+"]").attr("fileName"),createAgrModal.find("input#uploadfile").attr("type","text"),Agreements.fileName=fileName,Agreements.fileId=fileId,Agreements.isSendAgreement=!0,returnHash=Layout.Page.hash}window.location.href=returnHash,Files.Esign.getAgreementsListPage(mode)},createAgreement:function(thisElm){var recipients,recplist,innerForm=!1,isFile=!1,searchElem=Layout.Page.container,createAgr=searchElem.find("div#createAgreementModal");if(Agreements.isFromEmployeeView)createAgr.find("#uploadfile").val(),recplist=createAgr.find("#recpList").val(),null!=Agreements.selectedRecpForm&&(recplist=Agreements.selectedRecpForm);else{var agmntFile=createAgr.find("#uploadfile")[0];"file"===$(agmntFile).attr("type")&&(agmntFile=agmntFile.files[0],isFile=!0);var recipientsMailIds=createAgr.find("input#recpList").val().split(",");null!=Agreements.selectedRecpForm&&(recipientsMailIds=Agreements.selectedRecpForm),recipients=this.constructMailFmt(recipientsMailIds)}var email_copies_to=createAgr.find("#copyList").val(),agreement_name=createAgr.find("#agmntName").val(),agreement_message=createAgr.find("#agmntMsg").val(),deadline=createAgr.find("#deadline").val(),reminder=createAgr.find("#remindRecp").find("label :checked").val(),needsendersign=createAgr.find("#senderSign").is(":checked"),signature_flow=createAgr.find("#senderSignFlow").find("label :checked").val(),preview_document=createAgr.find("#previewDoc").is(":checked"),catId=createAgr.find("select#agrselect_Cat").val(),newCatName=createAgr.find("input#hrnewCategory").val(),language=createAgr.find("select#agrselect_language").val();if(!Agreements.validation(isFile)){searchElem.find("#conreqcsr").val(csrfToken);var formData=new FormData;isFile&&void 0!=agmntFile&&formData.append("agmntFile",agmntFile),formData.append("conreqcsr",csrfToken),ZPSetupCommon.isEmpty(recipients)||formData.append("recipients",recipients),ZPSetupCommon.isEmpty(recplist)||formData.append("recipients",recplist);var recList=searchElem.find("div#createAgreementModal").data("recList");ZPSetupCommon.isEmpty(recList)||formData.append("recList",recList),Agreements.isFromEmployeeView&&(formData.append("relatedModule","2"),"2"===searchElem.find("div#createAgreementModal").find("input[name='esign']:checked").val()?formData.append("templateId",searchElem.find("div#createAgreementModal").find("select#templates").val()):formData.append("fileList",searchElem.find("div#createAgreementModal").find("#uploadfile").val())),formData.append("email_copies_to",email_copies_to),formData.append("agreement_message",agreement_message),formData.append("deadline",deadline),formData.append("needsendersign",needsendersign),formData.append("signature_flow",signature_flow),formData.append("preview_document",preview_document);var formId=searchElem.find("div#createAgreementModal").data("formId");void 0==formId&&(formId=ZPForm.CURRFORM_PARAM.formId);var action="sendAgreement";ZPSetupCommon.isEmpty(formId)?!0:formData.append("formId",formId),ZPSetupCommon.isEmpty(formId)||-1!=Layout.Page.hash.indexOf("view-formLinkName:")||-1!=Layout.Page.hash.indexOf("selfservice/user")||(action="scheduleSendAgreement"),(Layout.Page.hash.indexOf("view-formLinkName:")>-1||Agreements.isFromEmployeeView)&&(innerForm=!0),formData.append("action",action),formData.append("innerForm",innerForm),ZPSetupCommon.isEmpty(Files.uploadMode)||formData.append("uploadMode",Files.uploadMode),ZPSetupCommon.isEmpty(Files.uploadedDocObj)||formData.append("cloudUploadDoc",JSON.stringify(Files.uploadedDocObj));var fileID=null;if(isFile||ZPSetupCommon.isEmpty(createAgr.data("fileId"))||(fileID=createAgr.data("fileId"),formData.append("fileId",fileID)),ZPSetupCommon.isEmpty(language)||"select"===language||formData.append("language",language),null!==catId&&formData.append("catId",catId),formData.append("newCatName",newCatName),ZPSetupCommon.isEmpty(reminder)||formData.append("reminder",reminder),ZPSetupCommon.isEmpty(agreement_name)&&createAgr.find("#agmntName").val(createAgr.find("span#drop_file").text()),createAgr.find("input#select_pdf").is(":checked")?formData.append("docType","pdf"):formData.append("docType","docx"),Layout.Page.hash.indexOf("recordId:")>-1){var recordId=Layout.Page.hash.split("recordId:")[1];formData.append("recordId",recordId)}else void 0!=ZPForm.CURRFORM_PARAM.recordId&&formData.append("recordId",ZPForm.CURRFORM_PARAM.recordId);formData.append("agreement_name",createAgr.find("#agmntName").val()),createAgr.find("#createAgmntForm").css("display","none"),createAgr.find("div#zp_modal_body").append(ZPeople.LOADING_HTML),createAgr.find("div#ca_footer").hide(),$.ajax({url:"/adobeSignActions.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(data){Agreements.selectedRecpForm=null;var agreementResp=data[1];if(!0===agreementResp){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.documentscheduled")),Layout.Page.container.find("#zp_views_formrecactions").attr("style","display:block"),createAgr.modal("hide");var formRowsObj=Layout.Page.container.find("table#zp_views_records_table tbody");return formRowsObj.find("input#zp_view_sel_record").prop("checked",!1),$.each(recList,function(index,recId){formRowsObj.find("tr[recordid="+recId+"]").attr("isAgreementSent","true"),formRowsObj.find("tr[recordid="+recId+"]").attr("module",data[1].MODULE),formRowsObj.find("tr[recordid="+recId+"]").attr("agreeid",data[1].recordId)}),void Layout.Page.container.find("div#zp_view_record_delete").hide()}ZPView.newRecordDetails.agreeid=data[1].ARID,ZPView.newRecordDetails.module=data[1].MODULE,createAgr.find("div#zp_page_loading").remove(),createAgr.find("iframe[name='createAgmntResp']").css("display","block"),createAgr.find("iframe[name='createAgmntResp']").attr("src",agreementResp.url),createAgr.addClass("PopMdxModel l0"),agreementResp.newCat&&(createAgr.find("select#agrselect_Cat").append("<option value='"+agreementResp.catId+"'>"+newCatName+"</option>"),Object.keys(Files.newCategoryList).length>0&&(Files.newCategoryList[agreementResp.catId]=ZSEC.Encoder.encodeForHTML(newCatName),Layout.Page.container.find("select#search_cat").append("<option value='"+agreementResp.catId+"'>"+ZSEC.Encoder.encodeForHTML(newCatName)+"</option>")));agreementResp.status;createAgr.find("div#ca_footer,button#close_btn").show(),createAgr.find("button#footer_submit").hide(),createAgr.find("button#footer_close").text(ZPI18N.getString("zp.close"));var catName=createAgr.find("select#agrselect_Cat option[value='"+agreementResp.catId+"']").text();if(-1===Layout.Page.hash.indexOf("-formId")&&-1===Layout.Page.hash.indexOf("files/hrfile")&&-1===Layout.Page.hash.indexOf("files/adobesign/agreementslistview")){var viewObj=Layout.Page.container.find("#documents_list_form"),relobj=Layout.Page.container.find("#anchor_single_doc_list");viewObj.is(":visible")&&(relobj.hasClass("collapsed")||relobj.addClass("collapsed"),viewObj.slideUp())}if(null!=fileID){var sendFileObj=searchElem.find("ul[fileID="+fileID+"]");sendFileObj.find("i#send_agrmnt").addClass("grn"),sendFileObj.find("span#send_envelope").hide(),sendFileObj.attr("agreementId",agreementResp.ARID),searchElem.find("ul[fileid="+fileID+"]").find("i#send_agrmnt").parent().attr("onclick","Agreements.getAgreementPreview('"+agreementResp.ARID+"','','selffiles')"),searchElem.find("ul[fileid="+fileID+"]").find("i#send_agrmnt").removeClass("IC-adobe"),searchElem.find("ul[fileid="+fileID+"]").find("i#send_agrmnt").addClass("IC-send-file S14 grn FR MR15"),searchElem.find("ul[fileid="+fileID+"]").find("i#send_agrmnt").attr("title",ZPI18N.getString("zp.documentdtls"));var ele=searchElem.find("ul[fileid="+fileID+"]").find("i#send_agrmnt");searchElem.find("ul[fileid="+fileID+"]").find("i#send_agrmnt").parent().text(ZPI18N.getString("zp.documentdtls")),searchElem.find("ul[fileid="+fileID+"]").find(".PR5").append(ele)}if(ZPSetupCommon.isEmpty(catName)&&(catName=createAgr.find("input#hrnewCategory").val()),-1!==Layout.Page.hash.indexOf("files/adobesign/agreementslistview")){var pageId=Layout.Page.container,envName=pageId.find("input#search_agname").val(),catId=pageId.find("select#search_cat").val(),status=pageId.find("select#search_status").val(),name=agreementResp.name;catId!=agreementResp.catId&&""!=catId&&"select"!=catId||"Out for Signature"!=status&&""!=status&&"select"!=status||-1==name.indexOf(envName)&&""!=envName||(agreementResp.name=ZSEC.Encoder.encodeForHTML(agreementResp.name),agreementResp.OWN=ZSEC.Encoder.encodeForHTML(agreementResp.OWN),agreementResp.ownerId=ZSEC.Encoder.encodeForHTML(agreementResp.ownerId),Layout.Page.container.find("#agreements_list").prepend(Agreements.constructAgreementData(agreementResp,"single")),0===pageId.find("#agreements_list ul").length?(pageId.find("#agreement_norecords").removeClass("DN"),pageId.find("#agreement_norecords").addClass("Scrcont")):(pageId.find("#agreement_norecords .ctable").remove(),pageId.find("#agreement_norecords").removeClass("Scrcont"),pageId.find("#agreements_list").removeClass("DN"),pageId.find("#agreements_listingpage").removeClass("DN"),1===pageId.find("#agreements_list ul").length&&pageId.find("#agreements_listingpage").addClass("expand")))}},error:function(req){if(createAgr.find("div#zp_page_loading").hide(),createAgr.find("form#createAgmntForm,div#ca_footer").show(),400!==req.status){var errResponse=req.responseJSON[1];if(6013!=errResponse.errorCode)if(6014!=errResponse.errorCode){if(-1!=req.responseText.search("mailmerge")){var errorMsg;return errorMsg=JSON.parse(JSON.parse(req.responseText)[1].msg).error.message,void ZPeople.Message.showFailureMsg(errorMsg)}if("string"==typeof errResponse.msg)ZPeople.Message.showFailureMsg(errResponse.msg),Files.toggleFileFieldDisplay(),Layout.Page.container.find("div#zp_page_loading").remove(),createAgr.find("div#ca_footer,button#close_btn,#createAgmntForm").show();else{var dispMsg,validationMsg=errResponse.msg;if(validationMsg.hasOwnProperty("ef")){var dispName="<p>";$.each(validationMsg.ef,function(mailId,errorCompList){var emptyFieldsId=errorCompList.substring(1,errorCompList.length-1).split(",");$.each(emptyFieldsId,function(index,errId){var optElm=createAgr.find("option[value='"+errId.trim()+"']");-1===dispName.indexOf(optElm.text())&&(index>0&&(dispName+=","),dispName+=optElm.text())})}),dispMsg=dispName+=" is not available for this/these record(s) </p>"}else validationMsg.hasOwnProperty("extnerr")?dispMsg=ZPI18N.getString("zp.fileformaterr"):validationMsg.hasOwnProperty("disbaled")?dispMsg=validationMsg.disbaled:validationMsg.hasOwnProperty("limitEx")?dispMsg=validationMsg.limitEx:ZPeople.Message.showFailureMsg(req.statusText);searchElem.find("div#form_adobeResp").html(dispMsg),searchElem.find("div#adobeFailedAlert").modal()}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.mmmailfailureerrormessadmin",new Array(errResponse.msg)));else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.mmmailfailuresubject"))}else ZPeople.Message.showFailureMsg(req.responseJSON.error)}})}},validation:function(isFileType){var searchElem=Layout.Page.container,createAgr=searchElem.find("div#createAgreementModal"),recipientsElms=createAgr.find("*[id=recpList]"),catId=createAgr.find("select#agrselect_Cat").val(),agr_name_elm=(createAgr.find("input#hrnewCategory").val(),searchElem.find("input#agmntName").val()),agr_sub=searchElem.find("#agmntMsg").val();$(".ERR").remove();var err=!1;if(-1!==Layout.Page.hash.indexOf("agreementslistview")){var agmntFile=createAgr.find("#uploadfile")[0].files[0];if(agmntFile||"cloudUpload"===Files.uploadMode){if(agmntFile&&(agmntFile.size>5e6?(err=!0,createAgr.find("#uploadfile").closest("div#err_div").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.agreementfilesizelimit")+"</span>")):createAgr.find("#uploadfile").closest("div#err_div").next("span#errormsg").remove()),!err){var fileExtn=createAgr.find("span#drop_file").find("span").text();fileExtn=fileExtn.substr(fileExtn.lastIndexOf(".")+1,fileExtn.length),-1===Agreements.adobeCompatibleExtns.indexOf(fileExtn.toLowerCase())?(err=!0,createAgr.find("#uploadfile").closest("div#err_div").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.choosepdffile")+"</span>")):createAgr.find("#uploadfile").closest("div#err_div").next("span#errormsg").remove()}}else err=!0,createAgr.find("#uploadfile").closest("div#err_div").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.choosedoc")+"</span>")}Agreements.isFromEmployeeView&&(ZPSetupCommon.isEmpty(createAgr.find("#uploadfile").val())||"select"===createAgr.find("#uploadfile").val()?createAgr.find("#uploadfile").parent().after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectfileupload")+"</span>"):createAgr.find("#uploadfile").parent().next("span#errormsg").remove(),ZPSetupCommon.isEmpty(createAgr.find("#templates").val())||"0"===createAgr.find("#templates").val()?createAgr.find("#templates").parent().after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectfileupload")+"</span>"):createAgr.find("#templates").parent().next("span#errormsg").remove());var recipientsMailIds=recipientsElms.val();if(ZPSetupCommon.isEmpty(recipientsMailIds)||"select"===recipientsMailIds){err=!0;var errMsg=recipientsElms.is("input")?ZPI18N.getString("zp.entervalidemailaddress"):ZPI18N.getString("zp.selectemailidfield");createAgr.find("#recpList").after('<span class="ERR" id="errormsg">'+errMsg+"</span>")}else recipientsElms.is("input")&&Agreements.validateMailIds(recipientsMailIds.split(","),createAgr.find("#recpList"),ZPI18N.getString("zp.entervalidemailaddress"));createAgr.find("div#s2id_agrselect_Cat").is(":visible")&&"select"===catId?(err=!0,createAgr.find("#agrselect_Cat").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectcategory")+"</span>")):createAgr.find("input#hrnewCategory").is(":visible")&&ZPSetupCommon.isEmpty(createAgr.find("input#hrnewCategory").val())?(err=!0,createAgr.find("#hrnewCategory").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.enterCategory")+"</span>")):createAgr.find("#agrselect_Cat").parent().find("span#errormsg").remove();var smc=createAgr.find("#copyList").val();ZPSetupCommon.isEmpty(smc)||(smc.split(",").length>50?createAgr.find("#copyList").after('<span class="ERR" id="errormsg" errmsg="mailids">'+ZPI18N.getString("zp.maildidslengthunlimit")+"</span>"):(createAgr.find("#copyList").parent().find("span#errormsg").remove(),Agreements.validateMailIds(smc.split(","),createAgr.find("#copyList"),ZPI18N.getString("zp.entervalidemailaddress"))));var deadLine=createAgr.find("input#deadline").val();if(!ZPSetupCommon.isEmpty(deadLine)){var lastDate=moment(deadLine,dateFmt.toUpperCase()).format("DD-MMM-YYYY").split("-"),month=Calendar.months.indexOf(lastDate[1])+1,lDate=lastDate[2]+"/"+month+"/"+lastDate[0];"NaN"===Date.parse(lDate).toString()||moment(lDate).diff(moment(),"days")<0?(err=!0,createAgr.find("input#deadline").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.holiday.dateerror")+"</span>")):createAgr.find("input#deadline").parent().find("span#errormsg").remove()}return ZPSetupCommon.isEmpty(createAgr.find("input#agmntName").val())&&(err=!0,createAgr.find("#agmntName").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.agreementnameempty")+"</span>")),agr_name_elm.length>100&&(createAgr.find("#agmntName").after('<span id="errormsg" class="ERR">'+ZPI18N.getString("zp.lengthvalidation",new Array(ZPI18N.getString("zp.name"),100))+"</span>"),err=!0),-1==agr_name_elm.indexOf("<")&&-1==agr_name_elm.indexOf(">")||(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.filesexcludesplchars",new Array(ZPI18N.getString("zp.name")))),err=!0),agr_sub.length>1e3&&(createAgr.find("#agmntMsg").after('<span id="errormsg" class="ERR">'+ZPI18N.getString("zp.lengthvalidation",new Array(ZPI18N.getString("zp.message"),1e3))+"</span>"),err=!0),err},validateMailIds:function(mailIds,obj,msg){var err=!1;return mailIds.length<=50?$.each(mailIds,function(ind,mailId){if(!ZPUtil.Validation.isEmail(mailId))return err=!0,obj.after('<span class="ERR" id="errormsg">'+msg+"</span>"),!1;obj.next("span#errormsg").remove()}):(err=!0,$("div#createAgreementModal").find("#recpList").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.maildidslengthunlimit")+"</span>")),err},showRemindersMode:function(){Layout.Page.container;var createAgr=$("div#createAgreementModal"),reminderElm=createAgr.find("div#remindRecp");reminderElm.toggle(),createAgr.find("input#reminder_check").is(":checked")?$(reminderElm.find("input[name='reminder']")[0]).prop("checked",!0):$(reminderElm.find("input[name='reminder']")[0]).prop("checked",!1)},constructMailFmt:function(mailIds){var builtMailFmt="";return $.each(mailIds,function(index,mailId){builtMailFmt+="Email:"+mailId+":SIGNER",index!==mailIds.length-1&&(builtMailFmt+=",")}),builtMailFmt},getAgreementsListPage:function(mode){var returnHash;(Agreements.recordId="",Layout.Page.container.find("div#createAgreementModal").removeClass("PopMdxModel l0"),-1!==Layout.Page.hash.indexOf("createAgreement")||-1!==Layout.Page.hash.indexOf("agreementId:"))&&(Layout.Page.container.find("div#viewAgreementModal").removeAttr("agrid"),Agreements.isSendAgreement=!1,"Nbar2F"===$("div#page-wrapper").attr("class")&&(Agreements.isFilterOpen=!0),-1===Layout.Page.hash.indexOf("agreementslistview")&&(Agreements.isCancelAgr=!0),-1!==Layout.Page.hash.indexOf("files/fileView/hrfileslistview")?returnHash="#files/fileView/hrfileslistview":-1!==Layout.Page.hash.indexOf("files/hrfile/hrfileslistview")?returnHash="#files/hrfile/hrfileslistview":-1!==Layout.Page.hash.indexOf("files/fileView/companyfileslistview")?returnHash="#files/fileView/companyfileslistview":-1!==Layout.Page.hash.indexOf("files/companyfile/companyfileslistview")?returnHash="#files/companyfile/companyfileslistview":-1!==Layout.Page.hash.indexOf("files/fileView/agreementslistview")?returnHash="#files/fileView/agreementslistview":-1!==Layout.Page.hash.indexOf("files/adobesign/agreementslistview")&&(returnHash="#files/adobesign/agreementslistview"),window.location.href=returnHash)},funcToOpenFilter:function(){Agreements.isFilterOpen&&($("div#page-wrapper").attr("class","Nbar2F"),Agreements.isFilterOpen=!1)},toggleSignFlowDiv:function(obj){$(obj).is(":checked")?$(obj).parent().parent().parent().next("div").css("display","block"):$(obj).parent().parent().parent().next("div").css("display","none")},getAgreementsList:function(modeCnt,evnt,isAjax,e,sortDefined,sortOrderval,sortColumnval){Layout.Page.container.find("#doc_multiselDel").hide(),Layout.Page.container.find("#doc_HeaderBar").show(),Layout.Page.container.find("#agreements_checkallbox").prop("checked",!1),void 0==isAnySignConfigured&&Zohosign.getEsignConfigurations();var pageId=Layout.Page.container;if("search"!=evnt&&"reset"!=evnt||Agreements.hideAndShowFilterIC("close"),Layout.Page.container.find("#agreements_list").attr("scroll","enabled"),Files.Esign.firescrollTrigger("agreement"),ZPSetupCommon.isEmpty(e)||!ZPSetupCommon.isEmpty(e)&&13===e.keyCode){$("div#createAgreementModal");var contentBody="";contentBody=pageId.find("#agreements_list");var catId=pageId.find("select#search_cat").val(),catName=pageId.find("#s2id_search_cat").find("span").text(),agName=pageId.find("#search_agname").val(),agStatus=pageId.find("select#search_status").val(),startInd=ZPSetupCommon.isEmpty(contentBody.data("start"))?1:contentBody.data("start"),sortColumn=(Layout.Page.hash.split("-")[1],parseInt(pageId.find("select#search_cat").val()),""),sortOrder=!1,searchParams={};void 0!=Layout.Page.container.find(".sort-d").attr("id")?(getSortColumn=Layout.Page.container.find(".sort-d").attr("id"),sortColumn=Files.Esign.getSortColumn(getSortColumn),sortOrder=!1):void 0!=Layout.Page.container.find(".sort-u").attr("id")&&(getSortColumn=Layout.Page.container.find(".sort-u").attr("id"),sortColumn=Files.Esign.getSortColumn(getSortColumn),sortOrder=!0),""==sortColumn&&(void 0==sortDefined?sortColumn="SENT_DATE":(sortOrder=sortOrderval,sortColumn=sortColumnval));var sentFrom="",sentTo="";if(""!=pageId.find("#agree_sentfrom").val()&&0!=pageId.find("#agree_sentfrom").val()&&void 0!=pageId.find("#agree_sentfrom").val())sentFrom=pageId.find("#agree_sentfrom").val(),searchParams[ZPI18N.getString("zp.from")]=sentFrom;else sentFrom="-1";if(""!=pageId.find("#agree_sentto").val()&&0!=pageId.find("#agree_sentto").val()&&void 0!=pageId.find("#agree_sentto").val())sentTo=pageId.find("#agree_sentto").val(),searchParams[ZPI18N.getString("zp.to")]=sentTo;else sentTo="-1";24,"search"==evnt||"reset"==evnt||"sort"==evnt?(Layout.Page.container.find("#agreements_list").removeAttr("scroll"),Layout.Page.container.find("#agreements_list").attr("scroll","enabled"),contentBody.empty(),Agreements.agreeStartindex=1,startInd=1):1==Agreements.agreeFirescroll&&(0==Agreements.agreeStartindex?Agreements.agreeStartindex=25:Agreements.agreeStartindex=Agreements.agreeStartindex+24,startInd=Agreements.agreeStartindex),Agreements.showTotalCnt();var params={action:"getAgreementsList",conreqcsr:csrfToken,startInd:startInd,limit:24,sortOrder:sortOrder,sortColumn:sortColumn,sentFrom:sentFrom,sentTo:sentTo};ZPSetupCommon.isEmpty(catId)||"select"===catId||(params.catId=catId),ZPSetupCommon.isEmpty(catName)||"Select"===catName||(searchParams[ZPI18N.getString("zp.folder")]=catName),ZPSetupCommon.isEmpty(agName)||"select"===agName||(params.agreementName=agName,searchParams[ZPI18N.getString("zp.name")]=agName),ZPSetupCommon.isEmpty(agStatus)||"select"===agStatus||(params.status=agStatus,searchParams[ZPI18N.getString("zp.status")]=status);var keyId="filter_params_agreeFiles";if(Object.keys(searchParams).length>0){var resultHtml="";$.each(searchParams,function(key,val){resultHtml+="<span value='"+key+"'>"+key+"&nbsp;&nbsp; : &nbsp;&nbsp;"+ZSEC.Encoder.encodeForHTML(val)+"<i onclick='Files.removeSearchBreadcrumbs(this)'></i></span>"}),Layout.Page.container.find("#"+keyId).html(resultHtml),Files.opnclsSearchBreadcrumbs("open")}else-1===Layout.Page.hash.indexOf("files/adobesign/agreementslistview")&&(Layout.Page.container.find("#"+keyId).html(""),Files.opnclsSearchBreadcrumbs("close"));ZPeople.Request.send("/adobeSignActions.zp",params,this.constructAgreementsList,isAjax,this.failedCallBack)}},constructAgreementsList:function(data,params,isAjax){var agreementsListElms="",listCount=(data=data[1]).length-1,pageId=Layout.Page.container;if(void 0==isAdobeReadView&&Zohosign.getReadView(),isAdobeReadView||isAdobeConfig||Zohosign.isfromFilterView){var contentBody="";contentBody=pageId.find("#agreements_list"),Zohosign.populateDocumentView(),Zohosign.isfromFilterView&&Layout.Page.container.find("#zp_esign_view").select2("val","2"),0==listCount&&contentBody.find(".ZPListingUL").length>1&&(ZPeople.FireScroll.getFireScrollPropertie().triggered=!0,Agreements.agreeFirescroll=!1),$.each(data,function(index,agreementInfo){if(index<listCount)agreementsListElms+=Agreements.constructAgreementData(agreementInfo),pageId.find("div#agrlist_div,div#tab_actions").removeClass("DN"),pageId.find("#tab_actions").find("#create_agr").removeClass("DN");else{var limitCnt,start=agreementInfo.start;limitCnt=1===start?listCount>1?listCount:start:listCount>1?listCount+start-1:start,data.length<=1&&(start=0,limitCnt=0),pageId.find("span#zp_view_page_cnt").html(start+"&nbsp;-&nbsp;"+limitCnt),contentBody.data({start:start,next:agreementInfo.nexpage}),Agreements.constructLanguage()}data.length<24?(Agreements.agreeFirescroll=!1,ZPeople.FireScroll.getFireScrollPropertie().triggered=!0):Agreements.agreeFirescroll=!0}),Layout.Page.container.find("#zp_esign_view").select2("val","2"),isAdobeReadView&&($("a#zp_t_files_zohosign_documentlistview").parent("li").addClass("active"),$("a#zp_t_files_docusign").parent("li").addClass("active"),$("a#zp_t_files_adobesign").parent("li").addClass("active"),$("a#zp_t_files_zohosign_documentlistview").parent("li").parent("ul").attr("style","display:block"),$("a#zp_t_files_docusign").parent("li").parent("ul").attr("style","display:block"),$("a#zp_t_files_adobesign").parent("li").parent("ul").attr("style","display:block"),Layout.Page.container.find("#create_agr").addClass("DN"),Layout.Page.container.find("#zp_esign_view").select2("val","2")),Agreements.isCachedAgrList=!0,pageId.find("div#no_recfound_img").remove(),pageId.find("div#agrlist_div,div#tab_actions").removeClass("DN"),""===agreementsListElms?(Layout.Page.container.find("#agreement_norecords .ctable").remove(),Agreements.newuinorecords()):(pageId.find("#agreement_norecords").addClass("DN"),pageId.find("div#agreements_list").removeClass("DN"),pageId.find("div#agreement_norecords").removeClass("Scrcont"),pageId.find("div#agreements_listingpage").removeClass("DN"),pageId.find("div#agrlist_div,div#agmnt_footer").removeClass("DN"),contentBody.append(agreementsListElms),Agreements.setCatName(data))}else pageId.find("div#agrlist_div,div#tab_actions").addClass("DN"),pageId.find("div#adobe_authErr").removeClass("DN"),pageId.find("div#permission_errdiv").after(document.createTextNode(ZPI18N.getString("zp.notauthenticate"))),pageId.find("div#agmnt_footer").addClass("DN");ZPeople.FireScroll.reset()},constructAgreementData:function(obj,mode){0==Object.keys(Files.newCategoryList).length?ZPeople.Request.sendAsyncPost("/fileCabinetAction.zp",{methodName:"getCategoryList",conreqcsr:csrfToken},Zohosign.openFilter):Zohosign.openFilter(Files.newCategoryList);var statusCls,ARID,owner,completeDate,sentDate,categoryName,ownerId,topRecipient,size,row="",catId=ZPSetupCommon.isEmpty(obj.catId)?"0":obj.catId,agName=ZPSetupCommon.isEmpty(obj.name)?"[No name]":obj.name,repName=[];if("single"==mode){ARID=obj.ARID,obj.agreementId,owner=obj.owner,ownerId=obj.ownerId,sentDate=obj.SD,completeDate="",categoryName=ZSEC.Encoder.encodeForHTML(Layout.Page.container.find("select#search_cat").find("option[value='"+catId+"']").text()),statusCls="org",status="Out for Signature",size=obj.recipients.length;for(var i=0;i<size;i++)0==i&&(topRecipient=obj.recipients[i]),repName.push(obj.recipients[i])}else ARID=obj.ARID,obj.agreementId,owner=obj.owner,ownerId=obj.ownerId,sentDate=obj.sentDate,completeDate=obj.completeDate,categoryName=Files.newCategoryList[obj.catId],statusCls="Out for Signature"===obj.status?"org":"Signed"===obj.status?"grn":"red",status=obj.status,repName=obj.recipients,topRecipient=obj.topRecipient;return row+='<ul class="ZPListingUL" href="" agreementId="'+ARID+'" isCancelled='+("Cancelled / Declined"===obj.status)+">",row+='<li class="check"><div class="checkbox"><input type="checkbox"  onclick=Files.Esign.checkParticularFiles(this,"agreements")><label></label></div></li>',row+='<li class="tsize"><div class="fileType BGtxt"><img src="'+obj.senderPhoto+'"></div>',row+='<div class="DIB CP" onclick="Agreements.getAgreementViewPage(this)"><span class="bld txttrim ellip">'+agName+"</span>",row+='<span class="DB S13 MT8">',row+='<span class="ellip"><em class="dgry">'+ownerId+'-</em><em class="ML2">'+owner+"</em></span>",row+="</span></div></li>",void 0!=repName&&(repName.length>1?(row+='<li class="tsize"><span class="btn-sm FL ellip">'+repName.toString().split(",")[0]+"</span>",row+='<div class=" dropdown ZPCusDrs  FL  ML5 "><div data-toggle="dropdown" class="btn btn-sm btn-lgray moreDt"><i class="IC-more"></i></div>',row+=Files.getAllSharedLocRole(repName),row+="</div></li>"):row+=void 0!=topRecipient?'<li class="tsize"><span class="ellip">'+topRecipient+"</span></li>":'<li class="tsize"><span class="ellip"> </span></li>'),row+='<li id="sentOn">'+sentDate+"</li>",row+='</span></div></li><li id="cat_nm"><span class="ellip">'+categoryName+"</span></li>",row+=null!==completeDate&&void 0!==completeDate&&""!==completeDate?'<li name="env_status"><span class='+statusCls+">"+status+'<i class="IC-rou-tik ML5 grn"></i></span><span class="DB dgry MT5">'+completeDate+"</span></li>":'<li name="env_status"><span class='+statusCls+">"+status+"</span></li>",row+='<li class="actions"><div class="FR">',row+='<i class="IC-down" onclick=Agreements.downloadAttachement(this,"'+ARID+'","download") class="IC-imprt S16 gry FR MR15"></i>',row+='<i class="IC-delete-1px" onclick="Files.Esign.deleteRecConfirm(this, \'action_confirm_btn\');"></i></div>',row+='<div class="FL"><div id="action_confirm_btn" class="DN"><button class="btn btn-default btn-sm FR" onclick="Files.Esign.cancelDelRecConfirm(this);">Cancel</button><button class="btn btn-danger btn-sm FR MR10" onclick=Agreements.deleteAgreementRecord(this,"last");>Confirm</button></div>',row+="</div></li></ul>"},setCatName:function(dataObj){var pageId=Layout.Page.container;$.each(dataObj,function(index,agreementDtls){var catId=ZPSetupCommon.isEmpty(agreementDtls.catId)?"0":agreementDtls.catId,categoryName=pageId.find("select#search_cat").find("option[value='"+catId+"']").text();pageId.find("#agreements_list").find("ul[agreementId='"+agreementDtls.ARID+"'] span#cat_nm").text(categoryName)})},getTotalRecordCount:function(){var pageId=Layout.Page.container,catId=pageId.find("select#search_cat").val(),status=pageId.find("select#search_status").val(),params={action:"getAgreementsRecordCount",conreqcsr:csrfToken,agreementName:pageId.find("input#search_agname").val()};"select"!==catId&&(params.catId=catId),"select"!==status&&(params.status=status),ZPeople.Request.send("/adobeSignActions.zp",params,Agreements.showTotalCnt)},constructLanguageData:function(dataObj,params){languageList=dataObj[1]},constructLanguage:function(){Layout.Page.container;var createAgr=$("div#createAgreementModal"),languageListOptn="<option value='select'>"+ZPI18N.getString("zp.select")+"</option>";void 0==languageList&&ZPeople.Request.sendAsyncPost("/adobeSignActions.zp",{action:"getLanguagesList",conreqcsr:csrfToken},Agreements.constructLanguageData),$.each(languageList,function(index,language){var languages=language.split("=");languages[0].split("_")[0]===currLanguage?languageListOptn+="<option value='"+languages[0]+"' selected='selected'>"+languages[1]+"</option>":languageListOptn+="<option value='"+languages[0]+"'>"+languages[1]+"</option>"}),createAgr.find("select#agrselect_language").html(languageListOptn).select2()},getAgreementViewPage:function(thisObj,mode){var agreementId;agreementId=$(thisObj).closest("ul").attr("agreementId"),window.location.href=Layout.Page.hash+"-agreementId:"+agreementId},openFilter:function(categoryList){var pageId=Layout.Page.container,createAgr=$("div#createAgreementModal"),categoriesOpt="";(isadmin||1==loginUserRoleCheck||2==loginUserRoleCheck)&&(categoriesOpt="<option value='select' selected='selected'>"+ZPI18N.getString("zp.select")+"</option>"),newcategoryList=categoryList[1],void 0!=newcategoryList?$.each(categoryList[1],function(index,categoriesObj){"General"===categoriesObj.CatName||"general"===categoriesObj.CatName||categoriesObj.CatName===ZPI18N.getString("zp.general")?categoriesOpt+="<option value='"+categoriesObj.CatID+"'>"+ZPI18N.getString("zp.general")+"</option>":categoriesOpt+="<option value='"+categoriesObj.CatID+"'>"+categoriesObj.CatName+"</option>"}):$.each(categoryList,function(index,categoriesObj){"General"===categoriesObj||"general"===categoriesObj||categoriesObj===ZPI18N.getString("zp.general")?categoriesOpt+="<option value='"+index+"'>"+ZPI18N.getString("zp.general")+"</option>":categoriesOpt+="<option value='"+index+"'>"+categoriesObj+"</option>"}),Agreements.isFromEmployeeView?Agreements.isFormCatListCached=!0:Agreements.isFilterCached=!0,Object.keys(Files.newCategoryList).length<=0&&$.each(newcategoryList,function(index,categoriesObj){Files.newCategoryList[categoriesObj.CatID]=categoriesObj.CatName});var selectedCatid=pageId.find("#search_cat").val(),selectedCategory=Files.newCategoryList[selectedCatid];pageId.find("select#search_cat").html(categoriesOpt),"select"==selectedCategory||null==selectedCategory?pageId.find("div#hrfilterdiv").find("select").select2():(pageId.find("div#hrfilterdiv").find(selectedCatid).select2(),pageId.find("select#search_cat").val(selectedCatid)),createAgr.find("select#agrselect_Cat").html(categoriesOpt),createAgr.find("select#agrselect_Cat").select2(),createAgr.find("div#s2id_agrselect_Cat").find("button#addcat_btn").remove(),(isadmin||1==loginUserRoleCheck||2==loginUserRoleCheck)&&createAgr.find("div#s2id_agrselect_Cat").find("ul").after('<button class="btn btn-primary" onclick="Agreements.shownewCategory(this)" data-toggle="modal" id="addcat_btn">'+ZPI18N.getString("zp.addcat")+"</button>")},showTotalCnt:function(data){var pageId=Layout.Page.container;data?(pageId.find("span#agreement_totalcnt").text(data.count).removeClass("hide"),pageId.find("a#zp_views_recordcount").addClass("hide")):(pageId.find("span#agreement_totalcnt").addClass("hide"),pageId.find("a#zp_views_recordcount").removeClass("hide"))},hideAndShowFilterIC:function(mode){var pageId=Layout.Page.container;$("div#page-wrapper").attr("class");pageId.find("i#agrm_filterIc").attr("class").indexOf("blu")>-1||"close"==mode?pageId.find("div#hrfilterdiv").hide():pageId.find("div#hrfilterdiv").show(),pageId.find("i#agrm_filterIc").toggleClass("gry").toggleClass("blu"),Layout.Page.container.find("div#filter").addClass("TEbnd")},resetFilter:function(){var pageId=Layout.Page.container;pageId.find("#filter_params_agreeFiles").find("span").remove(),Files.opnclsSearchBreadcrumbs("close");var filterOptions=pageId.find("#search_cat,#search_status");filterOptions.select2("val","select"),filterOptions.trigger("change"),pageId.find("#agree_sentfrom").val(""),pageId.find("#agree_sentto").val(""),pageId.find("#search_agname").val(""),Agreements.getAgreementsList(0,"reset",!0)},searchAgreementsRecord:function(catObj){Layout.Page.container.find("button#reset_agrBtn").removeClass("DN")},getAgreementPreview:function(agreementId,thisObj,mode){var formId,agrId,recId,moduleType;-1===Layout.Page.hash.indexOf("-formId:")&&(agrId=Layout.Page.hash.split("agreementId:")[1]),Layout.Page.hash.indexOf("agreementslistview-agreementId")>-1||-1!==Layout.Page.hash.indexOf("hrfile")?moduleType="1":Layout.Page.hash.indexOf("-formId:")>-1?(moduleType="2",agrId=agreementId,recId=$(thisObj).closest("tr").attr("recordId"),formId=Layout.Page.urlparam.formId):(moduleType="2",void 0!=agreementId&&(agrId=agreementId),recId=thisObj,formId=Layout.Page.urlparam.formId),(-1!==Layout.Page.hash.indexOf("hrfile")||Layout.Page.hash.indexOf("agreementslistview-agreementId")>-1||"selffiles"==mode)&&void 0!=agreementId&&(recId=agrId=agreementId,moduleType="1"),Agreements.recordId=recId,ZPeople.Request.send("/adobeSignActions.zp",{action:"getAgreementStatus",conreqcsr:csrfToken,agreementId:agrId,moduleType:moduleType,formId:formId,recordId:recId},Agreements.constructAgreementInfo,{agrId:agrId,recordId:recId},Agreements.failedCallBack)},constructAgreementInfo:function(agreementInfo,params,otherDtls){var agreementId=otherDtls.agrId;if(Layout.Page.hash.indexOf("-formId:")>-1&&jQuery.isEmptyObject(agreementInfo))ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.agreementdeleted"));else{var pageId=Layout.Page.container,reciepentInfoRow="";if(pageId.find("tr[agreementId='"+agreementId+"']").data("agreements_data")||pageId.find("table#agreements_list").find("tr[agreementId='"+agreementId+"']").data({agreements_data:agreementInfo[1]}),agreementInfo=agreementInfo[1],ZPeople.BSModal.setup({id:"viewAgreementModal",type:22,modalClass:"popRgtModel PopLgModel fileAgrModal in",header:Agreements.view.header,body:Agreements.view.bodymainContent,footer:Agreements.view.footer}),pageId.find("#activityDiv").remove(),Files.Esign.constructActivityDetailsDiv(),agreementInfo.hasOwnProperty("RINFO")){var reciepentInfo=agreementInfo.RINFO;$.each(reciepentInfo,function(reciepentId,reciepentObj){reciepentInfoRow+='<li><div class="dtable"><div class="ph">',null!==reciepentObj.RCD&&void 0!==reciepentObj.RCD&&""!==reciepentObj.RCD&&(reciepentInfoRow+='<i class="IC-task-chk grn"></i>'),reciepentInfoRow+='<div class="fileType BGtxt"><span>'+reciepentObj.RN.charAt(0).toUpperCase()+"</span></div></div>",reciepentInfoRow+='<div class="user"><b class="DB">'+reciepentObj.RN+'</b> <span class="dgry">'+reciepentObj.RN+"</span></div>","SIGNER"==reciepentObj.RT?reciepentInfoRow+='<div class="sign"><i class="CR-sign cirIcon" data-toggle="tooltip" data-original-title="'+reciepentObj.RT+'" title="" data-placement="bottom"></i></div>':reciepentInfoRow+='<div class="sign"><i class="IC-eye1 cirIcon" data-toggle="tooltip" data-original-title="'+reciepentObj.RT+'" title="" data-placement="bottom"></i></div>',reciepentObj.hasOwnProperty("RS")?"SIGNED"==reciepentObj.RS.toUpperCase()?(reciepentInfoRow+='<div class="status"><b class="DB">Completed on</b>',reciepentInfoRow+='<span class="dgry">'+reciepentObj.RCD+"</span>"):(reciepentInfoRow+='<div class="status"><b class="DB">'+ZPI18N.getString("zp.status")+"</b>",reciepentInfoRow+='<span class="dgry">'+reciepentObj.RS+"</span>"):(reciepentInfoRow+='<div class="status"><b class="DB">'+ZPI18N.getString("zp.status")+"</b>",reciepentInfoRow+='<span class="dgry"></span>'),reciepentInfoRow+='<i class="IC-ar-dwn cirIcon" onclick="Zohosign.viewRecipients(this)"></i></div></div>',reciepentInfoRow+='<div class="dtable expnd"><div><b class="DB">Type</b><span class="dgry">'+reciepentObj.RT+"</span>",reciepentInfoRow+='</div><div><b class="DB">Order</b><span class="dgry">'+reciepentObj.RO+"</span></div><div>",reciepentInfoRow+='<b class="DB">Date Delivered</b><span class="dgry">'+reciepentObj.RDD+"</span></div></div></li>"})}var viewAgreementModal=pageId.find("div#viewAgreementModal");viewAgreementModal.attr("name","esign"),viewAgreementModal.attr("recordId",otherDtls.recordId),reciepentInfoRow=""===reciepentInfoRow?Agreements.norecElm:reciepentInfoRow;var eventInfoRow="";if(agreementInfo.hasOwnProperty("EINFO")){var eventInfo=agreementInfo.EINFO;$.each(eventInfo,function(eventId,eventObj){eventInfoRow+='<div class="event dot">',eventInfoRow+="<p>"+eventObj.N+"<em>"+eventObj.ED+"</em></p>",eventInfoRow+="<div>"+eventObj.EDESC+"</div>",eventInfoRow+="</div>"})}if(eventInfoRow=""===eventInfoRow?Agreements.norecElm:eventInfoRow,agreementInfo.hasOwnProperty("DINFO")){var dInfo=agreementInfo.DINFO;pageId.find("b#agName").text(dInfo.name),pageId.find("span#agOwner").text(dInfo.owner),pageId.find("#senderProfile").attr("src",dInfo.senderPhoto),pageId.find("span#sentDate").text(dInfo.sentDate),"-1"!=dInfo.sentDate&&pageId.find("span#doc_sent_date").text(dInfo.sentDate),fileowner=dInfo.owner,catId=dInfo.catId,"-"!=dInfo.completeDate&&pageId.find("span#completed_date").text(dInfo.completeDate),"-"!=dInfo.VALIDUNTIL?pageId.find("b#deadLine").text(dInfo.VALIDUNTIL):pageId.find("b#deadLine").parents("div")[0].remove(),"-"!=dInfo.message?pageId.find("b#agr_msg").text(dInfo.message):pageId.find("b#agr_msg").parents("div")[0].remove(),fileCategoryname=Files.newCategoryList[catId],pageId.find("b#status").text(dInfo.status),"Completed"!=dInfo.status&&"Signed"!=dInfo.status||pageId.find("i#taskCompleted").addClass("IC-task-chk grn FR"),void 0==isAdobeReadView&&Zohosign.getReadView(),"Completed"==dInfo.status||"Signed"==dInfo.status||"Cancelled / Declined"==dInfo.status?(pageId.find("#cancelAgreebtn").hide(),pageId.find("button#send_remindBtn").hide()):isAdobeReadView?(pageId.find("#cancelAgreebtn").hide(),pageId.find("button#send_remindBtn").hide()):(pageId.find("#cancelAgreebtn").show(),pageId.find("button#send_remindBtn").show()),"-"!=dInfo.sendmail_copies?pageId.find("b#mail_copies").text(dInfo.sendmail_copies):pageId.find("b#mail_copies").parents("div")[0].remove(),pageId.find(".Scrcont .ZPSdiv").last().addClass("bn")}var attachmentsRow="";if(agreementInfo.hasOwnProperty("AINFO")){var attachmentDtls=agreementInfo.AINFO;$.each(attachmentDtls,function(pkId,attachmentsDtls){var encodeFileName=encodeURIComponent(attachmentsDtls.fileName),encodeFilePath=encodeURIComponent(attachmentsDtls.fP),attachmentsRownew="",fileEObj="",fileExtn=(fileEObj=""==attachmentsDtls.fP?encodeFileName:encodeFilePath).substr(fileEObj.lastIndexOf(".")+1,fileEObj.length).toLowerCase(),fileIconextn=Files.Esign.fileIcons(fileExtn);"jpg"===fileExtn||"jpeg"===fileExtn||"gif"===fileExtn||"png"===fileExtn||"gif"===fileExtn?(attachmentsRownew+='<div class="attDivBox"><span class="FL"><i class="IC-'+fileIconextn+'"></i></span><span class="FL dtl">',attachmentsRownew+='<span class="DB" onclick=Zohosign.constructDataForPreview(true,"'+encodeFilePath+'","'+encodeURIComponent(fileowner)+'","'+encodeURIComponent(fileCategoryname)+'","'+encodeFileName+'","'+agreementInfo.RINFO.RN+'","'+agreementId+'","'+agreementInfo.DINFO.sentDate+'","'+pkId+'");Agreements.downloadAttachement(this,"'+pkId+'","view","'+encodeFileName+'","'+encodeFilePath+'")><a class="CP">'+attachmentsDtls.fileName+'</a></span> <span class="DB dgry S12 MT5">'+attachmentsDtls.ED+"</span></span>",attachmentsRownew+='<span class="FR"><i class="IC-down" onclick=Agreements.downloadAttachement(this,"'+pkId+'","download","'+encodeFileName+'","'+encodeFilePath+'")></i></span></div>'):(attachmentsRownew+='<div class="attDivBox"><span class="FL"><i class="IC-'+fileIconextn+'"></i></span><span class="FL dtl">',attachmentsRownew+='<span class="DB" onclick=Zohosign.constructDataForPreview(false,"'+encodeFilePath+'","'+encodeURIComponent(fileowner)+'","'+encodeURIComponent(fileCategoryname)+'","'+encodeFileName+'","'+agreementInfo.RINFO.RN+'","'+agreementId+'","'+agreementInfo.DINFO.sentDate+'","'+pkId+'");Agreements.downloadAttachement(this,"'+pkId+'","view","'+encodeFileName+'","'+encodeFilePath+'")><a class="CP">'+attachmentsDtls.fileName+'</a></span><span class="DB dgry S12 MT5">'+attachmentsDtls.ED+"</span></span>",attachmentsRownew+='<span class="FR"><i class="IC-down" onclick=Agreements.downloadAttachement(this,"'+pkId+'","download","'+encodeFileName+'","'+encodeFilePath+'")></i></span></div></div>'),Layout.Page.container.find("div#attachmentsData").append(attachmentsRownew)})}Agreements.setAgreementsDtlsValue(agreementId),attachmentsRow=""===attachmentsRow?Agreements.norecElm:attachmentsRow,pageId.find("ul#recipientsList").html(reciepentInfoRow),pageId.find("#actDetails").html(eventInfoRow),pageId.find("tbody#attachments_Info").html(attachmentsRow),pageId.find("i#agrm_filterIc").attr("class","IC-filter S18 CP FR ML20 MT5 gry"),void 0==isAdobeReadView&&Zohosign.getReadView(),isAdobeReadView?(viewAgreementModal.find("#cancelAgreebtn").hide(),viewAgreementModal.find("button#send_remindBtn").hide()):viewAgreementModal.find("button#send_remindBtn").show();var previewActions=viewAgreementModal.find("div#preview_actions");viewAgreementModal.attr("agrId",agreementId),"Cancelled / Declined"===pageId.find("span#status").text()||"Signed"===pageId.find("span#status").text()?previewActions.hide():previewActions.show()}},setAgreementsDtlsValue:function(agreementId){var pageId=Layout.Page.container,currRow=$("tr[agreementId='"+agreementId+"']");$.each(pageId.find("div#agrmnt_dtlsview").find("div[name='formGrp']"),function(index,obj){var insertValueObj=$(obj).find("span"),key_name=insertValueObj.attr("id");insertValueObj.text(currRow.data(key_name))})},downloadAttachement:function(obj,viewfileId,mode,fileName,filePath){var fileExtn,recordId;Layout.Page.container;fileName=decodeURIComponent(fileName),void 0!=ZPForm.CURRFORM_PARAM.recordId?recordId=ZPForm.CURRFORM_PARAM.recordId:(void 0==(recordId=$("div#viewDocumentModal").attr("recordId"))&&(recordId=$("div#viewEnvelopeModal").attr("recordId")),void 0==recordId&&(recordId=$("div#viewAgreementModal").attr("recordId")));var fileEObj="";fileEObj=""!=filePath?filePath:fileName,ZPSetupCommon.isEmpty(fileEObj)||(fileExtn=fileEObj.substr(fileEObj.lastIndexOf(".")+1,fileEObj.length));var isPolicy="5"==obj;void 0!=fileEObj&&"-1"==fileEObj.lastIndexOf(".")&&isPolicy&&(fileExtn="docx");var viewParams={};if("download"===mode||"xls"!==fileExtn&&"xlsx"!==fileExtn&&"doc"!==fileExtn&&"docx"!==fileExtn&&"rtf"!==fileExtn&&"ppt"!==fileExtn&&"pptx"!==fileExtn){var url="";if(url="download"===mode||"pdf"!==fileExtn&&"PDF"!==fileExtn?"viewFile?&mode=agreement":"pdfViewer.zp?mode=agreement",ZPSetupCommon.isEmpty(viewfileId)||(url+="&fileId="+viewfileId,viewParams.fileId=viewfileId),void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1){url+="&recordId="+recordId,viewParams.recordId=recordId;var formId=Layout.Page.urlparam.formId;void 0===formId&&(formId=ZPForm.CURRFORM_PARAM.formId),url+="&formId="+formId,viewParams.formId=formId}if("download"===mode)return url+="&action=download",void window.open(url);if("jpg"===fileExtn||"jpeg"===fileExtn||"gif"===fileExtn||"png"===fileExtn||"gif"===fileExtn){var iframe=$("#imageviewFrame"),viewAgrDiv=$("#viewPreviewFileDiv");$(window.document).find("#viewPreviewFileDiv").height($(window).height()+"px"),$(window).on("resize",function(){if(iframe.height(" "),viewAgrDiv.height(" "),$(window.document).find("#viewPreviewFileDiv").height($(window).height()+"px"),0!=$(window.document).find("#imageviewFrame").length){var contentpv=$(window.document).find("#imageviewFrame").parent();contentpv.css("max-height",$("#viewPreviewFileDiv").height()-43+"px"),contentpv.css("max-width",$("#viewPreviewFileDiv").width()-300+"px")}}),iframe.html(""),iframe.attr("src",""),iframe.attr("src",decodeURIComponent(url)),$("#imageviewFrame").off("load"),$("#imageviewFrame").on("load",function(){Files.esignimgOrgHeight=$("#imageviewFrame").height()})}else{iframe=$("#viewFileFrame"),viewAgrDiv=$("#viewPreviewFileDiv");$(window.document).find("#viewPreviewFileDiv").height($(window).height()+"px"),$(window).on("resize",function(){iframe.height(" "),viewAgrDiv.height(" "),$(window.document).find("#viewPreviewFileDiv").height($(window).height()+"px"),esignviewFrame=$(window.document).find("#viewFileFrame"),esignviewFrame.height($("#viewPreviewFileDiv").height()-43+"px")}),iframe.html(""),iframe.attr("src",""),iframe.attr("src",decodeURIComponent(url)),esignviewFrame=$(window.document).find("#viewFileFrame"),esignviewFrame.height($("#viewPreviewFileDiv").height()-43+"px")}}else Files.isViewZBasedFile(fileName,mode)?ZPeople.Request.send("/adobeSignActions.zp",{action:"viewFiles",conreqcsr:csrfToken,fileId:viewfileId,recordId:recordId,formId:Layout.Page.urlparam.formId,isPolicy:isPolicy},Agreements.viewAttachmentFile,fileName,Agreements.failedCallBack):Files.isFilesPreviewEnabled(mode)&&("docx"!=fileExtn&&"doc"!=fileExtn&&"rtf"!==fileExtn&&"pptx"!=fileExtn&&"ppt"!=fileExtn||(viewParams.mode="agreement",viewParams.fileId=viewfileId,viewParams.recordId=recordId,viewParams.formId=Layout.Page.urlparam.formId,viewParams.isPolicy=isPolicy),url=Files.constructPreviewUrl("agreement",viewParams,fileExtn),Files.setUrlIframeToViewFile(url,mode))},viewAttachmentFile:function(data,paramsObj,fileNm){var url,pageId=Layout.Page.container;if(data=data[0],pageId.find("#zp_page_loading").remove(),"writer"===data.fileforformat)url=(url=data.url.replace("<script language='javascript'>window.location.href='","")).replace("';<\/script>","");else{data.url.indexOf("https"),data.url.indexOf("false");url=data.url}var iframe=$("#viewFileFrame"),viewAgrDiv=$("#viewPreviewFileDiv");$(window.document).find("#viewPreviewFileDiv").height($(window).height()+"px"),$(window).on("resize",function(){iframe.height(" "),viewAgrDiv.height(" "),$(window.document).find("#viewPreviewFileDiv").height($(window).height()+"px"),esignviewFrame=$(window.document).find("#viewFileFrame"),esignviewFrame.height($("#viewPreviewFileDiv").height()-43+"px")}),iframe.html(""),iframe.attr("src",""),iframe.attr("src",decodeURIComponent(url)),esignviewFrame=$(window.document).find("#viewFileFrame"),esignviewFrame.height($("#viewPreviewFileDiv").height()-43+"px")},reasonToCancelAgrPopUp:function(thisObj){var pageId=Layout.Page.container;pageId.find("div#agr_reason_popup").modal(),pageId.find("span#errormsg").remove(),pageId.find("input#cancel_reason").val(""),pageId.find("a#cancel_confirmBtn").removeClass("disabled")},cancelAgreement:function(thisObj){var recordId,pageId=Layout.Page.container,reason=pageId.find("input#cancel_reason").val();if(pageId.find("span#errormsg").remove(),ZPSetupCommon.isEmpty(reason))pageId.find("input#cancel_reason").parent().append('<span id="errormsg" class="ERR">'+ZPI18N.getString("zp.enterreason")+"</span>");else{var moduleType,agrmntID=Layout.Page.container.find("div#viewAgreementModal").attr("agrId"),formId="";$(thisObj).addClass("disabled"),Layout.Page.hash.indexOf("agreementslistview-agreementId:")>-1?moduleType="1":(void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1)&&(moduleType="2",void 0===(formId=Layout.Page.urlparam.formId)&&(formId=ZPForm.CURRFORM_PARAM.formId),recordId=Agreements.recordId),ZPeople.Request.send("/adobeSignActions.zp",{action:"cancelAgreement",conreqcsr:csrfToken,agreementId:agrmntID,reason:reason,moduleType:moduleType,formId:formId,recordId:recordId},Agreements.handleCancelAgreement,null,Agreements.failedCallBack)}},handleCancelAgreement:function(data){var agrmntID=Layout.Page.container.find("div#viewAgreementModal").attr("agrId"),pageId=Layout.Page.container;if(pageId.find("a#cancel_confirmBtn").removeClass("disabled"),data.isCancelled){var row="";row=-1!=Layout.Page.hash.indexOf("files/adobesign/agreementslistview")||-1!=Layout.Page.hash.indexOf("files/hrfile")||Layout.Page.hash.indexOf("selfservice/user/files")?pageId.find("ul[agreementId='"+agrmntID+"'] li[name='env_status']"):pageId.find("ul[documentid='"+recordId+"'] li[name='env_status']"),pageId.find("div#viewAgreementModal").find("#status").text("Cancelled / Declined"),pageId.find("div#agr_reason_popup").modal("hide"),row.html("<span class='red'>Cancelled / Declined</span>"),pageId.find("div#viewAgreementModal").find("#cancelAgreebtn").hide(),pageId.find("div#viewAgreementModal").find("button#send_remindBtn").hide(),row.closest("tr").attr("isCancelled",!0),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.documentcancelled"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.docnotcancel"))},sendReminder:function(thisObj){var agrmntID=Layout.Page.container.find("div#viewAgreementModal").attr("agrId"),params={action:"sendReminder",conreqcsr:csrfToken,recordId:agrmntID};if(void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1){params.moduleType="2";var formId=Layout.Page.urlparam.formId;void 0===formId&&(formId=ZPForm.CURRFORM_PARAM.formId),params.formId=formId,params.recordId=Agreements.recordId,params.agreementRecordid=agrmntID}else params.moduleType="1";ZPeople.Request.send("/adobeSignActions.zp",params,Agreements.handleSendReminder,null,Agreements.failedCallBack)},handleSendReminder:function(data){"success"===data.status?ZPeople.Message.showSuccessMsg("Reminder has been sent"):ZPeople.Message.showFailureMsg("Reminder has not been sent")},shownewCategory:function(thisObj){var createAgr=$("div#createAgreementModal");createAgr.find("#cancel_hrCat_btn").show(),$(".select2-drop-active").hide(),createAgr.find("#hrnewCategory").val(""),createAgr.find("#agrselect_Cat").val(""),createAgr.find("#hrnewCategory").val($(".select2-drop-active input:visible").val()),$(thisObj).closest("div#select2-drop").hide(),createAgr.find("#agrselect_Cat").next("span#errormsg").remove(),createAgr.find("#hrnewCategory,#new_hrCatDIV").show(),createAgr.find("#s2id_agrselect_Cat,#hrzp_add_Cat,#hrcategory_err").hide(),$(".select2-drop-active").find("input").val("")},cancelnewCategory:function(){var createAgr=$("div#createAgreementModal");createAgr.find("#cancel_hrCat_btn,#hrnewCategory,#new_hrCatDIV,#hrcategory_err").hide(),createAgr.find("input#hrnewCategory").next("span#errormsg").remove(),createAgr.find("#s2id_agrselect_Cat,#hrzp_add_Cat").show(),createAgr.find("#agrselect_Cat").select2("val","select")},deleteAgreementConfirm:function(thisObj){ZPeople.confirm(this,"zp.zpalert","zp.deleteRecord","","","",ZPI18N.getString("zp.delete"),"",!0),$("#confirmConfirmationPopup").attr("onclick","Agreements.deleteAgreementRecord('','first')")},deleteAgreementRecord:function(thisObj,position){var recordIdArr="",moduleType="",formId="",recordId="";if("first"==position)for(var deleteArray=Layout.Page.container.find("#agreements_list").find('input[type="checkbox"]:checked'),deleteCount=deleteArray.length,i=0;i<deleteCount;i++)i>=1&&(recordIdArr+=","),recordIdArr+=Layout.Page.container.find(deleteArray[i]).parent().parent().parent().attr("agreementId");else(void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1)&&(void 0===(formId=Layout.Page.urlparam.formId)&&(formId=ZPForm.CURRFORM_PARAM.formId),formId=formId,recordId=ZPForm.CURRFORM_PARAM.recordId),moduleType="2",recordIdArr=$(thisObj).closest("ul").attr("agreementId");ZPeople.Request.send("/adobeSignActions.zp",{action:"deleteAgreement",conreqcsr:csrfToken,recordIdList:recordIdArr,moduleType:moduleType,recordId:recordId,formId:formId},Agreements.deleteCallBack,thisObj,Agreements.failedCallBack)},deleteCallBack:function(data,params,thisObj){var pageId=Layout.Page.container;data.isDeleted?($(pageId.find("#agreements_list").find('input[type="checkbox"]:checked').length)[0]>0?($(pageId.find("#agreements_list").find('input[type="checkbox"]:checked')).closest("ul").remove(),Layout.Page.container.find("#doc_multiselDel").hide(),Layout.Page.container.find("#doc_HeaderBar").show()):$(thisObj).closest("ul").remove(),0===pageId.find("#agreements_list").find("ul").length&&(Layout.Page.container.find("#agreement_norecords .ctable").remove(),Agreements.newuinorecords(),pageId.find("#agreements_list").addClass("DN"),pageId.find("#agreements_listingpage").addClass("DN"),pageId.find("#agreements_listingpage").removeClass("expand")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.zs.documentdeletedsuccessfully"))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.zs.documentnotdeleted"))},newuinorecords:function(){var pageId=Layout.Page.container;Layout.Page.container.find("#no_agree_rec").remove(),pageId.find("div#agreements_list").addClass("DN"),pageId.find("#agreements_listingpage").removeClass("expand"),pageId.find("#agreement_norecords").addClass("Scrcont"),pageId.find("div#agreements_listingpage").addClass("DN"),pageId.find("#agreement_norecords").removeClass("DN");var currScrollContObj=pageId.find("#agreement_norecords"),noFilesFound="";noFilesFound+='<div class="ctable"><div class="ctcell"><div class="ZPNdata">',noFilesFound+='<i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i>',noFilesFound+='<i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i>',noFilesFound+='<h5 id="zp_views_nodata">'+ZPI18N.getString("zp.lookup.norecfound")+"</h5></div></div></div>",currScrollContObj.append(noFilesFound)},failedCallBack:function(error){"500"==error.responseJSON[1].errorCode&&(ZPeople.Message.showFailureMsg(error.statusText),(Layout.Page.hash.indexOf("files/fileView/agreementslistview")>-1||Layout.Page.hash.indexOf("files/adobesign/agreementslistview")>-1)&&Layout.Page.container.find("div#agmnt_footer").hide())}},SignUtil={setValuesForMailMergeDocument:function(isCacheModel){var option="<option value='select'>All</option>";return $.each(MMtemplte.templateList.templateDetails,function(index,obj){option+='<option value="'+obj.tid+'">'+obj.fname+"</option>"}),labelTxt=ZPI18N.getString("zp.selecttemplate"),file_elm='<div class="col-sm-6" id="fileElm"> <div class=""> <select id="uploadfile" fieldtype="26" name="rid">'+option+"</select></div> </div>",{labelTxt:labelTxt,file_elm:file_elm}}};Envelope={add:{header:'<h6 id="envelopeHeader" class="addPopTitle">'+ZPI18N.getString("zp.requestsignature")+'</h6><button aria-label="Close" data-dismiss="modal" onclick=Files.Esign.getEnvelopeListpage("cancel") class="close" id="close_btn" type="button"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button>',bodyCont:'<div class="form-horizontal pad"><iframe width="100%" height="100%" src="" name="createEnvelopeResp" style="min-height:500px; min-width:600px; display:none; overflow:hidden;"></iframe> <form target="createEnvelopeResp" id="createEnvelopeForm" enctype="multipart/form-data" method="post" role="form"> <div class="form-group" id="files_list"> <label class="control-label col-sm-3 zp_mdt" id="file_lbl"><font>'+ZPI18N.getString("zp.file")+'</font></label></div> <div class="form-group DN" id="template_grp"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.selecttemplate")+'</font></label><div class="col-sm-6"><select id="templates"><option value="0">Select</option></select></div></div><div class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.reciepents")+'</font></label> <div class="col-sm-6" id="recp"> <input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="recipients" id="recpList" autocomplete="off" class="form-control"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</label> <div class="col-sm-6"> <input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="email_copies_to" id="copyList" autocomplete="off" class="form-control"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.name")+'</font></label> <div class="col-sm-6"> <input name="envelopeName" id="envName" autocomplete="off" class="form-control"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.subject")+'</font></label> <div class="col-sm-6"> <input name="envelope_subject" id="envelope_subject" class="form-control" autocomplete="off"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.message")+'</label> <div class="col-sm-6"> <textarea rows="5" class="form-control" name="envelope_message" id="envelope_message" fieldtype="3"></textarea> </div> </div> <div class="form-group"><label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.folder")+'</font></label> <div class="col-sm-6"><select onchange=Files.clearErrmsg("companycategory_err") placeholder="'+ZPI18N.getString("Select")+'" id="agrselect_Cat" class="" tabindex="-1"></select><input type="name" style="display: none;" class="form-control" id="hrnewCategory" autocomplete="off"></div> <div class="col-sm-3" id="cancel_hrCat_btn" style="display:none"> <a href="javascript:void(0)" onclick="Envelope.cancelnewCategory();" class="btn btn-default btn-sm MT5">'+ZPI18N.getString("zp.cancel")+'</a> </div> </div> <div class="form-group"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" name="reminder" id="reminder_check" onclick="Envelope.setDaysForReminder()"><span>'+ZPI18N.getString("zp.reminder")+'</span></label></div></div> <div class="form-group"> <div class="col-sm-10 col-sm-offset-3 DN" id="reminder_setting"><label class="col-sm-3 PL0"> <span class="DIB MT8">'+ZPI18N.getString("zp.sendreminderafter",new Array(""))+'</span> </label><div class="col-sm-1 PL0" id="reminder_dayscnt"> <input class="form-control" name="first_reminder" autocomplete="off"> </div> <label class="col-md-2 PL0"> <span class="PT8 DIB">'+ZPI18N.getString("zp.days")+'</span> </label></div> <div class="col-sm-10 col-sm-offset-3 MT10 DN" id="reminder_freq"><label class="col-sm-4 PL0"> <span class="DIB MT8">'+ZPI18N.getString("zp.sendreminderonce",new Array(""))+'</span> </label><div class="col-sm-1 PL0" id="reminder_freqdayscnt"> <input class="form-control" name="reminder_freqdayscnt" autocomplete="off"> </div> <label class="col-md-2 PL0"> <span class="PT8 DIB">'+ZPI18N.getString("zp.days")+'</span> </label></div> </div> <div class="form-group"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input name="expiration" id="expire_check" onclick=Envelope.setDaysForReminder("expire") type="checkbox"><span>Expiry</span></label></div></div> <div class="form-group"><div class="col-sm-10 col-sm-offset-3 DN" id="expire_setting"><label class="col-sm-3 PL0"> <span class="DIB MT8">'+ZPI18N.getString("zp.expirydate")+'</span> </label><div class="col-sm-3 PL0" id="deadline"><div class="btnCal"> <input class="form-control" name="deadline" autocomplete="off" caltype="popup" onclick="Calendar.setUpCalendar(event,this)" type="text"> </div></div></div> <div class="col-sm-10 col-sm-offset-3 MT10 DN" id="warning"><label class="col-sm-3 PL0"> <span class="DIB MT8">'+ZPI18N.getString("zp.notifyrecipients")+'</span> </label><div class="col-sm-1 PL0" id="freq_warn"> <input class="form-control" name="freq_warn" autocomplete="off"> </div> <label class="col-md-4 PL0"> <span class="PT8 DIB">'+ZPI18N.getString("zp.daysbeforeexpiry")+'</span> </label></div> </div> <div class="form-group DN"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" onclick="Agreements.toggleSignFlowDiv(this)" name="needsendersign" id="senderSign"><span>'+ZPI18N.getString("zp.signthedoc")+'</span></label> </div> </div> <div id="my_sign" style="display:none;" class="form-group"> <label class="control-label col-sm-3">My Sign</label> <div id="senderSignFlow" class="col-sm-6"> <label class="radio DIB MR8"><input type="radio" checked="checked" value="1" name="signature_flow"><span class="ML2">'+ZPI18N.getString("zp.first")+'</span></label> <label class="radio DIB MR8"><input type="radio" value="2" name="signature_flow"><span class="ML2">'+ZPI18N.getString("zp.last")+'</span></label> </div> </div> <div class="form-group DN"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" id="previewDoc" name="preview_document"><span>'+ZPI18N.getString("zp.previewdoc")+'</span></label> </div> </div> <div class="form-group DN"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.language")+'</label> <div class="col-sm-6"> <select id="envselect_language" name="language"></select> </div> </div> <input type="hidden" value="" id="conreqcsr" name="conreqcsr"> </form> </div>',footer:'<div id="ca_footer" class="modal-footer text-left"><button onclick="Envelope.sendEnvelope()" id="footer_submit" type="button" class="btn btn-primary">'+ZPI18N.getString("zp.send")+'</button><button type="button" onclick=Files.Esign.getEnvelopeListpage("cancel") id="footer_close" data-dismiss="modal" class="btn btn-default">Cancel</button></div>',cloudElm:'<div class="col-sm-6"><div class="ZPUFile" id="err_div"><div class="ZPUlft" id="beforeUpload"><span>Attach from </span><div class="ZPCfile"><span>Desktop</span><input class="ZPFfile form-control" onchange=Files.changeOnUpload($(this).val(),"localUpload") name="envelope" id="uploadfile" type="file"></div></div> <div class="ZPUlft DN" id="afterUpload"><span id="drop_file"><span></span><i class="IC-cls-r red" onclick="Files.toggleFileFieldDisplay()"></i></span></div></div><div class="ZPMxlt PSI" id="maxPopup"></div></div>',cloud:'<span class="dgry ML2 MR2">or</span><a onclick="Files.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl, \'DocuSign\')">Cloud</a>',docuCompatibleExtns:["as","asl","asp","doc","docm","docx","dot","dotm","dotx","htm","html","pdf","pdx","rtf","txt","wpd","wps","wpt","dps","dpt","pot","potx","pps","ppt","pptm","pptx","csv","et","ett","xls","xlsm","xlsx","xlt","emz","svg","svgz","vdx","vss","vst","bmp","cdr","dcx","gif","ico","jpg","jpeg","pct","pic","png","rgb","sam","tga","tif","tiff","wpg"]},view:{header:'<h6 class="addPopTitle" id="envelopeHeader">'+ZPI18N.getString("zp.documentdtls")+'</h6><a class="close IC-cls" onclick=Files.Esign.getEnvelopeListpage("cancel") data-dismiss="modal"></a></h6>',bodymainContent:'<div class="Scrcont"><div class="ZPSdiv"><span class="FL"><b id="agName" class="DB MB5"></b><span id="doc_sent_date" class="dgry"></span></span><span class="FR"><span id="agOwner"></span><img id="senderProfile" src=""></span></div><div class="ZPSdiv"><span class="FL"><b>'+ZPI18N.getString("zp.status")+'</b></span><span class="FR"><span class="FR"><span class="DB MB5"><b id= "status"></b></span><span id="completed_date" class="dgry S12"></span></span><i id="taskCompleted"></i></span></div><div class="ZPSdiv"><span class="DB"><b>Last Date</b></span><span class="FR"><b id="deadLine"></b></span></div><div class="ZPSdiv"><span class="DB"><b>'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</b></span><span class="DB ML20 MT10"><span class="DB MB5"><b id="mail_copies"></b></span></span></div><div class="ZPSdiv bn"><span class="DB"> <b>'+ZPI18N.getString("zp.message")+'</b> </span> <span class="DB ML20 MT10"> <span class="DB MB5"><b id = "agr_msg"></b></span> </span> </div> <div class="lineHdr"> <b class="DB">'+ZPI18N.getString("zp.attachments")+'</b><div id = "attachmentsData" class="attDiv"></div></div><div class="lineHdr"><div class="boxShLst"><b class="DB">'+ZPI18N.getString("zp.reciepents")+'</b><ul id ="recipientsList"></ul></div></div><div class="lineHdr"><b class="DB MB10">'+ZPI18N.getString("zp.activity")+'</b><div class="aclog_cont"><div class="aclog_detl" id="actDetails"></div></div></div></div></div>',bodyCont:'<div class="form-horizontal pad"> <div style="padding:0" class="dveSignview MB30 clearfix" id="agrmnt_dtlsview"> <h6 class="ZPbold MT0">'+ZPI18N.getString("zp.documentdtls")+'</h6> <div class="col-md-6"> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.name")+'</label> <div class="col-sm-8"> <span id="agName"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.agreementowner")+'</label> <div class="col-sm-8"> <span id="agOwner"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.datesent",new Array(""))+'</label> <div class="col-sm-8"> <span id="sentDate"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</label> <div class="col-sm-8"> <span id="mail_copies" class="txttrim"></span> </div> </div> </div> <div class="col-md-6"> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.status")+'</label> <div class="col-sm-8"> <span id="status"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.datecompleted",new Array(""))+'</label> <div class="col-sm-8"> <span id="completed_date"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.message")+'</label> <div class="col-sm-8"> <span id="agr_msg"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.deadline")+'</label> <div class="col-sm-8"> <span id="deadLine"></span> </div> </div> </div> </div> <h6><span class="ZPbold">'+ZPI18N.getString("zp.attachments")+'</span><div class="clearfix"></div></h6> <table class="table table-hover"> <thead> <tr class="TblGryBg"> <th width="500">'+ZPI18N.getString("zp.filename")+"</th> <th>"+ZPI18N.getString("zp.modifiedtime")+'</th> <th width="150"></th> </tr> </thead> <tbody id="attachments_Info"> </tbody> </table> <h6><span class="ZPbold">'+ZPI18N.getString("zp.reciepents")+'</span><div class="clearfix"></div></h6> <table class="table table-hover"> <thead> <tr class="TblGryBg"> <th>'+ZPI18N.getString("zp.reciepentname")+"</th> <th>"+ZPI18N.getString("zp.mail")+"</th> <th>"+ZPI18N.getString("zp.type")+"</th> <th>"+ZPI18N.getString("zp.reciepentorder")+"</th> <th>"+ZPI18N.getString("zp.status")+"</th> <th>"+ZPI18N.getString("zp.reciepentdelivered")+"</th> <th>"+ZPI18N.getString("zp.datecompleted",new Array(""))+'</th> </tr> </thead> <tbody id="recipientsList"> </tbody> </table> <h6><span class="ZPbold">'+ZPI18N.getString("zp.envelopehistory")+'</span><div class="clearfix"></div></h6> <table class="table table-hover Vlis bgc"> <thead> <tr class="TblGryBg"> <th>'+ZPI18N.getString("zp.eventsname")+"</th> <th>"+ZPI18N.getString("zp.description")+"</th> <th>"+ZPI18N.getString("zp.date")+'</th> </tr> </thead> <tbody id="eventsList"> </tbody> </table> </div>',footer:'<div class="modal-footer text-left"><div class="FR"><button type="button" id="cancelEnvbtn" class="btn btn-default" onclick=ZPeople.confirm(this,"zp.zpalert","zp.confirmcancel",Envelope.cancelEnvelope,"","","","","")>'+ZPI18N.getString("zp.canceldocument")+'<button type="button" class="btn btn-default FR" data-dismiss="modal" onclick=Files.Esign.getEnvelopeListpage("cancel")>'+ZPI18N.getString("zp.close")+"</button></div>"},fileId:null,emailidfield:{},fileuploadfield:{},isFromFormView:!1,isCachedEnvelopeList:!1,isCachedCatList:!1,isMMerge:!1,recordId:null,envelopeStartindex:0,envelopeFirescroll:!1,selectedRecpForm:null,openCreateEnvelopeModal:function(mode,thisObj){"hr"!==mode?Layout.Page.hash:Layout.Page.hash.indexOf("#files/hrfile")>-1?Layout.Page.hash:(Layout.Page.hash,$(thisObj).closest("tr").attr("fileID")),Files.Esign.getEnvelopeListpage("hr",thisObj)},openEnvModal:function(isFromFormView,isMailMerge,thisObj){Envelope.selectedRecpForm=null;var pageId=Layout.Page.container;pageId.find("div#createEnvelopeModal");pageId.find("div#createEnvelopeModal").remove();var removableElm,file_elm;if(ZPeople.BSModal.setup({id:"createEnvelopeModal",type:22,modalClass:"popRgtModel",headerHtml:Envelope.add.header,body:Envelope.add.bodyCont,footer:Envelope.add.footer}),Layout.Page.hash.indexOf("doculistview")>-1&&Layout.Page.container.find("div#createEnvelopeModal").find("label#file_lbl").after(Envelope.add.cloudElm),isFromFormView){var formId;Envelope.isFromFormView=isFromFormView,formId=null!=Layout.Page.container.attr("id").match(/[\d]+$/)?Layout.Page.container.attr("id").match(/[\d]+$/).toString():ZPForm.CURRFORM_PARAM.formId;var emailidfieldArr={},fileuploadfieldArr={},formCompData=ZPForm.FORM_COMPONENT_DATA[formId];void 0===formCompData&&$.ajax({type:"POST",async:!1,url:"/formAction.zp",data:{mode:"getFormComponents",conreqcsr:csrfToken,formId:formId},success:function(data){formCompData=data}});var formComp=formCompData.message;$.each(formComp.formComponentDetails,function(index){this.isTabular||($.each(this.column1,function(index,fieldData){if(this.fieldType==ZPForm.Field.EMAIL_ADDRESS){var fcId=this.formComponentId;emailidfieldArr[fcId]=this.displayName}else if(this.fieldType==ZPForm.Field.FILE_UPLOAD){fcId=this.formComponentId;fileuploadfieldArr[fcId]=this.displayName}}),$.each(this.column2,function(index,fieldData){if(this.fieldType==ZPForm.Field.EMAIL_ADDRESS){var fcId=this.formComponentId;emailidfieldArr[fcId]=this.displayName}else if(this.fieldType==ZPForm.Field.FILE_UPLOAD){fcId=this.formComponentId;fileuploadfieldArr[fcId]=this.displayName}}))}),Envelope.emailidfield.formId=emailidfieldArr,Envelope.fileuploadfield.formId=fileuploadfieldArr;var labelTxt=ZPI18N.getString("zp.file");pageId.find(""),file_elm="";var modalId=pageId.find("div#createEnvelopeModal");if(modalId.find("div#fileElm").remove(),Envelope.isMMerge=!0,isMailMerge){var fileDetails=SignUtil.setValuesForMailMergeDocument();labelTxt=fileDetails.labelTxt,file_elm=fileDetails.file_elm}else file_elm='<div class="col-sm-6" id="fileElm"> <div class=""> <select id="uploadfile" fieldtype="26" name="file_lbl">'+Envelope.constructFormFields(Envelope.fileuploadfield.formId)+"</select></div> </div>";modalId.find("label#file_lbl").contents().last()[0].textContent=labelTxt,file_elm='<div class="col-sm-6" id="fileElm"> <div class=""> <select id="uploadfile" fieldtype="26" name="file_lbl">'+Envelope.constructFormFields(Envelope.fileuploadfield.formId)+"</select></div> </div>";var recpOption=Envelope.constructFormFields(Envelope.emailidfield.formId),multiselin=pageId.find("div#createEnvelopeModal").find("#recp").find("select");0!=multiselin.length&&void 0!=multiselin||(pageId.find("div#createEnvelopeModal").find("#recpList").remove(),pageId.find("div#createEnvelopeModal").find("#recp").append('<select id="recpList" multiple fieldtype="26" name="recipients">'+recpOption+"</select>"));var recList=[];if($.each(pageId.find("table#zp_views_records_table tbody").find("input[id='zp_view_sel_record']:checked"),function(index,elm){recList.push($(elm).closest("tr").attr("recordId"))}),0==recList&&recList.push(ZPForm.CURRFORM_PARAM.recordId),pageId.find("div#files_list").show(),pageId.find("div#template_grp").hide(),pageId.find("div#createEnvelopeModal").data({recList:recList}),void 0==(hashFormId=Layout.Page.hash.split("formId:")[1])){var hashFormId=Layout.Page.container[0].getAttribute("id").split("formId-")[1];pageId.find("div#createEnvelopeModal").data({formId:hashFormId})}else pageId.find("div#createEnvelopeModal").data({formId:hashFormId.substring(0,hashFormId.indexOf("/"))})}else if(Envelope.isFromFormView=!1,-1!==Layout.Page.hash.indexOf("doculistview"))removableElm=pageId.find("div#createEnvelopeModal").find("div#err_div").parent(),file_elm=Envelope.add.cloudElm;else{removableElm=pageId.find("div#createEnvelopeModal").find("span#drop_file").parent();var fileId="";fileId=thisObj,file_elm='<div class="col-sm-6"> <div class="ZPFFcus"> <span id="drop_file" class="txttrim"></span> <input name="envFile" id="uploadfile" onchange="Agreements.setFIlename(this)" class="ZPFfile form-control"> </div> </div>'}if(void 0!=removableElm&&removableElm.remove(),pageId.find("div#createEnvelopeModal").data({fileId:fileId}),pageId.find("div#createEnvelopeModal").find("label#file_lbl").after(file_elm),Envelope.isFromFormView){pageId.find("div#createEnvelopeModal").find("#recpList option:first-child").attr("selected","selected"),ZPSetupCommon.isEmpty(file_elm)||pageId.find("div#createEnvelopeModal").find("label#file_lbl").parent().find("select").select2(),Envelope.selectedRecpForm=null;var $eventSelect=pageId.find("div#createEnvelopeModal").find("#recpList").parent().find("select");$eventSelect.select2(),Envelope.selectedRecpForm=[],Envelope.selectedRecpForm=pageId.find("div#createEnvelopeModal").find("#recpList").val(),$eventSelect.on("change.select2",function(e){if(void 0!=e.added)Envelope.selectedRecpForm.push(e.added.id);else if(void 0!=e.removed){const index=Envelope.selectedRecpForm.indexOf(e.removed.id);index>-1&&Envelope.selectedRecpForm.splice(index,1)}}),pageId.find("div#selectDoc,div#file_format").remove();var docType='<div id="selectDoc" style="" class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.sendfrom",new Array(""))+'</font></label> <div class="col-sm-6"> <label class="radio DIB MR8" onclick=Agreements.showFilesElm("envelope")><input checked="checked" value="1" type="radio" name="esign"><span class="ML2">'+ZPI18N.getString("zp.signoptnfromform")+'</span></label> <label class="radio DIB MR8" onclick=Agreements.showFilesElm("envelope") ><input value="2" id="from_mm" type="radio" name="esign"><span class="ML2">'+ZPI18N.getString("zp.mmerge")+'</span></label> </div> </div><div class="form-group DN" id="file_format"><label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.selectformat")+'</font></label> <div class="col-sm-8"><div class="inlRadio"><label class="radio tagbgmail" onclick=MMtemplte.showViewType("1")><input name="1" checked="" id="select_pdf" type="radio"><span>PDF</span></label> <label class="radio tagbgmail" onclick=MMtemplte.showViewType("2")><input name="1" type="radio"><span>DOCX</span></label> </div></div><div></div></div>';pageId.find("form#createEnvelopeForm").prepend(docType),MMtemplte.constructTemplateList("form",null,null,null,"envelope",!0)}else{var fileName;fileId="";fileId=thisObj,fileName=pageId.find("div#hr_allfileList").find("ul[fileID="+fileId+"]").attr("fileName"),pageId.find("span#drop_file").text(fileName),!isChinaSetup&&Layout.Page.hash.indexOf("doculistview")>-1&&pageId.find("div#createEnvelopeModal").find("input#uploadfile").parent().after(Envelope.add.cloud)}((Layout.Page.hash.indexOf("files/fileView/doculistview")>-1||Layout.Page.hash.indexOf("files/docusign/doculistview")>-1)&&0===pageId.find("div#s2id_search_cat").length||0===pageId.find("div#createEnvelopeModal").find("div#s2id_agrselect_Cat").length)&&ZPeople.Request.send("/fileCabinetAction.zp",{methodName:"getCategoryList",conreqcsr:csrfToken},Envelope.openFilter);var popUpDiv=pageId.find("#maxPopup"),toopTipDiv='<i data-content="<p>'+ZPI18N.getString("zp.maxfileuploadsize",[maxFileSize])+'</p>" data-popover="true" data-html="true" data-toggle="popover" data-placement="bottom" class="IC-info S18 gry form-icon popHover" data-original-title="" title=""></i>';popUpDiv.append(toopTipDiv)},constructFormFields:function(dataObj,htmlObj){if(!ZPSetupCommon.isEmpty(dataObj)){var option="";return Object.keys(dataObj).length>0&&$.each(dataObj,function(key,value){option+='<option value="'+key+'">'+value+"</option>"}),option}Envelope.openFilter(Files.newCategoryList);var popUpDiv=pageId.find("#maxPopup"),toopTipDiv='<i data-content="<p>'+ZPI18N.getString("zp.maxfileuploadsize",[maxFileSize])+'</p>" data-popover="true" data-html="true" data-toggle="popover" data-placement="bottom" class="IC-info S18 gry form-icon popHover" data-original-title="" title=""></i>';popUpDiv.append(toopTipDiv)},getTemplates:function(formId,tempId){var params={mode:esign.MODE,formId:formId.toString(),method:"getTemplates",conreqcsr:csrfToken};$.ajax({url:"/getTemplates.zp",type:"POST",data:params,success:function(datas){ZPSetupCommon.isEmpty(tempId)||(datas.templateId=tempId),TemplateCommon.setFormTemplates(datas)}})},openFilter:function(categoryList){var pageId=Layout.Page.container,createAgr=$("div#createEnvelopeModal"),categoriesOpt="";(isadmin||1==loginUserRoleCheck||2==loginUserRoleCheck)&&(categoriesOpt="<option value='select' selected='selected'>"+ZPI18N.getString("zp.select")+"</option>"),newcategoryList=categoryList[1],void 0!=newcategoryList?$.each(categoryList[1],function(index,categoriesObj){ZPSetupCommon.isEmpty(categoriesObj.CatName)||("General"===categoriesObj.CatName||"general"===categoriesObj.CatName||categoriesObj.CatName===ZPI18N.getString("zp.general")?categoriesOpt+="<option value='"+categoriesObj.CatID+"'>"+ZPI18N.getString("zp.general")+"</option>":categoriesOpt+="<option value='"+categoriesObj.CatID+"'>"+categoriesObj.CatName+"</option>")}):$.each(categoryList,function(index,categoriesObj){"General"===categoriesObj||"general"===categoriesObj||categoriesObj===ZPI18N.getString("zp.general")?categoriesOpt+="<option value='"+index+"'>"+ZPI18N.getString("zp.general")+"</option>":categoriesOpt+="<option value='"+index+"'>"+categoriesObj+"</option>"}),Envelope.isCachedCatList=!0,Object.keys(Files.newCategoryList).length<=0&&$.each(newcategoryList,function(index,categoriesObj){Files.newCategoryList[categoriesObj.CatID]=categoriesObj.CatName});var selectedCatid=pageId.find("#search_cat").val(),selectedCategory=Files.newCategoryList[selectedCatid];pageId.find("select#search_cat").html(categoriesOpt),"select"==selectedCategory||null==selectedCategory?pageId.find("div#hrfilterdiv").find("select").select2():(pageId.find("div#hrfilterdiv").find(selectedCatid).select2(),pageId.find("select#search_cat").val(selectedCatid)),createAgr.find("select#agrselect_Cat").html(categoriesOpt),createAgr.find("select#agrselect_Cat").select2(),createAgr.find("div#s2id_agrselect_Cat").find("button#addcat_btn").remove(),(isadmin||1==loginUserRoleCheck||2==loginUserRoleCheck)&&createAgr.find("div#s2id_agrselect_Cat").find("ul").after('<button class="btn btn-primary" onclick="Envelope.shownewCategory(this)" data-toggle="modal" id="addcat_btn">'+ZPI18N.getString("zp.addcat")+"</button>")},shownewCategory:function(thisObj){var createAgr=$("div#createEnvelopeModal");createAgr.find("#cancel_hrCat_btn").show(),$(".select2-drop-active").hide(),createAgr.find("#hrnewCategory").val(""),createAgr.find("#agrselect_Cat").val(""),createAgr.find("#hrnewCategory").val($(".select2-drop-active input:visible").val()),$(thisObj).closest("div#select2-drop").hide(),createAgr.find("#agrselect_Cat").next("span#errormsg").remove(),createAgr.find("#hrnewCategory,#new_hrCatDIV").show(),createAgr.find("#s2id_agrselect_Cat,#hrzp_add_Cat,#hrcategory_err").hide(),$(".select2-drop-active").find("input").val("")},cancelnewCategory:function(){var createAgr=$("div#createEnvelopeModal");createAgr.find("#cancel_hrCat_btn,#hrnewCategory,#new_hrCatDIV,#hrcategory_err").hide(),createAgr.find("input#hrnewCategory").next("span#errormsg").remove(),createAgr.find("#s2id_agrselect_Cat,#hrzp_add_Cat").show(),createAgr.find("#agrselect_Cat").select2("val","select")},sendEnvelope:function(){innerForm=!1;var pageId=Layout.Page.container;$(".ERR").remove();var createEnvelope=pageId.find("div#createEnvelopeModal"),envelopeSubject=pageId.find("input#envelope_subject").val(),envelopeMessage=pageId.find("textarea#envelope_message").val(),envName=pageId.find("input#envName").val(),envelope=Layout.Page.container.find("#uploadfile"),recpList=pageId.find("#recpList").val();null!=Envelope.selectedRecpForm&&(recpList=Envelope.selectedRecpForm);var formData=new FormData;if(formData.append("conreqcsr",csrfToken),formData.append("envelope_subject",envelopeSubject),formData.append("envelope_message",envelopeMessage),formData.append("email_copies_to",pageId.find("input#copyList").val()),formData.append("reminder",createEnvelope.find("input#reminder_check").is(":checked")),createEnvelope.find("input#reminder_check").is(":checked")){var firstReminder=createEnvelope.find("div#reminder_dayscnt input").val();firstReminder=ZPSetupCommon.isEmpty(firstReminder)?"0":firstReminder,formData.append("first_reminder",firstReminder);var freqReminder=createEnvelope.find("div#reminder_freqdayscnt input").val();freqReminder=ZPSetupCommon.isEmpty(freqReminder)?"0":freqReminder,formData.append("reminder_freqdays",freqReminder)}if(formData.append("expire_check",createEnvelope.find("input#expire_check").is(":checked")),createEnvelope.find("input#expire_check").is(":checked")){var expirationDays=createEnvelope.find("div#deadline input").val(),freqWarnDays=createEnvelope.find("div#freq_warn input").val();freqWarnDays=ZPSetupCommon.isEmpty(freqWarnDays)?"0":freqWarnDays,formData.append("freq_warn",freqWarnDays),formData.append("deadline",expirationDays)}if(!Envelope.validation()){var isFile=!1;if("file"===createEnvelope.find("#uploadfile").attr("type")&&(envelope=createEnvelope.find("#uploadfile")[0].files[0],isFile=!0),isFile&&void 0!=envelope)formData.append("envelope",envelope);else if(!ZPSetupCommon.isEmpty(createEnvelope.data("fileId"))){var fileID=createEnvelope.data("fileId");formData.append("fileId",fileID),Files.uploadMode=null}ZPSetupCommon.isEmpty(Files.uploadMode)||formData.append("uploadMode",Files.uploadMode),ZPSetupCommon.isEmpty(Files.uploadedDocObj)||formData.append("cloudUploadDoc",JSON.stringify(Files.uploadedDocObj));var recList=pageId.find("div#createEnvelopeModal").data("recList");if(Envelope.isFromFormView){formData.append("relatedModule","4");var formId=createEnvelope.data("formId");void 0==formId&&(formId=ZPForm.CURRFORM_PARAM.formId),formData.append("formId",formId),-1==Layout.Page.hash.indexOf("view-formLinkName:")&&-1==Layout.Page.hash.indexOf("selfservice/user")?formData.append("action","scheduleSendEnvelopes"):(innerForm=!0,formData.append("action","sendEnvelope")),"2"===pageId.find("div#createEnvelopeModal").find("input[name='esign']:checked").val()?formData.append("templateId",createEnvelope.find("select#templates").val()):formData.append("fileList",createEnvelope.find("#uploadfile").val()),formData.append("recList",recList)}else formData.append("action","sendEnvelope");if(formData.append("recipients",recpList),Layout.Page.hash.indexOf("recordId:")>-1){var recordId=Layout.Page.hash.split("recordId:")[1];formData.append("recordId",recordId)}else void 0!=ZPForm.CURRFORM_PARAM.recordId&&formData.append("recordId",ZPForm.CURRFORM_PARAM.recordId);var catId=pageId.find("select#agrselect_Cat").val();ZPSetupCommon.isEmpty(catId)?formData.append("newCatName",pageId.find("div#createEnvelopeModal").find("input#hrnewCategory").val()):formData.append("catId",pageId.find("select#agrselect_Cat").val()),ZPSetupCommon.isEmpty(envName)||formData.append("envelopeName",envName),createEnvelope.find("input#select_pdf").is(":checked")?formData.append("docType","pdf"):formData.append("docType","docx"),formData.append("innerForm",innerForm),pageId.find("form#createEnvelopeForm").hide(),pageId.find("div#zp_modal_body").append(ZPeople.LOADING_HTML),pageId.find("div#ca_footer").hide(),$.ajax({url:"docuSignActions.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(data){if(Envelope.selectedRecpForm=null,Envelope.isFromFormView&&0==innerForm){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.documentscheduled")),pageId.find("#zp_views_formrecactions").attr("style","display:block"),pageId.find("div#createEnvelopeModal").modal("hide");var formRowsObj=pageId.find("table#zp_views_records_table tbody");if(formRowsObj.find("input#zp_view_sel_record").prop("checked",!1),$.each(recList,function(index,recId){formRowsObj.find("tr[recordid="+recId+"]").attr("isAgreementSent","true"),formRowsObj.find("tr[recordid="+recId+"]").attr("module",data[1].MODULE),formRowsObj.find("tr[recordid="+recId+"]").attr("agreeid",data[1].recordId)}),Layout.Page.container.find("div#zp_view_record_delete").hide(),0==innerForm)return}if(ZPView.newRecordDetails.agreeid=data[1].recordId,ZPView.newRecordDetails.module=data[1].MODULE,pageId.find("iframe[name='createEnvelopeResp']").attr("src",data[1].uri).show(),pageId.find("div#createEnvelopeModal").addClass("PopMdxModel l0"),pageId.find("div#zp_modal_body").find("div#zp_page_loading").remove(),pageId.find("button#close_btn").show(),pageId.find("div#createEnvelopeModal").find("div#embed_iframe").show(),Envelope.loadIframe(data[1]),pageId.find("div#ca_footer").hide(),pageId.find("div#zp_modal_body").addClass("NomdlFoot"),pageId.find("button#footer_submit").hide(),pageId.find("button#footer_close").text("Close"),null!=fileID){pageId.find("ul[fileid="+fileID+"]").find("i#send_envelope").addClass("grn"),pageId.find("ul[fileid="+fileID+"]").find("i#send_envelope").parent().attr("onclick","Envelope.getEnvelopePreview('"+data[1].recordId+"','','selffiles')"),pageId.find("ul[fileid="+fileID+"]").find("i#send_envelope").removeClass(),pageId.find("ul[fileid="+fileID+"]").find("i#send_envelope").addClass("IC-send-file S14 grn FR MR15"),pageId.find("ul[fileid="+fileID+"]").find("i#send_envelope").attr("title",ZPI18N.getString("zp.documentdtls"));var ele=pageId.find("ul[fileid="+fileID+"]").find("i#send_envelope");pageId.find("ul[fileid="+fileID+"]").find("i#send_envelope").parent().text(ZPI18N.getString("zp.documentdtls")),pageId.find("ul[fileid="+fileID+"]").find(".PR5").append(ele)}if(-1===Layout.Page.hash.indexOf("-formId")&&-1===Layout.Page.hash.indexOf("files/hrfile")&&-1===Layout.Page.hash.indexOf("files/docusign/doculistview")){var viewObj=Layout.Page.container.find("#documents_list_form"),relobj=Layout.Page.container.find("#anchor_single_doc_list");viewObj.is(":visible")&&(relobj.hasClass("collapsed")||relobj.addClass("collapsed"),viewObj.slideUp())}},error:function(req){if(pageId.find("div#zp_page_loading").hide(),pageId.find("form#createEnvelopeForm,div#ca_footer").show(),400!==req.status){var errResponse=req.responseJSON[1];if(6013!=errResponse.errorCode)if(6014!=errResponse.errorCode){if(-1!=req.responseText.search("mailmerge")){var errorMsg;return errorMsg=JSON.parse(JSON.parse(req.responseText)[1].msg).error.message,void ZPeople.Message.showFailureMsg(errorMsg)}if("string"==typeof errResponse.msg)ZPeople.Message.showFailureMsg(errResponse.msg),Files.toggleFileFieldDisplay(),Layout.Page.container.find("div#zp_page_loading").remove(),pageId.find("div#ca_footer,button#close_btn,#createEnvelopeForm").show();else{var dispMsg,validationMsg=errResponse.msg;if(validationMsg.hasOwnProperty("ef")){var dispName="<p>";$.each(validationMsg.ef,function(mailId,errorCompList){var emptyFieldsId=errorCompList.substring(1,errorCompList.length-1).split(",");$.each(emptyFieldsId,function(index,errId){var optElm=pageId.find("option[value='"+errId.trim()+"']");-1===dispName.indexOf(optElm.text())&&(index>0&&(dispName+=","),dispName+=optElm.text())})}),dispMsg=dispName+=" is not available for this/these record(s) </p>"}else validationMsg.hasOwnProperty("extnerr")?dispMsg=ZPI18N.getString("zp.fileformaterr"):validationMsg.hasOwnProperty("disbaled")?dispMsg=validationMsg.disbaled:validationMsg.hasOwnProperty("limitEx")?dispMsg=validationMsg.limitEx:ZPeople.Message.showFailureMsg(req.statusText);pageId.find("div#form_adobeResp").html(dispMsg),pageId.find("div#adobeFailedAlert").modal()}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.mmmailfailureerrormessadmin",new Array(errResponse.msg)));else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.mmmailfailuresubject"))}else ZPeople.Message.showFailureMsg(req.responseJSON.error)}})}},loadIframe:function(data){var pageId=Layout.Page.container;pageId.find("iframe[name='createEnvelopeResp']").one("load",function(){if("true"===$(this).attr("drafted")){pageId.find("div#createEnvelopeModal").removeClass("PopMdxModel l0"),pageId.find("div#createEnvelopeModal").modal("hide"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.docadddsucc")),-1===Layout.Page.hash.indexOf("-formId")&&(window.location.href=Layout.Page.hash.split("-createEnvelope")[0]),pageId.find("iframe[name='createEnvelopeResp']").attr("drafted","false");var catName=pageId.find("select#agrselect_Cat option[value='"+data.catId+"']").text();if(catName=ZPSetupCommon.isEmpty(catName)?data.newcat:catName,data.hasOwnProperty("newcat")&&Object.keys(Files.newCategoryList).length>0&&(Files.newCategoryList[data.catId]=ZSEC.Encoder.encodeForHTML(data.newcat),Layout.Page.container.find("select#search_cat").append("<option value='"+data.catId+"'>"+ZSEC.Encoder.encodeForHTML(data.newcat)+"</option>")),pageId.attr("id").indexOf("files-docusign-doculistview")>-1){var envName=pageId.find("input#search_envelopename").val(),catId=pageId.find("select#search_cat").val(),status=pageId.find("select#search_status").val(),name=data.name;catId!=data.catId&&""!=catId&&"select"!=catId||"Sent"!=status&&""!=status&&"select"!=status||-1==name.indexOf(envName)&&""!=envName||(data.name=ZSEC.Encoder.encodeForHTML(data.name),data.OWN=ZSEC.Encoder.encodeForHTML(data.OWN),data.ownerId=ZSEC.Encoder.encodeForHTML(data.ownerId),pageId.find("#envelopes_list").prepend(Envelope.constructEnvelopeData(data,"single"))),0===pageId.find("#envelopes_list ul").length?(pageId.find("#envelope_norecords").removeClass("DN"),pageId.find("#envelope_norecords").addClass("Scrcont")):(pageId.find("#envelope_norecords .ctable").remove(),pageId.find("#envelope_norecords").removeClass("Scrcont"),pageId.find("#envelopes_list").removeClass("DN"),pageId.find("#envelopes_listingpage").removeClass("DN"),1===pageId.find("#envelopes_list ul").length&&pageId.find("#envelopes_listingpage").addClass("expand"))}}else $(this).attr("drafted","true"),Envelope.loadIframe(data)})},getEnvelopeList:function(e,modeType,event,sortDefined,sortOrderval,sortColumnval){Layout.Page.container.find("#doc_multiselDel").hide(),Layout.Page.container.find("#doc_HeaderBar").show(),Layout.Page.container.find("#envelopes_checkallbox").prop("checked",!1),void 0==isAnySignConfigured&&Zohosign.getEsignConfigurations();var pageId=Layout.Page.container,limit="";if("search"!=event&&"reset"!=event||Agreements.hideAndShowFilterIC("close"),Layout.Page.container.find("#envelopes_list").attr("scroll","enabled"),Files.Esign.firescrollTrigger("envelope"),void 0!=e&&13===e.keyCode||ZPSetupCommon.isEmpty(e)){var contentBody="";contentBody=pageId.find("#envelopes_list");var envName=pageId.find("input#search_envelopename").val(),catId=pageId.find("select#search_cat").val(),catName=pageId.find("#s2id_search_cat").find("span").text(),status=pageId.find("select#search_status").val(),startInd=ZPSetupCommon.isEmpty(contentBody.data("start"))?1:contentBody.data("start"),sortColumn="",sortOrder=!1,searchParams={};if(void 0!=Layout.Page.container.find(".sort-d").attr("id")?(getSortColumn=Layout.Page.container.find(".sort-d").attr("id"),sortColumn=Files.Esign.getSortColumn(getSortColumn),sortOrder=!1):void 0!=Layout.Page.container.find(".sort-u").attr("id")&&(getSortColumn=Layout.Page.container.find(".sort-u").attr("id"),sortColumn=Files.Esign.getSortColumn(getSortColumn),sortOrder=!0),""==sortColumn&&(void 0==sortDefined?sortColumn="SENT_DATE":(sortOrder=sortOrderval,sortColumn=sortColumnval)),""!=pageId.find("#env_sentfrom").val()&&0!=pageId.find("#env_sentfrom").val()&&void 0!=pageId.find("#env_sentfrom").val())sentFrom=pageId.find("#env_sentfrom").val(),searchParams[ZPI18N.getString("zp.from")]=sentFrom;else sentFrom="-1";if(""!=pageId.find("#env_sentto").val()&&0!=pageId.find("#env_sentto").val()&&void 0!=pageId.find("#env_sentto").val())sentTo=pageId.find("#env_sentto").val(),searchParams[ZPI18N.getString("zp.to")]=sentTo;else sentTo="-1";limit=24,"search"==event||"reset"==event||"sort"==event?(Layout.Page.container.find("#envelopes_list").removeAttr("scroll"),Layout.Page.container.find("#envelopes_list").attr("scroll","enabled"),contentBody.empty(),Envelope.envelopeStartindex=1,startInd=1):1==Envelope.envelopeFirescroll&&(0==Envelope.envelopeStartindex?Envelope.envelopeStartindex=25:Envelope.envelopeStartindex=Envelope.envelopeStartindex+24,startInd=Envelope.envelopeStartindex),("click"===event&&1===modeType&&1===contentBody.data("next")||-1===modeType&&parseInt(contentBody.data("start"))>1||"click"!==event)&&(-1===modeType?startInd-=200:1===modeType&&(startInd+=200));var params={action:"getEnvelopes",limit:limit,startInd:startInd,sortOrder:sortOrder,sortColumn:sortColumn,sentFrom:sentFrom,sentTo:sentTo};ZPSetupCommon.isEmpty(envName)||(params.envelopeName=envName,searchParams[ZPI18N.getString("zp.name")]=envName),ZPSetupCommon.isEmpty(catId)||"select"===catId||(params.catId=catId),ZPSetupCommon.isEmpty(catName)||"Select"===catName||(searchParams[ZPI18N.getString("zp.folder")]=catName),ZPSetupCommon.isEmpty(status)||"select"===status||(params.status=status,searchParams[ZPI18N.getString("zp.status")]=status);var keyId="filter_params_envFiles";if(Object.keys(searchParams).length>0){var resultHtml="";$.each(searchParams,function(key,val){resultHtml+="<span value='"+key+"'>"+key+"&nbsp;&nbsp; : &nbsp;&nbsp;"+ZSEC.Encoder.encodeForHTML(val)+"<i onclick='Files.removeSearchBreadcrumbs(this)'></i></span>"}),Layout.Page.container.find("#"+keyId).html(resultHtml),Files.opnclsSearchBreadcrumbs("open")}else-1===Layout.Page.hash.indexOf("files/docusign/doculistview")&&(Layout.Page.container.find("#"+keyId).html(""),Files.opnclsSearchBreadcrumbs("close"));ZPeople.Request.send("/docuSignActions.zp",params,this.constructEnvelopeList)}},constructEnvelopeList:function(data,params){var agreementsListElms="",pageId=Layout.Page.container;contentBody=pageId.find("#envelopes_list");Layout.Page.container.find("#tab_actions").removeClass("DN"),Layout.Page.container.find("#tab_actions").find("#create_agr").removeClass("DN"),pageId.find("div#no_recfound_img").remove(),Envelope.isCachedEnvelopeList=!0;var listCount=data[1].length-1;Zohosign.populateDocumentView(),void 0==isDocuReadView&&Zohosign.getReadView(),Zohosign.isfromFilterView&&Layout.Page.container.find("#zp_esign_view").select2("val","4"),1===data[1].length&&contentBody.find(".ZPListingUL").length>1?(ZPeople.FireScroll.getFireScrollPropertie().triggered=!0,Envelope.envelopeFirescroll=!1):1===data[1].length?(Layout.Page.container.find("#envelope_norecords .ctable").remove(),Envelope.newuinorecords()):(pageId.find("div#envelopes_list").removeClass("DN"),pageId.find("div#envelopes_listingpage").removeClass("DN"),pageId.find("div#envelope_norecords").removeClass("Scrcont"),pageId.find("div#envelope_norecords").addClass("DN"),data[1].length<24?(Envelope.envelopeFirescroll=!1,ZPeople.FireScroll.getFireScrollPropertie().triggered=!0):Envelope.envelopeFirescroll=!0,$.each(data[1],function(index,obj){if(obj.hasOwnProperty("limit")){var limitCnt,start=obj.start;limitCnt=1===start?listCount>1?listCount:start:listCount>1?listCount+start-1:start,data.length<=1&&(start=0,limitCnt=0),pageId.find("span#zp_view_page_cnt").html(start+"&nbsp;-&nbsp;"+limitCnt),contentBody.data({start:start,next:obj.nexpage})}else agreementsListElms+=Envelope.constructEnvelopeData(obj)}),contentBody.append(agreementsListElms),Envelope.setCatName(data[1]),contentBody.data({start:params.startInd}),pageId.find("div#envelope_footer").removeClass("DN"),void 0!=isDocuReadView&&isDocuReadView&&($("a#zp_t_files_zohosign_documentlistview").parent("li").addClass("active"),$("a#zp_t_files_docusign").parent("li").addClass("active"),$("a#zp_t_files_adobesign").parent("li").addClass("active"),$("a#zp_t_files_zohosign_documentlistview").parent("li").parent("ul").attr("style","display:block"),$("a#zp_t_files_docusign").parent("li").parent("ul").attr("style","display:block"),$("a#zp_t_files_adobesign").parent("li").parent("ul").attr("style","display:block"),Layout.Page.container.find("#create_agr").addClass("DN"),Layout.Page.container.find("#zp_esign_view").select2("val","4")),Layout.Page.container.find("#zp_esign_view").select2("val","4")),ZPeople.FireScroll.reset()},constructEnvelopeData:function(obj,mode){0==Object.keys(Files.newCategoryList).length?ZPeople.Request.sendAsyncPost("/fileCabinetAction.zp",{methodName:"getCategoryList",conreqcsr:csrfToken},Zohosign.openFilter):Zohosign.openFilter(Files.newCategoryList);var statusCls,ARID,owner,completeDate,sentDate,categoryName,ownerId,topRecipient,size,row="",catId=ZPSetupCommon.isEmpty(obj.catId)?"0":obj.catId,agName=ZPSetupCommon.isEmpty(obj.name)?"[No name]":obj.name,repName=[];if("single"==mode){ARID=obj.recordId,obj.agreementId,owner=obj.OWN,ownerId=obj.ownerId,sentDate=obj.statusDateTime,completeDate="",categoryName=ZSEC.Encoder.encodeForHTML(Layout.Page.container.find("select#search_cat").find("option[value='"+catId+"']").text()),statusCls="org",status="Sent",size=obj.recipients.length;for(var i=0;i<size;i++)0==i&&(topRecipient=obj.recipients[i]),repName.push(obj.recipients[i])}else ARID=obj.ARID,obj.agreementId,owner=obj.owner,ownerId=obj.ownerId,sentDate=obj.sentDate,completeDate=obj.completeDate,categoryName=Files.newCategoryList[obj.catId],statusCls="Sent"===obj.status?"org":"Completed"===obj.status?"grn":"red",status=obj.status,repName=obj.recipients,topRecipient=obj.topRecipient;return row+='<ul class="ZPListingUL" href="" envelopeId="'+ARID+'" isCancelled='+("Cancelled / Declined"===obj.status)+">",row+='<li class="check"><div class="checkbox"><input type="checkbox" onclick=Files.Esign.checkParticularFiles(this,"envelopes")><label></label></div></li>',row+='<li class="tsize"><div class="fileType BGtxt"><img src="'+obj.senderPhoto+'"></div>',row+='<div class="DIB CP" onclick="Envelope.getEnvelopeViewPage(this)"><span class="bld ellip txttrim">'+agName+"</span>",row+='<span class="DB S13 MT8">',row+='<span class="ellip"><em class="dgry">'+ownerId+'-</em><em class="ML2">'+owner+"</em></span>",row+="</span></div></li>",void 0!=repName&&(repName.length>1?(row+='<li class="tsize"><span class="btn-sm FL ellip">'+repName.toString().split(",")[0]+"</span>",row+='<div class=" dropdown ZPCusDrs  FL  ML5 "><div data-toggle="dropdown" class="btn btn-sm btn-lgray moreDt"><i class="IC-more"></i></div>',row+=Files.getAllSharedLocRole(repName),row+="</div></li>"):row+=void 0!=topRecipient?'<li class="tsize"><span class="ellip">'+topRecipient+"</span></li>":'<li class="tsize"><span class="ellip"> </span></li>'),row+='<li id="sentOn">'+sentDate+"</li>",row+='</span class="ellip"></div></li><li id="cat_nm"><span class="ellip">'+categoryName+"</span></li>",row+=null!==completeDate&&void 0!==completeDate&&""!==completeDate?'<li name="env_status"><span class='+statusCls+">"+status+'<i class="IC-rou-tik ML5 grn"></i></span><span class="DB dgry MT5">'+completeDate+"</span></li>":'<li name="env_status"><span class='+statusCls+">"+status+"</span></li>",row+='<li class="actions"><div class="FR">',row+='<i class="IC-down" onclick=Agreements.downloadAttachement(this,"'+ARID+'","download") class="IC-imprt S16 gry FR MR15"></i>',row+='<i class="IC-delete-1px" onclick="Files.Esign.deleteRecConfirm(this, \'action_confirm_btn\');"></i></div>',row+='<div class="FL"><div id="action_confirm_btn" class="DN"><button class="btn btn-default btn-sm FR" onclick="Files.Esign.cancelDelRecConfirm(this);">Cancel</button><button class="btn btn-danger btn-sm FR MR10" onclick=Envelope.deleteAgreementRecord(this,"last");>Confirm</button></div>',row+="</div></li></ul>"},newuinorecords:function(){var pageId=Layout.Page.container;pageId.find("div#envelopes_list").addClass("DN"),pageId.find("div#envelopes_listingpage").addClass("DN"),pageId.find("#envelopes_listingpage").removeClass("expand"),pageId.find("#envelope_norecords").addClass("Scrcont"),pageId.find("#envelope_norecords").removeClass("DN");var currScrollContObj=pageId.find("#envelope_norecords"),noFilesFound="";noFilesFound+='<div class="ctable"><div class="ctcell"><div class="ZPNdata">',noFilesFound+='<i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i>',noFilesFound+='<i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i>',noFilesFound+='<h5 id="zp_views_nodata">'+ZPI18N.getString("zp.lookup.norecfound")+"</h5></div></div></div>",currScrollContObj.append(noFilesFound)},resetFilter:function(){var pageId=Layout.Page.container;pageId.find("#filter_params_envFiles").find("span").remove(),Files.opnclsSearchBreadcrumbs("close");var filterOptions=pageId.find("#search_cat,#search_status");filterOptions.select2("val","select"),filterOptions.trigger("change"),pageId.find("#search_envelopename").val(""),pageId.find("#env_sentto").val(""),pageId.find("#env_sentfrom").val(""),Envelope.getEnvelopeList("","","reset")},searchAgreementsRecord:function(catObj){Layout.Page.container.find("button#reset_envBtn").removeClass("DN")},getEnvelopeViewPage:function(thisObj,recId){var envId;Envelope.recordId="",envId=ZPSetupCommon.isEmpty(thisObj)?recId:$(thisObj).closest("ul").attr("envelopeId"),window.location.href=Layout.Page.hash+"-envelopeId:"+envId},getEnvelopePreview:function(agreementId,thisObj,mode){var agrId,moduleType,formId,recId;-1===Layout.Page.hash.indexOf("-formId:")&&(agrId=Layout.Page.hash.split("envelopeId:")[1]),Layout.Page.hash.indexOf("doculistview-envelopeId")>-1||-1!==Layout.Page.hash.indexOf("hrfile")?moduleType="1":(Layout.Page.hash.indexOf("-formId:")>-1||void 0!=ZPForm.CURRFORM_PARAM.recordId)&&(moduleType="2",void 0===(formId=Layout.Page.urlparam.formId)&&(formId=ZPForm.CURRFORM_PARAM.formId),agrId=agreementId,void 0==(recId=$(thisObj).closest("tr").attr("recordId"))&&(recId=thisObj)),-1===Layout.Page.hash.indexOf("hrfile")&&"selffiles"!=mode||void 0!=agreementId&&(recId=agrId=agreementId,moduleType="1"),Envelope.recordId=recId,ZPeople.Request.send("/docuSignActions.zp",{action:"getEnvelopeStatus",conreqcsr:csrfToken,envelopeId:agrId,moduleType:moduleType,formId:formId,recordId:recId},Envelope.constructEnvelopeInfo,{envId:agrId,recordId:recId})},constructEnvelopeInfo:function(infoData,params,otherDtls){var envelopeInfo=infoData[1],envelopeId=otherDtls.envId;if(Layout.Page.hash.indexOf("-formId:")>-1&&jQuery.isEmptyObject(envelopeInfo))ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.agreementdeleted"));else{var reciepentInfoRow="";if((pageId=Layout.Page.container).find("tr[envelopeId='"+envelopeId+"']").data("agreements_data")||pageId.find("table#agreements_list").find("tr[envelopeId='"+envelopeId+"']").data({agreements_data:envelopeInfo}),ZPeople.BSModal.setup({id:"viewEnvelopeModal",type:22,modalClass:"popRgtModel PopLgModel fileAgrModal in",header:Envelope.view.header,body:Envelope.view.bodymainContent,footer:Envelope.view.footer}),pageId.find("#activityDiv").remove(),Files.Esign.constructActivityDetailsDiv(),envelopeInfo.hasOwnProperty("RINFO")){var reciepentInfo=envelopeInfo.RINFO;$.each(reciepentInfo,function(reciepentId,reciepentObj){reciepentInfoRow+='<li><div class="dtable"><div class="ph">',null!==reciepentObj.RCD&&void 0!==reciepentObj.RCD&&""!==reciepentObj.RCD&&(reciepentInfoRow+='<i class="IC-task-chk grn"></i>'),reciepentInfoRow+='<div class="fileType BGtxt"><span>'+reciepentObj.RN.charAt(0).toUpperCase()+"</span></div></div>",reciepentInfoRow+='<div class="user"><b class="DB">'+reciepentObj.RN+'</b> <span class="dgry">'+reciepentObj.RN+"</span></div>","SIGNER"==reciepentObj.RT?reciepentInfoRow+='<div class="sign"><i class="CR-sign cirIcon" data-toggle="tooltip" data-original-title="'+reciepentObj.RT+'" title="" data-placement="bottom"></i></div>':reciepentInfoRow+='<div class="sign"><i class="IC-eye1 cirIcon" data-toggle="tooltip" data-original-title="'+reciepentObj.RT+'" title="" data-placement="bottom"></i></div>',reciepentObj.hasOwnProperty("RS")?"Completed"==reciepentObj.RS?(reciepentInfoRow+='<div class="status"><b class="DB">Completed on</b>',reciepentInfoRow+='<span class="dgry">'+reciepentObj.RCD+"</span>"):(reciepentInfoRow+='<div class="status"><b class="DB">'+ZPI18N.getString("zp.status")+"</b>",reciepentInfoRow+='<span class="dgry">'+reciepentObj.RS+"</span>"):(reciepentInfoRow+='<div class="status"><b class="DB">'+ZPI18N.getString("zp.status")+"</b>",reciepentInfoRow+='<span class="dgry"></span>'),reciepentInfoRow+='<i class="IC-ar-dwn cirIcon" onclick="Zohosign.viewRecipients(this)"></i></div></div>',reciepentInfoRow+='<div class="dtable expnd"><div><b class="DB">Type</b><span class="dgry">'+reciepentObj.RT+"</span>",reciepentInfoRow+='</div><div><b class="DB">Order</b><span class="dgry">'+reciepentObj.RO+"</span></div><div>",reciepentInfoRow+='<b class="DB">Date Delivered</b><span class="dgry">'+reciepentObj.RDD+"</span></div></div></li>"})}var viewEnvelopeModal=pageId.find("div#viewEnvelopeModal");viewEnvelopeModal.attr("name","esign"),viewEnvelopeModal.attr("recordId",otherDtls.recordId),reciepentInfoRow=""===reciepentInfoRow?Agreements.norecElm:reciepentInfoRow;var eventInfoRow="";if(envelopeInfo.hasOwnProperty("EINFO")){var eventInfo=envelopeInfo.EINFO;$.each(eventInfo,function(eventId,eventObj){eventInfoRow+='<div class="event dot">',eventInfoRow+="<p>"+eventObj.N+"<em>"+eventObj.ED+"</em></p>",eventInfoRow+="<div>"+eventObj.EDESC+"</div>",eventInfoRow+="</div>"})}if(eventInfoRow=""===eventInfoRow?Agreements.norecElm:eventInfoRow,envelopeInfo.hasOwnProperty("DINFO")){var pageId=Layout.Page.container,dInfo=envelopeInfo.DINFO;pageId.find("b#agName").text(dInfo.name),pageId.find("span#agOwner").text(dInfo.owner),pageId.find("#senderProfile").attr("src",dInfo.senderPhoto),pageId.find("span#sentDate").text(dInfo.sentDate),"-1"!=dInfo.sentDate&&pageId.find("span#doc_sent_date").text(dInfo.sentDate),fileowner=dInfo.owner,catId=dInfo.catId,"-"!=dInfo.completeDate&&pageId.find("span#completed_date").text(dInfo.completeDate),"-"!=dInfo.VALIDUNTIL?pageId.find("b#deadLine").text(dInfo.VALIDUNTIL):pageId.find("#deadLine").parents("div")[0].remove(),""!=dInfo.message&&"-"!=dInfo.message?pageId.find("b#agr_msg").text(dInfo.message):pageId.find("#agr_msg").parents("div")[0].remove(),fileCategoryname=Files.newCategoryList[catId],pageId.find("b#status").text(dInfo.status),"Completed"==dInfo.status&&pageId.find("i#taskCompleted").addClass("IC-task-chk grn FR"),void 0==isDocuReadView&&Zohosign.getReadView(),"Sent"==dInfo.status&&(isDocuReadView?pageId.find("#cancelEnvbtn").hide():pageId.find("#cancelEnvbtn").show()),"-"!=dInfo.sendmail_copies?pageId.find("b#mail_copies").text(dInfo.sendmail_copies):pageId.find("#mail_copies").parents("div")[0].remove(),pageId.find(".Scrcont .ZPSdiv").last().addClass("bn")}var attachmentsRow="";if(envelopeInfo.hasOwnProperty("AINFO")){var attachmentDtls=envelopeInfo.AINFO;$.each(attachmentDtls,function(pkId,attachmentsDtls){var encodeFileName=encodeURIComponent(attachmentsDtls.fileName),encodeFilePath=encodeURIComponent(attachmentsDtls.fP),fileEObj="",fileExtn=(fileEObj=""==attachmentsDtls.fP?encodeFileName:encodeFilePath).substr(fileEObj.lastIndexOf(".")+1,fileEObj.length).toLowerCase(),attachmentsRownew="",fileIconextn=Files.Esign.fileIcons(fileExtn);"jpg"===fileExtn||"jpeg"===fileExtn||"gif"===fileExtn||"png"===fileExtn||"gif"===fileExtn?(attachmentsRownew+='<div class="attDivBox"><span class="FL"><i class="IC-'+fileIconextn+'"></i></span><span class="FL dtl">',attachmentsRownew+='<span class="DB" onclick=Zohosign.constructDataForPreview(true,"'+encodeFilePath+'","'+encodeURIComponent(fileowner)+'","'+encodeURIComponent(fileCategoryname)+'","'+encodeFileName+'","'+envelopeInfo.RINFO.RN+'","'+envelopeId+'","'+envelopeInfo.DINFO.sentDate+'","'+pkId+'");Agreements.downloadAttachement(this,"'+pkId+'","view","'+encodeFileName+'","'+encodeFilePath+'")><a class="CP">'+attachmentsDtls.fileName+'</a></span><span class="DB dgry S12 MT5">'+attachmentsDtls.ED+"</span></span>",attachmentsRownew+='<span class="FR"><i class="IC-down" onclick=Agreements.downloadAttachement(this,"'+pkId+'","download","'+encodeFileName+'","'+encodeFilePath+'")></i></span></div>'):(attachmentsRownew+='<div class="attDivBox"><span class="FL"> <i class="IC-'+fileIconextn+'"></i></span><span class="FL dtl">',attachmentsRownew+='<span class="DB" onclick=Zohosign.constructDataForPreview(false,"'+encodeFilePath+'","'+encodeURIComponent(fileowner)+'","'+encodeURIComponent(fileCategoryname)+'","'+encodeFileName+'","'+envelopeInfo.RINFO.RN+'","'+envelopeId+'","'+envelopeInfo.DINFO.sentDate+'","'+pkId+'");Agreements.downloadAttachement(this,"'+pkId+'","view","'+encodeFileName+'","'+encodeFilePath+'")><a class="CP">'+attachmentsDtls.fileName+'</a></span> <span class="DB dgry S12 MT5">'+attachmentsDtls.ED+"</span></span>",attachmentsRownew+='<span class="FR"><i class="IC-down" onclick=Agreements.downloadAttachement(this,"'+pkId+'","download","'+encodeFileName+'","'+encodeFilePath+'")></i></span></div>'),Layout.Page.container.find("div#attachmentsData").append(attachmentsRownew)})}Agreements.setAgreementsDtlsValue(envelopeId),attachmentsRow=""===attachmentsRow?Agreements.norecElm:attachmentsRow,pageId.find("ul#recipientsList").html(reciepentInfoRow),pageId.find("#actDetails").html(eventInfoRow),pageId.find("tbody#attachments_Info").html(attachmentsRow),pageId.find("i#agrm_filterIc").attr("class","IC-filter S18 CP FR ML20 MT5 gry");var previewActions=viewEnvelopeModal.find("div#preview_actions");viewEnvelopeModal.attr("envelopeId",envelopeId),"Cancelled / Declined"===pageId.find("span#status").text()||"Signed"===pageId.find("span#status").text()?previewActions.hide():previewActions.show()}},deleteAgreementConfirm:function(thisObj){ZPeople.confirm(this,"zp.zpalert","zp.deleteRecord","","","",ZPI18N.getString("zp.delete"),"",!0),$("#confirmConfirmationPopup").attr("onclick","Envelope.deleteAgreementRecord('','first')")},deleteAgreementRecord:function(thisObj,position){var recordIdArr="",moduleType="",formId="",recordId="";if("first"==position)for(var deleteArray=Layout.Page.container.find("#envelopes_list").find('input[type="checkbox"]:checked'),deleteCount=deleteArray.length,i=0;i<deleteCount;i++)i>=1&&(recordIdArr+=","),recordIdArr+=Layout.Page.container.find(deleteArray[i]).parent().parent().parent().attr("envelopeId");else(void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1)&&(void 0===(formId=Layout.Page.urlparam.formId)&&(formId=ZPForm.CURRFORM_PARAM.formId),formId=formId,recordId=ZPForm.CURRFORM_PARAM.recordId),moduleType="2",recordIdArr=$(thisObj).closest("ul").attr("envelopeId");ZPeople.Request.send("/docuSignActions.zp",{action:"deleteEnvelope",conreqcsr:csrfToken,recordIdList:recordIdArr,recordId:recordId,moduleType:moduleType,formId:formId},Envelope.deleteCallBack,thisObj)},deleteCallBack:function(data,params,thisObj){var pageId=Layout.Page.container;data[1].isDeleted?($(pageId.find("#envelopes_list").find('input[type="checkbox"]:checked').length)[0]>0?($(pageId.find("#envelopes_list").find('input[type="checkbox"]:checked')).closest("ul").remove(),Layout.Page.container.find("#doc_multiselDel").hide(),Layout.Page.container.find("#doc_HeaderBar").show()):$(thisObj).closest("ul").remove(),0===pageId.find("#envelopes_list").find("ul").length&&(Layout.Page.container.find("#envelope_norecords .ctable").remove(),Envelope.newuinorecords(),pageId.find("#envelopes_list").addClass("DN"),pageId.find("#envelopes_listingpage").addClass("DN"),pageId.find("#docenvelopes_listingpageuments_listingpage").removeClass("expand")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.zs.documentdeletedsuccessfully"))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.zs.documentnotdeleted"))},validation:function(isFileType){var createAgr=Layout.Page.container.find("div#createEnvelopeModal"),recipientsElms=createAgr.find("*[id=recpList]"),envelope_name_elm=createAgr.find("#envName").val(),catId=createAgr.find("select#agrselect_Cat").val(),envelopeSubject=(createAgr.find("input#hrnewCategory").val(),createAgr.find("input[name='deadline']").val(),createAgr.find("input#envelope_subject").val()),envelopeMessage=createAgr.find("textarea#envelope_message").val();$(".ERR").remove();var err=!1;if(-1!==Layout.Page.hash.indexOf("doculistview")){var agmntFile=createAgr.find("#uploadfile")[0].files[0];if(agmntFile||"cloudUpload"===Files.uploadMode){if(agmntFile&&(agmntFile.size>5e6?(err=!0,createAgr.find("#uploadfile").closest("div#err_div").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.agreementfilesizelimit")+"</span>")):createAgr.find("#uploadfile").closest("div#err_div").next("span#errormsg").remove()),!err){var fileExtn=createAgr.find("span#drop_file").find("span").text();fileExtn=fileExtn.substr(fileExtn.lastIndexOf(".")+1,fileExtn.length),-1===Envelope.add.docuCompatibleExtns.indexOf(fileExtn.toLowerCase())?(err=!0,createAgr.find("#uploadfile").closest("div#err_div").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.choosepdffile")+"</span>")):createAgr.find("#uploadfile").closest("div#err_div").next("span#errormsg").remove()}}else err=!0,createAgr.find("#uploadfile").closest("div#err_div").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.choosedoc")+"</span>")}if(ZPSetupCommon.isEmpty(envelope_name_elm)){err=!0;var errMsg=ZPI18N.getString("zp.zs.envelopenameempty");createAgr.find("#envName").after('<span class="ERR" id="errormsg">'+errMsg+"</span>")}envelope_name_elm.length>100&&(createAgr.find("#envName").after('<span  errmsg="mailids" id="errormsg" class="ERR">'+ZPI18N.getString("zp.lengthvalidation",new Array(ZPI18N.getString("zp.name"),100))+"</strong></span>"),err=!0),!ZPSetupCommon.isEmpty(envelopeSubject)&&envelopeSubject.length>100&&(createAgr.find("#envelope_subject").after('<span  errmsg="mailids" id="errormsg" class="ERR">'+ZPI18N.getString("zp.lengthvalidation",new Array(ZPI18N.getString("zp.subject"),100))+"</strong></span>"),err=!0),-1==envelope_name_elm.indexOf("<")&&-1==envelope_name_elm.indexOf(">")||(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.filesexcludesplchars",new Array(ZPI18N.getString("zp.name")))),err=!0),envelopeMessage.length>1e3&&(createAgr.find("#envelope_message").after('<span  errmsg="mailids" id="errormsg" class="ERR">'+ZPI18N.getString("zp.lengthvalidation",new Array(ZPI18N.getString("zp.message"),1e3))+"</strong></span>"),err=!0),Envelope.isFromFormView&&(ZPSetupCommon.isEmpty(createAgr.find("#uploadfile").val())||"select"===createAgr.find("#uploadfile").val()?createAgr.find("#uploadfile").parent().after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectfileupload")+"</span>"):createAgr.find("#uploadfile").parent().next("span#errormsg").remove(),ZPSetupCommon.isEmpty(createAgr.find("#templates").val())||"0"===createAgr.find("#templates").val()?createAgr.find("#templates").parent().after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectfileupload")+"</span>"):createAgr.find("#templates").parent().next("span#errormsg").remove());var recipientsMailIds=recipientsElms.val();if(ZPSetupCommon.isEmpty(recipientsMailIds)||"select"===recipientsMailIds){err=!0;errMsg=recipientsElms.is("input")?ZPI18N.getString("zp.entervalidemailaddress"):ZPI18N.getString("zp.selectemailidfield");createAgr.find("#recpList").after('<span class="ERR" id="errormsg">'+errMsg+"</span>")}else recipientsElms.is("input")&&Agreements.validateMailIds(recipientsMailIds.split(","),createAgr.find("#recpList"),ZPI18N.getString("zp.entervalidemailaddress"));createAgr.find("div#s2id_agrselect_Cat").is(":visible")&&"select"===catId?(err=!0,createAgr.find("#agrselect_Cat").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectcategory")+"</span>")):createAgr.find("input#hrnewCategory").is(":visible")&&ZPSetupCommon.isEmpty(createAgr.find("input#hrnewCategory").val())?(err=!0,createAgr.find("#hrnewCategory").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.enterCategory")+"</span>")):createAgr.find("#agrselect_Cat").parent().find("span#errormsg").remove();var smc=createAgr.find("#copyList").val();ZPSetupCommon.isEmpty(smc)||(smc.split(",").length>50?createAgr.find("#copyList").after('<span class="ERR" id="errormsg" errmsg="mailids">'+ZPI18N.getString("zp.maildidslengthunlimit")+"</span>"):(createAgr.find("#copyList").parent().find("span#errormsg").remove(),Envelope.validateMailIds(smc.split(","),createAgr.find("#copyList"),ZPI18N.getString("zp.entervalidemailaddress"))));var deadLine=createAgr.find("input[name='deadline']").val();if(!ZPSetupCommon.isEmpty(deadLine)){var lastDate=moment(deadLine,dateFmt.toUpperCase()).format("DD-MMM-YYYY").split("-"),month=Calendar.months.indexOf(lastDate[1])+1,lDate=lastDate[2]+"/"+month+"/"+lastDate[0];"NaN"===Date.parse(lDate).toString()||moment(lDate).diff(moment(),"days")<0?(err=!0,createAgr.find("input[name='deadline']").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.holiday.dateerror")+"</span>")):createAgr.find("input[name='deadline']").parent().find("span#errormsg").remove();var warnRecp=ZPSetupCommon.isEmpty(warnRecp)?"0":createAgr.find("input[name='freq_warn']").val()}return ZPSetupCommon.isEmpty(createAgr.find("input#envelope_subject").val())&&(err=!0,createAgr.find("#envelope_subject").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.subjectnameempty")+"</span>")),ZPSetupCommon.isEmpty(createAgr.find("input#envName").val())&&(err=!0,createAgr.find("#envName").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.envelopenameempty")+"</span>")),err},validateMailIds:function(mailIds,obj,msg){mailIds.length<=50?$.each(mailIds,function(ind,mailId){if(!ZPUtil.Validation.isEmail(mailId))return!0,obj.after('<span class="ERR" id="errormsg">'+msg+"</span>"),!1;obj.next("span#errormsg").remove()}):(!0,$("div#createAgreementModal").find("#recpList").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.maildidslengthunlimit")+"</span>"))},setDaysForReminder:function(mode){var pageId=Layout.Page.container;ZPSetupCommon.isEmpty(mode)?pageId.find("div#createEnvelopeModal").find("input#reminder_check").is(":checked")?pageId.find("div#createEnvelopeModal").find("div#reminder_setting,div#reminder_freq").show():pageId.find("div#createEnvelopeModal").find("div#reminder_setting,div#reminder_freq").hide():pageId.find("div#createEnvelopeModal").find("input#expire_check").is(":checked")?pageId.find("div#createEnvelopeModal").find("div#expire_setting,div#warning").show():pageId.find("div#createEnvelopeModal").find("div#expire_setting,div#warning").hide()},cancelEnvelope:function(thisObj){var moduleType,recId,recordId=Layout.Page.container.find("div#viewEnvelopeModal").attr("envelopeId"),formId="";void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1?(void 0===(formId=Layout.Page.urlparam.formId)&&(formId=ZPForm.CURRFORM_PARAM.formId),moduleType="2",recId=Envelope.recordId):Layout.Page.hash.indexOf("doculistview-envelopeId")>-1&&(moduleType="1");ZPeople.Request.send("/docuSignActions.zp",{conreqcsr:csrfToken,envelopeId:recordId,action:"cancelEnvelopes",moduleType:moduleType,formId:formId,recordId:recId},Envelope.cancelCallback,recordId)},cancelCallback:function(data,params,recordId){var pageId=Layout.Page.container;if(data[1]){var row="";row=-1!=Layout.Page.hash.indexOf("files/docusign/doculistview")||-1!=Layout.Page.hash.indexOf("files/hrfile")||-1!=Layout.Page.hash.indexOf("selfservice/user/files")?pageId.find("ul[envelopeId='"+recordId+"'] li[name='env_status']"):pageId.find("ul[documentid='"+recordId+"'] li[name='env_status']"),pageId.find("div#viewEnvelopeModal").find("#status").text("Cancelled / Declined"),pageId.find("#cancelEnvbtn").hide(),pageId.find("#status").text("Cancelled / Declined"),row.html("<span class='red'>Cancelled / Declined</span>"),pageId.find("div#viewEnvelopeModal").find("#cancelEnvbtn").hide(),row.closest("tr").attr("isCancelled",!0),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.documentcancelled"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.docnotcancel"))},getTotalRecordCount:function(){var pageId=Layout.Page.container,params={conreqcsr:csrfToken,action:"getEnvelopeRecordCount"};params.envelopeName=pageId.find("input#search_envelopename").val(),"select"!==pageId.find("select#search_cat").val()&&(params.catId=pageId.find("select#search_cat").val()),"select"!==pageId.find("select#search_status").val()&&(params.status=pageId.find("select#search_status").val()),ZPeople.Request.send("/docuSignActions.zp",params,Envelope.showCount)},showCount:function(data){var pageId=Layout.Page.container;data?(pageId.find("span#envelope_totalcnt").text(data.count).removeClass("hide"),pageId.find("a#zp_views_recordcount").addClass("hide")):(pageId.find("span#envelope_totalcnt").addClass("hide"),pageId.find("a#zp_views_recordcount").removeClass("hide"))},setCatName:function(dataObj){var pageId=Layout.Page.container;$.each(dataObj,function(index,envelopeDtls){var catId=ZPSetupCommon.isEmpty(envelopeDtls.catId)?"0":envelopeDtls.catId,categoryName=pageId.find("select#search_cat").find("option[value='"+catId+"']").text();pageId.find("#envelopes_list").find("ul[envelopeId='"+envelopeDtls.ARID+"'] span#cat_nm").text(categoryName)})}},Zohosign={add:{header:'<h6 id="documentHeader" class="addPopTitle">'+ZPI18N.getString("zp.requestsignature")+'</h6><button aria-label="Close" data-dismiss="modal" onclick=Files.Esign.getDocumentsListPage("cancel") class="close" id="close_btn" type="button"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button>',bodyCont:'<div class="form-horizontal pad"><form target="createDocumentResp" id="createDocumentForm" enctype="multipart/form-data" method="post" role="form"> <div class="form-group" id="files_list"> <label class="control-label col-sm-3 zp_mdt" id="file_lbl"><font>'+ZPI18N.getString("zp.file")+'</font></label></div>  <div class="form-group DN" id="template_grp"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.selecttemplate")+'</font></label><div class="col-sm-6"><select id="templates"><option value="0">'+ZPI18N.getString("zp.select")+'</option></select></div></div>   <div id="selectDocType" style="" class="form-group DN"> <label class="control-label col-sm-3 zp_mdt"><font>Doc Type</font></label> <div class="col-sm-6"> <label class="radio DIB MR8"><input checked="checked" value="1" type="radio" name="docType"><span class="ML2">PDF</span></label> <label class="radio DIB MR8"><input value="2" id="docTypeRadio" type="radio" name="docType"><span class="ML2">'+ZPI18N.getString("zp.docx")+'</span></label></div></div>  <div class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.reciepents")+'</font></label> <div class="col-sm-6" id="recp"> <input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="recipients" id="recpList" class="form-control" autocomplete="off"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</label> <div class="col-sm-6"> <input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="email_copies_to" id="copyList" autocomplete="off" class="form-control"> </div> </div> <div class="form-group" id="documentNameDiv"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.name")+'</font></label> <div class="col-sm-6"> <input name="document_name" id="document_name" autocomplete="off" class="form-control"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.message")+'</label> <div class="col-sm-6"> <textarea rows="5" class="form-control" name="document_message" id="document_message" fieldtype="3"></textarea> </div> </div> <div class="form-group"><label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.folder")+'</font></label> <div class="col-sm-6"><select onchange=Files.clearErrmsg("companycategory_err") placeholder="'+ZPI18N.getString("Select")+'" id="agrselect_Cat" class="" tabindex="-1"></select><input type="name" style="display: none;" class="form-control" id="hrnewCategory" autocomplete="off"></div> <div class="col-sm-3" id="cancel_hrCat_btn" style="display:none"> <a href="javascript:void(0)" onclick="Zohosign.cancelnewCategory();" class="btn btn-default btn-sm MT5">'+ZPI18N.getString("zp.cancel")+'</a> </div> </div> <div id="moreSettings" class="DN"><div class="form-group"><label class="col-sm-12 text-left MB15 MT15 PT15 ML20"><b>'+ZPI18N.getString("zp.automation.options")+'</b></label></div><div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.expirationdate")+'</label><div class="col-sm-6" id="deadline"><div class="btnCal"> <input class="form-control" name="deadline" autocomplete="off" caltype="popup" onclick="Calendar.setUpCalendar(event,this)" type="text"> </div></div></div><div class="form-group"> <label class="control-label col-sm-1"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" name="reminder" id="reminder_check" onclick="Zohosign.setDaysForReminder()"><span>'+ZPI18N.getString("zp.reminder")+'</span></label></div></div> <div class="form-group"> <div class="col-sm-10 col-sm-offset-3 DN" id="reminder_setting"></div> <div class="col-sm-10 col-sm-offset-2 MT10 DN" id="reminder_freq"><label class="col-sm-4 PL0"> <span class="DIB MT8">'+ZPI18N.getString("zp.sendreminderonce",new Array(""))+'</span> </label><div class="col-sm-1 PL0" id="reminder_freqdayscnt"> <input class="form-control" name="reminder_freqdayscnt" autocomplete="off"> </div> <label class="col-md-2 PL0"> <span class="PT8 DIB">'+ZPI18N.getString("zp.days")+'</span> </label></div> </div><div class="form-group"><label class="col-sm-12 text-left MB15 MT15 PT15 ML20"><b>'+ZPI18N.getString("zp.redirectionheader")+'</b></label><div class="info-modal MB20 ML20 FL"><div><p class="PB10">'+ZPI18N.getString("zp.redirectioncontent")+'</p></div></div></div><div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.redirectsuccess")+'</label> <div class="col-sm-6"> <input name="redSuccess" id="redSuccess" autocomplete="off" class="form-control"> </div><span name="errormsg" class="dverrormsg"></span> </div><div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.redirectlater")+'</label> <div class="col-sm-6"> <input name="redLater" id="redLater" autocomplete="off" class="form-control"> </div><span name="errormsg" class="dverrormsg"></span></div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.redirectdecline")+'</label> <div class="col-sm-6"> <input  name="redDeclined" id="redDeclined" autocomplete="off" class="form-control"> </div><span name="errormsg" class="dverrormsg"></span> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.redirectcomplete")+'</label> <div class="col-sm-6"> <input  name="redCompleted" id="redCompleted" autocomplete="off" class="form-control"> </div><span name="errormsg" class="dverrormsg"></span> </div> </div> </div></div><div class="ML30"><span><a val="0" onclick="Zohosign.expColSettings()" id="setting_lnk">'+ZPI18N.getString("zp.automation.moreoptions")+'</a></span></div> <div class="form-group DN"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" onclick="Agreements.toggleSignFlowDiv(this)" name="needsendersign" id="senderSign"><span>'+ZPI18N.getString("zp.signthedoc")+'</span></label> </div> </div> <div id="my_sign" style="display:none;" class="form-group"> <label class="control-label col-sm-3">My Sign</label> <div id="senderSignFlow" class="col-sm-6"> <label class="radio DIB MR8"><input type="radio" checked="checked" value="1" name="signature_flow"><span class="ML2">'+ZPI18N.getString("zp.first")+'</span></label> <label class="radio DIB MR8"><input type="radio" value="2" name="signature_flow"><span class="ML2">'+ZPI18N.getString("zp.last")+'</span></label> </div> </div> <div class="form-group DN"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" id="previewDoc" name="preview_document"><span>'+ZPI18N.getString("zp.previewdoc")+'</span></label> </div> </div> <div class="form-group DN"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.language")+'</label> <div class="col-sm-6"> <select id="envselect_language" name="language"></select> </div> </div> <input type="hidden" value="" id="conreqcsr" name="conreqcsr"> </form> </div><div class="embed-iframe" id="embed_iframe" style="display:none"><iframe src="" name="createDocumentResp"></iframe></div></div>',bodyFormCont:'<div class="form-horizontal pad"><form target="createDocumentResp" id="createDocumentForm" enctype="multipart/form-data" method="post" role="form"> <div class="form-group" id="files_list"> <label class="control-label col-sm-3 zp_mdt" id="file_lbl"><font>'+ZPI18N.getString("zp.file")+'</font></label></div>  <div class="form-group DN" id="template_grp"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.selecttemplate")+'</font></label><div class="col-sm-6"><select id="templates"><option value="0">'+ZPI18N.getString("zp.select")+'</option></select></div></div>   <div id="selectDocType" style="" class="form-group DN"> <label class="control-label col-sm-3 zp_mdt"><font>Doc Type</font></label> <div class="col-sm-6"> <label class="radio DIB MR8"><input checked="checked" value="1" type="radio" name="docType"><span class="ML2">PDF</span></label> <label class="radio DIB MR8"><input value="2" id="docTypeRadio" type="radio" name="docType"><span class="ML2">'+ZPI18N.getString("zp.docx")+'</span></label></div></div>  <div class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.reciepents")+'</font></label> <div class="col-sm-6" id="recp"> <input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="recipients" id="recpList" class="form-control" autocomplete="off"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</label> <div class="col-sm-6"> <input placeholder="'+ZPI18N.getString("zp.entercommalist")+'" name="email_copies_to" id="copyList" autocomplete="off" class="form-control"> </div> </div> <div class="form-group" id="documentNameDiv"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.name")+'</font></label> <div class="col-sm-6"> <input name="document_name" id="document_name" autocomplete="off" class="form-control"> </div> </div> <div class="form-group"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.message")+'</label> <div class="col-sm-6"> <textarea rows="5" class="form-control" name="document_message" id="document_message" fieldtype="3"></textarea> </div> </div> <div class="form-group"><label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.folder")+'</font></label> <div class="col-sm-6"><select onchange=Files.clearErrmsg("companycategory_err") placeholder="'+ZPI18N.getString("Select")+'" id="agrselect_Cat" class="" tabindex="-1"></select><input type="name" style="display: none;" class="form-control" id="hrnewCategory" autocomplete="off"></div> <div class="col-sm-3" id="cancel_hrCat_btn" style="display:none"> <a href="javascript:void(0)" onclick="Zohosign.cancelnewCategory();" class="btn btn-default btn-sm MT5">'+ZPI18N.getString("zp.cancel")+'</a> </div> </div> <div id="moreSettings" class="zp_flsMrst DN"><div class="form-group"><label class="col-sm-12 text-left MT15 PT15"><b>'+ZPI18N.getString("zp.automation.options")+'</b></label></div><div class="form-group PL20"> <label class="control-label col-sm-3"><label class="checkbox DIB"><input type="checkbox" id ="showExpiryOptions"  name="showExpiryOptions" onclick="Zohosign.showExpiryOptions(this)"><span>Expiration Date</span></label></label></div><div class="form-group DN PL40" id ="datefieldOptions"><label class="control-label col-sm-4"><span class="inlRadio"><label class="radio"><input type="radio" name="datelookup" id="datelookupid" onclick="Zohosign.showDateLookup(this)"><span>Date Lookup</span></label><label class="radio"><input type="radio" name="datelookup" id="expdateid"  value="1" onclick="Zohosign.showDateLookup(this)"><span>Date</span></label></span></label></div><div class="form-group DN zp_eSgMlt" id="deadlinegrp"><label class="control-label">'+ZPI18N.getString("zp.selectdatelookup")+'</label><div><input name="deadlinedays" id="deadlinedays" autocomplete="off" placeholder="0" type="text" class="form-control"></div><div><span class="MR10">Days After</span><select style="width: 150px;" class="select2-offscreen" tabindex="-1" id="dateFieldOpt"></select></div></div><div class="form-group zp_eSgMlt DNI" id="deadlineLabel"><div class="zp_flsDt"><input name="deadline" id="deadline" autocomplete="off" onclick="Calendar.setUpCalendar(event,this)" caltype="popup" placeholder="Choose Date" type="text"><i class="IC-CL-02"></i></div></div><div class="form-group PL20"><label class="col-sm-3"><label class="checkbox DIB"><input type="checkbox" name="reminder" id="reminder_check" onclick="Zohosign.setDaysForReminder()"><span>'+ZPI18N.getString("zp.reminder")+'</span></label></label></div><div class="form-group zp_eSgMlt DN" id="reminder_freq"><label class="control-label">'+ZPI18N.getString("zp.sendreminderonce",new Array(""))+'</label><div><input name="reminder_freqdayscnt" autocomplete="off"></div><div><span>'+ZPI18N.getString("zp.days")+'</span></div></div><div class="form-group PL20"><label class="control-label col-sm-5"><label class="checkbox DIB"><input type="checkbox" name="synctohrfiles" onclick="Zohosign.showOptions(this)"><span class="ML2">'+ZPI18N.getString("zp.addtohrfiles",new Array(""))+'</span></label></label></div><div class="form-group PL40 DNI" id="synctypeOptions"><label class="control-label col-sm-6"><span class="inlRadio"><label class="radio"><input type="radio" name="optchosdrdbtn" id="optrecordbtn" value="1" onclick="Zohosign.showEmployeeLookup(this)"> <span class="MR10 ML5">'+ZPI18N.getString("zp.recordowner")+'</span></label><label class="radio"><input type="radio" name="optchosdrdbtn" id="optotherbtn" onclick="Zohosign.showEmployeeLookup(this)"><span class="MR10 ML5">'+ZPI18N.getString("zp.employeelookup")+'</span></label></span></label></div><div id="hrfileoptdiv" class="form-group DN PL40"><label class="control-label col-sm-4">'+ZPI18N.getString("zp.selectlookup")+'</label><div class="col-sm-4"><select id="hrfileopt" tabindex="-1" class="select2-offscreen"></select></div></div><div class="form-group DN PL20" id="formFielddrpdown"><label class="control-label col-sm-4">'+ZPI18N.getString("zp.addtoformfield")+'</label><div id="addtoformfield" class="col-sm-4"><select class="select2-offscreen" tabindex="-1" id="addtoformfieldselect"></select></div></div><div class="form-group"><label class="col-sm-12 text-left MB15 MT15 PT15"><b>'+ZPI18N.getString("zp.redirectionheader")+'</b></label><div class="info-modal MB20 FL ML10 MR40"><div><p class="PB10">'+ZPI18N.getString("zp.redirectioncontent")+'</p></div></div></div><div class="form-group PL20"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.redirectsuccess")+'</label> <div class="col-sm-6"> <input name="redSuccess" id="redSuccess" autocomplete="off" class="form-control"> </div><span name="errormsg" class="dverrormsg"></span> </div><div class="form-group PL20"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.redirectlater")+'</label> <div class="col-sm-6"> <input name="redLater" id="redLater" autocomplete="off" class="form-control"> </div><span name="errormsg" class="dverrormsg"></span></div> <div class="form-group PL20"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.redirectdecline")+'</label> <div class="col-sm-6"> <input  name="redDeclined" id="redDeclined" autocomplete="off" class="form-control"> </div><span name="errormsg" class="dverrormsg"></span> </div> <div class="form-group PL20"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.redirectcomplete")+'</label> <div class="col-sm-6"> <input  name="redCompleted" id="redCompleted" autocomplete="off" class="form-control"> </div><span name="errormsg" class="dverrormsg"></span></div></div><div class="ML30"><span><a val="0" onclick="Zohosign.expColSettings()" id="setting_lnk">'+ZPI18N.getString("zp.automation.moreoptions")+'</a></span></div> <div class="form-group DN"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" onclick="Agreements.toggleSignFlowDiv(this)" name="needsendersign" id="senderSign"><span>'+ZPI18N.getString("zp.signthedoc")+'</span></label> </div> </div> <div id="my_sign" style="display:none;" class="form-group"> <label class="control-label col-sm-3">My Sign</label> <div id="senderSignFlow" class="col-sm-6"> <label class="radio DIB MR8"><input type="radio" checked="checked" value="1" name="signature_flow"><span class="ML2">'+ZPI18N.getString("zp.first")+'</span></label> <label class="radio DIB MR8"><input type="radio" value="2" name="signature_flow"><span class="ML2">'+ZPI18N.getString("zp.last")+'</span></label> </div> </div> <div class="form-group DN"> <label class="control-label col-sm-3"></label> <div class="col-sm-6"> <label class="checkbox DIB"><input type="checkbox" id="previewDoc" name="preview_document"><span>'+ZPI18N.getString("zp.previewdoc")+'</span></label> </div> </div> <div class="form-group DN"> <label class="control-label col-sm-3">'+ZPI18N.getString("zp.language")+'</label> <div class="col-sm-6"> <select id="envselect_language" name="language"></select> </div> </div> <input type="hidden" value="" id="conreqcsr" name="conreqcsr"> </form> </div><div class="embed-iframe" id="embed_iframe" style="display:none"><iframe src="" name="createDocumentResp"></iframe></div></div>',footer:'<div id="ca_footer" class="modal-footer text-left"><button onclick="Zohosign.sendDocument()" id="footer_submit" type="button" class="btn btn-primary">'+ZPI18N.getString("zp.send")+'</button><button type="button" onclick=Files.Esign.getDocumentsListPage("cancel") id="footer_close" data-dismiss="modal" class="btn btn-default">Cancel</button></div>',footerSignTemp:'<div id="ca_footer" class="modal-footer text-left"><button onclick="Zohosign.sendDocument()" id="footer_submit" type="button" class="btn btn-primary">'+ZPI18N.getString("zp.next")+'</button><button type="button" onclick=Files.Esign.getDocumentsListPage("cancel") id="footer_close" data-dismiss="modal" class="btn btn-default">Cancel</button></div>',headersetupTemp:'<h6 class="addPopTitle">'+ZPI18N.getString("zp.setupsignature")+'</h6><button aria-label="Close" data-dismiss="modal" onclick=Files.Esign.getDocumentsListPage("cancel") class="close" type="button"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button>',templateHeader:'<h6 id="documentHeader" class="addPopTitle">'+ZPI18N.getString("zp.templatename")+'</h6><button aria-label="Close" data-dismiss="modal" onclick=Files.Esign.getDocumentsListPage("cancel") class="close" id="close_btn" type="button"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button>',bodyIframe:'<div class="embed-iframe" id="embed_iframe" style="display:none"><iframe src="" name="createDocumentResp"></iframe></div>',bodyContSignTemp:'<form target="createDocumentResp" name="createDocumentResp" id="createDocumentForm" enctype="multipart/form-data" method="post" role="form" class="form-horizontal pad"><div class="form-group" id="files_list"><label class="control-label col-sm-3 zp_mdt" id="file_lbl"><font>'+ZPI18N.getString("zp.file")+'</font></label><div class="col-sm-6"></div></div><div class="form-group" id="documentNameDiv"><label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.name")+'</font></label><div class="col-sm-6"><input type="text" name="document_name" id="document_name" class="form-control" autocomplete="off"></div></div><div class="form-group" id="recp_grp"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.reciepents")+'</label><div class="col-sm-6"><label class="checkbox DIB MR5"><input type="checkbox" name="signing_order" id="signing_order"><span class="ML2">'+ZPI18N.getString("zp.zs.setsigningorder")+'</span></label><span id="addMngrBtn" onclick="Zohosign.addMngr()" class="DIB FR CP blu MT8"><i class="IC-add S12 MR5"></i> Add Manager</span><div id="managerdesc" class="ZPMxlt PSI"><i data-content="<p>'+ZPI18N.getString("zp.managerdesc")+'</p>" data-popover="true" data-html="true" data-toggle="popover" data-placement="bottom" class="IC-info S18 gry form-icon popHover" data-original-title="" title=""></i></div><div id="selectZSEmpDiv"><div class="search-cmn opn" id="selectZSEmpInpEncDiv"><div id="empdesc" style="position: absolute;left: 100%; width: 148px; margin-top: 4px;"><i data-content="<p>'+ZPI18N.getString("zp.selempdesc")+'</p>" data-popover="true" data-html="true" data-toggle="popover" data-placement="bottom" class="IC-info S18 gry popHover" data-original-title="" title="" ></i></div><input id="selectZSEmpInp" name="selectZSEmpInp" autocomplete="off" placeholder="Select employees" type="text" selectedids="" class="form-control MT15"></div></div></div><select onchange="" placeholder="'+ZPI18N.getString("Select")+'" id="signempList" class="DN" tabindex="-1"></select></div><div class="form-group zsign-cri"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.message")+'</label><div class="col-sm-6"><div class="zsign-temp-view M0I ML15I P10" contenteditable="true" name="document_message" id="document_message"></div></div></div><div class="form-group"><label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.folder")+'</font></label><div class="col-sm-6"><select onchange=Files.clearErrmsg("companycategory_err") placeholder="'+ZPI18N.getString("Select")+'" id="agrselect_Cat" class="" tabindex="-1"></select><input type="text" style="display: none;" autocomplete="off" class="select2-input form-control" id="hrnewCategory" autocomplete="off"></div><div class="col-sm-3" id="cancel_hrCat_btn" style="display:none"> <a href="javascript:void(0)" onclick="Zohosign.cancelnewCategory();" class="btn btn-default btn-sm MT5">'+ZPI18N.getString("zp.cancel")+'</a> </div></div></div> <p class="MT40 MB20 PL35 ML25"><b>'+ZPI18N.getString("zp.options")+'</b></p><div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.expirationindays")+'</label><div class="col-sm-2" id="noOfDays"> <input class="form-control" name="noOfDays" autocomplete="off"></div></div><div class="form-group"><label class="control-label col-sm-3"></label><div class="col-sm-6"><label class="checkbox DIB MR5"><input type="checkbox" name="reminder" id="reminder_check" onclick="Zohosign.setDaysForReminder()"><span class="ML2">'+ZPI18N.getString("zp.reminder")+'</span></label></div></div><div class="form-group"><div class="col-sm-10 col-sm-offset-3 MT10 DN" id="reminder_freq" ><label class="W160 FL PL0"><span class="DIB MT8">'+ZPI18N.getString("zp.sendreminderonce",new Array(""))+'</span> </label><div class="col-sm-2 PL0" id="reminder_freqdayscnt"> <input class="form-control" name="reminder_freqdayscnt" autocomplete="off"></div><label class="col-md-2 PL0"><span class="PT8 DIB">'+ZPI18N.getString("zp.days")+'</span></label></div></div></form><div class="embed-iframe" id="embed_iframe" style="display:none"><iframe src="" name="createDocumentResp"></iframe></div>',bodyemptySignTemp:'<div class="form-horizontal pad"></div><div class="embed-iframe" id="embed_iframe" style="display:none"><iframe src="" name="createDocumentResp"></iframe></div></div>',cloudElm:'<div class="col-sm-6"><div class="ZPUFile" id="err_div"><div class="ZPUlft" id="beforeUpload"><span>Attach from </span><div class="ZPCfile"><span>Desktop</span><input class="ZPFfile form-control" onchange=Files.changeOnUpload($(this).val(),"localUpload") name="envelope" id="uploadfile" type="file"></div></div> <div class="ZPUlft DN" id="afterUpload"><span id="drop_file"><span></span><i class="IC-cls-r red" onclick="Files.toggleFileFieldDisplay()"></i></span></div></div><div class="ZPMxlt PSI" id="maxPopup"></div></div>',cloudWorkflow:'<div class="col-sm-5"><div class="ZPUlft" id="beforeUpload"><span>Upload from </span><div class="ZPCfile"><span>Desktop</span><input class="ZPFfile form-control" onchange=Files.changeOnUpload($(this)[0].files,"localUploadmultiple") name="envelope" id="upload_files" type="file" multiple></div></div> <div class="ZPUlft DN" id="afterUpload"><span id="drop_file"><span></span><i class="IC-cls-r red" onclick="Files.toggleFileFieldDisplay()"></i></span></div><div class="ZPMxlt PSI" id="maxPopup"></div></div>',cloud:'<span class="dgry ML2 MR2">or</span><a onclick="Files.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl, \'ZohoSign\')">Cloud</a>',docuCompatibleExtns:["pdf","jpg","jpeg","doc","docx","png","odf","rtf","dotx","txt","tex","sxw"]},view:{header:'<h6 class="addPopTitle" id="documentHeader">'+ZPI18N.getString("zp.documentdtls")+' <div class="zp_drpbtn DNI" style="width:200px" id="showExpdropdown" onmouseleave="Zohosign.hideOtherOptions()" ><font id="send_remindBtn" onclick=ZPeople.confirm(this,"zp.zpalert","zp.confirmremind",Zohosign.sendReminder,"","","","","")>'+ZPI18N.getString("zp.sendreminder")+'</font><i id="otherDropdown" class="IC-ar-dwn" onclick="Zohosign.showOtherOptions()"></i><ul id="showOtherOptions" class="DN CP ML20 MT10 WBG"><li id="showExp">'+ZPI18N.getString("zp.extendexpiry")+'<br></li><li onclick=ZPeople.confirm(this,"zp.zpalert","zp.confirmrecall",Zohosign.cancelDocument,"","","","","");Zohosign.showOtherOptions(); id="cancelDocBtn">'+ZPI18N.getString("zp.recalldocument")+'</li></ul></div><a class="close IC-cls" data-dismiss="modal" onclick=Files.Esign.getDocumentsListPage("cancel") id="bluePrintCls"></a></h6>',bodymainContent:'<div class="Scrcont"><div class="ZPSdiv"><span class="FL"><b id="agName" class="DB MB5"></b><span id="doc_sent_date" class="dgry S12"></span></span><span class="FR"><span id="agOwner"></span><img id="senderProfile" src=""></span></div><div class="ZPSdiv"><span class="FL"><b>'+ZPI18N.getString("zp.status")+'</b></span><span class="FR"><span class="FR"><span class="DB MB5"><b id= "status"></b><i id="taskCompleted"></i></span><span id="completed_date" class="dgry S12"></span></span></span></div><div class="ZPSdiv"><span class="FL"><b>'+ZPI18N.getString("zp.expirationdate")+'</b></span><span class="FR"><b id="deadLine"></b></span></div><div class="ZPSdiv"><span class="DB"><b>'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</b></span><span class="DB ML20 MT10"><span class="DB MB5"><b id="mail_copies"></b></span></span></div><div class="ZPSdiv bn"><span class="DB"> <b>'+ZPI18N.getString("zp.message")+'</b> </span><div class="zsign-temp-view P10 zp_eScngBx" id="agr_msg"></div></div><div class="lineHdr"> <b class="DB">'+ZPI18N.getString("zp.attachments")+'</b><div id = "attachmentsData" class="attDiv"></div></div><div class="lineHdr"><div class="boxShLst"><b class="DB">'+ZPI18N.getString("zp.reciepents")+'</b><ul id ="recipientsList"></ul></div></div><div class="lineHdr"><b class="DB MB10">'+ZPI18N.getString("zp.activity")+'</b><div class="aclog_cont"><div class="aclog_detl" id="actDetails"></div></div></div></div></div>',bodyCont:'<div class="form-horizontal pad"> <div style="padding:0" class="dveSignview MB30 clearfix" id="agrmnt_dtlsview"> <h6 class="ZPbold MT0">'+ZPI18N.getString("zp.documentdtls")+'</h6> <div class="col-md-6"> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.name")+'</label> <div class="col-sm-8"> <span id="agName"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.agreementowner")+'</label> <div class="col-sm-8"> <span id="agOwner"></span></div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.datesent",new Array(""))+'</label> <div class="col-sm-8"> <span id="sentDate"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.sendemailcopiesto",new Array(""))+'</label> <div class="col-sm-8"> <span id="mail_copies" class="txttrim"></span> </div> </div> </div> <div class="col-md-6"> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.status")+'</label> <div class="col-sm-8"> <span id="status"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.datecompleted",new Array(""))+'</label> <div class="col-sm-8"> <span id="completed_date"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="control-label col-sm-4">'+ZPI18N.getString("zp.message")+'</label> <div class="col-sm-8"> <span id="agr_msg"></span> </div> </div> <div class="form-group" name = "formGrp"> <label class="checkbox DB PT10"><input type="checkbox" id ="showExpiryOptions"  name="showExpiryOptions" onclick="Zohosign.showExpiryOptions(this)"><span class="ML2"><fmt:message key="zp.expirydate" arg0="" bundle="zpeopleResource"/></span></label> </div> </div> </div> <h6><span class="ZPbold">'+ZPI18N.getString("zp.attachments")+'</span><div class="clearfix"></div></h6> <table class="table table-hover"> <thead> <tr class="TblGryBg"> <th width="500">'+ZPI18N.getString("zp.filename")+"</th> <th>"+ZPI18N.getString("zp.modifiedtime")+'</th> <th width="150"></th> </tr> </thead> <tbody id="attachments_Info"> </tbody> </table> <h6><span class="ZPbold">'+ZPI18N.getString("zp.reciepents")+'</span><div class="clearfix"></div></h6> <table class="table table-hover"> <thead> <tr class="TblGryBg"> <th>'+ZPI18N.getString("zp.reciepentname")+"</th> <th>"+ZPI18N.getString("zp.mail")+"</th> <th>"+ZPI18N.getString("zp.type")+"</th> <th>"+ZPI18N.getString("zp.reciepentorder")+"</th> <th>"+ZPI18N.getString("zp.status")+"</th> <th>"+ZPI18N.getString("zp.reciepentdelivered")+"</th> <th>"+ZPI18N.getString("zp.datecompleted",new Array(""))+'</th> </tr> </thead> <tbody id="recipientsList"> </tbody> </table> <h6><span class="ZPbold">'+ZPI18N.getString("zp.documenthistory")+'</span><div class="clearfix"></div></h6> <table class="table table-hover Vlis bgc"> <thead> <tr class="TblGryBg"> <th>'+ZPI18N.getString("zp.eventsname")+"</th> <th>"+ZPI18N.getString("zp.description")+"</th> <th>"+ZPI18N.getString("zp.date")+'</th> </tr> </thead> <tbody id="eventsList"> </tbody> </table> </div>',footer:'<div class="modal-footer text-left"><div class="FL"><button type="button" class="btn btn-default FR" data-dismiss="modal" onclick=Files.Esign.getDocumentsListPage("cancel")>'+ZPI18N.getString("zp.close")+"</button></div>"},fileId:null,emailidfield:{},fileuploadfield:{},textfield:{},dateFields:{},templateIds:{},editData:null,isFromFormView:!1,isMMerge:!1,isCachedDocumentList:!1,isCachedCatList:!1,SIGNER:"1",VIEWER:"2",APPROVER:"3",DOC_NAME:"6",DOC_MESSAGE:"7",CATID:"8",DEADLINE:"9",VALIDUNTIL:"10",REMINDER:"11",RECP:"16",EXPIRE_DAYS:"21",DOC_SUBJECT:"20",REMINDER_FREQDAYS:"22",EXPIRE_CHECK:"23",CC:"26",NOTES:"28",TEMPLATE_ID:"29",DOCTYPE:"30",EMAIL_TEMPLATE:"32",IS_SEQ:"34",LOCAL_FILEPATH:"37",FILEUPLOAD_FILEDS:"4",DOCUMENT_COUNT:"42",LOCAL_FILEPATH_ORDER:"41",FILEUPLOAD_FILEDS_ORDER:"40",TEMPLATE_FORMFIELDS_ORDER:"38",SYNCTOHRFILES:"44",HRFILE_OPT_VAL:"45",RECIPIENT_ID:"46",RECIPIENT_ORDER:"47",RECIPIENT_TYPE:"48",RECIPIENT_INFO:"49",REDSUCCESS:"51",REDLATER:"52",REDDECLINE:"53",REDCOMPLETED:"54",SHOWEXPIRYOPTIONS:"55",DATELOOKUPID:"56",EXPIRYDATEID:"57",DATEFILED:"58",DEADLINEDAYS:"59",ADDTOFILEUPLOAD:"60",APPROVE:"61",USERLISTARRAY:"64",ACTION_ID:"67",docsubject:[],docname:[],recpdtls:{},isCancel:!1,isWorkflow:!1,mailMergeId:null,docStartindex:0,documentFirescroll:!1,isMutlipleField:!1,isfromOrgFiles:!1,signFileId:"",signTemplateId:"",locationId:"",compfileId:"",esignmodule:"",reportSliderclose:!1,locId:"",entityId:"",unitId:"",departmentId:"",divisionId:"",recordAgreementList:[],scrolled:0,zsFeatureList:"",tempFirescroll:!1,templateStartindex:0,isCachedTempList:!1,actionNames:[],paymentUrl:"",hasZohosignRecord:"",hasAdobesignRecord:"",hasDocusignRecord:"",isfromFilterView:!1,activeZuidCnt:0,overAllUserList:"",userListArray:"",editSignTempId:"",zsignEtxns:["pdf","jpg","jpeg","png","doc","docx","html","htm","tex","txt","sxw","odt","rtf"],selectedRecpForm:null,ZSEmpList:{},delZSActionId:[],openCreateDocumentModal:function(mode,thisObj){Zohosign.selectedRecpForm=null,"hr"!==mode?Layout.Page.hash:Layout.Page.hash,Files.Esign.getDocumentsListPage("hr",thisObj)},openEnvModal:function(isFromFormView,isMailMerge,mode,fID,confID,thisObj){var removableElm,file_elm,pageId=Layout.Page.container;if(Zohosign.isMutlipleField=!0,Zohosign.isWorkflow=!ZPSetupCommon.isEmpty(mode)&&mode.indexOf("workflow")>-1,!Zohosign.isWorkflow){pageId.find("div#createDocumentModal").remove();pageId.find("div#createDocumentModal");"files_companyfile_listview"==Layout.Page.urlmode||"files_companyfile_view"==Layout.Page.urlmode||"files_zohosign_templatelistview"==Layout.Page.urlmode?ZPeople.BSModal.setup({id:"createDocumentModal",type:2,modalClass:"popRgtModel",headerHtml:Zohosign.add.headersetupTemp,body:Zohosign.add.bodyContSignTemp,footer:Zohosign.add.footerSignTemp}):isFromFormView?ZPeople.BSModal.setup({id:"createDocumentModal",type:2,modalClass:"popRgtModel",headerHtml:Zohosign.add.header,body:Zohosign.add.bodyFormCont,footer:Zohosign.add.footer}):ZPeople.BSModal.setup({id:"createDocumentModal",type:2,modalClass:"popRgtModel",headerHtml:Zohosign.add.header,body:Zohosign.add.bodyCont,footer:Zohosign.add.footer})}if(!isFromFormView&&Layout.Page.hash.indexOf("documentlistview")>-1&&Layout.Page.container.find("div#createDocumentModal").find("label#file_lbl").after(Zohosign.add.cloudElm),isFromFormView){if(Zohosign.isFromFormView=isFromFormView,Zohosign.isWorkflow){var formId;if("0"===(formId=Layout.Page.container.find("select#formsListAutomation").val())&&(formId=$(Layout.Page.container.find("#formsListAutomation option")[1]).val()),(Layout.Page.hash.indexOf("esign/edit-formid:")>-1||Layout.Page.hash.indexOf("esign/add")>-1||Layout.Page.hash.indexOf("workflow/list/edit")>-1||Layout.Page.hash.indexOf("workflow/list/add")>-1||Layout.Page.hash.indexOf("customaction/add")>-1||Layout.Page.hash.indexOf("customaction/edit")>-1)&&(formId=Layout.Page.hash.indexOf("workflow/list/add")>-1?Layout.Page.container.find("#wfconfigFormslist").val():Layout.Page.hash.indexOf("workflow/list/edit")>-1?AutomationCommon.getFormId():Layout.Page.hash.indexOf("customaction/add")>-1||Layout.Page.hash.indexOf("customaction/edit")>-1?AutomationCommon.getFormId():"init"===fID?Layout.Page.hash.split("edit-formid:")[1].split("/configid")[0]:Layout.Page.hash.indexOf("esign/add")>-1?Layout.Page.hash.split("add-formid:")[1]:Layout.Page.container.find("tr#"+Layout.Page.hash.split("configid:")[1]).attr("fid")),Layout.Page.container.find("#fname").select2("val",formId),Layout.Page.hash.indexOf("esign/edit-formid:")>-1||Layout.Page.hash.indexOf("workflow/list")>-1||Layout.Page.hash.indexOf("customaction/add")>-1||Layout.Page.hash.indexOf("customaction/edit")>-1){var formName;if(Layout.Page.container.find("#form_edit").hide(),Layout.Page.hash.indexOf("workflow/list/add")>-1)formName=Layout.Page.container.find("#wfconfigFormslist option[value="+formId+"]").text();else if(Layout.Page.hash.indexOf("workflow/list/edit")>-1)formName=Layout.Page.container.find("#editmode").text();else if(Layout.Page.hash.indexOf("customaction/add")>-1||Layout.Page.hash.indexOf("customaction/edit")>-1){var formInp=Layout.Page.container.find("#cActform");formName=$(formInp).siblings("div".zp_Tg).text()}else formName=Layout.Page.container.find("#fname option[value="+formId+"]").text();Layout.Page.container.find("#form_view").text(formName).show(),Layout.Page.container.find("#form_view").attr("fid",formId),Layout.Page.container.find("#form_view").attr("cid",confID)}else Layout.Page.container.find("#form_edit").show(),Layout.Page.container.find("#form_view").hide();pageId.find("#config_name,#deadline,[name=reminder_freqdayscnt],#deadlinedays,#redSuccess,#redLater,#redDeclined,#redCompleted").val(""),pageId.find("input[name=synctohrfiles]").prop("checked",!1),pageId.find("input[name=optchosdrdbtn]").prop("checked",!1),pageId.find("#hrfileopt").select2("val","Select"),pageId.find("input[name=showExpiryOptions]").prop("checked",!1),pageId.find("#reminder_check").prop("checked",!1),pageId.find("#reminder_freq").addClass("DN"),pageId.find("#datefieldOptions").addClass("DN"),pageId.find("#deadlinegrp").addClass("DN"),pageId.find("#deadlineLabel").addClass("DNI"),pageId.find("#datelookupid").prop("checked",!0),pageId.find("#templates,#recpList,#recp_type,#fTempOpt").empty(),pageId.find("#agrselect_Cat").select2("val","0"),Layout.Page.hash.indexOf("add-formid")>-1&&(pageId.find("#config_name,#deadline,[name=reminder_freqdayscnt]").val(""),pageId.find("#templates,#recpList,#recp_type,#fTempOpt").select2("val","0")),pageId.find("span#errormsg").remove(),$(pageId.find("div[name=recp_row]")[0]).siblings("div[name=recp_row]").remove(),pageId.find("#hrnewCategory,#cancel_hrCat_btn").hide(),pageId.find("#s2id_agrselect_Cat").show(),Layout.Page.container.find("#zsignShareOptListID #toInputTag").find("[ptagid=system]").remove(),pageId.find("input[name=notifyMail]").prop("checked",!1)}else void 0!=ZPForm.CURRFORM_PARAM.formId?formId=ZPForm.CURRFORM_PARAM.formId:null!=Layout.Page.container.attr("id").match(/[\d]+$/)&&(formId=Layout.Page.container.attr("id").match(/[\d]+$/).toString());Zohosign.getFormCompFields(formId,mode),(Layout.Page.hash.indexOf("add-formid:")>-1||"workflow"==mode)&&Zohosign.getTemplates(formId);var labelTxt=ZPI18N.getString("zp.file");file_elm="";var modalId=pageId.find("div#createDocumentModal");modalId.find("div#fileElm").remove(),Zohosign.isMMerge=!0,isMailMerge||(file_elm='<div class="col-sm-6" id="fileElm"> <div class=""> <select id="uploadfile" fieldtype="26" name="file_lbl">'+Zohosign.constructFormFields(Zohosign.fileuploadfield.formId)+"</select></div> </div>"),Zohosign.isWorkflow||(modalId.find("label#file_lbl").contents().last()[0].textContent=labelTxt);var option=Zohosign.constructFormFields(Zohosign.fileuploadfield.formId);Zohosign.isWorkflow||(file_elm='<div class="col-sm-6"> <div class=""> <select id="uploadfile" fieldtype="26" name="file_lbl">'+option+"</select></div> </div>"),Zohosign.isWorkflow&&pageId.find("#uploadfile").html(option).select2();var recpOption=Zohosign.constructFormFields(Zohosign.emailidfield.formId);if(Zohosign.isWorkflow)pageId.find("div#createDocumentModal").find("#recpList").html(recpOption).select2();else{var multiselin=pageId.find("div#createDocumentModal").find("#recp").find("select");0!=multiselin.length&&void 0!=multiselin||(pageId.find("div#createDocumentModal").find("#recpList").remove(),pageId.find("div#createDocumentModal").find("#recp").append('<select id="recpList" multiple fieldtype="26" name="recipients">'+recpOption+"</select>"))}if(Zohosign.isWorkflow){Files.uploadMode="",Zohosign.mainPageAct(!0),esign.openWorkFlowEsignModal("esignconfig");var docNameOption=Zohosign.constructFormFields(Zohosign.textfield.formId);pageId.find("div#createDocumentModal").find("#doc_msg").html(docNameOption).select2(),Zohosign.checkZSFeature(),Zohosign.zsFeatureList.approver?pageId.find("#recp_type").html("<option value='1'>"+ZPI18N.getString("zp.sign")+"</option><option value='2'>"+ZPI18N.getString("zp.view")+"</option><option value='3'>"+ZPI18N.getString("zp.approve")+"</option>").select2():pageId.find("#recp_type").html("<option value='1'>"+ZPI18N.getString("zp.sign")+"</option><option value='2'>"+ZPI18N.getString("zp.view")+"</option>").select2(),Zohosign.expColSettings(),pageId.find("#formRole").html(Zohosign.constructFormFields(Zohosign.fileuploadfield.formId)),pageId.find("#dateFieldOpt").html(Zohosign.constructFormFields(Zohosign.dateFields.formId)).select2();$("#tempRoleOptions").setPopOver({html:"",callback:NewWorkFlow.mappingCallBack,keyname:"name=list-group-item",targetId:"",multi:!0}),$("#fileRoleOptions").setPopOver({html:"",callback:NewWorkFlow.mappingCallBack,keyname:"name=list-group-item",targetId:"",multi:!0}),Object.keys(Zohosign.emailidfield.formId).length===pageId.find("[name=recp_row]").length?pageId.find("#add_recplnk").hide():pageId.find("#add_recplnk").show()}var recList=[];$.each(pageId.find("table#zp_views_records_table tbody").find("input[id='zp_view_sel_record']:checked"),function(index,elm){recList.push($(elm).closest("tr").attr("recordId"))}),0==recList&&recList.push(ZPForm.CURRFORM_PARAM.recordId),pageId.find("div#documentNameDiv").hide(),pageId.find("div#createDocumentModal").data({recList:recList});var hashFormId=Layout.Page.hash.split("formId:")[1];if($(".ERR").remove(),!Zohosign.isWorkflow)if(pageId.find("div#template_grp").hide(),void 0==hashFormId){hashFormId=Layout.Page.container[0].getAttribute("id").split("formId-")[1];pageId.find("div#createDocumentModal").data({formId:hashFormId})}else pageId.find("div#createDocumentModal").data({formId:hashFormId.substring(0,hashFormId.indexOf("/"))});pageId.find("#dateFieldOpt").html(Zohosign.constructFormFields(Zohosign.dateFields.formId)).select2(),pageId.find("#addtoformfieldselect").html(Zohosign.constructFormFields(Zohosign.fileuploadfield.formId,null,!0)).select2(),pageId.find("#formFielddrpdown").removeClass("DN"),ZPeople.Request.sendAsyncPost("/fileCabinetAction.zp",{methodName:"getEsignCongifDtls",conreqcsr:csrfToken,formId:formId},Zohosign.lookupopt)}else if(Zohosign.isFromFormView=!1,pageId.find("#formFielddrpdown").addClass("DN"),-1!==Layout.Page.hash.indexOf("documentlistview"))removableElm=pageId.find("div#createDocumentModal").find("div#err_div").parent(),file_elm=Zohosign.add.cloudElm;else{removableElm=pageId.find("div#createDocumentModal").find("span#drop_file").parent();var fileId="";fileId=thisObj,file_elm='<div class="col-sm-6"> <div class="ZPFFcus"> <span id="drop_file" class="txttrim"></span> <input name="envFile" id="uploadfile" onchange="Agreements.setFIlename(this)" class="ZPFfile form-control"> </div> </div>'}if(void 0!=removableElm&&removableElm.remove(),Layout.Page.hash.indexOf("esign/edit-formid:")>-1||!ZPSetupCommon.isEmpty(mode)&&"workflow_edit"===mode?pageId.find("div#createDocumentModal").find("h6").text(ZPI18N.getString("zp.automation.editesign")):ZPSetupCommon.isEmpty(mode)||"workflow"!==mode||pageId.find("div#createDocumentModal").find("h6").text(ZPI18N.getString("zp.automation.addesign")),pageId.find("div#createDocumentModal").data({fileId:fileId}),pageId.find("div#createDocumentModal").find("label#file_lbl").after(file_elm),Zohosign.isFromFormView){pageId.find("div#createDocumentModal").find("#recpList option:first-child").attr("selected","selected"),ZPSetupCommon.isEmpty(file_elm)||pageId.find("div#createDocumentModal").find("label#file_lbl").parent().find("select").select2(),pageId.find("div#selectDoc").remove();var docType='<div id="selectDoc" style="" class="form-group"> <label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.sendfrom",new Array(""))+'</font></label> <div class="col-sm-6"> <label class="radio DIB MR8" onclick=Agreements.showFilesElm("document")><input checked="checked" value="1" type="radio" name="esign"><span class="ML2">'+ZPI18N.getString("zp.signoptnfromform")+'</span></label> <label class="radio DIB MR8" onclick=Agreements.showFilesElm("document") ><input value="2" id="from_mm" type="radio" name="esign"><span class="ML2">'+ZPI18N.getString("zp.mmerge")+'</span></label> </div> </div><div class="form-group DN" id="file_format"><label class="control-label col-sm-3 zp_mdt"><font>'+ZPI18N.getString("zp.selectformat")+'</font></label> <div class="col-sm-8"><div class="inlRadio"><label class="radio tagbgmail" onclick=MMtemplte.showViewType("1")><input name="1" checked="" id="select_pdf" type="radio"><span>PDF</span></label> <label class="radio tagbgmail" onclick=MMtemplte.showViewType("2")><input name="1" type="radio"><span>DOCX</span></label> </div></div><div></div></div>';pageId.find("form#createDocumentForm").prepend(docType),Zohosign.isWorkflow?MMtemplte.constructTemplateList("workflow",formId,"1"):MMtemplte.constructTemplateList("form",null,null,null,"document",!0),pageId.find("div#createDocumentModal").find("#recpList").parent().find("select").select2();var $eventSelect=pageId.find("div#createDocumentModal").find("#recpList").parent().find("select");$eventSelect.select2(),Zohosign.selectedRecpForm=[],Zohosign.selectedRecpForm=pageId.find("div#createDocumentModal").find("#recpList").val(),$eventSelect.on("change.select2",function(e){if(void 0!=e.added)Zohosign.selectedRecpForm.push(e.added.id);else if(void 0!=e.removed){const index=Zohosign.selectedRecpForm.indexOf(e.removed.id);index>-1&&Zohosign.selectedRecpForm.splice(index,1)}}),pageId.find("div#documentNameDiv").show(),pageId.find("#document_name").val(""),pageId.find(".zsign-doc").length>0&&pageId.find("#multiple_files").remove()}else{fileId="";var fileName="";fileId=thisObj,"files_companyfile_listview"==Layout.Page.urlmode||"files_companyfile_view"==Layout.Page.urlmode||"files_zohosign_templatelistview"==Layout.Page.urlmode?(Zohosign.addMngr(!0),Zohosign.templateInit(),Zohosign.sortZSRecp(),fileName=pageId.find("div#comp_fileListing").find("ul[fileID="+fileId+"]").attr("fileName"),"files_zohosign_templatelistview"==Layout.Page.urlmode&&(fileName=$(pageId.find("div#signtemplate_list").find("div[id="+fileId+"]").find("span")[0]).text())):fileName=pageId.find("div#hr_allfileList").find("ul[fileID="+fileId+"]").attr("fileName"),pageId.find("span#drop_file").text(fileName),!ZPeople.isChinaSetup&&Layout.Page.hash.indexOf("documentlistview")>-1&&pageId.find("div#createDocumentModal").find("input#uploadfile").parent().after(Zohosign.add.cloud)}(Zohosign.isFromFormView||Layout.Page.hash.indexOf("files/fileView/documentlistview")>-1&&0===pageId.find("div#s2id_search_cat").length||0===pageId.find("div#s2id_agrselect_Cat").length&&-1===Layout.Page.hash.indexOf("esign/edit-formid:"))&&(0==Object.keys(Files.newCategoryList).length?ZPeople.Request.sendAsyncPost("/fileCabinetAction.zp",{methodName:"getCategoryList",conreqcsr:csrfToken},Zohosign.openFilter):Zohosign.openFilter(Files.newCategoryList)),(Layout.Page.hash.indexOf("esign/edit-formid:")>-1||Layout.Page.hash.indexOf("workflow/list/add")>-1||"workflow"==mode||"workflow_edit"==mode)&&(ZPeople.Request.sendAsyncPost("/fileCabinetAction.zp",{methodName:"getEsignCongifDtls",conreqcsr:csrfToken,formId:formId},Zohosign.lookupopt),pageId.find("#addtoformfieldselect").html(Zohosign.constructFormFields(Zohosign.fileuploadfield.formId,null,!0)).select2(),pageId.find("#formFielddrpdown").removeClass("DN")),Zohosign.isWorkflow&&(Zohosign.isCancel=!1,(Layout.Page.hash.indexOf("edit-formid:")>-1||"workflow_edit"===mode)&&null!=Zohosign.editData?("init"===fID&&pageId.find("#form_view").text(decodeHTML(esign.formsList[1][formId])),$.each(Zohosign.editData[1],function(index,eachData){if(("workflow_edit"===mode?confID:Layout.Page.hash.split("configid:")[1])==eachData.cid){pageId.find("#config_name").val(ZPeople.decodeTxt(eachData.name));var info=eachData.info;if(info.hasOwnProperty(Zohosign.TEMPLATE_ID)&&(Zohosign.mailMergeId=info[Zohosign.TEMPLATE_ID]),info.hasOwnProperty(Zohosign.RECIPIENT_INFO)){for(var recInfo=JSON.parse(info[Zohosign.RECIPIENT_INFO]),t=0;t<recInfo.length;t++)for(var i=0;i<recInfo.length;i++)if(t==recInfo[i][Zohosign.RECIPIENT_ORDER]){0!==t&&Zohosign.addRecp();var currRow=$(pageId.find("[name='recp_row']")[recInfo[i][Zohosign.RECIPIENT_ORDER]]);currRow.find("#recpList").select2("val",recInfo[i][Zohosign.RECIPIENT_ID]),currRow.find("#recp_type").select2("val",recInfo[i][Zohosign.RECIPIENT_TYPE])}}else info.hasOwnProperty(Zohosign.RECP)&&(info[Zohosign.RECP].split(",").length>1?$.each(info[Zohosign.RECP].split(","),function(index,recp){0!==index&&Zohosign.addRecp();var currRow=$(pageId.find("[name='recp_row']")[index]);currRow.find("#recpList").select2("val",recp),currRow.find("#recp_type").select2("val",Zohosign.SIGNER)}):(pageId.find("div[name='recp_row']").find("#recpList").select2("val",info[Zohosign.RECP]),pageId.find("#recp_type").select2("val",Zohosign.SIGNER))),info.hasOwnProperty(Zohosign.CC)&&(info[Zohosign.CC].split(",").length>1?$.each(info[Zohosign.CC].split(","),function(index,cc){(0!==index||info.hasOwnProperty(Zohosign.RECP))&&Zohosign.addRecp();var currRow=$(pageId.find("[name='recp_row']")[index]);currRow.find("#recpList").select2("val",cc),currRow.find("#recp_type").select2("val",Zohosign.VIEWER)}):(Zohosign.addRecp(),pageId.find("div[name='recp_row']:last").find("#recpList").select2("val",info[Zohosign.CC]),info.hasOwnProperty(Zohosign.CC)&&pageId.find("div[name='recp_row']:last").find("#recp_type").select2("val",Zohosign.VIEWER))),info.hasOwnProperty(Zohosign.APPROVE)&&(info[Zohosign.APPROVER].split(",").length>1?$.each(info[Zohosign.APPROVE].split(","),function(index,appr){(0!==index||info.hasOwnProperty(Zohosign.APPROVER))&&Zohosign.addRecp();var currRow=$(pageId.find("[name='recp_row']")[index]);currRow.find("#recpList").select2("val",appr),currRow.find("#recp_type").select2("val",Zohosign.APPROVER)}):(Zohosign.addRecp(),pageId.find("div[name='recp_row']:last").find("#recpList").select2("val",info[Zohosign.APPROVE]),info.hasOwnProperty(Zohosign.APPROVE)&&pageId.find("div[name='recp_row']:last").find("#recp_type").select2("val",Zohosign.APPROVER)));if(pageId.find("#fname").select2("val",AutomationCommon.getFormId()),info.hasOwnProperty(Zohosign.DOC_NAME)){var docVal=info[Zohosign.DOC_NAME];$.each(Zohosign.textfield.formId,function(fcId,value){docVal.indexOf(fcId)>-1&&(docVal=docVal.replaceAll(fcId,"${"+value+"}"))}),pageId.find("#document_name").val(docVal)}if(info.hasOwnProperty(Zohosign.DOC_SUBJECT)){var docSubject=info[Zohosign.DOC_SUBJECT];$.each(Zohosign.textfield.formId,function(fcId,value){docSubject.indexOf(fcId)>-1&&(docSubject=docSubject.replaceAll(fcId,"${"+value+"}"))})}if(info.hasOwnProperty(Zohosign.NOTES)&&pageId.find("#fTempOpt").select2("val",info[Zohosign.NOTES]),info.hasOwnProperty(Zohosign.CATID)&&(void 0==Files.newCategoryList?ZPeople.Request.send("/fileCabinetAction.zp",{methodName:"getCategoryList",conreqcsr:csrfToken},Zohosign.openFilter,info[Zohosign.CATID]):Zohosign.openFilter(Files.newCategoryList,null,info[Zohosign.CATID])),info.hasOwnProperty(Zohosign.SYNCTOHRFILES)){if(pageId.find("input[name='synctohrfiles']").prop("checked",info[Zohosign.SYNCTOHRFILES]),info.hasOwnProperty(Zohosign.HRFILE_OPT_VAL))if(pageId.find("#synctypeOptions").removeClass("DNI"),1==info[Zohosign.HRFILE_OPT_VAL].length)pageId.find("#optrecordbtn").prop("checked",!0),pageId.find("#hrfileoptdiv").addClass("DN");else{pageId.find("#hrfileoptdiv").removeClass("DN"),pageId.find("#optotherbtn").prop("checked",!0);var otherdetails=info[Zohosign.HRFILE_OPT_VAL]}ZPeople.Request.sendAsyncPost("/fileCabinetAction.zp",{methodName:"getEsignCongifDtls",conreqcsr:csrfToken,formId:formId},Zohosign.lookupopt,otherdetails)}else pageId.find("#hrfileoptdiv").addClass("DN"),pageId.find("#synctypeOptions").addClass("DNI");if(pageId.find("#deadlinegrp").addClass("DN"),pageId.find("#deadlineLabel").addClass("DNI"),pageId.find("#datefieldOptions").addClass("DN"),void 0!=Zohosign.dateFields.formId&&pageId.find("#dateFieldOpt").html(Zohosign.constructFormFields(Zohosign.dateFields.formId)),info.hasOwnProperty(Zohosign.DEADLINE)&&(pageId.find('[name="showExpiryOptions"]').prop("checked",!0),pageId.find("input#deadline").removeClass("DN"),pageId.find("input#deadline").val(info[Zohosign.DEADLINE].replace("23:59:59","")),pageId.find("#deadlineLabel").removeClass("DNI"),pageId.find("#datefieldOptions").removeClass("DN"),pageId.find("#expdateid").prop("checked",!0)),info.hasOwnProperty(Zohosign.DATELOOKUPID)&&(pageId.find('[name="showExpiryOptions"]').prop("checked",!0),pageId.find("#datelookupid").prop("checked",!0),pageId.find("#datefieldOptions").removeClass("DN"),pageId.find("#deadlinegrp").removeClass("DN"),info.hasOwnProperty(Zohosign.DEADLINEDAYS)&&pageId.find("#deadlinedays").val(info[Zohosign.DEADLINEDAYS]),info.hasOwnProperty(Zohosign.DATEFILED)&&pageId.find("#dateFieldOpt").select2("val",info[Zohosign.DATEFILED])),info.hasOwnProperty(Zohosign.REMINDER_FREQDAYS)&&0!=info[Zohosign.REMINDER_FREQDAYS]&&(pageId.find("[name=reminder_freqdayscnt]").val(info[Zohosign.REMINDER_FREQDAYS]),pageId.find("#reminder_check").prop("checked",!0),pageId.find("#reminder_freq").removeClass("DN")),info.hasOwnProperty(Zohosign.EMAIL_TEMPLATE)&&Zohosign.getTemplates(formId,info[Zohosign.EMAIL_TEMPLATE]),info.hasOwnProperty(Zohosign.IS_SEQ)&&pageId.find("input[name=signing_order]").prop("checked",info[Zohosign.IS_SEQ]),Layout.Page.container.find("#zsignShareOptListID #toInputTag").find("[ptagid=system]").remove(),void 0!=info[Zohosign.USERLISTARRAY]){Zohosign.constructMailId(info[Zohosign.USERLISTARRAY],Layout.Page.container.find("#zsignShareOptListID #toInputTag"));Layout.Page.container.find("#notify_Mail").prop("checked",!0)}if(Zohosign.displayUsers(),info.hasOwnProperty(Zohosign.DOCUMENT_COUNT))for(var w=0;w<info[Zohosign.DOCUMENT_COUNT];w++){if(info.hasOwnProperty(Zohosign.LOCAL_FILEPATH_ORDER)){var lfo=JSON.parse(info[Zohosign.LOCAL_FILEPATH_ORDER]);for(t=0;t<lfo.length;t++)lfo[t].order==w&&Zohosign.addFileFields(lfo[t].filePath)}if(1==info.hasOwnProperty(Zohosign.TEMPLATE_FORMFIELDS_ORDER)){var tfo=JSON.parse(info[Zohosign.TEMPLATE_FORMFIELDS_ORDER]);for(t=0;t<tfo.length;t++)if(tfo[t].order==w){var itemplateIdval=tfo[t].templateIdval;Zohosign.addTemplate("templates",itemplateIdval)}}if(info.hasOwnProperty(Zohosign.FILEUPLOAD_FILEDS_ORDER)){var ffo=JSON.parse(info[Zohosign.FILEUPLOAD_FILEDS_ORDER]);for(t=0;t<ffo.length;t++)if(ffo[t].order==w){var ifilepathval=ffo[t].filepathval;Zohosign.addTemplate("filepath",ifilepathval)}}}else 1==info.hasOwnProperty(Zohosign.TEMPLATE_ID)&&info[Zohosign.TEMPLATE_ID].toString().split(",").length>0&&$.each(info[Zohosign.TEMPLATE_ID].toString().split(","),function(index,tempid){Zohosign.addTemplate("templates",tempid)});info.hasOwnProperty(Zohosign.REDSUCCESS)&&pageId.find("[id=redSuccess]").val(encodeURI(info[Zohosign.REDSUCCESS])),info.hasOwnProperty(Zohosign.REDLATER)&&pageId.find("[id=redLater]").val(encodeURI(info[Zohosign.REDLATER])),info.hasOwnProperty(Zohosign.REDDECLINE)&&pageId.find("[id=redDeclined]").val(encodeURI(info[Zohosign.REDDECLINE])),info.hasOwnProperty(Zohosign.REDCOMPLETED)&&pageId.find("[id=redCompleted]").val(encodeURI(info[Zohosign.REDCOMPLETED])),info.hasOwnProperty(Zohosign.ADDTOFILEUPLOAD)&&pageId.find("#addtoformfieldselect").select2("val",info[Zohosign.ADDTOFILEUPLOAD])}})):(pageId.find("#hrfileoptdiv").addClass("DN"),pageId.find("#synctypeOptions").addClass("DNI"))),pageId.find("#templates").hide()},constructMailId:function(configJson,tagInputObj){var dispValJson=$.extend({},TemplateCommon.keyPairIdJson,{constantVal:{id:"constantVal",dispVal:ZPI18N.getString("zp.contactemail")}}),keyNameList=[dispValJson.system.id];$.each(keyNameList,function(i,keyVal){configJson.hasOwnProperty(keyVal)&&$.each(configJson[keyVal],function(key,val){var parentJson=dispValJson[keyVal],parentTagJson={id:parentJson.id,value:parentJson.dispVal},childTagJson={id:key,value:val,attr:key};$(tagInputObj).tagInput(parentTagJson,[childTagJson],TemplateCommon.newConstant)}),TemplateCommon.newConstant($(tagInputObj))})},mappingCallBack:function(getLiObj,params){var getThis=$(getLiObj).find("[name=mOpt]"),workflowType=$(getThis).closest("[actname]").attr("actname"),tempId=$(getThis).attr("id"),tempName=$(getThis).text(),isAdd=-1!==$(getThis).closest("li").attr("class").indexOf("sel"),mapTable=$(getThis).closest("[actname]").find("[name=mappingTable]"),mapName=$(getThis).closest("[actname]").attr("actname"),method=NewWorkFlow.getMethodOfAction(workflowType,tempId);if(!0===isAdd)if(Zohosign.isfromOrgFiles)Layout.Page.container.find("#empRoleOptions").parent().find(".dvfrmlist").children().hasClass("taggroup")?Layout.Page.container.find("#empRoleOptions").parent().find(".dvfrmlist").find(".taggroup").append('<span id="'+tempId+'" val ="tempid" class="spntag" attr="'+tempId+'">'+AutomationCommon.htmlEncode(tempName)+'<i name="closeIc" class="IC-cls-1px" onclick = "Files.deleteSelection(this)"></i></span>'):(Layout.Page.container.find("#empRoleOptions").parent().find(".dvfrmlist").append('<div ptagid="employeeNames" class="taggroup">'),Layout.Page.container.find("#empRoleOptions").parent().find(".dvfrmlist").find(".taggroup").append('<span id="'+tempId+'" val ="tempid" class="spntag" attr="'+tempId+'">'+AutomationCommon.htmlEncode(tempName)+'<i name="closeIc" class="IC-cls-1px" onclick = "Files.deleteSelection(this)"></i></span>'));else if(Zohosign.isMutlipleField)!Layout.Page.container.find(".zsign-doc").length>0&&(Layout.Page.container.find("#tempfileform").after('<div class="zsign-doc" id ="multiple_files"></div>'),$("#multiple_files").sortable(),$("#multiple_files").disableSelection()),""!=getLiObj.firstChild.getAttribute("val")&&null!=getLiObj.firstChild.getAttribute("val")?Layout.Page.container.find(".zsign-doc").append('<span id="'+tempId+'" val ="tempid"><b>'+AutomationCommon.htmlEncode(tempName)+'</b><i class="IC-cls" onclick = "Files.deleteSelection(this)"></i></span>'):Layout.Page.container.find(".zsign-doc").append('<span id="'+tempId+'"><b>'+AutomationCommon.htmlEncode(tempName)+'</b><i class="IC-cls" onclick = "Files.deleteSelection(this)"></i></span>');else{"WEBHOOK"===mapName&&$(mapTable).find("tr").remove();var trRow=$('<tr><td width="20"></td><td><a name="mappingRow" onclick="'+method+'" class="lblname">'+AutomationCommon.htmlEncode(tempName)+'</a></td><td width="15%"><div class="dvlist-action"> <a class="ML15 ZPtitle" title="Delete"><span class="IC-delete" onclick="NewWorkFlow.removeActionListRow(this)"></span></a> </div></td></tr>');trRow.attr("id",tempId+"_row"),trRow.find("[name=mappingRow]").attr("templateid",tempId),mapTable.append(trRow)}else Zohosign.isMutlipleField||Zohosign.isfromOrgFiles?Files.deleteSelection(this,!0):$(mapTable).find("#"+tempId+"_row").remove()},wfEdit:function(wfFormId,confID,triggerEdit){triggerEdit?Zohosign.openEnvModal(!0,!1,"workflow_edit",wfFormId,confID):esign.getConfigList("wfedit",wfFormId,confID)},isDuplicateRecp:function(value,thisObj){$.each(Zohosign.recpdtls,function(key,val){ZPSetupCommon.isEmpty(value)||value!==val||$(thisObj).select2("val","0")})},getTemplates:function(formId,tempId){var params={mode:esign.MODE,formId:formId.toString(),method:"getTemplates",conreqcsr:csrfToken};$.ajax({url:"/getTemplates.zp",type:"POST",data:params,success:function(datas){ZPSetupCommon.isEmpty(tempId)||(datas.templateId=tempId),TemplateCommon.setFormTemplates(datas)}})},getFormCompFields:function(formId,mode){var emailidfieldArr={},fileuploadfieldArr={},textField={},dateFields={},formCompData=ZPForm.FORM_COMPONENT_DATA[formId];(void 0===formCompData||Zohosign.isWorkflow)&&$.ajax({type:"POST",async:!1,url:"/formAction.zp",data:{mode:"getFormComponents",conreqcsr:csrfToken,formId:formId},success:function(data){formCompData=data}});var formComp=formCompData.message;$.each(formComp.formComponentDetails,function(index){this.isTabular||($.each(this.column1,function(index,fieldData){if(this.fieldType==ZPForm.Field.EMAIL_ADDRESS){var fcId=this.formComponentId;emailidfieldArr[fcId]=ZPeople.decodeTxt(this.displayName)}else if(this.fieldType==ZPForm.Field.FILE_UPLOAD){fcId=this.formComponentId;fileuploadfieldArr[fcId]=ZPeople.decodeTxt(this.displayName)}else if(this.fieldType==ZPForm.Field.TEXT){fcId=this.formComponentId;textField[fcId]=ZPeople.decodeTxt(this.displayName)}else if(this.fieldType==ZPForm.Field.DATE){fcId=this.formComponentId;dateFields[fcId]=ZPeople.decodeTxt(this.displayName)}}),$.each(this.column2,function(index,fieldData){if(this.fieldType==ZPForm.Field.EMAIL_ADDRESS){var fcId=this.formComponentId;emailidfieldArr[fcId]=ZPeople.decodeTxt(this.displayName)}else if(this.fieldType==ZPForm.Field.FILE_UPLOAD){fcId=this.formComponentId;fileuploadfieldArr[fcId]=ZPeople.decodeTxt(this.displayName)}else if(this.fieldType==ZPForm.Field.TEXT){fcId=this.formComponentId;textField[fcId]=ZPeople.decodeTxt(this.displayName)}else if(this.fieldType==ZPForm.Field.DATE){fcId=this.formComponentId;dateFields[fcId]=ZPeople.decodeTxt(this.displayName)}}))}),Zohosign.emailidfield.formId=emailidfieldArr,Zohosign.fileuploadfield.formId=fileuploadfieldArr,Zohosign.textfield.formId=textField,Zohosign.dateFields.formId=dateFields},constructFormFields:function(dataObj,htmlObj,isSelect){if(ZPSetupCommon.isEmpty(dataObj))return"";var option="";return isSelect&&(option="<option value='0' selected='selected'>"+ZPI18N.getString("zp.select")+"</option>"),Object.keys(dataObj).length>0&&$.each(dataObj,function(key,value){option+='<option value="'+key+'">'+value+"</option>"}),option},changeConfiguration:function(){var pageId=Layout.Page.container,formId=pageId.find("#fname").val();pageId.find("#templates").html(""),MMtemplte.constructTemplateList("workflow",formId,"1"),Zohosign.getFormCompFields(formId,"workflow"),pageId.find("#recpList").html(Zohosign.constructFormFields(Zohosign.emailidfield.formId)),pageId.find("#document_name").html(Zohosign.constructFormFields(Zohosign.textfield.formId)),pageId.find("#document_name").val(""),pageId.find(".zsign-doc").length>0&&pageId.find("#multiple_files").remove(),pageId.find("#formRole").val(),pageId.find("#dateFieldOpt").val(),pageId.find("#agrselect_Cat").select2("val","select"),pageId.find("div[name=recp_row]").remove(),Zohosign.addRecp(null,null,!0),Object.keys(Zohosign.emailidfield.formId).length===pageId.find("[name=recp_row]").length?pageId.find("#add_recplnk").hide():pageId.find("#add_recplnk").show(),ZPeople.Request.sendAsyncPost("/fileCabinetAction.zp",{methodName:"getEsignCongifDtls",conreqcsr:csrfToken,formId:formId},Zohosign.lookupopt),TemplateCommon.getTemplates(),pageId.find("#formRole").html(Zohosign.constructFormFields(Zohosign.fileuploadfield.formId)),pageId.find("#uploadfile").html(Zohosign.constructFormFields(Zohosign.fileuploadfield.formId)).select2(),pageId.find("#dateFieldOpt").html(Zohosign.constructFormFields(Zohosign.dateFields.formId)).select2()},saveWorkflowConf:function(){ZPeople.Request.send("/zohoSignActions.zp",{action:"saveWorkFlowConfig"},this.constructDocumentList)},openFilter:function(categoryList,params,catId){var pageId=Layout.Page.container,createAgr=$("div#createDocumentModal"),categoriesOpt="<option value='select' selected='selected'>"+ZPI18N.getString("zp.select")+"</option>";newcategoryList=categoryList[1],void 0!=newcategoryList?$.each(newcategoryList,function(index,categoriesObj){ZPSetupCommon.isEmpty(categoriesObj.CatName)||("General"===categoriesObj.CatName||"general"===categoriesObj.CatName||categoriesObj.CatName===ZPI18N.getString("zp.general")?categoriesOpt+="<option value='"+categoriesObj.CatID+"'>"+ZPI18N.getString("zp.general")+"</option>":categoriesOpt+="<option value='"+categoriesObj.CatID+"'>"+categoriesObj.CatName+"</option>")}):$.each(categoryList,function(index,categoriesObj){"General"===categoriesObj||"general"===categoriesObj||categoriesObj===ZPI18N.getString("zp.general")?categoriesOpt+="<option value='"+index+"'>"+ZPI18N.getString("zp.general")+"</option>":categoriesOpt+="<option value='"+index+"'>"+categoriesObj+"</option>"}),Zohosign.isCachedCatList=!0,Object.keys(Files.newCategoryList).length<=0&&$.each(newcategoryList,function(index,categoriesObj){Files.newCategoryList[categoriesObj.CatID]=categoriesObj.CatName});var selectedCatid=pageId.find("#search_cat").val(),selectedCategory=Files.newCategoryList[selectedCatid];pageId.find("select#search_cat").html(categoriesOpt),"select"==selectedCategory||null==selectedCategory?pageId.find("div#hrfilterdiv").find("select").select2():(pageId.find("div#hrfilterdiv").find(selectedCatid).select2(),pageId.find("select#search_cat").val(selectedCatid)),createAgr.find("select#agrselect_Cat").html(categoriesOpt),createAgr.find("select#agrselect_Cat").select2(),ZPSetupCommon.isEmpty(catId)||createAgr.find("select#agrselect_Cat").select2("val",catId),(isadmin||1==loginUserRoleCheck||2==loginUserRoleCheck)&&createAgr.find("div#s2id_agrselect_Cat").find("ul").after('<button class="btn btn-primary" onclick="Zohosign.shownewCategory(this)" data-toggle="modal" id="addcat_btn">'+ZPI18N.getString("zp.addcat")+"</button>")},shownewCategory:function(thisObj){var createAgr=$("div#createDocumentModal");createAgr.find("#cancel_hrCat_btn").show(),createAgr.find("#hrnewCategory").val(""),createAgr.find("#hrnewCategory").val($(".select2-drop-active input:visible").val()),$(thisObj).closest("div#select2-drop").hide(),$(".select2-drop-active").hide(),createAgr.find("#agrselect_Cat").val(""),createAgr.find("#agrselect_Cat").next("span#errormsg").remove(),createAgr.find("#hrnewCategory,#new_hrCatDIV").show(),createAgr.find("#s2id_agrselect_Cat,#hrzp_add_Cat,#hrcategory_err").hide(),$(".select2-drop-active").find("input").val("")},cancelnewCategory:function(){var createAgr=$("div#createDocumentModal");createAgr.find("#cancel_hrCat_btn,#hrnewCategory,#new_hrCatDIV,#hrcategory_err").hide(),createAgr.find("input#hrnewCategory").next("span#errormsg").remove(),createAgr.find("#s2id_agrselect_Cat,#hrzp_add_Cat").show(),createAgr.find("#agrselect_Cat").select2("val","select")},addTemplate:function(getLiObj,tempId){var tempName;!Layout.Page.container.find(".zsign-doc").length>0&&(Layout.Page.container.find("#tempfileform").after('<div class="zsign-doc" id ="multiple_files"></div>'),$("#multiple_files").sortable(),$("#multiple_files").disableSelection()),"templates"==getLiObj?$.each(Zohosign.templateIds,function(key,value){value.tid==tempId&&(tempName=value.fname)}):$.each(Zohosign.fileuploadfield.formId,function(key,value){key==tempId&&(tempName=value)}),"templates"==getLiObj?Layout.Page.container.find(".zsign-doc").append('<span id="'+tempId+'" val ="tempid"><b>'+AutomationCommon.htmlEncode(tempName)+'</b><i class="IC-cls" onclick = "Files.deleteSelection(this)"></i></span>'):Layout.Page.container.find(".zsign-doc").append('<span id="'+tempId+'"><b>'+AutomationCommon.htmlEncode(tempName)+'</b><i class="IC-cls" onclick = "Files.deleteSelection(this)"></i></span>')},clearFileUpload:function(){Layout.Page.container.find("#upload_files").val("")},setZSFeatureList:function(data){Zohosign.zsFeatureList=data[1].features},setZohoSignPaymentURL:function(data){Zohosign.paymentUrl=data[1].payment_url},checkZSFeature:function(){""==Zohosign.zsFeatureList&&ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",{action:"getZSignFeatureList",conreqcsr:csrfToken},Zohosign.setZSFeatureList)},getZSPaymentURL:function(){""==Zohosign.paymentUrl&&ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",{action:"getSubscriptionDetails",conreqcsr:csrfToken},Zohosign.setZohoSignPaymentURL)},sendDocument:function(){Zohosign.isMutlipleField=!1,innerForm=!1;var pageId=Layout.Page.container;$(".ERR").remove();var formData=new FormData;if("files_companyfile_listview"==Layout.Page.urlmode||"files_companyfile_view"==Layout.Page.urlmode||"files_zohosign_templatelistview"==Layout.Page.urlmode){formData.append("isTemplate",!0),formData.append("signTemplateId",Zohosign.editSignTempId),formData.append("signing_order",pageId.find("[name=signing_order]").is(":checked"));var documentMessage=""}var createZohosign=pageId.find("div#createDocumentModal");documentMessage="files_companyfile_listview"==Layout.Page.urlmode||"files_companyfile_view"==Layout.Page.urlmode||"files_zohosign_templatelistview"==Layout.Page.urlmode?pageId.find("#document_message").text():pageId.find("#document_message").val();pageId.find("#recp_grp #fTempOpt").val();var documentName=pageId.find("#document_name").val(),doc=Layout.Page.container.find("#uploadfile"),configName=pageId.find("#config_name").val(),recpList=pageId.find("#recpList").val();null!=Zohosign.selectedRecpForm&&(recpList=Zohosign.selectedRecpForm);var expirationDays,dateField=pageId.find("#dateFieldOpt").val(),automation_message=pageId.find("#recp_grp #fTempOpt").val(),addtofileupload=pageId.find("#addtoformfieldselect").val(),docNameIds="",ccList=pageId.find("input#copyList").val(),redSuccess=pageId.find("input#redSuccess").val(),redCompleted=pageId.find("input#redCompleted").val(),redDeclined=pageId.find("input#redDeclined").val(),redLater=pageId.find("input#redLater").val();if(Zohosign.isWorkflow){for(var selectedFiles,selectedFilesfromdb,fileuploadFields=[],fileuploadFieldsoriginal=[],templateFields=[],selectedFilesOrder=[],selectedFilesfromdborder=[],selectedcloudOrder=[],templateoriginalFields=[],selectedcloudFilesarray=[],selectedFilesfromdbarray=[],multiplefiles=Layout.Page.container.find("#multiple_files").find("span"),multiplefilesDetails=Layout.Page.container.find("#multiple_files").find("span").find("b"),document_length=multiplefiles.length,i=0,l=multiplefiles.length;i<l;i++){var selfilename=multiplefilesDetails[i].textContent||multiplefilesDetails[i].innerText;selectedFilesfromdb=Layout.Page.container.find(multiplefilesDetails[i]).data("filename"),selectedFiles=Layout.Page.container.find(multiplefiles[i]).data("filedetails");var selectedcloudFiles=Layout.Page.container.find(multiplefiles[i]).data("cloudfileDetails");if(void 0!=selectedFiles){formData.append("selectedFiles",selectedFiles);var selectedFilesOrderval={};selectedFilesOrderval.order=i,selectedFilesOrderval.filepathstring=Layout.Page.container.find(multiplefiles[i]).data("filedetails").name,selectedFilesOrder.push(selectedFilesOrderval)}if(void 0!=selectedcloudFiles){selectedcloudFilesarray.push(JSON.parse(selectedcloudFiles));var selectedFilescloudOrderval={};selectedFilescloudOrderval.order=i,selectedFilescloudOrderval.filepathstring=JSON.parse(Layout.Page.container.find(multiplefiles[i]).data("cloudfileDetails")).docName,selectedcloudOrder.push(selectedFilescloudOrderval)}if(void 0!=selectedFilesfromdb){var selectedFilesfromdbobjorder={};selectedFilesfromdbarray.push(selectedFilesfromdb),selectedFilesfromdbobjorder.order=i,selectedFilesfromdbobjorder.filepathstring=selectedFilesfromdb,selectedFilesfromdborder.push(selectedFilesfromdbobjorder)}var fileExtn=selfilename.substr(selfilename.lastIndexOf(".")+1,selfilename.length);if(""!=multiplefiles[i].id){var templateFieldsval={},fileFieldsval={};"tempid"==multiplefiles[i].getAttribute("val")?(templateFieldsval.order=i,templateFieldsval.templateIdval=multiplefiles[i].id,templateFields.push(templateFieldsval),templateoriginalFields.push(multiplefiles[i].id)):(fileFieldsval.order=i,fileFieldsval.filepathval=multiplefiles[i].id,fileuploadFields.push(fileFieldsval),fileuploadFieldsoriginal.push(multiplefiles[i].id))}else if(-1===Zohosign.zsignEtxns.indexOf(fileExtn.toLowerCase()))return err=!0,void pageId.find("#tempfileform").append('<div class="ERR ML15 MT2" id="errormsg">'+ZPI18N.getString("zp.zs.choosepdffile")+"</div>")}if(0==multiplefiles.length)return void pageId.find("#tempfileform").append('<div class="ERR ML15 MT2" id="errormsg">'+ZPI18N.getString("zp.zs.selectatleastonedoc")+"</div>");if(multiplefiles.length>5)return void pageId.find("#tempfileform").append('<div class="ERR ML15 MT2" id="errormsg">'+ZPI18N.getString("zp.zs.maxdocuploads")+"</div>");var dataArray=[];for(key in selectedcloudFilesarray)dataArray.push(selectedcloudFilesarray[key]);0!=dataArray.length&&(formData.append("selectedcloudFilesarray",JSON.stringify(dataArray)),formData.append("selectedcloudOrder",JSON.stringify(selectedcloudOrder))),0!=selectedFilesfromdbarray.length&&(formData.append("selectedFilesfromdbarray",JSON.stringify(selectedFilesfromdbarray)),formData.append("selectedFilesfromdborder",JSON.stringify(selectedFilesfromdborder))),0!=selectedFilesOrder.length&&formData.append("selectedFilesOrder",JSON.stringify(selectedFilesOrder))}if(formData.append("conreqcsr",csrfToken),formData.append("reminder",createZohosign.find("input#reminder_check").is(":checked")),ZPSetupCommon.isEmpty(configName)||formData.append("config_name",configName),(-1==Layout.Page.hash.indexOf("workflow")||Layout.Page.hash.indexOf("workflow")>-1||Layout.Page.hash.indexOf("customaction")>-1)&&"1"==pageId.find("input[id='expdateid']:checked").val()&&pageId.find("[name=showExpiryOptions]").is(":checked")?void 0!=(expirationDays=createZohosign.find("input#deadline").val())&&formData.append("deadline",expirationDays):void 0!=(expirationDays=createZohosign.find("div#deadline input").val())&&formData.append("deadline",expirationDays),Zohosign.isFromFormView||Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("workflow/list")>-1||Layout.Page.hash.indexOf("customaction/add")>-1||Layout.Page.hash.indexOf("customaction/edit")>-1){var noOfDays=pageId.find("#deadlinedays").val(),showExpiryOptions=pageId.find("[name=showExpiryOptions]").is(":checked");if(formData.append("showExpiryOptions",showExpiryOptions),"on"==pageId.find("input[id='datelookupid']:checked").val()&&showExpiryOptions){formData.append("datelookupid",!0),ZPSetupCommon.isEmpty(noOfDays)?formData.append("noOfDays",0):formData.append("noOfDays",noOfDays);dateField=pageId.find("#dateFieldOpt").val();formData.append("dateField",dateField)}if("1"==pageId.find("input[id='expdateid']:checked").val()&&showExpiryOptions&&formData.append("expdateid",!0),formData.append("signing_order",pageId.find("[name=signing_order]").is(":checked")),!ZPSetupCommon.isEmpty(documentName)){var index=0;$.each(Zohosign.textfield.formId,function(fcId,fieldName){documentName.indexOf("${"+fieldName+"}")>-1&&(documentName=documentName.replaceAll("${"+fieldName+"}",fcId),0!==index&&(docNameIds+=","),docNameIds+=fcId,index++)})}formData.append("docSubjectList",""),formData.append("docNameList",docNameIds)}if(!Zohosign.validation(formData)){void 0!=Zohosign.userListArray&&0!=Zohosign.userListArray.length&&formData.append("userListArray",Zohosign.userListArray),void 0!=redSuccess&&0!=redSuccess.length&&formData.append("redSuccess",redSuccess),void 0!=redCompleted&&0!=redCompleted.length&&formData.append("redCompleted",redCompleted),void 0!=redDeclined&&0!=redDeclined.length&&formData.append("redDeclined",redDeclined),void 0!=redLater&&0!=redLater.length&&formData.append("redLater",redLater),Layout.Page.container.find("#moreSettings").addClass("DN"),Zohosign.isWorkflow&&(fileuploadFields.length>0&&(formData.append("fileList",fileuploadFieldsoriginal),formData.append("fileListarray",JSON.stringify(fileuploadFields))),templateFields.length>0&&(formData.append("templateIdorder",JSON.stringify(templateFields)),formData.append("templateId",templateoriginalFields)),formData.append("document_length",document_length));var isFile=!1;if("file"===createZohosign.find("#uploadfile").attr("type")&&(doc=createZohosign.find("#uploadfile")[0].files[0],isFile=!0),isFile&&void 0!=doc)formData.append("document",doc);else if(!ZPSetupCommon.isEmpty(createZohosign.data("fileId"))){var fileID=createZohosign.data("fileId");Zohosign.compfileId=fileID,formData.append("fileId",fileID),Files.uploadMode=null}ZPSetupCommon.isEmpty(Files.uploadMode)||formData.append("uploadMode",Files.uploadMode),!ZPSetupCommon.isEmpty(Files.uploadedDocObj)&&void 0==Files.uploadedDocObj.length&&Layout.Page.hash.indexOf("documentlistview")>-1&&formData.append("cloudUploadDoc",JSON.stringify(Files.uploadedDocObj));var recList=pageId.find("div#createDocumentModal").data("recList"),errFlag=!1;if(Zohosign.isFromFormView){formData.append("relatedModule","6");var formId=pageId.find("div#createDocumentModal").data("formId");if((Layout.Page.hash.indexOf("workflow/actions/esign")>-1||ZPSetupCommon.isEmpty(formId))&&(formId=pageId.find("#fname").val()),Layout.Page.hash.indexOf("workflow/list/add-formid")>-1?formId=Layout.Page.container.find("#wfconfigFormslist").val():Layout.Page.hash.indexOf("workflow/list/edit-formid")>-1?formId=Layout.Page.container.find("#editmode").attr("formid"):Layout.Page.hash.indexOf("workflow/actions/esign/edit")>-1?formId=Layout.Page.container.find("#form_view").attr("fid"):(Layout.Page.hash.indexOf("customaction/add")>-1||Layout.Page.hash.indexOf("customaction/edit")>-1)&&(formId=AutomationCommon.getFormId()),Layout.Page.hash.indexOf("admin/automation/workflow")>-1||Layout.Page.hash.indexOf("admin/formslayout/customaction")>-1?formData.append("action","saveWorkFlowConfig"):-1==Layout.Page.hash.indexOf("view-formLinkName:")&&-1==Layout.Page.hash.indexOf("selfservice/user")?formData.append("action","scheduleSendDocuments"):(innerForm=!0,formId=pageId[0].getAttribute("id").split("formId-")[1],formData.append("action","sendDocument")),void 0==formId&&(formId=ZPForm.CURRFORM_PARAM.formId),formData.append("formId",formId),"2"===pageId.find("div#createDocumentModal").find("input[name='esign']:checked").val()||Layout.Page.hash.indexOf("admin/automation/workflow/actions/esign")>-1||Layout.Page.hash.indexOf("admin/automation/workflow/list")>-1||Layout.Page.hash.indexOf("customaction/add")>-1||Layout.Page.hash.indexOf("customaction/edit")>-1?void 0!=createZohosign.find("select#templates").val()&&formData.append("templateId",createZohosign.find("select#templates").val()):formData.append("fileList",createZohosign.find("#uploadfile").val()),formData.append("recList",recList),Layout.Page.hash.indexOf("automation/workflow")>-1||Layout.Page.hash.indexOf("customaction/add")>-1||Layout.Page.hash.indexOf("customaction/edit")>-1){recpList="",ccList="";var recipientDetails=[];$.each(pageId.find("[name=recp_row]"),function(index,recpObj){var recpType=$(recpObj).find("#recp_type").val(),recpVal=$(recpObj).find("#recpList").val(),recipientDetailsObject={};recipientDetailsObject[Zohosign.RECIPIENT_ID]=recpVal,recipientDetailsObject[Zohosign.RECIPIENT_ORDER]=index,recipientDetailsObject[Zohosign.RECIPIENT_TYPE]=recpType,recpType===Zohosign.SIGNER?(index>0&&""!==recpList&&(recpList+=","),recpList+=recpVal):(index>0&&""!==ccList&&(ccList+=","),ccList+=recpVal),recipientDetails.push(recipientDetailsObject)})}}else if("files_companyfile_listview"==Layout.Page.urlmode||"files_companyfile_view"==Layout.Page.urlmode||"files_zohosign_templatelistview"==Layout.Page.urlmode){ZPSetupCommon.isEmpty(Zohosign.editSignTempId)?formData.append("action","sendDocument"):formData.append("action","editZohoSignTemplate"),recpList="",0!=Zohosign.delZSActionId.length&&formData.append("delZSActionId",JSON.stringify(Zohosign.delZSActionId)),ccList="";recipientDetails=[];$.each(pageId.find("#signRecpList #signRecpListUL").find("li"),function(index,recpObj){var recpType=$(recpObj).find("#recp_type").val(),recpVal="";recpVal=void 0!=$($(recpObj).find("div span")[0]).attr("emailId")?$($(recpObj).find("div span")[0]).attr("emailId"):$($(recpObj).find("div span")[0]).text();var recpActId=$(recpObj).attr("id");if(!errFlag){var recipientDetailsObject={};if(recipientDetailsObject[Zohosign.RECIPIENT_ID]=recpVal,recipientDetailsObject[Zohosign.RECIPIENT_ORDER]=index,recipientDetailsObject[Zohosign.RECIPIENT_TYPE]=recpType,recipientDetailsObject[Zohosign.ACTION_ID]=recpActId,recpType===Zohosign.SIGNER?(index>0&&""!==recpList&&(recpList+=","),recpList+=recpVal):(index>0&&""!==ccList&&(ccList+=","),ccList+=recpVal),index>4)return pageId.find("#signRecpList #signRecpListUL").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.maxfiveusers")+"</span>"),void(errFlag=!0);recipientDetails.push(recipientDetailsObject)}})}else formData.append("action",Layout.Page.hash.indexOf("admin/automation/workflow/")>-1||Layout.Page.hash.indexOf("admin/formslayout/customaction")>-1?"saveWorkFlowConfig":"sendDocument");if(!errFlag){if(Layout.Page.hash.indexOf("recordId:")>-1){var recordId=Layout.Page.hash.split("recordId:")[1];formData.append("recordId",recordId)}else void 0!=ZPForm.CURRFORM_PARAM.recordId&&formData.append("recordId",ZPForm.CURRFORM_PARAM.recordId);var configId="";Layout.Page.hash.indexOf("configid:")>-1?configId=Layout.Page.hash.split("configid:")[1]:(Layout.Page.hash.indexOf("workflow/list")>-1||Layout.Page.hash.indexOf("customaction/add")>-1||Layout.Page.hash.indexOf("customaction/edit")>-1)&&Layout.Page.container.find("#form_view").is(":visible")&&(configId=Layout.Page.container.find("#form_view").attr("cid")),ZPSetupCommon.isEmpty(configId)||formData.append("recordId",configId),ZPSetupCommon.isEmpty(recipientDetails)||formData.append("recipientDetails",JSON.stringify(recipientDetails)),Layout.Page.hash.indexOf("automation/workflow")>-1||Layout.Page.hash.indexOf("customaction")>-1||(formData.append("recipients",ZPSetupCommon.isEmpty(recpList)?"":recpList),formData.append("email_copies_to",ZPSetupCommon.isEmpty(ccList)?"":ccList)),formData.append("document_message",ZPSetupCommon.isEmpty(documentMessage)?"":documentMessage),formData.append("automation_message",ZPSetupCommon.isEmpty(automation_message)?"":automation_message),void 0!=addtofileupload&&0!=addtofileupload&&formData.append("addtofileupload",addtofileupload),formData.append("document_name",ZPSetupCommon.isEmpty(documentName)?"":documentName);var catId=pageId.find("select#agrselect_Cat").val();ZPSetupCommon.isEmpty(catId)?formData.append("newCatName",pageId.find("div#createDocumentModal").find("input#hrnewCategory").val()):formData.append("catId",pageId.find("select#agrselect_Cat").val());var synctohrfiles=pageId.find("[name=synctohrfiles]").is(":checked");if(null!=synctohrfiles&&0!=synctohrfiles){formData.append("synctohrfiles",!0);var hrfileoptval="",optionchoosed=pageId.find("[name=optchosdrdbtn]:checked").val();if(void 0==optionchoosed||""==optionchoosed)return void pageId.find("#moreSettings").append('<div class="ERR ML15 MT2" id="errormsg">'+ZPI18N.getString("zp.zs.anyopt")+"</div>");if(1==optionchoosed)hrfileoptval=optionchoosed;else if("on"==optionchoosed){if("Select"==pageId.find("select#hrfileopt").val())return void pageId.find("#hrfileoptdiv .zprt-label").append('<div class="ERR MT2" id="errormsg">'+ZPI18N.getString("zp.zs.formfield")+"</div>");hrfileoptval=pageId.find("select#hrfileopt").val()}ZPSetupCommon.isEmpty(hrfileoptval)||formData.append("hrfileoptval",hrfileoptval.toString())}pageId.find("div#createDocumentModal").find("input#select_pdf").is(":checked")?formData.append("docType","pdf"):-1===Layout.Page.hash.indexOf("workflow/actions/esign")&&formData.append("docType","pdf"),pageId.find("form#createDocumentForm").hide(),"sendDocument"==formData.get("action")&&pageId.find("#setting_lnk").parent().hide(),pageId.find("div#zp_modal_body").append(ZPeople.LOADING_HTML),pageId.find("div#ca_footer").hide(),Layout.Page.hash.indexOf("workflow/list")>-1&&(Layout.Page.container.find("#form_view").removeAttr("fid"),Layout.Page.container.find("#form_view").removeAttr("cid")),$.ajax({url:"zsign.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(data){var pageId=Layout.Page.container;if(Zohosign.selectedRecpForm=null,Zohosign.isFromFormView){var formRowsObj=pageId.find("table#zp_views_records_table tbody");if(formRowsObj.find("input#zp_view_sel_record").prop("checked",!1),$.each(recList,function(index,recId){formRowsObj.find("tr[recordid="+recId+"]").attr("isAgreementSent","true"),formRowsObj.find("tr[recordid="+recId+"]").attr("module",data[1].MODULE),formRowsObj.find("tr[recordid="+recId+"]").attr("agreeid",data[1].recordId)}),Layout.Page.container.find("div#zp_view_record_delete").hide(),Zohosign.isWorkflow||0!=innerForm||(pageId.find("div#createDocumentModal").modal("hide"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.documentscheduled")),pageId.find("#zp_views_formrecactions").attr("style","display:block")),ZPView.newRecordDetails.agreeid=data[1].recordId,ZPView.newRecordDetails.module=data[1].MODULE,Zohosign.isWorkflow)switch(ZPACommon.getUrlMode()){case NewWorkFlow.MODE:NewWorkFlow.callbackByAction(esign.MODE,data[1]);break;case CustomAction.MODE:CustomAction.callbackByAction(esign.MODE,data[1]);break;default:if(pageId.find("#"+data[1].confId).length>0)pageId.find("#"+data[1].confId).find("a#conf_name").text(data[1].confName),pageId.find("#esignLeftListing").find("a#"+data[1].confId).text(data[1].confName);else{var newRec="<tr id="+data[1].confId+' fid="'+formId+'"><td class="text-center"></td><td><div><a class="ulnk" id="conf_name" onclick = Zohosign.esignConfigEditSlide($(this).closest("tr"))>'+data[1].confName+"</a></div></td><td><span>"+ZSEC.Encoder.encodeForHTML(Layout.Page.container.find("#fname option[value='"+formId+"']").text())+'</span></td><td><div class="dvlist-action"><a onclick="" href="#admin/automation/workflow/esign/edit-formid:'+formId+"/configid:"+data[1].confId+'" class="IC-pen ZPtitle" title="" data-original-title="Edit"></a><a displayname="Welcome new Employee" onclick="ZPeople.confirm(this,\'\',\'zp.esigndeletemessage\', Zohosign.deleteEsignConfig)" class="IC-delete ML15 ZPtitle" title="" data-original-title="Delete"></a></div></td></tr>';pageId.find("#esignTempList_table tbody").append(newRec)}window.location.href="#admin/automation/workflow/actions/esign"}if(0==innerForm)return}if(data[1].hasOwnProperty("newCategoryname")&&Object.keys(Files.newCategoryList).length>0&&(Files.newCategoryList[data[1].catId]=ZSEC.Encoder.encodeForHTML(data[1].newCategoryname),Layout.Page.container.find("select#search_cat").append("<option value='"+data[1].catId+"'>"+ZSEC.Encoder.encodeForHTML(data[1].newCategoryname)+"</option>")),"files_companyfile_listview"!=Layout.Page.urlmode&&"files_companyfile_view"!=Layout.Page.urlmode&&"files_zohosign_templatelistview"!=Layout.Page.urlmode){var embedUrlArray;embedUrlArray=data[1].request_url.split("#");var zohoOneOrigin=ZPeople.UnifiedUI.getZOFrameOriginUrl(),embedUrl=embedUrlArray[0]+"?frameorigin=https://"+document.domain+"#"+embedUrlArray[1];if(null!=zohoOneOrigin&&void 0!=zohoOneOrigin&&""!=zohoOneOrigin&&(embedUrl=embedUrlArray[0]+"?frameorigin="+zohoOneOrigin+",https://"+document.domain+"#"+embedUrlArray[1]),pageId.find("div#createDocumentModal").addClass("PopMdxModel l0"),pageId.find("iframe[name='createDocumentResp']").attr("src",embedUrl).show(),pageId.find("div#zp_modal_body").find("div#zp_page_loading").remove(),pageId.find("button#close_btn").show(),pageId.find("div#createDocumentModal").find("div#embed_iframe").show(),Zohosign.loadIframe(data[1]),pageId.find("div#ca_footer").hide(),pageId.find("div#zp_modal_body").addClass("NomdlFoot"),pageId.find("button#footer_submit").hide(),pageId.find("button#footer_close").text("Close"),-1===Layout.Page.hash.indexOf("-formId")&&-1===Layout.Page.hash.indexOf("files/hrfile")&&-1===Layout.Page.hash.indexOf("files/zohosign/documentlistview")){var viewObj=Layout.Page.container.find("#documents_list_form"),relobj=Layout.Page.container.find("#anchor_single_doc_list");viewObj.is(":visible")&&(relobj.hasClass("collapsed")||relobj.addClass("collapsed"),viewObj.slideUp())}if(null!=fileID){if(-1!=Layout.Page.hash.indexOf("selfservice")){var viewSenthtml='<i onclick=Zohosign.getDocumentPreview("'+data[1].recordId+'","","selffiles") id="send_agrmnt" data-toggle="modal" class="IC-send-file S14 grn FR MR15 CP"></i>';pageId.find("#hr_allfileList").find("#hrfileTr_"+Zohosign.compfileId).find(".actions .FL #moreFileOperations li").remove(),pageId.find("#hr_allfileList").find("#hrfileTr_"+Zohosign.compfileId).find(".actions .FL #moreFileOperations").append(viewSenthtml)}else{pageId.find("#hrfileTr_"+fileID).find("span#send_document").addClass("grn"),pageId.find("ul[fileid="+fileID+"]").find("i#send_document").parent().attr("onclick","Zohosign.getDocumentPreview('"+data[1].recordId+"')"),pageId.find("ul[fileid="+fileID+"]").find("i#send_document").removeClass("IC-zohosign"),pageId.find("ul[fileid="+fileID+"]").find("i#send_document").addClass("IC-send-file S14 grn FR MR15"),pageId.find("ul[fileid="+fileID+"]").find("i#send_document").attr("title",ZPI18N.getString("zp.documentdtls"));var ele=pageId.find("ul[fileid="+fileID+"]").find("i#send_document");pageId.find("ul[fileid="+fileID+"]").find("i#send_document").parent().text(ZPI18N.getString("zp.documentdtls")),pageId.find("ul[fileid="+fileID+"]").find(".PR5").append(ele)}}}else{Zohosign.delZSActionId=[];pageId.find("div#createDocumentModal");var templated=data[1].templates.template_id,signURL=data[1].tempURL;if(pageId.find("iframe[name='createDocumentResp']").attr("src",signURL).show(),pageId.find("div#createDocumentModal").addClass("PopMdxModel l0"),pageId.find("div#zp_modal_body").find("div#zp_page_loading").remove(),pageId.find("button#close_btn").show(),pageId.find("div#createDocumentModal").find("div#embed_iframe").show(),pageId.find("div#createDocumentModal").find("div.modal-footer").remove(),pageId.find("div#ca_footer").hide(),pageId.find("div#zp_modal_body").addClass("NomdlFoot"),pageId.find("button#footer_submit").hide(),pageId.find("button#footer_close").text("Close"),0==pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").find("#reqSign").length){Zohosign.locId=pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").find("#setupSign").attr("locID"),Zohosign.divisionId=pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").find("#setupSign").attr("divi"),Zohosign.unitId=pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").find("#setupSign").attr("unit"),Zohosign.departmentId=pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").find("#setupSign").attr("dept"),Zohosign.entityId=pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").find("#setupSign").attr("ent");var comphtml='<li id= "reqSign" onclick="Zohosign.loadActionData(\''+templated+"',false);Zohosign.loadSignTemplate('"+Zohosign.compfileId+"','"+templated+"','"+Zohosign.locId+"','"+Zohosign.entityId+"','"+Zohosign.unitId+"','"+Zohosign.divisionId+"','"+Zohosign.departmentId+'\')"><i class="IC-zohosign"></i>'+ZPI18N.getString("zp.requestsignature")+'</li><li id= "editSign" onclick=Zohosign.openCreateDocumentModal("hr",\''+fileID+"');Zohosign.loadActionData('"+templated+'\',true)><i class="IC-pen-1px"></i>'+ZPI18N.getString("zp.editsignature")+"</li>";pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").find("#setupSign").remove(),pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").append(comphtml),Zohosign.compfileId="",Zohosign.locId="",Zohosign.divisionId="",Zohosign.departmentId="",Zohosign.entityId="",Zohosign.unitId=""}}},error:function(req){if(pageId.find("div#zp_page_loading").hide(),pageId.find("form#createDocumentForm,div#ca_footer").show(),-1==req.responseText.search("File size is greater than allocated limit")){if(-1!=req.responseText.search("mailmerge")){var errorMsg;return errorMsg=JSON.parse(JSON.parse(req.responseText)[1].msg).error.message,void ZPeople.Message.showFailureMsg(errorMsg)}if(400!==req.status){var errResponse=req.responseJSON[1];if(8026!=errResponse.errorCode&&9999!=errResponse.errorCode&&9995!=errResponse.errorCode&&9994!=errResponse.errorCode&&9996!=errResponse.errorCode&&8100!=errResponse.errorCode&&8101!=errResponse.errorCode&&7569!=errResponse.errorCode)if(6013!=errResponse.errorCode)if(6014!=errResponse.errorCode)if(7566!=errResponse.errorCode)if("string"==typeof errResponse.msg)ZPeople.Message.showFailureMsg(errResponse.msg),Files.toggleFileFieldDisplay(),Layout.Page.container.find("div#zp_page_loading").remove(),pageId.find("div#ca_footer,button#close_btn,#createDocumentForm").show();else{var dispMsg,validationMsg=errResponse.msg;if(validationMsg.hasOwnProperty("ef")){var dispName="<p>";$.each(validationMsg.ef,function(mailId,errorCompList){var emptyFieldsId=errorCompList.substring(1,errorCompList.length-1).split(",");$.each(emptyFieldsId,function(index,errId){var optElm=pageId.find("option[value='"+errId.trim()+"']");-1===dispName.indexOf(optElm.text())&&(index>0&&(dispName+=","),dispName+=optElm.text())})}),dispMsg=dispName+=" is not available for this/these record(s) </p>"}else validationMsg.hasOwnProperty("extnerr")?dispMsg=ZPI18N.getString("zp.fileformaterr"):validationMsg.hasOwnProperty("disbaled")?dispMsg=validationMsg.disbaled:validationMsg.hasOwnProperty("limitEx")?dispMsg=validationMsg.limitEx:ZPeople.Message.showFailureMsg(req.statusText);pageId.find("div#form_adobeResp").html(dispMsg),pageId.find("div#adobeFailedAlert").modal()}else{var domain="";ZPeople.isChinaSetup||(domain=document.domain.substr(document.domain.lastIndexOf(".")+1));var signhelpUrl="https://www.zoho."+domain+"/sign/help/admin-guide/organization-details.html#Delete";ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.zs.zsaccexist",new Array(errResponse.msg,signhelpUrl)))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.mmmailfailureerrormessadmin",new Array(errResponse.msg)));else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.mmmailfailuresubject"));else ZPeople.Message.showFailureMsg(errResponse.msg)}else if("PATTERN_NOT_MATCHED"==req.responseJSON.code){var textParam=ZPI18N.getString("zp.field");"document_name"!=req.responseJSON.paramName&&"config_name"!=req.responseJSON.paramName||(textParam=ZPI18N.getString("zp.name")),"document_message"!=req.responseJSON.paramName&&"automation_message"!=req.responseJSON.paramName||(textParam=ZPI18N.getString("zp.message")),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.entervalidinputforesign",new Array(textParam)))}else ZPeople.Message.showFailureMsg(req.responseJSON.error)}else for(var filename=req.responseJSON[1].msg.substring(req.responseJSON[1].msg.indexOf("-")+1),spanCount=pageId.find("#multiple_files").find("span").length,q=0;q<spanCount;q++)if(pageId.find("#multiple_files").find("span").find("b")[q].innerHTML==filename)return void $('<div class="ERR ML15 MT2" id="errormsg">'+ZPI18N.getString("zp.maxfilesize")+"</div>").insertAfter(pageId.find("#multiple_files").find("span")[q])}})}}},esignConfigEditSlide:function(thisObj){var params={action:"getEsignConfigTemplates",recordId:(null==$(thisObj).attr("id")?thisObj:$(thisObj).attr("id"))+""};ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",params,Zohosign.handleEditSlidePage,null,Zohosign.oldUIOpen)},oldUIOpen:function(dataObj){ZPeople.Message.showFailureMsg(dataObj.responseJSON[1].msg)},handleEditSlidePage:function(dataObj,params){Zohosign.editData=dataObj,Layout.Page.container.find("a#"+Zohosign.editData[1][0].cid).closest("li").addClass("sel").siblings("li").removeClass("sel");var newURL="#admin/automation/workflow/actions/esign/edit-formid:"+Zohosign.editData[1][0].fid+"/configid:"+Zohosign.editData[1][0].cid;window.location.href.indexOf(newURL)>-1?Zohosign.openEnvModal(!0,!1,"workflow","init"):window.location.href="#admin/automation/workflow/actions/esign/edit-formid:"+Zohosign.editData[1][0].fid+"/configid:"+Zohosign.editData[1][0].cid},loadIframe:function(data){var pageId=Layout.Page.container;data.requests;pageId.find("iframe[name='createDocumentResp']").one("load",function(){if("true"===$(this).attr("drafted")){pageId.find("div#createDocumentModal").modal("hide"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.docadddsucc")),-1===Layout.Page.hash.indexOf("-formId")&&(-1==Layout.Page.hash.indexOf("view-formLinkName:")&&(window.location.href=Layout.Page.hash.split("-createDocument")[0]),ZPView.newRecordDetails={isAgreementSent:"true",module:data.MODULE,agreeid:data.recordId}),pageId.find("iframe[name='createDocumentResp']").attr("drafted","false");var catName=pageId.find("select#agrselect_Cat option[value='"+data.catId+"']").text();if(catName=ZPSetupCommon.isEmpty(catName)?data.newcat:catName,pageId.attr("id").indexOf("files-zohosign-documentlistview")>-1){var envName=pageId.find("input#search_documentname").val(),catId=pageId.find("select#search_cat").val();"select"==catId&&(catId=data.catId);var status=pageId.find("select#search_status").val(),name=data.name,newCatId=data.catId,ownerId=data.ownerId;catId!=newCatId&&""!=catId&&"select"!=catId||"Draft"!=status&&""!=status&&"select"!=status||-1==name.indexOf(envName)&&""!=envName||(data.OWN=ZSEC.Encoder.encodeForHTML(data.OWN),data.name=ZSEC.Encoder.encodeForHTML(name),data.ownerId=ZSEC.Encoder.encodeForHTML(ownerId),pageId.find("#documents_list").prepend(Zohosign.constructDocumentData(data,"single"))),0===pageId.find("#documents_list ul").length?(pageId.find("#document_norecords").addClass("Scrcont"),pageId.find("#document_norecords").removeClass("DN")):(pageId.find("#document_norecords .ctable").remove(),pageId.find("#document_norecords").removeClass("Scrcont"),pageId.find("#documents_list").removeClass("DN"),pageId.find("#documents_listingpage").removeClass("DN"),1===pageId.find("#documents_list ul").length&&pageId.find("#documents_listingpage").addClass("expand"))}}else $(this).attr("drafted","true"),Zohosign.loadIframe(data)})},sendReminder:function(thisObj){var agrmntID=Layout.Page.container.find("div#viewDocumentModal").attr("documentId"),params={action:"sendReminder",conreqcsr:csrfToken,documentId:agrmntID};if(void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1){params.moduleType="2";var formId=Layout.Page.urlparam.formId;void 0===formId&&(formId=ZPForm.CURRFORM_PARAM.formId),params.recList=Layout.Page.container.find("div#viewDocumentModal").attr("recordId"),params.formId=formId}else params.moduleType="1";ZPeople.Request.send("/zsign.zp",params,Zohosign.handleSendReminder,null,Zohosign.failedCallBack)},failedCallBack:function(error){var responseJson=error.responseJSON[1];"500"==responseJson.errorCode?(void 0!=responseJson.msg?ZPeople.Message.showFailureMsg(responseJson.msg):ZPeople.Message.showFailureMsg(error.statusText),(Layout.Page.hash.indexOf("files/fileView/documentlistview")>-1||Layout.Page.hash.indexOf("files/zohosign/documentlistview")>-1)&&Layout.Page.container.find("div#agmnt_footer").hide()):"8006"==responseJson.errorCode&&(ZPeople.Message.showFailureMsg(responseJson.msg),(Layout.Page.hash.indexOf("files/fileView/documentlistview")>-1||Layout.Page.hash.indexOf("files/zohosign/documentlistview")>-1)&&$("#files-zohosign-documentlistview").addClass("DN"))},handleSendReminder:function(data){"success"===data.status?ZPeople.Message.showSuccessMsg("Reminder has been sent"):"Error"===data.status&&(void 0!=data.message?ZPeople.Message.showFailureMsg(data.message):ZPeople.Message.showFailureMsg("Reminder has not been sent"))},getDocumentList:function(e,modeType,event,sortDefined,sortOrderval,sortColumnval,viewType){Layout.Page.container.find("#doc_multiselDel").hide(),Layout.Page.container.find("#doc_HeaderBar").show(),Layout.Page.container.find("#documents_checkallbox").prop("checked",!1),$("body").popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"bottom",delay:{show:50,hide:50}});var methodName="getDocuments";if(void 0!=viewType&&"WorkFlowReports"==viewType){if(methodName="getWFDocuments",Layout.Page.container.find("#WFStatuslistingdiv").hasClass("DN")&&Layout.Page.container.find("#WFStatuslistingdiv").removeClass("DN"),Layout.Page.container.find("#documents_list").removeAttr("scroll"),!Layout.Page.container.find("#documentslistingdiv").hasClass("DN"))Layout.Page.container.find("#documentslistingdiv").addClass("DN"),(filterOptions=Layout.Page.container.find("#search_status,#search_cat")).select2("val","select"),filterOptions.trigger("change"),Layout.Page.container.find("#search_documentname").val("")}else{var filterOptions;if(Layout.Page.container.find("#wfdocuments_list").removeAttr("scroll"),!Layout.Page.container.find("#WFStatuslistingdiv").hasClass("DN"))Layout.Page.container.find("#WFStatuslistingdiv").addClass("DN"),(filterOptions=Layout.Page.container.find("#search_wfstatus,#search_form,#search_perfrmdemp")).select2("val","select"),filterOptions.trigger("change");Layout.Page.container.find("#documentslistingdiv").hasClass("DN")&&Layout.Page.container.find("#documentslistingdiv").removeClass("DN")}if(void 0==isAnySignConfigured&&Zohosign.getEsignConfigurations(),"search"!=event&&"reset"!=event||Agreements.hideAndShowFilterIC("close"),void 0!=viewType&&"WorkFlowReports"==viewType?(Layout.Page.container.find("#wfdocuments_list").attr("scroll","enabled"),Files.Esign.firescrollTrigger("wfreports")):(Layout.Page.container.find("#documents_list").attr("scroll","enabled"),Files.Esign.firescrollTrigger("document")),void 0!=e&&13===e.keyCode||ZPSetupCommon.isEmpty(e)){var pageId=Layout.Page.container,contentBody="";contentBody=pageId.find("#documents_list"),void 0!=viewType&&"WorkFlowReports"==viewType&&(contentBody=pageId.find("#wfdocuments_list")),Files.fromcompFilesReportPage&&(pageId.find("#wfdocuments_list ul").remove(),pageId.find("#documents_list ul").remove());var envName=pageId.find("input#search_documentname").val(),catId=pageId.find("select#search_cat").val(),catName=pageId.find("#s2id_search_cat").find("span").text(),status=pageId.find("select#search_status").val(),wfstatus=pageId.find("select#search_wfstatus").val(),formId=pageId.find("select#search_form").val(),emailID=pageId.find("input#emailId_search").val(),recordId=pageId.find("input#recordId_search").val(),formName=pageId.find("#s2id_search_form").find("span").text(),perfrmdbyId=pageId.find("select#search_perfrmdemp").val(),perfrmdbyName=pageId.find("#s2id_search_perfrmdemp").find("span").text(),startInd=ZPSetupCommon.isEmpty(contentBody.data("start"))?1:contentBody.data("start"),sortColumn="",sortOrder=!1,getSortColumn="",fileId="",searchParams={};Files.companyFilesReport&&(fileId=Files.companyFileId,event="reset"),void 0!=Layout.Page.container.find(".sort-d").attr("id")?(getSortColumn=Layout.Page.container.find(".sort-d").attr("id"),sortColumn=Files.Esign.getSortColumn(getSortColumn),sortOrder=!1):void 0!=Layout.Page.container.find(".sort-u").attr("id")&&(getSortColumn=Layout.Page.container.find(".sort-u").attr("id"),sortColumn=Files.Esign.getSortColumn(getSortColumn),sortOrder=!0),""==sortColumn&&(void 0==sortDefined?sortColumn="SENT_DATE":(sortOrder=sortOrderval,sortColumn=sortColumnval));var sentFrom="",sentTo="";if(""!=pageId.find("#doc_sentfrom").val()&&0!=pageId.find("#doc_sentfrom").val()&&void 0!=pageId.find("#doc_sentfrom").val()){sentFrom=pageId.find("#doc_sentfrom").val();var fromText=ZPI18N.getString("zp.from");void 0!=viewType&&"WorkFlowReports"==viewType&&(fromText="wf_From"),searchParams[fromText]=sentFrom}else sentFrom="-1";if(""!=pageId.find("#doc_sentto").val()&&0!=pageId.find("#doc_sentto").val()&&void 0!=pageId.find("#doc_sentto").val()){sentTo=pageId.find("#doc_sentto").val();var toText=ZPI18N.getString("zp.to");void 0!=viewType&&"WorkFlowReports"==viewType&&(toText="wf_To"),searchParams[toText]=sentTo}else sentTo="-1";24,"search"==event||"reset"==event||"sort"==event?(Layout.Page.container.find("#documents_list").removeAttr("scroll"),Layout.Page.container.find("#documents_list").attr("scroll","enabled"),Layout.Page.container.find("#wfdocuments_list").removeAttr("scroll"),Layout.Page.container.find("#wfdocuments_list").attr("scroll","enabled"),contentBody.empty(),Zohosign.docStartindex=1,startInd=1):1==Zohosign.documentFirescroll&&(0==Zohosign.docStartindex?Zohosign.docStartindex=25:Zohosign.docStartindex=Zohosign.docStartindex+24,startInd=Zohosign.docStartindex);var params={action:methodName,limit:24,startInd:startInd,sortOrder:sortOrder,sortColumn:sortColumn,sentFrom:sentFrom,sentTo:sentTo,fileId:fileId};Files.fromcompFilesReportPage&&(params.type="files"),ZPSetupCommon.isEmpty(envName)||(params.documentName=envName,searchParams[ZPI18N.getString("zp.name")]=envName),ZPSetupCommon.isEmpty(emailID)||(params.recipients=emailID),ZPSetupCommon.isEmpty(emailID)||""===emailID||(searchParams[ZPI18N.getString("zp.emailid")]=emailID),ZPSetupCommon.isEmpty(recordId)||(params.recordId=recordId),ZPSetupCommon.isEmpty(recordId)||""===recordId||(searchParams[ZPI18N.getString("zp.historyExportRecordId")]=recordId),ZPSetupCommon.isEmpty(catId)||"select"===catId||(params.catId=catId),ZPSetupCommon.isEmpty(catName)||"Select"===catName||(searchParams[ZPI18N.getString("zp.folder")]=catName),ZPSetupCommon.isEmpty(status)||"select"===status||(params.status=status,searchParams[ZPI18N.getString("zp.status")]=status),ZPSetupCommon.isEmpty(wfstatus)||"select"===wfstatus||(params.wfstatus=wfstatus,searchParams[ZPI18N.getString("zp.wfstatus")]=wfstatus),ZPSetupCommon.isEmpty(formId)||"select"===formId||(params.formId=formId),ZPSetupCommon.isEmpty(formName)||"Select"===formName||(searchParams[ZPI18N.getString("zp.formname")]=formName),ZPSetupCommon.isEmpty(perfrmdbyId)||"select"===perfrmdbyId||(params.perfmerecno=perfrmdbyId),ZPSetupCommon.isEmpty(perfrmdbyName)||"Select"===perfrmdbyName||(searchParams[ZPI18N.getString("zp.triggeredby")]=perfrmdbyName),void 0!=viewType&&"WorkFlowReports"==viewType&&(searchParams[ZPI18N.getString("zp.viewtype")]=ZPI18N.getString("zp.esignworkflow")),Zohosign.showCount();var keyId="filter_params_docFiles";if(void 0!=viewType&&"WorkFlowReports"==viewType&&(keyId="wf_filter_params_docFiles"),Object.keys(searchParams).length>0){var resultHtml="";$.each(searchParams,function(key,val){var dispval=key;"wf_To"==key?dispval=ZPI18N.getString("zp.to"):"wf_From"==key&&(dispval=ZPI18N.getString("zp.from")),resultHtml+="<span value='"+key+"'>"+dispval+"&nbsp;&nbsp; : &nbsp;&nbsp;"+ZSEC.Encoder.encodeForHTML(val)+"<i onclick='Files.removeSearchBreadcrumbs(this)'></i></span>"}),Layout.Page.container.find("#"+keyId).html(resultHtml),Files.opnclsSearchBreadcrumbs("open"),Files.showMoreFilter(keyId)}else-1===Layout.Page.hash.indexOf("files/zohosign/documentlistview")&&(Layout.Page.container.find("#"+keyId).html(""),Files.opnclsSearchBreadcrumbs("close"));void 0!=viewType&&"WorkFlowReports"==viewType?ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",params,this.constructWFDocumentList):ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",params,this.constructDocumentList)}},showFilterOpts:function(keyId){Layout.Page.container.find("#WFStatus_listingpage").toggleClass("expand"),$("#page-wrapper").toggleClass("shwresult")},getETemplateList:function(e,modeType,event,sortDefined,sortOrderval,sortColumnval,viewType){void 0==isAnySignConfigured&&Zohosign.getEsignConfigurations();var pageId=Layout.Page.container,limit="";if(Files.companyFilesReport,"search"!=event&&"reset"!=event||Agreements.hideAndShowFilterIC("close"),Layout.Page.container.find("#signtemplate_list").attr("scroll","enabled"),Files.Esign.firescrollTrigger("zsigntemplates"),void 0!=e&&13===e.keyCode||ZPSetupCommon.isEmpty(e)){var contentBody="";contentBody=pageId.find("#signtemplate_list");var envName=pageId.find("input#search_view").val(),startInd=ZPSetupCommon.isEmpty(contentBody.data("start"))?1:contentBody.data("start"),searchParams={};if(""!=pageId.find("#temp_sentfrom").val()&&0!=pageId.find("#temp_sentfrom").val()&&void 0!=pageId.find("#temp_sentfrom").val())sentFrom=pageId.find("#temp_sentfrom").val(),searchParams[ZPI18N.getString("zp.from")]=sentFrom;else sentFrom="-1";if(""!=pageId.find("#temp_sentto").val()&&0!=pageId.find("#temp_sentto").val()&&void 0!=pageId.find("#temp_sentto").val())sentTo=pageId.find("#temp_sentto").val(),searchParams[ZPI18N.getString("zp.to")]=sentTo;else sentTo="-1";limit=24,"search"==event||"reset"==event?(Layout.Page.container.find("#signtemplate_list").removeAttr("scroll"),Layout.Page.container.find("#signtemplate_list").attr("scroll","enabled"),contentBody.empty(),Zohosign.templateStartindex=1,startInd=1):1==Zohosign.tempFirescroll&&(0==Zohosign.templateStartindex?Zohosign.templateStartindex=25:Zohosign.templateStartindex=Zohosign.templateStartindex+24,startInd=Zohosign.templateStartindex);var params={action:"getSignTemplates",limit:limit,startInd:startInd,sentFrom:sentFrom,sentTo:sentTo};params.noModuleCheck=void 0==event,ZPSetupCommon.isEmpty(envName)||(params.documentName=envName,searchParams[ZPI18N.getString("zp.name")]=envName);var keyId="filter_params_tempFiles";if(Object.keys(searchParams).length>0){var resultHtml="";$.each(searchParams,function(key,val){resultHtml+="<span value='"+key+"'>"+key+"&nbsp;&nbsp; : &nbsp;&nbsp;"+ZSEC.Encoder.encodeForHTML(val)+"<i onclick='Files.removeSearchBreadcrumbs(this)'></i></span>"}),Layout.Page.container.find("#"+keyId).html(resultHtml),Files.opnclsSearchBreadcrumbs("open")}else-1===Layout.Page.hash.indexOf("files/zohosign/templatelistview")&&(Layout.Page.container.find("#"+keyId).html(""),Files.opnclsSearchBreadcrumbs("close"));ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",params,this.constructSignTemplateList)}},constructHRDocumentsList:function(data,params){var agreementsListElms="",pageId=Layout.Page.container;pageId.find("#agrm_filterIc").addClass("DNI"),contentBody=pageId.find("#hrdoc_list");pageId.find("div#no_recfound_img").remove(),0===data[1].length?(Layout.Page.container.find("#hrdoc_norecords .ctable").remove(),Zohosign.newuinohrDocrecords(ZPI18N.getString("zp.nodatafound"))):(pageId.find("div#hrdoc_list").removeClass("DN"),pageId.find("div#hrdoc_listingpage").removeClass("DN"),pageId.find("div#temp_norecords").removeClass("Scrcont"),pageId.find("div#temp_norecords").addClass("DN"),$.each(data[1],function(index,obj){obj.hasOwnProperty("limit")||(agreementsListElms=Zohosign.constructHRDocuments(obj),contentBody.append(agreementsListElms))}),Zohosign.setCatName(data[1]),contentBody.data({start:params.startInd}),pageId.find("div#temp_footer").removeClass("DN"))},constructSignTemplateList:function(data,params){var agreementsListElms="",pageId=Layout.Page.container;contentBody=pageId.find("#signtemplate_list"),pageId.find("#agrm_filterIc").removeClass("DNI");Files.isIprestricted||Files.isGeorestricted||Layout.Page.container.find("#tab_actions").find("#create_agr").removeClass("DN"),pageId.find("div#no_recfound_img").remove(),Zohosign.isCachedTempList=!0;var listCount=data[1].length-1;1===data[1].length&&contentBody.find(".ZPListingUL").length>1?(ZPeople.FireScroll.getFireScrollPropertie().triggered=!0,Zohosign.tempFirescroll=!1):0===data[1].length?(Layout.Page.container.find("#temp_norecords .ctable").remove(),Zohosign.newuinorecordsSigntemp()):(pageId.find("div#signtemplate_list").removeClass("DN"),pageId.find("div#signtemplate_listingpage").removeClass("DN"),pageId.find("div#temp_norecords").removeClass("Scrcont"),pageId.find("div#temp_norecords").addClass("DN"),data[1].length<24?(Zohosign.tempFirescroll=!1,ZPeople.FireScroll.getFireScrollPropertie().triggered=!0):Zohosign.tempFirescroll=!0,$.each(data[1],function(index,obj){if(obj.hasOwnProperty("limit")){var limitCnt,start=obj.start;limitCnt=1===start?listCount>1?listCount:start:listCount>1?listCount+start-1:start,data.length<=1&&(start=0,limitCnt=0),pageId.find("span#zp_view_page_cnt").html(start+"&nbsp;-&nbsp;"+limitCnt),contentBody.data({start:start,next:obj.nexpage})}else agreementsListElms+=Zohosign.constructtemplateData(obj)}),contentBody.append(agreementsListElms),Zohosign.setCatName(data[1]),contentBody.data({start:params.startInd}),pageId.find("div#temp_footer").removeClass("DN")),ZPeople.FireScroll.reset()},constructsinglerecordview:function(obj){var statusCls,pageId=Layout.Page.container,catId=ZPSetupCommon.isEmpty(obj.catId)?"0":obj.catId,agName=ZPSetupCommon.isEmpty(obj.name)?"[No name]":obj.name;statusCls="Sent"===obj.status||"Out for Signature"===obj.status||"Draft"===obj.status?"org":"Completed"===obj.status||"Signed"===obj.status?"grn":"red";pageId.find("select#search_cat").find("option[value='"+catId+"']").text();var isCancelled="Cancelled / Declined"===obj.status;agreementsListElms+='<tr class="ZPLRow" href="" documentId="'+obj.ARID+'" isCancelled='+isCancelled+' envIdStr = "'+obj.agreementId+'">',agreementsListElms+='<td colspan="3"><a onclick="Zohosign.getDocumentViewPage(this)" class="txttrim">'+ZSEC.Encoder.encodeForHTML(agName)+"</a></td>",agreementsListElms+='<td><span class="ellip" id="cat_nm"></span></td>',agreementsListElms+="<td>"+obj.sentDate+"</td>",agreementsListElms+='<td><span class="txttrim">'+ZSEC.Encoder.encodeForHTML(obj.owner)+"</span></td>",agreementsListElms+="<td>"+obj.completeDate+"</td>",agreementsListElms+='<td name="env_status"><span class="'+statusCls+'">'+obj.status+"</span></td>",agreementsListElms+='<td class="over-display"><span class="IC-delete-1px CP" onclick="Files.Esign.deleteRecConfirm(this, \'action_confirm_btn\');"></span>',agreementsListElms+='<i onclick=Agreements.downloadAttachement(this,"'+obj.ARID+'","download") class="IC-imprt S16 gry FR MR15"></i>',agreementsListElms+="</td></tr>",contentBody.append(agreementsListElms)},constructWFDocumentList:function(data,params){var pageId=Layout.Page.container,row="";if(Zohosign.documentFirescroll||pageId.find("#wfdocuments_list ul").remove(),data[1].length<24?(Zohosign.documentFirescroll=!1,ZPeople.FireScroll.getFireScrollPropertie().triggered=!0):Zohosign.documentFirescroll=!0,0===data[1].length&&0===pageId.find("#wfdocuments_list ul").length){pageId.find("#wfdocument_norecords").addClass("Scrcont"),pageId.find("#wfdocument_norecords").removeClass("DN"),pageId.find("div#wfdocuments_list").addClass("DN"),pageId.find("div#WFStatus_listingpage").addClass("DN"),pageId.find("#WFStatus_listingpage").removeClass("expand");var currScrollContObj=pageId.find("#wfdocument_norecords");Layout.Page.container.find("#wfdocument_norecords .ctable").remove();var noFilesFound="";noFilesFound+='<div class="ctable"><div class="ctcell"><div class="ZPNdata">',noFilesFound+='<i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i>',noFilesFound+='<i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i>',noFilesFound+='<h5 id="zp_views_nodata">'+ZPI18N.getString("zp.lookup.norecfound")+"</h5></div></div></div>",currScrollContObj.append(noFilesFound)}else pageId.find("#wfdocument_norecords").hasClass("DN")||(pageId.find("#wfdocument_norecords").removeClass("Scrcont"),pageId.find("#wfdocument_norecords").addClass("DN"),pageId.find("div#wfdocuments_list").removeClass("DN"),pageId.find("div#WFStatus_listingpage").removeClass("DN"),pageId.find("#WFStatus_listingpage").addClass("expand"));$.each(data[1],function(index,obj){if(!obj.hasOwnProperty("limit")){var status="Failure";obj.s&&(status="Success"),void 0==obj.e&&(obj.e=""),row+='<ul class="ZPListingUL" onclick=ZPApprovals.setReqFormUrl("'+obj.fid+'","'+obj.rcid+'","'+obj.tablename+'") >',row+='<li class="tsize" >'+obj.wn+"</li>",row+='<li class="tsize" >'+ZSEC.Encoder.encodeForHTML(obj.esignName)+"</li>",row+="<li>"+ZSEC.Encoder.encodeForHTML(obj.formnm)+"</li>",row+="<li>"+ZSEC.Encoder.encodeForHTML(obj.perfnm)+"</li>",row+="<li>"+obj.time+"</li>",obj.s?row+='<li class="grn">'+status+"</li>":(row+='<li class="red">'+status,row+=' <i data-popover="true" data-html="true" data-placement="bottom" data-content="<span class=&quot;DB S13&quot;><b>Error: </b> <p class=&quot;MT3&quot;>'+ZPeople.escapeHtml(obj.e)+'</p></span>" class="CR-info popHover red" data-original-title="" title=""></i></li>'),row+="</ul>"}}),pageId.find("#wfdocuments_list").append(row),ZPeople.FireScroll.reset()},populateDocumentView:function(){if(ZPSetupCommon.isEmpty(Zohosign.hasZohosignRecord)){var params={conreqcsr:csrfToken,action:"getEsignActivityOptions"};$.ajax({url:"/zohoSignActions.zp",type:"POST",data:params,async:!1,success:function(data){data=data[1].servicesConfigured,Zohosign.hasZohosignRecord=data.hasZohosignActivity,Zohosign.hasAdobesignRecord=data.hasAdobesignActivity,Zohosign.hasDocusignRecord=data.hasDocusignActivity}})}var signhtmlOpt="";Layout.Page.container.find("#zp_esign_view").html(""),(Zohosign.hasZohosignRecord||isZSConfig)&&(signhtmlOpt+='<option value="6">'+ZPI18N.getString("zp.zohosign")+"</option>"),(Zohosign.hasAdobesignRecord||isAdobeConfig)&&(signhtmlOpt+='<option value="2">'+ZPI18N.getString("zp.adobeesign")+"</option>"),(Zohosign.hasDocusignRecord||isDocuConfig)&&(signhtmlOpt+='<option value="4">'+ZPI18N.getString("zp.docusign")+"</option>"),Layout.Page.container.find("#zp_esign_view").html(signhtmlOpt),void 0==isAnySignConfigured&&Zohosign.getEsignConfigurations(),isZSConfig?Layout.Page.container.find("#zp_esign_view").select2("val","6"):isAdobeConfig?Layout.Page.container.find("#zp_esign_view").select2("val","2"):isDocuConfig&&Layout.Page.container.find("#zp_esign_view").select2("val","4"),Layout.Page.container.find("#zp_esign_view").removeClass("DN"),Layout.Page.container.find("#zp_esign_view").select2()},loadReadView:function(){Zohosign.isfromFilterView=!0;var viewtype=Layout.Page.container.find("#zp_esign_view").val();"4"==viewtype?(window.location.href="#files/docusign/doculistview",Files.Esign.getEnvelopeListpage()):"6"==viewtype?(window.location.href="#files/zohosign/documentlistview",Files.Esign.getDocumentsListPage()):"2"==viewtype&&(window.location.href="#files/adobesign/agreementslistview",Files.Esign.getAgreementsListPage())},constructDocumentList:function(data,params){var agreementsListElms="",pageId=Layout.Page.container,contentBody="";if(null!=Files.companyFileId)Layout.Page.container.find("#tab_actions").find("#create_agr").addClass("DN"),Layout.Page.container.find("#docfoldergroup").hide(),Layout.Page.container.find("#search_nameHeader").hide(),Layout.Page.container.find("#search_documentname").hide(),Layout.Page.container.find("#exportasZip").hide(),Layout.Page.container.find("#doc_HeaderBar .col-sm-7 .bc").find("span").remove(),Layout.Page.container.find("#doc_HeaderBar .col-sm-7 .bc").append('<span><em class="dgry">'+ZPI18N.getString("zp.viewreportfor")+'</em><em class="ML2">-</em><em class="bld ML2">'+Files.fileNameforCR+"</em></span>"),Layout.Page.container.find("#doc_HeaderBar .col-sm-7 .bc").find("span").addClass("ML30 S16"),Layout.Page.container.find("#zp_esign_view").addClass("DN"),0!=Layout.Page.container.find("#compBackbtn").length?Layout.Page.container.find("#compBackbtn").show():Layout.Page.container.find("#doc_HeaderBar .col-sm-7 .bc").append("<div class='FL PR MT12'><a id='compBackbtn' class=''><div class='zp-back'><i class='IC-ar-lft S18 FL blu'onclick='Files.hideViewReport()'></i></div></a></div>");else{Layout.Page.container.find("#tab_actions").find("#create_agr").removeClass("DN"),Zohosign.populateDocumentView(),void 0==isZohoReadView&&Zohosign.getReadView(),Zohosign.isfromFilterView&&Layout.Page.container.find("#zp_esign_view").select2("val","6"),Layout.Page.container.find("#search_nameHeader").show(),Layout.Page.container.find("#search_documentname").show(),Layout.Page.container.find("#exportasZip").show(),Layout.Page.container.find("#docfoldergroup").show();var contHTML="<p class='LH18I'>"+ZPI18N.getString("zp.doctabinfo")+"</p>";Layout.Page.container.find("#doc_HeaderBar .col-sm-7 .bc").find("span").remove(),Layout.Page.container.find("#doc_HeaderBar .col-sm-7 .bc").append('<span class="ML5 bld S16">'+ZPI18N.getString("zp.esignature")+'<i data-popover="true" data-html="true" class="IC-info S18 gry ML10 popHover" data-original-title="" title="" data-content="'+contHTML+'"></i></span>'),Layout.Page.container.find("#compBackbtn").hide()}contentBody=pageId.find("#documents_list");pageId.find("div#no_recfound_img").remove(),Zohosign.isCachedDocumentList=!0;var listCount=data[1].length-1;1===data[1].length&&contentBody.find(".ZPListingUL").length>1?(ZPeople.FireScroll.getFireScrollPropertie().triggered=!0,Zohosign.documentFirescroll=!1):1===data[1].length?(Layout.Page.container.find("#document_norecords .ctable").remove(),Zohosign.newuinorecords()):(pageId.find("div#document_norecords").addClass("DN"),pageId.find("div#document_norecords").removeClass("Scrcont"),pageId.find("div#documents_list").removeClass("DN"),pageId.find("div#documents_listingpage").removeClass("DN"),data[1].length<24?(Zohosign.documentFirescroll=!1,ZPeople.FireScroll.getFireScrollPropertie().triggered=!0):Zohosign.documentFirescroll=!0,$.each(data[1],function(index,obj){if(obj.hasOwnProperty("limit")){var limitCnt,start=obj.start;limitCnt=1===start?listCount>1?listCount:start:listCount>1?listCount+start-1:start,data.length<=1&&(start=0,limitCnt=0),pageId.find("span#zp_view_page_cnt").html(start+"&nbsp;-&nbsp;"+limitCnt),contentBody.data({start:start,next:obj.nexpage})}else null!=Files.companyFileId?agreementsListElms+=Zohosign.constructDocumentData(obj,"compfiles"):agreementsListElms+=Zohosign.constructDocumentData(obj)}),contentBody.append(agreementsListElms),Zohosign.setCatName(data[1]),contentBody.data({start:params.startInd}),pageId.find("div#document_footer").removeClass("DN"),isZohoReadView&&($("a#zp_t_files_zohosign_documentlistview").parent("li").addClass("active"),$("a#zp_t_files_docusign").parent("li").addClass("active"),$("a#zp_t_files_adobesign").parent("li").addClass("active"),$("a#zp_t_files_zohosign_documentlistview").parent("li").parent("ul").attr("style","display:block"),$("a#zp_t_files_docusign").parent("li").parent("ul").attr("style","display:block"),$("a#zp_t_files_adobesign").parent("li").parent("ul").attr("style","display:block"),Layout.Page.container.find("#create_agr").addClass("DN"),Layout.Page.container.find("#zp_esign_view").select2("val","6")),Layout.Page.container.find("#zp_esign_view").select2("val","6")),ZPeople.FireScroll.reset()},getReadView:function(){void 0!=isAdobeReadView&&void 0!=isDocuReadView&&void 0!=isZohoReadView||(Zohosign.populateDocumentView(),$.ajax({type:"POST",async:!1,url:"/zohoSignActions.zp",data:{action:"loginUserRolecheckAccess",conreqcsr:csrfToken},success:function(data){isAdobeReadView=data[1].isAdobeReadView,isDocuReadView=data[1].isDocuReadView,isZohoReadView=data[1].isZohoReadView}}))},constructDocumentData:function(obj,mode){0==Object.keys(Files.newCategoryList).length?ZPeople.Request.sendAsyncPost("/fileCabinetAction.zp",{methodName:"getCategoryList",conreqcsr:csrfToken,formId:ZPForm.CURRFORM_PARAM.formId,recordId:ZPForm.CURRFORM_PARAM.recordId},Zohosign.openFilter):Zohosign.openFilter(Files.newCategoryList);var row="";if(void 0==obj)return row+='<h4 class="ZPNdt text-center" id="zp_views_nodata">No records found</h4>';var statusCls,ARID,agreementId,owner,completeDate,sentDate,categoryName,ownerId,topRecipient,size,catId=ZPSetupCommon.isEmpty(obj.catId)?"0":obj.catId,agName=ZPSetupCommon.isEmpty(obj.name)?"[No name]":obj.name,repName=[];if("single"==mode){ARID=obj.recordId,agreementId=obj.requests.document_ids[0].document_id,owner=obj.OWN,ownerId=obj.ownerId,sentDate=obj.SD,completeDate="",topRecipient=obj.topRecipient,categoryName=ZSEC.Encoder.encodeForHTML(Layout.Page.container.find("select#search_cat").find("option[value='"+catId+"']").text()),statusCls="org",status="Draft",size=obj.requests.actions.length;for(var i=0;i<size;i++)0==i&&(topRecipient=obj.requests.actions[i].recipient_email),repName.push(obj.requests.actions[i].recipient_email)}else ARID=obj.ARID,agreementId=obj.agreementId,owner=obj.owner,ownerId=obj.ownerId,sentDate=obj.sentDate,repName=obj.recipients,topRecipient=obj.topRecipient,completeDate=obj.completeDate,categoryName=Files.newCategoryList[obj.catId],statusCls="Sent"===obj.status||"Out for Signature"===obj.status||"Draft"===obj.status?"org":"Completed"===obj.status||"Signed"===obj.status?"grn":"red",status=obj.status;var recordid=ZPForm.CURRFORM_PARAM.recordId;""==owner&&(owner=ZPI18N.getString("zp.deleteduser"),ownerId="");var isCancelled="Cancelled / Declined"===obj.status;return"formsHeader"==mode&&(row+='<div class="ZPListingHdr"><ul class="ZPListingUL">',row+='<li class="tsize"><span class="ellip">'+ZPI18N.getString("zp.name")+"</span></li>",row+='<li class="tsize"><span class="ellip">'+ZPI18N.getString("zp.reciepents")+"</span></li>",row+="<li>"+ZPI18N.getString("zp.datesent",new Array(""))+"</li>",row+='<li><span class="ellip">'+ZPI18N.getString("zp.folder")+"</span></li>",row+="<li>"+ZPI18N.getString("zp.status")+"</li>",row+='<li class="actions"></li>',row+="</ul></div>"),row+='<ul class="ZPListingUL" href="" documentId="'+ARID+'" isCancelled='+isCancelled+' envIdStr = "'+agreementId+'">',"forms"!=mode&&"formsHeader"!=mode&&(row+='<li class="check"><div class="checkbox"><input type="checkbox" onclick=Files.Esign.checkParticularFiles(this,"documents")><label></label></div></li>'),null!=obj.recipientPhoto?row+='<li class="tsize"><div class="fileType BGtxt"><img src="'+obj.recipientPhoto+'"></div>':row+='<li class="tsize"><div class="fileType BGtxt"><img src="'+obj.senderPhoto+'"></div>',"forms"==mode||"formsHeader"==mode?"3"===obj.module||"4"===obj.module?row+='<div class="DIB CP" onclick=Envelope.getEnvelopePreview("'+ARID+'","'+recordid+'")><span class="bld ellip"  class="txttrim">'+agName+"</span>":"5"===obj.module||"6"===obj.module?row+='<div class="DIB CP" onclick=Zohosign.getDocumentPreview("'+ARID+'","'+recordid+'") ><span class="bld ellip" class="txttrim">'+agName+"</span>":row+='<div class="DIB CP" onclick=Agreements.getAgreementPreview("'+ARID+'","'+recordid+'") ><span class="bld ellip" class="txttrim">'+agName+"</span>":row+="compfiles"==mode?""==ownerId?'<div class="DIB CP" onclick=Zohosign.getDocumentViewPage(this)><span class="ellip"><em class="dgry"></em><em class="ML2 bld">'+owner+"</em></span>":'<div class="DIB CP" onclick=Zohosign.getDocumentViewPage(this)><span class="ellip"><em class="dgry">'+ownerId+'-</em><em class="ML2 bld">'+owner+"</em></span>":'<div class="DIB CP" onclick=Zohosign.getDocumentViewPage(this)><span class="bld ellip" onclick="Zohosign.getDocumentViewPage(this)" class="txttrim">'+agName+"</span>",row+='<span class="DB S13 MT8">',"compfiles"!=mode&&(row+=""==ownerId?'<span class="ellip"><em class="dgry"></em><em class="ML2">'+owner+"</em></span>":'<span class="ellip"><em class="dgry">'+ownerId+'-</em><em class="ML2">'+owner+"</em></span>"),row+="</span></div></li>",void 0!=repName&&(repName.length>1?(row+='<li class="tsize"><span class="btn-sm FL ellip">'+repName.toString().split(",")[0]+"</span>",row+='<div class=" dropdown ZPCusDrs  FL  ML5 "><div data-toggle="dropdown" class="btn btn-sm btn-lgray moreDt"><i class="IC-more"></i></div>',row+=Files.getAllSharedLocRole(repName),row+="</div></li>"):row+=void 0!=topRecipient?'<li class="tsize"><span class="ellip">'+topRecipient+"</span></li>":'<li class="tsize"><span class="ellip"> </span></li>'),row+='<li id="sentOn">'+sentDate+"</li>",row+='<li id="cat_nm"><span class="ellip txttrim">'+categoryName+"</span></li>",row+=null!==completeDate&&void 0!==completeDate&&""!==completeDate?'<li name="env_status"><span  class='+statusCls+">"+status+'<i class="IC-rou-tik ML5 grn"></i></span><span class="DB dgry MT5">'+completeDate+"</span></li>":'<li name="env_status"><span  class='+statusCls+">"+status+"</span></li>",row+='<li class="actions"><div class="FR">',"forms"!=mode&&"formsHeader"!=mode&&(row+='<i class="IC-down" onclick=Agreements.downloadAttachement(this,"'+ARID+'","download") class="IC-imprt S16 gry FR MR15"></i>'),row+='<i class="IC-delete-1px" onclick="Files.Esign.deleteRecConfirm(this, \'action_confirm_btn\');"></i></div>',row+='<div class="FL"><div id="action_confirm_btn" class="DN"><button class="btn btn-default btn-sm FR" onclick="Files.Esign.cancelDelRecConfirm(this);">Cancel</button><button class="btn btn-danger btn-sm FR MR10" onclick=Zohosign.deleteAgreementRecord(this,"last");>Confirm</button></div>',row+="</ul>"},constructtemplateData:function(obj,mode){var row="";if(void 0==obj)return row+='<h4 class="ZPNdt text-center" id="zp_views_nodata">No records found</h4>';var tempId,owner,createdDate,ownerId,isSystem,name=ZPSetupCommon.isEmpty(obj.name)?"[No name]":obj.name;name.lastIndexOf(".")>0&&(name=name.substr(0,name.lastIndexOf(".")));return tempId=obj.tempId,owner=obj.owner,ownerId=obj.ownerId,createdDate=obj.createdDate,isSystem=obj.isSystem,row+='<ul class="ZPListingUL" href="" tempId="'+tempId+'">',row+='<li class="check"><div class="checkbox"><input type="checkbox" onclick=Files.Esign.checkParticularFiles(this,"zsigntemplates")><label></label></div></li>',row+='<li class="nameL"><div class="fileType icn"><i class="IC-pdf"></i></div>',row+='<div class="DIB CP" id=\''+obj.fileID+"' onclick=\"Zohosign.loadActionData('"+obj.tempId+"',false);Zohosign.loadSignTemplate('"+obj.fileID+"','"+obj.tempId+'\')"><span class="bld">'+name+"</span>",isSystem?row+='<span class="DB S13 MT8"><em class="FL gry">'+ZPI18N.getString("zp.createdon")+" "+createdDate+" "+ZPI18N.getString("zp.by")+" "+ZPI18N.getString("zp.systemdetect")+"</em></span>":void 0==ownerId&&""==createdDate?row+='<span class="DB S13 MT8"><em class="FL gry">-</em></span>':""!=createdDate&&(row+='<span class="DB S13 MT8"><em class="FL gry">'+ZPI18N.getString("zp.createdon")+" "+createdDate+" "+ZPI18N.getString("zp.by")+" "+owner+"</em></span>"),row+="</div></div></li>",row+='<li class="actions"><div class="FR">',row+='<div id="moreOptionsParDiv" class="dropdown ZPCusDrs  FL  ML10"><div data-hover="dropdown" data-toggle="dropdown" class="btn btn-sm btn-lgray moreDt"><i class="IC-more"></i></div>',row+='<ul class="dropdown-menu ZPCmn-Arrow top gray CP" id="moreFileOperations">',row+='<li id= "reqSign" onclick="Zohosign.loadActionData(\''+obj.tempId+"');Zohosign.loadSignTemplate('"+obj.fileID+"','"+obj.tempId+'\')"><i class="IC-zohosign"></i>'+ZPI18N.getString("zp.requestsignature")+"</li>",row+='<li id= "editSign" onclick=Zohosign.openCreateDocumentModal("hr",\''+obj.fileID+"');Zohosign.loadActionData('"+obj.tempId+'\',true);><i class="CR-edit"></i>'+ZPI18N.getString("zp.editsignature")+"</li>",row+="</ul></div>",row+='<i class="IC-delete-1px" onclick="Files.Esign.deleteRecConfirm(this, \'action_confirm_btn\');"></i></div>',row+='<div class="FL"><div id="action_confirm_btn" class="DN"><button class="btn btn-default btn-sm FR" onclick="Files.Esign.cancelDelRecConfirm(this);">Cancel</button><button class="btn btn-danger btn-sm FR MR10" onclick=Zohosign.deleteZSignTemp(this,"last");>Confirm</button></div>',row+="</ul>"},constructHRDocuments:function(obj,mode){var row="";if(void 0==obj)return row+='<h4 class="ZPNdt text-center" id="zp_views_nodata">'+ZPI18N.getString("zp.lookup.norecfound")+"</h4>";var createdDate,name=ZPSetupCommon.isEmpty(obj.fileName)?"[No name]":obj.fileName,fileExtn=name.substr(name.lastIndexOf(".")+1,name.length).toLowerCase();return name=ZPSetupCommon.isEmpty(obj.fileName)?"[No name]":obj.fileName.substr(0,obj.fileName.lastIndexOf(".")),obj.fileOwnerName,obj.fileOwnerID,createdDate=obj.fileDate,row+='<ul class="ZPListingUL" href="" fileID="'+obj.fileID+'" id="hrdocTr_'+obj.fileID+'">',row+="pdf"==fileExtn?'<li class="check" id="chdocTr_'+obj.fileID+'"><div class="checkbox"><input type="checkbox" id="'+obj.fileID+'" onclick=Files.Esign.checkParticularFiles(this,"hrdocuments")><label></label></div></li>':'<li class="check" id="chdocTr_'+obj.fileID+'"><div class="checkbox"><input type="checkbox" id="'+obj.fileID+'" onclick=Files.Esign.checkParticularFiles(this,"hrmergedocuments")><label></label></div></li>',row+="pdf"==fileExtn?'<li class="fsize"><div class="fileType icn"><i class="IC-pdf"></i></div>':'<li class="fsize"><div class="fileType icn"><i class="IC-doc"></i></div>',row+='<div class="DIB CP" onclick=Layout.Page.pageContWrapper.parent().prepend(Files.constructPreview(\'hrdocTr_'+obj.fileID+'\',\'hr\'));Files.viewFile(this.parentElement,"hr")><span class="bld">'+name+"</span>",""!=createdDate&&(row+='<span class="DB S13 MT8"><em class="FL gry">Created on '+createdDate+"</em></span>"),row+="</div></div></li>",row+='<li class="tsize"><div><span>'+obj.fileDesc+"</span></div></li>",row+='<li class="actions"><div class="FR">',row+='<div id="moreOptionsParDiv" class="dropdown ZPCusDrs  FL  ML10"><div data-hover="dropdown" data-toggle="dropdown" class="btn btn-sm btn-lgray moreDt"><i class="IC-more"></i></div>',row+='<ul class="dropdown-menu ZPCmn-Arrow top gray CP" id="moreFileOperations">',fileExtn.indexOf("docx")>-1?(row+='<li id= "editCompTemp" onclick="MMtemplte.editMMHRTemplate(\''+obj.filePath+'\')"><i class="IC-pen-1px"></i>'+ZPI18N.getString("zp.edittemp")+"</li>",row+='<li id= "mergeCompTemp" onclick=Files.constructPreview(\'hrdocTr_'+obj.fileID+"','hrdocPdf');Files.viewFile('#chdocTr_"+obj.fileID+'\',"hrdocPdf")><i class="CR-merge"></i>'+ZPI18N.getString("zp.mergeandmove",new Array(Files.compdisname))+"</li>"):row+='<li id= "movehrdoc" onclick=Files.showEdithrdocuments("edit",this,"uploadmode")><i class="IC-move"></i>'+ZPI18N.getString("zp.movetocompfiles",new Array(Files.compdisname))+"</li>",row+="</ul></div>",row+='<i class="IC-delete-1px" onclick="Files.Esign.deleteRecConfirm(this, \'action_confirm_btn\');"></i></div>',fileExtn.indexOf("docx")>-1?row+='<div class="FL"><div id="action_confirm_btn" class="DN"><button class="btn btn-default btn-sm FR" onclick="Files.Esign.cancelDelRecConfirm(this);">'+ZPI18N.getString("zp.cancel")+'</button><button class="btn btn-danger btn-sm FR MR10" onclick=Files.deleteFiles("single",\''+obj.fileID+'\',this,"hrmergedocuments");>'+ZPI18N.getString("zp.confirm")+"</button></div>":row+='<div class="FL"><div id="action_confirm_btn" class="DN"><button class="btn btn-default btn-sm FR" onclick="Files.Esign.cancelDelRecConfirm(this);">'+ZPI18N.getString("zp.cancel")+'</button><button class="btn btn-danger btn-sm FR MR10" onclick=Files.deleteFiles("single",\''+obj.fileID+'\',this,"hrdocuments");>'+ZPI18N.getString("zp.confirm")+"</button></div>",row+="</ul>",(row=$(row)).data("ldata",obj),row},showUpgradePage:function(){Layout.Page.container.find("#upgradediv").removeClass("DN"),$("#zp-contwrap-files-zohosign").addClass("zp_files"),Layout.Page.container.find("#signtempdisp").addClass("DN"),Layout.Page.container.find("#zsignsubscriptionLink").attr("href",Zohosign.paymentUrl)},hideUpgrade:function(){Layout.Page.container.find("#upgradediv").addClass("DN"),$("#zp-contwrap-files-zohosign").removeClass("zp_files"),Layout.Page.container.find("#signtempdisp").removeClass("DN")},constructDataForPreview:function(isImage,filePath,fileOwner,fileCategoryName,name,recepient,documentId,sentDate,aggId){var agreementdtls=[];agreementdtls.fileId=aggId,agreementdtls.filePath=decodeURIComponent(filePath),agreementdtls.fileType=3,agreementdtls.allowDownload=!0,agreementdtls.fileCreateByName=decodeURIComponent(fileOwner),agreementdtls.fileName=decodeURIComponent(name),agreementdtls.sharedTo=recepient,agreementdtls.fileDate=sentDate,agreementdtls.aggId=aggId;var fileExtn=agreementdtls.filePath.substr(agreementdtls.filePath.lastIndexOf(".")+1,agreementdtls.filePath.length),info={};info[ZPI18N.getString("zp.owner")]=ZPeople.escapeHtml(agreementdtls.fileCreateByName),info[ZPI18N.getString("zp.zs.Sentdate")]=agreementdtls.fileDate,info[ZPI18N.getString("zp.type")]=fileExtn,agreementdtls.info=info,Preview.showPreview(agreementdtls,"ESign")},resetFilter:function(){Zohosign.resetFilterOptions(),Zohosign.getDocumentList("","","reset")},resetFilterOptions:function(){var pageId=Layout.Page.container;pageId.find("#filter_params_docFiles").find("span").remove(),pageId.find("#wf_filter_params_docFiles").find("span").remove(),Files.opnclsSearchBreadcrumbs("close");var filterOptions=pageId.find("#search_cat,#search_status,#search_wfstatus,#search_form,#search_perfrmdemp");filterOptions.select2("val","select"),filterOptions.trigger("change"),pageId.find("#search_view").select2("val","ESignatureDocuments"),pageId.find("#search_documentname").val(""),pageId.find("#doc_sentto").val(""),pageId.find("#doc_sentfrom").val("")},resetEsignTempFilter:function(){Zohosign.resetFilterEsignTempOptions(),Zohosign.getETemplateList("","","reset")},resetFilterEsignTempOptions:function(){var pageId=Layout.Page.container;pageId.find("#filter_params_tempFiles").find("span").remove(),Files.opnclsSearchBreadcrumbs("close"),pageId.find("#search_view").val(""),pageId.find("#temp_sentto").val(""),pageId.find("#temp_sentfrom").val("")},isCandidateEmployee:function(){Layout.Page.container.find("input#emailId_search").val(""),Layout.Page.container.find("input#recordId_search").val(""),Layout.Page.container.find("#emailIdsearch").addClass("DNI");var tableName=$("#search_form").find("option:selected").attr("tablename");"P_Employee"!=tableName&&"P_Candidate"!=tableName||Layout.Page.container.find("#emailIdsearch").removeClass("DNI")},searchAgreementsRecord:function(catObj){if(Layout.Page.container.find("button#reset_envBtn").removeClass("DN"),"WorkFlowReports"==Layout.Page.container.find("#search_view").val()){if(Layout.Page.container.find("#filtersubmit").attr("onclick","Zohosign.getDocumentList('','','search','','','','WorkFlowReports')"),Layout.Page.container.find("#search_nameHeader").hasClass("DNI")||(Layout.Page.container.find("#search_nameHeader").addClass("DNI"),Layout.Page.container.find("#doc_sentto").val(""),Layout.Page.container.find("#doc_sentfrom").val("")),Layout.Page.container.find("#docfoldergroup").hasClass("DNI")||Layout.Page.container.find("#docfoldergroup").addClass("DNI"),Layout.Page.container.find("#esignstatus").hasClass("DNI")||Layout.Page.container.find("#esignstatus").addClass("DNI"),Layout.Page.container.find("#esignwfstatus").hasClass("DNI")&&Layout.Page.container.find("#esignwfstatus").removeClass("DNI"),Layout.Page.container.find("#formlist").hasClass("DNI")&&Layout.Page.container.find("#formlist").removeClass("DNI"),ZPSetupCommon.isEmpty(Layout.Page.container.find("select#search_form option"))){var formsListElm="<option value='select' selected='selected'>"+ZPI18N.getString("zp.select")+"</option>";ZPACommon.getFormList(MMtemplte.MODE,!0),$.each(Automation.formList,function(index,obj){formsListElm+="<option value="+obj.formId+" tableName="+obj.tableName+">"+obj.dispName+"</option>"}),Layout.Page.container.find("select#search_form").append(formsListElm).show().select2()}if(Layout.Page.container.find("#perfrmdbylist").hasClass("DNI")&&Layout.Page.container.find("#perfrmdbylist").removeClass("DNI"),ZPSetupCommon.isEmpty(Layout.Page.container.find("select#search_perfrmdemp option"))){var empListElm="<option value='select' selected='selected'>"+ZPI18N.getString("zp.select")+"</option>",params={mode:"GET_MODULE_EMP_LIST",module:"File_Data",conreqcsr:csrfToken};$.ajax({url:"/commonAction.zp",type:"POST",data:params,async:!1,success:function(data){Files.employeeData=data}}),$.each(Files.employeeData.empList,function(index,obj){empListElm+="<option value="+obj.ERECNO+">"+obj.EMPNAME+",&nbsp;"+obj.EMPID+"</option>"}),Layout.Page.container.find("select#search_perfrmdemp").append(empListElm).show().select2()}Layout.Page.container.find("#recordIdsearch").hasClass("DNI")&&Layout.Page.container.find("#recordIdsearch").removeClass("DNI")}else"files_zohosign_templatelistview"!=Layout.Page.urlmode&&Layout.Page.container.find("#filtersubmit").attr("onclick","Zohosign.getDocumentList('','','search')"),Layout.Page.container.find("#search_nameHeader").hasClass("DNI")&&(Layout.Page.container.find("#search_nameHeader").removeClass("DNI"),Layout.Page.container.find("#doc_sentto").val(""),Layout.Page.container.find("#doc_sentfrom").val("")),Layout.Page.container.find("#docfoldergroup").hasClass("DNI")&&Layout.Page.container.find("#docfoldergroup").removeClass("DNI"),Layout.Page.container.find("#esignstatus").hasClass("DNI")&&Layout.Page.container.find("#esignstatus").removeClass("DNI"),Layout.Page.container.find("#esignwfstatus").hasClass("DNI")||Layout.Page.container.find("#esignwfstatus").addClass("DNI"),Layout.Page.container.find("#formlist").hasClass("DNI")||Layout.Page.container.find("#formlist").addClass("DNI"),Layout.Page.container.find("#perfrmdbylist").hasClass("DNI")||Layout.Page.container.find("#perfrmdbylist").addClass("DNI"),Layout.Page.container.find("#emailIdsearch").hasClass("DNI")||Layout.Page.container.find("#emailIdsearch").addClass("DNI"),Layout.Page.container.find("#recordIdsearch").hasClass("DNI")||Layout.Page.container.find("#recordIdsearch").addClass("DNI")},getDocumentViewPage:function(thisObj,recId){var envId;Files.fromcompFilesReportPage&&(Zohosign.reportSliderclose=!0),envId=ZPSetupCommon.isEmpty(thisObj)?recId:$(thisObj).closest("ul").attr("documentId"),window.location.href=Layout.Page.hash+"-documentId:"+envId},getDocumentPreview:function(agreementId,thisObj,mode){var agrId,moduleType,formId,recId;-1===Layout.Page.hash.indexOf("-formId:")&&(agrId=Layout.Page.hash.split("documentId:")[1]),Layout.Page.hash.indexOf("documentlistview-documentId")>-1||-1!==Layout.Page.hash.indexOf("hrfile")?moduleType="1":Layout.Page.hash.indexOf("-formId:")>-1?("form",moduleType="2",agrId=agreementId,void 0==(recId=ZPForm.CURRFORM_PARAM.recordId)&&(recId=$(thisObj).closest("tr").attr("recordId")),formId=Layout.Page.urlparam.formId):(moduleType="2","form",void 0!=agreementId&&(agrId=agreementId),recId=thisObj,formId=Layout.Page.urlparam.formId),-1===Layout.Page.hash.indexOf("hrfile")&&"selffiles"!=mode||void 0!=agreementId&&(recId=agrId=agreementId,moduleType="1"),ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",{action:"getDocumentStatus",conreqcsr:csrfToken,documentId:agrId,moduleType:moduleType,formId:formId,recordId:recId},Zohosign.constructDocumentInfo,agrId)},viewRecipients:function(obj){Layout.Page.container.find(obj).parent().parent().parent().hasClass("sel")?Layout.Page.container.find(obj).parent().parent().parent().removeClass("sel"):Layout.Page.container.find(obj).parent().parent().parent().addClass("sel")},getsingleRecordconst:function(obj){obj=$(obj).parent();var relobj=$(obj).find("a"),recordid=ZPForm.CURRFORM_PARAM.recordId,formId=ZPForm.CURRFORM_PARAM.formId,viewObj=$(relobj).parent().parent().parent().find("#documents_list_form");if(viewObj.is(":visible"))return relobj.hasClass("collapsed")||relobj.addClass("collapsed"),void viewObj.slideUp();if($(viewObj).find(".ZPListingUL").children().length>0&&(relobj.removeClass("collapsed"),viewObj.slideDown()),$(relobj).parent().parent().parent().find("#documents_list_form").remove(),$.ajax({type:"POST",async:!1,url:"/zohoSignActions.zp",data:{action:"getEsignRecords",conreqcsr:csrfToken,recordId:recordid,formId:formId},success:function(data){Zohosign.recordAgreementList=data[1].agreementList}}),void 0==isAdobeReadView&&(Zohosign.populateDocumentView(),$.ajax({type:"POST",async:!1,url:"/zohoSignActions.zp",data:{action:"loginUserRolecheckAccess",conreqcsr:csrfToken},success:function(data){isAdobeReadView=data[1].isAdobeReadView,isDocuReadView=data[1].isDocuReadView,isZohoReadView=data[1].isZohoReadView}})),""!=Zohosign.recordAgreementList&&void 0!=Zohosign.recordAgreementList&&!ZPSetupCommon.isEmpty(Zohosign.recordAgreementList)&&Zohosign.recordAgreementList.length>0){for(var recordIdArr="",recCount=Zohosign.recordAgreementList.length,i=0;i<recCount;i++)i>=1&&(recordIdArr+=","),recordIdArr+=Zohosign.recordAgreementList[i];$.ajax({type:"POST",async:!1,url:"/zohoSignActions.zp",data:{action:"getDocuments",conreqcsr:csrfToken,limit:24,startInd:1,sortOrder:void 0,recordIdList:recordIdArr,sortColumn:void 0,sentFrom:void 0,sentTo:void 0,isDocuSign:!1,isZohoSign:!1,noModuleCheck:!0,type:"form",formId:formId},success:function(data){var agreementsListElms="",relobj=$(obj).find("a"),viewObj=$(relobj).parent().parent().parent().find("#documents_list_form");data[1].length>0?($.each(data[1],function(index,obj){obj.hasOwnProperty("limit")||(agreementsListElms+=0==index?Zohosign.constructDocumentData(obj,"formsHeader"):Zohosign.constructDocumentData(obj,"forms"))}),relobj.removeClass("collapsed"),viewObj='<div class="ZPListing ZPLagree" id="documents_list_form">'+agreementsListElms+"</div>",$(relobj).parent().parent().parent().append(viewObj)):(agreementsListElms='<h4 class="ZPNdt text-center" id="zp_views_nodata">No records found</h4>',istElms='<h4 class="ZPNdt text-center" id="zp_views_nodata">No records found</h4>',relobj.removeClass("collapsed"),viewObj='<div class="ZPListing ZPLagree" id="documents_list_form">'+agreementsListElms+"</div>",$(relobj).parent().parent().parent().append(viewObj))}}),Zohosign.recordAgreementList=""}else agreementsListElms='<h4 class="ZPNdt text-center" id="zp_views_nodata">'+ZPI18N.getString("zp.lookup.norecfound")+"</h4>",istElms='<h4 class="ZPNdt text-center" id="zp_views_nodata">No records found</h4>',relobj.removeClass("collapsed"),viewObj='<div class="ZPListing ZPLagree" id="documents_list_form">'+agreementsListElms+"</div>",$(relobj).parent().parent().parent().append(viewObj)},getsingleRecordconstold:function(obj){obj=$(obj).parent();var relobj=$(obj).find("a"),viewObj=(ZPForm.CURRFORM_PARAM.recordId,$(relobj).parent().parent().parent().find("#documents_list_form"));if(viewObj.is(":visible"))return relobj.hasClass("collapsed")||relobj.addClass("collapsed"),void viewObj.slideUp();if($(viewObj).find(".ZPListingUL").children().length>0)return relobj.removeClass("collapsed"),void viewObj.slideDown();$(relobj).parent().parent().parent().find("#documents_list_form").remove();var recorddetails=Layout.Page.container.find("#zp_view_record_"+ZPForm.CURRFORM_PARAM.recordId).closest("tr")[0],aggreeID=(ZPForm.CURRFORM_PARAM.recordId,""),agreementsListElms="",esignmodule="";if(void 0==recorddetails&&void 0!=ZPView.newRecordDetails.agreeid?(aggreeID=ZPView.newRecordDetails.agreeid,esignmodule=ZPView.newRecordDetails.module):void 0!=Layout.Page.container.find("#zp_view_record_"+ZPForm.CURRFORM_PARAM.recordId).closest("tr")[0]?(aggreeID=Layout.Page.container.find("#zp_view_record_"+ZPForm.CURRFORM_PARAM.recordId).closest("tr")[0].getAttribute("agreeId"),esignmodule=Layout.Page.container.find("#zp_view_record_"+ZPForm.CURRFORM_PARAM.recordId).closest("tr")[0].getAttribute("module")):(aggreeID=null,esignmodule=null),"undefined"!=aggreeID&&"null"!=aggreeID&&null!=aggreeID){var isDocuSign=!1,isZohoSign=!0;1!=esignmodule&&2!=esignmodule||(isZohoSign=!1),4!=esignmodule&&3!=esignmodule||(isDocuSign=!0),$.ajax({type:"POST",async:!1,url:"/zohoSignActions.zp",data:{action:"getDocuments",conreqcsr:csrfToken,limit:24,startInd:1,sortOrder:void 0,sortColumn:void 0,sentFrom:void 0,sentTo:void 0,documentId:aggreeID,isDocuSign:isDocuSign,isZohoSign:isZohoSign},success:function(data){agreementsListElms=Zohosign.constructDocumentData(data,"forms"),relobj.removeClass("collapsed"),viewObj='<div class="ZPListing ZPLagree" id="documents_list_form">'+agreementsListElms+"</div>",$(relobj).parent().parent().parent().append(viewObj)}})}else agreementsListElms='<h4 class="ZPNdt text-center" id="zp_views_nodata">No records found</h4>',istElms='<h4 class="ZPNdt text-center" id="zp_views_nodata">No records found</h4>',relobj.removeClass("collapsed"),viewObj='<div class="ZPListing ZPLagree" id="documents_list_form">'+agreementsListElms+"</div>",$(relobj).parent().parent().parent().append(viewObj)},constructDocumentInfo:function(infoData,params,documentId){var documentInfo=infoData[1];if(Layout.Page.hash.indexOf("-formId:")>-1&&jQuery.isEmptyObject(documentInfo))ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.agreementdeleted"));else{var recipientInfoRow="";if((pageId=Layout.Page.container).find("tr[documentId='"+documentId+"']").data("agreements_data")||pageId.find("table#agreements_list").find("tr[documentId='"+documentId+"']").data({agreements_data:documentInfo}),ZPeople.BSModal.setup({id:"viewDocumentModal",type:22,modalClass:"popRgtModel fileAgrModal in",header:Zohosign.view.header,body:Zohosign.view.bodymainContent,footer:Zohosign.view.footer}),pageId.find("#activityDiv").remove(),Files.Esign.constructActivityDetailsDiv(),documentInfo.hasOwnProperty("RINFO"))for(var recipientInfo=documentInfo.RINFO,recipientInfoKeys=Object.keys(recipientInfo).sort(),recpLen=Object.keys(recipientInfo).length,i=0;i<recpLen;i++){var reciepentObj=recipientInfo[recipientInfoKeys[i]];recipientInfoKeys[i];recipientInfoRow+='<li><div class="dtable"><div class="ph">',null!==reciepentObj.RCD&&void 0!==reciepentObj.RCD&&""!==reciepentObj.RCD&&(recipientInfoRow+='<i class="IC-task-chk grn"></i>'),recipientInfoRow+='<div class="fileType BGtxt"><span>'+reciepentObj.RN.charAt(0).toUpperCase()+"</span></div></div>",recipientInfoRow+='<div class="user"><b class="DB">'+reciepentObj.RN+'</b> <span class="dgry">'+reciepentObj.RN+"</span></div>","SIGNER"==reciepentObj.RT?recipientInfoRow+='<div class="sign"><i class="CR-sign cirIcon" data-toggle="tooltip" data-original-title="'+reciepentObj.RT+'" title="" data-placement="bottom"></i></div>':"APPROVER"==reciepentObj.RT?recipientInfoRow+='<div class="sign"><i class="CR-approval cirIcon" data-toggle="tooltip" data-original-title="'+reciepentObj.RT+'" title="" data-placement="bottom"></i></div>':recipientInfoRow+='<div class="sign"><i class="IC-eye1 cirIcon" data-toggle="tooltip" data-original-title="'+reciepentObj.RT+'" title="" data-placement="bottom"></i></div>',reciepentObj.hasOwnProperty("RS")?"SIGNED"==reciepentObj.RS.toUpperCase()?(recipientInfoRow+='<div class="status"><b class="DB">'+ZPI18N.getString("zp.local.CompletedOn")+"</b>",recipientInfoRow+='<span class="dgry">'+reciepentObj.RCD+"</span>"):(recipientInfoRow+='<div class="status"><b class="DB">'+ZPI18N.getString("zp.status")+"</b>",recipientInfoRow+='<span class="dgry">'+reciepentObj.RS+"</span>"):(recipientInfoRow+='<div class="status"><b class="DB">'+ZPI18N.getString("zp.status")+"</b>",recipientInfoRow+='<span class="dgry"></span>'),recipientInfoRow+='<i class="CP IC-ar-dwn cirIcon" onclick="Zohosign.viewRecipients(this)"></i></div></div>',recipientInfoRow+='<div class="dtable expnd"><div><b class="DB">Type</b><span class="dgry">'+reciepentObj.RT+"</span>",recipientInfoRow+='</div><div><b class="DB">Order</b><span class="dgry">'+reciepentObj.RO+"</span></div><div>",recipientInfoRow+='<b class="DB">'+ZPI18N.getString("zp.reciepentdelivered")+'</b><span class="dgry">'+reciepentObj.RDD+"</span></div></div></li>"}var viewDocumentModal=pageId.find("div#viewDocumentModal");viewDocumentModal.attr("name","esign"),viewDocumentModal.attr("recordId",params.recordId),recipientInfoRow=""===recipientInfoRow?Agreements.norecElm:recipientInfoRow;var eventInfoRow="";if(documentInfo.hasOwnProperty("EINFO")){var eventInfo=documentInfo.EINFO;$.each(eventInfo,function(eventId,eventObj){eventInfoRow+='<div class="event dot">',eventInfoRow+="<p>"+eventObj.N+"<em>"+eventObj.ED+"</em></p>",eventInfoRow+="<div>"+eventObj.EDESC+"</div>",eventInfoRow+="</div>"})}eventInfoRow=""===eventInfoRow?Agreements.norecElm:eventInfoRow;var attachmentsRow="",fileowner="";if(documentInfo.hasOwnProperty("DINFO")){var pageId=Layout.Page.container,dInfo=documentInfo.DINFO;pageId.find("b#agName").text(dInfo.name),pageId.find("span#agOwner").text(dInfo.owner),pageId.find("#senderProfile").attr("src",dInfo.senderPhoto),pageId.find("span#sentDate").text(dInfo.sentDate),fileowner=dInfo.owner,catId=dInfo.catId,"-"!=dInfo.sentDate&&pageId.find("span#doc_sent_date").text(dInfo.sentDate),"-"!=dInfo.completeDate&&pageId.find("span#completed_date").text(dInfo.completeDate),"-"!=dInfo.lastDate?(pageId.find("b#deadLine").text(dInfo.lastDate),pageId.find("#showExp").attr("onclick","Zohosign.showExpiryPop('"+dInfo.lastDate+"')")):(pageId.find("#deadLine").parents("div")[0].remove(),pageId.find("#showExp").attr("onclick","Zohosign.showExpiryPop()")),""!=dInfo.message&&"-"!=dInfo.message?pageId.find("#agr_msg").html(dInfo.message):pageId.find("#agr_msg").parents("div")[0].remove(),fileCategoryname=Files.newCategoryList[catId],pageId.find("b#status").text(dInfo.status),"Completed"==dInfo.status&&pageId.find("i#taskCompleted").addClass("IC-task-chk grn FR"),"-"!=dInfo.sendmail_copies?pageId.find("b#mail_copies").text(dInfo.sendmail_copies):pageId.find("#mail_copies").parents("div")[0].remove(),void 0==isZohoReadView&&Zohosign.getReadView(),"SENT"==dInfo.status.toUpperCase()||"EXPIRED"==dInfo.status.toUpperCase()?isZohoReadView||(pageId.find("#send_remindBtn").show(),pageId.find("#showExpdropdown").removeClass("DNI"),"SENT"==dInfo.status.toUpperCase()&&(pageId.find("#cancelDocBtn").show(),pageId.find("#send_remindBtn").text(ZPI18N.getString("zp.sendreminder")),pageId.find("#send_remindBtn").attr("onclick",'ZPeople.confirm(this,"zp.zpalert","zp.confirmremind",Zohosign.sendReminder,"","","","","")')),"EXPIRED"==dInfo.status.toUpperCase()&&(pageId.find("#cancelDocBtn").addClass("DN"),pageId.find("#otherDropdown").addClass("DN"),"-"!=dInfo.lastDate?pageId.find("#send_remindBtn").attr("onclick","Zohosign.showExpiryPop('"+dInfo.lastDate+"')"):pageId.find("#send_remindBtn").attr("onclick","Zohosign.showExpiryPop()"),pageId.find("#send_remindBtn").text(ZPI18N.getString("zp.extendexpiry")))):(pageId.find("#send_remindBtn").addClass("DN"),pageId.find("#cancelDocBtn").addClass("DN"),pageId.find("#otherDropdown").addClass("DN")),pageId.find(".Scrcont .ZPSdiv").last().addClass("bn")}if(documentInfo.hasOwnProperty("AINFO")){var attachmentDtls=documentInfo.AINFO,attachmentsRownew="";$.each(attachmentDtls,function(pkId,attachmentsDtls){var encodeFileName=encodeURIComponent(attachmentsDtls.fileName),encodeFilePath=encodeURIComponent(attachmentsDtls.fP);attachmentsRow+="";var fileEObj="",fileExtn=(fileEObj=""==attachmentsDtls.fP?encodeFileName:encodeFilePath).substr(fileEObj.lastIndexOf(".")+1,fileEObj.length).toLowerCase(),fileIconextn=Files.Esign.fileIcons(fileExtn);"jpg"===fileExtn||"jpeg"===fileExtn||"gif"===fileExtn||"png"===fileExtn||"gif"===fileExtn?(attachmentsRownew+='<div class="attDivBox"><span class="FL"><i class="IC-'+fileIconextn+'"></i></span><span class="FL dtl">',attachmentsRownew+='<span class="DB CP" onclick=Zohosign.constructDataForPreview(true,"'+encodeFilePath+'","'+encodeURIComponent(fileowner)+'","'+encodeURIComponent(fileCategoryname)+'","'+encodeFileName+'","'+documentInfo.RINFO.RN+'","'+documentId+'","'+documentInfo.DINFO.sentDate+'","'+pkId+'");Agreements.downloadAttachement(this,"'+pkId+'","view","'+encodeFileName+'","'+encodeFilePath+'")><a class="CP">'+attachmentsDtls.fileName+'</a></span> <span class="DB dgry S12 MT5">'+attachmentsDtls.ED+"</span></span>",attachmentsRownew+='<span class="FR"><i class="IC-down" onclick=Agreements.downloadAttachement(this,"'+pkId+'","download","'+encodeFileName+'","'+encodeFilePath+'")></i></span></div>'):(attachmentsRownew+='<div class="attDivBox"> <span class="FL"> <i class="IC-'+fileIconextn+'"></i></span><span class="FL dtl">',attachmentsRownew+='<span class="DB CP" onclick=Zohosign.constructDataForPreview(false,"'+encodeFilePath+'","'+encodeURIComponent(fileowner)+'","'+encodeURIComponent(fileCategoryname)+'","'+encodeFileName+'","'+documentInfo.RINFO.RN+'","'+documentId+'","'+documentInfo.DINFO.sentDate+'","'+pkId+'");Agreements.downloadAttachement(this,"'+pkId+'","view","'+encodeFileName+'","'+encodeFilePath+'")><a class="CP">'+attachmentsDtls.fileName+'</a></span> <span class="DB dgry S12 MT5">'+attachmentsDtls.ED+"</span></span>",attachmentsRownew+='<span class="FR"><i class="IC-down" onclick=Agreements.downloadAttachement(this,"'+pkId+'","download","'+encodeFileName+'","'+encodeFilePath+'")></i></span></div>')}),Layout.Page.container.find("div#attachmentsData").append(attachmentsRownew)}Agreements.setAgreementsDtlsValue(documentId),attachmentsRow=""===attachmentsRow?Agreements.norecElm:attachmentsRow,pageId.find("ul#recipientsList").html(recipientInfoRow),pageId.find("#actDetails").html(eventInfoRow),pageId.find("tbody#attachments_Info").html(attachmentsRow),pageId.find("i#agrm_filterIc").attr("class","IC-filter S18 CP FR ML20 MT5 gry");var previewActions=viewDocumentModal.find("div#preview_actions");viewDocumentModal.attr("documentId",documentId),"Cancelled / Declined"===pageId.find("span#status").text()||"Completed"===pageId.find("span#status").text()?previewActions.hide():previewActions.show()}},deleteAgreementConfirm:function(thisObj){ZPeople.confirm(this,"zp.zpalert","zp.deleteRecord","","","",ZPI18N.getString("zp.delete"),"",!0),$("#confirmConfirmationPopup").attr("onclick","Zohosign.deleteAgreementRecord('','first')")},deleteZSignTempConfirm:function(thisObj){ZPeople.confirm(this,"zp.zpalert","zp.deleteRecord","","","",ZPI18N.getString("zp.delete"),"",!0),$("#confirmConfirmationPopup").attr("onclick","Zohosign.deleteZSignTemp('','first')")},deleteZSignTemp:function(thisObj,position){var recordIdArr="",moduleType="";if("first"==position)for(var deleteArray=Layout.Page.container.find("#signtemplate_list").find('input[type="checkbox"]:checked'),deleteCount=deleteArray.length,i=0;i<deleteCount;i++)i>=1&&(recordIdArr+=","),recordIdArr+=Layout.Page.container.find(deleteArray[i]).parent().parent().parent().attr("tempid");else moduleType="2",recordIdArr=$(thisObj).closest("ul").attr("tempid");ZPeople.Request.send("/zsign.zp",{action:"deleteZSignTemplate",conreqcsr:csrfToken,recordIdList:recordIdArr,recordId:"",moduleType:moduleType,formId:""},Zohosign.deleteCallBack,thisObj)},deleteAgreementRecord:function(thisObj,position){var recordIdArr="",moduleType="",formId="",recordId="";if("first"==position)for(var deleteArray=Layout.Page.container.find("#documents_list").find('input[type="checkbox"]:checked'),deleteCount=deleteArray.length,i=0;i<deleteCount;i++)i>=1&&(recordIdArr+=","),recordIdArr+=Layout.Page.container.find(deleteArray[i]).parent().parent().parent().attr("documentid");else(void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1)&&(void 0===(formId=Layout.Page.urlparam.formId)&&(formId=ZPForm.CURRFORM_PARAM.formId),formId=formId,recordId=ZPForm.CURRFORM_PARAM.recordId),moduleType="2",recordIdArr=$(thisObj).closest("ul").attr("documentId");ZPeople.Request.send("/zsign.zp",{action:"deleteDocument",conreqcsr:csrfToken,recordIdList:recordIdArr,recordId:recordId,moduleType:moduleType,formId:formId},Zohosign.deleteCallBack,thisObj)},deleteCallBack:function(data,params,thisObj){var pageId=Layout.Page.container;if(data[1].isDeleted){if(void 0==isAnySignConfigured&&Zohosign.getEsignConfigurations(),$(pageId.find("#documents_list").find('input[type="checkbox"]:checked').length)[0]>0)$(pageId.find("#documents_list").find('input[type="checkbox"]:checked')).closest("ul").remove(),Layout.Page.container.find("#doc_multiselDel").hide(),Layout.Page.container.find("#doc_HeaderBar").show();else if(2===pageId.find("#documents_list_form").find("ul").length){var esignDocumentmethod="";isAdobeConfig?esignDocumentmethod='ZPView.sendForSignDocs("adobe")':isDocuConfig?esignDocumentmethod='ZPView.sendForSignDocs("")':isZSConfig&&(esignDocumentmethod='ZPView.sendForSignDocs("zsign","true")');var headerToggle=$(thisObj).parent().parent().parent().parent().parent().parent().find("a")[0];$(headerToggle).after('<div id ="bigPlusforSign" class="IC-plus-big togg-plus"onclick='+esignDocumentmethod+"></div>"),Layout.Page.container.find("#anchor_single_doc_list").addClass("collapsed"),$(thisObj).closest("#documents_list_form").remove()}else $(pageId.find("#signtemplate_list").find('input[type="checkbox"]:checked').length)[0]>0?($(pageId.find("#signtemplate_list").find('input[type="checkbox"]:checked')).closest("ul").remove(),Layout.Page.container.find("#doc_multiselDel").hide(),Layout.Page.container.find("#doc_HeaderBar").show()):$(pageId.find("#hrdoc_list").find('input[type="checkbox"]:checked').length)[0]>0?($(pageId.find("#hrdoc_list").find('input[type="checkbox"]:checked')).closest("ul").remove(),Layout.Page.container.find("#doc_multiselDel").hide(),Layout.Page.container.find("#doc_HeaderBar").show()):$(thisObj).closest("ul").remove();0===pageId.find("#documents_list").find("ul").length&&"files_zohosign_templatelistview"==!Layout.Page.urlmode?(Layout.Page.container.find("#document_norecords .ctable").remove(),Zohosign.newuinorecords(),pageId.find("#documents_list").addClass("DN"),pageId.find("#documents_listingpage").addClass("DN"),pageId.find("#documents_listingpage").removeClass("expand")):0===pageId.find("#signtemplate_list").find("ul.ZPListingUL").length&&"files_zohosign_templatelistview"==Layout.Page.urlmode?(Layout.Page.container.find("#temp_norecords .ctable").remove(),Zohosign.newuinorecords(),pageId.find("#signtemplate_list").addClass("DN"),pageId.find("#signtemplate_listingpage").addClass("DN"),pageId.find("#signtemplate_listingpage").removeClass("expand")):0===pageId.find("#hrdoc_list").find("ul.ZPListingUL").length&&"files_hrdocuments_listview"==Layout.Page.urlmode&&(Layout.Page.container.find("#temp_norecords .ctable").remove(),Zohosign.newuinorecords(),pageId.find("#hrdoc_list").addClass("DN"),pageId.find("#hrdoc_listingpage").addClass("DN"),pageId.find("#hrdoc_listingpage").removeClass("expand")),"deleteZSignTemplate"==params.action?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.zs.signtempdeletedsuccessfully")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.zs.documentdeletedsuccessfully"))}else"deleteZSignTemplate"==params.action?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.zs.signtempnotdeleted")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.zs.documentnotdeleted"))},noFilesFoundConst:function(value){var noFilesFound="";return noFilesFound+='<div class="ctable"><div class="ctcell"><div class="ZPNdata">',noFilesFound+='<i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i>',noFilesFound+='<i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i>',noFilesFound+=void 0!=value?'<h5 id="zp_views_nodata">'+value+"</h5></div></div></div>":'<h5 id="zp_views_nodata">'+ZPI18N.getString("zp.lookup.norecfound")+"</h5></div></div></div>"},newuinorecords:function(){var pageId=Layout.Page.container;pageId.find("div#documents_list").addClass("DN"),pageId.find("div#documents_listingpage").addClass("DN"),pageId.find("#documents_listingpage").removeClass("expand"),pageId.find("#document_norecords").removeClass("DN"),pageId.find("#document_norecords").addClass("Scrcont"),pageId.find("#document_norecords").append(Zohosign.noFilesFoundConst())},newuinorecordsSigntemp:function(){var pageId=Layout.Page.container;pageId.find("div#signtemplate_list").addClass("DN"),pageId.find("div#signtemplatelistingpage").addClass("DN"),pageId.find("#signtemplatelistingpage").removeClass("expand"),pageId.find("#temp_norecords").removeClass("DN"),pageId.find("#temp_norecords").addClass("Scrcont"),pageId.find("#temp_norecords").append(Zohosign.noFilesFoundConst())},newuinohrDocrecords:function(value){var pageId=Layout.Page.container;pageId.find("div#hrdoc_list").addClass("DN"),pageId.find("div#hrdoc_listingpage").addClass("DN"),pageId.find("#hrdoc_listingpage").removeClass("expand"),pageId.find("#hrdoc_norecords").removeClass("DN"),pageId.find("#hrdoc_norecords").addClass("Scrcont");var currScrollContObj=pageId.find("#hrdoc_norecords");""!=value?currScrollContObj.append(Zohosign.noFilesFoundConst(value)):currScrollContObj.append(Zohosign.noFilesFoundConst(ZPI18N.getString("zp.nodatafound")))},validation:function(formData){var createAgr=Layout.Page.container.find("div#createDocumentModal"),recipientsElms=createAgr.find("*[id=recpList]"),document_name_elm=createAgr.find("#document_name").val(),document_message_len=createAgr.find("#document_message").val(),catId=createAgr.find("select#agrselect_Cat").val(),redSuccess=(createAgr.find("input#hrnewCategory").val(),createAgr.find("input[name='deadline']").val(),createAgr.find("select#templates").val(),createAgr.find("input#redSuccess").val()),redCompleted=createAgr.find("input#redCompleted").val(),redDeclined=createAgr.find("input#redDeclined").val(),redLater=createAgr.find("input#redLater").val();$(".ERR").remove();var err=!1,maxSize=1e6*maxFileSize.split("MB")[0];Zohosign.checkZSFeature();var urlregex=new RegExp("^(ht|f)tp(s?)://[-.w]*(/?)([a-zA-Z0-9-.?,:'/\\+=&amp;%$#_@]*)?$");if(void 0!=redSuccess&&0!=redSuccess.length&&(Zohosign.zsFeatureList.redirection?urlregex.test(redSuccess)||(errMsg=ZPI18N.getString("zp.cbtmapacturlempty"),err=!0,Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#redSuccess").parent().next("div[name=errormsg]").append('<span class="ERR" id="errormsg">'+errMsg+"</span>"):createAgr.find("#redSuccess").after('<span class="ERR" id="errormsg">'+errMsg+"</span>")):(errMsg=ZPI18N.getString("zp.zsenterpriseerr"),err=!0,Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#redSuccess").parent().next("div[name=errormsg]").append('<span class="ERR" id="errormsg">'+errMsg+"</span>"):createAgr.find("#redSuccess").after('<span class="ERR" id="errormsg">'+errMsg+"</span>"))),void 0!=redCompleted&&0!=redCompleted.length&&(Zohosign.zsFeatureList.redirection?urlregex.test(redCompleted)||(err=!0,errMsg=ZPI18N.getString("zp.cbtmapacturlempty"),Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#redCompleted").parent().next("div[name=errormsg]").append('<span class="ERR" id="errormsg">'+errMsg+"</span>"):createAgr.find("#redCompleted").after('<span class="ERR" id="errormsg">'+errMsg+"</span>")):(errMsg=ZPI18N.getString("zp.zsenterpriseerr"),err=!0,Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#redCompleted").parent().next("div[name=errormsg]").append('<span class="ERR" id="errormsg">'+errMsg+"</span>"):createAgr.find("#redCompleted").after('<span class="ERR" id="errormsg">'+errMsg+"</span>"))),void 0!=redDeclined&&0!=redDeclined.length&&(Zohosign.zsFeatureList.redirection?urlregex.test(redDeclined)||(err=!0,errMsg=ZPI18N.getString("zp.cbtmapacturlempty"),Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#redDeclined").parent().next("div[name=errormsg]").append('<span class="ERR" id="errormsg">'+errMsg+"</span>"):createAgr.find("#redDeclined").after('<span class="ERR" id="errormsg">'+errMsg+"</span>")):(errMsg=ZPI18N.getString("zp.zsenterpriseerr"),err=!0,Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#redDeclined").parent().next("div[name=errormsg]").append('<span class="ERR" id="errormsg">'+errMsg+"</span>"):createAgr.find("#redDeclined").after('<span class="ERR" id="errormsg">'+errMsg+"</span>"))),void 0!=redLater&&0!=redLater.length&&(Zohosign.zsFeatureList.redirection?urlregex.test(redLater)||(err=!0,errMsg=ZPI18N.getString("zp.cbtmapacturlempty"),Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#redLater").parent().next("div[name=errormsg]").append('<span class="ERR" id="errormsg">'+errMsg+"</span>"):createAgr.find("#redLater").after('<span class="ERR" id="errormsg">'+errMsg+"</span>")):(errMsg=ZPI18N.getString("zp.zsenterpriseerr"),err=!0,Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#redLater").parent().next("div[name=errormsg]").append('<span class="ERR" id="errormsg">'+errMsg+"</span>"):createAgr.find("#redLater").after('<span class="ERR" id="errormsg">'+errMsg+"</span>"))),!Zohosign.isFromFormView&&-1!==Layout.Page.hash.indexOf("documentlistview")){var agmntFile=createAgr.find("#uploadfile")[0].files[0];if(agmntFile||"cloudUpload"===Files.uploadMode){if(agmntFile&&(agmntFile.size>maxSize?(err=!0,createAgr.find("#uploadfile").closest("div#err_div").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.customizedfilesizelimit",new Array(maxFileSize))+"</span>")):createAgr.find("#uploadfile").closest("div#err_div").next("span#errormsg").remove()),!err){var fileExtn=createAgr.find("span#drop_file").find("span").text();fileExtn=fileExtn.substr(fileExtn.lastIndexOf(".")+1,fileExtn.length),-1===Zohosign.zsignEtxns.indexOf(fileExtn.toLowerCase())?(err=!0,createAgr.find("#uploadfile").closest("div#err_div").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.zs.choosepdffile")+"</span>")):createAgr.find("#uploadfile").closest("div#err_div").next("span#errormsg").remove()}}else err=!0,createAgr.find("#uploadfile").closest("div#err_div").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.choosedoc")+"</span>")}if(ZPSetupCommon.isEmpty(document_name_elm)){err=!0;var errMsg=ZPI18N.getString("zp.zs.documentnameempty");Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#document_name").closest("#docNameInputTag").next("div[name=errormsg]").append('<span class="ERR" id="errormsg">'+errMsg+"</span>"):createAgr.find("#document_name").after('<span class="ERR" id="errormsg">'+errMsg+"</span>")}if(-1==document_name_elm.indexOf("<")&&-1==document_name_elm.indexOf(">")||(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.filesexcludesplchars",new Array(ZPI18N.getString("zp.name")))),err=!0),document_name_elm.length>100&&(err=!0,Layout.Page.hash.indexOf("workflow/actions/esign")>-1||Layout.Page.hash.indexOf("customaction")>-1?createAgr.find("#document_name").closest("#docNameInputTag").next("div[name=errormsg]").append('<span id="errormsg" class="ERR">'+ZPI18N.getString("zp.lengthvalidation",new Array(ZPI18N.getString("zp.name"),100))+"</span>"):createAgr.find("#document_name").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.lengthvalidation",new Array(ZPI18N.getString("zp.name"),100))+"</span>")),!ZPSetupCommon.isEmpty(document_message_len)&&document_message_len.length>=5e3&&(err=!0,(!Layout.Page.hash.indexOf("workflow/actions/esign")>-1&&!Layout.Page.hash.indexOf("automation/workflow/list")>-1||Layout.Page.hash.indexOf("customaction")>-1)&&createAgr.find("#document_message").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.lengthvalidation",new Array(ZPI18N.getString("zp.message"),5e3))+"</span>")),Zohosign.isFromFormView&&(createAgr.find("#uploadfile").is(":visible")&&(ZPSetupCommon.isEmpty(createAgr.find("#uploadfile").val())||"select"===createAgr.find("#uploadfile").val()?createAgr.find("#uploadfile").parent().after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectfileupload")+"</span>"):createAgr.find("#uploadfile").parent().next("span#errormsg").remove()),createAgr.find("#templates").is(":visible")&&(ZPSetupCommon.isEmpty(createAgr.find("#templates").val())||"0"===createAgr.find("#templates").val()?createAgr.find("#templates").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectfileupload")+"</span>"):createAgr.find("#templates").next("span#errormsg").remove())),!Zohosign.isWorkflow&&"files_companyfile_listview"!=Layout.Page.urlmode&&"files_companyfile_view"!=Layout.Page.urlmode&&"files_zohosign_templatelistview"!=Layout.Page.urlmode){var recipientsMailIds=recipientsElms.val();if(ZPSetupCommon.isEmpty(recipientsMailIds)||"select"===recipientsMailIds){err=!0;errMsg=recipientsElms.is("input")?ZPI18N.getString("zp.entervalidemailaddress"):ZPI18N.getString("zp.selectemailidfield");createAgr.find("#recpList").after('<span class="ERR" id="errormsg">'+errMsg+"</span>")}else recipientsElms.is("input")&&(err=Agreements.validateMailIds(recipientsMailIds.split(","),createAgr.find("#recpList"),ZPI18N.getString("zp.entervalidemailaddress")))}if(createAgr.find("div#s2id_agrselect_Cat").is(":visible")&&"select"===catId||"0"===catId?(err=!0,createAgr.find("#agrselect_Cat").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectcategory")+"</span>")):createAgr.find("input#hrnewCategory").is(":visible")&&ZPSetupCommon.isEmpty(createAgr.find("input#hrnewCategory").val())?(err=!0,createAgr.find("#hrnewCategory").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.enterCategory")+"</span>")):createAgr.find("#agrselect_Cat").parent().find("span#errormsg").remove(),"files_companyfile_listview"==Layout.Page.urlmode||"files_companyfile_view"==Layout.Page.urlmode||"files_zohosign_templatelistview"==Layout.Page.urlmode){var noOfDays=createAgr.find("input[name=noOfDays]").val();ZPSetupCommon.isEmpty(noOfDays)||(noOfDays>0&&noOfDays<99?formData.append("noOfDays",noOfDays):noOfDays>99?(createAgr.find("input[name=noOfDays]").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.zohosignexplimit")+"</span>"),err=!0):(createAgr.find("input[name=noOfDays]").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.validvalue")+"</span>"),err=!0))}if(createAgr.find("input#reminder_check").is(":checked")||Layout.Page.hash.indexOf("customaction")>-1){var freqReminder=createAgr.find("div#reminder_freqdayscnt input").val();0!=(freqReminder=ZPSetupCommon.isEmpty(freqReminder)?"0":freqReminder)&&(freqReminder>=1&&freqReminder<=98?formData.append("reminder_freqdays",freqReminder):(createAgr.find("#reminder_freq").append('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.zohosignreminderlimit")+"</span>"),err=!0))}var smc=createAgr.find("#copyList").val();if(ZPSetupCommon.isEmpty(smc)||(smc.split(",").length>50?createAgr.find("#copyList").after('<span class="ERR" id="errormsg" errmsg="mailids">'+ZPI18N.getString("zp.maildidslengthunlimit")+"</span>"):(createAgr.find("#copyList").parent().find("span#errormsg").remove(),Zohosign.validateMailIds(smc.split(","),createAgr.find("#copyList"),ZPI18N.getString("zp.entervalidemailaddress")))),0!=createAgr.find("#config_name").length){var config_name=createAgr.find("#config_name").val();ZPSetupCommon.isEmpty(config_name)?(err=!0,createAgr.find("#config_name").after('<span class="ERR" id="errormsg">Please enter a config_name</span>')):createAgr.find("#config_name").next("span#errormsg").remove()}var deadLine=createAgr.find("input[name='deadline']").val();if(!ZPSetupCommon.isEmpty(deadLine)&&(-1==Layout.Page.hash.indexOf("workflow")||(Layout.Page.hash.indexOf("workflow")>-1||Layout.Page.hash.indexOf("customaction")>-1)&&"1"==createAgr.find("input[id='expdateid']:checked").val()&&showExpiryOptions)){var lastDate=moment(deadLine,dateFmt.toUpperCase()).format("DD-MMM-YYYY").split("-"),month=Calendar.months.indexOf(lastDate[1])+1,lDate=lastDate[2]+"/"+month+"/"+lastDate[0];if("NaN"===Date.parse(lDate).toString()||moment(lDate).diff(moment().format("YYYY/MM/DD"),"days")<=0){err=!0;var errMessage="";errMessage="NaN"===Date.parse(lDate).toString()?ZPI18N.getString("zp.holiday.dateerror"):ZPI18N.getString("zp.validuntilerr"),createAgr.find("input[name='deadline']").after('<span class="ERR" id="errormsg">'+errMessage+"</span>"),Layout.Page.container.find("#setting_lnk").attr("val","1"),Layout.Page.container.find("#moreSettings").removeClass("DN"),Layout.Page.container.find("#moreSettings").removeAttr("style"),Layout.Page.container.find("#setting_lnk").text(ZPI18N.getString("zp.automation.lessoptions"))}else createAgr.find("input[name='deadline']").parent().find("span#errormsg").remove();var warnRecp=ZPSetupCommon.isEmpty(warnRecp)?"0":createAgr.find("input[name='freq_warn']").val()}if(Layout.Page.hash.indexOf("workflow")>-1||Layout.Page.hash.indexOf("customaction")>-1){var recpList=[],recpType=[];$.each(createAgr.find("[name=recp_row]"),function(index,elm){recpList.indexOf($(elm).find("#recpList").val())>-1?(err=!0,createAgr.find("[name=recp_row]").last().append('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.zs.diffrecp")+"</span>")):createAgr.find("[name=recp_row]").last().find("span#errormsg").remove(),recpType.push($(elm).find("#recp_type").val()),recpList.push($(elm).find("#recpList").val())}),"1"!=recpType[0]&&"3"!=recpType[0]&&(err=!0,createAgr.find("[name=recp_row]").last().append('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.zs.firstrecnotview")+"</span>")),err||-1===recpType.indexOf("3")&&(-1===recpType.indexOf("1")?(err=!0,createAgr.find("[name=recp_row]").last().append('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.zs.atleastonesigner")+"</span>")):createAgr.find("[name=recp_row]").last().find("span#errormsg").remove())}if(Zohosign.isFromFormView||Layout.Page.hash.indexOf("workflow")>-1||Layout.Page.hash.indexOf("customaction")>-1){var dateField=createAgr.find("#dateFieldOpt").val();noOfDays=createAgr.find("#deadlinedays").val();if(!ZPSetupCommon.isEmpty(noOfDays)){if(noOfDays<0)return err=!0,createAgr.find("#deadlinegrp").append('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.validvalue")+"</span>"),err;if(noOfDays>99)return err=!0,createAgr.find("#deadlinegrp").append('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.zohosignexplimit")+"</span>"),err;createAgr.find("#deadlinegrp").last().find("span#errormsg").remove()}var showExpiryOptions=createAgr.find("[name=showExpiryOptions]").is(":checked");if(null==dateField&&"on"==$("input[id='datelookupid']:checked").val()&&showExpiryOptions)return err=!0,createAgr.find("#deadlinegrp").append('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.nodatelookup")+"</span>"),err;if("1"==createAgr.find("input[id='expdateid']:checked").val()&&showExpiryOptions&&ZPSetupCommon.isEmpty(deadLine))return err=!0,createAgr.find("#deadlinegrp").append('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.selectexpdate")+"</span>"),err}var userListArray=[];if(Layout.Page.container.find("#notify_Mail").is(":checked")){var userList=Layout.Page.container.find("#zsignShareOptListID").find("span");0==userList.length&&(err=!0,createAgr.find("#zsignShareOptListID").append('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.chooseskillset",new Array(ZPI18N.getString("zp.users")))+"</span>"));for(var i=0,l=userList.length;i<l;i++){var userErecNo=$(userList)[i].getAttribute("attr");userListArray.push(userErecNo)}0!=userListArray.length&&(Zohosign.userListArray=JSON.stringify(userListArray))}else Zohosign.userListArray="";return err},validateMailIds:function(mailIds,obj,msg){mailIds.length<=50?$.each(mailIds,function(ind,mailId){if(!ZPUtil.Validation.isEmail(mailId))return!0,obj.after('<span class="ERR" id="errormsg">'+msg+"</span>"),!1;obj.next("span#errormsg").remove()}):(!0,$("div#createAgreementModal").find("#recpList").after('<span class="ERR" id="errormsg">'+ZPI18N.getString("zp.maildidslengthunlimit")+"</span>"))},setDaysForReminder:function(mode){var pageId=Layout.Page.container;ZPSetupCommon.isEmpty(mode)?pageId.find("div#createDocumentModal").find("input#reminder_check").is(":checked")?pageId.find("div#createDocumentModal").find("div#reminder_freq").removeClass("DN"):pageId.find("div#createDocumentModal").find("div#reminder_freq").addClass("DN"):pageId.find("div#createDocumentModal").find("input#expire_check").is(":checked")?pageId.find("div#createDocumentModal").find("div#expire_setting,div#warning").show():pageId.find("div#createDocumentModal").find("div#expire_setting,div#warning").hide()},cancelDocument:function(thisObj){var moduleType,recList,recordId=Layout.Page.container.find("div#viewDocumentModal").attr("documentId");if(void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1){var formId=Layout.Page.urlparam.formId;void 0===formId&&(formId=ZPForm.CURRFORM_PARAM.formId),formId=formId,moduleType="2",recList=Layout.Page.container.find("div#viewDocumentModal").attr("recordId")}else moduleType="1";ZPeople.Request.send("/zsign.zp",{conreqcsr:csrfToken,documentId:recordId,action:"cancelDocument",moduleType:moduleType,formId:formId,recList:recList},Zohosign.cancelCallback,recordId)},cancelCallback:function(data,params,recordId){var pageId=Layout.Page.container;if("success"===data.status){var row="";row=-1!=Layout.Page.hash.indexOf("files/zohosign/documentlistview")||-1!=Layout.Page.hash.indexOf("files/hrfile")||Layout.Page.hash.indexOf("selfservice/user/files")?pageId.find("ul[documentId='"+recordId+"'] li[name='env_status']"):pageId.find("ul[documentid='"+recordId+"'] li[name='env_status']"),pageId.find("div#viewDocumentModal").find("#status").text("Recalled"),row.html("<span class='red'>Recalled</span>"),row.closest("tr").attr("isCancelled",!0),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.documentrecalled")),pageId.find("#otherDropdown").addClass("DN"),pageId.find("#showOtherOptions").addClass("DN"),pageId.find("#send_remindBtn").hide(),pageId.find("#cancelDocBtn").hide(),pageId.find("#showExpdropdown").addClass("DNI")}else"Error"===data.status&&(void 0!=data.message?ZPeople.Message.showFailureMsg(data.message):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.docnotrecall")))},getTotalRecordCount:function(){var pageId=Layout.Page.container,params={conreqcsr:csrfToken,action:"getDocumentRecordCount"};params.documentName=pageId.find("input#search_documentname").val(),"select"!==pageId.find("select#search_cat").val()&&(params.catId=pageId.find("select#search_cat").val()),"select"!==pageId.find("select#search_status").val()&&(params.status=pageId.find("select#search_status").val()),ZPeople.Request.send("/docuSignActions.zp",params,Zohosign.showCount)},showCount:function(data){var pageId=Layout.Page.container;data?(pageId.find("span#document_totalcnt").text(data.count).removeClass("hide"),pageId.find("a#zp_views_recordcount").addClass("hide")):(pageId.find("span#document_totalcnt").addClass("hide"),pageId.find("a#zp_views_recordcount").removeClass("hide"))},setCatName:function(dataObj){var pageId=Layout.Page.container;$.each(dataObj,function(index,documentDtls){var catId=ZPSetupCommon.isEmpty(documentDtls.catId)?"0":documentDtls.catId,categoryName=pageId.find("select#search_cat").find("option[value='"+catId+"']").text();pageId.find("#documents_list").find("ul[documentid='"+documentDtls.ARID+"'] span#cat_nm").text(categoryName)})},mainPageAct:function(option){!0===option&&ZPACommon.getUrlMode()===NewWorkFlow.MODE?AutomationCommon.showHidePage("[automationPages=esignConfigPage]","slide"):!0===option?AutomationCommon.showHidePage("[automationPages=esignConfigPage]"):AutomationCommon.showHidePage("[automationPages=esignConfigPage]",!0)},close:function(){switch(Zohosign.mainPageAct(),Zohosign.isMutlipleField=!1,Layout.Page.container.find("#setting_lnk").attr("val","0"),Layout.Page.container.find("#moreSettings").removeAttr("style"),Layout.Page.hash.indexOf("workflow/list")>-1&&(Layout.Page.container.find("#form_view").removeAttr("fid"),Layout.Page.container.find("#form_view").removeAttr("cid")),Layout.Page.container.find("#moreSettings").hasClass("DN")||Layout.Page.container.find("#moreSettings").addClass("DN"),Layout.Page.container.find("#setting_lnk").text(ZPI18N.getString("zp.automation.moreoptions")),Layout.Page.container.find("#esignTempList").show(),ZPACommon.getUrlMode()){case NewWorkFlow.MODE:NewWorkFlow.callbackByAction(esign.MODE,{cancel:!0});break;case CustomAction.MODE:CustomAction.callbackByAction(esign.MODE,{cancel:!0});break;default:Zohosign.isCancel=!0,Layout.Page.container.find("#esignTempList").toggleClass("DN"),window.location.href="#admin/automation/workflow/actions/esign"}},initiatePage:function(){var url=Layout.Page.hash;if(AutomationCommon.pageInsert(esign.MODE),esign.openWorkFlowEsignModal(),-1!==url.indexOf("esign/add"))Zohosign.openEnvModal(!0,!1,"workflow");else if(-1!==url.indexOf("esign/edit"))if(null==Zohosign.editData){var confID=url.split("configid:")[1];Zohosign.esignConfigEditSlide(confID)}else Zohosign.openEnvModal(!0,!1,"workflow","init")},templateChangeAct:function(getThis){var pageId=$(getThis).parents(".modal-body"),templateData=(AutomationCommon.getFormId(),$(getThis).on("select2:select").find("option:selected").attr("temp").trim());pageId.find("#msgEditor").hide(),$(getThis).closest("[name=row]").find("[name=editTemp]").hide(),pageId.find("#msgTemplate").html(templateData),ZPSetupCommon.isEmpty(templateData)?pageId.find("#msgTemplate").addClass("DN"):pageId.find("#msgTemplate").removeClass("DN")},editTemplateConfig:function(){return esign.openWorkFlowEsignModal("edit")},addRecp:function(thisObj,action,isFilterMode){var pageId=Layout.Page.container;if(!ZPSetupCommon.isEmpty(action)&&"mins"===action)return $(thisObj).closest("[name=recp_row]").remove(),void pageId.find("#add_recplnk").show();if(Object.keys(Zohosign.emailidfield.formId).length>pageId.find("[name=recp_row]").length){var recpOption=Zohosign.constructFormFields(Zohosign.emailidfield.formId),addRecpElm='<div class="zp_fm" name="recp_row">';addRecpElm+='<div class="criteria-field">',addRecpElm+='<i class="ri"></i>',addRecpElm+='<div class="actions" id="action_icon">',isFilterMode||(addRecpElm+='<i class="IC-mins" onclick=Zohosign.addRecp(this,"mins")></i>'),addRecpElm+="</div>",addRecpElm+='<div class="col-sm-6"><select id="recpList" placeholder="'+ZPI18N.getString("role")+'" class="select2" tabindex="-1">'+recpOption+"</select></div>",addRecpElm+='<div class="col-sm-6"><select id="recp_type" placeholder="'+ZPI18N.getString("role")+'" class="select2" tabindex="-1"><option value="1">'+ZPI18N.getString("zp.sign")+'</option><option value="2">'+ZPI18N.getString("zp.view")+"</option>",Zohosign.checkZSFeature(),Zohosign.zsFeatureList.approver&&(addRecpElm+='<option value="3">'+ZPI18N.getString("zp.approve")+"</option>"),addRecpElm+="</select></div>",addRecpElm+="</div>",addRecpElm+="</div>",$(addRecpElm).insertBefore(pageId.find("#add_recplnk"));var recpSelect=$(addRecpElm).find("#recpList");$(recpSelect.find("option:nth-child("+parseInt(pageId.find("[name=recp_row]").length-1)+")")).attr("selected","selected"),pageId.find("select#recpList,select#recp_type").select2()}Object.keys(Zohosign.emailidfield.formId).length===pageId.find("[name=recp_row]").length&&pageId.find("#add_recplnk").hide()},addFileFields:function(filename){var docDispName=filename.substring(filename.lastIndexOf("/")+1);!Layout.Page.container.find(".zsign-doc").length>0&&(Layout.Page.container.find("#tempfileform").after('<div class="zsign-doc" id ="multiple_files"></div>'),$("#multiple_files").sortable(),$("#multiple_files").disableSelection()),Layout.Page.container.find(".zsign-doc").append("<span> <b>"+docDispName+'</b><i class="IC-cls" onclick = "Files.deleteSelection(this)"></i></span>');for(var multiplefiles=Layout.Page.container.find(".zsign-doc").find("span").find("b"),j=0,l=multiplefiles.length;j<l;j++)""!=!multiplefiles[j].getAttribute("id")&&multiplefiles[j].innerText==docDispName&&Layout.Page.container.find(multiplefiles[j]).data("filename",docDispName)},expColSettings:function(){"1"===Layout.Page.container.find("#setting_lnk").attr("val")?(Layout.Page.container.find("#moreSettings").slideUp("slow"),Layout.Page.container.find("#setting_lnk").text(ZPI18N.getString("zp.automation.moreoptions")),Layout.Page.container.find("#setting_lnk").attr("val","0")):(Layout.Page.container.find("#moreSettings").slideDown("slow"),Layout.Page.container.find("#setting_lnk").text(ZPI18N.getString("zp.automation.lessoptions")),Layout.Page.container.find("#setting_lnk").attr("val","1"))},deleteEsignConfig:function(thisObj){var params={action:"deleteEsign",recordId:$(thisObj).closest("tr").attr("id")};ZPeople.Request.send("/zsign.zp",params,Zohosign.handleCallBackDelete)},handleCallBackDelete:function(data,params){if("success"===data[1].response){var configId=params.recordId;Layout.Page.container.find("#esignTempList_table tbody").find("tr[id='"+configId+"']").remove(),0===Layout.Page.container.find("#esignTempList_table tbody tr").length&&Layout.Page.container.find("#emptyListPage").removeClass("DN")}else AutomationCommon.showCannotDeleteModal("esignTemplateMessage",data[1].wfmapping,"Esign")},showFields:function(thisObj){AutomationCommon.getFormFieldsHtml().clone();Layout.Page.container.find("#addDocNameField,#addSubjectField").popover({html:!0,content:function(){return Zohosign.showFieldsHtml(Layout.Page.container.find("#addDocNameField,#addSubjectField"))}}),$("body").on("click",function(e){0===$(".popover").has(e.target).length&&0===$(Layout.Page.container.find("#addDocNameField,#addSubjectField")).has(e.target).length&&$(Layout.Page.container.find("#addDocNameField,#addSubjectField")).popover("hide")})},showFieldsHtml:function(clickObj){var data=Zohosign.textfield.formId,headerDiv=$('<div class="tabvertical tabselectsingle" srcTxt="true"><div class="dvPopsearch"><div class="inputsearch"> <input class="form-control" type="search" placeholder="'+ZPI18N.getString("Select")+'" id="temp_search"> </div></div><ul class="list-group ulRecipient" role="tablist" id="listBody"> </ul></div>');if($.isEmptyObject(data)){var noRecords="<div class='col-md-12 P20'><span>"+ZPI18N.getString("zp.norecfound")+"</span></div>";headerDiv.find("#listBody").html(noRecords)}else{headerDiv.find("#listBody").html(""),headerDiv.find("#listBody").prepend("<li class='head'><span class='ZPbold'>Fields</span></li>");var fieldDetails={};$.each(data,function(fieldId,fieldName){var cloneLi=$('<li name="list-group-item"><span data-toggle="tab" role="tab" name="mOpt"></span></li>').clone();cloneLi.find("[name=mOpt]").text(decodeHTML(fieldName)),cloneLi.find("[name=mOpt]").attr({id:fieldId,val:fieldId}),cloneLi.on("click",function(){$(this).addClass("sel").siblings().removeClass("sel");var getInput="subjectInputTag"===$(this).closest("[name='popover_div']").attr("id")?Layout.Page.container.find("#document_subject"):Layout.Page.container.find("#document_name"),getField="${"+$(this).find("span[name=mOpt]").text()+"}",fcId=$(this).find("[name=mOpt]").attr("id"),actualVal="";-1===$(this).attr("class").indexOf("sel")?getInput.val(getInput.val().replace(getField,"")):(fieldDetails[fcId]=getField,ZPSetupCommon.isEmpty(getField)?getInput.val(getInput.val()+""+getField):getInput.val(getInput.val()+getField),ZPSetupCommon.isEmpty(actualVal)||""==actualVal||(actualVal+=","),"addSubjectField"===$(clickObj).attr("id")?Zohosign.docsubject.push(fcId):Zohosign.docname.push(fcId))}),headerDiv.find("#listBody").append(cloneLi)})}return headerDiv},createTemplate:function(thisObj){var fileID=thisObj,formData=new FormData;formData.append("fileId",fileID),formData.append("conreqcsr",csrfToken),formData.append("action","sendDocument"),formData.append("isTemplate",!0),$.ajax({url:"zsign.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(data){var pageId=Layout.Page.container;pageId.find("div#templateModel").remove();pageId.find("div#templateModel");ZPeople.BSModal.setup({id:"templateModel",type:22,modalClass:"popRgtModel NomdlFoot",headerHtml:Zohosign.add.templateHeader,body:Zohosign.add.bodyIframe});var url=data[1].signURL,templated=data[1].templates.template_id,signURL=(data[1].templates.actions[0].action_id,url+"/zs?frameorigin=https://"+document.domain+"#/template/new/"+templated+"?internal=true&service=zohopeople");pageId.find("iframe[name='createDocumentResp']").attr("src",signURL).show(),pageId.find("div#templateModel").addClass("PopMdxModel l0"),pageId.find("div#zp_modal_body").find("div#zp_page_loading").remove(),pageId.find("div#templateModel").find("div#embed_iframe").show(),pageId.find("div#templateModel").find("div.modal-footer").remove(),pageId.find("div#zp_modal_body").addClass("NomdlFoot")}})},sendToAllEmp:function(){Layout.Page.container.find("#sendtoAll").addClass("IC-radio2x"),Layout.Page.container.find("#sendtoEmp").removeClass("IC-radio2x"),Layout.Page.container.find("#zsignEmpSel").addClass("zp_opLw"),Layout.Page.container.find("#signFileDiv").addClass("zp_opLw")},sendToEmpList:function(){Layout.Page.container.find("#sendtoEmp").addClass("IC-radio2x"),Layout.Page.container.find("#sendtoAll").removeClass("IC-radio2x"),Layout.Page.container.find("#zsignEmpSel").removeClass("zp_opLw"),Layout.Page.container.find("#signFileDiv").removeClass("zp_opLw")},selectEmployee:function(getThis){var tempId=$(getThis).attr("id"),tempName=$(getThis).text();if(-1!==$(getThis).closest("li").attr("class").indexOf("sel")){var construDiv='<div class="zp_Tg" id='+tempId+">"+ZSEC.Encoder.encodeForHTML(tempName)+'<i class="IC-cls-1px" onclick="Files.deleteSelection(this,true)"></i></div>';Layout.Page.container.find("#zsignEmpSel").append(construDiv)}},unSelectEmployee:function(getThis){var idDel=getThis;Layout.Page.container.find("#zsignEmpSel").find("div#"+idDel).remove()},loadSignTemplate:function(fileID,tempId,locId,entityId,unitId,divisionId,departmentId){if(void 0!=Zohosign.hidePopupForSend&&Zohosign.hidePopupForSend)Zohosign.hidePopupForSend=!1;else{OWNER_LIST={},Layout.Page.container.find("#sendtoAll").addClass("IC-radio2x"),Layout.Page.container.find("#signFileDiv").addClass("ddn zp_opLw"),Layout.Page.container.find("#sendtoEmp").removeClass("IC-radio2x"),Layout.Page.container.find("#zsignEmpSel").find(".zp_Tg").remove(),Layout.Page.container.find("#reqSignDiv").addClass("active"),$(".main-wrp").addClass("services"),Zohosign.isfromOrgFiles=!0,Zohosign.signTemplateId=tempId,Zohosign.locationId=locId,Zohosign.entityId=entityId,Zohosign.unitId=unitId,Zohosign.divisionId=divisionId,Zohosign.departmentId=departmentId,Files.employeeData="",Zohosign.signFileId=fileID;var formData={};""!=locId&&void 0!=locId&&(formData.locationIdlist=locId),""!=Zohosign.entityId&&void 0!=Zohosign.entityId&&(formData.legalEntityIdlist=Zohosign.entityId),""!=Zohosign.unitId&&void 0!=Zohosign.unitId&&(unitIds=Zohosign.unitId,formData.businessUnitIdlist,Zohosign.unitId),""!=Zohosign.divisionId&&void 0!=Zohosign.divisionId&&(formData.divisionIdlist=Zohosign.divisionId),""!=Zohosign.departmentId&&void 0!=Zohosign.departmentId&&(formData.departmentIdlist=Zohosign.departmentId);var empObj={id:"signFileDivEmp",data:function(initObj){var query=$(initObj).val();return query=void 0==query||""==query?"*":query,EmployeeDropdown.getEmpList(query,"emp","FILES_ESIGNLIST",[],formData,!1)},callback:Zohosign.selectEmployee,callbackOnCancel:Zohosign.unSelectEmployee,search:!0,border:!0,width:250,noArrow:!0,checkbox:!0,position:ZPArrow.BOTTOM_CENTER};$(document).on("click","#signFileDivInput",function(e){$(this).zparrowmenu(empObj)})}},addMngr:function(notManager){var role="Manager",pageId=Layout.Page.container;if(notManager){role="Employee",pageId.find("#signRecpList").remove();pageId.find("#selectZSEmpInp").after('<div id="signRecpList" class="zptabOrg pa_cstmPop sign_cstm MT5"><ul id="signRecpListUL" class="tabCont dragger ui-sortable"></ul></div>')}else $("#addMngrBtn").addClass("DNI"),$("#managerdesc").addClass("DNI");var recpIndData='<li><div class="mvr"><i class="CR-drag"></i><span>'+role+'</span><select id="recp_type" placeholder="'+ZPI18N.getString("role")+'" class="select2" tabindex="-1"><option value="1">'+ZPI18N.getString("zp.sign")+'</option><option value="2">'+ZPI18N.getString("zp.view")+"</option>";Zohosign.checkZSFeature(),Zohosign.zsFeatureList.approver&&(recpIndData+='<option value="3">'+ZPI18N.getString("zp.approve")+"</option>"),recpIndData+="</select></div>","Employee"!=role&&(recpIndData+='<i class="IC-delete-1px" onclick="Zohosign.delZSTempEmp(this)"></i>'),recpIndData+="</li>",pageId.find("#signRecpList #signRecpListUL").append(recpIndData),pageId.find("#signRecpList #signRecpListUL").find("li").last().find("#recp_type").last().select2();pageId.find("#signRecpList #signRecpListUL").find("li").last().find("#recp_type").select2("val",1),Zohosign.actionNames.push(role)},loadActionData:function(signTemplateId,isEdit){Zohosign.delZSActionId=[];var params={action:"getTemplateActionIds",conreqcsr:csrfToken,signTemplateId:signTemplateId};Zohosign.actionNames=[],Zohosign.editSignTempId=signTemplateId,ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",params,Zohosign.setActionNames,isEdit,Zohosign.failedCallBack)},setActionNames:function(data,params,isEdit){Zohosign.actionNames=[];var actionValues=data[1][4],actionData=data[1].data;if(isEdit=void 0!=isEdit&&isEdit,Zohosign.hidePopupForSend=!1,0==actionData.signerFieldForAllRecp&&!isEdit)return Zohosign.hidePopupForSend=!0,void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.addsignerfields"),1e4);var expDays=actionData.expiration_days,isSeq=actionData.is_sequential,notes=actionData.notes,reminder=actionData.reminder_period,tempName=actionData.template_name,catId=actionData.CatID;if(void 0==Files.newCategoryList?ZPeople.Request.send("/fileCabinetAction.zp",{methodName:"getCategoryList",conreqcsr:csrfToken},Zohosign.openFilter,info[Zohosign.CATID]):Zohosign.openFilter(Files.newCategoryList,null,catId),isEdit){var pageId=Layout.Page.container;pageId.find("#signing_order").prop("checked",isSeq),pageId.find("#document_message").html(notes),reminder>=1&&(pageId.find("#reminder_check").prop("checked",!0),pageId.find("input[name=reminder_freqdayscnt]").val(reminder),pageId.find("#reminder_freq").removeClass("DN")),pageId.find("input[name=noOfDays]").val(expDays),pageId.find("#document_name").val(tempName),pageId.find("#signRecpList").remove();var recpIndData="",typeNum=0;Zohosign.templateInit();pageId.find("#selectZSEmpInp").after('<div id="signRecpList" class="zptabOrg pa_cstmPop sign_cstm MT5"><ul id="signRecpListUL" class="tabCont dragger ui-sortable"></ul></div>');var listItem=$("#ddList").find("li");Object.keys(actionValues).length>0&&$.each(actionValues,function(key,value){if(recpIndData="","Employee"==value.role||"Manager"==value.role||"MANAGER"==value.role||"SIGNER"==value.role)"Manager"!=value.role&&"MANAGER"!=value.role||($("#addMngrBtn").addClass("DNI"),$("#managerdesc").addClass("DNI")),recpIndData+='<li id="'+value.action_id+'"><div class="mvr"><i class="CR-drag"></i><span>'+value.role+'</span><select id="recp_type" placeholder="'+ZPI18N.getString("role")+'" class="select2" tabindex="-1"><option value="1">'+ZPI18N.getString("zp.sign")+'</option><option value="2">'+ZPI18N.getString("zp.view")+"</option>",Zohosign.checkZSFeature(),Zohosign.zsFeatureList.approver&&(recpIndData+='<option value="3">'+ZPI18N.getString("zp.approve")+"</option>"),recpIndData+="</select></div>","Employee"!=value.role&&"SIGNER"!=value.role&&(recpIndData+='<i class="IC-delete-1px" onclick="Zohosign.delZSTempEmp(this)"></i>'),recpIndData+="</li>",1;else for(var x=0;x<listItem.length;x++){var email=$(listItem[x]).attr("emailid");if(email==value.role||email==value.recipient_email){var name=$(listItem[x]).attr("name");recpIndData+='<li id="'+value.action_id+'"><div class="mvr"><i class="CR-drag"></i><span emailId='+email+">"+name+'</span><select id="recp_type" placeholder='+ZPI18N.getString("role")+' class="select2" tabindex="-1"><option value="1">'+ZPI18N.getString("zp.sign")+'</option><option value="2">'+ZPI18N.getString("zp.view")+"</option>",Zohosign.checkZSFeature(),Zohosign.zsFeatureList.approver&&(recpIndData+='<option value="3">'+ZPI18N.getString("zp.approve")+"</option>"),recpIndData+="</select></div>","Employee"!=value.role&&"SIGNER"!=value.role&&(recpIndData+='<i class="IC-delete-1px" onclick="Zohosign.delZSTempEmp(this)"></i>'),recpIndData+="</li>",1;break}}0==pageId.find("#signRecpList #signRecpListUL").find("li").length?pageId.find("#signRecpList #signRecpListUL").append(recpIndData):pageId.find("#signRecpList #signRecpListUL").find("li").last().after(recpIndData),pageId.find("#signRecpList #signRecpListUL").find("li").last().find("#recp_type").last().select2(),typeNum=1,"SIGN"==value.type?typeNum=1:"VIEW"==value.type?typeNum=2:"APPROVER"==value.type&&(typeNum=3),pageId.find("#signRecpList #signRecpListUL").find("li").last().find("#recp_type").select2(),pageId.find("#signRecpList #signRecpListUL").find("li").last().find("#recp_type").select2("val",typeNum),Zohosign.actionNames.push(value.role)});var selectedIDList="",cnt=(listItem=$("#ddList").find("li"),0),selId="";if(Zohosign.actionNames.length>0)for(var j=0;j<Zohosign.actionNames.length;j++)for(var x=0;x<listItem.length;x++)if($(listItem[x]).attr("emailid")==Zohosign.actionNames[j]){$(listItem[x]).addClass("sel"),1==actionValues.length?(cnt++,selectedIDList+=$(listItem[x]).attr("id"),selId=$(listItem[x]).attr("id")):(0==cnt?(cnt++,selectedIDList+=$(listItem[x]).attr("id")):(cnt++,selectedIDList=selectedIDList+","+$(listItem[x]).attr("id")),selId=$(listItem[x]).attr("id")),$($(pageId.find("#signRecpList #signRecpListUL").find("li")[j]).find("span")[0]).attr("id",selId);break}Layout.Page.container.find("#selectZSEmpInp").attr("selectedids",selectedIDList),Zohosign.sortZSRecp()}else{Layout.Page.container.find("#extraRecipient").html(""),Layout.Page.container.find("#extraRecipient").addClass("DN");var constructVal='<p class="gry">'+ZPI18N.getString("requiresignfrom")+"</p>";Object.keys(actionValues).length>1&&($.each(actionValues,function(key,value){var roleValue=""!=value.role?value.role:"";roleValue=""==roleValue&&""!=value.recipient_email?value.recipient_email:roleValue,"Employee"!=value.role&&(constructVal+='<div class="zp_Tg">'+roleValue+"</div>"),Zohosign.actionNames.push(value)}),Layout.Page.container.find("#extraRecipient").append(constructVal),Layout.Page.container.find("#extraRecipient").removeClass("DN"))}},selectZsignTempEmployee:function(getThis){var tempId=$(getThis).attr("id"),pageId=Layout.Page.container,isAdd=$(getThis).hasClass("sel"),tempName=getThis.getAttribute("name"),emailId=getThis.getAttribute("emailid");if(isAdd){var recpIndData="";"Employee"==emailId||"Manager"==emailId||"MANAGER"==emailId||"SIGNER"==emailId?(recpIndData+='<li><div class="mvr"><i class="CR-drag"></i><span emailid="'+emailId+'" id="'+tempId+'">'+ZSEC.Encoder.encodeForHTML(tempName)+'</span><select id="recp_type" placeholder="'+ZPI18N.getString("role")+'" class="select2" tabindex="-1"><option value="1">'+ZPI18N.getString("zp.sign")+'</option><option value="2">'+ZPI18N.getString("zp.view")+"</option>",Zohosign.checkZSFeature(),Zohosign.zsFeatureList.approver&&(recpIndData+='<option value="3">'+ZPI18N.getString("zp.approve")+"</option>"),recpIndData+="</select></div>","Employee"!=emailId&&"SIGNER"!=emailId&&(recpIndData+='<i class="IC-delete-1px" onclick="Zohosign.delZSTempEmp(this)"></i>'),recpIndData+="</li>","Manager"!=emailId&&"MANAGER"!=emailId||(pageId.find("#addMngrBtn").addClass("DNI"),pageId.find("#managerdesc").addClass("DNI"))):(recpIndData+='<li><div class="mvr"><i class="CR-drag"></i><span emailId="'+emailId+'" id="'+tempId+'">'+ZSEC.Encoder.encodeForHTML(tempName)+'</span><select id="recp_type" placeholder='+ZPI18N.getString("role")+' class="select2" tabindex="-1"><option value="1">'+ZPI18N.getString("zp.sign")+'</option><option value="2">'+ZPI18N.getString("zp.view")+"</option>",Zohosign.checkZSFeature(),Zohosign.zsFeatureList.approver&&(recpIndData+='<option value="3">'+ZPI18N.getString("zp.approve")+"</option>"),recpIndData+="</select></div>","Employee"!=emailId&&"SIGNER"!=emailId&&(recpIndData+='<i class="IC-delete-1px" onclick="Zohosign.delZSTempEmp(this)"></i>'),recpIndData+="</li>"),0==pageId.find("#signRecpList #signRecpListUL").find("li").length?pageId.find("#signRecpList #signRecpListUL").append(recpIndData):pageId.find("#signRecpList #signRecpListUL").find("li").last().after(recpIndData),pageId.find("#signRecpList #signRecpListUL").find("li").last().find("#recp_type").last().select2(),pageId.find("#signRecpList #signRecpListUL").find("li").last().find("#recp_type").select2("val",1),Zohosign.actionNames.push(emailId)}else{Zohosign.splitSelectedId(getThis);var LookupList=pageId.find("#signRecpList #signRecpListUL").find("li span a");$.each(LookupList,function(key,value){$(value).text()==emailId&&($(value).parents("li").remove(),"Manager"!=$(value).text()&&"MANAGER"!=$(value).text()||($("#addMngrBtn").removeClass("DNI"),$("#managerdesc").removeClass("DNI")))})}},splitSelectedId:function(getThis){var selectedIdList=Layout.Page.container.find("#selectZSEmpInp").attr("selectedids").split(",");selectedIdList.removeElement($(getThis).attr("id")),Layout.Page.container.find("#selectZSEmpInp").attr("selectedids",selectedIdList.toString())},templateInit:function(){var empObj={id:"searchSignerZSignTemp",data:function(initObj){var query=$(initObj).val();return query=void 0==query||""==query?"*":query,EmployeeDropdown.getEmpList(query,"emp","FILES_ESIGNLIST",[],{},!1,"",!0)},callback:Zohosign.selectZsignTempEmployee,callbackOnCancel:Zohosign.unSelectZsignTempEmployee,search:!0,border:!0,width:340,noArrow:!0,checkbox:!0,position:ZPArrow.BOTTOM_CENTER};Zohosign.ZSEmpList=empObj,$(document).on("click","#selectZSEmpInp",function(e){$(this).zparrowmenu(empObj)}),$("#selectZSEmpInp").click()},sortZSRecp:function(){$("#signRecpListUL").addClass("sortable"),$("#signRecpListUL").sortable({containment:"parent"})},delZSTempEmp:function(getThis){var pageId=Layout.Page.container,displayName=$($(getThis).parents("li").find("span")[0]).text();if("Employee"!=displayName&&"Signer"!=displayName&&"SIGNER"!=displayName){$($(getThis).parents("li").find("span")[0]).text();var delActionId=$($(getThis).parents("li")).attr("id"),LookupList=pageId.find("#signRecpList #signRecpListUL").find("li span");$.each(LookupList,function(key,value){if((void 0!=delActionId&&$(value).parents("li").attr("id")==delActionId||$(value).text()==displayName)&&$(value).text()==displayName)return"Manager"==$(value).text()||"MANAGER"==$(value).text()?($("#addMngrBtn").removeClass("DNI"),$("#managerdesc").removeClass("DNI")):Zohosign.splitSelectedId(value),$(value).parents("li").remove(),!1}),void 0!=delActionId&&Zohosign.delZSActionId.push(delActionId)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectemployee"))},unSelectZsignTempEmployee:function(getThis){var pageId=Layout.Page.container,idDel=getThis;Zohosign.splitSelectedId($(""+getThis));var lookupList=pageId.find("#signRecpList #signRecpListUL").find("li span[id]");$.each(lookupList,function(key,value){if($(value).attr("emailId")==$("#ddList").find("li#"+getThis).attr("emailid"))return $(lookupList[key]).parents("li").remove(),!1}),Layout.Page.container.find("#zsignEmpSel").find("div#"+idDel).remove()},listEmpForSignTemp:function(empList,params,dataObj){var createAgr=$("div#createDocumentModal"),empOpt="";empOpt+="<option value='Employee'>"+ZPI18N.getString("zp.employee")+"</option>",empOpt+="<option value='Manager'>"+ZPI18N.getString("zp.manager")+"</option>",$.each(empList,function(key,value){empOpt+="<option value='"+value.zuid+"'>"+value.emailId+"</option>"}),createAgr.find("select#signempList").append(empOpt),createAgr.find("select#signempList").removeClass("DN"),createAgr.find("select#signempList").select2()},clearSendTemplate:function(){Zohosign.editSignTempId="",Layout.Page.container.find("#reqSignDiv").removeClass("active"),$(".main-wrp").removeClass("services"),Layout.Page.container.find("#empRoleOptions span").remove(),Layout.Page.container.find("#sendtoAll").is(":checked")&&(Layout.Page.container.find("#empRoleOptions").popover("toggleEnabled"),Layout.Page.container.find("#sendtoAll").prop("checked",!1),Layout.Page.container.find("#signFileDiv").addClass("zp_opLw")),Layout.Page.container.find("#empRoleOptions").removeClass("dvfrmlistBD"),Layout.Page.container.find("#signFileDivInput").attr("selectedids",""),Zohosign.isfromOrgFiles=!1,OWNER_LIST={}},sendToAll:function(){Layout.Page.container.find("#empRoleOptions").popover("toggleEnabled"),Layout.Page.container.find("#empRoleOptions").hasClass("dvfrmlistBD")?Layout.Page.container.find("#empRoleOptions").removeClass("dvfrmlistBD"):Layout.Page.container.find("#empRoleOptions").addClass("dvfrmlistBD")},scheduleSignTemplate:function(){var emailErecList="",tempId=Zohosign.signTemplateId,fileID=Zohosign.signFileId,locationId=Zohosign.locationId,sendtoAll=Layout.Page.container.find("#sendtoAll").hasClass("IC-radio2x"),formData=new FormData;if(sendtoAll)""!=locationId&&void 0!=locationId&&formData.append("locationId",locationId),""!=Zohosign.entityId&&void 0!=Zohosign.entityId&&formData.append("entityId",Zohosign.entityId),""!=Zohosign.unitId&&void 0!=Zohosign.unitId&&formData.append("unitId",Zohosign.unitId),""!=Zohosign.divisionId&&void 0!=Zohosign.divisionId&&formData.append("divisionId",Zohosign.divisionId),""!=Zohosign.departmentId&&void 0!=Zohosign.departmentId&&formData.append("departmentId",Zohosign.departmentId);else emailErecList=Layout.Page.container.find("#signFileDivInput").attr("selectedids");if(""!=emailErecList||sendtoAll){formData.append("fileId",fileID),formData.append("conreqcsr",csrfToken),formData.append("action","scheduleZohoSignTemplate"),formData.append("signTemplateId",tempId),formData.append("emailErecList",ZPSetupCommon.isEmpty(emailErecList)?"":emailErecList);var pageId=Layout.Page.container;if(pageId.find("#reqSignDiv").removeClass("active"),$(".main-wrp").removeClass("services"),Zohosign.clearSendTemplate(),$.ajax({url:"zsign.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(data){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.documentscheduled")),Zohosign.editSignTempId=""},error:function(req){if(pageId.find("div#zp_page_loading").hide(),pageId.find("form#createDocumentForm,div#ca_footer").show(),400===req.status){if(void 0!=req.responseJSON)return void ZPeople.Message.showFailureMsg(req.responseJSON.error);ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.internalservererror"))}if(void 0!=req.responseJSON){var errResponse=req.responseJSON[1];if(8026==errResponse.errorCode||8006==errResponse.errorCode)return void ZPeople.Message.showFailureMsg(errResponse.msg)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.internalservererror"))}}),"#files/zohosign/templatelistview"!=Layout.Page.hash&&0==pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").find("#viewcompReport").length){var comphtml='<li id= "viewcompReport" onclick="Files.showViewReport(\''+fileID+'\')"><i class="IC-chart"></i>'+ZPI18N.getString("zp.viewreport")+"</li>";pageId.find("#comp_fileListing").find("#compfileTr_"+fileID).find("#moreFileOperations").append(comphtml)}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectemployee"))},showEmployeeLookup:function(){"on"==Layout.Page.container.find("#optotherbtn:checked").val()?Layout.Page.container.find("#hrfileoptdiv").removeClass("DN"):1==Layout.Page.container.find("#optrecordbtn:checked").val()&&Layout.Page.container.find("#hrfileoptdiv").addClass("DN")},showDateLookup:function(thisObj){"1"!=Layout.Page.container.find("#expdateid:checked").val()?(Layout.Page.container.find("#deadlineLabel").addClass("DNI"),Layout.Page.container.find("#deadlinegrp").removeClass("DN")):1==Layout.Page.container.find("#expdateid:checked").val()&&(Layout.Page.container.find("#deadlineLabel").removeClass("DNI"),Layout.Page.container.find("#deadlinegrp").addClass("DN"))},lookupopt:function(LookupList,params,LookupId){LookupList=LookupList[1].emplookup;var createAgr=$("div#createDocumentModal");Zohosign.fetchEmpLookup(LookupList),ZPSetupCommon.isEmpty(LookupId)?createAgr.find("select#hrfileopt").select2("val","Select"):(createAgr.find("select#hrfileopt").select2("val",LookupId),createAgr.find("#optotherbtn").prop("checked",!0),createAgr.find("#hrfileoptdiv").removeClass("DN"))},fetchEmpLookup:function(lookuplist){Layout.Page.container;var createAgr=$("div#createDocumentModal"),employeelookupOpt="<option value='Select' selected='selected'>"+ZPI18N.getString("zp.select")+"</option>";$.each(lookuplist,function(key,value){employeelookupOpt+="<option value='"+key+"'>"+value+"</option>"}),createAgr.find("select#hrfileopt").html(employeelookupOpt),createAgr.find("select#hrfileopt").select2()},showOptions:function(me){Layout.Page.container.find("#synctypeOptions");1==Layout.Page.container.find("[name="+me.name+"]").is(":checked")?("on"!=Layout.Page.container.find("#optotherbtn:checked").val()&&Layout.Page.container.find("#optrecordbtn").prop("checked",!0),Layout.Page.container.find("#synctypeOptions").removeClass("DNI"),Zohosign.showEmployeeLookup()):(Layout.Page.container.find("#synctypeOptions").addClass("DNI"),Layout.Page.container.find("#hrfileoptdiv").addClass("DN"))},showExpiryOptions:function(me){var optionholder=Layout.Page.container.find("#datefieldOptions");1==Layout.Page.container.find("[name="+me.name+"]").is(":checked")?(optionholder.removeClass("DN"),"1"!=Layout.Page.container.find("#expdateid:checked").val()?(Layout.Page.container.find("#datelookupid").prop("checked",!0),Layout.Page.container.find("#deadlinegrp").removeClass("DN")):(Layout.Page.container.find("#expdateid").prop("checked",!0),Layout.Page.container.find("#deadlineLabel").removeClass("DNI"))):(optionholder.addClass("DN"),Layout.Page.container.find("#deadlinegrp").addClass("DN"),Layout.Page.container.find("#deadlineLabel").addClass("DNI"),Layout.Page.container.find("#datefieldOptions").addClass("DN"))},getEsignConfigurations:function(){isAnySignConfigured=!1,isZSConfig=!1,isAdobeConfig=!1,isDocuConfig=!1,$.ajax({type:"POST",async:!1,url:"/zohoSignActions.zp",data:{action:"getEsignConfigurations",conreqcsr:csrfToken},success:function(data){data[1].isAnySignConfigured&&(isAnySignConfigured=!0),data[1].servicesConfigured.ZohoSign?isZSConfig=!0:data[1].servicesConfigured.AdobeSign?isAdobeConfig=!0:data[1].servicesConfigured.DocuSign&&(isDocuConfig=!0),data[1].filespermission&&(loginUserRoleCheck=data[1].filespermission)}})},extendExpiry:function(){$("#newExpiry").parent().removeClass("zp_err"),$("#newExpiry").parents("div.zp_formncls").find("span.etxt").remove();var agrmntID=Layout.Page.container.find("div#viewDocumentModal").attr("documentId"),expiryDate=$("#newExpiry").val();if(ZPUtil.Validation.isDate(expiryDate)){var params={action:"extendExpiry",conreqcsr:csrfToken,documentId:agrmntID,expiryDate:expiryDate};if(void 0!=ZPForm.CURRFORM_PARAM.recordId||Layout.Page.hash.indexOf("-formId:")>-1){params.moduleType="2";var formId=Layout.Page.urlparam.formId;void 0===formId&&(formId=ZPForm.CURRFORM_PARAM.formId),params.recList=Layout.Page.container.find("div#viewDocumentModal").attr("recordId"),params.formId=formId}else params.moduleType="1";if(""==expiryDate||void 0==expiryDate||0==expiryDate)return $("#newExpiry").parent().addClass("zp_err"),void $("#newExpiry").parent("div").parent("div").after('<span class="etxt">'+ZPI18N.getString("zp.entervaliddate")+"</span>");"-1"!=dateFmt.indexOf("MMM")&&(expiryDate=expiryDate.replace(/-/g," "));var currentdatelong=Calendar.getCurrentDate().getTime();if(new Date(expiryDate).getTime()<currentdatelong)return $("#newExpiry").parent("div").parent("div").addClass("zp_err"),void $("#newExpiry").parent("div").parent("div").after('<span class="etxt">'+ZPI18N.getString("zp.validuntilerr")+"</span>");ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",params,Zohosign.handleExtendExpiry,null,Zohosign.failedCallBack)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.holiday.dateerror"))},handleExtendExpiry:function(data,params){if("success"===data[1].status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.expirationextended")),$("#showExp").attr("onclick","Zohosign.showExpiryPop('"+data[1].uiDate+"')"),$("#deadLine").text(data[1].uiDate),$("#status").text(ZPI18N.getString("zp.sent")),$("#otherDropdown").removeClass("DN"),$("#showExpdropdown").removeClass("DNI"),$("#cancelDocBtn").show(),$("#send_remindBtn").text(ZPI18N.getString("zp.sendreminder")),$("#send_remindBtn").attr("onclick",'ZPeople.confirm(this,"zp.zpalert","zp.confirmremind",Zohosign.sendReminder,"","","","","")');var row="",pageId=Layout.Page.container;(row=-1!=Layout.Page.hash.indexOf("files/zohosign/documentlistview")||-1!=Layout.Page.hash.indexOf("files/hrfile")||Layout.Page.hash.indexOf("selfservice/user/files")?pageId.find("ul[documentId='"+params.documentId+"'] li[name='env_status']"):pageId.find("ul[documentid='"+params.documentId+"'] li[name='env_status']")).html("<span class='red'>"+ZPI18N.getString("zp.sent")+"</span>"),row.closest("tr").attr("isCancelled",!0)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.expirationnotextended"));Zohosign.closeExpiryPop()},closeExpiryPop:function(){$("#extendExpdiv").removeClass("active")},showExpiryPop:function(deadline){if($("#newExpiry").val(""),void 0!=deadline)$("#existExpiry").val(deadline);else{var agrmntID=Layout.Page.container.find("div#viewDocumentModal").attr("documentId"),params={action:"getDocumentDetailsOrUpdateExpiry",conreqcsr:csrfToken,documentId:agrmntID,updateExp:!0};ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",params,Zohosign.setExpiryDate,null,Zohosign.failedCallBack)}"#selfservice/user/files"!=Layout.Page.hash?Layout.Page.container.find("#extendExpdiv").addClass("active"):$("#extendExpdiv").addClass("active"),Zohosign.showOtherOptions()},showOtherOptions:function(){$("#showExpdropdown").toggleClass("open")},hideOtherOptions:function(){$("#showExpdropdown").removeClass("open")},setExpiryDate:function(data){data[1].expdate?$("#existExpiry").val(data[1].expdate):$("#existExpiry").val("")},iPorGeoRestriction:function(categoryList){var noRestriction=!1,pageId=Layout.Page.container;if(1==categoryList.length&&categoryList[0].hasOwnProperty("ip")){noRestriction=!0,Files.isIprestricted=!0;var row='<ul class="ZPListingUL">';row+='<li class="text-center">'+ZPI18N.getString("zp.iprestricted")+"</li></ul>",pageId.append(row),pageId.find("#tab_actions").hide()}if(categoryList.hasOwnProperty("fail")){Files.isGeorestricted=!0,noRestriction=!0;row='<ul class="ZPListingUL" id="geo_err">';row+='<li class="text-center">'+ZPI18N.getString("zp.georestricted")+"</li></ul>",(pageId=Layout.Page.container.find("#documents_list")).html(row),pageId.show(),pageId.find("#tab_actions").hide(),ZPeople.Message.showFailureMsg(categoryList.fail)}return noRestriction},getUsersOptsList:function(){if(!1===Files.isOrgShareFetched){var formData=new FormData;formData.append("methodName","getOrgComponents"),formData.append("isOrgStrEnabled",isOrgStructureEnabled),formData.append("conreqcsr",csrfToken),$.ajax({url:Files.ACTION.URL,type:"POST",data:formData,async:!1,contentType:!1,processData:!1,success:function(resultData){Files.isOrgShareFetched=!0,void 0!==resultData[1]&&(Files.sharingOpts=resultData[1])}})}},setUsersList:function(){},loadMAddrPopUp:function(getThis,tagId){$(getThis).data("data")||(Zohosign.initiatePopOver(),$(getThis).popover("show")),TemplateCommon.selectMalertAddr(tagId,$(getThis))},initiatePopOver:function(){var data={},pageDiv=$("#"+AutomationCommon.getCurrentPageId());Layout.Page.container,ZPACommon.getMode();pageDiv.find("#newTemplateDiv").show();var keyPairIdJson="";keyPairIdJson=JSON.parse(JSON.stringify(TemplateCommon.keyPairIdJson));var employeeObjs={},userList=ZPeople.getUserListData();$.each(userList,function(cnt,empObj){"false"===empObj.isNonUser&&"false"===empObj.isMobileUser&&(employeeObjs[empObj.usererec]=empObj.name+" "+empObj.empid)});var fromObj=pageDiv.find("#fromMailAddr"),getFromList=fromObj.find("option").map(function(){return-1!==$(this).val().indexOf("ORGEMAIL")?JSON.parse($(this).val()).ID:$(this).val()}).get();$.each(data.fromEmailDtls,function(key,obj){if(-1===$.inArray(obj.orgEmailSetId,getFromList)){var opt=$("<option>",{value:'{"ID":"'+obj.orgEmailSetId+'","KEY":"ORGEMAIL"}',text:ZPI18N.getString("zp.orgemailtag")+" ("+obj.ORG_EMAIL+")"});fromObj.append(opt)}}),pageDiv.find("#fromAdd").data("domains",data.verifiedDom),data.system=employeeObjs,keyPairIdJson.system.Class="tab-pane fade active in",keyPairIdJson.system.parentClass="active";var popOverObjs=pageDiv.find("[targetid]");$.each(popOverObjs,function(i,obj){$(obj).attr("targetid");var addrPopOverHtml=AutomationCommon.contructMbox(data,keyPairIdJson,obj),popOverContent=$(addrPopOverHtml).clone();void 0===$(obj).data("bs.popover")?$(obj).setPopOver({callback:TemplateCommon.msgTempAddrFn,html:popOverContent,targetId:$(obj).attr("targetid"),keyname:"name=list-group-item",multi:!0}):$(obj).setContent(popOverContent)}),$(popOverObjs).data("data",!0)},displayUsers:function(event){Layout.Page.container.find("#notify_Mail").is(":checked")?Layout.Page.container.find("#zsignShareOptListID").removeClass("DN"):Layout.Page.container.find("#zsignShareOptListID").addClass("DN")},getZSignUserIntegDetails:function(search){var params={action:"getZsignIntegDetails",conreqcsr:csrfToken};if(search){var searchText=$("#searchEmpToken").val();if(void 0!=searchText&&0!=searchText.length&&!ZPUtil.Validation.isEmail(searchText))return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.entervalidemailaddress"));params.recipients=searchText,params.search=!0}search&&void 0!=searchText&&0!=searchText.length?(Zohosign.integDtls=void 0,ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",params,Zohosign.displayZSignEmpToken,null,Zohosign.failedCallBack)):!search||void 0!=searchText&&0!=searchText.length?ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",params,Zohosign.constructZSignUserSlider,null,Zohosign.failedCallBack):(Zohosign.displayZSignEmpToken(Zohosign.initialintegDtls),Zohosign.integDtls=Zohosign.initialintegDtls)},selcheckboxEmp:function(thisObj){$(thisObj).prop("checked")?$(thisObj).parents("ul").addClass("actv"):$(thisObj).parents("ul").removeClass("actv")},displayZSignEmpToken:function(integDtls){Zohosign.searchIntegDtls=integDtls;var bodyHtml="";$("#search_email_list").find(".modal-body").remove();var indexZtoken=1;0!=integDtls.length&&(bodyHtml+='<div class="modal-body"><div class="ZPListing">  <div class="Scrcont"><div class="ZSsrch_lst"><div>');for(var x=0;x<integDtls.length;x++)bodyHtml=bodyHtml+'<ul class="ZPListingUL" id="#zplisting_"+indexZtoken+><li class="W20 PR0"><div class="checkbox"><input type="checkbox" onclick="Zohosign.selcheckboxEmp(this)" id="zsearchuser_'+indexZtoken+'" zuid='+integDtls[x].zuid+'><label class="MT3"></label></div></li><li class="CP W400"><div class="name DF"  zuid='+integDtls[x].zuid+" ><img src="+integDtls[x].image+' class=""><div class="W100"><span class="ellip">'+integDtls[x].value+'</span><a class="DB">'+integDtls[x].emailId+"</a></div></div>  </li> </ul>",indexZtoken++;0!=integDtls.length&&(bodyHtml=bodyHtml+'</div><div class="zsign_ftr "><span class="btn btn-primary" onclick="Zohosign.validateAddbtn()">'+ZPI18N.getString("zp.lms.course.add")+'</span><span class="btn btn-default" id="zignClsT" onclick="Zohosign.closeAccountbtn()">'+ZPI18N.getString("zp.close")+"</span></div>"),0!=integDtls.length&&(bodyHtml+="</div></div></div>  </div>"),$("#integPeopleData").addClass("DN"),$("#search_email_list").removeClass("DN"),$("#searchEmpToken").after(bodyHtml),indexZtoken=1;for(x=0;x<Zohosign.searchIntegDtls.length;x++)Layout.Page.container.find("#zsearchuser_"+indexZtoken).data("jsonsearchData",Zohosign.searchIntegDtls[x]),indexZtoken++;0==indexZtoken&&Zohosign.norecordsfound()},toggleNoteView:function(){Layout.Page.container.find("#expandNote").toggleClass("z_mview"),Layout.Page.container.find("#fullviewNote").hasClass("CR-fullview")?(Layout.Page.container.find("#fullviewNote").removeClass("CR-fullview"),Layout.Page.container.find("#fullviewNote").addClass("CR-miniview"),Layout.Page.container.find("#fullviewNote").attr("data-original-title",ZPI18N.getString("zp.minimize"))):(Layout.Page.container.find("#fullviewNote").removeClass("CR-miniview"),Layout.Page.container.find("#fullviewNote").addClass("CR-fullview"),Layout.Page.container.find("#fullviewNote").attr("data-original-title",ZPI18N.getString("zp.maximize")))},constructZSignUserSlider:function(integData){$pageId().append('<div class="modal-backdrop in"></div>');var indexZtoken=0;Zohosign.activeZuidCnt=0,Zohosign.integDtls=integData,Zohosign.initialintegDtls=integData;for(var placeHolder=ZPI18N.getString("zp.searchemployee"),bodyHtml='<div class="modal popRgtModel zsignPop  in" id="zsign_user_config_modal" role="dialog" aria-labelledby="modal" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content" id="zsignEmpList"><div class="modal-header PR"><button aria-label="Close" data-dismiss="modal" class="close" type="button" onclick="Zohosign.closeIntegPopup()"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button><h6 class="addPopTitle">'+ZPI18N.getString("zp.zohosign")+'</h6><p class="dgry MB15 MT5">'+ZPI18N.getString("zp.ztoken1")+'</p></div><div class="ZPListing"><div class="ZPListingHdr"><ul class="ZPListingUL"><li class="name dgry W400">'+ZPI18N.getString("zp.activeaccounts")+'</li><li><span class="name MR10">'+ZPI18N.getString("zp.status")+'</span></li><li><span class="name MR10">'+ZPI18N.getString("zp.enableall")+'</span><span class="cout PT5"><label class="btnactive chkBxSwitch M0I VM "><input class="cmn-toggle-small cmn-toggle-round-small" type="checkbox" id="selectAllchk" onclick="Zohosign.checkAllbox()"><span class="M0"></span></label></span></li></ul></div></div><div class="ZPednote yell MT20" id="expandNote"><b>'+ZPI18N.getString("zp.ztokennoteheader")+'<i onclick="Zohosign.toggleNoteView()" id="fullviewNote" data-toggle="tooltip" data-placement="left" data-original-title='+ZPI18N.getString("zp.minimize")+' class="CR-miniview FR CP blk PR5 S18"></i><i class="CR-miniview FR CP blk PR5 S18 DN"></i></b><ul style="list-style-type:disc"><li>'+ZPI18N.getString("zp.tokennote1")+"</li><li>"+ZPI18N.getString("zp.tokennote2")+"</li><li>"+ZPI18N.getString("zp.tokennote3")+'</li></ul></div><div class="zsignCont" id="addAcctListing"><div class="zsign_adac" id="addAccountbtn" onclick="Zohosign.addAccountbtn()"><span> <i class="IC-plus-fill"></i>'+ZPI18N.getString("zp.activeacct")+'</span></div>  <div class="modal-body" id="integPeopleData"><div class="ZPListing">   <div class="Scrcont">',x=0;x<Zohosign.integDtls[1].resp.length;x++)indexZtoken++,Layout.Page.container.find("#ztoken_norecords").addClass("DN"),bodyHtml=bodyHtml+'<ul class="ZPListingUL"><li class="CP W400"><div class="name DF"><img src='+Zohosign.integDtls[1].resp[x].empPhoto+'class=""><div class="W100"><span class="ellip">'+Zohosign.integDtls[1].resp[x].empId+" - "+Zohosign.integDtls[1].resp[x].empName+'</span><a class="DB">'+Zohosign.integDtls[1].resp[x].email+"</a></div></div> </li>",void 0==Zohosign.integDtls[1].resp[x].inZohoSign?bodyHtml=bodyHtml+'<li class="W200"><span>'+ZPI18N.getString("zp.inactive")+" "+ZPI18N.getString("zp.in")+" "+ZPI18N.getString("zp.zohosign")+"</span></li>":void 0==Zohosign.integDtls[1].resp[x].status?bodyHtml=bodyHtml+'<li class="W200"><span>'+ZPI18N.getString("zp.inactive")+"</span></li>":1==Zohosign.integDtls[1].resp[x].status?(Zohosign.activeZuidCnt++,bodyHtml=bodyHtml+'<li class="W200"><span>'+ZPI18N.getString("zp.active")+"</span></li>"):void 0!=Zohosign.integDtls[1].resp[x].tobeDeleted&&Zohosign.integDtls[1].resp[x].tobeDeleted?bodyHtml=bodyHtml+'<li class="W200"><span>'+ZPI18N.getString("zp.zstokendeactivate")+"</span></li>":void 0!=Zohosign.integDtls[1].resp[x].tobeActivated&&Zohosign.integDtls[1].resp[x].tobeActivated?bodyHtml=bodyHtml+'<li class="W200"><span>'+ZPI18N.getString("zp.zstokenactivate")+"</span></li>":0==Zohosign.integDtls[1].resp[x].status&&(bodyHtml=bodyHtml+'<li class="W200"><span>'+ZPI18N.getString("zp.emailsent")+"</span></li>"),bodyHtml+='<li class="text-center"><span class="cout PT5 ML40"><label class="btnactive chkBxSwitch M0I VM ">',bodyHtml=Zohosign.integDtls[1].resp[x].isEnable?bodyHtml+'<input class="cmn-toggle-small cmn-toggle-round-small" checked="" type="checkbox" zuid='+Zohosign.integDtls[1].resp[x].zuid+' id="zuser_'+indexZtoken+'">':bodyHtml+'<input class="cmn-toggle-small cmn-toggle-round-small" type="checkbox"  zuid='+Zohosign.integDtls[1].resp[x].zuid+'  id="zuser_'+indexZtoken+'">',bodyHtml+='<span class="M0"></span></label></span></li></ul>';bodyHtml=bodyHtml+'</div></div></div></div><div class="zsignCont DN" id="search_email_list" onmouseleave="Zohosign.hideOnMouseOutsearchList()"><div class="search-cmn opn" id="searchEmpToken"><i class="IC-lens"></i><input type="text" class="ztextbox" value="" autocomplete="off" id="searchList" placeholder='+placeHolder+'></div> </div><div class="modal-footer" id="zsignFooter"><button type="button" class="btn btn-primary" onclick="Zohosign.submitZSTokenDetails()">'+ZPI18N.getString("zp.save")+'</button><button type="button" class="btn btn-default ML15I" onclick="Zohosign.closeIntegPopup()">'+ZPI18N.getString("zp.cancel")+'</button><a class="btn btn-danger FR" name="ZohoSign" revokeAll=true onclick="Zohosign.deleteConfigConfirm(this)">'+ZPI18N.getString("zp.gtrevoke")+'<i class="IC-sync whi P5 DIB rotate-animate" id="revokeZPayrollLoader" style="display:none;"></i></a></div></div></div>',0==Layout.Page.container.find("#zsign_user_config_modal").length?($("#admin-integration-zohoservices").append(bodyHtml),0==indexZtoken&&Zohosign.norecordsfound()):Layout.Page.container.find("#zsign_user_config_modal").addClass("popRgtModel");var indexToken=0;for(x=0;x<Zohosign.integDtls[1].resp.length;x++)indexToken++,Layout.Page.container.find("#zuser_"+indexToken).data("jsonData",Zohosign.integDtls[1].resp[x]);Layout.Page.container.find("#zsign_user_config_modal").fadeIn(100);var empObj_data=function(initObj){var query=$(initObj).val();return query=void 0==query||""==query?"*":query,EmployeeDropdown.getEmpList(query,"emp","FILES_ESIGNLIST",[],{},!1,"",!0)};Zohosign.selectEmployee,Zohosign.unSelectEmployee,ZPArrow.BOTTOM_CENTER;$(document).on("keyup","#searchList",function(e){Zohosign.displayZSignEmpToken(empObj_data("#searchList"))})},addAccountbtn:function(){Layout.Page.container.find("#addAcctListing").addClass("DN"),Layout.Page.container.find("#search_email_list").removeClass("DN")},closeAccountbtn:function(){Layout.Page.container.find("#search_email_list").addClass("DN"),Layout.Page.container.find("#addAcctListing").removeClass("DN"),Layout.Page.container.find("#integPeopleData").removeClass("DN"),0!=Layout.Page.container.find("#search_email_list .modal-body").length&&(Layout.Page.container.find("#search_email_list .modal-body").remove(),Layout.Page.container.find("#searchList").val(""))},hideOnMouseOutsearchList:function(){0==Layout.Page.container.find("#search_email_list .modal-body").length&&Zohosign.closeAccountbtn()},validateAddbtn:function(){for(var leng=$(".ZSsrch_lst").find(".ZPListingUL .checkbox").find("input").length,tokenCount=$("#zsignEmpList #integPeopleData .ZPListingUL li span.ellip").length,newuserCount=tokenCount,idArray=[],bodyHtml="",i=0;i<leng;i++){if($(".ZSsrch_lst .ZPListingUL .checkbox").find("input")[i].checked){0;var alreadyPresent=!1,zuid=$(Layout.Page.container.find(".ZSsrch_lst .ZPListingUL .checkbox").find("input")[i]).attr("zuid"),id=$(Layout.Page.container.find(".ZSsrch_lst .ZPListingUL .checkbox").find("input")[i]).attr("id");idArray.push(id);for(var t=0;t<tokenCount;t++){if(zuid==$(Layout.Page.container.find("#zsignEmpList #integPeopleData .ZPListingUL")[t]).find("input").attr("zuid")){!0,alreadyPresent=!0;break}}if(!alreadyPresent){newuserCount++;var jsonUser=$(Layout.Page.container.find(".ZSsrch_lst .ZPListingUL .checkbox").find("input")[i]).data("jsonsearchData");bodyHtml=bodyHtml+'<ul class="ZPListingUL"><li class="CP W400"><div class="name DF"><img src='+jsonUser.image+'class=""><div class="W100"><span class="ellip">'+jsonUser.value+'</span><a class="DB">'+jsonUser.emailId+'</a></div></div> </li><li class="W200"><span></span></li><li class="text-center"><span class="cout PT5 ML40"><label class="btnactive chkBxSwitch M0I VM "><input class="cmn-toggle-small cmn-toggle-round-small" checked="" type="checkbox"  zuid='+jsonUser.zuid+'  id="zuser_'+newuserCount+'"><span class="M0"></span></label></span></li></ul>'}}for(var k=0;k<idArray;k++)$(Layout.Page.container.find("#"+idArray)).prop("checked",!1)}Layout.Page.container.find("#integPeopleData .ZPListingUL:last").after(bodyHtml),Zohosign.closeAccountbtn()},norecordsfound:function(){var currScrollContObj=Layout.Page.container.find("#ztoken_norecords"),noFilesFound="";noFilesFound+='<div class="ctable"><div class="ctcell"><div class="ZPNdata">',noFilesFound+='<i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i>',noFilesFound+='<i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i>',noFilesFound+='<h5 id="zp_views_nodata">'+ZPI18N.getString("zp.noactiveaccounts")+"</h5></div></div></div>",currScrollContObj.append(noFilesFound)},closeIntegPopup:function(){$("#zsign_user_config_modal").remove(),$(".modal-backdrop").remove(),Zohosign.integDtls=void 0,Zohosign.initialintegDtls=void 0},deleteConfigConfirm:function(thisObj){ZPeople.confirm(this,"zp.zpalert","zp.revokealltokens","","","",ZPI18N.getString("zp.confirm"),"",!0),$("#confirmConfirmationPopup").attr("name","ZohoSign"),$("#confirmConfirmationPopup").attr("revokeAll",!0),$("#confirmConfirmationPopup").attr("onclick","allServicesInteg.revokeAuthenticatedService(this)")},submitZSTokenDetails:function(){$("#selectAllchk").is(":checked");for(var zuidArray="",delzuidArray="",documentId="",count=0,delcount=0,deleteActiveZuidCnt=0,leng=$("#zsignEmpList #integPeopleData .ZPListingUL li span.ellip").length,i=1;i<=leng;i++)if($("#zsignEmpList .ZPListingUL #zuser_"+i).is(":checked")){var status=0;void 0!=Layout.Page.container.find("#zuser_"+i).data("jsonData")?(documentId=Layout.Page.container.find("#zuser_"+i).data("jsonData").zuid,status=Layout.Page.container.find("#zuser_"+i).data("jsonData").status):documentId=Layout.Page.container.find("#zuser_"+i).attr("zuid"),0==status&&(count>=1&&(zuidArray+=","),zuidArray+=documentId,count++)}else void 0!=Layout.Page.container.find("#zuser_"+i).data("jsonData")&&(documentId=Layout.Page.container.find("#zuser_"+i).data("jsonData").zuid,1==Layout.Page.container.find("#zuser_"+i).data("jsonData").status&&deleteActiveZuidCnt++,++delcount>1&&(delzuidArray+=","),delzuidArray+=documentId);deleteActiveZuidCnt>=Zohosign.activeZuidCnt?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.retainoneactiveuser")):ZPeople.Request.sendAsyncPost("/zohoSignActions.zp",{action:"scheduleTokenMail",conreqcsr:csrfToken,zuidArray:zuidArray,delzuidArray:delzuidArray},Zohosign.zsignGenerateTokenResp,"",Zohosign.failedCallBack)},zsignGenerateTokenResp:function(resp){resp[1]?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.zstokenschedule")),Zohosign.closeIntegPopup()):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.messages.unexpectederror"))},checkAllbox:function(){$("#selectAllchk").is(":checked")?$("#selectAllchk").prop("checked",!0):$("#selectAllchk").prop("checked",!1)}};var lmsfileuploaddownload={x_service_code:"",upload_url:"",uploadSpecObj:null,supportedFiles:{supportedMediaExtensions:"image/*,video/*,audio/*",supportedFileExtensions:".js,,java,.css,.jsp,.xml,.log,.python,.py,.properties,.html,.htm,.conf,.sh,.c,.cpp,.jspf,.go,.eml,.odt",supportedDocumentExtensions:".txt,.text,.pdf,.doc,.docx,.sxw,.odt,.rtf",supportedSheetExtensions:".xls,.xlsx,.ods,.sxc,.csv,.tsv",supportedPresentationExtensions:".ppt,.pptx,.pps,.odp,.sxi"},uploadFileEleId:"",onSelect:function(eve,parentId,uploadMode){var pageId=Layout.Page.hash.indexOf("selfservice/user/files")>-1?Layout.Page.parentContainer.parent():Layout.Page.container,fileName=eve.files[0].name;if(pageId.find("#drop_file span").text(fileName),pageId.find("#fileName").val(fileName),Files.udsParams.fileId="-1",Files.udsParams.fileVersion="",Files.uploadMode=uploadMode,lmsfileuploaddownload.uploadFileEleId=parentId,eve.files.length&&lmsfileuploaddownload.uploadViaXHRs(eve),UDS_UPLOAD_IS_ACTIVE){var fieldId=$(eve).attr("id"),fileConsHtml='<div class="zpfilepro"><em>'+ZPeople.escapeHtml(fileName)+'</em><div data-progressjs="'+fieldId+'" style="width: 0%"></div>';fileConsHtml+='<i class="IC-cls-1px fclose" onclick="Files.toggleFileFieldDisplay()"></i></div>',pageId.find("#"+lmsfileuploaddownload.uploadFileEleId).find("#afterUpload").removeClass("zpmulti-fl")}pageId.find("#"+lmsfileuploaddownload.uploadFileEleId).find("#afterUpload").html(fileConsHtml),pageId.find("#"+lmsfileuploaddownload.uploadFileEleId).find("#beforeUpload,#afterUpload").toggleClass("DN"),UDS_UPLOAD_IS_ACTIVE&&progressJs("div[data-progressjs='"+fieldId+"']").autoIncrease(8,10)},uploadViaXHRs:function(eve){for(var fileStore=eve.files,i=0;i<fileStore.length;i++)lmsfileuploaddownload.uploadFileByXHR(fileStore[i])},uploadFileByXHR:function(file){var xhr=new XMLHttpRequest,uploadId_files=lmsfileuploaddownload.generateUniqueKey();xhr.upload.uploadId=uploadId_files;var udsUploadApi=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload";xhr.open("post",udsUploadApi,!0),xhr.setRequestHeader("x-assured-response",!0),xhr.setRequestHeader("x-streammode","1"),xhr.setRequestHeader("x-fclient-version","2"),xhr.setRequestHeader("app-info",JSON.stringify({portalId:_LOGGEDIN_ACCZSOID,moduleName:"Files"})),xhr.setRequestHeader("file-info",JSON.stringify({fileName:encodeURIComponent(file.name),contentType:file.type,fileSize:file.size})),xhr.setRequestHeader("upload-id",uploadId_files),xhr.withCredentials=!0,xhr.onreadystatechange=function(oEvent){if(4==xhr.readyState)if(200!==xhr.status)(Layout.Page.hash.indexOf("selfservice/user/files")>-1?Layout.Page.parentContainer.parent():Layout.Page.container).find("#"+lmsfileuploaddownload.uploadFileEleId).find("#drop_file").parent().parent().after('<span  errmsg="mailids" id="errormsg" class="ERR">'+ZPI18N.getString("zp.fileuploaderror")+"</strong></span>");else if(200===xhr.status){var responseObj=JSON.parse(xhr.response);lmsfileuploaddownload.uploadCallBack(responseObj)}},xhr.send(file)},uploadCallBack:function(uploadedFileInfo){if(this.uploadedFileInfo=uploadedFileInfo,uploadedFileInfo.fileInfo){var fileInfo=uploadedFileInfo.fileInfo;Files.udsParams.fileId=fileInfo.fileId,Files.udsParams.fileVersion=fileInfo.fileVersion;var progressDiv=Layout.Page.container.find("div[data-progressjs='uploadfile']");if(0!=progressDiv.length){progressJs("div[data-progressjs='uploadfile']").end(),progressDiv.parent().removeClass(),progressDiv.parent().addClass("zpfilepro success"),progressDiv[0].style.width="100%",progressDiv.parent().find(".fclose").remove(),progressDiv.parent().after("<span>Success</span>");var fileObj=Layout.Page.container.find("div#"+lmsfileuploaddownload.uploadFileEleId).find("input#uploadfile")[0].files[0];Layout.Page.container.find("#"+lmsfileuploaddownload.uploadFileEleId).find("#afterUpload").html('<span id="drop_file"><span id="importFileName">'+ZSEC.Encoder.encodeForHTML(fileObj.name)+'</span><i class="IC-cls-r red" onclick="Files.toggleFileFieldDisplay()"></i></span>')}}},generateUniqueKey:function(){return(new Date).getTime()+""+erecno}};ProgressJs=function(obj){void 0!==obj.length?this._targetElement=obj:this._targetElement=[obj],void 0===window._progressjsId&&(window._progressjsId=1),void 0===window._progressjsIntervals&&(window._progressjsIntervals={}),this._options={theme:"blue",overlayMode:!1,considerTransition:!0}},_startProgress=function(){void 0!==this._onBeforeStartCallback&&this._onBeforeStartCallback.call(this),_createContainer.call(this);for(var i=0,elmsLength=this._targetElement.length;i<elmsLength;i++)_setcall(this,this._targetElement[i])},_setProgress=function(targetElement){if(!targetElement.hasAttribute("data-progressjs")){var targetElementOffset=_getOffset.call(this,targetElement);targetElement.setAttribute("data-progressjs",window._progressjsId);var progressElementContainer=document.createElement("div");progressElementContainer.className="progressjs-progress progressjs-theme-"+this._options.theme,"body"===targetElement.tagName.toLowerCase()?progressElementContainer.style.position="fixed":progressElementContainer.style.position="absolute",progressElementContainer.setAttribute("data-progressjs",window._progressjsId);var progressElement=document.createElement("div");progressElement.className="progressjs-inner";var progressPercentElement=document.createElement("div");progressPercentElement.className="progressjs-percent",progressPercentElement.innerHTML="1%",progressElement.appendChild(progressPercentElement),this._options.overlayMode&&"body"===targetElement.tagName.toLowerCase()?(progressElementContainer.style.left=0,progressElementContainer.style.right=0,progressElementContainer.style.top=0,progressElementContainer.style.bottom=0):(progressElementContainer.style.left=targetElementOffset.left+"px",progressElementContainer.style.top=targetElementOffset.top+"px","BODY"==targetElement.nodeName?progressElementContainer.style.width="100%":progressElementContainer.style.width=targetElementOffset.width+"px",this._options.overlayMode&&(progressElementContainer.style.height=targetElementOffset.height+"px")),progressElementContainer.appendChild(progressElement),document.querySelector(".progressjs-container").appendChild(progressElementContainer),_setPercentFor(targetElement,1),++window._progressjsId}},_setPercent=function(percent){for(var i=0,elmsLength=this._targetElement.length;i<elmsLength;i++)_setPercentFor.call(this,this._targetElement[i],percent)},_setPercentFor=function(targetElement,percent){var self=this;percent>=100&&(percent=100),targetElement.hasAttribute("data-progressjs")&&setTimeout(function(){void 0!==self._onProgressCallback&&self._onProgressCallback.call(self,targetElement,percent);var percentElement=_getPercentElement(targetElement);void 0!=percentElement&&null!=percentElement&&(percentElement.style.width=parseInt(percent)+"%")},50)},_getPercentElement=function(targetElement){var progressjsId=""+targetElement.getAttribute("data-progressjs");return document.querySelector('[data-progressjs="'+progressjsId+'"]')},_autoIncrease=function(size,millisecond){var self=this,target=this._targetElement[0];if(target){var progressjsId=""+target.getAttribute("data-progressjs");void 0!==window._progressjsIntervals[progressjsId]&&clearInterval(window._progressjsIntervals[progressjsId]),window._progressjsIntervals[progressjsId]=setInterval(function(){_increasePercent.call(self,size)},millisecond)}},_increasePercent=function(size){for(var i=0,elmsLength=this._targetElement.length;i<elmsLength;i++){var currentElement=this._targetElement[i];if(currentElement.hasAttribute("data-progressjs")){var percentElement=_getPercentElement(currentElement);if(void 0==percentElement||null==percentElement){var progressjsId=""+currentElement.getAttribute("data-progressjs");if(window._progressjsIntervals[progressjsId])try{clearInterval(window._progressjsIntervals[progressjsId]),window._progressjsIntervals[progressjsId]=null,delete window._progressjsIntervals[progressjsId]}catch(ex){}}var existingPercent=parseInt(percentElement.style.width.replace("%",""));existingPercent<90&&_setPercentFor.call(this,currentElement,existingPercent+(size||1))}}},_end=function(){void 0!==this._onBeforeEndCallback&&(!0===this._options.considerTransition?_getPercentElement(this._targetElement[0]).addEventListener(whichTransitionEvent(),this._onBeforeEndCallback,!1):this._onBeforeEndCallback.call(this));var target=this._targetElement[0];if(target){var progressjsId=""+target.getAttribute("data-progressjs");elmsLength=this._targetElement.length;if(0<elmsLength){var currentElement=this._targetElement[0],percentElement=_getPercentElement(currentElement);if(!percentElement)return;var timeoutSec=1;parseInt(percentElement.style.width.replace("%",""))<100&&(_setPercentFor.call(this,currentElement,100),timeoutSec=500),function(percentElement,currentElement){setTimeout(function(){percentElement.parentNode.className+=" progressjs-end",setTimeout(function(){$(percentElement.parentElement).closest(".zp-err").find('[id="error_message"]').remove(),$(percentElement.parentElement).closest(".zp-err").removeClass("zp-err"),$(percentElement.parentElement.parentElement).addClass("zpmulti-fl"),$(percentElement.parentElement.previousSibling).removeClass("DN"),$(percentElement.parentElement).next().remove(),percentElement.parentNode.parentNode.removeChild(percentElement.parentNode),currentElement.removeAttribute("data-progressjs")},1e3)},timeoutSec)}(percentElement,currentElement)}if(window._progressjsIntervals[progressjsId])try{clearInterval(window._progressjsIntervals[progressjsId]),window._progressjsIntervals[progressjsId]=null,delete window._progressjsIntervals[progressjsId]}catch(ex){}}},_kill=function(){var target=this._targetElement[0];if(target){var progressjsId=""+target.getAttribute("data-progressjs");if(elmsLength=this._targetElement.length,0<elmsLength){var currentElement=this._targetElement[0],percentElement=_getPercentElement(currentElement);if(!percentElement)return;!function(percentElement,currentElement){percentElement.parentNode.className+=" progressjs-end",setTimeout(function(){currentElement.removeAttribute("data-progressjs")},1e3)}(percentElement,currentElement)}if(window._progressjsIntervals[progressjsId])try{clearInterval(window._progressjsIntervals[progressjsId]),window._progressjsIntervals[progressjsId]=null,delete window._progressjsIntervals[progressjsId]}catch(ex){}}},_createContainer=function(){if(!document.querySelector(".progressjs-container")){var containerElement=document.createElement("div");containerElement.className="progressjs-container",document.body.appendChild(containerElement)}},_getOffset=function(element){var elementPosition={};"body"===element.tagName.toLowerCase()?(elementPosition.width=element.clientWidth,elementPosition.height=element.clientHeight):(elementPosition.width=element.offsetWidth,elementPosition.height=element.offsetHeight);for(var _x=0,_y=0;element&&!isNaN(element.offsetLeft)&&!isNaN(element.offsetTop);)_x+=element.offsetLeft,_y+=element.offsetTop,element=element.offsetParent;return elementPosition.top=_y,elementPosition.left=_x,elementPosition},_mergeOptions=function(obj1,obj2){var obj3={};for(var attrname in obj1)obj3[attrname]=obj1[attrname];for(var attrname in obj2)obj3[attrname]=obj2[attrname];return obj3};var progressJs=function(targetElm){if("object"==typeof targetElm)return new ProgressJs(targetElm);if("string"==typeof targetElm){var targetElement=document.querySelectorAll(targetElm);if(targetElement)return new ProgressJs(targetElement);throw new Error("There is no element with given selector.")}return new ProgressJs(document.body)};whichTransitionEvent=function(){var t,el=document.createElement("fakeelement"),transitions={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in transitions)if(void 0!==el.style[t])return transitions[t]},progressJs.fn=ProgressJs.prototype={clone:function(){return new ProgressJs(this)},setOption:function(option,value){return this._options[option]=value,this},setOptions:function(options){return this._options=_mergeOptions(this._options,options),this},start:function(){return _startcall(this),this},set:function(percent){return _setPercent.call(this,percent),this},increase:function(size){return _increasePercent.call(this,size),this},autoIncrease:function(size,millisecond){return _autoIncrease.call(this,size,millisecond),this},end:function(){return _end.call(this),this},kill:function(){return _kill.call(this),this},onbeforeend:function(providedCallback){if("function"!=typeof providedCallback)throw new Error("Provided callback for onbeforeend was not a function");return this._onBeforeEndCallback=providedCallback,this},onbeforestart:function(providedCallback){if("function"!=typeof providedCallback)throw new Error("Provided callback for onbeforestart was not a function");return this._onBeforeStartCallback=providedCallback,this},onprogress:function(providedCallback){if("function"!=typeof providedCallback)throw new Error("Provided callback for onprogress was not a function");return this._onProgressCallback=providedCallback,this}};var ReportSettings={},RSCONSTANTS={MONTHLY:1,WEEKLY:2,BIWEEKLY:3,SEMIMONTHLY:4,SUNDAY:0,MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,LASTDAY:32,NONE:-1,CURRENT_MONTH:0,NEXT_MONTH:1,WEEK_NAME:[ZPI18N.getString("zp.sunday"),ZPI18N.getString("zp.monday"),ZPI18N.getString("zp.tuesday"),ZPI18N.getString("zp.wednesday"),ZPI18N.getString("zp.thursday"),ZPI18N.getString("zp.friday"),ZPI18N.getString("zp.saturday")],SUPERSCRIPT:{1:"st",2:"nd",3:"rd",4:"th"}};ReportSettings={MODAL_ID:"zp_reportsetting_modal",localValues:{},ALL_LIST:{},autoApplyLeavePayperiod:!1,LAYOUT:$("<form class='form-horizontal pad' role='form'><div class='form-group'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.ppname")+"</label><div class='col-sm-6'><input class='form-control' id='zp_rs_name' type='text'><span id='zp_rs_name_error' class='error-msg'></span></div></div><div class='form-group'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.ppcycle")+"</label><div class='col-sm-3'><select id='zp_rs_frequency' onchange=ReportSettings.onFrequencyChange()><option value="+RSCONSTANTS.MONTHLY+">"+ZPI18N.getString("zp.monthly")+"</option><option value="+RSCONSTANTS.WEEKLY+">"+ZPI18N.getString("zp.weekly")+"</option><option value="+RSCONSTANTS.BIWEEKLY+">"+ZPI18N.getString("zp.local.BiWeekly")+"</option><option value="+RSCONSTANTS.SEMIMONTHLY+">"+ZPI18N.getString("zp.local.HalfMonthly")+"</option></select><span id='zp_rs_frequency_error' class='error-msg'></span></div></div><div class='form-group'><div class='col-sm-offset-3 col-sm-3'><select id='zp_rs_from_day'></select><span class='DN dgry MT5' id='zp_rs_startday_info_dummy'>of every month</span></div><div class='col-sm-3'><label class='control-label to-label'>-</label><select id='zp_rs_to_day' onchange='ReportSettings.validateEndDay();'></select><span class='DN dgry MT5' id='zp_rs_endday_info_dummy'>of every month</span><span id='zp_rs_to_day_error' class='error-msg'></span></div></div><span id='zp_rs_to_day_info_dummy' class=' DN error-msg col-sm-offset-3'></span></div><div class='form-group'><label class='control-label col-sm-3' id='zp_rs_ppprocDayText_1'>"+ZPI18N.getString("zp.ppprocessingday")+"</label><div class='col-sm-3'><select class='W100I' id='zp_rs_closure_day' onchange='ReportSettings.validateClosureDay();'></select><span id='zp_rs_closure_day_error' class='error-msg' style='display: none;'></span><span class='DN dgry MT5' id='zp_rs_closure_day_info_dummy'></span></div><div class='col-sm-6'></div></div><div class='form-group'><label class='control-label col-sm-3' id='zp_rs_freeze_dateText'>"+ZPI18N.getString("zp.ppgenerationday")+"</label><div class='col-sm-3'><select class='W100I' id='zp_rs_freeze_date'  onchange='ReportSettings.validateClosureDay();'></select><span id='zp_rs_closure_dayerror_semMont' class='error-msg' style='display: none;'></span><em id='zp_rs_payroll_text' class='dgry'></em></div><div class='col-sm-6 P0'><span class='DB dgry MT5'></span></div></div><div class='form-group' id='zp_rs_cont_semMont'><div class='col-sm-offset-3 col-sm-3'><select id='zp_rs_fromday_semMont'></select><span class='DB dgry MT5' id='zp_rs_startdayinfo_semMont'>of every month</span></div><div class='col-sm-3'><label class='control-label to-label'>-</label><select id='zp_rs_today_semMont'></select><span class='DB dgry MT5' id='zp_rs_enddayinfo_semMont'>of every month</span><span id='zp_rs_to_dayerror_semMont' class='error-msg'></span></div></div><div class='form-group' id='zp_rs_proCont_semMont'><label class='control-label col-sm-3' id='zp_rs_ppprocDayText_2'>"+ZPI18N.getString("zp.ppprocessingday")+"</label><div class='col-sm-3'><select class='W100I' id='zp_rs_closureday_semMont' onchange='ReportSettings.validateClosureDay();'></select><span id='zp_rs_closure_dayerror_semMont' class='error-msg' style='display: none;'></span></div><div class='col-sm-3'><span class='DB dgry MT5' id='zp_rs_closure_dayinfo_semMont'></span></div></div><div class='form-group DN' id='zp_rs_freeze_cont2' ><label class='control-label col-sm-3' id='zp_rs_freeze_dateText2'>"+ZPI18N.getString("zp.ppgenerationday")+"</label><div class='col-sm-3'><select class='W100I' id='zp_rs_freeze_date2'  onchange='ReportSettings.validateClosureDay();'></select><span id='zp_rs_closure_dayerror_semMont' class='error-msg' style='display: none;'></span><em id='zp_rs_payroll_text2'></em></div><div class='col-sm-6 P0'><span class='DB dgry MT5'></span></div></div><div class='form-group'><div class='col-sm-offset-3 col-sm-6'><label class='checkbox pp-checkbox'><input id='zp_rs_encash' type='checkbox' onchange='ReportSettings.validateClosureDay();'><span>"+ZPI18N.getString("zp.pp.processencashment")+"</span></label></div></div><div class='form-group'><div class='col-sm-offset-3 col-sm-6' id='freeze_lable'><label class='checkbox pp-checkbox'><input id='zp_rs_freeze' type='checkbox' onchange='ReportSettings.validateClosureDay();' name='chk1'><span>"+ZPI18N.getString("zp.pplock")+"<small id='lockInfo' class='dgry S14'> "+ZPI18N.getString("zp.pplockinfo")+"</small></span></label></div></div><div class='form-group'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.ppapplicablelocation")+"</label><div class='col-sm-6'><select id='zp_rs_location' multiple='multiple'></select><span id='zp_rs_location_error' class='error-msg'></span></div></div>"),tr:$("<tr class='ZPLRow'><td id='td_name'></td><td id='td_frequency'></td><td id='td_closureDay'></td><td class='text-right P0I'><div id='action_button' class='over-display' style='display: block;'><i onclick='ReportSettings.showHideConfirmDeleteButtons(this,\"action_confirm_button\",\"table-responsive\");' title='Delete' class='IC-delete S14 gry FR MR15 CP'></i><i id='zp_rs_edit' onclick='ReportSettings.constructAddEditPage(this,true);' title='Edit' class='IC-pen S14 gry FR MR15 CP'></i></div><div style='display: none;' id='action_confirm_button'><button onclick='ReportSettings.showHideConfirmDeleteButtons(this,\"action_button\",\"table-responsive\");' class='btn btn-default btn-sm FR MR15' type='button'>"+ZPI18N.getString("zp.cancel")+"</button><button id='zp_rs_delete' onclick='ReportSettings.deleteAction(this);' class='btn btn-danger btn-sm FR MR10' type='button'>"+ZPI18N.getString("zp.confirm")+"</button></div></td></tr>"),INPUT_PAGE:null,showReportSettingList:function(refresh){if(Layout.Page.container.find("#zp_report_settings_list_div_id,#zp_empty_report_settings_div_id").hide(),Layout.Page.container.find("#zp_report_settings_loading").html(ZPeople.LOADING_HTML).show(),Attendance.noDataImg(8,"CR-set-shlr",Layout.Page.container.find("#zp_svg_id")),Object.keys(ReportSettings.ALL_LIST).length<=0||refresh){var url="reportSettingAction.zp";ZPeople.Module.CURRENT_MODULEPREFIX&&(url="/"+ZPeople.Module.CURRENT_MODULEPREFIX+url);ZPeople.Request.send(url,{mode:"getReportSettings"},ReportSettings.constructListPage)}else ReportSettings.constructData(ReportSettings.ALL_LIST)},showReportSettingListAsync:function(refresh){if(Layout.Page.container.find("#zp_report_settings_loading").html(ZPeople.LOADING_HTML).show(),Attendance.noDataImg(8,"CR-set-shlr",Layout.Page.container.find("#zp_svg_id")),Object.keys(ReportSettings.ALL_LIST).length<=0||refresh){var url="reportSettingAction.zp";ZPeople.Module.CURRENT_MODULEPREFIX&&(url="/"+ZPeople.Module.CURRENT_MODULEPREFIX+url);ZPeople.Request.sendAsyncPost(url,{mode:"getReportSettings"},ReportSettings.constructListPage)}else ReportSettings.constructData(ReportSettings.ALL_LIST)},constructListPage:function(data){return"ACCESS_DENIED"===data.error?(ReportSettings.accessDenied(),null):data.STATUS===ZPI18N.getString("zp.capfailure")?(void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&(ZPeople.Message.showFailureMsg(data.CLIENT_MSG),Layout.Page.container.find("#zp_report_settings_list_div_id,#zp_report_settings_loading").hide(),Layout.Page.container.find("#zp_empty_report_settings_div_id").show()),null):(ReportSettings.iterate(data.DATA.reportSettingList),void ReportSettings.constructData(ReportSettings.ALL_LIST))},constructData:function(data){Object.keys(data).length>0?(Layout.Page.container.find("#zp_report_settings_list_div_id").show(),Layout.Page.container.find("#zp_empty_report_settings_div_id,#zp_report_settings_loading").hide(),Layout.Page.container.find("#zp_report_setting_table_body_id").empty(),$.each(data,function(key,value){var trClone=ReportSettings.tr.clone();trClone.attr("id","tr_"+value.reportSettID),trClone.find("#td_name").text(value.rsName),trClone.find("#td_frequency").html(value.ppcycle);var proDay=value.closureDayName;value.frequencyCode===RSCONSTANTS.MONTHLY&&value.closureDayCode!==RSCONSTANTS.LASTDAY&&(proDay+=""+ReportSettings.getNumberSuffix(parseInt(value.closureDayName))),proDay+=" <span class='dgry'>"+ReportSettings.getClosureDayInfo(value.frequencyCode,value.toDayCode,value.closureDayCode)+"</span>",value.closureDayName_2&&(proDay+="<div class='MT10'>"+value.closureDayName_2,value.frequencyCode===RSCONSTANTS.MONTHLY&&value.closureDayCode!==RSCONSTANTS.LASTDAY&&(proDay+=""+ReportSettings.getNumberSuffix(parseInt(value.closureDayName_2))),proDay+=" <span class='dgry'>"+value.info[4]+"</span>",proDay+="</div>"),trClone.find("#td_closureDay").html(proDay);var locNameConcat="";$.each(value.locationList,function(key,value){locNameConcat+=value+", ","<span class='label label-primary FL MR5'>"+value+"</span>"}),(locNameConcat=$.trim(locNameConcat)).length<=0?(locNameConcat=ZPI18N.getString("zp.capall"),ZPI18N.getString("zp.capall")):locNameConcat=locNameConcat.substring(0,locNameConcat.length-1),trClone.find("#zp_rs_edit").attr("rsID",value.reportSettID),trClone.find("#zp_rs_delete").attr("rsID",value.reportSettID),Layout.Page.container.find("#zp_report_setting_table_body_id").append(trClone)}),Layout.Page.container.find("#zp_report_setting_table_id").parent().hasClass("tabcont")||ZPView.handleTablePosition()):(Layout.Page.container.find("#zp_report_settings_list_div_id,#zp_report_settings_loading").hide(),Layout.Page.container.find("#zp_empty_report_settings_div_id").show())},showHideConfirmDeleteButtons:function(obj,toggleId,divClass){Layout.Page.container.find("."+divClass).css("overflow-x","hidden"),$(obj).parent().toggle("drop",{direction:"right"},200,function(){$(obj).parent().siblings("#"+toggleId).toggle("drop",200),Layout.Page.container.find("."+divClass).css("overflow-x","")})},iterate:function(reportList){void 0!==reportList&&$.each(reportList,function(key,value){var rsJson={};rsJson.reportSettID=value.rsID;var freq=value.rsFrequency;if(freq===RSCONSTANTS.MONTHLY){rsJson.frequencyCode=freq,rsJson.frequencyName=ZPI18N.getString("zp.monthly"),rsJson.toDayCode=value.rsToDay,rsJson.toDayName=ZPI18N.getString("zp.schlastday"),value.rsToDay!==RSCONSTANTS.LASTDAY&&(rsJson.toDayName=value.rsToDay);var startDay=ReportSettings.getStartDayFromEndDay(freq,value.rsToDay),info=ReportSettings.getStartDayEndDayInfo(freq,value.rsToDay),cycle=startDay;startDay!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(startDay))),cycle+=" <span class='dgry'>"+info[0]+"</span> - "+rsJson.toDayName,rsJson.toDayCode!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(rsJson.toDayName))),cycle+=" <span class='dgry'>"+info[1]+"</span>",rsJson.ppcycle=cycle,rsJson.startDayCode=startDay,rsJson.closureDayCode=value.rsClosureDay,rsJson.closureDayName=ZPI18N.getString("zp.select"),value.rsClosureDay===RSCONSTANTS.LASTDAY?rsJson.closureDayName=ZPI18N.getString("zp.schlastday"):value.rsClosureDay!==RSCONSTANTS.NONE&&(rsJson.closureDayName=value.rsClosureDay)}else if(freq===RSCONSTANTS.SEMIMONTHLY){rsJson.frequencyCode=freq,rsJson.frequencyName=ZPI18N.getString("zp.monthly"),rsJson.toDayCode=value.rsToDay,rsJson.toDayName=ZPI18N.getString("zp.schlastday"),value.rsToDay!==RSCONSTANTS.LASTDAY&&(rsJson.toDayName=value.rsToDay);var stEndDet=ReportSettings.getStartDayEndDay(value.rsToDay);info=ReportSettings.getStartDayEndDayInfo(freq,value.rsToDay);cycle="<div>"+stEndDet.startDay_1,stEndDet.startDay_1!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(stEndDet.startDay_1))),cycle+=" <span class='dgry'>"+info[0]+"</span> - "+rsJson.toDayName,rsJson.toDayCode!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(rsJson.toDayName))),cycle+=" <span class='dgry'>"+info[1]+"</span>",cycle+=" </div>",cycle+="<div class='MT10'>"+stEndDet.startDay_2,stEndDet.startDay_2!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(stEndDet.startDay_2))),stEndDet.endDay_2===RSCONSTANTS.LASTDAY?cycle+=" <span class='dgry'>"+info[2]+"</span> - "+ZPI18N.getString("zp.schlastday"):(cycle+=" <span class='dgry'>"+info[2]+"</span> - "+stEndDet.endDay_2,cycle+=ReportSettings.getNumberSuffix(parseInt(stEndDet.endDay_2))),cycle+=" <span class='dgry'>"+info[3]+"</span>",cycle+=" </div>",rsJson.ppcycle=cycle,rsJson.info=info,rsJson.startDayCode=startDay,rsJson.closureDayCode=value.rsClosureDay,rsJson.toDayCode_2=value.rsSecToDay,rsJson.closureDayCode_2=value.rsSecClosureDay,rsJson.closureDayName=ZPI18N.getString("zp.select"),value.rsClosureDay===RSCONSTANTS.LASTDAY?rsJson.closureDayName=ZPI18N.getString("zp.schlastday"):value.rsClosureDay!==RSCONSTANTS.NONE&&(rsJson.closureDayName=value.rsClosureDay),rsJson.closureDayName_2=ZPI18N.getString("zp.select"),value.rsSecClosureDay===RSCONSTANTS.LASTDAY?rsJson.closureDayName_2=ZPI18N.getString("zp.schlastday"):value.rsSecClosureDay!==RSCONSTANTS.NONE&&(rsJson.closureDayName_2=value.rsSecClosureDay),rsJson.rsSecPayrollClosure=value.rsSecPayrollClosure}else{rsJson.frequencyCode=freq,rsJson.frequencyName=ZPI18N.getString("zp.weekly"),rsJson.toDayCode=value.rsToDay,rsJson.toDayName=RSCONSTANTS.WEEK_NAME[value.rsToDay];startDay=ReportSettings.getStartDayFromEndDay(freq,value.rsToDay),cycle=RSCONSTANTS.WEEK_NAME[startDay]+" - "+rsJson.toDayName;rsJson.ppcycle=cycle,rsJson.startDayCode=startDay,rsJson.closureDayCode=value.rsClosureDay,rsJson.closureDayName=ZPI18N.getString("zp.select"),value.rsClosureDay!==RSCONSTANTS.NONE&&(rsJson.closureDayName=RSCONSTANTS.WEEK_NAME[value.rsClosureDay])}rsJson.rsName=ZPeople.decodeTxt(value.rsName),rsJson.isFreeze=value.rsIsFreeze,rsJson.rsProcessEncashment=value.rsProcessEncashment,rsJson.payrollClosure=ZP.optValue(value,"rsPayrollClosure",-1),rsJson.locationList=value.rsLocations,ReportSettings.ALL_LIST[rsJson.reportSettID]=rsJson})},constructAddEditPage:function(obj,isUpdate){var customFooter=$(ZPeople.BSModal.MODAL_FOOTER).clone();customFooter.append("<div id='zp_rs_input_warning_div' class='label-message ZPAltmsg DN'><p class='dorg' id='zp_rs_input_warning'></p></div>"),ZPeople.BSModal.setup({id:ReportSettings.MODAL_ID,type:2,modalClass:"popRgtModel ZPsecModal",header:ZPI18N.getString("zp.payperiodaddbutton"),body:ZPeople.LOADING_HTML,buttonValue:ZPI18N.getString("zp.save"),successCallback:isUpdate?ReportSettings.updateAction:ReportSettings.saveAction,footer:customFooter});var modelCnt=1,i=0;if(document.getElementsByClassName("modal-backdrop  in").length>1)for(;i<document.getElementsByClassName("modal-backdrop  in").length;)"modal-backdrop  in"==document.getElementsByClassName("modal-backdrop  in")[i].className&&(modelCnt>1?document.getElementsByClassName("modal-backdrop  in")[i].remove():modelCnt+=1),i++;ReportSettings.INPUT_PAGE=ReportSettings.LAYOUT.clone(),ReportSettings.INPUT_PAGE.find("#zp_rs_location").html(ZPUtil.Location.constructLocationComboBoxOption()),Layout.Page.container.find("#"+ReportSettings.MODAL_ID).find(".modal-body").html(ReportSettings.INPUT_PAGE),Layout.Page.container.find("#"+ReportSettings.MODAL_ID).find(".modal-footer").find("#cycle_details")[0]?Layout.Page.container.find("#"+ReportSettings.MODAL_ID).find(".modal-footer").find("#cycle_details").css("display","none"):Layout.Page.container.find("#"+ReportSettings.MODAL_ID).find(".modal-footer").append('<div class="label-message PPAltmsg label-note DN" id="cycle_details"></div>'),ReportSettings.defaultAction();var repSettID=$(obj).attr("rsID");Object.keys(ReportSettings.ALL_LIST).length>0&&$.each(ReportSettings.ALL_LIST,function(key,value){repSettID!==value.reportSettID&&$.each(value.locationList,function(key,value){Layout.Page.container.find("#zp_rs_location").find("option[value="+key+"]").remove()})}),Layout.Page.container.find("[data-popover]").popover(),isUpdate&&void 0!==obj&&void 0!==repSettID&&(ReportSettings.localValues.repSettID=repSettID,ReportSettings.populateData(repSettID))},populateData:function(repSettID){var rs=ReportSettings.ALL_LIST[repSettID];ReportSettings.INPUT_PAGE.find(".label-message").addClass("DN"),ReportSettings.INPUT_PAGE.find("#zp_rs_name").val(rs.rsName),ReportSettings.INPUT_PAGE.find("#zp_rs_frequency").select2("val",rs.frequencyCode+"").trigger("change"),ReportSettings.INPUT_PAGE.find("#zp_rs_from_day").select2("val",[rs.startDayCode]),ReportSettings.INPUT_PAGE.find("#zp_rs_to_day").select2("val",[rs.toDayCode]).trigger("change"),ReportSettings.INPUT_PAGE.find("#zp_rs_closure_day").select2("val",[rs.closureDayCode]).trigger("change"),ReportSettings.INPUT_PAGE.find("#zp_rs_closureday_semMont").select2("val",[rs.closureDayCode_2]).trigger("change"),ReportSettings.INPUT_PAGE.find("#zp_rs_freeze_date").select2("val",[rs.payrollClosure]).trigger("change"),ReportSettings.INPUT_PAGE.find("#zp_rs_freeze_date2").select2("val",[rs.rsSecPayrollClosure]).trigger("change"),ReportSettings.INPUT_PAGE.find("#zp_rs_freeze")[0].checked=rs.isFreeze,ReportSettings.INPUT_PAGE.find("#zp_rs_freeze")[0].onchange(),ReportSettings.INPUT_PAGE.find("#zp_rs_encash")[0].checked=rs.rsProcessEncashment,ReportSettings.INPUT_PAGE.find("#zp_rs_encash")[0].onchange(),ReportSettings.INPUT_PAGE.find("#zp_rs_location").select2("val",Object.keys(rs.locationList))},defaultAction:function(){Layout.Page.container.find(".error-msg").hide(),Layout.Page.container.find("#zp_rs_name").on("keypress",function(){Layout.Page.container.find("#zp_rs_name").val().length<=0&&Layout.Page.container.find("#zp_rs_name_error").hide()}),Layout.Page.container.find("#zp_rs_location").select2({placeholder:ZPI18N.getString("zp.select")}),Layout.Page.container.find("#zp_rs_frequency").select2({minimumResultsForSearch:1/0}),Layout.Page.container.find("#zp_rs_closure_day,#zp_rs_to_day,#zp_rs_from_day,#zp_rs_closureday_semMont,#zp_rs_today_semMont,#zp_rs_fromday_semMont").select2(),Layout.Page.container.find("#zp_rs_frequency").select2("val","1").trigger("change"),Layout.Page.container.find("#zp_rs_to_day,#zp_rs_from_day,#zp_rs_today_semMont,#zp_rs_fromday_semMont").select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_from_day,#zp_rs_fromday_semMont,#zp_rs_today_semMont").select2("disable"),Layout.Page.container.find("#zp_rs_closure_day,#zp_rs_closureday_semMont").select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_name").val(null)},validateInput:function(fromSave){var isValid=ReportSettings.validateEndDay(fromSave);return isValid=isValid?ReportSettings.validateClosureDay():isValid},validateEndDay:function(fromSave){Layout.Page.container.find("#zp_rs_frequency_error,#zp_rs_to_day_error").hide();var isValid=!0,frequency=Layout.Page.container.find("#zp_rs_frequency").select2("val"),toDay=parseInt(Layout.Page.container.find("#zp_rs_to_day").val());if(void 0===frequency?(Layout.Page.container.find("#zp_rs_frequency_error").html(ZPI18N.getString("zp.frequencyerror")).show(),isValid=!1):(null===toDay||void 0===toDay||isNaN(toDay)||-1===toDay)&&(Layout.Page.container.find("#zp_rs_to_day_error").html(ZPI18N.getString("zp.enddateerror")).show(),ReportSettings.INPUT_PAGE.find("#zp_rs_from_day").select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_startday_info,#zp_rs_endday_info").hide(),isValid=!1),!isValid)return isValid;frequency=parseInt(frequency),Layout.Page.container.find("#zp_rs_to_day_info").hide();var startDayVal;if(frequency===RSCONSTANTS.WEEKLY||frequency===RSCONSTANTS.BIWEEKLY){var prevWeekDay=toDay>=RSCONSTANTS.SATURDAY?RSCONSTANTS.SUNDAY:[toDay+1];"Report will generate from  "+RSCONSTANTS.WEEK_NAME[prevWeekDay]+" to "+RSCONSTANTS.WEEK_NAME[toDay]+".",ReportSettings.INPUT_PAGE.find("#zp_rs_from_day").select2("val",[prevWeekDay]),Layout.Page.container.find("#zp_rs_startday_info,#zp_rs_endday_info").hide();var sDayInfo=ZPI18N.getString("zp.pppreviousweek"),eDayInfo=ZPI18N.getString("zp.sofcurrentweek");6===toDay&&frequency===RSCONSTANTS.WEEKLY?sDayInfo=ZPI18N.getString("zp.sofcurrentweek"):6!==toDay&&frequency===RSCONSTANTS.BIWEEKLY&&(sDayInfo=ZPI18N.getString("zp.ppbeforepreviousweek")),Layout.Page.container.find("#zp_rs_startday_info").text(sDayInfo).show(),Layout.Page.container.find("#zp_rs_endday_info").text(eDayInfo).show()}else if(frequency===RSCONSTANTS.MONTHLY){var startDayInfo,endDayInfo;if(startDayVal=1,toDay===RSCONSTANTS.LASTDAY)"Report will generate from 1"+ReportSettings.getNumberSuffix(1)+" of current month to LAST DAY of current month.",startDayInfo=endDayInfo=ZPI18N.getString("zp.sofcurrentmonth");else{var prevMonthDay=[toDay+1];"Report will generate from "+prevMonthDay+ReportSettings.getNumberSuffix(prevMonthDay)+" of previous month to "+toDay+ReportSettings.getNumberSuffix(toDay)+" of current month.",startDayVal=prevMonthDay,startDayInfo=ZPI18N.getString("zp.pppreviousmonth"),endDayInfo=ZPI18N.getString("zp.sofcurrentmonth")}ReportSettings.INPUT_PAGE.find("#zp_rs_from_day").select2("val",[startDayVal]),Layout.Page.container.find("#zp_rs_startday_info").text(startDayInfo).show(),Layout.Page.container.find("#zp_rs_endday_info").text(endDayInfo).show()}else if(frequency===RSCONSTANTS.SEMIMONTHLY){var stEndDet=ReportSettings.getStartDayEndDay(toDay);startDayVal=stEndDet.startDay_1;var secEndDayVal=stEndDet.endDay_2,secStartDayVal=stEndDet.startDay_2;ReportSettings.INPUT_PAGE.find("#zp_rs_from_day").select2("val",[startDayVal]),ReportSettings.INPUT_PAGE.find("#zp_rs_fromday_semMont").select2("val",[secStartDayVal]),ReportSettings.INPUT_PAGE.find("#zp_rs_today_semMont").select2("val",[secEndDayVal]),fromSave||ReportSettings.setDayInfo(toDay)}var closureDay=parseInt(Layout.Page.container.find("#zp_rs_closure_day").val());return null===closureDay||void 0===closureDay||isNaN(closureDay)||-1===closureDay?isValid:(ReportSettings.validateClosureDay(),isValid)},getStartDayEndDay:function(toDay){var startDay_1=toDay-14,endDay_2=startDay_1-1,startDay_2=toDay+1,info={};return 15===toDay||14===toDay?(startDay_1=1,startDay_2=toDay+1,endDay_2=RSCONSTANTS.LASTDAY):toDay<15?startDay_1=(endDay_2=(startDay_2=toDay+1)+14)+1:toDay===RSCONSTANTS.LASTDAY&&(startDay_1=16,startDay_2=1,endDay_2=15),info.startDay_1=startDay_1,info.startDay_2=startDay_2,info.endDay_1=toDay,info.endDay_2=endDay_2,info},setDayInfo:function(toDay){var secClsDayVal=parseInt(Layout.Page.container.find("#zp_rs_today_semMont").val()),startDayInfo=ZPI18N.getString("zp.sofcurrentmonth"),endDayInfo=startDayInfo;RSCONSTANTS.NONE,ZPI18N.getString("zp.select");Layout.Page.container.find("#zp_rs_closure_day,#zp_rs_freeze_date").html(ReportSettings.consOptionForClsDay(toDay)).select2("val","-1"),Layout.Page.container.find("#zp_rs_closureday_semMont,#zp_rs_freeze_date2").html(ReportSettings.consOptionForClsDay(secClsDayVal)).select2("val","-1"),toDay<14?startDayInfo=ZPI18N.getString("zp.pppreviousmonth"):toDay===RSCONSTANTS.LASTDAY?(startDayInfo=endDayInfo=ZPI18N.getString("zp.pppreviousmonth"),RSCONSTANTS.LASTDAY,ZPI18N.getString("zp.schlastday")):toDay>15&&(startDayInfo=endDayInfo=ZPI18N.getString("zp.pppreviousmonth")),Layout.Page.container.find("#zp_rs_startday_info").text(startDayInfo).show(),Layout.Page.container.find("#zp_rs_endday_info").text(endDayInfo).show(),Layout.Page.container.find("#zp_rs_closure_day_info,#zp_rs_closure_dayinfo_semMont").text("").hide()},setClsDayInfo:function(){var clsDayVal=parseInt(Layout.Page.container.find("#zp_rs_closure_day").val()),secClsDayVal=parseInt(Layout.Page.container.find("#zp_rs_closureday_semMont").val()),toDayVal=parseInt(Layout.Page.container.find("#zp_rs_to_day").val()),secToDayVal=parseInt(Layout.Page.container.find("#zp_rs_today_semMont").val()),clsDayInfo=ZPI18N.getString("zp.sofcurrentmonth");return toDayVal<=15&&secClsDayVal<secToDayVal?ZPI18N.getString("zp.ppnextmonth"):toDayVal===RSCONSTANTS.LASTDAY&&toDayVal===clsDayVal?clsDayInfo=ZPI18N.getString("zp.pppreviousmonth"):toDayVal>15&&toDayVal<=clsDayVal&&(clsDayInfo=ZPI18N.getString("zp.pppreviousmonth")),-1===clsDayVal&&(clsDayInfo=""),clsDayInfo},consOptionForClsDay:function(toDay){var bufferOpt="<option value="+RSCONSTANTS.NONE+">"+ZPI18N.getString("zp.select")+"</option>";32===toDay&&(toDay=29);for(var i=toDay;i<toDay+7;i++)if(29===i)bufferOpt+='<option value="'+RSCONSTANTS.LASTDAY+'">'+ZPI18N.getString("zp.schlastday")+"</option>";else if(i>29){var tDay=i-29;bufferOpt+='<option value="'+tDay+'">'+tDay+ReportSettings.getNumberSuffix(tDay)+"</option>"}else bufferOpt+='<option value="'+i+'">'+i+ReportSettings.getNumberSuffix(i)+"</option>";return bufferOpt},getStartDayEndDayInfo:function(frequency,toDay){var info=[];return frequency===RSCONSTANTS.MONTHLY?toDay===RSCONSTANTS.LASTDAY?(info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth"))):(info.push(ZPI18N.getString("zp.pppreviousmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth"))):frequency===RSCONSTANTS.SEMIMONTHLY&&(15===toDay?(info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth"))):toDay===RSCONSTANTS.LASTDAY?(info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.ppnextmonth")),info.push(ZPI18N.getString("zp.ppnextmonth")),info.push(ZPI18N.getString("zp.ppnextmonth"))):toDay<15?(info.push(ZPI18N.getString("zp.pppreviousmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth"))):(info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.sofcurrentmonth")),info.push(ZPI18N.getString("zp.ppnextmonth")),info.push(ZPI18N.getString("zp.ppnextmonth")))),info},getStartDayFromEndDay:function(frequency,toDay){if(frequency===RSCONSTANTS.WEEKLY||frequency===RSCONSTANTS.BIWEEKLY)return toDay>=RSCONSTANTS.SATURDAY?RSCONSTANTS.SUNDAY:toDay+1;if(frequency===RSCONSTANTS.MONTHLY){return toDay===RSCONSTANTS.LASTDAY?1:toDay+1}},validateClosureDay:function(){Layout.Page.container.find("#zp_rs_closure_day_error,#zp_rs_closure_dayerror_semMont").hide();var isValid=!0,frequency=Layout.Page.container.find("#zp_rs_frequency").select2("val"),fromDay=parseInt(Layout.Page.container.find("#zp_rs_from_day").val()),toDay=parseInt(Layout.Page.container.find("#zp_rs_to_day").val()),closureDay=parseInt(Layout.Page.container.find("#zp_rs_closure_day").val()),closureDay2=parseInt(Layout.Page.container.find("#zp_rs_closureday_semMont").val()),report_freeze=parseInt(Layout.Page.container.find("#zp_rs_freeze_date").val()),report_freeze2=parseInt(Layout.Page.container.find("#zp_rs_freeze_date2").val());if(void 0===frequency||frequency===RSCONSTANTS.NONE?(Layout.Page.container.find("#zp_rs_frequency_error").html(ZPI18N.getString("zp.frequencyerror")).show(),isValid=!1):null===toDay||void 0===toDay||isNaN(toDay)||-1===toDay?(Layout.Page.container.find("#zp_rs_to_day_error").html(ZPI18N.getString("zp.enddateerror")).show(),isValid=!1):null===closureDay||void 0===closureDay||isNaN(closureDay)||-1===closureDay?(Layout.Page.container.find("#zp_rs_closure_day_error").html(ZPI18N.getString("zp.closuredayerror")).show(),isValid=!1):"4"!==frequency||null!==closureDay2&&void 0!==closureDay2&&!isNaN(closureDay2)&&-1!==closureDay2||(isValid=!1),!isValid)return!1;Layout.Page.container.find("#zp_rs_closure_day_info").hide();var closureMsg="";(frequency=parseInt(frequency))!==RSCONSTANTS.WEEKLY&&frequency!==RSCONSTANTS.BIWEEKLY||closureDay===RSCONSTANTS.NONE?frequency===RSCONSTANTS.MONTHLY&&closureDay!==RSCONSTANTS.NONE?closureMsg=closureDay>=toDay&&closureDay<=RSCONSTANTS.LASTDAY?(RSCONSTANTS.LASTDAY,ZPI18N.getString("zp.sofcurrentmonth")):(RSCONSTANTS.LASTDAY,ZPI18N.getString("zp.ppnextmonth")):frequency===RSCONSTANTS.SEMIMONTHLY&&closureDay!==RSCONSTANTS.NONE&&(closureMsg=ReportSettings.setClsDayInfo()):closureMsg=ZPI18N.getString("zp.ppeveryweek");report_freeze!==RSCONSTANTS.NONE&&(frequency===RSCONSTANTS.WEEKLY||frequency===RSCONSTANTS.BIWEEKLY?ZPI18N.getString("zp.ppeveryweek"):frequency===RSCONSTANTS.MONTHLY&&ZPI18N.getString("zp.sofcurrentmonth")),Layout.Page.container.find("#zp_rs_closure_day_info").text(closureMsg).show().css("display","inline-block");var lock_enabled=Layout.Page.container.find("#zp_rs_freeze").is(":checked");if(frequency===RSCONSTANTS.SEMIMONTHLY){var fromDay2=parseInt(Layout.Page.container.find("#zp_rs_fromday_semMont").val()),toDay2=parseInt(Layout.Page.container.find("#zp_rs_today_semMont").val()),period_details=ReportSettings.getPayPeriod(fromDay,toDay,closureDay,report_freeze,frequency,fromDay2,toDay2,closureDay2,report_freeze2),process_date=Calendar.formatDate(period_details.closure)+", "+Calendar.formatDate(period_details.closure2),payprocess_date=Calendar.formatDate(period_details.payroll_closure)+" "+(period_details.payroll_closure>period_details.closure?"00:00 AM":"")+", "+Calendar.formatDate(period_details.payroll_closure2)+" "+(period_details.payroll_closure2===period_details.closure2?"":"00:00 AM"),processReports=ZPI18N.getString("zp.leave.lopreport")+(Layout.Page.container.find("#zp_rs_encash").is(":checked")?", "+ZPI18N.getString("zp.leave.encashmentreport",["Leave"]):"")+" & "+ZPI18N.getString("zp.overtimereport"),help="<div class='MB10'><b>"+ZPI18N.getString("zp.ppgeneration.summary")+"</b></div><p><span>i)</span>Upcoming Pay Cycles : "+Calendar.formatDate(period_details.start)+" - "+Calendar.formatDate(period_details.end)+", "+Calendar.formatDate(period_details.start2)+" - "+Calendar.formatDate(period_details.end2)+"</p><p><span>ii)</span>"+ZPI18N.getString("zp.payperiod.generation.help1",[processReports,process_date])+"</p>";lock_enabled&&(help+="<p><span>iii)</span>"+ZPI18N.getString("zp.payperiod.generation.help2",[process_date])+"</p>"),help+=report_freeze>-1&&report_freeze2>-1?"<p><span>"+(lock_enabled?"iv)":"iii)")+"</span>"+ZPI18N.getString("zp.payperiod.generation.help3",[payprocess_date])+"</span></p>":"",Layout.Page.container.find("#cycle_details").html(help).show().css("display","inline-block")}else{period_details=ReportSettings.getPayPeriod(fromDay,toDay,closureDay,report_freeze,frequency),process_date=Calendar.formatDate(period_details.closure),payprocess_date=Calendar.formatDate(period_details.payroll_closure)+" "+(period_details.payroll_closure>period_details.closure?"00:00 AM":""),processReports=ZPI18N.getString("zp.leave.lopreport")+(Layout.Page.container.find("#zp_rs_encash").is(":checked")?", "+ZPI18N.getString("zp.leave.encashmentreport",["Leave"]):"")+" & "+ZPI18N.getString("zp.overtimereport"),help="<div class='MB10'><b>"+ZPI18N.getString("zp.ppgeneration.summary")+"</b></div><p><span>i)</span>Upcoming Pay Cycle : "+Calendar.formatDate(period_details.start)+" - "+Calendar.formatDate(period_details.end)+"</p><p><span>ii)</span>"+ZPI18N.getString("zp.payperiod.generation.help1",[processReports,process_date])+"</p>";lock_enabled&&(help+="<p><span>iii)</span>"+ZPI18N.getString("zp.payperiod.generation.help2",[process_date])+"</p>"),help+=report_freeze>-1?"<p><span>"+(lock_enabled?"iv)":"iii)")+"</span>"+ZPI18N.getString("zp.payperiod.generation.help3",[payprocess_date])+"</span></p>":"",Layout.Page.container.find("#cycle_details").html(help).show().css("display","inline-block")}return isValid},getPayPeriodSummary:function(start,end,closure,payroll_closure,frequency,start2,end2,closure2,payroll_closure2){var params={mode:"getCurrentPayPeriod"},conf={start:start,end:end,closure:closure,frequency:frequency,mode:{1:"Monthly",2:"Weekly",3:"Weekly",4:"SemiMonthly"}[frequency]};-1!=payroll_closure&&!isNaN(payroll_closure)&&void 0!=payroll_closure&&(conf.payroll=payroll_closure),4==frequency&&(conf.start2=start2,conf.end2=end2,conf.closure2=closure2,-1!=payroll_closure2&&!isNaN(payroll_closure2)&&void 0!=payroll_closure2&&(conf.payroll2=payroll_closure2)),params[csrfParamName]=csrfToken,params.payperiodConf=JSON.stringify(conf);var payperiod={};return ZPeople.Request.sendAsyncPost("reportSettingAction.zp",params,function(result){result.data&&(payperiod=result.data)}),payperiod},getPayPeriod:function(start,end,closure,payroll_closure,frequency,start2,end2,closure2,payroll_closure2){var cls_date,s_date,e_date,paycls_date,cur_date=Calendar.currrentDate,period={};if(cls_date=s_date=e_date=paycls_date=cur_date,frequency===RSCONSTANTS.MONTHLY||frequency===RSCONSTANTS.SEMIMONTHLY?(cls_date=new Date(cur_date),cur_date.getDate()>closure?(cls_date.setMonth(cur_date.getMonth()+1),ZPUtil.setDate(cls_date,closure)):ZPUtil.setDate(cls_date,closure),e_date=new Date(cls_date),ZPUtil.setDate(e_date,end),e_date>cls_date&&(32==end?e_date.setDate(0):(e_date.setMonth(e_date.getMonth()-1),ZPUtil.setDate(e_date,end))),(s_date=new Date(e_date)).setDate(e_date.getDate()+1),s_date.setMonth(s_date.getMonth()-1),paycls_date=new Date(cls_date),ZPUtil.setDate(paycls_date,payroll_closure),paycls_date<cls_date&&(paycls_date.setMonth(paycls_date.getMonth()+1),ZPUtil.setDate(paycls_date,payroll_closure))):frequency!==RSCONSTANTS.WEEKLY&&frequency!==RSCONSTANTS.BIWEEKLY||((cls_date=new Date(cur_date)).setDay(closure),cur_date.getDate()>cls_date.getDate()&&cls_date.setDate(cls_date.getDate()+7),(e_date=new Date(cls_date)).setDay(end),e_date.getDate()>cls_date.getDate()&&e_date.setDate(e_date.getDate()-7),s_date=new Date(e_date),frequency===RSCONSTANTS.BIWEEKLY?s_date.setDate(e_date.getDate()-13):s_date.setDate(e_date.getDate()-6),(paycls_date=new Date(cls_date)).setDay(payroll_closure),paycls_date<cls_date&&paycls_date.setDate(paycls_date.getDate()+7)),frequency===RSCONSTANTS.SEMIMONTHLY){if(cur_date>cls_date)return ReportSettings.getPayPeriod(start2,end2,closure2,payroll_closure2,frequency,start,end,closure,payroll_closure);var cls_date2,s_date2,e_date2,paycls_date2;s_date=new Date(e_date),ZPUtil.setDate(s_date,start),s_date>e_date&&s_date.setMonth(s_date.getMonth()-1),cls_date2=new Date(cur_date),ZPUtil.setDate(cls_date2,closure2),cur_date<=cls_date2?(cls_date2.setMonth(cur_date.getMonth()+1),ZPUtil.setDate(cls_date2,closure2)):cls_date>=cur_date&&cls_date2<cls_date&&cls_date2<cur_date&&(cls_date2.setMonth(cls_date2.getMonth()+1),ZPUtil.setDate(cls_date2,closure2)),e_date2=new Date(cls_date2),ZPUtil.setDate(e_date2,end2),e_date2>cls_date2&&(32==end2?e_date2.setDate(0):(e_date2.setMonth(e_date2.getMonth()-1),ZPUtil.setDate(e_date2,end2))),s_date2=new Date(e_date2),ZPUtil.setDate(s_date2,start2),s_date2>e_date2&&s_date2.setMonth(s_date2.getMonth()-1),paycls_date2=new Date(cls_date2),ZPUtil.setDate(paycls_date2,payroll_closure2),paycls_date2<cls_date2&&(paycls_date2.setMonth(paycls_date2.getMonth()+1),ZPUtil.setDate(paycls_date2,payroll_closure2)),period.start2=s_date2,period.end2=e_date2,period.closure2=cls_date2,period.payroll_closure2=paycls_date2}return period.start=s_date,period.end=e_date,period.closure=cls_date,period.payroll_closure=paycls_date,period},getClosureDayInfo:function(frequency,toDay,closureDay){var closureMsg="";return(frequency=parseInt(frequency))!==RSCONSTANTS.WEEKLY&&frequency!==RSCONSTANTS.BIWEEKLY||closureDay===RSCONSTANTS.NONE?frequency!==RSCONSTANTS.MONTHLY&&frequency!==RSCONSTANTS.SEMIMONTHLY||closureDay===RSCONSTANTS.NONE||(closureMsg=closureDay>=toDay&&closureDay<=RSCONSTANTS.LASTDAY?(RSCONSTANTS.LASTDAY,ZPI18N.getString("zp.sofcurrentmonth")):(RSCONSTANTS.LASTDAY,ZPI18N.getString("zp.ppnextmonth"))):closureMsg=ZPI18N.getString("zp.ppeveryweek"),closureMsg},saveAction:function(modal,isUpdate,checkLocationInput){Layout.Page.container.find("#zp_rs_name_error").hide(),Layout.Page.container.find("#zp_rs_location_error").hide();var isValid=ReportSettings.validateInput(!0),name=$.trim(Layout.Page.container.find("#zp_rs_name").val());(void 0===name||name.length<=0)&&(Layout.Page.container.find("#zp_rs_name_error").html(ZPI18N.getString("zp.nameerror")).show(),isValid=!1);var locVal=Layout.Page.container.find("#zp_rs_location").val(),locationList=null===locVal||0==locVal.length?null:locVal.toString();if($.each(ReportSettings.ALL_LIST,function(settingId,setting){null!=locationList||0!=_.size(setting.locationList)||isUpdate&&ReportSettings.localValues.repSettID==setting.reportSettID||(Layout.Page.container.find("#zp_rs_location_error").html(ZPI18N.getString("zp.locationerror")).show(),isValid=!1)}),isValid){var frequency=Layout.Page.container.find("#zp_rs_frequency").select2("val"),toDay=Layout.Page.container.find("#zp_rs_to_day").val(),fromDay=Layout.Page.container.find("#zp_rs_from_day").val(),closureDay=Layout.Page.container.find("#zp_rs_closure_day").val(),isFreeze=Layout.Page.container.find("#zp_rs_freeze").is(":checked"),processEncashment=Layout.Page.container.find("#zp_rs_encash").is(":checked"),payPerCycle={};payPerCycle.rsName=name,payPerCycle.rsFrequency=parseInt(frequency),payPerCycle.rsFromDay=parseInt(fromDay),payPerCycle.rsToDay=parseInt(toDay),payPerCycle.rsClosureDay=parseInt(closureDay),payPerCycle.rsIsFreeze=isFreeze,payPerCycle.rsProcessEncashment=processEncashment,payPerCycle.rsPayrollClosure=Layout.Page.container.find("#zp_rs_freeze_date").val(),"4"===frequency&&(payPerCycle.rsSecClosureDay=parseInt(Layout.Page.container.find("#zp_rs_closureday_semMont").val()),payPerCycle.rsSecPayrollClosure=Layout.Page.container.find("#zp_rs_freeze_date2").val(),payPerCycle.rsSecFromDay=parseInt(Layout.Page.container.find("#zp_rs_fromday_semMont").val()),payPerCycle.rsSecToDay=parseInt(Layout.Page.container.find("#zp_rs_today_semMont").val()));var url="reportSettingAction.zp";ZPeople.Module.CURRENT_MODULEPREFIX&&(url="/"+ZPeople.Module.CURRENT_MODULEPREFIX+url);var params={mode:void 0!==isUpdate&&isUpdate?"updateReportSetting":"addReportSetting",reportSettingID:void 0!==isUpdate&&isUpdate?ReportSettings.localValues.repSettID:0,payPerCycle:JSON.stringify(payPerCycle),locationList:locationList};Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").attr("disabled",!0),ZPeople.Request.sendAsyncPost(url,params,ReportSettings.afterSaveAction),allServicesInteg.getPayrollCycle(allServicesInteg.serviceName)}},updateAction:function(){var editRepSettID=ReportSettings.localValues.repSettID,locList=ReportSettings.ALL_LIST[editRepSettID].locationList,checkLocationInput=!1;null===Layout.Page.container.find("#zp_rs_location").val()&&Object.keys(locList).length<=0&&(checkLocationInput=!0),ReportSettings.saveAction(null,!0,checkLocationInput)},afterSaveAction:function(data){if("ACCESS_DENIED"===data.error)return ReportSettings.accessDenied(),null;Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").prop("disabled",!1),ZPeople.BSModal.hide(ReportSettings.MODAL_ID),data.STATUS===ZPI18N.getString("zp.capfailure")?void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&ZPeople.Message.showFailureMsg(data.CLIENT_MSG):data.STATUS===ZPI18N.getString("zp.capsuccess")&&(void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&ZPeople.Message.showSuccessMsg(data.CLIENT_MSG),ReportSettings.showReportSettingList(!0))},deleteAction:function(obj){var repSettID=$(obj).attr("rsID"),url="reportSettingAction.zp";ZPeople.Module.CURRENT_MODULEPREFIX&&(url="/"+ZPeople.Module.CURRENT_MODULEPREFIX+url);var params={mode:"deleteReportSetting",reportSettingID:repSettID};ZPeople.Request.sendAsyncPost(url,params,ReportSettings.afterDeleteAction),allServicesInteg.getPayrollCycle(allServicesInteg.serviceName)},afterDeleteAction:function(data){if("ACCESS_DENIED"===data.error)return ReportSettings.accessDenied(),null;if(data.STATUS===ZPI18N.getString("zp.capfailure"))void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&ZPeople.Message.showFailureMsg(data.CLIENT_MSG);else if(data.STATUS===ZPI18N.getString("zp.capsuccess")){void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&ZPeople.Message.showSuccessMsg(data.CLIENT_MSG);var repSettID=data.DATA.reportSettingID;$("#zp_report_setting_table_body_id #tr_"+repSettID).remove(),delete ReportSettings.ALL_LIST[repSettID],Object.keys(ReportSettings.ALL_LIST).length<=0&&(Layout.Page.container.find("#zp_report_settings_list_div_id,#zp_report_settings_loading").hide(),Layout.Page.container.find("#zp_empty_report_settings_div_id").show())}},onFrequencyChange:function(){var freqVal=parseInt(Layout.Page.container.find("#zp_rs_frequency").select2("val"));Layout.Page.container.find("#zp_rs_cont_semMont").hide(),Layout.Page.container.find("#zp_rs_proCont_semMont,#zp_rs_freeze_cont2").hide(),Layout.Page.container.find("#zp_rs_ppprocDayText_1").text(ZPI18N.getString("zp.ppprocessingday")),Layout.Page.container.find("#zp_rs_freeze_dateText").text(ZPI18N.getString("zp.ppgenerationday")),freqVal===RSCONSTANTS.MONTHLY?(Layout.Page.container.find("#zp_rs_from_day").html(ReportSettings.monthlyOptions(!1,!0)),Layout.Page.container.find("#zp_rs_to_day").html(ReportSettings.monthlyOptions(!1,!1)),Layout.Page.container.find("#zp_rs_closure_day").html(ReportSettings.monthlyOptions(!0)),Layout.Page.container.find("#zp_rs_to_day,#zp_rs_from_day").select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_freeze_date").html(ReportSettings.monthlyOptions(!0,!1)).select2().select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_frequency_error,#zp_rs_startday_info,#zp_rs_endday_info,#zp_rs_closure_day_info,#zp_rs_closure_day_error").hide()):freqVal===RSCONSTANTS.WEEKLY||freqVal===RSCONSTANTS.BIWEEKLY?(Layout.Page.container.find("#zp_rs_from_day").html(ReportSettings.weeklyOptions(!1,!0)),Layout.Page.container.find("#zp_rs_to_day").html(ReportSettings.weeklyOptions(!1,!1)),Layout.Page.container.find("#zp_rs_closure_day").html(ReportSettings.weeklyOptions(!0)),Layout.Page.container.find("#zp_rs_freeze_date,#zp_rs_freeze_date2").html(ReportSettings.weeklyOptions(!0)).select2().select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_to_day,#zp_rs_from_day").select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_frequency_error,#zp_rs_startday_info,#zp_rs_endday_info,#zp_rs_closure_day_info,#zp_rs_closure_day_error").hide()):freqVal===RSCONSTANTS.SEMIMONTHLY?(Layout.Page.container.find("#zp_rs_ppprocDayText_1").text(ZPI18N.getString("zp.ppfirstprocessingday")),Layout.Page.container.find("#zp_rs_ppprocDayText_2").text(ZPI18N.getString("zp.ppsecondprocessingday")),Layout.Page.container.find("#zp_rs_freeze_dateText").text("1st "+ZPI18N.getString("zp.ppgenerationday")),Layout.Page.container.find("#zp_rs_freeze_dateText2").text("2nd "+ZPI18N.getString("zp.ppgenerationday")),Layout.Page.container.find("#zp_rs_cont_semMont,#zp_rs_proCont_semMont,#zp_rs_freeze_cont2").show(),Layout.Page.container.find("#zp_rs_from_day,#zp_rs_fromday_semMont").html(ReportSettings.monthlyOptions(!1,!0)),Layout.Page.container.find("#zp_rs_to_day,#zp_rs_today_semMont").html(ReportSettings.monthlyOptions(!1,!1)),Layout.Page.container.find("#zp_rs_closure_day,#zp_rs_closureday_semMont").html(ReportSettings.monthlyOptions(!0)),Layout.Page.container.find("#zp_rs_freeze_date,#zp_rs_freeze_date2").html(ReportSettings.monthlyOptions(!0,!1)).select2(),Layout.Page.container.find("#zp_rs_to_day,#zp_rs_from_day,#zp_rs_closureday_semMont,#zp_rs_today_semMont,#zp_rs_fromday_semMont").select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_frequency_error,#zp_rs_startdayinfo_semMont,#zp_rs_enddayinfo_semMont,#zp_rs_closure_dayinfo_semMont,#zp_rs_closure_dayerror_semMont").hide(),Layout.Page.container.find("#zp_rs_frequency_error,#zp_rs_startday_info,#zp_rs_endday_info,#zp_rs_closure_day_info,#zp_rs_closure_day_error").hide()):(Layout.Page.container.find("#zp_rs_to_day,#zp_rs_from_day").html(""),Layout.Page.container.find("#zp_rs_to_day,#zp_rs_from_day").select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_closure_day").html(""),Layout.Page.container.find("#zp_rs_to_day_error,#zp_rs_startday_info,#zp_rs_endday_info,#zp_rs_closure_day_error,#zp_rs_closure_day_info").hide()),Layout.Page.container.find("#zp_rs_closure_day").select2("val",[RSCONSTANTS.NONE]),Layout.Page.container.find("#zp_rs_freeze").attr("checked",!1)},closureDayOptions:function(isNoneRequired){var bufferOpt="";isNoneRequired&&(bufferOpt="<option value="+RSCONSTANTS.NONE+">"+ZPI18N.getString("zp.select")+"</option>");var cnt=0;cnt=parseInt(Layout.Page.container.find("#zp_rs_frequency").val())===RSCONSTANTS.MONTHLY?10:4;for(var i=1;i<=cnt;i++)bufferOpt+='<option value="'+i+'">'+i+"</option>";return bufferOpt},monthlyOptions:function(skipNone,isStart){var monthlyOpt="",cnt=28;skipNone?monthlyOpt="<option value="+RSCONSTANTS.NONE+">"+ZPI18N.getString("zp.select")+"</option>":isStart?(monthlyOpt="<option value="+RSCONSTANTS.NONE+">"+ZPI18N.getString("zp.ppstartday")+"</option>",cnt=29):monthlyOpt="<option value="+RSCONSTANTS.NONE+">"+ZPI18N.getString("zp.ppendday")+"</option>";for(var i=1;i<=cnt;i++)monthlyOpt+='<option value="'+i+'">'+i+ReportSettings.getNumberSuffix(i)+"</option>";return monthlyOpt+="<option value="+RSCONSTANTS.LASTDAY+">"+ZPI18N.getString("zp.schlastday")+"</option>"},weeklyOptions:function(skipNone,isStart){var weeklyOpt="";return weeklyOpt=skipNone?"<option value="+RSCONSTANTS.NONE+">"+ZPI18N.getString("zp.select")+"</option>":isStart?"<option value="+RSCONSTANTS.NONE+">"+ZPI18N.getString("zp.ppstartday")+"</option>":"<option value="+RSCONSTANTS.NONE+">"+ZPI18N.getString("zp.ppendday")+"</option>",weeklyOpt+="<option value="+RSCONSTANTS.SUNDAY+">"+ZPI18N.getString("zp.sunday")+"</option><option value="+RSCONSTANTS.MONDAY+">"+ZPI18N.getString("zp.monday")+"</option><option value="+RSCONSTANTS.TUESDAY+">"+ZPI18N.getString("zp.tuesday")+"</option><option value="+RSCONSTANTS.WEDNESDAY+">"+ZPI18N.getString("zp.wednesday")+"</option><option value="+RSCONSTANTS.THURSDAY+">"+ZPI18N.getString("zp.thursday")+"</option><option value="+RSCONSTANTS.FRIDAY+">"+ZPI18N.getString("zp.friday")+"</option><option value="+RSCONSTANTS.SATURDAY+">"+ZPI18N.getString("zp.saturday")+"</option>"},getNumberSuffix:function(num){if(-1===[11,12,13].indexOf(num)){var ss=num%10;switch(ss){case 1:case 2:case 3:return RSCONSTANTS.SUPERSCRIPT[ss+""];default:return RSCONSTANTS.SUPERSCRIPT[4]}}return RSCONSTANTS.SUPERSCRIPT[4]},accessDenied:function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.adminerrormsg"))}},ReportSetting={localValues:{},ALL_LIST:{},conAbs_lt_select:0,showReportSettingList:function(refresh){if(settingsPage.container.find("#zp_report_Setting_list,#zp_empty_data").hide(),"#settings/service/marketplace/otherapplications"!==window.location.hash&&"#settings/service/marketplace/zohoapplications"!==window.location.hash&&settingsPage.container.html(ZPeople.LOADING_HTML),settingsPage.container.addClass("zpl_tblfxd"),Object.keys(ReportSetting.ALL_LIST).length<=0||refresh){var url="reportSettingAction.zp";settingsUrlProps.currentMode&&"marketplace"!==settingsUrlProps.currentMode&&(url="/"+settingsUrlProps.currentMode+url);ZPeople.Request.send(url,{mode:"getReportSettings"},ReportSetting.constructListPage,null,ReportSetting.handleError)}else"#settings/service/marketplace/otherapplications"===window.location.hash||"#settings/service/marketplace/zohoapplications"===window.location.hash?ReportSetting.constructData(ReportSetting.ALL_LIST,$("#payPerDv"+IntegrationSettings.serviceName)):ReportSetting.constructData(ReportSetting.ALL_LIST)},handleError:function(data){403==data.status&&(settingsPage.container.html(""),settingsPage.constructPermissionDeniedPage())},constructListPage:function(data){return"ACCESS_DENIED"===data.error?(ReportSettings.accessDenied(),null):data.STATUS===ZPI18N.getString("zp.capfailure")?(void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&(ModuleComp.Msg.showFailureMsg(data.CLIENT_MSG),settingsPage.container.find("#zp_report_Setting_list,#zp_report_settings_loading").hide(),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.payperiod.nodatamsg"),buttonName:ZPI18N.getString("zp.payperiodaddbutton"),buttonCallBack:ReportSetting.constructAddEditPage,desc:ZPI18N.getString("zp.leave.payperioddef")})),null):(ReportSetting.autoApplyLeavePayperiod=!0,ReportSetting.iterate(data.DATA.reportSettingList),"#settings/service/marketplace/otherapplications"===window.location.hash||"#settings/service/marketplace/zohoapplications"===window.location.hash?ReportSetting.constructData(ReportSetting.ALL_LIST,$("#payPerDv"+IntegrationSettings.serviceName)):ReportSetting.constructData(ReportSetting.ALL_LIST),void AppExc.getApplicableIds())},contructHeader:function(){return'<thead><tr><th width="250">'+ZPI18N.getString("zp.ppname")+"</th> <th>"+ZPI18N.getString("zp.ppcycle")+"</th> <th>"+ZPI18N.getString("zp.ppprocessingday")+'</th> <th width="100"></th> </tr> </thead>'},constructData:function(data,id){if(void 0!==id?id.html('<div id="topSettMenu" class="zpl_btnmnu"><div class="zpl_rgt"><class="zpl_rgt"><button  class="zlabel zlabel--blue zlabel--medium" data-popup-open="configPay" onclick="ReportSetting.constructAddEditPage()">'+ZPI18N.getString("zp.payperiodaddbutton")+'</button></div></div><div class="zpl_rgtcnt"><div class="zpl_tblres" id="zp_report_Setting_list"><table class="zpl_tbl">'+ReportSetting.contructHeader()+'<tbody id="zp_report_setting_table_body_id"></tbody></table></div></div>'):settingsPage.container.html('<div class="zpl_crd zpl_topcrdhdr"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.leave.report.payperiod")+"</h4><p>"+ZPI18N.getString("zp.leave.payperioddef")+'</p></div></div></div><div class="zpl_rgtcnt"><div id="topSettMenu" class="zpl_btnmnu"><div class="zpl_rgt"><button class="zlabel zlabel--blue zlabel--medium" data-popup-open="configPay" id="addPayPeriodBtn" onclick="ReportSetting.constructAddEditPage()">'+ZPI18N.getString("zp.payperiod.caddpayperiod")+'</button></div></div><div id="zp_report_settings_loading"></div><div class="zpl_tblres" id="zp_report_Setting_list"><table class="zpl_tbl">'+ReportSetting.contructHeader()+'<tbody id="zp_report_setting_table_body_id"></tbody></table></div></div>'),settingsPage.container.find("#zp_report_settings_loading").html(ZPeople.LOADING_HTML),Object.keys(data).length>0){settingsPage.container.find("#addPayPeriodBtn").closest(".zpl_btnmnu").removeClass("DNI"),settingsPage.container.find("#zp_report_Setting_list").show(),settingsPage.container.find("#zp_empty_data,#zp_report_settings_loading").hide(),settingsPage.container.find("#zp_report_setting_table_body_id").empty(),data=ReportSetting.ALL_LIST;var tbody=settingsPage.container.find(".zpl_tbl").find("tbody");$.each(data,function(key,value){var tr='<tr id="tr_'+value.reportSettID+'" rsID="'+value.reportSettID+'">';tr+="<td><span>"+ZPeople.escapeHtml(value.rsName)+"</span></td>",tr+="<td><span>"+value.ppcycle+"</span></td>",tr+="<td><span>",tr+=value.closureDayName,value.frequencyCode===RSCONSTANTS.MONTHLY&&value.closureDayCode!==RSCONSTANTS.LASTDAY&&(tr+=""+ReportSettings.getNumberSuffix(parseInt(value.closureDayName))),tr+=" "+ReportSettings.getClosureDayInfo(value.frequencyCode,value.toDayCode,value.closureDayCode)+"</span>",value.closureDayName_2&&(tr+="<span>"+value.closureDayName_2,value.frequencyCode===RSCONSTANTS.MONTHLY&&value.closureDayCode!==RSCONSTANTS.LASTDAY&&(tr+=""+ReportSettings.getNumberSuffix(parseInt(value.closureDayName_2))),tr+=" "+value.info[4],tr+="</span>"),tr+="</td>",tr+='<td rsID="'+value.reportSettID+'"><div class="zpl_hvr"><i class="PI_delete" title='+ZPI18N.getString("zp.delete")+"></i></div></td>",tbody.append(tr),ReportSetting.constructMoreOption(value.locationList,"locMoreOptions_"+value.reportSettID)}),tbody.on("click","tr td:not(:last-child)",function(){ReportSetting.constructAddEditPage($(this).closest("tr"),!0)}),tbody.on("click","tr td:last-child i",function(){ReportSetting.showHideConfirmDeleteButtons($(this).closest("td"),"action_confirm_button",ReportSetting.deleteAction)})}else{if(void 0!==id)new EmptyPages("zp_nd_nodata",ZPI18N.getString("zp.payperiod.nodatamsg"),"",$(id.find(".zpl_rgtcnt"))).show();else settingsPage.container.find("#zp_report_Setting_list,#zp_report_settings_loading").hide(),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.payperiod.nodatamsg"),buttonName:ZPI18N.getString("zp.payperiodaddbutton"),buttonCallBack:ReportSetting.constructAddEditPage,desc:ZPI18N.getString("zp.leave.payperioddef")});settingsPage.container.find("#addPayPeriodBtn").closest(".zpl_btnmnu").addClass("DNI")}TimelyZComp.toolTip.intiliaze()},constructMoreOption:function(moreopt,Id){if(Object.keys(moreopt).length>0){var mhtml='<div id="'+Id+'" class="zpl_drpdwn zpl_tagdrpdwn zmenu zposition--bottomright zh-radiustopright" data-type="list"><ul data-body="true" style="height: auto;">';let count=0;$.each(moreopt,function(key,name){count>2&&(mhtml+='<li data-item-type="custom"><div class="zpl_tg"><span>'+name+"</span></div></li>"),count++});let forElementId=Id+"Btn";mhtml+="</ul></div>",$(settingsPage.mainWrapId).append(mhtml),ZPeopleComponents.menu("#"+Id,{forElement:"#"+forElementId}),settingsPage.container.find("#"+forElementId).off().on("click",e=>{e.stopPropagation(),ZPeopleComponents.menu("#"+Id).show()})}},constructAddEditPage:function(obj,isUpdate){var title=ZPI18N.getString("zp.eg")+" "+ZPI18N.getString("zp.monthly")+" "+ZPI18N.getString("zp.spayperiod"),html='<form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.ppname")+'</label></div><div><input id="zp_rs_name" placeholder="'+title+'" type="text" class="ztextbox"><span id="zp_rs_name_error" class="ztextbox--error__label"></span></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.ppcycle")+'</label></div><div><select id="zp_rs_frequency" class="select-js" data-width="330" ><option value='+RSCONSTANTS.MONTHLY+">"+ZPI18N.getString("zp.monthly")+"</option><option value="+RSCONSTANTS.WEEKLY+">"+ZPI18N.getString("zp.weekly")+"</option><option value="+RSCONSTANTS.BIWEEKLY+">"+ZPI18N.getString("zp.payperiod.biweekly")+"</option><option value="+RSCONSTANTS.SEMIMONTHLY+">"+ZPI18N.getString("zp.payperiod.halfmonthly")+'</option></select><span id="zp_rs_frequency_error" class="ztextbox--error__label"></span></div></div><div class="zpl_secn zpl_idivingrp"><div><div> <label for="">'+ZPI18N.getString("zp.tt.startday")+'</label><label for="" class="zpl_mtry">'+ZPI18N.getString("zp.tt.endday")+'</label></div></div><div><div><select id="zp_rs_from_day" class="select-js"  ></select><select id="zp_rs_to_day" class="select-js"  ></select></div><div><span class="ztextbox--error__label"></span><span id="zp_rs_to_day_error" class="ztextbox--error__label"></span></div></div></div><div class="zpl_secn"><div><label id="zp_rs_ppprocDayText_1" class="zpl_mtry">'+ZPI18N.getString("zp.ppprocessingday")+'</label></div><div><select id="zp_rs_closure_day" class="select-js" ></select><span id="zp_rs_closure_day_error" class="ztextbox--error__label" ><span class="DN dgry MT5" id="zp_rs_closure_day_info_dummy"></span></div></div><div class="zpl_secn"><div><label id="zp_rs_freeze_dateText" class="zpl_mtry">'+ZPI18N.getString("zp.ppgenerationday")+'</label></div><div><select id="zp_rs_freeze_date" class="select-js" ></select><span id="zp_rs_freeze_day_error" class="ztextbox--error__label"></div></div><div class="zpl_secn zpl_idivingrp" id="zp_rs_cont_semMont"><div><div> <label for="">'+ZPI18N.getString("zp.tt.startday")+'</label><label for="">'+ZPI18N.getString("zp.tt.endday")+'</label></div></div><div><div><select id="zp_rs_fromday_semMont" class="select-js" ></select><span class="DB dgry MT5" id="zp_rs_startdayinfo_semMont">of every month</span><select id="zp_rs_today_semMont" class="select-js" ></select><span class="DB dgry MT5" id="zp_rs_enddayinfo_semMont">of every month</span></div><div><span id="zp_rs_to_dayerror_semMont" class="ztextbox--error__label"></span></div></div></div><div class="zpl_secn" id="zp_rs_proCont_semMont"><div><label id="zp_rs_ppprocDayText_2" class="zpl_mtry">'+ZPI18N.getString("zp.ppprocessingday")+'</label></div><div><select id="zp_rs_closureday_semMont" class="select-js" ></select><span id="zp_rs_closure_dayerror_semMont" class="ztextbox--error__label"><span class="DN dgry MT5" id="zp_rs_closure_day_info_dummy"></span></div></div><div class="zpl_secn" id="zp_rs_freeze_cont2"><div><label id="zp_rs_freeze_dateText2" class="zpl_mtry">'+ZPI18N.getString("zp.ppgenerationday")+'</label></div><div><select id="zp_rs_freeze_date2" class="select-js" ></select><span id="zp_rs_freeze_dayerror_semMont" class="ztextbox--error__label" ></div></div><div class="zpl_secn"><div><div class="zcheckbox"><input id="zp_rs_encash" type="checkbox" class="zcheckbox__helper" onchange="ReportSetting.getPayPeriodInfo();"><label for="zp_rs_encash" class="zcheckbox__label">'+ZPI18N.getString("zp.pp.processencashment")+'</label></div></div></div><div class="zpl_secn"><div class="zpl_flexalign"><div class="zcheckbox"><input id="zp_rs_review" type="checkbox" class="zcheckbox__helper childenable" onchange="ReportSetting.onReviewChange();"><label for="zp_rs_review" class="zcheckbox__label"></label></div><div><select id="zp_rs_review_status" class="" style=""><option value="0">'+ZPI18N.getString("zp.autoreject")+'</option><option value="1">'+ZPI18N.getString("zp.autoapprove")+'</option></select></div><label class="zpl_ml2">'+ZPI18N.getString("zp.pppendingonprocessday")+"</label></div></div>"+ReportSetting.autoApplyLeaveOption()+'<div class="zpl_secn"><div><div class="zcheckbox"><input id="zp_rs_freeze" type="checkbox" class="zcheckbox__helper childenable" onchange="ReportSetting.getPayPeriodInfo();"><label for="zp_rs_freeze" class="zcheckbox__label">'+ZPI18N.getString("zp.pplock")+" "+ZPI18N.getString("zp.pplockinfo")+'</label></div></div></div><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.applicableto",[""])+'</h5><span id="zp_rs_appFor_error" class="ztextbox--error__label"></span></div><div class="zpl_cndor"><div class="zpl_gbox zpl_w-100">                <div class="zpl_idiv">                  <select id="zp_rs_appfor" class="select-js">                    <option value="EMPLOYEE_TYPE">'+ZPI18N.getString("zp.employeeType")+'</option>                    <option value="LOCATION">'+ZPI18N.getString("zp.location")+'</option>                    <option value="ROLE">'+ZPI18N.getString("zp.role")+'</option>                  </select>                  <span>is</span>                  <z-tokenfield id="zp_rs_appfor_values" elemType="tokenfield" values="Array" style="display:none"></z-tokenfield>                </div>              </div>            </div>          </div><div class="zpl_secn"><div class="zpl_info DN" id="cycle_details"></div></div></div></form>',modal=ModuleComp.Modal.setup({id:"configurePayPeriod",type:1,header:isUpdate?ZPI18N.getString("zp.payperiod.editpayperiod"):ZPI18N.getString("zp.payperiod.caddpayperiod"),body:html,backdrop:!1,deleteOnHide:!0,buttonValue:ZPI18N.getString("zp.save"),successCallback:isUpdate?ReportSetting.updateAction:ReportSetting.saveAction,hiddenCallback:ReportSetting.destroyZComp,closeonEsc:!0,LayerId:settingsPage.container[0].id});(modal=settingsPage.container.find("#configurePayPeriod")).find(".PI_cls").attr("title",ZPI18N.getString("zp.close")).ztooltip();var locArray=[],locIdArr=[];locIdArr.push("0"),locArray.push({id:"0",name:ZPI18N.getString("zp.alllocaction")}),$.each(ZPUtil.Location.ALL_LOCATION,function(key,value){locArray.push({id:key,name:value}),locIdArr.push(key)});var repSettID=$(obj).attr("rsID");Object.keys(ReportSetting.ALL_LIST).length>0&&$.each(ReportSetting.ALL_LIST,function(key,value){if(repSettID!==value.reportSettID)if(0===Object.keys(value.locationList).length){let index=locIdArr.indexOf("0");index>-1&&(locArray.splice(index,1),locIdArr.splice(index,1))}else $.each(value.locationList,function(key,value){let index=locIdArr.indexOf(key);index>-1&&(locArray.splice(index,1),locIdArr.splice(index,1))})});ZPI18N.getString("zp.nomatchesfound"),ZPI18N.getString("zp.select"),modal.find(".zpl_mcnt");let locationDiv=modal.find("#zp_rs_location");locationDiv.on("ztokenfieldbeforetokenadd",function(obj){AppExc.getZtokenFieldOnchangeForApp(obj,locationDiv)}),modal.find("#cycle_details")[0]?modal.find(".zpl_mfoter").find("#cycle_details").addClass("DNI"):modal.find(".zpl_crdcnt").append('<div class="zpl_secn"><div class="zpl_info DNI" id="cycle_details"></div></div>'),ReportSetting.defaultAction(),modal.find("#zp_rs_name").focus(),modal.find("[data-popover]").popover(),isUpdate&&void 0!==obj&&void 0!==repSettID&&(ReportSetting.localValues.repSettID=repSettID,ReportSetting.populateData(repSettID)),modal.find(".zpl_mcnt").animate({scrollTop:0},20),modal.find(".zpl_mcnt").removeClass("zpl_fm")},autoApplyLeaveOption:function(){return html="",ReportSetting.autoApplyLeavePayperiod&&(html='<div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="zp_rs_convert_absent" type="checkbox" class="zcheckbox__helper" onchange="ReportSetting.convertToAbsent();"><label for="zp_rs_convert_absent" class="zcheckbox__label">'+ZPI18N.getString("zp.payperiod.convertabsenttoleave")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.payperiod.convertabsentdesc")+'</span><div class="zpl_gbox zpl_w320 DNI" id="convertAbs_leaveIdCont"><div id="convertAbs_leaveRows"></div><div class="zpl_idiv"><div><a class="zpl_lnkbg" id="addConAbsLeaveRow" onclick="ReportSetting.addConvertAbsLeaveRow();">'+ZPI18N.getString("zp.add")+"</a></div></div></div></div></div>"),html},defaultAction:function(){var modal=settingsPage.container.find("#configurePayPeriod");modal.find(".error-msg").hide(),modal.find("#zp_rs_name").on("keypress",function(){modal.find("#zp_rs_name").val().length<=0&&(Timetracker.Util.removeError(modal.find("#zp_rs_name")),modal.find("#zp_rs_name_error").hide())}),ZPeopleComponents.select(modal.find("#zp_rs_review_status")[0]).setAttributes({disabled:!0}),ZPeopleComponents.select(modal.find("#zp_rs_frequency")).setAttributes({selectedValue:"1",dropdownList:{appendTo:modal.find(".zpl_mcnt")}}),ZPeopleComponents.select(modal.find("#zp_rs_appfor")[0]);let appForValueEle=modal.find("#zp_rs_appfor_values");var attr={isLabelHTMLEncoded:!0,sort:!1,dropdownList:{closeOnSelect:!1,hideItemOnSelect:!0,isTextHTMLEncoded:!0,fitForElement:!0,appendTo:appForValueEle.closest(".zpl_mdl").length>0?appForValueEle.closest(".zpl_mdl"):settingsPage.container}};TimelyZComp.tokenField.intialize(appForValueEle,attr,!0),ReportSetting.onFrequencyChange(),ReportSetting.onAppForChange(),$("#zp_rs_frequency").on("zselectchange",ReportSetting.onFrequencyChange),$("#zp_rs_to_day").on("zselectchange",ReportSetting.updateStartDay).on("zselectchange",ReportSetting.updateClosureDay),$("#zp_rs_closure_day,#zp_rs_closureday_semMont").on("zselectchange",ReportSetting.updatePayrollDay),$("#zp_rs_freeze_date,#zp_rs_freeze_date2").on("zselectchange",ReportSetting.getPayPeriodInfo),$("#zp_rs_appfor").on("zselectchange",ReportSetting.onAppForChange)},onFrequencyChange:function(){var modal=settingsPage.container.find("#configurePayPeriod"),freqVal=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_frequency")).getValue());modal.find("#zp_rs_proCont_semMont,#zp_rs_freeze_cont2,#zp_rs_cont_semMont").hide(),modal.find("#zp_rs_ppprocDayText_1").text(ZPI18N.getString("zp.ppprocessingday")),modal.find("#zp_rs_freeze_dateText").text(ZPI18N.getString("zp.ppgenerationday")),modal.find(".ztextbox__error").removeClass("ztextbox__error"),modal.find("#zp_rs_to_day_error").hide(),modal.find("#zp_rs_closure_day_error,#zp_rs_closure_dayerror_semMont").hide(),modal.find("#zp_rs_freeze_day_error,#zp_rs_freeze_dayerror_semMont").hide(),modal.find("#cycle_details").hide();var appendTo=modal.find(".zpl_mcnt");freqVal===RSCONSTANTS.MONTHLY?(ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setAttributes({options:ReportSetting.monthlyOptions(!1,!0),selectedValue:RSCONSTANTS.NONE,disabled:!0,dropdownList:{appendTo:appendTo},placeholder:ZPI18N.getString("zp.select")}),ZPeopleComponents.select(modal.find("#zp_rs_to_day")).setAttributes({options:ReportSetting.monthlyOptions(!0,!1),selectedValue:RSCONSTANTS.NONE,dropdownList:{appendTo:appendTo},placeholder:ZPI18N.getString("zp.select")}),ReportSetting.updateClosureDay(),ReportSetting.updatePayrollDay({target:modal.find("#zp_rs_closure_day")}),modal.find("#zp_rs_frequency_error,#zp_rs_startday_info,#zp_rs_endday_info,#zp_rs_closure_day_info").hide()):freqVal===RSCONSTANTS.WEEKLY||freqVal===RSCONSTANTS.BIWEEKLY?(ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setAttributes({options:ReportSetting.weeklyOptions(!1,!0),selectedValue:RSCONSTANTS.NONE,disabled:!0,dropdownList:{appendTo:appendTo},placeholder:ZPI18N.getString("zp.select")}),ZPeopleComponents.select(modal.find("#zp_rs_to_day")).setAttributes({options:ReportSetting.weeklyOptions(!0,!1),selectedValue:RSCONSTANTS.NONE,dropdownList:{appendTo:appendTo},placeholder:ZPI18N.getString("zp.select")}),ReportSetting.updateClosureDay(),ReportSetting.updatePayrollDay({target:modal.find("#zp_rs_closure_day")}),modal.find("#zp_rs_frequency_error,#zp_rs_startday_info,#zp_rs_endday_info,#zp_rs_closure_day_info").hide()):freqVal===RSCONSTANTS.SEMIMONTHLY?(modal.find("#zp_rs_ppprocDayText_1").text(ZPI18N.getString("zp.ppfirstprocessingday")),modal.find("#zp_rs_ppprocDayText_2").text(ZPI18N.getString("zp.ppsecondprocessingday")),modal.find("#zp_rs_freeze_dateText").text("1st "+ZPI18N.getString("zp.ppgenerationday")),modal.find("#zp_rs_freeze_dateText2").text("2nd "+ZPI18N.getString("zp.ppgenerationday")),modal.find("#zp_rs_cont_semMont,#zp_rs_proCont_semMont,#zp_rs_freeze_cont2").show(),ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setAttributes({options:ReportSetting.monthlyOptions(!1,!0),selectedValue:RSCONSTANTS.NONE,disabled:!0,dropdownList:{appendTo:appendTo},placeholder:ZPI18N.getString("zp.select")}),ZPeopleComponents.select(modal.find("#zp_rs_to_day")).setAttributes({options:ReportSetting.monthlyOptions(!0,!1),selectedValue:RSCONSTANTS.NONE,dropdownList:{appendTo:appendTo},placeholder:ZPI18N.getString("zp.select")}),ZPeopleComponents.select(modal.find("#zp_rs_today_semMont")).setAttributes({options:ReportSetting.monthlyOptions(!0,!1),selectedValue:RSCONSTANTS.NONE,disabled:!0,dropdownList:{appendTo:appendTo},placeholder:ZPI18N.getString("zp.select")}),ZPeopleComponents.select(modal.find("#zp_rs_fromday_semMont")).setAttributes({options:ReportSetting.monthlyOptions(!1,!0),selectedValue:RSCONSTANTS.NONE,disabled:!0,dropdownList:{appendTo:appendTo},placeholder:ZPI18N.getString("zp.select")}),ReportSetting.updateClosureDay(),ReportSetting.updatePayrollDay({target:modal.find("#zp_rs_closure_day")}),ReportSetting.updatePayrollDay({target:modal.find("#zp_rs_closureday_semMont")}),modal.find("#zp_rs_frequency_error,#zp_rs_startdayinfo_semMont,#zp_rs_enddayinfo_semMont,#zp_rs_closure_dayinfo_semMont,#zp_rs_closure_dayerror_semMont").hide(),modal.find("#zp_rs_frequency_error,#zp_rs_startday_info,#zp_rs_endday_info,#zp_rs_closure_day_info").hide()):(modal.find("#zp_rs_to_day,#zp_rs_from_day").html(""),ZPeopleComponents.select(modal.find("#zp_rs_to_day")).setAttributes({options:{},selectedValue:RSCONSTANTS.NONE,disabled:!0,dropdownList:{appendTo:appendTo}}),ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setAttributes({options:{},selectedValue:RSCONSTANTS.NONE,dropdownList:{appendTo:appendTo}}),ZPeopleComponents.select(modal.find("#zp_rs_closure_day")).setAttributes({options:{},dropdownList:{appendTo:appendTo}}),modal.find("#zp_rs_startday_info,#zp_rs_endday_info,#zp_rs_closure_day_info").hide()),modal.find("#zp_rs_freeze").attr("checked",!1)},onAppForChange:function(){var modal=settingsPage.container.find("#configurePayPeriod"),appForEntity=ZPeopleComponents.select(modal.find("#zp_rs_appfor")).getValue(),appForValueEle=modal.find("#zp_rs_appfor_values"),values=[];TimelyZComp.tokenField.destroy(appForValueEle),values="EMPLOYEE_TYPE"===appForEntity?AppExc.getValueForCriteriaOptions("empTypeList",AppExc.appLabels[9],!0):"ROLE"===appForEntity?AppExc.getValueForCriteriaOptions("roleList",AppExc.appLabels[3],!0):AppExc.getValueForCriteriaOptions("locationList",AppExc.appLabels[0],!0);var attr={isLabelHTMLEncoded:!0,sort:!1,dropdownList:{closeOnSelect:!1,hideItemOnSelect:!0,isTextHTMLEncoded:!0,fitForElement:!0,appendTo:appForValueEle.closest(".zpl_mdl").length>0?appForValueEle.closest(".zpl_mdl"):settingsPage.container}};TimelyZComp.tokenField.intialize(appForValueEle,attr,!0),TimelyZComp.tokenField.addOptions(appForValueEle,values),appForValueEle.on("ztokenfieldbeforetokenadd",function(obj){AppExc.getZtokenFieldOnchangeForApp(obj,appForValueEle)})},validateEndDay:function(fromSave){var isErrorNeeded=!0;fromSave&&"boolean"!=typeof fromSave&&fromSave.detail&&!fromSave.detail.fromUI&&(isErrorNeeded=!1);var modal=settingsPage.container.find("#configurePayPeriod");modal.find("#zp_rs_frequency_error,#zp_rs_to_day_error").hide(),Timetracker.Util.removeError(modal.find("#zp_rs_frequency")),Timetracker.Util.removeError(modal.find("#zp_rs_to_day"));var isValid=!0,frequency=ZPeopleComponents.select(modal.find("#zp_rs_frequency")).getValue(),toDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_to_day")).getValue());if(void 0===frequency?(isErrorNeeded&&(modal.find("#zp_rs_frequency_error").html(ZPI18N.getString("zp.frequencyerror")).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_frequency")})),isValid=!1):(null===toDay||void 0===toDay||isNaN(toDay)||-1===toDay)&&(isErrorNeeded&&(modal.find("#zp_rs_to_day_error").html(ZPI18N.getString("zp.payperiod.payperiodenddayerr")).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_to_day")})),ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setValue(RSCONSTANTS.NONE),modal.find("#zp_rs_startday_info,#zp_rs_endday_info").hide(),isValid=!1),!isValid)return isValid;frequency=parseInt(frequency),modal.find("#zp_rs_to_day_info").hide();var startDayVal;if(frequency===RSCONSTANTS.WEEKLY||frequency===RSCONSTANTS.BIWEEKLY){var prevWeekDay=toDay>=RSCONSTANTS.SATURDAY?RSCONSTANTS.SUNDAY:[toDay+1];"Report will generate from  "+RSCONSTANTS.WEEK_NAME[prevWeekDay]+" to "+RSCONSTANTS.WEEK_NAME[toDay]+".",ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setValue(prevWeekDay),modal.find("#zp_rs_startday_info,#zp_rs_endday_info").hide();var sDayInfo=ZPI18N.getString("zp.pppreviousweek"),eDayInfo=ZPI18N.getString("zp.sofcurrentweek");6===toDay&&frequency===RSCONSTANTS.WEEKLY?sDayInfo=ZPI18N.getString("zp.sofcurrentweek"):6!==toDay&&frequency===RSCONSTANTS.BIWEEKLY&&(sDayInfo=ZPI18N.getString("zp.ppbeforepreviousweek")),modal.find("#zp_rs_startday_info").text(sDayInfo).show(),modal.find("#zp_rs_endday_info").text(eDayInfo).show()}else if(frequency===RSCONSTANTS.MONTHLY){var startDayInfo,endDayInfo;if(startDayVal=1,toDay===RSCONSTANTS.LASTDAY)"Report will generate from 1"+ReportSettings.getNumberSuffix(1)+" of current month to LAST DAY of current month.",startDayInfo=endDayInfo=ZPI18N.getString("zp.sofcurrentmonth");else{var prevMonthDay=[toDay+1];"Report will generate from "+prevMonthDay+ReportSettings.getNumberSuffix(prevMonthDay)+" of previous month to "+toDay+ReportSettings.getNumberSuffix(toDay)+" of current month.",startDayVal=prevMonthDay,startDayInfo=ZPI18N.getString("zp.pppreviousmonth"),endDayInfo=ZPI18N.getString("zp.sofcurrentmonth")}ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setValue(startDayVal),modal.find("#zp_rs_startday_info").text(startDayInfo).show(),modal.find("#zp_rs_endday_info").text(endDayInfo).show()}else if(frequency===RSCONSTANTS.SEMIMONTHLY){var stEndDet=ReportSettings.getStartDayEndDay(toDay);startDayVal=stEndDet.startDay_1;var secEndDayVal=stEndDet.endDay_2,secStartDayVal=stEndDet.startDay_2;ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setValue(startDayVal),ZPeopleComponents.select(modal.find("#zp_rs_fromday_semMont")).setValue(secStartDayVal),ZPeopleComponents.select(modal.find("#zp_rs_today_semMont")).setValue(secEndDayVal),fromSave&&"boolean"==typeof fromSave||ReportSetting.setDayInfo(toDay)}var closureDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_closure_day")).getValue());return null===closureDay||void 0===closureDay||isNaN(closureDay)||-1===closureDay?isValid:(ReportSetting.validateGenerationDay(),isValid)},updateStartDay:function(obj){var startDayVal,modal=settingsPage.container.find("#configurePayPeriod"),frequency=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_frequency")).getValue()),toDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_to_day")).getValue());if(-1!==toDay&&null!==toDay&&void 0!==toDay&&!isNaN(toDay))if(frequency===RSCONSTANTS.WEEKLY||frequency===RSCONSTANTS.BIWEEKLY){var prevWeekDay=toDay>=RSCONSTANTS.SATURDAY?RSCONSTANTS.SUNDAY:[toDay+1];ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setValue(prevWeekDay)}else if(frequency===RSCONSTANTS.MONTHLY)startDayVal=toDay===RSCONSTANTS.LASTDAY?1:[toDay+1],ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setValue(startDayVal);else if(frequency===RSCONSTANTS.SEMIMONTHLY){var stEndDet=ReportSettings.getStartDayEndDay(toDay);startDayVal=stEndDet.startDay_1;var secEndDayVal=stEndDet.endDay_2,secStartDayVal=stEndDet.startDay_2;ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setValue(startDayVal),ZPeopleComponents.select(modal.find("#zp_rs_fromday_semMont")).setValue(secStartDayVal),ZPeopleComponents.select(modal.find("#zp_rs_today_semMont")).setValue(secEndDayVal)}},validateGenerationDay:function(obj){if(!obj||!obj.detail||obj.detail.fromUI){var modal=settingsPage.container.find("#configurePayPeriod");modal.find("#zp_rs_closure_day_error,#zp_rs_closure_dayerror_semMont").hide(),modal.find("#zp_rs_freeze_day_error,#zp_rs_freeze_dayerror_semMont").hide(),modal.find(".ztextbox__error").removeClass("ztextbox__error");var frequency=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_frequency")).getValue()),toDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_to_day")).getValue()),toDay2=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_today_semMont")).getValue()),closureDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_closure_day")).getValue()),closureDay2=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_closureday_semMont")).getValue()),report_freeze=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_freeze_date")).getValue()),report_freeze2=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_freeze_date2")).getValue());return void 0===frequency||frequency===RSCONSTANTS.NONE?(modal.find("#zp_rs_frequency_error").html(ZPI18N.getString("zp.frequencyerror")).show(),!1):null===toDay||void 0===toDay||isNaN(toDay)||-1===toDay?(modal.find("#zp_rs_to_day_error").html(ZPI18N.getString("zp.enddateerror")).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_to_day")}),!1):null===closureDay||void 0===closureDay||isNaN(closureDay)||-1===closureDay?(modal.find("#zp_rs_closure_day_error").html(ZPI18N.getString("zp.payperiod.error.dayrange",[ZPI18N.getString("zp.ppprocessingday"),ZPI18N.getString("zp.ppendday")])).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_closure_day")}),!1):null===report_freeze||void 0===report_freeze||isNaN(report_freeze)||-1===report_freeze?(modal.find("#zp_rs_freeze_day_error").html(ZPI18N.getString("zp.payperiod.error.dayrange",[ZPI18N.getString("zp.ppgenerationday"),ZPI18N.getString("zp.ppprocessingday")])).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_freeze_date")}),!1):4!==frequency||null!==closureDay2&&void 0!==closureDay2&&!isNaN(closureDay2)&&-1!==closureDay2?4!==frequency||null!==report_freeze2&&void 0!==report_freeze2&&!isNaN(report_freeze2)&&-1!==report_freeze2?1!=frequency&&4!=frequency||ReportSetting.consOptionForClsDay(toDay).map(obj=>obj.value).includes(closureDay)?1!=frequency&&4!=frequency||ReportSetting.consOptionForClsDay(32==closureDay?1:closureDay+1).map(obj=>obj.value).includes(report_freeze)?4!==frequency||ReportSetting.consOptionForClsDay(toDay2).map(obj=>obj.value).includes(closureDay2)?!(4===frequency&&!ReportSetting.consOptionForClsDay(32==closureDay2?1:closureDay2+1).map(obj=>obj.value).includes(report_freeze2))||(modal.find("#zp_rs_freeze_dayerror_semMont").html(ZPI18N.getString("zp.payperiod.error.dayrange",[ZPI18N.getString("zp.ppgenerationday"),ZPI18N.getString("zp.ppprocessingday")])).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_freeze_date2")}),!1):(modal.find("#zp_rs_closure_dayerror_semMont").html(ZPI18N.getString("zp.payperiod.error.dayrange",[ZPI18N.getString("zp.ppprocessingday"),ZPI18N.getString("zp.ppendday")])).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_closure_dayerror_semMont")}),!1):(modal.find("#zp_rs_freeze_day_error").html(ZPI18N.getString("zp.payperiod.error.dayrange",[ZPI18N.getString("zp.ppgenerationday"),ZPI18N.getString("zp.ppprocessingday")])).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_freeze_date")}),!1):(modal.find("#zp_rs_closure_day_error").html(ZPI18N.getString("zp.payperiod.error.dayrange",[ZPI18N.getString("zp.ppprocessingday"),ZPI18N.getString("zp.ppendday")])).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_closure_day")}),!1):(modal.find("#zp_rs_freeze_dayerror_semMont").html(ZPI18N.getString("zp.payperiod.error.dayrange",[ZPI18N.getString("zp.ppgenerationday"),ZPI18N.getString("zp.ppprocessingday")])).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_freeze_date2")}),!1):(modal.find("#zp_rs_closure_dayerror_semMont").html(ZPI18N.getString("zp.payperiod.error.dayrange",[ZPI18N.getString("zp.ppprocessingday"),ZPI18N.getString("zp.ppendday")])).show(),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_rs_closureday_semMont")}),!1)}},validateApplicablity:function(){return!0},onReviewChange:function(){var modal=settingsPage.container.find("#configurePayPeriod"),reviewStatusEnabled=modal.find("#zp_rs_review").is(":checked");ZPeopleComponents.select(modal.find("#zp_rs_review_status")[0]).setAttributes({disabled:!reviewStatusEnabled})},convertToAbsent:function(){var modal=settingsPage.container.find("#configurePayPeriod");if(modal.find("#zp_rs_convert_absent").is(":checked")){let leaveTypeContainer=modal.find("#convertAbs_leaveIdCont");leaveTypeContainer.removeClass("DNI"),0==leaveTypeContainer.find("#convertAbs_leaveRows").find(".zpl_idiv").length&&ReportSetting.addConvertAbsLeaveRow()}else modal.find("#convertAbs_leaveIdCont").addClass("DNI")},createLeaveRows:function(idx){let lt_selectId=`convertAbs_lt_select_${ReportSetting.conAbs_lt_select++}`;return html='<div class="zpl_idiv"><div><select class="select-js" id="'+lt_selectId+'" name="convertAbs_lt"></select></div>',0!=idx&&(html+='<div><i class="PI_delete"></i></div>'),html+="</div>",$(html)},updateltOptions:function(){let leavetypes=ReportSetting.getPaidLeaveIdsList(),usedLeaveIds=ReportSetting.getUsedLeaveIds();settingsPage.container.find("select[name=convertAbs_lt]").each(function(idx,ele){let availableLeaveIds=ReportSetting.getAvailableLeaveIds(idx,usedLeaveIds,leavetypes);TimelyZComp.select.setAttributes(ele,{options:availableLeaveIds})})},getUsedLeaveIds:function(){let usedLeaveIds=[];return settingsPage.container.find("select[name=convertAbs_lt]").each(function(idx,ele){let selected_ltype=TimelyZComp.select.getValue(ele);""!=selected_ltype&&usedLeaveIds.push(selected_ltype)}),usedLeaveIds},getAvailableLeaveIds:function(index,savedLeaveIds=[],allLeaveIds){void 0===allLeaveIds&&(allLeaveIds=ReportSetting.getPaidLeaveIdsList());let currentLeaveIds=savedLeaveIds[index]||[],usedInOtherRows=savedLeaveIds.filter((tokens,i)=>i!==index).flat();return allLeaveIds.filter(item=>{let usedElsewhere=usedInOtherRows.includes(item.value),usedHere=currentLeaveIds.includes(item.value);return!usedElsewhere||usedHere})},addConvertAbsLeaveRow:function(selectedValue){let leaveRowsContainer=settingsPage.container.find("#convertAbs_leaveRows"),ltrow=ReportSetting.createLeaveRows(leaveRowsContainer.find(".zpl_idiv").length);leaveRowsContainer.append(ltrow);let leaveIdsSelect=ltrow.find("select[name=convertAbs_lt]");TimelyZComp.select.destroy(leaveIdsSelect),TimelyZComp.select.intialize(leaveIdsSelect,{options:ReportSetting.getAvailableLeaveIds(leaveRowsContainer.find(".zpl_idiv").length,ReportSetting.getUsedLeaveIds(),ReportSetting.getPaidLeaveIdsList())}),void 0!=selectedValue&&TimelyZComp.select.setValue(leaveIdsSelect,selectedValue),ltrow.find("i").on("click",function(event){TimelyZComp.select.destroy(leaveIdsSelect),ltrow.remove(),leaveRowsContainer.find(".zpl_idiv").length<5?settingsPage.container.find("#addConAbsLeaveRow").show():settingsPage.container.find("#addConAbsLeaveRow").hide()}),5==leaveRowsContainer.find(".zpl_idiv").length?settingsPage.container.find("#addConAbsLeaveRow").hide():settingsPage.container.find("#addConAbsLeaveRow").show(),leaveRowsContainer.find("select[name=convertAbs_lt]").on("zselectchange",function(event){ReportSetting.updateltOptions()})},getPaidLeaveIdsList:function(){return AppExc.appElements.paidLeaveList.map(obj=>({value:obj.id,label:ZPeople.decodeTxt(obj.name)}))},getPayPeriodInfo:function(obj){if(!obj||!obj.detail||obj.detail.fromUI){var modal=settingsPage.container.find("#configurePayPeriod");modal.find("#zp_rs_freeze_day_error,#zp_rs_freeze_dayerror_semMont").hide(),Timetracker.Util.removeError(modal.find("#zp_rs_freeze_date")),Timetracker.Util.removeError(modal.find("#zp_rs_freeze_date2"));var frequency=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_frequency")).getValue()),fromDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_from_day")).getValue()),toDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_to_day")).getValue()),toDay2=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_today_semMont")).getValue()),closureDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_closure_day")).getValue()),closureDay2=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_closureday_semMont")).getValue()),report_freeze=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_freeze_date")).getValue()),report_freeze2=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_freeze_date2")).getValue()),isValid=!0;if(void 0===frequency||frequency===RSCONSTANTS.NONE?isValid=!1:null===toDay||void 0===toDay||isNaN(toDay)||-1===toDay?isValid=!1:null===closureDay||void 0===closureDay||isNaN(closureDay)||-1===closureDay?isValid=!1:null===report_freeze||void 0===report_freeze||isNaN(report_freeze)||-1===report_freeze?isValid=!1:(4!==frequency||null!==closureDay2&&void 0!==closureDay2&&!isNaN(closureDay2)&&-1!==closureDay2)&&(4!==frequency||null!==report_freeze2&&void 0!==report_freeze2&&!isNaN(report_freeze2)&&-1!==report_freeze2)&&(1!=frequency&&4!=frequency||ReportSetting.consOptionForClsDay(toDay).map(obj=>obj.value).includes(closureDay))&&(1!=frequency&&4!=frequency||ReportSetting.consOptionForClsDay(32==closureDay?1:closureDay+1).map(obj=>obj.value).includes(report_freeze))&&(4!==frequency||ReportSetting.consOptionForClsDay(toDay2).map(obj=>obj.value).includes(closureDay2))&&(4!==frequency||ReportSetting.consOptionForClsDay(32==closureDay2?1:closureDay2+1).map(obj=>obj.value).includes(report_freeze2))||(isValid=!1),isValid){modal.find("#zp_rs_closure_day_info").hide();var closureMsg="";(frequency=parseInt(frequency))!==RSCONSTANTS.WEEKLY&&frequency!==RSCONSTANTS.BIWEEKLY||closureDay===RSCONSTANTS.NONE?frequency===RSCONSTANTS.MONTHLY&&closureDay!==RSCONSTANTS.NONE?closureMsg=closureDay>=toDay&&closureDay<=RSCONSTANTS.LASTDAY?(RSCONSTANTS.LASTDAY,ZPI18N.getString("zp.sofcurrentmonth")):(RSCONSTANTS.LASTDAY,ZPI18N.getString("zp.ppnextmonth")):frequency===RSCONSTANTS.SEMIMONTHLY&&closureDay!==RSCONSTANTS.NONE&&(closureMsg=ReportSettings.setClsDayInfo()):closureMsg=ZPI18N.getString("zp.ppeveryweek");report_freeze!==RSCONSTANTS.NONE&&(frequency===RSCONSTANTS.WEEKLY||frequency===RSCONSTANTS.BIWEEKLY?ZPI18N.getString("zp.ppeveryweek"):frequency===RSCONSTANTS.MONTHLY&&ZPI18N.getString("zp.sofcurrentmonth")),modal.find("#zp_rs_closure_day_info").text(closureMsg).show().css("display","inline-block");var lock_enabled=modal.find("#zp_rs_freeze").is(":checked");if(frequency===RSCONSTANTS.SEMIMONTHLY){let fromDay2=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_fromday_semMont")).getValue()),toDay2=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_today_semMont")).getValue()),period_details=ReportSettings.getPayPeriodSummary(fromDay,toDay,closureDay,report_freeze,frequency,fromDay2,toDay2,closureDay2,report_freeze2),process_date=period_details.closure+", "+period_details.closure2,payprocess_date=period_details.payroll_closure+" "+(report_freeze===closureDay?"":"00:00 AM")+", "+period_details.payroll_closure2+" "+(report_freeze2===closureDay2?"":"00:00 AM"),processReports=ZPI18N.getString("zp.leave.report.lopreport")+(modal.find("#zp_rs_encash").is(":checked")?", "+ZPI18N.getString("zp.leave.encashmentreport",["Leave"]):"")+" & "+ZPI18N.getString("zp.local.ovetimedetailsreport"),help="<h6><span>"+ZPI18N.getString("zp.ppgeneration.summary")+"</span></h6><ul><li><em>Upcoming Pay Cycles : "+period_details.start+" - "+period_details.end+", "+period_details.start2+" - "+period_details.end2+"</em></li><li><em>"+ZPI18N.getString("zp.payperiod.generation.help1",[processReports,process_date])+"</em></li>";lock_enabled&&(help+="<li><em>"+ZPI18N.getString("zp.payperiod.generation.help2",[process_date])+"</em></li>"),help+=report_freeze>-1&&report_freeze2>-1?"<li><em>"+ZPI18N.getString("zp.payperiod.generation.help4",[payprocess_date])+"</em></li>":"",help+="</ul>",modal.find("#cycle_details").html(help).show().css("display","inline-block")}else{let period_details=ReportSettings.getPayPeriodSummary(fromDay,toDay,closureDay,report_freeze,frequency),process_date=period_details.closure,payprocess_date=period_details.payroll_closure+" "+(report_freeze===closureDay?"":"00:00 AM"),processReports=ZPI18N.getString("zp.leave.report.lopreport")+(modal.find("#zp_rs_encash").is(":checked")?", "+ZPI18N.getString("zp.leave.encashmentreport",["Leave"]):"")+" & "+ZPI18N.getString("zp.local.ovetimedetailsreport"),help="<h6><b>"+ZPI18N.getString("zp.ppgeneration.summary")+"</b></h6><ul><li><em>Upcoming pay cycle : "+period_details.start+" - "+period_details.end+"</em></li><li><em>"+ZPI18N.getString("zp.payperiod.generation.help1",[processReports,process_date])+"</em></li>";lock_enabled&&(help+="<li><em>"+ZPI18N.getString("zp.payperiod.generation.help2",[process_date])+"</em></li>"),help+=report_freeze>-1?"<li><em>"+ZPI18N.getString("zp.payperiod.generation.help4",[payprocess_date])+"</em></li>":"",help+="</ul>",modal.find("#cycle_details").html(help).show().css("display","inline-block")}}else modal.find("#cycle_details").hide()}},validateInput:function(fromSave){var isValid=ReportSetting.validateEndDay(fromSave);return isValid=isValid?ReportSetting.validateGenerationDay():isValid},saveAction:function(modal,isUpdate){(modal=settingsPage.container.find("#configurePayPeriod")).find("#zp_rs_name_error").hide(),modal.find("#zp_rs_appFor_error").hide();var isValid=ReportSetting.validateGenerationDay(),name=$.trim(modal.find("#zp_rs_name").val());(void 0===name||name.length<=0)&&(modal.find("#zp_rs_name").addClass("ztextbox__error"),modal.find("#zp_rs_name_error").html(ZPI18N.getString("zp.payperiod.nameerror")).show(),isValid=!1);let leave_type_heirarchy=[];if(modal.find("#zp_rs_convert_absent").is(":checked")){modal.find("select[name=convertAbs_lt]").each(function(idx,ele){leave_type_heirarchy.push(TimelyZComp.select.getValue(ele))})}var appForEntity=ZPeopleComponents.select(modal.find("#zp_rs_appfor")).getValue(),appForArray=TimelyZComp.tokenField.getValues(modal.find("#zp_rs_appfor_values"));if((void 0==appForArray||appForArray.length<1)&&(modal.find("#zp_rs_appFor_error").html(ZPI18N.getString("zp.tt.selectonecriteria")).show(),isValid=!1),isValid){var frequency=ZPeopleComponents.select(modal.find("#zp_rs_frequency")).getValue(),toDay=ZPeopleComponents.select(modal.find("#zp_rs_to_day")).getValue(),fromDay=ZPeopleComponents.select(modal.find("#zp_rs_from_day")).getValue(),closureDay=ZPeopleComponents.select(modal.find("#zp_rs_closure_day")).getValue(),isFreeze=modal.find("#zp_rs_freeze").is(":checked"),processEncashment=modal.find("#zp_rs_encash").is(":checked"),payPerCycle={};payPerCycle.rsName=name,payPerCycle.rsFrequency=parseInt(frequency),payPerCycle.rsFromDay=parseInt(fromDay),payPerCycle.rsToDay=parseInt(toDay),payPerCycle.rsClosureDay=parseInt(closureDay),payPerCycle.rsIsFreeze=isFreeze,payPerCycle.rsProcessEncashment=processEncashment,payPerCycle.rsPayrollClosure=ZPeopleComponents.select(modal.find("#zp_rs_freeze_date")).getValue(),payPerCycle.rsReviewStatus=Layout.Page.container.find("#zp_rs_review").is(":checked")?ZPeopleComponents.select(modal.find("#zp_rs_review_status")).getValue():-1,"4"===frequency&&(payPerCycle.rsSecClosureDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_closureday_semMont")).getValue()),payPerCycle.rsSecPayrollClosure=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_freeze_date2")).getValue()),payPerCycle.rsSecFromDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_fromday_semMont")).getValue()),payPerCycle.rsSecToDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_today_semMont")).getValue())),leave_type_heirarchy.length>0&&(payPerCycle.MODULE_DATA={LEAVE_TYPE_HIERARCHY:JSON.stringify(leave_type_heirarchy)});var url="reportSettingAction.zp";settingsUrlProps.currentMode&&"marketplace"!==settingsUrlProps.currentMode&&(url="/"+settingsUrlProps.currentMode+url);var params={mode:void 0!==isUpdate&&"boolean"==typeof isUpdate&&isUpdate?"updateReportSetting":"addReportSetting",reportSettingID:void 0!==isUpdate&&"boolean"==typeof isUpdate&&isUpdate?ReportSetting.localValues.repSettID:0,payPerCycle:JSON.stringify(payPerCycle)};"EMPLOYEE_TYPE"===appForEntity&&(params.employeeType=appForArray.toString()),"ROLE"===appForEntity?params.role=appForArray.toString():params.locationList=appForArray.toString(),modal.find(".zpl_mfoter").find("#zp_modal_blubtn").attr("disabled",!0),ZPeople.Request.sendAsyncPost(url,params,ReportSetting.saveActionCallBack),ReportSettings.showReportSettingListAsync(!0)}},setClsDayInfo:function(){var clsDayVal=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_closure_day")).getValue()),secClsDayVal=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_closureday_semMont")).getValue()),toDayVal=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_to_day")).getValue()),secToDayVal=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_today_semMont")).getValue()),clsDayInfo=ZPI18N.getString("zp.sofcurrentmonth");return toDayVal<=15&&secClsDayVal<secToDayVal?ZPI18N.getString("zp.ppnextmonth"):toDayVal===RSCONSTANTS.LASTDAY&&toDayVal===clsDayVal?clsDayInfo=ZPI18N.getString("zp.pppreviousmonth"):toDayVal>15&&toDayVal<=clsDayVal&&(clsDayInfo=ZPI18N.getString("zp.pppreviousmonth")),-1===clsDayVal&&(clsDayInfo=""),clsDayInfo},setDayInfo:function(toDay){var modal=settingsPage.container.find("#configurePayPeriod"),secClsDayVal=parseInt(modal.find("#zp_rs_today_semMont").val()),startDayInfo=ZPI18N.getString("zp.sofcurrentmonth"),endDayInfo=startDayInfo;ZPeopleComponents.select(modal.find("#zp_rs_closure_day")).setAttributes({options:ReportSetting.consOptionForClsDay(toDay),selectedValue:RSCONSTANTS.NONE}),ZPeopleComponents.select(modal.find("#zp_rs_freeze_date")).setAttributes({options:ReportSetting.consOptionForClsDay(toDay),selectedValue:RSCONSTANTS.NONE}),ZPeopleComponents.select(modal.find("#zp_rs_closureday_semMont")).setAttributes({options:ReportSetting.consOptionForClsDay(secClsDayVal),selectedValue:RSCONSTANTS.NONE}),ZPeopleComponents.select(modal.find("#zp_rs_freeze_date2")).setAttributes({options:ReportSetting.consOptionForClsDay(secClsDayVal),selectedValue:RSCONSTANTS.NONE}),toDay<14?startDayInfo=ZPI18N.getString("zp.pppreviousmonth"):toDay===RSCONSTANTS.LASTDAY?startDayInfo=endDayInfo=ZPI18N.getString("zp.pppreviousmonth"):toDay>15&&(startDayInfo=endDayInfo=ZPI18N.getString("zp.pppreviousmonth")),modal.find("#zp_rs_startday_info").text(startDayInfo).show(),modal.find("#zp_rs_endday_info").text(endDayInfo).show(),modal.find("#zp_rs_closure_day_info,#zp_rs_closure_dayinfo_semMont").text("").hide()},consOptionForClsDay:function(toDay){var bufferOpt=[];bufferOpt.push({label:ZPI18N.getString("zp.select"),value:RSCONSTANTS.NONE}),32===toDay&&(toDay=29);for(var i=toDay;i<toDay+7;i++)if(29===i)bufferOpt.push({label:ZPI18N.getString("zp.schlastday"),value:RSCONSTANTS.LASTDAY});else if(i>29){var tDay=i-29;bufferOpt.push({label:tDay+ReportSettings.getNumberSuffix(tDay),value:tDay})}else bufferOpt.push({label:i+ReportSettings.getNumberSuffix(i),value:i});return bufferOpt},populateData:function(repSettID){var modal=settingsPage.container.find("#configurePayPeriod"),rs=ReportSetting.ALL_LIST[repSettID];modal.find("#zp_rs_name").val(rs.rsName).focus(),ZPeopleComponents.select(modal.find("#zp_rs_frequency")).setValue(rs.frequencyCode),ZPeopleComponents.select(modal.find("#zp_rs_from_day")).setValue(rs.startDayCode),ZPeopleComponents.select(modal.find("#zp_rs_to_day")).setValue(rs.toDayCode),ReportSetting.setOptionsForEdit(modal.find("#zp_rs_closure_day"),rs.closureDayCode),rs.frequencyCode===RSCONSTANTS.SEMIMONTHLY&&(ReportSetting.setOptionsForEdit(modal.find("#zp_rs_closureday_semMont"),rs.closureDayCode_2),ReportSetting.setOptionsForEdit(modal.find("#zp_rs_freeze_date2"),rs.rsSecPayrollClosure)),ReportSetting.setOptionsForEdit(modal.find("#zp_rs_freeze_date"),rs.payrollClosure),modal.find("#zp_rs_freeze")[0].checked=rs.isFreeze,modal.find("#zp_rs_encash")[0].checked=rs.rsProcessEncashment,modal.find("#zp_rs_review")[0].checked=rs.rsReviewStatus>-1,rs.rsReviewStatus>-1&&(ZPeopleComponents.select(modal.find("#zp_rs_review_status")).setValue(rs.rsReviewStatus),ZPeopleComponents.select(modal.find("#zp_rs_review_status")).setAttributes({disabled:!1})),ReportSetting.getPayPeriodInfo();var appForValues=["0"];rs.appEmpType.length>0?(appForValues=rs.appEmpType,ZPeopleComponents.select(modal.find("#zp_rs_appfor")).setValue("EMPLOYEE_TYPE")):rs.appRole.length>0?(appForValues=rs.appRole,ZPeopleComponents.select(modal.find("#zp_rs_appfor")).setValue("ROLE")):(appForValues=rs.locationList,ZPeopleComponents.select(modal.find("#zp_rs_appfor")).setValue("LOCATION")),TimelyZComp.tokenField.setValues(modal.find("#zp_rs_appfor_values"),appForValues);let module_data=rs.MODULE_DATA;if(void 0!=module_data&&void 0!=module_data.LEAVE_TYPE_HIERARCHY&&module_data.LEAVE_TYPE_HIERARCHY.length>0){let leavetypeHeirarchy=module_data.LEAVE_TYPE_HIERARCHY,leavetype_cont=modal.find("#convertAbs_leaveIdCont");for(var leaveId of(leavetype_cont.removeClass("DNI"),modal.find("#zp_rs_convert_absent").attr("checked",!0),leavetypeHeirarchy))ReportSetting.addConvertAbsLeaveRow(leaveId)}},setOptionsForEdit:function(ele,day){var entitySelector=ZPeopleComponents.select(ele);entitySelector.options.map(obj=>obj.value).includes(day)?entitySelector.setValue(day):(entitySelector.deselectAllOptions(),entitySelector.setAttributes({placeholder:32==day?ZPI18N.getString("zp.schlastday"):day+ReportSettings.getNumberSuffix(day)}))},updateAction:function(){ReportSetting.saveAction(null,!0)},saveActionCallBack:function(data){if("ACCESS_DENIED"===data.error)return ReportSettings.accessDenied(),null;var modal=settingsPage.container.find("#configurePayPeriod");if("SHOW_ERROR"===data.ACTION)return modal.find("#zp_rs_appFor_error").html("Pay Period Setting already configured for this criteria").show(),void settingsPage.container.find("#configurePayPeriod").find(".zpl_mfoter").find("#zp_modal_blubtn").prop("disabled",!1);modal.find("#zp_rs_appFor_error").hide(),ReportSetting.destroyZComp(),settingsPage.container.find("#configurePayPeriod").find(".zpl_mfoter").find("#zp_modal_blubtn").prop("disabled",!1),ModuleComp.Modal.hide("configurePayPeriod"),data.STATUS===ZPI18N.getString("zp.capfailure")?void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&ModuleComp.Msg.showFailureMsg(data.CLIENT_MSG):data.STATUS===ZPI18N.getString("zp.capsuccess")&&(void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&ModuleComp.Msg.showSuccessMsg(data.CLIENT_MSG),ReportSetting.showReportSettingList(!0))},deleteAction:function(obj){var repSettID=$(obj).attr("rsID"),url="reportSettingAction.zp";settingsUrlProps.currentMode&&"marketplace"!==settingsUrlProps.currentMode&&(url="/"+settingsUrlProps.currentMode+url);var params={mode:"deleteReportSetting",reportSettingID:repSettID};ZPeople.Request.sendAsyncPost(url,params,ReportSetting.afterDeleteAction)},afterDeleteAction:function(data){if(ModuleComp.Modal.hide("zp_modal_deletepop",!0),"ACCESS_DENIED"===data.error)return ReportSettings.accessDenied(),null;if(data.STATUS===ZPI18N.getString("zp.capfailure"))void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&ModuleComp.Msg.showFailureMsg(data.CLIENT_MSG);else if(data.STATUS===ZPI18N.getString("zp.capsuccess")){void 0!==data.CLIENT_MSG&&$.trim(data.CLIENT_MSG).length>0&&ModuleComp.Msg.showSuccessMsg(data.CLIENT_MSG);var repSettID=data.DATA.reportSettingID;$("#zp_report_setting_table_body_id #tr_"+repSettID).remove(),delete ReportSetting.ALL_LIST[repSettID],Object.keys(ReportSetting.ALL_LIST).length<=0&&(settingsPage.container.find("#zp_report_Setting_list,#zp_report_settings_loading").hide(),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.payperiod.nodatamsg"),buttonName:ZPI18N.getString("zp.payperiodaddbutton"),buttonCallBack:ReportSetting.constructAddEditPage,desc:ZPI18N.getString("zp.leave.payperioddef")}),settingsPage.container.find("#addPayPeriodBtn").closest(".zpl_btnmnu").addClass("DNI"))}},destroyZComp:function(){var modal=settingsPage.container.find("#configurePayPeriod");modal.find("select").each(function(){ZPeopleComponents.select(modal.find("#"+$(this).attr("id"))).destroy()}),modal.find("textarea").each(function(){ZPeopleComponents.tokenfield(modal.find("#"+$(this).attr("id"))).destroy()})},showHideConfirmDeleteButtons:function(obj,toggleId,callBack){callBack&&toggleId&&ModuleComp.Modal.delete(function(){callBack(obj)},ZPI18N.getString("zp.payperiod.deletepayperiod"),ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.spayperiod")+" "+ZPI18N.getString("zp.sconfig")]),ZPI18N.getString("zp.confirm"),{calId:toggleId})},monthlyOptions:function(skipNone,isStart){var monthlyOpt=[],cnt=28;!skipNone&&isStart&&(cnt=29),monthlyOpt.push({label:ZPI18N.getString("zp.select"),value:RSCONSTANTS.NONE});for(var i=1;i<=cnt;i++)monthlyOpt.push({label:i+ReportSettings.getNumberSuffix(i),value:i});return monthlyOpt.push({label:ZPI18N.getString("zp.schlastday"),value:RSCONSTANTS.LASTDAY}),monthlyOpt},weeklyOptions:function(skipNone,isStart){var weeklyOpt=[];return weeklyOpt.push({label:ZPI18N.getString("zp.select"),value:RSCONSTANTS.NONE}),weeklyOpt.push({label:ZPI18N.getString("zp.sunday"),value:RSCONSTANTS.SUNDAY}),weeklyOpt.push({label:ZPI18N.getString("zp.monday"),value:RSCONSTANTS.MONDAY}),weeklyOpt.push({label:ZPI18N.getString("zp.tuesday"),value:RSCONSTANTS.TUESDAY}),weeklyOpt.push({label:ZPI18N.getString("zp.wednesday"),value:RSCONSTANTS.WEDNESDAY}),weeklyOpt.push({label:ZPI18N.getString("zp.thursday"),value:RSCONSTANTS.THURSDAY}),weeklyOpt.push({label:ZPI18N.getString("zp.friday"),value:RSCONSTANTS.FRIDAY}),weeklyOpt.push({label:ZPI18N.getString("zp.saturday"),value:RSCONSTANTS.SATURDAY}),weeklyOpt},iterate:function(reportList){void 0!==reportList&&$.each(reportList,function(key,value){var rsJson={};rsJson.reportSettID=value.rsID;var freq=value.rsFrequency;if(freq===RSCONSTANTS.MONTHLY){rsJson.frequencyCode=freq,rsJson.frequencyName=ZPI18N.getString("zp.monthly"),rsJson.toDayCode=value.rsToDay,rsJson.toDayName=ZPI18N.getString("zp.schlastday"),value.rsToDay!==RSCONSTANTS.LASTDAY&&(rsJson.toDayName=value.rsToDay);var startDay=ReportSettings.getStartDayFromEndDay(freq,value.rsToDay),info=ReportSettings.getStartDayEndDayInfo(freq,value.rsToDay),cycle=startDay;startDay!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(startDay))),cycle+=" <span class='dgry'>"+info[0]+"</span> - "+rsJson.toDayName,rsJson.toDayCode!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(rsJson.toDayName))),cycle+=" <span class='dgry'>"+info[1]+"</span>",rsJson.ppcycle=cycle,rsJson.startDayCode=startDay,rsJson.closureDayCode=value.rsClosureDay,rsJson.closureDayName=ZPI18N.getString("zp.select"),value.rsClosureDay===RSCONSTANTS.LASTDAY?rsJson.closureDayName=ZPI18N.getString("zp.schlastday"):value.rsClosureDay!==RSCONSTANTS.NONE&&(rsJson.closureDayName=value.rsClosureDay)}else if(freq===RSCONSTANTS.SEMIMONTHLY){rsJson.frequencyCode=freq,rsJson.frequencyName=ZPI18N.getString("zp.monthly"),rsJson.toDayCode=value.rsToDay,rsJson.toDayName=ZPI18N.getString("zp.schlastday"),value.rsToDay!==RSCONSTANTS.LASTDAY&&(rsJson.toDayName=value.rsToDay);var stEndDet=ReportSettings.getStartDayEndDay(value.rsToDay);info=ReportSettings.getStartDayEndDayInfo(freq,value.rsToDay);cycle="<div>"+stEndDet.startDay_1,stEndDet.startDay_1!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(stEndDet.startDay_1))),cycle+=" <span class='dgry'>"+info[0]+"</span> - "+rsJson.toDayName,rsJson.toDayCode!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(rsJson.toDayName))),cycle+=" <span class='dgry'>"+info[1]+"</span>",cycle+=" </div>",cycle+="<div class='MT10'>"+stEndDet.startDay_2,stEndDet.startDay_2!==RSCONSTANTS.LASTDAY&&(cycle+=ReportSettings.getNumberSuffix(parseInt(stEndDet.startDay_2))),stEndDet.endDay_2===RSCONSTANTS.LASTDAY?cycle+=" <span class='dgry'>"+info[2]+"</span> - "+ZPI18N.getString("zp.schlastday"):(cycle+=" <span class='dgry'>"+info[2]+"</span> - "+stEndDet.endDay_2,cycle+=ReportSettings.getNumberSuffix(parseInt(stEndDet.endDay_2))),cycle+=" <span class='dgry'>"+info[3]+"</span>",cycle+=" </div>",rsJson.ppcycle=cycle,rsJson.info=info,rsJson.startDayCode=startDay,rsJson.closureDayCode=value.rsClosureDay,rsJson.toDayCode_2=value.rsSecToDay,rsJson.closureDayCode_2=value.rsSecClosureDay,rsJson.closureDayName=ZPI18N.getString("zp.select"),value.rsClosureDay===RSCONSTANTS.LASTDAY?rsJson.closureDayName=ZPI18N.getString("zp.schlastday"):value.rsClosureDay!==RSCONSTANTS.NONE&&(rsJson.closureDayName=value.rsClosureDay),rsJson.closureDayName_2=ZPI18N.getString("zp.select"),value.rsSecClosureDay===RSCONSTANTS.LASTDAY?rsJson.closureDayName_2=ZPI18N.getString("zp.schlastday"):value.rsSecClosureDay!==RSCONSTANTS.NONE&&(rsJson.closureDayName_2=value.rsSecClosureDay),rsJson.rsSecPayrollClosure=value.rsSecPayrollClosure}else{rsJson.frequencyCode=freq,rsJson.frequencyName=ZPI18N.getString("zp.weekly"),rsJson.toDayCode=value.rsToDay,rsJson.toDayName=RSCONSTANTS.WEEK_NAME[value.rsToDay];startDay=ReportSettings.getStartDayFromEndDay(freq,value.rsToDay),cycle=RSCONSTANTS.WEEK_NAME[startDay]+" - "+rsJson.toDayName;rsJson.ppcycle=cycle,rsJson.startDayCode=startDay,rsJson.closureDayCode=value.rsClosureDay,rsJson.closureDayName=ZPI18N.getString("zp.select"),value.rsClosureDay!==RSCONSTANTS.NONE&&(rsJson.closureDayName=RSCONSTANTS.WEEK_NAME[value.rsClosureDay])}rsJson.rsName=ZPeople.decodeTxt(value.rsName),rsJson.isFreeze=value.rsIsFreeze,rsJson.rsProcessEncashment=value.rsProcessEncashment,rsJson.payrollClosure=ZP.optValue(value,"rsPayrollClosure",-1),rsJson.locationList=value.rsLocations,rsJson.appEmpType=value.rsEmpTypes,rsJson.appRole=value.rsRoles,rsJson.rsReviewStatus=value.rsReviewStatus,value.hasOwnProperty("MODULE_DATA")&&(rsJson.MODULE_DATA=value.MODULE_DATA),ReportSetting.ALL_LIST[rsJson.reportSettID]=rsJson})},updateClosureDay:obj=>{var modal=settingsPage.container.find("#configurePayPeriod");modal.find("#zp_rs_to_day_error").hide(),Timetracker.Util.removeError(modal.find("#zp_rs_to_day"));var appendTo=modal.find(".zpl_mcnt"),frequency=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_frequency")).getValue()),toDay=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_to_day")).getValue());if(frequency===RSCONSTANTS.WEEKLY||frequency===RSCONSTANTS.BIWEEKLY)return(-1==toDay||isNaN(toDay))&&ZPeopleComponents.select(modal.find("#zp_rs_closure_day")).setAttributes({options:ReportSetting.weeklyOptions(!0),selectedValue:RSCONSTANTS.NONE,dropdownList:{appendTo:appendTo}}),void ReportSetting.getPayPeriodInfo();if(-1==toDay||isNaN(toDay))return ZPeopleComponents.select(modal.find("#zp_rs_closure_day")).setAttributes({options:ReportSetting.monthlyOptions(!0,!1),selectedValue:RSCONSTANTS.NONE,dropdownList:{appendTo:appendTo}}),void(frequency===RSCONSTANTS.SEMIMONTHLY&&ZPeopleComponents.select(modal.find("#zp_rs_closureday_semMont")).setAttributes({options:ReportSetting.monthlyOptions(!0,!1),selectedValue:RSCONSTANTS.NONE,dropdownList:{appendTo:appendTo}}));if(ReportSetting.updateValuesBasedOnPrev(modal.find("#zp_rs_closure_day"),toDay,appendTo),frequency===RSCONSTANTS.SEMIMONTHLY){var toDay2=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_today_semMont")).getValue());ReportSetting.updateValuesBasedOnPrev(modal.find("#zp_rs_closureday_semMont"),toDay2,appendTo)}ReportSetting.getPayPeriodInfo()},updatePayrollDay:obj=>{var modal=settingsPage.container.find("#configurePayPeriod");modal.find("#zp_rs_closure_day_error,#zp_rs_closure_dayerror_semMont").hide(),Timetracker.Util.removeError(modal.find("#zp_rs_closure_day")),Timetracker.Util.removeError(modal.find("#zp_rs_closureday_semMont"));var closureDay,appendTo=modal.find(".zpl_mcnt"),frequency=parseInt(ZPeopleComponents.select(modal.find("#zp_rs_frequency")).getValue()),closureDaySelector="#zp_rs_closure_day",payrollDaySelector="#zp_rs_freeze_date";if(frequency===RSCONSTANTS.WEEKLY||frequency===RSCONSTANTS.BIWEEKLY)return(-1==(closureDay=parseInt(ZPeopleComponents.select(modal.find(closureDaySelector)).getValue()))||isNaN(closureDay))&&ZPeopleComponents.select(modal.find("#zp_rs_freeze_date")).setAttributes({options:ReportSetting.weeklyOptions(!0),selectedValue:RSCONSTANTS.NONE,dropdownList:{appendTo:appendTo}}),void ReportSetting.getPayPeriodInfo();obj.target.length>0&&"zp_rs_closureday_semMont"===obj.target.attr("id")&&(closureDaySelector="#zp_rs_closureday_semMont",payrollDaySelector="#zp_rs_freeze_date2"),-1==(closureDay=parseInt(ZPeopleComponents.select(modal.find(closureDaySelector)).getValue()))||isNaN(closureDay)?ZPeopleComponents.select(modal.find(payrollDaySelector)).setAttributes({options:ReportSetting.monthlyOptions(!0),selectedValue:RSCONSTANTS.NONE,dropdownList:{appendTo:appendTo}}):ReportSetting.updateValuesBasedOnPrev(modal.find(payrollDaySelector),32==closureDay?1:closureDay+1,appendTo),ReportSetting.getPayPeriodInfo()},updateValuesBasedOnPrev:(ele,baseVal,appendTo)=>{var day=parseInt(ZPeopleComponents.select(ele).getValue());day=isNaN(day)?RSCONSTANTS.NONE:day;var selectedVal=RSCONSTANTS.NONE,options=ReportSetting.consOptionForClsDay(baseVal);options.map(obj=>obj.value).includes(day)&&(selectedVal=day),ZPeopleComponents.select(ele).setAttributes({options:options,selectedValue:selectedVal,dropdownList:{appendTo:appendTo}})}};