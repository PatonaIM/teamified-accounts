Attendance.Reg={LayoutId:null,isEditTotalHours:null,checkedBoxVal:[],apprconfirmStatus:-1,isFromreset:!1,init:function(){if(isManageAttendanceData=ZPeople.Module.MODULE_DATA.attendance.isManageAttedance,repMan=ZPeople.Module.MODULE_DATA.attendance.isLeadForShift,isEmpChooseApp=ZPeople.Module.MODULE_DATA.attendance.isEmpChooseApp,spocRegView=ZPeople.Module.MODULE_DATA.attendance.isSPOCEntryViewAllowed,isadmin&&(isManageAttendanceData=!0),JSON.stringify(Attendance.Reg.regReasons)!==JSON.stringify(ZPeople.Module.MODULE_DATA.attendance.regReasons)&&(Attendance.Reg.isRegReasonsEnabled=ZPeople.Module.MODULE_DATA.attendance.isRegReasonsEnabled,Attendance.Reg.regReasons=ZPeople.Module.MODULE_DATA.attendance.regReasons,$("#attendance-regularization-myrequests #ZPAtt_RegFilters_Reasons").html(""),$("#attendance-regularization-myapprovals #ZPAtt_RegFilters_Reasons").html("")),spocRegView||isManageAttendanceData||Layout.Page.container.find("#ZPAtt_myReqReg_empProfile").parent().parent().remove(),Attendance.Reg.LayoutId="#"+Layout.Page.container[0].id,Layout.Page.container.find("select").select2({minimumResultsForSearch:5}),Layout.Page.container.find("[data-toggle=tooltip]").tooltip({trigger:"click"}),Layout.Page.container.find("#ZPAtt_Reg_Filter").hasClass("ZPFilsel")&&$("#page-wrapper").attr("class","Nbar2F THF-2F"),-1!==Layout.Page.hash.indexOf("attendance/regularization/myrequests")){if(Layout.Page.container.find("#ZPAtt_RegBulkDelete").hide().prev().show(),Layout.Page.container.find("#ZPAtt_regMreOptns ul li").first().addClass("DN"),!isadmin||"6561197"!==_LOGGEDIN_ZSOID&&"59429288"!==_LOGGEDIN_ZSOID&&"676477865"!==_LOGGEDIN_ZSOID&&"55430888"!==_LOGGEDIN_ZSOID&&"663099069"!==_LOGGEDIN_ZSOID&&"708868343"!==_LOGGEDIN_ZSOID||Layout.Page.container.find("#ZPAtt_regMreOptns ul li").first().removeClass("DN"),Attendance.Report.getDepLocShiftList(!0),Attendance.Reg.isRegReasonsEnabled&&0===Layout.Page.container.find("#ZPAtt_RegFilters_Reasons option").length){var txt='<option value="-3">'+ZPI18N.getString("zp.all")+"</option>";$.each(Attendance.Reg.regReasons,function(index,data){txt+='<option value="'+index+'">'+$("<div/>").text(data).html()+"</option>"}),Layout.Page.container.find("#ZPAtt_RegFilters_Reasons").append(txt),Layout.Page.container.find("select").select2({minimumResultsForSearch:5}),Layout.Page.container.find("select[multiple='multiple']").select2({closeOnSelect:!1})}AttendanceApprovals.appendApprovalTopBand("myrequests","regularization"),Attendance.Reg.getRequest(!1)}else if(-1!==Layout.Page.hash.indexOf("attendance/regularization/myapprovals")){if(Layout.Page.container.find("#ZPAtt_RegTotalApprAction").hide().prev().show(),Attendance.Reg.isRegReasonsEnabled&&0===Layout.Page.container.find("#ZPAtt_RegFilters_Reasons option").length){txt='<option value="-3">'+ZPI18N.getString("zp.all")+"</option>";$.each(Attendance.Reg.regReasons,function(index,data){txt+='<option value="'+index+'">'+$("<div/>").text(data).html()+"</option>"}),Layout.Page.container.find("#ZPAtt_RegFilters_Reasons").append(txt),Layout.Page.container.find("select").select2({minimumResultsForSearch:5})}AttendanceApprovals.appendApprovalTopBand("myapprovals","regularization"),Attendance.Reg.getApprovals(!1)}else Attendance.Reg.getAttendanceRegDetails()},toggleFilSearch:function(){"#attendance-regularization-myrequests"===Attendance.Reg.LayoutId?Attendance.Reg.getRequest(!1,!0):Attendance.Reg.getApprovals(!1,!0),"/zp"===ZPeople.CONTEXT&&Attendance.Reg.toggleFilter()},toggleFilter:function(){$(Attendance.Reg.LayoutId+" #ZPAtt_Reg_Filter").hasClass("ZPFilsel")?($(Attendance.Reg.LayoutId+" #ZPAtt_Reg_Filter").removeClass("blu ZPFilsel"),$(Attendance.Reg.LayoutId+" #ZPAtt_RegFilters").attr("class","ZPFilMain"),$(Attendance.Reg.LayoutId+" #ZPAtt_RegFilClsBut").hide(),$("#page-wrapper").attr("class","Nbar3")):($(Attendance.Reg.LayoutId+" #ZPAtt_Reg_Filter").addClass("blu ZPFilsel"),$(Attendance.Reg.LayoutId+" #ZPAtt_RegFilters").attr("class","ZPFilMain TEbnd"),$(Attendance.Reg.LayoutId+" #ZPAtt_RegFilClsBut").show(),$("#page-wrapper").attr("class","Nbar2F THF-2F"),isManageAttendanceData||repMan||spocRegView?$(Attendance.Reg.LayoutId+" #ZPAtt_myReqReg_empName").parent().parent().show():$(Attendance.Reg.LayoutId+" #ZPAtt_myReqReg_empName").parent().parent().hide())},resetInputs:function(){var filters=Layout.Page.container.find("#ZPAtt_regFilter");filters.find("#ZPAtt_Reg_Status").select2("val",-3),filters.find("#ZPAtt_RegFilters_Reasons").select2("val",-3),"#attendance-regularization-myrequests"===Attendance.Reg.LayoutId&&Attendance.Reg.resetMyReqFilters(filters,"myReqReg",Attendance.Reg.currMonthSDate,Attendance.Reg.currMonthEDate)},resetMyReqFilters:function(filters,filId,currMonthSDate,currMonthEDate){filters.find("#ZPAtt_"+filId+"_empName").select2("val",""),filters.find("#ZPAtt_"+filId+"_period").select2("val","0"),filters.find("#ZPAtt_"+filId+"_fromDate").val(currMonthSDate),filters.find("#ZPAtt_"+filId+"_toDate").val(currMonthEDate),filters.find("#ZPAtt_"+filId+"_fromDate").attr("disabled",!0),filters.find("#ZPAtt_"+filId+"_toDate").attr("disabled",!0),filters.find("#ZPAtt_"+filId+"_showDirectRepTo").prop("checked",!1),filters.find("#ZPAtt_"+filId+"_showDirectRepTo").parent().show(),filters.find("#ZPAtt_"+filId+"_location").select2("val",0),filters.find("#ZPAtt_"+filId+"_orgTag").select2("val",0),filters.find("#ZPAtt_"+filId+"_status").select2("val",0),filters.find("#ZPAtt_"+filId+"_department").select2("val",0),filters.find("#ZPAtt_"+filId+"_businessUnit").select2("val",0),filters.find("#ZPAtt_"+filId+"_division").select2("val",0),filters.find("#ZPAtt_"+filId+"_entity").select2("val",0),filters.find("#ZPAtt_"+filId+"_desg").select2("val",0),filters.find("#ZPAtt_"+filId+"_empProfile").select2("val",Attendance.Report.defEmpProfSel),filters.find("#ZPAtt_"+filId+"_incExitDate").prop("checked",!0).parent().show(),filters.find("#ZPAtt_"+filId+"_status").select2("val","")},getMyRequestDateFilter:function(param,filId,filter){var sDate=filter.find("#ZPAtt_"+filId+"_fromDate").val().trim(),eDate=filter.find("#ZPAtt_"+filId+"_toDate").val().trim();if("2"===filter.find("#ZPAtt_"+filId+"_period").val()&&(""===sDate||""===eDate))return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.enterfromtodate")),void(param.error=!0);var fromDate=new Date(moment(sDate,dateFmt.toUpperCase())._d),toDate=new Date(moment(eDate,dateFmt.toUpperCase())._d);if(fromDate.getTime()>toDate.getTime())return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")),void(param.error=!0);var nextMonthDate=new Date(fromDate.getFullYear(),fromDate.getMonth()+1,fromDate.getDate()),dateErrMsg=ZPI18N.getString("zp.datewithinonemonth");if("myReqOD"===filId||"myReqPerm"===filId||"myReqReg"===filId){var erecno=filter.find("#ZPAtt_"+filId+"_empName").val();if(erecno&&0!=erecno.length&&""!=erecno)1===erecno.split(",").length&&(nextMonthDate=new Date(fromDate.getFullYear()+1,fromDate.getMonth(),fromDate.getDate()),dateErrMsg=ZPI18N.getString("zp.datewithinoneyear"))}if(toDate.getTime()>nextMonthDate)return ZPeople.Message.showFailureMsg(dateErrMsg),void(param.error=!0);""!==sDate&&(param.sDate=sDate),""!==eDate&&(param.eDate=eDate)},startIndex:0,getRequest:function(isScroll,fromSubmit,navigate){$(Attendance.Reg.LayoutId+" #ZPAtt_RegBulkDelete").hide(),$(Attendance.Reg.LayoutId+" #ZPAtt_RegBulkDelete").prev().show();var param={mode:"getMyRequest",status:$(Attendance.Reg.LayoutId+" #ZPAtt_Reg_Status").val(),conreqcsr:csrfToken};Attendance.Reg.isRegReqFromNav=void 0,navigate&&(param.navigate=navigate,Attendance.Reg.isRegReqFromNav=!0),$(Attendance.Reg.LayoutId+" #ZPAtt_Reg_myReqDaySort").hasClass("sort-d")?param.isDaySortAsc=!1:$(Attendance.Reg.LayoutId+" #ZPAtt_Reg_myReqDaySort").hasClass("sort-u")?param.isDaySortAsc=!0:$(Attendance.Reg.LayoutId+" #ZPAtt_Reg_myReqEmpSort").hasClass("sort-d")?param.isEmpSortAsc=!1:$(Attendance.Reg.LayoutId+" #ZPAtt_Reg_myReqEmpSort").hasClass("sort-u")&&(param.isEmpSortAsc=!0);var filter=Layout.Page.container.find("#ZPAtt_regFilter");Attendance.Reg.getMyRequestDateFilter(param,"myReqReg",filter),param.error||(Attendance.Report.getFilterValues(filter,param,"myReqReg"),Attendance.Reg.isRegReasonsEnabled&&-3!==Layout.Page.container.find("#ZPAtt_RegFilters_Reasons").val()&&(param.regReason=Attendance.Reg.regReasons[Layout.Page.container.find("#ZPAtt_RegFilters_Reasons").val()]),isScroll?param.startIndex=Attendance.Reg.startIndex+1:(Attendance.Reg.startIndex=0,$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReqDetails").scrollTop(0),fromSubmit&&($(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReq_emptyRecInfo")[0]&&$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReq_emptyRecInfo").hide(),$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReqDetails").hide(),0===$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReq").find("#zp_page_loading").length&&$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReq").append(ZPeople.LOADING_HTML))),$.post("/AttendanceAction.zp",param,function(resultData){if($("#zp_active_subtabs #zp_t_attendance_myapprovals").parent().removeClass("active"),$("#zp_active_subtabs #zp_t_attendance_myrequests").attr("href","#attendance/regularization/myrequests").parent().addClass("active"),resultData.error)"exceeded dates"===resultData.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinthreemonth")):"error in end date"===resultData.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate"));else{var layout=Layout.Page.container,regReqFilter=layout.find("#ZPAtt_RegFilters"),dateNav=layout.find("#ZPAtt_regReq_dateNav");Attendance.Reg.isRegReqFromNav?(regReqFilter.find("#ZPAtt_myReqReg_fromDate").val(resultData.fDate).attr("disabled",!1),regReqFilter.find("#ZPAtt_myReqReg_toDate").val(resultData.tDate).attr("disabled",!1),regReqFilter.find("#ZPAtt_myReqReg_period").select2("val",6)):resultData.sDate&&(Attendance.Reg.currMonthSDate=resultData.sDate,Attendance.Reg.currMonthEDate=resultData.eDate,Attendance.Reg.todayDate=resultData.todayDate,Attendance.Reg.prevDay=resultData.prevDay,Attendance.Reg.lastMonthStart=resultData.prevMonthStart,Attendance.Reg.lastMonthEnd=resultData.prevMonthEnd,Attendance.Reg.onPeriodChange()),resultData.dispMonth?dateNav.html(resultData.dispMonth):dateNav.html(Attendance.datesInHeader(resultData.fDate,resultData.tDate)),layout.find("#ZPAtt_RegMyReq").find("#zp_page_loading").remove(),20===resultData.list.length&&ZPeople.FireScroll.reset(),Attendance.Reg.isEditAllowedForSub=resultData.isEditAllowedForSub,Attendance.Reg.constructList(resultData,"getRequestList",isScroll),"hh:mm a"!==resultData.timeformat?Attendance.timeFormatIs12hr=!1:Attendance.timeFormatIs12hr=!0}}))},myReqEmpDaySort:function(obj){"ZPAtt_Reg_myReqEmpSort"===obj.id?$(Attendance.Reg.LayoutId+" #ZPAtt_Reg_myReqDaySort").attr("class","sort-img sort CP"):$(Attendance.Reg.LayoutId+" #ZPAtt_Reg_myReqEmpSort").attr("class","sort-img sort CP"),$(obj).hasClass("sort-d")?$(obj).attr("class","sort-img sort-u CP"):$(obj).attr("class","sort-img sort-d CP"),Attendance.Reg.getRequest(!1,!0)},onPeriodChange:function(){var fromElement=Layout.Page.container.find("#ZPAtt_myReqReg_fromDate"),toElement=Layout.Page.container.find("#ZPAtt_myReqReg_toDate");fromElement.attr("disabled",!0),toElement.attr("disabled",!0);var currMonthSDate=Attendance.Reg.currMonthSDate,currMonthEDate=Attendance.Reg.currMonthEDate,toDay=moment(Attendance.Reg.todayDate,dateFmt.toUpperCase()),weekStartDate=moment(toDay).startOf("week").add(weekstarts,"day");toDay._d.getTime()<weekStartDate._d.getTime()&&(weekStartDate=weekStartDate.add(-1,"week"));var weekEndDate=moment(toDay).startOf("week").add(weekstarts,"day");toDay._d.getTime()<weekEndDate._d.getTime()&&(weekEndDate=weekEndDate.add(-1,"week")),weekEndDate=weekEndDate.add(6,"day");var pValue=Layout.Page.container.find("#ZPAtt_myReqReg_period").val();"1"===pValue?(currMonthSDate=Attendance.Reg.lastMonthStart,currMonthEDate=Attendance.Reg.lastMonthEnd):"2"===pValue?(currMonthSDate=weekStartDate.format(dateFmt.toUpperCase()),currMonthEDate=weekEndDate.format(dateFmt.toUpperCase())):"3"===pValue?(currMonthSDate=moment(weekStartDate).add(-1,"week").format(dateFmt.toUpperCase()),currMonthEDate=moment(weekEndDate).add(-1,"week").format(dateFmt.toUpperCase())):"4"===pValue?(currMonthSDate=Attendance.Reg.todayDate,currMonthEDate=Attendance.Reg.todayDate):"5"===pValue?(currMonthSDate=Attendance.Reg.prevDay,currMonthEDate=Attendance.Reg.prevDay):"6"===pValue&&(fromElement.prop("disabled",!1),toElement.prop("disabled",!1)),"6"!==pValue&&(fromElement.val(currMonthSDate),toElement.val(currMonthEDate))},ApprstartIndex:0,getApprovals:function(isScroll,fromSubmit,callbackData){$(Attendance.Reg.LayoutId+" #zp_approval_pop").is(":visible")&&ZPeople.BSModal.hide(),Attendance.toggleLoadingDiv(!1,$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApproval"),$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApproval_emptyRecInfo"));var param={mode:"getApprovals",status:$(Attendance.Reg.LayoutId+" #ZPAtt_Reg_Status").val(),conreqcsr:csrfToken};isScroll?param.startIndex=Attendance.Reg.ApprstartIndex+1:($(Attendance.Reg.LayoutId+" #ZPAtt_RegTotalApprAction").hide(),$(Attendance.Reg.LayoutId+" #ZPAtt_RegTotalApprAction").prev().show(),$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApprovalDetails").scrollTop(0),Attendance.Reg.ApprstartIndex=0,fromSubmit&&($(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApproval_emptyRecInfo")[0]&&$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApproval_emptyRecInfo").hide(),$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApprovalDetails").hide(),0===$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApproval").find("#zp_page_loading").length&&$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApproval").append(ZPeople.LOADING_HTML))),Attendance.Reg.isRegReasonsEnabled&&-3!==Layout.Page.container.find("#ZPAtt_RegFilters_Reasons").val()&&(param.regReason=Attendance.Reg.regReasons[Layout.Page.container.find("#ZPAtt_RegFilters_Reasons").val()]),$.post("/AttendanceAction.zp",param,function(resultData){$("#zp_active_subtabs #zp_t_attendance_myrequests").parent().removeClass("active"),$("#zp_active_subtabs #zp_t_attendance_myapprovals").attr("href","#attendance/regularization/myapprovals").parent().addClass("active"),$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApproval").find("#zp_page_loading").remove(),resultData&&void 0!==resultData.list&&resultData.list.length>0&&Layout.Page.container.find("#ZPAtt_RegTotalApprAction").attr("onclick","ZPApprovals.viewApproveActionPopup("+resultData.list[0].formId+")"),Attendance.Reg.constructList(resultData,"getApprovals",isScroll),20===resultData.list.length&&ZPeople.FireScroll.reset(),callbackData&&callbackData.error&&Attendance.Reg.consApproveRejectErrorMsg(callbackData,!0)})},consApproveRejectErrorMsg:function(callbackData,isBulkApproval){if(callbackData&&callbackData.error){var errors=callbackData.error;if(isBulkApproval){var singleErr;ZPeople.Message.showFailureMsg(callbackData.errorMsg);for(var i=0;i<errors.length;i++){singleErr=errors[i];var recordRow=Layout.Page.container.find("#ZPAtt_RegMyApprovalBody").find("[recordid="+singleErr.recordId+"]");!singleErr.actionStatus&&recordRow&&(recordRow.addClass("LC2"),recordRow.find(".i_table").addClass("LC2"),7328===singleErr.code&&(singleErr.errorMsg=ZPI18N.getString("zp.commentsrequirederrormsg")),$('<i class="IC-info popHover red ML10" data-toggle="popover" data-content="'+singleErr.errorMsg+'" data-popover="true" data-original-title="" title=""></i>').insertAfter(recordRow.find("#zp_RegApproval_approvereject")))}Layout.Page.container.find("#ZPAtt_RegMyApprovalBody").popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"left",delay:{show:50,hide:50}}),setTimeout(function(){Layout.Page.container.find("#ZPAtt_RegMyApprovalBody").find("[recordid].LC2").removeClass("LC2"),Layout.Page.container.find("#ZPAtt_RegMyApprovalBody").find(".i_table.LC2").removeClass("LC2")},3e3)}}},getReqOnScroll:function(){Attendance.Reg.startIndex+=20,Attendance.Reg.getRequest(!0)},getApprOnScroll:function(){Attendance.Reg.ApprstartIndex+=20,Attendance.Reg.getApprovals(!0)},deleteBulkReg:function(){var selectedreq="";$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){selectedreq=""===selectedreq?$(this).attr("val"):selectedreq+","+$(this).attr("val")}),Attendance.Reg.deleteRegList(selectedreq)},cancelReg:function(recordId){var selectedreq="";if(void 0!=recordId?selectedreq=recordId:$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){selectedreq=""===selectedreq?$(this).attr("val"):selectedreq+","+$(this).attr("val")}),void 0!==ZPeople.Module.MODULE_DATA.attendance.isRegCancelReason){var layout=Layout.Page.container;if(!0===ZPeople.Module.MODULE_DATA.attendance.isRegCancelReason&&(void 0===layout.find("#cancel_reason textArea").val()||""===layout.find("#cancel_reason textArea").val().trim()))return void layout.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.providereason")).removeClass("DN")}Attendance.Reg.cancelRegIndividual(selectedreq)},regApprAction:function(getThis){Attendance.Reg.checkedBoxVal=[];var approvalComment=Layout.Page.container.find("#approval_comment").val(),action="zp_modal_blubtn"===getThis.id||"zp_modal_all_appr_btn"===getThis.id?1:0,isAllLevelApprove="zp_modal_all_appr_btn"===getThis.id;$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApprovalDetails").find("tbody input[type=checkbox]:enabled").each(function(){$(this).is(":checked")&&Attendance.Reg.checkedBoxVal.push($(this).attr("val"))}),Attendance.Reg.apprconfirmStatus=1,ZPForm.Record.approveReject(Attendance.Reg.checkedBoxVal,action,approvalComment,isAllLevelApprove,Attendance.Reg.resetApprovalsPage)},resetApprovalsPage:function(callbackData){Attendance.Reg.getApprovals(!1,void 0,callbackData)},constructList:function(resultData,mode,isScroll){var result=resultData.list,hideDel=resultData.hideDel,emptyMessage=$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReq_emptyRecInfo"),tslisttbody=$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReqBody"),subUrl="viewmyrequest",noDataImg="CR-at-myreq";"getApprovals"===mode&&(tslisttbody=$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApprovalBody"),emptyMessage=$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApproval_emptyRecInfo"),subUrl="viewmyapproval",noDataImg="CR-at-regapp"),tslisttbody.parent().find("thead input").attr("checked",!1),emptyMessage.hide(),emptyMessage.prev().show(),isScroll||tslisttbody.empty(),"getRequestList"!==mode||isManageAttendanceData||Layout.Page.container.find("#ZPAtt_RegMyReqHeader #ZPAtt_RegMyReqHeader_checkBox").remove(),Attendance.Reg.isRegReasonsEnabled?(Layout.Page.container.find("#ZPAtt_RegMyReqHeader #ZPAtt_RegMyReqHeader_Reason").show(),Layout.Page.container.find("#ZPAtt_RegMyApprovalHeader #ZPAtt_RegMyApprovalHeader_Reason").show(),Layout.Page.container.find("#ZPAtt_RegFilters_Reasons").closest(".col-md-2").show()):(Layout.Page.container.find("#ZPAtt_RegMyReqHeader #ZPAtt_RegMyReqHeader_Reason").hide(),Layout.Page.container.find("#ZPAtt_RegMyApprovalHeader #ZPAtt_RegMyApprovalHeader_Reason").hide(),Layout.Page.container.find("#ZPAtt_RegFilters_Reasons").closest(".col-md-2").hide()),$.each(result,function(ind,regDetails){var rowClass="ZPLNRow zp_tbr_ini";1==regDetails.regDetails.length&&regDetails.endDate&&(rowClass="ZPLNRow zp_tbr_ini zp-sr");var txt='<tr class="'+rowClass+'" id="list-'+regDetails.recordId+'" recordId="'+regDetails.recordId+'">';"getApprovals"===mode?-1===regDetails.status||regDetails.status===zpconst.ApprovalStatus.CancellationPending?txt+='<td><div class="checkbox"><input approvalStatus='+regDetails.status+' type="checkbox" val="'+regDetails.recordId+"\" onclick=\"Attendance.Reg.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>':-1!==regDetails.status&&(txt+='<td><div class="checkbox disabled"><input approvalStatus='+regDetails.status+' type="checkbox" disabled="true"><label class="MT3"></label></div></td>'):"getRequestList"===mode?!isManageAttendanceData||regDetails.isSubOrdinate||regDetails.erecno===erecno&&hideDel?isManageAttendanceData&&(regDetails.erecno===erecno&&hideDel||regDetails.isSubOrdinate)&&(txt+='<td><div class="checkbox disabled"><input type="checkbox" approvalStatus='+regDetails.status+' disabled="true"><label class="MT3"></label></div></td>'):txt+='<td><div class="checkbox"><input type="checkbox" approvalStatus='+regDetails.status+' val="'+regDetails.recordId+"\" onclick=\"Attendance.Reg.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>':"addreq"===mode&&(txt+='<td><div class="checkbox"><input type="checkbox" approvalStatus='+regDetails.status+' val="'+regDetails.recordId+"\" onclick=\"Attendance.Reg.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>');var redUrl="data-toggle=modal onclick=\"window.location.href='#attendance/regularization/"+subUrl+"-formId:"+regDetails.formId+"/recordId:"+regDetails.recordId+"'\"";txt+='<td class="P_AM UN_A"><div class="ZPusrName"><img class="FL" src='+regDetails.empPhoto+'><span class="ellipsis CP" '+redUrl+"><b>"+$("<div/>").text(regDetails.employeeId).html()+"</b>"+regDetails.employeeName+"</span>",regDetails.endDate&&(txt+='<p class="PT10 dgry MB0">'+regDetails.startDate+" "+ZPI18N.getString("zp.sto")+" "+regDetails.endDate+"</p>"),txt+="</div></td><td colspan='2' class='P0I'><table class='table'><tbody>";var regDetsHasRejectedData=!1;$.each(regDetails.regDetails,function(index,data){var reason=data.reason?data.reason:"-",oldTotHrs="-"!==data.totalHours?Attendance.disHours(data.totalHours/60):data.totalHours;txt+="<tr class='ZPLRow'><td class='P0I TBrdr'><table class='table i_table'><tbody><tr>",txt+="<td class='text-center P0I' style='min-width: 150px;'><div>"+data.originday+"</div></td><td class='text-center'><div class='W60 Mauto'>"+oldTotHrs+"</div></td>",txt+="<td class='text-center'><div class='W60 Mauto'>"+Attendance.disHours(data.new_totalHours/60)+"</div></td>",txt+="<td class='text-center'><div class='W90 Mauto'>"+Attendance.Reg.statI18nInReg(data.att_status)+"</div></td>",txt+="<td class='text-center'><div class='W90 Mauto'>"+Attendance.Reg.statI18nInReg(data.new_status)+"</div></td>",Attendance.Reg.isRegReasonsEnabled&&(txt+="<td class='text-center TBrdr' style='min-width: 150px;'><div class='WBBW'>"+reason+"</div></td>"),txt+="</tr></tbody></table></td>",0==data.status&&(regDetsHasRejectedData=!0)}),txt+="</tbody></table></td>";var appStatus="";if(1===regDetails.status){var dispStr=regDetsHasRejectedData?ZPI18N.getString("zp.partiallyapproved"):ZPI18N.getString("zp.approved");appStatus="<span "+redUrl+' class="'+(regDetsHasRejectedData?"org CP":"grn CP")+'" id = "zp_RegApproval_approvereject">'+dispStr+"</span>"}else 0===regDetails.status?appStatus="<span "+redUrl+' class="red CP" id = "zp_RegApproval_approvereject" >'+ZPI18N.getString("zp.rejected")+"</span>":-1===regDetails.status||regDetails.status===zpconst.ApprovalStatus.CancellationPending?appStatus="getRequestList"===mode||"addreq"===mode?"<span "+redUrl+' class="CP" id = "zp_RegApproval_approvereject">'+ZPI18N.getString("zp.waitingmsg")+"</span>":3===regDetails.regDetails[0].currentApprovalStatus?"<span "+redUrl+' class="CP" id = "zp_RegApproval_approvereject">'+ZPI18N.getString("zp.waitingnextlevel")+"</span>":'<button type=button class="btn btn-default btn-sm" '+redUrl+' id = "zp_RegApproval_approvereject">'+ZPI18N.getString("zp.clickapprove")+"</button>":-2===regDetails.status?appStatus="<span "+redUrl+' class="CP" id = "zp_RegApproval_approvereject">'+ZPI18N.getString("zp.drafts")+"</span>":2===regDetails.status&&(appStatus="<span "+redUrl+' class="CP red" id = "zp_RegApproval_approvereject">'+ZPI18N.getString("zp.cancelled")+"</span>");txt+='<td class="P0I TBrdr text-center">'+appStatus,txt+="</tr>","addreq"===mode?txt.prependTo(tslisttbody):tslisttbody.append(txt)}),!isManageAttendanceData&&"getRequestList"===mode&&$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReqHeader").children("th:eq(6)")[0]&&$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReqHeader").children("th:eq(6)").nextAll().remove(),Attendance.toggleLoadingDiv(!0),0===tslisttbody.children().length?(emptyMessage.prev().hide(),emptyMessage.show(),tslisttbody.prev().hide(),0===emptyMessage.find("i").eq(0).children().length&&Attendance.noDataImg(8,noDataImg,emptyMessage.find("i").eq(0))):tslisttbody.prev().show()},deleteConfirm:function(){$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){if("-1"!==$(this).attr("approvalStatus"))return!1,!1}),$("#confirmationPopup").modal({backdrop:"static",keyboard:!1}),$("#textConfirmationPopupHeader").html(ZPI18N.getString("zp.confirm")),$("#confirmConfirmationPopup").html(ZPI18N.getString("zp.confirm"));var message=ZPI18N.getString("zp.regularisationcancel");$("#textConfirmationPopupBody").html(message),$("#confirmConfirmationPopup").off("click"),$("#cancelConfirmationPopup").off("click"),$("#confirmConfirmationPopup").on("click",function(event){Attendance.Reg.deleteBulkReg()}),$("#cancelConfirmationPopup").on("click",function(event){$("#confirmationPopup").modal("hide")})},statI18nInReg:function(status){return-1!==status.indexOf("Half day Present")?status=status.replace("Half day Present",ZPI18N.getString("zp.halfdaypresent")):-1!==status.indexOf("Present")&&(status=status.replace("Present",ZPI18N.getString("zp.present"))),-1!==status.indexOf("Half day Absent")?status=status.replace("Half day Absent",ZPI18N.getString("zp.halfdayabsent")):-1!==status.indexOf("Absent")&&(status=status.replace("Absent",ZPI18N.getString("zp.absent"))),status},changeCheckBox:function(obj,val,mode){var currPage=$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyReqDetails"),pagebutton=$(Attendance.Reg.LayoutId+" #ZPAtt_RegBulkDelete");"getApprovals"===mode&&(currPage=$(Attendance.Reg.LayoutId+" #ZPAtt_RegMyApprovalDetails"),pagebutton=$(Attendance.Reg.LayoutId+" #ZPAtt_RegTotalApprAction")),"all"===val?$(obj).is(":checked")?currPage.find("tbody input[type=checkbox]:enabled").prop("checked",!0):currPage.find("tbody input[type=checkbox]:enabled").prop("checked",!1):currPage.find("tbody input[type=checkbox]:checked:enabled").length===currPage.find("tbody input[type=checkbox]:enabled").length?currPage.find("thead input[type=checkbox]:enabled").prop("checked",!0):currPage.find("thead input[type=checkbox]:enabled").prop("checked",!1),0===currPage.find("tbody input[type=checkbox]:checked:enabled").length?(pagebutton.hide(),pagebutton.prev().fadeIn(100)):(pagebutton.prev().hide(),pagebutton.fadeIn(100))},deleteRegList:function(listId){var params={mode:"deleteRegList",listId:listId,conreqcsr:csrfToken},empFilter=Layout.Page.container.find("#ZPAtt_myReqReg_empName");"0"!==empFilter.val()&&""!==empFilter.val()&&(params.erecno=empFilter.select2("val")),$.post("/AttendanceAction.zp",params,function(resultData){if(void 0!=resultData&&"success"==resultData.status){var layout=Layout.Page.container;if(layout.find("#ZPAtt_RegMyReq").is(":visible")){for(var deleted_Id=listId.split(","),i=0;i<deleted_Id.length;i++)$("#"+Layout.Page.pageId+" #list-"+deleted_Id[i]).remove();if(0===layout.find("#ZPAtt_RegMyReqBody tr").length){var emptyRecEle=layout.find("#ZPAtt_RegMyReq_emptyRecInfo");emptyRecEle.prev().hide(),emptyRecEle.fadeIn(200).parent().removeClass("section");var empImg=emptyRecEle.find("i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-regapp",empImg)}layout.find("#ZPAtt_RegMyReqDetails").find("thead input[type=checkbox]:enabled").prop("checked",!1),layout.find("#ZPAtt_RegBulkDelete").hide().prev().show()}else Attendance.Reg.getApprovals();ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.recorddeletedsuccessfully"))}else ZPeople.Message.showFailureMsg(resultData.message)})},cancelRegIndividual:function(listId){var layout=Layout.Page.container,params={mode:"cancelRegList",regId:listId,conreqcsr:csrfToken,reason:layout.find("#cancel_reason textArea").val()};$.post("/AttendanceAction.zp",params,function(resultData){if(layout.find("#cancelRegIndividual").addClass("DN"),void 0!==resultData&&void 0!==resultData.currentApprovalStatus&&void 0!==resultData.approvalDetail){ZPForm.Record.cancelRecCBforModule(resultData.currentApprovalStatus,{isfromAttendence:!0},resultData.approvalDetail)}if(void 0!=resultData&&"success"==resultData.status){ZPeople.BSModal.hide("zp_confirmation_pop");for(var regRows=layout.find("#attendanceRegListBody").find(".regRow"),n=regRows.length,i=0;i<n;i++)$(regRows.find("td:last")[i]).html(ZPI18N.getString("zp.cancelled"));var listHead=layout.find("#attendanceRegListHeader");listHead.find("#regBulkApprovalRej").hide(),listHead.find("#regApprovalState").show(),-1!==Layout.Page.hash.indexOf("#attendance/entry/tabularview")&&Attendance.Entry.getList(Attendance.Entry.selectedView,Attendance.Entry.preMonth)}else void 0!=resultData&&void 0!=resultData.message&&(resultData.message==ZPI18N.getString("zp.leave.cancell.error.providereason")?(layout.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.providereason")).removeClass("DN"),layout.find("#cancelRegIndividual").removeClass("DN")):(ZPeople.BSModal.hide("zp_confirmation_pop"),ZPeople.Message.showFailureMsg(resultData.message)))}).fail(function(data){void 0!=data.responseJSON&&void 0!=data.responseJSON.error&&layout.find("#cancel_reason_error").text(data.responseJSON.error).removeClass("DN")})},setApprovalSett:function(data){Attendance.Reg.approvalSett=data},getAttendanceRegDetails:function(formId,recordId,closeCallBack){void 0===Attendance.Reg.isRegReasonsEnabled&&ZPeople&&ZPeople.isRegReasonsEnabled&&(Attendance.Reg.isRegReasonsEnabled=ZPeople.isRegReasonsEnabled),Attendance.Entry.reloadFromWMS=!1;var popupTarget="ZPAtt_Reg_Details",title=ZPI18N.getString("zp.attendancereg");if(-1!==Layout.Page.pageId.indexOf("myapproval")?title=ZPI18N.getString("zp.myapprovals"):-1!==Layout.Page.pageId.indexOf("myrequest")&&(title=ZPI18N.getString("zp.myrequests")),!$("#"+Layout.Page.pageId+" #"+popupTarget)[0]){var regularizationViewPage='<div style="display: block;" aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" id="'+popupTarget+'" class="modal popRgtModel PopLgModel in"><div role="document" class="modal-dialog"><div class="modal-content"><div class="ZPNxtStep">';regularizationViewPage+='<div class="modal-header"><div class="col-sm-3"> <h6>'+title+' </h6> </div> <div class="col-sm-9"><div class="zp-recordsts zp_dyn" id="headerApprovalBtn"><span class="msg" id="headerApprovalMsg"></span><a id="zp_appproval_comment_btn" onclick="ZPApprovals.getApprovalDetails()">'+ZPI18N.getString("zp.view")+'</a></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div>',regularizationViewPage+='<div class="modal-body ZPAprval PT0I"><div class="container-fluid MT25"><div class="row"><div class="col-sm-7"><form class="form-horizontal"><div class="form-group"><label class="col-sm-3 Matry PT8">'+ZPI18N.getString("zp.employee")+'</label><div class="col-sm-5 PL0 PT8" id="ZPAtt_Reg_userName"></div></div><div class="form-group"><label class="col-sm-3 Matry PT8" id="attendRegDateLabel">'+ZPI18N.getString("zp.date")+'</label><div class="col-sm-6 PL0 PT10" id="attendRegDispDate"></div></div></form></div></div></div>',regularizationViewPage+='<div class="table-responsive MT30 feedModal"><table style="border-top: 1px solid #e9edf3;" class="table"><thead id="attendanceRegListHeader"><tr class="TblGryBg ZPLHRow"><th class="B1 TBrdr W350">'+ZPI18N.getString("zp.attenday")+"</th>",regularizationViewPage+='<th width="100" class="P0I TBrdr"><table class="table i_table"><tbody><tr><th colspan="2" class="text-center B1">'+ZPI18N.getString("zp.checkin")+'</th></tr><tr><th class="text-center W50"><div class="Mauto">'+ZPI18N.getString("zp.old")+'</div></th><th class="text-center W50"><div class="Mauto">'+ZPI18N.getString("zp.new")+"</div></th></tr></tbody></table></th>",regularizationViewPage+='<th width="100" class="P0I TBrdr"><table class="table i_table"><tbody><tr><th colspan="2" class="text-center B1">'+ZPI18N.getString("zp.checkout")+'</th></tr><tr><th class="text-center W50"><div class="Mauto">'+ZPI18N.getString("zp.old")+'</div></th><th class="text-center W50"><div class="Mauto">'+ZPI18N.getString("zp.new")+"</div></th></tr></tbody></table></th>",regularizationViewPage+='<th width="100" class="P0I TBrdr"><table class="table i_table"><tbody><tr><th colspan="2" class="text-center B1">'+ZPI18N.getString("zp.hours")+'</th></tr><tr><th class="text-center W50"><div class="Mauto">'+ZPI18N.getString("zp.old")+'</div></th><th class="text-center W50"><div class="Mauto">'+ZPI18N.getString("zp.new")+"</div></th></tr></tbody></table></th>",regularizationViewPage+='<th width="210" class="P0I TBrdr"><table class="table i_table"><tbody><tr><th colspan="2" class="text-center B1">'+ZPI18N.getString("zp.status")+'</th></tr><tr><th class="text-center"><div class="W80 Mauto">'+ZPI18N.getString("zp.old")+'</div></th><th class="text-center"><div class="W80 Mauto">'+ZPI18N.getString("zp.new")+"</div></th></tr></tbody></table></th>",regularizationViewPage+='<th class="text-center B1 TBrdr" width="750" id="attendanceRegListHeader_Reason">'+ZPI18N.getString("zp.reason")+'</th><th class="text-center B1 TBrdr" width="750">'+ZPI18N.getString("zp.description")+'</th><th id="approveChkBox" width="230" class="text-center B1 TBrdr"><div id="regBulkApprovalRej" style="display:none"><i id="regAllApprove" title="Approve" class="IC-rou-tik grn S18" onClick="Attendance.Reg.allcheckAppRej(this,true);"></i></div><div id="regApprovalState">'+ZPI18N.getString("zp.approvalstatus")+'</div></th></tr></thead><tbody class="B0" id="attendanceRegListBody"></tbody></table></div></div><div class="modal-footer text-left ZPAprval" id="ZPAtt_Reg_AppHierarchy"><div class="Row"></div></div></div></div></div></div>',$(Layout.Page.container).append(regularizationViewPage)}$("#"+Layout.Page.pageId+" #attendanceRegListBody tr").remove(),ZPeople.BSModal.show($("#"+Layout.Page.pageId+" #"+popupTarget)),$("#"+Layout.Page.pageId+" #"+popupTarget).off("hidden.bs.modal"),$("#"+Layout.Page.pageId+" #"+popupTarget).on("hidden.bs.modal",function(){-1!==Layout.Page.hash.indexOf("attendance/regularization/viewmyrequest")?window.location.href="#attendance/regularization/myrequests":-1!==Layout.Page.hash.indexOf("attendance/regularization/viewmyapproval")?window.location.href="#attendance/regularization/myapprovals":-1!==Layout.Page.hash.indexOf("#approvals/myapproval")&&ZPUtil.Validation.isFunction(ZPApprovals.closePopCallback)?ZPApprovals.closePopCallback():ZPUtil.Validation.isFunction(closeCallBack)&&closeCallBack()}),ZPForm.LAYOUT=$("#"+Layout.Page.pageId+" #"+popupTarget),ZPForm.CURRFORM_PARAM={},formId||(formId=Layout.Page.childUrlParam.formId,recordId=Layout.Page.childUrlParam.recordId),Attendance.Reg.approvalSett||ZPApprovals.fetchApprovalSettings(formId,!1,Attendance.Reg.setApprovalSett),ZPApprovals.FORMID=formId,ZPApprovals.RECORDID=recordId,ZPForm.CURRFORM_PARAM.formId=formId,ZPForm.CURRFORM_PARAM.recordId=recordId,ZPForm.CURRFORM_PARAM.tableName="P_AttendanceReg",ZPApprovals.MODAL_CLASS="modal popRgtModel PopApModel PopApZI";var AppHierCont="<div class='col-sm-12 text-right PT8'>";AppHierCont+="<button type='button' name='approvalTypeBtn' class='btn btn-success ZpaprvrBtn RsltA DN'  approvaltype='1'  id='zp_appproval_approve_btn'> "+ZPI18N.getString("zp.approve")+" </button>",AppHierCont+="<button type='button'name='approvalTypeBtn' class='btn btn-danger ZpaprvrBtn RsltR DN'  approvaltype='0'  id='zp_appproval_reject_btn'> "+ZPI18N.getString("zp.rejectall")+" </button>",AppHierCont+="<button class='btn btn-cancel btn-default ML8 DN' id='cancelRegIndividual'> "+ZPI18N.getString("zp.cancelreg")+" </button>",AppHierCont+="<button type='button' data-dismiss='modal' class='btn btn-default cancel-model DN' id='closeRegIndividual'> "+ZPI18N.getString("zp.close")+" </button></div>",$("#"+Layout.Page.pageId+" #ZPAtt_Reg_AppHierarchy .Row").html(AppHierCont),$("#"+Layout.Page.pageId+" #attendanceRegListHeader").hide(),delete Attendance.Reg.approvalAttendDets;var param={mode:"getAttendanceDetails",recordId:recordId,formId:formId,conreqcsr:csrfToken};if(-1!==Layout.Page.hash.indexOf("attendance/regularization/viewmyrequest")){var filter=Layout.Page.container.find("#ZPAtt_regFilter");Attendance.Report.getEmpProfDateofExitFilter(filter,param,"myReqReg")}$.post("/AttendanceAction.zp",param,function(result){if(ZPForm.CONF.isadmin=isManageAttendanceData,result.approvalDetails&&(result.approvalDetails.isfromAttendence=!0),Attendance.Entry.currentApprover=!1,Attendance.Entry.isRecordOwner=!1,result.approvalDetails&&result.approvalDetails.isOwner&&(Attendance.Entry.currentApprover=!0),result.approvalDetails&&result.approvalDetails.recOwner&&(Attendance.Entry.isRecordOwner=!0,ZPForm.RecordApproval.CREATE_ERECNO=result.approvalDetails.recOwner,result.approvalDetails.recordowner.erecno&&(ZPForm.RecordApproval.OWNER_ERECNO=result.approvalDetails.recordowner.erecno)),result.details){var empName=result.details.employeeName+" - "+$("<div/>").text(result.details.employeeId).html(),dateHtml=result.details.startDate;result.details.endDate&&(dateHtml+='<span class="ZPuscr">-</span>'+result.details.endDate),$("#"+Layout.Page.pageId+" #ZPAtt_Reg_userName").html(empName),$("#"+Layout.Page.pageId+" #attendRegDispDate").html(dateHtml),Attendance.Reg.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceRegListHeader #regAllApprove"),"gry","grn",ZPI18N.getString("zp.approve")),$("#"+Layout.Page.pageId+" #regBulkApprovalRej").hide(),$("#"+Layout.Page.pageId+" #regApprovalState").show(),result.approvalDetails&&-1==result.approvalDetails.currentApprovalStatus&&Attendance.Entry.currentApprover&&($("#"+Layout.Page.pageId+" #regApprovalState").hide(),$("#"+Layout.Page.pageId+" #regBulkApprovalRej").show()),Attendance.Reg.isRegReasonsEnabled?Layout.Page.container.find("#attendanceRegListHeader #attendanceRegListHeader_Reason").show():Layout.Page.container.find("#attendanceRegListHeader #attendanceRegListHeader_Reason").hide(),$.each(result.details.regDetails,function(ind,regDetails){var oldIn=regDetails.intime?regDetails.intime:"-",oldOut=regDetails.outtime?regDetails.outtime:"-",newIn=regDetails.new_intime?regDetails.new_intime:"-",newOut=regDetails.new_outtime?regDetails.new_outtime:"-",reason=regDetails.reason?regDetails.reason:"-",desc=regDetails.desc?regDetails.desc:"-",regDetailsId=regDetails.regDetailsId?regDetails.regDetailsId:"",oldTotHrs="-"!==regDetails.totalHours?Attendance.disHours(regDetails.totalHours/60):regDetails.totalHours,regTableCons='<tr class="ZPLRow regRow"><td class="TBrdr"><div>'+regDetails.originday+"</div></td>";if(regTableCons+='<td class="P0I TBrdr"><table class="table i_table"><tbody><tr><td class="text-center"><div class="W80 Mauto">'+oldIn+'</div></td><td class="text-center"><div class="W80 Mauto">'+newIn+"</div></td></tr></tbody></table></td>",regTableCons+='<td class="P0I TBrdr"><table class="table i_table"><tbody><tr><td class="text-center"><div class="W80 Mauto">'+oldOut+'</div></td><td class="text-center"><div class="W80 Mauto">'+newOut+"</div></td></tr></tbody></table></td>",regTableCons+='<td class="P0I TBrdr"><table class="table i_table"><tbody><tr><td class="text-center"><div class="W50 Mauto">'+oldTotHrs+'</div></td><td class="text-center"><div class="W50 Mauto">'+Attendance.disHours(regDetails.new_totalHours/60)+"</div></td></tr></tbody></table></td>",regTableCons+='<td class="P0I TBrdr"><table class="table i_table"><tbody><tr><td class="text-center"><div class="W60 Mauto">'+Attendance.Reg.statI18nInReg(regDetails.att_status)+'</div></td><td class="text-center"><div class="W60 Mauto">'+Attendance.Reg.statI18nInReg(regDetails.new_status)+"</div></td></tr></tbody></table></td>",Attendance.Reg.isRegReasonsEnabled&&(regTableCons+='<td class="text-center TBrdr"><div>'+reason+"</div></td>"),regTableCons+='<td class="text-center TBrdr"><div>'+desc+"</div></td>",$("#"+Layout.Page.pageId+" #attendanceRegListHeader #approveChkBox").hide(),""!==regDetailsId)if($("#"+Layout.Page.pageId+" #attendanceRegListHeader #approveChkBox").show(),result.approvalDetails&&-1==result.approvalDetails.currentApprovalStatus&&Attendance.Entry.currentApprover){regTableCons+='<td class="text-center TBrdr">';var approveRejectClass="gry",approveRejectTitle=ZPI18N.getString("zp.reject");1==regDetails.status||-1==regDetails.status?(approveRejectClass="grn",approveRejectTitle=ZPI18N.getString("zp.approve")):Attendance.Reg.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceRegListHeader #regAllApprove"),"grn","gry",ZPI18N.getString("zp.reject")),regTableCons+='<i id="indApprRejSelect" title="'+approveRejectTitle+'" regId="'+regDetailsId+'" class="IC-rou-tik '+approveRejectClass+' S18" onClick="Attendance.Reg.allcheckAppRej(this);"></i></td>'}else result.approvalDetails&&void 0!=result.approvalDetails.canceledRecord&&1==result.approvalDetails.canceledRecord?regTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.cancelled")+"</td":1!=regDetails.status||Attendance.Entry.isRecordOwner&&1!=result.approvalDetails.currentApprovalStatus&&0!=result.approvalDetails.currentApprovalStatus?0!=regDetails.status||Attendance.Entry.isRecordOwner&&1!=result.approvalDetails.currentApprovalStatus&&0!=result.approvalDetails.currentApprovalStatus?8!=regDetails.status||Attendance.Entry.isRecordOwner&&8!=result.approvalDetails.currentApprovalStatus?regTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.waitingmsg")+"</td":regTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.deleted")+"</td":regTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.rejected")+"</td":regTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.approved")+"</td";$("#"+Layout.Page.pageId+" #attendanceRegListBody").append(regTableCons)}),$("#"+Layout.Page.pageId+" #attendanceRegListHeader").show(),void 0!=result.details.isCancelPermitted&&1==result.details.isCancelPermitted&&Layout.Page.container.find("#cancelRegIndividual").removeClass("DN"),void 0!=result.details.isClosePermitted&&1==result.details.isClosePermitted&&Layout.Page.container.find("#closeRegIndividual").removeClass("DN"),Layout.Page.container.find("#cancelRegIndividual").on("click",function(){Attendance.Reg.cancelRegWarning(result)}),Attendance.Reg.approvalAttendDets=result;var otherDetails={isfromAttendence:!0};Attendance.Reg.approvalSett&&ZPApprovals.initApprovalSettings({approvalSettingsDetails:Attendance.Reg.approvalSett}),ZPApprovals.showApprovalHeader(result.approvalDetails.currentApprovalStatus,result.isRecordApprover,!!result.approvalDetails.isPrimaryAppr&&result.approvalDetails.isPrimaryAppr,otherDetails,result.approvalDetails)}else $("#"+Layout.Page.pageId+" #ZPAtt_Reg_Details div.modal-body ").empty().append('<div class="ZPNdata"><i id="norecfoundimg"></i><p class="no-para"><br>'+ZPI18N.getString("zp.norec")+"<br></p></div>"),Attendance.noDataImg(8,"CR-nodata",Layout.Page.container.find(".ZPNdata #norecfoundimg"))})},cancelRegWarning:function(result){ZPeople.BSModal.setup({id:"zp_confirmation_pop",type:1,header:'<div class="Icn grni"><i class="IC-tick whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.confirm")+"</h4>",body:'<div class="form-group"><p class="text-center MB15">'+ZPI18N.getString("zp.confirmregcancel")+'</p></div><div class="form-group" id="cancel_reason" style="height:90px"><div class="col-sm-12"><textarea class="form-control ZP-Input mandatory" style="width: 340px;margin: 0 auto;" name="remark" rows="5" placeholder="Reason For Cancellation"></textarea><span class="ERR text-center MT5 DN" id="cancel_reason_error" style="width: 100%;"></span></div></div>',modalClass:"modal fade ZPmdl in",buttonValue:ZPI18N.getString("zp.confirm"),successCallback:function(){Attendance.Reg.cancelReg(result.details.recordId)},hiddenCallback:ZPApprovals.approveOrRejectActionHidden}).find(".btn-default").text(ZPI18N.getString("zp.cancel"))},removeAndAddClass:function(obj,classToBeRemoved,classToBeAdded,titleToBeChanged){void 0===classToBeRemoved&&""===classToBeRemoved||$(obj).removeClass(classToBeRemoved),void 0===classToBeAdded&&""===classToBeAdded||$(obj).addClass(classToBeAdded),void 0===titleToBeChanged&&""===titleToBeChanged||$(obj).attr("title",titleToBeChanged)},allcheckAppRej:function(obj,isAllChanged){var grayColorTitle=ZPI18N.getString("zp.reject"),greenColorTitle=ZPI18N.getString("zp.approve");isAllChanged?$(obj).hasClass("grn")?(Attendance.Reg.removeAndAddClass(obj,"grn","gry",grayColorTitle),Attendance.Reg.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceRegListBody tr #indApprRejSelect"),"grn","gry",grayColorTitle)):(Attendance.Reg.removeAndAddClass(obj,"gry","grn",greenColorTitle),Attendance.Reg.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceRegListBody tr #indApprRejSelect"),"gry","grn",greenColorTitle)):($(obj).hasClass("grn")?Attendance.Reg.removeAndAddClass(obj,"grn","gry",grayColorTitle):Attendance.Reg.removeAndAddClass(obj,"gry","grn",greenColorTitle),$("#"+Layout.Page.pageId+" #attendanceRegListBody tr #indApprRejSelect.grn").length===$("#"+Layout.Page.pageId+" #attendanceRegListBody tr #indApprRejSelect").length?Attendance.Reg.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceRegListHeader #regAllApprove"),"gry","grn",greenColorTitle):Attendance.Reg.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceRegListHeader #regAllApprove"),"grn","gry",grayColorTitle))},appRejRegDetails:function(type,isAllLevelApprove,comment,regId,apprAct){var regIdSelList=[],isUpdationNeeded=!1,appAttDet=Attendance.Reg.approvalAttendDets;if(appAttDet&&appAttDet.details&&appAttDet.details.regDetails&&appAttDet.details.regDetails.length>0){if(appAttDet.details.regDetails[0].regDetailsId&&(isUpdationNeeded=!0),1==apprAct?(regIdSelList.push(regId),isUpdationNeeded=!1):$("#"+Layout.Page.pageId+" #attendanceRegListBody tr #indApprRejSelect").each(function(){$(this).hasClass("grn")&&1==type&&regIdSelList.push($(this).attr("regid"))}),1==type&&0===regIdSelList.length&&isUpdationNeeded)return $("#"+Layout.Page.pageId).find("[name='approvalBtn']").attr("disabled",!1),Layout.Page.container.find("#zp_approvereject_box").show(),Layout.Page.container.find("#zp_approval_confirm_btn").removeClass("disabled"),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectatleastoneregtoapprove"));var param={mode:"addAppStatusInRegDets",conreqcsr:csrfToken};param.recId=ZPForm.CURRFORM_PARAM.recordId,param.isUpdationNeeded=isUpdationNeeded,regIdSelList.length>0&&(param.regIdSelList=JSON.stringify(regIdSelList)),param.approvalStatus=type,param.isAllLevelApprove=isAllLevelApprove,param.comment=comment,param.formId=ZPForm.CURRFORM_PARAM.formId,$.post("/AttendanceAction.zp",param,function(rdata){if(!rdata.success&&1==rdata.errorCode)return Layout.Page.container.find("#zp_approvereject_box").find("#zp_approval_confirm_btn").removeClass("disabled"),Layout.Page.container.find("#ZPAtt_Reg_AppHierarchy").find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").show(),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.record.approval.immutableinfo"));ZPApprovals.approveRejectDtlCallBack(rdata,param),void 0!=rdata&&void 0!=rdata.approvalJson&&void 0!=rdata.approvalJson.processed&&1==rdata.approvalJson.processed[0].approvalStatus&&Layout.Page.container.find("#cancelRegIndividual").removeClass("DN"),Layout.Page.container.find("#closeRegIndividual").addClass("DN")})}},formId:null,regConfInfolist:null,getRegConfInfolist:function(){var param={mode:"fetchApprovals",formName:"P_AttendanceReg",conreqcsr:csrfToken};Attendance.toggleLoadingDiv(!1,$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_Reg"),$(Attendance.Settings.LayoutId+" #ZPAtt_SettReg_emptyRecInfo")),$.post("/AttendanceSettingsAction.zp",param,function(rdata){Attendance.Reg.regConfInfolist=rdata,Attendance.Reg.consRegConfInfolist()})},consRegConfInfolist:function(){for(var rdata=Attendance.Reg.regConfInfolist,txt="",i=0;i<rdata.list.length;i++){var data=rdata.list[i];data&&data.FORMID?(Attendance.Reg.formId=data.FORMID,txt+='<tr  class="ZPLRow" id="approval_'+data.FORM_TEMPLATE_ACTION_ID+'" approvalId="'+data.FORM_TEMPLATE_ACTION_ID+'"  >',txt+="<td class='CP' onclick=Attendance.Reg.editApproval(\""+data.FORM_TEMPLATE_ACTION_ID+'","'+Attendance.Reg.formId+'");>'+data.TEMPLATE_NAME+"</td>",txt+="<td>"+data.SUBJECT+"</td>",txt+='<td><div class="btnactive"><input type="checkbox" onclick="ApprovalProcess.enableDisable(\''+data.FORM_TEMPLATE_ACTION_ID+"','"+Attendance.Reg.formId+'\');" class="cmn-toggle-small cmn-toggle-round-small" id="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"',data.ISACTIVE&&(txt+=" checked"),txt+='><label class="M0" for="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"></label></div></td>',txt+="<td class='text-right P0I'><div id='ZPAtt_SettReg_delAction' class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_SettReg_delConfirm','table-responsive')></i><i class='IC-pen S14 gry FR MR15 CP' onclick=Attendance.Reg.editApproval(\""+data.FORM_TEMPLATE_ACTION_ID+'","'+Attendance.Reg.formId+'");></i></div>',txt+="<div style='display:none' id='ZPAtt_SettReg_delConfirm'>",txt+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_SettReg_delAction','table-responsive')>"+ZPI18N.getString("zp.cancel")+"</button>",txt+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=Attendance.Reg.deleteApproval(\""+Attendance.Reg.formId+'","'+data.FORM_TEMPLATE_ACTION_ID+'")>'+ZPI18N.getString("zp.confirm")+"</button></div>",txt+="</td><td></td>",txt+="</tr>"):data&&data.newformid&&(Attendance.Reg.formId=data.newformid)}if($(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDetBody").html(txt),0===$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDetBody").children().length){$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDet").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_SettReg_emptyRecInfo").fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_Reg").removeClass("section");var empImg=Layout.Page.container.find("#ZPAtt_SettReg_emptyRecInfo i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-set-regularization",empImg)}else $(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDet").parent().fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_SettReg_emptyRecInfo").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_Reg").attr("class","Scrcont section");Attendance.toggleLoadingDiv(!0),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDet").parent().hasClass("tabcont")||ZPView.handleTablePosition()},editApproval:function(approvalId,formId){ApprovalProcess.getApprovalRow(approvalId,formId,Attendance.Reg.getRegConfInfolist)},deleteApproval:function(formId,approvalId){var params={formTemplateId:approvalId,formId:formId,method:"deleteApproval",conreqcsr:csrfToken};$.post("/deleteApproval.zp",params,function(resultData){"success"===resultData.result?$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDetBody").find("#approval_"+approvalId).fadeOut("fast",function(){$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDetBody").find("#approval_"+approvalId).remove(),0===$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDetBody").find("tr").length&&($(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDet").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_SettReg_emptyRecInfo").fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_Reg").removeClass("section"),0===$("ZPAtt_SettReg_emptyRecInfo div").children().length&&ZPUtil.noDataSVG("ZPAtt_SettReg_emptyRecInfo div",ZPeople.getResourceURL(newUIImageUrl+"svg/no-data.svg"))),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.approvalconfigdeletionsuccess"))}):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.recordnotfound"))})},getTotalHoursBasedOnShift:function(shiftAllowedTimings,regFromTime,regToTime){var isFromCurDay=!0,isToCurDay=!0;regFromTime<shiftAllowedTimings.shiftAllowedFromTime&&(isFromCurDay=!1),(regToTime<shiftAllowedTimings.shiftAllowedFromTime||isFromCurDay&&regFromTime>regToTime)&&(isToCurDay=!1);var totalHours=isFromCurDay&&!isToCurDay?1440-regFromTime+regToTime:regToTime-regFromTime;return totalHours<0?0:totalHours},regFILOChanged:function(tmpDateObj,obj){var tableRow=$(obj).closest("tr"),regFromTime=tableRow.find("#ZPAtt_reg_fromTime").val().trim(),regToTime=tableRow.find("#ZPAtt_reg_toTime").val().trim(),attDate=tableRow.attr("id"),maxDt=Calendar.parseDate(attDate,uidateFormat);maxDt.setDate(maxDt.getDate()+1);var nextDate=Calendar.formatDate(maxDt);if(tableRow.find("#reg_errorMsg").remove(),tableRow.find("#reg_errorMsg_to").remove(),tableRow.css("height","44px"),tableRow.find("#ZPAtt_reg_totalHours").html(""),tableRow.find("#ZPAtt_reg_Explain").hide(),""!==regFromTime){var regFormatTime=regFromTime.split(" ")[1]+" "+regFromTime.split(" ")[2],regFromHours=parseInt(regFormatTime.split(":")[0],10),regFromMin=parseInt(regFormatTime.split(":")[1],10),invalidFromTime=!1;if(invalidFromTime=Attendance.timeFormatIs12hr?regFromHours>12||invalidFromTime:regFromHours>23||invalidFromTime,invalidFromTime=regFromMin>60||invalidFromTime)return tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="reg_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.attendance.regInvalidFromEntry")+"</span>")}if(""!==regToTime){regFormatTime=regToTime.split(" ")[1]+" "+regToTime.split(" ")[2];var regToHours=parseInt(regFormatTime.split(":")[0],10),regToMin=parseInt(regFormatTime.split(":")[1],10),invalidToTime=!1;if(invalidToTime=Attendance.timeFormatIs12hr?regToHours>12||invalidToTime:regToHours>23||invalidToTime,invalidToTime=regToMin>60||invalidToTime)return tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(1).find("div").append('<span id="reg_errorMsg_to" class="attRegErr">'+ZPI18N.getString("zp.attendance.regInvalidToEntry")+"</span>")}if(""!==regFromTime&&""!==regToTime){var regFromDate=new Date(regFromTime.split(" ")[0]),regToDate=new Date(regToTime.split(" ")[0]);if(regFromDate<new Date(attDate)||regFromDate>new Date(nextDate))return tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="reg_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.attendance.regInvalidDate")+"</span>");if(regToDate<new Date(attDate)||regToDate>new Date(nextDate))return tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(1).find("div").append('<span id="reg_errorMsg_to" class="attRegErr">'+ZPI18N.getString("zp.attendance.regInvalidDate")+"</span>");if(regFromTime=regFromTime.split(" ")[1]+" "+regFromTime.split(" ")[2],regToTime=regToTime.split(" ")[1]+" "+regToTime.split(" ")[2],regFromTime=Attendance.Common.convertTimerInputToMinsOrSecs(regFromTime),regToTime=Attendance.Common.convertTimerInputToMinsOrSecs(regToTime),regToDate>regFromDate&&regToTime>regFromTime)return tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="reg_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.timeexceeded24")+"</span>");if(regFromDate==regToDate&&regToTime<regFromTime||regFromDate>regToDate)return tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="reg_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.inshouldbebeforeout")+"</span>");regFromDate<regToDate&&(regToTime+=1440);var regDets=Attendance.Reg.getDayRecordJson.regDetails[attDate];if(regDets.isAutoBreakConf)Attendance.Reg.getTotHrsExcludingAutoBreaks(regFromTime,regToTime,attDate,tableRow);else{var shiftAllowedTimings=regDets.shiftAllowedTimings,totalHours=Attendance.Reg.getTotalHoursBasedOnShift(shiftAllowedTimings,regFromTime,regToTime),payHours=totalHours;regDets.isNewBreakConf||(payHours-=regDets.breakTime)<0&&(payHours=0),tableRow.find("#ZPAtt_reg_totalHours").html(Attendance.disHours(parseInt(totalHours),!0))}}},getTotHrsExcludingAutoBreaks:function(regFromTime,regToTime,attendDate,tableRow){var param={mode:"excludeAutoBreaksForReg"};param[csrfParamName]=csrfToken;var input={};input.regFromTime=regFromTime,input.regToTime=regToTime,input.attendDate=attendDate,($(Attendance.Entry.LayoutId+" #ZPAtt_tabView").is(":visible")||$(Attendance.Entry.LayoutId+" #ZPAtt_listView").is(":visible"))&&null!==Attendance.Entry.erecno?input.erecno=Attendance.Entry.erecno:isManageAttendanceData&&$("#"+Layout.Page.pageId+" #ZPAtt_AddReq_FilEmployee").val()&&"0"!==$("#"+Layout.Page.pageId+" #ZPAtt_AddReq_FilEmployee").val()?input.erecno=$("#"+Layout.Page.pageId+" #ZPAtt_AddReq_FilEmployee").select2("val"):input.erecno=erecno,param.input=JSON.stringify(input),$.post("/AttendanceAction.zp",param,function(rdata){void 0!=rdata.totalHours&&tableRow.find("#ZPAtt_reg_totalHours").html(Attendance.disHours(parseInt(rdata.totalHours/60),!0))})},getDayRecordJson:null,getAttFiloInfo:function(isDateRangeChanged){var param={mode:"getAttFiloInfo",conreqcsr:csrfToken,isAddRegRequest:!0};if($("#"+Layout.Page.pageId+" #attRegTableBody").hide(),"attendance-regularization-myrequests"===Layout.Page.pageId){var bothDaysValidCase=""!==$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDate").val()&&""!==$("#"+Layout.Page.pageId+" #ZPAtt_reg_fromDate").val();if(!0!==isDateRangeChanged&&!bothDaysValidCase)return;if(!0!==isDateRangeChanged)param.fromDate=$("#"+Layout.Page.pageId+" #ZPAtt_reg_fromDate").val(),$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDateDiv").is(":visible")||$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDate").val(param.fromDate),$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDate").val()!==param.fromDate&&(param.toDate=$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDate").val());else{if(param.rangeType=$("#"+Layout.Page.pageId+" #ZPAtt_reg_DateRange").val(),0==param.rangeType)$("#"+Layout.Page.pageId+" #ZPAtt_reg_fromDate").attr("disabled",!1);else{if(3==param.rangeType)return $("#"+Layout.Page.pageId+" #ZPAtt_reg_fromDate").attr("disabled",!1),$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDate").attr("disabled",!1),$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDateDiv").show(),void $("#"+Layout.Page.pageId+" #attRegTableBody").show();$("#"+Layout.Page.pageId+" #ZPAtt_reg_fromDate").attr("disabled",!0),$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDate").attr("disabled",!0)}1==param.rangeType&&(param.weekStarts=weekstarts)}"0"!==$("#"+Layout.Page.pageId+" #ZPAtt_AddReq_FilEmployee").select2("val")?param.erecno=$("#"+Layout.Page.pageId+" #ZPAtt_AddReq_FilEmployee").select2("val"):param.erecno=erecno,$("#"+Layout.Page.pageId+" #attRegTableBody").hide()}else null!==Attendance.Entry.erecno?param.erecno=Attendance.Entry.erecno:param.erecno=erecno,param.fromDate=$("#"+Layout.Page.pageId+" #ZPAtt_reg_regDate").val(),param.toDate=param.fromDate,$("#"+Layout.Page.pageId+" #ZPAtt_reg_fromTime").val(""),$("#"+Layout.Page.pageId+" #ZPAtt_reg_toTime").val("");$.post("/AttendanceAction.zp",param,function(rdata){if(rdata.dateError){"attendance-regularization-myrequests"===Layout.Page.pageId&&$("#"+Layout.Page.pageId+" #attRegTableBody").hide();var errorMsg="zp.datewithinonemonth";"lesserFromDate"==rdata.dateError&&(errorMsg="zp.greaterfromdate"),ZPeople.Message.showFailureMsg(ZPI18N.getString(errorMsg))}else rdata.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")):rdata.regDetails&&("attendance-regularization-myrequests"===Layout.Page.pageId?(Attendance.Reg.getDayRecordJson=rdata,Attendance.Reg.consRegPopup(isDateRangeChanged,rdata.isPopulateReqd)):(Attendance.Entry.getDayRecordJson=rdata,Attendance.Entry.consRegPopup()))})},consRegPopup:function(isDateRangeChanged,isPopulateReqd){$("#"+Layout.Page.pageId+" #attRegTableBody tr:gt(0)").remove();var dayList=Attendance.Reg.getDayRecordJson.regDetails.dayList;for(var i in $("#"+Layout.Page.pageId+" #ZPAtt_reg_fromDate").val(Attendance.Reg.getDayRecordJson.regDetails.startDate),$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDate").val(Attendance.Reg.getDayRecordJson.regDetails.endDate),!0===isDateRangeChanged&&Attendance.Reg.getDayRecordJson.regDetails.endDate==Attendance.Reg.getDayRecordJson.regDetails.startDate?($("#"+Layout.Page.pageId+" #ZPAtt_reg_toDateDiv").hide(),$("#"+Layout.Page.pageId+" #ZPAtt_reg_fromDate").attr("placeholder","")):!0===isDateRangeChanged&&($("#"+Layout.Page.pageId+" #ZPAtt_reg_toDateDiv").show(),$("#"+Layout.Page.pageId+" #ZPAtt_reg_fromDate").attr("placeholder",ZPI18N.getString("zp.from"))),dayList){var attDataForDay=Attendance.Reg.getDayRecordJson.regDetails[dayList[i]],row=$("#"+Layout.Page.pageId+" #attDetailsListRow").clone(),colorClass="";attDataForDay.isPaidLeave?colorClass+=" leave-border":attDataForDay.isUnPaidLeave?colorClass+=" lop-border":attDataForDay.isOnDuty?colorClass+=" onduty-border":attDataForDay.isWeekend?colorClass+=" wkend-border":attDataForDay.isHoliday?colorClass+=" holiday-border":attDataForDay.isAbsent&&(colorClass+=" absent-border"),$(row).find('[borderTag="true"]').addClass(colorClass),$(row).find("#monthDateValue").text(attDataForDay.dispMonthDate),$(row).find("#dayValue").text(attDataForDay.dispDay),$(row).find("#attRegDateDiv").attr("date_orgformat",dayList[i]),$(row).find("#ZPAtt_reg_fromTime").off("change").on("change",function(){Attendance.Reg.regFILOChanged(null,this)}),$(row).find("#ZPAtt_reg_toTime").off("change").on("change",function(){Attendance.Reg.regFILOChanged(null,this)});var minDt=Calendar.parseDate(dayList[i],uidateFormat),maxDt=Calendar.parseDate(dayList[i],uidateFormat);maxDt.setDate(maxDt.getDate()+1);var settingsObjStr='{mindate:"'+minDt+'",maxdate:"'+maxDt+'",selectedDate:"'+minDt+'"}',tempVal="";if(attDataForDay.fromdate&&(tempVal=dayList[i]+" "+attDataForDay.fromdate,attDataForDay.fDate&&(tempVal=attDataForDay.fDate+" "+attDataForDay.fromdate),tempVal+=Attendance.timeFormatIs12hr?"":":00"),$(row).find("#ZPAtt_reg_fromTime").val(tempVal),attDataForDay.todate)if(attDataForDay.fromdate){var regFromTime=Attendance.Common.convertTimerInputToMinsOrSecs(tempVal.split(" ")[1]+" "+tempVal.split(" ")[2]);tempVal=dayList[i]+" "+attDataForDay.todate,attDataForDay.tDate&&(tempVal=attDataForDay.tDate+" "+attDataForDay.todate),tempVal+=Attendance.timeFormatIs12hr?"":":00",Attendance.Common.convertTimerInputToMinsOrSecs(tempVal.split(" ")[1]+" "+tempVal.split(" ")[2])<regFromTime&&(tempVal=Calendar.formatDate(maxDt)+" "+attDataForDay.todate,tempVal+=Attendance.timeFormatIs12hr?"":":00")}else tempVal=dayList[i]+" "+attDataForDay.todate,tempVal+=Attendance.timeFormatIs12hr?"":":00";if($(row).find("#ZPAtt_reg_toTime").val(tempVal),$(row).find("#ZPAtt_reg_fromTime").attr("onclick","Calendar.setUpCalendar(event, this,1,undefined,Attendance.Reg.regFILOChanged,undefined,"+settingsObjStr+");"),$(row).find("#ZPAtt_reg_toTime").attr("onclick","Calendar.setUpCalendar(event, this,1,undefined,Attendance.Reg.regFILOChanged,undefined,"+settingsObjStr+");"),Attendance.Reg.isRegReasonsEnabled){Layout.Page.container.find("#attRegTable").find("#header1").addClass("zp_mdt").html("<font>"+ZPI18N.getString("zp.reason")+"</font>"),Layout.Page.container.find("#attRegTable").find("#header2").html(ZPI18N.getString("zp.description"));var txt='<div class="form-group"><div class="col-sm-12 P0"><select class="select2-container W300A" id="reg_req_reason">';txt+='<option value="-1">'+$("<div/>").text(ZPI18N.getString("zp.select")).html()+"</option>",$.each(Attendance.Reg.regReasons,function(index,data){txt+='<option value="'+index+'">'+$("<div/>").text(data).html()+"</option>"}),txt+="</select></div></div>",$(row).find("#reg_req_reasonanddesc1").addClass("PR"),$(row).find("#reg_req_reasonanddesc1").html(txt),void 0!=isPopulateReqd&&1==isPopulateReqd&&$(row).find("#reg_req_reason").on("change",function(e){Attendance.Reg.autoPopulateOtherValidEntries(e,dayList)}),$(row).find("#reg_req_reasonanddesc2").html('<textarea rows="1" class="form-control" id="reg_req_desc" placeholder="'+ZPI18N.getString("zp.description")+'"></textarea>')}else Layout.Page.container.find("#attRegTable").find("#header1").html(ZPI18N.getString("zp.description")),Layout.Page.container.find("#attRegTable").find("#header2").html(""),$(row).find("#reg_req_reasonanddesc1").html('<textarea rows="1" class="form-control" id="reg_req_desc" placeholder="'+ZPI18N.getString("zp.description")+'"></textarea>');$(row).find("select").select2({minimumResultsForSearch:5}),$(row).attr("id",dayList[i]),$(row).show(),attDataForDay.totalhrs>=0?$(row).find("#ZPAtt_reg_totalHours").html(Attendance.disHours(parseInt(attDataForDay.totalhrs/60),!0)):Attendance.Reg.regFILOChanged(null,row),$("#"+Layout.Page.pageId+" #attRegTableBody").append(row)}$("#"+Layout.Page.pageId+" #attRegTableBody").fadeIn()},autoPopulateOtherValidEntries:function(e,dayList){var index=$(e.target).closest("tr").index()-1,val=e.val,len=dayList.length,attRegTableBody=Layout.Page.container.find("#attRegTableBody"),isPreviousInvalid=!0,reached=!1;if(!Attendance.Reg.isRegularisationEntryInValid($(attRegTableBody.find("tr")[index+1])))for(j=0;j<len;j++){var row=$(attRegTableBody.find("tr")[j+1]),isCurrentInvalid=Attendance.Reg.isRegularisationEntryInValid(row),isCurrenEntryFilled=Attendance.Reg.isRegularisationEntryFilled(row);index==j?!isCurrentInvalid&&isPreviousInvalid&&(reached=!0,row.find("#reg_req_reason").val(val).select2()):reached&&index<j&&!isCurrentInvalid&&!isCurrenEntryFilled&&row.find("#reg_req_reason").val(val).select2(),isPreviousInvalid=isPreviousInvalid&&isCurrentInvalid}},isRegularisationEntryInValid:function(row){var currFromDate=row.find("#ZPAtt_reg_fromTime").val(),currToDate=row.find("#ZPAtt_reg_toTime").val();return""==currFromDate||void 0==currFromDate||""==currToDate||void 0==currToDate},isRegularisationEntryFilled:function(row){return"-1"!=row.find("#reg_req_reason").val()},resetRegPopup:function(obj,date){$("#"+Layout.Page.pageId+" #ZPAtt_reg_toDate").val(""),$("#"+Layout.Page.pageId+" #ZPAtt_reg_DateRange").val("0").trigger("change"),$("#"+Layout.Page.pageId+" #ZPAtt_reg_fromDate").val("")},showReqAddPopup:function(obj,date){var layout=Layout.Page.container;ZPeople.BSModal.show($(Attendance.Reg.LayoutId+" #addRegularizationPage")),layout.find("#ZPAtt_AddReq_FilEmployee").parent().parent().show(),Attendance.consResetEmpSearch("ZPAtt_myReqReg_empName",layout,!1,!0),Attendance.consResetEmpSearch("ZPAtt_AddReq_FilEmployee",layout,!0,!1),layout.find("#addRegularizationPage").find("#ZPAtt_reg_chooseAppr").hide(),layout.find("#addRegularizationPage").find("#emptyErrMsg").html(""),layout.find("#addRegularizationPage").find("#emptyErrMsg").removeClass("MB10"),isEmpChooseApp&&(layout.find("#addRegularizationPage").find("#ZPAtt_reg_approverId").parent().parent().show(),layout.find("#addRegularizationPage").find("#ZPAtt_reg_approverId").empty(),layout.find("#addRegularizationPage").find("#ZPAtt_reg_approverId").append(ZPeople.User.getEmployeeListFormatByType("option")),layout.find("#addRegularizationPage").find("#ZPAtt_reg_approverId").select2()),Attendance.Reg.resetRegPopup(obj,date)},getEmpChosenApprErecno:function(layout){layout.find("#emptyErrMsg").removeClass("MB10"),layout.find("#emptyErrMsg").html("");var appErecno=layout.find("#ZPAtt_reg_approverId").val();return"-Select-"===appErecno&&(layout.find("#emptyErrMsg").addClass("MB10"),layout.find("#emptyErrMsg").html(ZPI18N.getString("zp.chooseapprovererrormsg"))),appErecno}},Attendance.RegImport={showImport:function(){ZPeople.BSModal.show($("#"+Layout.Page.pageId+" #ZPAtt_reg_importPopup"));var regImportParent=Layout.Page.container.find("#ZPAtt_reg_importPopup");regImportParent.find("#ZPAtt_reg_importSuccMsg").hide(),regImportParent.find("#ZPAtt_reg_importSuccvalues").hide(),regImportParent.find("#ZPAtt_reg_import").parent().parent().removeAttr("class"),regImportParent.find("#ZPAtt_reg_import").fadeIn(300),regImportParent.find("#ZPAtt_reg_impEx").fadeIn(300),regImportParent.find("#ZPAtt_reg_importFileConf").hide(),regImportParent.find("#ZPAtt_reg_importMap").hide(),regImportParent.find("#ZPAtt_reg_importInput").val(""),regImportParent.find("#ZPAtt_reg_importDesc").after(regImportParent.find("#ZPAtt_reg_importInputCont").show()),regImportParent.find("#ZPAtt_reg_importInputCont span").text(ZPI18N.getString("zp.importfile")),regImportParent.find("#ZPAtt_reg_importInputCont").attr("class","btn btn-primary ZPbtnDefault"),regImportParent.find("#ZPAtt_reg_importNext").hide(),regImportParent.find("#ZPAtt_reg_importPrevious").hide(),regImportParent.find("#ZPAtt_reg_importHeader li").first().attr("class","active"),regImportParent.find("#ZPAtt_reg_importHeader li").last().removeAttr("class"),Layout.Page.container.find("#ZPAtt_reg_importPopup .modal-body").find("#zp_page_loading").remove(),Layout.Page.container.find("#ZPAtt_reg_importPopup .modal-body").children().show(),Attendance.RegImport.getPendingImport(),Layout.Page.container.find("#importErrDiv").hide()},onInputChange:function(){var regImportParent=Layout.Page.container.find("#ZPAtt_reg_importPopup"),fileName=regImportParent.find("#ZPAtt_reg_importInput").val();regImportParent.find("#ZPAtt_reg_importProgress").hide(),regImportParent.find("#ZPAtt_reg_importProgress").next().show(),fileName=fileName.replace("C:\\fakepath\\",""),regImportParent.find("#ZPAtt_reg_importFName").text(fileName),regImportParent.find("#ZPAtt_reg_importSuccMsg").hide(),regImportParent.find("#ZPAtt_reg_importSuccvalues").hide(),regImportParent.find("#ZPAtt_reg_importProgress").after(regImportParent.find("#ZPAtt_reg_importInputCont")),regImportParent.find("#ZPAtt_reg_importInputCont span").text(ZPI18N.getString("zp.removeandnew")),regImportParent.find("#ZPAtt_reg_importInputCont").attr("class","btn btn-default ZPbtnDefault");var extn=fileName.split(".").pop();"xls"===extn||"csv"===extn?(regImportParent.find("#ZPAtt_reg_importFName").next().attr("class","IC-rou-tik ML5 filetck"),regImportParent.find("#ZPAtt_reg_importNext").fadeIn(300),Layout.Page.container.find("#ZPAtt_reg_importNext").attr("disabled",!1),regImportParent.find("#ZPAtt_reg_importNext").off("click").on("click",function(){Attendance.RegImport.submitImport()})):(regImportParent.find("#ZPAtt_reg_importFName").next().attr("class","IC-r-close ML5 PR S18 red"),regImportParent.find("#ZPAtt_reg_importNext").hide(),regImportParent.find("#ZPAtt_reg_importInput").val(""),""===regImportParent.find("#ZPAtt_reg_importFName").text()&&regImportParent.find("#ZPAtt_reg_importFName").text(ZPI18N.getString("zp.choosefile"))),regImportParent.find("#ZPAtt_reg_import").hide(),regImportParent.find("#ZPAtt_reg_impEx").hide(),regImportParent.find("#ZPAtt_reg_importFileConf").fadeIn(300),regImportParent.find("#ZPAtt_reg_importMap").hide()},submitImport:function(){var regImportParent=Layout.Page.container.find("#ZPAtt_reg_importPopup");regImportParent.find("#ZPAtt_reg_importNext").off("click"),Attendance.RegImport.ProgressBarWidth=0,regImportParent.find("#ZPAtt_reg_importProgress").next().hide(),regImportParent.find("#ZPAtt_reg_importProgress div").width(Attendance.RegImport.ProgressBarWidth+"%").parent().show(),Attendance.RegImport.showProgress(regImportParent);var form=regImportParent.find("#ZPAtt_reg_importInput")[0].form;""!==regImportParent.find("#ZPAtt_reg_importInput").val()&&(Layout.Page.container.find("#ZPAtt_reg_importNext").attr("disabled",!0),Layout.Page.container.find("#ZPAtt_reg_importFormCsrf").val(csrfToken),form.action="AttendanceImport.zp",form.submit())},ProgressBarWidth:0,showProgress:function(){Layout.Page.container.find("#ZPAtt_reg_importPopup").find("#ZPAtt_reg_importProgress div").width(Attendance.RegImport.ProgressBarWidth+"%"),Attendance.RegImport.ProgressBarWidth+=2,Attendance.RegImport.ProgressBarWidth<=99&&setTimeout(Attendance.RegImport.showProgress,1)},getPendingImport:function(){var regImportParent=Layout.Page.container.find("#ZPAtt_reg_importPopup"),pendingMsg=regImportParent.find("#ZPAtt_reg_importMsg");pendingMsg.parent().hide();var param={mode:"getPendingImportInfo",conreqcsr:csrfToken,type:"RegMyRequest"};$.post("/AttendanceAction.zp",param,function(rdata){"empty"===rdata.tableInfo.tableHeaders?(pendingMsg.off("click"),pendingMsg.html(""),pendingMsg.parent().hide()):(pendingMsg.attr("class","blu CP"),pendingMsg.off("click").on("click",function(){Attendance.RegImport.showMapping(rdata.tableInfo,regImportParent)}),pendingMsg.html(rdata.tableInfo.recordCount+" "+ZPI18N.getString("zp.recordspending")),pendingMsg.parent().fadeIn(300))})},showMapping:function(obj){var regImportParent=Layout.Page.container.find("#ZPAtt_reg_importPopup");regImportParent.find("#ZPAtt_reg_importNext").attr("disabled",!1),regImportParent.find("#ZPAtt_reg_import").hide(),regImportParent.find("#ZPAtt_reg_impEx").hide(),regImportParent.find("#ZPAtt_reg_importFileConf").hide(),regImportParent.find("#ZPAtt_reg_importMap").fadeIn(300),regImportParent.find("#ZPAtt_reg_importPrevious").fadeIn(300),regImportParent.find("#ZPAtt_reg_importNext").fadeIn(300),regImportParent.find("#ZPAtt_reg_importHeader li").last().attr("class","active"),regImportParent.find("#ZPAtt_reg_importNext").off("click").on("click",function(){Attendance.RegImport.submitRegMapping(obj.fileFormat,regImportParent)}),regImportParent.find("#ZPAtt_reg_importReason").show(),Attendance.Reg.isRegReasonsEnabled||regImportParent.find("#ZPAtt_reg_importReason").hide();var rArray=obj.tableHeaders,res="<option value='None' selected='selected'>-- "+ZPI18N.getString("zp.select")+" --</option>";for(var i in rArray)res+="<option value='"+i+"'>"+rArray[i]+"</option>";if(regImportParent.find("#ZPAtt_reg_importMap select").select2(),-1!==Layout.Page.hash.indexOf("attendance/regularization/myrequests"))for(var i in"csv"!==obj.fileFormat?regImportParent.find("#ZPAtt_reg_importDateFor sup").hide():regImportParent.find("#ZPAtt_reg_importDateFor sup").show(),regImportParent.find("#ZPAtt_reg_importDateFor select").select2("val","0"),regImportParent.find("#ZPAtt_reg_importIds select").html(res),regImportParent.find("#ZPAtt_reg_importDate select").html(res),regImportParent.find("#ZPAtt_reg_importCheckIn select").html(res),regImportParent.find("#ZPAtt_reg_importCheckOut select").html(res),regImportParent.find("#ZPAtt_reg_importReason select").html(res),regImportParent.find("#ZPAtt_reg_importDescription select").html(res),rArray)-1!==rArray[i].toLowerCase().indexOf("in")?regImportParent.find("#ZPAtt_reg_importCheckIn select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("out")?regImportParent.find("#ZPAtt_reg_importCheckOut select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("employee")||-1!==rArray[i].toLowerCase().indexOf("id")||-1!==rArray[i].toLowerCase().indexOf("user")?regImportParent.find("#ZPAtt_reg_importIds select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("date")?regImportParent.find("#ZPAtt_reg_importDate select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("description")?regImportParent.find("#ZPAtt_reg_importDescription select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("reason")&&regImportParent.find("#ZPAtt_reg_importReason select").select2("val",i);regImportParent.find("#ZPAtt_reg_importMsg").off("click"),regImportParent.find("#ZPAtt_reg_importMsg").attr("class","blu"),regImportParent.find("#ZPAtt_reg_importMsg").parent().fadeIn(300),obj.error&&"rowExceededLimit"===obj.error?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.importcntexceederror"),!0),regImportParent.find("#ZPAtt_reg_importNext").attr("disabled",!0),regImportParent.find("#ZPAtt_reg_importMsg").text("")):void 0!==obj.recordCount?regImportParent.find("#ZPAtt_reg_importMsg").text(obj.recordCount+" "+ZPI18N.getString("zp.recordsfound")):regImportParent.find("#ZPAtt_reg_importMsg").text("0 "+ZPI18N.getString("zp.recordsfound")),regImportParent.find("#ZPAtt_reg_importMap select").select2()},submitRegMapping:function(fileFormat){var regImportParent=Layout.Page.container.find("#ZPAtt_reg_importPopup");Attendance.Entry.reloadFromWMS=!1;var si_Id=regImportParent.find("#ZPAtt_reg_importIds select")[0].selectedIndex,si_Date=regImportParent.find("#ZPAtt_reg_importDate select")[0].selectedIndex,si_punchIn=regImportParent.find("#ZPAtt_reg_importCheckIn select")[0].selectedIndex,si_punchOut=regImportParent.find("#ZPAtt_reg_importCheckOut select")[0].selectedIndex,si_reason=-1;Attendance.Reg.isRegReasonsEnabled&&(si_reason=regImportParent.find("#ZPAtt_reg_importReason select")[0].selectedIndex);var si_desc=regImportParent.find("#ZPAtt_reg_importDescription select")[0].selectedIndex;if(0!==si_Id&&0!=si_Date&&0!=si_reason&&0!==si_punchIn&&0!==si_punchOut){var param={mode:"regImportMapping",mailId:si_Id-1,date:si_Date-1,punchInId:si_punchIn-1,punchOutId:si_punchOut-1,reasonId:si_reason-1,descId:si_desc-1,conreqcsr:csrfToken};"0"!==regImportParent.find("#ZPAtt_reg_importDateFor select").val()&&(param.dateFormat=regImportParent.find("#ZPAtt_reg_importDateFor select").val()),"csv"!==fileFormat||param.dateFormat?(regImportParent.find("#ZPAtt_reg_importNext").attr("disabled",!0),regImportParent.find("#ZPAtt_reg_importPopup .modal-body").children().hide(),regImportParent.find("#ZPAtt_reg_importPopup .modal-body").append(ZPeople.LOADING_HTML),$.post("/AttendanceAction.zp",param,function(resultData){if(regImportParent.find("#ZPAtt_reg_importPopup .modal-body").find("#zp_page_loading").remove(),regImportParent.find("#ZPAtt_reg_importPopup .modal-body").children().show(),resultData.msg){if(regImportParent.find("#ZPAtt_reg_import").parent().parent().attr("class","ZPImfrm ZPRecList"),regImportParent.find("#ZPAtt_reg_importMap").hide(),regImportParent.find("#ZPAtt_reg_importMsg").parent().hide(),regImportParent.find("#ZPAtt_reg_importSuccMsg").fadeIn(300),regImportParent.find("#ZPAtt_reg_importSuccvalues").fadeIn(300),regImportParent.find("#ZPAtt_reg_importSuccvalues span")[1].innerHTML="0",resultData.msg.successCount&&(regImportParent.find("#ZPAtt_reg_importSuccvalues span")[1].innerHTML=resultData.msg.successCount),regImportParent.find("#ZPAtt_reg_importSuccvalues span")[0].innerHTML="0",resultData.msg.totalCount&&(regImportParent.find("#ZPAtt_reg_importSuccvalues span")[0].innerHTML=resultData.msg.totalCount),regImportParent.find("#ZPAtt_reg_importPrevious").hide(),regImportParent.find("#ZPAtt_reg_importNext").hide(),resultData.msg.errorType)return void ZPeople.Message.showFailureMsg(resultData.msg.errorType);if(Attendance.Reg.getRequest(!1),resultData.msg.emptyEmpIds||resultData.msg.skippedEmpInfo||resultData.msg.errorInfo){var rowNumber=0;if(regImportParent.find("#importErrDiv").show(),regImportParent.find("#importErrTBody").find("tr").remove(),resultData.msg.skippedEmpInfo){var length=resultData.msg.skippedEmpInfo.length;regImportParent.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.invalidempinfo")+"<ul></ul></td></tr>"));for(var i=0;i<length;i++)$($(regImportParent.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+$("<div/>").text(resultData.msg.skippedEmpInfo[i]).html()+"</li>");rowNumber++}if(resultData.msg.emptyEmpIds){length=resultData.msg.emptyEmpIds.length;regImportParent.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.emptyempids")+"<ul></ul></td></tr>"));for(i=0;i<length;i++)$($(regImportParent.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+resultData.msg.emptyEmpIds[i]+"</li>");rowNumber++}if(resultData.msg.errorInfo){var errObj=resultData.msg.errorInfo;for(length=errObj.length,i=0;i<length;i++){var errrObj=errObj[i],firstKey=Object.keys(errrObj)[0];regImportParent.find("#importErrTBody").append($("<tr class='ZPLRow'><td>"+firstKey+"</td><td>"+errrObj[firstKey]+"</td></tr>"))}}}}else if(resultData.fail||resultData.error){var failMsg=resultData.fail?resultData.fail:ZPI18N.getString("zp.unabletoprocess");ZPeople.Message.showFailureMsg(failMsg),Layout.Page.container.find("#ZPAtt_reg_importNext").attr("disabled",!1),Layout.Page.container.find("#ZPAtt_reg_importNext").off("click").on("click",function(){Attendance.RegImport.submitRegMapping(fileFormat)})}})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))}},Attendance.OD={checkedBoxVal:[],apprconfirmStatus:-1,isFromreset:!1,isHoursODEnabled:!1,isDaysODEnabled:!1,init:function(){isManageAttendanceData=ZPeople.Module.MODULE_DATA.attendance.isManageAttedance,repMan=ZPeople.Module.MODULE_DATA.attendance.isLeadForShift,isEmpChooseApp=ZPeople.Module.MODULE_DATA.attendance.isEmpChooseApp,isEmpChooseAppOD=ZPeople.Module.MODULE_DATA.attendance.isEmpChooseAppOD,spocODView=ZPeople.Module.MODULE_DATA.attendance.isSPOCEntryViewAllowed;var layout=Layout.Page.container;isadmin&&(isManageAttendanceData=!0),layout.find("#ZPAtt_AddODPage").off("hide.bs.modal").on("hide.bs.modal",function(){Attendance.OD.resetODPopup()}),spocODView||isManageAttendanceData||layout.find("#ZPAtt_myReqOD_empProfile").parent().parent().remove(),layout.find("select").select2({minimumResultsForSearch:5}),layout.find("[data-toggle=tooltip]").tooltip({trigger:"click"}),layout.find("#ZPAtt_OD_Filter").hasClass("ZPFilsel")&&$("#page-wrapper").attr("class","Nbar2F THF-2F"),-1!==Layout.Page.hash.indexOf("attendance/onduty/myrequests")?(layout.find("#ZPAtt_ODBulkDelete").hide().prev().show(),layout.find("#ZPAtt_ODMreOptns").removeClass("DN"),isadmin||layout.find("#ZPAtt_ODMreOptns li").eq(2).remove(),Layout.Page.container.find("select[multiple='multiple']").select2({closeOnSelect:!1}),Attendance.Report.getDepLocShiftList(!0),AttendanceApprovals.appendApprovalTopBand("myrequests","onduty"),Attendance.OD.getRequest(!1)):-1!==Layout.Page.hash.indexOf("attendance/onduty/myapprovals")?(layout.find("#ZPAtt_ODTotalApprAction").hide().prev().show(),AttendanceApprovals.appendApprovalTopBand("myapprovals","onduty"),Attendance.OD.getApprovals(!1)):Attendance.OD.getAttendanceODDetails()},formId:null,odConfInfolist:null,getODConfInfolist:function(){var layout=Layout.Page.container,param={mode:"fetchODApprovals",conreqcsr:csrfToken};Attendance.toggleLoadingDiv(!1,layout.find("#ZPAtt_Sett_OD"),layout.find("#ZPAtt_SettOD_emptyRecInfo")),$.post("/AttendanceSettingsAction.zp",param,function(rdata){Attendance.OD.odConfInfolist=rdata,Attendance.OD.consODConfInfolist()})},consODConfInfolist:function(){for(var rdata=Attendance.OD.odConfInfolist,layout=Layout.Page.container,txt="",i=0;i<rdata.list.length;i++){var data=rdata.list[i];data&&data.FORMID?(Attendance.OD.formId=data.FORMID,txt+='<tr  class="ZPLRow" id="approval_'+data.FORM_TEMPLATE_ACTION_ID+'" approvalId="'+data.FORM_TEMPLATE_ACTION_ID+'"  >',txt+="<td class='CP' onclick=Attendance.OD.editApproval(\""+data.FORM_TEMPLATE_ACTION_ID+'","'+Attendance.OD.formId+'");>'+data.TEMPLATE_NAME+"</td>",txt+="<td>"+data.SUBJECT+"</td>",txt+='<td><div class="btnactive"><input type="checkbox" onclick="ApprovalProcess.enableDisable(\''+data.FORM_TEMPLATE_ACTION_ID+"','"+Attendance.OD.formId+'\');" class="cmn-toggle-small cmn-toggle-round-small" id="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"',data.ISACTIVE&&(txt+=" checked"),txt+='><label class="M0" for="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"></label></div></td>',txt+="<td class='text-right P0I'><div id='ZPAtt_SettOD_delAction' class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_SettOD_delConfirm','table-responsive')></i><i class='IC-pen S14 gry FR MR15 CP' onclick=Attendance.OD.editApproval(\""+data.FORM_TEMPLATE_ACTION_ID+'","'+Attendance.OD.formId+'");></i></div>',txt+="<div style='display:none' id='ZPAtt_SettOD_delConfirm'>",txt+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_SettOD_delAction','table-responsive')>"+ZPI18N.getString("zp.cancel")+"</button>",txt+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=Attendance.OD.deleteApproval(\""+Attendance.OD.formId+'","'+data.FORM_TEMPLATE_ACTION_ID+'")>'+ZPI18N.getString("zp.confirm")+"</button></div>",txt+="</td><td></td>",txt+="</tr>"):data&&data.newformid&&(Attendance.OD.formId=data.newformid)}if(layout.find("#ZPAtt_Sett_OD_DetBody").html(txt),0===layout.find("#ZPAtt_Sett_OD_DetBody").children().length){layout.find("#ZPAtt_Sett_OD_Det").parent().hide(),layout.find("#ZPAtt_SettOD_emptyRecInfo").fadeIn(200),layout.find("#ZPAtt_Sett_OD").removeClass("section");var empImg=layout.find("#ZPAtt_SettOD_emptyRecInfo i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-set-regularization",empImg)}else layout.find("#ZPAtt_Sett_OD_Det").parent().fadeIn(200),layout.find("#ZPAtt_SettOD_emptyRecInfo").hide(),layout.find("#ZPAtt_Sett_OD").attr("class","Scrcont section");Attendance.toggleLoadingDiv(!0),layout.find("#ZPAtt_Sett_OD_Det").parent().hasClass("tabcont")||ZPView.handleTablePosition()},editApproval:function(approvalId,formId){ApprovalProcess.getApprovalRow(approvalId,formId,Attendance.OD.getODConfInfolist)},deleteApproval:function(formId,approvalId){var layout=Layout.Page.container,params={formTemplateId:approvalId,formId:formId,method:"deleteApproval",conreqcsr:csrfToken};$.post("/deleteApproval.zp",params,function(resultData){"success"===resultData.result?layout.find("#ZPAtt_Sett_OD_DetBody").find("#approval_"+approvalId).fadeOut("fast",function(){layout.find("#ZPAtt_Sett_OD_DetBody").find("#approval_"+approvalId).remove(),0===layout.find("#ZPAtt_Sett_OD_DetBody").find("tr").length&&(layout.find("#ZPAtt_Sett_OD_Det").parent().hide(),layout.find("#ZPAtt_SettOD_emptyRecInfo").fadeIn(200),layout.find("#ZPAtt_Sett_OD").removeClass("section"),0===$("ZPAtt_SettOD_emptyRecInfo div").children().length&&ZPUtil.noDataSVG("ZPAtt_SettOD_emptyRecInfo div",ZPeople.getResourceURL(newUIImageUrl+"svg/no-data.svg"))),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.approvalconfigdeletionsuccess"))}):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.recordnotfound"))})},toggleFilSearch:function(){"attendance-onduty-myrequests"===Layout.Page.pageId?Attendance.OD.getRequest(!1,!0):Attendance.OD.getApprovals(!1,!0),"/zp"===ZPeople.CONTEXT&&Attendance.OD.toggleFilter()},toggleFilter:function(){var layout=Layout.Page.container;layout.find("#ZPAtt_OD_Filter").hasClass("ZPFilsel")?(layout.find("#ZPAtt_OD_Filter").removeClass("blu ZPFilsel"),layout.find("#ZPAtt_ODFilters").attr("class","ZPFilMain"),layout.find("#ZPAtt_ODFilClsBut").hide(),$("#page-wrapper").attr("class","Nbar3")):(layout.find("#ZPAtt_OD_Filter").addClass("blu ZPFilsel"),layout.find("#ZPAtt_ODFilters").attr("class","ZPFilMain TEbnd"),layout.find("#ZPAtt_ODFilClsBut").show(),$("#page-wrapper").attr("class","Nbar2F THF-2F"),isManageAttendanceData||repMan||spocODView?layout.find("#ZPAtt_myReqOD_empName").parent().parent().show():layout.find("#ZPAtt_myReqOD_empName").parent().parent().hide())},resetInputs:function(){Layout.Page.container.find("#ZPAtt_OD_Status").select2("val",-3);var filters=Layout.Page.container.find("#ZPAtt_onDutyFilter");Attendance.Reg.resetMyReqFilters(filters,"myReqOD",Attendance.OD.currMonthSDate,Attendance.OD.currMonthEDate)},startIndex:0,getRequest:function(isScroll,fromSubmit,navigate){var layout=Layout.Page.container;layout.find("#ZPAtt_ODBulkDelete").hide(),layout.find("#ZPAtt_ODBulkDelete").prev().show();var param={mode:"getMyODRequest",status:layout.find("#ZPAtt_OD_Status").val(),conreqcsr:csrfToken};Attendance.OD.isODReqFromNav=void 0,navigate&&(param.navigate=navigate,Attendance.OD.isODReqFromNav=!0),layout.find("#ZPAtt_OD_myReqDaySort").hasClass("sort-d")?param.isDaySortAsc=!1:layout.find("#ZPAtt_OD_myReqDaySort").hasClass("sort-u")?param.isDaySortAsc=!0:layout.find("#ZPAtt_OD_myReqEmpSort").hasClass("sort-d")?param.isEmpSortAsc=!1:layout.find("#ZPAtt_OD_myReqEmpSort").hasClass("sort-u")&&(param.isEmpSortAsc=!0);var filter=Layout.Page.container.find("#ZPAtt_onDutyFilter");Attendance.Reg.getMyRequestDateFilter(param,"myReqOD",filter),param.error||(Attendance.Report.getFilterValues(filter,param,"myReqOD"),isScroll?param.startIndex=Attendance.OD.startIndex+1:(Attendance.OD.startIndex=0,layout.find("#ZPAtt_ODMyReqDetails").scrollTop(0),fromSubmit&&(layout.find("#ZPAtt_ODMyReq_emptyRecInfo")[0]&&layout.find("#ZPAtt_ODMyReq_emptyRecInfo").hide(),layout.find("#ZPAtt_ODMyReqDetails").hide(),0===layout.find("#ZPAtt_ODMyReq").find("#zp_page_loading").length&&layout.find("#ZPAtt_ODMyReq").append(ZPeople.LOADING_HTML))),$.post("/AttendanceAction.zp",param,function(resultData){if($("#zp_active_subtabs #zp_t_attendance_myapprovals").parent().removeClass("active"),$("#zp_active_subtabs #zp_t_attendance_myrequests").attr("href","#attendance/onduty/myrequests").parent().addClass("active"),resultData.error)"exceeded dates"===resultData.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinthreemonth")):"error in end date"===resultData.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate"));else{var ODReqFilter=layout.find("#ZPAtt_ODFilters"),dateNav=layout.find("#ZPAtt_ODReq_dateNav");Attendance.OD.isODReqFromNav?(ODReqFilter.find("#ZPAtt_myReqOD_fromDate").val(resultData.fDate).attr("disabled",!1),ODReqFilter.find("#ZPAtt_myReqOD_toDate").val(resultData.tDate).attr("disabled",!1),ODReqFilter.find("#ZPAtt_myReqOD_period").select2("val",6)):resultData.sDate&&(Attendance.OD.currMonthSDate=resultData.sDate,Attendance.OD.currMonthEDate=resultData.eDate,Attendance.OD.todayDate=resultData.todayDate,Attendance.OD.prevDay=resultData.prevDay,Attendance.OD.lastMonthStart=resultData.prevMonthStart,Attendance.OD.lastMonthEnd=resultData.prevMonthEnd,Attendance.OD.onPeriodChange()),resultData.dispMonth?dateNav.html(resultData.dispMonth):dateNav.html(Attendance.datesInHeader(resultData.fDate,resultData.tDate)),layout.find("#ZPAtt_ODMyReq").find("#zp_page_loading").remove(),20===resultData.list.length&&ZPeople.FireScroll.reset(),Attendance.OD.isEditAllowedForSub=resultData.isEditAllowedForSub,Attendance.OD.constructList(resultData,"getRequestList",isScroll),"hh:mm a"!==resultData.timeformat?Attendance.timeFormatIs12hr=!1:Attendance.timeFormatIs12hr=!0}}))},myReqEmpDaySort:function(obj){var layout=Layout.Page.container;"ZPAtt_OD_myReqEmpSort"===obj.id?layout.find("#ZPAtt_OD_myReqDaySort").attr("class","sort-img sort CP"):layout.find("#ZPAtt_OD_myReqEmpSort").attr("class","sort-img sort CP"),$(obj).hasClass("sort-d")?$(obj).attr("class","sort-img sort-u CP"):$(obj).attr("class","sort-img sort-d CP"),Attendance.OD.getRequest(!1,!0)},onPeriodChange:function(){var layout=Layout.Page.container,fromElement=layout.find("#ZPAtt_myReqOD_fromDate"),toElement=layout.find("#ZPAtt_myReqOD_toDate");fromElement.attr("disabled",!0),toElement.attr("disabled",!0);var currMonthSDate=Attendance.OD.currMonthSDate,currMonthEDate=Attendance.OD.currMonthEDate,toDay=moment(Attendance.OD.todayDate,dateFmt.toUpperCase()),weekStartDate=moment(toDay).startOf("week").add(weekstarts,"day");toDay._d.getTime()<weekStartDate._d.getTime()&&(weekStartDate=weekStartDate.add(-1,"week"));var weekEndDate=moment(toDay).startOf("week").add(weekstarts,"day");toDay._d.getTime()<weekEndDate._d.getTime()&&(weekEndDate=weekEndDate.add(-1,"week")),weekEndDate=weekEndDate.add(6,"day");var pValue=layout.find("#ZPAtt_myReqOD_period").val();"1"===pValue?(currMonthSDate=Attendance.OD.lastMonthStart,currMonthEDate=Attendance.OD.lastMonthEnd):"2"===pValue?(currMonthSDate=weekStartDate.format(dateFmt.toUpperCase()),currMonthEDate=weekEndDate.format(dateFmt.toUpperCase())):"3"===pValue?(currMonthSDate=moment(weekStartDate).add(-1,"week").format(dateFmt.toUpperCase()),currMonthEDate=moment(weekEndDate).add(-1,"week").format(dateFmt.toUpperCase())):"4"===pValue?(currMonthSDate=Attendance.OD.todayDate,currMonthEDate=Attendance.OD.todayDate):"5"===pValue?(currMonthSDate=Attendance.OD.prevDay,currMonthEDate=Attendance.OD.prevDay):"6"===pValue&&(fromElement.prop("disabled",!1),toElement.prop("disabled",!1)),"6"!==pValue&&(fromElement.val(currMonthSDate),toElement.val(currMonthEDate))},ApprstartIndex:0,getApprovals:function(isScroll,fromSubmit){var layout=Layout.Page.container;layout.find("#ZPAtt_ODTotalApprAction").hide(),layout.find("#ZPAtt_ODTotalApprAction").prev().show(),layout.find("#zp_approval_pop").is(":visible")&&ZPeople.BSModal.hide(),Attendance.toggleLoadingDiv(!1,layout.find("#ZPAtt_ODMyApproval"),layout.find("#ZPAtt_ODMyApproval_emptyRecInfo"));var param={mode:"getODApprovals",status:layout.find("#ZPAtt_OD_Status").val(),conreqcsr:csrfToken};isScroll?param.startIndex=Attendance.OD.ApprstartIndex+1:(layout.find("#ZPAtt_ODMyApprovalDetails").scrollTop(0),Attendance.OD.ApprstartIndex=0,fromSubmit&&(layout.find("#ZPAtt_ODMyApproval_emptyRecInfo")[0]&&layout.find("#ZPAtt_ODMyApproval_emptyRecInfo").hide(),layout.find("#ZPAtt_ODMyApprovalDetails").hide(),0===layout.find("#ZPAtt_ODMyApproval").find("#zp_page_loading").length&&layout.find("#ZPAtt_ODMyApproval").append(ZPeople.LOADING_HTML))),$.post("/AttendanceAction.zp",param,function(resultData){$("#zp_active_subtabs #zp_t_attendance_myrequests").parent().removeClass("active"),$("#zp_active_subtabs #zp_t_attendance_myapprovals").attr("href","#attendance/onduty/myapprovals").parent().addClass("active"),layout.find("#ZPAtt_ODMyApproval").find("#zp_page_loading").remove(),resultData&&void 0!==resultData.list&&resultData.list.length>0&&layout.find("#ZPAtt_ODTotalApprAction").attr("onclick","ZPApprovals.viewApproveActionPopup("+resultData.list[0].formId+")"),Attendance.OD.constructList(resultData,"getApprovals",isScroll),20===resultData.list.length&&ZPeople.FireScroll.reset()})},getReqOnScroll:function(){Attendance.OD.startIndex+=20,Attendance.OD.getRequest(!0)},getApprOnScroll:function(){Attendance.OD.ApprstartIndex+=20,Attendance.OD.getApprovals(!0)},deleteBulkOD:function(){var selectedreq="";Layout.Page.container.find("#ZPAtt_ODMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){selectedreq=""===selectedreq?$(this).attr("val"):selectedreq+","+$(this).attr("val")}),Attendance.OD.deleteODList(selectedreq)},cancelOD:function(recordId){var layout=Layout.Page.container,selectedreq="";void 0!=recordId?selectedreq=recordId:layout.find("#ZPAtt_ODMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){selectedreq=""===selectedreq?$(this).attr("val"):selectedreq+","+$(this).attr("val")}),void 0===ZPeople.Module.MODULE_DATA.attendance.isODCancelReason||!0!==ZPeople.Module.MODULE_DATA.attendance.isODCancelReason||void 0!==layout.find("#cancel_reason textArea").val()&&""!==layout.find("#cancel_reason textArea").val().trim()?Attendance.OD.cancelODIndividual(selectedreq):layout.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.providereason")).removeClass("DN")},ODApprAction:function(getThis){var layout=Layout.Page.container,approvalComment=layout.find("#approval_comment").val(),action="zp_modal_blubtn"===getThis.id||"zp_modal_all_appr_btn"===getThis.id?1:0,isAllLevelApprove="zp_modal_all_appr_btn"===getThis.id;layout.find("#ZPAtt_ODMyApprovalDetails").find("tbody input[type=checkbox]:enabled").each(function(){$(this).is(":checked")&&Attendance.OD.checkedBoxVal.push($(this).attr("val"))}),Attendance.OD.apprconfirmStatus=1,ZPForm.Record.approveReject(Attendance.OD.checkedBoxVal,action,approvalComment,isAllLevelApprove,Attendance.OD.resetApprovalsPage)},resetApprovalsPage:function(){Attendance.OD.getApprovals(!1)},constructList:function(resultData,mode,isScroll){var layout=Layout.Page.container,result=resultData.list,hideDel=resultData.hideDel,emptyMessage=layout.find("#ZPAtt_ODMyReq_emptyRecInfo"),tslisttbody=layout.find("#ZPAtt_ODMyReqBody"),subUrl="viewmyrequest",noDataImg="CR-at-myreq";"getApprovals"===mode&&(tslisttbody=layout.find("#ZPAtt_ODMyApprovalBody"),emptyMessage=layout.find("#ZPAtt_ODMyApproval_emptyRecInfo"),subUrl="viewmyapproval",noDataImg="CR-at-regapp"),tslisttbody.parent().find("thead input").attr("checked",!1),emptyMessage.hide(),emptyMessage.prev().show(),isScroll||tslisttbody.empty(),"getRequestList"!==mode||isManageAttendanceData||layout.find("#ZPAtt_ODMyReqHeader #ZPAtt_ODMyReqHeader_checkBox").remove(),$.each(result,function(ind,ODDetails){var txt='<tr class="ZPLRow zp_tbr_ini" id="list-'+ODDetails.recordId+'">';"getApprovals"===mode?-1===ODDetails.status||ODDetails.status===zpconst.ApprovalStatus.CancellationPending?txt+='<td><div class="checkbox"><input approvalStatus='+ODDetails.status+' type="checkbox" val="'+ODDetails.recordId+"\" onclick=\"Attendance.OD.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>':-1!==ODDetails.status&&(txt+='<td><div class="checkbox disabled"><input approvalStatus='+ODDetails.status+' type="checkbox" disabled="true"><label class="MT3"></label></div></td>'):"getRequestList"===mode?!isManageAttendanceData||ODDetails.isSubOrdinate||ODDetails.erecno===erecno&&hideDel?isManageAttendanceData&&(ODDetails.erecno===erecno&&hideDel||ODDetails.isSubOrdinate)&&(txt+='<td><div class="checkbox disabled"><input type="checkbox" approvalStatus='+ODDetails.status+' disabled="true"><label class="MT3"></label></div></td>'):txt+='<td><div class="checkbox"><input type="checkbox" approvalStatus='+ODDetails.status+' val="'+ODDetails.recordId+"\" onclick=\"Attendance.OD.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>':"addreq"===mode&&(txt+='<td><div class="checkbox"><input type="checkbox" approvalStatus='+ODDetails.status+' val="'+ODDetails.recordId+"\" onclick=\"Attendance.OD.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>');var redUrl="data-toggle=modal onclick=\"window.location.href='#attendance/onduty/"+subUrl+"-formId:"+ODDetails.formId+"/recordId:"+ODDetails.recordId+"'\"";txt+='<td class="P_AM UN_A"><div class="ZPusrName"><img class="FL" src='+ODDetails.empPhoto+'><span class="ellipsis CP" '+redUrl+"><b>"+$("<div/>").text(ODDetails.employeeId).html()+"</b>"+ODDetails.employeeName+"</span>",txt+="</div></td>";var dates=ODDetails.startDate;ODDetails.startDate!==ODDetails.endDate&&(dates=ODDetails.startDate+"&nbsp; - &nbsp;"+ODDetails.endDate),txt+="<td class='P0I TBrdr text-center'><div>"+dates+"</div></td>",txt+="<td class='P0I TBrdr text-center'><div>"+(ODDetails.type?$("<div/>").text(ODDetails.type).html():ZPI18N.getString("zp.onduty"))+"</div></td>";var hrsDaysDis="";0===ODDetails.unit&&ODDetails.totalDaysTaken?hrsDaysDis=ODDetails.totalDaysTaken+" "+ZPI18N.getString("zp.leavetype.daysinfo"):1===ODDetails.unit&&void 0!=ODDetails.totalHrsTaken&&ODDetails.totalHrsTaken>=0&&(hrsDaysDis=Attendance.disHours(ODDetails.totalHrsTaken)+" "+ZPI18N.getString("zp.shours")),txt+="<td class='P0I TBrdr text-center'>"+hrsDaysDis+"</td>";var ODDetsHasRejectedData=!1;$.each(ODDetails.odDetails,function(index,data){0==data.status&&(ODDetsHasRejectedData=!0)});var appStatus="";if(1===ODDetails.status){var dispStr=ODDetsHasRejectedData?ZPI18N.getString("zp.partiallyapproved"):ZPI18N.getString("zp.approved");appStatus="<span "+redUrl+' class="'+(ODDetsHasRejectedData?"org CP":"grn CP")+'">'+dispStr+"</span>"}else 0===ODDetails.status?appStatus="<span "+redUrl+' class="red CP">'+ZPI18N.getString("zp.rejected")+"</span>":-1===ODDetails.status||ODDetails.status===zpconst.ApprovalStatus.CancellationPending?appStatus="getRequestList"===mode||"addreq"===mode?"<span "+redUrl+' class="CP">'+ZPI18N.getString("zp.waitingmsg")+"</span>":3===ODDetails.odDetails.currentApprovalStatus?"<span "+redUrl+' class="CP">'+ZPI18N.getString("zp.waitingnextlevel")+"</span>":'<button type=button class="btn btn-default btn-sm" '+redUrl+">"+ZPI18N.getString("zp.clickapprove")+"</button>":-2===ODDetails.status?appStatus="<span "+redUrl+' class="CP">'+ZPI18N.getString("zp.submitted")+"</span>":2===ODDetails.status&&(appStatus="<span "+redUrl+' class="CP red">'+ZPI18N.getString("zp.cancelled")+"</span>");txt+='<td class="P0I TBrdr text-center">'+appStatus,txt+="</tr>","addreq"===mode?txt.prependTo(tslisttbody):tslisttbody.append(txt)}),!isManageAttendanceData&&"getRequestList"===mode&&layout.find("#ZPAtt_ODMyReqHeader").children("th:eq(6)")[0]&&layout.find("#ZPAtt_ODMyReqHeader").children("th:eq(6)").nextAll().remove(),Attendance.toggleLoadingDiv(!0),0===tslisttbody.children().length?(emptyMessage.prev().hide(),emptyMessage.show(),tslisttbody.prev().hide(),0===emptyMessage.find("i").eq(0).children().length&&Attendance.noDataImg(8,noDataImg,emptyMessage.find("i").eq(0))):tslisttbody.prev().show()},deleteConfirm:function(){Layout.Page.container.find("#ZPAtt_ODMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){if("-1"!==$(this).attr("approvalStatus"))return!1}),$("#confirmationPopup").modal({backdrop:"static",keyboard:!1}),$("#textConfirmationPopupHeader").html(ZPI18N.getString("zp.ondutydeleteconfirm")),$("#confirmConfirmationPopup").html(ZPI18N.getString("zp.confirm"));var message=ZPI18N.getString("zp.ondutycancel");$("#textConfirmationPopupBody").html(message),$("#confirmConfirmationPopup").off("click"),$("#cancelConfirmationPopup").off("click"),$("#confirmConfirmationPopup").click(function(event){Attendance.OD.deleteBulkOD()}),$("#cancelConfirmationPopup").click(function(event){$("#confirmationPopup").modal("hide")})},statI18nInOD:function(status){return-1!==status.indexOf("Half day Present")?status=status.replace("Half day Present",ZPI18N.getString("zp.halfdaypresent")):-1!==status.indexOf("Present")&&(status=status.replace("Present",ZPI18N.getString("zp.present"))),-1!==status.indexOf("Half day Absent")?status=status.replace("Half day Absent",ZPI18N.getString("zp.halfdayabsent")):-1!==status.indexOf("Absent")&&(status=status.replace("Absent",ZPI18N.getString("zp.absent"))),status},changeCheckBox:function(obj,val,mode){var layout=Layout.Page.container,currPage=layout.find("#ZPAtt_ODMyReqDetails"),pagebutton=layout.find("#ZPAtt_ODBulkDelete");"getApprovals"===mode&&(currPage=layout.find("#ZPAtt_ODMyApprovalDetails"),pagebutton=layout.find("#ZPAtt_ODTotalApprAction")),"all"===val?$(obj).is(":checked")?currPage.find("tbody input[type=checkbox]:enabled").prop("checked",!0):currPage.find("tbody input[type=checkbox]:enabled").prop("checked",!1):currPage.find("tbody input[type=checkbox]:checked:enabled").length===currPage.find("tbody input[type=checkbox]:enabled").length?currPage.find("thead input[type=checkbox]:enabled").prop("checked",!0):currPage.find("thead input[type=checkbox]:enabled").prop("checked",!1),0===currPage.find("tbody input[type=checkbox]:checked:enabled").length?(pagebutton.hide(),pagebutton.prev().fadeIn(100)):(pagebutton.prev().hide(),pagebutton.fadeIn(100))},deleteODList:function(listId){var layout=Layout.Page.container,params={mode:"deleteODList",listId:listId,conreqcsr:csrfToken},empFilter=layout.find("#ZPAtt_myReqOD_empName");"0"!==empFilter.val()&&""!==empFilter.val()&&(params.erecno=empFilter.select2("val")),$.post("/AttendanceAction.zp",params,function(resultData){if(void 0!=resultData&&"success"==resultData.status){if(layout.find("#ZPAtt_ODMyReq").is(":visible")){for(var deleted_Id=listId.split(","),i=0;i<deleted_Id.length;i++)layout.find("#list-"+deleted_Id[i]).remove();if(0===layout.find("#ZPAtt_ODMyReqBody tr").length){var emptyRecEle=layout.find("#ZPAtt_ODMyReq_emptyRecInfo");emptyRecEle.prev().hide(),emptyRecEle.fadeIn(200).parent().removeClass("section");var empImg=emptyRecEle.find("i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-regapp",empImg)}layout.find("#ZPAtt_ODMyReqDetails").find("thead input[type=checkbox]:enabled").prop("checked",!1),layout.find("#ZPAtt_ODBulkDelete").hide().prev().show()}else Attendance.OD.getApprovals();ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.recorddeletedsuccessfully"))}else ZPeople.Message.showFailureMsg(resultData.message)})},cancelODIndividual:function(listId){var layout=Layout.Page.container,params={mode:"cancelODList",ODId:listId,conreqcsr:csrfToken,reason:layout.find("#cancel_reason textArea").val()};$.post("/AttendanceAction.zp",params,function(resultData){if(layout.find("#cancelODIndividual").addClass("DN"),void 0!==resultData&&void 0!==resultData.currentApprovalStatus&&void 0!==resultData.approvalDetail){ZPForm.Record.cancelRecCBforModule(resultData.currentApprovalStatus,{isfromAttendence:!0},resultData.approvalDetail)}if(void 0!=resultData&&"success"==resultData.status){ZPeople.BSModal.hide("zp_confirmation_pop");for(var ODRows=layout.find("#ZPAtt_OD_DetListBody").find(".ODRow"),n=ODRows.length,i=0;i<n;i++)$(ODRows.find("td:last")[i]).html(ZPI18N.getString("zp.cancelled"));var listHead=layout.find("#ZPAtt_OD_DetListHeader");listHead.find("#ODBulkApprovalRej").hide(),listHead.find("#ODApprovalState").show()}else void 0!=resultData&&void 0!=resultData.message&&(resultData.message==ZPI18N.getString("zp.leave.cancell.error.providereason")?(layout.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.providereason")).removeClass("DN"),layout.find("#cancelODIndividual").removeClass("DN")):(ZPeople.BSModal.hide("zp_confirmation_pop"),ZPeople.Message.showFailureMsg(resultData.message)))}).fail(function(data){void 0!=data.responseJSON&&void 0!=data.responseJSON.error&&layout.find("#cancel_reason_error").text(data.responseJSON.error).removeClass("DN")})},setApprovalSett:function(data){Attendance.OD.approvalSett=data},getAttendanceODDetails:function(formId,recordId,closeCallBack){var layout=Layout.Page.container;Attendance.Entry.reloadFromWMS=!1;var popupTarget="ZPAtt_OD_Details",title=ZPI18N.getString("zp.onduty");if(-1!==Layout.Page.pageId.indexOf("myapproval")?title=ZPI18N.getString("zp.myapprovals"):-1!==Layout.Page.pageId.indexOf("myrequest")&&(title=ZPI18N.getString("zp.myrequests")),!layout.find("#"+popupTarget)[0]){var ondutyViewPage='<div style="display: block;" aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" id="'+popupTarget+'" class="modal popRgtModel PopLgModel in"><div role="document" class="modal-dialog"><div class="modal-content"><div class="ZPNxtStep">';ondutyViewPage+='<div class="modal-header"><div class="col-sm-3"> <h6>'+title+' </h6> </div> <div class="col-sm-9"><div class="zp-recordsts zp_dyn" id="headerApprovalBtn"><span class="msg" id="headerApprovalMsg"></span><a id="zp_appproval_comment_btn" onclick="ZPApprovals.getApprovalDetails()">'+ZPI18N.getString("zp.view")+'</a></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div>',ondutyViewPage+='<div class="modal-body ZPAprval PT0I"><div class="container-fluid MT25"><div class="row"><div class="col-sm-7"><form class="form-horizontal"><div class="form-group"><label class="col-sm-3 zp_mdt PT8"><font>'+ZPI18N.getString("zp.employee")+'</font></label><div class="col-sm-5 PL0 PT8" id="ZPAtt_OD_userName"></div></div><div class="form-group"><label class="col-sm-3 zp_mdt PT8"><font>'+ZPI18N.getString("zp.date")+'</font></label><div class="col-sm-6 PL0 PT10" id="ZPAtt_ODDispDate"></div></div>',ondutyViewPage+='<div class="form-group"><label class="col-sm-3 zp_mdt PT8"><font>'+ZPI18N.getString("zp.type")+'</font></label><div class="col-sm-6 PL0 PT10" id="ZPAtt_OD_type"></div></div><div class="form-group"><label class="col-sm-3 zp_mdt PT8"><font>'+ZPI18N.getString("zp.description")+'</font></label><div class="col-sm-6 PL0 PT10" id="ZPAtt_OD_desc"></div></div></form></div></div></div>',ondutyViewPage+='<div class="table-responsive MT30 feedModal"><table style="border-top: 1px solid #e9edf3;" class="table"><thead id="ZPAtt_OD_DetListHeader"></thead>',ondutyViewPage+='<tbody class="B0" id="ZPAtt_OD_DetListBody"></tbody></table></div></div><div class="modal-footer text-left ZPAprval" id="ZPAtt_OD_AppHierarchy"><div class="Row"></div></div></div></div></div></div>',$(layout).append(ondutyViewPage)}layout.find("#ZPAtt_OD_userName").html(""),layout.find("#ZPAtt_ODDispDate").html(""),layout.find("#ZPAtt_OD_type").html(""),layout.find("#ZPAtt_OD_desc").html(""),layout.find("#ZPAtt_OD_DetListBody tr").remove(),layout.find("#ZPAtt_OD_DetListHeader tr").remove(),ZPeople.BSModal.show(layout.find("#"+popupTarget)),layout.find("#"+popupTarget).off("hidden.bs.modal"),layout.find("#"+popupTarget).on("hidden.bs.modal",function(){-1!==Layout.Page.hash.indexOf("attendance/onduty/viewmyrequest")?window.location.href="#attendance/onduty/myrequests":-1!==Layout.Page.hash.indexOf("attendance/onduty/viewmyapproval")?window.location.href="#attendance/onduty/myapprovals":-1!==Layout.Page.hash.indexOf("#approvals/myapproval")&&ZPUtil.Validation.isFunction(ZPApprovals.closePopCallback)?ZPApprovals.closePopCallback():ZPUtil.Validation.isFunction(closeCallBack)&&closeCallBack()}),ZPForm.LAYOUT=layout.find("#"+popupTarget),ZPForm.CURRFORM_PARAM={},formId||(formId=Layout.Page.childUrlParam.formId,recordId=Layout.Page.childUrlParam.recordId),Attendance.OD.approvalSett||ZPApprovals.fetchApprovalSettings(formId,!1,Attendance.OD.setApprovalSett),ZPApprovals.FORMID=formId,ZPApprovals.RECORDID=recordId,ZPForm.CURRFORM_PARAM.formId=formId,ZPForm.CURRFORM_PARAM.recordId=recordId,ZPForm.CURRFORM_PARAM.tableName="P_AttendanceOD",ZPApprovals.MODAL_CLASS="modal popRgtModel PopApModel PopApZI";var AppHierCont="<div class='col-sm-12 text-right PT8'>";AppHierCont+="<button type='button' name='approvalTypeBtn' class='btn btn-success ZpaprvrBtn RsltA DN'  approvaltype='1'  id='zp_appproval_approve_btn'> "+ZPI18N.getString("zp.approve")+" </button>",AppHierCont+="<button type='button'name='approvalTypeBtn' class='btn btn-danger ZpaprvrBtn RsltR DN'  approvaltype='0'  id='zp_appproval_reject_btn'> "+ZPI18N.getString("zp.rejectall")+" </button>",AppHierCont+="<button class='btn btn-cancel btn-default ML8 DN' id='cancelODIndividual'> "+ZPI18N.getString("zp.cancelod")+" </button>",AppHierCont+="<button type='button' data-dismiss='modal' class='btn btn-default cancel-model DN' id='closeODIndividual'> "+ZPI18N.getString("zp.close")+" </button></div>",layout.find("#ZPAtt_OD_AppHierarchy .Row").html(AppHierCont);var param={mode:"getODDetails",recordId:recordId,formId:formId,conreqcsr:csrfToken};if(-1!==Layout.Page.hash.indexOf("attendance/onduty/viewmyrequest")){var filter=Layout.Page.container.find("#ZPAtt_onDutyFilter");Attendance.Report.getEmpProfDateofExitFilter(filter,param,"myReqOD")}delete Attendance.OD.approvalAttendDets,$.post("/AttendanceAction.zp",param,function(result){if(ZPForm.CONF.isadmin=isManageAttendanceData,result.approvalDetails){result.approvalDetails.isfromAttendence=!0;var isRecordOwner=!1,currentApprover=result.approvalDetails.isOwner;result.approvalDetails.recOwner&&(isRecordOwner=!0,ZPForm.RecordApproval.CREATE_ERECNO=result.approvalDetails.recOwner,result.approvalDetails.recordowner.erecno&&(ZPForm.RecordApproval.OWNER_ERECNO=result.approvalDetails.recordowner.erecno))}else Layout.Page.container.find("#headerApprovalBtn").removeClass(),Layout.Page.container.find("#headerApprovalBtn").addClass("zp-recordsts zp_dyn");if(result.details){layout.find("#ZPAtt_OD_Details .ZPNdata").remove();var unit=result.details.unit,header="<tr class='TblGryBg ZPLHRow'><th class='text-center TBrdr W250 P0I'>"+ZPI18N.getString("zp.attenday")+"</th>";0===unit?(header+="<th class='text-center TBrdr' width='200'>"+ZPI18N.getString("zp.duration")+"</th>",header+="<th class='text-center TBrdr' width='200'>"+ZPI18N.getString("zp.session")+"</th>"):(header+="<th class='text-center TBrdr' width='200'>"+ZPI18N.getString("zp.starttime")+"</th>",header+="<th class='text-center TBrdr' width='200'>"+ZPI18N.getString("zp.endtime")+"</th>",header+="<th class='text-center TBrdr' width='200'>"+ZPI18N.getString("zp.totalhours")+"</th>"),header+='<th id="approveChkBox" width="230" class="text-center B1 TBrdr"><div id="ODBulkApprovalRej" style="display:none"><i id="ODAllApprove" title="Approve" class="IC-rou-tik grn S18" onClick="Attendance.OD.allcheckAppRej(this,true);"></i></div><div id="ODApprovalState">'+ZPI18N.getString("zp.approvalstatus")+"</div></th></tr>",layout.find("#ZPAtt_OD_DetListHeader").html(header);var empName=result.details.employeeName+" - "+$("<div/>").text(result.details.employeeId).html();layout.find("#ZPAtt_OD_userName").html(empName),layout.find("#ZPAtt_ODDispDate").html(result.details.startDate+'<span class="ZPuscr">-</span>'+result.details.endDate);var desc=result.details.desc;desc||(desc="-"),layout.find("#ZPAtt_OD_desc").text(desc);var type=result.details.type;type||(type=ZPI18N.getString("zp.onduty")),layout.find("#ZPAtt_OD_type").text(type),Attendance.OD.removeAndAddClass(layout.find("#ZPAtt_OD_DetListHeader #ODAllApprove"),"gry","grn",ZPI18N.getString("zp.approve")),layout.find("#ODBulkApprovalRej").hide(),layout.find("#ODApprovalState").show(),result.approvalDetails&&-1==result.approvalDetails.currentApprovalStatus&&currentApprover&&(layout.find("#ODApprovalState").hide(),layout.find("#ODBulkApprovalRej").show()),$.each(result.details.odDetails,function(ind,ODDetails){var ODDetailsId=ODDetails.odDetailsId?ODDetails.odDetailsId:"",ODTableCons='<tr class="ZPLRow ODRow"><td class="text-center TBrdr"><div>'+ODDetails.originday+"</div></td>";if(0===unit){var dayTaken=ODDetails.dayTaken,session=ODDetails.session,durationText=ZPI18N.getString("zp.fullday"),sessionText="-";1===dayTaken?(durationText=ZPI18N.getString("zp.halfday"),sessionText=ZPI18N.getString("zp.secondhalf"),1===session&&(sessionText=ZPI18N.getString("zp.firsthalf"))):2===dayTaken&&(durationText=ZPI18N.getString("zp.quarterday"),sessionText=ZPI18N.getString("zp.fourthquarter"),1===session?sessionText=ZPI18N.getString("zp.firstquarter"):2===session?sessionText=ZPI18N.getString("zp.secondquarter"):3===session&&(sessionText=ZPI18N.getString("zp.thirdquarter"))),ODTableCons+='<td class="text-center TBrdr"><div>'+durationText+"</div></td>",ODTableCons+='<td class="text-center TBrdr"><div>'+sessionText+"</div></td>"}else ODTableCons+='<td class="text-center TBrdr"><div>'+ODDetails.startTime+"</div></td>",ODTableCons+='<td class="text-center TBrdr"><div>'+ODDetails.endTime+"</div></td>",ODTableCons+='<td class="text-center TBrdr"><div>'+Attendance.disHours(ODDetails.totalHrs)+"</div></td>";if(layout.find("#ZPAtt_OD_DetListHeader #approveChkBox").hide(),""!==ODDetailsId)if(layout.find("#ZPAtt_OD_DetListHeader #approveChkBox").show(),result.approvalDetails)if(-1==result.approvalDetails.currentApprovalStatus&&currentApprover){ODTableCons+='<td class="text-center TBrdr">';var approveRejectClass="gry",approveRejectTitle=ZPI18N.getString("zp.reject");1==ODDetails.status||-1==ODDetails.status?(approveRejectClass="grn",approveRejectTitle=ZPI18N.getString("zp.approve")):Attendance.OD.removeAndAddClass(layout.find("#ZPAtt_OD_DetListHeader #ODAllApprove"),"grn","gry",ZPI18N.getString("zp.reject")),ODTableCons+='<i id="indApprRejSelect" title="'+approveRejectTitle+'" odid="'+ODDetailsId+'" class="IC-rou-tik '+approveRejectClass+' S18" onClick="Attendance.OD.allcheckAppRej(this);"></i></td>'}else result.approvalDetails&&void 0!=result.approvalDetails.canceledRecord&&1==result.approvalDetails.canceledRecord?ODTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.cancelled")+"</td":1!=ODDetails.status||isRecordOwner&&1!=result.approvalDetails.currentApprovalStatus&&0!=result.approvalDetails.currentApprovalStatus?0!=ODDetails.status||isRecordOwner&&1!=result.approvalDetails.currentApprovalStatus&&0!=result.approvalDetails.currentApprovalStatus?8==ODDetails.status||8==result.approvalDetails.currentApprovalStatus?ODTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.deleted")+"</td":ODTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.waitingmsg")+"</td":ODTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.rejected")+"</td":ODTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.approved")+"</td";else 2==ODDetails.status?ODTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.cancelled")+"</td>":8==ODDetails.status?ODTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.deleted")+"</td>":-2==ODDetails.status?ODTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.submitted")+"</td>":ODTableCons+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.approved")+"</td>";layout.find("#ZPAtt_OD_DetListBody").append(ODTableCons)}),void 0!=result.details.isCancelPermitted&&1==result.details.isCancelPermitted&&layout.find("#cancelODIndividual").removeClass("DN"),void 0!=result.details.isClosePermitted&&1==result.details.isClosePermitted&&layout.find("#closeODIndividual").removeClass("DN"),layout.find("#cancelODIndividual").on("click",function(){Attendance.OD.cancelODWarning(result)}),Attendance.OD.approvalAttendDets=result;var otherDetails={isfromAttendence:!0};Attendance.OD.approvalSett&&ZPApprovals.initApprovalSettings({approvalSettingsDetails:Attendance.OD.approvalSett}),result.approvalDetails&&ZPApprovals.showApprovalHeader(result.approvalDetails.currentApprovalStatus,result.isRecordApprover,!!result.approvalDetails.isPrimaryAppr&&result.approvalDetails.isPrimaryAppr,otherDetails,result.approvalDetails)}else layout.find("#ZPAtt_OD_Details div.modal-body ").empty().append('<div class="ZPNdata"><i id="norecfoundimg"></i><p class="no-para"><br>'+ZPI18N.getString("zp.norec")+"<br></p></div>"),Attendance.noDataImg(8,"CR-nodata",layout.find(".ZPNdata #norecfoundimg"))})},cancelODWarning:function(result){ZPeople.BSModal.setup({id:"zp_confirmation_pop",type:1,header:'<div class="Icn grni"><i class="IC-tick whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.confirm")+"</h4>",body:'<div class="form-group"><p class="text-center MB15">'+ZPI18N.getString("zp.confirmregcancel")+'</p></div><div class="form-group" id="cancel_reason" style="height:90px"><div class="col-sm-12"><textarea class="form-control ZP-Input mandatory" style="width: 340px;margin: 0 auto;" name="remark" rows="5" placeholder="Reason For Cancellation"></textarea><span class="ERR text-center MT5 DN" id="cancel_reason_error" style="width: 100%;"></span></div></div>',modalClass:"modal fade ZPmdl in",buttonValue:ZPI18N.getString("zp.confirm"),successCallback:function(){Attendance.OD.cancelOD(result.details.recordId)},hiddenCallback:ZPApprovals.approveOrRejectActionHidden}).find(".btn-default").text(ZPI18N.getString("zp.cancel"))},removeAndAddClass:function(obj,classToBeRemoved,classToBeAdded,titleToBeChanged){void 0===classToBeRemoved&&""===classToBeRemoved||$(obj).removeClass(classToBeRemoved),void 0===classToBeAdded&&""===classToBeAdded||$(obj).addClass(classToBeAdded),void 0===titleToBeChanged&&""===titleToBeChanged||$(obj).attr("title",titleToBeChanged)},allcheckAppRej:function(obj,isAllChanged){var layout=Layout.Page.container,grayColorTitle=ZPI18N.getString("zp.reject"),greenColorTitle=ZPI18N.getString("zp.approve");isAllChanged?$(obj).hasClass("grn")?(Attendance.OD.removeAndAddClass(obj,"grn","gry",grayColorTitle),Attendance.OD.removeAndAddClass(layout.find("#ZPAtt_OD_DetListBody tr #indApprRejSelect"),"grn","gry",grayColorTitle)):(Attendance.OD.removeAndAddClass(obj,"gry","grn",greenColorTitle),Attendance.OD.removeAndAddClass(layout.find("#ZPAtt_OD_DetListBody tr #indApprRejSelect"),"gry","grn",greenColorTitle)):($(obj).hasClass("grn")?Attendance.OD.removeAndAddClass(obj,"grn","gry",grayColorTitle):Attendance.OD.removeAndAddClass(obj,"gry","grn",greenColorTitle),layout.find("#ZPAtt_OD_DetListBody tr #indApprRejSelect.grn").length===layout.find("#ZPAtt_OD_DetListBody tr #indApprRejSelect").length?Attendance.OD.removeAndAddClass(layout.find("#ZPAtt_OD_DetListHeader #ODAllApprove"),"gry","grn",greenColorTitle):Attendance.OD.removeAndAddClass(layout.find("#ZPAtt_OD_DetListHeader #ODAllApprove"),"grn","gry",grayColorTitle))},appRejODDetails:function(type,isAllLevelApprove,comment,odID,apprAct){var layout=Layout.Page.container,ODIdSelList=[],isUpdationNeeded=!1,appAttDet=Attendance.OD.approvalAttendDets;if(appAttDet&&appAttDet.details&&appAttDet.details.odDetails&&appAttDet.details.odDetails.length>0){if(appAttDet.details.odDetails[0].odDetailsId&&(isUpdationNeeded=!0),1==apprAct?(ODIdSelList.push(odID),isUpdationNeeded=!1):layout.find("#ZPAtt_OD_DetListBody tr #indApprRejSelect").each(function(){$(this).hasClass("grn")&&1==type&&ODIdSelList.push($(this).attr("odid"))}),1==type&&0===ODIdSelList.length&&isUpdationNeeded)return layout.find("[name='approvalBtn']").attr("disabled",!1),layout.find("#zp_approvereject_box").show(),layout.find("#zp_approval_confirm_btn").removeClass("disabled"),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectatleastoneODtoapprove"));var param={mode:"addAppStatusInODDets",conreqcsr:csrfToken};param.recId=ZPForm.CURRFORM_PARAM.recordId,param.isUpdationNeeded=isUpdationNeeded,ODIdSelList.length>0&&(param.ODIdSelList=JSON.stringify(ODIdSelList)),param.approvalStatus=type,param.isAllLevelApprove=isAllLevelApprove,param.comment=comment,param.formId=ZPForm.CURRFORM_PARAM.formId,$.post("/AttendanceAction.zp",param,function(rdata){ZPApprovals.approveRejectDtlCallBack(rdata,param),void 0!=rdata&&void 0!=rdata.approvalJson&&void 0!=rdata.approvalJson.processed&&1==rdata.approvalJson.processed[0].approvalStatus&&layout.find("#cancelODIndividual").removeClass("DN"),layout.find("#closeODIndividual").addClass("DN")})}},addODRequest:function(obj){var layout=Layout.Page.container,param={mode:"bulkAttendOD",conreqcsr:csrfToken};layout.find(".attRegErr").remove(),layout.find("#ZPAtt_OD_req_desc").next().remove();var isEmpChooseAppOD=ZPeople.Module.MODULE_DATA.attendance.isEmpChooseAppOD;(layout.find("#ZPAtt_tabView").is(":visible")||layout.find("#ZPAtt_listView").is(":visible"))&&null!==Attendance.Entry.erecno?param.erecno=Attendance.Entry.erecno:-1!==Layout.Page.hash.indexOf("attendance/onduty/myrequests")?param.erecno=layout.find("#ZPAtt_AddOD_Employee").select2("val"):param.erecno=erecno;var unit=layout.find("#ZPAtt_OD_AvailUnit").val().trim();param.unit=unit;var fdate=layout.find("#ZPAtt_OD_fromDate").val().trim(),tdate=layout.find("#ZPAtt_OD_toDate").val().trim();if(""!==fdate||""!==tdate){param.fdate=fdate,param.tdate=tdate;var desc=layout.find("#ZPAtt_OD_req_desc").val().trim();if(""!==desc){if(desc.length>1e3)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ondutydesclen"));param.desc=desc}else if(ZPeople.Module.MODULE_DATA.attendance.isOnDutyReasonMandatory)return void layout.find("#ZPAtt_OD_req_desc").after("<span class='ERR MT5'>"+ZPI18N.getString("zp.enterareason")+"</span>");var type=layout.find("#ZPAtt_OD_req_type").select2("val");""!==type&&(param.type=type);var dataObj={};if(isEmpChooseAppOD){var chosenErecno=Attendance.OD.getEmpChosenApprErecno(layout.find("#ZPAtt_AddODPage"));if("-Select-"===chosenErecno)return;param.empChoosenApprErecno=chosenErecno}if(Attendance.OD.isSubmit=!0,Attendance.OD.isChange=!1,layout.find("#ZPAtt_ODTableBody tr").each(function(){var userInputJson={},originDate=$(this).find("#ZPAtt_OD_date").attr("date_orgformat");if("1"===unit){if(!0===Attendance.OD.odFILOChanged(void 0,$(this))){var orgDate=Calendar.parseDate(originDate,uidateFormat),fTime=$(this).find("#ZPAtt_OD_fromTime").val().trim(),tTime=$(this).find("#ZPAtt_OD_toTime").val().trim();""!==fTime&&""!==tTime&&(fTime=Attendance.Common.convertTimerInputToMinsOrSecsFromDay(fTime,!1,!1,orgDate),tTime=Attendance.Common.convertTimerInputToMinsOrSecsFromDay(tTime,!1,!1,orgDate),userInputJson.ftime=fTime,userInputJson.ttime=tTime,dataObj[originDate]=userInputJson)}}else{var dayTaken=$(this).find("#ZPAtt_OD_dayTaken").select2("val");if("-1"!==dayTaken){if(userInputJson.dayTaken=dayTaken,"0"!==dayTaken){var session=$(this).find("#ZPAtt_OD_session").select2("val");userInputJson.session=session}dataObj[originDate]=userInputJson}}}),Attendance.OD.isChange=!0,Attendance.OD.isSubmit)if(Attendance.OD.isSubmit=!1,0!==Object.keys(dataObj).length)$(obj).attr("disabled","true"),param.isFromEntryPage="attendance-onduty-myrequests"!==Layout.Page.pageId,param.dataObj=JSON.stringify(dataObj),$.post("/AttendanceAction.zp",param,function(rdata){if($(obj).prop("disabled",!1),rdata.errorObj){if(rdata.errorObj.dateRangeError){var errorMsg="zp.leavetype.v2.error.daterange";return void ZPeople.Message.showFailureMsg(ZPI18N.getString(errorMsg))}if(rdata.errorObj.dateError){layout.find("#ZPAtt_ODTable").hide();errorMsg="zp.datewithinonemonth";return"lesserFromDate"==rdata.errorObj.dateError&&(errorMsg="zp.greaterfromdate"),"Future on duty requests are restricted"==rdata.errorObj.dateError&&(errorMsg="zp.ondutyfutureDateRestricted"),void ZPeople.Message.showFailureMsg(ZPI18N.getString(errorMsg))}for(var errDate in rdata.errorObj){if("typeErr"===errDate)return void ZPeople.Message.showWarningMsg(rdata.errorObj[errDate]);var dateId=errDate.replace(/\//g,"\\/");layout.find("#ZPAtt_ODTableBody #"+dateId).attr("errorDispRow",!0),layout.find("#ZPAtt_ODTableBody #"+dateId).css("height","70px"),"0"===unit?layout.find("#ZPAtt_ODTableBody #"+dateId+" td").eq(1).find("div").eq(1).append('<span class="attRegErr">'+rdata.errorObj[errDate]+"</span>"):layout.find("#ZPAtt_ODTableBody #"+dateId+" td").eq(1).find("div").eq(0).append('<span id="od_errorMsg" class="attRegErr">'+rdata.errorObj[errDate]+"</span>")}}else $(obj).next().trigger("click"),"attendance-onduty-myrequests"===Layout.Page.pageId?Attendance.OD.getRequest(!1,!1):Attendance.Entry.getList(Attendance.Entry.selectedView,Attendance.Entry.preMonth)});else{if("1"===unit){var divName=layout.find("#ZPAtt_ODTableBody").find("#od_errorMsg").length>0?layout.find("#ZPAtt_ODTableBody").find("#od_errorMsg"):layout.find("#ZPAtt_ODTableBody").find("#od_errorMsg_to");$(divName).closest("tr").css("height","44px"),$(divName).closest("tr").find("#ZPAtt_OD_totalHours").html(""),$(divName).remove()}ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maperror",new Array(ZPI18N.getString("zp.day"))))}}},getDayRecordJson:null,getAttFiloInfo:function(){var layout=Layout.Page.container,param={mode:"getAttFiloInfo",conreqcsr:csrfToken,isAddODRequest:!0};layout.find("#ZPAtt_ODTable").hide(),layout.find("#ZPAtt_OD_req_desc").next().remove();var fdate=layout.find("#ZPAtt_OD_fromDate").val().trim(),tdate=layout.find("#ZPAtt_OD_toDate").val().trim();if(""===fdate&&""===tdate)param.rangeType=0;else if(""===fdate||""===tdate)return;param.fromDate=fdate,param.toDate=tdate,(layout.find("#ZPAtt_tabView").is(":visible")||layout.find("#ZPAtt_listView").is(":visible"))&&null!==Attendance.Entry.erecno?param.erecno=Attendance.Entry.erecno:-1!==Layout.Page.hash.indexOf("attendance/onduty/myrequests")?param.erecno=layout.find("#ZPAtt_AddOD_Employee").select2("val"):param.erecno=erecno,layout.find("#ZPAtt_ODTable").hide(),$.post("/AttendanceAction.zp",param,function(rdata){if(rdata.dateError){layout.find("#ZPAtt_ODTable").hide();var errorMsg="zp.datewithinonemonth";"lesserFromDate"==rdata.dateError&&(errorMsg="zp.greaterfromdate"),ZPeople.Message.showFailureMsg(ZPI18N.getString(errorMsg))}else rdata.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")):rdata.regDetails&&(Attendance.OD.getDayRecordJson=rdata,Attendance.OD.consODPopup())})},consODPopup:function(){var layout=Layout.Page.container,dayList=Attendance.OD.getDayRecordJson.regDetails.dayList;layout.find("#ZPAtt_OD_fromDate").val(Attendance.OD.getDayRecordJson.regDetails.startDate),layout.find("#ZPAtt_OD_toDate").val(Attendance.OD.getDayRecordJson.regDetails.endDate);var odTypes=ZPeople.Module.MODULE_DATA.attendance.attODTypes;if(Object.keys(odTypes).length>0){var types="";$.each(odTypes,function(id,val){""===types?types="<option value='"+id+"'>"+$("<div/>").text(val).html()+"</option>":types+="<option value='"+id+"'>"+$("<div/>").text(val).html()+"</option>"}),layout.find("#ZPAtt_OD_req_type").html(types),layout.find("#ZPAtt_OD_req_type").select2("val",layout.find("#ZPAtt_OD_req_type option")[0].value)}else{types="<option value ='0'>"+ZPI18N.getString("zp.onduty")+"</option>";layout.find("#ZPAtt_OD_req_type").html(types),layout.find("#ZPAtt_OD_req_type").select2("val",layout.find("#ZPAtt_OD_req_type option")[0].value)}layout.find("#ZPAtt_OD_ReasonCont").remove();var addPopTab=layout.find("#ZPAtt_ODTable");addPopTab.show();var isHourUnit="1"===layout.find("#ZPAtt_OD_AvailUnit").val(),tabHeaderCont="";isHourUnit?(tabHeaderCont+="<th width='140'></th>",tabHeaderCont+="<th width='200' class='zp_mdt'><font>"+ZPI18N.getString("zp.local.FromTime")+"</font></th>",tabHeaderCont+="<th width='200' class='zp_mdt'><font>"+ZPI18N.getString("zp.local.ToTime")+"</font></th>",tabHeaderCont+="<th width='150'>"+ZPI18N.getString("zp.totalhours")+"</th>",tabHeaderCont+="<th></th>"):(tabHeaderCont+="<th width='160'></th>",tabHeaderCont+="<th width='230' class='zp_mdt'><font>"+ZPI18N.getString("zp.duration")+"</font></th>",tabHeaderCont+="<th width='230'>"+ZPI18N.getString("zp.session")+"</th>",tabHeaderCont+="<th></th>"),addPopTab.find("thead tr").html(tabHeaderCont);var tabBody=addPopTab.find("#ZPAtt_ODTableBody");for(var i in tabBody.html(""),dayList){var attDataForDay=Attendance.OD.getDayRecordJson.regDetails[dayList[i]],colorClass="";attDataForDay.isPaidLeave?colorClass+=" leave-border":attDataForDay.isUnPaidLeave?colorClass+=" lop-border":attDataForDay.isOnDuty?colorClass+=" onduty-border":attDataForDay.isWeekend?colorClass+=" wkend-border":attDataForDay.isHoliday?colorClass+=" holiday-border":attDataForDay.isAbsent&&(colorClass+=" absent-border");var tabBodyCont="<tr class='ZPLRow'>";if(tabBodyCont+="<td><span class='DB MB3' id='ZPAtt_OD_date' date_orgformat='"+dayList[i]+"' >"+attDataForDay.dispMonthDate+"</span><span class='DB dgry ZPOD'> "+attDataForDay.dispDay+" </span></td>",isHourUnit){var minDt=Calendar.parseDate(dayList[i],uidateFormat),maxDt=Calendar.parseDate(dayList[i],uidateFormat);maxDt.setDate(maxDt.getDate()+1);var settingsObjStr='{mindate:"'+minDt+'",maxdate:"'+maxDt+'",selectedDate:"'+minDt+'"}';tabBodyCont+="<td id='filoDiv' class='text-center'><div class='zpcal'>",tabBodyCont+="<input id='ZPAtt_OD_fromTime' onClick='Calendar.setUpCalendar(event, this,1,undefined,Attendance.OD.odFILOChanged,undefined,"+settingsObjStr+");' placeholder='"+ZPI18N.getString("zp.local.FromTime")+"' class='form-control zptxt-edit"+colorClass+"' type='text'",tabBodyCont+="autocomplete='off' fieldtype='22' autofillby='0' caltype='popup' bordertag='true' value=''></div></td>",tabBodyCont+="<td id='filoDiv' class='text-center'><div class='zpcal'>",tabBodyCont+="<input id='ZPAtt_OD_toTime' onClick='Calendar.setUpCalendar(event, this,1,undefined,Attendance.OD.odFILOChanged,undefined,"+settingsObjStr+");' placeholder='"+ZPI18N.getString("zp.local.ToTime")+"' class='form-control zptxt-edit"+colorClass+"' type='text'",tabBodyCont+="autocomplete='off' fieldtype='22' autofillby='0' caltype='popup' bordertag='true' value=''></div></td>",tabBodyCont+="<td id='totalHoursDiv'><span id='ZPAtt_OD_totalHours'></span></td>",tabBodyCont+="<td></td></tr>",tabBody.append(tabBodyCont),(addedCont=tabBody.find("tr:last-child")).attr("id",dayList[i]),addedCont.find("#ZPAtt_OD_fromTime").on("change",function(){Attendance.OD.odFILOChanged(void 0,addedCont)}),addedCont.find("#ZPAtt_OD_toTime").on("change",function(){Attendance.OD.odFILOChanged(void 0,addedCont)})}else{var addedCont;tabBodyCont+="<td><div class='form-group'><div class='col-sm-12 P0'><select class='select2-container W300A' id='ZPAtt_OD_dayTaken'>",tabBodyCont+="<option value='-1'>"+ZPI18N.getString("zp.select")+"</option>",ZPeople.Module.MODULE_DATA.attendance.isOnDutyFullDayEnabled&&(tabBodyCont+="<option value='0'>"+ZPI18N.getString("zp.fullday")+"</option>"),ZPeople.Module.MODULE_DATA.attendance.isOnDutyHalfDayEnabled&&(tabBodyCont+="<option value='1'>"+ZPI18N.getString("zp.halfday")+"</option>"),ZPeople.Module.MODULE_DATA.attendance.isOnDutyQuatDayEnabled&&(tabBodyCont+="<option value='2'>"+ZPI18N.getString("zp.quarterday")+"</option>"),tabBodyCont+="</select></div></div></td>",tabBodyCont+="<td><div class='form-group DN'><div class='col-sm-12 P0'><select class='select2-container W300A' id='ZPAtt_OD_session'>",tabBodyCont+="</select></div></div><div class='form-group'><span class='ML20'>-</span></div></td>",tabBodyCont+="<td></td></tr>",tabBody.append(tabBodyCont),(addedCont=tabBody.find("tr:last-child")).find("select").select2({minimumResultsForSearch:-1})," wkend-border"!==colorClass&&"holiday-border"!==colorClass&&(ZPeople.Module.MODULE_DATA.attendance.isOnDutyFullDayEnabled?addedCont.find("#ZPAtt_OD_dayTaken").select2("val","0"):ZPeople.Module.MODULE_DATA.attendance.isOnDutyHalfDayEnabled?(addedCont.find("#ZPAtt_OD_dayTaken").select2("val","1"),Attendance.OD.odOnDuraChanged(addedCont.find("#ZPAtt_OD_dayTaken"))):(addedCont.find("#ZPAtt_OD_dayTaken").select2("val","2"),Attendance.OD.odOnDuraChanged(addedCont.find("#ZPAtt_OD_dayTaken")))),addedCont.find("#ZPAtt_OD_dayTaken").on("change",function(){Attendance.OD.odOnDuraChanged(this)}),addedCont.attr("id",dayList[i]),addedCont.find(".select2-container").addClass(colorClass),""!==colorClass&&addedCont.find(".select2-container").css("border","1px solid")}}var mandReas='PT8">'+ZPI18N.getString("zp.reason");ZPeople.Module.MODULE_DATA.attendance.isOnDutyReasonMandatory&&(mandReas='zp_mdt PT8"><font>'+ZPI18N.getString("zp.reason")+"</font>");var reason='<div class="row" id="ZPAtt_OD_ReasonCont"><div class="col-sm-7"><form class="form-horizontal"><div class="form-group PL40" style="margin-bottom: 25px;">';reason+='<label class="col-sm-3 '+mandReas+'</label><div class="col-sm-7 PL0"><textarea class="H70 form-control" placeholder="'+ZPI18N.getString("zp.reason")+'" id="ZPAtt_OD_req_desc"></textarea>',reason+="</div></div></form></div></div>",tabBody.closest(".modal-body").append(reason),tabBody.fadeIn()},resetODPopup:function(){var layout=Layout.Page.container;layout.find("#ZPAtt_OD_toDate").val("").trigger("change"),ZPeople.Module.MODULE_DATA.attendance.isOnDutyFullDayEnabled||ZPeople.Module.MODULE_DATA.attendance.isOnDutyHalfDayEnabled||ZPeople.Module.MODULE_DATA.attendance.isOnDutyQuatDayEnabled?layout.find("#ZPAtt_OD_AvailUnit").select2("val","0"):layout.find("#ZPAtt_OD_AvailUnit").select2("val","1"),layout.find("#ZPAtt_OD_fromDate").val("")},odOnDuraChanged:function(obj){var currObjVal=$(obj).select2("val"),sessioSel=$(obj).closest("tr").find("#ZPAtt_OD_session");if(sessioSel.closest(".form-group").removeClass("DN"),sessioSel.closest(".form-group").next().addClass("DN"),"-1"===currObjVal||"0"===currObjVal)sessioSel.html("").closest(".form-group").addClass("DN"),sessioSel.closest(".form-group").next().removeClass("DN"),sessioSel.select2("val","");else if("1"===currObjVal){var opt="<option value='1'>"+ZPI18N.getString("zp.firsthalf")+"</option>";opt+="<option value='2'>"+ZPI18N.getString("zp.secondhalf")+"</option>",sessioSel.html(opt),sessioSel.select2("val","1")}else{opt="<option value='1'>"+ZPI18N.getString("zp.firstquarter")+"</option>";opt+="<option value='2'>"+ZPI18N.getString("zp.secondquarter")+"</option>",opt+="<option value='3'>"+ZPI18N.getString("zp.thirdquarter")+"</option>",opt+="<option value='4'>"+ZPI18N.getString("zp.fourthquarter")+"</option>",sessioSel.html(opt),sessioSel.select2("val","1")}},isSubmit:!1,isChange:!0,odFILOChanged:function(tmpDateObj,obj){var tableRow=$(obj).closest("tr"),odFromTime=tableRow.find("#ZPAtt_OD_fromTime").val().trim(),odToTime=tableRow.find("#ZPAtt_OD_toTime").val().trim(),attDate=tableRow.attr("id"),minDt=Calendar.parseDate(attDate,uidateFormat),maxDt=Calendar.parseDate(attDate,uidateFormat);if(maxDt.setDate(maxDt.getDate()+1),tableRow.find("#od_errorMsg").remove(),tableRow.find("#od_errorMsg_to").remove(),tableRow.css("height","44px"),tableRow.find("#ZPAtt_OD_totalHours").html(""),!0===Attendance.OD.isSubmit||!0===Attendance.OD.isChange){if(""!==odFromTime){var odFormatTime=odFromTime.split(" ")[1]+" "+odFromTime.split(" ")[2],odFromHours=parseInt(odFormatTime.split(":")[0],10),odFromMin=parseInt(odFormatTime.split(":")[1],10),invalidFromTime=!1;if(invalidFromTime=Attendance.timeFormatIs12hr?odFromHours>12||invalidFromTime:odFromHours>23||invalidFromTime,invalidFromTime=odFromMin>60||invalidFromTime)return Attendance.OD.isSubmit=!1,tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="od_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.attendance.regInvalidFromEntry")+"</span>")}if(""!==odToTime){odFormatTime=odToTime.split(" ")[1]+" "+odToTime.split(" ")[2];var odToHours=parseInt(odFormatTime.split(":")[0],10),odToMin=parseInt(odFormatTime.split(":")[1],10),invalidToTime=!1;if(invalidToTime=Attendance.timeFormatIs12hr?odToHours>12||invalidToTime:odToHours>23||invalidToTime,invalidToTime=odToMin>60||invalidToTime)return Attendance.OD.isSubmit=!1,tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(1).find("div").append('<span id="od_errorMsg_to" class="attRegErr">'+ZPI18N.getString("zp.attendance.regInvalidToEntry")+"</span>")}if(""!==odFromTime&&""!==odToTime){var odFromDate=Calendar.parseDate(odFromTime.split(" ")[0],uidateFormat),odToDate=Calendar.parseDate(odToTime.split(" ")[0],uidateFormat);if(odFromDate<minDt||odFromDate>maxDt)return Attendance.OD.isSubmit=!1,tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="od_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.attendance.regInvalidDate")+"</span>");if(odToDate<minDt||odToDate>maxDt)return Attendance.OD.isSubmit=!1,tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(1).find("div").append('<span id="od_errorMsg_to" class="attRegErr">'+ZPI18N.getString("zp.attendance.regInvalidDate")+"</span>");if(odFromTime=Attendance.Common.convertTimerInputToMinsOrSecsFromDay(odFromTime,!1,!1,odFromDate),odToTime=Attendance.Common.convertTimerInputToMinsOrSecsFromDay(odToTime,!1,!1,odFromDate),odToDate>odFromDate&&odToTime>odFromTime+1440)return Attendance.OD.isSubmit=!1,tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="od_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.timeexceeded24")+"</span>");if(odFromDate.getTime()===odToDate.getTime()&&odToTime<odFromTime||odFromDate>odToDate)return Attendance.OD.isSubmit=!1,tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="od_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.inshouldbebeforeout")+"</span>");var shiftAllowedTimings=Attendance.OD.getDayRecordJson.regDetails[tableRow.attr("id")].shiftAllowedTimings,totalHours=Attendance.Reg.getTotalHoursBasedOnShift(shiftAllowedTimings,odFromTime,odToTime);return tableRow.find("#ZPAtt_OD_totalHours").html(Attendance.disHours(parseInt(totalHours),!0)),odFromDate.getTime()!==odToDate.getTime()||odToTime!==odFromTime||(Attendance.OD.isSubmit=!1,tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),void tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="od_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.totalhourszero")+"</span>"))}if(1==Attendance.OD.isSubmit){var fromDate=Calendar.parseDate(Layout.Page.container.find("#ZPAtt_OD_fromDate").val()+"",uidateFormat),toDate=Calendar.parseDate(Layout.Page.container.find("#ZPAtt_OD_toDate").val()+"",uidateFormat),unitSel=Layout.Page.container.find("#s2id_ZPAtt_OD_AvailUnit").text().trim();fromDate.diffTodays(toDate)>31?(Attendance.OD.isSubmit=!1,Layout.Page.container.find("#ZPAtt_ODTable").hide(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinonemonth"))):"Hours"===unitSel&&""===odFromTime&&""!==odToTime?(Attendance.OD.isSubmit=!1,tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),tableRow.find(" #filoDiv").eq(0).find("div").append('<span id="od_errorMsg" class="attRegErr">'+ZPI18N.getString("zp.fromtimeemptyerr")+"</span>")):"Hours"===unitSel&&""!==odFromTime&&""===odToTime&&(Attendance.OD.isSubmit=!1,tableRow.attr("errorDispRow",!0),tableRow.css("height","70px"),tableRow.find(" #filoDiv").eq(1).find("div").append('<span id="od_errorMsg_to" class="attRegErr">'+ZPI18N.getString("zp.totimeemptyerr")+"</span>"))}}},onODUnitChange:function(){Attendance.OD.isHoursODEnabled&&Attendance.OD.isDaysODEnabled&&(Layout.Page.container.find("#ZPAtt_OD_Daywise").is(":checked")?(Attendance.ODImport.isDayWise=0,Layout.Page.container.find("#ZPAtt_OD_Hourwise").attr("checked",!1),Layout.Page.container.find("#ZPAtt_OD_Daywise").attr("checked",!0),Layout.Page.container.find("#ZPAtt_OD_Daywise_Sample").removeClass("DN"),Layout.Page.container.find("#ZPAtt_OD_Hourwise_Sample").addClass("DN")):(Attendance.ODImport.isDayWise=1,Layout.Page.container.find("#ZPAtt_OD_Daywise").attr("checked",!1),Layout.Page.container.find("#ZPAtt_OD_Hourwise").attr("checked",!0),Layout.Page.container.find("#ZPAtt_OD_Hourwise_Sample").removeClass("DN"),Layout.Page.container.find("#ZPAtt_OD_Daywise_Sample").addClass("DN")))},showReqAddPopup:function(obj,date){var layout=Layout.Page.container;ZPeople.BSModal.show(layout.find("#ZPAtt_AddODPage")),$("#ZPAtt_OD_AvailUnit option[value='0']").remove(),(ZPeople.Module.MODULE_DATA.attendance.isOnDutyFullDayEnabled||ZPeople.Module.MODULE_DATA.attendance.isOnDutyHalfDayEnabled||ZPeople.Module.MODULE_DATA.attendance.isOnDutyQuatDayEnabled)&&layout.find("#ZPAtt_OD_AvailUnit").append('<option value="0">'+ZPI18N.getString("zp.wfdays")+"</option>"),$("#ZPAtt_OD_AvailUnit option[value='1']").remove(),ZPeople.Module.MODULE_DATA.attendance.isOnDutyHoursEnabled&&layout.find("#ZPAtt_OD_AvailUnit").append('<option value="1">'+ZPI18N.getString("zp.hourslog")+"</option>"),layout.find("#s2id_ZPAtt_OD_AvailUnit")[0]||(layout.find("#ZPAtt_OD_AvailUnit").select2(),layout.find("#ZPAtt_OD_req_type").select2()),"attendance-onduty-myrequests"===Layout.Page.pageId?(layout.find("#ZPAtt_AddOD_Employee").parent().parent().show(),Attendance.consResetEmpSearch("ZPAtt_AddOD_Employee",layout,!0,!1)):(layout.find("#ZPAtt_AddODPage").off("hide.bs.modal").on("hide.bs.modal",function(){Attendance.OD.resetODPopup()}),layout.find("#ZPAtt_AddOD_Employee").parent().parent().hide()),layout.find("#ZPAtt_AddODPage").find("#ZPAtt_OD_chooseAppr").hide(),layout.find("#ZPAtt_AddODPage").find("#emptyErrMsg").html(""),layout.find("#ZPAtt_AddODPage").find("#emptyErrMsg").removeClass("MB10"),isEmpChooseAppOD&&(layout.find("#ZPAtt_AddODPage").find("#ZPAtt_OD_approverId").parent().parent().show(),layout.find("#ZPAtt_AddODPage").find("#ZPAtt_OD_approverId").empty(),layout.find("#ZPAtt_AddODPage").find("#ZPAtt_OD_approverId").append(ZPeople.User.getEmployeeListFormatByType("option")),layout.find("#ZPAtt_AddODPage").find("#ZPAtt_OD_approverId").select2()),Attendance.OD.resetODPopup(obj,date)},getEmpChosenApprErecno:function(layout){layout.find("#emptyErrMsg").removeClass("MB10"),layout.find("#emptyErrMsg").html("");var appErecno=layout.find("#ZPAtt_OD_approverId").val();return"-Select-"===appErecno&&(layout.find("#emptyErrMsg").addClass("MB10"),layout.find("#emptyErrMsg").html(ZPI18N.getString("zp.chooseapprovererrormsg"))),appErecno}},Attendance.ODImport={isDayWise:0,showImport:function(){var attModule=ZPeople.Module.MODULE_DATA.attendance;Attendance.OD.isDaysODEnabled=attModule.isOnDutyFullDayEnabled||attModule.isOnDutyHalfDayEnabled||attModule.isOnDutyQuatDayEnabled,Attendance.OD.isHoursODEnabled=attModule.isOnDutyHoursEnabled,ZPeople.BSModal.show($("#"+Layout.Page.pageId+" #ZPAtt_OD_importPopup"));var ODImportParent=Layout.Page.container.find("#ZPAtt_OD_importPopup");ODImportParent.find("#ZPAtt_OD_importSuccMsg").hide(),ODImportParent.find("#ZPAtt_OD_importSuccvalues").hide(),ODImportParent.find("#ZPAtt_OD_import").parent().parent().removeAttr("class"),ODImportParent.find("#ZPAtt_OD_import").fadeIn(300),ODImportParent.find("#ZPAtt_OD_impEx").fadeIn(300),ODImportParent.find("#ZPAtt_OD_importFileConf").hide(),ODImportParent.find("#ZPAtt_OD_importMap").hide(),ODImportParent.find("#ZPAtt_OD_importInput").val(""),ODImportParent.find("#ZPAtt_OD_importDesc").after(ODImportParent.find("#ZPAtt_OD_importInputCont").show()),ODImportParent.find("#ZPAtt_OD_importInputCont span").text(ZPI18N.getString("zp.importfile")),ODImportParent.find("#ZPAtt_OD_importInputCont").attr("class","btn btn-primary ZPbtnDefault"),ODImportParent.find("#ZPAtt_OD_importNext").hide(),ODImportParent.find("#ZPAtt_OD_importPrevious").hide(),ODImportParent.find("#ZPAtt_OD_importHeader li").first().attr("class","active"),ODImportParent.find("#ZPAtt_OD_importHeader li").last().removeAttr("class"),ODImportParent.find("#ZPAtt_OD_importMsg").parent().hide(),ODImportParent.find("#ODUnitDiv").parent().addClass("DN"),ODImportParent.find("#ZPAtt_ODImport_Note").closest("p").addClass("DN"),ODImportParent.find("#ZPAtt_OD_Daywise_Sample").addClass("DN"),ODImportParent.find("#ZPAtt_OD_Hourwise_Sample").addClass("DN"),ODImportParent.find("#ZPAtt_ODImport_Note").addClass("DN"),Attendance.ODImport.isDayWise=0,Attendance.OD.isHoursODEnabled&&Attendance.OD.isDaysODEnabled?(ODImportParent.find("#ODUnitDiv").parent().removeClass("DN"),ODImportParent.find("#ZPAtt_ODImport_Note").closest("p").removeClass("DN"),ODImportParent.find("#ZPAtt_ODImport_Note").removeClass("DN"),ODImportParent.find("#ZPAtt_OD_Daywise").is(":checked")?(Attendance.ODImport.isDayWise=0,ODImportParent.find("#ZPAtt_OD_Daywise_Sample").removeClass("DN"),ODImportParent.find("#ZPAtt_OD_Hourwise").attr("checked",!1)):ODImportParent.find("#ZPAtt_OD_Hourwise").is(":checked")&&(Attendance.ODImport.isDayWise=1,ODImportParent.find("#ZPAtt_OD_Hourwise_Sample").removeClass("DN"),ODImportParent.find("#ZPAtt_OD_Daywise").attr("checked",!1))):Attendance.OD.isHoursODEnabled?(Attendance.ODImport.isDayWise=1,ODImportParent.find("#ZPAtt_OD_Hourwise_Sample").removeClass("DN")):Attendance.OD.isDaysODEnabled&&(Attendance.ODImport.isDayWise=0,ODImportParent.find("#ZPAtt_OD_Daywise_Sample").removeClass("DN")),Layout.Page.container.find("#ZPAtt_OD_importPopup .modal-body").find("#zp_page_loading").remove(),Layout.Page.container.find("#ZPAtt_OD_importPopup .modal-body").children().show(),Layout.Page.container.find("#importErrDiv").hide()},onInputChange:function(){var ODImportParent=Layout.Page.container.find("#ZPAtt_OD_importPopup"),fileName=ODImportParent.find("#ZPAtt_OD_importInput").val();ODImportParent.find("#ZPAtt_OD_importProgress").hide(),ODImportParent.find("#ZPAtt_OD_importProgress").next().show(),fileName=fileName.replace("C:\\fakepath\\",""),ODImportParent.find("#ZPAtt_OD_importFName").text(fileName),ODImportParent.find("#ZPAtt_OD_importSuccMsg").hide(),ODImportParent.find("#ZPAtt_OD_importSuccvalues").hide(),ODImportParent.find("#ZPAtt_OD_importProgress").after(ODImportParent.find("#ZPAtt_OD_importInputCont")),ODImportParent.find("#ZPAtt_OD_importInputCont span").text(ZPI18N.getString("zp.removeandnew")),ODImportParent.find("#ZPAtt_OD_importInputCont").attr("class","btn btn-default ZPbtnDefault");var extn=fileName.split(".").pop();"xls"===extn||"csv"===extn?(ODImportParent.find("#ZPAtt_OD_importFName").next().attr("class","IC-rou-tik ML5 filetck"),ODImportParent.find("#ZPAtt_OD_importNext").fadeIn(300),Layout.Page.container.find("#ZPAtt_OD_importNext").attr("disabled",!1),ODImportParent.find("#ZPAtt_OD_importNext").off("click").on("click",function(){Attendance.ODImport.submitImport()})):(ODImportParent.find("#ZPAtt_OD_importFName").next().attr("class","IC-r-close ML5 PR S18 red"),ODImportParent.find("#ZPAtt_OD_importNext").hide(),ODImportParent.find("#ZPAtt_OD_importInput").val(""),""===ODImportParent.find("#ZPAtt_OD_importFName").text()&&ODImportParent.find("#ZPAtt_OD_importFName").text(ZPI18N.getString("zp.choosefile"))),ODImportParent.find("#ZPAtt_OD_import").hide(),ODImportParent.find("#ZPAtt_OD_impEx").hide(),ODImportParent.find("#ZPAtt_OD_importFileConf").fadeIn(300),ODImportParent.find("#ZPAtt_OD_importMap").hide()},submitImport:function(){var ODImportParent=Layout.Page.container.find("#ZPAtt_OD_importPopup");ODImportParent.find("#ZPAtt_OD_importNext").off("click"),Attendance.ODImport.ProgressBarWidth=0,ODImportParent.find("#ZPAtt_OD_importProgress").next().hide(),ODImportParent.find("#ZPAtt_OD_importProgress div").width(Attendance.ODImport.ProgressBarWidth+"%").parent().show(),Attendance.ODImport.showProgress(ODImportParent);var form=ODImportParent.find("#ZPAtt_OD_importInput")[0].form;""!==ODImportParent.find("#ZPAtt_OD_importInput").val()&&(Layout.Page.container.find("#ZPAtt_OD_importNext").attr("disabled",!0),Layout.Page.container.find("#ZPAtt_OD_importFormCsrf").val(csrfToken),form.action="AttendanceImport.zp",form.submit())},ProgressBarWidth:0,showProgress:function(){Layout.Page.container.find("#ZPAtt_OD_importPopup").find("#ZPAtt_OD_importProgress div").width(Attendance.ODImport.ProgressBarWidth+"%"),Attendance.ODImport.ProgressBarWidth+=2,Attendance.ODImport.ProgressBarWidth<=99&&setTimeout(Attendance.ODImport.showProgress,1)},showMapping:function(obj){var ODImportParent=Layout.Page.container.find("#ZPAtt_OD_importPopup");ODImportParent.find("#ZPAtt_OD_importNext").attr("disabled",!1),ODImportParent.find("#ZPAtt_OD_import").hide(),ODImportParent.find("#ZPAtt_OD_impEx").hide(),ODImportParent.find("#ZPAtt_OD_importFileConf").hide(),ODImportParent.find("#ZPAtt_OD_importMap").fadeIn(300),ODImportParent.find("#ZPAtt_OD_importPrevious").fadeIn(300),ODImportParent.find("#ZPAtt_OD_importNext").fadeIn(300),ODImportParent.find("#ZPAtt_OD_importHeader li").last().attr("class","active"),ODImportParent.find("#ZPAtt_OD_importNext").off("click").on("click",function(){Attendance.ODImport.submitODMapping(obj.fileFormat,ODImportParent)});var rArray=obj.tableHeaders,res="<option value='None' selected='selected'>-- "+ZPI18N.getString("zp.select")+" --</option>";for(var i in rArray)res+="<option value='"+i+"'>"+rArray[i]+"</option>";for(var i in ODImportParent.find("#ZPAtt_OD_importMap select").select2(),"csv"!==obj.fileFormat?ODImportParent.find("#ZPAtt_OD_importDateFor label").html(ZPI18N.getString("zp.dateformat")):ODImportParent.find("#ZPAtt_OD_importDateFor label").html("<font>"+ZPI18N.getString("zp.dateformat")+"</font>"),ODImportParent.find("#ZPAtt_OD_importDateFor select").select2("val","0"),ODImportParent.find("#ZPAtt_OD_importIds select").html(res),ODImportParent.find("#ZPAtt_OD_importType select").html(res),ODImportParent.find("#ZPAtt_OD_importFDate").show(),ODImportParent.find("#ZPAtt_OD_importTDate").show(),ODImportParent.find("#ZPAtt_OD_importDuration").show(),ODImportParent.find("#ZPAtt_OD_importSession").show(),ODImportParent.find("#ZPAtt_OD_importAttDate").show(),ODImportParent.find("#ZPAtt_OD_importFTime").show(),ODImportParent.find("#ZPAtt_OD_importTTime").show(),0===Attendance.ODImport.isDayWise?(ODImportParent.find("#ZPAtt_OD_importFDate select").html(res),ODImportParent.find("#ZPAtt_OD_importTDate select").html(res),ODImportParent.find("#ZPAtt_OD_importDuration select").html(res),ODImportParent.find("#ZPAtt_OD_importSession select").html(res),ODImportParent.find("#ZPAtt_OD_importAttDate").hide(),ODImportParent.find("#ZPAtt_OD_importFTime").hide(),ODImportParent.find("#ZPAtt_OD_importTTime").hide()):(ODImportParent.find("#ZPAtt_OD_importAttDate select").html(res),ODImportParent.find("#ZPAtt_OD_importFTime select").html(res),ODImportParent.find("#ZPAtt_OD_importTTime select").html(res),ODImportParent.find("#ZPAtt_OD_importFDate").hide(),ODImportParent.find("#ZPAtt_OD_importTDate").hide(),ODImportParent.find("#ZPAtt_OD_importDuration").hide(),ODImportParent.find("#ZPAtt_OD_importSession").hide()),ODImportParent.find("#ZPAtt_OD_importReason select").html(res),rArray){var colName=rArray[i].toLowerCase();-1!==colName.indexOf("employee")||-1!==colName.indexOf("id")||-1!==colName.indexOf("user")||-1!==colName.indexOf("mail")?ODImportParent.find("#ZPAtt_OD_importIds select").select2("val",i+""):-1!==colName.indexOf("type")?ODImportParent.find("#ZPAtt_OD_importType select").select2("val",i+""):-1!==colName.indexOf("from")?ODImportParent.find("#ZPAtt_OD_importFDate select").select2("val",i+""):-1!==colName.indexOf("to")?ODImportParent.find("#ZPAtt_OD_importTDate select").select2("val",i+""):-1!==colName.indexOf("date")?ODImportParent.find("#ZPAtt_OD_importAttDate select").select2("val",i+""):-1!==colName.indexOf("duration")?ODImportParent.find("#ZPAtt_OD_importDuration select").select2("val",i+""):-1!==colName.indexOf("session")?ODImportParent.find("#ZPAtt_OD_importSession select").select2("val",i+""):-1!==colName.indexOf("start")?ODImportParent.find("#ZPAtt_OD_importFTime select").select2("val",i+""):-1!==colName.indexOf("end")?ODImportParent.find("#ZPAtt_OD_importTTime select").select2("val",i+""):-1===colName.indexOf("reason")&&-1===colName.indexOf("desc")||ODImportParent.find("#ZPAtt_OD_importReason select").select2("val",i+"")}ODImportParent.find("#ZPAtt_OD_importReason label").html(ZPI18N.getString("zp.reason")),ZPeople.Module.MODULE_DATA.attendance.isOnDutyReasonMandatory&&ODImportParent.find("#ZPAtt_OD_importReason label").html("<font>"+ZPI18N.getString("zp.reason")+"</font>"),ODImportParent.find("#ZPAtt_OD_importMsg").off("click"),ODImportParent.find("#ZPAtt_OD_importMsg").attr("class","blu"),ODImportParent.find("#ZPAtt_OD_importMsg").parent().fadeIn(300),obj.error&&"rowExceededLimit"===obj.error?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.importcntexceederror"),!0),ODImportParent.find("#ZPAtt_OD_importNext").attr("disabled",!0),ODImportParent.find("#ZPAtt_OD_importMsg").text("")):void 0!==obj.recordCount?ODImportParent.find("#ZPAtt_OD_importMsg").text(obj.recordCount+" "+ZPI18N.getString("zp.recordsfound")):ODImportParent.find("#ZPAtt_OD_importMsg").text("0 "+ZPI18N.getString("zp.recordsfound")),ODImportParent.find("#ZPAtt_OD_importMap select").select2()},submitODMapping:function(fileFormat){var ODImportParent=Layout.Page.container.find("#ZPAtt_OD_importPopup");Attendance.Entry.reloadFromWMS=!1;var si_FDate,si_TDate,si_Duration,si_Session,si_AttDate,si_FTime,si_TTime,si_Id=ODImportParent.find("#ZPAtt_OD_importIds select")[0].selectedIndex,si_Type=ODImportParent.find("#ZPAtt_OD_importType select")[0].selectedIndex,si_Reson=ODImportParent.find("#ZPAtt_OD_importReason select")[0].selectedIndex,isValid=!0;if(0!==si_Id&&0!==si_Type||(isValid=!1),0===Attendance.ODImport.isDayWise?(si_FDate=ODImportParent.find("#ZPAtt_OD_importFDate select")[0].selectedIndex,si_TDate=ODImportParent.find("#ZPAtt_OD_importTDate select")[0].selectedIndex,si_Duration=ODImportParent.find("#ZPAtt_OD_importDuration select")[0].selectedIndex,si_Session=ODImportParent.find("#ZPAtt_OD_importSession select")[0].selectedIndex,0!==si_FDate&&0!==si_TDate&&0!==si_Duration&&0!==si_Session||(isValid=!1)):(si_AttDate=ODImportParent.find("#ZPAtt_OD_importAttDate select")[0].selectedIndex,si_FTime=ODImportParent.find("#ZPAtt_OD_importFTime select")[0].selectedIndex,si_TTime=ODImportParent.find("#ZPAtt_OD_importTTime select")[0].selectedIndex,0!==si_AttDate&&0!==si_FTime&&0!==si_TTime||(isValid=!1)),0===si_Reson&&ZPeople.Module.MODULE_DATA.attendance.isOnDutyReasonMandatory&&(isValid=!1),isValid){var param={mode:"ODImportMapping",mailId:si_Id-1,typeId:si_Type-1,isDayUnit:Attendance.ODImport.isDayWise,conreqcsr:csrfToken};0===Attendance.ODImport.isDayWise?(param.fdateId=si_FDate-1,param.tdateId=si_TDate-1,param.durationId=si_Duration-1,param.sessionId=si_Session-1):(param.ftimeId=si_FTime-1,param.ttimeId=si_TTime-1,param.attDateId=si_AttDate-1),0!==si_Reson&&(param.reasonId=si_Reson-1),"0"!==ODImportParent.find("#ZPAtt_OD_importDateFor select").val()&&(param.dateFormat=ODImportParent.find("#ZPAtt_OD_importDateFor select").val()),"csv"!==fileFormat||param.dateFormat?(ODImportParent.find("#ZPAtt_OD_importNext").attr("disabled",!0),ODImportParent.find("#ZPAtt_OD_importPopup .modal-body").children().hide(),ODImportParent.find("#ZPAtt_OD_importPopup .modal-body").append(ZPeople.LOADING_HTML),$.post("/AttendanceAction.zp",param,function(resultData){if(ODImportParent.find("#ZPAtt_OD_importPopup .modal-body").find("#zp_page_loading").remove(),ODImportParent.find("#ZPAtt_OD_importPopup .modal-body").children().show(),resultData.msg){if(ODImportParent.find("#ZPAtt_OD_import").parent().parent().attr("class","ZPImfrm ZPRecList"),ODImportParent.find("#ZPAtt_OD_importMap").hide(),ODImportParent.find("#ZPAtt_OD_importMsg").parent().hide(),ODImportParent.find("#ZPAtt_OD_importSuccMsg").fadeIn(300),ODImportParent.find("#ZPAtt_OD_importSuccvalues").fadeIn(300),ODImportParent.find("#ZPAtt_OD_importSuccvalues span")[1].innerHTML="0",resultData.msg.successCount&&(ODImportParent.find("#ZPAtt_OD_importSuccvalues span")[1].innerHTML=resultData.msg.successCount),ODImportParent.find("#ZPAtt_OD_importSuccvalues span")[0].innerHTML="0",resultData.msg.totalCount&&(ODImportParent.find("#ZPAtt_OD_importSuccvalues span")[0].innerHTML=resultData.msg.totalCount),ODImportParent.find("#ZPAtt_OD_importPrevious").hide(),ODImportParent.find("#ZPAtt_OD_importNext").hide(),resultData.msg.errorType)return void ZPeople.Message.showFailureMsg(resultData.msg.errorType);if(Attendance.OD.getRequest(!1),resultData.msg.emptyEmpIds||resultData.msg.skippedEmpInfo||resultData.msg.errorInfo||resultData.msg.duplicateRecords){var rowNumber=0;if(ODImportParent.find("#importErrDiv").show(),ODImportParent.find("#importErrTBody").find("tr").remove(),resultData.msg.skippedEmpInfo){var length=resultData.msg.skippedEmpInfo.length;ODImportParent.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.invalidempinfoforshiftimport")+"<ul></ul></td></tr>"));for(var i=0;i<length;i++)$($(ODImportParent.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+$("<div/>").text(resultData.msg.skippedEmpInfo[i]).html()+"</li>");rowNumber++}if(resultData.msg.emptyEmpIds){length=resultData.msg.emptyEmpIds.length;ODImportParent.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.emptyempids")+"<ul></ul></td></tr>"));for(i=0;i<length;i++)$($(ODImportParent.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+resultData.msg.emptyEmpIds[i]+"</li>");rowNumber++}if(resultData.msg.errorInfo){var errObj=resultData.msg.errorInfo,tbody=(length=errObj.length,"");for(i=0;i<length;i++){var errrObj=errObj[i],firstKey=Object.keys(errrObj)[0];if(tbody+="<tr class='ZPLRow'><td> Row :"+firstKey+"</td>",errrObj[firstKey]instanceof Object){var invalidObj=errrObj[firstKey],index=0;for(var key in invalidObj)tbody+=0==index?"<td>"+key+"</td><td>"+invalidObj[key]+"</td></tr>":"<tr class='ZPLRow'><td></td><td>"+key+"</td><td>"+invalidObj[key]+"</td></tr>",index++}else tbody+="<td></td><td>"+errrObj[firstKey]+"</td></tr>"}ODImportParent.find("#importErrTBody").append($(tbody))}if(resultData.msg.duplicateRecords){length=resultData.msg.duplicateRecords.length;var dupText="";for(i=0;i<length;i++)dupText+="<tr class='ZPLRow' ><td>"+ZPI18N.getString("zp.row")+" :"+resultData.msg.duplicateRecords[i]+"</td><td></td><td>"+ZPI18N.getString("zp.odduplicatemsg")+"</td></tr>";ODImportParent.find("#importErrTBody").append(dupText),rowNumber++}}}else if(resultData.fail||resultData.error){var failMsg=resultData.fail?resultData.fail:ZPI18N.getString("zp.unabletoprocess");ZPeople.Message.showFailureMsg(failMsg),Layout.Page.container.find("#ZPAtt_OD_importNext").attr("disabled",!1),Layout.Page.container.find("#ZPAtt_OD_importNext").off("click").on("click",function(){Attendance.ODImport.submitODMapping(fileFormat)})}})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))}},AttPermissions={checkedBoxVal:[],apprconfirmStatus:-1,isFromreset:!1,layout:{},init:function(){isManageAttendanceData=!!isadmin||ZPeople.Module.MODULE_DATA.attendance.isManageAttedance,repMan=ZPeople.Module.MODULE_DATA.attendance.isLeadForShift,isEmpChooseApp=ZPeople.Module.MODULE_DATA.attendance.isEmpChooseApp,isEmpChooseAppOD=ZPeople.Module.MODULE_DATA.attendance.isEmpChooseAppOD,spocODView=ZPeople.Module.MODULE_DATA.attendance.isSPOCEntryViewAllowed,isSPOCEntryEdit=ZPeople.Module.MODULE_DATA.attendance.isSPOCEntryEdit,Layout.Page.container.find("select").select2({minimumResultsForSearch:5}),Layout.Page.container.find("select[multiple='multiple']").select2({closeOnSelect:!1}),Layout.Page.container.find("[data-toggle=tooltip]").tooltip({trigger:"click"}),Layout.Page.container.find("#ZPAtt_Permission_Filter").hasClass("ZPFilsel")&&$("#page-wrapper").attr("class","Nbar2F THF-2F"),Attendance.consResetEmpSearch("ZPAtt_Permission_FilEmployee",Layout.Page.container,!0,!1),Layout.Page.container.find("#ZPAtt_PermissionType").select2(),Layout.Page.container.find("#ZPAtt_PermissionFromTime , #ZPAtt_PermissionToTime").timepicker({defaultTime:"",showMeridian:"hh:mm a"==timeFormat,disableMousewheel:!0,minuteStep:1}),isadmin&&(isManageAttendanceData=!0),isSPOCEntryEdit||isManageAttendanceData?Layout.Page.container.find("#ZPAtt_permission_importLI").show():Layout.Page.container.find("#ZPAtt_permission_importLI").hide(),spocODView||isManageAttendanceData||Layout.Page.container.find("#ZPAtt_myReqPerm_empProfile").parent().parent().remove(),-1!==Layout.Page.hash.indexOf("attendance/permission/myrequests")?AttendanceApprovals.appendApprovalTopBand("myrequests","permission"):-1!==Layout.Page.hash.indexOf("attendance/permission/myapprovals")&&AttendanceApprovals.appendApprovalTopBand("myapprovals","permission"),AttPermissions.loadPageDetails()},loadPageDetails:function(){AttPermissions.allPermissionList?AttPermissions.postPermissionLoad():AttPermissions.loadPermissionDetails(AttPermissions.postPermissionLoad)},postPermissionLoad:function(){AttPermissions.constructPermissionSelect(AttPermissions.cachePermission[erecno]),-1!==Layout.Page.hash.indexOf("attendance/permission/myrequests")?(Layout.Page.container.find("#ZPAtt_PermissionBulkDelete").hide().prev().show(),Attendance.Report.getDepLocShiftList(!0),AttPermissions.getRequest(!1)):-1!==Layout.Page.hash.indexOf("attendance/permission/myapprovals")?(Layout.Page.container.find("#ZPAtt_PermissionBulkApprove").hide().prev().show(),AttPermissions.getApprovals(!1)):AttPermissions.getPermissionApprovalDetails()},getPermissionApprovalDetails:function(){var formId=Layout.Page.childUrlParam.formId,recordId=Layout.Page.childUrlParam.recordId;Attendance.Permissions.getPermissionApprovalDetails(formId,recordId,AttPermissions.closeCallBack)},closeCallBack:function(){-1!==Layout.Page.hash.indexOf("attendance/permission/viewmyrequest")?window.location.href="#attendance/permission/myrequests":-1!==Layout.Page.hash.indexOf("attendance/permission/viewmyapproval")&&(window.location.href="#attendance/permission/myapprovals")},getReqOnScroll:function(){AttPermissions.startIndex+=20,AttPermissions.getRequest(!0)},getApprOnScroll:function(){AttPermissions.ApprstartIndex+=20,AttPermissions.getApprovals(!0)},startIndex:0,getRequest:function(isScroll,fromSubmit,navigate){Layout.Page.container.find("#ZPAtt_PermissionBulkDelete").hide(),Layout.Page.container.find("#ZPAtt_PermissionBulkDelete").prev().show();var param={mode:"getPermissionRequest",status:Layout.Page.container.find("#ZPAtt_Permission_Status").val(),conreqcsr:csrfToken};AttPermissions.isReqFromNav=void 0,navigate&&(param.navigate=navigate,AttPermissions.isReqFromNav=!0),Layout.Page.container.find("#ZPAtt_Permission_myReqEmpSort").hasClass("sort-d")?param.isEmpSortAsc=!1:Layout.Page.container.find("#ZPAtt_Permission_myReqEmpSort").hasClass("sort-u")&&(param.isEmpSortAsc=!0);var filter=Layout.Page.container.find("#ZPAtt_permFilter");Attendance.Reg.getMyRequestDateFilter(param,"myReqPerm",filter),param.error||(Attendance.Report.getFilterValues(filter,param,"myReqPerm"),isScroll?param.startIndex=AttPermissions.startIndex+1:(AttPermissions.startIndex=0,Layout.Page.container.find("#ZPAtt_PermissionMyReqDetails").scrollTop(0),fromSubmit&&(Layout.Page.container.find("#ZPAtt_PermissionMyReq_emptyRecInfo")[0]&&Layout.Page.container.find("#ZPAtt_PermissionMyReq_emptyRecInfo").hide(),Layout.Page.container.find("#ZPAtt_PermissionMyReqDetails").hide(),0===Layout.Page.container.find("#ZPAtt_PermissionMyReq").find("#zp_page_loading").length&&Layout.Page.container.find("#ZPAtt_PermissionMyReq").append(ZPeople.LOADING_HTML))),$.post("/AttendanceAction.zp",param,function(resultData){if($("#zp_active_subtabs #zp_t_attendance_myapprovals").parent().removeClass("active"),$("#zp_active_subtabs #zp_t_attendance_myrequests").attr("href","#attendance/permission/myrequests").parent().addClass("active"),resultData.error)"exceeded dates"===resultData.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinthreemonth")):"error in end date"===resultData.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate"));else{var requestFilter=Layout.Page.container.find("#ZPAtt_PermissionFilters"),dateNav=Layout.Page.container.find("#ZPAtt_PermissionReq_dateNav");AttPermissions.isReqFromNav?(requestFilter.find("#ZPAtt_myReqPerm_fromDate").val(resultData.fDate).attr("disabled",!1),requestFilter.find("#ZPAtt_myReqPerm_toDate").val(resultData.tDate).attr("disabled",!1),requestFilter.find("#ZPAtt_myReqPerm_period").select2("val",6)):resultData.sDate&&(AttPermissions.currMonthSDate=resultData.sDate,AttPermissions.currMonthEDate=resultData.eDate,AttPermissions.todayDate=resultData.todayDate,AttPermissions.prevDay=resultData.prevDay,AttPermissions.lastMonthStart=resultData.prevMonthStart,AttPermissions.lastMonthEnd=resultData.prevMonthEnd,AttPermissions.onPeriodChange()),resultData.dispMonth?dateNav.html(resultData.dispMonth):dateNav.html(Attendance.datesInHeader(resultData.fDate,resultData.tDate)),Layout.Page.container.find("#ZPAtt_PermissionMyReq").find("#zp_page_loading").remove(),20===resultData.list.length&&ZPeople.FireScroll.reset(),AttPermissions.isEditAllowedForSub=resultData.isEditAllowedForSub,AttPermissions.constructList(resultData,"getRequestList",isScroll),"hh:mm a"!==resultData.timeformat?Attendance.timeFormatIs12hr=!1:Attendance.timeFormatIs12hr=!0}}))},constructList:function(resultData,mode,isScroll){Layout.Page.container;var result=resultData.list,hideDel=resultData.hideDel,emptyMessage=Layout.Page.container.find("#ZPAtt_PermissionMyReq_emptyRecInfo"),tslisttbody=Layout.Page.container.find("#ZPAtt_PermissionMyReqBody"),subUrl="viewmyrequest",noDataImg="CR-at-myreq";"getApprovals"===mode&&(tslisttbody=Layout.Page.container.find("#ZPAtt_PermissionMyApprovalBody"),emptyMessage=Layout.Page.container.find("#ZPAtt_PermissionMyApproval_emptyRecInfo"),subUrl="viewmyapproval",noDataImg="CR-at-regapp"),tslisttbody.parent().find("thead input").attr("checked",!1),emptyMessage.hide(),emptyMessage.prev().show(),isScroll||tslisttbody.empty(),"getRequestList"!==mode||isManageAttendanceData||Layout.Page.container.find("#ZPAtt_PermissionMyReqHeader #ZPAtt_PermissionMyReqHeader_checkBox").remove(),$.each(result,function(ind,permissionDetails){var txt='<tr class="ZPLRow zp_tbr_ini" id="list-'+permissionDetails.recordId+'">';"getApprovals"===mode?-1===permissionDetails.status||permissionDetails.status===zpconst.ApprovalStatus.CancellationPending?txt+='<td><div class="checkbox"><input approvalStatus='+permissionDetails.status+' type="checkbox" val="'+permissionDetails.recordId+"\" onclick=\"AttPermissions.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>':-1!==permissionDetails.status&&(txt+='<td><div class="checkbox disabled"><input approvalStatus='+permissionDetails.status+' type="checkbox" disabled="true"><label class="MT3"></label></div></td>'):"getRequestList"===mode?!isManageAttendanceData||permissionDetails.isSubOrdinate||permissionDetails.erecno===erecno&&hideDel?isManageAttendanceData&&(permissionDetails.erecno===erecno&&hideDel||permissionDetails.isSubOrdinate)&&(txt+='<td><div class="checkbox disabled"><input type="checkbox" approvalStatus='+permissionDetails.status+' disabled="true"><label class="MT3"></label></div></td>'):txt+='<td><div class="checkbox"><input type="checkbox" approvalStatus='+permissionDetails.status+' val="'+permissionDetails.recordId+"\" onclick=\"AttPermissions.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>':"addreq"===mode&&(txt+='<td><div class="checkbox"><input type="checkbox" approvalStatus='+permissionDetails.status+' val="'+permissionDetails.recordId+"\" onclick=\"AttPermissions.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>');var redUrl="data-toggle=modal onclick=\"window.location.href='#attendance/permission/"+subUrl+"-formId:"+permissionDetails.formId+"/recordId:"+permissionDetails.recordId+"'\"";txt+='<td class="P_AM UN_A"><div class="ZPusrName"><img class="FL" src='+permissionDetails.empPhoto+'><span class="ellipsis CP" '+redUrl+"><b>"+$("<div/>").text(permissionDetails.employeeId).html()+"</b>"+permissionDetails.employeeName+"</span>",txt+="</div></td>",txt+="<td class='P0I TBrdr text-center'><div>"+AttPermissions.allPermissionList[permissionDetails.permissionId]+"</div></td>",txt+="<td class='P0I TBrdr text-center'><div>"+permissionDetails.date+"</div></td>",txt+="<td class='P0I TBrdr text-center'><div>"+permissionDetails.fromTime+"</div></td>",txt+="<td class='P0I TBrdr text-center'><div>"+permissionDetails.toTime+"</div></td>",txt+="<td class='P0I TBrdr text-center'><div>"+permissionDetails.totalTime+"</div></td>";var reason=permissionDetails.reason?permissionDetails.reason:"-";txt+="<td class='P0I TBrdr text-center'><div>"+$("<div></div>").text(reason).html()+"</div></td>";var appStatus="";1===permissionDetails.status?appStatus="<span "+redUrl+' class="grn CP">'+ZPI18N.getString("zp.approved")+"</span>":0===permissionDetails.status?appStatus="<span "+redUrl+' class="red CP">'+ZPI18N.getString("zp.rejected")+"</span>":-1===permissionDetails.status||permissionDetails.status===zpconst.ApprovalStatus.CancellationPending?appStatus="getRequestList"===mode||"addreq"===mode?"<span "+redUrl+' class="CP">'+ZPI18N.getString("zp.waitingmsg")+"</span>":'<button type=button class="btn btn-default btn-sm" '+redUrl+">"+ZPI18N.getString("zp.clickapprove")+"</button>":-2===permissionDetails.status?appStatus="<span "+redUrl+' class="CP">'+ZPI18N.getString("zp.submitted")+"</span>":2===permissionDetails.status&&(appStatus="<span "+redUrl+' class="CP red">'+ZPI18N.getString("zp.cancelled")+"</span>"),txt+='<td class="P0I TBrdr text-center">'+appStatus,txt+="</tr>","addreq"===mode?txt.prependTo(tslisttbody):tslisttbody.append(txt)}),!isManageAttendanceData&&"getRequestList"===mode&&Layout.Page.container.find("#ZPAtt_PermissionMyReqHeader").children("th:eq(7)")[0]&&Layout.Page.container.find("#ZPAtt_PermissionMyReqHeader").children("th:eq(7)").nextAll().remove(),Attendance.toggleLoadingDiv(!0),0===tslisttbody.children().length?(emptyMessage.prev().hide(),emptyMessage.show(),tslisttbody.prev().hide(),0===emptyMessage.find("i").eq(0).children().length&&Attendance.noDataImg(8,noDataImg,emptyMessage.find("i").eq(0))):tslisttbody.prev().show()},toggleFilSearch:function(){"attendance-permission-myrequests"===Layout.Page.pageId?AttPermissions.getRequest(!1,!0):AttPermissions.getApprovals(!1,!0),"/zp"===ZPeople.CONTEXT&&AttPermissions.toggleFilter()},toggleFilter:function(){Layout.Page.container;Layout.Page.container.find("#ZPAtt_Permission_Filter").hasClass("ZPFilsel")?(Layout.Page.container.find("#ZPAtt_Permission_Filter").removeClass("blu ZPFilsel"),Layout.Page.container.find("#ZPAtt_PermissionFilters").attr("class","ZPFilMain"),Layout.Page.container.find("#ZPAtt_PermissionFilClsBut").hide(),$("#page-wrapper").attr("class","Nbar3")):(Layout.Page.container.find("#ZPAtt_Permission_Filter").addClass("blu ZPFilsel"),Layout.Page.container.find("#ZPAtt_PermissionFilters").attr("class","ZPFilMain TEbnd"),Layout.Page.container.find("#ZPAtt_PermissionFilClsBut").show(),$("#page-wrapper").attr("class","Nbar2F THF-2F"),isManageAttendanceData||repMan||spocODView?Layout.Page.container.find("#ZPAtt_myReqPerm_empName").parent().parent().show():Layout.Page.container.find("#ZPAtt_myReqPerm_empName").parent().parent().hide())},resetInputs:function(){Layout.Page.container;Layout.Page.container.find("#ZPAtt_Permission_Status").select2("val",-3);var filters=Layout.Page.container.find("#ZPAtt_permFilter");Attendance.Reg.resetMyReqFilters(filters,"myReqPerm",AttPermissions.currMonthSDate,AttPermissions.currMonthEDate)},myReqEmpDaySort:function(obj){$(obj).hasClass("sort-d")?$(obj).attr("class","sort-img sort-u CP"):$(obj).attr("class","sort-img sort-d CP"),AttPermissions.getRequest(!1,!0)},onPeriodChange:function(){Layout.Page.container;var fromElement=Layout.Page.container.find("#ZPAtt_myReqPerm_fromDate"),toElement=Layout.Page.container.find("#ZPAtt_myReqPerm_toDate");fromElement.attr("disabled",!0),toElement.attr("disabled",!0);var currMonthSDate=AttPermissions.currMonthSDate,currMonthEDate=AttPermissions.currMonthEDate,toDay=moment(AttPermissions.todayDate,dateFmt.toUpperCase()),weekStartDate=moment(toDay).startOf("week").add(weekstarts,"day");toDay._d.getTime()<weekStartDate._d.getTime()&&(weekStartDate=weekStartDate.add(-1,"week"));var weekEndDate=moment(toDay).startOf("week").add(weekstarts,"day");toDay._d.getTime()<weekEndDate._d.getTime()&&(weekEndDate=weekEndDate.add(-1,"week")),weekEndDate=weekEndDate.add(6,"day");var pValue=Layout.Page.container.find("#ZPAtt_myReqPerm_period").val();"1"===pValue?(currMonthSDate=AttPermissions.lastMonthStart,currMonthEDate=AttPermissions.lastMonthEnd):"2"===pValue?(currMonthSDate=weekStartDate.format(dateFmt.toUpperCase()),currMonthEDate=weekEndDate.format(dateFmt.toUpperCase())):"3"===pValue?(currMonthSDate=moment(weekStartDate).add(-1,"week").format(dateFmt.toUpperCase()),currMonthEDate=moment(weekEndDate).add(-1,"week").format(dateFmt.toUpperCase())):"4"===pValue?(currMonthSDate=AttPermissions.todayDate,currMonthEDate=AttPermissions.todayDate):"5"===pValue?(currMonthSDate=AttPermissions.prevDay,currMonthEDate=AttPermissions.prevDay):"6"===pValue&&(fromElement.prop("disabled",!1),toElement.prop("disabled",!1)),"6"!==pValue&&(fromElement.val(currMonthSDate),toElement.val(currMonthEDate))},ApprstartIndex:0,getApprovals:function(isScroll,fromSubmit){Layout.Page.container;Layout.Page.container.find("#ZPAtt_PermissionBulkApprove").hide(),Layout.Page.container.find("#ZPAtt_PermissionBulkApprove").prev().show(),Layout.Page.container.find("#zp_approval_pop").is(":visible")&&ZPeople.BSModal.hide(),Attendance.toggleLoadingDiv(!1,Layout.Page.container.find("#ZPAtt_PermissionMyApproval"),Layout.Page.container.find("#ZPAtt_PermissionMyApproval_emptyRecInfo"));var param={mode:"getPermissionApprovals",status:Layout.Page.container.find("#ZPAtt_Permission_Status").val(),conreqcsr:csrfToken};isScroll?param.startIndex=AttPermissions.ApprstartIndex+1:(Layout.Page.container.find("#ZPAtt_PermissionMyApprovalDetails").scrollTop(0),AttPermissions.ApprstartIndex=0,fromSubmit&&(Layout.Page.container.find("#ZPAtt_PermissionMyApproval_emptyRecInfo")[0]&&Layout.Page.container.find("#ZPAtt_PermissionMyApproval_emptyRecInfo").hide(),Layout.Page.container.find("#ZPAtt_PermissionMyApprovalDetails").hide(),0===Layout.Page.container.find("#ZPAtt_PermissionMyApproval").find("#zp_page_loading").length&&Layout.Page.container.find("#ZPAtt_PermissionMyApproval").append(ZPeople.LOADING_HTML))),$.post("/AttendanceAction.zp",param,function(resultData){$("#zp_active_subtabs #zp_t_attendance_myrequests").parent().removeClass("active"),$("#zp_active_subtabs #zp_t_attendance_myapprovals").attr("href","#attendance/permission/myapprovals").parent().addClass("active"),Layout.Page.container.find("#ZPAtt_PermissionMyApproval").find("#zp_page_loading").remove(),resultData&&void 0!==resultData.list&&resultData.list.length>0&&Layout.Page.container.find("#ZPAtt_PermissionBulkApprove").attr("onclick","ZPApprovals.viewApproveActionPopup("+resultData.list[0].formId+")"),AttPermissions.constructList(resultData,"getApprovals",isScroll),20===resultData.list.length&&ZPeople.FireScroll.reset()})},deleteBulkPermission:function(){Layout.Page.container;var selectedreq="";Layout.Page.container.find("#ZPAtt_PermissionMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){selectedreq=""===selectedreq?$(this).attr("val"):selectedreq+","+$(this).attr("val")}),AttPermissions.deletePermissionList(selectedreq)},deletePermissionList:function(listId){Layout.Page.container;var params={mode:"deletePermissionList",recordId:listId,conreqcsr:csrfToken},empFilter=Layout.Page.container.find("#ZPAtt_myReqPerm_empName");"0"!==empFilter.val()&&""!==empFilter.val()&&(params.erecno=empFilter.select2("val")),$.post("/AttendanceAction.zp",params,function(resultData){if(void 0!=resultData&&"success"==resultData.status){if(Layout.Page.container.find("#ZPAtt_PermissionMyReq").is(":visible")){for(var deleted_Id=listId.split(","),i=0;i<deleted_Id.length;i++)Layout.Page.container.find("#list-"+deleted_Id[i]).remove();if(0===Layout.Page.container.find("#ZPAtt_PermissionMyReqBody tr").length){var emptyRecEle=Layout.Page.container.find("#ZPAtt_PermissionMyReq_emptyRecInfo");emptyRecEle.prev().hide(),emptyRecEle.fadeIn(200).parent().removeClass("section");var empImg=emptyRecEle.find("i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-regapp",empImg)}Layout.Page.container.find("#ZPAtt_PermissionMyReqDetails").find("thead input[type=checkbox]:enabled").prop("checked",!1),Layout.Page.container.find("#ZPAtt_PermissionBulkDelete").hide().prev().show()}else AttPermissions.getApprovals();ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.recorddeletedsuccessfully"))}else ZPeople.Message.showFailureMsg(resultData.message)})},cancelOD:function(recordId){Layout.Page.container;var selectedreq="";void 0!=recordId?selectedreq=recordId:Layout.Page.container.find("#ZPAtt_ODMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){selectedreq=""===selectedreq?$(this).attr("val"):selectedreq+","+$(this).attr("val")}),AttPermissions.cancelODIndividual(selectedreq)},permissionApprAction:function(getThis){Layout.Page.container;var approvalComment=Layout.Page.container.find("#approval_comment").val(),action="zp_modal_blubtn"===getThis.id||"zp_modal_all_appr_btn"===getThis.id?1:0,isAllLevelApprove="zp_modal_all_appr_btn"===getThis.id;Layout.Page.container.find("#ZPAtt_PermissionMyApprovalDetails").find("tbody input[type=checkbox]:enabled").each(function(){$(this).is(":checked")&&AttPermissions.checkedBoxVal.push($(this).attr("val"))}),AttPermissions.apprconfirmStatus=1,ZPForm.Record.approveReject(AttPermissions.checkedBoxVal,action,approvalComment,isAllLevelApprove,AttPermissions.refreshApprovals),AttPermissions.checkedBoxVal=[]},refreshApprovals:function(){AttPermissions.getApprovals(!1)},deleteConfirm:function(){Layout.Page.container;Layout.Page.container.find("#ZPAtt_ODMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){if("-1"!==$(this).attr("approvalStatus"))return!1}),$("#confirmationPopup").modal({backdrop:"static",keyboard:!1}),$("#textConfirmationPopupHeader").html(ZPI18N.getString("zp.confirm")),$("#confirmConfirmationPopup").html(ZPI18N.getString("zp.confirm"));var message=ZPI18N.getString("zp.permissioncancel");$("#textConfirmationPopupBody").html(message),$("#confirmConfirmationPopup").off("click"),$("#cancelConfirmationPopup").off("click"),$("#confirmConfirmationPopup").on("click",function(event){AttPermissions.deleteBulkPermission()}),$("#cancelConfirmationPopup").on("click",function(event){$("#confirmationPopup").modal("hide")})},changeCheckBox:function(obj,val,mode){var currPage=Layout.Page.container.find("#ZPAtt_PermissionMyReqDetails"),pagebutton=Layout.Page.container.find("#ZPAtt_PermissionBulkDelete");"getApprovals"===mode&&(currPage=Layout.Page.container.find("#ZPAtt_PermissionMyApprovalDetails"),pagebutton=Layout.Page.container.find("#ZPAtt_PermissionBulkApprove")),"all"===val?$(obj).is(":checked")?currPage.find("tbody input[type=checkbox]:enabled").prop("checked",!0):currPage.find("tbody input[type=checkbox]:enabled").prop("checked",!1):currPage.find("tbody input[type=checkbox]:checked:enabled").length===currPage.find("tbody input[type=checkbox]:enabled").length?currPage.find("thead input[type=checkbox]:enabled").prop("checked",!0):currPage.find("thead input[type=checkbox]:enabled").prop("checked",!1),0===currPage.find("tbody input[type=checkbox]:checked:enabled").length?(pagebutton.hide(),pagebutton.prev().fadeIn(100)):(pagebutton.prev().hide(),pagebutton.fadeIn(100))},cancelODIndividual:function(listId){Layout.Page.container;var params={mode:"cancelODList",ODId:listId,conreqcsr:csrfToken};$.post("/AttendanceAction.zp",params,function(resultData){if(void 0!=resultData&&"success"==resultData.status){if(Layout.Page.container.find("#cancelODIndividual").addClass("DN"),void 0!==resultData&&void 0!==resultData.currentApprovalStatus&&void 0!==resultData.approvalDetail){ZPForm.Record.cancelRecCBforModule(resultData.currentApprovalStatus,{isfromAttendence:!0},resultData.approvalDetail)}for(var ODRows=Layout.Page.container.find("#ZPAtt_OD_DetListBody").find(".ODRow"),n=ODRows.length,i=0;i<n;i++)$(ODRows.find("td:last")[i]).html(ZPI18N.getString("zp.cancelled"));var listHead=Layout.Page.container.find("#ZPAtt_OD_DetListHeader");listHead.find("#ODBulkApprovalRej").hide(),listHead.find("#ODApprovalState").show()}else ZPeople.Message.showFailureMsg(resultData.message)})},getEmpChosenApprErecno:function(layout){Layout.Page.container.find("#emptyErrMsg").removeClass("MB10"),Layout.Page.container.find("#emptyErrMsg").html("");var appErecno=Layout.Page.container.find("#ZPAtt_OD_approverId").val();return"-Select-"===appErecno&&(Layout.Page.container.find("#emptyErrMsg").addClass("MB10"),Layout.Page.container.find("#emptyErrMsg").html(ZPI18N.getString("zp.chooseapprovererrormsg"))),appErecno},cachePermission:{},loadPermissionDetails:function(callback){ZPeople.Request.send("/AttendanceViewAction.zp",{mode:"isPermissionApplicableForUser"},function(data){AttPermissions.allPermissionList=data.allPermissionList,AttPermissions.cachePermission[erecno]=data.isApplicable,ZPUtil.Validation.isFunction(callback)&&callback(),AttPermissions.constructPermissionSelect(AttPermissions.cachePermission[erecno])})},constructPermissionSelect:function(permissionObj,currentSelection){Layout.Page.container;var selectedId="",hasMatchingId=!1;void 0!==currentSelection&&null!=currentSelection&&(selectedId=currentSelection);var selectOption="";for(var PKID in permissionObj){selectOption+="<option value="+PKID+">"+permissionObj[PKID].name+"</option>",selectedId==PKID&&(hasMatchingId=!0)}Layout.Page.container.find("#ZPAtt_PermissionType").html(selectOption),Layout.Page.container.find("#ZPAtt_PermissionType").select2("val",""),hasMatchingId&&Layout.Page.container.find("#ZPAtt_PermissionType").select2("val",selectedId)},permissionEmployeeChange:function(){var erecno=Layout.Page.container.find("#ZPAtt_Permission_FilEmployee").select2("val"),currentSelection=Layout.Page.container.find("#ZPAtt_PermissionType").val();if(AttPermissions.cachePermission[erecno])return AttPermissions.constructPermissionSelect(AttPermissions.cachePermission[erecno],currentSelection),void AttPermissions.getPermissionBalance();var params={mode:"isPermissionApplicableForUser"};params.erecno=erecno,params.skipAllPermission=!0,ZPeople.Request.send("/AttendanceViewAction.zp",params,function(data){AttPermissions.cachePermission[erecno]=data.isApplicable,AttPermissions.constructPermissionSelect(data.isApplicable,currentSelection),AttPermissions.getPermissionBalance(),AttPermissions.permissionTypeSelect()})},permissionDateEmpty:function(){if(""==Layout.Page.container.find("#ZPAtt_PermissionDate").val().trim())return Layout.Page.container.find("#balanceCont").addClass("DN"),void Layout.Page.container.find("#permissionBalance").html("")},getPermissionBalance:function(){var date=Layout.Page.container.find("#ZPAtt_PermissionDate").val().trim();if(""==date||null==Layout.Page.container.find("#ZPAtt_PermissionType").val())return Layout.Page.container.find("#balanceCont").addClass("DN"),void Layout.Page.container.find("#permissionBalance").html("");var params={mode:"getPermissionBalance"};params.date=date;var fTime=Layout.Page.container.find("#ZPAtt_PermissionFromTime").val().trim();""!=fTime&&(params.fTime=Attendance.Common.convertTimerInputToMinsOrSecs(fTime)),params.erecno=Layout.Page.container.find("#ZPAtt_Permission_FilEmployee").select2("val"),params.permissionId=Layout.Page.container.find("#ZPAtt_PermissionType").val(),ZPeople.Request.send("/AttendanceAction.zp",params,function(data){Layout.Page.container.find("#permissionBalance").html(""),data.availableTime&&(Layout.Page.container.find("#permissionBalance").html(Attendance.disHours(data.availableTime/60)+" "+ZPI18N.getString("zp.shours")),Layout.Page.container.find("#balanceCont").removeClass("DN"))})},togglePermissionPopup:function(){var results={};-1===Layout.Page.hash.indexOf("attendance/permission/myrequests")&&Attendance.Entry.erecno?(results.id=Attendance.Entry.erecno,results.text=ZPeople.decodeTxt(Attendance.Entry.searchedUsername),results.html=Attendance.Entry.searchedUsername,results.photo=Attendance.Entry.searchedUserphoto):(results.id=ZPeople.CURR_USER.usererec,results.text=ZPeople.decodeTxt(ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name),results.html=ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name,results.photo=ZPeople.CURR_USER.thumb),Layout.Page.container.find("#ZPAtt_Permission_FilEmployee").select2("data",results),Layout.Page.container.find("#balanceCont").addClass("DN"),Layout.Page.container.find("#permissionBalance").html(""),Layout.Page.container.find("#ZPAtt_PermissionDate").val(""),Layout.Page.container.find("#ZPAtt_PermissionType").select2("val",""),Layout.Page.container.find("#ZPAtt_PermissionFromTime").val(""),Layout.Page.container.find("#ZPAtt_PermissionToTime").val(""),Layout.Page.container.find("#ZPAtt_PermissionFromTime").timepicker("setTime",""),Layout.Page.container.find("#ZPAtt_PermissionToTime").timepicker("setTime",""),Layout.Page.container.find("#ZPAtt_PermissionReason").val(""),Layout.Page.container.find("#permissionDateEmptyErr").addClass("DN"),Layout.Page.container.find("#permissionLimitExceededErr").addClass("DN"),Layout.Page.container.find("#permissionTypeEmptyErr").addClass("DN"),Layout.Page.container.find("#permissionFromTimeEmptyErr").addClass("DN"),Layout.Page.container.find("#permissionToTimeEmptyErr").addClass("DN"),Layout.Page.container.find("#permissionMinTimeErr").addClass("DN"),Layout.Page.container.find("#permissionMaxTimeErr").addClass("DN"),Layout.Page.container.find("#permissionAllowedInstanceExceededErr").addClass("DN"),Layout.Page.container.find("#ZPAtt_Permission_addRequest").modal("show"),AttPermissions.permissionTypeSelect()},permissionTypeSelect:function(){var permissionList=AttPermissions.cachePermission[Layout.Page.container.find("#ZPAtt_Permission_FilEmployee").select2("val")];permissionList&&1==Object.keys(permissionList).length?Layout.Page.container.find("#ZPAtt_PermissionType").select2("val",Object.keys(permissionList)[0]):Layout.Page.container.find("#ZPAtt_PermissionType").select2("val","")},addAttendancePermission:function(){var date=Layout.Page.container.find("#ZPAtt_PermissionDate").val().trim(),permissionId=Layout.Page.container.find("#ZPAtt_PermissionType").val(),fromTime=Layout.Page.container.find("#ZPAtt_PermissionFromTime").val().trim(),toTime=Layout.Page.container.find("#ZPAtt_PermissionToTime").val().trim(),reason=Layout.Page.container.find("#ZPAtt_PermissionReason").val().trim();if(!AttPermissions.validateApplyPermission(date,permissionId,fromTime,toTime)){var fromTimeInMins=Attendance.Common.convertTimerInputToMinsOrSecs(fromTime),toTimeInMins=Attendance.Common.convertTimerInputToMinsOrSecs(toTime),input={erecno:Layout.Page.container.find("#ZPAtt_Permission_FilEmployee").select2("val"),date:date,permissionId:permissionId,fromTime:fromTimeInMins,toTime:toTimeInMins};""!=reason&&(input.reason=reason),AttPermissions.permissionParam=input,AttPermissions.applyPermission()}},hidePermissionError:function(ele){"ZPAtt_PermissionDate"==$(ele).attr("id")?Layout.Page.container.find("#permissionDateEmptyErr").addClass("DN"):"ZPAtt_PermissionType"==$(ele).attr("id")?(Layout.Page.container.find("#permissionLimitExceededErr").addClass("DN"),Layout.Page.container.find("#permissionTypeEmptyErr").addClass("DN"),Layout.Page.container.find("#permissionAllowedInstanceExceededErr").addClass("DN")):"ZPAtt_PermissionFromTime"==$(ele).attr("id")?(Layout.Page.container.find("#permissionFromTimeEmptyErr").addClass("DN"),AttPermissions.getPermissionBalance()):"ZPAtt_PermissionToTime"==$(ele).attr("id")&&(Layout.Page.container.find("#permissionToTimeEmptyErr").addClass("DN"),Layout.Page.container.find("#permissionMinTimeErr").addClass("DN"),Layout.Page.container.find("#permissionMaxTimeErr").addClass("DN"))},applyPermission:function(){var params={mode:"applyPermission"};params.input=JSON.stringify(AttPermissions.permissionParam),Layout.Page.container.find("#ZPAtt_SavePermission").prop("disabled",!0),ZPeople.Request.send("/AttendanceAction.zp",params,function(data){(Attendance.getCurrPositionTriggered=!1,AttPermissions.permissionParam={},Layout.Page.container.find("#ZPAtt_SavePermission").prop("disabled",!1),data.errorCode)?AttPermissions.showErrorMessageForPermission(data):(-1===Layout.Page.hash.indexOf("attendance/permission/myrequests")?Attendance.Entry.getList(AttPermissions.selectedView,AttPermissions.preMonth):AttPermissions.getRequest(!1),Layout.Page.container.find("#ZPAtt_Permission_addRequest").modal("hide"))})},showErrorMessageForPermission:function(data){var errorCode=data.errorCode;if(102==errorCode)Layout.Page.container.find("#permissionLimitExceededErr").removeClass("DN");else if(103==errorCode){var timeDisp=Attendance.disHours(data.allowedCount);Layout.Page.container.find("#permissionMinTimeErr").html(ZPI18N.getString("zp.permissionlessthanmintime",new Array(timeDisp))),Layout.Page.container.find("#permissionMinTimeErr").removeClass("DN")}else if(104==errorCode){timeDisp=Attendance.disHours(data.allowedCount);Layout.Page.container.find("#permissionMaxTimeErr").html(ZPI18N.getString("zp.permissiongreaterthanmaxtime",new Array(timeDisp))),Layout.Page.container.find("#permissionMaxTimeErr").removeClass("DN")}else 105==errorCode?Layout.Page.container.find("#permissionAllowedInstanceExceededErr").removeClass("DN"):106==errorCode||108==errorCode?Layout.Page.container.find("#permissionWithSameTimeErr").removeClass("DN"):109==errorCode&&(Layout.Page.container.find("#permissionMaxTimeErr").html(data.errorMessage),Layout.Page.container.find("#permissionMaxTimeErr").removeClass("DN"))},validateApplyPermission:function(date,permissionId,fromTime,toTime){var returnFromApplyPermission=!1;return""==date&&(Layout.Page.container.find("#permissionDateEmptyErr").removeClass("DN"),returnFromApplyPermission=!0),null==permissionId&&(Layout.Page.container.find("#permissionTypeEmptyErr").removeClass("DN"),returnFromApplyPermission=!0),""==fromTime&&(Layout.Page.container.find("#permissionFromTimeEmptyErr").removeClass("DN"),returnFromApplyPermission=!0),""==toTime&&(Layout.Page.container.find("#permissionToTimeEmptyErr").removeClass("DN"),returnFromApplyPermission=!0),returnFromApplyPermission},showImport:function(){var permissionImportParent=Layout.Page.container.find("#ZPAtt_permission_importPopup");permissionImportParent.find("#ZPAtt_permission_importSuccMsg").hide(),permissionImportParent.find("#ZPAtt_permission_importSuccvalues").hide(),permissionImportParent.find("#ZPAtt_permission_import").parent().parent().removeAttr("class"),permissionImportParent.find("#ZPAtt_permission_import").fadeIn(300),permissionImportParent.find("#ZPAtt_permission_impEx").fadeIn(300),permissionImportParent.find("#ZPAtt_permission_importFileConf").hide(),permissionImportParent.find("#ZPAtt_permission_importMap").hide(),permissionImportParent.find("#ZPAtt_permission_importInput").val(""),permissionImportParent.find("#ZPAtt_permission_importDesc").after(permissionImportParent.find("#ZPAtt_permission_importInputCont").show()),permissionImportParent.find("#ZPAtt_permission_importInputCont span").text(ZPI18N.getString("zp.importfile")),permissionImportParent.find("#ZPAtt_permission_importInputCont").attr("class","btn btn-primary ZPbtnDefault"),permissionImportParent.find("#ZPAtt_permission_importNext").hide(),permissionImportParent.find("#ZPAtt_permission_importPrevious").hide(),permissionImportParent.find("#ZPAtt_permission_importHeader li").first().attr("class","active"),permissionImportParent.find("#ZPAtt_permission_importHeader li").last().removeAttr("class"),Layout.Page.container.find("#ZPAtt_permission_importPopup .modal-body").find("#zp_page_loading").remove(),Layout.Page.container.find("#ZPAtt_permission_importPopup .modal-body").children().show(),Layout.Page.container.find("#importErrDiv").hide(),ZPeople.BSModal.show($("#"+Layout.Page.pageId+" #ZPAtt_permission_importPopup")),AttPermissions.getPendingImport()},onInputChange:function(){var permissionImportParent=Layout.Page.container.find("#ZPAtt_permission_importPopup"),fileName=permissionImportParent.find("#ZPAtt_permission_importInput").val();fileName=fileName.replace("C:\\fakepath\\",""),permissionImportParent.find("#ZPAtt_permission_importProgress").hide(),permissionImportParent.find("#ZPAtt_permission_importProgress").next().show(),permissionImportParent.find("#ZPAtt_permission_importFName").text(fileName),permissionImportParent.find("#ZPAtt_permission_importSuccMsg").hide(),permissionImportParent.find("#ZPAtt_permission_importSuccvalues").hide(),permissionImportParent.find("#ZPAtt_permission_importProgress").after(permissionImportParent.find("#ZPAtt_permission_importInputCont")),permissionImportParent.find("#ZPAtt_permission_importInputCont span").text(ZPI18N.getString("zp.removeandnew")),permissionImportParent.find("#ZPAtt_permission_importInputCont").attr("class","btn btn-default ZPbtnDefault");var extn=fileName.split(".").pop();"xls"===extn||"csv"===extn?(permissionImportParent.find("#ZPAtt_permission_importFName").next().attr("class","IC-rou-tik ML5 filetck"),permissionImportParent.find("#ZPAtt_permission_importNext").fadeIn(300),Layout.Page.container.find("#ZPAtt_permission_importNext").attr("disabled",!1),permissionImportParent.find("#ZPAtt_permission_importNext").off("click").on("click",function(){AttPermissions.submitImport()})):(permissionImportParent.find("#ZPAtt_permission_importFName").next().attr("class","IC-r-close ML5 PR S18 red"),permissionImportParent.find("#ZPAtt_permission_importNext").hide(),permissionImportParent.find("#ZPAtt_permission_importInput").val(""),""===permissionImportParent.find("#ZPAtt_permission_importFName").text()&&permissionImportParent.find("#ZPAtt_permission_importFName").text(ZPI18N.getString("zp.choosefile"))),permissionImportParent.find("#ZPAtt_permission_import").hide(),permissionImportParent.find("#ZPAtt_permission_impEx").hide(),permissionImportParent.find("#ZPAtt_permission_importFileConf").fadeIn(300),permissionImportParent.find("#ZPAtt_permission_importMap").hide()},submitImport:function(){var permissionImportParent=Layout.Page.container.find("#ZPAtt_permission_importPopup");permissionImportParent.find("#ZPAtt_permission_importNext").off("click"),AttPermissions.ProgressBarWidth=0,permissionImportParent.find("#ZPAtt_permission_importProgress").next().hide(),permissionImportParent.find("#ZPAtt_permission_importProgress div").width(AttPermissions.ProgressBarWidth+"%").parent().show(),AttPermissions.showProgress(permissionImportParent);var form=permissionImportParent.find("#ZPAtt_permission_importInput")[0].form;""!==permissionImportParent.find("#ZPAtt_permission_importInput").val()&&(Layout.Page.container.find("#ZPAtt_permission_importNext").attr("disabled",!0),Layout.Page.container.find("#ZPAtt_permission_importFormCsrf").val(csrfToken),form.action="AttendanceImport.zp",form.submit())},ProgressBarWidth:0,showProgress:function(){Layout.Page.container.find("#ZPAtt_permission_importPopup").find("#ZPAtt_permission_importProgress div").width(AttPermissions.ProgressBarWidth+"%"),AttPermissions.ProgressBarWidth+=2,AttPermissions.ProgressBarWidth<=99&&setTimeout(AttPermissions.showProgress,1)},getPendingImport:function(){var pendingMsg=Layout.Page.container.find("#ZPAtt_permission_importPopup").find("#ZPAtt_permission_importMsg");pendingMsg.parent().hide();var param={mode:"getPendingImportInfo",conreqcsr:csrfToken,type:"PermissionMyRequest"};$.post("/AttendanceAction.zp",param,function(rdata){"empty"===rdata.tableInfo.tableHeaders?(pendingMsg.off("click"),pendingMsg.html(""),pendingMsg.parent().hide()):(pendingMsg.attr("class","blu CP"),pendingMsg.off("click").on("click",function(){AttPermissions.showMapping(rdata.tableInfo)}),pendingMsg.html(rdata.tableInfo.recordCount+" "+ZPI18N.getString("zp.recordspending")),pendingMsg.parent().fadeIn(300))})},showMapping:function(obj){var permissionImportParent=Layout.Page.container.find("#ZPAtt_permission_importPopup");permissionImportParent.find("#ZPAtt_permission_importNext").attr("disabled",!1),permissionImportParent.find("#ZPAtt_permission_import").hide(),permissionImportParent.find("#ZPAtt_permission_impEx").hide(),permissionImportParent.find("#ZPAtt_permission_importFileConf").hide(),permissionImportParent.find("#ZPAtt_permission_importMap").fadeIn(300),permissionImportParent.find("#ZPAtt_permission_importPrevious").fadeIn(300),permissionImportParent.find("#ZPAtt_permission_importNext").fadeIn(300),permissionImportParent.find("#ZPAtt_permission_importHeader li").last().attr("class","active"),permissionImportParent.find("#ZPAtt_permission_importNext").off("click").on("click",function(){AttPermissions.submitPermissionMapping(obj.fileFormat,permissionImportParent)});var rArray=obj.tableHeaders,res="<option value='None' selected='selected'>-- "+ZPI18N.getString("zp.select")+" --</option>";for(var i in rArray)res+="<option value='"+i+"'>"+rArray[i]+"</option>";for(var i in permissionImportParent.find("#ZPAtt_permission_importMap select").select2(),"csv"!==obj.fileFormat?permissionImportParent.find("#ZPAtt_permission_importDateFor label").html(ZPI18N.getString("zp.dateformat")):permissionImportParent.find("#ZPAtt_permission_importDateFor label").html("<font>"+ZPI18N.getString("zp.dateformat")+"</font>"),permissionImportParent.find("#ZPAtt_permission_importDateFor select").select2("val","0"),permissionImportParent.find("#ZPAtt_permission_importIds select").html(res),permissionImportParent.find("#ZPAtt_permission_importPermission select").html(res),permissionImportParent.find("#ZPAtt_permission_importDate select").html(res),permissionImportParent.find("#ZPAtt_permission_importFromTime select").html(res),permissionImportParent.find("#ZPAtt_permission_importToTime select").html(res),permissionImportParent.find("#ZPAtt_permission_importReason select").html(res),rArray)-1!==rArray[i].toLowerCase().indexOf("employee")||-1!==rArray[i].toLowerCase().indexOf("id")||-1!==rArray[i].toLowerCase().indexOf("user")?permissionImportParent.find("#ZPAtt_permission_importIds select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("date")?permissionImportParent.find("#ZPAtt_permission_importDate select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("permission")?permissionImportParent.find("#ZPAtt_permission_importPermission select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("reason")?permissionImportParent.find("#ZPAtt_permission_importReason select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("from")||-1!==rArray[i].toLowerCase().indexOf("start")?permissionImportParent.find("#ZPAtt_permission_importFromTime select").select2("val",i):-1===rArray[i].toLowerCase().indexOf("to")&&-1===rArray[i].toLowerCase().indexOf("end")||permissionImportParent.find("#ZPAtt_permission_importToTime select").select2("val",i);permissionImportParent.find("#ZPAtt_permission_importMsg").off("click"),permissionImportParent.find("#ZPAtt_permission_importMsg").attr("class","blu"),permissionImportParent.find("#ZPAtt_permission_importMsg").parent().fadeIn(300),obj.error&&"rowExceededLimit"===obj.error?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.importcntexceederror"),!0),permissionImportParent.find("#ZPAtt_permission_importNext").attr("disabled",!0),permissionImportParent.find("#ZPAtt_permission_importMsg").text("")):void 0!==obj.recordCount?permissionImportParent.find("#ZPAtt_permission_importMsg").text(obj.recordCount+" "+ZPI18N.getString("zp.recordsfound")):permissionImportParent.find("#ZPAtt_permission_importMsg").text("0 "+ZPI18N.getString("zp.recordsfound")),permissionImportParent.find("#ZPAtt_permission_importMap select").select2()},submitPermissionMapping:function(fileFormat){var permissionImportParent=Layout.Page.container.find("#ZPAtt_permission_importPopup"),si_Id=permissionImportParent.find("#ZPAtt_permission_importIds select")[0].selectedIndex,si_Permission=permissionImportParent.find("#ZPAtt_permission_importPermission select")[0].selectedIndex,si_Date=permissionImportParent.find("#ZPAtt_permission_importDate select")[0].selectedIndex,si_fromTime=permissionImportParent.find("#ZPAtt_permission_importFromTime select")[0].selectedIndex,si_toTime=permissionImportParent.find("#ZPAtt_permission_importToTime select")[0].selectedIndex,si_reason=permissionImportParent.find("#ZPAtt_permission_importReason select")[0].selectedIndex;if(0!==si_Id&&0!=si_Permission&&0!=si_Date&&0!==si_fromTime&&0!==si_toTime){var param={mode:"permissionImportMapping",mailId:si_Id-1,permissionId:si_Permission-1,date:si_Date-1,fromTimeId:si_fromTime-1,toTimeId:si_toTime-1,reasonId:si_reason-1,conreqcsr:csrfToken};"0"!==permissionImportParent.find("#ZPAtt_permission_importDateFor select").val()&&(param.dateFormat=permissionImportParent.find("#ZPAtt_permission_importDateFor select").val()),"csv"!==fileFormat||param.dateFormat?(permissionImportParent.find("#ZPAtt_permission_importNext").attr("disabled",!0),permissionImportParent.find("#ZPAtt_permission_importPopup .modal-body").children().hide(),permissionImportParent.find("#ZPAtt_permission_importPopup .modal-body").append(ZPeople.LOADING_HTML),$.post("/AttendanceAction.zp",param,function(resultData){if(permissionImportParent.find("#ZPAtt_permission_importPopup .modal-body").find("#zp_page_loading").remove(),permissionImportParent.find("#ZPAtt_permission_importPopup .modal-body").children().show(),resultData.msg){if(permissionImportParent.find("#ZPAtt_permission_import").parent().parent().attr("class","ZPImfrm ZPRecList"),permissionImportParent.find("#ZPAtt_permission_importMap").hide(),permissionImportParent.find("#ZPAtt_permission_importMsg").parent().hide(),permissionImportParent.find("#ZPAtt_permission_importSuccMsg").fadeIn(300),permissionImportParent.find("#ZPAtt_permission_importSuccvalues").fadeIn(300),permissionImportParent.find("#ZPAtt_permission_importSuccvalues span")[1].innerHTML="0",resultData.msg.successCount&&(permissionImportParent.find("#ZPAtt_permission_importSuccvalues span")[1].innerHTML=resultData.msg.successCount),permissionImportParent.find("#ZPAtt_permission_importSuccvalues span")[0].innerHTML="0",resultData.msg.totalCount&&(permissionImportParent.find("#ZPAtt_permission_importSuccvalues span")[0].innerHTML=resultData.msg.totalCount),permissionImportParent.find("#ZPAtt_permission_importPrevious").hide(),permissionImportParent.find("#ZPAtt_permission_importNext").hide(),resultData.msg.errorType)return void ZPeople.Message.showFailureMsg(resultData.msg.errorType);if(AttPermissions.getRequest(!1),resultData.msg.emptyEmpIds||resultData.msg.skippedEmpInfo||resultData.msg.errorInfo){var rowNumber=0;if(permissionImportParent.find("#importErrDiv").show(),permissionImportParent.find("#importErrTBody").find("tr").remove(),resultData.msg.skippedEmpInfo){var length=resultData.msg.skippedEmpInfo.length;permissionImportParent.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.invalidempinfoforshiftimport")+"<ul></ul></td></tr>"));for(var i=0;i<length;i++)$($(permissionImportParent.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+$("<div/>").text(resultData.msg.skippedEmpInfo[i]).html()+"</li>");rowNumber++}if(resultData.msg.emptyEmpIds){length=resultData.msg.emptyEmpIds.length;permissionImportParent.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.invalidempinfoforshiftimport")+"<ul></ul></td></tr>"));for(i=0;i<length;i++)$($(permissionImportParent.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+resultData.msg.emptyEmpIds[i]+"</li>");rowNumber++}if(resultData.msg.errorInfo){var errObj=resultData.msg.errorInfo;for(length=errObj.length,i=0;i<length;i++){var errrObj=errObj[i],firstKey=Object.keys(errrObj)[0];permissionImportParent.find("#importErrTBody").append($("<tr class='ZPLRow'><td>"+ZPI18N.getString("zp.row")+" "+firstKey+"</td><td>"+AttPermissions.getPermissionImportErrorMessage(errrObj[firstKey])+"</td></tr>"))}}}}else resultData.error&&(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")),Layout.Page.container.find("#ZPAtt_permission_importNext").attr("disabled",!1),Layout.Page.container.find("#ZPAtt_permission_importNext").off("click").on("click",function(){AttPermissions.submitPermissionMapping(fileFormat)}))})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))},getPermissionImportErrorMessage:function(data){var errorCode=data.errorCode;if(102==errorCode)return ZPI18N.getString("zp.allowedpermissionexceeded");if(103==errorCode){var timeDisp=Attendance.disHours(data.allowedCount);return ZPI18N.getString("zp.permissionlessthanmintime",new Array(timeDisp))}if(104==errorCode){timeDisp=Attendance.disHours(data.allowedCount);return ZPI18N.getString("zp.permissiongreaterthanmaxtime",new Array(timeDisp))}return 105==errorCode?ZPI18N.getString("zp.permissionallowedinstanceexceeded"):301==errorCode?ZPI18N.getString("zp.permissionnameinvalid"):109==errorCode?data.errorMessage:""},formId:null,permAppConfInfolist:null,getPermAppConfInfolist:function(){var layout=Layout.Page.container,param={mode:"fetchPermApprovals",conreqcsr:csrfToken};Attendance.toggleLoadingDiv(!1,layout.find("#ZPAtt_Sett_PermApp"),layout.find("#ZPAtt_SettPermApp_emptyRecInfo")),$.post("/AttendanceSettingsAction.zp",param,function(rdata){AttPermissions.permAppConfInfolist=rdata,AttPermissions.consPermAppConfInfolist()})},consPermAppConfInfolist:function(){for(var rdata=AttPermissions.permAppConfInfolist,layout=Layout.Page.container,txt="",i=0;i<rdata.list.length;i++){var data=rdata.list[i];data&&data.FORMID?(AttPermissions.formId=data.FORMID,txt+='<tr  class="ZPLRow" id="approval_'+data.FORM_TEMPLATE_ACTION_ID+'" approvalId="'+data.FORM_TEMPLATE_ACTION_ID+'"  >',txt+="<td class='CP' onclick=AttPermissions.editApproval(\""+data.FORM_TEMPLATE_ACTION_ID+'","'+AttPermissions.formId+'");>'+data.TEMPLATE_NAME+"</td>",txt+="<td>"+data.SUBJECT+"</td>",txt+='<td><div class="btnactive"><input type="checkbox" onclick="ApprovalProcess.enableDisable(\''+data.FORM_TEMPLATE_ACTION_ID+"','"+AttPermissions.formId+'\');" class="cmn-toggle-small cmn-toggle-round-small" id="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"',data.ISACTIVE&&(txt+=" checked"),txt+='><label class="M0" for="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"></label></div></td>',txt+="<td class='text-right P0I'><div id='ZPAtt_SettPermApp_delAction' class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_SettPermApp_delConfirm','table-responsive')></i><i class='IC-pen S14 gry FR MR15 CP' onclick=AttPermissions.editApproval(\""+data.FORM_TEMPLATE_ACTION_ID+'","'+AttPermissions.formId+'");></i></div>',txt+="<div style='display:none' id='ZPAtt_SettPermApp_delConfirm'>",txt+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_SettPermApp_delAction','table-responsive')>"+ZPI18N.getString("zp.cancel")+"</button>",txt+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=AttPermissions.deleteApproval(\""+AttPermissions.formId+'","'+data.FORM_TEMPLATE_ACTION_ID+'")>'+ZPI18N.getString("zp.confirm")+"</button></div>",txt+="</td><td></td>",txt+="</tr>"):data&&data.newformid&&(AttPermissions.formId=data.newformid)}if(layout.find("#ZPAtt_Sett_PermApp_DetBody").html(txt),0===layout.find("#ZPAtt_Sett_PermApp_DetBody").children().length){layout.find("#ZPAtt_Sett_PermApp_Det").parent().hide(),layout.find("#ZPAtt_SettPermApp_emptyRecInfo").fadeIn(200),layout.find("#ZPAtt_Sett_PermApp").removeClass("section");var empImg=layout.find("#ZPAtt_SettPermApp_emptyRecInfo i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-set-regularization",empImg)}else layout.find("#ZPAtt_Sett_PermApp_Det").parent().fadeIn(200),layout.find("#ZPAtt_SettPermApp_emptyRecInfo").hide(),layout.find("#ZPAtt_Sett_PermApp").attr("class","Scrcont section");Attendance.toggleLoadingDiv(!0),layout.find("#ZPAtt_Sett_PermApp_Det").parent().hasClass("tabcont")||ZPView.handleTablePosition()},editApproval:function(approvalId,formId){ApprovalProcess.getApprovalRow(approvalId,formId,AttPermissions.getPermAppConfInfolist)},deleteApproval:function(formId,approvalId){var layout=Layout.Page.container,params={formTemplateId:approvalId,formId:formId,method:"deleteApproval",conreqcsr:csrfToken};$.post("/deleteApproval.zp",params,function(resultData){"success"===resultData.result?layout.find("#ZPAtt_Sett_PermApp_DetBody").find("#approval_"+approvalId).fadeOut("fast",function(){layout.find("#ZPAtt_Sett_PermApp_DetBody").find("#approval_"+approvalId).remove(),0===layout.find("#ZPAtt_Sett_PermApp_DetBody").find("tr").length&&(layout.find("#ZPAtt_Sett_PermApp_Det").parent().hide(),layout.find("#ZPAtt_SettPermApp_emptyRecInfo").fadeIn(200),layout.find("#ZPAtt_Sett_PermApp").removeClass("section"),0===$("ZPAtt_SettPermApp_emptyRecInfo div").children().length&&ZPUtil.noDataSVG("ZPAtt_SettPermApp_emptyRecInfo div",ZPeople.getResourceURL(newUIImageUrl+"svg/no-data.svg"))),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.approvalconfigdeletionsuccess"))}):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.recordnotfound"))})}},AttendanceApprovals={replaceSubTabId:function(){$("#zp_active_subtabs #zp_t_attendance_onduty_myrequests").attr("id","zp_t_attendance_myrequests"),$("#zp_active_subtabs #zp_t_attendance_regularization_myrequests").attr("id","zp_t_attendance_myrequests"),$("#zp_active_subtabs #zp_t_attendance_permission_myrequests").attr("id","zp_t_attendance_myrequests"),$("#zp_active_subtabs #zp_t_attendance_shiftmapping_shiftmaprequests").attr("id","zp_t_attendance_myrequests"),$("#zp_active_subtabs #zp_t_attendance_onduty_myapprovals").attr("id","zp_t_attendance_myapprovals"),$("#zp_active_subtabs #zp_t_attendance_regularization_myapprovals").attr("id","zp_t_attendance_myapprovals"),$("#zp_active_subtabs #zp_t_attendance_permission_myapprovals").attr("id","zp_t_attendance_myapprovals"),$("#zp_active_subtabs #zp_t_attendance_shiftmapping_shiftmapapprovals").attr("id","zp_t_attendance_myapprovals")},appendApprovalTopBand:function(approvalType,moduleType){if(AttendanceApprovals.replaceSubTabId(),$("#zp_active_subtabs #zp_t_attendance_"+approvalType).attr("href","#"+Layout.Page.currentmode).parent().addClass("active"),0==$("#attendanceApprovalBar").length){var html='<nav class="navbar navbar-default ZPSnav" id="attendanceApprovalBar">';html+='<div class="container-fluid">',html+='<ul class="nav navbar-nav" id="attendanceApprovalTabs">',ZPeople.Module.MODULE_DATA.attendance.isRegConfigured&&(html+="<li id =\"regularizationApprTab\"><a onclick=\"AttendanceApprovals.approvalTabChange('regularization','"+approvalType+"')\">"+ZPI18N.getString("zp.regularization")+"</a></li>"),ZPeople.Module.MODULE_DATA.attendance.isPermissionConfigured&&(html+="<li id =\"permissionApprTab\"><a onclick=\"AttendanceApprovals.approvalTabChange('permission','"+approvalType+"')\">"+ZPI18N.getString("zp.permissions")+"</a></li>"),ZPeople.Module.MODULE_DATA.attendance.isOnDutyConfigured&&(html+="<li id =\"ondutyApprTab\"><a onclick=\"AttendanceApprovals.approvalTabChange('onduty','"+approvalType+"')\">"+ZPI18N.getString("zp.onduty")+"</a></li>");var shiftMapUrlEnd="myapprovals"===approvalType?"shiftmapapprovals":"shiftmaprequests";ZPeople.Module.MODULE_DATA.attendance.isShiftApprConfigured&&(html+="<li id =\"shiftmappingApprTab\"><a onclick=\"AttendanceApprovals.approvalTabChange('shiftmapping','"+shiftMapUrlEnd+"')\">"+ZPI18N.getString("zp.shiftchangeapprovals")+"</a></li>"),html+="</ul></div></nav>",$("#page-wrapper").prepend(html),$("#"+moduleType+"ApprTab").addClass("active"),$("#zp_active_subtabs #zp_t_attendance_"+approvalType).parent().addClass("active").parent().show(),$("#zp_active_subtabs #zp_t_attendance_"+shiftMapUrlEnd).parent().addClass("active").parent().show()}else $("#attendanceApprovalBar").removeClass("DN"),$("#attendanceApprovalTabs li.active").removeClass("active"),$("#attendanceApprovalTabs #"+moduleType+"ApprTab").addClass("active"),$("#attendanceApprovalTabs #ondutyApprTab a").attr("onclick","AttendanceApprovals.approvalTabChange('onduty','"+approvalType+"')"),$("#attendanceApprovalTabs #regularizationApprTab a").attr("onclick","AttendanceApprovals.approvalTabChange('regularization','"+approvalType+"')"),$("#attendanceApprovalTabs #permissionApprTab a").attr("onclick","AttendanceApprovals.approvalTabChange('permission','"+approvalType+"')"),$("#attendanceApprovalTabs #shiftmappingApprTab a").attr("onclick","AttendanceApprovals.approvalTabChange('shiftmapping','"+approvalType+"')")},approvalTabChange:function(moduleType,approvalType){AttendanceApprovals.appendApprovalTopBand(approvalType,moduleType);var reqUrl="#attendance/"+moduleType+"/"+approvalType;"shiftmapping"===moduleType&&(reqUrl="#attendance/"+moduleType+"/"+("myapprovals"===approvalType?"shiftmapapprovals":"shiftmaprequests"));"myapprovals"==approvalType?$("#zp_t_attendance_myapprovals").attr("href",reqUrl):$("#zp_t_attendance_myrequests").attr("href",reqUrl),window.location.href=reqUrl}},AttendanceShift={isHoursListView:!1,isUserShiftMapping:!1,hasPendingImportedFiles:!1,init:function(){AttendanceShift.LayoutId="#"+Layout.Page.container[0].id,AttendanceShift.getDepLocShiftList();var attModule=ZPeople.Module.MODULE_DATA.attendance;isLeadForShift=attModule.isLeadForShift,isManageAttSettings=attModule.isManageAttSettings,isManageAttendanceData=attModule.isManageAttedance,isEmpChooseApp=attModule.isEmpChooseShiftApp,isShiftEditAllowed=attModule.isShiftEditAllowed,isShiftViewAllowed=attModule.isShiftViewAllowed,isSPOCShiftView=attModule.isSPOCShiftView,isSPOCShiftEdit=attModule.isSPOCShiftEdit,isShiftChangeReasonMandatory=attModule.isShiftChangeReasonMandatory,editPastShiftPermRepMan=attModule.editPastShiftPermRepMan,editPastShiftPermUser=attModule.editPastShiftPermUser,isShiftApprConfigured=attModule.isShiftApprConfigured;var layout=Layout.Page.container;layout.find("select[multiple='multiple']").select2({minimumResultsForSearch:5,closeOnSelect:!1}),layout.find("select:not([multiple='multiple'])").select2({minimumResultsForSearch:5}),layout.find("[data-toggle=tooltip]").tooltip({trigger:"click"});var removeOrgStructFil=!isOrgStructureEnabled;isSPOCShiftView||isManageAttendanceData||isadmin||isLeadForShift||(layout.find("#ZPAtt_location").remove(),layout.find("#ZPAtt_department").remove(),layout.find("#ZPAtt_empName").remove(),removeOrgStructFil=!0),AttendanceShift.removeOrgStructFilter(Layout.Page.container,removeOrgStructFil),isSPOCShiftEdit||isManageAttendanceData||isadmin||isLeadForShift&&0!==isShiftEditAllowed||layout.find("#ZPAtt_Shift_importList").hide(),(isSPOCShiftEdit||isadmin||isManageAttendanceData||isLeadForShift&&1===isShiftEditAllowed||2===isShiftEditAllowed||3===isShiftEditAllowed)&&layout.find("#ZPAtt_settingsAddNew").show(),isSPOCShiftView||isManageAttendanceData||isadmin||Layout.Page.container.find("#ZPAtt_myReqShiftMap_empProfile").parent().parent().remove(),isShiftChangeReasonMandatory?($(AttendanceShift.LayoutId+" #ZPAtt_shift_reason label").addClass("zp_mdt"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importReason label").addClass("zp_mdt")):($(AttendanceShift.LayoutId+" #ZPAtt_shift_reason label").removeClass("zp_mdt"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importReason label").removeClass("zp_mdt"))},startIndex:0,getShiftMapRequest:function(isScroll,fromSubmit,navigate){Layout.Page.container.find("#ZPAtt_ShiftBulkDelete").parent().addClass("col-sm-3"),Layout.Page.container.find("#ZPAtt_ShiftBulkDelete").hide().prev().show(),isScroll||fromSubmit||(Attendance.Report.consHierarchyFilters(Layout.Page.container.find("#ZPAtt_shiftMapFilter"),"myReqShiftMap",!0,AttendanceShift.depLocShiftOptions),Layout.Page.container.find("#ZPAtt_myReqShiftMap_shift").children().remove(),Layout.Page.container.find("#ZPAtt_myReqShiftMap_shift").append(AttendanceShift.depLocShiftOptions.shiftOption)),Layout.Page.container.find("#ZPAtt_ShiftMapReqView_filter").hasClass("ZPFilsel")&&$("#page-wrapper").attr("class","Nbar2F THF-2F");var param={mode:"getMyShiftMapRequests",status:Layout.Page.container.find("#ZPAtt_Shift_Status").val(),conreqcsr:csrfToken},shiftList=Layout.Page.container.find("#ZPAtt_myReqShiftMap_shift").val();shiftList&&shiftList.length>0&&(param.shiftId=JSON.stringify(shiftList)),AttendanceShift.isShiftReqFromNav=void 0,navigate&&(param.navigate=navigate,AttendanceShift.isShiftReqFromNav=!0),Layout.Page.container.find("#ZPAtt_EmpShiftMapList_myReqEmpSort").hasClass("sort-d")?param.isEmpSortAsc=!1:Layout.Page.container.find("#ZPAtt_EmpShiftMapList_myReqEmpSort").hasClass("sort-u")&&(param.isEmpSortAsc=!0);var filter=Layout.Page.container.find("#ZPAtt_shiftMapFilter");Attendance.Reg.getMyRequestDateFilter(param,"myReqShiftMap",filter),param.error||(Attendance.Report.getFilterValues(filter,param,"myReqShiftMap"),isScroll?param.startIndex=AttendanceShift.startIndex+1:(AttendanceShift.startIndex=0,Layout.Page.container.find("#ZPAtt_ShiftMyReqDetails").scrollTop(0),fromSubmit&&(Layout.Page.container.find("#ZPAtt_ShiftMapReq_emptyRecInfo")[0]&&Layout.Page.container.find("#ZPAtt_ShiftMapReq_emptyRecInfo").hide(),Layout.Page.container.find(" #ZPAtt_ShiftMyReqDetails").hide(),0===Layout.Page.container.find("#ZPAtt_ShiftMyReq").find("#zp_page_loading").length&&Layout.Page.container.find("#ZPAtt_ShiftMyReq").append(ZPeople.LOADING_HTML))),$.post("/AttendanceShiftAction.zp",param,function(resultData){if($("#zp_active_subtabs #zp_t_attendance_myrequests").attr("href","#attendance/shiftmapping/shiftmaprequests").parent().addClass("active"),resultData.error){if("exceeded dates"===resultData.error)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinthreemonth"));else if("error in end date"===resultData.error)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate"));else if("permission denied"===resultData.error){Layout.Page.container.find("#ZPAtt_ShiftMyReqHeader #ZPAtt_ShiftMyReqHeader_checkBox").remove(),Layout.Page.container.find("#ZPAtt_ShiftReqNav").hide();var empMessage=Layout.Page.container.find("#ZPAtt_ShiftMapReq_emptyRecInfo");empMessage.prev().hide(),empMessage.show(),Attendance.noDataImg(8,"CR-at-myreq",empMessage.find("i").eq(0))}}else{var shiftReqFilter=Layout.Page.container.find("#ZPAtt_ShiftMapFilters"),dateNav=Layout.Page.container.find("#ZPAtt_shiftReq_dateNav");AttendanceShift.isShiftReqFromNav?(shiftReqFilter.find("#ZPAtt_myReqShiftMap_fromDate").val(resultData.fDate).attr("disabled",!1),shiftReqFilter.find("#ZPAtt_myReqShiftMap_toDate").val(resultData.tDate).attr("disabled",!1),shiftReqFilter.find("#ZPAtt_myReqShiftMap_period").select2("val",6)):AttendanceShift.onPeriodChange(),resultData.dispMonth?dateNav.html(resultData.dispMonth):dateNav.html(Attendance.datesInHeader(resultData.fDate,resultData.tDate)),Layout.Page.container.find("#ZPAtt_ShiftMyReq").find("#zp_page_loading").remove(),20===resultData.list.length&&ZPeople.FireScroll.reset(),AttendanceShift.constructList(resultData,"getShiftRequestList",isScroll),"hh:mm a"!==resultData.timeformat?Attendance.timeFormatIs12hr=!1:Attendance.timeFormatIs12hr=!0}}))},ApprstartIndex:0,getShiftMapApprovals:function(isScroll,fromSubmit,callbackData){Layout.Page.container.find("#ZPAtt_ShiftTotalApprAction").hide(),Layout.Page.container.find("#ZPAtt_ShiftTotalApprAction").prev().show(),Layout.Page.container.find("#zp_approval_pop").is(":visible")&&ZPeople.BSModal.hide(),Attendance.toggleLoadingDiv(!1,Layout.Page.container.find("#ZPAtt_ShiftMyApproval"),Layout.Page.container.find("#ZPAtt_ShiftMapApproval_emptyRecInfo")),Layout.Page.container.find("#ZPAtt_ShiftMapReqView_filter").hasClass("ZPFilsel")&&$("#page-wrapper").attr("class","Nbar2F THF-2F");var param={mode:"getMyShiftMapApprovals",status:Layout.Page.container.find("#ZPAtt_Shift_Status").val(),conreqcsr:csrfToken};isScroll?param.startIndex=AttendanceShift.ApprstartIndex+1:(Layout.Page.container.find("#ZPAtt_ShiftMyApprovalDetails").scrollTop(0),AttendanceShift.ApprstartIndex=0,fromSubmit&&(Layout.Page.container.find("#ZPAtt_ShiftMapApproval_emptyRecInfo")[0]&&Layout.Page.container.find("#ZPAtt_ShiftMapApproval_emptyRecInfo").hide(),Layout.Page.container.find("#ZPAtt_ShiftMyApprovalDetails").hide(),0===Layout.Page.container.find("#ZPAtt_ShiftMyApproval").find("#zp_page_loading").length&&Layout.Page.container.find("#ZPAtt_ShiftMyApproval").append(ZPeople.LOADING_HTML))),$.post("/AttendanceShiftAction.zp",param,function(resultData){$("#zp_active_subtabs #zp_t_attendance_myapprovals").attr("href","#attendance/shiftmapping/shiftmapapprovals").parent().addClass("active"),Layout.Page.container.find("#ZPAtt_ShiftMyApproval").find("#zp_page_loading").remove(),resultData&&void 0!==resultData.list&&resultData.list.length>0&&Layout.Page.container.find("#ZPAtt_ShiftTotalApprAction").attr("onclick","ZPApprovals.viewApproveActionPopup("+resultData.list[0].formId+")"),AttendanceShift.constructList(resultData,"getShiftMapApprovals",isScroll),callbackData&&callbackData.error&&AttendanceShift.consApproveRejectErrorMsg(callbackData,!0),20===resultData.list.length&&ZPeople.FireScroll.reset()})},constructList:function(resultData,mode,isScroll){var adminUserList,result=resultData.list;"getShiftRequestList"===mode&&(adminUserList=resultData.loginUser_adminUserList);var emptyMessage=Layout.Page.container.find("#ZPAtt_ShiftMapReq_emptyRecInfo"),tslisttbody=Layout.Page.container.find("#ZPAtt_ShiftMyReqBody"),subUrl="viewmyrequest",noDataImg="CR-at-myreq";"getShiftMapApprovals"===mode&&(tslisttbody=Layout.Page.container.find("#ZPAtt_ShiftMyApprovalBody"),emptyMessage=Layout.Page.container.find("#ZPAtt_ShiftMapApproval_emptyRecInfo"),subUrl="viewmyapproval",noDataImg="CR-at-regapp"),tslisttbody.parent().find("thead input").attr("checked",!1),emptyMessage.hide(),emptyMessage.prev().show(),isScroll||tslisttbody.empty(),"getShiftRequestList"!==mode||isSPOCShiftEdit||isManageAttendanceData||isadmin||Layout.Page.container.find("#ZPAtt_ShiftMyReqHeader #ZPAtt_ShiftMyReqHeader_checkBox").remove();var space="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";$.each(result,function(ind,shiftMapDetails){var html='<tr class="ZPLRow" id="list-'+shiftMapDetails.recordId+'" recordId="'+shiftMapDetails.recordId+'">';"getShiftMapApprovals"===mode?-1===shiftMapDetails.status||shiftMapDetails.status===zpconst.ApprovalStatus.CancellationPending?html+='<td><div class="checkbox"><input approvalStatus='+shiftMapDetails.status+' type="checkbox" val="'+shiftMapDetails.recordId+"\" onclick=\"AttendanceShift.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>':-1!==shiftMapDetails.status&&(html+='<td><div class="checkbox disabled"><input approvalStatus='+shiftMapDetails.status+' type="checkbox" disabled="true"><label class="MT3"></label></div></td>'):"getShiftRequestList"===mode&&(isSPOCShiftEdit&&isSPOCShiftEdit.includes(shiftMapDetails.erecno)||isadmin||isManageAttendanceData&&(!adminUserList||adminUserList&&adminUserList.includes(shiftMapDetails.erecno))?html+='<td><div class="checkbox"><input type="checkbox" approvalStatus='+shiftMapDetails.status+' val="'+shiftMapDetails.recordId+"\" onclick=\"AttendanceShift.changeCheckBox(this,'single','"+mode+'\')"><label class="MT3"></label></div></td>':(isSPOCShiftEdit&&!isSPOCShiftEdit.includes(shiftMapDetails.erecno)||isManageAttendanceData&&adminUserList&&!adminUserList.includes(shiftMapDetails.erecno))&&(html+='<td><div class="checkbox disabled"><input type="checkbox" approvalStatus='+shiftMapDetails.status+' disabled="true"><label class="MT3"></label></div></td>'));var redUrl="data-toggle=modal onclick=\"window.location.href='#attendance/shiftmapping/"+subUrl+"-formId:"+shiftMapDetails.formId+"/recordId:"+shiftMapDetails.recordId+"'\"";if(html+='<td class="P_AM UN_A"><div class="ZPusrName"><img class="FL" src='+shiftMapDetails.empPhoto+'><span class="ellipsis CP" '+redUrl+"><b>"+$("<div/>").text(shiftMapDetails.empid).html()+"</b>"+$("<div/>").text(shiftMapDetails.empname).html()+"</span></div></td><td>",shiftMapDetails.conflictList)for(var loop=0;shiftMapDetails.conflictList[loop];loop++){var dateRange="";void 0!==(shiftDetails=shiftMapDetails.conflictList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);var shift=AttendanceShift.depLocShiftList.shiftlist[shiftDetails.shiftId];shiftMapDetails.conflictList.length>1&&loop<shiftMapDetails.conflictList.length-1?(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="MB12 S13"><span class="sft-date">'+dateRange+"</span></div>"):(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="S13"><span class="sft-date">'+dateRange+"</span></div>")}else if(shiftMapDetails.newList){shift="";var shiftDetails=shiftMapDetails.newList[0];dateRange="";for(var shiftId in void 0!==shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat),AttendanceShift.depLocShiftList.shiftlist)if(1==AttendanceShift.depLocShiftList.shiftlist[shiftId].select){shift=AttendanceShift.depLocShiftList.shiftlist[shiftId];break}""!==shift&&(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="S13"><span class="sft-date">'+dateRange+"</span></div>")}else html+="-";if(html+="</td><td>",shiftMapDetails.newList)for(loop=0;shiftMapDetails.newList[loop];loop++){dateRange="";void 0!==(shiftDetails=shiftMapDetails.newList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);shift=AttendanceShift.depLocShiftList.shiftlist[shiftDetails.shiftId];shiftMapDetails.length>1&&loop<shiftMapDetails.newList.length-1?(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="MB12 S13"><span class="sft-date">'+dateRange+"</span></div>"):(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="S13"><span class="sft-date">'+dateRange+"</span></div>")}else html+="-";html+="</td>";var appStatus="";1===shiftMapDetails.status?appStatus="<span "+redUrl+' class="grn CP" id = "zp_ShiftApproval_approvereject">'+ZPI18N.getString("zp.approved")+"</span>":0===shiftMapDetails.status?appStatus="<span "+redUrl+' class="red CP" id = "zp_ShiftApproval_approvereject">'+ZPI18N.getString("zp.rejected")+"</span>":-1===shiftMapDetails.status||shiftMapDetails.status===zpconst.ApprovalStatus.CancellationPending?appStatus="getShiftRequestList"===mode?"<span "+redUrl+' class="CP" id = "zp_ShiftApproval_approvereject">'+ZPI18N.getString("zp.waitingmsg")+"</span>":3===shiftMapDetails.currentApprovalStatus?"<span "+redUrl+' class="CP" id = "zp_ShiftApproval_approvereject">'+ZPI18N.getString("zp.waitingnextlevel")+"</span>":'<button type=button class="btn btn-default btn-sm" id = "zp_ShiftApproval_approvereject"'+redUrl+">"+ZPI18N.getString("zp.clickapprove")+"</button>":-2===shiftMapDetails.status?appStatus="<span "+redUrl+' class="CP" id = "zp_ShiftApproval_approvereject">'+ZPI18N.getString("zp.drafts")+"</span>":2===shiftMapDetails.status&&(appStatus="<span "+redUrl+' class="CP red" id = "zp_ShiftApproval_approvereject">'+ZPI18N.getString("zp.cancelled")+"</span>"),html+="<td>"+appStatus,html+="</tr>",tslisttbody.append(html)}),Attendance.toggleLoadingDiv(!0),0===tslisttbody.children().length?(emptyMessage.prev().hide(),emptyMessage.show(),tslisttbody.prev().hide(),0===emptyMessage.find("i").eq(0).children().length&&Attendance.noDataImg(8,noDataImg,emptyMessage.find("i").eq(0))):tslisttbody.prev().show()},consApproveRejectErrorMsg:function(callbackData,isBulkApproval){if(callbackData&&callbackData.error){var errors=callbackData.error;if(isBulkApproval){var singleErr;ZPeople.Message.showFailureMsg(callbackData.errorMsg);for(var i=0;i<errors.length;i++){singleErr=errors[i];var recordRow=Layout.Page.container.find("#ZPAtt_ShiftMyApprovalBody").find("[recordid="+singleErr.recordId+"]");!singleErr.actionStatus&&recordRow&&(recordRow.addClass("LC2"),recordRow.find(".i_table").addClass("LC2"),7328===singleErr.code&&(singleErr.errorMsg=ZPI18N.getString("zp.commentsrequirederrormsg")),$('<i class="IC-info popHover red ML10" data-toggle="popover" data-content="'+singleErr.errorMsg+'" data-popover="true" data-original-title="" title=""></i>').insertAfter(recordRow.find("#zp_ShiftApproval_approvereject")))}Layout.Page.container.find("#ZPAtt_ShiftMyApprovalBody").popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"left",delay:{show:50,hide:50}}),setTimeout(function(){Layout.Page.container.find("#ZPAtt_ShiftMyApprovalBody").find("[recordid].LC2").removeClass("LC2"),Layout.Page.container.find("#ZPAtt_ShiftMyApprovalBody").find(".i_table.LC2").removeClass("LC2")},3e3)}}},onShiftMapRequestScroll:function(){AttendanceShift.startIndex+=20,AttendanceShift.getShiftMapRequest(!0)},onShiftMapApprovalScroll:function(){AttendanceShift.ApprstartIndex+=20,AttendanceShift.getShiftMapApprovals(!0)},changeCheckBox:function(obj,val,mode){var currPage=Layout.Page.container.find("#ZPAtt_ShiftMyReqDetails"),pagebutton=Layout.Page.container.find(" #ZPAtt_ShiftBulkDelete");"getShiftMapApprovals"===mode&&(currPage=Layout.Page.container.find("#ZPAtt_ShiftMyApprovalDetails"),pagebutton=Layout.Page.container.find("#ZPAtt_ShiftTotalApprAction")),"all"===val?$(obj).is(":checked")?currPage.find("tbody input[type=checkbox]:enabled").prop("checked",!0):currPage.find("tbody input[type=checkbox]:enabled").prop("checked",!1):currPage.find("tbody input[type=checkbox]:checked:enabled").length===currPage.find("tbody input[type=checkbox]:enabled").length?currPage.find("thead input[type=checkbox]:enabled").prop("checked",!0):currPage.find("thead input[type=checkbox]:enabled").prop("checked",!1),0===currPage.find("tbody input[type=checkbox]:checked:enabled").length?(pagebutton.hide(),pagebutton.prev().fadeIn(100)):(pagebutton.prev().hide(),pagebutton.fadeIn(100))},setApprovalSett:function(data){AttendanceShift.approvalSett=data},getAttendanceShiftDetails:function(formId,recordId,closeCallBack){Attendance.Entry.reloadFromWMS=!1,AttendanceShift.depLocShiftList||AttendanceShift.getDepLocShiftList();var popupTarget="ZPAtt_Shift_Details",title="";if(-1!==Layout.Page.pageId.indexOf("shiftmapapprovals")?title=ZPI18N.getString("zp.myapprovals"):-1!==Layout.Page.pageId.indexOf("shiftmaprequests")&&(title=ZPI18N.getString("zp.myrequests")),!Layout.Page.container.find("#"+popupTarget)[0]){var shiftMapViewPage='<div style="display: block;" aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" id="'+popupTarget+'" class="modal popRgtModel PopLgModel in"><div role="document" class="modal-dialog"><div class="modal-content"><div class="ZPNxtStep">';shiftMapViewPage+='<div class="modal-header"><div class="col-sm-3"> <h6>'+title+' </h6> </div> <div class="col-sm-9"><div class="zp-recordsts zp_dyn" id="headerApprovalBtn"><span class="msg" id="headerApprovalMsg"></span><a id="zp_appproval_comment_btn" onclick="ZPApprovals.getApprovalDetails()">'+ZPI18N.getString("zp.view")+'</a></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div>',shiftMapViewPage+='<div class="modal-body ZPAprval PT0I"><div class="container-fluid MT25"><div class="row"><div class="col-sm-7"><form class="form-horizontal"><div class="form-group"><label class="col-sm-3 Matry PT8">'+ZPI18N.getString("zp.employee")+'</label><div class="col-sm-5 PL0 PT8" id="ZPAtt_ShiftMap_userName"></div></div></form></div></div></div>',shiftMapViewPage+='<div class="table-responsive MT30 feedModal"><table style="border-top: 1px solid #e9edf3;" class="table"><thead id="attendanceShiftListHeader"><tr class="TblGryBg ZPLHRow">',shiftMapViewPage+='<th width="150" class="center TBrdr">'+ZPI18N.getString("zp.existingshift")+'</th><th width="150" class="center TBrdr">'+ZPI18N.getString("zp.newshift")+"</th>",shiftMapViewPage+='<th id="approveChkBox" width="230" class="text-center B1 TBrdr"><div id="shiftApprovalState">'+ZPI18N.getString("zp.approvalstatus")+'</div></th></tr></thead><tbody class="B0" id="attendanceShiftListBody"></tbody></table></div>',shiftMapViewPage+='<div class="container-fluid MT25" id="shiftChangeReasonField"><div class="row"><div class="col-sm-7"><form class="form-horizontal"><div class="form-group"><label class="col-sm-3 Matry PT8">'+ZPI18N.getString("zp.reason")+'</label><div class="col-sm-5 PL0 PT8" id="ZPAtt_ShiftMap_description"></div></div></form></div></div></div>',shiftMapViewPage+='</div><div class="modal-footer text-left ZPAprval" id="ZPAtt_Shift_AppHierarchy"><div class="Row"></div></div></div></div></div></div>',$(Layout.Page.container).append(shiftMapViewPage)}$("#"+Layout.Page.pageId+" #attendanceShiftListBody tr").remove(),ZPeople.BSModal.show($("#"+Layout.Page.pageId+" #"+popupTarget)),$("#"+Layout.Page.pageId+" #"+popupTarget).off("hidden.bs.modal"),$("#"+Layout.Page.pageId+" #"+popupTarget).on("hidden.bs.modal",function(){-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/viewmyrequest")?window.location.href="#attendance/shiftmapping/shiftmaprequests":-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/viewmyapproval")?window.location.href="#attendance/shiftmapping/shiftmapapprovals":-1!==Layout.Page.hash.indexOf("#approvals/myapproval")&&ZPUtil.Validation.isFunction(ZPApprovals.closePopCallback)?ZPApprovals.closePopCallback():ZPUtil.Validation.isFunction(closeCallBack)&&closeCallBack()}),ZPForm.LAYOUT=$("#"+Layout.Page.pageId+" #"+popupTarget),ZPForm.CURRFORM_PARAM={},formId||(formId=Layout.Page.childUrlParam.formId,recordId=Layout.Page.childUrlParam.recordId),AttendanceShift.approvalSett||ZPApprovals.fetchApprovalSettings(formId,!1,AttendanceShift.setApprovalSett),ZPApprovals.FORMID=formId,ZPApprovals.RECORDID=recordId,ZPForm.CURRFORM_PARAM.formId=formId,ZPForm.CURRFORM_PARAM.recordId=recordId,ZPForm.CURRFORM_PARAM.tableName="P_ShiftMappingForm",ZPApprovals.MODAL_CLASS="modal popRgtModel PopApModel PopApZI";var AppHierCont="<div class='col-sm-12 text-right PT8'>";AppHierCont+="<button type='button' name='approvalTypeBtn' class='btn btn-success ZpaprvrBtn RsltA DN'  approvaltype='1'  id='zp_appproval_approve_btn'> "+ZPI18N.getString("zp.approve")+" </button>",AppHierCont+="<button type='button'name='approvalTypeBtn' class='btn btn-danger ZpaprvrBtn RsltR DN'  approvaltype='0'  id='zp_appproval_reject_btn'> "+ZPI18N.getString("zp.rejectall")+" </button>",AppHierCont+="<button class='btn btn-cancel btn-default ML8 DN' id='cancelShiftChangeIndividual'> "+ZPI18N.getString("zp.cancelshiftchange")+" </button>",AppHierCont+="<button type='button' data-dismiss='modal' class='btn btn-default cancel-model DN' id='closeShiftIndividual'> "+ZPI18N.getString("zp.close")+" </button></div>",$("#"+Layout.Page.pageId+" #ZPAtt_Shift_AppHierarchy .Row").html(AppHierCont),$("#"+Layout.Page.pageId+" #attendanceShiftListHeader").hide(),delete AttendanceShift.approvalAttendDets;var param={mode:"getShiftMapDetails",recordId:recordId,formId:formId,conreqcsr:csrfToken};if(-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/viewmyrequest")){var filter=Layout.Page.container.find("#ZPAtt_shiftMapFilter");Attendance.Report.getEmpProfDateofExitFilter(filter,param,"myReqShiftMap")}$.post("/AttendanceShiftAction.zp",param,function(result){ZPForm.CONF.isadmin=isadmin||isManageAttendanceData;var currentApprover=!1,isRecordOwner=!1;if(result.approvalDetails.isOwner&&(currentApprover=!0),result.approvalDetails.recOwner&&(isRecordOwner=!0,ZPForm.RecordApproval.CREATE_ERECNO=result.approvalDetails.recOwner,result.approvalDetails.recordowner.erecno&&(ZPForm.RecordApproval.OWNER_ERECNO=result.approvalDetails.recordowner.erecno)),result.details){var empName=$("<div/>").text(result.details.empname).html()+" - "+$("<div/>").text(result.details.empid).html();$("#"+Layout.Page.pageId+" #ZPAtt_ShiftMap_userName").html(empName),AttendanceShift.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceShiftListHeader #shiftAllApprove"),"gry","grn",ZPI18N.getString("zp.approve")),-1==result.approvalDetails.currentApprovalStatus&&result.approvalDetails.isOwner&&$("#"+Layout.Page.pageId+" #attendanceShiftListHeader #approveChkBox").hide(),result.details.desc?($("#"+Layout.Page.pageId+" #shiftChangeReasonField").show(),$("#"+Layout.Page.pageId+" #ZPAtt_ShiftMap_description").text(result.details.desc)):$("#"+Layout.Page.pageId+" #shiftChangeReasonField").hide();var html='<tr class="ZPLRow shiftRow"><td class="TBrdr">',space="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";if(result.details.conflictList)for(var loop=0;result.details.conflictList[loop];loop++){var dateRange="";void 0!==(shiftDetails=result.details.conflictList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);var shift=AttendanceShift.depLocShiftList.shiftlist[shiftDetails.shiftId];result.details.conflictList.length>1&&loop<result.details.conflictList.length-1?(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="MB12 S13"><span class="sft-date">'+dateRange+"</span></div>"):(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="S13"><span class="sft-date">'+dateRange+"</span></div>")}else if(result.details.newList){shift="";var shiftDetails=result.details.newList[0];dateRange="";for(var shiftId in void 0!==shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat),AttendanceShift.depLocShiftList.shiftlist)if(1==AttendanceShift.depLocShiftList.shiftlist[shiftId].select){shift=AttendanceShift.depLocShiftList.shiftlist[shiftId];break}""!==shift&&(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="S13"><span class="sft-date">'+dateRange+"</span></div>")}else html+="-";if(html+='</td><td  class="TBrdr">',result.details.newList)for(loop=0;result.details.newList[loop];loop++){dateRange="";void 0!==(shiftDetails=result.details.newList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);shift=AttendanceShift.depLocShiftList.shiftlist[shiftDetails.shiftId];result.details.length>1&&loop<result.details.newList.length-1?(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="MB12 S13"><span class="sft-date">'+dateRange+"</span></div>"):(html+='<div class="S13">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="S13"><span class="sft-date">'+dateRange+"</span></div>")}else html+="-";if(html+="</td>",""!=recordId)if(-1==result.approvalDetails.currentApprovalStatus&&currentApprover){html+='<td class="text-center TBrdr DN">';var approveRejectClass="gry",approveRejectTitle=ZPI18N.getString("zp.reject");1!=result.details.status&&-1!=result.details.status||(approveRejectClass="grn",approveRejectTitle=ZPI18N.getString("zp.approve")),html+='<i id="indApprRejSelect" title="'+approveRejectTitle+'" shiftId="'+recordId+'" class="IC-rou-tik '+approveRejectClass+' S18" onClick="AttendanceShift.allcheckAppRej(this);"></i></td>'}else $("#"+Layout.Page.pageId+" #attendanceShiftListHeader #approveChkBox").show(),void 0!=result.approvalDetails.canceledRecord&&1==result.approvalDetails.canceledRecord?html+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.cancelled")+"</td":1!=result.details.status||isRecordOwner&&1!=result.approvalDetails.currentApprovalStatus&&0!=result.approvalDetails.currentApprovalStatus?0!=result.details.status||isRecordOwner&&1!=result.approvalDetails.currentApprovalStatus&&0!=result.approvalDetails.currentApprovalStatus?html+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.waitingmsg")+"</td":html+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.rejected")+"</td":html+='<td class="text-center TBrdr">'+ZPI18N.getString("zp.approved")+"</td";$("#"+Layout.Page.pageId+" #attendanceShiftListBody").append(html),$("#"+Layout.Page.pageId+" #attendanceShiftListHeader").show(),void 0!=result.details.isCancelPermitted&&1==result.details.isCancelPermitted&&Layout.Page.container.find("#cancelShiftChangeIndividual").removeClass("DN"),void 0!=result.details.isClosePermitted&&1==result.details.isClosePermitted&&Layout.Page.container.find("#closeShiftIndividual").removeClass("DN"),Layout.Page.container.find("#cancelShiftChangeIndividual").click(function(){AttendanceShift.cancelShiftWarning(result)}),AttendanceShift.approvalAttendDets=result;var otherDetails={isfromAttendence:!0};AttendanceShift.approvalSett&&ZPApprovals.initApprovalSettings({approvalSettingsDetails:AttendanceShift.approvalSett}),ZPApprovals.showApprovalHeader(result.approvalDetails.currentApprovalStatus,result.isRecordApprover,!!result.approvalDetails.isPrimaryAppr&&result.approvalDetails.isPrimaryAppr,otherDetails,result.approvalDetails)}else $("#"+Layout.Page.pageId+" #ZPAtt_Shift_Details div.modal-body ").empty().append('<div class="ZPNdata"><i id="norecfoundimg"></i><p class="no-para"><br>'+ZPI18N.getString("zp.norec")+"<br></p></div>"),Attendance.noDataImg(8,"CR-nodata",Layout.Page.container.find(".ZPNdata #norecfoundimg"))})},cancelShiftWarning:function(result){ZPeople.BSModal.setup({id:"zp_confirmation_pop",type:1,header:'<div class="Icn grni"><i class="IC-tick whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.confirm")+"</h4>",body:'<div class="form-group"><p class="text-center MB15">'+ZPI18N.getString("zp.confirmregcancel")+'</p></div><div class="form-group" id="cancel_reason" style="height:90px"><div class="col-sm-12"><textarea class="form-control ZP-Input mandatory" style="width: 340px;margin: 0 auto;" name="remark" rows="5" placeholder="Reason For Cancellation"></textarea><span class="ERR text-center MT5 DN" id="cancel_reason_error" style="width: 100%;"></span></div></div>',modalClass:"modal fade ZPmdl in",buttonValue:ZPI18N.getString("zp.confirm"),successCallback:function(){AttendanceShift.cancelShiftChange(result.details.recordId)},hiddenCallback:ZPApprovals.approveOrRejectActionHidden}).find(".btn-default").text(ZPI18N.getString("zp.cancel"))},cancelShiftChange:function(recordId){var layout=Layout.Page.container,params={mode:"cancelShiftChange"};if(params.listId=recordId,params.conreqcsr=csrfToken,void 0!==ZPeople.Module.MODULE_DATA.attendance.isShiftCancelReason){if(!0===ZPeople.Module.MODULE_DATA.attendance.isShiftCancelReason&&(void 0===layout.find("#cancel_reason textArea").val()||""===layout.find("#cancel_reason textArea").val().trim()))return void layout.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.providereason")).removeClass("DN");params.reason=layout.find("#cancel_reason textArea").val()}$.post("/AttendanceShiftAction.zp",params,function(resultData){if(layout.find("#cancelShiftChangeIndividual").addClass("DN"),void 0!==resultData&&void 0!==resultData.currentApprovalStatus&&void 0!==resultData.approvalDetail){ZPForm.Record.cancelRecCBforModule(resultData.currentApprovalStatus,{isfromAttendence:!0},resultData.approvalDetail)}void 0!=resultData&&"success"==resultData.status?(ZPeople.BSModal.hide("zp_confirmation_pop"),layout.find("#attendanceShiftListBody").find(".shiftRow td:last").html(ZPI18N.getString("zp.cancelled"))):void 0!=resultData&&void 0!=resultData.message&&(resultData.message==ZPI18N.getString("zp.leave.cancell.error.providereason")?(layout.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.providereason")).removeClass("DN"),layout.find("#cancelShiftChangeIndividual").removeClass("DN")):(ZPeople.BSModal.hide("zp_confirmation_pop"),ZPeople.Message.showFailureMsg(resultData.message)))}).fail(function(data){void 0!=data.responseJSON&&void 0!=data.responseJSON.error&&layout.find("#cancel_reason_error").text(data.responseJSON.error).removeClass("DN")})},appRejShiftDetails:function(type,isAllLevelApprove,comment,shiftApprId,apprAct){var shiftIdSelList=[],toUpdateList=[];if(1==apprAct?(toUpdateList.push(shiftApprId),shiftIdSelList.push(shiftApprId)):$("#"+Layout.Page.pageId+" #attendanceShiftListBody tr #indApprRejSelect").each(function(){toUpdateList.push($(this).attr("shiftId")),$(this).hasClass("grn")&&1==type&&shiftIdSelList.push($(this).attr("shiftId"))}),1==type&&0===shiftIdSelList.length)return $("#"+Layout.Page.pageId).find("[name='approvalBtn']").attr("disabled",!1),Layout.Page.container.find("#zp_approvereject_box").show(),Layout.Page.container.find("#zp_approval_confirm_btn").removeClass("disabled"),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectatleastoneshiftmaptoapprove"));var param={mode:"addAppStatInShiftBaseTab",conreqcsr:csrfToken};param.recId=ZPForm.CURRFORM_PARAM.recordId,toUpdateList.length>0&&(param.shiftIdSelList=JSON.stringify(toUpdateList)),param.approvalStatus=type,param.isAllLevelApprove=isAllLevelApprove,param.comment=comment,param.formId=ZPForm.CURRFORM_PARAM.formId,$.post("/AttendanceShiftAction.zp",param,function(rdata){rdata.error&&"payPeriodExceed"===rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.attendance.shiftChange.immutableinfo")),ZPApprovals.approveRejectDtlCallBack(rdata,param),void 0!=rdata&&void 0!=rdata.approvalJson&&void 0!=rdata.approvalJson.processed&&1==rdata.approvalJson.processed[0].approvalStatus&&Layout.Page.container.find("#cancelShiftChangeIndividual").removeClass("DN"),Layout.Page.container.find("#closeShiftIndividual").addClass("DN")})},removeAndAddClass:function(obj,classToBeRemoved,classToBeAdded,titleToBeChanged){void 0===classToBeRemoved&&""===classToBeRemoved||$(obj).removeClass(classToBeRemoved),void 0===classToBeAdded&&""===classToBeAdded||$(obj).addClass(classToBeAdded),void 0===titleToBeChanged&&""===titleToBeChanged||$(obj).attr("title",titleToBeChanged)},allcheckAppRej:function(obj,isAllChanged){var grayColorTitle=ZPI18N.getString("zp.reject"),greenColorTitle=ZPI18N.getString("zp.approve");isAllChanged?$(obj).hasClass("grn")?(AttendanceShift.removeAndAddClass(obj,"grn","gry",grayColorTitle),AttendanceShift.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceShiftListBody tr #indApprRejSelect"),"grn","gry",grayColorTitle)):(AttendanceShift.removeAndAddClass(obj,"gry","grn",greenColorTitle),AttendanceShift.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceShiftListBody tr #indApprRejSelect"),"gry","grn",greenColorTitle)):($(obj).hasClass("grn")?AttendanceShift.removeAndAddClass(obj,"grn","gry",grayColorTitle):AttendanceShift.removeAndAddClass(obj,"gry","grn",greenColorTitle),$("#"+Layout.Page.pageId+" #attendanceShiftListBody tr #indApprRejSelect.grn").length===$("#"+Layout.Page.pageId+" #attendanceShiftListBody tr #indApprRejSelect").length?AttendanceShift.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceShiftListHeader #shiftAllApprove"),"gry","grn",greenColorTitle):AttendanceShift.removeAndAddClass($("#"+Layout.Page.pageId+" #attendanceShiftListHeader #shiftAllApprove"),"grn","gry",grayColorTitle))},deleteConfirm:function(){$("#confirmationPopup").modal({backdrop:"static",keyboard:!1}),$("#textConfirmationPopupHeader").html(ZPI18N.getString("zp.confirm")),$("#confirmConfirmationPopup").html(ZPI18N.getString("zp.confirm"));var message=ZPI18N.getString("zp.shiftmapcancel");$("#textConfirmationPopupBody").html(message),$("#confirmConfirmationPopup").off("click"),$("#cancelConfirmationPopup").off("click"),$("#confirmConfirmationPopup").on("click",function(event){AttendanceShift.deleteBulkShiftMap()}),$("#cancelConfirmationPopup").on("click",function(event){$("#confirmationPopup").modal("hide")})},deleteBulkShiftMap:function(){var selectedreq="";$(AttendanceShift.LayoutId+" #ZPAtt_ShiftMyReqDetails").find("tbody input[type=checkbox]:checked:enabled").each(function(){selectedreq=""===selectedreq?$(this).attr("val"):selectedreq+","+$(this).attr("val")}),AttendanceShift.deleteShiftMapList(selectedreq)},deleteShiftMapList:function(listId){var params={mode:"deleteShiftMapReqList",listId:listId,conreqcsr:csrfToken};$.post("/AttendanceShiftAction.zp",params,function(resultData){if(void 0!=resultData&&"success"==resultData.status){var layout=Layout.Page.container;if(layout.find("#ZPAtt_ShiftMyReq").is(":visible")){for(var deleted_Id=listId.split(","),i=0;i<deleted_Id.length;i++)$("#"+Layout.Page.pageId+" #list-"+deleted_Id[i]).remove();if(0===layout.find("#ZPAtt_ShiftMyReqBody tr").length){var emptyRecEle=layout.find("#ZPAtt_ShiftMapReq_emptyRecInfo");emptyRecEle.prev().hide(),emptyRecEle.fadeIn(200).parent().removeClass("section");var empImg=emptyRecEle.find("i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-regapp",empImg)}layout.find("#ZPAtt_ShiftMyReqDetails").find("thead input[type=checkbox]:enabled").prop("checked",!1),layout.find("#ZPAtt_ShiftBulkDelete").hide().prev().show()}else AttendanceShift.getShiftMapApprovals;ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.recorddeletedsuccessfully"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.internalservererror"))})},checkedBoxVal:[],shiftMapApprAction:function(getThis){var approvalComment=Layout.Page.container.find("#approval_comment").val(),action="zp_modal_blubtn"===getThis.id||"zp_modal_all_appr_btn"===getThis.id?1:0,isAllLevelApprove="zp_modal_all_appr_btn"===getThis.id;$(AttendanceShift.LayoutId+" #ZPAtt_ShiftMyApprovalDetails").find("tbody input[type=checkbox]:enabled").each(function(){$(this).is(":checked")&&AttendanceShift.checkedBoxVal.push($(this).attr("val"))}),ZPForm.Record.approveReject(AttendanceShift.checkedBoxVal,action,approvalComment,isAllLevelApprove,AttendanceShift.resetApprovalsPage)},resetApprovalsPage:function(callbackData){AttendanceShift.getShiftMapApprovals(!1,void 0,callbackData)},formId:null,userShiftMapConfInfolist:null,getuserShiftMapConfInfolist:function(){var param={mode:"fetchApprovals",formName:"P_ShiftMappingForm",conreqcsr:csrfToken};Attendance.toggleLoadingDiv(!1,$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShift"),$(Attendance.Settings.LayoutId+" #ZPAtt_SettUserShift_emptyRecInfo")),$.post("/AttendanceSettingsAction.zp",param,function(rdata){AttendanceShift.userShiftMapConfInfolist=rdata,AttendanceShift.consShiftMapConfInfolist()})},consShiftMapConfInfolist:function(){for(var rdata=AttendanceShift.userShiftMapConfInfolist,txt="",i=0;i<rdata.list.length;i++){var data=rdata.list[i];data&&data.FORMID?(AttendanceShift.formId=data.FORMID,txt+='<tr  class="ZPLRow" id="approval_'+data.FORM_TEMPLATE_ACTION_ID+'" approvalId="'+data.FORM_TEMPLATE_ACTION_ID+'"  >',txt+="<td class='CP' onclick=AttendanceShift.editApproval(\""+data.FORM_TEMPLATE_ACTION_ID+'","'+AttendanceShift.formId+'");>'+data.TEMPLATE_NAME+"</td>",txt+="<td>"+data.SUBJECT+"</td>",txt+='<td><div class="btnactive"><input type="checkbox" onclick="ApprovalProcess.enableDisable(\''+data.FORM_TEMPLATE_ACTION_ID+"','"+AttendanceShift.formId+'\');" class="cmn-toggle-small cmn-toggle-round-small" id="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"',data.ISACTIVE&&(txt+=" checked"),txt+='><label class="M0" for="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"></label></div></td>',txt+="<td class='text-right P0I'><div id='ZPAtt_SettUserShift_delAction' class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_SettUserShift_delConfirm','table-responsive')></i><i class='IC-pen S14 gry FR MR15 CP' onclick=AttendanceShift.editApproval(\""+data.FORM_TEMPLATE_ACTION_ID+'","'+AttendanceShift.formId+'");></i></div>',txt+="<div style='display:none' id='ZPAtt_SettUserShift_delConfirm'>",txt+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_SettUserShift_delAction','table-responsive')>"+ZPI18N.getString("zp.cancel")+"</button>",txt+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=AttendanceShift.deleteApproval(\""+AttendanceShift.formId+'","'+data.FORM_TEMPLATE_ACTION_ID+'")>'+ZPI18N.getString("zp.confirm")+"</button></div>",txt+="</td><td></td>",txt+="</tr>"):data&&data.newformid&&(AttendanceShift.formId=data.newformid)}if($(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDetBody").html(txt),0===$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDetBody").children().length){$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDet").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_SettUserShift_emptyRecInfo").fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShift").removeClass("section");var empImg=Layout.Page.container.find("#ZPAtt_SettUserShift_emptyRecInfo i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-set-regularization",empImg)}else $(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDet").parent().fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_SettUserShift_emptyRecInfo").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShift").attr("class","Scrcont section");Attendance.toggleLoadingDiv(!0),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDet").parent().hasClass("tabcont")||ZPView.handleTablePosition()},editApproval:function(approvalId,formId){ApprovalProcess.getApprovalRow(approvalId,formId,AttendanceShift.consShiftMapConfInfolist)},deleteApproval:function(formId,approvalId){var params={formTemplateId:approvalId,formId:formId,method:"deleteApproval",conreqcsr:csrfToken};$.post("/deleteApproval.zp",params,function(resultData){"success"===resultData.result?$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDetBody").find("#approval_"+approvalId).fadeOut("fast",function(){$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDetBody").find("#approval_"+approvalId).remove(),0===$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDetBody").find("tr").length&&($(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDet").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_SettUserShift_emptyRecInfo").fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShift").removeClass("section"),0===$("ZPAtt_SettUserShift_emptyRecInfo div").children().length&&ZPUtil.noDataSVG("ZPAtt_SettUserShift_emptyRecInfo div",ZPeople.getResourceURL(newUIImageUrl+"svg/no-data.svg"))),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.approvalconfigdeletionsuccess"))}):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.recordnotfound"))})},shiftView:function(id){Layout.Page.container;if(!$(id).hasClass("active")){var alterMode=$(id).attr("value");if($(id).addClass("active"),"daysRep"===alterMode){$(id).next().removeClass("active"),Layout.Page.container.find(".row .col-md-4").find("h5").text(ZPI18N.getString("zp.calendarview")),Layout.Page.container.find(".ZPCalNav").attr("id","calview_month"),Layout.Page.container.find("#ZPAtt_Shift_importExportPopup li#printShiftHourView").remove(),Layout.Page.container.find("#ZPAtt_toDate").show(),Layout.Page.container.find("#ZPAtt_HoursView_Filter_fromDate").attr("id","ZPAtt_calFilter_fromDate"),Layout.Page.container.find("#ZPAtt_calFilter_period option[value='4']").remove(),Layout.Page.container.find("#ZPAtt_calFilter_period option[value='5']").remove(),Layout.Page.container.find("#ZPAtt_calFilter_period option[value='6']").remove();var optionval='<option value="4">'+ZPI18N.getString("zp.today")+"</option>";optionval+='<option value="5">'+ZPI18N.getString("zp.yesterday")+"</option>",optionval+='<option value="2">'+ZPI18N.getString("zp.thisweek")+"</option>",optionval+='<option value="3">'+ZPI18N.getString("zp.lastweek")+"</option>",optionval+='<option value="0">'+ZPI18N.getString("zp.onlyparticularmonth")+"</option>",optionval+='<option value="1">'+ZPI18N.getString("zp.lastmonth")+"</option>",optionval+='<option value="6">'+ZPI18N.getString("zp.custom")+"</option>",Layout.Page.container.find("#ZPAtt_calFilter_period").prepend(optionval),Layout.Page.container.find("#ZPAtt_calFilter_period").select2("val",AttendanceShift.calviewParam.period),"6"!=AttendanceShift.calviewParam.period?($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!0)):($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!1),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!1)),Layout.Page.container.find("#ZPAtt_fromDate label").text(ZPI18N.getString("zp.from")),Layout.Page.container.find("#ZPAtt_hoursView").hide(),Layout.Page.container.find("#ZPAtt_calView").show(),Layout.Page.container.find("#ZPAtt_calFilter_toDate").val(AttendanceShift.calviewParam.edate),Layout.Page.container.find("#ZPAtt_calFilter_fromDate").val(AttendanceShift.calviewParam.sdate);moment(AttendanceShift.calviewParam.edate,dateFmt.toUpperCase()).diff(moment(AttendanceShift.calviewParam.sdate,dateFmt.toUpperCase()),"days");var calView=AttendanceShift.userCalValue;if(null!==calView){var dateDetails=calView.date_details;calView.dispMonth?($(AttendanceShift.LayoutId+" #calview_month").html(calView.dispMonth),$(AttendanceShift.LayoutId+" ul.pager li").closest("div").find("nav").attr("class","ZPInlineNav"),$(AttendanceShift.LayoutId+" ul.pager li").eq(1).find("div").attr("class","ZPCalNav  mon MT8"),Layout.Page.container.find("#ZPAtt_cal_view_days a").html(ZPI18N.getString("zp.month"))):($(AttendanceShift.LayoutId+" #calview_month").html(Attendance.datesInHeader(dateDetails.startdate,dateDetails.enddate)),$(AttendanceShift.LayoutId+" ul.pager li").eq(1).find("div").attr("class","ZPCalNav"),$(AttendanceShift.LayoutId+" ul.pager li").closest("div").find("nav").attr("class","MT8"),Layout.Page.container.find("#ZPAtt_cal_view_days a").html(ZPI18N.getString("zp.week")))}AttendanceShift.hoursviewParam.depId==AttendanceShift.calviewParam.depId&&AttendanceShift.hoursviewParam.locId==AttendanceShift.calviewParam.locId&&AttendanceShift.hoursviewParam.shiftId==AttendanceShift.calviewParam.shiftId&&AttendanceShift.hoursviewParam.userId==AttendanceShift.calviewParam.userId||(AttendanceShift.userCalValue=null),null!=AttendanceShift.userCalValue&&50===AttendanceShift.userCalValue.userList.length&&ZPeople.FireScroll.reset(),AttendanceShift.isHoursListView=!1,AttendanceShift.consPageView(!0)}else{$(id).prev().removeClass("active"),Layout.Page.container.find(".row .col-md-4").find("h5").text(ZPI18N.getString("zp.shifthoursview")),Layout.Page.container.find(".ZPCalNav").attr("id","ZPAtt_hoursview_month");var print='<li id="printShiftHourView"><a onclick="Attendance.printReport();"><span class="IC-print DIB gry MR10"></span>'+ZPI18N.getString("zp.print")+"</a></li>";Layout.Page.container.find("#ZPAtt_Shift_importExportPopup").append(print),Layout.Page.container.find("#ZPAtt_toDate").hide(),Layout.Page.container.find("#ZPAtt_calFilter_fromDate").attr("id","ZPAtt_HoursView_Filter_fromDate"),Layout.Page.container.find("#ZPAtt_calFilter_period option[value='0']").remove(),Layout.Page.container.find("#ZPAtt_calFilter_period option[value='1']").remove(),Layout.Page.container.find("#ZPAtt_calFilter_period option[value='2']").remove(),Layout.Page.container.find("#ZPAtt_calFilter_period option[value='3']").remove(),Layout.Page.container.find("#ZPAtt_fromDate label").text(ZPI18N.getString("zp.date")),Layout.Page.container.find("#ZPAtt_calView").hide(),Layout.Page.container.find("#ZPAtt_hoursView").show(),void 0===AttendanceShift.hoursviewParam?(Layout.Page.container.find("#ZPAtt_HoursView_Filter_fromDate").val(AttendanceShift.depLocShiftList.currDate.todayDate),$(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").attr("disabled",!0)):(Layout.Page.container.find("#ZPAtt_HoursView_Filter_fromDate").val(AttendanceShift.hoursviewParam.sdate),Layout.Page.container.find("#ZPAtt_hoursview_month").text(AttendanceShift.hoursviewParam.sdate),Layout.Page.container.find("#ZPAtt_calFilter_period").select2("val",AttendanceShift.hoursviewParam.period),"6"==AttendanceShift.hoursviewParam.period?$(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").attr("disabled",!1):$(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").attr("disabled",!0)),void 0===AttendanceShift.hoursviewParam||AttendanceShift.hoursviewParam.depId==AttendanceShift.calviewParam.depId&&AttendanceShift.hoursviewParam.locId==AttendanceShift.calviewParam.locId&&AttendanceShift.hoursviewParam.shiftId==AttendanceShift.calviewParam.shiftId&&AttendanceShift.hoursviewParam.userId==AttendanceShift.calviewParam.userId||(AttendanceShift.userHoursValue=null),AttendanceShift.isHoursListView=!0,void 0!=AttendanceShift.userHoursValue&&50===AttendanceShift.userHoursValue.userList.length&&ZPeople.FireScroll.reset(),AttendanceShift.consPageView(!0),$(AttendanceShift.LayoutId+" ul.pager li").closest("div").find("nav").attr("class","ZPInlineNav"),$(AttendanceShift.LayoutId+" ul.pager li").eq(1).find("div").attr("class","ZPCalNav MT8")}}},applyOlderShift:function(){var param={mode:"applyOlderShift",conreqcsr:csrfToken},layout=Layout.Page.container,fromDate=layout.find("#ZPAtt_applyShiftFromDate").val().trim(),toDate=layout.find("#ZPAtt_applyShiftToDate").val().trim();""!==fromDate?""!==toDate?(param.startDate=fromDate,param.endDate=toDate,layout.find("#ZPAtt_applyOlderShiftPopup .btn-primary").attr("disabled",!0),$.post("/AttendanceShiftAction.zp",param,function(rdata){layout.find("#ZPAtt_applyOlderShiftPopup .btn-primary").prop("disabled",!1);var errorMsg=rdata.msg;"success"===errorMsg?(ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.applysettingupdating")),layout.find("#ZPAtt_applyOlderShiftPopup .close").click()):"payperioderrormsg"===errorMsg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.payperioderrormsg",new Array(AttendanceShift.depLocShiftList.freezeDate))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp."+errorMsg))})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invalidtodate")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invalidfromdate"))},getDepLocShiftList:function(fromsort){if(!AttendanceShift.depLocShiftList||fromsort){var param={mode:"getDepLocShiftList",conreqcsr:csrfToken};$(AttendanceShift.LayoutId+" #ZPAtt_shiftDetails_myReqNameSort").hasClass("sort")||(param.isShiftSortAsc=$(AttendanceShift.LayoutId+" #ZPAtt_shiftDetails_myReqNameSort").hasClass("sort-u")),$.post("/AttendanceShiftAction.zp",param,function(rdata){AttendanceShift.depLocShiftList=rdata,AttendanceShift.sortedIdList=rdata.sortedId,AttendanceShift.dateFormat=rdata.dateformat,"hh:mm a"!==rdata.timeformat?Attendance.timeFormatIs12hr=!1:Attendance.timeFormatIs12hr=!0,AttendanceShift.consDepLocShiftOptions(),-1!==Layout.Page.pageId.indexOf("attendance-shift-break")?Attendance.Break.consBreakPage():-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/shiftmaprequests")?(AttendanceApprovals.appendApprovalTopBand("myrequests","shiftmapping"),AttendanceShift.getShiftMapRequest(!1)):-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/shiftmapapprovals")?(AttendanceApprovals.appendApprovalTopBand("myapprovals","shiftmapping"),AttendanceShift.getShiftMapApprovals(!1)):-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/viewmyrequest")||-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/viewmyapproval")?AttendanceShift.getAttendanceShiftDetails():AttendanceShift.consPageView(),AttendanceShift.depLocShiftList.freezeDate&&Layout.Page.container.find("#ZPAtt_updateOlderShiftMsg").text(ZPI18N.getString("zp.choosedateafterpayperiod",new Array(AttendanceShift.depLocShiftList.freezeDate)))})}else-1!==Layout.Page.pageId.indexOf("attendance-shift-break")?Attendance.Break.consBreakPage():-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/shiftmaprequests")?(AttendanceApprovals.appendApprovalTopBand("myrequests","shiftmapping"),AttendanceShift.getShiftMapRequest(!1)):-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/shiftmapapprovals")?(AttendanceApprovals.appendApprovalTopBand("myapprovals","shiftmapping"),AttendanceShift.getShiftMapApprovals(!1)):-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/viewmyrequest")||-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/viewmyapproval")?AttendanceShift.getAttendanceShiftDetails():AttendanceShift.consPageView()},myReqEmpNameTimeSort:function(obj){$(obj).hasClass("sort-d")?$(obj).attr("class","sort-img sort-u CP"):$(obj).attr("class","sort-img sort-d CP"),"ZPAtt_shiftDetails_myReqNameSort"===obj.id?AttendanceShift.getDepLocShiftList(!0):"ZPAtt_shiftRotation_myReqNameSort"===obj.id||"ZPAtt_shiftRotation_myReqTimeSort"===obj.id?("ZPAtt_shiftRotation_myReqNameSort"===obj.id?$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotation_myReqTimeSort").attr("class","sort-img sort"):$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotation_myReqNameSort").attr("class","sort-img sort"),AttendanceShift.getShiftRotationList()):"ZPAtt_userShiftList_myReqEmpSort"===obj.id?AttendanceShift.getUserListView():"ZPAtt_calView_myReqEmpSort"===obj.id?AttendanceShift.getUserCalView():"ZPAtt_hoursView_myReqEmpSort"===obj.id?AttendanceShift.getHoursListView():"ZPAtt_EmpShiftMapList_myReqEmpSort"==obj.id&&AttendanceShift.getShiftMapRequest(!1,!0)},dropDownShiftOption:"",consDepLocShiftOptions:function(){var rdata=AttendanceShift.depLocShiftList,result={};Shift.shiftList=rdata.shiftlist;var depOption="",locOption="",shiftOption="",roleOption="",entityOption="",bUnitOption="",divisionOption="",sOption="",desgOption="",depOptionArr=[],locOptionArr=[],roleOptionArr=[],desgOptionArr=[],bUnitOptionArr=[],entityOptionArr=[],divisionOptionArr=[];if(isOrgStructureEnabled){for(var entityId in rdata.entityList)-1===(entityId+"").indexOf("_notEnc")&&(entityOption+="<option value="+entityId+">"+rdata.entityList[entityId]+"</option>",entityOptionArr.push({id:entityId,name:rdata.entityList[entityId]}));for(var bUnitId in result.entityOption=entityOption,result.entityOptionArr=entityOptionArr,rdata.bUnitList)-1===(bUnitId+"").indexOf("_notEnc")&&(bUnitOption+="<option value="+bUnitId+">"+rdata.bUnitList[bUnitId]+"</option>",bUnitOptionArr.push({id:bUnitId,name:rdata.bUnitList[bUnitId]}));for(var divisionId in result.bUnitOption=bUnitOption,result.bUnitOptionArr=bUnitOptionArr,rdata.divisionList)-1===(divisionId+"").indexOf("_notEnc")&&(divisionOption+="<option value="+divisionId+">"+rdata.divisionList[divisionId]+"</option>",divisionOptionArr.push({id:divisionId,name:rdata.divisionList[divisionId]}));result.divisionOption=divisionOption,result.divisionOptionArr=divisionOptionArr}for(var desgId in rdata.desgList)-1===(desgId+"").indexOf("_notEnc")&&(desgOption+="<option value="+desgId+">"+rdata.desgList[desgId]+"</option>",desgOptionArr.push({id:desgId,name:rdata.desgList[desgId]}));for(var d_r_depId in rdata.depList)-1===(d_r_depId+"").indexOf("_notEnc")&&(depOption+="<option value="+d_r_depId+">"+rdata.depList[d_r_depId]+"</option>",depOptionArr.push({id:d_r_depId,name:rdata.depList[d_r_depId]}));for(var d_r_locId in rdata.locList)-1===(d_r_locId+"").indexOf("_notEnc")&&(locOption+="<option value="+d_r_locId+">"+rdata.locList[d_r_locId]+"</option>",locOptionArr.push({id:d_r_locId,name:rdata.locList[d_r_locId]}));for(var d_r_roleList in rdata.roleList)-1===(d_r_roleList+"").indexOf("_notEnc")&&(roleOption+="<option value="+d_r_roleList+">"+rdata.roleList[d_r_roleList]+"</option>",roleOptionArr.push({id:d_r_roleList,name:rdata.roleList[d_r_roleList]}));for(var d_r_shiftId in AttendanceShift.dropDownShiftOption="",AttendanceShift.activeShiftlength=0,rdata.shiftlist)-1!==rdata.shiftlist[d_r_shiftId].select&&(AttendanceShift.activeShiftlength+=1,shiftOption+="<option value="+d_r_shiftId+">"+rdata.shiftlist[d_r_shiftId].shiftName+"</option>",sOption+="<option value="+d_r_shiftId+">"+rdata.shiftlist[d_r_shiftId].shiftName+"</option>",AttendanceShift.dropDownShiftOption+="<li onClick=\"AttendanceShift.changeShiftCalView($(this).attr('id'));\" id="+d_r_shiftId+"><a>"+rdata.shiftlist[d_r_shiftId].shiftName+"</a></li>");result.desgOption=desgOption,result.desgOptionArr=desgOptionArr,result.depOption=depOption,result.depOptionArr=depOptionArr,result.locOption=locOption,result.locOptionArr=locOptionArr,result.shiftOption=shiftOption,result.roleOption=roleOption,result.roleOptionArr=roleOptionArr,result.sOption=sOption,Attendance.organizationTag.constructOptions(rdata,result),AttendanceShift.depLocShiftOptions=result;var datFormat=dateFmt.toUpperCase(),toDay=moment(rdata.currDate.todayDate,datFormat),weekStartDate=moment(toDay).startOf("week").add(weekstarts,"day");toDay._d.getTime()<weekStartDate._d.getTime()&&(weekStartDate=weekStartDate.add(-1,"week"));var weekEndDate=moment(toDay).startOf("week").add(weekstarts,"day");toDay._d.getTime()<weekEndDate._d.getTime()&&(weekEndDate=weekEndDate.add(-1,"week")),weekEndDate=weekEndDate.add(6,"day"),AttendanceShift.depLocShiftList.currDate.weekStartDate=weekStartDate,AttendanceShift.depLocShiftList.currDate.weekEndDate=weekEndDate,$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").val(weekStartDate.format(datFormat)),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(weekEndDate.format(datFormat));var lastWeekStart=moment(weekStartDate).add(-7,"day"),lastWeekEnd=moment(weekEndDate).add(-7,"day");AttendanceShift.depLocShiftList.currDate.lastWeekStart=lastWeekStart,AttendanceShift.depLocShiftList.currDate.lastWeekEnd=lastWeekEnd},consPageView:function(isFromToggle){var layout=Layout.Page.container;layout.find("#ZPAtt_ShiftMapView_filter").hasClass("ZPFilsel")&&void 0===isFromToggle&&AttendanceShift.toggleFilter(),-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-listview")?(layout.find("#ZPAtt_shiftListViewBut").attr("class","btn btn-primary togg"),layout.find("#ZPAtt_shiftCalViewBut").attr("class","btn btn-default togg"),AttendanceShift.userListValue||(layout.find("#ZPAtt_calFilter_fromDate").val(AttendanceShift.depLocShiftList.currDate.monthStartDate).attr("disabled",!0),layout.find("#ZPAtt_calFilter_toDate").val(AttendanceShift.depLocShiftList.currDate.monthEndDate).attr("disabled",!0),AttendanceShift.reInitFieldValue(),layout.find("#listview_month").html(AttendanceShift.depLocShiftList.dispDate),AttendanceShift.getUserListView()),Attendance.consResetEmpSearch("ZPAtt_userShiftMappingEmpName",Layout.Page.container,!1,!0)):-1===Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")||AttendanceShift.isHoursListView?-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")&&AttendanceShift.isHoursListView?(AttendanceShift.userHoursValue||(layout.find("#ZPAtt_calFilter_period").select2("val",4),layout.find("#ZPAtt_HoursView_Filter_fromDate").attr("disabled",!0),layout.find("#calview_month").html(AttendanceShift.depLocShiftList.currDate.todayDate),AttendanceShift.userHoursValue=null,AttendanceShift.getHoursListView()),Attendance.consResetEmpSearch("ZPAtt_userShiftMappingEmpName",Layout.Page.container,!1,!0)):-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")&&(AttendanceShift.shiftRotationList||($(AttendanceShift.LayoutId).popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right",delay:{show:50,hide:50}}),AttendanceShift.getShiftRotationList())):(layout.find("#ZPAtt_shiftListViewBut").attr("class","btn btn-default togg"),layout.find("#ZPAtt_shiftCalViewBut").attr("class","btn btn-primary togg"),AttendanceShift.userCalValue||(layout.find("#ZPAtt_calFilter_period").select2("val",2),layout.find("#ZPAtt_calFilter_fromDate").attr("disabled",!0),layout.find("#ZPAtt_calFilter_toDate").attr("disabled",!0),AttendanceShift.fromNavigater=!1,void 0===isFromToggle&&AttendanceShift.reInitFieldValue(),AttendanceShift.userCalValue=null,AttendanceShift.getUserCalView()),Attendance.consResetEmpSearch("ZPAtt_userShiftMappingEmpName",Layout.Page.container,!1,!0))},onChangePeriod:function(){var period=$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_period")[0];-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")&&AttendanceShift.isHoursListView?"4"==period.value?($(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").val(AttendanceShift.depLocShiftList.currDate.todayDate)):"5"==period.value?($(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").val(AttendanceShift.depLocShiftList.currDate.prevDay)):$(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").attr("disabled",!1):(-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-listview")||-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")&&!AttendanceShift.isHoursListView)&&("0"==period.value?($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").val(AttendanceShift.depLocShiftList.currDate.monthStartDate),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(AttendanceShift.depLocShiftList.currDate.monthEndDate),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!0)):"1"==period.value?($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").val(AttendanceShift.depLocShiftList.currDate.prevMonthStart),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(AttendanceShift.depLocShiftList.currDate.prevMonthEnd),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!0)):"2"==period.value?($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").val(AttendanceShift.depLocShiftList.currDate.weekStartDate.format(dateFmt.toUpperCase())),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(AttendanceShift.depLocShiftList.currDate.weekEndDate.format(dateFmt.toUpperCase())),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!0)):"3"==period.value?($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").val(AttendanceShift.depLocShiftList.currDate.lastWeekStart.format(dateFmt.toUpperCase())),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(AttendanceShift.depLocShiftList.currDate.lastWeekEnd.format(dateFmt.toUpperCase())),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!0)):"4"==period.value?($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").val(AttendanceShift.depLocShiftList.currDate.todayDate),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(AttendanceShift.depLocShiftList.currDate.todayDate),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!0)):"5"==period.value?($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").val(AttendanceShift.depLocShiftList.currDate.prevDay),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(AttendanceShift.depLocShiftList.currDate.prevDay),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!0)):($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!1),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!1)))},onPeriodChange:function(){var fromElement=Layout.Page.container.find("#ZPAtt_myReqShiftMap_fromDate"),toElement=Layout.Page.container.find("#ZPAtt_myReqShiftMap_toDate");fromElement.attr("disabled",!0),toElement.attr("disabled",!0);var currMonthSDate=AttendanceShift.depLocShiftList.currDate.monthStartDate,currMonthEDate=AttendanceShift.depLocShiftList.currDate.monthEndDate,pValue=Layout.Page.container.find("#ZPAtt_myReqShiftMap_period").val();"1"===pValue?(currMonthSDate=AttendanceShift.depLocShiftList.currDate.prevMonthStart,currMonthEDate=AttendanceShift.depLocShiftList.currDate.prevMonthEnd):"2"===pValue?(currMonthSDate=AttendanceShift.depLocShiftList.currDate.weekStartDate.format(dateFmt.toUpperCase()),currMonthEDate=AttendanceShift.depLocShiftList.currDate.weekEndDate.format(dateFmt.toUpperCase())):"3"===pValue?(currMonthSDate=AttendanceShift.depLocShiftList.currDate.lastWeekStart.format(dateFmt.toUpperCase()),currMonthEDate=AttendanceShift.depLocShiftList.currDate.lastWeekEnd.format(dateFmt.toUpperCase())):"4"===pValue?(currMonthSDate=AttendanceShift.depLocShiftList.currDate.todayDate,currMonthEDate=AttendanceShift.depLocShiftList.currDate.todayDate):"5"===pValue?(currMonthSDate=AttendanceShift.depLocShiftList.currDate.prevDay,currMonthEDate=AttendanceShift.depLocShiftList.currDate.prevDay):"6"===pValue&&(fromElement.prop("disabled",!1),toElement.prop("disabled",!1)),"6"!==pValue&&(fromElement.val(currMonthSDate),toElement.val(currMonthEDate))},dateForFeeds:function(fromDate,changedDate,isCheckLessThan){return void 0===fromDate&&changedDate?fromDate=changedDate:void 0!==fromDate&&changedDate&&(isCheckLessThan&&moment(fromDate,dateFmt.toUpperCase())._d.getTime()<moment(changedDate,"YYYY-MM-DD")._d.getTime()||!isCheckLessThan&&moment(fromDate,dateFmt.toUpperCase())._d.getTime()>moment(changedDate,"YYYY-MM-DD")._d.getTime())&&(fromDate=changedDate),fromDate},constructTableForFeeds:function(shift){try{if(ZPeople.isZPNewUI()){var tableObj;if(shift.hasOwnProperty("conflictList")){tableObj='<div class="row">';for(var colObj='<div class="zp-sm-6"><div class="shift-col"><h3 class="shift-head">'+ZPI18N.getString("zp.existingshift")+"</h3>",loop=0;shift.conflictList&&shift.conflictList[loop];loop++){var dateRange="";(shiftDetails=shift.conflictList[loop]).fromRange=AttendanceShift.dateForFeeds(shiftDetails.fromRange,shift.changedFrom,!0),shiftDetails.toRange=AttendanceShift.dateForFeeds(shiftDetails.toRange,shift.changedTo,!1),void 0!==shiftDetails.fromRange&&void 0!==shiftDetails.toRange&&(dateRange=shiftDetails.fromRange+" - "+shiftDetails.toRange);var timings="("+Attendance.disTime(shiftDetails.fTime)+"-"+Attendance.disTime(shiftDetails.tTime)+")",rowClass="S13";shiftDetails.isModified||(rowClass="S13 red"),colObj+='<div class="shift-body"><div> <div class="ZPLtyp  shift-circle LC'+shiftDetails.shiftColour+'"></div> <div class="shift-cont '+rowClass+'"><div class="shift-name">'+$("<div/>").text(shiftDetails.shiftDisplayName).html()+" "+timings+'</div> <div class="shift-date">'+dateRange+"</div> </div> </div> </div>"}shift.addData&&!Shift.shiftList&&Shift.getShiftList();for(loop=0;shift.addConfList&&shift.addConfList[loop];loop++){dateRange="";(shiftDetails=shift.addConfList[loop]).fromRange=AttendanceShift.dateForFeeds(shiftDetails.fromRange,shift.changedFrom,!0),shiftDetails.toRange=AttendanceShift.dateForFeeds(shiftDetails.toRange,shift.changedTo,!1),void 0!==shiftDetails.fromRange&&void 0!==shiftDetails.toRange&&(dateRange=shiftDetails.fromRange+" - "+shiftDetails.toRange);rowClass="S13";if(shiftDetails.isModified||(rowClass="S13 red"),Shift.shiftList[shiftDetails.shiftId]){timings="("+Attendance.disTime(Shift.shiftList[shiftDetails.shiftId].fTime)+"-"+Attendance.disTime(Shift.shiftList[shiftDetails.shiftId].tTime)+")";colObj+='<div class="shift-body"><div> <div class="ZPLtyp  shift-circle LC'+Shift.shiftList[shiftDetails.shiftId].colorCode+'"></div> <div class="shift-cont '+rowClass+'"><div class="shift-name">'+$("<div/>").text(Shift.shiftList[shiftDetails.shiftId].shiftName).html()+" "+timings+'</div> <div class="shift-date">'+dateRange+"</div> </div> </div> </div>"}}tableObj+=colObj+="</div></div>",colObj='<div class="zp-sm-6"> <div class="shift-col"><h3 class="shift-head">'+ZPI18N.getString("zp.changedshift")+"</h3>";for(loop=0;shift.newList&&shift.newList[loop]&&shift.newList[loop].isActualInterval;loop++){dateRange="";void 0!==(shiftDetails=shift.newList[loop]).fromRange&&(dateRange=shiftDetails.fromRange+" - "+shiftDetails.toRange);rowClass="S13";shiftDetails.isAdded&&(rowClass="S13 grn");timings="("+Attendance.disTime(shiftDetails.fTime)+"-"+Attendance.disTime(shiftDetails.tTime)+")";colObj+='<div class="shift-body"><div> <div class="ZPLtyp  shift-circle LC'+shiftDetails.shiftColour+'"></div> <div class="shift-cont '+rowClass+'"><div class="shift-name">'+$("<div/>").text(shiftDetails.shiftDisplayName).html()+" "+timings+'</div> <div class="shift-date">'+dateRange+"</div> </div> </div> </div>"}for(loop=0;shift.addList&&shift.addList[loop];loop++){dateRange="";void 0!==(shiftDetails=shift.addList[loop]).fromRange&&(dateRange=shiftDetails.fromRange+" - "+shiftDetails.toRange);rowClass="S13";if(shiftDetails.isAdded&&(rowClass="S13 grn"),Shift.shiftList[shiftDetails.shiftId]){timings="("+Attendance.disTime(Shift.shiftList[shiftDetails.shiftId].fTime)+"-"+Attendance.disTime(Shift.shiftList[shiftDetails.shiftId].tTime)+")";colObj+='<div class="shift-body"><div> <div class="ZPLtyp  shift-circle LC'+Shift.shiftList[shiftDetails.shiftId].colorCode+'"></div> <div class="shift-cont '+rowClass+'"><div class="shift-name">'+$("<div/>").text(Shift.shiftList[shiftDetails.shiftId].shiftName).html()+" "+timings+'</div> <div class="shift-date">'+dateRange+"</div> </div> </div> </div>"}}colObj+="</div></div>",shiftDetails.desc&&(colObj+='<div class="zp-sm-12"><div><div class="FL MT15"><b>'+ZPI18N.getString("zp.reason")+": </b> <span>"+$("<span></span>").text(shiftDetails.desc).html()+"</span></div></div></div>"),tableObj+=colObj,tableObj+="</div>"}else{var shiftDetails;dateRange="",rowClass="S13";void 0!==(shiftDetails=shift.newList[0]).fromRange&&(dateRange=shiftDetails.fromRange+" - "+shiftDetails.toRange),shiftDetails.isAdded&&(rowClass="S13 grn");timings="("+Attendance.disTime(shiftDetails.fTime)+"-"+Attendance.disTime(shiftDetails.tTime)+")";tableObj='<div class="zp-feed-table"><table class="table"><tbody>',tableObj+="<tr><th>"+ZPI18N.getString("zp.shiftname")+'</th><td><div class="ZPLtyp  shift-circle LC'+shiftDetails.shiftColour+'"></div>'+$("<div/>").text(shiftDetails.shiftDisplayName).html()+"  "+timings+"</td></tr>",""!==dateRange&&(tableObj+="<tr><th>"+ZPI18N.getString("zp.shiftperiod")+"</th><td>"+dateRange+"</td></tr>"),tableObj+="</tbody></table>",shiftDetails.desc&&(tableObj+='<div class="zp-sm-12"><div><div class="FL MT15"><b>'+ZPI18N.getString("zp.reason")+": </b> <span>"+shiftDetails.desc+"</span></div></div></div>"),tableObj+="</div>"}return tableObj}}catch(err){}},consFeedsForAttMissNotification:function(activityObj){var type=activityObj.getAdditionalProperty("reminderType");activityObj.getAdditionalProperty("attDate");void 0===Attendance.timeFormatIs12hr&&(Attendance.timeFormatIs12hr=!1,"hh:mm a"==timeFormat&&(Attendance.timeFormatIs12hr=!0));var message=ZPI18N.getString("zp.attendance.notifyUserInBefore",new Array(Attendance.disTime(activityObj.getAdditionalProperty("shiftStartTime"))));if("10"==type){var repManJson=activityObj.getAdditionalProperty("repManJson"),remManInfo=ZPeople.getUserDetailsById(activityObj.getASUsers()),timings=Attendance.disTime(activityObj.getAdditionalProperty("shiftStartTime"))+" - "+Attendance.disTime(activityObj.getAdditionalProperty("shiftEndTime")),html="<div class='ZPFcont'><div>"+ZPI18N.getString("zp.notifyRepMsg",new Array(remManInfo.name))+"</br></div></div>";for(var locName in html+='<div class="fconde MT10I MB10I"><div class="fconDIv"><div class="lf">'+ZPI18N.getString("zp.shiftname")+'</div><div class="rg"><div><div class="ZPLtyp LC',html+=activityObj.getAdditionalProperty("shiftColor")+'"></div>'+activityObj.getAdditionalProperty("shiftName")+"</div></div></div>",html+='<div class="fconDIv"><div class="lf">'+ZPI18N.getString("zp.time")+'</div><div class="rg"><span class="dgry fs13">'+timings+"</span></div></div></div>",repManJson){var userList=repManJson[locName];locName=ZPeople.escapeHtml(locName);var empLocMapText=ZPI18N.getString("zp.multipleemployeesGroupedByNonLoc");""!=locName&&(empLocMapText=ZPI18N.getString("zp.multipleemployeesGroupedByLoc",new Array(locName))),html+='<table class="table table-bordered ZPSCtbl" style="width:75%"><thead><tr class="TblGryBg"><th width="230">'+empLocMapText+"</th></tr></thead><tbody>";for(var userDetails=ZPeople.getUserDetailsByIds(userList,!0),userInd=0;userInd<userList.length;userInd++){html+='<tr class="ZPLRow">',html+='<td><img class="FL" src="'+(userDet=ZPeople.getUserDetailsByIdInList(userList[userInd].empzuid,userDetails)).thumb+'"><div class="ZPusrName"><span><b>'+ZPeople.decodeTxt(userDet.empid)+"</b></span><span>"+ZPFeeds.Activity.getUsersLinkName(userDet,"dtl_pop")+"<span></span></span></div></td",html+="</tr>"}html+="</tbody></table>"}return html}if("67"==type||"68"==type){repManJson=activityObj.getAdditionalProperty("repManJson"),remManInfo=ZPeople.getUserDetailsById(activityObj.getASUsers()),timings=Attendance.disTime(activityObj.getAdditionalProperty("shiftStartTime"))+" - "+Attendance.disTime(activityObj.getAdditionalProperty("shiftEndTime"));var html="<div class='ZPFcont'><div>"+ZPI18N.getString("zp.notifyRepMsg.earlyCheckout",new Array(remManInfo.name))+"</br></div></div>";for(var locName in html+='<div class="fconde MT10I MB10I"><div class="fconDIv"><div class="lf">'+ZPI18N.getString("zp.shiftname")+'</div><div class="rg"><div><div class="ZPLtyp LC',html+=activityObj.getAdditionalProperty("shiftColor")+'"></div>'+activityObj.getAdditionalProperty("shiftName")+"</div></div></div>",html+='<div class="fconDIv"><div class="lf">'+ZPI18N.getString("zp.time")+'</div><div class="rg"><span class="dgry fs13">'+timings+"</span></div></div></div>",repManJson){userList=repManJson[locName];locName=ZPeople.escapeHtml(locName);empLocMapText=ZPI18N.getString("zp.multipleemployeesGroupedByNonLoc");""!=locName&&(empLocMapText=ZPI18N.getString("zp.multipleemployeesGroupedByLoc",new Array(locName))),html+='</br><table class="table table-bordered ZPSCtbl" style="width:75%">',html+="<thead>",html+='<tr class="TblGryBg"><th width="230">'+empLocMapText+"</th><th>"+ZPI18N.getString("zp.checkouttime")+"</th><th>"+ZPI18N.getString("zp.earlyby",new Array(""))+"</th></tr>",html+="</thead><tbody>";for(userDetails=ZPeople.getUserDetailsByIds(userList,!0),userInd=0;userInd<userList.length;userInd++){var userDet=ZPeople.getUserDetailsByIdInList(userList[userInd].empzuid,userDetails);html+='<tr class="ZPLRow">',html+="<td><span>"+ZPFeeds.Activity.getUsersLinkName(userDet,"dtl_pop")+"<span></td>",html+="<td><span>"+(userList[userInd].checkOutTime?userList[userInd].checkOutTime:"-")+"<span></td>",html+="<td><span>"+(userList[userInd].earlyBy?userList[userInd].earlyBy:"-")+"<span></td>",html+="</tr>"}html+="</tbody></table>"}return html+="</br>"+ZPI18N.getString("zp.notifyRepMsg.mailNote")+"</div></div></div>"}if("66"==type){timings=Attendance.disTime(activityObj.getAdditionalProperty("shiftStartTime"))+" - "+Attendance.disTime(activityObj.getAdditionalProperty("shiftEndTime"));var latEmp=activityObj.getAdditionalProperty("lateEmpName"),rmName=activityObj.getAdditionalProperty("reportingManagerName"),lateBy=activityObj.getAdditionalProperty("lateBy");message=ZPI18N.getString("zp.notifyRepMsg.lateArrival.content",new Array(rmName,latEmp));var tablehtml='<table class="table table-bordered zpsctbl" style="width:75%"><tbody>';return tablehtml+='<tr class="ZPLRow"><td><b>'+ZPI18N.getString("zp.date")+"</b></td><td>"+activityObj.getAdditionalProperty("attDate")+"</td></tr>",tablehtml+='<tr class="ZPLRow"><td><b>'+ZPI18N.getString("zp.shiftsig")+"</b></td><td>"+activityObj.getAdditionalProperty("shiftName")+"("+timings+")</td></tr>",activityObj.getAdditionalProperty("checkInTime")&&(tablehtml+='<tr class="ZPLRow"><td><b>'+ZPI18N.getString("zp.checkintime")+"</b></td><td>"+activityObj.getAdditionalProperty("checkInTime")+"</td></tr>"),tablehtml+='<tr class="ZPLRow"><td><b>'+ZPI18N.getString("zp.lateby",new Array(""))+"</b></td><td>"+lateBy+"</td></tr>",html='<div class="ZPFcont"><div><div>'+message+"</br></br>"+(tablehtml+="</tbody></table>")+"</br></br>"+ZPI18N.getString("zp.notifyRepMsg.mailNote")+"</div></div></div>"}return"7"===type?message=ZPI18N.getString("zp.attendance.notifyUserInAfter"):"8"===type?message=ZPI18N.getString("zp.attendance.notifyUserOutBefore",new Array(Attendance.disTime(activityObj.getAdditionalProperty("shiftEndTime")))):"9"===type&&(message=ZPI18N.getString("zp.attendance.notifyUserOutAfter")),html='<div class="ZPFcont"><div><div>'+message+"</br></br></div></div></div>"},contructBreakViolatedMessge:function(acitivityObj){return acitivityObj.getAdditionalProperty("violetedEmployeeZuid")?'<div class="ZPFcont"><div><div>'+ZPI18N.getString("zp.attendance.breakviolate.shiftTime.self",new Array(acitivityObj.getAdditionalProperty("coreHourRange")))+"</div></div></div>":'<div class="ZPFcont"><div><div>'+ZPI18N.getString("zp.attendance.breakviolate.shiftTime",new Array(acitivityObj.getAdditionalProperty("violetedEmployeeName"),acitivityObj.getAdditionalProperty("coreHourRange")))+"</div></div></div>"},getApplicableShifts:function(erecNo,isCalView,obj,shiftIdFromEditMap){var cont,erecArr=ZPPickList.sharedSelectedUsers,locArr=ZPPickList.sharedSelectedLocations;if(erecNo)erecArr=[erecNo+""],locArr=[],cont=$("#"+"ZPAtt_shiftlist_drop");else{if(cont=$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup").find("#ZPAtt_empShiftMap_drop"),AttendanceShift.getApplicableShiftsCache(cont,erecArr,locArr))return;$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup").find("#attShiftMiniLoader").show()}var sel=cont.select2().val();cont.children().remove(),$.ajax({type:"POST",async:!0,url:"/AttendanceShiftAction.zp",data:{mode:"getApplicableShifts",erecno:JSON.stringify(erecArr),location:JSON.stringify(locArr),conreqcsr:csrfToken},success:function(rdata){var shiftList=rdata.applicableShifts;if(AttendanceShift.applicableShifts=shiftList,erecNo&&isCalView){AttendanceShift.dropDownShiftOption="",AttendanceShift.depLocShiftOptions.shiftOption="";var optHtml="";for(var shiftId in shiftList)-1!==shiftList[shiftId].select&&(AttendanceShift.dropDownShiftOption+="<li onClick=\"AttendanceShift.changeShiftCalView($(this).attr('id'));\" id="+shiftId+"><a>"+shiftList[shiftId].shiftName+"</a></li>",optHtml+="<option value="+shiftId+">"+shiftList[shiftId].shiftName+"</option>");AttendanceShift.depLocShiftOptions.shiftOption=optHtml;var shiftDropDown=Layout.Page.container.find("#ZPAtt_shiftDropDown"),dayView="day"===$(obj).attr("elem"),rowErec=dayView?"#"+$(obj).parent().parent().parent().attr("id"):"#"+$(obj).closest("tr").attr("id");shiftDropDown.find(rowErec).find("ul").empty(),shiftDropDown.find(rowErec).find("ul").append(AttendanceShift.dropDownShiftOption);var dropdownHei=shiftDropDown.find(".SftDD").height(),elemOff=dayView?$(obj).parent().next().offset():$(obj).offset(),elemHei=dayView?$(obj).parent().next().height():$(obj).height(),docHei=$(document).height(),elemBot=elemOff.top+elemHei,rowTop=dayView?$("#ZPAtt_hoursView .zphours-row").offset():$("#ZPAtt_calView .ZPLHRow").offset(),rowHei=dayView?$("#ZPAtt_hoursView .zphours-row").height():$("#ZPAtt_calView .ZPLHRow").height(),rowBot=rowTop.top+rowHei,posi="top",topfix=elemBot+elemHei+10;(dayView?elemBot+dropdownHei+30:elemBot+dropdownHei)>=docHei&&(topfix=elemBot-dropdownHei+15,posi="bottom"),topfix-=rowBot,shiftDropDown.find(".SftDD").removeClass("top"),shiftDropDown.find(".SftDD").removeClass("bottom"),shiftDropDown.find(".SftDD").addClass(" "+posi),shiftDropDown.find(".SftDD").css({top:topfix+"px"})}else{$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup").find("#attShiftMiniLoader").hide();var shiftOption="",isAvail=!1;for(var shiftId in shiftList)-1!==shiftList[shiftId].select&&(shiftOption+="<option value="+shiftId+">"+shiftList[shiftId].shiftName+"</option>"),erecNo&&!isCalView&&shiftIdFromEditMap&&shiftId===shiftIdFromEditMap&&(isAvail=!0);if(erecNo)isCalView||(cont.append(shiftOption),shiftIdFromEditMap&&(isAvail?cont.val(shiftIdFromEditMap).change():$(AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp").find("#s2id_ZPAtt_shiftlist_drop span").html("")));else{cont.select2().off("opening"),cont.select2().off("close"),cont.html(shiftOption),cont.select2("open");var selCache=0;-1!==shiftOption.indexOf(sel)&&(selCache=sel+""),cont.select2("val",selCache).on("close",function(event){cont.select2().off("opening").select2().on("opening",function(event){event.preventDefault(),event.stopPropagation(),AttendanceShift.getApplicableShifts()})})}}}})},getApplicableShiftsCache:function(cont,erecArr,locArr){var cacheErecArr=AttendanceShift.cacheErecArr,cacheLocArr=AttendanceShift.cacheLocArr;if(void 0!=cacheErecArr&&void 0!=cacheLocArr&&cacheErecArr.length===erecArr.length&&cacheLocArr.length===locArr.length){var isCacheNeed=!0;for(var i in erecArr){if(!isCacheNeed)break;var isEmpExist=!1;for(var j in cacheErecArr){if(isEmpExist)break;cacheErecArr[j]===erecArr[i]&&(isEmpExist=!0)}isCacheNeed&=isEmpExist}for(var i in locArr){if(!isCacheNeed)break;var isLocExist=!1;for(var j in cacheLocArr){if(isLocExist)break;cacheLocArr[j]===locArr[i]&&(isLocExist=!0)}isCacheNeed&=isLocExist}if(isCacheNeed){var sel=cont.select2().val(),shiftList=AttendanceShift.applicableShifts,shiftOption="";for(var shiftId in shiftList)-1!==shiftList[shiftId].select&&(shiftOption+="<option value="+shiftId+">"+shiftList[shiftId].shiftName+"</option>");cont.select2().off("opening"),cont.select2().off("close"),cont.html(shiftOption),cont.select2("open");var selCache=0;return-1!==shiftOption.indexOf(sel)&&(selCache=sel+""),cont.select2("val",selCache).on("close",function(event){cont.select2().off("opening").select2().on("opening",function(event){event.preventDefault(),event.stopPropagation(),AttendanceShift.getApplicableShifts()})}),!0}}else AttendanceShift.cacheErecArr=JSON.parse(JSON.stringify(erecArr)),AttendanceShift.cacheLocArr=JSON.parse(JSON.stringify(locArr));return!1},showImport:function(setUpdAttEntry){var shiftImportView=Layout.Page.container.find("#ZPAtt_Shift_importView");shiftImportView.modal("show"),shiftImportView.off("hidden.bs.modal").on("hidden.bs.modal",function(){shiftImportView.find("#ZPAtt_updAttDivImpShift").hide(),shiftImportView.find("#ZPAtt_updAttEntryOnShiftImp")[0].checked=!0}),$(AttendanceShift.LayoutId+" #zp_import_submitappr_cont").hide(),setUpdAttEntry&&(shiftImportView.find("#ZPAtt_updAttDivImpShift").hide(),shiftImportView.find("#ZPAtt_updAttEntryOnShiftImp")[0].checked=!0),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importSuccMsg").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importSuccvalues").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_import").parent().parent().removeAttr("class"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_import").fadeIn(300),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_impEx").fadeIn(300),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFileConf").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMap").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInput").val(""),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importDesc").after($(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInputCont").show()),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInputCont span").text(ZPI18N.getString("zp.importfile")),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInputCont").attr("class","btn btn-primary ZPbtnDefault"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importPrevious").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importHeader li").first().attr("class","active"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importHeader li").last().removeAttr("class"),Layout.Page.container.find("#ZPAtt_Shift_importView .modal-body").find("#zp_page_loading").remove(),Layout.Page.container.find("#ZPAtt_Shift_importView .modal-body").children().show(),Layout.Page.container.find("input:radio[name=ZPAtt_Shift_Type]")[0].checked=!0,AttendanceShift.isUserShiftMapping=!1,AttendanceShift.consUserWiseImportNote(),$(AttendanceShift.LayoutId+" #ZPAtt_shift_chooseAppr").hide(),isEmpChooseApp&&($(AttendanceShift.LayoutId+" #ZPAtt_shiftImport_approverId").parent().parent().show(),$(AttendanceShift.LayoutId+" #ZPAtt_shiftImport_approverId").empty(),$(AttendanceShift.LayoutId+" #ZPAtt_shiftImport_approverId").append(ZPeople.User.getEmployeeListFormatByType("option")),$(AttendanceShift.LayoutId+" #ZPAtt_shiftImport_approverId").select2()),Layout.Page.container.find("#ZPAtt_Shift_UserWiseImport_Note").removeClass("DN"),AttendanceShift.isUserShiftMapping?(Layout.Page.container.find("#ZPAtt_Shift_Userwise_Sample").removeClass("DN"),Layout.Page.container.find("#ZPAtt_Shift_Shiftwise_Sample").addClass("DN")):(Layout.Page.container.find("#ZPAtt_Shift_Shiftwise_Sample").removeClass("DN"),Layout.Page.container.find("#ZPAtt_Shift_Userwise_Sample").addClass("DN"),Layout.Page.container.find("#ZPAtt_Shift_UserWiseImport_Note").addClass("DN"));var shiftList=[],index=0;for(var shiftId in AttendanceShift.depLocShiftList.shiftlist)if(-1!==AttendanceShift.depLocShiftList.shiftlist[shiftId].select&&(shiftList[index]=AttendanceShift.depLocShiftList.shiftlist[shiftId].shiftName,5==++index))break;AttendanceShift.consShiftwiseImportSample(shiftList),AttendanceShift.consUserWiseImportSample(shiftList),AttendanceShift.getPendingImport(),Layout.Page.container.find("#importErrDiv").hide()},consUserWiseImportNote:function(){if(!($(AttendanceShift.LayoutId+" #ZPAtt_Shift_UserWiseImport_Note").children().length>0)){var html='<p class="S13"><b>'+ZPI18N.getString("zp.notes")+": </b>"+ZPI18N.getString("zp.userwise.shiftimportnote1")+"<br><br>";html+=ZPI18N.getString("zp.userwise.shiftimportnote2")+"<br><br>",html+=ZPI18N.getString("zp.userwise.shiftimportnote3")+"<br><br>",html+=ZPI18N.getString("zp.userwise.shiftimportnote4",[AttendanceShift.dateFormat])+"<br><br>",$(AttendanceShift.LayoutId+" #ZPAtt_Shift_UserWiseImport_Note").append(html)}},consShiftwiseImportSample:function(shiftList){if(!($(AttendanceShift.LayoutId+" #ZPAtt_Shift_Shiftwise_Sample tbody").children().length>0)){var html_table='<tbody><tr class="TblGryBg "><th class="PL12I" width="50"></th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th></tr>';html_table+='<tr class="ZPLRow"><th class="PL12I">1</th><td>'+ZPI18N.getString("zp.shiftname")+"</td><td>"+ZPI18N.getString("zp.from")+"</td><td>"+ZPI18N.getString("zp.to")+"</td><td>"+ZPI18N.getString("zp.emailemployeeid")+"</td><td>"+ZPI18N.getString("zp.reason")+"</td></tr>";var shiftName=shiftList[0],fdate=moment([curyear,curmonth,1]).format(AttendanceShift.dateFormat.toUpperCase()),tdate=moment([curyear,curmonth,10]).format(AttendanceShift.dateFormat.toUpperCase()),emplIDorEmail=ZPeople.CURR_USER.email;html_table+='<tr class="ZPLRow"><th class="PL12I">2</th><td>'+shiftName+"</td><td>"+fdate+"</td><td>"+tdate+"</td><td>"+emplIDorEmail+"</td><td>"+ZPI18N.getString("zp.assistsupportteam")+"</td></tr>";fdate=moment([curyear,curmonth,5]).format(AttendanceShift.dateFormat.toUpperCase()),tdate=moment([curyear,curmonth,11]).format(AttendanceShift.dateFormat.toUpperCase());var empIndex=0;if(locempArr.length>0){empIndex=locempArr[empIndex].ERECNO==erecno?empIndex+1:empIndex,emplIDorEmail=locempArr[empIndex]?locempArr[empIndex].EMPID:locempArr[0].EMPID,html_table+='<tr class="ZPLRow"><th class="PL12I">3</th><td>'+(shiftName=shiftList[1]?shiftList[1]:shiftName)+"</td><td>"+fdate+"</td><td>"+tdate+"</td><td>"+emplIDorEmail+"</td><td>"+ZPI18N.getString("zp.clientpriority")+"</td></tr>";fdate=moment([curyear,curmonth,10]).format(AttendanceShift.dateFormat.toUpperCase()),tdate=moment([curyear,curmonth,30]).format(AttendanceShift.dateFormat.toUpperCase());empIndex=locempArr[empIndex+1]?locempArr[empIndex+1].ERECNO==erecno?empIndex:empIndex+1:empIndex,emplIDorEmail=locempArr[empIndex]?locempArr[empIndex].EMPID:locempArr[0].EMPID,html_table+='<tr class="ZPLRow"><th class="PL12I">4</th><td>'+(shiftName=shiftList[2]?shiftList[2]:shiftName)+"</td><td>"+fdate+"</td><td>"+tdate+"</td><td>"+emplIDorEmail+"</td><td></td></tr></tbody>"}else{html_table+='<tr class="ZPLRow"><th class="PL12I">3</th><td>'+shiftName+"</td><td>"+fdate+"</td><td>"+tdate+"</td><td>ZCON001</td><td></td></tr>";fdate=moment([curyear,curmonth,10]).format(AttendanceShift.dateFormat.toUpperCase()),tdate=moment([curyear,curmonth,30]).format(AttendanceShift.dateFormat.toUpperCase());html_table+='<tr class="ZPLRow"><th class="PL12I">4</th><td>'+(shiftName=shiftList[2]?shiftList[2]:shiftName)+"</td><td>"+fdate+"</td><td>"+tdate+"</td><td>ZCON002</td><td>"+ZPI18N.getString("zp.escalations")+"</td></tr></tbody>"}$(AttendanceShift.LayoutId+" #ZPAtt_Shift_Shiftwise_Sample").append(html_table)}},consUserWiseImportSample:function(shiftList){if(!($(AttendanceShift.LayoutId+" #ZPAtt_Shift_Userwise_Sample tbody").children().length>0)){var html_table='<tbody><tr class="TblGryBg "><th class="PL12I" width="50"></th><th>A</th><th>B</th> <th>C</th><th>D</th><th>E</th><th>F</th><th>G</th></tr><tr class="ZPLRow"><th class="PL12I">1</th>';html_table+="<td>"+ZPI18N.getString("zp.emailemployeeid")+"</td>";for(var i=1;i<=5;i++)html_table+="<td>"+moment([curyear,curmonth,i]).format(AttendanceShift.dateFormat.toUpperCase())+"</td>";var emplIDorEmail=ZPeople.CURR_USER.email;html_table+="<td>"+ZPI18N.getString("zp.reason")+'</td></tr><tr class="ZPLRow"><th class="PL12I">2</th>',html_table+="<td>"+emplIDorEmail+"</td>";var shiftindex=0;for(i=0;i<5;i++)html_table+="<td>"+shiftList[shiftindex]+"</td>",shiftindex=shiftList[shiftindex+1]?shiftindex+1:0;html_table+="<td>"+ZPI18N.getString("zp.escalations")+"</td>";var empIndex=0;locempArr.length>0?(empIndex=locempArr[empIndex].ERECNO==erecno?empIndex+1:empIndex,emplIDorEmail=locempArr[empIndex]?locempArr[empIndex].EMPID:locempArr[0].EMPID):emplIDorEmail="ZCON001",html_table+='</tr><tr class="ZPLRow"><th class="PL12I">3</th>',html_table+="<td>"+emplIDorEmail+"</td>",shiftindex=0;for(i=0;i<5;i++)html_table+="<td>"+shiftList[shiftindex]+"</td>",shiftindex=shiftList[shiftindex+1]?shiftindex+1:0;html_table+="<td></td>",locempArr.length>0?(empIndex=locempArr[empIndex+1]?locempArr[empIndex+1].ERECNO==erecno?empIndex:empIndex+1:empIndex,emplIDorEmail=locempArr[empIndex]?locempArr[empIndex].EMPID:locempArr[0].EMPID):emplIDorEmail="ZCON002",html_table+='</tr><tr class="ZPLRow"><th class="PL12I">4</th>',html_table+="<td>"+emplIDorEmail+"</td>",shiftindex=0;for(i=0;i<5;i++)html_table+="<td>"+shiftList[shiftindex]+"</td>",shiftindex=shiftList[shiftindex+1]?shiftindex+1:0;html_table+="<td>"+ZPI18N.getString("zp.assistsupportteam")+"</td></tr></tbody>",$(AttendanceShift.LayoutId+" #ZPAtt_Shift_Userwise_Sample").append(html_table)}},getPendingImport:function(){var pendingMsg=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg");pendingMsg.parent().hide(),$.post("/AttendanceShiftAction.zp",{mode:"getPendingShiftImportInfo",conreqcsr:csrfToken},function(rdata){"empty"===rdata.tableInfo.tableHeaders?(AttendanceShift.hasPendingImportedFiles=!1,pendingMsg.off("click"),pendingMsg.html(""),pendingMsg.parent().hide()):(AttendanceShift.hasPendingImportedFiles=!0,pendingMsg.attr("class","blu CP"),pendingMsg.off("click").on("click",function(){if(isEmpChooseApp&&"-Select-"===$(AttendanceShift.LayoutId+" #ZPAtt_shiftImport_approverId").val())return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.chooseapprovererrormsg")),void AttendanceShift.showImport(!0);AttendanceShift.showShiftMapping(rdata.tableInfo)}),pendingMsg.html(rdata.tableInfo.recordCount+" "+ZPI18N.getString("zp.recordspending")),pendingMsg.parent().fadeIn(300))})},onImportInputChange:function(){var fileName=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInput").val();if($(AttendanceShift.LayoutId+" #ZPAtt_Shift_importProgress").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importProgress").next().show(),$(AttendanceShift.LayoutId+" #zp_import_submitappr_cont").hide(),isShiftApprConfigured&&($(AttendanceShift.LayoutId+" #zp_import_submitappr_cont").find("input").prop("checked",!0),$(AttendanceShift.LayoutId+" #zp_import_submitappr_cont").show()),isEmpChooseApp&&"-Select-"===$(AttendanceShift.LayoutId+" #ZPAtt_shiftImport_approverId").val())return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.chooseapprovererrormsg")),void AttendanceShift.showImport(!0);fileName=fileName.replace("C:\\fakepath\\",""),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFName").text(fileName),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importSuccMsg").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importSuccvalues").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importProgress").after($(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInputCont")),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInputCont span").text(ZPI18N.getString("zp.removeandnew")),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInputCont").attr("class","btn btn-default ZPbtnDefault");var extn=fileName.split(".").pop();"xls"===extn||"csv"===extn?($(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFName").next().attr("class","IC-rou-tik ML5 filetck"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").fadeIn(300),Layout.Page.container.find("#ZPAtt_Shift_importNext").attr("disabled",!1),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").off("click").on("click",function(){AttendanceShift.submitImport()})):($(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFName").next().attr("class","IC-r-close ML5 PR S18 red"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInput").val(""),""===$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFName").text()&&$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFName").text(ZPI18N.getString("zp.choosefile"))),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_import").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_impEx").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_shift_chooseAppr").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFileConf").fadeIn(300),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMap").hide()},submitImport:function(){$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").off("click"),AttendanceShift.ProgressBarWidth=0,$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importProgress").next().hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importProgress div").width(AttendanceShift.ProgressBarWidth+"%").parent().show(),$(AttendanceShift.LayoutId+" #zp_import_submitappr_cont").hide(),AttendanceShift.showProgress();var form=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInput")[0].form;""!==$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importInput").val()&&(Layout.Page.container.find("#ZPAtt_Shift_importNext").attr("disabled",!0),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFormCsrf").val(csrfToken),AttendanceShift.isUserShiftMapping?$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFormType").val("UserWise"):$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFormType").val("ShiftWise"),form.action="AttendanceImport.zp",form.submit())},ProgressBarWidth:0,showProgress:function(){$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importProgress div").width(AttendanceShift.ProgressBarWidth+"%"),AttendanceShift.ProgressBarWidth+=2,AttendanceShift.ProgressBarWidth<=99&&setTimeout(AttendanceShift.showProgress,1)},showShiftMapping:function(obj){if(Layout.Page.container.find("#ZPAtt_Shift_importNext").attr("disabled",!1),AttendanceShift.tableDetails=obj,$(AttendanceShift.LayoutId+" #ZPAtt_Shift_import").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_impEx").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_shift_chooseAppr").hide(),Layout.Page.container.find("#ZPAtt_updAttDivImpShift").hide(),Layout.Page.container.find("#ZPAtt_updAttEntryOnShiftImp")[0].checked=!0,$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importHeader li").last().attr("class","active"),AttendanceShift.isUserShiftMapping){if(Layout.Page.container.find(" #ZPAtt_Shift_importMap .col-sm-6").hide(),obj.error&&("columnExceededLimit"===obj.error||"rowExceededLimit"===obj.error)){var errormsg="rowExceededLimit"===obj.error?"zp.rowsimportcntexceederror.shiftImport":"zp.columnsimportcntexceederror.shiftImport";return ZPeople.Message.showFailureMsg(ZPI18N.getString(errormsg),!0),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importPrevious").fadeIn(300).attr("onclick","AttendanceShift.showImport(true);"),Layout.Page.container.find("#ZPAtt_Shift_importNext").attr("disabled",!0),void Layout.Page.container.find("#ZPAtt_Shift_importMsg").text("")}void 0!==obj.recordCount?$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").text(obj.recordCount+" "+ZPI18N.getString("zp.recordsfound")):$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").text("0 "+ZPI18N.getString("zp.recordsfound")),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").off("click"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").attr("class","blu"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").parent().fadeIn(300),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFileConf").hide(),AttendanceShift.checkAttEntryUpd(obj)}else{$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFileConf").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMap").fadeIn(300),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importPrevious").fadeIn(300).attr("onclick","AttendanceShift.showImport(true);"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").fadeIn(300),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMap select").off("change"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").off("click").on("click",function(){AttendanceShift.checkAttEntryUpd(obj)}),Layout.Page.container.find(" #ZPAtt_Shift_importMap .col-sm-6").show(),"csv"!==obj.fileFormat?Layout.Page.container.find("#ZPAtt_Shift_importDateFor label").html(ZPI18N.getString("zp.dateformat")):Layout.Page.container.find("#ZPAtt_Shift_importDateFor label").html("<font>"+ZPI18N.getString("zp.dateformat")+"</font>"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importDateFor select").select2("val",0);var rArray=obj.tableHeaders,res="<option value='None' selected='selected'>-- "+ZPI18N.getString("zp.select")+" --</option>";for(var i in rArray)res+="<option value='"+i+"'>"+rArray[i]+"</option>";for(var i in $(AttendanceShift.LayoutId+" #ZPAtt_Shift_importEmpId select").html(res),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFrom select").html(res),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importTo select").html(res),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importShiftId select").html(res),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importReason select").html(res),rArray)-1!==rArray[i].indexOf("from")?$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFrom select").select2("val",i):-1!==rArray[i].indexOf("to")?$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importTo select").select2("val",i):-1!==rArray[i].indexOf("employee")||-1!==rArray[i].indexOf("user")?$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importEmpId select").select2("val",i):-1!==rArray[i].indexOf("shift")?$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importShiftId select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("reason")&&$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importReason select").select2("val",i);$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").off("click"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").attr("class","blu"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").parent().fadeIn(300),obj.error&&"rowExceededLimit"===obj.error?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.importcntexceederror"),!0),Layout.Page.container.find("#ZPAtt_Shift_importNext").attr("disabled",!0),Layout.Page.container.find("#ZPAtt_Shift_importMsg").text("")):void 0!==obj.recordCount?$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").text(obj.recordCount+" "+ZPI18N.getString("zp.recordsfound")):$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").text("0 "+ZPI18N.getString("zp.recordsfound")),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMap select").select2()}},checkAttEntryUpd:function(obj){if(AttendanceShift.isUserShiftMapping){for(var importedDates=obj.tableHeaders,dateLen=importedDates.length,isPastDateAvail=!1,index=1;index<dateLen;index++){var date=importedDates[index].trim().replace("]","");if(Attendance.dateLessThanOrEqualCurrDate(date,!0)){isPastDateAvail=!0;break}}isPastDateAvail&&!Attendance.isSpiceJet()?(Layout.Page.container.find("#ZPAtt_updAttDivImpShift").show(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").off("click").on("click",function(){AttendanceShift.submitMapping(obj.fileFormat)})):AttendanceShift.submitMapping(obj.fileFormat)}else if(Attendance.isSpiceJet())AttendanceShift.submitMapping(obj.fileFormat);else{var shiftImpView=Layout.Page.container.find("#ZPAtt_Shift_importView"),shiftId=shiftImpView.find("#ZPAtt_Shift_importShiftId select")[0].selectedIndex,from=shiftImpView.find("#ZPAtt_Shift_importFrom select")[0].selectedIndex,empId=(shiftImpView.find("#ZPAtt_Shift_importTo select")[0].selectedIndex,shiftImpView.find("#ZPAtt_Shift_importEmpId select")[0].selectedIndex),desc=shiftImpView.find("#ZPAtt_Shift_importReason select")[0].selectedIndex;if(!AttendanceShift.isUserShiftMapping&&(0===shiftId||0===empId||0===from||isShiftChangeReasonMandatory&&0===desc))return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"));var shiftType=0;Layout.Page.container.find("input:radio[name=ZPAtt_Shift_Type]")[1].checked&&(shiftType=1);var param={mode:"getPastDateShiftUpd",from:from-1,conreqcsr:csrfToken,shiftType:shiftType};if(AttendanceShift.isUserShiftMapping||"0"===$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importDateFor select").val()||(param.dateformat=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importDateFor select").val()),!AttendanceShift.isUserShiftMapping&&"csv"===obj.fileFormat&&!param.dateformat)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"));$.post("/AttendanceShiftAction.zp",param,function(resultData){resultData&&resultData.pastDateAvail?(shiftImpView.find("#ZPAtt_updAttDivImpShift").show(),shiftImpView.find("#ZPAtt_Shift_importMap").hide(),AttendanceShift.shiftImpObj=obj,shiftImpView.find("#ZPAtt_Shift_importPrevious").attr("onclick","AttendanceShift.showShiftMapping(AttendanceShift.shiftImpObj);"),shiftImpView.find("#ZPAtt_Shift_importNext").off("click").on("click",function(){AttendanceShift.submitMapping(obj.fileFormat)})):AttendanceShift.submitMapping(obj.fileFormat)})}},submitMapping:function(fileFormat){var shiftId=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importShiftId select")[0].selectedIndex,from=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importFrom select")[0].selectedIndex,to=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importTo select")[0].selectedIndex,empId=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importEmpId select")[0].selectedIndex,desc=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importReason select")[0].selectedIndex;if(AttendanceShift.isUserShiftMapping||0!==shiftId&&0!==empId&&0!==from){var shiftType=0;Layout.Page.container.find("input:radio[name=ZPAtt_Shift_Type]")[1].checked&&(shiftType=1);var param={mode:"shiftImportMapping",shiftId:shiftId-1,from:from-1,to:to-1,empId:empId-1,conreqcsr:csrfToken,shiftType:shiftType};0!==desc&&(param.desc=desc-1),isEmpChooseApp&&(param.empChoosenApprErecno=Layout.Page.container.find("#ZPAtt_shiftImport_approverId").val()),isShiftApprConfigured&&(param.approvalOn=$(AttendanceShift.LayoutId+" #zp_import_submitappr_cont").find("input").prop("checked")),AttendanceShift.isUserShiftMapping||"0"===$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importDateFor select").val()||(param.dateformat=$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importDateFor select").val()),AttendanceShift.importParam=param,AttendanceShift.isUserShiftMapping||"csv"!==fileFormat||param.dateformat?(param.updateAttEntries=!1,!0===Layout.Page.container.find("#ZPAtt_updAttEntryOnShiftImp")[0].checked&&(param.updateAttEntries=!0),Layout.Page.container.find("#ZPAtt_Shift_importNext").attr("disabled",!0),Layout.Page.container.find("#ZPAtt_Shift_importView .modal-body").children().hide(),Layout.Page.container.find("#ZPAtt_Shift_importView .modal-body").append(ZPeople.LOADING_HTML),$.post("/AttendanceShiftAction.zp",param,function(resultData){if(Layout.Page.container.find("#ZPAtt_Shift_importView .modal-body").find("#zp_page_loading").remove(),Layout.Page.container.find("#ZPAtt_Shift_importView .modal-body").children().show(),AttendanceShift.excludeCnt=0,AttendanceShift.excludedImportData=[],0===Object.keys(resultData.impDetails).length||resultData.impDetails.error)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")),Layout.Page.container.find("#ZPAtt_Shift_importMap").show(),Layout.Page.container.find("#ZPAtt_Shift_importNext").attr("disabled",!1),void Layout.Page.container.find("#ZPAtt_Shift_importNext").off("click").on("click",function(){AttendanceShift.submitMapping(fileFormat)});if(resultData.impDetails.msg){AttendanceShift.selectCnt=resultData.impDetails.selectCnt,AttendanceShift.importSuccess();var rowNumber=0;if(resultData.impDetails.emptyShiftEmployee||resultData.impDetails.inValidUsers.length>0||resultData.impDetails.emptyEmpIds.length>0||resultData.impDetails.emptyShiftIds.length>0||resultData.impDetails.inValidShifts.length>0||(resultData.impDetails.errorInfo&&resultData.impDetails.errorInfo.length)>0||resultData.impDetails.userwiseerrorInfo&&resultData.impDetails.userwiseerrorInfo.length>0||resultData.impDetails.inValidReason&&resultData.impDetails.inValidReason.length>0){if(Layout.Page.container.find("#importErrDiv").show(),Layout.Page.container.find("#importErrTBody").find("tr").remove(),resultData.impDetails.inValidUsers.length>0){for(length=resultData.impDetails.inValidUsers.length,Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.invalidempinfoforshiftimport")+"<ul></ul></td></tr>")),i=0;i<length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+$("<div/>").text(resultData.impDetails.inValidUsers[i]).html()+"</li>");rowNumber++}if(resultData.impDetails.emptyEmpIds.length>0){for(length=resultData.impDetails.emptyEmpIds.length,Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.emptyempidsforshiftimport")+"<ul></ul></td></tr>")),i=0;i<length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+resultData.impDetails.emptyEmpIds[i]+"</li>");rowNumber++}if(resultData.impDetails.inValidShifts.length>0){for(length=resultData.impDetails.inValidShifts.length,Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.invalidshiftinfo")+"<ul></ul></td></tr>")),i=0;i<length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+$("<div/>").text(resultData.impDetails.inValidShifts[i]).html()+"</li>");rowNumber++}if(resultData.impDetails.emptyShiftIds.length>0){for(length=resultData.impDetails.emptyShiftIds.length,Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.emptyshiftids")+"<ul></ul></td></tr>")),i=0;i<length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+resultData.impDetails.emptyShiftIds[i]+"</li>");rowNumber++}if(resultData.impDetails.errorInfo&&resultData.impDetails.errorInfo.length>0&&resultData.impDetails.errorInfo.forEach(function(obj,index){for(Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow'><td>Row "+obj[0]+" :</td><td></td></tr>")),i=1;i<obj.length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[index+rowNumber]).find("td")[1]).append(obj[i]+"<br>")}),resultData.impDetails.userwiseerrorInfo&&resultData.impDetails.userwiseerrorInfo.length>0&&resultData.impDetails.userwiseerrorInfo.forEach(function(obj,index){for(Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow'><td>Column "+obj[0]+" :</td><td></td></tr>")),i=1;i<obj.length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[index+rowNumber]).find("td")[1]).append(decodeHTML(obj[i])+"<br>")}),resultData.impDetails.inValidReason&&resultData.impDetails.inValidReason.length>0&&resultData.impDetails.inValidReason.forEach(function(obj){Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow'><td>Row "+obj[0]+" :</td><td>"+decodeHTML(obj[1])+"</td></tr>"))}),resultData.impDetails.emptyShiftEmployee){var emptyShiftEmp=resultData.impDetails.emptyShiftEmployee;if(Object.keys(emptyShiftEmp).length<0)return;Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.emptyshfitidsforEmp")+"<ul></ul></td></tr>"));var index=1;for(var key in Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow'><td>"+ZPI18N.getString("zp.emailemployeeid")+"</td><td>"+ZPI18N.getString("zp.schdates")+"</td></tr>")),emptyShiftEmp){Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow'><td>"+key+"</td><td></td></tr>"));var dates="";for(i=0;i<emptyShiftEmp[key].length;i++)dates=dates+"  "+emptyShiftEmp[key][i];$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[index+rowNumber]).find("td")[1]).append(decodeHTML(dates)+"<br>"),index+=1}}}}else{$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").off("click").on("click",function(){AttendanceShift.showConflictPage()}),AttendanceShift.importDetails=resultData;for(var isFirst=!0,loop=0;resultData.impDetails.result[loop];loop++)!0===isFirst?(AttendanceShift.consConflictList(resultData.impDetails.result[loop],!1,loop),isFirst=!1):AttendanceShift.consConflictList(resultData.impDetails.result[loop],!0,loop);AttendanceShift.showConflictPage()}})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))},addShiftFromImport:function(result){AttendanceShift.importParam.excludeList=JSON.stringify(result),$.post("/AttendanceShiftAction.zp",AttendanceShift.importParam,function(resultData){if(0===Object.keys(resultData).length||resultData.error)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess"));else if(resultData.impDetails.msg){if(AttendanceShift.selectCnt=resultData.impDetails.selectCnt,AttendanceShift.importSuccess(),resultData.impDetails.inValidUsers.length>0||resultData.impDetails.emptyEmpIds.length>0||resultData.impDetails.emptyShiftIds.length>0||resultData.impDetails.inValidShifts.length>0||resultData.impDetails.errorInfo.length>0||resultData.impDetails.userwiseerrorInfo&&resultData.impDetails.userwiseerrorInfo.length>0){var rowNumber=0;if(Layout.Page.container.find("#importErrDiv").show(),Layout.Page.container.find("#importErrTBody").find("tr").remove(),resultData.impDetails.inValidUsers.length>0){for(length=resultData.impDetails.inValidUsers.length,Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.invalidempinfoforshiftimport")+"<ul></ul></td></tr>")),i=0;i<length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+$("<div/>").text(resultData.impDetails.inValidUsers[i]).html()+"</li>");rowNumber++}if(resultData.impDetails.emptyEmpIds.length>0){for(length=resultData.impDetails.emptyEmpIds.length,Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.emptyempidsforshiftimport")+"<ul></ul></td></tr>")),i=0;i<length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+resultData.impDetails.emptyEmpIds[i]+"</li>");rowNumber++}if(resultData.impDetails.inValidShifts.length>0){for(length=resultData.impDetails.inValidShifts.length,Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.invalidshiftinfo")+"<ul></ul></td></tr>")),i=0;i<length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+$("<div/>").text(resultData.impDetails.inValidShifts[i]).html()+"</li>");rowNumber++}if(resultData.impDetails.emptyShiftIds.length>0){for(length=resultData.impDetails.emptyShiftIds.length,Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow' ><td colspan=2 class='err-lst'>"+ZPI18N.getString("zp.emptyshiftids")+"<ul></ul></td></tr>")),i=0;i<length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[rowNumber]).find("ul")).append("<li>"+resultData.impDetails.emptyShiftIds[i]+"</li>");rowNumber++}resultData.impDetails.errorInfo.length>0&&resultData.impDetails.errorInfo.forEach(function(obj,index){for(Layout.Page.container.find("#importErrTBody").append($("<tr class='ZPLRow'><td>Row "+obj[0]+" :</td><td></td></tr>")),i=1;i<obj.length;i++)$($(Layout.Page.container.find("#importErrTBody").find(".ZPLRow")[index+rowNumber]).find("td")[1]).append(obj[i]+"<br>")})}}else;})},importSuccess:function(){-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-listview")?(AttendanceShift.getUserListView(),AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-calview"),AttendanceShift.userCalValue=null,AttendanceShift.userHoursValue=null):-1===Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")||AttendanceShift.isHoursListView?-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")&&AttendanceShift.isHoursListView&&(AttendanceShift.userHoursValue=null,AttendanceShift.getHoursListView(),AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-listview"),AttendanceShift.userListValue=null,AttendanceShift.userCalValue=null):(AttendanceShift.userCalValue=null,AttendanceShift.getUserCalView(),AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-listview"),AttendanceShift.userListValue=null,AttendanceShift.userHoursValue=null),Layout.Page.container.find("#ZPAtt_updAttEntryOnShiftImp")[0].checked=!0,Layout.Page.container.find("#ZPAtt_updAttDivImpShift").hide(),$(AttendanceShift.LayoutId+" #conflictPage #addUserShift").next().click(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_import").parent().parent().attr("class","ZPImfrm ZPRecList"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMap").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").parent().hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importSuccMsg").fadeIn(300),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importSuccvalues").fadeIn(300),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importSuccvalues span")[0].innerHTML=AttendanceShift.tableDetails.recordCount,$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importSuccvalues span")[1].innerHTML=AttendanceShift.selectCnt,$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importPrevious").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importNext").hide(),AttendanceShift.excludeCnt=0,Attendance.resetForLoadData()},reInitFieldValue:function(){var layout=Layout.Page.container,shiftFilter=layout.find("#ZPAtt_calFilters");shiftFilter.find("#ZPAtt_shiftdepartment").children().remove(),shiftFilter.find("#ZPAtt_shiftdesg").children().remove(),shiftFilter.find("#ZPAtt_shiftentity").children().remove(),shiftFilter.find("#ZPAtt_shiftbusinessUnit").children().remove(),shiftFilter.find("#ZPAtt_shiftdivision").children().remove(),layout.find("#ZPAtt_shiftlist_drop").children().remove(),shiftFilter.find("#ZPAtt_shiftlocation").children().remove(),shiftFilter.find("#ZPAtt_shift_shiftName").children().remove(),Attendance.consResetEmpSearch("ZPAtt_userShiftMappingEmpName",Layout.Page.container,!0,!1);var datFormat=dateFmt.toUpperCase(),toDay=moment(AttendanceShift.depLocShiftList.currDate.todayDate,datFormat),weekStartDate=moment(toDay).startOf("week").add(weekstarts,"day"),weekEndDate=moment(toDay).startOf("week").add(weekstarts,"day").add(6,"day");""===shiftFilter.find("#ZPAtt_calFilter_fromDate").val()&&shiftFilter.find("#ZPAtt_calFilter_fromDate").val(weekStartDate.format(datFormat)),""===shiftFilter.find("#ZPAtt_calFilter_toDate").val()&&shiftFilter.find("#ZPAtt_calFilter_toDate").val(weekEndDate.format(datFormat)),$(AttendanceShift.LayoutId+" #ZPAtt_empShiftMap_drop").append(AttendanceShift.depLocShiftOptions.shiftOption),Attendance.Report.removeFilterOrSetOptions(shiftFilter.find("#ZPAtt_shiftlocation"),this.depLocShiftOptions.locOption),Attendance.organizationTag.isEnabled()&&(shiftFilter.find("#ZPAtt_shiftorgTag").children().remove(),Attendance.Report.removeFilterOrSetOptions(shiftFilter.find("#ZPAtt_shiftorgTag"),this.depLocShiftOptions.orgTagOption)),Attendance.Report.removeFilterOrSetOptions(shiftFilter.find("#ZPAtt_shiftdepartment"),this.depLocShiftOptions.depOption),Attendance.Report.removeFilterOrSetOptions(shiftFilter.find("#ZPAtt_shiftdesg"),this.depLocShiftOptions.desgOption),shiftFilter.find("#ZPAtt_shift_shiftName").append(AttendanceShift.depLocShiftOptions.shiftOption),Attendance.Report.removeFilterOrSetOptions(shiftFilter.find("#ZPAtt_shiftentity"),this.depLocShiftOptions.entityOption),Attendance.Report.removeFilterOrSetOptions(shiftFilter.find("#ZPAtt_shiftbusinessUnit"),this.depLocShiftOptions.bUnitOption),Attendance.Report.removeFilterOrSetOptions(shiftFilter.find("#ZPAtt_shiftdivision"),this.depLocShiftOptions.divisionOption)},resetFilterInputs:function(){if(-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftmaprequests")||-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftmapapprovals")){var shiftReqFilters=Layout.Page.container.find("#ZPAtt_ShiftMapFilters");if(shiftReqFilters.find("#ZPAtt_Shift_Status").select2("val",-3),-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftmaprequests")){shiftReqFilters.find("#ZPAtt_myReqShiftMap_shift").select2("val",0);var filters=Layout.Page.container.find("#ZPAtt_shiftMapFilter");Attendance.Reg.resetMyReqFilters(filters,"myReqShiftMap",this.depLocShiftList.currDate.monthStartDate,this.depLocShiftList.currDate.monthEndDate)}}else{var shiftFilter=Layout.Page.container.find("#ZPAtt_calFilters");if(-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-calview"))if(AttendanceShift.isHoursListView)shiftFilter.find("#ZPAtt_HoursView_Filter_fromDate").val(this.depLocShiftList.currDate.todayDate),shiftFilter.find("#ZPAtt_HoursView_Filter_fromDate").attr("disabled",!0),shiftFilter.find(" #ZPAtt_calFilter_period").select2("val",4);else{var datFormat=dateFmt.toUpperCase(),toDay=moment(AttendanceShift.depLocShiftList.currDate.todayDate,datFormat),weekStartDate=moment(toDay).startOf("week").add(weekstarts,"day"),weekEndDate=moment(toDay).startOf("week").add(weekstarts,"day").add(6,"day");shiftFilter.find("#ZPAtt_calFilter_fromDate").val(weekStartDate.format(datFormat)),shiftFilter.find("#ZPAtt_calFilter_toDate").val(weekEndDate.format(datFormat)),shiftFilter.find("#ZPAtt_calFilter_fromDate").attr("disabled",!0),shiftFilter.find("#ZPAtt_calFilter_toDate").attr("disabled",!0),shiftFilter.find("#ZPAtt_calFilter_period").select2("val",2)}-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-listview")&&(shiftFilter.find("#ZPAtt_calFilter_fromDate").val(this.depLocShiftList.currDate.monthStartDate),shiftFilter.find("#ZPAtt_calFilter_toDate").val(this.depLocShiftList.currDate.monthEndDate),shiftFilter.find("#ZPAtt_calFilter_period").select2("val",1)),shiftFilter.find("#ZPAtt_calFilter_fromDate").attr("disabled",!0),shiftFilter.find("#ZPAtt_calFilter_toDate").attr("disabled",!0),shiftFilter.find("#ZPAtt_shiftdepartment").select2("val",0),shiftFilter.find("#ZPAtt_shiftdesg").select2("val",0),shiftFilter.find("#ZPAtt_shiftlocation").select2("val",0),shiftFilter.find("#ZPAtt_shiftorgTag").select2("val",0),shiftFilter.find("#ZPAtt_shiftentity").select2("val",0),shiftFilter.find("#ZPAtt_shiftbusinessUnit").select2("val",0),shiftFilter.find("#ZPAtt_shiftdivision").select2("val",0),shiftFilter.find("#ZPAtt_shift_shiftName").select2("val",0),shiftFilter.find("#ZPAtt_shiftDirectRepTo").prop("checked",!1).parent().show(),shiftFilter.find("#ZPAtt_userShiftMappingEmpName").select2("val","")}},resetFilterInputsForReload:function(layoutId){$(layoutId+" #ZPAtt_shiftdepartment").val(""),$(layoutId+" #ZPAtt_shiftdesg").val(""),$(layoutId+" #ZPAtt_shiftlocation").val(""),$(layoutId+" #ZPAtt_shift_shiftName").val(""),$(layoutId+" #ZPAtt_userShiftMappingEmpName").select2("val","")},userListCurMonth:0,userListStartIndex:0,listViewUserList:null,getUserListView:function(navigate,isScroll){var oldParam=AttendanceShift.listviewParam,layout=Layout.Page.container;AttendanceShift.enableFilters(layout);var param={mode:"getUserListView",conreqcsr:csrfToken};navigate&&(param.navigate=navigate);var shiftFilter=layout.find("#ZPAtt_calFilters");AttendanceShift.getShiftFilterValues(shiftFilter,param),param.returned||param.isInvalid||(isScroll&&(oldParam.sdate===param.sdate&&oldParam.edate===param.edate&&oldParam.locId===param.locId&&oldParam.depId===param.depId&&oldParam.userId===param.userId||(param=AttendanceShift.listviewParam),param.startIndex=AttendanceShift.userListStartIndex+1),layout.find("#ZPAtt_userShiftList_myReqEmpSort").hasClass("sort")||(param.isEmpSortAsc=layout.find("#ZPAtt_userShiftList_myReqEmpSort").hasClass("sort-u")),0===layout.find("#shiftLister").parent().parent().find("#zp_page_loading").length&&(isScroll||layout.find("#ZPAtt_userShiftList #shiftLister").hide(),layout.find("#shiftLister").parent().parent().append(ZPeople.LOADING_HTML),layout.find("#shiftLister").parent().parent().find("#zp_page_loading").attr("style","height:80px")),$.post("/AttendanceShiftAction.zp",param,function(rdata){if(AttendanceShift.listviewParam=param,rdata.error)return $(AttendanceShift.LayoutId+" #ZPAtt_userShiftList #shiftLister").show(),$(AttendanceShift.LayoutId+" #shiftLister").parent().parent().find("#zp_page_loading").remove(),void("exceeded dates"===rdata.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinonemonth")):"from date greater"===rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")));if(50===rdata.userList.length&&ZPeople.FireScroll.reset(),isScroll)for(var i in rdata.userList)AttendanceShift.listViewUserList.push(rdata.userList[i]);else AttendanceShift.userListStartIndex=0,$(AttendanceShift.LayoutId+" #ZPAtt_userShiftList .table-responsive").scrollTop(0),AttendanceShift.listViewUserList=rdata.userList;AttendanceShift.userListValue=null,-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-listview")&&(AttendanceShift.userListValue=rdata,$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").val(rdata.date_details.startdate),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(rdata.date_details.enddate),rdata.dispMonth?($(AttendanceShift.LayoutId+" #listview_month").html(rdata.dispMonth),$(AttendanceShift.LayoutId+" ul.pager li").closest("div").find("nav").attr("class","ZPInlineNav"),$(AttendanceShift.LayoutId+" ul.pager li").eq(1).find("div").attr("class","ZPCalNav  mon MT8")):($(AttendanceShift.LayoutId+" #listview_month").html(Attendance.datesInHeader(rdata.date_details.startdate,rdata.date_details.enddate)),$(AttendanceShift.LayoutId+" ul.pager li").eq(1).find("div").attr("class","ZPCalNav"),$(AttendanceShift.LayoutId+" ul.pager li").closest("div").find("nav").attr("class","MT8")),AttendanceShift.consUserListView(rdata,isScroll))}))},consUserListView:function(rdata,isScroll){var emptyMsg=$(AttendanceShift.LayoutId+" #ZPAtt_ShiftMap_emptyRecInfo");if(0===rdata.userList.length&&!isScroll)return $(AttendanceShift.LayoutId+" #shiftLister").parent().parent().find("#zp_page_loading").remove(),$(emptyMsg).prev().hide(),$(emptyMsg).show(),void(0===emptyMsg.find("i").eq(0).children().length&&Attendance.noDataImg(8,"CR-at-shift-cal",emptyMsg.find("i").eq(0)));var adminUserList=rdata.loginUser_adminUserList;$(emptyMsg).prev().show(),$(emptyMsg).hide(),isScroll||$(AttendanceShift.LayoutId+" #shiftLister").empty();for(var space="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",userList=rdata.userList,i=0;userList[i]&&userList[i].shiftList[0];i++){var userObj=userList[i],html=(userObj.locationId,'<tr class="ZPLRow" id='+userObj.erecno+'><td><img class="FL" src='+userObj.empPhoto+'><div class="ZPusrName"><span><b>'+$("<div/>").text(userObj.empid).html()+"</b></span><span>"+$("<div/>").text(userObj.empname).html()+"<span>");html+='</div></td><td colspan="2" width="50%"><table class="STpad"><tbody>';for(var loop=0;userObj.shiftList[loop];loop++){var shiftDet=userObj.shiftList[loop],shiftId=shiftDet.shiftId,shiftData=AttendanceShift.depLocShiftList.shiftlist[shiftId],dateRange=(shiftDet.fromRangeInOrgFormat?shiftDet.fromRangeInOrgFormat:space+"-"+space)+" - "+(shiftDet.toRangeInOrgFormat?shiftDet.toRangeInOrgFormat:space+"-"+space),from=AttendanceShift.convertTime(shiftData.fTime,!0),to=AttendanceShift.convertTime(shiftData.tTime,!0),toEditView=!1,editClick="";(isSPOCShiftEdit&&isSPOCShiftEdit.includes(userObj.erecno)||isadmin||isManageAttendanceData&&(!adminUserList||adminUserList&&adminUserList.includes(userObj.erecno))||isLeadForShift&&1==isShiftEditAllowed&&userObj.erecno!==ZPeople.CURR_USER.usererec||3==isShiftEditAllowed&&userObj.erecno===ZPeople.CURR_USER.usererec||2===isShiftEditAllowed)&&(toEditView=!0,editClick="onclick=\"AttendanceShift.editSingleUserList($(this).parent().find('#ZPAtt_Shift_delAction span').eq(0))\"");var detCont="<div>"+shiftData.shiftName+'<span class="dgry">('+from+"-"+to+')</span></div><span class="ZSdte">'+dateRange+"</span>";1===userObj.shiftList.length&&0===loop?html+="<tr id="+shiftId+'><td class="CP" '+editClick+">"+detCont+"</td>":html+=0===loop?"<tr id="+shiftId+'><td class="CP" id='+i+">"+detCont+'<a class="DB VSLmore" onclick="AttendanceShift.showAllListEntries(this);">More...</a></td>':'<tr class="DN" id='+shiftId+'><td class="CP">'+detCont+"</td>";var lastModified=shiftDet.lastModifiedTime;lastModified&&(html+='<td width="30%">'+lastModified+"</td>"),html+='<td class="text-right P0I" width="20%"><div class="over-display" id="ZPAtt_Shift_delAction">',toEditView&&(html+='<span class="IC-pen S14 gry  MR15 CP" data-toggle="modal" onclick="AttendanceShift.editSingleUserList(this)"></span>'),(isSPOCShiftEdit&&isSPOCShiftEdit.includes(userObj.erecno)||isadmin||isManageAttendanceData&&(!adminUserList||adminUserList&&adminUserList.includes(userObj.erecno)))&&(html+='<span class="IC-delete S14 gry FR MR15 CP" onclick=event.stopPropagation();Attendance.deleteConfirmMsg(this,"ZPAtt_Shiftlist_delConfirm")></span></div>',html+='<div id="ZPAtt_Shiftlist_delConfirm" style="display:none">',html+="<button class=\"btn btn-default btn-sm FR\" type=\"button\" onclick=\"$(this).parent().parent().find('div').eq(0).removeAttr('style');event.stopPropagation();Attendance.deleteConfirmMsg(this,'ZPAtt_Shiftlist_delConfirm')\">"+ZPI18N.getString("zp.cancel")+"</button>",html+="<button id="+shiftDet.usmid+' onclick="event.stopPropagation();AttendanceShift.deleteShiftMapping(this)" class="btn btn-danger btn-sm FR MR10" type="button">'+ZPI18N.getString("zp.confirm")+"</button></div>"),html+="</td></tr>"}html+="</tbody></table></td></tr>",$(AttendanceShift.LayoutId+" #shiftLister").append(html)}$(AttendanceShift.LayoutId+" #shiftLister tr tbody tr:first-child td:first-child").on("click",function(){AttendanceShift.showAllListEntries(this)}),$(AttendanceShift.LayoutId+" #shiftLister tr tbody tr:not(:first-child) td:first-child").on("click",function(){AttendanceShift.editSingleUserList($(this).parent().find("#ZPAtt_Shift_delAction span").eq(0))}),$(AttendanceShift.LayoutId+" #ZPAtt_userShiftList #shiftLister").show(),$(AttendanceShift.LayoutId+" #shiftLister").parent().parent().find("#zp_page_loading").remove()},showAllListEntries:function(obj){$(obj).closest("tr").nextAll().removeAttr("class"),$(obj).closest("tr").find("a").hide(),$(obj).closest("tr").find("td").removeAttr("onclick"),$(obj).off("click").on("click",function(){AttendanceShift.editSingleUserList($(this).parent().find("#ZPAtt_Shift_delAction span").eq(0))})},deleteShiftMapping:function(obj){var param={mode:"deleteShiftMapping",conreqcsr:csrfToken,usmid:$(obj).attr("id"),erecno:$(obj).closest("tr").parent().closest("tr").attr("id")};$.post("/AttendanceShiftAction.zp",param,function(){AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-calview"),AttendanceShift.userCalValue=null,AttendanceShift.userHoursValue=null,Attendance.resetForLoadData(),0===$(obj).closest("tr").index()&&($(obj).closest("tr").siblings(":visible").length>0||$(obj).closest("tr").next().hasClass("DN"))?($(obj).closest("tr").nextAll().removeAttr("class"),$(obj).closest("tr").fadeOut("fast",function(){$(obj).closest("tr").hide()})):$(obj).closest("tr").index()>0&&$(obj).closest("tr").siblings(":visible").length>0?$(obj).closest("tr").fadeOut("fast",function(){$(obj).closest("tr").hide()}):$(obj).closest("tr.ZPLRow").fadeOut("fast",function(){if($(obj).closest("tr.ZPLRow").hide(),0===$(obj).closest("tbody#shiftLister").children(":visible").length){var rdata=[];rdata.userList=[],AttendanceShift.consUserListView(rdata)}})})},resetFields:function(){var md=$(AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp");md.find("shiftlist_fromdate").off("change"),md.find("#shiftlist_todate").off("change"),md.find("#shiftlist_fromdate").val(""),md.find("#shiftlist_todate").val(""),md.find("#ZPAtt_ShiftChangeReason").val(""),md.find("#ZPAtt_popUpContent_uShiftList #singleConflict").remove(),$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup #ZPAtt_popUpContent_uShiftList #ZPAtt_SMapEmptyLoc").remove()},editSingleUserList:function(obj){if(0!==$(obj).closest("tr").children().eq(2).find("#ZPAtt_Shift_delAction").length){AttendanceShift.resetFields();var md=$(AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp"),user=AttendanceShift.listViewUserList[$(obj).closest(".ZPLRow").index()],userShift=user.shiftList[$(obj).closest("tr").index()],shiftId=$(obj).closest("tr").attr("id");md.modal("show"),AttendanceShift.resetSingleUserParam();var from=userShift.fromRangeInOrgFormat,to=userShift.toRangeInOrgFormat,shiftInfo=AttendanceShift.depLocShiftList.shiftlist[shiftId],shift_timings="("+AttendanceShift.convertTime(shiftInfo.fTime,!0)+"-"+AttendanceShift.convertTime(shiftInfo.tTime,!0)+")",sName=shiftInfo.shiftName,desc=userShift.desc;md.find("#title").html(sName+" "+shift_timings),md.find("#shiftlist_fromdate").val(from),md.find("#shiftlist_todate").val(to),md.find("#selectedUser").text(user.empname).parent().attr("id",user.erecno),AttendanceShift.getApplicableShifts(user.erecno,void 0,void 0,shiftId),md.off("hide.bs.modal").on("hide.bs.modal",function(){md.find("#ZPAtt_updAttDivAssignShift").hide(),md.find("#ZPAtt_updAttEntryOnShift")[0].checked=!0}),md.find("#ZPAtt_ShiftChangeReason").val(desc),md.find("#ZPAtt_shift_chooseAppr").hide(),md.find("#emptyErrMsg").html(""),md.find("#emptyErrMsg").removeClass("MB10"),isEmpChooseApp&&(md.find("#ZPAtt_shift_approverId").parent().parent().show(),md.find("#ZPAtt_shift_approverId").empty(),md.find("#ZPAtt_shift_approverId").append(ZPeople.User.getEmployeeListFormatByType("option")),md.find("#ZPAtt_shift_approverId").select2()),AttendanceShift.singlePopUpFrom=from,AttendanceShift.singlePopUpTo=to,AttendanceShift.singlePopUpShift=shiftId,AttendanceShift.singlePopUpDesc=desc,AttendanceShift.toggleUpdAttEntryCheckBox(),md.find("#ZPAtt_sNewPopupRecSave").off("click").on("click",function(){AttendanceShift.setUserBasedShift()}),$("div.modal-backdrop").off("click").on("click",function(){md.find("#ZPAtt_sNewPopupRecSave").next().trigger("click")})}},onCalendarViewScroll:function(){AttendanceShift.userCalValue&&50===AttendanceShift.userCalValue.userList.length&&!AttendanceShift.isHoursListView&&(AttendanceShift.userCalStartIndex+=50,AttendanceShift.getUserCalView(!0)),AttendanceShift.userHoursValue&&50===AttendanceShift.userHoursValue.userList.length&&AttendanceShift.isHoursListView&&(AttendanceShift.hoursListStartIndex+=50,AttendanceShift.getHoursListView(!0))},onListViewScroll:function(){AttendanceShift.userListValue&&50===AttendanceShift.userListValue.userList.length&&(AttendanceShift.userListStartIndex+=50,AttendanceShift.getUserListView(!1,!0))},userCalCurMon:0,userCalStartIndex:0,getUserCalView:function(isScroll,navigate){var oldParam=AttendanceShift.calviewParam,layout=Layout.Page.container;AttendanceShift.enableFilters(layout);var param={mode:"getUserCalView",conreqcsr:csrfToken};navigate&&(param.navigate=navigate);var shiftFilter=layout.find("#ZPAtt_calFilters");if(AttendanceShift.getShiftFilterValues(shiftFilter,param),!param.returned){if(AttendanceShift.Asc=null,layout.find("#ZPAtt_calView_myReqEmpSort").hasClass("sort-d")?(param.isEmpSortAsc=!1,AttendanceShift.Asc="sort-d"):layout.find("#ZPAtt_calView_myReqEmpSort").hasClass("sort-u")&&(param.isEmpSortAsc=!0,AttendanceShift.Asc="sort-u"),isScroll?(oldParam.sdate===param.sdate&&oldParam.edate===param.edate&&oldParam.locId===param.locId&&oldParam.depId===param.depId&&oldParam.userId===param.userId||(param=AttendanceShift.calviewParam),param.startIndex=AttendanceShift.userCalStartIndex+1):(layout.find("#cal_shiftLister").hide(),layout.find("#cal_shiftLister").prev().hide()),0===layout.find("#cal_shiftLister").parent().parent().find("#zp_page_loading").length&&Attendance.appendScroller(layout.find("#cal_shiftLister"),isScroll),param.isInValid)return layout.find("#cal_shiftLister").show(),layout.find("#cal_shiftLister").prev().show(),layout.find("#cal_shiftLister").parent().parent().find("#zp_page_loading").remove(),AttendanceShift.calviewParam=param,void(AttendanceShift.calviewParam.period=layout.find("#ZPAtt_calFilter_period")[0].value);$.post("/AttendanceShiftAction.zp",param,function(rdata){AttendanceShift.calviewParam=param;var layout=Layout.Page.container;if(AttendanceShift.calviewParam.period=layout.find("#ZPAtt_calFilter_period")[0].value,rdata.error){var shiftLister=layout.find("#cal_shiftLister");return shiftLister.show().prev().show(),shiftLister.parent().parent().find("#zp_page_loading").remove(),void("exceeded dates"===rdata.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinonemonth")):"from date greater"===rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")))}if(50===rdata.userList.length&&ZPeople.FireScroll.reset(),isScroll||(AttendanceShift.userCalStartIndex=0,layout.find("#ZPAtt_calView .table-responsive").scrollTop(0)),AttendanceShift.userCalValue=null,-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")&&!AttendanceShift.isHoursListView){var fromDateEle=layout.find("#ZPAtt_calFilter_fromDate"),toDateEle=layout.find("#ZPAtt_calFilter_toDate"),dateHeader=layout.find("#calview_month"),ulPager=layout.find("ul.pager li");fromDateEle.val(rdata.date_details.startdate),toDateEle.val(rdata.date_details.enddate);moment(param.edate,dateFmt.toUpperCase()).diff(moment(param.sdate,dateFmt.toUpperCase()),"days");AttendanceShift.fromNavigater&&(layout.find("#ZPAtt_calFilter_period").select2("val",6),fromDateEle.attr("disabled",!1),toDateEle.attr("disabled",!1)),rdata.dispMonth?(dateHeader.html(rdata.dispMonth),ulPager.closest("div").find("nav").attr("class","ZPInlineNav"),ulPager.eq(1).find("div").attr("class","ZPCalNav  mon MT8"),Layout.Page.container.find("#ZPAtt_cal_view_days a").html(ZPI18N.getString("zp.month"))):(dateHeader.html(Attendance.datesInHeader(rdata.date_details.startdate,rdata.date_details.enddate)),ulPager.eq(1).find("div").attr("class","ZPCalNav"),ulPager.closest("div").find("nav").attr("class","MT8"),Layout.Page.container.find("#ZPAtt_cal_view_days a").html(ZPI18N.getString("zp.week"))),AttendanceShift.userCalValue=rdata,AttendanceShift.consUserCalList(rdata,isScroll)}})}},shiftCalEditObj:null,appendShiftDropDown:function(obj){var shiftDropDown=Layout.Page.container.find("#ZPAtt_shiftDropDown");shiftDropDown.empty(),AttendanceShift.dropDownShiftOption="";var dayView="day"===$(obj).attr("elem"),rowObj=dayView?"#ZPAtt_hoursView .zphours-row":"#ZPAtt_calView .ZPLHRow",elemId=dayView?$(obj).parent().parent().parent().attr("id"):obj.parentElement.id,elemOff=dayView?$(obj).parent().next().offset():$(obj).offset(),elemHei=dayView?$(obj).parent().next().height():$(obj).height(),docHei=$(document).height(),elemBot=elemOff.top+elemHei,rowTop=$(rowObj).offset(),rowHei=$(rowObj).height(),rowBot=rowTop.top+rowHei;AttendanceShift.shiftCalEditObj=obj;var html='<div class="dropdown-menu ZPAtck ZPCmn-Arrow SftDD gray" id='+elemId+' style="position:absolute;z-index:999;max-width:200px;"><ul><div class="line-scale se-ldr" style="text-align:center" id="zp_Att_etloader"><div></div><div></div><div></div></div>';html+='</ul><div class="PL10 PR10"><a class="btn btn-primary W100I" href="#" data-toggle="modal" data-target="#shift" onClick="AttendanceShift.editShift();">',html+=ZPI18N.getString("zp.editshift")+"</a></div></div>",shiftDropDown.append(html);var dropdownHei=$(".SftDD").height(),posi="top",topfix=elemBot+elemHei+10,left=left=elemOff.left-100;(dayView?elemBot+dropdownHei+30:elemBot+dropdownHei)>=docHei&&(topfix=elemBot-dropdownHei+15,posi="bottom"),topfix-=rowBot,left+="px",dayView&&(left=event.clientX-176,"Minimize"===$(document).find("#zp_minimax_leftpanel").attr("data-original-title")&&(left-=190)),shiftDropDown.find(".SftDD").addClass(" "+posi),shiftDropDown.find(".SftDD").css({top:topfix+"px"}),shiftDropDown.find(".SftDD").css({left:left}),shiftDropDown.find("li#"+$(obj).attr("id")).attr("class","actve"),shiftDropDown.addClass("open"),AttendanceShift.getApplicableShifts(elemId,!0,obj)},consUserCalList:function(rdata,isScroll){var emptyMsg=$(AttendanceShift.LayoutId+" #ZPAtt_ShiftMap_emptyRecInfo");if(0===rdata.userList.length&&!isScroll)return $(AttendanceShift.LayoutId+" #cal_shiftLister").parent().parent().find("#zp_page_loading").remove(),$(emptyMsg).prev().hide(),$(emptyMsg).show(),void(0===emptyMsg.find("i").eq(0).children().length&&Attendance.noDataImg(8,"CR-at-shift-cal",emptyMsg.find("i").eq(0)));if($(emptyMsg).prev().show(),$(emptyMsg).hide(),!isScroll){$(AttendanceShift.LayoutId+" .ZPLHRow").empty(),$(AttendanceShift.LayoutId+" #cal_shiftLister").empty();var sort=null===AttendanceShift.Asc?"sort":AttendanceShift.Asc;$(AttendanceShift.LayoutId+" .ZPLHRow").append("<th style='max-width:300px;width:300px;'><div><span>"+ZPI18N.getString("zp.employee")+"</span><i class='sort-img "+sort+" CP' id='ZPAtt_calView_myReqEmpSort' onclick='AttendanceShift.myReqEmpNameTimeSort(this)' data-toggle='tooltip' data-placement='bottom' data-container='body' data-original-title=' "+ZPI18N.getString("zp.sort")+" '></i></div></th>");for(var i=0;rdata.statusHeader[i];i++){var status=AttendanceShift.userCalValue.statusHeader[i],html="<th class='text-center'><span class='shft-hdat'><small>"+days[status.split("-")[2]-1]+"</small>"+status.split("-")[0]+" </span></th>";$(AttendanceShift.LayoutId+" .ZPLHRow").append(html)}}AttendanceShift.userCalStartIndex;var adminUserList=rdata.loginUser_adminUserList,userList=rdata.userList,dateArray=rdata.dateArray;for(i=0;userList[i];i++){var user=userList[i],empId=user.empid,empName=user.empname;html='<tr class="ZPLRow" id="'+user.erecno+'"><td class="fxdtd" style="max-width:300px;width:300px;"><img class="FL" src='+user.empPhoto+">";html+='<div class="ZPusrName"><span class="ellipsis CP W200" data-toggle="tooltip" data-placement="top" data-container="body" title="'+empId+" "+empName+'"><b id="cal_shiftId">'+empId+'</b><span id="cal_shiftName">'+empName+"</span></span></div></td>";var style="";0===i&&(style="style=min-width:150px;max-width:initial;");for(var loop=0;user.shiftList[loop];loop++){var shift=AttendanceShift.depLocShiftList.shiftlist[user.shiftList[loop].shiftId],className="LC"+shift.colorCode,title="",shiftTitle=shift.shiftName;if(user.shiftList[loop].isWeekend){className+=" WStripe",title=ZPI18N.getString("zp.weekend");var endClose=user.shiftList[loop].isHoliday?"":")";shiftTitle+=" ("+ZPI18N.getString("zp.weekend")+endClose}user.shiftList[loop].isHoliday&&(className+=" WStripe",title=holiday_disName,shiftTitle+=user.shiftList[loop].isWeekend?"/"+holiday_disName+")":" ("+holiday_disName+")");var calClick="",isBeforeCurrDate=Attendance.dateLessThanOrEqualCurrDate(dateArray[loop],!0),isSPOCShEdit=isSPOCShiftEdit&&isSPOCShiftEdit.includes(user.erecno),isCurrUserData=user.erecno===ZPeople.CURR_USER.usererec,isAdmin=isadmin||isManageAttendanceData&&!adminUserList,isLocAdmin=isManageAttendanceData&&adminUserList&&adminUserList.includes(user.erecno),editSubOrdData=(isLeadForShift?!isCurrUserData&&0!==isShiftEditAllowed&&3!==isShiftEditAllowed:2===isShiftEditAllowed)&&(editPastShiftPermRepMan||!isBeforeCurrDate),editOwnData=isCurrUserData&&(2===isShiftEditAllowed||3===isShiftEditAllowed)&&(editPastShiftPermUser||!isBeforeCurrDate);(isSPOCShEdit||isAdmin||isLocAdmin||editSubOrdData||editOwnData)&&(className+=" CP",calClick="onclick=AttendanceShift.appendShiftDropDown(this)"),trow='<td title="'+title+'" class="'+className+'" data-toggle="dropdown" id="'+shift.shiftId+'" '+calClick+' align="center" '+style+">",trow+='<span class="ellipsis" title="'+shiftTitle+'">'+shift.shiftName+"</span>",trow+='<span class="sc-time">('+AttendanceShift.convertTime(shift.fTime,!0)+" - "+AttendanceShift.convertTime(shift.tTime,!0)+")</span></td>",html+=trow}html+="</tr>",$(AttendanceShift.LayoutId+" #cal_shiftLister").append(html),0}$(AttendanceShift.LayoutId+" #cal_shiftLister").show(),$(AttendanceShift.LayoutId+" #cal_shiftLister").prev().show(),$(AttendanceShift.LayoutId+" #cal_shiftLister").parent().parent().find("#zp_page_loading").remove();var width=$(AttendanceShift.LayoutId+" .ZPLHRow th.text-center").eq(0).width();$(AttendanceShift.LayoutId+" .ZPLHRow th.text-center div").attr("style","min-width:"+width+"px;"),Attendance.handleTableHeader()},hoursListStartIndex:0,getHoursListView:function(isScroll){var oldParam=AttendanceShift.userHoursValue,param={mode:"getUserCalView",conreqcsr:csrfToken,isHoursView:!0},shiftFilter=Layout.Page.container.find("#ZPAtt_calFilters");AttendanceShift.getShiftFilterValues(shiftFilter,param,!0),param.returned||($(AttendanceShift.LayoutId+" #ZPAtt_hoursView_myReqEmpSort").hasClass("sort")||(param.isEmpSortAsc=$(AttendanceShift.LayoutId+" #ZPAtt_hoursView_myReqEmpSort").hasClass("sort-u")),isScroll?(oldParam.sdate===param.sdate&&oldParam.locId===param.locId&&oldParam.depId===param.depId&&oldParam.userId===param.userId||(param=AttendanceShift.hoursviewParam),param.startIndex=AttendanceShift.hoursListStartIndex+1,0===Layout.Page.container.find(".zpschedule-list").parent().parent().find("#zp_page_loading").length&&Attendance.appendScroller(Layout.Page.container.find(".zpschedule-list"),isScroll)):($(AttendanceShift.LayoutId+" #ZPAtt_hoursShift_emptyRecInfo").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_hoursShift_emptyRecInfo").prev().hide(),0===$(AttendanceShift.LayoutId+" #ZPAtt_hoursShift_emptyRecInfo").parent().parent().find("#zp_page_loading").length&&Attendance.toggleLoadingDiv(!1,$(AttendanceShift.LayoutId+" #ZPAtt_hoursView"),$(AttendanceShift.LayoutId+" #ZPAtt_hoursShift_emptyRecInfo"))),$.post("/AttendanceShiftAction.zp",param,function(rdata){if(rdata.error)return"exceeded dates"===rdata.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinoneweek")):"from date greater"===rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")),void $(AttendanceShift.LayoutId+" #ZPAtt_hoursShift_emptyRecInfo").parent().parent().find("#zp_page_loading").remove();AttendanceShift.hoursviewParam=param,AttendanceShift.hoursviewParam.period=$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_period")[0].value,50===rdata.userList.length&&ZPeople.FireScroll.reset(),isScroll||(AttendanceShift.hoursListStartIndex=0),AttendanceShift.userHoursValue=null,-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")&&AttendanceShift.isHoursListView&&($(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").val(rdata.date_details.startdate),$(AttendanceShift.LayoutId+" #ZPAtt_hoursview_month").parent().prev().show(),$(AttendanceShift.LayoutId+" #ZPAtt_hoursview_month").parent().next().show(),$(AttendanceShift.LayoutId+" #ZPAtt_hoursview_month").attr("class","ZPCalNav MT8"),$(AttendanceShift.LayoutId+" #ZPAtt_hoursview_month").html(rdata.date_details.startdate),AttendanceShift.userHoursValue=rdata,AttendanceShift.consHoursViewList(rdata,isScroll))}))},consHoursViewList:function(rdata,isScroll){var emptyMsg=$(AttendanceShift.LayoutId+" #ZPAtt_hoursShift_emptyRecInfo");if(0===rdata.userList.length&&!isScroll)return $(AttendanceShift.LayoutId).find("#zp_page_loading").remove(),$(emptyMsg).prev().hide(),$(emptyMsg).show(),void(0===emptyMsg.find("i").eq(0).children().length&&Attendance.noDataImg(8,"CR-at-shift-cal",emptyMsg.find("i").eq(0)));if($(emptyMsg).prev().show(),$(emptyMsg).hide(),!isScroll){$(AttendanceShift.LayoutId+" #ZPAtt_hours_shiftListHeader .zphours-row").empty(),$(AttendanceShift.LayoutId+" #ZPAtt_hours_shiftLister").empty();var headerParent=$(AttendanceShift.LayoutId+" #ZPAtt_hours_shiftListHeader").parent();1!==rdata.statusHeader.length&&2===headerParent.children().length?headerParent.prepend('<div class="zpdata-col zpday-col"></div>'):1===rdata.statusHeader.length&&3===headerParent.children().length&&headerParent.children().eq(0).remove();var conClass="scheduler-container jobSchdl-con";headerParent.find(".zpday-col")[0]&&(conClass="scheduler-container jobSchdl-con-ddc"),$(AttendanceShift.LayoutId+" #ZPAtt_hoursView .scheduler-container").attr("class",conClass);for(var k=0;k<24;k++){var mins=0+60*k;mins>=1440&&(mins-=1440);var time=Attendance.disTime(mins,!0);Attendance.timeFormatIs12hr&&(time=time.substr(0,time.length-1));var html='<div class="zphour-col zpsmall-col">'+time+"</div>";$(AttendanceShift.LayoutId+" #ZPAtt_hours_shiftListHeader .zphours-row").append(html)}}for(var obj={},dateArray=rdata.dateArray,adminUserList=rdata.loginUser_adminUserList,i=(html=isScroll?"":'<div class="zpdata-col BB0I BL0I"><ul class="zp-list zpschedule-list">',0);rdata.userList[i];i++){var user=rdata.userList[i],shift=AttendanceShift.depLocShiftList.shiftlist[rdata.userList[i].shiftList[0].shiftId];(shift.tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(obj[user.erecno]=shift);var shiftContWidth=100,shiftContLeft=(shift=AttendanceShift.depLocShiftList.shiftlist[rdata.userList[i].shiftList[1].shiftId]).fTime/60/24.01*100;shift.fTime,shift.tTime;if(shift.tTime>shift.fTime?shiftContWidth=100/24*((shift.tTime-shift.fTime)/60):(shift.tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(shiftContWidth=100-shiftContLeft),html+='<li class="zpuser-row" id="'+user.erecno+'"><div class="zpuser-col zpfirst-col"><div class="zpth-user"><img class="FL" src='+user.empPhoto+'><div class="ZPusrName"><span class="ellipsis W100 CP" data-toggle="tooltip" data-placement="top" data-container="body" title="'+user.empid+" "+user.empname+'"><b>'+user.empid+"</b><span>"+user.empname+"</span></div></div></div>",html+='<div class="zpdata-col"><div class="zpshift-spans">',obj[user.erecno]&&null!==obj[user.erecno]){var sDet=obj[user.erecno],sWidth=sDet.tTime/60/24*100,sTime=AttendanceShift.convertTime(sDet.fTime,!0).toUpperCase()+" - "+AttendanceShift.convertTime(sDet.tTime,!0).toUpperCase();html+='<div class="shif-itemdiv" style="width:'+sWidth+'%; left:0%;"><div class="shift-items LC'+sDet.colorCode+'" data-toggle="tooltip" data-placement="top" data-container="body" title="'+sTime+" / "+sDet.shiftName+'">',html+="<p><b>"+sTime+'</b> &nbsp;/&nbsp;<span class="zp-sname">'+sDet.shiftName+"</span></p></div></div>",obj[user.erecno]=null}var calClick="",viewName="",isBeforeCurrDate=Attendance.dateLessThanOrEqualCurrDate(dateArray[0],!0),isSPOCShEdit=isSPOCShiftEdit&&isSPOCShiftEdit.includes(user.erecno),isCurrUserData=user.erecno===ZPeople.CURR_USER.usererec,isAdmin=isadmin||isManageAttendanceData&&!adminUserList,isLocAdmin=isManageAttendanceData&&adminUserList&&adminUserList.includes(user.erecno),editSubOrdData=(isLeadForShift?!isCurrUserData&&0!==isShiftEditAllowed&&3!==isShiftEditAllowed:2===isShiftEditAllowed)&&(editPastShiftPermRepMan||!isBeforeCurrDate),editOwnData=isCurrUserData&&(2===isShiftEditAllowed||3===isShiftEditAllowed)&&(editPastShiftPermUser||!isBeforeCurrDate),className="shif-itemdiv ellipsis";(isSPOCShEdit||isAdmin||isLocAdmin||editSubOrdData||editOwnData)&&(calClick='onclick="AttendanceShift.appendShiftDropDown(this)"',viewName=' elem="day"',className+=" CP");var shiftTime=AttendanceShift.convertTime(shift.fTime,!0).toUpperCase()+" - "+AttendanceShift.convertTime(shift.tTime,!0).toUpperCase();html+='<div id="'+shift.shiftId+'" '+calClick+viewName+' class="'+className+'" style="width:'+shiftContWidth+"%; left:"+shiftContLeft+'%;" data-toggle="dropdown" ><div class="shift-items LC'+shift.colorCode+'" data-toggle="tooltip" data-placement="top" data-container="body" title="'+shiftTime+" / "+shift.shiftName+'">',html+="<p><b>"+shiftTime+'</b> &nbsp;/&nbsp;<span class="zp-sname">'+shift.shiftName+"</span></p></div></div>",html+='</div><div class="zphours-row">';for(k=0;k<24;k++)html+='<div class="zphour-col zpsmall-col"></div>';(shift.tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(obj[user.erecno]=shift),html+="</div></div></li>"}html+="</ul></div></li></ul>",isScroll?Layout.Page.container.find("#ZPAtt_hours_shiftLister").find(".zpschedule-list").append(html):$(AttendanceShift.LayoutId+" #ZPAtt_hours_shiftLister").append(html);var currList=$(AttendanceShift.LayoutId+" #ZPAtt_hours_shiftLister").children().eq(0);currList.find(".zpdata-col.zpday-col").css("height",currList.height()),$(AttendanceShift.LayoutId+" #ZPAtt_hours_shiftLister").show(),$(AttendanceShift.LayoutId+" #ZPAtt_hours_shiftLister").prev().show(),$(AttendanceShift.LayoutId).find("#zp_page_loading").remove(),Attendance.handleTableHeader();var width=$(AttendanceShift.LayoutId+" #ZPAtt_hoursView .ZPLHRow th.text-center").eq(0).width();$(AttendanceShift.LayoutId+" #ZPAtt_hoursView .ZPLHRow th.text-center div").attr("style","min-width:"+width+"px;")},resetSingleUserParam:function(){AttendanceShift.singlePopUpEditFrom="",AttendanceShift.singlePopUpEditTo="",AttendanceShift.singlePopUpEditShift="",AttendanceShift.singlePopUpEditDesc=""},toggleUpdAttEntryCheckBox:function(){var layout=Layout.Page.container;(layout="none"===layout.find("#ZPAtt_shiftMapAddPopup")[0].style.display?layout.find("#singleUser_ListShiftPopUp"):layout.find("#ZPAtt_shiftMapAddPopup")).find("#ZPAtt_updAttEntryOnShift")[0].checked=!0,Attendance.dateLessThanOrEqualCurrDate(layout.find("#shiftlist_fromdate").val())&&!Attendance.isSpiceJet()?layout.find("#ZPAtt_updAttDivAssignShift").show():layout.find("#ZPAtt_updAttDivAssignShift").hide()},setUserBasedShift:function(isSend){var isSingleUserEdit=Layout.Page.container.find("#singleUser_ListShiftPopUp").hasClass("in");if(isSingleUserEdit)var curPopup=AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp";else curPopup=AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup";$(AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp #ZPAtt_popUpContent_uShiftList #singleConflict").remove(),$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup div.modal-footer div").remove();var locList,from_date=$(curPopup+" #shiftlist_fromdate").val().trim(),to_date=$(curPopup+" #shiftlist_todate").val().trim(),desc=$(curPopup+" #ZPAtt_ShiftChangeReason").val().trim(),ereclist=ZPPickList.sharedSelectedUsers;if(!0!==isSend||ereclist&&0!==ereclist.toString().length){if(AttendanceShift.selectedUserPickList=ereclist,isSingleUserEdit?ereclist=$(curPopup+" #selectedUser").parent().attr("id"):locList=ZPPickList.sharedSelectedLocations,locList&&0===locList.toString().length&&ereclist&&0===ereclist.toString().length)return isadmin?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectuserandshift")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.pleaseselectuser")),void AttendanceShift.resetSingleUserParam();var shiftid=$(curPopup+" #"+(isSingleUserEdit?"ZPAtt_shiftlist_drop":"ZPAtt_empShiftMap_drop")).val();if("0"===shiftid||""===shiftid||null===shiftid)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectshift")),void AttendanceShift.resetSingleUserParam();if(""===from_date)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectfromandto")),void AttendanceShift.resetSingleUserParam();if(null===shiftid)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.changedeletedshift")),void AttendanceShift.resetSingleUserParam();if(isSingleUserEdit){if(!(AttendanceShift.singlePopUpFrom!==from_date||AttendanceShift.singlePopUpShift!==shiftid||AttendanceShift.singlePopUpDesc!==desc&&(isShiftChangeReasonMandatory||AttendanceShift.singlePopUpDesc||""!==desc)||AttendanceShift.singlePopUpTo!==to_date&&(AttendanceShift.singlePopUpTo||""!==to_date))&&$(curPopup+" #ZPAtt_updAttEntryOnShift")[0].checked)return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nochangesmade"));AttendanceShift.singlePopUpEditFrom!==from_date||AttendanceShift.singlePopUpEditTo!==to_date||AttendanceShift.singlePopUpEditShift!==shiftid||AttendanceShift.singlePopUpEditDesc!==desc?(isSend=!1,AttendanceShift.resetSingleUserParam()):isSend=!0,AttendanceShift.singlePopUpEditFrom=from_date,AttendanceShift.singlePopUpEditTo=to_date,AttendanceShift.singlePopUpEditShift=shiftid,AttendanceShift.singlePopUpEditDesc=desc}if(isShiftChangeReasonMandatory&&""===desc)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.enterreasonforshiftchange")),void AttendanceShift.resetSingleUserParam();$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup #zp_shared_sub_list_header button").off("click"),$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup #zp_shared_sub_list_header button").on("click",function(){$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup div.modal-footer div").remove()});var params={shiftid:shiftid,mode:"addUserShiftMapping",conreqcsr:csrfToken};if(ereclist&&0!==ereclist.length&&(params.erecno=ereclist.toString()),""!==from_date&&(params.fdate=from_date),""!==to_date&&(params.tdate=to_date),""!==desc){if(desc.length>250)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.leave.cancell.error.reasonlength"));params.desc=desc}if(!0===isSend){if(params.update=!0,!params.erecno)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.excludedalluser"))}else locList&&0!==locList.length&&(params.locList=locList.toString());if(params.updateAttEntries=!1,!0===$(curPopup+" #ZPAtt_updAttEntryOnShift")[0].checked&&(params.updateAttEntries=!0),isEmpChooseApp){$(curPopup+" #emptyErrMsg").removeClass("MB10"),$(curPopup+" #emptyErrMsg").html("");var appErecno=$(curPopup+" #ZPAtt_shift_approverId").val();if("-Select-"===appErecno)return $(curPopup+" #emptyErrMsg").addClass("MB10"),void $(curPopup+" #emptyErrMsg").html(ZPI18N.getString("zp.chooseapprovererrormsg"));params.empChoosenApprErecno=appErecno}isShiftApprConfigured&&-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftmaprequests")&&(params.isFromShiftChangeRequest=!0),$.post("/AttendanceShiftAction.zp",params,function(rdata){var layout=Layout.Page.container,shiftMapAddPopup=layout.find("#ZPAtt_shiftMapAddPopup");if(shiftMapAddPopup.find("#ZPAtt_popUpContent_uShiftList #ZPAtt_SMapEmptyLoc").remove(),rdata.error){if(rdata.error===ZPI18N.getString("zp.cannoteditpastshift"))return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannoteditpastshift"));if("payPeriodExceed"===rdata.error)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.attendance.shiftChange.immutableinfo"));if("todate is mandatory"===rdata.error)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.emptytodate"))}return rdata.emptyLocList?(AttendanceShift.consEmptyLocCont(rdata.emptyLocList),void(AttendanceShift.emptyLocList=rdata.emptyLocList)):rdata.error||rdata.result.error?("from date greater"===rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")),void shiftMapAddPopup.find(".div.modal-footer div").hide()):((!0===isSend||rdata.result.msg)&&(layout.find("#conflictPage #addUserShift").next().click(),$(curPopup+" #ZPAtt_sNewPopupRecSave").next().click(),Attendance.resetForLoadData(),-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-listview")?(AttendanceShift.getUserListView(),AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-calview"),AttendanceShift.userCalValue=null,AttendanceShift.userHoursValue=null):-1===Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")||AttendanceShift.isHoursListView?-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")&&AttendanceShift.isHoursListView?(AttendanceShift.userHoursValue=null,AttendanceShift.getHoursListView(),AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-listview"),AttendanceShift.userListValue=null,AttendanceShift.userCalValue=null):-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftmaprequests")&&AttendanceShift.getShiftMapRequest(!1):(AttendanceShift.userCalValue=null,AttendanceShift.getUserCalView(),AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-listview"),AttendanceShift.userListValue=null,AttendanceShift.userHoursValue=null),!isShiftApprConfigured||-1===Layout.Page.pageId.indexOf("attendance-shiftmapping-listview")&&-1===Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")||ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.requestraisedsuccess"))),void(rdata.result.success||rdata.result.msg||0===Object.keys(rdata.result).length?layout.find("#ZPAtt_updAttEntryOnShift")[0].checked=!0:layout.find("#singleUser_ListShiftPopUp").hasClass("in")?(layout.find("#singleUser_ListShiftPopUp").find("#ZPAtt_updAttDivAssignShift").hide(),AttendanceShift.consConflictListSingleUser(rdata.result)):(rdata.erecArr&&(ZPPickList.sharedSelectedUsers=rdata.erecArr),AttendanceShift.showConflictPage(),AttendanceShift.consConflictList(rdata.result))))})}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.excludedalluser"))},consEmptyLocCont:function(emptyLocList){var cont='<div id="ZPAtt_SMapEmptyLoc" class="form-group"><div class="col-sm-6 col-sm-offset-3"><div class="ZPednote">';for(var i in cont+='<p class="notdesc">'+ZPI18N.getString("zp.noempinbelowloc")+'</p><table class="table MB0I S13 MT20"><tbody>',emptyLocList){cont+='<tr><td><div class="S13">'+emptyLocList[i]+"</span></div></td></tr>";var index=ZPPickList.sharedSelectedLocations.indexOf(i);ZPPickList.sharedSelectedLocations.splice(index,1)}$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup #ZPAtt_sNewPopupRecSave").text(ZPI18N.getString("zp.continue")),cont+="</tbody></table><p></p></div></div></div>",$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup #ZPAtt_popUpContent_uShiftList").append(cont)},showConflictPage:function(){$(AttendanceShift.LayoutId+" #conflictPage").modal("show"),$(AttendanceShift.LayoutId+" #conflictPage").on("hidden.bs.modal",function(){if(ZPPickList.sharedSelectedUsers=AttendanceShift.selectedUserPickList,$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup #ZPAtt_sNewPopupRecSave").text(ZPI18N.getString("zp.submit")),$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup #ZPAtt_popUpContent_uShiftList #ZPAtt_SMapEmptyLoc").remove(),AttendanceShift.emptyLocList){for(var i in AttendanceShift.emptyLocList)$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup #pickListComp #"+i).remove();AttendanceShift.emptyLocList=null}})},convertTime:function(mins,dropdown){if(Attendance.timeFormatIs12hr){var ampm=ZPI18N.getString("zp.am").toLocaleLowerCase();mins>=720&&1440!=mins&&(ampm=ZPI18N.getString("zp.pm").toLocaleLowerCase(),mins>=780&&(mins-=720));var hh=(mins-mins%60)/60,mm=mins%60;0!=hh&&24!=hh||ampm!=ZPI18N.getString("zp.am").toLocaleLowerCase()||(hh=12)}else hh=(mins-mins%60)/60,mm=mins%60,ampm="";if(dropdown)if(0==mm)var list=Attendance.disTwoDigit(hh)+ampm;else list=Attendance.disTwoDigit(hh)+":"+Attendance.disTwoDigit(mm)+ampm;else list=Attendance.disTwoDigit(hh)+" : "+Attendance.disTwoDigit(mm)+" "+ampm;return list},consConflictListSingleUser:function(rdata){var space="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",html='<div id="singleConflict" class="form-group"><div class="col-sm-6 col-sm-offset-3"><div class="ZPednote"><p class="notdesc">'+ZPI18N.getString("zp.shiftalreadymappedmsg",new Array("<br>"))+"</p>";for(var erec in html+='<table class="table MB0I S13 MT20"><thead><tr><th>'+ZPI18N.getString("zp.existingshift")+"</th><th>"+ZPI18N.getString("zp.changedshift")+"</th></tr></thead><tbody>",rdata)if(rdata[erec].conflictList)for(var loop=0;rdata[erec].conflictList[loop];loop++){var dateRange="";void 0!==(shiftDetails=rdata[erec].conflictList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);var shiftInfo=AttendanceShift.depLocShiftList.shiftlist[shiftDetails.shiftId],timings="("+AttendanceShift.convertTime(shiftInfo.fTime,!0)+"-"+AttendanceShift.convertTime(shiftInfo.tTime,!0)+")",rowClass="S13";shiftDetails.isModified||(rowClass="S13 red"),html+='<tr><td><div class="'+rowClass+'">'+shiftInfo.shiftName+'<span class="ML2">'+timings+'</span></div><span class="sft-date">'+dateRange+"</span></td></tr>"}else html+="<tr><td>N/A</td>";for(var erec in html+="</tbody></table></p></div></div></div>",$(AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp #ZPAtt_popUpContent_uShiftList").append(html),rdata)if(rdata[erec].newList)for(loop=0;rdata[erec].newList[loop];loop++){var shiftDetails;dateRange="";void 0!==(shiftDetails=rdata[erec].newList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);rowClass="S13";shiftDetails.isAdded&&(rowClass="S13 grn");shiftInfo=AttendanceShift.depLocShiftList.shiftlist[shiftDetails.shiftId],timings="("+AttendanceShift.convertTime(shiftInfo.fTime,!0)+"-"+AttendanceShift.convertTime(shiftInfo.tTime,!0)+")",html='<td><div class="'+rowClass+'">'+shiftInfo.shiftName+'<span class="ML2">'+timings+'</span><span class="sft-date">'+dateRange+"</span></div></td></tr>";1===$(AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp #ZPAtt_popUpContent_uShiftList tbody tr").eq(loop).length?$(AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp #ZPAtt_popUpContent_uShiftList tbody tr").eq(loop).append(html):$(AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp #ZPAtt_popUpContent_uShiftList tbody").append("<tr><td></td>"+html+"</tr>")}else html=ZPI18N.getString("zp.na"),$(AttendanceShift.LayoutId+" #singleUser_ListShiftPopUp #ZPAtt_popUpContent_uShiftList tbody tr").append("<td>"+html+"</td>")},consConflictList:function(rdata,isAppend,groupNo){$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importView").hasClass("in")?($(AttendanceShift.LayoutId+" #conflictPage #addUserShift").attr("onclick","AttendanceShift.addShiftFromImport(AttendanceShift.excludedImportData);"),$(AttendanceShift.LayoutId+" #conflictPage #addUserShift").next().text(ZPI18N.getString("zp.previous"))):($(AttendanceShift.LayoutId+" #conflictPage #addUserShift").attr("onclick","AttendanceShift.setUserBasedShift(true);"),$(AttendanceShift.LayoutId+" #conflictPage #addUserShift").next().text(ZPI18N.getString("zp.cancel"))),isAppend||$(AttendanceShift.LayoutId+" #conflictPage tbody tr:not(:first)").remove();var space="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";for(var erecno in rdata){var html='<tr class="ZPLRow"><td align="center"></td><td><img class="FL" src='+rdata[erecno].empPhoto+'><div class="tltnam ML10 MT10 FL" id="empname_'+erecno+'"></div></td><td>';if($(AttendanceShift.LayoutId+" #ZPAtt_Shift_importView").hasClass("in")&&(html='<tr class="ZPLRow" id='+groupNo+'><td align="center"></td><td><img class="FL" src='+rdata[erecno].empPhoto+'><div class="tltnam ML10 MT10 FL" id="empname_'+erecno+'"></div></td><td>'),rdata[erecno].conflictList)for(var loop=0;rdata[erecno].conflictList[loop];loop++){var dateRange="";void 0!==(shiftDetails=rdata[erecno].conflictList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);var shift=AttendanceShift.depLocShiftList.shiftlist[shiftDetails.shiftId],rowClass="S13";shiftDetails.isModified||(rowClass="S13 red"),rdata[erecno].conflictList.length>1&&loop<rdata[erecno].conflictList.length-1?(html+='<div class="'+rowClass+'">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="MB12 S13"><span class="sft-date">'+dateRange+"</span></div>"):(html+='<div class="'+rowClass+'">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="S13"><span class="sft-date">'+dateRange+"</span></div>")}else html+=ZPI18N.getString("zp.na");if(html+="</td><td>",rdata[erecno].newList)for(loop=0;rdata[erecno].newList[loop];loop++){var shiftDetails;dateRange="";void 0!==(shiftDetails=rdata[erecno].newList[loop]).fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+shiftDetails.toRangeInOrgFormat:void 0!==shiftDetails.fromRangeInOrgFormat&&void 0===shiftDetails.toRangeInOrgFormat?dateRange=shiftDetails.fromRangeInOrgFormat+" - "+space+"-"+space:void 0===shiftDetails.fromRangeInOrgFormat&&void 0!==shiftDetails.toRangeInOrgFormat&&(dateRange=space+"-"+space+" - "+shiftDetails.toRangeInOrgFormat);shift=AttendanceShift.depLocShiftList.shiftlist[shiftDetails.shiftId],rowClass="S13";shiftDetails.isAdded&&(rowClass="S13 grn"),rdata[erecno].newList.length>1&&loop<rdata[erecno].newList.length-1?(html+='<div class="'+rowClass+'">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="MB12 S13"><span class="sft-date">'+dateRange+"</span></div>"):(html+='<div class="'+rowClass+'">'+shift.shiftName+'<span class="ML2">('+AttendanceShift.convertTime(shift.fTime,!0)+"-"+AttendanceShift.convertTime(shift.tTime,!0),html+=')</span></div><div class="S13"><span class="sft-date">'+dateRange+"</span></div>")}else html+=ZPI18N.getString("zp.na");html+="</td>",html+='<td class="text-right over-display P0"><input id='+erecno+' class="btn exc-btn btn-danger btn-sm" onClick="AttendanceShift.exclude(this);" type="button" value="'+ZPI18N.getString("zp.exclude")+'"></td><td></td></tr>',$(AttendanceShift.LayoutId+" #conflictPage tbody").append(html),$(AttendanceShift.LayoutId+" #conflictPage tbody div#empname_"+erecno).text(rdata[erecno].empid+" "+rdata[erecno].empname)}},excludedImportData:[],excludeCnt:0,exclude:function(obj){if($(AttendanceShift.LayoutId+" #ZPAtt_Shift_importView").hasClass("in")){if(AttendanceShift.importDetails.impDetails.result[$(obj).closest("tr").attr("id")][$(obj).attr("id")].newList){for(var excludedetails={},newList=AttendanceShift.importDetails.impDetails.result[$(obj).closest("tr").attr("id")][$(obj).attr("id")].newList,loop=0;newList[loop];loop++)newList[loop].isActualInterval&&(excludedetails.shiftId=newList[loop].shiftId,newList[loop].fromRange&&(excludedetails.fromRange=newList[loop].fromRange),newList[loop].toRange&&(excludedetails.toRange=newList[loop].toRange));excludedetails.erecno=$(obj).attr("id"),AttendanceShift.excludeCnt++,AttendanceShift.excludedImportData.push(excludedetails)}}else{var index=ZPPickList.sharedSelectedUsers.indexOf($(obj).attr("id"));ZPPickList.sharedSelectedUsers.splice(index,1)}$(obj).parent().attr("class","text-right P0"),$(obj).parent().html('<span class="dgry">'+ZPI18N.getString("zp.excluded")+"</span>")},locationAdminUsers:null,setUserList:function(ele){var userList;if(ZPPickList.loginUserNeed=!0,isSPOCShiftEdit||isManageAttendanceData&&!isadmin){var params={mode:"GET_MODULE_EMP_LIST",module:"Attendance_Data",conreqcsr:csrfToken};$.post("/commonAction.zp",params,function(rdata){userList=rdata.empList,AttendanceShift.conUserList(ele,userList)})}else isManageAttendanceData||isadmin||!(isLeadForShift&&1===isShiftEditAllowed||2===isShiftEditAllowed||3===isShiftEditAllowed)?AttendanceShift.conUserList(ele):(userList=ZPForm.getPrimaryLookupValues(2==isShiftEditAllowed?2:3==isShiftEditAllowed?1:4),AttendanceShift.conUserList(ele,userList))},conUserList:function(ele,userList){var key=[];if(key.push(ZPPickList.CONSTANTS.USERS),null!==userList&&void 0!==userList){var users=[];$.each(userList,function(index,data){var user={};data.Value?(user.name=data.Value,user.usererec=data.Id):(user.name=data.EMPNAME+", "+data.EMPID,user.usererec=data.ERECNO),users.push(user)}),$(ele).html(ZPPickList.initSingleComponentUser(key,!0,users))}else key.push(ZPPickList.CONSTANTS.LOCATIONS),$(ele).html(ZPPickList.initComponent(key,!0)),$(ele).find(".dropdown-menu").addClass("ZPSchPoP");$(AttendanceShift.LayoutId+" #zp_shared_sub_list_header i").hide()},changeShiftCalView:function(shiftId){curRow=AttendanceShift.shiftCalEditObj;var dayView="day"===$(curRow).attr("elem");if(isEmpChooseApp||isShiftChangeReasonMandatory)return $("#shift").modal(),void AttendanceShift.editShift();if(!$(curRow).hasClass("actve")){var fdate=dayView?Layout.Page.container.find("#ZPAtt_hoursview_month").html():AttendanceShift.userCalValue.dateArray[$(curRow).index()-1],tdate=dayView?fdate:AttendanceShift.userCalValue.dateArray[$(curRow).index()-1],params={erecno:dayView?$(curRow).parent().parent().parent().attr("id"):$(curRow).closest("tr").attr("id"),shiftid:shiftId,mode:"addUserShiftMapping",update:!0,conreqcsr:csrfToken,fdate:fdate,tdate:tdate,loadDataForCalView:!0,updateAttEntries:!1};Attendance.isSpiceJet()||(params.updateAttEntries=!0),void 0==AttendanceShift.hoursviewParam||AttendanceShift.hoursviewParam.sdate!==params.fdate||dayView||(AttendanceShift.userHoursValue=null),$.post("/AttendanceShiftAction.zp",params,function(rdata){if(rdata.error)rdata.error===ZPI18N.getString("zp.cannoteditpastshift")?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannoteditpastshift")):"payPeriodExceed"===rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.attendance.shiftChange.immutableinfo"));else{var shift=AttendanceShift.depLocShiftList.shiftlist[rdata.userShiftList[0].shiftList[0].shiftId],tempObj=dayView?$(curRow.firstChild):$(curRow);$(tempObj).attr("title","");var className=$(tempObj).hasClass("CP")?"CP ":"",shiftTitle=decodeHTML(shift.shiftName);if(rdata.userShiftList[0].shiftList[0].isWeekend&&!dayView?(className+="LC"+shift.colorCode+" WStripe",$(tempObj).attr("title","Weekend"),shiftTitle+=" ("+ZPI18N.getString("zp.weekend")+")"):rdata.userShiftList[0].shiftList[0].isHoliday&&!dayView?(className+="LC"+shift.colorCode+" WStripe",$(tempObj).attr("title",holiday_disName),shiftTitle+=" ("+holiday_disName+")"):className+=dayView?"shift-items LC"+shift.colorCode:"LC"+shift.colorCode,$(tempObj).attr("class",className),isShiftApprConfigured&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.requestraisedsuccess")),AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-listview"),AttendanceShift.userListValue=null,Attendance.Settings.generalSettings=null,Attendance.resetForLoadData(),$(curRow).attr("id",rdata.userShiftList[0].shiftList[0].shiftId),dayView){var shiftContWidth=100,shiftContLeft=shift.fTime/60/24.01*100;shift.fTime,shift.tTime;shift.tTime>shift.fTime?shiftContWidth=100/24*((shift.tTime-shift.fTime)/60):(shift.tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(shiftContWidth=100-shiftContLeft);var shiftTime=AttendanceShift.convertTime(shift.fTime,!0).toUpperCase()+" - "+AttendanceShift.convertTime(shift.tTime,!0).toUpperCase();$(curRow.firstChild).attr("data-original-title",shiftTime+" / "+shift.shiftName),$(curRow.firstChild).find("span.zp-sname").html(shift.shiftName),$(curRow.firstChild).find("b").html(shiftTime),$(curRow).css({width:shiftContWidth+"%"}),$(curRow).css({left:shiftContLeft+"%"})}else $(curRow).find("span.ellipsis").html(shift.shiftName),$(curRow).find("span.ellipsis").attr("title",shiftTitle),$(curRow).find("span.sc-time").html("("+AttendanceShift.convertTime(shift.fTime,!0)+" - "+AttendanceShift.convertTime(shift.tTime,!0)+")")}})}},editShift:function(){var shiftMapAddPopup=Layout.Page.container.find("#shift");shiftMapAddPopup.find("#ZPAtt_shift_chooseAppr").hide(),shiftMapAddPopup.find("#emptyErrMsg").html(""),shiftMapAddPopup.find("#emptyErrMsg").removeClass("MB10"),isEmpChooseApp&&(shiftMapAddPopup.find("#ZPAtt_shift_approverId").parent().parent().show(),shiftMapAddPopup.find("#ZPAtt_shift_approverId").empty(),shiftMapAddPopup.find("#ZPAtt_shift_approverId").append(ZPeople.User.getEmployeeListFormatByType("option")),shiftMapAddPopup.find("#ZPAtt_shift_approverId").select2()),$("#ShiftChangeCalReason").val(""),id=AttendanceShift.shiftCalEditObj;var dayView="day"===$(id).attr("elem"),erecno=dayView?$(id).parent().parent().parent().attr("id"):$(id).closest("tr").attr("id");$(AttendanceShift.LayoutId+" #shift #ZPAtt_ShiftCalChangeDrop").children().remove(),$(AttendanceShift.LayoutId+" #shift #ZPAtt_ShiftCalChangeDrop").append(AttendanceShift.depLocShiftOptions.shiftOption),$(AttendanceShift.LayoutId+" #shift #ZPAtt_ShiftCalChangeDrop").val($(id).attr("id")).change(),$(AttendanceShift.LayoutId+" #shift #s2id_ZPAtt_ShiftCalChangeDrop span").html(AttendanceShift.depLocShiftList.shiftlist[$(id).attr("id")].shiftName),dayView?($(AttendanceShift.LayoutId+" #shift #ShiftCalChangeFrom").val(Layout.Page.container.find("#ZPAtt_hoursview_month").html()),$(AttendanceShift.LayoutId+" #shift #ShiftCalChangeTo").val(Layout.Page.container.find("#ZPAtt_hoursview_month").html())):($(AttendanceShift.LayoutId+" #shift #ShiftCalChangeFrom").val(AttendanceShift.userCalValue.dateArray[$(id).index()-1]),$(AttendanceShift.LayoutId+" #shift #ShiftCalChangeTo").val(AttendanceShift.userCalValue.dateArray[$(id).index()-1])),$(AttendanceShift.LayoutId+" #calEditShift").off("click"),$(AttendanceShift.LayoutId+" #calEditShift").on("click",function(){var shiftId=$(AttendanceShift.LayoutId+" #shift #ZPAtt_ShiftCalChangeDrop").val(),from_date=$(AttendanceShift.LayoutId+" #ShiftCalChangeFrom").val(),to_date=$(AttendanceShift.LayoutId+" #ShiftCalChangeTo").val(),desc=$("#ShiftChangeCalReason").val().trim();if(""!==from_date&&"0"!==shiftId)if(null!==shiftId)if(isShiftChangeReasonMandatory&&""===desc)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.enterreasonforshiftchange"));else{var params={erecno:erecno,shiftid:shiftId,mode:"addUserShiftMapping",conreqcsr:csrfToken,fdate:from_date,update:!0,loadDataForCalView:!0};if(""!==desc){if(desc.length>250)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.leave.cancell.error.reasonlength"));params.desc=desc}if(params.updateAttEntries=!1,Attendance.isSpiceJet()||(params.updateAttEntries=!0),""!==to_date&&(params.tdate=to_date),isEmpChooseApp){shiftMapAddPopup.find("#emptyErrMsg").removeClass("MB10"),shiftMapAddPopup.find("#emptyErrMsg").html("");var appErecno=shiftMapAddPopup.find("#ZPAtt_shift_approverId").val();if("-Select-"===appErecno)return shiftMapAddPopup.find("#emptyErrMsg").addClass("MB10"),void shiftMapAddPopup.find("#emptyErrMsg").html(ZPI18N.getString("zp.chooseapprovererrormsg"));params.empChoosenApprErecno=appErecno}$.post("/AttendanceShiftAction.zp",params,function(rdata){if(rdata.error)rdata.error===ZPI18N.getString("zp.cannoteditpastshift")?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannoteditpastshift")):"from date greater"===rdata.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")):"payPeriodExceed"===rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.attendance.shiftChange.immutableinfo"));else{!isShiftApprConfigured||-1===Layout.Page.pageId.indexOf("attendance-shiftmapping-listview")&&-1===Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")||ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.requestraisedsuccess")),AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-listview");var start=AttendanceShift.userCalValue.dateArray.indexOf(params.fdate)+1,end=AttendanceShift.userCalValue.dateArray.indexOf(params.tdate)+1;if(dayView){if(!(new Date(moment(Layout.Page.container.find("#ZPAtt_hoursview_month").html(),AttendanceShift.dateFormat.toUpperCase())._d).getTime()>=new Date(moment(params.fdate,AttendanceShift.dateFormat.toUpperCase())._d).getTime()&&new Date(moment(Layout.Page.container.find("#ZPAtt_hoursview_month").html(),AttendanceShift.dateFormat.toUpperCase())._d)<=new Date(moment(params.tdate,AttendanceShift.dateFormat.toUpperCase())._d).getTime()))return void $(AttendanceShift.LayoutId+" #calEditShift").next().click();var shift=AttendanceShift.depLocShiftList.shiftlist[rdata.userShiftList[0].shiftList[0].shiftId];$(id.firstChild).attr("title","");var shiftTitle=decodeHTML(shift.shiftName);$(id.firstChild).attr("class",$(id.firstChild).hasClass("CP")?"shift-items LC"+shift.colorCode+" CP":"shift-items LC"+shift.colorCode),$(id).attr("id",rdata.userShiftList[0].shiftList[0].shiftId);var shiftContWidth=100,shiftContLeft=shift.fTime/60/24.01*100;shift.fTime,shift.tTime;shift.tTime>shift.fTime?shiftContWidth=100/24*((shift.tTime-shift.fTime)/60):(shift.tTime<shift.fTime||shift.tTime===shift.fTime&&0!==shift.tTime)&&(shiftContWidth=100-shiftContLeft);var shiftTime=AttendanceShift.convertTime(shift.fTime,!0).toUpperCase()+" - "+AttendanceShift.convertTime(shift.tTime,!0).toUpperCase();$(id.firstChild).attr("data-original-title",shiftTime+" / "+shift.shiftName),$(id.firstChild).find("span.zp-sname").html(shift.shiftName),$(id.firstChild).find("b").html(shiftTime),$(id).css({width:shiftContWidth+"%"}),$(id).css({left:shiftContLeft+"%"})}else{if(AttendanceShift.userListValue=null,0==start&&0==end&&!(new Date(moment($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").val(),AttendanceShift.dateFormat.toUpperCase())._d).getTime()>new Date(moment(params.fdate,AttendanceShift.dateFormat.toUpperCase())._d).getTime()&&new Date(moment($(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").val(),AttendanceShift.dateFormat.toUpperCase())._d)<new Date(moment(params.tdate,AttendanceShift.dateFormat.toUpperCase())._d).getTime()))return void $(AttendanceShift.LayoutId+" #calEditShift").next().click();0==start&&(start=1),0==end&&(end=AttendanceShift.userCalValue.dateArray.length);for(var i=start;i<=end;i++){shift=AttendanceShift.depLocShiftList.shiftlist[rdata.userShiftList[0].shiftList[i-start].shiftId];$(id).closest("tr").find("td").eq(i).attr("title","");shiftTitle=decodeHTML(shift.shiftName);var className=$(id).closest("tr").find("td").eq(i).hasClass("CP")?"CP ":"";rdata.userShiftList[0].shiftList[i-start].isWeekend?(className+="LC"+shift.colorCode+" WStripe",$(id).closest("tr").find("td").eq(i).attr("title","Weekend"),shiftTitle+=" ("+ZPI18N.getString("zp.weekend")+")"):rdata.userShiftList[0].shiftList[i-start].isHoliday?(className+="LC"+shift.colorCode+" WStripe",$(id).closest("tr").find("td").eq(i).attr("title",holiday_disName),shiftTitle+=" ("+holiday_disName+")"):className+="LC"+shift.colorCode,$(id).closest("tr").find("td").eq(i).attr("class",className),$(id).closest("tr").find("td").eq(i).find("span.ellipsis").html(shift.shiftName),$(id).closest("tr").find("td").eq(i).find("span.ellipsis").attr("title",shiftTitle),$(id).closest("tr").find("td").eq(i).attr("id",rdata.userShiftList[0].shiftList[i-start].shiftId),$(id).closest("tr").find("td").eq(i).find("span.sc-time").html("("+AttendanceShift.convertTime(shift.fTime,!0)+" - "+AttendanceShift.convertTime(shift.tTime,!0)+")")}}$(AttendanceShift.LayoutId+" #calEditShift").next().click()}})}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.changedeletedOrNotAppshift"));else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectuseranddate"))})},getNavigator:function(isPre){if(-1!==AttendanceShift.LayoutId.indexOf("attendance-shiftmapping-calview")&&AttendanceShift.isHoursListView){var add=1;isPre&&(add=-1);var dateFormat=AttendanceShift.depLocShiftList.dateformat.toLocaleUpperCase(),fDate=moment(AttendanceShift.userHoursValue.dateArray[0],dateFormat).add(add,"days").format(dateFormat);$(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").val(fDate),$(AttendanceShift.LayoutId+" #ZPAtt_HoursView_Filter_fromDate").attr("disabled",!1),AttendanceShift.hoursListStartIndex=0,AttendanceShift.getHoursListView()}else{if("#attendance-shiftmapping-calview"!==AttendanceShift.LayoutId||AttendanceShift.isHoursListView){nav=1;isPre&&(nav=-1),AttendanceShift.getUserListView(nav)}else{AttendanceShift.userCalValue=null;var nav=1;isPre&&(nav=-1),AttendanceShift.getUserCalView(!1,nav)}$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_fromDate").attr("disabled",!1),$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_toDate").attr("disabled",!1)}$(AttendanceShift.LayoutId+" #ZPAtt_calFilter_period").select2("val",6)},toggleFilter:function(){$(AttendanceShift.LayoutId+" #ZPAtt_ShiftMapView_filter").hasClass("ZPFilsel")?($(AttendanceShift.LayoutId+" #ZPAtt_ShiftMapView_filter").removeClass("blu ZPFilsel"),$(AttendanceShift.LayoutId+" #ZPAtt_calFilters").attr("class","ZPFilMain"),$(AttendanceShift.LayoutId+" #ZPAtt_filterCloseButton").hide(),$("#page-wrapper").attr("class","Nbar2")):($(AttendanceShift.LayoutId+" #ZPAtt_ShiftMapView_filter").addClass("blu ZPFilsel"),$(AttendanceShift.LayoutId+" #ZPAtt_calFilters").attr("class","ZPFilMain TEbnd"),$(AttendanceShift.LayoutId+" #ZPAtt_filterCloseButton").show(),$("#page-wrapper").attr("class","Nbar2F"),$(AttendanceShift.LayoutId+" #ZPAtt_calFilters .col-md-2").children().length>5?($("#page-wrapper").attr("class","Nbar2F2"),$(AttendanceShift.LayoutId+" #ZPAtt_calFilters").attr("class","ZPFilMain TEbnd1")):($("#page-wrapper").attr("class","Nbar2F"),$(AttendanceShift.LayoutId+" #ZPAtt_calFilters").attr("class","ZPFilMain TEbnd")))},toggleShiftReqFilter:function(){Layout.Page.container.find("#ZPAtt_ShiftMapReqView_filter").hasClass("ZPFilsel")?(Layout.Page.container.find("#ZPAtt_ShiftMapReqView_filter").removeClass("blu ZPFilsel"),Layout.Page.container.find("#ZPAtt_ShiftMapFilters").attr("class","ZPFilMain"),Layout.Page.container.find("#ZPAtt_shiftRequestFilterCloseButton").hide(),$("#page-wrapper").attr("class","Nbar2"),"attendance-shiftmapping-shiftmaprequests"!==Layout.Page.pageId&&"attendance-shiftmapping-shiftmapapprovals"!==Layout.Page.pageId||$("#page-wrapper").attr("class","Nbar3")):(Layout.Page.container.find("#ZPAtt_ShiftMapReqView_filter").addClass("blu ZPFilsel"),Layout.Page.container.find("#ZPAtt_ShiftMapFilters").attr("class","ZPFilMain TEbnd"),Layout.Page.container.find("#ZPAtt_shiftRequestFilterCloseButton").show(),$("#page-wrapper").attr("class","Nbar2F"),"attendance-shiftmapping-shiftmaprequests"===Layout.Page.pageId||"attendance-shiftmapping-shiftmapapprovals"===Layout.Page.pageId?($("#page-wrapper").attr("class","Nbar2F THF-2F"),Layout.Page.container.find(" #ZPAtt_ShiftMapFilters").attr("class","ZPFilMain TEbnd")):Layout.Page.container.find(" #ZPAtt_ShiftMapFilters .col-md-2").children().length>5?($("#page-wrapper").attr("class","Nbar2F2"),Layout.Page.container.find("#ZPAtt_ShiftMapFilters").attr("class","ZPFilMain TEbnd1")):($("#page-wrapper").attr("class","Nbar2F"),Layout.Page.container.find(" #ZPAtt_ShiftMapFilters").attr("class","ZPFilMain TEbnd")))},toggleShiftReqFilterSearch:function(){-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftmaprequests")?AttendanceShift.getShiftMapRequest(!1,!0):AttendanceShift.getShiftMapApprovals(!1,!0),"/zp"===ZPeople.CONTEXT&&AttendanceShift.toggleShiftReqFilter()},fromNavigater:!1,getToggleSearch:function(){"#attendance-shiftmapping-calview"!==AttendanceShift.LayoutId||AttendanceShift.isHoursListView?-1!==AttendanceShift.LayoutId.indexOf("attendance-shiftmapping-calview")&&AttendanceShift.isHoursListView?(AttendanceShift.userHoursValue=null,AttendanceShift.getHoursListView()):(AttendanceShift.userListCurMonth=0,AttendanceShift.getUserListView()):(AttendanceShift.userCalValue=null,AttendanceShift.fromNavigater=!1,AttendanceShift.userCalCurMon=0,AttendanceShift.getUserCalView(!1)),"/zp"===ZPeople.CONTEXT&&AttendanceShift.toggleFilter()},toggleAddNewPopUp:function(show){if(AttendanceShift.cacheErecArr=void 0,AttendanceShift.cacheArr=void 0,AttendanceShift.applicableShifts=void 0,show){var shiftMapAddPopup=$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup");shiftMapAddPopup.off("hide.bs.modal").on("hide.bs.modal",function(){shiftMapAddPopup.find("#ZPAtt_updAttDivAssignShift").hide(),shiftMapAddPopup.find("#ZPAtt_updAttEntryOnShift")[0].checked=!0}),shiftMapAddPopup.find("#ZPAtt_popUpHeader_shiftDet").html(ZPI18N.getString("zp.associateuser")),shiftMapAddPopup.find("#ZPAtt_popUpContent_uShiftList #singleConflict").remove(),shiftMapAddPopup.find("#ZPAtt_popUpContent_uShiftList #ZPAtt_SMapEmptyLoc").remove(),shiftMapAddPopup.find("#ZPAtt_sNewPopupRecSave").text(ZPI18N.getString("zp.submit")),$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup div.modal-footer div").hide(),Layout.Page.container.find("#conflictPage tbody tr:not(:first)").remove(),Layout.Page.container.find("#ZPAtt_sNewPopupRecSave").off("click"),Layout.Page.container.find("#ZPAtt_userShiftList").is(":visible")||-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-calview")||-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftmaprequests")?(AttendanceShift.setUserList(Layout.Page.container.find("#pickUser")),Layout.Page.container.find("#pickUser").find("#pickListComp").find("#key_list").find("#zp_shared_list_Users").on("DOMSubtreeModified",AttendanceShift.clearSelShifts),Layout.Page.container.find("#pickUser").find("#pickListComp").find("#key_list").find("#zp_shared_list_Locations").on("DOMSubtreeModified",AttendanceShift.clearSelShifts),shiftMapAddPopup.find("#ZPAtt_empShiftMap_drop").select2("val",0).off("opening").on("opening",function(event){event.preventDefault(),event.stopPropagation(),AttendanceShift.getApplicableShifts()}),"inline"===shiftMapAddPopup.find("#key_list .clearfix").css("display")&&Layout.Page.container.find("#zp_shared_sub_list_header .btn").click(),shiftMapAddPopup.find("#shiftlist_fromdate").val(""),shiftMapAddPopup.find("#shiftlist_todate").val(""),shiftMapAddPopup.find("#ZPAtt_ShiftChangeReason").val(""),shiftMapAddPopup.find("#ZPAtt_sNewPopupRecSave").off("click"),shiftMapAddPopup.find("#ZPAtt_sNewPopupRecSave").on("click",function(){AttendanceShift.setUserBasedShift()}),shiftMapAddPopup.modal("show"),shiftMapAddPopup.off("hidden.bs.modal").on("hidden.bs.modal",function(){Layout.Page.container.find("#ZPAtt_updAttEntryOnShift")[0].checked=!0}),shiftMapAddPopup.find("#ZPAtt_shift_chooseAppr").hide(),shiftMapAddPopup.find("#emptyErrMsg").html(""),shiftMapAddPopup.find("#emptyErrMsg").removeClass("MB10"),isEmpChooseApp&&(shiftMapAddPopup.find("#ZPAtt_shift_approverId").parent().parent().show(),shiftMapAddPopup.find("#ZPAtt_shift_approverId").empty(),shiftMapAddPopup.find("#ZPAtt_shift_approverId").append(ZPeople.User.getEmployeeListFormatByType("option")),shiftMapAddPopup.find("#ZPAtt_shift_approverId").select2())):-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")&&Timetracker.schedulerReminderSettings.showCommonCodeForScheduleAndReminderAddPage(0)}else{if(-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation"))return void $(AttendanceShift.LayoutId+" #tssettings-addschdiv").modal("hide");$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup").modal("hide")}},clearSelShifts:function(){cont=$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup").find("#ZPAtt_empShiftMap_drop"),cont.children().remove(),$("#s2id_ZPAtt_empShiftMap_drop span").html("")},excludeFromList:function(obj){$(AttendanceShift.LayoutId+" #conflictPage tbody #"+$(obj).closest("span").attr("id").split("_")[1]).click(),0===$(AttendanceShift.LayoutId+" #zp_shared_sub_list_records").children().length&&$(AttendanceShift.LayoutId+" #ZPAtt_shiftMapAddPopup div.modal-footer div").remove()},convertTimePickValToMins:function(value){return 60*parseInt(value.split(":")[0])+parseInt(value.split(":")[1])},resetValuesOnShiftChange:function(){AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-calview"),AttendanceShift.resetFilterInputsForReload("#attendance-shiftmapping-listview"),AttendanceShift.userListValue=null,AttendanceShift.userCalValue=null,AttendanceShift.userHoursValue=null,Attendance.Settings.generalSettings=null,Attendance.resetForLoadData()},setShiftList:function(rdata){AttendanceShift.depLocShiftList.shiftlist=rdata.shiftlist,AttendanceShift.sortedIdList=rdata.sortedId,Shift.shiftList=rdata.shiftlist;var shiftOption="<option value=0>"+ZPI18N.getString("zp.selectshift")+"</option>",sOption="";for(var d_r_shiftId in AttendanceShift.dropDownShiftOption="",AttendanceShift.activeShiftlength=0,rdata.shiftlist)-1!==rdata.shiftlist[d_r_shiftId].select&&(AttendanceShift.activeShiftlength+=1,shiftOption+="<option value="+d_r_shiftId+">"+rdata.shiftlist[d_r_shiftId].shiftName+"</option>",sOption+="<option value="+d_r_shiftId+">"+rdata.shiftlist[d_r_shiftId].shiftName+"</option>",AttendanceShift.dropDownShiftOption+="<li onClick=\"AttendanceShift.changeShiftCalView($(this).attr('id'));\" id="+d_r_shiftId+"><a>"+rdata.shiftlist[d_r_shiftId].shiftName+"</a></li>");AttendanceShift.depLocShiftOptions.shiftOption=shiftOption,AttendanceShift.depLocShiftOptions.sOption=sOption,AttendanceShift.consShiftDetails()},getShiftRotationList:function(){var param={mode:"getShiftSchedule",conreqcsr:csrfToken};$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotation_myReqNameSort").hasClass("sort")||(param.isScheduleSortAsc=$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotation_myReqNameSort").hasClass("sort-u")),$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotation_myReqTimeSort").hasClass("sort")||(param.isDaySortAsc=$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotation_myReqTimeSort").hasClass("sort-u")),$.post("/AttendanceShiftAction.zp",param,function(rdata){AttendanceShift.shiftRotationList=rdata.list,AttendanceShift.consShiftRotation()})},shiftRotList:{},shiftRotRowCons:function(obj,isDelete,onValueChange,list){var shiftRot=$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotationBox"),opt=AttendanceShift.depLocShiftOptions.sOption,prevValues=shiftRot.children().find("select"),objParentIndex=null;if(obj&&(objParentIndex=$(obj).parent().closest(".row").index()),shiftRot.next().remove(),list)for(var i in shiftRot.empty(),list){var fromShift=list[i].split("_")[0],toShift=list[i].split("_")[1],row="<div class='row MB15 PR' id='ZPAtt_shiftRotRow_"+i+"'><div class='col-sm-5'><select class='table-select' onchange=AttendanceShift.shiftRotRowCons(this,false,true)>"+opt.toString()+"</select></div>";row+="<div class='col-sm-5'><label class='control-label to-label'>-</label><select class='table-select' onchange=AttendanceShift.shiftRotRowCons(this,false,true)>"+opt.toString()+"</select></div>",row+="<div class='addSelectIcon'>",1!==Object.keys(list).length&&(row+="<div class='IC-cls-fill S18 gry MR10 FL MT6 CP' onclick=AttendanceShift.shiftRotRowCons(this,true)></div>"),parseInt(i)===Object.keys(list).length-1&&AttendanceShift.activeShiftlength!==Object.keys(list).length&&(row+="<div class='IC-plus-fill S18 gry MR10 FL MT6 CP' onclick=AttendanceShift.shiftRotRowCons(this)></div>"),row+="</div></div>",shiftRot.append(row),$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotRow_"+i).find("select").eq(0).val(fromShift),$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotRow_"+i).find("select").eq(1).val(toShift),-1===opt.indexOf("value="+fromShift+">")&&$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotRow_"+i).find("select").eq(0).attr("deletedShiftFound",fromShift),-1===opt.indexOf("value="+toShift+">")&&$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotRow_"+i).find("select").eq(1).attr("deletedShiftFound",toShift)}else{if(AttendanceShift.activeShiftlength<2){shiftRot.empty();row="<div class='row MB15 PR'><div class='col-sm-6'><select class='table-select' disabled='true'>"+opt.toString()+"</select></div>";return row+="<div class='col-sm-6'><label class='control-label to-label'>-</label><select class='table-select' disabled='true'>"+opt.toString()+"</select></div></div>",shiftRot.append(row),shiftRot.parent().append("<p class='MT5 red S12'>"+ZPI18N.getString("zp.shiftnotrotatable")+"</p>"),void $(AttendanceShift.LayoutId+" #ZPAtt_shiftRotationBox select").select2()}var shiftRowLen=shiftRot.children().length;onValueChange||(shiftRowLen+=1,isDelete&&(shiftRowLen=shiftRot.children().length-1)),shiftRot.empty();for(var len=0;len<shiftRowLen;len++){row="<div class='row MB15 PR'><div class='col-sm-5'><select class='table-select' onchange=AttendanceShift.shiftRotRowCons(this,false,true)>"+opt.toString()+"</select></div>";if(row+="<div class='col-sm-5'><label class='control-label to-label'>-</label><select class='table-select' onchange=AttendanceShift.shiftRotRowCons(this,false,true)>"+opt.toString()+"</select></div>",row+="<div class='addSelectIcon'>",obj){1!==shiftRowLen&&(row+="<div class='IC-cls-fill S18 gry MR10 FL MT6 CP' onclick=AttendanceShift.shiftRotRowCons(this,true)></div>")}1!==AttendanceShift.activeShiftlength&&shiftRot.children().length!==AttendanceShift.activeShiftlength-1&&len===shiftRowLen-1&&(row+="<div class='IC-plus-fill S18 gry MR10 FL MT6 CP' onclick=AttendanceShift.shiftRotRowCons(this)></div></div></div>"),shiftRot.append(row)}}for(var select=shiftRot.children().find("select"),sel=0;sel<select.length;sel++){if(!list&&prevValues[0]&&prevValues.eq(sel)[0]){var prevSelval=sel;isDelete&&null!==objParentIndex&&parseInt(sel/2)>=objParentIndex&&(prevSelval=sel+2),select.eq(sel).val(prevValues.eq(prevSelval).val())}for(var selectVal=select.eq(sel).val(),selectIndex=select.eq(sel).parent().index(),selectRowIndex=select.eq(sel).closest(".row").index(),notCurrRow=shiftRot.children().not(":nth-child("+(selectRowIndex+1)+")"),notCurr=0;notCurr<notCurrRow.length;notCurr++)notCurrRow.eq(notCurr).find("select").eq(selectIndex).find("option[value="+selectVal+"]").remove();shiftRot.children().eq(selectRowIndex).children().not(":nth-child("+(selectIndex+1)+")").find("option[value="+selectVal+"]").remove()}if($(AttendanceShift.LayoutId+" #ZPAtt_shiftRotationBox select").select2(),list)for(var deletedShift=shiftRot.find("select[deletedShiftFound]"),del=0;del<deletedShift.length;del++){var shiftVal=shiftRot.find("select[deletedShiftFound]").eq(del).attr("deletedShiftFound");shiftRot.find("select[deletedShiftFound]").eq(del).parent().find(".select2-container a span").text(AttendanceShift.depLocShiftList.shiftlist[shiftVal].sName+"("+ZPI18N.getString("zp.deleted")+")"),shiftRot.find("select[deletedShiftFound]").eq(del).val(null)}},consShiftRotation:function(){var slist=AttendanceShift.shiftRotationList,tbody=$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotationBody");if(tbody.empty(),$.each(slist,function(index,data){var daysStat=[ZPI18N.getString("zp.sunday"),ZPI18N.getString("zp.monday"),ZPI18N.getString("zp.tuesday"),ZPI18N.getString("zp.wednesday"),ZPI18N.getString("zp.thursday"),ZPI18N.getString("zp.friday"),ZPI18N.getString("zp.saturday")],freqStatus=ZPI18N.getString("zp.daily"),freq=data.frequency,freqDay=data.day;1===freq?freqStatus="<a>"+daysStat[freqDay]+"</a> <span class='dgry'>"+ZPI18N.getString("zp.ofevery")+"</span> <span>"+ZPI18N.getString("zp.week")+"</span>":2===freq?freqStatus=31===freqDay?"<a>"+ZPI18N.getString("zp.schlastday")+"</a> <span class='dgry'>"+ZPI18N.getString("zp.ofevery")+"</span> <span>"+ZPI18N.getString("zp.month")+"</span>":"<a>"+freqDay+AttendanceShift.conLettersOfNumbers(freqDay+"")+"</a> <span class='dgry'>"+ZPI18N.getString("zp.ofevery")+"</span> <span>"+ZPI18N.getString("zp.month")+"</span>":3===freq&&(freqStatus="<a>"+daysStat[freqDay]+"</a>, <span class='dgry'>"+ZPI18N.getString("zp.onceintwoweeks")+"</span>");var td='<td class="CP" onclick=Timetracker.schedulerReminderSettings.showAutoScheduleModify(this,undefined,"5");>'+data.scheduleName+"</td><td>"+freqStatus+"</td><td>"+Calendar.minstotime(data.time%1440,!0)+"</td>";td+="<td class='text-right P0I'><div id='ZPAtt_ShiftRot_delAction' class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_ShiftRot_delConfirm')></i>",td+='<i class="IC-pen S14 gry FR MR15 CP" onclick=Timetracker.schedulerReminderSettings.showAutoScheduleModify(this,"0","5"); data-toggle="modal"></i></div>',td+="<div style='display:none' id='ZPAtt_ShiftRot_delConfirm'>",td+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_ShiftRot_delAction')>"+ZPI18N.getString("zp.cancel")+"</button>",td+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=AttendanceShift.deleteShiftSchedule('"+data.scheduleId+"');>"+ZPI18N.getString("zp.confirm")+"</button></div></td>";var tr="<tr id="+i+" class='ZPLRow'>";tr+=td,tr+="</tr>",(tr=$(tr)).data(data),tbody.append(tr)}),0===tbody.children().length){$(AttendanceShift.LayoutId+" #ZPAtt_ShiftRot_emptyRecInfo").fadeIn(200),$(AttendanceShift.LayoutId+" #ZPAtt_shiftRot").parent().hide();var empDiv=Layout.Page.container.find("#ZPAtt_ShiftRot_emptyRecInfo i");0===empDiv.children().length&&Attendance.noDataImg(8,"CR-at-schlr",empDiv.eq(0)),$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotation").removeClass("section")}else $(AttendanceShift.LayoutId+" #ZPAtt_ShiftRot_emptyRecInfo").hide(),$(AttendanceShift.LayoutId+" #ZPAtt_shiftRot").parent().fadeIn(200),$(AttendanceShift.LayoutId+" #ZPAtt_shiftRotation").attr("class","Scrcont section"),$(AttendanceShift.LayoutId+" #ZPAtt_shiftRot").parent().hasClass("tabcont")||ZPView.handleTablePosition()},shiftRotselValChange:function(){"0"===$("#"+Layout.Page.pageId+" #schDate").select2("val")?($("#"+Layout.Page.pageId+" #beforeCont").html(ZPI18N.getString("zp.shiftscheduleonday",[""])),$("#"+Layout.Page.pageId+" #scheduleDateCont").html(ZPI18N.getString("zp.day"))):($("#"+Layout.Page.pageId+" #beforeCont").html(ZPI18N.getString("zp.prior")),$("#"+Layout.Page.pageId+" #scheduleDateCont").html(ZPI18N.getString("zp.shiftscheduledate")))},deleteShiftSchedule:function(scheduleId){$.post("/AttendanceShiftAction.zp",{mode:"deleteShiftSchedule",scheduleId:scheduleId,conreqcsr:csrfToken},function(){AttendanceShift.getShiftRotationList()})},conLettersOfNumbers:function(numbers){var num=numbers[numbers.length-1];return"1"===num&&"11"!==numbers?"st":"2"===num&&"12"!==numbers?"nd":"3"===num&&"13"!==numbers?"rd":"Last Day"!==numbers?"th":""},frequencyOnChange:function(){if(-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")){$("#"+Layout.Page.pageId+" #s2id_tssettings-daymonthCycleAffected")[0]||$("#"+Layout.Page.pageId+" #tssettings-daymonthCycleAffected").select2(),$("#"+Layout.Page.pageId+" #s2id_tssettings-dayweekCycleAffected")[0]||$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").select2();var notesText,dateFormatUpp=dateFmt.toUpperCase();if("1"===$("#"+Layout.Page.pageId+" #tssettings-frequency").val()){if($("#"+Layout.Page.pageId+" #shiftScheduleDate").parent().hide(),$("#"+Layout.Page.pageId+" #tssettings-daymonthCycleAffected").parent().hide(),$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").parent().show(),$("#"+Layout.Page.pageId+" #scheduleDateBeforeCont").text(ZPI18N.getString("zp.from")),"0"===$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").val())$("#"+Layout.Page.pageId+" #scheduleDateAfterCont").text(" to "+$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").children().eq(6).text()+" "+ZPI18N.getString("zp.ofthefollowingweek"));else{var weekVal=parseInt($("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").val());$("#"+Layout.Page.pageId+" #scheduleDateAfterCont").text(ZPI18N.getString("zp.to").toLowerCase()+" "+$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").children().eq(weekVal-1).text()+" "+ZPI18N.getString("zp.ofthefollowingweek"))}var periodStartVal=parseInt($("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").val()),rotationVal=parseInt($("#"+Layout.Page.pageId+" #tssettings-dayweek").val()),periods=AttendanceShift.getShiftRotDateDet(periodStartVal,rotationVal,$("#"+Layout.Page.pageId+" #tssettings-frequency").val()),rotRunDay=$("#"+Layout.Page.pageId+" #tssettings-dayweek").prev().find("a span").text();(weekParamArr=[]).push("<b>"+moment(periods.rotation).format(dateFormatUpp)+" ("+rotRunDay+")</b>"),weekParamArr.push("<b>"+moment(periods.start).format(dateFormatUpp)+"</b>"),weekParamArr.push("<b>"+moment(periods.end).format(dateFormatUpp)+"</b>"),notesText=ZPI18N.getString("zp.shiftrotnotecont",weekParamArr)}else if("2"===$("#"+Layout.Page.pageId+" #tssettings-frequency").val()){$("#"+Layout.Page.pageId+" #shiftScheduleDate").parent().hide(),$("#"+Layout.Page.pageId+" #tssettings-daymonthCycleAffected").parent().show(),$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").parent().hide(),$("#"+Layout.Page.pageId+" #scheduleDateBeforeCont").text(ZPI18N.getString("zp.from"));var monthspanInp=$("#"+Layout.Page.pageId+" #tssettings-daymonthCycleAffected").prev().find("a span").text(),monthspanToInp=($("#"+Layout.Page.pageId+" #tssettings-daymonth").prev().find("a span").text(),parseInt(monthspanInp)-1);"1"===monthspanInp?monthspanToInp=ZPI18N.getString("zp.lastday"):"31"===$("#"+Layout.Page.pageId+" #tssettings-daymonthCycleAffected").val()&&(monthspanToInp="30"),$("#"+Layout.Page.pageId+" #scheduleDateAfterCont").text(ZPI18N.getString("zp.to").toLowerCase()+" "+monthspanToInp+AttendanceShift.conLettersOfNumbers(String(monthspanToInp))+" "+ZPI18N.getString("zp.ofthefollowingmonth"));periodStartVal=parseInt($("#"+Layout.Page.pageId+" #tssettings-daymonthCycleAffected").val()),rotationVal=parseInt($("#"+Layout.Page.pageId+" #tssettings-daymonth").val()),periods=AttendanceShift.getShiftRotDateDet(periodStartVal,rotationVal,$("#"+Layout.Page.pageId+" #tssettings-frequency").val());var monthParamArr=[];monthParamArr.push("<b>"+moment(periods.rotation).format(dateFormatUpp)+"</b>"),monthParamArr.push("<b>"+moment(periods.start).format(dateFormatUpp)+"</b>"),monthParamArr.push("<b>"+moment(periods.end).format(dateFormatUpp)+"</b>"),notesText=ZPI18N.getString("zp.shiftrotnotecont",monthParamArr)}else if("3"===$("#"+Layout.Page.pageId+" #tssettings-frequency").val()){if($("#"+Layout.Page.pageId+" #shiftScheduleDate").parent().hide(),$("#"+Layout.Page.pageId+" #tssettings-daymonthCycleAffected").parent().hide(),$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").parent().show(),$("#"+Layout.Page.pageId+" #scheduleDateBeforeCont").text(ZPI18N.getString("zp.from")),"0"===$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").val())$("#"+Layout.Page.pageId+" #scheduleDateAfterCont").text(" to "+$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").children().eq(6).text());else{weekVal=parseInt($("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").val());$("#"+Layout.Page.pageId+" #scheduleDateAfterCont").text(ZPI18N.getString("zp.to").toLowerCase()+" "+$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").children().eq(weekVal-1).text())}var weekParamArr;periodStartVal=parseInt($("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").val()),rotationVal=parseInt($("#"+Layout.Page.pageId+" #tssettings-dayweek").val()),periods=AttendanceShift.getShiftRotDateDet(periodStartVal,rotationVal,$("#"+Layout.Page.pageId+" #tssettings-frequency").val()),rotRunDay=$("#"+Layout.Page.pageId+" #tssettings-dayweek").prev().find("a span").text();(weekParamArr=[]).push("<b>"+moment(periods.rotation).format(dateFormatUpp)+" ("+rotRunDay+")</b>"),weekParamArr.push("<b>"+moment(periods.start).format(dateFormatUpp)+"</b>"),weekParamArr.push("<b>"+moment(periods.end).format(dateFormatUpp)+"</b>"),notesText=ZPI18N.getString("zp.shiftrotnotecont",weekParamArr)}else{$("#"+Layout.Page.pageId+" #shiftScheduleDate").parent().show(),$("#"+Layout.Page.pageId+" #tssettings-daymonthCycleAffected").parent().hide(),$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").parent().hide(),$("#"+Layout.Page.pageId+" #scheduleDateBeforeCont").text(ZPI18N.getString("zp.wfon")),$("#"+Layout.Page.pageId+" #scheduleDateAfterCont").text(AttendanceShift.conLettersOfNumbers($("#"+Layout.Page.pageId+" #shiftScheduleDate").val())+" "+ZPI18N.getString("zp.day"));var inpVal=ZPI18N.getString("zp.on").toLowerCase()+" <b>"+$("#"+Layout.Page.pageId+" #shiftScheduleDate").val()+AttendanceShift.conLettersOfNumbers($("#"+Layout.Page.pageId+" #shiftScheduleDate").val())+" "+ZPI18N.getString("zp.day")+"</b>";"0"===$("#"+Layout.Page.pageId+" #shiftScheduleDate").val()?inpVal="<b>"+ZPI18N.getString("zp.currentday").toLowerCase()+"</b>":"1"===$("#"+Layout.Page.pageId+" #shiftScheduleDate").val()&&(inpVal="<b>"+ZPI18N.getString("zp.nextday").toLowerCase()+"</b>"),notesText=ZPI18N.getString("zp.schedulerrundailyandshifteffective")+" "+inpVal}$("#"+Layout.Page.pageId+" #shiftSchedule-notemessage").html(notesText)}},getShiftRotDateDet:function(start,rotDay,frequency){var cur_date="";try{cur_date=new Date((new Date).toLocaleString("en-US",{timeZone:ZPeople.TIME.companyTimeZone}))}catch(e){cur_date=new Date}var atTime=$("#"+Layout.Page.pageId+" #tssettings-time").val();""===atTime&&(atTime="00:00");var hrs=atTime.split(/(\s+)/)[0],ampm=atTime.split(/(\s+)/)[2];ampm=void 0!==ampm?ampm.toLowerCase():"";var rot_date,s_date,e_date,time=Calendar.timetomins(hrs,0,ampm),period={};return rot_date=s_date=e_date=cur_date,"2"===frequency?(rot_date=new Date(cur_date),AttendanceShift.setDate(rot_date,rotDay),rot_date.setHours(0),rot_date.setMinutes(0),rot_date.setSeconds(0),rot_date.setMilliseconds(0),rot_date.setMinutes(time.tottime),cur_date.getTime()>rot_date.getTime()&&(rot_date.setMonth(cur_date.getMonth()+1),AttendanceShift.setDate(rot_date,rotDay)),s_date=new Date(rot_date),AttendanceShift.setDate(s_date,start),s_date.getDate()<rot_date.getDate()&&(31===start?(s_date.setDate(1).setMonth(s_date.getMonth()+1),AttendanceShift.setDate(s_date,rotDay)):s_date.setMonth(s_date.getMonth()+1)),e_date=new Date(s_date),1===start?AttendanceShift.setDate(e_date,31):(e_date.setMonth(e_date.getMonth()+1),e_date.setDate(e_date.getDate()-1))):"1"!==frequency&&"3"!==frequency||((rot_date=new Date(cur_date)).setDay(rotDay),rot_date.setHours(0),rot_date.setMinutes(0),rot_date.setSeconds(0),rot_date.setMilliseconds(0),rot_date.setMinutes(time.tottime),cur_date.getTime()>rot_date.getTime()&&rot_date.setDate(rot_date.getDate()+7),(s_date=new Date(rot_date)).setDay(start),s_date.getTime()<rot_date.getTime()&&s_date.setDate(s_date.getDate()+7),e_date=new Date(s_date),"3"===frequency?e_date.setDate(s_date.getDate()+13):e_date.setDate(s_date.getDate()+6)),period.start=s_date,period.end=e_date,period.rotation=rot_date,period},setDate:function(date,day){31===day?date.setDate(new Date(date.getFullYear(),date.getMonth()+1,0).getDate()):date.setDate(day)},onShiftTypeChange:function(){var shiftWise=Layout.Page.container.find("input:radio[name=ZPAtt_Shift_Type]")[0].checked;Layout.Page.container.find("#ZPAtt_Shift_UserWiseImport_Note").removeClass("DN"),shiftWise?(Layout.Page.container.find("#ZPAtt_Shift_Shiftwise_Sample").removeClass("DN"),Layout.Page.container.find("#ZPAtt_Shift_Userwise_Sample").addClass("DN"),Layout.Page.container.find("#ZPAtt_Shift_UserWiseImport_Note").addClass("DN"),AttendanceShift.isUserShiftMapping=!1,AttendanceShift.hasPendingImportedFiles&&$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").parent().show()):(Layout.Page.container.find("#ZPAtt_Shift_Userwise_Sample").removeClass("DN"),Layout.Page.container.find("#ZPAtt_Shift_Shiftwise_Sample").addClass("DN"),$(AttendanceShift.LayoutId+" #ZPAtt_Shift_importMsg").parent().hide(),AttendanceShift.isUserShiftMapping=!0)},downloadSample:function(){var shiftType=0;Layout.Page.container.find("input:radio[name=ZPAtt_Shift_Type]")[1].checked&&(shiftType=1);var formObj=$("<form id='ZPLeave_exp_form' action='AttendanceShiftAction.zp?mode=import_template' method='post' target='exportresp1' style='display:none'/>").html("");formObj.append('<input type="hidden" value="'+csrfToken+'" name="conreqcsr"/>'),formObj.append('<input type="hidden" value="'+shiftType+'" name="shiftType"/>'),$("body").append(formObj),formObj.submit()},getShiftFilterValues:function(shiftFilter,param,isHoursView){if(isHoursView){var fromDate=shiftFilter.find("#ZPAtt_HoursView_Filter_fromDate").val().trim();if(""!==fromDate){moment(fromDate,AttendanceShift.depLocShiftList.dateformat.toUpperCase());param.sdate=fromDate}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.dateempty")),param.returned=!0}else{var startDate=shiftFilter.find("#ZPAtt_calFilter_fromDate"),endDate=shiftFilter.find("#ZPAtt_calFilter_toDate");if(startDate[0]&&""!==startDate.val().trim()&&(param.sdate=startDate.val().trim()),endDate[0]&&""!==endDate.val().trim()&&(param.edate=endDate.val().trim()),!param.sdate||!param.edate)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectfromandto")),void(param.returned=!0);var dateDiff=moment(param.edate,dateFmt.toUpperCase()).diff(moment(param.sdate,dateFmt.toUpperCase()),"days");dateDiff>31?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinonemonth")),param.isInValid=!1):dateDiff<0&&(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")),param.isInValid=!1)}shiftFilter.find("#ZPAtt_shiftlocation").val()&&0!=shiftFilter.find("#ZPAtt_shiftlocation").val().length&&(param.locId=JSON.stringify(shiftFilter.find("#ZPAtt_shiftlocation").val())),Attendance.organizationTag.isEnabled()&&shiftFilter.find("#ZPAtt_shiftorgTag").val()&&0!=shiftFilter.find("#ZPAtt_shiftorgTag").val().length&&(param.orgTagId=JSON.stringify(shiftFilter.find("#ZPAtt_shiftorgTag").val())),shiftFilter.find("#ZPAtt_shiftdepartment").val()&&0!=shiftFilter.find("#ZPAtt_shiftdepartment").val().length&&(param.depId=JSON.stringify(shiftFilter.find("#ZPAtt_shiftdepartment").val())),shiftFilter.find("#ZPAtt_shift_shiftName").val()&&0!=shiftFilter.find("#ZPAtt_shift_shiftName").val().length&&(param.shiftId=JSON.stringify(shiftFilter.find("#ZPAtt_shift_shiftName").val())),shiftFilter.find("#ZPAtt_userShiftMappingEmpName").val()&&0!=shiftFilter.find("#ZPAtt_userShiftMappingEmpName").val().length&&(param.userId=JSON.stringify(shiftFilter.find("#ZPAtt_userShiftMappingEmpName").val().split(",")));var entityObj=shiftFilter.find("#ZPAtt_shiftentity").val();entityObj&&0!=entityObj.length&&(param.entityId=JSON.stringify(entityObj));var bUnitObj=shiftFilter.find("#ZPAtt_shiftbusinessUnit").val();bUnitObj&&0!=bUnitObj.length&&(param.bUnitId=JSON.stringify(bUnitObj));var divisionObj=shiftFilter.find("#ZPAtt_shiftdivision").val();divisionObj&&0!=divisionObj.length&&(param.divisionId=JSON.stringify(divisionObj));var desgObj=shiftFilter.find("#ZPAtt_shiftdesg").val();desgObj&&0!=desgObj.length&&(param.desgId=JSON.stringify(desgObj)),shiftFilter.find("#ZPAtt_shiftDirectRepTo").prop("checked")&&(param.showDirectRepTo=!0)},enableFilters:function(layout){layout.find("#ZPAtt_location").attr("class","col-md-2"),Attendance.organizationTag.isEnabled()&&layout.find("#ZPAtt_orgTag").attr("class","col-md-2"),layout.find("#ZPAtt_department").attr("class","col-md-2"),layout.find("#ZPAtt_desg").attr("class","col-md-2"),layout.find("#ZPAtt_shift_sName").attr("class","col-md-2"),layout.find("#ZPAtt_entity").attr("class","col-md-2"),layout.find("#ZPAtt_businessUnit").attr("class","col-md-2"),layout.find("#ZPAtt_division").attr("class","col-md-2"),layout.find("#ZPAtt_empName").attr("class","col-md-2")},removeOrgStructFilter:function(layout,remove){if(remove||!ZPeople.orgStructureTagMap.entity)layout.find("#ZPAtt_entity").remove();else{var legalEntityDisplayName=ZPeople.orgStructureDispNameMap&&ZPeople.orgStructureDispNameMap.entity?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname");layout.find("#ZPAtt_shiftentityLabel").html(legalEntityDisplayName)}if(remove||!ZPeople.orgStructureTagMap.unit)layout.find("#ZPAtt_businessUnit").remove();else{var businessUnitDisplayName=ZPeople.orgStructureDispNameMap&&ZPeople.orgStructureDispNameMap.unit?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.addbusinessunit");layout.find("#ZPAtt_shiftbusinessUnitLabel").html(businessUnitDisplayName)}if(remove||!ZPeople.orgStructureTagMap.division)layout.find("#ZPAtt_division").remove();else{var divisionDisplayName=ZPeople.orgStructureDispNameMap&&ZPeople.orgStructureDispNameMap.division?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname");layout.find("#ZPAtt_shiftdivisionLabel").html(divisionDisplayName)}},toggleStatWkndConfig:function(obj){var ele=$(obj),chbxMainEle=ele.closest(".form-group"),selectOptions=AttendanceShift.getStatWkndOptions();ele.closest(".blkCheckbox").next().addClass("DNI"),""!==selectOptions?ele.prop("checked")?chbxMainEle.next()[0]?AttendanceShift.showHideCustName(chbxMainEle,!1):AttendanceShift.buildStatWkndConfig(void 0,ele):AttendanceShift.showHideCustName(chbxMainEle,!0):AttendanceShift.removeElementsAndShowErr()},removeElementsAndShowErr:function(){var layout=Layout.Page.container;layout.find("#enableStatWknd").prop("checked",!1),layout.find("#noWkndsChosen").removeClass("DNI"),AttendanceShift.showHideCustName(layout.find("#enableStatWknd").closest(".form-group"),!0)},showHideCustName:function(chbxMainEle,isAddClass){isAddClass?(chbxMainEle.next().addClass("DNI"),chbxMainEle.next().next().addClass("DNI"),chbxMainEle.next().next().next().addClass("DNI")):(chbxMainEle.next().removeClass("DNI"),chbxMainEle.next().next().removeClass("DNI"),chbxMainEle.next().next().next().removeClass("DNI"))},buildStatWkndConfig:function(data,ele){var selectHtml='<div class="form-group"><label class="col-sm-3 control-label">'+ZPI18N.getString("zp.statweekend");selectHtml+='</label><div class="col-sm-3"><select class="W300" multiple="multiple" id="selectedStatWknds">';var chkbxErrMsg=ele.closest(".blkCheckbox").next();chkbxErrMsg.addClass("DNI");var selectOptions=AttendanceShift.getStatWkndOptions(data);if(""===selectOptions)return ele.prop("checked",!1),void chkbxErrMsg.removeClass("DNI");selectHtml+=selectOptions,selectHtml+='</select><div class="error-msg DNI" id="noStatWkndsChosen">'+ZPI18N.getString("zp.nostatwkndschosen")+"</div></div></div>";var appendableEle=ele.closest(".form-group");if(appendableEle.after(selectHtml),(appendableEle=appendableEle.next()).find("select[multiple='multiple']").select2({minimumResultsForSearch:5,closeOnSelect:!1}),data){for(var intStatWknds=[],statWknds=data.statWknds.split(","),index=0;index<statWknds.length;index++)intStatWknds.push(parseInt(statWknds[index]));appendableEle.find("select[multiple='multiple']").select2("val",intStatWknds),ele.prop("checked",!0)}},getStatWkndOptions:function(data){var selectHtmlOptns="";if(data)for(var dayDet=data.getNwDays,index=0;index<7;index++){(singleDayDet=dayDet[index]).isNone||(selectHtmlOptns+='<option value="'+index+'">'+singleDayDet.dispDay+"</option>")}else{var current=Leave.Settings.Calendar.constructWknds(Layout.Page.container.find("#dvWeekdef tbody tr")),keys=Object.keys(current),dayNames=[];dayNames.push(ZPI18N.getString("zp.sunday")),dayNames.push(ZPI18N.getString("zp.monday")),dayNames.push(ZPI18N.getString("zp.tuesday")),dayNames.push(ZPI18N.getString("zp.wednesday")),dayNames.push(ZPI18N.getString("zp.thursday")),dayNames.push(ZPI18N.getString("zp.firday")),dayNames.push(ZPI18N.getString("zp.saturday"));for(index=0;index<7;index++){var singleDayDet;"None"!==(singleDayDet=current[keys[index]])&&(selectHtmlOptns+='<option value="'+index+'">'+dayNames[index]+"</option>")}}return selectHtmlOptns},removeAddStatWkndsOnWkndChng:function(tr){var layout=Layout.Page.container,nthDay=layout.find("#dvWeekdef ."+tr.attr("class")).index(),noOfEleSel=tr.find(":checked").length,selectedStatWknds=layout.find("#selectedStatWknds");if(selectedStatWknds[0])if(noOfEleSel>0&&!selectedStatWknds.find('option[value="'+nthDay+'"]')[0]){var option='<option value="'+nthDay+'">'+tr.find(".weekDayname").text()+"</option>";selectedStatWknds.find("option")[0]?selectedStatWknds.find("option").eq(selectedStatWknds.find("option").length-1).after(option):selectedStatWknds.append(option)}else if(0===noOfEleSel){var selVal=selectedStatWknds.val();if(selVal&&selVal.includes(nthDay.toString())){selVal.splice(selVal.indexOf(nthDay.toString()),1);var nextValToSel=selVal.map(Number);selectedStatWknds.select2("val",nextValToSel)}selectedStatWknds.find('option[value="'+nthDay+'"]')[0]&&selectedStatWknds.find('option[value="'+nthDay+'"]').remove()}}},Attendance.Break={CURR_MANUAL_BREAK:[],CURR_AUTO_BREAK:[],CURR_AUTO_BREAKTIME:void 0,IS_OLD_AUTO_BREAK:!1,MANUAL_BREAK_NO:0,init:function(){var cont=Layout.Page.container;cont.find("select[multiple='multiple']").select2({minimumResultsForSearch:5,closeOnSelect:!1}),cont.find("select").select2({minimumResultsForSearch:5}),cont.find("[data-toggle=tooltip]").tooltip({trigger:"click"}),AttendanceShift.getDepLocShiftList(),cont.find("#ZPAtt_breakTime").timepicker({defaultTime:"",showMeridian:!1,disableMousewheel:!0,minuteStep:1}).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>600&&$(this).timepicker("setTime","10:00")}),Attendance.Break.convertToTimepicker(cont.find(".ZPAtt_breakFromTime")),Attendance.Break.convertToTimepicker(cont.find(".ZPAtt_breakToTime")),cont.find("#ZPAtt_sNewPopupRecSave").off("click").on("click",function(){Attendance.Break.addShiftBreak(cont.find("#ZPAtt_shiftBreakConfAddPopup").attr("breakId"))}),cont.find("#ZPAtt_shiftBreakConfAddPopup [removeerr='true']").off("focus").on("focus",function(){Attendance.Break.hideAllBreakErrTexts()}),cont.find("#ZPAtt_breakAppShift").off("change").on("change",function(){Attendance.Break.hideAllBreakErrTexts()}),$("#ZPAtt_isBreakSystemCalc").find("label"),$(cont.find("#ZPAtt_isBreakSystemCalc").find("label")[0]).attr("data-original-title",ZPI18N.getString("zp.allowsystembreaktooltip")),cont.popover({selector:"[data-popover].popHover",trigger:"click hover",delay:{show:50,hide:50}})},convertToTimepicker:function(cont){cont.timepicker({defaultTime:"",showMeridian:Attendance.timeFormatIs12hr,disableMousewheel:!0,minuteStep:1})},consBreakPage:function(){var cont=Layout.Page.container;cont.find("#ZPAtt_Break_filter").hasClass("ZPFilsel")&&Attendance.Break.toggleBreakFilter(),Attendance.Break.breakDetails||(cont.find("#ZPAtt_BreakFilterShift").append(AttendanceShift.depLocShiftOptions.shiftOption),Attendance.Break.getBreakDetails())},scrollBreakIndex:0,onBreakScroll:function(){if(Attendance.Break.isShiftBreak()){if(Attendance.Break.breakDetails.breakList.breakDetailsArr.length%20==0){var scrollObj={isScroll:!0};Attendance.Break.scrollBreakIndex+=20,Attendance.Break.getBreakDetails(scrollObj)}}else Timetracker.Break.isTTBreakPage()&&Timetracker.Break.onBreakScroll()},getBreakDetails:function(filterData,obj){var param={},isFromScroll=filterData&&filterData.isScroll;filterData&&!isFromScroll?param=filterData:isFromScroll&&(param=Attendance.Break.getBreakFilterData(Attendance.Break.getSortBreakData()),Attendance.Break.isShiftBreak()?param.scrollIndex=Attendance.Break.scrollBreakIndex+1:Timetracker.Break.isShiftBreak()&&(param.scrollIndex=Timetracker.Break.scrollBreakIndex+1)),param.mode="getBreakDetails",param[csrfParamName]=csrfToken,isFromScroll||(Attendance.Break.isShiftBreak()?Attendance.Break.scrollBreakIndex=0:Timetracker.Break.isTTBreakPage()&&(Timetracker.Break.scrollBreakIndex=0),Layout.Page.container.find("#ZPAtt_shiftBreakConf .table-responsive").scrollTop(0),Attendance.Break.emptyBreakContainer(obj));var reqUrl=Attendance.Break.getReqUrl();Timetracker.Break.isTTBreakPage()&&Timetracker.Break.updateBreakParams(param),$.post(reqUrl,param,function(rdata){if(rdata.error)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")),void Attendance.Break.appendLoader(Layout.Page.container.find("#ZPAtt_shiftBreakDetails").parent(),!1);if(isFromScroll)for(var index in 20===rdata.breakList.breakDetailsArr.length&&ZPeople.FireScroll.reset(),rdata.breakList.breakDetailsArr)Attendance.Break.isShiftBreak()?Attendance.Break.breakDetails.breakList.breakDetailsArr.push(rdata.breakList.breakDetailsArr[index]):Timetracker.Break.isTTBreakPage()&&Timetracker.Break.breakDetails.breakList.breakDetailsArr.push(rdata.breakList.breakDetailsArr[index]);else ZPeople.FireScroll.reset(),Attendance.Break.isShiftBreak()?Attendance.Break.breakDetails=rdata:Timetracker.Break.isTTBreakPage()&&(Timetracker.Break.breakDetails=rdata);Attendance.Break.consShiftBreakDetails(rdata,isFromScroll)})},consShiftBreakDetails:function(rdata,isFromScroll){Attendance.Break.appendLoader(Layout.Page.container.find("#ZPAtt_shiftBreakDetails").parent(),!1);var breakDetailsArr=rdata.breakList.breakDetailsArr;if(breakDetailsArr){var emptyMsg=Layout.Page.container.find("#ZPAtt_ShiftBreak_emptyRecInfo");if(!isFromScroll&&0==breakDetailsArr.length)return $(emptyMsg).prev().hide(),$(emptyMsg).show(),void(0===emptyMsg.find("i").eq(0).children().length&&Attendance.noDataImg(8,"CR-nodata",emptyMsg.find("i").eq(0)));Layout.Page.container.find("#ZPAtt_shiftBreakDetails").show(),$(emptyMsg).prev().show(),$(emptyMsg).hide();var tableBody=Layout.Page.container.find("#ZPAtt_shiftBreakDetailsBody");for(var index in breakDetailsArr){var breakObj=breakDetailsArr[index],breakId=breakObj.breakId,breakName=breakObj.breakName,breakTiming=Attendance.disHours(breakObj.breakTimeInMins,!0),breakResFromToTime=breakObj.breakResFromToTime,breakPayType=1==breakObj.breakPayType?ZPI18N.getString("zp.leavetype.paid"):ZPI18N.getString("zp.leavetype.unpaid"),breakUsageType=breakObj.isBreakAutoDeduct?ZPI18N.getString("zp.automatic"):ZPI18N.getString("zp.manual"),breakRow="";Attendance.Break.isShiftBreak()?breakRow='<tr id="'+breakId+'" class="ZPLRow"><td class="dropdown" onclick="Attendance.ShiftDetails.appendShiftColors(this,true)"><div aria-expanded="false"':Timetracker.Break.isTTBreakPage()&&(breakRow='<tr id="'+breakId+'" class="ZPLRow"><td class="dropdown"><div aria-expanded="false"'),breakRow+=' data-toggle="dropdown" class="ZPLtyp LC'+breakObj.breakColorCode+'"></div><span class="CP" ',breakRow+='onclick=Attendance.Break.toggleBreakPopUp(true,"'+breakId+'")>'+breakName+"</span></td>",breakRow+="<td><span>"+breakTiming+"</span></td>",breakRow+='<td><div class="alwd_dur">',breakRow+=Attendance.Break.constructBreakPop(breakResFromToTime,index),breakRow+="</td></div>",breakRow+="<td><span>"+breakPayType+"</span></td><td><span>"+breakUsageType+"</span></td>",breakRow+='<td><div class="btnactive"><input onclick=Attendance.Break.disableBreak(this,"'+breakId+'") class="cmn-toggle-small cmn-toggle-round-small" id="breakDisable_'+breakId+'" ',breakObj.isDisabled||(breakRow+='checked="" '),breakRow+='type="checkbox"><label class="M0" for="breakDisable_'+breakId+'"></label></div></td>',breakRow+='<td class="text-right P0I"><div id="ZPAtt_ShiftBreak_delAction" class="over-display">',breakRow+='<i class="IC-delete S14 gry FR MR15 CP" onclick=Attendance.Break.deleteBreakPopup(this)></i><i class="IC-pen S14 gry FR MR15 CP" data-toggle="modal" onclick=Attendance.Break.toggleBreakPopUp(true,"'+breakId+'")></i></div>',breakRow+="</td><td></td></tr>",tableBody.append(breakRow);var cont=Layout.Page.container;0!=cont.find("#breakPopOvr_"+index).length&&(cont.find("#breakPopOvr_"+index).attr("data-content",Attendance.Break.getBreakTimingPop(breakResFromToTime)),$(cont.find("#breakPopOvr_"+index)[0]).position().top+30>=$("#ZPAtt_shiftBreakConf").height()&&cont.find("#breakPopOvr_"+index).attr("data-placement","top"))}}},constructBreakPop:function(breakResFromToTime,index){var breakRow="";if(void 0!=breakResFromToTime&&0!=breakResFromToTime.length){var len=breakResFromToTime.length;if(len<3)for(var it=0;it<len;it++)breakRow+=' <span class="alwd_tg">'+Attendance.disTime(breakResFromToTime[it].fromTime)+" - "+Attendance.disTime(breakResFromToTime[it].toTime)+"</span>";else breakRow+=' <span class="alwd_tg">'+Attendance.disTime(breakResFromToTime[0].fromTime)+" - "+Attendance.disTime(breakResFromToTime[0].toTime)+"</span>",breakRow+=' <span class="alwd_tg">'+Attendance.disTime(breakResFromToTime[1].fromTime)+" - "+Attendance.disTime(breakResFromToTime[1].toTime)+"</span>",breakRow+='<span class="alwd_tg popHover" id="breakPopOvr_'+index+'" data-popover="true" data-html="true" data-placement="bottom" data-content data-original-title="" title=""> +'+(len-2)+" </span>"}return breakRow},getBreakTimingPop:function(breakResFromToTime){var breakDiv="";if(void 0!=breakResFromToTime&&0!=len){var len=breakResFromToTime.length;breakDiv+="<h5>"+ZPI18N.getString("zp.allowedtiming")+"</h5>";for(var it=0;it<len;it++)breakDiv+='<div class="alwd_tg"> <span>'+Attendance.disTime(breakResFromToTime[it].fromTime)+"</span> - <span>"+Attendance.disTime(breakResFromToTime[it].toTime)+"</span></div>"}return breakDiv},disableBreak:function(obj,breakId){var param={mode:"toggleBreakStatus"};param[csrfParamName]=csrfToken,param.breakId=breakId;var reqUrl=Attendance.Break.getReqUrl();$.post(reqUrl,param,function(rdata){if(Timetracker.Break.isTTBreakPage()&&0===(rdata.hasOwnProperty("res")?rdata.res:1))return void Timetracker.Break.displayBreakErrorMessages(rdata);var successMsg=$(obj).is(":checked")?ZPI18N.getString("zp.enablesuccessful"):ZPI18N.getString("zp.disablesuccessful");ZPeople.Message.showSuccessMsg(successMsg)})},deleteBreakPopup:function(obj){var popup=$("#confirmationPopup");popup.modal({backdrop:"static",keyboard:!1});var popupConf=$("#confirmConfirmationPopup"),popupCancel=$("#cancelConfirmationPopup");popupConf.removeClass("btn-primary").addClass("btn-danger"),popupConf.html("").append(ZPI18N.getString("zp.delete")),Timetracker.Break.isTTBreakPage()?$("#textConfirmationPopupBody").html(ZPI18N.getString("zp.tsdeletebreak")):$("#textConfirmationPopupBody").html(ZPI18N.getString("zp.deletebreak")),popupConf.off("click"),popupCancel.off("click"),popupConf.on("click",function(event){Attendance.Break.deleteBreak(obj)}),popupCancel.on("click",function(event){popup.modal("hide")})},deleteBreak:function(obj){var param={mode:"deleteBreak"};param[csrfParamName]=csrfToken,param.breakId=$(obj).closest("tr").attr("id");var reqUrl=Attendance.Break.getReqUrl();$.post(reqUrl,param,function(rdata){if(rdata.error)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess"));else{if(Timetracker.Break.isTTBreakPage())if(0===(rdata.hasOwnProperty("res")?rdata.res:1))return void Timetracker.Break.displayBreakErrorMessages(rdata);var arr=null;Attendance.Break.isShiftBreak()?arr=Attendance.Break.breakDetails.breakList.breakDetailsArr:Timetracker.Break.isTTBreakPage()&&(arr=Timetracker.Break.breakDetails.breakList.breakDetailsArr);for(var n=arr.length,i=0;i<n;i++)if(arr[i].breakId==param.breakId){arr.splice(i,1);break}$(obj).closest("tr").fadeOut("fast",function(){$(obj).closest("tr").remove()})}})},breakModeChange:function(setAutoMins,fromEditBrk){var container=Layout.Page.container,breakObj={},isSystemCalc=container.find("#ZPAtt_isBreakSystemCalc"),isAutobreak=container.find("[name=ZPAtt_breakMode]")[0].checked;isSystemCalc.show(),container.find("#breakFromLabel").html(ZPI18N.getString("zp.starttime")),container.find("#breakToLabel").html(ZPI18N.getString("zp.endtime")),breakObj.isBreakAutoDeduct=isAutobreak,$(container.find("#ZPAtt_breakFromTimeErr1")[0]).hide(),container.find("#ZPAtt_breakFromTimeErr").hide(),isAutobreak?(breakObj.breakResFromToTime=Attendance.Break.CURR_AUTO_BREAK,isSystemCalc.hide(),container.find("#breakFromLabel").html("<font>"+ZPI18N.getString("zp.starttime")+"</font>"),container.find("#breakToLabel").html("<font>"+ZPI18N.getString("zp.endtime")+"</font>"),container.find("#breakDurationDiv").addClass("DN")):(breakObj.breakResFromToTime=Attendance.Break.CURR_MANUAL_BREAK,container.find("#breakDurationDiv").removeClass("DN")),fromEditBrk||Attendance.Break.fillBreakFromTo(breakObj),Attendance.Break.breakDurationChange(setAutoMins,void 0,isAutobreak)},createNewBreakFromToDiv:function(cont,isAutobreak){var html=Attendance.Break.getNewBreakHtml(isAutobreak);cont.after(html);var breakDiv=cont.next();return Attendance.Break.convertToTimepicker(breakDiv.find(".ZPAtt_breakFromTime")),Attendance.Break.convertToTimepicker(breakDiv.find(".ZPAtt_breakToTime")),breakDiv},breakDurationChange:function(setAutoMins,cont,isAutoBreak){if((cont=Layout.Page.container).find("[name=ZPAtt_breakMode]")[0].checked){var fromTime=cont.find(".ZPAtt_breakFromTime").val().trim(),toTime=cont.find(".ZPAtt_breakToTime").val().trim();if(cont.find("#auto_Time").html(""),""!==fromTime&&""!==toTime){var ftime=Attendance.Common.convertTimerInputToMinsOrSecs(fromTime,!1,!Attendance.timeFormatIs12hr),ttime=Attendance.Common.convertTimerInputToMinsOrSecs(toTime,!1,!Attendance.timeFormatIs12hr),tmins=ttime-ftime;tmins=(tmins=tmins<0?tmins+1440:tmins)>600?600:tmins,cont.find("#auto_Time").removeClass("DN").html(Attendance.disHours(tmins,!0));var temp={};temp.fromTime=ftime,temp.toTime=ttime,Attendance.Break.CURR_AUTO_BREAK[0]=temp}else void 0!=Attendance.Break.CURR_AUTO_BREAKTIME&&Attendance.Break.IS_OLD_AUTO_BREAK&&cont.find("#auto_Time").removeClass("DN").html(Attendance.disHours(Attendance.Break.CURR_AUTO_BREAKTIME,!0))}else Attendance.Break.iterateAddBreakFromTo(Layout.Page.container.find('[rel="breakFromTo"]'))},iterateAddBreakFromTo:function(arr){var cont=Layout.Page.container,len=arr.length,isSysDetect=!1;Attendance.Break.CURR_MANUAL_BREAK=[],Attendance.Break.MANUAL_BREAK_NO=0;for(var cnt=0,ind=0;ind<len;ind++){var breakFromTo=$(arr[ind]),temp={},fromTime=breakFromTo.find(".ZPAtt_breakFromTime").val().trim(),toTime=breakFromTo.find(".ZPAtt_breakToTime").val().trim();if(Attendance.Break.MANUAL_BREAK_NO++,""!==fromTime&&""!==toTime){isSysDetect=!0;var ftime=Attendance.Common.convertTimerInputToMinsOrSecs(fromTime,!1,!Attendance.timeFormatIs12hr),ttime=Attendance.Common.convertTimerInputToMinsOrSecs(toTime,!1,!Attendance.timeFormatIs12hr),tmins=ttime-ftime;tmins=(tmins=tmins<0?tmins+1440:tmins)>600?600:tmins,temp.fromTime=ftime,temp.toTime=ttime,Attendance.Break.CURR_MANUAL_BREAK[cnt++]=temp}}var isBreakSysCalc=cont.find("#ZPAtt_isBreakSystemCalc");isSysDetect?(isBreakSysCalc.find("label").removeAttr("data-toggle"),isBreakSysCalc.find("label").removeClass("hidd"),$(isBreakSysCalc.find("input[type=checkbox]")[0]).removeAttr("disabled"),$(isBreakSysCalc.find("input[type=checkbox]")[0]).prop("checked",void 0!=Attendance.Break.IS_SYS_CALC&&Attendance.Break.IS_SYS_CALC)):(isBreakSysCalc.find("label").attr("data-toggle","tooltip"),isBreakSysCalc.find("label").addClass("hidd"),$(isBreakSysCalc.find("input[type=checkbox]")[0]).attr("disabled",!0),$(isBreakSysCalc.find("input[type=checkbox]")[0]).prop("checked",!1))},addShiftBreak:function(breakId){var param={mode:"addBreak"};if(param[csrfParamName]=csrfToken,Attendance.Break.hideAllBreakErrTexts(),"error"!=Attendance.Break.checkForBreakValidFields()){var breakTime,container=Layout.Page.container,breakName=container.find("#ZPAtt_newBreakName").val().trim(),breakColor=container.find("#breakColorSelector").find("div.sel").index()+1,breakImage=container.find("#breakImageSelector").find("div.active").index()+1,breakPayType=container.find("input:radio[name=ZPAtt_breakPayType]")[0].checked?1:0,isBreakAutoDeduct=container.find("input:radio[name=ZPAtt_breakMode]")[0].checked;breakTime=isBreakAutoDeduct?container.find("#auto_Time").html():container.find("#ZPAtt_breakTime").val();var breakTimeInMins=AttendanceShift.convertTimePickValToMins(breakTime),inputParam={};if(breakId){inputParam.breakId=breakId;var index=container.find("#ZPAtt_shiftBreakDetailsBody tr#"+breakId).index(),breakObj=null;Attendance.Break.isShiftBreak()?breakObj=Attendance.Break.breakDetails.breakList.breakDetailsArr[index]:Timetracker.Break.isTTBreakPage()&&(breakObj=Timetracker.Break.breakDetails.breakList.breakDetailsArr[index])}if(breakId&&breakObj.breakName==breakName||(inputParam.breakName=breakName),breakId&&breakObj.breakColorCode==breakColor||(inputParam.breakColor=breakColor),breakId&&breakObj.breakTimeInMins==breakTimeInMins||(inputParam.breakTime=breakTimeInMins),breakId&&breakObj.isBreakAutoDeduct==isBreakAutoDeduct||(inputParam.isBreakAutoDeduct=isBreakAutoDeduct),!isBreakAutoDeduct){var isBreakSystemCalc=$(container.find("#ZPAtt_isBreakSystemCalc").find("input[type=checkbox]")[0]).prop("checked");breakId&&breakObj.isBreakSystemCalc===isBreakSystemCalc||(inputParam.isBreakSystemCalc=isBreakSystemCalc)}breakId&&breakObj.breakPayType==breakPayType||(inputParam.breakPayType=breakPayType),breakId&&breakObj.breakImageCode==breakImage||(inputParam.breakImage=breakImage),Attendance.Break.isShiftBreak()?breakId&&Attendance.Break.isIdenticalArrays(container.find("#ZPAtt_breakAppShift").val(),breakObj.shiftApplicableList)||(inputParam.applicableShifts=container.find("#ZPAtt_breakAppShift").val()):Timetracker.Break.isTTBreakPage()&&(breakId&&Attendance.Break.isIdenticalArrays(container.find("#ZPAtt_breakAppLocations").val(),breakObj.applicableLocations)||(inputParam.applicableLocations=container.find("#ZPAtt_breakAppLocations").val()));var breakFromTo=Attendance.Break.constructBreakFromToArr(Layout.Page.container.find('[rel="breakFromTo"]'));if(!breakId||void 0!=breakFromTo&&!Attendance.Break.isIdenticalJSONArrays(breakFromTo,breakObj.breakResFromToTime)){var breakTimeFromTo=Attendance.Break.constructInputBrkFromTo(Layout.Page.container.find('[rel="breakFromTo"]'),breakObj,inputParam);if(inputParam.breakTime=breakTimeInMins,!breakTimeFromTo)return}if(1!=Object.keys(inputParam).length){var extraParams={};Attendance.Break.isShiftBreak()?param.applicableShifts||(extraParams.updatedAppShifts=Layout.Page.container.find("#ZPAtt_breakAppShift").val()):Timetracker.Break.isTTBreakPage()&&(param.applicableLocations||(extraParams.updatedAppLocations=Layout.Page.container.find("#ZPAtt_breakAppLocations").val())),param.breakTimeInMins||(extraParams.updatedBreakTimeInMins=breakTimeInMins),breakId&&!inputParam.restTimeInMins&&(extraParams.updatedRestTimeInMins=void 0!=breakObj.breakResFromToTime?breakObj.breakResFromToTime:[]),inputParam.extraParams=extraParams,param.inputParam=JSON.stringify(inputParam),Layout.Page.container.find("#ZPAtt_sNewPopupRecSave").prop("disabled",!0);var reqUrl=Attendance.Break.getReqUrl();$.post(reqUrl,param,function(rdata){Layout.Page.container.find("#ZPAtt_sNewPopupRecSave").prop("disabled",!1);var isEdit=!1,breakId=JSON.parse(param.inputParam).breakId;if(breakId&&(isEdit=!0),Attendance.Break.isShiftBreak()){if(rdata.error)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess"));if(rdata.errorObj&&(rdata.errorObj.errorTypes||rdata.errorObj.errorDetails))return void Attendance.Break.displayBreakErrMessages(rdata.errorObj)}else if(Timetracker.Break.isTTBreakPage()){if(0===(rdata.hasOwnProperty("res")?rdata.res:1))return void Timetracker.Break.displayBreakErrorMessages(rdata)}if(rdata.resultObj){var breakResObj={};if(isEdit){var arr=null;Attendance.Break.isShiftBreak()?arr=Attendance.Break.breakDetails.breakList.breakDetailsArr:Timetracker.Break.isTTBreakPage()&&(arr=Timetracker.Break.breakDetails.breakList.breakDetailsArr);for(var n=arr.length,i=0;i<n;i++)if(arr[i].breakId==breakId){breakResObj=arr[i];break}}(breakObj=rdata.resultObj).breakId&&(breakResObj.breakId=breakObj.breakId?breakObj.breakId:""),breakObj.breakName&&(breakResObj.breakName=breakObj.breakName?breakObj.breakName:""),breakObj.breakColor&&(breakResObj.breakColor=breakObj.breakColor?breakObj.breakColor:void 0),breakObj.breakColorCode&&(breakResObj.breakColorCode=breakObj.breakColorCode?breakObj.breakColorCode:void 0),breakObj.breakImage&&(breakResObj.breakImage=breakObj.breakImage?breakObj.breakImage:void 0),breakObj.breakImageCode&&(breakResObj.breakImageCode=breakObj.breakImageCode?breakObj.breakImageCode:void 0),breakObj.breakTimeInMins&&(breakResObj.breakTimeInMins=breakObj.breakTimeInMins),void 0!=breakObj.isBreakSystemCalc&&(breakResObj.isBreakSystemCalc=breakObj.isBreakSystemCalc),void 0!=breakObj.isBreakAutoDeduct&&(breakResObj.isBreakAutoDeduct=breakObj.isBreakAutoDeduct),void 0!=breakObj.isDisabled&&(breakResObj.isDisabled=breakObj.isDisabled),void 0!=breakObj.isDeleted&&(breakResObj.isDeleted=breakObj.isDeleted),breakObj.breakResFromToTime&&(breakResObj.breakResFromToTime=breakObj.breakResFromToTime),Attendance.Break.isShiftBreak()?breakObj.shiftApplicableList&&(breakResObj.shiftApplicableList=breakObj.shiftApplicableList):Timetracker.Break.isTTBreakPage()&&breakObj.applicableLocations&&(breakResObj.applicableLocations=breakObj.applicableLocations),breakResObj.breakFrom="",breakResObj.breakTo="",breakObj.breakPayType&&(breakResObj.breakPayType=breakObj.breakPayType);var paytype=1==breakResObj.breakPayType?ZPI18N.getString("zp.leavetype.paid"):ZPI18N.getString("zp.leavetype.unpaid");breakObj.isBreakAutoDeduct&&(breakResObj.isBreakAutoDeduct=breakObj.isBreakAutoDeduct);var isBreakAuto=breakResObj.isBreakAutoDeduct?ZPI18N.getString("zp.automatic"):ZPI18N.getString("zp.manual"),breakMins=breakResObj.breakTimeInMins?Attendance.disHours(breakResObj.breakTimeInMins,!0):void 0,breakRow="";if(Attendance.Break.isShiftBreak()?breakRow='<tr id="'+breakResObj.breakId+'" class="ZPLRow"><td class="dropdown" onclick="Attendance.ShiftDetails.appendShiftColors(this,true)"><div aria-expanded="false"':Timetracker.Break.isTTBreakPage()&&(breakRow='<tr id="'+breakResObj.breakId+'" class="ZPLRow"><td class="dropdown"><div aria-expanded="false"'),breakRow+=' data-toggle="dropdown" class="ZPLtyp LC'+breakResObj.breakColorCode+'"></div><span class="CP" ',breakRow+='onclick=Attendance.Break.toggleBreakPopUp(true,"'+breakResObj.breakId+'")>'+breakResObj.breakName+"</span></td>",breakRow+="<td><span>"+breakMins+"</span></td>",breakRow+='<td><div class="alwd_dur">',breakRow+=Attendance.Break.constructBreakPop(breakResObj.breakResFromToTime,0),breakRow+="</td></div>",breakRow+="<td></span>"+paytype+"</span></td><td><span>"+isBreakAuto+"</span></td>",breakRow+='<td><div class="btnactive"><input onclick=Attendance.Break.disableBreak(this,"'+breakResObj.breakId+'") class="cmn-toggle-small cmn-toggle-round-small" id="breakDisable_'+breakResObj.breakId+'" ',breakResObj.isDisabled||(breakRow+='checked="" '),breakRow+='type="checkbox"><label class="M0" for="breakDisable_'+breakResObj.breakId+'"></label></div></td>',breakRow+='<td class="text-right P0I"><div id="ZPAtt_ShiftBreak_delAction" class="over-display">',breakRow+='<i class="IC-delete S14 gry FR MR15 CP" onclick=Attendance.Break.deleteBreakPopup(this)></i><i class="IC-pen S14 gry FR MR15 CP" data-toggle="modal" onclick=Attendance.Break.toggleBreakPopUp(true,"'+breakResObj.breakId+'")></i></div>',breakRow+="</td><td></td></tr>",isEdit)Layout.Page.container.find("#ZPAtt_shiftBreakDetailsBody").find("#"+breakId).replaceWith(breakRow);else{var cont=Layout.Page.container,breakNo=$(cont.find("#ZPAtt_shiftBreakDetailsBody")[0]).children("tr").length;cont.find("#ZPAtt_shiftBreakDetailsBody").append(breakRow),0==breakNo&&(cont.find("#ZPAtt_ShiftBreak_emptyRecInfo").hide(),cont.find("#ZPAtt_ShiftBreak_emptyRecInfo").prev().show(),cont.find("#ZPAtt_shiftBreakDetails").show()),Attendance.Break.isShiftBreak()?Attendance.Break.breakDetails.breakList.breakDetailsArr.push(breakObj):Timetracker.Break.isTTBreakPage()&&Timetracker.Break.breakDetails.breakList.breakDetailsArr.push(breakObj)}var breakObj=Layout.Page.container.find("#ZPAtt_shiftBreakDetailsBody").find("#"+breakResObj.breakId);0!=breakObj.find("#breakPopOvr_0").length&&(breakObj.find("#breakPopOvr_0").attr("data-content",Attendance.Break.getBreakTimingPop(breakResObj.breakResFromToTime)),$(breakObj.find("#breakPopOvr_0")[0]).position().top+30>=$("#ZPAtt_shiftBreakConf").height()&&breakObj.find("#breakPopOvr_0").attr("data-placement","top")),Attendance.Break.toggleBreakPopUp()}})}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.editanyfield"))}},removeBreakFromTo:function(curr){var breakFromTo=Layout.Page.container.find(curr.closest(".breakFromToDiv")),length=Layout.Page.container.find('[rel="breakFromTo"]').length;breakFromTo.index()==length&&breakFromTo.prev().find(".breakAdd").removeClass("DN"),breakFromTo.remove(),Attendance.Break.reduceManualBreakNumber();var relFromTo=Layout.Page.container.find('[rel="breakFromTo"]');1==(length=relFromTo.length)&&Layout.Page.container.find(relFromTo[0]).find(".breakRemove").addClass("DN"),Layout.Page.container.find(relFromTo[length-1]).find(".breakAdd").removeClass("DN"),Attendance.Break.iterateAddBreakFromTo(Layout.Page.container.find('[rel="breakFromTo"]'))},getNewBreakHtml:function(isAutomatic){var html='<div class="form-group breakFromToDiv" rel="breakFromTo">';return html+='<div class="zp-sm-4 PR0I">',html+='<div class="input-group bootstrap-timepicker timepicker" id="breakFromInputGrp">',html+='<input type="text" class="form-control ZPAtt_breakFromTime" name="from" onchange="Attendance.Break.breakDurationChange();">',html+='<span class="input-group-addon"><div class="IC-clock gry CP"></div>',html+="</span>",html+='</div><span class="ERR PL10 PT5 DN ZPAtt_breakFromTimeErr">Invalid time</span></div>',html+='<div class="zp-sm-4 zp-sm-offset-1 PL0I toDiv">',html+='<div class="input-group bootstrap-timepicker timepicker" id="breakToInputGrp">',html+='<input type="text" class="form-control ZPAtt_breakToTime" name="from" onchange="Attendance.Break.breakDurationChange();">',html+='<span class="input-group-addon"><div class="IC-clock gry CP"></div>',html+="</span>",html+="</div> </div>",isAutomatic&&(html+='<div class="zp-sm-1 P0I MT8">',html+='<label class="dgry DN" id="auto_Time"></label>',html+="</div>"),html+='<div class="zp-sm-1 P0I MT8">',html+='<i class="IC-cls-fill S14 gry MR5 CP breakRemove '+(isAutomatic?"DN":"")+'" onclick="Attendance.Break.removeBreakFromTo(this);"></i>',html+='<i class="IC-plus-fill S14 gry CP breakAdd '+(isAutomatic?"DN":"")+'" onclick="Attendance.Break.addNewBreakFromTo(this);"></i>',html+='</div><span class="ERR PL10 PT5 ZPAtt_breakFromTimeErr"></span></div>'},addNewBreakFromTo:function(curr){Layout.Page.container;var obj={isLast:!1};if(Attendance.Break.validateManualBreakNo(obj)){var breakFromTo=$(curr.closest(".breakFromToDiv"));breakFromTo.find(".breakAdd").addClass("DN"),breakFromTo.find(".breakRemove").removeClass("DN"),breakFromTo=Attendance.Break.createNewBreakFromToDiv(breakFromTo,!1),obj.isLast&&breakFromTo.find(".breakAdd").addClass("DN"),Attendance.Break.convertToTimepicker(breakFromTo.find(".ZPAtt_breakFromTime")),Attendance.Break.convertToTimepicker(breakFromTo.find(".ZPAtt_breakToTime")),Attendance.Break.MANUAL_BREAK_NO++}},checkForBreakValidFields:function(){var breakTime,cont=Layout.Page.container,status="success";""==cont.find("#ZPAtt_newBreakName").val().trim()&&(status="error",cont.find("#breakNameErr").html(ZPI18N.getString("zp.breaknameerr")).show());var isBreakAutoDeduct=cont.find("input:radio[name=ZPAtt_breakMode]")[0].checked;""!=(breakTime=isBreakAutoDeduct?cont.find("#auto_Time").html():cont.find("#ZPAtt_breakTime").val())&&0!=AttendanceShift.convertTimePickValToMins(breakTime)||(status="error",isBreakAutoDeduct?cont.find("#ZPAtt_breakFromTimeErr1").html(""==breakTime?ZPI18N.getString("zp.breakEmptyFromTo"):ZPI18N.getString("zp.breakValidFromTo")).show():cont.find("#breakTimeErr").show());return Attendance.Break.isShiftBreak()&&0===cont.find("#ZPAtt_breakAppShift").val().length?(status="error",cont.find("#breakAppShiftErr").show()):Timetracker.Break.isTTBreakPage()&&null==cont.find("#ZPAtt_breakAppLocations").val()&&(status="error",cont.find("#breakAppLocErr").show()),status=Attendance.Break.validateBreakFromTo(Layout.Page.container.find('[rel="breakFromTo"]'),status)},validateBreakFromTo:function(arr,status){for(var n=arr.length,i=0;i<n;i++){var breakFromToDiv=$(arr[i]),from=breakFromToDiv.find(".ZPAtt_breakFromTime").val().trim(),to=breakFromToDiv.find(".ZPAtt_breakToTime").val().trim();if(""==from&&""!=to||""!=from&&""==to){status="error",Layout.Page.container.find("#ZPAtt_breakFromTimeErr1").html(ZPI18N.getString("zp.breakEmptyFromTo")).show();break}}return status},displayBreakErrMessages:function(errorObj){var cont=Layout.Page.container;if(errorObj.errorTypes){var errorArr=errorObj.errorTypes;for(var index in errorArr){var error=errorArr[index];"breakNameEmpty"==error?cont.find("#breakNameErr").html(ZPI18N.getString("zp.breaknameerr")).show():"breakTimeInValid"==error?cont.find("#breakTimeErr").show():"applicableShiftsEmpty"==error?cont.find("#breakAppShiftErr").show():"restTimeError"==error?$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(ZPI18N.getString("zp.breakEmptyFromTo")).show():"intervalsBreakTimeMismatch"==error?$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(ZPI18N.getString("zp.breakDurationMisMatch",new Array(cont.find("#ZPAtt_breakTime").val()))).show():"intervalsBreakTimeExceeded"==error?$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(ZPI18N.getString("zp.breakFromToExceed")).show():"invalid From and To"==error?$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(ZPI18N.getString("zp.breakValidFromTo")).show():"manualBreakLimitExceeded"==error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.manualBreakNo",new Array(Attendance.Break.getManualBreakLimit()+""))):"autoBreakLimitExceeded"==error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.autoBreakNo")):"breakTimeCantBeMoreThan10Hr"==error&&$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(ZPI18N.getString("zp.durationlimit")).show()}}else{var errorDetails=errorObj.errorDetails;for(var errorKey in errorDetails){var errDets=errorDetails[errorKey];"breakCrossedShift"===errorKey?(Attendance.Break.iterateAndShowError("breakCrossedShift",errDets.existBreakFrom,errDets.existBreakTo),$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(ZPI18N.getString("zp.breaktimeexceeded",new Array(errDets.shiftName,errDets.shiftFrom,errDets.shiftTo))).show()):"breakOverlapsBreak"===errorKey?(Attendance.Break.iterateAndShowError("breakOverlapsBreak",errDets.existBreakFrom,errDets.existBreakTo),$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(ZPI18N.getString("zp.breaktimeoverlap",new Array(errDets.breakName,errDets.breakFrom,errDets.breakTo))).show()):"breakThresholdReachedForShift"===errorKey?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.breakLimitExceeded",new Array(Attendance.Break.getBreakLimitForShift()+"",errDets.shiftName))):"sameBreakOverlapped"===errorKey?(Attendance.Break.iterateAndShowError("breakOverlapsBreak",errDets.overlapBreakFrom,errDets.overlapBreakTo),$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(ZPI18N.getString("zp.sameBreakOverlaps",new Array(errDets.overlapFromTime,errDets.overlapToTime))).show()):"duplicateBreakforShift"===errorKey&&$(cont.find("#breakNameErr")).html(ZPI18N.getString("zp.breakdupnameerr",new Array(errDets.sName_encoded))).show()}}},iterateAndShowError:function(errorMsg,existFrom,existTo){for(var arr=Layout.Page.container.find('[rel="breakFromTo"]'),n=arr.length,i=0;i<n;i++){var breakFromToDiv=$(arr[i]),inputFrom=breakFromToDiv.find("#breakFromInputGrp"),inputTo=breakFromToDiv.find("#breakToInputGrp");inputFrom.removeClass("fadio"),inputTo.removeClass("fadio");var from=breakFromToDiv.find(".ZPAtt_breakFromTime").val().trim(),to=breakFromToDiv.find(".ZPAtt_breakToTime").val().trim();from=Attendance.Common.convertTimerInputToMinsOrSecs(from,!1,!Attendance.timeFormatIs12hr),to=Attendance.Common.convertTimerInputToMinsOrSecs(to,!1,!Attendance.timeFormatIs12hr),from==existFrom&&to==existTo&&(inputFrom.addClass("fadio"),inputTo.addClass("fadio"))}},iterateAndShowMultiError:function(errorMsg,existFromTo){for(var arr=Layout.Page.container.find('[rel="breakFromTo"]'),n=arr.length,i=0;i<n;i++){var breakFromToDiv=$(arr[i]),from=breakFromToDiv.find(".ZPAtt_breakFromTime").val().trim(),to=breakFromToDiv.find(".ZPAtt_breakToTime").val().trim(),inputFrom=breakFromToDiv.find("#breakFromInputGrp"),inputTo=breakFromToDiv.find("#breakToInputGrp");for(var ind in from=Attendance.Common.convertTimerInputToMinsOrSecs(from,!1,!Attendance.timeFormatIs12hr),to=Attendance.Common.convertTimerInputToMinsOrSecs(to,!1,!Attendance.timeFormatIs12hr),inputFrom.removeClass("fadio"),inputTo.removeClass("fadio"),existFromTo){var json=existFromTo[ind];json.existBreakFrom==from&&json.existBreakTo==to&&(inputFrom.addClass("fadio"),inputTo.addClass("fadio"))}}},changeBreakColor:function(obj){var breakId=$(obj).closest("tr").attr("id"),breakColor=$(obj).attr("class").split(" ")[0].slice(2),param={mode:"addBreak"};param[csrfParamName]=csrfToken;var inputParam={};inputParam.breakId=breakId,inputParam.breakColor=breakColor,param.inputParam=JSON.stringify(inputParam);var reqUrl=Attendance.Break.getReqUrl();$.post(reqUrl,param,function(rdata){if(rdata.error)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess"));else{if(Timetracker.Break.isTTBreakPage())if(0===(rdata.hasOwnProperty("res")?rdata.res:1))return void Timetracker.Break.displayBreakErrorMessages(rdata);ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.colorchanged"));var colorClass=["#f6f6f6","#fce0d9","#fcebd5","#fffcbb","#edfadb","#e6f3fd","#f1e9f8","#fbeaf4","#e5e5e5","#fac7ba","#fadbb3","#fef985","#def5be","#d2eafc","#e6d7f2","#f8d9eb"],index=Layout.Page.container.find("#ZPAtt_shiftBreakDetailsBody tr#"+breakId).index();Attendance.Break.isShiftBreak()?(Attendance.Break.breakDetails.breakList.breakDetailsArr[index].breakColorCode=breakColor,Attendance.Break.breakDetails.breakList.breakDetailsArr[index].breakColor=colorClass[breakColor-1]):Timetracker.Break.isTTBreakPage()&&(Timetracker.Break.breakDetails.breakList.breakDetailsArr[index].breakColorCode=breakColor,Timetracker.Break.breakDetails.breakList.breakDetailsArr[index].breakColor=colorClass[breakColor-1]),$(obj).closest("tr").find("td.dropdown div").eq(0).attr("class","ZPLtyp "+$(obj).attr("class"))}})},resetBreakPopUp:function(breakId){var cont=Layout.Page.container;if(Attendance.Break.hideAllBreakErrTexts(),cont.find("#ZPAtt_shiftBreakConfAddPopup").modal("show"),cont.find("#ZPAtt_shiftBreakConfAddPopup #ZPAtt_newBreakName").val(""),Attendance.Break.fillBreakImagePopup(),Attendance.Break.changeBreakImage(Layout.Page.container.find("#breakImageSelector div").length>0?Layout.Page.container.find("#breakImageSelector div").eq(0):void 0),cont.find("#ZPAtt_breakTime").timepicker("setTime",""),cont.find("input:radio[name=ZPAtt_breakPayType]")[0].checked=!0,cont.find("input:radio[name=ZPAtt_breakMode]")[0].checked=!0,cont.find("#ZPAtt_isBreakSystemCalc").closest("label").addClass("disabled"),cont.find("#ZPAtt_isBreakSystemCalc").prop("checked",!1),cont.find("#breakFromLabel").html(ZPI18N.getString("zp.starttime")),cont.find("#breakToLabel").html(ZPI18N.getString("zp.endtime")),cont.find("#ZPAtt_breakFromTime").timepicker("setTime",""),cont.find("#ZPAtt_breakToTime").timepicker("setTime",""),Attendance.Break.isShiftBreak())cont.find("#ZPAtt_breakAppShift").html("").append(AttendanceShift.depLocShiftOptions.sOption),cont.find("#ZPAtt_breakAppShift").val("").select2();else if(Timetracker.Break.isTTBreakPage()){var filterparam=Timetracker.Filters.getParamsForFilter("TTBreak");Timetracker.Location.constructLocationFilter("ZPAtt_breakAppLocations",filterparam)}},toggleBreakPopUp:function(show,breakId){var cont=Layout.Page.container;if(Attendance.Break.CURR_MANUAL_BREAK=[],Attendance.Break.CURR_AUTO_BREAK=[],Attendance.Break.CURR_AUTO_BREAKTIME=void 0,Attendance.Break.IS_OLD_AUTO_BREAK=!1,!show)return Attendance.Break.CURR_AUTO_BREAKTIME=void 0,void cont.find("#ZPAtt_shiftBreakConfAddPopup").modal("hide");if(Attendance.Break.resetBreakPopUp(breakId),Attendance.Break.breakPopupType="ADD_BREAK",Attendance.Break.popupBreakId=breakId,cont.find("#ZPAtt_breakPopupHeader").html(ZPI18N.getString("zp.addbreak")),breakId){Attendance.Break.breakPopupType="EDIT_BREAK",cont.find("#ZPAtt_breakPopupHeader").html(ZPI18N.getString("zp.editbreak"));var index=Layout.Page.container.find("#ZPAtt_shiftBreakDetailsBody tr#"+breakId).index(),breakObj=null;Attendance.Break.isShiftBreak()?breakObj=Attendance.Break.breakDetails.breakList.breakDetailsArr[index]:Timetracker.Break.isTTBreakPage()&&(breakObj=Timetracker.Break.breakDetails.breakList.breakDetailsArr[index]),Attendance.Break.changeBreakImage(Layout.Page.container.find("#breakImageSelector i."+breakObj.breakImage).parent()),cont.find("#ZPAtt_shiftBreakConfAddPopup #ZPAtt_newBreakName").val(decodeHTML(breakObj.breakName)),Attendance.Break.isShiftBreak()?cont.find("#ZPAtt_breakAppShift").val(breakObj.shiftApplicableList).select2():Timetracker.Break.isTTBreakPage()&&cont.find("#ZPAtt_breakAppLocations").val(breakObj.applicableLocations).select2(),0==breakObj.breakPayType&&(cont.find("input:radio[name=ZPAtt_breakPayType]")[1].checked=!0),breakObj.isBreakAutoDeduct||(cont.find("input:radio[name=ZPAtt_breakMode]")[1].checked=!0),Attendance.Break.IS_SYS_CALC=breakObj.isBreakSystemCalc,breakObj.isBreakSystemCalc&&$(cont.find("#ZPAtt_isBreakSystemCalc").find("input[type=checkbox]")[0]).prop("checked",!0),Attendance.Break.fillBreakFromTo(breakObj),cont.find("#ZPAtt_sNewPopupRecSave").off("click").on("click",function(){Attendance.Break.addShiftBreak(breakId)}),cont.find("#breakColorSelector").find("span").attr("class","LC"+breakObj.breakColorCode),cont.find("#breakColorSelector").find("div.sel").removeClass("sel"),cont.find("#breakColorSelector").find("div.LC"+breakObj.breakColorCode).addClass("sel");var breakMins=Attendance.disHours(breakObj.breakTimeInMins,!0);breakObj.isBreakAutoDeduct?(Attendance.Break.IS_OLD_AUTO_BREAK=void 0==breakObj.breakResFromToTime,Attendance.Break.CURR_AUTO_BREAKTIME=breakObj.breakTimeInMins,cont.find("#auto_Time").removeClass("DN").html(breakMins)):cont.find("#ZPAtt_breakTime").timepicker("setTime",breakMins),Attendance.Break.breakModeChange(!0,!0)}else Attendance.Break.IS_SYS_CALC=!1,cont.find("#breakColorSelector").find("span").attr("class","LC1"),cont.find("#breakColorSelector").find("div.sel").removeClass("sel"),cont.find("#breakColorSelector").find("div.LC1").addClass("sel"),cont.find("#breakFromLabel").html("<font>"+ZPI18N.getString("zp.starttime")+"</font>"),cont.find("#breakToLabel").html("<font>"+ZPI18N.getString("zp.endtime")+"</font>"),cont.find("#ZPAtt_sNewPopupRecSave").off("click").on("click",function(){Attendance.Break.addShiftBreak()}),Attendance.Break.breakModeChange()},fillBreakFromTo:function(breakObj){var container=Layout.Page.container,breakArr=breakObj.breakResFromToTime;container.find(".breakFromToDiv").remove();var cont=container.find("#breakFromTo"),isAutoBreak=breakObj.isBreakAutoDeduct,isBreakSysCalc=cont.find("#ZPAtt_isBreakSystemCalc");if(isBreakSysCalc.find("label").addClass("hidd"),$(isBreakSysCalc.find("input[type=checkbox]")[0]).attr("disabled",!0),$(isBreakSysCalc.find("input[type=checkbox]")[0]).prop("checked",!1),cont=container.find("#breakFromToHead"),void 0!=breakArr&&breakArr.length>0){for(var len=breakArr.length,i=0;i<len;i++){isAutoBreak||cont.find(".breakAdd").addClass("DN");var tempJson=breakArr[i],breakResFromTime=tempJson.fromTime,breakResToTime=tempJson.toTime;cont=Attendance.Break.createNewBreakFromToDiv(cont,isAutoBreak),void 0!=breakResFromTime&&breakResFromTime>=0&&(cont.find(".ZPAtt_breakFromTime").timepicker("setTime",Attendance.disTime(breakResFromTime)),cont.find(".ZPAtt_breakToTime").timepicker("setTime",Attendance.disTime(breakResToTime)),Attendance.Break.IS_SYS_CALC&&(isBreakSysCalc.find("label").removeClass("hidd"),$(isBreakSysCalc.find("input[type=checkbox]")[0]).prop("disabled",!1),$(isBreakSysCalc.find("input[type=checkbox]")[0]).prop("checked",!0)))}1!=len||cont.find(".breakRemove").hasClass("DN")||cont.find(".breakRemove").addClass("DN"),3!=len||cont.find(".breakAdd").hasClass("DN")||cont.find(".breakAdd").addClass("DN")}else(cont=Attendance.Break.createNewBreakFromToDiv(cont,isAutoBreak)).find(".breakRemove").hasClass("DN")||cont.find(".breakRemove").addClass("DN"),isAutoBreak&&void 0!=Attendance.Break.CURR_AUTO_BREAKTIME&&Attendance.Break.IS_OLD_AUTO_BREAK&&cont.find("#auto_Time").removeClass("DN").html(Attendance.disHours(Attendance.Break.CURR_AUTO_BREAKTIME,!0));isAutoBreak?container.find("#breakFromToHead").addClass("Matry").find("sup").show():container.find("#breakFromToHead").removeClass("Matry").find("sup").hide()},breakSysCalcChange:function(){Attendance.Break.IS_SYS_CALC=$(Layout.Page.container.find("#ZPAtt_isBreakSystemCalc").find("input[type=checkbox]")[0]).prop("checked")},validateManualBreakNo:function(obj){var manualLimit=Attendance.Break.getManualBreakLimit();return Attendance.Break.MANUAL_BREAK_NO+1>manualLimit?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.manualBreakNo",new Array(manualLimit+""))),!1):(Attendance.Break.MANUAL_BREAK_NO+1==manualLimit&&(obj.isLast=!0),!0)},reduceManualBreakNumber:function(){Attendance.Break.MANUAL_BREAK_NO<=0?Attendance.Break.MANUAL_BREAK_NO=0:Attendance.Break.MANUAL_BREAK_NO--},constructInputBrkFromTo:function(arr,breakObj,inputParam){for(var n=arr.length,breakFromToArr=[],cnt=0,i=0;i<n;i++){var breakFromToDiv=$(arr[i]),breakFromTime=breakFromToDiv.find(".ZPAtt_breakFromTime").val().trim(),breakToTime=breakFromToDiv.find(".ZPAtt_breakToTime").val().trim(),breakFromToMins={};if(""!=breakFromTime&&""!=breakToTime)breakFromToMins.fromTime=Attendance.Common.convertTimerInputToMinsOrSecs(breakFromTime,!1,!Attendance.timeFormatIs12hr),breakFromToMins.toTime=Attendance.Common.convertTimerInputToMinsOrSecs(breakToTime,!1,!Attendance.timeFormatIs12hr),breakFromToArr[cnt++]=breakFromToMins;else if(inputParam.isBreakAutoDeduct&&(void 0==breakObj||void 0==breakObj.breakResFromToTime)||""!=breakFromTime||""!=breakToTime)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.breakValidFromTo")),!1}return breakFromToArr=Attendance.Break.sortBreakFromTo(breakFromToArr),inputParam.restTimeInMins=breakFromToArr,!0},constructBreakFromToArr:function(arr){for(var n=arr.length,breakFromToArr=[],cnt=0,i=0;i<n;i++){var breakFromToDiv=$(arr[i]),breakFromTime=breakFromToDiv.find(".ZPAtt_breakFromTime").val().trim(),breakToTime=breakFromToDiv.find(".ZPAtt_breakToTime").val().trim(),breakFromToMins={};""!=breakFromTime&&""!=breakToTime&&(breakFromToMins.fromTime=Attendance.Common.convertTimerInputToMinsOrSecs(breakFromTime,!1,!Attendance.timeFormatIs12hr),breakFromToMins.toTime=Attendance.Common.convertTimerInputToMinsOrSecs(breakToTime,!1,!Attendance.timeFormatIs12hr),breakFromToArr[cnt++]=breakFromToMins)}return breakFromToArr=Attendance.Break.sortBreakFromTo(breakFromToArr)},appendLoader:function(object,isShow,height){if("string"==typeof object)object=$(object);else if("object"!=typeof object)return;if(isShow){if(0===object.find("#zp_page_loading").length){var loaderHeight=height>=0?height:80;object.append(ZPeople.LOADING_HTML),object.find("#zp_page_loading").attr("style","height:"+loaderHeight+"px")}}else object.find("#zp_page_loading").remove()},emptyBreakContainer:function(obj){var cont=Layout.Page.container;cont.find("#ZPAtt_shiftBreakDetailsBody").empty(),obj&&obj.fixedHeader||Layout.Page.container.find("#ZPAtt_shiftBreakDetails").hide(),cont.find("#ZPAtt_ShiftBreak_emptyRecInfo").prev().show(),cont.find("#ZPAtt_ShiftBreak_emptyRecInfo").hide(),Attendance.Break.appendLoader(cont.find("#ZPAtt_shiftBreakDetails").parent(),!0,80)},showBreakEditNote:function(){var cont=Layout.Page.container;if(0==cont.find("#ZPAtt_shiftBreakConfAddPopup #breakChangeInfo").length){var html='<div id="breakChangeInfo" class="label-message ZPAltmsg label-note"><p class="S13"><b>'+ZPI18N.getString("zp.note")+":</b> "+ZPI18N.getString("zp.breakeditnote")+"</p></div>";cont.find("#ZPAtt_shiftBreakConfAddPopup div.modal-footer").append(html)}else cont.find("#ZPAtt_shiftBreakConfAddPopup #breakChangeInfo").show()},fillBreakImagePopup:function(){if(0==Layout.Page.container.find("ul[breakImageDropDown='true']").find("#changeDropDown").length){var breakImg='<li id="changeDropDown"><div class="icons active" onclick="Attendance.Break.changeBreakImage(this);"><i class="CR-break"></i></div>';breakImg+='<div class="icons" onclick="Attendance.Break.changeBreakImage(this);"><i class="CR-tea"></i></div>',breakImg+='<div class="icons" onclick="Attendance.Break.changeBreakImage(this);"><i class="IC-app45"></i></div>',breakImg+='<div class="icons" onclick="Attendance.Break.changeBreakImage(this);"><i class="CR-t-job"></i></div>',breakImg+='<div class="icons" onclick="Attendance.Break.changeBreakImage(this);"><i class="CR-holiday"></i></div>',breakImg+='<div class="icons" onclick="Attendance.Break.changeBreakImage(this);"><i class="CR-rest"></i></div>',breakImg+='<div class="icons" onclick="Attendance.Break.changeBreakImage(this);"><i class="CR-play"></i></div>',breakImg+='<div class="icons" onclick="Attendance.Break.changeBreakImage(this);"><i class="CR-emg-break"></i></div></li>',Layout.Page.container.find("ul[breakImageDropDown='true']").append(breakImg)}},toggleBreakFilter:function(){var cont=Layout.Page.container,filterIconId="ZPAtt_Break_filter";Timetracker.Break.isTTBreakPage()&&(filterIconId="ZPTT_Break_filter"),cont.find("#"+filterIconId).hasClass("ZPFilsel")?(cont.find("#"+filterIconId).removeClass("blu ZPFilsel"),cont.find("#ZPAtt_breakFilters").attr("class","ZPFilMain"),cont.find("#ZPAtt_breakFilterCloseButton").hide(),$("#page-wrapper").attr("class","Nbar2")):(cont.find("#"+filterIconId).addClass("blu ZPFilsel"),cont.find("#ZPAtt_breakFilters").attr("class","ZPFilMain TEbnd"),cont.find("#ZPAtt_breakFilterCloseButton").show(),$("#page-wrapper").attr("class","Nbar2F"))},resetBreakFilterInputs:function(){var cont=Layout.Page.container;cont.find("#ZPAtt_BreakFilterMode").select2("val",0),cont.find("#ZPAtt_BreakFilterPayType").select2("val",0),Attendance.Break.isShiftBreak()?cont.find("#ZPAtt_BreakFilterShift").select2("val",0):Timetracker.Break.isTTBreakPage()&&cont.find("#breakLocTT").select2("val",0)},getBreakFilterData:function(sortData){var filterData={};sortData&&(filterData=sortData);var payType=parseInt(Layout.Page.container.find("#ZPAtt_BreakFilterPayType").val()),breakMode=parseInt(Layout.Page.container.find("#ZPAtt_BreakFilterMode").val()),shiftLocfilterIconId="ZPAtt_BreakFilterShift";Timetracker.Break.isTTBreakPage()&&(shiftLocfilterIconId="breakLocTT");var shiftId=Layout.Page.container.find("#"+shiftLocfilterIconId).val();return shiftId&&0!=shiftId.length&&(shiftId=JSON.stringify(shiftId)),0!=payType&&(payType=2==payType?0:1,filterData.payType=payType),0!=breakMode&&(breakMode=2==breakMode,filterData.breakMode=breakMode),shiftId&&0!=shiftId.length&&(Attendance.Break.isShiftBreak()?filterData.shiftId=shiftId:Timetracker.Break.isTTBreakPage()&&(filterData.locationId=shiftId)),filterData},breakFilteredSearch:function(){var sortData=Attendance.Break.getSortBreakData();Attendance.Break.getBreakDetails(Attendance.Break.getBreakFilterData(sortData));var filterIconId="ZPAtt_Break_filter";Timetracker.Break.isTTBreakPage()&&(filterIconId="ZPTT_Break_filter"),"/zp"===ZPeople.CONTEXT&&Layout.Page.container.find("#"+filterIconId).hasClass("ZPFilsel")&&Attendance.Break.toggleBreakFilter()},getSortBreakData:function(filterData){var sortData={};filterData&&(sortData=filterData);var breakNameSortObj=Layout.Page.container.find("#ZPAtt_breakSortByName"),breakTimeSortObj=Layout.Page.container.find("#ZPAtt_breakSortByTime");return breakNameSortObj.hasClass("sort-u")||breakNameSortObj.hasClass("sort-d")?sortData.isBreakNameSortAsc=!!breakNameSortObj.hasClass("sort-u"):(breakTimeSortObj.hasClass("sort-u")||breakTimeSortObj.hasClass("sort-d"))&&(sortData.isBreakTimeSortAsc=!!breakTimeSortObj.hasClass("sort-u")),sortData},sortBreakDetails:function(object){var selectedSortObj=$(object);Layout.Page.container.find(".sort-img").not("#"+selectedSortObj.attr("id")).removeClass("sort-u").removeClass("sort-d"),selectedSortObj.hasClass("sort-u")||selectedSortObj.hasClass("sort-d")?selectedSortObj.hasClass("sort-u")?(selectedSortObj.removeClass("sort-u"),selectedSortObj.addClass("sort-d")):selectedSortObj.hasClass("sort-d")&&(selectedSortObj.removeClass("sort-d"),selectedSortObj.addClass("sort-u")):selectedSortObj.addClass("sort-u");var filterData=Attendance.Break.getBreakFilterData();Attendance.Break.getBreakDetails(Attendance.Break.getSortBreakData(filterData),{fixedHeader:!0})},hideAllBreakErrTexts:function(){Layout.Page.container.find("#ZPAtt_shiftBreakConfAddPopup span.ERR").hide()},showOrHidePaytype:function(obj){"EDIT_BREAK"==Attendance.Break.breakPopupType&&Attendance.Break.showBreakEditNote(),Layout.Page.container.find("#payTypeRow").fadeOut(300),Layout.Page.container.find("input:radio[name=ZPAtt_breakDeductSelect]")[1].checked&&Layout.Page.container.find("#payTypeRow").fadeIn(300)},changeBreakImage:function(obj){if(void 0!=obj){var cont=Layout.Page.container;cont.find("ul[breakImageDropDown='true']").find("div.active").removeClass("active"),cont.find("ul[breakImageDropDown='true']").find("li div:eq("+$(obj).index()+")").addClass("active"),cont.find("#selectedImage").attr("class",$(obj).find("i").attr("class").split(" ")[0])}},isIdenticalArrays:function(array1,array2){if(array1.length!=array2.length)return!1;for(var ind1 in array1)if(-1==array2.indexOf(array1[ind1]))return!1;return!0},isIdenticalJSONArrays:function(array1,array2){if(!(void 0!=array1&&0!=array1.length||void 0!=array2&&0!=array2.length))return!0;if(void 0==array1||void 0==array2)return!1;if(array1.length!=array2.length)return!1;for(var ind in array1){var json1=array1[ind],json2=array2[ind];if(json1.fromTime!=json2.fromTime||json1.toTime!=json2.toTime)return!1}return!0},getManualBreakLimit:function(){return 3},getBreakLimitForShift:function(){return 4},sortBreakFromTo:function(arr){return arr.sort(function(a,b){return a.fromTime==b.fromTime?a.toTime-b.toTime:a.fromTime-b.fromTime}),arr},getReqUrl:function(){return Attendance.Break.isShiftBreak()?"/AttendanceShiftAction.zp":Timetracker.Break.isTTBreakPage()?"/timesheetDispAction.zp":void 0},isShiftBreak:function(){if(-1!==Layout.Page.pageId.indexOf("attendance-shift-break"))return!0}},Attendance.ShiftDetails={shiftDetailsIndex:0,isHalfDayShiftEnabledOrg:!1,getShiftDetails:function(input){Layout.Page.container.popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right",delay:{show:50,hide:50}});var isFromScroll=input&&input.shiftDetailsIndex;if(Layout.Page.container.find("[data-toggle=tooltip]").tooltip({trigger:"click"}),!Attendance.ShiftDetails.shiftList||isFromScroll){var param={mode:"getShiftDetails"};param[csrfParamName]=csrfToken,"object"==typeof input&&Object.keys(input).length>0?param.extraParams=JSON.stringify(input):param.extraParams=JSON.stringify({}),Attendance.timeFormatIs12hr="hh:mm a"==timeFormat,$.post("/AttendanceShiftAction.zp",param,function(rdata){if(50===rdata.shiftList.length&&ZPeople.FireScroll.reset(),isFromScroll)for(var index in rdata.shiftList)Attendance.ShiftDetails.shiftList.push(rdata.shiftList[index]);else Attendance.ShiftDetails.shiftList=rdata.shiftList;Attendance.ShiftDetails.consShiftDetails(input,rdata.shiftList),!0===rdata.isHalfDayShiftEnabledOrg&&(Attendance.ShiftDetails.isHalfDayShiftEnabledOrg=!0)})}},validateShiftAdd:function(sname,fromTime,toTime,shiftAllowanceEnabled,allowanceAmount){var errorDisplayed=!1;if(sname||(errorDisplayed=!0,Layout.Page.container.find("#ZPAtt_newShiftName").next().html(ZPI18N.getString("zp.entershiftname"))),void 0==fromTime&&(errorDisplayed=!0,Layout.Page.container.find("#ZPAtt_newShiftFromTime").parent().next().html(ZPI18N.getString("zp.enterfromtime"))),void 0==toTime&&(errorDisplayed=!0,Layout.Page.container.find("#ZPAtt_newShiftToTime").parent().next().html(ZPI18N.getString("zp.entertotime"))),1===shiftAllowanceEnabled){var allowanceHtml=Layout.Page.container.find("#ZPAtt_shiftAllowanceAmount");!allowanceAmount||isNaN(allowanceAmount)?(errorDisplayed=!0,allowanceHtml.next().html(ZPI18N.getString("zp.allowancenumericalerror"))):allowanceAmount<0&&(errorDisplayed=!0,allowanceHtml.next().html(ZPI18N.getString("zp.negativeallowanceerror")))}return errorDisplayed},addShift:function(shiftIndex){var layout=Layout.Page.container,shiftName=layout.find("#ZPAtt_newShiftName").val().trim(),fromTime=Attendance.Common.convertTimerInputToMinsOrSecs(layout.find("#ZPAtt_newShiftFromTime").val().trim()),toTime=Attendance.Common.convertTimerInputToMinsOrSecs(layout.find("#ZPAtt_newShiftToTime").val().trim()),shiftAllowanceEnabled=layout.find("input:radio[name=ZPAtt_shiftAllowanceSelect]")[1].checked?0:1,allowanceAmount=layout.find("#ZPAtt_shiftAllowanceAmount").val();if(!Attendance.ShiftDetails.validateShiftAdd(shiftName,fromTime,toTime,shiftAllowanceEnabled,allowanceAmount)){var shiftColor=layout.find("#ZPAtt_shiftMapAddPopup #shiftColorSelector").find("div.sel").index()+1,weekendBasedOn=layout.find("input:radio[name=ZPAtt_weekendSelect]")[0].checked?0:1,param={mode:"addNewShift"};param[csrfParamName]=csrfToken;var inputParam={};if(shiftIndex){var shiftObj=Attendance.ShiftDetails.shiftList[shiftIndex];inputParam.shiftId=shiftObj.shiftId}if(shiftIndex&&shiftName===shiftObj.shiftName||(inputParam.sname=shiftName),shiftIndex&&fromTime===shiftObj.fTime||(inputParam.ftime=fromTime),shiftIndex&&toTime===shiftObj.tTime||(inputParam.ttime=toTime),shiftIndex&&shiftColor===shiftObj.colorCode||(inputParam.colorCode=shiftColor),(!shiftIndex||shiftObj.isShiftBasedWeekend&&0===weekendBasedOn||!shiftObj.isShiftBasedWeekend&&1===weekendBasedOn)&&(inputParam.weekendBasedOn=weekendBasedOn),shiftIndex&&shiftObj.allowanceEnabled===shiftAllowanceEnabled||(inputParam.shiftAllowanceEnabled=shiftAllowanceEnabled),shiftIndex&&shiftObj.shiftAllowance===parseFloat(layout.find("#ZPAtt_shiftAllowanceAmount").val())||1!==shiftAllowanceEnabled||(inputParam.shiftAllowanceAmount=Math.round(100*allowanceAmount)/100),1===weekendBasedOn){for(var ele=layout.find("#ZPAtt_shiftMapAddPopup tbody tr.ZPLRow"),weekends={},weekendList={},sessionInfo={},weekDays=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat"),sessionInfoDays=new Array("sunday","monday","tuesday","wednesday","thursday","friday","saturday"),halfWeekendEnabled=layout.find("input:radio[name=hflwrk]")[0].checked?1:0,i=0;i<ele.length;i++){var wkday=weekDays[i],sessionWknd=sessionInfoDays[i];weekendList[wkday]="None";var tdArray=$(ele[i]).find("tbody td:not(:first-child)").find("input[type=checkbox]:checked");if(5===tdArray.length){if(weekendList[wkday]="All",halfWeekendEnabled){for(var tmp={},j=0;j<tdArray.length;j++){weekends=$(tdArray[j]).closest("td").index();var session=$(tdArray[j]).closest("td").find("select").find(":selected").val();tmp[weekends]=session}sessionInfo[sessionWknd]=tmp}}else if(tdArray.length>0){weekendList[wkday]="";for(tmp={},j=0;j<tdArray.length;j++)if(weekends=$(tdArray[j]).closest("td").index(),weekendList[wkday]+=String(weekends)+",",halfWeekendEnabled){session=$(tdArray[j]).closest("td").find("select").find(":selected").val();tmp[weekends]=session}weekendList[wkday]=weekendList[wkday].slice(0,-1),halfWeekendEnabled&&(sessionInfo[sessionWknd]=tmp)}}inputParam.weekendDays=weekendList,inputParam.sessionInfo=sessionInfo}if(layout.find("input:radio[name=ZPAtt_shiftMarginToggle]")[0].checked){var margin={},margeStarts=Attendance.Common.convertTimerInputToMinsOrSecs(layout.find("#ZPAtt_shiftMarginStarts").val().trim()),margeEnds=Attendance.Common.convertTimerInputToMinsOrSecs(layout.find("#ZPAtt_shiftMarginEnds").val().trim());margin.marginStarts=margeStarts||0,margin.marginEnds=margeEnds||0,inputParam.shiftMargin=margin}var appfor={};appfor.div=ZPPickList.getSelectedDivisions(),appfor.dep=ZPPickList.getSelectedDepartments(),appfor.loc=ZPPickList.getSelectedLocations(),inputParam.applicableFor=appfor,!0===Attendance.ShiftDetails.isHalfDayShiftEnabledOrg&&(inputParam.isHalfDayShiftEnabled=!(!halfWeekendEnabled||!layout.find("#ZPAtt_halfDayShiftEnabled")[0].checked)),param.inputParam=JSON.stringify(inputParam),Layout.Page.container.find("#ZPAtt_sNewPopupRecSave").prop("disabled",!0),$.post("/AttendanceShiftAction.zp",param,function(rdata){Layout.Page.container.find("#ZPAtt_sNewPopupRecSave").prop("disabled",!1),rdata.errorType?Attendance.ShiftDetails.showAddShiftErrorMessages(rdata.errorType):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.shiftsaved")),Attendance.ShiftDetails.resetPreLoadedShiftDetails(),Attendance.ShiftDetails.reFetchShiftdetails(),Attendance.ShiftDetails.toggleAddNewPopUp(),AttendanceShift.depLocShiftList&&AttendanceShift.resetValuesOnShiftChange())})}},showAddShiftErrorMessages:function(errorObj){errorObj.shiftnameerr?Layout.Page.container.find("#ZPAtt_newShiftName").next().html(ZPI18N.getString("zp.entershiftname")):errorObj.duplicateShiftName&&Layout.Page.container.find("#ZPAtt_newShiftName").next().html(ZPI18N.getString("zp.shiftnameduplicate")),errorObj.fromtimeerr&&Layout.Page.container.find("#ZPAtt_newShiftFromTime").parent().next().html(ZPI18N.getString("zp.enterfromtime")),errorObj.totimeerr&&Layout.Page.container.find("#ZPAtt_newShiftToTime").parent().next().html(ZPI18N.getString("zp.entertotime")),errorObj.allowancenumericalerr?Layout.Page.container.find("#ZPAtt_shiftAllowanceAmount").next().html(ZPI18N.getString("zp.allowancenumericalerror")):errorObj.allowancelessthanzero&&Layout.Page.container.find("#ZPAtt_shiftAllowanceAmount").next().html(ZPI18N.getString("zp.negativeallowanceerror"))},changeShiftColorDetailsPage:function(obj){var param={mode:"addNewShift"};param[csrfParamName]=csrfToken;var inputParam={};inputParam.shiftId=$(obj).closest("tr").attr("id"),inputParam.colorCode=$(obj).attr("class").split(" ")[0].slice(2),inputParam.onlyColorChange=!0,param.inputParam=JSON.stringify(inputParam),$.post("/AttendanceShiftAction.zp",param,function(){var objClass=$(obj).attr("class");if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.colorchanged")),Attendance.ShiftDetails.shiftList[$(obj).closest("tr").index()].colorCode=objClass.slice(2),$(obj).closest("tr").find("td.dropdown div").eq(0).attr("class","ZPLtyp "+objClass),AttendanceShift.depLocShiftList){var shiftId=$(obj).closest("tr").attr("id");AttendanceShift.depLocShiftList.shiftlist[shiftId].colorCode=objClass.slice(2),Shift.shiftList[shiftId].colorCode=objClass.slice(2),AttendanceShift.resetValuesOnShiftChange()}})},deleteShift:function(obj){var param={mode:"deleteShift"};param[csrfParamName]=csrfToken,param.shiftId=$(obj).closest("tr").attr("id"),$.post("/AttendanceShiftAction.zp",param,function(rdata){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.shiftdeleted")),Attendance.ShiftDetails.reFetchShiftdetails(),Attendance.ShiftDetails.resetPreLoadedShiftDetails()})},resetPreLoadedShiftDetails:function(){delete AttendanceShift.depLocShiftList},getShiftDetailsOnScroll:function(){Attendance.ShiftDetails.shiftDetailsIndex+=50;var input=Attendance.ShiftDetails.getSortBreakData();input.shiftDetailsIndex=Attendance.ShiftDetails.shiftDetailsIndex+1,Attendance.ShiftDetails.getShiftDetails(input)},sortShiftDetails:function(obj){$(obj).hasClass("sort-d")?$(obj).attr("class","sort-img sort-u CP"):$(obj).attr("class","sort-img sort-d CP"),"ZPAtt_shiftDetails_myReqNameSort"==$(obj).attr("id")?Layout.Page.container.find("#ZPAtt_shiftDetails_timeSort").attr("class","sort-img sort CP"):Layout.Page.container.find("#ZPAtt_shiftDetails_myReqNameSort").attr("class","sort-img sort CP"),Attendance.ShiftDetails.reFetchShiftdetails()},getSortBreakData:function(){var sortData={},shiftTimeSortObj=Layout.Page.container.find("#ZPAtt_shiftDetails_timeSort"),shiftNameSortObj=Layout.Page.container.find("#ZPAtt_shiftDetails_myReqNameSort");return shiftNameSortObj.hasClass("sort-u")||shiftNameSortObj.hasClass("sort-d")?sortData.isSortName=!!shiftNameSortObj.hasClass("sort-u"):(shiftTimeSortObj.hasClass("sort-u")||shiftTimeSortObj.hasClass("sort-d"))&&(sortData.isSortTime=!!shiftTimeSortObj.hasClass("sort-u")),sortData},reFetchShiftdetails:function(){Layout.Page.container.find("#ZPAtt_shiftDetailsBody").empty(),Attendance.Break.appendLoader(Layout.Page.container.find("#ZPAtt_shiftDetails").parent(),!0,1200),Attendance.ShiftDetails.shiftDetailsIndex=0,delete Attendance.ShiftDetails.shiftList,Attendance.ShiftDetails.getShiftDetails(Attendance.ShiftDetails.getSortBreakData())},consShiftDetails:function(input,shiftList){var isFromScroll=input&&input.shiftDetailsIndex,tbody=$("#ZPAtt_shiftDetailsBody");isFromScroll||(Layout.Page.container.find("#ZPAtt_shiftDetailsBody").empty(),Attendance.Break.appendLoader(Layout.Page.container.find("#ZPAtt_shiftDetails").parent(),!1));var existingShiftLength=Layout.Page.container.find("#ZPAtt_shiftDetailsBody tr").length;for(var index in shiftList){var data=shiftList[index],rowIndex=parseInt(existingShiftLength)+parseInt(index),tr="<tr id="+data.shiftId+" class='ZPLRow'>";tr+='<td class="dropdown" onclick="Attendance.ShiftDetails.appendShiftColors(this)"><div aria-expanded="false" data-toggle="dropdown" class="ZPLtyp LC'+data.colorCode+'">',tr+='</div><span class="CP" onclick=Attendance.ShiftDetails.toggleAddNewPopUp(true,"'+rowIndex+'")>'+data.shiftName+"</span>",tr+="</td><td><span>"+Attendance.disTime(data.fTime)+'</span><span class="ZPuscr">-</span><span>'+Attendance.disTime(data.tTime)+"</span></td>",1===data.select?tr+='<td class="text-right P0I"><div class="over-display"><i class="IC-pen S14 gry FR MR15 CP" onclick=Attendance.ShiftDetails.toggleAddNewPopUp(true,"'+rowIndex+'") data-toggle="modal"></i></div></td><td></td>':(tr+="<td class='text-right P0I'><div id='ZPAtt_Shift_delAction' class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_Shift_delConfirm')></i>",tr+='<i class="IC-pen S14 gry FR MR15 CP" onclick=Attendance.ShiftDetails.toggleAddNewPopUp(true,"'+rowIndex+'") data-toggle="modal"></i></div>',tr+="<div style='display:none' id='ZPAtt_Shift_delConfirm'>",tr+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_Shift_delAction')>"+ZPI18N.getString("zp.cancel")+"</button>",tr+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=Attendance.ShiftDetails.deleteShift(this)>"+ZPI18N.getString("zp.confirm")+"</button></div></td><td></td>"),tr+="</tr>",tbody.append(tr)}Layout.Page.container.find("#ZPAtt_shiftDetails").parent().hasClass("tabcont")||ZPView.handleTablePosition()},appendShiftColors:function(obj,isConsForBreak){if($(obj).find("ul").length>0)return $(obj).find("li div").removeClass("sel"),void $(obj).find("li div."+$(obj).find("div").eq(0).attr("class").split(" ")[1]).addClass("sel");for(var html='<ul class="ZPCP dropdown-menu ZPCmn-Arrow lt top gray" style="left:15px;"><li>',num=1;num<=16;num++)html+=isConsForBreak?'<div class="LC'+num+'"onclick="Attendance.Break.changeBreakColor(this);"></div>':'<div class="LC'+num+'"onclick="Attendance.ShiftDetails.changeShiftColorDetailsPage(this);"></div>';html+="</li></ul>",$(obj).find("div").eq(0).after(html),$(obj).find("li div").removeClass("sel"),$(obj).find("li div."+$(obj).find("div").eq(0).attr("class").split(" ")[1]).addClass("sel")},resetErrorMessageOnFocus:function(){var nameHtml=Layout.Page.container.find("#ZPAtt_newShiftName");nameHtml.focus(function(){nameHtml.next().html("")});var fromHtml=Layout.Page.container.find("#ZPAtt_newShiftFromTime");fromHtml.focus(function(){fromHtml.parent().next().html("")});var toHtml=Layout.Page.container.find("#ZPAtt_newShiftToTime");toHtml.focus(function(){toHtml.parent().next().html("")});var allowanceHtml=Layout.Page.container.find("#ZPAtt_shiftAllowanceAmount");allowanceHtml.focus(function(){allowanceHtml.next().html("")})},constNewShiftPopup:function(isAdd){var layout=Layout.Page.container;layout.find("#ZPAtt_newShiftName").val(""),layout.find("#ZPAtt_newShiftName").next().html(""),layout.find("#ZPAtt_newShiftFromTime").parent().next().html(""),layout.find("#ZPAtt_newShiftToTime").parent().next().html(""),layout.find("#ZPAtt_shiftAllowanceAmount").next().html(""),layout.find("#ZPAtt_shiftAllowanceAmount").val(""),layout.find("#shiftAmount").hide();var object={disableMousewheel:!0,minuteStep:!0,showMeridian:!1};if(Attendance.timeFormatIs12hr){var defTime="9:00 "+ZPI18N.getString("zp.am").toUpperCase();object.defaultTime=defTime,object.showMeridian=!0,layout.find("#ZPAtt_newShiftFromTime").val(defTime).timepicker(object).on("changeTime.timepicker",function(){Attendance.ShiftDetails.marginDefinition()}),defTime="6:00 "+ZPI18N.getString("zp.pm").toUpperCase(),object.defaultTime=defTime,object.showMeridian=!0,layout.find("#ZPAtt_newShiftToTime").val(defTime).timepicker(object).on("changeTime.timepicker",function(){Attendance.ShiftDetails.marginDefinition()})}else object.defaultTime="9:00",layout.find("#ZPAtt_newShiftFromTime").val("9:00").timepicker(object).on("changeTime.timepicker",function(){Attendance.ShiftDetails.marginDefinition()}),object.defaultTime="18:00",layout.find("#ZPAtt_newShiftToTime").val("18:00").timepicker(object).on("changeTime.timepicker",function(){Attendance.ShiftDetails.marginDefinition()});object.defaultTime="",object.showMeridian=!1,layout.find("#ZPAtt_shiftMarginStarts").val("").timepicker(object).on("changeTime.timepicker",function(){Attendance.ShiftDetails.marginDefinition()}),layout.find("#ZPAtt_shiftMarginEnds").val("").timepicker(object).on("changeTime.timepicker",function(){Attendance.ShiftDetails.marginDefinition()})},toggleAddNewPopUp:function(show,shiftIndex,isAdd){var layout=Layout.Page.container,addPopup=layout.find("#ZPAtt_shiftMapAddPopup"),shiftColorSelect=addPopup.find("#shiftColorSelector");if(show){if(Attendance.ShiftDetails.resetErrorMessageOnFocus(),addPopup.find("#ZPAtt_sNewPopupRecSave").text(ZPI18N.getString("zp.submit")),addPopup.find("div.modal-footer div").hide(),layout.find("#ZPAtt_shiftSettings").is(":visible")){Attendance.ShiftDetails.constNewShiftPopup(isAdd),Attendance.ShiftDetails.constructApplicableFor(),addPopup.find("input[type=checkbox]").prop("checked",!1);var html='<div class="label-message ZPAltmsg label-note"><p class="S13"><b>'+ZPI18N.getString("zp.note")+":</b>";if(layout.find("input:radio[name=ZPAtt_shiftMarginToggle]")[1].checked=!0,isAdd)html+=" "+ZPI18N.getString("zp.shiftbasedweekendnotmsg")+"</p></div>",addPopup.find("#ZPAtt_popUpHeader_shiftDet").html(ZPI18N.getString("zp.addshift")),layout.find("#ZPAtt_sNewPopupRecSave").off("click").on("click",function(){Attendance.ShiftDetails.addShift()}),layout.find("input:radio[name=ZPAtt_weekendSelect]")[0].checked=!0,layout.find("input:radio[name=ZPAtt_shiftAllowanceSelect]")[1].checked=!0,layout.find("#ZPAtt_configShiftWeekends").hide(),layout.find("#ZPAtt_popUpContent_shiftDet").find("input:radio[name=hflwrk]")[1].checked=!0,layout.find("#ZPAtt_popUpContent_shiftDet").find("#halfWorkingDay").hide(),layout.find("#ZPAtt_popUpContent_shiftDet").find("#ZPAtt_halfDayShift").hide(),layout.find("#ZPAtt_popUpContent_shiftDet .i_table").find("input[type=checkbox]").prop("checked",!1),layout.find("#ZPAtt_popUpContent_shiftDet .i_table").eq(1).find("input[type=checkbox]").prop("checked",!0),layout.find("#ZPAtt_popUpContent_shiftDet .i_table").find("select").select2().prev().select2("val",0).hide(),layout.find("#ZPAtt_configShiftWeekends").find("#shiftTable").addClass("col-sm-6").removeClass("col-sm-10"),shiftColorSelect.find("span").attr("class","LC1"),shiftColorSelect.find("div.sel").removeClass("sel"),shiftColorSelect.find("div.LC1").addClass("sel");else if(shiftIndex){html+=" "+ZPI18N.getString("zp.shiftbasedweekendEditnotmsg")+"</p></div>",addPopup.find("#ZPAtt_popUpHeader_shiftDet").html(ZPI18N.getString("zp.editshift"));var shiftDetails=Attendance.ShiftDetails.shiftList[shiftIndex];Attendance.ShiftDetails.constructApplicableForEdit(shiftDetails),layout.find("#ZPAtt_newShiftName").val(decodeHTML(shiftDetails.shiftName)),layout.find("#ZPAtt_newShiftFromTime").val(Attendance.disTime(shiftDetails.fTime,!1,!0)),layout.find("#ZPAtt_newShiftToTime").val(Attendance.disTime(shiftDetails.tTime,!1,!0)),Attendance.ShiftDetails.getWeekendsBasedOnShift(shiftDetails.shiftId),shiftDetails.isShiftBasedWeekend?layout.find("input:radio[name=ZPAtt_weekendSelect]")[1].checked=!0:layout.find("input:radio[name=ZPAtt_weekendSelect]")[0].checked=!0,layout.find("#ZPAtt_popUpContent_shiftDet").find("input:radio[name=hflwrk]")[1].checked=!0,layout.find("#ZPAtt_shiftAllowanceAmount").val(shiftDetails.shiftAllowance),1===shiftDetails.allowanceEnabled?(layout.find("input:radio[name=ZPAtt_shiftAllowanceSelect]")[0].checked=!0,layout.find("#shiftAmount").show()):layout.find("input:radio[name=ZPAtt_shiftAllowanceSelect]")[1].checked=!0,layout.find("#ZPAtt_configShiftWeekends").hide(),layout.find("#halfWorkingDay").hide(),layout.find("#ZPAtt_halfDayShift").hide(),layout.find("#ZPAtt_configShiftWeekends").find("#shiftTable").addClass("col-sm-6").removeClass("col-sm-10"),layout.find("#ZPAtt_popUpContent_shiftDet .i_table").find("select").select2("val",0),layout.find("#ZPAtt_popUpContent_shiftDet .i_table").find("select").select2().prev().hide(),shiftDetails.isShiftBasedWeekend&&("false"===isV1&&layout.find("#halfWorkingDay").show(),layout.find("#ZPAtt_configShiftWeekends").show());var shiftMargin=shiftDetails.shiftMargin;shiftMargin&&(layout.find("input:radio[name=ZPAtt_shiftMarginToggle]")[0].checked=!0,void 0!==shiftMargin.marginStarts&&layout.find("#ZPAtt_shiftMarginStarts").val(Attendance.disHours(shiftDetails.shiftMargin.marginStarts,!0)),void 0!==shiftMargin.marginEnds&&layout.find("#ZPAtt_shiftMarginEnds").val(Attendance.disHours(shiftDetails.shiftMargin.marginEnds,!0))),shiftColorSelect.find("span").attr("class","LC"+shiftDetails.colorCode),shiftColorSelect.find("div.sel").removeClass("sel"),shiftColorSelect.find("div.LC"+shiftDetails.colorCode).addClass("sel"),layout.find("#ZPAtt_sNewPopupRecSave").off("click").on("click",function(){Attendance.ShiftDetails.addShift(shiftIndex)})}addPopup.find("div.modal-footer div.label-message").remove(),addPopup.find("div.modal-footer").append(html),addPopup.modal("show"),Attendance.ShiftDetails.marginOptionChange(),Attendance.ShiftDetails.marginDefinition()}}else layout.find("#ZPAtt_shiftMapAddPopup").modal("hide")},halfWorkingDayRadioChange:function(obj){var layout=Layout.Page.container,shiftTable=layout.find("#ZPAtt_popUpContent_shiftDet .i_table");if("halfWorkingDayEnabled"===obj.id){shiftTable.find("select").select2().prev().hide(),layout.find("#ZPAtt_popUpContent_shiftDet").find("#shiftTable").addClass("col-sm-10").removeClass("col-sm-6"),layout.find("#ZPAtt_popUpContent_shiftDet .table-cbox.MB0I").addClass("enbl_hlfdy");for(let i=1;i<=7;i++)for(let j=1;j<6;j++)!0===shiftTable.eq(i).find("input[type=checkbox]").eq(j).is(":checked")&&shiftTable.eq(i).find("select").eq(j-1).select2().prev().show();!0===Attendance.ShiftDetails.isHalfDayShiftEnabledOrg&&layout.find("#ZPAtt_halfDayShift").fadeIn(300)}else"halfWorkingDayDiabled"===obj.id&&(shiftTable.find("select").select2().prev().hide(),layout.find("#ZPAtt_popUpContent_shiftDet").find("#shiftTable").addClass("col-sm-6").removeClass("col-sm-10"),layout.find("#ZPAtt_popUpContent_shiftDet .table-cbox.MB0I").removeClass("enbl_hlfdy"),layout.find("#ZPAtt_halfDayShift").fadeOut(100))},changeWeekendCheckBox:function(obj,val){!0===Layout.Page.container.find("#ZPAtt_popUpContent_shiftDet").find("#halfWorkingDayEnabled").is(":checked")?"all"===val?$(obj).is(":checked")?($(obj).closest("tbody").find("input[type=checkbox]").prop("checked",!0),$(obj).closest("tbody").find("td").find("select").select2().prev().show()):($(obj).closest("tbody").find("input[type=checkbox]").prop("checked",!1),$(obj).closest("tbody").find("td").find("select").select2().prev().hide()):$(obj).closest("tbody").find("td:not(:first-child)").find("input[type=checkbox]:checked").length===$(obj).closest("tbody").find("td:not(:first-child)").find("input[type=checkbox]").length?($(obj).closest("tbody").find("td:first").find("input[type=checkbox]").prop("checked",!0),$(obj).closest("tbody").find("td").find("select").select2().prev().show()):($(obj).closest("tbody").find("td:first").find("input[type=checkbox]").prop("checked",!1),$(obj).closest("td").find("input[type=checkbox]").is(":checked")?$(obj).closest("td").find("select").select2().prev().show():$(obj).closest("td").find("select").select2().prev().hide()):"all"===val?$(obj).is(":checked")?$(obj).closest("tbody").find("input[type=checkbox]").prop("checked",!0):$(obj).closest("tbody").find("input[type=checkbox]").prop("checked",!1):$(obj).closest("tbody").find("td:not(:first-child)").find("input[type=checkbox]:checked").length===$(obj).closest("tbody").find("td:not(:first-child)").find("input[type=checkbox]").length?$(obj).closest("tbody").find("td:first").find("input[type=checkbox]").prop("checked",!0):$(obj).closest("tbody").find("td:first").find("input[type=checkbox]").prop("checked",!1)},changeShiftColor:function(obj){$(obj).parent().find("div").removeClass("sel"),$(obj).addClass("sel"),$(obj).closest("a").find("span").attr("class",$(obj).attr("class").split(" ")[0])},weekendRadioChange:function(obj){var layout=Layout.Page.container;"shiftBasedWeekend"===obj.id?("false"===isV1&&(layout.find("#halfWorkingDay").fadeIn(300),!0===Attendance.ShiftDetails.isHalfDayShiftEnabledOrg&&!0===layout.find("#halfWorkingDayEnabled")[0].checked&&layout.find("#ZPAtt_halfDayShift").fadeIn(300)),layout.find("#ZPAtt_configShiftWeekends").fadeIn(300)):(layout.find("#ZPAtt_configShiftWeekends").fadeOut(300),layout.find("#halfWorkingDay").fadeOut(300),layout.find("#ZPAtt_halfDayShift").fadeOut(300))},getWeekendsBasedOnShift:function(shiftId){var param={mode:"getWeekendList",conreqcsr:csrfToken};shiftId&&(param.shiftId=shiftId),$.post("/AttendanceShiftAction.zp",param,function(rdata){if(rdata&&rdata.weekendList){var weekendList=rdata.weekendList,rows=Layout.Page.container.find("#ZPAtt_popUpContent_shiftDet .i_table"),shiftDetails=Layout.Page.container.find("#ZPAtt_popUpContent_shiftDet");if(null!=weekendList.sessionInfo?(shiftDetails.find("input:radio[name=hflwrk]")[0].checked=!0,shiftDetails.find("#shiftTable").addClass("col-sm-10").removeClass("col-sm-6"),shiftDetails.find(".table-cbox.MB0I").addClass("enbl_hlfdy"),shiftDetails.find("#halfWorkingDay").is(":visible")&&!0===Attendance.ShiftDetails.isHalfDayShiftEnabledOrg&&(shiftDetails.find("#ZPAtt_halfDayShift").show(),shiftDetails.find(!0===weekendList.isHalfDayShiftEnabled?"#ZPAtt_halfDayShiftEnabled":"#ZPAtt_halfDayShiftDisabled").prop("checked",!0))):shiftDetails.find("input:radio[name=hflwrk]")[1].checked=!0,rows.find("select").select2().prev().hide(),weekendList.Sunday&&"None"!==weekendList.Sunday){var day=weekendList.Sunday,dayCheckBox=rows.eq("1").find("input[type=checkbox]"),selectBox=rows.eq("1").find("select");if("All"===day){if(dayCheckBox.prop("checked",!0),null!=weekendList.sessionInfo){day=JSON.parse(weekendList.sessionInfo).sunday;Object.keys(day).forEach(k=>{selectBox.eq(k-1).select2().prev().select2("val",day[k])})}}else for(var i in day=day.split(","))if(dayCheckBox.eq(day[i]).prop("checked",!0),null!=weekendList.sessionInfo){var session=JSON.parse(weekendList.sessionInfo).sunday;selectBox.eq(day[i]-1).select2().prev().select2("val",session[day[i]])}}if(weekendList.Monday&&"None"!==weekendList.Monday){day=weekendList.Monday,dayCheckBox=rows.eq("2").find("input[type=checkbox]"),selectBox=rows.eq("2").find("select");if("All"===day){if(dayCheckBox.prop("checked",!0),null!=weekendList.sessionInfo){day=JSON.parse(weekendList.sessionInfo).monday;Object.keys(day).forEach(k=>{selectBox.eq(k-1).select2().prev().select2("val",day[k])})}}else for(var i in day=day.split(","))if(dayCheckBox.eq(day[i]).prop("checked",!0),null!=weekendList.sessionInfo){session=JSON.parse(weekendList.sessionInfo).monday;selectBox.eq(day[i]-1).select2().prev().select2("val",session[day[i]])}}if(weekendList.Tuesday&&"None"!==weekendList.Tuesday){day=weekendList.Tuesday,dayCheckBox=rows.eq("3").find("input[type=checkbox]"),selectBox=rows.eq("3").find("select");if("All"===day){if(dayCheckBox.prop("checked",!0),null!=weekendList.sessionInfo){day=JSON.parse(weekendList.sessionInfo).tuesday;Object.keys(day).forEach(k=>{selectBox.eq(k-1).select2().prev().select2("val",day[k])})}}else for(var i in day=day.split(","))if(dayCheckBox.eq(day[i]).prop("checked",!0),null!=weekendList.sessionInfo){session=JSON.parse(weekendList.sessionInfo).tuesday;selectBox.eq(day[i]-1).select2().prev().select2("val",session[day[i]])}}if(weekendList.Wednesday&&"None"!==weekendList.Wednesday){day=weekendList.Wednesday,dayCheckBox=rows.eq("4").find("input[type=checkbox]"),selectBox=rows.eq("4").find("select");if("All"===day){if(dayCheckBox.prop("checked",!0),null!=weekendList.sessionInfo){day=JSON.parse(weekendList.sessionInfo).wednesday;Object.keys(day).forEach(k=>{selectBox.eq(k-1).select2().prev().select2("val",day[k])})}}else for(var i in day=day.split(","))if(dayCheckBox.eq(day[i]).prop("checked",!0),null!=weekendList.sessionInfo){session=JSON.parse(weekendList.sessionInfo).wednesday;selectBox.eq(day[i]-1).select2().prev().select2("val",session[day[i]])}}if(weekendList.Thursday&&"None"!==weekendList.Thursday){day=weekendList.Thursday,dayCheckBox=rows.eq("5").find("input[type=checkbox]"),selectBox=rows.eq("5").find("select");if("All"===day){if(dayCheckBox.prop("checked",!0),null!=weekendList.sessionInfo){day=JSON.parse(weekendList.sessionInfo).thursday;Object.keys(day).forEach(k=>{selectBox.eq(k-1).select2().prev().select2("val",day[k])})}}else for(var i in day=day.split(","))if(dayCheckBox.eq(day[i]).prop("checked",!0),null!=weekendList.sessionInfo){session=JSON.parse(weekendList.sessionInfo).thursday;selectBox.eq(day[i]-1).select2().prev().select2("val",session[day[i]])}}if(weekendList.Friday&&"None"!==weekendList.Friday){day=weekendList.Friday,dayCheckBox=rows.eq("6").find("input[type=checkbox]"),selectBox=rows.eq("6").find("select");if("All"===day){if(dayCheckBox.prop("checked",!0),null!=weekendList.sessionInfo){day=JSON.parse(weekendList.sessionInfo).friday;Object.keys(day).forEach(k=>{selectBox.eq(k-1).select2().prev().select2("val",day[k])})}}else for(var i in day=day.split(","))if(dayCheckBox.eq(day[i]).prop("checked",!0),null!=weekendList.sessionInfo){session=JSON.parse(weekendList.sessionInfo).friday;selectBox.eq(day[i]-1).select2().prev().select2("val",session[day[i]])}}if(weekendList.Saturday&&"None"!==weekendList.Saturday){day=weekendList.Saturday,dayCheckBox=rows.eq("7").find("input[type=checkbox]"),selectBox=rows.eq("7").find("select");if("All"===day){if(dayCheckBox.prop("checked",!0),null!=weekendList.sessionInfo){day=JSON.parse(weekendList.sessionInfo).saturday;Object.keys(day).forEach(k=>{selectBox.eq(k-1).select2().prev().select2("val",day[k])})}}else for(var i in day=day.split(","))if(dayCheckBox.eq(day[i]).prop("checked",!0),null!=weekendList.sessionInfo){session=JSON.parse(weekendList.sessionInfo).saturday;selectBox.eq(day[i]-1).select2().prev().select2("val",session[day[i]])}}}})},allowanceOtionChange:function(obj){"allowShiftAllowance"===obj.id?Layout.Page.container.find("#shiftAmount").fadeIn(300):Layout.Page.container.find("#shiftAmount").fadeOut(300)},showImport:function(){Layout.Page.container.find("#ZPAtt_ShiftDetailsImportView").modal("show"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSuccMsg").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMsg").parent().hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSuccvalues").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImport").parent().parent().removeAttr("class"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImport").fadeIn(300),Layout.Page.container.find("#ZPAtt_ShiftDetails_impEx").fadeIn(300),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFileConf").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMap").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInput").val(""),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportDesc").after(Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInputCont").show()),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInputCont span").text(ZPI18N.getString("zp.importfile")),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInputCont").attr("class","btn btn-primary ZPbtnDefault"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportPrevious").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportHeader li").first().attr("class","active"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportHeader li").last().removeAttr("class"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportErrDiv").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportView .modal-body").find("#zp_page_loading").remove(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportView .modal-body").children().not("#ZPAtt_ShiftDetailsImportErrDiv").show(),Attendance.ShiftDetails.getPendingImport()},getPendingImport:function(){var pendingMsg=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMsg");pendingMsg.parent().hide(),$.post("/AttendanceShiftAction.zp",{mode:"getPendingShiftDetailsImport",conreqcsr:csrfToken},function(rdata){"empty"===rdata.tableInfo.tableHeaders?(pendingMsg.off("click"),pendingMsg.html(""),pendingMsg.parent().hide()):(pendingMsg.attr("class","blu CP"),pendingMsg.off("click").on("click",function(){Attendance.ShiftDetails.showMapping(rdata.tableInfo)}),pendingMsg.html(rdata.tableInfo.recordCount+" "+ZPI18N.getString("zp.recordspending")),pendingMsg.parent().fadeIn(300))})},onImportInputChange:function(){var fileName=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInput").val();Layout.Page.container.find("#ZPAtt_ShiftDetailsImportProgress").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportProgress").next().show(),fileName=fileName.replace("C:\\fakepath\\",""),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFName").text(fileName),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSuccMsg").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSuccvalues").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportProgress").after(Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInputCont")),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInputCont span").text(ZPI18N.getString("zp.removeandnew")),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInputCont").attr("class","btn btn-default ZPbtnDefault");var extn=fileName.split(".").pop();"xls"===extn||"csv"===extn?(Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFName").next().attr("class","IC-rou-tik ML5 filetck"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").fadeIn(300),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").attr("disabled",!1),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").off("click").on("click",function(){Attendance.ShiftDetails.submitImport()})):(Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFName").next().attr("class","IC-r-close ML5 PR S18 red"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInput").val(""),""===Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFName").text()&&Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFName").text(ZPI18N.getString("zp.choosefile"))),Layout.Page.container.find("#ZPAtt_ShiftDetailsImport").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetails_impEx").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFileConf").fadeIn(300),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMap").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMsg").off("click").on("click",function(){Attendance.ShiftDetails.showMapping(rdata.tableInfo)})},submitImport:function(){Attendance.ShiftDetails.ProgressBarWidth=0,Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").off("click"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportProgress").next().hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportProgress div").width(Attendance.ShiftDetails.ProgressBarWidth+"%").parent().show(),Attendance.ShiftDetails.showProgress();var form=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInput")[0].form;""!==Layout.Page.container.find("#ZPAtt_ShiftDetailsImportInput").val()&&(Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").attr("disabled",!0),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFormCsrf").val(csrfToken),form.action="/AttendanceImport.zp",form.submit())},ProgressBarWidth:0,showProgress:function(){Layout.Page.container.find("#ZPAtt_ShiftDetailsImportProgress div").width(Attendance.ShiftDetails.ProgressBarWidth+"%"),Attendance.ShiftDetails.ProgressBarWidth+=2,Attendance.ShiftDetails.ProgressBarWidth<=99&&setTimeout(Attendance.ShiftDetails.showProgress,1)},showMapping:function(obj){Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").attr("disabled",!1),Attendance.ShiftDetails.tableDetails=obj,Layout.Page.container.find("#ZPAtt_ShiftDetailsImport").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetails_impEx").hide(),Layout.Page.container.find("#ZPAtt_shift_chooseAppr").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFileConf").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMap").fadeIn(300),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportPrevious").fadeIn(300),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").fadeIn(300),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportHeader li").last().attr("class","active"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMap select").off("change"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").off("click").on("click",function(){Attendance.ShiftDetails.submitMapping(obj.fileFormat)});var rArray=obj.tableHeaders,res="<option value='None' selected='selected'>-- "+ZPI18N.getString("zp.select")+" --</option>";for(var i in rArray)res+="<option value='"+i+"'>"+rArray[i]+"</option>";for(var i in Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMap select").html(res),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMap select").select2(),rArray)-1===rArray[i].toLowerCase().indexOf("shift")&&-1===rArray[i].toLowerCase().indexOf("name")||"None"!=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShift select").val()?-1!==rArray[i].toLowerCase().indexOf("from")&&-1===rArray[i].toLowerCase().indexOf("shift margin from")&&"None"==Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFrom select").val()?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFrom select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("to")&&-1===rArray[i].toLowerCase().indexOf("shift margin to")&&"None"==Layout.Page.container.find("#ZPAtt_ShiftDetailsImportTo select").val()?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportTo select").select2("val",i):-1===rArray[i].toLowerCase().indexOf("weekend")&&-1===rArray[i].toLowerCase().indexOf("type")||"None"!=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportWeekend select").val()?-1!==rArray[i].toLowerCase().indexOf("allowance")||-1!==rArray[i].toLowerCase().indexOf("amount")||-1!==rArray[i].toLowerCase().indexOf("rate")?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportAllowance select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("mon")?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMonWeekend select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("tue")?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportTueWeekend select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("wed")?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportWedWeekend select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("thu")?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportThuWeekend select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("fri")?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFriWeekend select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("sat")?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSatWeekend select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("sun")?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSunWeekend select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("shift margin")&&-1===rArray[i].toLowerCase().indexOf("shift margin from")&&"None"==Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShiftMargin select").val()?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShiftMargin select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("shift margin from")&&"None"==Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShiftMarginFrom select").val()?Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShiftMarginFrom select").select2("val",i):-1!==rArray[i].toLowerCase().indexOf("shift margin to")&&"None"==Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShiftMarginTo select").val()&&Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShiftMarginTo select").select2("val",i):Layout.Page.container.find("#ZPAtt_ShiftDetailsImportWeekend select").select2("val",i):Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShift select").select2("val",i);if(Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMsg").off("click"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMsg").attr("class","blu"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMsg").parent().fadeIn(300),obj.error&&"rowExceededLimit"===obj.error)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.importcntexceederror"),!0),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").attr("disabled",!0),void Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMsg").text("");var totalRecords=obj.recordCount?obj.recordCount:0;Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMsg").text(totalRecords+" "+ZPI18N.getString("zp.recordsfound"))},submitMapping:function(format){var name=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShift select")[0].selectedIndex,fromTime=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFrom select")[0].selectedIndex,toTime=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportTo select")[0].selectedIndex;if(0!==name&&0!==fromTime&&0!==toTime){var param={mode:"shiftDetailsImport"};param[csrfParamName]=csrfToken;var importColumns={};importColumns.shiftName=name-1,importColumns.from=fromTime-1,importColumns.to=toTime-1;var shiftMargin=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShiftMargin select")[0].selectedIndex,shiftMarginFrom=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShiftMarginFrom select")[0].selectedIndex,shiftMarginTo=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportShiftMarginTo select")[0].selectedIndex;if(0!==shiftMargin&&0!==shiftMarginFrom&&0!==shiftMarginTo)importColumns.margin=shiftMargin-1,importColumns.fromMargin=shiftMarginFrom-1,importColumns.toMargin=shiftMarginTo-1;else if(0!==shiftMargin||0!==shiftMarginFrom||0!==shiftMarginTo)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectmargincols"));var weekendBasedOn=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportWeekend select")[0].selectedIndex;0!==weekendBasedOn&&(importColumns.weekendBasedOn=weekendBasedOn-1);var allowance=Layout.Page.container.find("#ZPAtt_ShiftDetailsImportAllowance select")[0].selectedIndex;0!==allowance&&(importColumns.allowance=allowance-1);var weekendObj={};Attendance.ShiftDetails.pushWeekend(weekendObj,"Mon",Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMonWeekend select")[0].selectedIndex),Attendance.ShiftDetails.pushWeekend(weekendObj,"Tue",Layout.Page.container.find("#ZPAtt_ShiftDetailsImportTueWeekend select")[0].selectedIndex),Attendance.ShiftDetails.pushWeekend(weekendObj,"Wed",Layout.Page.container.find("#ZPAtt_ShiftDetailsImportWedWeekend select")[0].selectedIndex),Attendance.ShiftDetails.pushWeekend(weekendObj,"Thu",Layout.Page.container.find("#ZPAtt_ShiftDetailsImportThuWeekend select")[0].selectedIndex),Attendance.ShiftDetails.pushWeekend(weekendObj,"Fri",Layout.Page.container.find("#ZPAtt_ShiftDetailsImportFriWeekend select")[0].selectedIndex),Attendance.ShiftDetails.pushWeekend(weekendObj,"Sat",Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSatWeekend select")[0].selectedIndex),Attendance.ShiftDetails.pushWeekend(weekendObj,"Sun",Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSunWeekend select")[0].selectedIndex),Object.keys(weekendObj).length>=0&&(importColumns.weekendObj=weekendObj),param.importColumns=JSON.stringify(importColumns),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").attr("disabled",!0),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportView .modal-body").children().not("#ZPAtt_ShiftDetailsImportErrDiv").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportView .modal-body").append(ZPeople.LOADING_HTML),$.post("/AttendanceShiftAction.zp",param,function(resultData){if(Layout.Page.container.find("#ZPAtt_ShiftDetailsImportView .modal-body").find("#zp_page_loading").remove(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportView .modal-body").children().not("#ZPAtt_ShiftDetailsImportErrDiv").show(),resultData.updatedCount>=0)Attendance.ShiftDetails.reFetchShiftdetails(),Attendance.ShiftDetails.resetPreLoadedShiftDetails(),Attendance.ShiftDetails.importSuccess(resultData),resultData.updatedCount>0&&AttendanceShift.depLocShiftList&&AttendanceShift.resetValuesOnShiftChange(),resultData.errorArr&&Attendance.ShiftDetails.showShiftImportError(resultData.errorArr);else if(resultData.fail||resultData.error){var failMsg=resultData.fail?resultData.fail:ZPI18N.getString("zp.unabletoprocess");ZPeople.Message.showFailureMsg(failMsg),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").attr("disabled",!1),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").off("click").on("click",function(){Attendance.ShiftDetails.submitMapping(format)})}})}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))},showShiftImportError:function(errorArr){for(var index in Layout.Page.container.find("#ZPAtt_ShiftDetailsImportErrBody").empty(),errorArr){var indErrorArr=errorArr[index],errorHtml='<tr class="ZPLRow"><td style="width: 35%;">'+ZPI18N.getString("zp.row")+" "+indErrorArr[0]+"</td>";for(var indIndex in errorHtml+="<td>",indErrorArr)0!=indIndex&&(errorHtml+=indErrorArr[indIndex]+"<br>");errorHtml+="</td></tr>",Layout.Page.container.find("#ZPAtt_ShiftDetailsImportErrBody").append(errorHtml)}Layout.Page.container.find("#ZPAtt_ShiftDetailsImportErrDiv").show()},pushWeekend:function(obj,keyName,keyValue){0!==keyValue&&(obj[keyName]=keyValue-1)},importSuccess:function(resultData){Layout.Page.container.find("#ZPAtt_ShiftDetailsImport").parent().parent().attr("class","ZPImfrm ZPRecList"),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMap").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportMsg").parent().hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSuccMsg").fadeIn(300),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSuccvalues").fadeIn(300),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSuccvalues span")[0].innerHTML=Attendance.ShiftDetails.tableDetails.recordCount,Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSuccvalues span")[1].innerHTML=resultData.updatedCount,Layout.Page.container.find("#ZPAtt_ShiftDetailsImportSuccvalues span")[2].innerHTML=resultData.errorArr?resultData.errorArr.length:0,Layout.Page.container.find("#ZPAtt_ShiftDetailsImportPrevious").hide(),Layout.Page.container.find("#ZPAtt_ShiftDetailsImportNext").hide()},marginOptionChange:function(){var layout=Layout.Page.container,inputs=layout.find("#ZPAtt_shiftMarginStartLayout, #ZPAtt_shiftMarginEndLayout");!0===layout.find("input:radio[name=ZPAtt_shiftMarginToggle]")[0].checked?inputs.fadeIn(100):inputs.fadeOut(100)},marginValChange:function(obj){""===obj.value&&Attendance.ShiftDetails.marginDefinition()},marginDefinition:function(){var layout=Layout.Page.container,fromTime=Attendance.Common.convertTimerInputToMinsOrSecs(layout.find("#ZPAtt_newShiftFromTime").val().trim()),toTime=Attendance.Common.convertTimerInputToMinsOrSecs(layout.find("#ZPAtt_newShiftToTime").val().trim()),marginStarts=Attendance.Common.convertTimerInputToMinsOrSecs(layout.find("#ZPAtt_shiftMarginStarts").val().trim(),!1,!0);marginStarts=marginStarts||0;var nonWorking,marginEnds=Attendance.Common.convertTimerInputToMinsOrSecs(layout.find("#ZPAtt_shiftMarginEnds").val().trim(),!1,!0);marginEnds=marginEnds||0,(nonWorking=fromTime>=toTime?(fromTime-toTime)/2:(1440-toTime+fromTime)/2)>480&&(nonWorking=480),marginStarts>nonWorking&&(marginStarts=nonWorking,layout.find("#ZPAtt_shiftMarginStarts").timepicker("setTime",Attendance.disHours(marginStarts,!0))),marginEnds>nonWorking&&(marginEnds=nonWorking,layout.find("#ZPAtt_shiftMarginEnds").timepicker("setTime",Attendance.disHours(marginEnds,!0)));var starts=fromTime-marginStarts;starts=starts<0?starts+1440:starts;var ends=toTime+marginEnds;ends=ends>1439?ends-1440:ends;var duration=Attendance.disTime(starts,!1,!0)+" - "+Attendance.disTime(ends,!1,!0);layout.find("#ZPAtt_shiftMarginDef").text(ZPI18N.getString("zp.shiftmarginnote",new Array(duration)))},constructApplicableFor:function(){APPLICABLEFORKEYS=[ZPPickList.CONSTANTS.DEPARTMENTS,ZPPickList.CONSTANTS.LOCATIONS,ZPPickList.CONSTANTS.DIVISIONS],Layout.Page.container.find("#shiftPickUser").html(ZPPickList.init(APPLICABLEFORKEYS)),Layout.Page.container.find("#shiftPickUser").find("#pickListComp").find(".dropdown-menu").addClass("ZPSchPoP")},constructApplicableForEdit:function(shiftDetails){var deps=shiftDetails.dep,divs=shiftDetails.div,locs=shiftDetails.loc,loc_arr=void 0!=locs?locs.split(","):new Array,dep_arr=void 0!=deps?deps.split(","):new Array,div_arr=void 0!=divs?divs.split(","):new Array;0!=dep_arr.length&&"0"!=dep_arr[0]&&ZPPickList.setSelectedDepartments($.extend([],dep_arr,!0)),0!=div_arr.length&&"0"!=div_arr[0]&&ZPPickList.setSelectedDivisions($.extend([],div_arr,!0)),0!=loc_arr.length&&"0"!=loc_arr[0]&&ZPPickList.setSelectedLocations($.extend([],loc_arr,!0))}},Attendance.SPOC={init:function(){var layout=Layout.Page.container;null===Attendance.SPOC.settingsList&&(layout.css("background","#f9fafc"),layout.find("select[multiple='multiple']").select2({minimumResultsForSearch:5,closeOnSelect:!1,maximumSelectionLength:15}),AttendanceShift.getDepLocShiftList(),Attendance.SPOC.setEmpFormLookUp(),Attendance.SPOC.getGroupsList(),Attendance.SPOC.getSettingsList(),layout.find("select[name='ZPAtt_SPOC_SystemAppl']").on("change",function(){Attendance.SPOC.changeApplicableOption(this)}))},changeApplicableOption:function(obj){var layout=Layout.Page.container,eleId=$(obj).closest(".zp-label").attr("id"),isUser=-1!==(eleId=-1!==eleId.indexOf("_AppField")?eleId.replace("_AppField","_ExpField"):eleId.replace("_ExpField","_AppField")).indexOf("ZPAtt_SPOC_user_"),value=$(obj).select2("val"),parEle=layout.find("#"+eleId);0===value.length?(parEle.removeClass("DN"),isUser&&parEle.prev().removeClass("DN")):(parEle.addClass("DN"),isUser&&parEle.prev().addClass("DN"))},setEmpFormLookUp:function(){var moduleData=ZPeople.Module.MODULE_DATA.attendance,layout=Layout.Page.container,formFields=moduleData.empFormLookUps,li="";for(var i in formFields){var field=formFields[i],dipsName=field.dispName;li+="<li name="+field.fcId+"><a>"+dipsName+"</a></li>"}layout.find("div[id*=ZPAtt_SPOC_empLookUp] ul").html(li).children().off("click").on("click",function(){Attendance.SPOC.getValueFromEmpLookUp(this)})},formCompFieldOptions:{},getValueFromEmpLookUp:function(obj){obj=$(obj);var fcId=$(obj).attr("name"),appExp="ZPAtt_SPOC_empLookUp_AppFields"===obj.closest(".zp-label").attr("id")?"AppField":"ExpField";if(Attendance.SPOC.formCompFieldOptions[fcId])Attendance.SPOC.consFormFields(obj,fcId,appExp);else{var param={mode:"getOptionForFormFeilds",conreqcsr:csrfToken,fcId:fcId};$.post("/AttendanceShiftAction.zp",param,function(rdata){var fieldValues=rdata.fieldValues[fcId];Attendance.SPOC.formCompFieldOptions[fcId]=fieldValues,Attendance.SPOC.consFormFields(obj,fcId,appExp)})}},consFormFields:function(obj,fcId,appExp){var layout=Layout.Page.container,lookUps=ZPeople.Module.MODULE_DATA.attendance.empFormLookUps,closest=obj.closest("div").parent(),optionhtml=Attendance.SPOC.consFormOptions(fcId,lookUps,appExp);if(""!==optionhtml){closest.before(optionhtml),closest.prev().find("select").select2({minimumResultsForSearch:5,closeOnSelect:!1});var eleId=$(obj).closest(".zp-label").attr("id");eleId=-1!==eleId.indexOf("_AppField")?eleId.replace("_AppField","_ExpField"):eleId.replace("_ExpField","_AppField"),layout.find("#ZPAtt_SPOC_empLookUp_AppFields li[name='"+fcId+"'],#ZPAtt_SPOC_empLookUp_ExpFields li[name='"+fcId+"']").remove()}},consFormOptions:function(fcId,lookUps,appExc){var formOptions=Attendance.SPOC.formCompFieldOptions[fcId];if(!formOptions)return"";void 0===lookUps&&(lookUps=ZPeople.Module.MODULE_DATA.attendance.empFormLookUps);var dispName=lookUps[fcId].dispName,htmlCont='<div class="zp-label Rflds" id="ZPAtt_lookUp_'+appExc+"_"+fcId+'"><label class="zplt-label">'+$("<div/>").text(dispName).html()+'</label><div class="W300 DIB"><select multiple="multiple" name="'+fcId+'">';for(var i in formOptions){var value=formOptions[i];htmlCont+="<option value='"+value.optionId+"'>"+$("<div/>").text(value.optionVal).html()+"</option>"}return htmlCont+='</select><i class="IC-cls-fill S13 red ML10 CP" onclick=Attendance.SPOC.removeCustomField(this);></i></div></div>'},removeCustomField:function(obj){var ele=$(obj),fcId=ele.prev().attr("name"),fields=ZPeople.Module.MODULE_DATA.attendance.empFormLookUps[fcId],dipsName=fields.dispName;fcId=fields.fcId;Layout.Page.container.find("div[id*=ZPAtt_SPOC_empLookUp] ul").append("<li name="+fcId+"><a>"+dipsName+"</a></li>").children().off("click").on("click",function(){Attendance.SPOC.getValueFromEmpLookUp(this)}),ele.closest(".Rflds").remove()},currSettId:null,populateSettingsOptions:function(show,obj){var layout=Layout.Page.container;if(show){if(layout.find("#ZPAtt_SPOCAddSettingsPopup").modal("show"),layout.find("#ZPAtt_SPOCSettingsName").val(""),layout.find("#ZPAtt_SPOCUser_AddAdmin,#ZPAtt_SPOCGroupsSelect").select2("val",""),layout.find("#ZPAtt_SPOCAddSettingsPopup input[type=checkbox]").prop("checked",!1),layout.find("#ZPAtt_SPOCViewShiftEnabled,#ZPAtt_SPOCEditShiftEnabled").prop("checked",!0),layout.find("#s2id_ZPAtt_SPOCUser_AddAdmin")[0]||Attendance.consResetEmpSearch("ZPAtt_SPOCUser_AddAdmin",layout,!0),Attendance.SPOC.entryViewChange(),Attendance.SPOC.currSettId=null,obj){var settingsId=$(obj).attr("id");Attendance.SPOC.currSettId=settingsId;var list=Attendance.SPOC.settingsList[settingsId];layout.find("#ZPAtt_SPOCSettingsName").val(list.settingsName),layout.find("#ZPAtt_SPOCViewAttEnabled").prop("checked",1===list.viewAttEntry),layout.find("#ZPAtt_SPOCEditAttEnabled").prop("checked",1===list.editAttEntry),layout.find("#ZPAtt_SPOCViewShiftEnabled").prop("checked",1===list.viewShiftMap),layout.find("#ZPAtt_SPOCEditShiftEnabled").prop("checked",1===list.editShiftMap),layout.find("#ZPAtt_SPOCEViewReportEnabled").prop("checked",1===list.viewAttReport),layout.find("#ZPLveEntry_ViewEnabled").length>0&&(layout.find("#ZPLveEntry_ViewEnabled").prop("checked",1===list.viewLvEntry),layout.find("#ZPLveEntry_EditEnabled").prop("checked",1===list.editLvEntry),layout.find("#ZPLveReport_ViewEnabled").prop("checked",1===list.viewLvReport)),Attendance.SPOC.entryViewChange();var groupIds=list.groupIds,userIds=list.userIds;if(0!==groupIds.length&&layout.find("#ZPAtt_SPOCGroupsSelect").select2("val",groupIds),0!==userIds.length){var userList=ZPeople.getUserDetailsByIds(userIds,!1),values=[];for(var i in userIds){var id=userIds[i],userDtl=ZPeople.getUserDetailsByIdInList(id,userList);userDtl&&userDtl.name&&values.push({id:id,text:ZPeople.decodeTxt(userDtl.name),html:userDtl.name,photo:userDtl.photo})}layout.find("#ZPAtt_SPOCUser_AddAdmin").select2("data",values)}}}else layout.find("#ZPAtt_SPOCAddSettingsPopup").modal("hide")},groupMappingList:{},currGroupId:null,populateGroupOptions:function(obj,show){var layout=Layout.Page.container;if(show){var groupId;layout.find("#ZPAtt_SPOCAddGroupPopup").modal("show"),$(".modal-backdrop.in").last().css("z-index","996"),layout.find("#ZPAtt_SPOCHeadAppli").addClass("active").siblings().removeClass("active"),layout.find("#ZPAtt_SPOCApplicables").removeClass("DN"),layout.find("#ZPAtt_SPOCExceptions").addClass("DN"),layout.find("#ZPAtt_SPOCGroupName").val(""),layout.find("#ZPAtt_SPOCApplicables select,#ZPAtt_SPOCExceptions select").select2("val",""),layout.find("#ZPAtt_SPOCUser_AppField_user,#ZPAtt_SPOCUser_ExpField_user").select2("val",""),layout.find("#ZPAtt_SPOCApplicables .zp-label,#ZPAtt_SPOCExceptions .zp-label").removeClass("DN"),layout.find("div[id*=ZPAtt_lookUp_]").remove(),Attendance.SPOC.setEmpFormLookUp(),Attendance.SPOC.currGroupId=null,layout.find("#s2id_ZPAtt_SPOCUser_AppField_user")[0]||(Attendance.SPOC.populateApplicableOptions(),Attendance.consResetEmpSearch("ZPAtt_SPOCUser_AppField_user",layout,!0),Attendance.consResetEmpSearch("ZPAtt_SPOCUser_ExpField_user",layout,!0),layout.find("#ZPAtt_SPOCUser_AppField_user,#ZPAtt_SPOCUser_AppField_user").on("change",function(){Attendance.SPOC.changeApplicableOption(this)}));var divId=$(obj).attr("id");if(void 0!==divId&&"ZPAtt_SPOCAddGroup"!==divId&&(groupId=$(obj).attr("id")),groupId){Attendance.SPOC.currGroupId=groupId;var mappings=Attendance.SPOC.groupMappingList[groupId];if(layout.find("#ZPAtt_SPOCGroupName").val(Attendance.SPOC.groupsList[groupId]),void 0!==mappings)Attendance.SPOC.populateGroupMappings(mappings);else{var param={mode:"getGroupMappings",conreqcsr:csrfToken,groupId:groupId};$.post("/AttendanceShiftAction.zp",param,function(rdata){var mapp=rdata.groupList;Attendance.SPOC.groupMappingList[groupId]=mapp,Attendance.SPOC.populateGroupMappings(mapp)})}}}else layout.find("#ZPAtt_SPOCAddGroupPopup").modal("hide")},populateGroupMappings:function(mappings){var layout=Layout.Page.container,appList=mappings.applicableObj,expList=mappings.exceptionObj,appFormField=mappings.appFormFieldObj,expFormField=mappings.expFormFieldObj,formCompOptions=mappings.formCompOptions;for(var i in appList){var val=appList[i];layout.find("#ZPAtt_SPOC_"+i+"_ExpField").addClass("DN"),"user"===i?Attendance.SPOC.consGroupMapUsers(val,"AppField","ExpField"):layout.find("#ZPAtt_SPOC_"+i+"_AppField select").select2("val",val)}for(var k in expList){val=expList[k];layout.find("#ZPAtt_SPOC_"+k+"_AppField").addClass("DN"),"user"===k?Attendance.SPOC.consGroupMapUsers(val,"ExpField","AppField"):layout.find("#ZPAtt_SPOC_"+k+"_ExpField select").select2("val",val)}var lookUps=ZPeople.Module.MODULE_DATA.attendance.empFormLookUps,appField=layout.find("#ZPAtt_SPOC_empLookUp_AppFields");for(var j in appFormField)Attendance.SPOC.formCompFieldOptions[j]=formCompOptions[j],appField.before(Attendance.SPOC.consFormOptions(j,lookUps,"AppField")),appField.prev().find("select").select2({minimumResultsForSearch:5,closeOnSelect:!1}).select2("val",appFormField[j]),layout.find("#ZPAtt_SPOC_empLookUp_AppFields li[name='"+j+"'],#ZPAtt_SPOC_empLookUp_ExpFields li[name='"+j+"']").remove();var expField=layout.find("#ZPAtt_SPOC_empLookUp_ExpFields");for(var l in expFormField)Attendance.SPOC.formCompFieldOptions[l]=formCompOptions[l],expField.before(Attendance.SPOC.consFormOptions(l,lookUps,"ExpField")),expField.prev().find("select").select2({minimumResultsForSearch:5,closeOnSelect:!1}).select2("val",expFormField[l]),layout.find("#ZPAtt_SPOC_empLookUp_AppFields li[name='"+l+"'],#ZPAtt_SPOC_empLookUp_ExpFields li[name='"+l+"']").remove()},consGroupMapUsers:function(val,showClass,hideClass){var layout=Layout.Page.container;layout.find("#ZPAtt_SPOC_user_"+hideClass).prev().addClass("DN");var userList=ZPeople.getUserDetailsByIds(val,!1),values=[];for(var i in val){var id=val[i],userDtl=ZPeople.getUserDetailsByIdInList(id,userList);userDtl&&userDtl.name&&values.push({id:id,text:ZPeople.decodeTxt(userDtl.name),html:userDtl.name,photo:userDtl.photo})}layout.find("#ZPAtt_SPOCUser_"+showClass+"_user").select2("data",values)},populateApplicableOptions:function(){var layout=Layout.Page.container;isOrgStructureEnabled||layout.find("#ZPAtt_SPOC_OrgStrut_AppField,#ZPAtt_SPOC_OrgStrut_ExpField").remove();var mapOpt=AttendanceShift.depLocShiftOptions;layout.find("#ZPAtt_SPOC_loc_AppField select, #ZPAtt_SPOC_loc_ExpField select").html(mapOpt.locOption),layout.find("#ZPAtt_SPOC_dept_AppField select, #ZPAtt_SPOC_dept_ExpField select").html(mapOpt.depOption),layout.find("#ZPAtt_SPOC_desg_AppField select, #ZPAtt_SPOC_desg_ExpField select").html(mapOpt.desgOption),layout.find("#ZPAtt_SPOC_role_AppField select, #ZPAtt_SPOC_role_ExpField select").html(mapOpt.roleOption),isOrgStructureEnabled?(layout.find("#ZPAtt_SPOC_entity_AppField select, #ZPAtt_SPOC_entity_ExpField select").html(mapOpt.entityOption),layout.find("#ZPAtt_SPOC_busiUnit_AppField select, #ZPAtt_SPOC_busiUnit_ExpField select").html(mapOpt.bUnitOption),layout.find("#ZPAtt_SPOC_division_AppField select, #ZPAtt_SPOC_division_ExpField select").html(mapOpt.divisionOption)):layout.find("#ZPAtt_SPOC_OrgStrut_AppField,#ZPAtt_SPOC_OrgStrut_ExpField").remove()},saveSPOCSettings:function(){var layout=Layout.Page.container,settName=layout.find("#ZPAtt_SPOCSettingsName").val().trim(),adminIds=layout.find("#ZPAtt_SPOCUser_AddAdmin").select2("val"),groupIds=layout.find("#ZPAtt_SPOCGroupsSelect").select2("val");if(layout.find("#ZPAtt_SPOCAddSettingsPopup .ERR").remove(),""!==settName)if(0!==adminIds.length)if(0!==groupIds.length){var viewAttEntry=layout.find("#ZPAtt_SPOCViewAttEnabled").is(":checked")?1:0,editAttEntry=layout.find("#ZPAtt_SPOCEditAttEnabled").is(":checked")?1:0,viewShiftMap=layout.find("#ZPAtt_SPOCViewShiftEnabled").is(":checked")?1:0,editShiftMap=layout.find("#ZPAtt_SPOCEditShiftEnabled").is(":checked")?1:0,viewAttReport=layout.find("#ZPAtt_SPOCEViewReportEnabled").is(":checked")?1:0,viewLeaveEntry=0,viewLeaveReport=0;layout.find("#ZPLveEntry_ViewEnabled").length>0&&(viewLeaveEntry=layout.find("#ZPLveEntry_ViewEnabled").is(":checked")?1:0,layout.find("#ZPLveEntry_EditEnabled").is(":checked")?1:0,viewLeaveReport=layout.find("#ZPLveReport_ViewEnabled").is(":checked")?1:0);var param={mode:"saveSPOCSetting",conreqcsr:csrfToken,settingsName:settName,groupIds:JSON.stringify(groupIds),adminIds:JSON.stringify(adminIds),viewAttEntry:viewAttEntry,editAttEntry:editAttEntry,viewShiftMap:viewShiftMap,editShiftMap:editShiftMap,viewAttReport:viewAttReport,viewLvEntry:viewLeaveEntry,editLvEntry:0,viewLvReport:viewLeaveReport};Attendance.SPOC.currSettId&&(param.settingsId=Attendance.SPOC.currSettId),$.post("/AttendanceShiftAction.zp",param,function(rdata){rdata&&rdata.error&&"adminIdPresent"===rdata.error?layout.find("#ZPAtt_SPOCUser_AddAdmin").after("<span class='ERR MT5'>"+ZPI18N.getString("zp.adminusercannotshiftadmin")+"</span>"):(Attendance.SPOC.getSettingsList(),layout.find("#ZPAtt_SPOCAddSettingsPopup").modal("hide"))})}else layout.find("#ZPAtt_SPOCGroupsSelect").after("<span class='ERR MT5'>"+ZPI18N.getString("zp.groupismandat")+"</span>");else layout.find("#ZPAtt_SPOCUser_AddAdmin").after("<span class='ERR MT5'>"+ZPI18N.getString("zp.adminismandat")+"</span>");else layout.find("#ZPAtt_SPOCSettingsName").after("<span class='ERR MT5'>"+ZPI18N.getString("zp.nameismandat")+"</span>")},saveSPOCGroup:function(){var layout=Layout.Page.container,gName=layout.find("#ZPAtt_SPOCGroupName").val().trim();if(layout.find("#ZPAtt_SPOCAddGroupPopup .ERR").remove(),""!==gName){var applicableFor={},appForLookUp={},exceptFor={},exceptForLookUp={};if(Attendance.SPOC.getApplData(applicableFor,appForLookUp,!0),Attendance.SPOC.getApplData(exceptFor,exceptForLookUp,!1),0!==Object.keys(applicableFor).length||0!==Object.keys(appForLookUp).length||0!==Object.keys(exceptFor).length||0!==Object.keys(exceptForLookUp).length){var param={mode:"saveSPOCGroup",conreqcsr:csrfToken,applicableFor:JSON.stringify(applicableFor),exceptFor:JSON.stringify(exceptFor),appForLookUp:JSON.stringify(appForLookUp),exceptForLookUp:JSON.stringify(exceptForLookUp),groupName:gName},groupId=Attendance.SPOC.currGroupId;groupId&&(param.groupId=groupId),$.post("/AttendanceShiftAction.zp",param,function(rdata){delete Attendance.SPOC.groupMappingList[groupId];var grpId=null;layout.find("#ZPAtt_SPOCGroupsList_Popup").hasClass("in")||(grpId=rdata.groupId),Attendance.SPOC.getGroupsList(grpId),layout.find("#ZPAtt_SPOCAddGroupPopup").modal("hide")})}else ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.applicablemandat"))}else layout.find("#ZPAtt_SPOCGroupName").after("<span class='ERR MT5'>"+ZPI18N.getString("zp.nameismandat")+"</span>")},getApplData:function(appFor,appForLookUp,type){for(var layout=Layout.Page.container,mapping=["loc","dept","desg","role","entity","busiUnit","division","user"],appclass=type?"AppField":"ExpField",mapLen=mapping.length,i=0;i<mapLen;i++){var applArr,field=mapping[i];0!==(applArr=i===mapLen-1?layout.find("#ZPAtt_SPOCUser_"+appclass+"_user").select2("val"):layout.find("#ZPAtt_SPOC_"+field+"_"+appclass+" select").select2("val")).length&&(appFor[mapping[i]]=applArr)}layout.find("div[id*=ZPAtt_lookUp_"+appclass+"] select").each(function(i,ele){var val=(ele=$(ele)).select2("val");if(0!==val.length){var fcId=ele.attr("name");appForLookUp[fcId]=val}})},switchApplicable:function(obj){var layout=Layout.Page.container;$(obj).addClass("active").siblings().removeClass("active"),"ZPAtt_SPOCHeadAppli"===obj.id?(layout.find("#ZPAtt_SPOCApplicables").removeClass("DN"),layout.find("#ZPAtt_SPOCExceptions").addClass("DN")):(layout.find("#ZPAtt_SPOCApplicables").addClass("DN"),layout.find("#ZPAtt_SPOCExceptions").removeClass("DN"))},settingsList:null,getSettingsList:function(){var layout=Layout.Page.container,param={mode:"getAllSPOCSettings",conreqcsr:csrfToken};null===Attendance.SPOC.settingsList&&layout.find("#ZPAtt_SPOCSettingsList").append(ZPeople.LOADING_HTML),$.post("/AttendanceShiftAction.zp",param,function(rdata){layout.find("#ZPAtt_SPOCSettingsList #zp_page_loading").remove(),Attendance.SPOC.settingsList=rdata.settingsList,Attendance.SPOC.consSettingsList()})},consSettingsList:function(){var layout=Layout.Page.container,list=Attendance.SPOC.settingsList,tableCont=layout.find("#ZPAtt_SPOCSettingsTable");if(0===Object.keys(list).length){layout.find("#ZPAtt_SPOCSettingsList .spoc_cnt").hide();var emptyMsg=layout.find("#ZPAtt_SPOCSettingsemptyRecInfo").show();return 0===emptyMsg.find("i").eq(0).children().length&&Attendance.noDataImg(8,"CR-at-shift-cal",emptyMsg.find("i").eq(0)),void tableCont.html("")}layout.find("#ZPAtt_SPOCSettingsList .spoc_cnt").show(),layout.find("#ZPAtt_SPOCSettingsemptyRecInfo").hide();var cont="<tbody class='CP'>";for(var i in list){var settings=list[i];cont+="<tr id='"+i+"' onclick=Attendance.SPOC.populateSettingsOptions(true,this)>",cont+="<td width='20%'><b>"+$("<div/>").text(settings.settingsName).html()+"</b></td>",cont+="<td width='20%'>";var userDet=settings.users;for(var k in userDet){if(cont+="<div class='zpusImg'><img class='img-26' src='"+(det=userDet[k]).empPhoto+"'>",cont+="<div class='zpusImg_nme'><span><b>"+$("<div/>").text(det.empId).html()+" - </b> "+$("<div/>").text(det.empName).html()+"</span></div></div>","1"===k&&void 0!==userDet[parseInt(k)+1]){cont+="<span class='DB'>  + "+(Object.keys(userDet).length-2)+" "+ZPI18N.getString("zp.more")+"</span>";break}}cont+="</td>",cont+="<td width='20%'>";var groupDet=settings.groups;for(var l in groupDet){var det=groupDet[l];if(cont+="<span class='grp_tg'>"+$("<div/>").text(det.groupName).html()+"</span>","1"===l&&void 0!==groupDet[parseInt(l)+1]){cont+="<span class='DB'>  + "+(Object.keys(groupDet).length-2)+" "+ZPI18N.getString("zp.more")+"</span>";break}}cont+="</td>",cont+="<td width='20%'><div class='crd_actns'><i class='CR-ed-pen MR10'></i><i class='CR-ed-delete' onclick=Attendance.SPOC.delSettPopup(this,event)></i></div></td>"}tableCont.html(cont)},entryViewChange:function(){var layout=Layout.Page.container,editButt=layout.find("#ZPAtt_SPOCEditAttEnabled");editButt.prop("disabled",!1),layout.find("#ZPAtt_SPOCViewAttEnabled").is(":checked")||(editButt.prop("checked",!1),editButt.prop("disabled",!0));var editSButt=layout.find("#ZPAtt_SPOCEditShiftEnabled");editSButt.prop("disabled",!1),layout.find("#ZPAtt_SPOCViewShiftEnabled").is(":checked")||(editSButt.prop("checked",!1),editSButt.prop("disabled",!0))},delSettPopup:function(obj,event){event.stopPropagation();var popup=$("#confirmationPopup");popup.modal({backdrop:"static",keyboard:!1});var popupConf=$("#confirmConfirmationPopup"),popupCancel=$("#cancelConfirmationPopup");popupConf.removeClass("btn-primary").addClass("btn-danger"),popupConf.html("").append(ZPI18N.getString("zp.delete")),$("#textConfirmationPopupBody").html(ZPI18N.getString("zp.deleteshiftadminconfirmmsg")),popupConf.off("click").on(function(event){Attendance.SPOC.deleteSettings(obj)}),popupCancel.off("click").on(function(event){popup.modal("hide")})},deleteSettings:function(obj){var settId=$(obj).closest("tr").attr("id"),param={mode:"deletSPOCSetting",conreqcsr:csrfToken,settingsId:settId};$.post("/AttendanceShiftAction.zp",param,function(){$("#"+settId).remove(),delete Attendance.SPOC.settingsList[settId];var layout=Layout.Page.container;if(0===Object.keys(Attendance.SPOC.settingsList).length){layout.find("#ZPAtt_SPOCSettingsList .spoc_cnt").hide();var emptyMsg=layout.find("#ZPAtt_SPOCSettingsemptyRecInfo").show();0===emptyMsg.find("i").eq(0).children().length&&Attendance.noDataImg(8,"CR-at-shift-cal",emptyMsg.find("i").eq(0))}})},groupsList:null,getGroupsList:function(groupId){var layout=Layout.Page.container,param={mode:"getAllSPOCGroups",conreqcsr:csrfToken};$.post("/AttendanceShiftAction.zp",param,function(rdata){var groupList=rdata.groupList;Attendance.SPOC.groupsList=groupList;var listkeys=Object.keys(groupList),selectHtml="",html='<div class="zp-sm-4" onclick="Attendance.SPOC.populateGroupOptions(this,true);"><div class="spoc_Crd ad_grp CP"><div class="add_admn"><span class="CR-addemp S22"><span class="path1"></span><span class="path2"></span></span>';for(var key in html+='<h5 class="S14">'+ZPI18N.getString("zp.addshiftgroup")+' </h5></div><p class="">'+ZPI18N.getString("zp.spocgroupconfigdesc")+"</p></div></div>",listkeys){var value=listkeys[key];html+='<div class="zp-sm-4" onclick="Attendance.SPOC.populateGroupOptions(this,true);" id="'+value+'"><div class="spoc_Crd grp CP"><div class="grp_tit">'+$("<div/>").text(groupList[value]).html()+'</div><div class="grp_crd_actns">',html+='<i class="IC-pen MR10 FR"></i><i class="IC-delete FR" onclick=Attendance.SPOC.showHideSPOCGroupDel(this,true,event)></i></div></div></div>',selectHtml+="<option value='"+value+"'>"+groupList[value]+"</option>"}layout.find("#ZPAtt_SPOCGroupsList").html(html);var groupsSelect=layout.find("#ZPAtt_SPOCGroupsSelect"),groupsSelectVal=groupsSelect.select2("val");groupsSelect.html(selectHtml),groupId&&groupsSelectVal.push(groupId),groupsSelect.select2("val",groupsSelectVal)})},showHideSPOCGroupDel:function(obj,show,event){event.stopPropagation();var parent=$(obj).closest(".spoc_Crd");if(show){parent.addClass("dlt_opt");var confMsg='<div class="zp_popdete" onclick=Attendance.SPOC.delLayClick(event)><div class="zp_popdetebx"><span>'+ZPI18N.getString("zp.deleteshiftgroupconfirmmsg")+"</span>";confMsg+='<a class="zp_popdetecf" onclick=Attendance.SPOC.delSPOCGroup(this,event)>Confirm</a><a class="zp_popdetecl" onclick=Attendance.SPOC.showHideSPOCGroupDel(this,false,event)>Cancel</a></div></div>',parent.append(confMsg)}else parent.removeClass("dlt_opt"),parent.children().last().remove()},delSPOCGroup:function(obj,event){event.stopPropagation();var layout=Layout.Page.container,parent=$(obj).closest(".zp-sm-4"),groupId=parent.attr("id"),param={mode:"deletSPOCGroup",conreqcsr:csrfToken,groupId:groupId};$.post("/AttendanceShiftAction.zp",param,function(rdata){parent.remove();var groupsSelect=layout.find("#ZPAtt_SPOCGroupsSelect"),groupsSelectVal=groupsSelect.select2("val");layout.find("#ZPAtt_SPOCGroupsSelect option[value='"+groupId+"']").remove();var index=groupsSelectVal.indexOf(groupId);index>-1&&groupsSelectVal.splice(index,1),groupsSelect.select2("val",groupsSelectVal)})},delLayClick:function(event){event.stopPropagation()}},GeoRestriction={map_elem:"<div class='ZPlocmap' id='tempMapid' style='height:450px;width:100%;border:0;'></div>",filterEdited:!1,allI18NKeys:{role:"zp.allroles",location:"zp.alllocation",desg:"zp.alldesignation",department:"zp.alldepartment",users:"zp.allemployees"},init:function(){Layout.Page.container.find("#"+Layout.Page.pageId+"_map")[0]&&!$("#ZPAtt_mapCont")[0]||($("#ZPAtt_mapCont").remove(),$(".ZPlocmap").remove(),Layout.Page.container.find("#maplocid").prepend(GeoRestriction.map_elem),$("#tempMapid").attr("id",Layout.Page.pageId+"_map"),ZPMaps.staticLoadedForGeo&&ZPMaps.loadMap(null,null,!0,Layout.Page.pageId+"_map")),ZPMaps.staticLoadedForGeo||ZPMaps.loadStaticForGeo(Layout.Page.pageId+"_map"),GeoRestriction.geoDetails?GeoRestriction.constructMapDetails(GeoRestriction.geoDetails):GeoRestriction.getGeoDetails(),GeoRestriction.constructApplicableFor(),GeoRestriction.filterEdited=!1,GeoRestriction.contructfilterOptions(),Layout.Page.container.find("#addreq #moduleSelect").select2()},toggleFilter:function(){if($("#"+Layout.Page.pageId+" #geoRestriction_filter").hasClass("ZPFilsel"))$("#"+Layout.Page.pageId+" #geoRestriction_filter").removeClass("blu ZPFilsel"),$("#"+Layout.Page.pageId+" #geoRestrict_FiltersList").attr("class","ZPFilMain"),$("#"+Layout.Page.pageId+" #geoRestrict_filterCloseButton").hide(),$("#page-wrapper").attr("class","Nbar2");else if($("#"+Layout.Page.pageId+" #geoRestriction_filter").addClass("blu ZPFilsel"),$("#"+Layout.Page.pageId+" #geoRestrict_FiltersList").attr("class","ZPFilMain TEbnd"),$("#"+Layout.Page.pageId+" #geoRestrict_filterCloseButton").show(),$("#page-wrapper").attr("class","Nbar2F"),$("#"+Layout.Page.pageId+" #geoRestrict_FiltersList .col-md-2").children().length>5?($("#page-wrapper").attr("class","Nbar2F2"),$("#"+Layout.Page.pageId+" #geoRestrict_FiltersList").attr("class","ZPFilMain TEbnd1")):($("#page-wrapper").attr("class","Nbar2F"),$("#"+Layout.Page.pageId+" #geoRestrict_FiltersList").attr("class","ZPFilMain TEbnd")),!GeoRestriction.filterEdited){var applDiv=Layout.Page.container.find("#zp_geoFilter_applicable");GeoRestriction.togglePlaceholder(applDiv.find("#geoRestrict_department"),GeoRestriction.allI18NKeys.department),GeoRestriction.togglePlaceholder(applDiv.find("#geoRestrict_desg"),GeoRestriction.allI18NKeys.desg),GeoRestriction.togglePlaceholder(applDiv.find("#geoRestrict_location"),GeoRestriction.allI18NKeys.location),GeoRestriction.togglePlaceholder(applDiv.find("#geoRestrict_role"),GeoRestriction.allI18NKeys.role),GeoRestriction.togglePlaceholder(applDiv.find("#appl_geoRestrict_users"),GeoRestriction.allI18NKeys.users,"users")}},resetFilterInputs:function(){var applicableFilter=Layout.Page.container.find("#zp_geoFilter_applicable");applicableFilter.find("#geoRestrict_department").select2("val",0),applicableFilter.find("#geoRestrict_desg").select2("val",0),applicableFilter.find("#geoRestrict_location").select2("val",0),applicableFilter.find("#geoRestrict_role").select2("val",0),applicableFilter.find("#appl_geoRestrict_users").select2("val","");var exceptionFilter=Layout.Page.container.find("#zp_geoFilter_exception");exceptionFilter.find("#geoRestrict_department").select2("val",""),exceptionFilter.find("#geoRestrict_desg").select2("val",""),exceptionFilter.find("#geoRestrict_location").select2("val",""),exceptionFilter.find("#geoRestrict_role").select2("val",""),exceptionFilter.find("#except_geoRestrict_users").select2("val",""),Layout.Page.container.find("#geoRestrict_FiltersList").find("#geoRestrict_name").val("")},populateFilterOptions:function(tagname,options,id){var select=Layout.Page.container.find(id).find("select[name="+tagname+"]");for(var id in select.select2({closeOnSelect:!1}),options){var obj=options[id];$(select).append(ZP.create("option",{value:obj.recID,text:ZPeople.decodeTxt(obj.recName)}))}},contructfilterOptions:function(){Layout.Page.container.find("#geoRestrict_FiltersList").find("#geoRestrict_name").children().remove();var applicableFilter=Layout.Page.container.find("#zp_geoFilter_applicable");applicableFilter.find("#geoRestrict_department").children().remove(),applicableFilter.find("#geoRestrict_desg").children().remove(),applicableFilter.find("#geoRestrict_location").children().remove(),applicableFilter.find("#geoRestrict_role").children().remove(),applicableFilter.find("#appl_geoRestrict_users").children().remove();var exceptionFilter=Layout.Page.container.find("#zp_geoFilter_exception");exceptionFilter.find("#geoRestrict_department").children().remove(),exceptionFilter.find("#geoRestrict_desg").children().remove(),exceptionFilter.find("#geoRestrict_location").children().remove(),exceptionFilter.find("#geoRestrict_role").children().remove(),exceptionFilter.find("#except_geoRestrict_users").children().remove(),GeoRestriction.userInputSelect2(applicableFilter.find("#appl_geoRestrict_users_div").find("input[name=users]")),GeoRestriction.userInputSelect2(exceptionFilter.find("#except_geoRestrict_users_div").find("input[name=users]")),GeoRestriction.populateFilterOptions("department",ZPPickList.allDepartments,"#zp_geoFilter_applicable"),GeoRestriction.populateFilterOptions("desg",ZPPickList.allDesignations,"#zp_geoFilter_applicable"),GeoRestriction.populateFilterOptions("role",ZPPickList.allRoles,"#zp_geoFilter_applicable"),GeoRestriction.populateFilterOptions("location",ZPPickList.allLocations,"#zp_geoFilter_applicable"),GeoRestriction.populateFilterOptions("department",ZPPickList.allDepartments,"#zp_geoFilter_exception"),GeoRestriction.populateFilterOptions("desg",ZPPickList.allDesignations,"#zp_geoFilter_exception"),GeoRestriction.populateFilterOptions("role",ZPPickList.allRoles,"#zp_geoFilter_exception"),GeoRestriction.populateFilterOptions("location",ZPPickList.allLocations,"#zp_geoFilter_exception")},getToggleSearch:function(){GeoRestriction.getGeoDetails(!0),GeoRestriction.toggleFilter()},filterValuesOnChange:function(select,type){var name=$(select).attr("name");GeoRestriction.filterEdited=!0;var isApplicable="appl"==type,oppmodal=isApplicable?Layout.Page.container.find("#zp_geoFilter_exception"):Layout.Page.container.find("#zp_geoFilter_applicable"),curmodal=isApplicable?Layout.Page.container.find("#zp_geoFilter_applicable"):Layout.Page.container.find("#zp_geoFilter_exception"),divId="#geoRestrict_"+name,oppdivId="#geoRestrict_"+name;"users"==name&&(divId=isApplicable?"#appl_geoRestrict_users":"#except_geoRestrict_users",oppdivId=isApplicable?"#except_geoRestrict_users":"#appl_geoRestrict_users");var oppEle,values=curmodal.find(divId).val();values&&0!=values[0]&&values.length>0?("users"==name&&isApplicable?(0==curmodal.find("#geoRestrict_department").val()&&GeoRestriction.togglePlaceholder(curmodal.find("#geoRestrict_department"),""),0==curmodal.find("#geoRestrict_desg").val()&&GeoRestriction.togglePlaceholder(curmodal.find("#geoRestrict_desg"),""),0==curmodal.find("#geoRestrict_location").val()&&GeoRestriction.togglePlaceholder(curmodal.find("#geoRestrict_location"),""),0==curmodal.find("#geoRestrict_role").val()&&GeoRestriction.togglePlaceholder(curmodal.find("#geoRestrict_role"),"")):"users"!=name&&isApplicable&&""==curmodal.find("#appl_geoRestrict_users").val()&&GeoRestriction.togglePlaceholder(curmodal.find("#appl_geoRestrict_users"),"","users"),(oppEle=oppmodal.find(oppdivId)).select2("val",""),oppmodal.find(oppdivId+"_div").addClass("DN")):("users"==name&&isApplicable?(0==curmodal.find("#geoRestrict_department").val()&&(GeoRestriction.togglePlaceholder(curmodal.find("#geoRestrict_department"),GeoRestriction.allI18NKeys.department),curmodal.find("#geoRestrict_department").select2("val",0)),0==curmodal.find("#geoRestrict_desg").val()&&(GeoRestriction.togglePlaceholder(curmodal.find("#geoRestrict_desg"),GeoRestriction.allI18NKeys.desg),curmodal.find("#geoRestrict_desg").select2("val",0)),0==curmodal.find("#geoRestrict_location").val()&&(GeoRestriction.togglePlaceholder(curmodal.find("#geoRestrict_location"),GeoRestriction.allI18NKeys.location),curmodal.find("#geoRestrict_location").select2("val",0)),0==curmodal.find("#geoRestrict_role").val()&&(GeoRestriction.togglePlaceholder(curmodal.find("#geoRestrict_role"),GeoRestriction.allI18NKeys.role),curmodal.find("#geoRestrict_role").select2("val",0))):"users"!=name&&isApplicable&&""==curmodal.find("#appl_geoRestrict_users").val()&&0==curmodal.find("#geoRestrict_department").val()&&0==curmodal.find("#geoRestrict_desg").val()&&0==curmodal.find("#geoRestrict_location").val()&&0==curmodal.find("#geoRestrict_role").val()&&GeoRestriction.togglePlaceholder(curmodal.find("#appl_geoRestrict_users"),GeoRestriction.allI18NKeys.users,"users"),(oppEle=oppmodal.find(oppdivId)).parents(oppdivId+"_div").removeClass("DN"),isApplicable&&0!=curmodal.find("#appl_geoRestrict_users").val()&&GeoRestriction.togglePlaceholder(curmodal.find(divId),""),isApplicable||""!=oppmodal.find("#appl_geoRestrict_users").val()||0!=oppmodal.find("#geoRestrict_department").val()||0!=oppmodal.find("#geoRestrict_desg").val()||0!=oppmodal.find("#geoRestrict_location").val()||0!=oppmodal.find("#geoRestrict_role").val()||GeoRestriction.togglePlaceholder(oppmodal.find("#appl_geoRestrict_users"),GeoRestriction.allI18NKeys.users,"users"),isApplicable||oppEle.select2("val",""))},switchApplicableFilterTabs:function(ele){if("appl"==$(ele).attr("id")){var applDiv=Layout.Page.container.find("#zp_geoFilter_applicable");applDiv.removeClass("DN"),Layout.Page.container.find("#zp_geoFilter_exception").addClass("DN"),""!=applDiv.find("#appl_geoRestrict_users").val()||(GeoRestriction.togglePlaceholder(applDiv.find("#geoRestrict_department"),GeoRestriction.allI18NKeys.department),GeoRestriction.togglePlaceholder(applDiv.find("#geoRestrict_desg"),GeoRestriction.allI18NKeys.desg),GeoRestriction.togglePlaceholder(applDiv.find("#geoRestrict_location"),GeoRestriction.allI18NKeys.location),GeoRestriction.togglePlaceholder(applDiv.find("#geoRestrict_role"),GeoRestriction.allI18NKeys.role),0==applDiv.find("#geoRestrict_department").val()&&0==applDiv.find("#geoRestrict_desg").val()&&0==applDiv.find("#geoRestrict_location").val()&&0==applDiv.find("#geoRestrict_role").val()&&GeoRestriction.togglePlaceholder(applDiv.find("#appl_geoRestrict_users"),GeoRestriction.allI18NKeys.users,"users"))}else Layout.Page.container.find("#zp_geoFilter_exception").removeClass("DN"),Layout.Page.container.find("#zp_geoFilter_applicable").addClass("DN");$(ele).addClass("activ"),$(ele).siblings().removeClass("activ")},getGeoDetails:function(isFromSearch){var param={mode:"list",conreqcsr:csrfToken,method:"get"};if(isFromSearch){var geoRangeName=Layout.Page.container.find("#geoRestrict_FiltersList").find("#geoRestrict_name").val();geoRangeName&&0!=geoRestrict_name.length&&(param.name=geoRangeName);var applicableFilter=Layout.Page.container.find("#zp_geoFilter_applicable"),exceptionFilter=Layout.Page.container.find("#zp_geoFilter_exception"),desgObj=applicableFilter.find("#geoRestrict_desg").val();desgObj&&0!=desgObj.length&&(param.desgId=JSON.stringify(desgObj),param.desgIdType=0),(desgObj=exceptionFilter.find("#geoRestrict_desg").val())&&0!=desgObj.length&&(param.desgId=JSON.stringify(desgObj),param.desgIdType=1);var roleObj=applicableFilter.find("#geoRestrict_role").val();roleObj&&0!=roleObj.length&&(param.roleId=JSON.stringify(roleObj),param.roleIdType=0),(roleObj=exceptionFilter.find("#geoRestrict_role").val())&&0!=roleObj.length&&(param.roleId=JSON.stringify(roleObj),param.roleIdType=1);var departMentObj=applicableFilter.find("#geoRestrict_department").val();departMentObj&&0!=departMentObj.length&&(param.deptId=JSON.stringify(departMentObj),param.deptIdType=0),(departMentObj=exceptionFilter.find("#geoRestrict_department").val())&&0!=departMentObj.length&&(param.deptId=JSON.stringify(departMentObj),param.deptIdType=1);var locationObj=applicableFilter.find("#geoRestrict_location").val();locationObj&&0!=locationObj.length&&(param.locationId=JSON.stringify(locationObj),param.locationIdType=0),(locationObj=exceptionFilter.find("#geoRestrict_location").val())&&0!=locationObj.length&&(param.locationId=JSON.stringify(locationObj),param.locationIdType=1);var empObj=applicableFilter.find("#appl_geoRestrict_users").val();empObj&&0!=empObj.length&&(param.empId=JSON.stringify(empObj.split(",")),param.empIdType=0),(empObj=exceptionFilter.find("#except_geoRestrict_users").val())&&0!=empObj.length&&(param.empId=JSON.stringify(empObj.split(",")),param.empIdType=1)}Layout.Page.container.find("#geoDetails").parent().parent().parent().append(ZPeople.LOADING_HTML),Layout.Page.container.find("#geoDetails").parent().parent().parent().find("#zp_page_loading").attr("style","height:80px");var url="getGeoRestriction.zp";ZPeople.Module.CURRENT_MODULEPREFIX&&(url=ZPeople.Module.CURRENT_MODULEPREFIX+url),$.post(url,param,function(rdata){GeoRestriction.geoDetails=rdata.geoDetails,GeoRestriction.constructMapDetails(rdata.geoDetails,void 0,isFromSearch)})},constructMapDetails:function(rdata,index,isFromSearch){var moduleNameArr=[ZPI18N.getString("zp.attendance"),ZPI18N.getString("zp.timetracker"),ZPI18N.getString("zp.files")],emptyMsg=Layout.Page.container.find("#ZPAtt_mapView_emptyRecInfo");if(Layout.Page.container.find("#geoConfigDiv").show(),0===Object.keys(rdata).length)return Layout.Page.container.find("#geoDetails").parent().parent().parent().find("#zp_page_loading").remove(),Layout.Page.container.find("#geoConfigDiv").hide(),isFromSearch&&(emptyMsg=Layout.Page.container.find("#ZPAtt_mapView_noRecFilteredInfo")),$(emptyMsg).prev().hide(),$(emptyMsg).show(),void(0===emptyMsg.find("i").eq(0).children().length&&Attendance.noDataImg(8,"CR-nodata",emptyMsg.find("i").eq(0)));$(emptyMsg).prev().show(),$(emptyMsg).hide(),emptyMsg=Layout.Page.container.find("#ZPAtt_mapView_noRecFilteredInfo"),$(emptyMsg).hide(),void 0===index&&Layout.Page.container.find("#geoDetails").empty();var html="";for(var i in rdata){var mapDetail=rdata[i],moduleHtml="";for(var mod in mapDetail.module)moduleHtml+='<span class="btn-sm addbadge FL MR5">'+moduleNameArr[mapDetail.module[mod]-1]+"</span>";html+='<tr class="ZPLRow" id="'+i+'"><td class="text-center"></td><td><span class="CP" onclick="GeoRestriction.toggleMapLocPopup(true,this);">'+$("<div></div>").text(rdata[i].rangename).html()+"</span></td><td>"+moduleHtml,html+='</td><td class="text-right P0I">',html+='<div id="ZPAtt_geoDelAction" class="over-display"><i class="IC-delete S14 gry FR MR15 CP" onClick="Attendance.deleteConfirmMsg(this,\'ZPAtt_geoDelConfirm\')"></i>',html+='<i class="IC-pen S14 gry FR MR15 CP" onclick="GeoRestriction.toggleMapLocPopup(true,this);"></i></div><div id="ZPAtt_geoDelConfirm"',html+=' style="display:none"><button class="btn btn-default btn-sm FR" type="button" onClick="Attendance.deleteConfirmMsg(this,\'ZPAtt_geoDelAction\')">',html+=ZPI18N.getString("zp.cancel")+'</button><button class="btn btn-danger btn-sm FR MR10" type="button" onClick="GeoRestriction.deleteMapSettings(this);">'+ZPI18N.getString("zp.confirm")+"</button></div>",html+="</td><td></td></tr>",""}Layout.Page.container.find("#geoDetails").parent().parent().parent().find("#zp_page_loading").remove(),void 0===index||""===index?Layout.Page.container.find("#geoDetails").append(html):0===index?Layout.Page.container.find("#geoDetails").prepend(html):Layout.Page.container.find("#geoDetails tr:nth-child("+index+")").after(html),Layout.Page.container.find("#geoConfig_Tab").parent().hasClass("tabcont")||ZPView.handleTablePosition()},constructApplicableFor:function(){APPLICABLEFORKEYS=[ZPPickList.CONSTANTS.ROLES,ZPPickList.CONSTANTS.DEPARTMENTS,ZPPickList.CONSTANTS.DESIGNATIONS,ZPPickList.CONSTANTS.LOCATIONS,ZPPickList.CONSTANTS.USERS],ZPPickList.loginUserNeed=!0,ZPPickList.init(APPLICABLEFORKEYS)},APPLICABLE_FOR_KEYS:["dep","desig","loc","roles","users"],EXCEPTION_FOR_KEYS:["exceptdep","exceptdesig","exceptloc","exceptroles","exceptusers"],toggleMapLocPopup:function(isOpen,ele){if(isOpen)if(Layout.Page.container.find("#addreq").hasClass("in")||GeoRestriction.clearPopUpFields(),void 0!=ZPMaps.map&&ZPMaps.map.isLoaded())if(Layout.Page.container.find("#addreq #geoPopupTitle").html(ZPI18N.getString("zp.addgeorestriction")),Layout.Page.container.find("#addreq #saveGeo").off("click").on("click",function(){GeoRestriction.addMapSettings()}),$(".form-horizontal").off("click").on("click",function(){}),ZPMaps.hideFullScreen(),ele){ZPMaps.addCurrentLocationMarker(),GeoRestriction.getApplicableForInfo($(ele).closest("tr").attr("id"));var mapDetails=GeoRestriction.geoDetails[$(ele).closest("tr").attr("id")];$("#"+Layout.Page.pageId+"_map .zmap-drawingtoolbar-section-shapes").attr("style","opacity: 0.5; pointer-events: none;"),Layout.Page.container.find("#addreq #saveGeo").off("click").on("click",function(){GeoRestriction.editMapSettings($(ele).closest("tr").attr("id"))}),Layout.Page.container.find("#addreq #label").val(mapDetails.rangename),Layout.Page.container.find("#addreq #moduleSelect").val(mapDetails.module).select2();var locObj=mapDetails.rangeval;mapDetails.rangeval.startsWith("{")&&(locObj="["+mapDetails.rangeval+"]"),ZPMaps.loadShape(locObj),Layout.Page.container.find("#addreq #geoPopupTitle").html(ZPI18N.getString("zp.editgeorestriction"))}else{ZPMaps.showCurrentLocation(),GeoRestriction.populateOptions(),GeoRestriction.showgeoRestrictionpopup();var applicabletype=Layout.Page.container.find("#geoapplicableDiv");GeoRestriction.togglePlaceholder(applicabletype.find("#location_field select[name=location]"),GeoRestriction.allI18NKeys.location),GeoRestriction.togglePlaceholder(applicabletype.find("#department_field select[name=department]"),GeoRestriction.allI18NKeys.department),GeoRestriction.togglePlaceholder(applicabletype.find("#designation_field select[name=designation]"),GeoRestriction.allI18NKeys.desg),GeoRestriction.togglePlaceholder(applicabletype.find("#role_field select[name=role]"),GeoRestriction.allI18NKeys.role),$("#"+Layout.Page.pageId+"_map-zmap-drawingtoolbar-container-id ."+Layout.Page.pageId+"_map-zmap-drawingtoolbar-section-shapes").removeAttr("style")}else clearTimeout(GeoRestriction.waitTillMapLoad),GeoRestriction.waitTillMapLoad=setTimeout(function(){GeoRestriction.toggleMapLocPopup(!0,ele)},1e3);else Layout.Page.container.find("#addreq").modal("hide"),clearTimeout(GeoRestriction.waitTillMapLoad)},showgeoRestrictionpopup:function(){Layout.Page.container.find("#addreq").hasClass("in")||(Layout.Page.container.find("#selConditional").addClass("DN"),Layout.Page.container.find(".zpTabs_innerTitleOut").removeClass("DN"),Layout.Page.container.find("#addreq").modal("show"))},getApplicableForInfo:function(geoRangeId){var param={mode:"info",geoRangeId:geoRangeId,conreqcsr:csrfToken,method:"get"},url="getGeoRestriction.zp";ZPeople.Module.CURRENT_MODULEPREFIX&&(url=ZPeople.Module.CURRENT_MODULEPREFIX+url),$.post(url,param,function(rdata){rdata.isBGProcessRunning?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.georestriction.v2.error.editgeorestriction")):(GeoRestriction.geoDetails[geoRangeId].assDetails=rdata.assDetails,GeoRestriction.populateOptions(geoRangeId),GeoRestriction.updateEditOptions(rdata,geoRangeId),GeoRestriction.showgeoRestrictionpopup(),GeoRestriction.populateConditonalOption(geoRangeId))})},clearPopUpFields:function(){data_array=[],Layout.Page.container.find("#addreq input").val(""),ZPMaps.removeShape(),Layout.Page.container.find("#addreq #key_list button").click();var modulekey=ZPeople.Module.getModuleKey(),selmodule="";"attendance"==modulekey?selmodule="1":"timetracker"==modulekey&&(selmodule="2"),Layout.Page.container.find("#addreq #moduleSelect").val(selmodule).select2()},dataEntryCheck:function(){return""===Layout.Page.container.find("#addreq #label").val().trim()||null===Layout.Page.container.find("#addreq #moduleSelect").val()?ZPI18N.getString("zp.enterallfields"):""==ZPMaps.gJson?ZPI18N.getString("zp.selectgeorange"):"success"},editMapSettings:function(geoRangeId){var msg=GeoRestriction.dataEntryCheck();if("success"===msg){var param={conreqcsr:csrfToken,geoRangeId:geoRangeId},applicableFor={};GeoRestriction.getApplData(applicableFor,!0),Object.keys(applicableFor).length>0&&(param.applicableFor=JSON.stringify(applicableFor));var exceptFor={};GeoRestriction.getApplData(exceptFor,!1),Object.keys(exceptFor).length>0&&(param.exceptFor=JSON.stringify(exceptFor)),!_.isEqual(GeoRestriction.geoDetails[geoRangeId].module,Layout.Page.container.find("#addreq #moduleSelect").val())&&Layout.Page.container.find("#addreq #moduleSelect").val().length>0&&(param.modules=JSON.stringify(Layout.Page.container.find("#addreq #moduleSelect").val())),GeoRestriction.geoDetails[geoRangeId].rangename!==Layout.Page.container.find("#addreq #label").val().trim()&&(param.geoName=Layout.Page.container.find("#addreq #label").val().trim()),GeoRestriction.geoDetails[geoRangeId].rangeval!==JSON.stringify(ZPMaps.gJson)&&(param.mapValues=JSON.stringify(ZPMaps.gJson),ZPMaps.gJson=""),param.version=Layout.Page.container.find("select[name=selConditional]").val(),param.method="edit";var url="editGeoRestriction.zp";ZPeople.Module.CURRENT_MODULEPREFIX&&(url=ZPeople.Module.CURRENT_MODULEPREFIX+url),GeoRestriction.saveMapDetails(param,geoRangeId,url)}else ZPeople.Message.showFailureMsg(msg)},addMapSettings:function(){var msg=GeoRestriction.dataEntryCheck();if("success"===msg){var applicableFor={};GeoRestriction.getApplData(applicableFor,!0);var exceptFor={};GeoRestriction.getApplData(exceptFor,!1);var param={conreqcsr:csrfToken,modules:JSON.stringify(Layout.Page.container.find("#addreq #moduleSelect").val()),applicableFor:JSON.stringify(applicableFor),exceptFor:JSON.stringify(exceptFor),mapValues:JSON.stringify(ZPMaps.gJson),version:2,geoName:Layout.Page.container.find("#addreq #label").val().trim(),method:"add"},url="addGeoRestriction.zp";ZPeople.Module.CURRENT_MODULEPREFIX&&(url=ZPeople.Module.CURRENT_MODULEPREFIX+url),GeoRestriction.saveMapDetails(param,null,url)}else""!==msg&&ZPeople.Message.showFailureMsg(msg)},saveMapDetails:function(param,geoRangeId,url){Layout.Page.container.find("#saveGeo").prop("disabled",!0),$.post(url,param,function(rdata){if(Layout.Page.container.find("#saveGeo").prop("disabled",!1),rdata.errorMsg)ZPeople.Message.showFailureMsg(rdata.errorMsg),"edit"==param.method&&Layout.Page.container.find("#addreq #moduleSelect").val(GeoRestriction.geoDetails[param.geoRangeId].module).select2();else if(rdata.geoDetails){var rowPos="";geoRangeId?(rowPos=Layout.Page.container.find("#geoDetails tr#"+Object.keys(rdata.geoDetails)[0]).index(),Layout.Page.container.find("#geoDetails tr#"+Object.keys(rdata.geoDetails)[0]).remove(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"))):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.addsuccessful")),GeoRestriction.geoDetails[Object.keys(rdata.geoDetails)[0]]=rdata.geoDetails[Object.keys(rdata.geoDetails)[0]],GeoRestriction.constructMapDetails(rdata.geoDetails,rowPos),GeoRestriction.toggleMapLocPopup(!1),ZPMaps.gJson=""}})},deleteMapSettings:function(geoRow){var param={conreqcsr:csrfToken,geoRangeId:$(geoRow).closest("tr").attr("id"),method:"delete"},url="deleteGeoRestriction.zp";ZPeople.Module.CURRENT_MODULEPREFIX&&(url=ZPeople.Module.CURRENT_MODULEPREFIX+url),$.post(url,param,function(rdata){if(rdata.errorMsg)ZPeople.Message.showFailureMsg(ZPI18N.getString(rdata.errorMsg,[ZPI18N.getString(rdata.module)])),Attendance.deleteConfirmMsg(geoRow,"ZPAtt_geoDelAction");else if(rdata.msg){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.deletesuccessful"));var keyCount=Object.keys(GeoRestriction.geoDetails).length;if(delete GeoRestriction.geoDetails[rdata.msg],Layout.Page.container.find("#geoDetails tr#"+rdata.msg).hide("slow",function(){Layout.Page.container.find("#geoDetails tr#"+rdata.msg).remove()}),1===keyCount){GeoRestriction.constructMapDetails({})}}})},switchApplicableTabs:function(ele){"appl"==$(ele).attr("id")?(Layout.Page.container.find("#addreq #geoapplicableDiv").removeClass("DN"),Layout.Page.container.find("#addreq #geoexceptionDiv").addClass("DN")):(Layout.Page.container.find("#addreq #geoexceptionDiv").removeClass("DN"),Layout.Page.container.find("#addreq #geoapplicableDiv").addClass("DN")),$(ele).addClass("active"),$(ele).siblings().removeClass("active")},populateOptions:function(georangeId){var html=Layout.Page.container.find("#GeoApplicableFor");if(html.find("#appl").addClass("active"),html.find("#appl").siblings().removeClass("active"),html.find("#users_field #selectedempcount").text(""),Layout.Page.container.find("#selConditional").addClass("DN"),Layout.Page.container.find("#geoexceptionDiv").addClass("DN"),Layout.Page.container.find("#geoapplicableDiv").removeClass("DN"),GeoRestriction.emptyDropdown(),GeoRestriction.regApplicable(Layout.Page.container.find("#geoapplicableDiv"),"appl"),GeoRestriction.regApplicable(Layout.Page.container.find("#geoexceptionDiv"),"except"),GeoRestriction.populateApplicableOptions("location","loc",ZPPickList.allLocations),GeoRestriction.populateApplicableOptions("designation","desg",ZPPickList.allDesignations),GeoRestriction.populateApplicableOptions("department","dept",ZPPickList.allDepartments),GeoRestriction.populateApplicableOptions("role","role",ZPPickList.allRoles),GeoRestriction.userInputSelect2(Layout.Page.container.find("#geoexceptionDiv").find("input[name=users].except")),GeoRestriction.userInputSelect2(Layout.Page.container.find("#geoapplicableDiv").find("input[name=users].appl")),GeoRestriction.appendSelect2(Layout.Page.container.find("#geoapplicableDiv"),!0),GeoRestriction.appendSelect2(Layout.Page.container.find("#geoexceptionDiv")),georangeId){var applicabletype=Layout.Page.container.find("#geoapplicableDiv");GeoRestriction.togglePlaceholder(applicabletype.find("#location_field select[name=location]"),GeoRestriction.allI18NKeys.location),GeoRestriction.togglePlaceholder(applicabletype.find("#department_field select[name=department]"),GeoRestriction.allI18NKeys.department),GeoRestriction.togglePlaceholder(applicabletype.find("#designation_field select[name=designation]"),GeoRestriction.allI18NKeys.desg),GeoRestriction.togglePlaceholder(applicabletype.find("#role_field select[name=role]"),GeoRestriction.allI18NKeys.role)}},regApplicable:function(modal,type){modal.children("div").removeClass("DN"),modal.find("."+type).on("change",function(){var name=$(this).attr("name"),data=$(this).select2("data"),arr=_.pluck(data,"id"),type=$(this).attr("class"),oppmodal=-1!=type.indexOf("appl")?Layout.Page.container.find("#geoexceptionDiv"):Layout.Page.container.find("#geoapplicableDiv"),oppType=-1!=type.indexOf("appl")?"except":"appl",oppEle=oppmodal.find("[name="+name+"]."+oppType);if(oppEle.parents(".zp-label").removeClass("DN"),"users"==name&&oppEle.parents(".zp-label").prev().removeClass("DN"),-1!=type.indexOf("appl")){var applicabletype=Layout.Page.container.find("#geoapplicableDiv"),usercount=Layout.Page.container.find("#users_field .select2-search-choice").length;GeoRestriction.togglePlaceholder(applicabletype.find("#location_field select[name=location]"),GeoRestriction.allI18NKeys.location),GeoRestriction.togglePlaceholder(applicabletype.find("#department_field select[name=department]"),GeoRestriction.allI18NKeys.department),GeoRestriction.togglePlaceholder(applicabletype.find("#designation_field select[name=designation]"),GeoRestriction.allI18NKeys.desg),GeoRestriction.togglePlaceholder(applicabletype.find("#role_field select[name=role]"),GeoRestriction.allI18NKeys.role),!usercount||Layout.Page.container.find("#location_field .select2-search-choice").length||Layout.Page.container.find("#department_field .select2-search-choice").length||Layout.Page.container.find("#designation_field .select2-search-choice").length||Layout.Page.container.find("#role_field .select2-search-choice").length||(GeoRestriction.togglePlaceholder(applicabletype.find("#location_field select[name=location]"),""),GeoRestriction.togglePlaceholder(applicabletype.find("#department_field select[name=department]"),""),GeoRestriction.togglePlaceholder(applicabletype.find("#designation_field select[name=designation]"),""),GeoRestriction.togglePlaceholder(applicabletype.find("#role_field select[name=role]"),""))}1==arr.length&&"0"==arr[0]||"0"==_.last(arr)?$(this).select2("data",_.filter(data,function(obj){return"0"==obj.id})):-1!=arr.indexOf("0")&&($(this).select2("data",_.filter(data,function(obj){return"0"!=obj.id})),oppEle.parents(".zp-label").addClass("DN"),"users"==name&&oppEle.parents(".zp-label").prev().addClass("DN")),arr.length>0&&($(this).is("input")?oppEle.select2("val",""):oppEle.select2("val",[]),oppEle.parents(".zp-label").addClass("DN"),"users"==name&&oppEle.parents(".zp-label").prev().addClass("DN"))})},populateApplicableOptions:function(tagname,type,options){var select=Layout.Page.container.find("#geoapplicableDiv select[name="+tagname+"]");$.each(options,function(indx,obj){0!=obj.recID&&$(select).append(ZP.create("option",{value:obj.recID,text:ZPeople.decodeTxt(obj.recName)}))});select=Layout.Page.container.find("#geoexceptionDiv select[name="+tagname+"]");$.each(options,function(indx,obj){0!=obj.recID&&$(select).append(ZP.create("option",{value:obj.recID,text:ZPeople.decodeTxt(obj.recName)}))})},populateConditonalOption:function(georangeId){var select=Layout.Page.container.find("select[name=selConditional]");$("#"+Layout.Page.pageId+" select[name=selConditional] option[value='1']").length<1&&($(select).append(ZP.create("option",{value:1,text:"OR"})),$(select).append(ZP.create("option",{value:2,text:"AND"})));var version=georangeId&&GeoRestriction.geoDetails[georangeId]?GeoRestriction.geoDetails[georangeId].version:2;$(select).val(version).select2(),Layout.Page.container.find(".zpTabs_innerTitleOut").removeClass("DN"),1==version?(Layout.Page.container.find("#selConditional").removeClass("DN"),Layout.Page.container.find(".zpTabs_innerTitleOut").addClass("DN")):Layout.Page.container.find("#selConditional").addClass("DN")},appendSelect2:function(applicabletype,isappl){applicabletype.find("#location_field select[name=location]").val("").select2({closeOnSelect:!1}),applicabletype.find("#department_field select[name=department]").val("").select2({closeOnSelect:!1}),applicabletype.find("#designation_field select[name=designation]").val("").select2({closeOnSelect:!1}),applicabletype.find("#role_field select[name=role]").val("").select2({closeOnSelect:!1}),applicabletype.find("#users_field select[name=users]").select2("data",null)},emptyDropdown:function(){Layout.Page.container.find("#location_field select[name=location]").empty(),Layout.Page.container.find("#department_field select[name=department]").empty(),Layout.Page.container.find("#designation_field select[name=designation]").empty(),Layout.Page.container.find("#role_field select[name=role]").empty(),Layout.Page.container.find("select[name=selConditional]").empty()},updateEditOptions:function(data,geoRangeId){var version=GeoRestriction.geoDetails[geoRangeId]?GeoRestriction.geoDetails[geoRangeId].version:2;GeoRestriction.setApplData(Layout.Page.container.find("#geoapplicableDiv"),data.assDetails,!0,version),GeoRestriction.setApplData(Layout.Page.container.find("#geoexceptionDiv"),data.assDetails,!1,version)},setApplData:function(modal,data,appFor,version){var fields=GeoRestriction.APPLICABLE_FOR_KEYS,mapping={roles:"role",loc:"location",dep:"department",desig:"designation",users:"users"},oppmodal=Layout.Page.container.find("#geoexceptionDiv");for(var indx in appFor||(oppmodal=Layout.Page.container.find("#geoapplicableDiv"),fields=GeoRestriction.EXCEPTION_FOR_KEYS,mapping={exceptroles:"role",exceptloc:"location",exceptdep:"department",exceptdesig:"designation",exceptusers:"users"}),fields){var field=fields[indx],obj=data[field],arr=_.isArray(obj)?obj:[];if(0!=arr.length)if(modal.find("#"+mapping[field]+"_field").removeClass("DN"),1==arr.length&&"0"==arr[0]||"0"==_.last(arr)?oppmodal.find("#"+mapping[field]+"_field").removeClass("DN"):oppmodal.find("#"+mapping[field]+"_field").addClass("DN"),"users"==field||"exceptusers"==field){var values=[];modal.find("#users_field").prev().removeClass("DN"),appFor&&arr.length>0&&(data.dep||data.role||data.desig||data.loc||(GeoRestriction.togglePlaceholder(modal.find("#location_field select[name=location]"),""),GeoRestriction.togglePlaceholder(modal.find("#department_field select[name=department]"),""),GeoRestriction.togglePlaceholder(modal.find("#designation_field select[name=designation]"),""),GeoRestriction.togglePlaceholder(modal.find("#role_field select[name=role]"),"")));var userList=ZPeople.getUserDetailsByIds(arr,!1);for(var i in arr){var id=arr[i],userDtl=ZPeople.getUserDetailsByIdInList(id,userList);void 0!=id&&"null"!=id&&(userDtl&&-1!=userDtl.id&&values.push({id:id,text:ZPeople.decodeTxt(userDtl.name),html:userDtl.name,photo:userDtl.photo}))}modal.find("input[name=users]").select2("data",values),"0"!=id&&oppmodal.find("#users_field").prev().addClass("DN")}else"0"!=_.last(arr)&&(modal.find("[name="+mapping[field]+"]").select2("val",arr),modal.find("[name="+mapping[field]+"]").val(arr).trigger("change"));else oppmodal.find("#"+mapping[field]+"_field").removeClass("DN"),1==version&&"users"!=field&&appFor&&GeoRestriction.togglePlaceholder(modal.find("select[name="+mapping[field]+"]"),""),("users"==field||"exceptusers"==field)&&oppmodal.find("#users_field").prev().removeClass("DN")}},getApplData:function(applicableFor,type){for(var mapping={roles:"role",loc:"location",dep:"department",desig:"designation",users:"users"},appclass=type?"appl":"except",appUserele=Layout.Page.container.find("#GeoApplicableFor [name=users]."+appclass),applUSerarr=_.pluck(appUserele.select2("data"),"id"),version=Layout.Page.container.find("select[name=selConditional]").val(),appliConfigured=!1,i=0;i<GeoRestriction.APPLICABLE_FOR_KEYS.length;i++){var applArr=[],keyName=GeoRestriction.APPLICABLE_FOR_KEYS[i],ele=Layout.Page.container.find("#GeoApplicableFor [name="+mapping[keyName]+"]."+appclass);applArr=_.pluck(ele.select2("data"),"id"),type&&0==applArr.length&&""==ele.attr("data-placeholder")&&(1==version||applUSerarr.length>0)?applicableFor[keyName]=[-1]:(appliConfigured=!(!type||"users"==keyName||2!=version)||appliConfigured,applicableFor[keyName]=applArr)}if(appliConfigured)for(i=0;i<GeoRestriction.APPLICABLE_FOR_KEYS.length;i++){if("users"!=(keyName=GeoRestriction.APPLICABLE_FOR_KEYS[i]))1==(applArr=applicableFor[keyName]).length&&-1==applArr[0]&&applArr.pop()}},togglePlaceholder:function(ele,key,name){if("users"===name)return ele.attr("data-placeholder",ZPI18N.getString(key)),void ele.select2("val","");ele.attr("data-placeholder",ZPI18N.getString(key)),ele.select2()},userInputSelect2:function(ele){var eleId=$(ele).attr("id"),isMultiple=$(ele).attr("ismultiple");if(void 0==eleId||""==eleId){var maxIndx=0;$.each(Layout.Page.container.find("[id^="+Layout.Page.pageId+"_empsearch_]"),function(){var indx=$(this).attr("id").split("_")[2];maxIndx=Math.max(indx,maxIndx)}),eleId=Layout.Page.pageId+"_empsearch_"+(maxIndx+1),$(ele).attr("id",eleId)}var json={id:eleId,inpFormat:"select",isMultiple:isMultiple,initCurrentUser:!1,type:1,limit:10,searchMode:"IPGEO_RESTRICTION_SETTINGS",searchType:"emp",maximumSelectionSize:1e3,initDefaultValues:!0};ZPComponents.Search.create(json)}};var Shift={shiftList:null,getShiftList:function(callback){if(Shift.shiftList)void 0!==callback&&callback();else{var param={mode:"getShiftList",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/AttendanceShiftAction.zp",param,function(rdata){rdata.shiftList&&(Shift.shiftList=rdata.shiftList),void 0!==callback&&callback()})}},getShiftName:function(shiftId,needTimeInterval,needTimeInMins){var resObj={};if(Shift.shiftList){var shift=Shift.shiftList[shiftId];shiftId&&shift&&(resObj.shiftName=shift.shiftName,needTimeInterval&&(resObj.timeInterval=Attendance.disTime(shift.fTime,!0)+" - "+Attendance.disTime(shift.tTime,!0)),needTimeInMins&&(resObj.fTime=shift.fTime,resObj.tTime=shift.tTime))}else resObj.shiftName="",resObj.timeInterval="",resObj.fTime="",resObj.tTime="";return resObj},getDefaultShiftId:function(){var defShiftId=null;return null!=Shift.shiftList&&Object.keys(Shift.shiftList).forEach(function(shiftId){Shift.shiftList[shiftId].select&&(defShiftId=shiftId)}),defShiftId},getShiftTimeForDisplay:function(shiftId){if(Shift.shiftList){var shift=Shift.shiftList[shiftId];if(shiftId&&shift)return Attendance.disTime(shift.fTime,!1,!0)+" - "+Attendance.disTime(shift.tTime,!1,!0)}return""},getShiftColour:function(shiftId){if(Shift.shiftList){var shift=Shift.shiftList[shiftId];if(shiftId&&shift)return shift.colorCode}return""}};Attendance.DeviceSettings={pwdPolicy:{},loginCountry:"us",loginLocale:"en",loginDetailsList:{},zaid:null,domainUrl:null,init:function(needRefresh){var layout=Layout.Page.container;if(0===layout.find("#ZPAtt_DeviceSett_UserList tbody").children().length||needRefresh){layout.popover({selector:"[data-popover].popHover",trigger:"click hover",delay:{show:50,hide:50}});var param={mode:"getDeviceNameAndUser",conreqcsr:csrfToken};$.post("/AttendanceDevice.zp",param,function(rdata){var resp=rdata.response,tbody=layout.find("#ZPAtt_DeviceSett_UserList tbody");if(tbody.empty(),resp&&resp.kioskName&&resp.clientUsers&&0!==resp.clientUsers.length){layout.find("#ZPAtt_DeviceSett_emptyRecInfo").hide(),layout.find("#ZAtt_DeviceSett_HelpCont").remove(),Attendance.DeviceSettings.setKioskName(resp.kioskName),layout.find("#ZPAtt_DeviceSett_UserList").show(),layout.find("#ZPAtt_DeviceSett_addUserMsg").html("<button class='btn btn-primary btnPlus FR MT3' data-toggle='modal' onclick='Attendance.DeviceSettings.showHidePopupForDeviceConfig(false);'>"+ZPI18N.getString("zp.addlogincredential")+"</button>"),Layout.Page.container.find("#ZPAtt_DeviceSett_Tab").parent().hasClass("tabcont")||ZPView.handleTablePosition();var usersArr=resp.clientUsers;Attendance.DeviceSettings.loginDetailsList=usersArr,Attendance.DeviceSettings.zaid=resp.ZAID,resp.domainUrl&&(Attendance.DeviceSettings.domainUrl=resp.domainUrl);var html="";for(var i in usersArr){var userObj=usersArr[i];html+="<tr class='ZPLRow' id='"+userObj.userId+"'>",html+="<td></td>",html+="<td>"+$("<div/>").text(userObj.loginDeviceName?userObj.loginDeviceName:"").html()+"</td>",html+="<td>"+(userObj.loginEmailID?userObj.loginEmailID:"")+"</td>",html+="<td>"+(userObj.loginCountry?userObj.loginCountry:"")+"</td>",html+="<td>"+(userObj.loginLanguage?userObj.loginLanguage:"")+"</td>",html+="<td>"+(userObj.loginTZ?userObj.loginTZ:"")+"</td>",html+="<td><div class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick='Attendance.DeviceSettings.showDelConfirm(this)'></i>",html+="<i class='IC-pen S14 gry FR MR15 CP' onclick='Attendance.DeviceSettings.showHidePopupForDeviceConfig(false,this)'></i>",html+="</div></td>",html+="</tr>"}tbody.html(html)}else resp&&resp.kioskName?(layout.find("#ZPAtt_DeviceSett_Kiosk_AddPage").hide(),layout.find("#ZAtt_DeviceSett_HelpCont").remove(),layout.find("#ZPAtt_DeviceSett_emptyRecInfo").show(),Attendance.DeviceSettings.setKioskName(resp.kioskName)):(layout.find("#ZPAtt_DeviceSett_Kiosk_AddPage").show(),layout.find("#ZAtt_DeviceSett_HelpCont").show(),layout.find("#ZPAtt_DeviceSett_emptyRecInfo").hide()),layout.find("#ZPAtt_DeviceSett_UserList").hide();Attendance.DeviceSettings.getTimezoneList(),resp.pwdPolicy&&(Attendance.DeviceSettings.pwdPolicy=resp.pwdPolicy),resp.loginCountry&&(Attendance.DeviceSettings.loginCountry=resp.loginCountry),resp.loginLocale&&(Attendance.DeviceSettings.loginLocale=resp.loginLocale)})}},kioskNameValidation:function(obj){var curportal=$(obj).val();curportal=(curportal=curportal?curportal.replace(/[^a-z0-9]/gi,""):"").toLowerCase(),$(obj).val(curportal)},setKioskName:function(kName){var layout=Layout.Page.container,header="<div class='dvcVw'><div class='FL MR40'><h5 class='FL MR10'> "+ZPI18N.getString("zp.kioskname")+" : <a>"+$("<div/>").text(kName).html()+"</a></h5>";header+="<i class='IC-pen FL MT8 gry'></i></div><div><h5 class='FL MR10'>"+ZPI18N.getString("zp.copykiosklink")+"</h5>",header+="<i class='IC-copy FL gry MT8 CP' onclick='Attendance.kiosk.copyTxtToClipBoard()'></i><input type='text' class='valselect' id='ZPAtt_KioskCopyInput' value style='opacity: 0; z-index: -1; position: absolute;'></div></div></div>",layout.find("#ZPAtt_DeviceSett_KioskName").html(header),layout.find("#ZPAtt_DeviceSett_KioskName .IC-pen").unbind("click").bind("click",function(){Attendance.DeviceSettings.openEditKioskName(kName)})},openEditKioskName:function(kName){var layout=Layout.Page.container,header="<div class='dvcEdt'><h5 class='FL MR10'>"+ZPI18N.getString("zp.kioskname")+" : </h5>";header+="<div class='dcvEdt_flds'><input type='text' value='"+kName+"' class='dvcEdt_inpt' onkeyup='Attendance.DeviceSettings.kioskNameValidation(this)'><i class='IC-tick grn MR5 CP'></i>",header+="<i class='IC-cls-1px red S16 CP'></i></div></div></div></div>",layout.find("#ZPAtt_DeviceSett_KioskName").html(header),layout.find("#ZPAtt_DeviceSett_KioskName .IC-cls-1px").unbind("click").bind("click",function(){Attendance.DeviceSettings.setKioskName(kName)}),layout.find("#ZPAtt_DeviceSett_KioskName .IC-tick").unbind("click").bind("click",function(){Attendance.DeviceSettings.addKiosk(this)})},getTimezoneList:function(){var data=Layout.Page.container.find("#ZPAtt_DeviceSett_LoginTz").data();void 0!==data.list?Attendance.DeviceSettings.showTimezoneModal(data.list):ZPeople.Request.send(ZPeople.COMMON_URL,{mode:"GET_TIMEZONE_LIST"},Attendance.DeviceSettings.showTimezoneModal)},showTimezoneModal:function(data){if(data.success){var timeZoneCont=Layout.Page.container.find("#ZPAtt_DeviceSett_LoginTz");timeZoneCont.data("list",data);var tZoneHtml="";$.each(data.list,function(){ZPUtil.Validation.isEmpty(this.disName)||(tZoneHtml+='<option value="'+this.tzId+'">'+this.disName+"</option>")}),timeZoneCont.html(tZoneHtml),timeZoneCont.select2().select2("val",ZPeople.TIME.userTimeZone)}},showHidePopupForDeviceConfig:function(isHide,obj){var layout=Layout.Page.container;if(isHide)ZPeople.BSModal.hide("ZPAtt_DeviceSett_AddPopup"),layout.find("#ZPAtt_DeviceSett_DeviceName").val(""),layout.find("#ZPAtt_DeviceSett_LoginMailId").val(""),layout.find("#ZPAtt_DeviceSett_LoginPassword").val("");else{if(ZPeople.BSModal.show(layout.find("#ZPAtt_DeviceSett_AddPopup")),Attendance.DeviceSettings.showPwdPolicy(),layout.find("#ZPAtt_DeviceSett_DeviceName").val("").removeClass("error-clr"),layout.find("#ZPAtt_DeviceSett_LoginMailId").val("").removeAttr("disabled").removeClass("error-clr"),layout.find("#ZPAtt_DeviceSett_LoginPassword").val("").attr("type","password").removeClass("error-clr"),layout.find("#s2id_ZPAtt_DeviceSett_LoginLocale")[0]||(layout.find("#ZPAtt_DeviceSett_LoginCtry").select2(),layout.find("#ZPAtt_DeviceSett_LoginLocale").select2()),layout.find("#ZPAtt_DeviceSett_AddCredCont").show(),layout.find("#ZPAtt_DeviceSett_AddCreInfo").show(),layout.find("#ZPAtt_DeviceSett_UpdatePwdCont").hide(),obj){var loginDet=Attendance.DeviceSettings.loginDetailsList[$(obj).closest(".ZPLRow").index()];layout.find("#ZPAtt_DeviceSett_DeviceName").val(loginDet.loginDeviceName?loginDet.loginDeviceName:""),layout.find("#ZPAtt_DeviceSett_LoginMailId").val(loginDet.loginEmailID?decodeHTML(loginDet.loginEmailID):"").attr("disabled","disabled"),layout.find("#ZPAtt_DeviceSett_LoginPassword").closest(".form-group").hide(),layout.find("#ZPAtt_DeviceSett_LoginCtry").select2("val",loginDet.loginCountryCode.toLocaleUpperCase()),layout.find("#ZPAtt_DeviceSett_LoginLocale").select2("val",loginDet.loginLanguageCode),layout.find("#ZPAtt_DeviceSett_LoginTz").select2("val",loginDet.loginTZ),layout.find("#ZPAtt_DeviceSett_addButt").text(ZPI18N.getString("zp.update")),layout.find("#ZPAtt_DeviceSett_AddPopup .modal-title").text(ZPI18N.getString("zp.updatelogindetails")),layout.find("#ZPAtt_DeviceSett_addButt").attr("isUpdate",!0),layout.find("#ZPAtt_DeviceSett_UpdatePwd").show(),layout.find("#ZPAtt_DeviceSett_UpdatePwdCont").data("loginZuid",loginDet.zuid),layout.find("#ZPAtt_DeviceSett_LoginMailId").parent().next().hide(),layout.find("#ZPAtt_DeviceSett_AddCreInfo").hide()}else layout.find("#ZPAtt_DeviceSett_LoginCtry").select2("val",Attendance.DeviceSettings.loginCountry.toLocaleUpperCase()),layout.find("#ZPAtt_DeviceSett_LoginLocale").select2("val",Attendance.DeviceSettings.loginLocale),layout.find("#ZPAtt_DeviceSett_LoginPassword").closest(".form-group").show(),layout.find("#ZPAtt_DeviceSett_LoginTz").select2("val",ZPeople.TIME.userTimeZone),layout.find("#ZPAtt_DeviceSett_addButt").text(ZPI18N.getString("zp.add")),layout.find("#ZPAtt_DeviceSett_AddPopup .modal-title").text(ZPI18N.getString("zp.addlogincredential")),layout.find("#ZPAtt_DeviceSett_addButt").attr("isUpdate",!1),layout.find("#ZPAtt_DeviceSett_UpdatePwd").hide(),layout.find("#ZPAtt_DeviceSett_LoginMailId").parent().next().show();null===layout.find("#ZPAtt_DeviceSett_LoginCtry").select2("val")&&layout.find("#ZPAtt_DeviceSett_LoginCtry").select2("val","US"),null===layout.find("#ZPAtt_DeviceSett_LoginLocale").select2("val")&&layout.find("#ZPAtt_DeviceSett_LoginLocale").select2("val","en")}},addKiosk:function(obj){var layout=Layout.Page.container,param={mode:"addKioskName",conreqcsr:csrfToken},kNameCont=$(obj);!0===kNameCont.hasClass("IC-tick")?(kNameCont=kNameCont.prev(),param.isUpdate=!0):kNameCont=layout.find("#ZPAtt_DeviceSett_addKiosk");var kName=kNameCont.val().trim();kNameCont.removeClass("error-clr"),""!==kName?(param.kioskName=kName.toLocaleLowerCase(),$(obj).attr("disabled",!0),$.post("/AttendanceDevice.zp",param,function(rdata){if($(obj).removeAttr("disabled"),rdata.response){if(rdata.response.msg)return ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),void Attendance.DeviceSettings.init(!0);"kioskNameAlreadyExist"===rdata.response.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.kioskalreadyexist"))}})):kNameCont.addClass("error-clr")},add:function(obj){var layout=Layout.Page.container;if(layout.find("#ZPAtt_DeviceSett_UpdatePwdCont").is(":visible"))Attendance.DeviceSettings.updatePassWord();else{var isUpdate="true"===layout.find("#ZPAtt_DeviceSett_addButt").attr("isUpdate"),dNameCont=layout.find("#ZPAtt_DeviceSett_DeviceName"),dMailCont=layout.find("#ZPAtt_DeviceSett_LoginMailId"),dPWordCont=layout.find("#ZPAtt_DeviceSett_LoginPassword"),dName=dNameCont.val().trim(),dMail=dMailCont.val().trim(),dPWord=dPWordCont.val().trim(),dTz=layout.find("#ZPAtt_DeviceSett_LoginTz").select2("val"),dctry=layout.find("#ZPAtt_DeviceSett_LoginCtry").select2("val"),dLoc=layout.find("#ZPAtt_DeviceSett_LoginLocale").select2("val");if(dNameCont.removeClass("error-clr"),dMailCont.removeClass("error-clr"),dPWordCont.removeClass("error-clr"),""!==dName)if(isUpdate||""!==dMail)if(isUpdate||""!==dPWord){if(!isUpdate){if(0===Object.keys(Attendance.DeviceSettings.pwdPolicy).length&&dPWord.length<8)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.passwordlengshort"));if(Attendance.DeviceSettings.validatePwdPolicy(dPWord))return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.passwordpolicy"))}var param={mode:"addDeviceNameAndUser",conreqcsr:csrfToken};param.loginDeviceName=dName,param.loginMailId=dMail,isUpdate||(param.loginPassWord=dPWord),param.loginTz=dTz,param.loginCountry=dctry,param.loginLocale=dLoc,param.isUpdate=isUpdate,$(obj).attr("disabled","disabled"),$.post("/AttendanceDevice.zp",param,function(rdata){$(obj).removeAttr("disabled");var error=rdata.response.error;error?"kioskNameAlreadyExist"===error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.kioskalreadyexist")):"userAlreadyExist"===error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.loginmailalreadyexist")):"problemInAddingUser"===error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.probleminaddinguser")):"specialcharnotallowed"===error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.filespecialcharacter")):"weakpassword"===error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.weakpassword")):"sequencecharactersnotallowed"===error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.password.sequencechar")):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),Attendance.DeviceSettings.showHidePopupForDeviceConfig(!0),Attendance.DeviceSettings.init(!0))}).fail(function(data){$(obj).removeAttr("disabled");var respo=data.responseText;respo&&-1!==respo.indexOf("loginMailId")&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.validMail"))})}else dPWordCont.addClass("error-clr");else dMailCont.addClass("error-clr");else dNameCont.addClass("error-clr")}},togglePwdView:function(obj){var pwdCont=$(obj).closest(".form-group").find("input");"password"!==pwdCont.attr("type")?pwdCont.attr("type","password"):pwdCont.attr("type","text")},openUpdatePwd:function(){var layout=Layout.Page.container;layout.find("#ZPAtt_DeviceSett_AddCredCont").hide(),layout.find("#ZPAtt_DeviceSett_AddCreInfo").hide(),layout.find("#ZPAtt_DeviceSett_UpdatePwdCont").show(),layout.find("#ZPAtt_DeviceSett_AddPopup .modal-title").text(ZPI18N.getString("zp.changepassword")),layout.find("#ZPAtt_DeviceSett_OldPassword,#ZPAtt_DeviceSett_NewPassword").val("").attr("type","password").removeClass("error-clr")},updatePassWord:function(){var layout=Layout.Page.container,oldPwd=layout.find("#ZPAtt_DeviceSett_OldPassword"),newPwd=layout.find("#ZPAtt_DeviceSett_NewPassword"),oldPwdVal=oldPwd.val().trim(),newPwdVal=newPwd.val().trim();if(oldPwd.removeClass("error-clr"),newPwd.removeClass("error-clr"),""!==oldPwdVal)if(""!==newPwdVal)if(0===Object.keys(Attendance.DeviceSettings.pwdPolicy).length&&newPwdVal.length<8)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.passwordlengshort"));else if(Attendance.DeviceSettings.validatePwdPolicy(newPwdVal))ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.passwordpolicy"));else{var param={mode:"updateDevicePwd",conreqcsr:csrfToken,zaid:Attendance.DeviceSettings.zaid,oldPassword:oldPwdVal,newPassword:newPwdVal,zuid:layout.find("#ZPAtt_DeviceSett_UpdatePwdCont").data("loginZuid")};layout.find("#ZPAtt_DeviceSett_addButt").attr("disabled","disabled"),$.post("/AttendanceDevice.zp",param,function(rdata){layout.find("#ZPAtt_DeviceSett_addButt").removeAttr("disabled");var resp=rdata.response;"success"===resp?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),Attendance.DeviceSettings.showHidePopupForDeviceConfig(!0),Attendance.DeviceSettings.init(!0)):"invalid old password"===resp?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.incorrectoldpassword")):"same as old password"===resp?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.newpasswordcantold")):"weakpassword"===resp?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.weakpassword")):"sequencecharactersnotallowed"===error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.password.sequencechar"))}).fail(function(data){layout.find("#ZPAtt_DeviceSett_addButt").removeAttr("disabled");var respo=data.responseText;respo&&-1!==respo.indexOf("oldPassword")&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.incorrectoldpassword"))})}else newPwd.addClass("error-clr");else oldPwd.addClass("error-clr")},validatePwdPolicy:function(passwd){var pwdKeys=Attendance.DeviceSettings.pwdPolicy;if(pwdKeys.hasOwnProperty("minPwdLen")&&passwd.length<pwdKeys.minPwdLen)return!0;if(pwdKeys.hasOwnProperty("mixedCase")){var regex=/[a-z]/g,regex2=/[A-Z]/g;if(!(null!==passwd.match(regex)&&passwd.match(regex).length>=1&&null!==passwd.match(regex2)&&passwd.match(regex2).length>=1))return!0}if(pwdKeys.hasOwnProperty("minSplChar")){var allFoundSplCharacters=passwd.match(/[@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/g);if(null===allFoundSplCharacters||!(allFoundSplCharacters.length>=pwdKeys.minSplChar))return!0}if(pwdKeys.hasOwnProperty("minNumChar")){var allFoundNumCharacters=passwd.match(/[\d]/g);if(null===allFoundNumCharacters||!(allFoundNumCharacters.length>=pwdKeys.minNumChar))return!0}return!1},showPwdPolicy:function(){var popup=Layout.Page.container.find("#ZPAtt_DeviceSett_AddPopup");if(!popup.find(".IC-eye").next()[0]&&0!==Object.keys(Attendance.DeviceSettings.pwdPolicy).length){var pwdDtls="";$.each(Attendance.DeviceSettings.pwdPolicy,function(key,val){"minPwdLen"==key?pwdDtls+=ZPI18N.getString("zp.pwdminlength")+" "+val+"<br><br>":"minNumChar"==key?pwdDtls+=ZPI18N.getString("zp.pwdminnumchar")+" "+val+"<br><br>":"minSplChar"==key?pwdDtls+=ZPI18N.getString("zp.pwdminsplchar")+" "+val+"<br><br>":"mixedCase"==key&&(pwdDtls+=ZPI18N.getString("zp.pwdmixedcase")+"<br><br>")});var info='<i class="IC-info gry ML10 popHover MT7" data-original-title="" data-placement="bottom" title="" data-popover="true" data-html="true" data-content="'+("<p class='LH18I P10I W200'>"+pwdDtls+"</p>")+'"></i>';popup.find(".IC-eye").parent().eq(0).append(info),popup.find(".IC-eye").parent().eq(2).append(info),popup.popover({selector:"[data-popover].popHover",trigger:"click hover",delay:{show:50,hide:50}})}},showDelConfirm:function(obj){var id=$(obj).closest("tr").attr("id");ZPeople.confirm(id,"",ZPI18N.getString("zp.devicelogindelconfirm"),Attendance.DeviceSettings.deleteUser,!1,!0,"",!0,!0)},deleteUser:function(id){var param={mode:"deleteDeviceUser",conreqcsr:csrfToken,deviceUserId:id};$.post("/AttendanceDevice.zp",param,function(){$("#"+id).remove(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),Attendance.DeviceSettings.init(!0)})}},Attendance.kiosk={loadInitialCont:function(){$("#ZPAtt_kioskFailureCont").remove(),$("#ZPAtt_PhotoCaptureModal").remove(),$("#ZPAtt_PhotoComparingPopup").remove(),$("#ZPAtt_KioskSuccCont").remove(),$("#ZPAtt_KioskInitialCont").show(),$("#ZPAtt_Kiosk_KName").text(portalName),$("#ZPAtt_KioskInitialCont .MT50").text(ZPI18N.getString("zp.kioskwelcomemsg",new Array(companyName))),$("#ZPAtt_Kiosk_LoginMailId").text(_LOGGEDIN_EMAIL),$("#ZPAtt_Kiosk_DName").html(_LOGGEDIN_NAME),$("#ZPAtt_Kiosk_Info").attr("isloaded")||($("#ZPAtt_Kiosk_Info").on("show.bs.modal",function(e){var id=$(this).attr("id");setTimeout(function(){$(".modal-backdrop").attr("id",id+"_BackDrop"),$("#"+id+"_BackDrop").click(function(){$("#"+id).modal("hide")})})}),Attendance.kiosk.fetchCurrLocation()),$("#ZPAtt_Kiosk_Info").attr("isloaded","true")},checkValidKName:function(){var kioskName=$("#ZPAtt_Kiosk_Name").val().trim();if($(".ERR").remove(),""!==kioskName){var param={mode:"checkValidKioskName",kioskName:kioskName};$.post("/AttendanceKioskAction.zp",param,function(rdata){rdata.isValid?window.location.href="/"+kioskName+"/cp/devicehome":$("#ZPAtt_Kiosk_Name").before("<span class='ERR MB10 ML45'>Incorrect kiosk name</span>")})}else $("#ZPAtt_Kiosk_Name").before("<span class='ERR MB10 ML45'>Enter kiosk name</span>")},copyTxtToClipBoard:function(){var i,successCopy,link=Attendance.DeviceSettings.domainUrl?Attendance.DeviceSettings.domainUrl:window.location.href,j=0,linkhref="";for(i=0;i<link.length&&("/"===link[i]&&j++,3!==j);i++)linkhref+=link[i];linkhref+="/kiosk",$("input#ZPAtt_KioskCopyInput").val(linkhref).trigger("select");try{!1===(successCopy=document.execCommand("copy"))?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.copyfailed")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.copysuccess"))}catch(exception){successCopy=!1,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.copyfailed"))}return successCopy},ClearCookies:function(){if(UDS_UPLOAD_URL.indexOf("/zfiles")>=0)window.location.href="/accounts/p/"+_LOGGEDIN_ZAID+"/logout?servicename=zohopeople&serviceurl="+window.location.href;else{var xhr=new XMLHttpRequest,logouturl=UDS_UPLOAD_URL.replace("webupload","logout");xhr.open("POST",logouturl+"?x-cli-zaid="+_LOGGEDIN_ZAID,!0),xhr.withCredentials=!0,xhr.send(),(xhr=new XMLHttpRequest).open("POST",UDS_DOWNLOAD_URL+"/logout?x-cli-zaid="+_LOGGEDIN_ZAID,!0),xhr.withCredentials=!0,xhr.send(),setTimeout(function(){window.location.href="/"+portalName+"/cp/Logout.zp?DIGEST="+zaidDigest},500)}},fetchCurrLocation:function(){if(navigator.geolocation){var extraParam={maximumAge:12e4,timeout:12e3};navigator.geolocation.getCurrentPosition(Attendance.kiosk.getGeoForPunch,Attendance.kiosk.geoErrForPunch,extraParam),setTimeout(function(){Attendance.kiosk.fetchCurrLocation()},12e4)}},getGeoForPunch:function(position){Attendance.kiosk.getLatLangFromGeo(position)},geoErrForPunch:function(error){Attendance.kiosk.errorForgetLatLang(error)},getLatLangFromGeo:function(position){var obj={};obj.latitude=position.coords.latitude,obj.longitude=position.coords.longitude,obj.accuracy=position.coords.accuracy,Attendance.Entry.storeLatLongInLStore(obj)},errorForgetLatLang:function(error){"undefined"!=typeof Storage&&localStorage.removeItem("att_LatLonDet")},openTakePhotoPopup:function(punchMode){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(stream){var notesMsg=ZPI18N.getString("zp.addanote"),butMsg=ZPI18N.getString("zp.checkout"),colClass="rd";"smart"===punchMode?(butMsg=ZPI18N.getString("zp.checkinout"),colClass="zpl_chkn-punch"):"checkIn"===punchMode&&(butMsg=ZPI18N.getString("zp.checkin"),colClass="gn"),$("#zpinitloading").remove();var modal="<div class='zp_mdl mdl_cntr top in fc_Recg ksk_fcrec in' id='ZPAtt_PhotoCaptureModal' aria-hidden='false' data-backdrop='static' data-keyboard='false'>";modal+="<div class='zp_mdl-dlg'><div class='zp_mdl-cnt' style='height:inherit;'><div class='zp_mdl-hdr' style='height:inherit;'><h6>"+ZPI18N.getString("zp.capturephoto")+"</h6>",modal+="<button aria-label=Close' data-dismiss='modal' class='close'><span aria-hidden='true'><div class='IC-cls-1px S24 CP' style='color: #D0021B;'></div></span></button></div>",modal+="<div class='zp_mdl-bdy' style='overflow: hidden;'><div class='ksk_inrtgs' style='border-radius:10px'>",modal+="<video id='ZPAtt_PhotoCapture_VideoPrev'>Video stream not available</video>",modal+="<img id='ZPAtt_PhotoCapture_output'><canvas id='ZPAtt_PhotoCaptureCanvas' style='display:none'></canvas></div>",modal+="<div class='fc_actn'><div class='cm_on' style='display: flex;'><i class='CR-camera' id='ZPAtt_PhotoCaptureButton'></i></div></div>",modal+="<div class='ksk_fcactn' style='display: flex;'><input class='ksk_adnte MR20' id='ZPAtt_Kiosk_AddNotes' type='text' placeholder='"+notesMsg+"'>",modal+="<button class='ksk_smbtn MR20 bk' id='ZPAtt_PhotoCaptureReTake'>"+ZPI18N.getString("zp.retake")+"</button>",modal+="<button class='ksk_smbtn "+colClass+"' data-dismiss='modal' id='ZPAtt_PhotoCaptureProceed'>"+butMsg+"</button></div>",modal+="</div></div></div></div>",$("body").find("#ZPAtt_PhotoCaptureModal")[0]||($("#ZPAtt_KioskInitialCont").parent().append(modal),$("#ZPAtt_KioskInitialCont").hide());var layout=$("#ZPAtt_PhotoCaptureModal");layout.modal("show"),layout.on("hidden.bs.modal",function(){Attendance.kiosk.onPhotoCaptureHide()});var videoPrev=layout.find("#ZPAtt_PhotoCapture_VideoPrev");videoPrev.css("width",videoPrev.parent().width()),videoPrev.css("transform","rotateY(180deg)"),videoPrev.css("-webkit-transform","rotateY(180deg)"),videoPrev.css("-moz-transform","rotateY(180deg)");var vdo=videoPrev[0];vdo.srcObject=stream,vdo.play(),layout.find("#ZPAtt_PhotoCaptureProceed").parent().hide(),layout.find("#ZPAtt_PhotoCaptureButton").on("click",function(){Attendance.kiosk.takePicture(punchMode)}),layout.find("#ZPAtt_PhotoCaptureReTake").on("click",function(){Attendance.kiosk.reTakePicture()}),videoPrev.show(),layout.find("#ZPAtt_PhotoCapture_output").hide()}).catch(function(err){Attendance.kiosk.onPhotoCaptureHide(!0),-1===err.toString().indexOf("Requested device not found")?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.youneedtoverifyphoto")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.notsupporttoverifyphoto"))})},playVideo:function(){var vdo=$("#ZPAtt_PhotoCaptureModal").find("#ZPAtt_PhotoCapture_VideoPrev")[0];navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(stream){vdo.srcObject=stream,vdo.play()}).catch(function(err){-1===err.toString().indexOf("Requested device not found")?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.youneedtoverifyphoto")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.notsupporttoverifyphoto"))})},onPhotoCaptureHide:function(isFromError){isFromError||(Attendance.kiosk.stopMediaPlay(),$("#ZPAtt_PhotoCaptureModal").remove(),$("#ZPAtt_KioskInitialCont").show()),Attendance.getCurrPositionTriggered=!1},takePicture:function(punchMode){var layout=$("#ZPAtt_PhotoCaptureModal"),video=layout.find("#ZPAtt_PhotoCapture_VideoPrev")[0],canvas=layout.find("#ZPAtt_PhotoCaptureCanvas")[0],photo=layout.find("#ZPAtt_PhotoCapture_output")[0],width=video.videoWidth,height=video.videoHeight,context=canvas.getContext("2d");canvas.width=width,canvas.height=height,context.translate(width,0),context.scale(-1,1),context.drawImage(video,0,0);var data=canvas.toDataURL("image/png");photo.setAttribute("src",data),layout.find("#ZPAtt_PhotoCapture_VideoPrev").hide(),layout.find("#ZPAtt_PhotoCapture_output").show(),Attendance.kiosk.stopMediaPlay(),layout.find("#ZPAtt_PhotoCaptureProceed").unbind("click").bind("click",function(){Attendance.kiosk.preceedPunches(data,punchMode)}),layout.find("#ZPAtt_PhotoCaptureProceed").parent().show(),layout.find("#ZPAtt_PhotoCaptureButton").parent().hide(),layout.find("h6").text(ZPI18N.getString("zp.capturedphoto"))},reTakePicture:function(){var layout=$("#ZPAtt_PhotoCaptureModal");layout.find("#ZPAtt_PhotoCapture_VideoPrev").show(),layout.find("#ZPAtt_PhotoCapture_output").hide(),layout.find("#ZPAtt_PhotoCapture_output")[0].src="",layout.find("#ZPAtt_PhotoCaptureProceed").parent().hide(),layout.find("#ZPAtt_PhotoCaptureButton").parent().show(),layout.find("h6").text(ZPI18N.getString("zp.capturephoto")),Attendance.kiosk.playVideo()},preceedPunches:function(data,punchMode){var base64ImageContent=data.replace(/^data:image\/(png|jpg);base64,/,""),blob=Attendance.kiosk.base64ToBlob(base64ImageContent,"image/png"),formData=new FormData;formData.append("conreqcsr",csrfToken),formData.append("userImage",blob,"userImage.png"),"smart"!==punchMode&&formData.append("isCheckin","checkIn"===punchMode);var notes=$("#ZPAtt_PhotoCaptureModal #ZPAtt_Kiosk_AddNotes").val().trim();if(""!==notes&&formData.append("desc",notes),$(".modal-backdrop").remove(),$("#ZPAtt_PhotoCaptureModal").remove(),Attendance.kiosk.openPhotoComparingPopup(data,null,null,!0),navigator&&!navigator.onLine&&window.location.reload(),"undefined"!=typeof Storage&&null!==localStorage.getItem("att_LatLonDet")){var latLonObj=JSON.parse(localStorage.getItem("att_LatLonDet"));void 0!==latLonObj.latitude&&(formData.append("latitude",latLonObj.latitude),formData.append("longitude",latLonObj.longitude),formData.append("accuracy",latLonObj.accuracy))}$.ajax({url:"/AttendanceDevice.zp?mode=addEntryByPhoto",type:"POST",data:formData,contentType:!1,processData:!1,success:function(rdata){void 0===rdata.status&&(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sessionexpired")),setTimeout(function(){location.reload()},3e3)),1!==rdata.status?Attendance.kiosk.openPhotoComparingPopup(data,null,rdata.result,!1):Attendance.kiosk.openPhotoComparingPopup(data,rdata.message,null,!1)},error:function(data){}})},stopMediaPlay:function(){$("#ZPAtt_PhotoCaptureModal").find("#ZPAtt_PhotoCapture_VideoPrev")[0].srcObject.getTracks().forEach(function(track){track.stop()})},openPhotoComparingPopup:function(imageObj,failureMsg,userDet,isScanning){var popCont="";if(isScanning)popCont="<div class='_scnng' id='ZPAtt_PhotoComparingPopup'><h5>"+ZPI18N.getString("zp.scanning")+"</h5><div class='PR'><div class='ksk_scnimg'>",popCont+="<img src='"+imageObj+"'></div><div style='width: 350px; height: 350px; float: left; overflow: hidden;'></div></div>",popCont+="<span class='scnng_desc'>"+ZPI18N.getString("zp.verifyingphoto")+"</span></div></div>",$("body").find("#ZPAtt_PhotoComparingPopup")[0]||($("#ZPAtt_KioskInitialCont").parent().append(popCont),$("#ZPAtt_KioskInitialCont").hide());else{if(failureMsg)return popCont="<div class='ksk_chknot' id='ZPAtt_kioskFailureCont'><div class='icn_sf fld'><i class='IC-cls-1px'></i></div><p class='S24 MB15 ZPbold'>"+ZPI18N.getString("zp.photomismatch")+"</p>",popCont+="<p class='ksk_txtfld'>"+failureMsg+"</p> <button class='ksk_smbtn bk' onclick='Attendance.kiosk.loadInitialCont();'>"+ZPI18N.getString("zp.retake")+"</button></div>",$("body").find("#ZPAtt_kioskFailureCont")[0]||($("#ZPAtt_KioskInitialCont").parent().append(popCont),$("#ZPAtt_PhotoComparingPopup").remove()),void setTimeout(function(){$("#ZPAtt_kioskFailureCont").remove(),$("#ZPAtt_KioskInitialCont").show()},4500);var dispName=$("<div/>").text(userDet.displayName+" - "+userDet.empId).html(),headMsg="checkIn"===userDet.currentOper?ZPI18N.getString("zp.checkinsuccess"):ZPI18N.getString("zp.checkoutsuccess");$("#ZPAtt_PhotoComparingTitle").html(headMsg+"<span>"+ZPI18N.getString("zp.photoverified")+"</span>");var fIn=userDet.fromTime?userDet.fromTime:"--/--",lOut=userDet.toTime?userDet.toTime:"--/--",hrs=userDet.totalHrs?userDet.totalHrs+" "+ZPI18N.getString("zp.hrs"):"00:00 "+ZPI18N.getString("zp.hrs");popCont="<div class='scngDv' id='ZPAtt_KioskSuccCont' style='display: flex;'><div class='icn_sf sucs'><i class='IC-tick'></i></div><p class='S24 MB15'>"+headMsg+"</p>",popCont+="<p class='S20 MB30'>"+ZPI18N.getString("zp.photomatched")+"</p><div class='chk_dtlbx'><div class='chk_smbx'></div>",popCont+="<img src='"+imageObj+"' style='width:310px;height:310px;' class='MB20'><p class='S24 MB15 TC'>"+dispName+"</p>",popCont+="<div class='chknout_dts'><div class='dot gn'></div><span class='prgs_Lne'></span><div class='dot rd'></div></div>",popCont+="<div class='chknout_dts MT10 MB20'><span>"+fIn+"</span><span>"+lOut+"</span></div><p class='S24'>"+hrs+"</p></div></div>",setTimeout(function(){$("#ZPAtt_KioskSuccCont").remove(),$("#ZPAtt_KioskInitialCont").show()},4500),$("body").find("#ZPAtt_KioskSuccCont")[0]||($("#ZPAtt_KioskInitialCont").parent().append(popCont),$("#ZPAtt_PhotoComparingPopup").remove())}},base64ToBlob:function(base64,mime){mime=mime||"";for(var byteChars=atob(base64),byteArrays=[],offset=0,len=byteChars.length;offset<len;offset+=1024){for(var slice=byteChars.slice(offset,offset+1024),byteNumbers=new Array(slice.length),i=0;i<slice.length;i++)byteNumbers[i]=slice.charCodeAt(i);var byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray)}return new Blob(byteArrays,{type:mime})}},Attendance.Settings={LayoutId:null,settingsPageId:null,isFirst:1,init:function(){isManageAttendanceData=ZPeople.Module.MODULE_DATA.attendance.isManageAttedance,isadmin&&(isManageAttendanceData=!0),Layout.Page.container.find("[data-toggle=tooltip]").tooltip({trigger:"click"});var layout=Layout.Page.container;if(Attendance.Settings.LayoutId="#"+Layout.Page.container[0].id,$("#zp_subtab_attendance_settings_shiftlister").hide(),$("#zp_subtab_attendance_settings_shiftmapping").hide(),-1!==Layout.Page.pageId.indexOf("attendance-settings-general"))Attendance.Settings.settingsPageId="genSett",$(Attendance.Settings.LayoutId+" #ZPAtt_settingsAddNew").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_generalSettings form").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_generalSettings form").fadeIn(200),Attendance.Settings.consInputTimeOnSett(),$(Attendance.Settings.LayoutId+" select").select2({minimumResultsForSearch:5}),Attendance.Settings.CustomizeTemplate.resetShiftReminderTemplateFields(),Attendance.Settings.generalSettings?(Attendance.Settings.CustomizeTemplate.getShiftReminderTemplate(Attendance.Settings.generalSettings),Attendance.Settings.consSettingsView()):Attendance.Settings.getSettInfo(),Attendance.Settings.ShiftSettList||Attendance.Settings.getShiftPermSettings(),Attendance.Settings.CustomizeTemplate.resetGraceTemplateFields(),$(Attendance.Settings.LayoutId).popover({selector:"[data-popover].popHover",trigger:"click hover",delay:{show:50,hide:50}});else if(-1!==Layout.Page.pageId.indexOf("attendance-settings-useridmapping"))0===$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetailsBody").children().length&&($(Attendance.Settings.LayoutId+" select").select2(),$(Attendance.Settings.LayoutId+" #ZPAtt_settingsAddNew").text(ZPI18N.getString("zp.adduseridmapping")),""===$(Attendance.Settings.LayoutId+" #ZPAtt_userIdMappingEmpName").val()&&(Attendance.changeinputtoselect2("ZPAtt_userIdMappingEmpName",Attendance.Settings.LayoutId),$(Attendance.Settings.LayoutId).popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"bottom",delay:{show:50,hide:50}})),Attendance.Settings.Mapper.getUserMapIdList()),$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").on("focus",function(){$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").next().html("")}),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetails").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_UIdMap_emptyRecInfo").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetails").fadeIn(200);else if(-1!==Layout.Page.pageId.indexOf("attendance-settings-user"))$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_filter").hasClass("ZPFilsel")&&Attendance.Settings.toggleFilter(),Attendance.Settings.settingsPageId="userSett",$(Attendance.Settings.LayoutId+" #ZPAtt_settingsAddNew").text(ZPI18N.getString("zp.addsettings")),Attendance.Settings.consInputTimeOnSett(),$(Attendance.Settings.LayoutId+" select").select2(),Attendance.Settings.userSettings?($(Attendance.Settings.LayoutId+" #ZPAtt_UserSett_emptyRecInfo").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettingsDetails").hide(),Attendance.Settings.USettings.consUsettingsDetails()):Attendance.Settings.getSettInfo("userSettings"),$(Attendance.Settings.LayoutId).popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"bottom",delay:{show:50,hide:50}});else if(-1!==Layout.Page.pageId.indexOf("attendance-settings-absentschedule"))$(Attendance.Settings.LayoutId+" #ZPAtt_absentSchedulerDet").parent().hide(),$(Attendance.Settings.LayoutId+" select").select2(),$(Attendance.Settings.LayoutId+" #ZPAtt_absSched_emptyRecInfo").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settingsAddNew").text(ZPI18N.getString("zp.addschedule")),0===$(Attendance.Settings.LayoutId+" #ZPAtt_absentSchedulerDetBody").children().length?(Attendance.Settings.Scheduler.showScheduleList(),$(Attendance.Settings.LayoutId).popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"bottom",delay:{show:50,hide:50}})):Attendance.Settings.Scheduler.consScheduleList();else if(-1!==Layout.Page.pageId.indexOf("attendance-settings-regularization")){$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDet").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_SettReg_emptyRecInfo").hide();var apprBtn=$(Attendance.Settings.LayoutId+" #ZPAtt_settingsAddNew").text(ZPI18N.getString("zp.addapproval"));if(0===$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDetBody").children().length?Attendance.Reg.getRegConfInfolist():$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_RegDet").parent().show(),$(Attendance.Settings.LayoutId+" #ZPAtt_settingsAddSet").length<1){var settingsBtn=$("<button/>").text(ZPI18N.getString("zp.approvalsettings")).addClass("btn btn-default  FR MT3 ML5").attr("id","ZPAtt_settingsAddSet").on("click",function(){ApprovalSettings.initiatePage(Attendance.Reg.formId,"Attendance Regularization")});apprBtn.parent().prepend(settingsBtn)}FromAddress.fetchAllFromAddress(),AutomationCommon.pageInsert(ApprovalProcess.MODE)}else if(-1!==Layout.Page.pageId.indexOf("attendance-settings-shiftmapping")){$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDet").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_SettUserShift_emptyRecInfo").hide();apprBtn=$(Attendance.Settings.LayoutId+" #ZPAtt_settingsAddNew").text(ZPI18N.getString("zp.addapproval"));if(0===$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDetBody").children().length?AttendanceShift.getuserShiftMapConfInfolist():$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShiftDet").parent().show(),$(Attendance.Settings.LayoutId+" #ZPAtt_settingsAddSet").length<1){settingsBtn=$("<button/>").text(ZPI18N.getString("zp.approvalsettings")).addClass("btn btn-default  FR MT3 ML5").attr("id","ZPAtt_settingsAddSet").on("click",function(){ApprovalSettings.initiatePage(AttendanceShift.formId,"Shift Change Request")});apprBtn.parent().prepend(settingsBtn)}FromAddress.fetchAllFromAddress(),AutomationCommon.pageInsert(ApprovalProcess.MODE)}else if(-1!==Layout.Page.pageId.indexOf("attendance-settings-onduty")){layout.find("#ZPAtt_Sett_OD_Det").parent().hide(),layout.find("#ZPAtt_SettOD_emptyRecInfo").hide();apprBtn=layout.find("#ZPAtt_settingsAddNew").text(ZPI18N.getString("zp.addapproval"));if(0===layout.find("#ZPAtt_Sett_OD_DetBody").children().length?Attendance.OD.getODConfInfolist():layout.find("#ZPAtt_Sett_OD_Det").parent().show(),layout.find("#ZPAtt_settingsAddSet").length<1){settingsBtn=$("<button/>").text(ZPI18N.getString("zp.approvalsettings")).addClass("btn btn-default  FR MT3 ML5").attr("id","ZPAtt_settingsAddSet").on("click",function(){ApprovalSettings.initiatePage(Attendance.OD.formId,"On Duty")});apprBtn.parent().prepend(settingsBtn)}FromAddress.fetchAllFromAddress(),AutomationCommon.pageInsert(ApprovalProcess.MODE)}else if(-1!==Layout.Page.pageId.indexOf("attendance-settings-permissionsapp")){layout.find("#ZPAtt_Sett_PermApp_Det").parent().hide(),layout.find("#ZPAtt_SettPermApp_emptyRecInfo").hide();apprBtn=layout.find("#ZPAtt_settingsAddNew").text(ZPI18N.getString("zp.addapproval"));if(0===layout.find("#ZPAtt_Sett_PermApp_DetBody").children().length?AttPermissions.getPermAppConfInfolist():layout.find("#ZPAtt_Sett_PermApp_Det").parent().show(),layout.find("#ZPAtt_settingsAddSet").length<1){settingsBtn=$("<button/>").text(ZPI18N.getString("zp.approvalsettings")).addClass("btn btn-default FR MT3 ML5").attr("id","ZPAtt_settingsAddSet").on("click",function(){ApprovalSettings.initiatePage(AttPermissions.formId,"Permissions")});apprBtn.parent().prepend(settingsBtn)}FromAddress.fetchAllFromAddress(),AutomationCommon.pageInsert(ApprovalProcess.MODE)}var pageID=Layout.Page.pageId;if(-1!==pageID.indexOf("attendance-settings-regularization")||-1!==pageID.indexOf("attendance-settings-shiftmapping")||-1!==pageID.indexOf("attendance-settings-onduty")||-1!==pageID.indexOf("attendance-settings-permissionsapp")){var container=Layout.Page.container.parent();if(!container.find(".navbar")[0]){var navCont="<nav class='navbar navbar-default ZPSnav'><div class='container-fluid'><ul class='nav navbar-nav'>";navCont+="<li id='navTab-attendance-settings-regularization'><a href='#attendance/settings/regularization'>"+ZPI18N.getString("zp.regularization")+"</a></li>",navCont+="<li id='navTab-attendance-settings-permissionsapp'><a href='#attendance/settings/permissionsapp'>"+ZPI18N.getString("zp.permissions")+"</a></li>",navCont+="<li id='navTab-attendance-settings-onduty'><a href='#attendance/settings/onduty'>"+ZPI18N.getString("zp.onduty")+"</a></li>",navCont+="<li id='navTab-attendance-settings-shiftmapping'><a href='#attendance/settings/shiftmapping'>"+ZPI18N.getString("zp.shiftchangeapprovals")+"</a></li>",container.prepend(navCont)}container.find("li").removeClass("active"),container.find("#navTab-"+pageID).addClass("active"),$("#zp_active_subtabs #zp_t_attendance_settings_regularization").parent().addClass("active").parent().show()}},consInputTimeOnSett:function(){var obj={showMeridian:!1,disableMousewheel:!0,minuteStep:1};$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"BreakTime").timepicker(obj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>720&&$(this).timepicker("setTime","12:00")}),$(Attendance.Settings.LayoutId+" #ZPAtt_shiftAllowanceMinHours").timepicker(obj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>720&&$(this).timepicker("setTime","12:00")}),Attendance.Settings.ShiftSettList||$(Attendance.Settings.LayoutId+" #ZPAtt_shiftAllowanceMinHours").timepicker("setTime","00:00");var notifyObj=obj;notifyObj.defaultTime="",$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"checkInNotifyBefore").timepicker(notifyObj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>300&&$(this).timepicker("setTime","05:00")}),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"checkInNotifyAfter").timepicker(notifyObj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>300&&$(this).timepicker("setTime","05:00")}),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"checkOutNotifyBefore").timepicker(notifyObj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>300&&$(this).timepicker("setTime","05:00")}),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"checkOutNotifyAfter").timepicker(notifyObj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>300&&$(this).timepicker("setTime","05:00")}),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"InMissReportNotifyAfter").timepicker(notifyObj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>300&&$(this).timepicker("setTime","05:00")}),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"LModePDay").timepicker(obj).on("changeTime.timepicker",function(e){var LModePDay=Attendance.changeToMin(e.time.hours,e.time.minutes);LModePDay>720&&$(this).timepicker("setTime","12:00");var MaxFDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxFDay").val().trim(),MaxFDayHour=parseInt(MaxFDay.split(":")[0]),MaxFDayMin=parseInt(MaxFDay.split(":")[1]);(MaxFDay=Attendance.changeToMin(MaxFDayHour,MaxFDayMin))<LModePDay&&$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxFDay").timepicker("setTime",Attendance.disHours(LModePDay,!0))}),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeFDay").timepicker(obj).on("changeTime.timepicker",function(e){var SModeFDay=Attendance.changeToMin(e.time.hours,e.time.minutes);SModeFDay>720&&$(this).timepicker("setTime","12:00");var SModeHDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeHDay").val().trim(),SModeHDayHour=parseInt(SModeHDay.split(":")[0]),SModeHDayMin=parseInt(SModeHDay.split(":")[1]);SModeHDay=Attendance.changeToMin(SModeHDayHour,SModeHDayMin),0===SModeFDay&&0!==SModeHDay?$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeHDay").timepicker("setTime",Attendance.disHours(SModeFDay,!0)):SModeHDay>=SModeFDay&&0!==SModeHDay&&$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeHDay").timepicker("setTime",Attendance.disHours(SModeFDay-1,!0));var MaxFDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxFDay").val().trim(),MaxFDayHour=parseInt(MaxFDay.split(":")[0]),MaxFDayMin=parseInt(MaxFDay.split(":")[1]);(MaxFDay=Attendance.changeToMin(MaxFDayHour,MaxFDayMin))<SModeFDay&&$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxFDay").timepicker("setTime",Attendance.disHours(SModeFDay,!0))}),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeHDay").timepicker(obj).on("changeTime.timepicker",function(e){var SModeHDay=Attendance.changeToMin(e.time.hours,e.time.minutes),SModeFDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeFDay").val().trim(),SModeFDayHour=parseInt(SModeFDay.split(":")[0]),SModeFDayMin=parseInt(SModeFDay.split(":")[1]);0===(SModeFDay=Attendance.changeToMin(SModeFDayHour,SModeFDayMin))&&0!==SModeHDay?$(this).timepicker("setTime",Attendance.disHours(SModeFDay,!0)):SModeHDay>=SModeFDay&&0!==SModeHDay&&$(this).timepicker("setTime",Attendance.disHours(SModeFDay-1,!0));var MaxHDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxHDay").val().trim(),MaxHDayHour=parseInt(MaxHDay.split(":")[0]),MaxHDayMin=parseInt(MaxHDay.split(":")[1]);MaxHDay=Attendance.changeToMin(MaxHDayHour,MaxHDayMin),$("input:radio[name=ZPAtt_"+Attendance.Settings.settingsPageId+"AttMarkHours]")[1].checked&&(SModeHDay=Math.round(Attendance.Settings.maxShiftDiffTime/2)),MaxHDay<SModeHDay&&$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxHDay").timepicker("setTime",Attendance.disHours(SModeHDay,!0))}),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxFDay").timepicker(obj).on("changeTime.timepicker",function(e){var MaxFDay=Attendance.changeToMin(e.time.hours,e.time.minutes),SModeFDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeFDay").val().trim();$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"LModePDay").is(":visible")&&(SModeFDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"LModePDay").val().trim());var SModeFDayHour=parseInt(SModeFDay.split(":")[0]),SModeFDayMin=parseInt(SModeFDay.split(":")[1]);SModeFDay=Attendance.changeToMin(SModeFDayHour,SModeFDayMin),$("input:radio[name=ZPAtt_"+Attendance.Settings.settingsPageId+"AttMarkHours]")[1].checked&&(SModeFDay=Attendance.Settings.maxShiftDiffTime),MaxFDay<SModeFDay&&$(this).timepicker("setTime",Attendance.disHours(SModeFDay,!0));var MaxHDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxHDay").val().trim(),MaxHDayHour=parseInt(MaxHDay.split(":")[0]),MaxHDayMin=parseInt(MaxHDay.split(":")[1]);MaxHDay=Attendance.changeToMin(MaxHDayHour,MaxHDayMin),$("input:radio[name=ZPAtt_"+Attendance.Settings.settingsPageId+"AttMarkHours]")[1].checked&&(MaxFDay=Math.round(Attendance.Settings.maxShiftDiffTime/2)),MaxHDay>MaxFDay&&$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxHDay").timepicker("setTime",Attendance.disHours(MaxFDay,!0))}),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxHDay").timepicker(obj).on("changeTime.timepicker",function(e){var MaxHDay=Attendance.changeToMin(e.time.hours,e.time.minutes),SModeHDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeHDay").val().trim(),SModeHDayHour=parseInt(SModeHDay.split(":")[0]),SModeHDayMin=parseInt(SModeHDay.split(":")[1]);SModeHDay=Attendance.changeToMin(SModeHDayHour,SModeHDayMin),$("input:radio[name=ZPAtt_"+Attendance.Settings.settingsPageId+"AttMarkHours]")[1].checked&&(SModeHDay=Math.round(Attendance.Settings.maxShiftDiffTime/2)),MaxHDay<SModeHDay&&$(this).timepicker("setTime",Attendance.disHours(SModeHDay,!0));var MaxFDay=$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"MaxFDay").val().trim(),MaxFDayHour=parseInt(MaxFDay.split(":")[0]),MaxFDayMin=parseInt(MaxFDay.split(":")[1]);MaxFDay=Attendance.changeToMin(MaxFDayHour,MaxFDayMin),$("input:radio[name=ZPAtt_"+Attendance.Settings.settingsPageId+"AttMarkHours]")[1].checked&&(MaxFDay=Attendance.Settings.maxShiftDiffTime),MaxHDay>MaxFDay&&$(this).timepicker("setTime",Attendance.disHours(MaxFDay,!0))})},getSettInfo:function(settings){var param={mode:"getAttConfInfo",conreqcsr:csrfToken};$(Attendance.Settings.LayoutId+" #ZPAtt_userSettingsDet_myReqNameSort").hasClass("sort")||(param.isNameSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_userSettingsDet_myReqNameSort").hasClass("sort-u")),"userSettings"===settings&&Attendance.toggleLoadingDiv(!1,$(Attendance.Settings.LayoutId+" #ZPAtt_userSettings"),$(Attendance.Settings.LayoutId+" #ZPAtt_UserSett_emptyRecInfo")),$.post("/AttendanceSettingsAction.zp",param,function(rdata){rdata.fail||("hh:mm a"!==rdata.timeformat?Attendance.timeFormatIs12hr=!1:Attendance.timeFormatIs12hr=!0,Attendance.Settings.shiftList=rdata.shiftlist,Attendance.Settings.dateInfo=rdata.dateInfo,Attendance.Settings.generalSettings=rdata.confInfo.default,Attendance.Settings.userSettings=rdata.confInfo,Attendance.Settings.permLocList=rdata.locList,Attendance.Settings.trackLateNightWork=rdata.trackLateNightWork,rdata.isV2Enabled&&(Attendance.Settings.gracePeriod.leaveList=rdata.leaveTypes,Attendance.Settings.gracePeriod.isV2Leave=rdata.isV2Enabled),Attendance.Settings.sortedIdList=rdata.confInfo.sortedId,"userSettings"===settings?(Attendance.Settings.USettings.consUsettingsDetails(),Attendance.Settings.consShiftListSelect()):(Attendance.Settings.consSettingsView(),Attendance.Settings.tooglePastShiftEditPerm(),Attendance.Settings.CustomizeTemplate.getShiftReminderTemplate(Attendance.Settings.generalSettings)))})},consSettingsView:function(rdata,isAdd){var layout=Layout.Page.container,pageId=Attendance.Settings.settingsPageId;if(rdata?(rdata.Att_settingsName&&layout.find("#ZPAtt_settingsName").val(rdata.Att_settingsName.trim()),Attendance.Settings.onSettForChange()):(rdata=Attendance.Settings.generalSettings,Attendance.Settings.settingsId=null,layout.find("#ZPAtt_effectiveFromDate").val(rdata.Att_validRecordFrom),Attendance.Settings.consShiftListSelect("genSettShift"),$($("input:radio[name=ZPAtt_genSettScaleView]")[0]).is(":visible")&&(0===rdata.Att_ShowScaleView?$("input:radio[name=ZPAtt_genSettScaleView]")[0].checked=!0:$("input:radio[name=ZPAtt_genSettScaleView]")[1].checked=!0,$("input:radio[name=ZPAtt_genSettPwdProtect]")[0].checked=!0,0===rdata.Att_isPwdProtect&&($("input:radio[name=ZPAtt_genSettPwdProtect]")[1].checked=!0))),layout.find("#ZPAtt_applySettFromDate").val(Attendance.Settings.dateInfo.monthStartDate),layout.find("#ZPAtt_applySettToDate").val(Attendance.Settings.dateInfo.todayDate),0===rdata.Att_Intervels?$("input:radio[name=ZPAtt_"+pageId+"Interval]")[1].checked=!0:$("input:radio[name=ZPAtt_"+pageId+"Interval]")[0].checked=!0,layout.find("#ZPAtt_"+pageId+"Settings").hide(),rdata.Att_BreakTime>0&&!isAdd){var breakTime=Attendance.disHours(rdata.Att_BreakTime,!0);layout.find("#ZPAtt_"+pageId+"BreakTime").timepicker("setTime",breakTime),layout.find("#ZPAtt_"+pageId+"Settings").show()}0===rdata.Att_useShiftHrs?$("input:radio[name=ZPAtt_"+pageId+"AttMarkHours]")[0].checked=!0:$("input:radio[name=ZPAtt_"+pageId+"AttMarkHours]")[1].checked=!0,0===rdata.Att_minHrsEnabled?($("input:radio[name=ZPAtt_"+pageId+"AttMarking]")[0].checked=!0,layout.find("#ZPAtt_"+pageId+"LModeHoursCont").parent().css("height","74px"),layout.find("#ZPAtt_"+pageId+"MaxHoursCont").css("height","84px"),layout.find("#ZPAtt_"+pageId+"MaxHoursHalfDayCont").show(),layout.find("#ZPAtt_"+pageId+"LModeHoursCont").hide(),layout.find("#ZPAtt_"+pageId+"SModeHoursCont").show(),layout.find("#ZPAtt_"+pageId+"SModeHoursCont .selinput").show().next().hide(),1===rdata.Att_useShiftHrs&&layout.find("#ZPAtt_"+pageId+"SModeHoursCont .selinput").hide().next().show()):($("input:radio[name=ZPAtt_"+pageId+"AttMarking]")[1].checked=!0,layout.find("#ZPAtt_"+pageId+"LModeHoursCont").parent().css("height","34px"),layout.find("#ZPAtt_"+pageId+"MaxHoursCont").css("height","44px"),layout.find("#ZPAtt_"+pageId+"MaxHoursHalfDayCont").hide(),layout.find("#ZPAtt_"+pageId+"LModeHoursCont").show(),layout.find("#ZPAtt_"+pageId+"SModeHoursCont").hide(),layout.find("#ZPAtt_"+pageId+"LModeHoursCont .selinput").show().next().hide(),1===rdata.Att_useShiftHrs&&layout.find("#ZPAtt_"+pageId+"LModeHoursCont .selinput").hide().next().show());var settingsFullDay=Attendance.disHours(rdata.Att_fullday,!0);layout.find("#ZPAtt_"+pageId+"SModeFDay").timepicker("setTime",settingsFullDay);var settingsHalfDay=Attendance.disHours(rdata.Att_halfday,!0);layout.find("#ZPAtt_"+pageId+"SModeHDay").timepicker("setTime",settingsHalfDay);var settingsPerDay=Attendance.disHours(rdata.Att_ExpectedWorkingHrs,!0);layout.find("#ZPAtt_"+pageId+"LModePDay").timepicker("setTime",settingsPerDay),0===rdata.Att_showOTDT?layout.find("#ZPAtt_"+pageId+"ShowOverDevTime")[0].checked=!0:layout.find("#ZPAtt_"+pageId+"ShowOverDevTime")[0].checked=!1,0===rdata.Att_maxHrsEnabled?($("input:radio[name=ZPAtt_"+pageId+"MaxHours]")[0].checked=!0,layout.find("#ZPAtt_"+pageId+"MaxHoursCont").show()):($("input:radio[name=ZPAtt_"+pageId+"MaxHours]")[1].checked=!0,layout.find("#ZPAtt_"+pageId+"MaxHoursCont").hide());var settingsMaxFullDay=Attendance.disHours(rdata.Att_maxHoursFullday,!0);layout.find("#ZPAtt_"+pageId+"MaxFDay").timepicker("setTime",settingsMaxFullDay);var settingsMaxHalfDay=Attendance.disHours(rdata.Att_maxHoursHalfday,!0);layout.find("#ZPAtt_"+pageId+"MaxHDay").timepicker("setTime",settingsMaxHalfDay);var settParent=Layout.Page.container.find("#ZPAtt_popUpContent_uSettings");"genSett"===pageId&&(settParent=Layout.Page.container.find("#ZPAtt_generalSettings")),0===rdata.Att_AllowUIEntry?$("input:radio[name=ZPAtt_"+pageId+"UIEntry]",settParent)[0].checked=!0:($("input:radio[name=ZPAtt_"+pageId+"UIEntry]",settParent)[1].checked=!0,settParent.find("#ZPAtt_"+pageId+"UIEntryLoc").attr("disabled",!0),settParent.find("#ZPAtt_"+pageId+"CaptureImageWeb").attr("disabled",!0),settParent.find("#ZPAtt_"+pageId+"VerifyUserWeb").attr("disabled",!0)),settParent.find("#ZPAtt_"+pageId+"UIEntryLoc")[0].checked=!1,rdata.Att_advaSetts&&rdata.Att_advaSetts.Att_AllowUIEntryLoc&&0===rdata.Att_AllowUIEntry&&(settParent.find("#ZPAtt_"+pageId+"UIEntryLoc")[0].checked=!0),settParent.find("#ZPAtt_"+pageId+"CaptureImageWeb")[0].checked=!1,1===rdata.Att_CapturePhotoInWeb&&(settParent.find("#ZPAtt_"+pageId+"CaptureImageWeb")[0].checked=!0),settParent.find("#ZPAtt_"+pageId+"VerifyUserWeb")[0].checked=!1,1===rdata.Att_VerifyUserPhotoInWeb&&(settParent.find("#ZPAtt_"+pageId+"VerifyUserWeb")[0].checked=!0),1==rdata.Att_AllowMobileEntry?$("input:radio[name=ZPAtt_"+pageId+"MobileEntry]",settParent)[0].checked=!0:($("input:radio[name=ZPAtt_"+pageId+"MobileEntry]",settParent)[1].checked=!0,settParent.find("#ZPAtt_"+pageId+"MobileEntryLoc").attr("disabled",!0),settParent.find("#ZPAtt_"+pageId+"CaptureImageMobile").attr("disabled",!0),settParent.find("#ZPAtt_"+pageId+"VerifyUserMobile").attr("disabled",!0)),settParent.find("#ZPAtt_"+pageId+"MobileEntryLoc")[0].checked=!1,rdata.Att_advaSetts&&rdata.Att_advaSetts.Att_AllowMobileEntryLoc&&1==rdata.Att_AllowMobileEntry&&(settParent.find("#ZPAtt_"+pageId+"MobileEntryLoc")[0].checked=!0),settParent.find("#ZPAtt_"+pageId+"CaptureImageMobile")[0].checked=!1,1===rdata.Att_CapturePhotoInMobile&&(settParent.find("#ZPAtt_"+pageId+"CaptureImageMobile")[0].checked=!0),settParent.find("#ZPAtt_"+pageId+"VerifyUserMobile")[0].checked=!1,1===rdata.Att_VerifyUserPhotoInMobile&&(settParent.find("#ZPAtt_"+pageId+"VerifyUserMobile")[0].checked=!0),0===rdata.Att_showAllEntries?$("input:radio[name=ZPAtt_"+pageId+"ShowAllEntry]")[0].checked=!0:$("input:radio[name=ZPAtt_"+pageId+"ShowAllEntry]")[1].checked=!0,0===rdata.Att_ReportManView?$("input:radio[name=ZPAtt_"+pageId+"ReportManView]")[0].checked=!0:$("input:radio[name=ZPAtt_"+pageId+"ReportManView]")[1].checked=!0,0===rdata.Att_ReportManEdit?($("input:radio[name=ZPAtt_"+pageId+"ReportManEdit]")[0].checked=!0,layout.find("#ZPAtt_"+pageId+"SubOrdEdit").show()):($("input:radio[name=ZPAtt_"+pageId+"ReportManEdit]")[1].checked=!0,layout.find("#ZPAtt_"+pageId+"SubOrdEdit").hide()),0===rdata.Att_ReportManNotify?layout.find("#ZPAtt_"+pageId+"SubEditNotifyCheck")[0].checked=!0:layout.find("#ZPAtt_"+pageId+"SubEditNotifyCheck")[0].checked=!1,layout.find("#ZPAtt_"+pageId+"SubEditNotifyCheck")[0].checked?layout.find("#ZPAtt_"+pageId+"SubEditNotifyEmail").removeAttr("disabled"):layout.find("#ZPAtt_"+pageId+"SubEditNotifyEmail").attr("disabled","disabled");var subEditNotifyMailId=decodeHTML(rdata.Att_ReportManNotifyMailID);if(layout.find("#ZPAtt_"+pageId+"SubEditNotifyEmail").val(subEditNotifyMailId),0===rdata.Att_UserEdit?($("input:radio[name=ZPAtt_"+pageId+"UserEdit]")[0].checked=!0,layout.find("#ZPAtt_"+pageId+"OwnEntryEdit").children().show()):($("input:radio[name=ZPAtt_"+pageId+"UserEdit]")[1].checked=!0,layout.find("#ZPAtt_"+pageId+"OwnEntryEdit").children().hide()),0===rdata.Att_UserEditNotify?layout.find("#ZPAtt_"+pageId+"OwnEditNotifyCheck")[0].checked=!0:layout.find("#ZPAtt_"+pageId+"OwnEditNotifyCheck")[0].checked=!1,0===rdata.Att_UserEditNotifyTOReportMan?layout.find("#ZPAtt_"+pageId+"OwnEditNotifyMan")[0].checked=!0:layout.find("#ZPAtt_"+pageId+"OwnEditNotifyMan")[0].checked=!1,layout.find("#ZPAtt_"+pageId+"OwnEditNotifyCheck")[0].checked?layout.find("#ZPAtt_"+pageId+"OwnEditNotifyEmail").removeAttr("disabled"):layout.find("#ZPAtt_"+pageId+"OwnEditNotifyEmail").attr("disabled","disabled"),!rdata.Att_advaSetts||void 0===rdata.Att_advaSetts.Att_TrackLocation||rdata.Att_advaSetts.Att_TrackLocation?$("input:radio[name=ZPAtt_"+pageId+"TrackLocation]")[0].checked=!0:$("input:radio[name=ZPAtt_"+pageId+"TrackLocation]")[1].checked=!0,rdata.Att_advaSetts&&rdata.Att_advaSetts.Att_RestrictiOSAutoEntry?$("#ZPAtt_"+pageId+"AutoEntry").prop("checked",!0):$("#ZPAtt_"+pageId+"AutoEntry").prop("checked",!1),rdata.Att_advaSetts&&rdata.Att_advaSetts.roundOff){var roundOff=rdata.Att_advaSetts.roundOff;$("input:radio[name=ZPAtt_"+pageId+"RoundOff]")[0].checked=!0,layout.find("#ZPAtt_"+pageId+"RoundOffConfig").show(),layout.find("#ZPAtt_"+pageId+"RoundOffIn").val(roundOff.firstIn?roundOff.firstIn:""),layout.find("#ZPAtt_"+pageId+"RoundOffOut").val(roundOff.lastOut?roundOff.lastOut:""),layout.find("#ZPAtt_"+pageId+"RoundOffHrs").val(roundOff.hours?roundOff.hours:"")}else $("input:radio[name=ZPAtt_"+pageId+"RoundOff]")[1].checked=!0,layout.find("#ZPAtt_"+pageId+"RoundOffConfig").hide(),layout.find("#ZPAtt_"+pageId+"RoundOffIn").val(""),layout.find("#ZPAtt_"+pageId+"RoundOffOut").val(""),layout.find("#ZPAtt_"+pageId+"RoundOffHrs").val("");layout.find(".mode-input_err").remove();var userEditNotifyMailId=decodeHTML(rdata.Att_UserEditNotifyMailID);if(layout.find("#ZPAtt_"+pageId+"OwnEditNotifyEmail").val(userEditNotifyMailId),Attendance.Settings.constructPermValFromCheckBox(rdata.Att_ShowReport,"showReport",void 0),Attendance.Settings.constructPermValFromCheckBox(rdata.Att_showBalOt,"BalanceOT",!0),Attendance.Settings.constructPermValFromCheckBox(rdata.Att_editBalOt,"BalanceOT",!1),layout.find("#ZPAtt_userSettings").is(":visible")&&(Attendance.Settings.graceData=$.extend({},rdata.Att_advaSetts&&rdata.Att_advaSetts.Att_GracePeriod,!0),Attendance.Settings.gracePeriod.consGraceSettView(),Attendance.Settings.gracePeriod.consGraceMailAlert(rdata)),layout.find("#ZPAtt_"+pageId+"checkInNotifyBefore").timepicker("setTime",""),layout.find("#ZPAtt_"+pageId+"checkInNotifyAfter").timepicker("setTime",""),layout.find("#ZPAtt_"+pageId+"checkOutNotifyBefore").timepicker("setTime",""),layout.find("#ZPAtt_"+pageId+"checkOutNotifyAfter").timepicker("setTime",""),layout.find("#ZPAtt_"+pageId+"InMissReportNotifyAfter").timepicker("setTime",""),rdata.hasOwnProperty("Att_checkInNotifyBefore")){var checkInNotifyBefore=Attendance.disHours(rdata.Att_checkInNotifyBefore,!0);layout.find("#ZPAtt_"+pageId+"checkInNotifyBefore").timepicker("setTime",checkInNotifyBefore)}if(rdata.hasOwnProperty("Att_checkInNotifyAfter")){var checkInNotifyAfter=Attendance.disHours(rdata.Att_checkInNotifyAfter,!0);layout.find("#ZPAtt_"+pageId+"checkInNotifyAfter").timepicker("setTime",checkInNotifyAfter)}if(rdata.hasOwnProperty("Att_checkOutNotifyBefore")){var checkOutNotifyBefore=Attendance.disHours(rdata.Att_checkOutNotifyBefore,!0);layout.find("#ZPAtt_"+pageId+"checkOutNotifyBefore").timepicker("setTime",checkOutNotifyBefore)}if(rdata.hasOwnProperty("Att_checkOutNotifyAfter")){var checkOutNotifyAfter=Attendance.disHours(rdata.Att_checkOutNotifyAfter,!0);layout.find("#ZPAtt_"+pageId+"checkOutNotifyAfter").timepicker("setTime",checkOutNotifyAfter)}if(rdata.hasOwnProperty("Att_MissInNotifyAfter")){var attInMissNotifyAfter=Attendance.disHours(rdata.Att_MissInNotifyAfter,!0);layout.find("#ZPAtt_"+pageId+"InMissReportNotifyAfter").timepicker("setTime",attInMissNotifyAfter)}"userSett"===pageId&&layout.find("[name=ZPAtt_userSettFor]")[0].checked;if(layout.find("#ZPAtt_userSettToggleShiftReminder").show(),layout.find("#ZPAtt_"+pageId+"DaysAfterForReg").val(""),layout.find("#ZPAtt_"+pageId+"NumberOfRegRequests").val(""),layout.find("#ZPAtt_"+pageId+"RegDateRange").val("0").trigger("change"),layout.find("input:radio[name=ZPAtt_"+pageId+"RegAllowedForFuture]")[1].checked=!0,rdata.hasOwnProperty("Att_Reg_allowedForFuture")&&(layout.find("input:radio[name=ZPAtt_"+pageId+"RegAllowedForFuture]")[rdata.Att_Reg_allowedForFuture?0:1].checked=!0),rdata.hasOwnProperty("Att_Reg_restrictedAfter")&&layout.find("#ZPAtt_"+pageId+"DaysAfterForReg").val(rdata.Att_Reg_restrictedAfter),rdata.hasOwnProperty("Att_Reg_allowedTimes")&&(layout.find("#ZPAtt_"+pageId+"NumberOfRegRequests").val(rdata.Att_Reg_allowedTimes),layout.find("#ZPAtt_"+pageId+"RegDateRange").val(rdata.Att_Reg_allowedInPeriod).trigger("change")),layout.find("#ZPAtt_"+pageId+"DaysAfterRegDiv").find(".attRegErr").hide(),layout.find("#ZPAtt_"+pageId+"NumberOfRegRequestsDiv").find(".attRegErr").hide(),layout.find("#ZPAtt_"+pageId+"DaysAfterForReg").on("change",function(){var DaysAfterForReg=layout.find("#ZPAtt_"+pageId+"DaysAfterForReg").val();/^\d+$/.test(DaysAfterForReg)||""===DaysAfterForReg?layout.find("#ZPAtt_"+pageId+"DaysAfterRegDiv").find(".attRegErr").hide():layout.find("#ZPAtt_"+pageId+"DaysAfterRegDiv").find(".attRegErr").show()}),layout.find("#ZPAtt_"+pageId+"NumberOfRegRequests").on("change",function(){var numberOfRegRequests=layout.find("#ZPAtt_"+pageId+"NumberOfRegRequests").val(),isNum=/^\d+$/.test(numberOfRegRequests);isNum&&0===parseInt(numberOfRegRequests)&&"genSett"===pageId&&(Attendance.Settings.generalSettings.hasOwnProperty("Att_Reg_allowedTimes")?(layout.find("#ZPAtt_"+pageId+"NumberOfRegRequests").val(Attendance.Settings.generalSettings.Att_Reg_allowedTimes),numberOfRegRequests=Attendance.Settings.generalSettings.Att_Reg_allowedTimes):(layout.find("#ZPAtt_"+pageId+"NumberOfRegRequests").val(""),numberOfRegRequests="")),isNum||""===numberOfRegRequests?layout.find("#ZPAtt_"+pageId+"NumberOfRegRequestsDiv").find(".attRegErr").hide():layout.find("#ZPAtt_"+pageId+"NumberOfRegRequestsDiv").find(".attRegErr").show()}),"genSett"===pageId){$("input:radio[name=ZPAtt_genSettIncStatWknd]")[1].checked=!0,$("input:radio[name=ZPAtt_genSettIncStatWknd]").closest(".form-group").addClass("DNI"),$("input:radio[name=ZPAtt_genSettIncNonStatWknd]")[1].checked=!0,$("input:radio[name=ZPAtt_genSettIncNonStatWknd]").closest(".form-group").addClass("DNI"),0===rdata.Att_payPer_IncWknd?$("input:radio[name=ZPAtt_genSettIncWknd]")[0].checked=!0:$("input:radio[name=ZPAtt_genSettIncWknd]")[1].checked=!0,0===rdata.Att_payPer_IncHlday?$("input:radio[name=ZPAtt_genSettIncHlday]")[0].checked=!0:$("input:radio[name=ZPAtt_genSettIncHlday]")[1].checked=!0,0===rdata.Att_payPer_IncLeave?$("input:radio[name=ZPAtt_genSettIncLeave]")[0].checked=!0:$("input:radio[name=ZPAtt_genSettIncLeave]")[1].checked=!0,!0===hasHalfWeekendFlag&&1===isWeekendPayFlag&&(0===rdata.Att_fullPay_halfWorking?$("input:radio[name=ZPAtt_genSettFullPayForHalfDay]")[1].checked=!0:$("input:radio[name=ZPAtt_genSettFullPayForHalfDay]")[0].checked=!0),void 0!==settParent.find("#treatAsLevOnRequest")[0]&&(settParent.find("#treatAsLevOnRequest")[0].checked=!0,rdata.treatAsLevOnApproval&&(settParent.find("#treatAsLevOnApproval")[0].checked=!0));var isCarryOverOT=!rdata.Att_advaSetts||void 0===rdata.Att_advaSetts.Att_isCarryOverOT||rdata.Att_advaSetts.Att_isCarryOverOT,carryOverRadio=layout.find("input:radio[name=ZPAtt_genSettCarryOverOT]");isCarryOverOT?carryOverRadio[0].checked=!0:carryOverRadio[1].checked=!0,0===rdata.onDutyEnabled?$("input:radio[name=ZPAtt_genSettonDuty]")[1].checked=!0:(Attendance.OD.getODConfInfolist(),$("input:radio[name=ZPAtt_genSettonDuty]")[0].checked=!0),0===rdata.onDutyTypeEnabled?$("input:radio[name=ZPAtt_genSettonDutyType]")[1].checked=!0:$("input:radio[name=ZPAtt_genSettonDutyType]")[0].checked=!0,1===rdata.onDutyFullDayEnabled?settParent.find("#ZPAtt_"+pageId+"OnDutyFullDay")[0].checked=!0:settParent.find("#ZPAtt_"+pageId+"OnDutyFullDay")[0].checked=!1,1===rdata.onDutyHalfDayEnabled?settParent.find("#ZPAtt_"+pageId+"OnDutyHalfDay")[0].checked=!0:settParent.find("#ZPAtt_"+pageId+"OnDutyHalfDay")[0].checked=!1,1===rdata.onDutyQuatDayEnabled?settParent.find("#ZPAtt_"+pageId+"OnDutyQuatDay")[0].checked=!0:settParent.find("#ZPAtt_"+pageId+"OnDutyQuatDay")[0].checked=!1,1===rdata.onDutyHoursEnabled?settParent.find("#ZPAtt_"+pageId+"OnDutyHours")[0].checked=!0:settParent.find("#ZPAtt_"+pageId+"OnDutyHours")[0].checked=!1,1===rdata.isOnDutyReasonMandatory?settParent.find("#ZPAtt_"+pageId+"IsODReasonMandatory")[0].checked=!0:settParent.find("#ZPAtt_"+pageId+"IsODReasonMandatory")[0].checked=!1,0===rdata.restrictOnDutyForFuture?settParent.find("#ZPAtt_"+pageId+"IsODRestrictedForFuture")[0].checked=!1:settParent.find("#ZPAtt_"+pageId+"IsODRestrictedForFuture")[0].checked=!0;var odObj=rdata.Att_ondutySetts?rdata.Att_ondutySetts:{};if(rdata.onDutyTypeEnabled?(Attendance.Settings.consODTypes(odObj),$("input:radio[name=ZPAtt_genSettonDutyType]")[0].checked=!0,layout.find("#od_table").show(),layout.find("#ZPAtt_typesOfOnDuty").removeClass("DN")):($("input:radio[name=ZPAtt_genSettonDutyType]")[1].checked=!0,layout.find("#od_table").hide(),layout.find("#ZPAtt_typesOfOnDuty").addClass("DN")),Attendance.Settings.toggleConsOnDutySett(),rdata.Att_advaSetts&&rdata.Att_advaSetts.regReasons)!0===rdata.Att_advaSetts.regReasons.enabled?($("input:radio[name=ZPAtt_enable_reg_reasons]")[0].checked=!0,Attendance.Settings.consRegReasons()):($("input:radio[name=ZPAtt_enable_reg_reasons]")[1].checked=!0,layout.find("#reg_reason_table").hide(),layout.find("#reg_reason_table").closest(".form-group").addClass("DN"));else $("input:radio[name=ZPAtt_enable_reg_reasons]")[1].checked=!0,layout.find("#reg_reason_table").hide(),layout.find("#reg_reason_table").closest(".form-group").addClass("DN");rdata.Att_advaSetts&&rdata.Att_advaSetts.raiseMultiReg?$("input:radio[name=ZPAtt_enable_multirecperday]")[0].checked=!0:$("input:radio[name=ZPAtt_enable_multirecperday]")[1].checked=!0;var shiftMinHours=Attendance.disHours(rdata.shiftAllowanceMinHours,!0);layout.find("#ZPAtt_shiftAllowanceMinHours").timepicker("setTime",shiftMinHours),ZPeople.Module.MODULE_DATA.attendance.isStatWkndConfig&&($("input:radio[name=ZPAtt_genSettIncStatWknd]").closest(".form-group").removeClass("DNI"),$("input:radio[name=ZPAtt_genSettIncNonStatWknd]").closest(".form-group").removeClass("DNI"),$("input:radio[name=ZPAtt_genSettIncStatWknd]")[1].checked=!0,$("input:radio[name=ZPAtt_genSettIncNonStatWknd]")[1].checked=!0,(void 0===rdata.Att_advaSetts||rdata.Att_advaSetts&&(void 0===rdata.Att_advaSetts.Att_incStatWknd||rdata.Att_advaSetts.Att_incStatWknd))&&($("input:radio[name=ZPAtt_genSettIncStatWknd]")[0].checked=!0),(void 0===rdata.Att_advaSetts||rdata.Att_advaSetts&&(void 0===rdata.Att_advaSetts.Att_incNonStatWknd||rdata.Att_advaSetts.Att_incNonStatWknd))&&($("input:radio[name=ZPAtt_genSettIncNonStatWknd]")[0].checked=!0));var trackLateNightWork=Attendance.Settings.trackLateNightWork;layout.find("#ZPAtt_lateNightSetFormGroup").children().children().remove(),Attendance.Settings.locList=_.clone(Attendance.Settings.permLocList),trackLateNightWork&&trackLateNightWork.length>0?(layout.find("#ZPAtt_lateNightWork").prop("checked",!0),Attendance.Settings.buildHtmlToAddLateNightWork(!0),!1===rdata.isLateNightStrictShiftMargin?layout.find("#ZPAtt_lateNight_Strict_ShiftMargin").prop("checked",!1):layout.find("#ZPAtt_lateNight_Strict_ShiftMargin").prop("checked",!0),trackLateNightWork.forEach(function(ele,index){Attendance.Settings.addLocForLateNight(ele),Attendance.Settings.removeAddLocOptions(layout.find(".RotBox.zpnotfy.grc_rlBx").find("#ZPAtt_lateNightLoc")[index],ele.locId,Attendance.Settings.locList[ele.locId])})):(layout.find("#ZPAtt_lateNightWork").prop("checked",!1),Attendance.Settings.buildHtmlToAddLateNightWork(!0))}},toggleConsOnDutySett:function(){var layout=Layout.Page.container.find("#ZPAtt_generalSettings");layout.find("#ZPAtt_typesOfOnDuty").addClass("DN"),layout.find("#ZPAtt_genSettOnDutyTypes").closest(".form-group").addClass("DN"),layout.find("#ZPAtt_genSettOnDutyAllowedDuration").closest(".form-group").addClass("DN"),layout.find("#ZPAtt_genSettIsODRestrictedForFuture").closest(".form-group").addClass("DN"),layout.find("#ZPAtt_genSettIsODReasonMandatory").closest(".form-group").addClass("DN"),$("input:radio[name=ZPAtt_genSettonDuty]")[0].checked&&(layout.find("#ZPAtt_typesOfOnDuty").removeClass("DN"),layout.find("#ZPAtt_genSettOnDutyTypes").closest(".form-group").removeClass("DN"),layout.find("#ZPAtt_genSettOnDutyAllowedDuration").closest(".form-group").removeClass("DN"),layout.find("#ZPAtt_genSettIsODRestrictedForFuture").closest(".form-group").removeClass("DN"),layout.find("#ZPAtt_genSettIsODReasonMandatory").closest(".form-group").removeClass("DN"),$("input:radio[name=ZPAtt_genSettonDutyType]")[1].checked&&layout.find("#ZPAtt_typesOfOnDuty").addClass("DN"),layout.find("#ZPAtt_genSettOnDutyAllowedDuration").find(".error-msg").addClass("DNI"))},toggleConsOnDutyTypes:function(){if($("input:radio[name=ZPAtt_genSettonDutyType]")[0].checked){var odObj=Attendance.Settings.generalSettings.Att_ondutySetts?Attendance.Settings.generalSettings.Att_ondutySetts:{};Attendance.Settings.consODTypes(odObj),Layout.Page.container.find("#od_table").show(),Layout.Page.container.find("#ZPAtt_typesOfOnDuty").removeClass("DN")}else Layout.Page.container.find("#od_table").hide(),Layout.Page.container.find("#ZPAtt_typesOfOnDuty").addClass("DN")},consRegReasons:function(){var regReasons=[];Attendance.Settings.generalSettings.Att_advaSetts&&Attendance.Settings.generalSettings.Att_advaSetts.regReasons?(regReasons=JSON.parse(Attendance.Settings.generalSettings.Att_advaSetts.regReasons.reasons)).length<1&&(regReasons=[ZPI18N.getString("zp.forgotcheckin"),ZPI18N.getString("zp.forgotcheckout")]):regReasons=[ZPI18N.getString("zp.forgotcheckin"),ZPI18N.getString("zp.forgotcheckout")],Layout.Page.container.find("#reg_reason_body").html(""),$.each(regReasons,function(index,data){data.includes('"')&&(data=data.replace(/\"/g,"&quot;")),Attendance.Settings.addRegReasonRows(data),0===index&&1===regReasons.length&&(Layout.Page.container.find("#reg_reason_body").find(".IC-cls-fill").hide(),Layout.Page.container.find("#reg_reason_body").find(".IC-plus-fill").show())}),Layout.Page.container.find("#reg_reason_table").show(),Layout.Page.container.find("#reg_reason_table").closest(".form-group").removeClass("DN")},toggleConsRegReasons:function(){$("input:radio[name=ZPAtt_enable_reg_reasons]")[0].checked?Attendance.Settings.consRegReasons():(Layout.Page.container.find("#reg_reason_table").hide(),Layout.Page.container.find("#reg_reason_table").closest(".form-group").addClass("DN"))},addRegReasonRows:function(data){var txt='<tr><td><input type="text" class="form-control" placeholder="'+ZPI18N.getString("zp.reason")+'"';data&&(txt+='value="'+data+'"'),txt+="></td>",txt+='<td  width="60">',txt+='<i class="IC-cls-fill S14 gry FL CP" onclick="Attendance.Settings.deleteRegReasonRows(this);"></i>',txt+='<i class="IC-plus-fill S14 gry FL ML5 CP " onclick="Attendance.Settings.addRegReasonRows();"></i></td></tr>',Layout.Page.container.find("#reg_reason_body").find(".IC-cls-fill").show(),Layout.Page.container.find("#reg_reason_body").find(".IC-plus-fill").hide(),Layout.Page.container.find("#reg_reason_body").append(txt);var count=Layout.Page.container.find("#reg_reason_body > tr").length;data||Layout.Page.container.find("#reg_reason_body input").eq(count-1).trigger("focus"),count>=10&&Layout.Page.container.find("#reg_reason_body").find(".IC-plus-fill").hide()},deleteRegReasonRows:function(obj){1!==Layout.Page.container.find("#reg_reason_body > tr").length&&($(obj).parent().parent().remove(),Layout.Page.container.find("#reg_reason_body").find(".IC-plus-fill").last().show(),1===Layout.Page.container.find("#reg_reason_body > tr").length&&Layout.Page.container.find("#reg_reason_body").find(".IC-cls-fill").hide());var count=Layout.Page.container.find("#reg_reason_body > tr").length;Layout.Page.container.find("#reg_reason_body input").eq(count-1).trigger("focus")},consODTypes:function(odObj){Attendance.Settings.odJson={};var odTypeBody=Layout.Page.container.find("#ZPAtt_ODSett_Type");odTypeBody.html("");Object.keys(odObj).length;0==Object.keys(odObj).length&&(odObj.def1="Client visit",odObj.def2="Work from home"),$.each(odObj,function(typeId,name){name.includes('"')&&(name=name.replace(/\"/g,"&quot;")),"def1"!=typeId&&"def2"!=typeId&&(Attendance.Settings.odJson[typeId]=name),Attendance.Settings.addODTypesRows(typeId,name),1===Object.keys(odObj).length&&(odTypeBody.find(".IC-cls-fill").hide(),odTypeBody.find(".IC-plus-fill").show())})},addODTypesRows:function(typeId,name){var txt='<tr><td><input type="text" class="form-control" placeholder="'+ZPI18N.getString("zp.type")+'"',odTypeBody=Layout.Page.container.find("#ZPAtt_ODSett_Type");name?(txt+='id="'+typeId+'"',txt+='value="'+name+'"'):txt+='id="-1"',txt+="></td>",txt+='<td  width="60">',txt+='<i class="IC-cls-fill S14 gry FL CP" onclick="Attendance.Settings.deleteODTypesRows(this);"></i>',txt+='<i class="IC-plus-fill S14 gry FL ML5 CP " onclick="Attendance.Settings.addODTypesRows();"></i></td></tr>',odTypeBody.find(".IC-cls-fill").show(),odTypeBody.find(".IC-plus-fill").hide(),odTypeBody.append(txt);var count=Layout.Page.container.find("#ZPAtt_ODSett_Type > tr").length;name||Layout.Page.container.find("#ZPAtt_ODSett_Type input").eq(count-1).trigger("focus"),count>=10&&odTypeBody.find(".IC-plus-fill").hide()},deleteODTypesRows:function(obj){1!==Layout.Page.container.find("#ZPAtt_ODSett_Type > tr").length&&($(obj).parent().parent().remove(),Layout.Page.container.find("#ZPAtt_ODSett_Type").find(".IC-plus-fill").last().show(),1===Layout.Page.container.find("#ZPAtt_ODSett_Type > tr").length&&Layout.Page.container.find("#ZPAtt_ODSett_Type").find(".IC-cls-fill").hide());var count=Layout.Page.container.find("#ZPAtt_ODSett_Type > tr").length;Layout.Page.container.find("#ZPAtt_ODSett_Type input").eq(count-1).trigger("focus")},getShiftPermSettings:function(){var param={mode:"getShiftPermSettings",conreqcsr:csrfToken};$.post("/ShiftSettingsAction.zp",param,function(rdata){Attendance.Settings.ShiftSettList=rdata.settList;var layout=Layout.Page.container.find("#ZPAtt_generalSettings");Attendance.Settings.constructPermValFromCheckBox(rdata.settList.mappingView_Allowed,"shiftMap",!0),Attendance.Settings.constructPermValFromCheckBox(rdata.settList.mappingEdit_Allowed,"shiftMap",!1),Attendance.Settings.showHidePastShiftEditPerm(layout,rdata.settList.mappingEdit_Allowed),1===rdata.settList.NotifyMail_Allowed?$("input:radio[name=ZPAtt_genSettEditShiftNotifyMail]")[0].checked=!0:$("input:radio[name=ZPAtt_genSettEditShiftNotifyMail]")[1].checked=!0,1===rdata.settList.NotifyFeeds_Allowed?$("input:radio[name=ZPAtt_genSettEditShiftNotifyFeed]")[0].checked=!0:$("input:radio[name=ZPAtt_genSettEditShiftNotifyFeed]")[1].checked=!0,1===rdata.settList.isShiftChangeReasonMandatory?$("#ZPAtt_genSettIsShiftChangeReasonMandatory").prop("checked",!0):$("#ZPAtt_genSettIsShiftChangeReasonMandatory").prop("checked",!1)})},shiftSubViewEditChange:function(obj){var objVal=$(obj).val();$(Attendance.Settings.LayoutId+" #ZPAtt_genSettEditShiftRec option").prop("disabled",!1),"0"===objVal?($(Attendance.Settings.LayoutId+" #ZPAtt_genSettEditShiftRec").select2("val","0"),$(Attendance.Settings.LayoutId+" #ZPAtt_genSettEditShiftRec option:not(:first-child)").attr("disabled","true")):"1"===objVal&&($(Attendance.Settings.LayoutId+" #ZPAtt_genSettEditShiftRec").select2("val","0"),$(Attendance.Settings.LayoutId+" #ZPAtt_genSettEditShiftRec option").eq(2).attr("disabled","true")),Attendance.Settings.tooglePastShiftEditPerm(!0)},tooglePastShiftEditPerm:function(isFromToggle){var layout=Layout.Page.container.find("#ZPAtt_generalSettings");Attendance.Settings.showHidePastShiftEditPerm(layout,Attendance.Settings.getPermValFromCheckBox("shiftMap",!1),isFromToggle)},showHidePastShiftEditPerm:function(layout,editPerm,isFromToggle){"1"===editPerm||1===editPerm?(Attendance.Settings.removeEditPastShift(layout,"User"),Attendance.Settings.setValueEditPastShift(layout,"RepMan","repMan",isFromToggle)):"2"===editPerm||2===editPerm?(Attendance.Settings.setValueEditPastShift(layout,"RepMan","repMan",isFromToggle),Attendance.Settings.setValueEditPastShift(layout,"User","user",isFromToggle)):"3"===editPerm||3===editPerm?(Attendance.Settings.removeEditPastShift(layout,"RepMan"),Attendance.Settings.setValueEditPastShift(layout,"User","user",isFromToggle)):(Attendance.Settings.removeEditPastShift(layout,"RepMan"),Attendance.Settings.removeEditPastShift(layout,"User"))},setValueEditPastShift:function(layout,id,val,isFromToggle){layout.find("#ZPAtt_genSettEditPastShift").removeClass("DN");var ele="#ZPAtt_genSettEditPastShift"+id,valId="Att_"+val+"EditPastShift";layout.find(ele).parent().removeClass("DNI"),layout.find(ele)[0].checked=!1,(Attendance.Settings.generalSettings&&(!Attendance.Settings.generalSettings.Att_advaSetts||void 0===Attendance.Settings.generalSettings.Att_advaSetts[valId]||Attendance.Settings.generalSettings.Att_advaSetts[valId])||isFromToggle)&&(layout.find(ele)[0].checked=!0)},removeEditPastShift:function(layout,id){layout.find("#ZPAtt_genSettEditPastShift").addClass("DN");var ele="#ZPAtt_genSettEditPastShift"+id;layout.find(ele).parent().addClass("DNI"),layout.find(ele)[0].checked=!1},toggleAddNewPopUp:function(show,settingsId,isAdd){show?($(Attendance.Settings.LayoutId+" #ZPAtt_Sett_Reg").is(":visible")||$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_UserShift").is(":visible")||$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_OD").is(":visible")||$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_PermApp").is(":visible")||($(Attendance.Settings.LayoutId+" #ZPAtt_addPopup").modal("show"),$(Attendance.Settings.LayoutId+" #ZPAtt_sNewPopupRecSave").off("click")),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettings").is(":visible")?(Attendance.Settings.CustomizeTemplate.resetGraceTemplateFields(),Attendance.Settings.CustomizeTemplate.resetShiftReminderTemplateFields(),$("#ZPAtt_addPopup").addClass("popAddsttng"),$(Attendance.Settings.LayoutId+" #ZPAtt_popUpHeader_uSettings").html(ZPI18N.getString("zp.addsettings")),$(Attendance.Settings.LayoutId+" input:radio[name=ZPAtt_userSettFor]")[0].checked=!0,$(Attendance.Settings.LayoutId+" #ZPAtt_userSettForShift").next().html(""),$(Attendance.Settings.LayoutId+" #ZPAtt_settingsName").next().html(""),$(Attendance.Settings.LayoutId+" #ZPAtt_settingsName").val(""),$(Attendance.Settings.LayoutId+" #ZPAtt_sNewPopupRecSave").on("click",function(){Attendance.Settings.saveSettings(settingsId)}),$(Attendance.Settings.LayoutId+" #ZPAtt_addPopup, .modal-body").animate({scrollTop:0}),settingsId?(Attendance.Settings.settingsId=settingsId,Attendance.Settings.CustomizeTemplate.getGraceTemplates(Attendance.Settings.userSettings[settingsId]),Attendance.Settings.consSettingsView(Attendance.Settings.userSettings[settingsId]),Attendance.Settings.CustomizeTemplate.getShiftReminderTemplate(Attendance.Settings.userSettings[settingsId]),$(Attendance.Settings.LayoutId+" #ZPAtt_popUpHeader_uSettings").html(ZPI18N.getString("zp.editsettings"))):(Attendance.Settings.settingsId=null,Attendance.Settings.consSettingsView(void 0,isAdd),Attendance.Settings.onSettForChange())):$(Attendance.Settings.LayoutId+" #ZPAtt_userIdMapping").is(":visible")?($(Attendance.Settings.LayoutId+" #ZPAtt_userIdMappingEmpName").next().html(""),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdMappingEmpName").select2("val",[]),$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").val(""),$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").next().html(""),$(Attendance.Settings.LayoutId+" #ZPAtt_sNewPopupRecSave").on("click",function(){Attendance.Settings.Mapper.addMapper()})):$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler").is(":visible")?(Timetracker.schedulerReminderSettings.initializeGlobalVar(),$(Attendance.Settings.LayoutId+" #ZPAtt_sNewPopupRecSave").on("click",function(){Timetracker.schedulerReminderSettings.updateScheduleSettings()}),isAdd?($(Attendance.Settings.LayoutId+" #ZPAtt_popUpHeader_absSchdl").html(ZPI18N.getString("zp.addschedule")),Timetracker.schedulerReminderSettings.showCommonCodeForScheduleAndReminderAddPage(0)):$(Attendance.Settings.LayoutId+" #ZPAtt_popUpHeader_absSchdl").html(ZPI18N.getString("zp.editschedule"))):$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_Reg").is(":visible")?(ApprovalProcess.addNew(Attendance.Reg.formId,"0",Attendance.Reg.getRegConfInfolist,ZPI18N.getString("zp.attendancereg")),Layout.Page.container.find("#approvalListTable").remove()):$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_OD").is(":visible")?(ApprovalProcess.addNew(Attendance.OD.formId,"0",Attendance.OD.getODConfInfolist,ZPI18N.getString("zp.onduty")),Layout.Page.container.find("#approvalListTable").remove()):$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_PermApp").is(":visible")?(ApprovalProcess.addNew(AttPermissions.formId,"0",AttPermissions.getPermAppConfInfolist,ZPI18N.getString("zp.permissions")),Layout.Page.container.find("#approvalListTable").remove()):(ApprovalProcess.addNew(AttendanceShift.formId,"0",AttendanceShift.getuserShiftMapConfInfolist,ZPI18N.getString("zp.attusershiftmapping")),Layout.Page.container.find("#approvalListTable").remove())):$(Attendance.Settings.LayoutId+" #ZPAtt_addPopup").modal("hide"),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettings").is(":visible")&&Layout.Page.container.find(" input:radio[name=ZPAtt_userSettFor]")[0].checked?Layout.Page.container.find(" #ZPAtt_userSettRegDiv").hide():Layout.Page.container.find(" #ZPAtt_userSettRegDiv").show()},onWebCheckChange:function(disable){var settParent=Layout.Page.container.find("#ZPAtt_popUpContent_uSettings");"genSett"===Attendance.Settings.settingsPageId&&(settParent=Layout.Page.container.find("#ZPAtt_generalSettings")),settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"UIEntryLoc").attr("disabled",disable),settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"CaptureImageWeb").attr("disabled",disable),settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"VerifyUserWeb").attr("disabled",disable),disable&&(settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"UIEntryLoc")[0].checked=!disable,settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"CaptureImageWeb")[0].checked=!disable,settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"VerifyUserWeb")[0].checked=!disable)},onMobileCheckChange:function(disable){var settParent=Layout.Page.container.find("#ZPAtt_popUpContent_uSettings");"genSett"===Attendance.Settings.settingsPageId&&(settParent=Layout.Page.container.find("#ZPAtt_generalSettings")),settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"MobileEntryLoc").attr("disabled",disable),settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"CaptureImageMobile").attr("disabled",disable),settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"VerifyUserMobile").attr("disabled",disable),disable&&(settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"MobileEntryLoc")[0].checked=!disable,settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"CaptureImageMobile")[0].checked=!disable,settParent.find("#ZPAtt_"+Attendance.Settings.settingsPageId+"VerifyUserMobile")[0].checked=!disable)},toggleFilter:function(){$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_filter").hasClass("ZPFilsel")?($(Attendance.Settings.LayoutId+" #ZPAtt_Sett_filter").removeClass("blu ZPFilsel"),$(Attendance.Settings.LayoutId+" #ZPAtt_SettFilters").attr("class","ZPFilMain"),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_filterClsButt").hide(),$("#page-wrapper").attr("class","Nbar2")):($(Attendance.Settings.LayoutId+" #ZPAtt_Sett_filter").addClass("blu ZPFilsel"),$(Attendance.Settings.LayoutId+" #ZPAtt_SettFilters").attr("class","ZPFilMain TEbnd"),$(Attendance.Settings.LayoutId+" #ZPAtt_Sett_filterClsButt").show(),$("#page-wrapper").attr("class","Nbar2F"))},onSettForChange:function(obj){if(obj){var isShiftEnabled=$(Attendance.Settings.LayoutId+" input:radio[name=ZPAtt_userSettFor]")[0].checked;Attendance.Settings.resetPickList(isShiftEnabled),Attendance.Settings.setUserShiftPickList(isShiftEnabled),isShiftEnabled?Layout.Page.container.find(" #ZPAtt_userSettRegDiv").hide():Layout.Page.container.find(" #ZPAtt_userSettRegDiv").show()}if(null!==Attendance.Settings.settingsId){var rdata=Attendance.Settings.userSettings[Attendance.Settings.settingsId],enoList=rdata.erecnoList,shiftList=rdata.shiftIdList;0!==shiftList.length&&(!obj||obj&&0===$(obj).parent().index())?($(Attendance.Settings.LayoutId+" input:radio[name=ZPAtt_userSettFor]")[0].checked=!0,Attendance.Settings.resetPickList(!0),obj||Attendance.Settings.setUserShiftPickList(!0),ZPPickList.setSelectedShifts($.extend([],shiftList,!0)),Attendance.Settings.consMaxShiftDiffTime()):0!==enoList.length&&(!obj||obj&&1===$(obj).parent().index())?($(Attendance.Settings.LayoutId+" input:radio[name=ZPAtt_userSettFor]")[1].checked=!0,Attendance.Settings.resetPickList(),obj||Attendance.Settings.setUserShiftPickList(),ZPPickList.setSelectedUsers($.extend([],enoList,!0))):obj||(Attendance.Settings.resetPickList(!0),Attendance.Settings.setUserShiftPickList(!0))}obj||null!==Attendance.Settings.settingsId||(Attendance.Settings.resetPickList(!0),Attendance.Settings.setUserShiftPickList(!0)),$(Attendance.Settings.LayoutId+" #zp_shared_list_Shifts #zp_shared_sub_list_records").off("DOMSubtreeModified").on("DOMSubtreeModified",function(){setTimeout(function(){Attendance.Settings.consMaxShiftDiffTime(),Attendance.Settings.onRadioValChange($("input:radio[name=ZPAtt_"+Attendance.Settings.settingsPageId+"AttMarkHours]")[0])},300)})},resetPickList:function(isShiftShow){isShiftShow?($(Attendance.Settings.LayoutId+" #ZPAtt_userSettForEmployee").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettForShift").show()):($(Attendance.Settings.LayoutId+" #ZPAtt_userSettForEmployee").show(),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettForShift").hide())},onShowBalChange:function(obj){var objVal=$(obj).val();$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"BalOtEdit option").prop("disabled",!1),"0"===objVal?($(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"BalOtEdit").select2("val","0"),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"BalOtEdit option").eq(1).attr("disabled","true"),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"BalOtEdit option").eq(2).attr("disabled","true")):"1"===objVal&&($(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"BalOtEdit").select2("val","0"),$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"BalOtEdit option").eq(2).attr("disabled","true"))},resetInputs:function(){$(Attendance.Settings.LayoutId+" #ZPAtt_userSett_type").select2("val",0)},setUserShiftPickList:function(isShift,isDefPre){if(isShift){var shiftKey=[];shiftKey.push(ZPPickList.CONSTANTS.SHIFTS),Layout.Page.container.find("#ZPAtt_userSettShiftPickList").html(ZPPickList.initSingleComponent(shiftKey))}else{var key=[];key.push(ZPPickList.CONSTANTS.USERS);var users=Attendance.Settings.getUsersForApp();isDefPre?(ZPPickList.loginUserNeed=!0,Layout.Page.container.find("#ZPAtt_defPreEmployeePickList").html(ZPPickList.init(key,null,!0))):Layout.Page.container.find("#ZPAtt_userSettEmployeePickList").html(ZPPickList.initSingleComponentUser(key,!1,users))}},getUsersForApp:function(){var userList=ZPForm.getPrimaryLookupValues(3),users=[];return null===userList&&void 0===userList||$.each(userList,function(index,data){var user={};data.Value?(user.name=data.Value,user.usererec=data.Id):(user.name=data.EMPNAME+", "+data.EMPID,user.usererec=data.ERECNO),users.push(user)}),users},typeShowErrMsg:function(msg){$(Attendance.Settings.LayoutId+" #ZPAtt_settingsName").next().html(""),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettForShift").next().html(msg),$(Attendance.Settings.LayoutId+" #ZPAtt_addPopup, .modal-body").animate({scrollTop:0})},isValidEmail:function(value){return/^\w+((-\w+)|(\.\w+)|(\+\w+)|(\'\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test($.trim(value))},saveSettings:function(settingsId){var rdata=Attendance.Settings.generalSettings,layout=Layout.Page.container,pageId=Attendance.Settings.settingsPageId,calApplySettings=!1,param={mode:"setAttConfInfo",conreqcsr:csrfToken};if(layout.find("#ZPAtt_userSettings").is(":visible")){if(settingsId?(rdata=Attendance.Settings.userSettings[settingsId],param.settingsId=settingsId):calApplySettings=!0,layout.find("input:radio[name=ZPAtt_userSettFor]")[0].checked){var shiftIdList=ZPPickList.sharedSelectedShifts;if(0!==shiftIdList.length){var sList,idLis=shiftIdList.toString();rdata.shiftIdList&&idLis===(sList=rdata.shiftIdList).toString()||(calApplySettings=!0);var mappedShiftCount=0;if(Attendance.Settings.USettings.settMappedShiftList.filter(function(sId){-1===shiftIdList.indexOf(sId)||sList&&-1!==sList.indexOf(sId)||mappedShiftCount++}),0!==mappedShiftCount)return void Attendance.Settings.typeShowErrMsg(ZPI18N.getString("zp.shiftalreadymappedsett",new Array(mappedShiftCount+"")));param.shiftList=idLis}}else{var empList=ZPPickList.sharedSelectedUsers;if(0!==empList.length){var eList,enoLis=empList.toString();rdata.erecnoList&&enoLis===(eList=rdata.erecnoList).toString()||(calApplySettings=!0);var mappedEnoCount=0;if(Attendance.Settings.USettings.settMappedEnoList.filter(function(eno){-1===empList.indexOf(eno)||eList&&-1!==eList.indexOf(eno)||mappedEnoCount++}),0!==mappedEnoCount)return void Attendance.Settings.typeShowErrMsg(ZPI18N.getString("zp.useralreadymappedsett",new Array(mappedEnoCount+"")));param.erecnoList=enoLis}if(layout.find(".attRegErr").is(":visible"))return;var Att_Reg_restrictedAfter=parseInt(layout.find("#ZPAtt_"+pageId+"DaysAfterForReg").val());(has_Att_Reg_restrictedAfter=rdata.hasOwnProperty("Att_Reg_restrictedAfter"))&&isNaN(Att_Reg_restrictedAfter)?param.Att_Reg_restrictedAfter=-1:(!has_Att_Reg_restrictedAfter&&!isNaN(Att_Reg_restrictedAfter)||has_Att_Reg_restrictedAfter&&rdata.Att_Reg_restrictedAfter!==Att_Reg_restrictedAfter)&&(param.Att_Reg_restrictedAfter=Att_Reg_restrictedAfter);var Att_Reg_allowedTimes=parseInt(layout.find("#ZPAtt_"+pageId+"NumberOfRegRequests").val());(has_Att_Reg_allowedTimes=rdata.hasOwnProperty("Att_Reg_allowedTimes"))&&isNaN(Att_Reg_allowedTimes)?param.Att_Reg_allowedTimes=-1:isNaN(Att_Reg_allowedTimes)||has_Att_Reg_allowedTimes&&(!has_Att_Reg_allowedTimes||rdata.Att_Reg_allowedTimes===Att_Reg_allowedTimes)||(param.Att_Reg_allowedTimes=Att_Reg_allowedTimes);var Att_Reg_allowedInPeriod=layout.find("#ZPAtt_"+pageId+"RegDateRange").val();isNaN(Att_Reg_allowedTimes)||rdata.Att_Reg_allowedInPeriod==Att_Reg_allowedInPeriod||(param.Att_Reg_allowedInPeriod=Att_Reg_allowedInPeriod);var Att_Reg_allowedForFuture=layout.find("input:radio[name=ZPAtt_"+pageId+"RegAllowedForFuture]")[0].checked;rdata.hasOwnProperty("Att_Reg_allowedForFuture")&&rdata.Att_Reg_allowedForFuture!==Att_Reg_allowedForFuture&&(param.Att_Reg_allowedForFuture=Att_Reg_allowedForFuture)}var settingsName=layout.find("#ZPAtt_settingsName").val().trim();if(""===settingsName)return layout.find("#ZPAtt_settingsName").next().html(ZPI18N.getString("zp.entersettingsname")),layout.find("#ZPAtt_userSettForShift").next().html(""),void $(Attendance.Settings.LayoutId+" #ZPAtt_addPopup, .modal-body").animate({scrollTop:0});if(param.settingsName=settingsName,!param.erecnoList&&!param.shiftList)return void Attendance.Settings.typeShowErrMsg(ZPI18N.getString("zp.userandshift"));if(layout.find("input:checkbox[id=gracetoggle]").prop("checked")){var sendGraceMail=layout.find("input:checkbox[id=graceMailToggle]").prop("checked")?1:0;rdata.sendGraceMail!=sendGraceMail&&(param.sendGraceMail=sendGraceMail),rdata.leaveTemplateID!=Attendance.Settings.leaveTemplateID&&(param.leaveTemplateID=Attendance.Settings.leaveTemplateID),rdata.absentTemplateID!=Attendance.Settings.absentTemplateID&&(param.absentTemplateID=Attendance.Settings.absentTemplateID),rdata.leaveRevertTemplateID!=Attendance.Settings.leaveRevertTemplateID&&(param.leaveRevertTemplateID=Attendance.Settings.leaveRevertTemplateID),rdata.absentRevertTemplateID!=Attendance.Settings.absentRevertTemplateID&&(param.absentRevertTemplateID=Attendance.Settings.absentRevertTemplateID)}else 0!=rdata.sendGraceMail&&(param.sendGraceMail=0)}else{var validFrom=layout.find("#ZPAtt_effectiveFromDate").val().trim();""!==validFrom&&validFrom!==rdata.Att_validRecordFrom&&(param.validDate=validFrom);var shiftTiming=layout.find("#ZPAtt_genSettShift").select2("val");if(shiftTiming!==Attendance.Settings.generalShiftId&&(param.selShiftId=shiftTiming),0!==rdata.Att_ShowScaleView||$("input:radio[name=ZPAtt_genSettScaleView]")[0].checked?1===rdata.Att_ShowScaleView&&$("input:radio[name=ZPAtt_genSettScaleView]")[0].checked&&(param.showScaleView="0"):param.showScaleView="1",0===rdata.Att_isPwdProtect&&$("input:radio[name=ZPAtt_genSettPwdProtect]")[0].checked?param.isPwdProtect="1":1!==rdata.Att_isPwdProtect||$("input:radio[name=ZPAtt_genSettPwdProtect]")[0].checked||(param.isPwdProtect="0"),layout.find(".attRegErr").is(":visible"))return;var has_Att_Reg_restrictedAfter;Att_Reg_restrictedAfter=parseInt(layout.find("#ZPAtt_"+pageId+"DaysAfterForReg").val());(has_Att_Reg_restrictedAfter=rdata.hasOwnProperty("Att_Reg_restrictedAfter"))&&isNaN(Att_Reg_restrictedAfter)?param.Att_Reg_restrictedAfter=-1:(!has_Att_Reg_restrictedAfter&&!isNaN(Att_Reg_restrictedAfter)||has_Att_Reg_restrictedAfter&&rdata.Att_Reg_restrictedAfter!==Att_Reg_restrictedAfter)&&(param.Att_Reg_restrictedAfter=Att_Reg_restrictedAfter);var has_Att_Reg_allowedTimes;Att_Reg_allowedTimes=parseInt(layout.find("#ZPAtt_"+pageId+"NumberOfRegRequests").val());(has_Att_Reg_allowedTimes=rdata.hasOwnProperty("Att_Reg_allowedTimes"))&&isNaN(Att_Reg_allowedTimes)?param.Att_Reg_allowedTimes=-1:isNaN(Att_Reg_allowedTimes)||0===Att_Reg_allowedTimes||has_Att_Reg_allowedTimes&&(!has_Att_Reg_allowedTimes||rdata.Att_Reg_allowedTimes===Att_Reg_allowedTimes)||(param.Att_Reg_allowedTimes=Att_Reg_allowedTimes);Att_Reg_allowedInPeriod=layout.find("#ZPAtt_"+pageId+"RegDateRange").val();isNaN(Att_Reg_allowedTimes)||rdata.Att_Reg_allowedInPeriod==Att_Reg_allowedInPeriod||(param.Att_Reg_allowedInPeriod=Att_Reg_allowedInPeriod);Att_Reg_allowedForFuture=layout.find("input:radio[name=ZPAtt_"+pageId+"RegAllowedForFuture]")[0].checked;if(rdata.hasOwnProperty("Att_Reg_allowedForFuture")&&rdata.Att_Reg_allowedForFuture!==Att_Reg_allowedForFuture&&(param.Att_Reg_allowedForFuture=Att_Reg_allowedForFuture),0!==rdata.onDutyEnabled||$("input:radio[name=ZPAtt_"+pageId+"onDuty]")[1].checked?1===rdata.onDutyEnabled&&$("input:radio[name=ZPAtt_"+pageId+"onDuty]")[1].checked&&(param.onDutyEnabled=0):(param.onDutyEnabled=1,Attendance.OD.getODConfInfolist()),void 0===param.onDutyEnabled?1===rdata.onDutyEnabled:1===param.onDutyEnabled){0===rdata.onDutyFullDayEnabled&&$("#ZPAtt_"+pageId+"OnDutyFullDay")[0].checked?param.onDutyFullDayEnabled=1:1!==rdata.onDutyFullDayEnabled||$("#ZPAtt_"+pageId+"OnDutyFullDay")[0].checked||(param.onDutyFullDayEnabled=0),0===rdata.onDutyHalfDayEnabled&&$("#ZPAtt_"+pageId+"OnDutyHalfDay")[0].checked?param.onDutyHalfDayEnabled=1:1!==rdata.onDutyHalfDayEnabled||$("#ZPAtt_"+pageId+"OnDutyHalfDay")[0].checked||(param.onDutyHalfDayEnabled=0),0===rdata.onDutyQuatDayEnabled&&$("#ZPAtt_"+pageId+"OnDutyQuatDay")[0].checked?param.onDutyQuatDayEnabled=1:1!==rdata.onDutyQuatDayEnabled||$("#ZPAtt_"+pageId+"OnDutyQuatDay")[0].checked||(param.onDutyQuatDayEnabled=0),0===rdata.onDutyHoursEnabled&&$("#ZPAtt_"+pageId+"OnDutyHours")[0].checked?param.onDutyHoursEnabled=1:1!==rdata.onDutyHoursEnabled||$("#ZPAtt_"+pageId+"OnDutyHours")[0].checked||(param.onDutyHoursEnabled=0),0===rdata.isOnDutyReasonMandatory&&$("#ZPAtt_"+pageId+"IsODReasonMandatory")[0].checked?param.isOnDutyReasonMandatory=1:1!==rdata.isOnDutyReasonMandatory||$("#ZPAtt_"+pageId+"IsODReasonMandatory")[0].checked||(param.isOnDutyReasonMandatory=0),0===rdata.restrictOnDutyForFuture&&$("#ZPAtt_"+pageId+"IsODRestrictedForFuture")[0].checked?param.restrictOnDutyForFuture=1:1!==rdata.restrictOnDutyForFuture||$("#ZPAtt_"+pageId+"IsODRestrictedForFuture")[0].checked||(param.restrictOnDutyForFuture=0),Layout.Page.container.find("#ZPAtt_genSettOnDutyAllowedDuration").find(".error-msg").addClass("DNI");var odFullEnabled=void 0===param.onDutyFullDayEnabled?1===rdata.onDutyFullDayEnabled:1===param.onDutyFullDayEnabled,odHalfEnabled=void 0===param.onDutyHalfDayEnabled?1===rdata.onDutyHalfDayEnabled:1===param.onDutyHalfDayEnabled,odQuatEnabled=void 0===param.onDutyQuatDayEnabled?1===rdata.onDutyQuatDayEnabled:1===param.onDutyQuatDayEnabled,odHoursEnabled=void 0===param.onDutyHoursEnabled?1===rdata.onDutyHoursEnabled:1===param.onDutyHoursEnabled;if(!(odFullEnabled||odHalfEnabled||odQuatEnabled||odHoursEnabled))return Layout.Page.container.find("#ZPAtt_genSettOnDutyAllowedDuration").find(".error-msg").removeClass("DNI"),void layout.find("#ZPAtt_generalSettings").animate({scrollTop:2500})}}var shiftReminderTemplateIDs={};if(Attendance.Settings.CustomizeTemplate.templateIdJSON){for(var templateType in Attendance.Settings.CustomizeTemplate.templateIdJSON)shiftReminderTemplateIDs[Attendance.Settings.CustomizeTemplate.templateTypeName[templateType]]=Attendance.Settings.CustomizeTemplate.templateIdJSON[templateType];param.shiftReminderTemplateIDs=JSON.stringify(shiftReminderTemplateIDs)}if(0!==rdata.Att_Intervels||$("input:radio[name=ZPAtt_"+pageId+"Interval]")[1].checked?1===rdata.Att_Intervels&&$("input:radio[name=ZPAtt_"+pageId+"Interval]")[1].checked&&(param.selIntervels="0",calApplySettings=!0):(param.selIntervels="1",calApplySettings=!0),layout.find("#ZPAtt_"+pageId+"BreakTime").is(":visible")){var breakTimeVal=layout.find("#ZPAtt_"+pageId+"BreakTime").val().trim();if(""!==breakTimeVal){var breakTime=parseInt(breakTimeVal.split(":")[0]);breakTime=60*breakTime+parseInt(breakTimeVal.split(":")[1]),rdata.Att_BreakTime!==breakTime&&(param.breakTiming=breakTime,calApplySettings=!0)}}0===rdata.Att_useShiftHrs&&$("input:radio[name=ZPAtt_"+pageId+"AttMarkHours]")[1].checked?(param.useShiftHrs="1",calApplySettings=!0):1===rdata.Att_useShiftHrs&&$("input:radio[name=ZPAtt_"+pageId+"AttMarkHours]")[0].checked&&(param.useShiftHrs="0",calApplySettings=!0),0!==rdata.Att_minHrsEnabled||$("input:radio[name=ZPAtt_"+pageId+"AttMarking]")[0].checked?1===rdata.Att_minHrsEnabled&&$("input:radio[name=ZPAtt_"+pageId+"AttMarking]")[0].checked&&(param.minimumHours="0",calApplySettings=!0):(param.minimumHours="1",calApplySettings=!0);var minFullDayVal=layout.find("#ZPAtt_"+pageId+"SModeFDay").val().trim();if(""!==minFullDayVal){var minFullDay=parseInt(minFullDayVal.split(":")[0]);minFullDay=60*minFullDay+parseInt(minFullDayVal.split(":")[1]),rdata.Att_fullday!==minFullDay&&(param.fullPresent=minFullDay,calApplySettings=!0)}var minHalfDayVal=layout.find("#ZPAtt_"+pageId+"SModeHDay").val().trim();if(""!==minHalfDayVal){var minHalfDay=parseInt(minHalfDayVal.split(":")[0]);minHalfDay=60*minHalfDay+parseInt(minHalfDayVal.split(":")[1]),rdata.Att_halfday!==minHalfDay&&(param.halfPresent=minHalfDay,calApplySettings=!0)}var expWorkingHoursVal=layout.find("#ZPAtt_"+pageId+"LModePDay").val().trim();if(""!==expWorkingHoursVal){var expWorkingHours=parseInt(expWorkingHoursVal.split(":")[0]);expWorkingHours=60*expWorkingHours+parseInt(expWorkingHoursVal.split(":")[1]),rdata.Att_ExpectedWorkingHrs!==expWorkingHours&&(param.expectedWorkingHours=expWorkingHours,calApplySettings=!0)}0!==rdata.Att_showOTDT||layout.find("#ZPAtt_"+pageId+"ShowOverDevTime")[0].checked?1===rdata.Att_showOTDT&&layout.find("#ZPAtt_"+pageId+"ShowOverDevTime")[0].checked&&(param.showOverDevTime="0"):param.showOverDevTime="1",0!==rdata.Att_maxHrsEnabled||$("input:radio[name=ZPAtt_"+pageId+"MaxHours]")[0].checked?1===rdata.Att_maxHrsEnabled&&$("input:radio[name=ZPAtt_"+pageId+"MaxHours]")[0].checked&&(param.maximumHours="0",calApplySettings=!0):(param.maximumHours="1",calApplySettings=!0);var maxFullDayVal=layout.find("#ZPAtt_"+pageId+"MaxFDay").val().trim();if(""!==maxFullDayVal){var maxFullDay=parseInt(maxFullDayVal.split(":")[0]);maxFullDay=60*maxFullDay+parseInt(maxFullDayVal.split(":")[1]),rdata.Att_maxHoursFullday!==maxFullDay&&(param.maximumHoursFullday=maxFullDay,calApplySettings=!0)}var maxHalfDayVal=layout.find("#ZPAtt_"+pageId+"MaxHDay").val().trim();if(""!==maxHalfDayVal){var maxHalfDay=parseInt(maxHalfDayVal.split(":")[0]);maxHalfDay=60*maxHalfDay+parseInt(maxHalfDayVal.split(":")[1]),rdata.Att_maxHoursHalfday!==maxHalfDay&&(param.maximumHoursHalfDay=maxHalfDay,calApplySettings=!0)}var settParent=layout.find("#ZPAtt_popUpContent_uSettings");"genSett"===pageId&&(settParent=layout.find("#ZPAtt_generalSettings")),0!==rdata.Att_AllowUIEntry||$("input:radio[name=ZPAtt_"+pageId+"UIEntry]")[0].checked?1===rdata.Att_AllowUIEntry&&$("input:radio[name=ZPAtt_"+pageId+"UIEntry]")[0].checked&&(param.webCheckIn="0"):param.webCheckIn="1",0!==rdata.Att_AllowMobileEntry||$("input:radio[name=ZPAtt_"+pageId+"MobileEntry]")[1].checked?1===rdata.Att_AllowMobileEntry&&$("input:radio[name=ZPAtt_"+pageId+"MobileEntry]")[1].checked&&(param.mobileCheckIn="0"):param.mobileCheckIn="1",0===rdata.Att_CapturePhotoInMobile&&$("#ZPAtt_"+pageId+"CaptureImageMobile")[0].checked?param.captureImageMobile="1":1!==rdata.Att_CapturePhotoInMobile||$("#ZPAtt_"+pageId+"CaptureImageMobile")[0].checked||(param.captureImageMobile="0"),0===rdata.Att_VerifyUserPhotoInMobile&&$("#ZPAtt_"+pageId+"VerifyUserMobile")[0].checked?param.verifyUserMobile="1":1!==rdata.Att_VerifyUserPhotoInMobile||$("#ZPAtt_"+pageId+"VerifyUserMobile")[0].checked||(param.verifyUserMobile="0"),0===rdata.Att_CapturePhotoInWeb&&$("#ZPAtt_"+pageId+"CaptureImageWeb")[0].checked?param.captureImageWeb="1":1!==rdata.Att_CapturePhotoInWeb||$("#ZPAtt_"+pageId+"CaptureImageWeb")[0].checked||(param.captureImageWeb="0"),0===rdata.Att_VerifyUserPhotoInWeb&&$("#ZPAtt_"+pageId+"VerifyUserWeb")[0].checked?param.verifyUserWeb="1":1!==rdata.Att_VerifyUserPhotoInWeb||$("#ZPAtt_"+pageId+"VerifyUserWeb")[0].checked||(param.verifyUserWeb="0"),0!==rdata.Att_showAllEntries||$("input:radio[name=ZPAtt_"+pageId+"ShowAllEntry]")[0].checked?1===rdata.Att_showAllEntries&&$("input:radio[name=ZPAtt_"+pageId+"ShowAllEntry]")[0].checked&&(param.showAllEntries="0"):param.showAllEntries="1",0!==rdata.Att_ReportManView||$("input:radio[name=ZPAtt_"+pageId+"ReportManView]")[0].checked?1===rdata.Att_ReportManView&&$("input:radio[name=ZPAtt_"+pageId+"ReportManView]")[0].checked&&(param.reportManView="0"):param.reportManView="1",0!==rdata.Att_ReportManEdit||$("input:radio[name=ZPAtt_"+pageId+"ReportManEdit]")[0].checked?1===rdata.Att_ReportManEdit&&$("input:radio[name=ZPAtt_"+pageId+"ReportManEdit]")[0].checked&&(param.reportManEdit="0"):param.reportManEdit="1",0!==rdata.Att_ReportManNotify||layout.find("#ZPAtt_"+pageId+"SubEditNotifyCheck")[0].checked?1===rdata.Att_ReportManNotify&&layout.find("#ZPAtt_"+pageId+"SubEditNotifyCheck")[0].checked&&(param.reportManNotify="0"):param.reportManNotify="1";var subEditNotifyEmail=layout.find("#ZPAtt_"+pageId+"SubEditNotifyEmail"),reportmanNotifyMailId=subEditNotifyEmail.val().trim();if(subEditNotifyEmail.removeClass("error-clr"),reportmanNotifyMailId!==decodeHTML(rdata.Att_ReportManNotifyMailID)&&""!==reportmanNotifyMailId&&layout.find("#ZPAtt_"+pageId+"SubEditNotifyCheck")[0].checked){if(!Attendance.Settings.isValidEmail(reportmanNotifyMailId))return void subEditNotifyEmail.addClass("error-clr");param.reportManNotifyMailID=reportmanNotifyMailId}0!==rdata.Att_UserEdit||$("input:radio[name=ZPAtt_"+pageId+"UserEdit]")[0].checked?1===rdata.Att_UserEdit&&$("input:radio[name=ZPAtt_"+pageId+"UserEdit]")[0].checked&&(param.userEdit="0"):param.userEdit="1",0!==rdata.Att_UserEditNotify||layout.find("#ZPAtt_"+pageId+"OwnEditNotifyCheck")[0].checked?1===rdata.Att_UserEditNotify&&layout.find("#ZPAtt_"+pageId+"OwnEditNotifyCheck")[0].checked&&(param.userEditNotify="0"):param.userEditNotify="1";var userEditNotifyMail=layout.find("#ZPAtt_"+pageId+"OwnEditNotifyEmail"),userEditNotifyMailId=userEditNotifyMail.val().trim();if(userEditNotifyMail.removeClass("error-clr"),userEditNotifyMailId!==decodeHTML(rdata.Att_UserEditNotifyMailID)&&""!==userEditNotifyMailId&&layout.find("#ZPAtt_"+pageId+"OwnEditNotifyCheck")[0].checked){if(!Attendance.Settings.isValidEmail(userEditNotifyMailId))return void userEditNotifyMail.addClass("error-clr");param.userEditNotifyMailID=userEditNotifyMailId}0!==rdata.Att_UserEditNotifyTOReportMan||layout.find("#ZPAtt_"+pageId+"OwnEditNotifyMan")[0].checked?1===rdata.Att_UserEditNotifyTOReportMan&&layout.find("#ZPAtt_"+pageId+"OwnEditNotifyMan")[0].checked&&(param.userEditNotifyTOReportMan="0"):param.userEditNotifyTOReportMan="1",rdata.Att_ShowReport+""!==Attendance.Settings.getPermValFromCheckBox("showReport")&&(param.showReport=Attendance.Settings.getPermValFromCheckBox("showReport"));Layout.Page.urlmode.indexOf("attendance_settings_general"),Layout.Page.urlmode.indexOf("attendance_settings_general");rdata.Att_showBalOt+""!==Attendance.Settings.getPermValFromCheckBox("BalanceOT",!0)&&(param.showBalanceOT=Attendance.Settings.getPermValFromCheckBox("BalanceOT",!0)),rdata.Att_editBalOt+""!==Attendance.Settings.getPermValFromCheckBox("BalanceOT",!1)&&(param.editBalanceOT=Attendance.Settings.getPermValFromCheckBox("BalanceOT",!1));var checkInNotifyBefore=layout.find("#ZPAtt_"+pageId+"checkInNotifyBefore").val().trim(),notifyMins="";""!==checkInNotifyBefore&&(notifyMins=60*(notifyMins=parseInt(checkInNotifyBefore.split(":")[0]))+parseInt(checkInNotifyBefore.split(":")[1])),rdata.Att_checkInNotifyBefore===notifyMins||""===notifyMins&&!rdata.hasOwnProperty("Att_checkInNotifyBefore")||(param.checkInNotifyBefore=notifyMins);var checkInNotifyAfter=layout.find("#ZPAtt_"+pageId+"checkInNotifyAfter").val().trim();notifyMins="",""!==checkInNotifyAfter&&(notifyMins=60*(notifyMins=parseInt(checkInNotifyAfter.split(":")[0]))+parseInt(checkInNotifyAfter.split(":")[1])),rdata.Att_checkInNotifyAfter===notifyMins||""===notifyMins&&!rdata.hasOwnProperty("Att_checkInNotifyAfter")||(param.checkInNotifyAfter=notifyMins);var checkOutNotifyBefore=layout.find("#ZPAtt_"+pageId+"checkOutNotifyBefore").val().trim();notifyMins="",""!==checkOutNotifyBefore&&(notifyMins=60*(notifyMins=parseInt(checkOutNotifyBefore.split(":")[0]))+parseInt(checkOutNotifyBefore.split(":")[1])),rdata.Att_checkOutNotifyBefore===notifyMins||""===notifyMins&&!rdata.hasOwnProperty("Att_checkOutNotifyBefore")||(param.checkOutNotifyBefore=notifyMins);var checkOutNotifyAfter=layout.find("#ZPAtt_"+pageId+"checkOutNotifyAfter").val().trim();notifyMins="",""!==checkOutNotifyAfter&&(notifyMins=60*(notifyMins=parseInt(checkOutNotifyAfter.split(":")[0]))+parseInt(checkOutNotifyAfter.split(":")[1])),rdata.Att_checkOutNotifyAfter===notifyMins||""===notifyMins&&!rdata.hasOwnProperty("Att_checkOutNotifyAfter")||(param.checkOutNotifyAfter=notifyMins);var inMissReportNotifyAfter=layout.find("#ZPAtt_"+pageId+"InMissReportNotifyAfter").val().trim();notifyMins="",""!==inMissReportNotifyAfter&&(notifyMins=60*(notifyMins=parseInt(inMissReportNotifyAfter.split(":")[0]))+parseInt(inMissReportNotifyAfter.split(":")[1])),rdata.Att_MissInNotifyAfter===notifyMins||""===notifyMins&&!rdata.hasOwnProperty("Att_MissInNotifyAfter")||(param.inMissReportNotifyAfter=notifyMins);var advaSetts={};advaSetts.Att_TrackLocation=layout.find("input:radio[name=ZPAtt_"+pageId+"TrackLocation]")[0].checked,advaSetts.Att_RestrictiOSAutoEntry=layout.find("#ZPAtt_"+pageId+"AutoEntry").prop("checked"),"genSett"===pageId&&(advaSetts.Att_repManEditPastShift=!1,layout.find("#ZPAtt_genSettEditPastShiftRepMan")[0].checked&&(advaSetts.Att_repManEditPastShift=!0),advaSetts.Att_userEditPastShift=!1,layout.find("#ZPAtt_genSettEditPastShiftUser")[0].checked&&(advaSetts.Att_userEditPastShift=!0));var webLocMandatory=!rdata.Att_advaSetts||void 0===rdata.Att_advaSetts.Att_AllowUIEntryLoc||rdata.Att_advaSetts.Att_AllowUIEntryLoc;"1"===param.webCheckIn||webLocMandatory&&!settParent.find("#ZPAtt_"+pageId+"UIEntryLoc")[0].checked?advaSetts.Att_AllowUIEntryLoc=!1:!webLocMandatory&&settParent.find("#ZPAtt_"+pageId+"UIEntryLoc")[0].checked&&(advaSetts.Att_AllowUIEntryLoc=!0);var mobLocMandatory=!rdata.Att_advaSetts||void 0===rdata.Att_advaSetts.Att_AllowMobileEntryLoc||rdata.Att_advaSetts.Att_AllowMobileEntryLoc;if("0"===param.mobileCheckIn||mobLocMandatory&&!settParent.find("#ZPAtt_"+pageId+"MobileEntryLoc")[0].checked?advaSetts.Att_AllowMobileEntryLoc=!1:!mobLocMandatory&&settParent.find("#ZPAtt_"+pageId+"MobileEntryLoc")[0].checked&&(advaSetts.Att_AllowMobileEntryLoc=!0),void 0!==advaSetts.Att_TrackLocation||void 0===advaSetts.Att_AllowMobileEntryLoc&&void 0===advaSetts.Att_AllowUIEntryLoc||(advaSetts.Att_TrackLocation=trackAllowed),void 0!==advaSetts.Att_AllowUIEntryLoc||void 0===advaSetts.Att_TrackLocation&&void 0===advaSetts.Att_AllowMobileEntryLoc||(advaSetts.Att_AllowUIEntryLoc=webLocMandatory),void 0!==advaSetts.Att_AllowMobileEntryLoc||void 0===advaSetts.Att_TrackLocation&&void 0===advaSetts.Att_AllowUIEntryLoc||(advaSetts.Att_AllowMobileEntryLoc=mobLocMandatory),layout.find("#ZPAtt_userSettings").is(":visible")){if(layout.find("input:checkbox[id=gracetoggle]").prop("checked")){var enabled=!0;if(!(rdata.Att_advaSetts&&rdata.Att_advaSetts.Att_GracePeriod?Attendance.Settings.gracePeriod.consGracePerSettParam(rdata.Att_advaSetts.Att_GracePeriod,advaSetts,enabled):Attendance.Settings.gracePeriod.consGracePerSettParam(null,advaSetts,enabled)))return}rdata.Att_advaSetts&&((void 0!=advaSetts.Att_TrackLocation||void 0!=advaSetts.Att_AllowMobileEntryLoc||void 0!=advaSetts.Att_AllowUIEntryLoc)&&enabled&&void 0==advaSetts.Att_GracePeriod&&rdata.Att_advaSetts.Att_GracePeriod?advaSetts.Att_GracePeriod=rdata.Att_advaSetts.Att_GracePeriod:(rdata.Att_advaSetts.Att_GracePeriod&&!enabled||enabled&&void 0!=advaSetts.Att_GracePeriod)&&(void 0==advaSetts.Att_TrackLocation&&(advaSetts.Att_TrackLocation=trackAllowed),void 0==advaSetts.Att_AllowUIEntryLoc&&(advaSetts.Att_AllowUIEntryLoc=webLocMandatory),void 0==advaSetts.Att_AllowMobileEntryLoc&&(advaSetts.Att_AllowMobileEntryLoc=mobLocMandatory)))}else{var isCarryOverOTCurr=layout.find("input:radio[name=ZPAtt_genSettCarryOverOT]")[0].checked;advaSetts.Att_isCarryOverOT=isCarryOverOTCurr;var regReasons=[],regReasonObj={},regReasonsLenError=!1,reasonEnabled=!1;$("input:radio[name=ZPAtt_enable_reg_reasons]")[0].checked&&layout.find("#reg_reason_body > tr").each(function(index){var reason=$(layout.find("#reg_reason_body > tr")[index]).find(".form-control").val();""!==(reason=reason.trim())&&(regReasons.push(reason),reasonEnabled=!0,reason.length>200&&(regReasonsLenError=!0,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.regreasonlen"))))}),regReasonObj.reasons=regReasons,regReasonObj.enabled=reasonEnabled;var raiseMultiReg=$("input:radio[name=ZPAtt_enable_multirecperday]")[0].checked;if(advaSetts.regReasons=regReasonObj,raiseMultiReg&&(advaSetts.raiseMultiReg=raiseMultiReg),((rdata.Att_advaSetts&&rdata.Att_advaSetts.regReasons&&rdata.Att_advaSetts.regReasons.reasons)!==JSON.stringify(regReasonObj.reasons)||void 0!==advaSetts.Att_TrackLocation||void 0!=advaSetts.Att_AllowMobileEntryLoc||void 0!=advaSetts.Att_AllowUIEntryLoc||rdata.Att_advaSetts&&rdata.Att_advaSetts.raiseMultiReg!=raiseMultiReg)&&(advaSetts.regReasons=regReasonObj,void 0===advaSetts.Att_TrackLocation&&(advaSetts.Att_TrackLocation=trackAllowed),void 0==advaSetts.Att_AllowUIEntryLoc&&(advaSetts.Att_AllowUIEntryLoc=webLocMandatory),void 0==advaSetts.Att_AllowMobileEntryLoc&&(advaSetts.Att_AllowMobileEntryLoc=mobLocMandatory),raiseMultiReg&&(advaSetts.raiseMultiReg=raiseMultiReg),regReasonsLenError||(ZPeople.Module.MODULE_DATA.attendance.isRegReasonsEnabled=reasonEnabled,ZPeople.Module.MODULE_DATA.attendance.regReasons=regReasons)),ZPeople.Module.MODULE_DATA.attendance.isStatWkndConfig&&(advaSetts.Att_incStatWknd=!1,advaSetts.Att_incNonStatWknd=!1,$("input:radio[name=ZPAtt_genSettIncStatWknd]")[0].checked&&(advaSetts.Att_incStatWknd=!0),$("input:radio[name=ZPAtt_genSettIncNonStatWknd]")[0].checked&&(advaSetts.Att_incNonStatWknd=!0)),layout.find("#ZPAtt_lateNightErrMsg")[0]&&!layout.find("#ZPAtt_lateNightErrMsg").hasClass("DNI")&&layout.find("#ZPAtt_lateNightErrMsg").addClass("DNI"),layout.find("#ZPAtt_lateNightLocErrMsg").addClass("DNI"),layout.find("#ZPAtt_lateNightWork").prop("checked")){advaSetts.Att_lateNightWorkTracking=!0;var allValuesPopulated=!0,lateNightParam=[];if(layout.find("#ZPAtt_lateNightSetFormGroup .RotBox.zpnotfy.grc_rlBx").each(function(index,ele){var obj=$(ele),eachLocParam={},value=obj.find("#ZPAtt_lateNightLoc").val();value&&""!==value&&"-1"!==value?eachLocParam.locId=value:allValuesPopulated=!1,(value=obj.find("#ZPAtt_locFrom").val())&&""!==value?eachLocParam.from=Attendance.Common.convertTimerInputToMinsOrSecs(value):allValuesPopulated=!1,(value=obj.find("#ZPAtt_locTo").val())&&""!==value?eachLocParam.to=Attendance.Common.convertTimerInputToMinsOrSecs(value):allValuesPopulated=!1,eachLocParam=Attendance.Settings.checkIfTrackLateNightEdited(eachLocParam),lateNightParam.push(eachLocParam)}),!allValuesPopulated)return void layout.find("#ZPAtt_lateNightErrMsg").removeClass("DNI");lateNightParam=Attendance.Settings.checkAndAddDeletedLateNightConfig(lateNightParam),param.Att_trackLateNightWork=JSON.stringify(lateNightParam),param.isLateNightStrictShiftMargin="0",layout.find("#ZPAtt_lateNight_Strict_ShiftMargin").prop("checked")&&(param.isLateNightStrictShiftMargin="1")}if(layout.find("#ZPAtt_ODSett_Type")[0]){var odArr=[],isErr=!1;if(layout.find("#ZPAtt_ODSett_Type > tr").each(function(index){var odJson={},type=$(layout.find("#ZPAtt_ODSett_Type > tr")[index]).find(".form-control").val().trim(),odId=$(layout.find("#ZPAtt_ODSett_Type > tr")[index]).find(".form-control").attr("id");""!=type&&(!1,type.length>100&&(isErr=!0),odJson[odId]=type,odArr.push(odJson))}),isErr)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ondutytypelen"))}if(rdata.onDutyEnabled&&void 0===param.onDutyEnabled||param.onDutyEnabled){if(odArr.length>0)0!=(odArr=Attendance.Settings.addorDeleteODTypes(odArr)).length&&(param.odTypes=JSON.stringify(odArr));0!==rdata.onDutyTypeEnabled||$("input:radio[name=ZPAtt_"+pageId+"onDutyType]")[1].checked?1===rdata.onDutyTypeEnabled&&$("input:radio[name=ZPAtt_"+pageId+"onDutyType]")[1].checked&&(param.onDutyTypeEnabled=0):param.onDutyTypeEnabled=1}}if(roundOff=layout.find("input:radio[name=ZPAtt_"+pageId+"RoundOff]")[0].checked){var roundOff={},roundOffIn=layout.find("#ZPAtt_"+pageId+"RoundOffIn").val().trim(),roundOffOut=layout.find("#ZPAtt_"+pageId+"RoundOffOut").val().trim(),roundOffHrs=layout.find("#ZPAtt_"+pageId+"RoundOffHrs").val().trim();if(layout.find("#ZPAtt_"+pageId+"RoundOffConfig .error-msg").text(""),""===roundOffIn&&""===roundOffOut&&""===roundOffHrs)return void Attendance.Settings.showRoundOffErr(!0);if(roundOffIn>0&&roundOffIn<61)roundOff.firstIn=roundOffIn;else if(""!==roundOffIn)return void Attendance.Settings.showRoundOffErr();if(roundOffOut>0&&roundOffOut<61)roundOff.lastOut=roundOffOut;else if(""!==roundOffOut)return void Attendance.Settings.showRoundOffErr();if(roundOffHrs>0&&roundOffHrs<61)roundOff.hours=roundOffHrs;else if(""!==roundOffHrs)return void Attendance.Settings.showRoundOffErr();if(!Attendance.Settings.checkGraceForRoundOff(roundOff.firstIn,roundOff.lastOut,roundOff.hours,advaSetts))return;0!==Object.keys(roundOff).length&&(advaSetts.roundOff=roundOff)}if(0!==Object.keys(advaSetts).length&&(param.Att_advaSetts=JSON.stringify(advaSetts)),"genSett"===pageId){0!==rdata.Att_payPer_IncWknd||$("input:radio[name=ZPAtt_genSettIncWknd]")[0].checked?1===rdata.Att_payPer_IncWknd&&$("input:radio[name=ZPAtt_genSettIncWknd]")[0].checked&&(param.payPer_IncWknd="0"):param.payPer_IncWknd="1",0!==rdata.Att_payPer_IncHlday||$("input:radio[name=ZPAtt_genSettIncHlday]")[0].checked?1===rdata.Att_payPer_IncHlday&&$("input:radio[name=ZPAtt_genSettIncHlday]")[0].checked&&(param.payPer_IncHlday="0"):param.payPer_IncHlday="1",0!==rdata.Att_payPer_IncLeave||$("input:radio[name=ZPAtt_genSettIncLeave]")[0].checked?1===rdata.Att_payPer_IncLeave&&$("input:radio[name=ZPAtt_genSettIncLeave]")[0].checked&&(param.payPer_IncLeave="0"):param.payPer_IncLeave="1",!0===hasHalfWeekendFlag&&1===isWeekendPayFlag&&(0!==rdata.Att_fullPay_halfWorking||$("input:radio[name=ZPAtt_genSettFullPayForHalfDay]")[1].checked?1===rdata.Att_fullPay_halfWorking&&$("input:radio[name=ZPAtt_genSettFullPayForHalfDay]")[1].checked&&(param.fullPay_halfWorking="0"):param.fullPay_halfWorking="1"),void 0!==settParent.find("#treatAsLevOnApproval")[0]&&rdata.treatAsLevOnApproval!==settParent.find("#treatAsLevOnApproval")[0].checked&&(param.treatAsLevOnApproval=settParent.find("#treatAsLevOnApproval")[0].checked);var shiftMinTime=layout.find("#ZPAtt_shiftAllowanceMinHours").val().trim();if(""!==shiftMinTime){var shiftMin_Mins=parseInt(shiftMinTime.split(":")[0]);shiftMin_Mins=60*shiftMin_Mins+parseInt(shiftMinTime.split(":")[1]),rdata.shiftAllowanceMinHours!==shiftMin_Mins&&(param.shiftAllowanceMinHours=shiftMin_Mins)}}2===Object.keys(param).length&&-1!==Attendance.Settings.LayoutId.indexOf("attendance-settings-general")||regReasonsLenError||(layout.find("#ZPAtt_sNewPopupRecSave").attr("disabled",!0),$.post("/AttendanceSettingsAction.zp",param,function(rdata){rdata.response&&(layout.find("#ZPAtt_sNewPopupRecSave").prop("disabled",!1),void 0!==param.selShiftId&&(AttendanceShift.depLocShiftList=null),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.settingssaved")),AttendanceShift.userListValue=null,AttendanceShift.userCalValue=null,AttendanceShift.userHoursValue=null,AttendanceShift.depLocShiftList=null,Attendance.resetForLoadData(),calApplySettings&&$(layout.find("#ZPAtt_showApplySett")[0]).trigger("click"),param.settingsId||param.shiftList||param.erecnoList?(Attendance.Settings.getSettInfo("userSettings"),Attendance.Settings.settingsId=rdata.response+""):(Attendance.Settings.getSettInfo(),Attendance.Settings.settingsId=null),Attendance.Settings.toggleAddNewPopUp())}))},addorDeleteODTypes:function(obj){var odJson=Attendance.Settings.odJson,odArray=[],odObj={},addTypeJson={},delTypeJson={},editTypeJson={},addArr=[],editArr=[],deleteArr=[];return 0==Object.keys(odJson).length?(odObj.action="add",$.each(obj,function(index,value){$.each(value,function(id,data){addTypeJson.hasOwnProperty(id)&&(addArr=addTypeJson[id]),addArr.push(data),addTypeJson[id]=addArr})}),odObj.types=addTypeJson,odArray.push(odObj)):($.each(obj,function(index,value){var isEdit=!1,isExist=!1;$.each(value,function(id,data){$.each(odJson,function(typeId,name){return data.toLowerCase()===name.toLowerCase()?(isExist=!0,!1):id===typeId&&data.toLowerCase()!=name.toLowerCase()?(isEdit=!0,isExist=!0,!1):void 0}),isExist?isExist&&isEdit&&((editArr=[]).push(data),editTypeJson[id]=editArr):(addTypeJson.hasOwnProperty(id)&&(addArr=addTypeJson[id]),addArr.push(data),addTypeJson[id]=addArr)})}),$.each(odJson,function(id,data){var isExist=!1;$.each(obj,function(index,value){$.each(value,function(typeId,name){if(id===typeId)return isExist=!0,!1})}),isExist||((deleteArr=[]).push(data),delTypeJson[id]=deleteArr)}),0!=Object.keys(addTypeJson).length&&(odObj.action="add",odObj.types=addTypeJson,odArray.push(odObj)),0!=Object.keys(delTypeJson).length&&((odObj={}).action="delete",odObj.types=delTypeJson,odArray.push(odObj)),0!=Object.keys(editTypeJson).length&&((odObj={}).action="edit",odObj.types=editTypeJson,odArray.push(odObj))),odArray},checkIfTrackLateNightEdited:function(obj){var trackLateNightSett=Attendance.Settings.trackLateNightWork;if(!trackLateNightSett||trackLateNightSett.length<1)return obj.action="add",obj;var eleFound=!1;return trackLateNightSett.forEach(function(ele,index){ele.locId==obj.locId&&(ele.from===obj.from&&ele.to===obj.to||(obj.action="edit"),eleFound=!0)}),eleFound||(obj.action="add"),obj},checkAndAddDeletedLateNightConfig:function(lateNightParam){var trackLateNightSett=Attendance.Settings.trackLateNightWork;return!trackLateNightSett||trackLateNightSett.length<1?lateNightParam:(lateNightParam.forEach(function(ele,index){trackLateNightSett.forEach(function(obj,eleIndex){obj.locId==ele.locId&&(obj.avail=!0)})}),trackLateNightSett.forEach(function(ele,index){if(!ele.avail){var singleLateNightConfig={};singleLateNightConfig.locId=ele.locId,singleLateNightConfig.action="delete",lateNightParam.push(singleLateNightConfig)}delete ele.avail}),lateNightParam)},showRoundOffErr:function(isEmpty){var layout=Layout.Page.container,pageId=Attendance.Settings.settingsPageId,errMsg=layout.find("#ZPAtt_"+pageId+"RoundOffConfig .error-msg");errMsg.text("");var text=ZPI18N.getString("zp.enterthevaluebetween",new Array("1","60"));isEmpty&&(text=ZPI18N.getString("zp.entertheleastvalue",new Array("1","60"))),errMsg.text(text);var id="#ZPAtt_addPopup, .modal-body";"genSett"===pageId&&(id="#ZPAtt_generalSettings"),layout.find(id).animate({scrollTop:500})},checkGraceForRoundOff:function(roundOffIn,roundOffOut,roundOffHrs,advaSetts){var layout=Layout.Page.container,pageId=Attendance.Settings.settingsPageId,graceSett=advaSetts.Att_GracePeriod;if(graceSett){var inSett=graceSett.In,outSett=graceSett.Out,workSett=graceSett.Work,inOutSett=graceSett.InOut,inWorkSett=graceSett.InWork,outWorkSett=graceSett.OutWork,inOutWorkSett=graceSett.InOutWork,round="";if(roundOffIn&&(inSett&&roundOffIn>=inSett.Intime||inOutSett&&roundOffIn>=inOutSett.Intime||inWorkSett&&roundOffIn>=inWorkSett.Intime||inOutWorkSett&&roundOffIn>=inOutWorkSett.Intime)?round=layout.find("#ZPAtt_"+pageId+"RoundOffIn")[0]:roundOffOut&&(outSett&&roundOffOut>=outSett.Outtime||inOutSett&&roundOffOut>=inOutSett.Outtime||outWorkSett&&roundOffOut>=outWorkSett.Outtime||inOutWorkSett&&roundOffOut>=inOutWorkSett.Outtime)?round=layout.find("#ZPAtt_"+pageId+"RoundOffOut")[0]:roundOffHrs&&(workSett&&roundOffHrs>=workSett.Worktime||inWorkSett&&roundOffHrs>=inWorkSett.Worktime||outWorkSett&&roundOffHrs>=outWorkSett.Worktime||inOutWorkSett&&roundOffHrs>=inOutWorkSett.Worktime)&&(round=layout.find("#ZPAtt_"+pageId+"RoundOffHrs")[0]),""!==round)return Attendance.Settings.maxValForRoundOff(round),layout.find("genSett"===pageId?"#ZPAtt_generalSettings":"#ZPAtt_addPopup, .modal-body").animate({scrollTop:500}),!1}return!0},restrictCharRoundOff:function(event){var charCode=event.which?event.which:event.keyCode;return!(charCode>31&&(charCode<48||charCode>57))},maxValForRoundOff:function(obj){var layout=Layout.Page.container,pageId=Attendance.Settings.settingsPageId,graceEnabled=layout.find("input:checkbox[id=gracetoggle]").filter(":checked").length,roundOffDisabled=layout.find("input:radio[name=ZPAtt_"+pageId+"RoundOff]")[1].checked,graceInOutTime="",parent=$(obj).parent();layout.find(".mode-input_err").remove(),layout.find(".grc_rlBx").find("#graceRoundOff").remove();var objId=obj.id,errLoc="InGracetime"===objId?"In":"OutGracetime"===objId?"Out":"Work";if(Attendance.Settings.gracePeriod.resetTimeValue(errLoc),!(graceEnabled<=0||roundOffDisabled)){if(objId==="ZPAtt_"+pageId+"RoundOffIn"||"InGracetime"===objId){var roundOffIn=layout.find("#ZPAtt_"+pageId+"RoundOffIn").val().trim();layout.find("input:checkbox[id=entryGrace]").filter(":checked")&&(graceInOutTime=layout.find("input:checkbox[id=entryGrace]").filter(":checked").parent().next().find("#InGracetime").val().trim()),""!==graceInOutTime&&(graceTime=60*(graceTime=parseInt(graceInOutTime.split(":")[0]))+parseInt(graceInOutTime.split(":")[1])),roundOffIn&&void 0!==graceTime&&roundOffIn>=graceTime&&(objId==="ZPAtt_"+pageId+"RoundOffIn"?parent.append("<div class='mode-input_err'>"+ZPI18N.getString("zp.errormsgforroundoffforgrace",new Array(graceTime+""))+"</div>"):parent.parent().parent().parent().append("<div class='ERR PL10 PT5' id='graceRoundOff'>"+ZPI18N.getString("zp.errormsgforgraceforroundoff",new Array(roundOffIn+""))+"</div>"))}if(objId==="ZPAtt_"+pageId+"RoundOffOut"||"OutGracetime"===objId){var roundOffOut=layout.find("#ZPAtt_"+pageId+"RoundOffOut").val().trim();layout.find("input:checkbox[id=exitGrace]").filter(":checked")&&(graceInOutTime=layout.find("input:checkbox[id=exitGrace]").filter(":checked").parent().next().find("#OutGracetime").val().trim()),""!==graceInOutTime&&(graceTime=60*(graceTime=parseInt(graceInOutTime.split(":")[0]))+parseInt(graceInOutTime.split(":")[1])),roundOffOut&&void 0!==graceTime&&roundOffOut>=graceTime&&(objId==="ZPAtt_"+pageId+"RoundOffOut"?parent.append("<div class='mode-input_err'>"+ZPI18N.getString("zp.errormsgforroundoffforgrace",new Array(graceTime+""))+"</div>"):parent.parent().parent().parent().append("<div class='ERR PL10 PT5' id='graceRoundOff'>"+ZPI18N.getString("zp.errormsgforgraceforroundoff",new Array(roundOffOut+""))+"</div>"))}if(objId==="ZPAtt_"+pageId+"RoundOffHrs"||"WorkGracetime"===objId){var graceTime,roundOffHrs=layout.find("#ZPAtt_"+pageId+"RoundOffHrs").val().trim();layout.find("input:checkbox[id=workGrace]").filter(":checked")&&(graceInOutTime=layout.find("input:checkbox[id=workGrace]").filter(":checked").parent().next().find("#WorkGracetime").val().trim()),""!==graceInOutTime&&(graceTime=60*(graceTime=parseInt(graceInOutTime.split(":")[0]))+parseInt(graceInOutTime.split(":")[1])),roundOffHrs&&void 0!==graceTime&&roundOffHrs>=graceTime&&(objId==="ZPAtt_"+pageId+"RoundOffHrs"?parent.append("<div class='mode-input_err'>"+ZPI18N.getString("zp.errormsgforroundoffforgrace",new Array(graceTime+""))+"</div>"):parent.parent().parent().parent().append("<div class='ERR PL10 PT5' id='graceRoundOff'>"+ZPI18N.getString("zp.errormsgforgraceforroundoff",new Array(roundOffHrs+""))+"</div>"))}}},updateShiftPermSettings:function(){var shiftSettParam={mode:"updateShiftPermSettings",conreqcsr:csrfToken},shiftSettList=Attendance.Settings.ShiftSettList,shiftViewPerm=Attendance.Settings.getPermValFromCheckBox("shiftMap",!0);shiftSettList.mappingView_Allowed!==shiftViewPerm&&(shiftSettParam.mappingView_Allowed=shiftViewPerm);var shiftEditPerm=Attendance.Settings.getPermValFromCheckBox("shiftMap",!1);shiftSettList.mappingEdit_Allowed!==shiftEditPerm&&(shiftSettParam.mappingEdit_Allowed=shiftEditPerm),0===shiftSettList.NotifyMail_Allowed&&$("input:radio[name=ZPAtt_genSettEditShiftNotifyMail]")[0].checked?shiftSettParam.notifyMail_Allowed="1":1!==shiftSettList.NotifyMail_Allowed||$("input:radio[name=ZPAtt_genSettEditShiftNotifyMail]")[0].checked||(shiftSettParam.notifyMail_Allowed="0"),0===shiftSettList.NotifyFeeds_Allowed&&$("input:radio[name=ZPAtt_genSettEditShiftNotifyFeed]")[0].checked?shiftSettParam.notifyFeeds_Allowed="1":1!==shiftSettList.NotifyFeeds_Allowed||$("input:radio[name=ZPAtt_genSettEditShiftNotifyFeed]")[0].checked||(shiftSettParam.notifyFeeds_Allowed="0"),0===shiftSettList.isShiftChangeReasonMandatory&&$("#ZPAtt_genSettIsShiftChangeReasonMandatory").prop("checked")?shiftSettParam.isShiftChangeReasonMandatory="1":1!==shiftSettList.isShiftChangeReasonMandatory||$("ZPAtt_genSettIsShiftChangeReasonMandatory").prop("checked")||(shiftSettParam.isShiftChangeReasonMandatory="0"),2!==Object.keys(shiftSettParam).length&&$.post("/ShiftSettingsAction.zp",shiftSettParam,function(rdata){rdata.response&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.settingssaved")),Attendance.Settings.getShiftPermSettings())})},toggleAllowEmailEdit:function(obj){$(obj).is(":checked")?$(obj).parent().next().prop("disabled",!1):$(obj).parent().next().attr("disabled","disabled")},onRadioValChange:function(obj){var pageId=Attendance.Settings.settingsPageId,layout=Layout.Page.container;if(obj.id==="ZPAtt_"+pageId+"MiniWHours"||obj.name==="ZPAtt_"+pageId+"AttMarkHours"&&$("#ZPAtt_"+pageId+"MiniWHours").prop("checked")){layout.find("#ZPAtt_"+pageId+"LModeHoursCont").parent().animate({height:"74px"},120,function(){layout.find("#ZPAtt_"+pageId+"LModeHoursCont").hide(),layout.find("#ZPAtt_"+pageId+"SModeHoursCont").show()}),layout.find("#ZPAtt_"+pageId+"MaxHoursCont").animate({height:"84px"},120,function(){layout.find("#ZPAtt_"+pageId+"MaxHoursFullDayCont label").text(ZPI18N.getString("zp.fullday")),layout.find("#ZPAtt_"+pageId+"MaxHoursHalfDayCont").show()});var SModeFDay=layout.find("#ZPAtt_"+pageId+"SModeFDay").val().trim(),SModeFDayHour=parseInt(SModeFDay.split(":")[0]),SModeFDayMin=parseInt(SModeFDay.split(":")[1]);SModeFDay=Attendance.changeToMin(SModeFDayHour,SModeFDayMin);var MaxFDay=layout.find("#ZPAtt_"+pageId+"MaxFDay").val().trim(),MaxFDayHour=parseInt(MaxFDay.split(":")[0]),MaxFDayMin=parseInt(MaxFDay.split(":")[1]);if(MaxFDay=Attendance.changeToMin(MaxFDayHour,MaxFDayMin),layout.find("#ZPAtt_"+pageId+"SModeHoursCont .selinput").show().next().hide(),$("input:radio[name=ZPAtt_"+pageId+"AttMarkHours]")[1].checked&&(layout.find("#ZPAtt_"+pageId+"SModeHoursCont .selinput").hide().next().show(),SModeFDay=Attendance.Settings.maxShiftDiffTime),MaxFDay<SModeFDay&&layout.find("#ZPAtt_"+pageId+"MaxFDay").val(Attendance.disHours(SModeFDay,!0)),$("input:radio[name=ZPAtt_"+pageId+"AttMarkHours]")[1].checked){var MaxHDay=layout.find("#ZPAtt_"+pageId+"MaxHDay").val().trim(),MaxHDayHour=parseInt(MaxHDay.split(":")[0]),MaxHDayMin=parseInt(MaxHDay.split(":")[1]);MaxHDay=Attendance.changeToMin(MaxHDayHour,MaxHDayMin);var SModeHDay=Math.round(Attendance.Settings.maxShiftDiffTime/2);MaxHDay<SModeHDay&&layout.find("#ZPAtt_"+pageId+"MaxHDay").timepicker("setTime",Attendance.disHours(SModeHDay,!0))}}else if(obj.id==="ZPAtt_"+pageId+"ExpWHours"||obj.name==="ZPAtt_"+pageId+"AttMarkHours"&&$("#ZPAtt_"+pageId+"ExpWHours").prop("checked")){layout.find("#ZPAtt_"+pageId+"LModeHoursCont").parent().animate({height:"34px"},120,function(){layout.find("#ZPAtt_"+pageId+"SModeHoursCont").hide(),layout.find("#ZPAtt_"+pageId+"LModeHoursCont").show()}),layout.find("#ZPAtt_"+pageId+"MaxHoursCont").animate({height:"44px"},120,function(){layout.find("#ZPAtt_"+pageId+"MaxHoursFullDayCont label").text(ZPI18N.getString("zp.perday")),layout.find("#ZPAtt_"+pageId+"MaxHoursHalfDayCont").hide()});var LModePDay=layout.find("#ZPAtt_"+pageId+"LModePDay").val().trim(),LModePDayHour=parseInt(LModePDay.split(":")[0]),LModePDayMin=parseInt(LModePDay.split(":")[1]);LModePDay=Attendance.changeToMin(LModePDayHour,LModePDayMin),layout.find("#ZPAtt_"+pageId+"LModeHoursCont .selinput").show().next().hide(),$("input:radio[name=ZPAtt_"+pageId+"AttMarkHours]")[1].checked&&(layout.find("#ZPAtt_"+pageId+"LModeHoursCont .selinput").hide().next().show(),LModePDay=Attendance.Settings.maxShiftDiffTime);var MaxFDay1=layout.find("#ZPAtt_"+pageId+"MaxFDay").val().trim(),MaxFDayHour1=parseInt(MaxFDay1.split(":")[0]),MaxFDayMin1=parseInt(MaxFDay1.split(":")[1]);(MaxFDay1=Attendance.changeToMin(MaxFDayHour1,MaxFDayMin1))<LModePDay&&layout.find("#ZPAtt_"+pageId+"MaxFDay").val(Attendance.disHours(LModePDay,!0))}else if(obj.id==="ZPAtt_"+pageId+"MaxHoursDisable")layout.find("#ZPAtt_"+pageId+"MaxHoursCont").slideUp(300);else if(obj.id==="ZPAtt_"+pageId+"MaxHoursEnable"){MaxFDay=layout.find("#ZPAtt_"+pageId+"MaxFDay").val().trim(),MaxFDayHour=parseInt(MaxFDay.split(":")[0]),MaxFDayMin=parseInt(MaxFDay.split(":")[1]);MaxFDay=Attendance.changeToMin(MaxFDayHour,MaxFDayMin),$("input:radio[name=ZPAtt_"+pageId+"AttMarkHours]")[1].checked&&MaxFDay<(SModeFDay=Attendance.Settings.maxShiftDiffTime)&&layout.find("#ZPAtt_"+pageId+"MaxFDay").val(Attendance.disHours(SModeFDay,!0)),$("input:radio[name=ZPAtt_"+pageId+"AttMarking]")[1].checked&&layout.find("#ZPAtt_"+pageId+"MaxHoursFullDayCont label").text(ZPI18N.getString("zp.perday")),layout.find("#ZPAtt_"+pageId+"MaxHoursCont").slideDown(300)}else obj.id==="ZPAtt_"+pageId+"ReportManEditDisable"?layout.find("#ZPAtt_"+pageId+"SubOrdEdit").slideUp(300):obj.id==="ZPAtt_"+pageId+"ReportManEditEnable"?(layout.find("#ZPAtt_"+pageId+"SubOrdEdit").slideDown(300),$("input:radio[name=ZPAtt_"+pageId+"ReportManView]")[0].checked=!0):obj.id==="ZPAtt_"+pageId+"ReportManViewDisable"?layout.find("#ZPAtt_"+pageId+"ReportManEditDisable").trigger("click"):obj.id==="ZPAtt_"+pageId+"UserEditDisable"?layout.find("#ZPAtt_"+pageId+"OwnEntryEdit").children().slideUp(300):obj.id==="ZPAtt_"+pageId+"UserEditEnable"?layout.find("#ZPAtt_"+pageId+"OwnEntryEdit").children().slideDown(300):obj.id==="ZPAtt_"+pageId+"RoundOffEnable"?layout.find("#ZPAtt_"+pageId+"RoundOffConfig").slideDown(200):obj.id==="ZPAtt_"+pageId+"RoundOffDisable"&&layout.find("#ZPAtt_"+pageId+"RoundOffConfig").slideUp(200)},onUseShiftTimeChange:function(obj){var useShiftHours=$("input:radio[name=ZPAtt_"+Attendance.Settings.settingsPageId+"AttMarkHours]")[1].checked;$("input:radio[name=ZPAtt_"+Attendance.Settings.settingsPageId+"AttMarking]")[1].checked?($(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"LModeHoursCont .selinput").show().next().hide(),useShiftHours&&$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"LModeHoursCont .selinput").hide().next().show()):($(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeHoursCont .selinput").show().next().hide(),useShiftHours&&$(Attendance.Settings.LayoutId+" #ZPAtt_"+Attendance.Settings.settingsPageId+"SModeHoursCont .selinput").hide().next().show()),Attendance.Settings.onRadioValChange(obj)},myReqEmpNameIdDaySort:function(obj){$(obj).hasClass("sort-d")?$(obj).attr("class","sort-img sort-u CP"):$(obj).attr("class","sort-img sort-d CP"),"ZPAtt_absentScheduler_myReqNameSort"!==obj.id&&"ZPAtt_absentScheduler_myReqDaySort"!==obj.id||("ZPAtt_absentScheduler_myReqNameSort"===obj.id?$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler_myReqDaySort").attr("class","sort-img sort CP"):$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler_myReqNameSort").attr("class","sort-img sort CP"),Attendance.Settings.Scheduler.showScheduleList()),"ZPAtt_userId_myReqEmpSort"!==obj.id&&"ZPAtt_userId_myReqIdSort"!==obj.id||("ZPAtt_userId_myReqEmpSort"===obj.id?$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqIdSort").attr("class","sort-img sort CP"):$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqEmpSort").attr("class","sort-img sort CP"),Attendance.Settings.Mapper.MapIdStartIndex=0,Attendance.Settings.Mapper.getUserMapIdList()),"ZPAtt_userSettingsDet_myReqNameSort"===obj.id&&Attendance.Settings.getSettInfo("userSettings"),"ZPAtt_defPre_myReqNameSort"!==obj.id&&"ZPAtt_defPreFrom_myReqDaySort"!==obj.id&&"ZPAtt_defPreTo_myReqDaySort"!==obj.id||("ZPAtt_defPre_myReqNameSort"===obj.id?(Layout.Page.container.find("#ZPAtt_defPreFrom_myReqDaySort").attr("class","sort-img sort CP"),Layout.Page.container.find("#ZPAtt_defPreTo_myReqDaySort").attr("class","sort-img sort CP")):"ZPAtt_defPreFrom_myReqDaySort"===obj.id?(Layout.Page.container.find("#ZPAtt_defPre_myReqNameSort").attr("class","sort-img sort CP"),Layout.Page.container.find("#ZPAtt_defPreTo_myReqDaySort").attr("class","sort-img sort CP")):"ZPAtt_defPreTo_myReqDaySort"===obj.id&&(Layout.Page.container.find("#ZPAtt_defPreFrom_myReqDaySort").attr("class","sort-img sort CP"),Layout.Page.container.find("#ZPAtt_defPre_myReqNameSort").attr("class","sort-img sort CP")),Attendance.Settings.DefaultPresent.settings=null,Attendance.Settings.DefaultPresent.getAllDefPreRule())},erecNo:null,applySettings:function(){var param={mode:"applySettings",conreqcsr:csrfToken};""!==$(Attendance.Settings.LayoutId+" #ZPAtt_applySettFromDate").val().trim()?""!==$(Attendance.Settings.LayoutId+" #ZPAtt_applySettToDate").val().trim()?(param.startDate=$(Attendance.Settings.LayoutId+" #ZPAtt_applySettFromDate").val().trim(),param.endDate=$(Attendance.Settings.LayoutId+" #ZPAtt_applySettToDate").val().trim(),null!==Attendance.Settings.settingsId&&(param.settingsId=Attendance.Settings.settingsId),$(Attendance.Settings.LayoutId+" #ZPAtt_applyGenSettPopup .btn-primary").attr("disabled",!0),$.post("/AttendanceSettingsAction.zp",param,function(rdata){$(Attendance.Settings.LayoutId+" #ZPAtt_applyGenSettPopup .btn-primary").prop("disabled",!1),"success"===rdata.msg?(ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.applysettingupdating")),$($(Attendance.Settings.LayoutId+" #ZPAtt_showApplySett")[0]).trigger("click")):"invalid Dates"===rdata.msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")):"exceeded dates"===rdata.msg&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.datewithinonemonth"))})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invalidtodate")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invalidfromdate"))},maxShiftDefDiffTime:null,shiftDiffObj:{},consShiftListSelect:function(id){Attendance.Settings.maxShiftDefDiffTime=null,Attendance.Settings.shiftDiffObj={};var sList=Attendance.Settings.shiftList;if("genSettShift"===id){var newShiftMappingShiftList=$(Attendance.Settings.LayoutId+" #ZPAtt_"+id);newShiftMappingShiftList.children().remove()}for(var i in sList){var diffTime,data=sList[i];"genSettShift"===id&&(newShiftMappingShiftList.append("<option value="+data.shiftId+">"+data.sname+" [ "+Attendance.disTime(data.fTime,!0)+" - "+Attendance.disTime(data.tTime,!0)+"] </option>"),"genSettShift"===id&&1===data.select&&(newShiftMappingShiftList.select2("val",data.shiftId),Attendance.Settings.generalShiftId=data.shiftId));var fromTime=parseInt(data.fTime),toTime=parseInt(data.tTime);diffTime=fromTime<toTime?toTime-fromTime:fromTime>toTime?1440-(diffTime=fromTime-toTime):1439,Attendance.Settings.shiftDiffObj[data.shiftId]=diffTime,(null===Attendance.Settings.maxShiftDefDiffTime||Attendance.Settings.maxShiftDefDiffTime<diffTime)&&(Attendance.Settings.maxShiftDefDiffTime=Attendance.Settings.maxShiftDiffTime=diffTime)}},maxShiftDiffTime:null,consMaxShiftDiffTime:function(){var shiftList=ZPPickList.sharedSelectedShifts;if(Attendance.Settings.maxShiftDiffTime=null,0!==shiftList.length)for(var i in shiftList){var diffTime=Attendance.Settings.shiftDiffObj[shiftList[i]];(null===Attendance.Settings.maxShiftDiffTime||Attendance.Settings.maxShiftDiffTime<diffTime)&&(Attendance.Settings.maxShiftDiffTime=diffTime)}else Attendance.Settings.maxShiftDiffTime=Attendance.Settings.maxShiftDefDiffTime},constructAbsSchNotify:function(){var element=Layout.Page.container.find(".RotBox.zpnotfy");Layout.Page.container.find("#ZPAtt_notifyAbsentEntryCheck")[0].checked?(Attendance.Settings.enableOrDisableCustLink(),element[0]?(element.show(),Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days #ZPAtt_AbsSch_add").show()):Attendance.Settings.addDaysConfigForAbsSch()):(element.hide(),Layout.Page.container.find("#customise_template").hide(),Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days #ZPAtt_AbsSch_add").hide())},enableOrDisableCustLink:function(){var popup_parent=Layout.Page.container.find("#ZPAtt_addPopup"),checkedLength=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days").find("input:checkbox:checked").length;popup_parent.find("#customise_template").addClass("isDisabled"),popup_parent.find("#customise_template").show(),checkedLength>0&&popup_parent.find("#customise_template").removeClass("isDisabled")},addDaysConfigForAbsSch:function(day,initialSelection){var element=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days"),isClassDefined=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days")[0],txt="",constructedDates=[];isClassDefined?element.find(".RotBox.zpnotfy").each(function(index){constructedDates=constructedDates.concat(element.find(".RotBox.zpnotfy").eq(index).attr("value"))}):txt+='<div class="form-group" id="ZPAtt_AbsSch_Days"><div class="col-sm-7 col-sm-offset-3">';for(var index=0,optionTxt="";index<10;index++){var value=index+1;constructedDates.includes(value.toString())||(day||(day=value),optionTxt+='<option value="'+value+'">'+value+"</option>")}Attendance.Settings.removeOptionsForDays(day);var consAbs=ZPI18N.getString("zp.consabs");if(1===day&&(consAbs=ZPI18N.getString("zp.onedayabs")),txt+="<div class='RotBox zpnotfy' value='"+day+"'><div class='addSelectIcon' onClick='Attendance.Settings.delDaysConfigForAbsSch(this,"+day+")'><i class='IC-remove red CP'></i></div>",txt+="<div class='W100 FL MB10'><label class='MT7 FL MR10'>"+ZPI18N.getString("zp.wfon")+"</label><select class='FL DIB' style='width:110px;'  id='ZPAtt_dayOptions' onchange='Attendance.Settings.changeIdName("+day+")'>",txt+=optionTxt,txt+="</option></select>",txt+="<label class='MT7 FL ML10' id='ZPAtt_conabs'>"+consAbs+"</label></div>",txt+="<label class='checkbox W100 FL'><input type='checkbox'  id='ZPAtt_notifyAbsToEmp_"+day+"' onclick='Attendance.Settings.enableOrDisableCustLink()'><span>"+ZPI18N.getString("zp.notifyemployee")+"</span></label><label class='checkbox W100 FL'><input type='checkbox'  id='ZPAtt_notifyAbsToRepMan_"+day+"' onclick='Attendance.Settings.enableOrDisableCustLink()'><span>"+ZPI18N.getString("zp.notifyrepman")+"</span></label>",txt+="<label class='checkbox W100 FL notspeusrchk'><input type='checkbox' id='ZPAtt_notifyAbsToNotSpec_"+day+"' onchange='Attendance.Settings.addNotifySpecificUsers("+day+")' onclick='Attendance.Settings.enableOrDisableCustLink()'><span>"+ZPI18N.getString("zp.notifyspecificusers")+"</span></label>",txt+="<input type='hidden' multiple='multiple' class='slct2_Mxhgt' id='ZPAtt_notifyAbsMultiUser_"+day+"'></div>",Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days #ZPAtt_AbsSch_add").show(),isClassDefined?($(txt).insertBefore(Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days #ZPAtt_AbsSch_add")),element.find(".RotBox.zpnotfy").length>=10&&Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days #ZPAtt_AbsSch_add").hide(),Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days .RotBox.zpnotfy .addSelectIcon").show()):(txt+="<a class='IC-add zpadsdl' id='ZPAtt_AbsSch_add' onClick='Attendance.Settings.addDaysConfigForAbsSch()'>"+ZPI18N.getString("zp.addmore")+"</a></div>",$(txt).insertAfter(Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_form4")),Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days .RotBox.zpnotfy .addSelectIcon").hide()),Attendance.changeinputtoselect2("ZPAtt_notifyAbsMultiUser_"+day,Attendance.Settings.LayoutId,initialSelection&&initialSelection.length>0?initialSelection:void 0),!(initialSelection&&initialSelection.length>0)){var document=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days .RotBox.zpnotfy[value="+day+"]");document.find("#s2id_ZPAtt_notifyAbsMultiUser_"+day).hide(),document.find("#ZPAtt_notifyAbsMultiUser_"+day).hide(),document.find("#ZPAtt_notifyAbsMultiUser_"+day).val("").trigger("change")}Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days select").select2({minimumResultsForSearch:-1}),Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days").show()},addNotifySpecificUsers:function(day){var element=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days .RotBox.zpnotfy[value="+day+"]");element.find("#ZPAtt_notifyAbsToNotSpec_"+day)[0].checked?(element.find("#s2id_ZPAtt_notifyAbsMultiUser_"+day).show(),element.find("#ZPAtt_notifyAbsMultiUser_"+day).show()):(element.find("#s2id_ZPAtt_notifyAbsMultiUser_"+day).hide(),element.find("#ZPAtt_notifyAbsMultiUser_"+day).hide())},delDaysConfigForAbsSch:function(obj,day){$(obj).parent().remove();var element=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days");1===element.find(".RotBox.zpnotfy").length&&element.find(".RotBox.zpnotfy .addSelectIcon").hide(),Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days #ZPAtt_AbsSch_add").show(),Attendance.Settings.addOptionsForDays(day)},changeIdName:function(day){var row=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days").find(".RotBox.zpnotfy[value="+day+"]"),newDay=parseInt(row.find(".select2-choice span").text().substring(0,1));1===newDay&&"0"===row.find(".select2-choice span").text().substring(1,2)&&(newDay=parseInt(row.find(".select2-choice span").text().substring(0,2))),row.attr("value",newDay),row.find("#s2id_ZPAtt_notifyAbsMultiUser_"+day).attr("id","s2id_ZPAtt_notifyAbsMultiUser_"+newDay),row.find("#ZPAtt_notifyAbsMultiUser_"+day).attr("id","ZPAtt_notifyAbsMultiUser_"+newDay),row.find("#ZPAtt_notifyAbsToRepMan_"+day).attr("id","ZPAtt_notifyAbsToRepMan_"+newDay),row.find("#ZPAtt_notifyAbsToEmp_"+day).attr("id","ZPAtt_notifyAbsToEmp_"+newDay),row.find("#ZPAtt_dayOptions").attr("onchange","Attendance.Settings.changeIdName("+newDay+")"),row.find("#ZPAtt_notifyAbsToNotSpec_"+day).attr("id","ZPAtt_notifyAbsToNotSpec_"+newDay),row.find("#ZPAtt_notifyAbsToNotSpec_"+newDay).attr("onchange","Attendance.Settings.addNotifySpecificUsers("+newDay+")"),row.find(".addSelectIcon").attr("onclick","Attendance.Settings.delDaysConfigForAbsSch(this,"+newDay+")"),1==newDay?row.find("#ZPAtt_conabs").text(ZPI18N.getString("zp.onedayabs")):1==day&&row.find("#ZPAtt_conabs").text(ZPI18N.getString("zp.consabs")),Attendance.Settings.removeOptionsForDays(newDay),Attendance.Settings.addOptionsForDays(day)},removeOptionsForDays:function(day){Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days").find(".RotBox.zpnotfy").each(function(index,row){parseInt(row.getAttribute("value"))!==day&&$(row).find("#ZPAtt_dayOptions [value="+day+"]").remove()})},addOptionsForDays:function(day){var txt='<option value="'+day+'">'+day+"</option>";Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days").find(".RotBox.zpnotfy").each(function(index,row){$(row).find("#ZPAtt_dayOptions option").each(function(index,option){var cur=parseInt(option.getAttribute("value"));if(null===option.previousSibling&&day<cur)$(txt).insertBefore(option);else if(null===option.nextSibling&&day>cur)$(txt).insertAfter(option);else if(null!==option.nextSibling){var next=parseInt(option.nextSibling.getAttribute("value"));day>cur&&day<next&&$(txt).insertAfter(option)}})})},buildHtmlToAddLateNightWork:function(noNeedToAppend){var layout=Layout.Page.container,lateNightFormGrp=layout.find("#ZPAtt_lateNightSetFormGroup"),lateNightOvertimeShiftMargin=layout.find("#ZPAtt_lateNightWork_OverTime_ShiftMargin"),lateNightWorkCheckBox=layout.find("#ZPAtt_lateNightWork");if(lateNightWorkCheckBox.prop("checked")){var appendableEle=lateNightFormGrp.children().eq(0);if(0===appendableEle.find(".inpt_rel").length)if(Object.keys(Attendance.Settings.locList).length>0){Attendance.Settings.getLocListOption();var html='<div class="inpt_rel FL rotBox zp_LNW">';html+='<span class="error-msg ML20 DNI" id="ZPAtt_lateNightErrMsg">'+ZPI18N.getString("zp.selectallvalues")+"</span></div>",appendableEle.append(html),noNeedToAppend||Attendance.Settings.addLocForLateNight()}else layout.find("#ZPAtt_lateNightLocErrMsg").removeClass("DNI"),lateNightWorkCheckBox.prop("checked",!1);lateNightFormGrp.removeClass("DN"),lateNightOvertimeShiftMargin.removeClass("DN")}else lateNightFormGrp.addClass("DN"),lateNightOvertimeShiftMargin.addClass("DN")},removeAddLocOptions:function(obj,locId,locName){var changedEle=$(obj);locId&&-1!==locId&&(Attendance.Settings.locList[locId]=locName);var id=changedEle.val();"-1"!==id?(changedEle.attr("onchange","Attendance.Settings.removeAddLocOptions(this,"+id+",'"+Attendance.Settings.locList[id]+"')"),delete Attendance.Settings.locList[id]):changedEle.attr("onchange","Attendance.Settings.removeAddLocOptions(this,-1)"),Layout.Page.container.find(".RotBox.zpnotfy.grc_rlBx").each(function(index,ele){Attendance.Settings.addSelectedOption($(ele).find("#ZPAtt_lateNightLoc"))})},addSelectedOption:function(exactEle){var locOption=Attendance.Settings.getLocListOption(),val=exactEle.val();if(val&&""!==val&&"-1"!==val){var text=exactEle.find('option[value="'+val+'"]').text();locOption+="<option value="+val+">"+ZPeople.escapeHtml(text)+"</option>"}exactEle.find("option").remove(),exactEle.append(locOption),exactEle.select2("val",val)},addLocForLateNight:function(obj){var ele=Layout.Page.container.find("#ZPAtt_lateNightSetFormGroup"),locList=Attendance.Settings.locList,rotBox=ele.find(".RotBox.zpnotfy.grc_rlBx"),noOfLocLessCons=0;rotBox.each(function(index,obj){"-1"!==$(obj).find("select").val()?(delete locList[$(obj).find("select").val()],0):noOfLocLessCons++}),Attendance.Settings.locList=locList;var locOption=Attendance.Settings.getLocListOption(),lengthCons=rotBox.length,noOfLocsToBeCons=Object.keys(locList).length,appendableEle=ele.find("#ZPAtt_lateNightErrMsg"),addIconClass="remove",removeIconClass="remove";1!==noOfLocsToBeCons&&noOfLocLessCons+1!==noOfLocsToBeCons||(addIconClass="remove DN"),0===lengthCons&&(removeIconClass="remove DN"),appendableEle.before(Attendance.Settings.appendNewLocHtml(removeIconClass,locOption,addIconClass));var newEle=appendableEle.prev();newEle.find("#ZPAtt_lateNightLoc").select2({minimumResultsForSearch:5}),obj?(newEle.find("#ZPAtt_lateNightLoc").select2("val",obj.locId),Attendance.Settings.setTimePickerValues(newEle),newEle.find("#ZPAtt_locFrom").timepicker("setTime",Attendance.disTime(obj.from,void 0,!0,!0)),newEle.find("#ZPAtt_locTo").timepicker("setTime",Attendance.disTime(obj.to,void 0,!0,!0))):Attendance.Settings.setTimePickerValues(newEle),newEle.prev().find(".remove").eq(0).removeClass("DN"),newEle.prev().find(".remove").eq(1).addClass("DN")},setTimePickerValues:function(ele){var showMeridian=Attendance.timeFormatIs12hr,onClick="Attendance.set_DefValue_ForTimePicker_Input(this)",placeHolder=showMeridian?"1:00 PM":"13:00";Attendance.Common.setTimePicker(showMeridian,onClick,placeHolder,ele.find("#ZPAtt_locFrom")),Attendance.Common.setTimePicker(showMeridian,onClick,placeHolder,ele.find("#ZPAtt_locTo"))},appendNewLocHtml:function(removeIconClass,locOption,addIconClass){var timePickerClass='<div class="input-group bootstrap-timepicker timepicker zp_Cust-timpckr W120 FL ML10"><input type="text" class="form-control"',timepickerSpan='><span class="input-group-addon"><div class="IC-clock gry CP"></div></span></div>',html='<div class="RotBox zpnotfy grc_rlBx"><div class="addSelectIcon"><a class="'+removeIconClass+'" onclick="Attendance.Settings.removeLocForLateNight(this)"><i class="IC-remove red CP"></i></a>';return html+='<a class="'+addIconClass+'" onclick="Attendance.Settings.addLocForLateNight()"><i class="IC-add-r S18 CP"></i></a></div>',html+='<div class="zp_noti-Inp"><select class="W180 ML5 MR5 FL" id="ZPAtt_lateNightLoc" onchange="Attendance.Settings.removeAddLocOptions(this)">'+locOption+"</select>",html+=timePickerClass+'id="ZPAtt_locFrom"'+timepickerSpan,html+=timePickerClass+'id="ZPAtt_locTo"'+timepickerSpan,html+="</div></div>"},removeLocForLateNight:function(obj){var ele=$(obj).closest(".RotBox.zpnotfy.grc_rlBx"),val=ele.find("#ZPAtt_lateNightLoc").val(),text=ele.find('#ZPAtt_lateNightLoc option[value="'+val+'"]').text();ele.remove();var updOptions=!1;"-1"!==val&&(Attendance.Settings.locList[val]=text,updOptions=!0,Attendance.Settings.getLocListOption());Attendance.Settings.locList;var rotBox=Layout.Page.container.find("#ZPAtt_lateNightSetFormGroup").find(".RotBox.zpnotfy.grc_rlBx"),length=rotBox.length;rotBox.each(function(index,doc){updOptions&&Attendance.Settings.addSelectedOption($(doc).find("#ZPAtt_lateNightLoc")),$(doc).find(".remove").eq(0).removeClass("DN"),$(doc).find(".remove").eq(1).addClass("DN"),index===length-1&&0!==index?($(doc).find(".remove").eq(0).removeClass("DN"),$(doc).find(".remove").eq(1).removeClass("DN")):index===length-1&&0===index&&($(doc).find(".remove").eq(0).addClass("DN"),$(doc).find(".remove").eq(1).removeClass("DN"))})},getLocListOption:function(){locList=Attendance.Settings.locList;var locOption='<option value="-1" selected>'+ZPI18N.getString("zp.selLocation")+"</option>";for(var locId in locList)locOption+="<option value="+locId+">"+ZPeople.escapeHtml(ZPeople.decodeTxt(locList[locId]))+"</option>";return locOption},propagateClick:function(obj,isView,viewId,editId){isView&&(Layout.Page.container.find("#"+viewId).prop("checked")?(Layout.Page.container.find("#"+editId).prop("disabled",!1),$(Layout.Page.container.find("#"+editId).parent()[0]).removeClass("lbl_disbld")):(Layout.Page.container.find("#"+editId).prop("checked",!1),Layout.Page.container.find("#"+editId).prop("disabled",!0),$(Layout.Page.container.find("#"+editId).parent()[0]).addClass("lbl_disbld"))),"ZPAtt_enable_editshiftsettings_Users"!==editId&&"ZPAtt_enable_editshiftsettings_RepMan"!==editId||Attendance.Settings.tooglePastShiftEditPerm()},getPermValFromCheckBox:function(inputName,isView){var perm=0,isGeneralSettPage=-1!==Layout.Page.urlmode.indexOf("attendance_settings_general");if("showReport"===inputName){var generalShiftSpec=isGeneralSettPage?"ZPAtt_genSettReportShowRepMan":"ZPAtt_userSettReportShowRepMan";perm=Layout.Page.container.find("#"+generalShiftSpec).prop("checked")?1:0}else{var repManId="shiftMap"===inputName?isView?"#ZPAtt_enable_shiftsettings_RepMan":"#ZPAtt_enable_editshiftsettings_RepMan":isView?"#"+(isGeneralSettPage?"showBalanceOTViewIdRepMan":"ZPAtt_userSettBalOtShowRepMan"):"#"+(isGeneralSettPage?"editBalanceOTViewIdRepMan":"ZPAtt_userSettBalOtEditRepMan"),userId="shiftMap"===inputName?isView?"#ZPAtt_enable_shiftsettings_Users":"#ZPAtt_enable_editshiftsettings_Users":isView?"#"+(isGeneralSettPage?"showBalanceOTViewIduser":"ZPAtt_userSettBalOtShowUsers"):"#"+(isGeneralSettPage?"editBalanceOTViewIduser":"ZPAtt_userSettBalOtEditUsers"),repManPerm=Layout.Page.container.find(repManId).prop("checked"),userPerm=Layout.Page.container.find(userId).prop("checked");perm=repManPerm&&userPerm?2:repManPerm?1:userPerm?3:0}return perm},constructPermValFromCheckBox:function(permVal,inputName,isView){var isGeneralPage=-1!==Layout.Page.urlmode.indexOf("attendance_settings_general");if("showReport"===inputName){var generalShiftSpec=isGeneralPage?"#ZPAtt_genSettReportShowRepMan":"#ZPAtt_userSettReportShowRepMan";Layout.Page.container.find(generalShiftSpec).prop("checked",1==permVal)}else{var repManId,userId,repManViewId,repManEditId,userViewId,userEditId;"shiftMap"===inputName?(repManViewId="#ZPAtt_enable_shiftsettings_RepMan",repManEditId="#ZPAtt_enable_editshiftsettings_RepMan",userViewId="#ZPAtt_enable_shiftsettings_Users",userEditId="#ZPAtt_enable_editshiftsettings_Users"):(repManViewId=isGeneralPage?"#showBalanceOTViewIdRepMan":"#ZPAtt_userSettBalOtShowRepMan",repManEditId=isGeneralPage?"#editBalanceOTViewIdRepMan":"#ZPAtt_userSettBalOtEditRepMan",userViewId=isGeneralPage?"#showBalanceOTViewIduser":"#ZPAtt_userSettBalOtShowUsers",userEditId=isGeneralPage?"#editBalanceOTViewIduser":"#ZPAtt_userSettBalOtEditUsers"),repManId=isView?repManViewId:repManEditId,userId=isView?userViewId:userEditId,Layout.Page.container.find(repManId).prop("checked",!1),Layout.Page.container.find(userId).prop("checked",!1),isView&&(Layout.Page.container.find(repManEditId).prop("disabled",!0),Layout.Page.container.find(userEditId).prop("disabled",!0),$(Layout.Page.container.find(repManEditId).parent()[0]).addClass("lbl_disbld"),$(Layout.Page.container.find(userEditId).parent()[0]).addClass("lbl_disbld")),2==permVal?(Layout.Page.container.find(repManId).prop("checked",!0),Layout.Page.container.find(userId).prop("checked",!0),isView?(Layout.Page.container.find(repManEditId).prop("disabled",!1),Layout.Page.container.find(userEditId).prop("disabled",!1),$(Layout.Page.container.find(repManEditId).parent()[0]).removeClass("lbl_disbld"),$(Layout.Page.container.find(userEditId).parent()[0]).removeClass("lbl_disbld")):"shiftMap"===inputName&&Attendance.Settings.tooglePastShiftEditPerm()):3==permVal?(Layout.Page.container.find(userId).prop("checked",!0),isView?(Layout.Page.container.find(userEditId).prop("disabled",!1),$(Layout.Page.container.find(userEditId).parent()[0]).removeClass("lbl_disbld")):"shiftMap"===inputName&&Attendance.Settings.tooglePastShiftEditPerm()):1==permVal&&(Layout.Page.container.find(repManId).prop("checked",!0),isView?(Layout.Page.container.find(repManEditId).prop("disabled",!1),$(Layout.Page.container.find(repManEditId).parent()[0]).removeClass("lbl_disbld")):"shiftMap"===inputName&&Attendance.Settings.tooglePastShiftEditPerm())}}},Attendance.Settings.USettings={settMappedShiftList:[],settMappedEnoList:[],consUsettingsDetails:function(){var tbody=$(Attendance.Settings.LayoutId+" #ZPAtt_userSettingsBody");$(Attendance.Settings.LayoutId+" #ZPAtt_userSettingsBody").empty(),$(Attendance.Settings.LayoutId+" #ZPAtt_UserSett_emptyRecInfo").fadeOut(200),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettingsDetails").show().parent().show();var typeVal=$(Attendance.Settings.LayoutId+" #ZPAtt_userSett_type").val();"/zp"===ZPeople.CONTEXT&&Layout.Page.container.find("#ZPAtt_Sett_filter").hasClass("ZPFilsel")&&Attendance.Settings.toggleFilter();var userSettingsDetails=Attendance.Settings.userSettings;Attendance.Settings.USettings.settMappedShiftList=[],Attendance.Settings.USettings.settMappedEnoList=[];var consTR=function(rdata,i){if("default"!==i){var enoList=rdata.erecnoList,shiftList=rdata.shiftIdList,type="";if(0!==shiftList.length?(type=ZPI18N.getString("zp.shifts"),Attendance.Settings.USettings.settMappedShiftList=Attendance.Settings.USettings.settMappedShiftList.concat(shiftList)):0!==enoList.length&&(type=ZPI18N.getString("zp.users"),Attendance.Settings.USettings.settMappedEnoList=Attendance.Settings.USettings.settMappedEnoList.concat(enoList)),""===type&&"0"!==typeVal||"1"===typeVal&&type===ZPI18N.getString("zp.users")||"2"===typeVal&&type===ZPI18N.getString("zp.shifts"))return;var tHrsCalculatiuon=ZPI18N.getString("zp.excludeinter"),webCheckinOut=ZPI18N.getString("zp.enabled");1===rdata.Att_Intervels&&(tHrsCalculatiuon=ZPI18N.getString("zp.includeinter")),1===rdata.Att_AllowUIEntry&&(webCheckinOut=ZPI18N.getString("zp.disabled"));var tr="<tr class='ZPLRow'>";tr+="<td class='CP' onclick=Attendance.Settings.toggleAddNewPopUp(true,'"+i+"')>";var name="";return rdata.Att_settingsName&&(name=rdata.Att_settingsName),tr+="<span class='ellipsis W150'>"+$("<div/>").text(name).html()+"</span></td>",tr+="<td>"+type+"</td>",tr+="<td>"+tHrsCalculatiuon+"</td><td>"+webCheckinOut+"</td>",tr+="<td class='text-right P0I'><div id='ZPAtt_USett_delAction' class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_USett_delConfirm','table-responsive')></i><i class='IC-pen S14 gry FR MR15 CP' onclick=Attendance.Settings.toggleAddNewPopUp(true,'"+i+"')></i></div>",tr+="<div style='display:none' id='ZPAtt_USett_delConfirm'>",tr+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_USett_delAction','table-responsive')>"+ZPI18N.getString("zp.cancel")+"</button>",tr+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=Attendance.Settings.USettings.deleteUSettings(this,'"+i+"')>"+ZPI18N.getString("zp.confirm")+"</button></div>",tr+="</td><td></td></tr>"}},sortedId=Attendance.Settings.sortedIdList;if(sortedId)for(var i in sortedId){var rdata=userSettingsDetails[sortedId[i]];tbody.append(consTR(rdata,sortedId[i]))}else for(var i in userSettingsDetails){rdata=userSettingsDetails[i];tbody.append(consTR(rdata,i))}if(0===tbody[0].children.length){$(Attendance.Settings.LayoutId+" #ZPAtt_UserSett_emptyRecInfo").fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettingsDetails").parent().hide();var empImg=Layout.Page.container.find("#ZPAtt_UserSett_emptyRecInfo i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-set-user",empImg)}else $(Attendance.Settings.LayoutId+" #ZPAtt_userSettings").attr("class","Scrcont section");Attendance.toggleLoadingDiv(!0),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettingsDetails").parent().hasClass("tabcont")||ZPView.handleTablePosition()},deleteUSettings:function(obj,settingsId){var param={mode:"deleteSettings",conreqcsr:csrfToken};param.settingsId=settingsId,$.post("/AttendanceSettingsAction.zp",param,function(rdata){if(!rdata.error){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.settingsdeleted"));var uSett=Attendance.Settings.userSettings[settingsId],uSettEno=uSett.erecnoList,uSettShift=uSett.shiftIdList;uSettEno&&uSettEno.filter(function(eno){var index=Attendance.Settings.USettings.settMappedEnoList.indexOf(eno);-1!==index&&Attendance.Settings.USettings.settMappedEnoList.splice(index,1)}),uSettShift&&uSettShift.filter(function(sId){var index=Attendance.Settings.USettings.settMappedShiftList.indexOf(sId);-1!==index&&Attendance.Settings.USettings.settMappedShiftList.splice(index,1)}),delete Attendance.Settings.userSettings[settingsId],$(obj.parentNode.parentNode.parentNode).fadeOut("fast",function(){if($(obj.parentNode.parentNode.parentNode).remove(),1===Object.keys(Attendance.Settings.userSettings).length){$(Attendance.Settings.LayoutId+" #ZPAtt_UserSett_emptyRecInfo").show(),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettingsDetails").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_userSettings").removeClass("section");var empImg=Layout.Page.container.find("#ZPAtt_UserSett_emptyRecInfo i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-set-user",empImg)}})}})}},Attendance.Settings.Mapper={mapperList:{},MapIdStartIndex:0,getUserMapIdOnScroll:function(){Attendance.Settings.Mapper.MapIdStartIndex+=50,Attendance.Settings.Mapper.getUserMapIdList(!0)},getUserMapIdList:function(isScroll){var param={mode:"getUserMapIdList",conreqcsr:csrfToken,getMapper:!0};isScroll&&(param.startIndex=Attendance.Settings.Mapper.MapIdStartIndex+1),$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqEmpSort").hasClass("sort")||(param.isEmpSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqEmpSort").hasClass("sort-u")),$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqIdSort").hasClass("sort")||(param.isIdSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqIdSort").hasClass("sort-u")),Attendance.toggleLoadingDiv(!1,$(Attendance.Settings.LayoutId+" #ZPAtt_userIdMapping"),$(Attendance.Settings.LayoutId+" #ZPAtt_UIdMap_emptyRecInfo")),$.post("/AttendanceSettingsAction.zp",param,function(rdata){50===rdata.mapperlist.length&&ZPeople.FireScroll.reset(),Attendance.Settings.Mapper.conMapperList(rdata.mapperlist,isScroll)})},conMapperList:function(mlist,isScroll){var tbody=$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetailsBody");isScroll||tbody.empty();var consTR=function(data){Attendance.Settings.Mapper.mapperList[data.usermapid]=data.mapid;var tr="<tr id="+data.usermapid+" class='ZPLRow'>";return tr+="<td><img class='FL' src="+data.empPhoto+">",tr+="<div class='ZPusrName'><span class='ellipsis W300'><b>"+data.empid+"</b>"+data.empname+"</span></div></td>",tr+="<td>"+$("<div/>").text(data.mapid).html()+"</td>",tr+="<td class='text-right P0I'><div id='ZPAtt_MapperID_delAction' class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_MapperID_Confirm','table-responsive')></i><i class='IC-pen S14 gry FR MR15 CP' onclick=Attendance.Settings.Mapper.showEditMapper(this)></i></div>",tr+="<div style='display:none' id='ZPAtt_MapperID_Confirm' class='text-right P0I'>",tr+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_MapperID_delAction','table-responsive')>"+ZPI18N.getString("zp.cancel")+"</button>",tr+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=Attendance.Settings.Mapper.deleteMapper(this)>"+ZPI18N.getString("zp.confirm")+"</button></div>",(tr+="</td><td></td></tr>").data=data,tr};for(var i in mlist)tbody.append(consTR(mlist[i]));if(0===$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetailsBody tr").length){$(Attendance.Settings.LayoutId+" #ZPAtt_UIdMap_emptyRecInfo").fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetails").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdMapping").removeClass("section");var empImg=Layout.Page.container.find("#ZPAtt_UIdMap_emptyRecInfo i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-set-userid",empImg)}else $(Attendance.Settings.LayoutId+" #ZPAtt_UIdMap_emptyRecInfo").fadeOut(200),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetails").parent().show(),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdMapping").attr("class","Scrcont section");Attendance.toggleLoadingDiv(!0),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetails").parent().hasClass("tabcont")||ZPView.handleTablePosition()},addMapper:function(){var eId=$(Attendance.Settings.LayoutId+" #ZPAtt_userIdMappingEmpName").val(),mId=$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").val().trim();if("0"!==eId&&null!==eId){if(""===mId)return $(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").next().html(ZPI18N.getString("zp.entermapperid")),void $(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").on("focus",function(){$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").next().html("")});var param={mode:"addMapperId",conreqcsr:csrfToken};Attendance.Settings.Mapper.MapIdConfigured&&(param.mode="editMapper"),$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqIdSort").hasClass("sort")||(param.isIdSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqIdSort").hasClass("sort-u")),$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqEmpSort").hasClass("sort")||(param.isEmpSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqEmpSort").hasClass("sort-u")),param.erecno=eId,param.mapid=mId,param.getMapper=!0,Layout.Page.container.find("#ZPAtt_sNewPopupRecSave").prop("disabled",!0),$.post("/AttendanceSettingsAction.zp",param,function(rdata){if(Layout.Page.container.find("#ZPAtt_sNewPopupRecSave").prop("disabled",!1),null!=rdata.fail){var msg=ZPI18N.getString("zp.importduplicateuserid");2==rdata.fail&&(msg=ZPI18N.getString("zp.importduplicateempid")),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdMappingEmpName").next().html(""),$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").next().html(msg)}else rdata.mapperlist&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.useridmapped")),$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetailsBody").empty(),Attendance.Settings.Mapper.MapIdStartIndex=0,Attendance.Settings.Mapper.conMapperList(rdata.mapperlist),ZPeople.FireScroll.reset(),Attendance.Settings.toggleAddNewPopUp())})}else $(Attendance.Settings.LayoutId+" #ZPAtt_userIdMappingEmpName").next().html(ZPI18N.getString("zp.selectusername"))},showEditMapper:function(obj){if($(Attendance.Settings.LayoutId+" #ZPAtt_mapperEditinput")[0]){var mid=Attendance.Settings.Mapper.mapperList[$(Attendance.Settings.LayoutId+" #ZPAtt_mapperEditinput")[0].parentNode.parentNode.id];$(Attendance.Settings.LayoutId+" #ZPAtt_mapperEditinput").parent().text(mid)}var tdobj=$(obj.parentNode.parentNode).prev()[0];tdobj.innerHTML="";tdobj.innerHTML="<input type='text' id='ZPAtt_mapperEditinput' class='form-control' style='width:250px;height:27px'/>",$(Attendance.Settings.LayoutId+" #ZPAtt_mapperEditinput").val(Attendance.Settings.Mapper.mapperList[obj.parentNode.parentNode.parentNode.id]),$(Attendance.Settings.LayoutId+" #ZPAtt_mapperEditinput").on("keyup",function(event){Attendance.Settings.Mapper.editMapper(this,event)}),$(Attendance.Settings.LayoutId+" #ZPAtt_mapperEditinput").on("focus",function(){$(Attendance.Settings.LayoutId+" #ZPAtt_mapperEditinput").select()}),$(Attendance.Settings.LayoutId+" #ZPAtt_mapperEditinput").trigger("focus")},editMapper:function(element,event){if(void 0===event.keyCode||27!==event.keyCode){if(void 0===event.keyCode||13===event.keyCode)if(element.value.trim()!==Attendance.Settings.Mapper.mapperList[element.parentNode.parentNode.id]&&""!==element.value.trim()){var param={mode:"editMapper",conreqcsr:csrfToken,usermapid:element.parentNode.parentNode.id,getMapper:!0};param.mapid=element.value.trim(),$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqIdSort").hasClass("sort")||(param.isIdSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqIdSort").hasClass("sort-u")),$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqEmpSort").hasClass("sort")||(param.isEmpSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqEmpSort").hasClass("sort-u")),$.post("/AttendanceSettingsAction.zp",param,function(rdata){if("success"===rdata.msg)ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.useridmapped")),Attendance.Settings.Mapper.conMapperList(rdata.mapperlist);else{var msg=ZPI18N.getString("zp.duplicateuserid");2==rdata.fail&&(msg=ZPI18N.getString("zp.duplicateid")),ZPeople.Message.showFailureMsg(msg),$(element.parentNode).text(Attendance.Settings.Mapper.mapperList[element.parentNode.parentNode.id])}})}else $(element.parentNode).text(Attendance.Settings.Mapper.mapperList[element.parentNode.parentNode.id])}else $(element.parentNode).text(Attendance.Settings.Mapper.mapperList[element.parentNode.parentNode.id])},getOldConfMapper:function(){var inpVal=$(Attendance.Settings.LayoutId+" #ZPAtt_userIdMappingEmpName").val().trim();if($(Attendance.Settings.LayoutId+" #ZPAtt_userIdMappingEmpName").next().html(""),$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").val(""),$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").next().html(""),Attendance.Settings.Mapper.MapIdConfigured=!1,"0"!==inpVal){var param={mode:"getUserMapIdList",conreqcsr:csrfToken,eno:inpVal};$.post("/AttendanceSettingsAction.zp",param,function(rdata){rdata.mapperDetails.mapId&&($(Attendance.Settings.LayoutId+" #ZPAtt_userIdMappingEmpName").next().text(ZPI18N.getString("zp.mapperidfound")),$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").val(rdata.mapperDetails.mapId),$(Attendance.Settings.LayoutId+" #ZPAtt_newMapperId").trigger("focus"),Attendance.Settings.Mapper.MapIdConfigured=!0)})}},deleteMapper:function(obj){var row=obj.parentNode.parentNode.parentNode,param={mode:"deleteMapper",conreqcsr:csrfToken,usermapid:row.id,getMapper:!0};$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqIdSort").hasClass("sort")||(param.isIdSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqIdSort").hasClass("sort-u")),$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqEmpSort").hasClass("sort")||(param.isEmpSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_userId_myReqEmpSort").hasClass("sort-u")),$.post("/AttendanceSettingsAction.zp",param,function(rdata){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.mappeduseriddeleted")),Attendance.Settings.Mapper.mapperList[row.id]=null,$(row).fadeOut("fast",function(){$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetailsBody").empty(),Attendance.Settings.Mapper.MapIdStartIndex=0,Attendance.Settings.Mapper.conMapperList(rdata.mapperlist),ZPeople.FireScroll.reset()})})},showUmidImport:function(){$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccMsg").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccvalues").hide(),$(Attendance.Settings.LayoutId+" #umidimportErrDiv").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_import").parent().parent().removeAttr("class"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_import").fadeIn(300),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_impEx").fadeIn(300),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importFileConf").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMap").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInput").val(""),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importDesc").after($(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInputCont").show()),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInputCont span").text(ZPI18N.getString("zp.importfile")),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInputCont").attr("class","btn btn-primary ZPbtnDefault"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importNext").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importPrevious").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importHeader li").removeAttr("class"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importHeader li").first().attr("class","active"),Layout.Page.container.find("#ZPAtt_settUIdMap_importPopup .modal-body").find("#zp_page_loading").remove(),Layout.Page.container.find("#ZPAtt_settUIdMap_importPopup .modal-body").children().show(),Attendance.Settings.Mapper.getUmidPendingImport()},onInputChange:function(){var fileName=$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInput").val();$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importProgress").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importProgress").next().show(),fileName=fileName.replace("C:\\fakepath\\",""),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importFName").text(fileName),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccMsg").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccvalues").hide(),$(Attendance.Settings.LayoutId+" #umidimportErrDiv").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importProgress").after($(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInputCont")),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInputCont span").text(ZPI18N.getString("zp.removeandnew")),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInputCont").attr("class","btn btn-default ZPbtnDefault");var extn=fileName.split(".").pop();"xls"===extn||"csv"===extn?($(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importFName").next().attr("class","IC-rou-tik ML5 filetck"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importNext").fadeIn(300),Layout.Page.container.find("#ZPAtt_settUIdMap_importNext").attr("disabled",!1),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importNext").off("click").on("click",function(){Attendance.Settings.Mapper.submitImport()})):($(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importFName").next().attr("class","IC-r-close ML5 PR S18 red"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importNext").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInput").val(""),""===$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importFName").text()&&$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importFName").text(ZPI18N.getString("zp.choosefile"))),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_import").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_impEx").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importFileConf").fadeIn(300),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMap").hide()},getUmidPendingImport:function(){var pendingMsg=$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMsg");pendingMsg.parent().hide(),$.post("/AttendanceSettingsAction.zp",{mode:"getUmidPendingImportInfo",conreqcsr:csrfToken},function(rdata){"empty"===rdata.tableInfo.tableHeaders?(pendingMsg.off("click"),pendingMsg.html(""),pendingMsg.parent().hide()):(pendingMsg.attr("class","blu CP"),pendingMsg.off("click").on("click",function(){Attendance.Settings.Mapper.showUmidMapping(rdata.tableInfo)}),pendingMsg.html(rdata.tableInfo.recordCount+" "+ZPI18N.getString("zp.recordspending")),pendingMsg.parent().fadeIn(300))})},submitImport:function(){$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importNext").off("click"),Attendance.Settings.Mapper.ProgressBarWidth=0,$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importProgress").next().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importProgress div").width(Attendance.Settings.Mapper.ProgressBarWidth+"%").parent().show(),Attendance.Settings.Mapper.showProgress();var form=$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInput")[0].form;""!==$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importInput").val()&&(Layout.Page.container.find("#ZPAtt_settUIdMap_importNext").attr("disabled",!0),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importFormCsrf").val(csrfToken),form.action="AttendanceImport.zp",form.submit())},ProgressBarWidth:0,showProgress:function(){$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importProgress div").width(Attendance.Settings.Mapper.ProgressBarWidth+"%"),Attendance.Settings.Mapper.ProgressBarWidth+=2,Attendance.Settings.Mapper.ProgressBarWidth<=100&&setTimeout(Attendance.Settings.Mapper.showProgress,1)},showUmidMapping:function(obj){Layout.Page.container.find("#ZPAtt_settUIdMap_importNext").attr("disabled",!1),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_import").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_impEx").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importFileConf").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMap").fadeIn(300),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importPrevious").fadeIn(300),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importNext").fadeIn(300),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importHeader li:eq(1)").attr("class","active"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importHeader li:eq(2)").attr("class","active"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importNext").off("click").on("click",function(){Attendance.Settings.Mapper.submitUmidMapping()});var rArray=obj.tableHeaders,res="<option value='None' selected='selected'>-- "+ZPI18N.getString("zp.select")+" --</option>";for(var i in rArray)res+="<option value='"+i+"'>"+rArray[i]+"</option>";$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importIds select").html(res),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMapId select").html(res),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMsg").off("click"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMsg").attr("class","blu"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMsg").parent().fadeIn(300),obj.error&&"rowExceededLimit"===obj.error?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.performanceImportcntexceederror"),!0),Layout.Page.container.find("#ZPAtt_settUIdMap_importNext").attr("disabled",!0),Layout.Page.container.find("#ZPAtt_settUIdMap_importMsg").text("")):void 0!==obj.recordCount?$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMsg").text(obj.recordCount+" "+ZPI18N.getString("zp.recordsfound")):$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMsg").text("0 "+ZPI18N.getString("zp.recordsfound")),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMap select").select2()},submitUmidMapping:function(){var si_Id=$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importIds select")[0].selectedIndex,si_userMapId=$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMapId select")[0].selectedIndex;if(0!==si_Id&&0!==si_userMapId){var param={mode:"umidImportMapping",mailId:si_Id-1,mapId:si_userMapId-1,conreqcsr:csrfToken,getMapper:!0};$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importNext").off("click"),Layout.Page.container.find("#ZPAtt_settUIdMap_importNext").attr("disabled",!0),Layout.Page.container.find("#ZPAtt_settUIdMap_importPopup .modal-body").children().hide(),Layout.Page.container.find("#ZPAtt_settUIdMap_importPopup .modal-body").append(ZPeople.LOADING_HTML),$.post("/AttendanceSettingsAction.zp",param,function(resultData){if(Layout.Page.container.find("#ZPAtt_settUIdMap_importPopup .modal-body").find("#zp_page_loading").remove(),Layout.Page.container.find("#ZPAtt_settUIdMap_importPopup .modal-body").children().show(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importHeader li:eq(3)").attr("class","active"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importHeader li").last().attr("class","active"),resultData.msg)if(resultData.msg.filesizeerror)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.rowerror")),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importPopup").modal("hide");else{$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_import").parent().parent().attr("class","ZPImfrm ZPRecList"),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMap").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importMsg").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccMsg").fadeIn(300),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccvalues").fadeIn(300),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccvalues span")[0].innerHTML=resultData.msg.totalCount,$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccvalues span")[1].innerHTML=resultData.msg.successCount,$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccvalues span")[2].innerHTML=resultData.msg.skippedCount,$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importSuccvalues span")[3].innerHTML=resultData.msg.skippedCount;var errorbody="",errData=resultData.msg.errorData,errorlen=errData.length;for(var i in errData){var errormsg=errData[i].split(":");errorbody+="<tr><td>"+errormsg[0]+" : </td><td>"+errormsg[1]+"</td></tr>"}errorlen>0&&($(Attendance.Settings.LayoutId+" #umidimportErrDiv").show(),$(Attendance.Settings.LayoutId+" #umidimportErrDiv").find("tbody").html(errorbody)),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importPrevious").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_settUIdMap_importNext").hide()}else if(resultData.fail||resultData.error){var failMsg=resultData.fail?resultData.fail:ZPI18N.getString("zp.unabletoprocess");return ZPeople.Message.showFailureMsg(failMsg),Layout.Page.container.find("#ZPAtt_settUIdMap_importNext").attr("disabled",!1),void Layout.Page.container.find("#ZPAtt_settUIdMap_importNext").off("click").on("click",function(){Attendance.Settings.Mapper.submitUmidMapping()})}$(Attendance.Settings.LayoutId+" #ZPAtt_userIdDetailsBody").empty(),Attendance.Settings.Mapper.MapIdStartIndex=0,ZPeople.FireScroll.reset(),Attendance.Settings.Mapper.conMapperList(resultData.mapperlist)})}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.choosereqcolumns"))}},Attendance.Settings.Scheduler={scheduleList:null,tabName:null,showScheduleList:function(obj){$(Attendance.Settings.LayoutId+" #ZPAtt_absSched_execute").on("hidden.bs.modal",function(){$(Attendance.Settings.LayoutId+" #ZPAtt_absSch_executeDate").removeAttr("scheduleid"),$(Attendance.Settings.LayoutId+" #ZPAtt_absSch_executeDate").val("")}),obj&&obj.parentNode&&($(obj).parent().find(".active").removeAttr("class"),$(obj).attr("class","active"),0===$(obj).index()?Attendance.Settings.Scheduler.tabName="absSchedule":Attendance.Settings.Scheduler.tabName="compOffSchedule");var params={mode:"getAbsentSchedule",conreqcsr:csrfToken};$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler_myReqNameSort").hasClass("sort")||(params.isScheduleSortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler_myReqNameSort").hasClass("sort-u")),$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler_myReqDaySort").hasClass("sort")||(params.isDaySortAsc=$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler_myReqDaySort").hasClass("sort-u")),Attendance.toggleLoadingDiv(!1,$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler"),$(Attendance.Settings.LayoutId+" #ZPAtt_absSched_emptyRecInfo")),$.post("/AttendanceSettingsAction.zp",params,function(resultData){Attendance.Settings.Scheduler.scheduleList=resultData,Attendance.Settings.Scheduler.consScheduleList()})},consScheduleList:function(){var resultData=Attendance.Settings.Scheduler.scheduleList;if($(Attendance.Settings.LayoutId+" #ZPAtt_absentSchedulerDetBody").html(""),0==resultData.list.length){$(Attendance.Settings.LayoutId+" #ZPAtt_absSched_emptyRecInfo").fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_absentSchedulerDet").parent().hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler").removeClass("section");var empImg=Layout.Page.container.find("#ZPAtt_absSched_emptyRecInfo i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-schlr",empImg)}else $(Attendance.Settings.LayoutId+" #ZPAtt_absSched_emptyRecInfo").hide(),$(Attendance.Settings.LayoutId+" #ZPAtt_absentSchedulerDet").parent().fadeIn(200),$(Attendance.Settings.LayoutId+" #ZPAtt_absentScheduler").attr("class","Scrcont section");$.each(resultData.list,function(index,data){var tr="<tr class='ZPLRow'>";tr+='<td class="CP" onclick="Attendance.Settings.toggleAddNewPopUp(true);Timetracker.schedulerReminderSettings.showAutoScheduleModify(this,undefined,\''+data.type+"')\">"+data.scheduleName+"</td>",tr+="<td>"+Calendar.minstotime(data.time%1440)+"</td>",tr+="<td>"+ZPI18N.getString("zp.before")+" "+parseInt(data.time/24/60)+" "+ZPI18N.getString("zp.day")+"</td>",tr+="<td class='text-right P0I'><div id='ZPAtt_AbsSchedule_delAction' class='over-display'><i class='IC-delete S14 gry FR MR15 CP' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_AbsSchedule_Confirm','table-responsive');></i><i class='IC-pen S14 gry FR MR15 CP' id=edit"+data.scheduleId+" onclick=Attendance.Settings.toggleAddNewPopUp(true);Timetracker.schedulerReminderSettings.showAutoScheduleModify(this,1,"+data.type+");></i>",tr+="<i class='IC-play S14 gry FR MR15 CP' data-toggle='modal' data-target='#ZPAtt_absSched_execute' onclick=$(Attendance.Settings.LayoutId).find('#ZPAtt_absSch_executeDate').attr('scheduleid','"+data.scheduleId+"')></i></div>",tr+="<div style='display:none' id='ZPAtt_AbsSchedule_Confirm' class='text-right P0I'>",tr+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_AbsSchedule_delAction','table-responsive')>"+ZPI18N.getString("zp.cancel")+"</button>",tr+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=Attendance.Settings.Scheduler.deleteAutoSchedule('"+data.scheduleId+"');>"+ZPI18N.getString("zp.confirm")+"</button></div>",tr+="</td><td></td></tr>",(tr=$(tr)).data(data),$(Attendance.Settings.LayoutId+" #ZPAtt_absentSchedulerDetBody").append(tr)}),Attendance.toggleLoadingDiv(!0),$(Attendance.Settings.LayoutId+" #ZPAtt_absentSchedulerDet").parent().hasClass("tabcont")||ZPView.handleTablePosition()},selectValChange:function(){-1===Layout.Page.pageId.indexOf("shiftrotation")?"0"===$(Attendance.Settings.LayoutId+" #schDate").select2("val")?($(Attendance.Settings.LayoutId+" #beforeCont").show(),$(Attendance.Settings.LayoutId+" #scheduleDateCont").html(ZPI18N.getString("zp.day"))):($(Attendance.Settings.LayoutId+" #beforeCont").hide(),$(Attendance.Settings.LayoutId+" #scheduleDateCont").html(ZPI18N.getString("zp.daybefore",new Array("")))):AttendanceShift.shiftRotselValChange()},deleteAutoSchedule:function(scheduleId){$.post("/AttendanceSettingsAction.zp",{mode:"deleteAbsentSchedule",scheduleId:scheduleId,conreqcsr:csrfToken},function(){Attendance.Settings.Scheduler.showScheduleList()})},executeNow:function(){var schDate=$(Attendance.Settings.LayoutId+" #ZPAtt_absSch_executeDate").val(),schid=$(Attendance.Settings.LayoutId+" #ZPAtt_absSch_executeDate").attr("scheduleid");if(""!==schDate){if(""!==schid&&schid){$(Attendance.Settings.LayoutId+" #ZPAtt_absSched_execute").find(".btn-primary").attr("disabled","disabled");var param={mode:"executeAttSchedule",scheduleId:schid,scheduleDate:schDate,conreqcsr:csrfToken};"compOffSchedule"===Attendance.Settings.Scheduler.tabName?param.sch_type=4:param.sch_type=3,$.post("/AttendanceSettingsAction.zp",param,function(rdata){$(Attendance.Settings.LayoutId+" #ZPAtt_absSched_execute").find(".btn-primary").removeAttr("disabled"),"success"===rdata.msg&&($(Attendance.Settings.LayoutId+" #ZPAtt_absSched_execute").modal("hide"),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.manualabswaitingmsg"))),rdata.error&&ZPeople.Message.showFailureMsg(rdata.error)})}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.entervaliddate"))},hideAbsentTemplate:function(){$("#absmailtemplate").modal("hide")}},Attendance.Settings.gracePeriod={leaveObj:{},toggleCustomiseMail:function(ele){$(ele).prop("checked")?Layout.Page.container.find("#customiseTemplateCont").show():Layout.Page.container.find("#customiseTemplateCont").hide()},consGraceMailAlert:function(data){0!==Object.keys(Attendance.Settings.graceData).length&&Layout.Page.container.find("#graceMailToggleCont").removeClass("DN"),1==data.sendGraceMail?Layout.Page.container.find("#graceMailToggle").prop("checked",!0).trigger("change"):Layout.Page.container.find("#graceMailToggle").prop("checked",!1).trigger("change")},consGraceSettView:function(){var graceParent=Layout.Page.container.find("#grace_rule_list");Layout.Page.container.find("#grc_rule").find("#emptyErrMsg").html(""),Layout.Page.container.find("#grc_rule").find("#emptyErrMsg").parent().removeClass("MB10"),Layout.Page.container.find("#grace_rule_list #grc_rule .rotBox .grc_rlBx").remove(),0!==Object.keys(Attendance.Settings.graceData).length?(Layout.Page.container.find("#gracetoggle").prop("checked",!0),Attendance.Settings.gracePeriod.consGracePerSett(graceParent)):(Layout.Page.container.find("#gracetoggle").prop("checked",!1),Layout.Page.container.find("#grace_rule_list #grc_rule #addRule").addClass("DN"))},consGracePerSett:function(graceParId){var graceruleParent=Layout.Page.container.find("#grace_rule_list #grc_rule");if(void 0==Attendance.Settings.graceData.ruleOrder){var ruleOrder=[];$.each(Attendance.Settings.graceData,function(index,value){ruleOrder.push(index)}),Attendance.Settings.graceData.ruleOrder=ruleOrder}$.each(Attendance.Settings.graceData.ruleOrder,function(index,value){var graceRule=Attendance.Settings.graceData[value];Attendance.Settings.gracePeriod.constructGraceRotBox();var set=0;"In"===value?(graceruleParent.find("#grc_rlBx_"+(index+1)).find("#entryGrace")[0].checked=!0,set=1):"Out"===value?(graceruleParent.find("#grc_rlBx_"+(index+1)).find("#exitGrace")[0].checked=!0,set=2):"Work"===value?graceruleParent.find("#grc_rlBx_"+(index+1)).find("#workGrace")[0].checked=!0:"InOut"===value?(graceruleParent.find("#grc_rlBx_"+(index+1)).find("#entryGrace")[0].checked=!0,graceruleParent.find("#grc_rlBx_"+(index+1)).find("#exitGrace")[0].checked=!0,set=3):"InWork"===value?(graceruleParent.find("#grc_rlBx_"+(index+1)).find("#entryGrace")[0].checked=!0,graceruleParent.find("#grc_rlBx_"+(index+1)).find("#workGrace")[0].checked=!0):"OutWork"===value?(graceruleParent.find("#grc_rlBx_"+(index+1)).find("#exitGrace")[0].checked=!0,graceruleParent.find("#grc_rlBx_"+(index+1)).find("#workGrace")[0].checked=!0):"InOutWork"===value&&(graceruleParent.find("#grc_rlBx_"+(index+1)).find("#entryGrace")[0].checked=!0,graceruleParent.find("#grc_rlBx_"+(index+1)).find("#exitGrace")[0].checked=!0,graceruleParent.find("#grc_rlBx_"+(index+1)).find("#workGrace")[0].checked=!0),Attendance.Settings.gracePeriod.setValuesForGracePeriod(graceruleParent.find("#grc_rlBx_"+(index+1)),graceRule,set,index+1)})},setValuesForGracePeriod:function(grcparent,graceRule,set,ruleCount){var gMode=1;if(1!=set&&3!=set||void 0!==graceRule.rule||(graceRule.Intime=graceRule.time),2!=set&&3!=set||void 0!==graceRule.rule||(graceRule.Outtime=graceRule.time),void 0!==graceRule.Intime){var graceTime=Attendance.disHours(graceRule.Intime,!0);Attendance.Settings.gracePeriod.enableOrDisableAddRule(grcparent.find("#entryGrace"),!1,0),grcparent.find("#InGracetime").timepicker("setTime",graceTime)}if(void 0!==graceRule.Outtime){graceTime=Attendance.disHours(graceRule.Outtime,!0);Attendance.Settings.gracePeriod.enableOrDisableAddRule(grcparent.find("#exitGrace"),!1,0),grcparent.find("#OutGracetime").timepicker("setTime",graceTime)}if(void 0!==graceRule.Worktime){graceTime=Attendance.disHours(graceRule.Worktime,!0);Attendance.Settings.gracePeriod.enableOrDisableAddRule(grcparent.find("#workGrace"),!1,0),grcparent.find("#WorkGracetime").timepicker("setTime",graceTime)}if(1===graceRule.graceMode?(grcparent.find("#graceMul").val(graceRule.allowDays),grcparent.find("#punishMultiplePeriod").select2("val",graceRule.period),grcparent.find("#gmode2").prop("checked",!0),gMode=2):(grcparent.find("#graceAdd").val(graceRule.allowDays),grcparent.find("#punishPeriod").select2("val",graceRule.period),grcparent.find("#gmode1").prop("checked",!0)),Attendance.Settings.gracePeriod.setLeaveNotes(grcparent,graceRule.period,graceRule.allowDays,gMode),grcparent.find("#reduceCount").select2("val",graceRule.redStat),0!=grcparent.find("#leave_table").length){var leaveParent=grcparent.find("#leavetable > tbody > tr");graceRule.leavetype?"string"==typeof graceRule.leavetype?(leaveParent.find("#leave_types_1").select2("val",graceRule.leavetype),Attendance.Settings.gracePeriod.addRemoveStaticAbsent(leaveParent.find("#leave_types_1"))):$.each(graceRule.leavetype,function(index,value){index>0&&Attendance.Settings.gracePeriod.addLeaveRow(grcparent,ruleCount);var leaveParent=grcparent.find("#leavetable > tbody > tr");leaveParent.find("#leave_types_"+(index+1)).select2("val",value),Attendance.Settings.gracePeriod.addRemoveStaticAbsent(leaveParent.find("#leave_types_"+(index+1)))}):(leaveParent.find("#leave_types_1").select2("val","0"),Attendance.Settings.gracePeriod.addRemoveStaticAbsent(leaveParent.find("#leave_types_1")))}},showErrorMsg:function(graceParId,elementId){$(graceParId).find("#"+elementId+"TimeErrMsg").parent().parent().addClass("MB10"),$(graceParId).find("#"+elementId+"TimeErrMsg").html(ZPI18N.getString("zp.emptyerr")),$(Attendance.Settings.LayoutId+" #ZPAtt_addPopup, .modal-body").animate({scrollTop:$(graceParId).position().top+400})},showEmptyErrMsg:function(){Layout.Page.container.find("#grc_rule").is(":visible")&&(Layout.Page.container.find("#grc_rule").find("#emptyErrMsg").addClass("MB10"),Layout.Page.container.find("#grc_rule").find("#emptyErrMsg").html(ZPI18N.getString("zp.graceerr")),$(Attendance.Settings.LayoutId+" #ZPAtt_addPopup, .modal-body").animate({scrollTop:Layout.Page.container.find("#grc_rule").find("#emptyErrMsg").position().top+100}))},resetErrorMsg:function(graceParent){$(graceParent).find("#InTimeErrMsg").html(""),$(graceParent).find("#OutTimeErrMsg").html(""),$(graceParent).find("#WorkTimeErrMsg").html("");for(var j=1;j<=2;j++)$(graceParent).find("#allTimeErrMsg_"+j).html(""),$(graceParent).find("#allTimeErrMsg_"+j).removeClass("ERR zp-sm-offset-4 zp-sm-3")},resetErrors:function(){Layout.Page.container.find("#grc_rule").find("#emptyErrMsg").html(""),Layout.Page.container.find("#grc_rule").find("div").removeClass("MB10");for(var len=Layout.Page.container.find("#grace_rule_list").find(".grc_rlBx").length,i=1;i<=len;i++)Attendance.Settings.gracePeriod.resetErrorMsg(Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+i))},convertTimeToMins:function(graceSetTime){return""!=graceSetTime?60*parseInt(graceSetTime.split(":")[0])+parseInt(graceSetTime.split(":")[1]):""},checkIfEmptyBox:function(graceTime,graceParId,elementId){return""!==graceTime||(Attendance.Settings.gracePeriod.showErrorMsg(graceParId,elementId),!1)},deductionCheck:function(graceParId,allDays,elemId){var errLoc="#allTimeErrMsg_"+elemId,len=Attendance.Settings.gracePeriod.rangeFinder($(graceParId));len=0===len?1:len;var set=1===elemId?$(graceParId).find("#punishPeriod").val():$(graceParId).find("#punishMultiplePeriod").val(),max=0==set?7*len:31*len,errMsg=1===elemId?""===allDays?ZPI18N.getString("zp.emptyerr"):ZPI18N.getString("zp.invalidinput"):ZPI18N.getString("zp.entervalinrange",new Array(1,max));return!(""===allDays||!/^\d+$/.test(allDays)||!(1===elemId||allDays<=max&&allDays>=1))||($(graceParId).find(errLoc).addClass("ERR zp-sm-offset-4 zp-sm-3"),$(graceParId).find(errLoc).html(errMsg),$(Attendance.Settings.LayoutId+" #ZPAtt_addPopup, .modal-body").animate({scrollTop:$(graceParId).position().top+400}),Attendance.Settings.gracePeriod.setLeaveNotes($(graceParId),set,"",elemId),!1)},saveGraceSett:function(elementId,combinedType,graceObj,graceParId){var graceTime="",graceInTime="",graceOutTime="",graceWorkTime="",leaveTypes=[],allDays="",graceMode=0,period="";if($(graceParId).find("#gmode2").is(":checked")?(allDays=$(graceParId).find("#graceMul").val(),period=$(graceParId).find("#punishMultiplePeriod").select2("val"),graceMode=1):$(graceParId).find("#gmode1").is(":checked")&&(allDays=$(graceParId).find("#graceAdd").val(),period=$(graceParId).find("#punishPeriod").select2("val")),!Attendance.Settings.gracePeriod.deductionCheck(graceParId,allDays,graceMode+1))return!1;var graceSetTime="";if(-1==combinedType){if(graceSetTime=$(graceParId).find("#"+elementId+"Gracetime").val().trim(),graceTime=Attendance.Settings.gracePeriod.convertTimeToMins(graceSetTime),!Attendance.Settings.gracePeriod.checkIfEmptyBox(graceTime,graceParId,elementId))return!1;graceObj[elementId+"time"]=graceTime}else{var inTimeEmpty=!0,outTimeEmpty=!0,workTimeEmpty=!0;if(graceSetTime=$(graceParId).find("#InGracetime").val().trim(),graceInTime=Attendance.Settings.gracePeriod.convertTimeToMins(graceSetTime),graceSetTime=$(graceParId).find("#OutGracetime").val().trim(),graceOutTime=Attendance.Settings.gracePeriod.convertTimeToMins(graceSetTime),graceSetTime=$(graceParId).find("#WorkGracetime").val().trim(),graceWorkTime=Attendance.Settings.gracePeriod.convertTimeToMins(graceSetTime),0==combinedType?(graceObj.Intime=graceInTime,graceObj.Outtime=graceOutTime,inTimeEmpty=Attendance.Settings.gracePeriod.checkIfEmptyBox(graceInTime,graceParId,"In"),outTimeEmpty=Attendance.Settings.gracePeriod.checkIfEmptyBox(graceOutTime,graceParId,"Out")):1==combinedType?(graceObj.Intime=graceInTime,graceObj.Worktime=graceWorkTime,inTimeEmpty=Attendance.Settings.gracePeriod.checkIfEmptyBox(graceInTime,graceParId,"In"),workTimeEmpty=Attendance.Settings.gracePeriod.checkIfEmptyBox(graceWorkTime,graceParId,"Work")):2==combinedType?(graceObj.Outtime=graceOutTime,graceObj.Worktime=graceWorkTime,outTimeEmpty=Attendance.Settings.gracePeriod.checkIfEmptyBox(graceOutTime,graceParId,"Out"),workTimeEmpty=Attendance.Settings.gracePeriod.checkIfEmptyBox(graceWorkTime,graceParId,"Work")):(graceObj.Intime=graceInTime,graceObj.Outtime=graceOutTime,graceObj.Worktime=graceWorkTime,inTimeEmpty=Attendance.Settings.gracePeriod.checkIfEmptyBox(graceInTime,graceParId,"In"),outTimeEmpty=Attendance.Settings.gracePeriod.checkIfEmptyBox(graceOutTime,graceParId,"Out"),workTimeEmpty=Attendance.Settings.gracePeriod.checkIfEmptyBox(graceWorkTime,graceParId,"Work")),!inTimeEmpty||!outTimeEmpty||!workTimeEmpty)return!1}return graceObj.allowDays=allDays,graceObj.graceMode=graceMode,graceObj.redStat=$(graceParId).find("#reduceCount").select2("val"),graceObj.period=period,0!=$(graceParId).find("#leave_table").length&&($(graceParId).find("#leavetable > tbody > tr").each(function(index,obj){0!==$(obj).find("select").length&&null!==$(obj).find("select").val()&&leaveTypes.push($(obj).find("select").val())}),0!=leaveTypes.length&&(graceObj.leavetype=leaveTypes)),!0},consGracePerSettParam:function(previouSetts,advaSetts){var graceCritObj={},tempObj={},graceParent=Layout.Page.container.find("#grace_rule_list .grc_rlBx");Attendance.Settings.gracePeriod.resetErrors();var checkboxIds=[],ruleOrder=[],ruleCount=1,loop=!0;return 0==graceParent.find('input[type="checkbox"]').filter(":checked").length?(Attendance.Settings.gracePeriod.showEmptyErrMsg(),loop=!1):graceParent.each(function(index,obj){var combinedSettType=-1,count=$(obj).find('input[type="checkbox"]').filter(":checked").length;if(0!=count){$(obj).find("input:checkbox:checked").each(function(){checkboxIds.push($(this).attr("id"))});var elementId="";if(1===count)tempObj={},elementId="entryGrace"===(element1=checkboxIds.pop())?"In":"exitGrace"===element1?"Out":"Work";else if(2===count){tempObj={};var element1,element2=checkboxIds.pop();"entryGrace"===(element1=checkboxIds.pop())&&"exitGrace"==element2?(elementId="InOut",combinedSettType=0):"entryGrace"===element1&&"workGrace"==element2?(elementId="InWork",combinedSettType=1):"exitGrace"===element1&&"workGrace"==element2&&(elementId="OutWork",combinedSettType=2)}else 3===count&&(tempObj={},combinedSettType=3,elementId="InOutWork");if(!Attendance.Settings.gracePeriod.saveGraceSett(elementId,combinedSettType,tempObj,obj))return loop=!1,!1;if(tempObj.rule=ruleCount,graceCritObj[elementId]=tempObj,ruleOrder.push(elementId),null===previouSetts||void 0===previouSetts[elementId])graceCritObj.ruleOrder=ruleOrder,advaSetts.Att_GracePeriod=graceCritObj;else{var prevObj=previouSetts[elementId];Attendance.Settings.gracePeriod.timeDiff(prevObj,tempObj,combinedSettType,elementId)||tempObj.graceMode!=prevObj.graceMode||tempObj.allowDays!=prevObj.allowDays||tempObj.redStat!=prevObj.redStat||tempObj.period!=prevObj.period||void 0==prevObj.leavetype&&tempObj.leavetype||JSON.stringify(tempObj.leavetype)!=JSON.stringify(prevObj.leavetype)?(graceCritObj.ruleOrder=ruleOrder,advaSetts.Att_GracePeriod=graceCritObj):JSON.stringify(ruleOrder)!==JSON.stringify(previouSetts.ruleOrder)&&(graceCritObj.ruleOrder=ruleOrder,advaSetts.Att_GracePeriod=graceCritObj)}ruleCount++}}),loop},timeDiff:function(prevObj,tempObj,combinedSettType,elementId){if(-1==combinedSettType){var key=elementId.concat("time");return prevObj[key1=void 0==prevObj.time?key:"time"]!=tempObj[key]}key="Intime";var key1="Outtime",key2="Worktime";return 0==combinedSettType?void 0==prevObj.time?prevObj[key]!=tempObj[key]||prevObj[key1]!=tempObj[key1]:prevObj.time!=tempObj[key]||prevObj.time!=tempObj[key1]:1==combinedSettType?void 0==prevObj.time?prevObj[key]!=tempObj[key]||prevObj[key2]!=tempObj[key2]:prevObj.time!=tempObj[key]||prevObj.time!=tempObj[key2]:2==combinedSettType?void 0==prevObj.time?prevObj[key1]!=tempObj[key1]||prevObj[key2]!=tempObj[key2]:prevObj.time!=tempObj[key1]||prevObj.time!=tempObj[key2]:void 0==prevObj.time?prevObj[key]!=tempObj[key]||prevObj[key1]!=tempObj[key1]||prevObj[key2]!=tempObj[key2]:prevObj.time!=tempObj[key]||prevObj.time!=tempObj[key1]||prevObj.time!=tempObj[key2]},consLeaveList:function(leaveList,id,leaveCount){if(leaveList.length>0){var leaveOption="";for(var ltype in leaveList){var leaves=leaveList[ltype];""==leaveOption?leaveOption="<option value="+leaves.LeaveID+" name ="+ltype+">"+leaves[leaves.LeaveID]+"</option>":leaveOption+="<option value="+leaves.LeaveID+" name ="+ltype+">"+leaves[leaves.LeaveID]+"</option>",1==leaveCount&&(Attendance.Settings.gracePeriod.leaveObj[leaves.LeaveID]=leaves[leaves.LeaveID])}leaveOption+="<option value= 0  name ="+leaveList.length+">"+ZPI18N.getString("zp.absent")+"</option>",id.append(leaveOption),Layout.Page.container.find("#grace_rule_list").find("select").select2({minimumResultsForSearch:10}),Attendance.Settings.gracePeriod.leaveObj[0]=ZPI18N.getString("zp.absent"),1!==leaveCount&&(Attendance.Settings.gracePeriod.removeLeaveOption(id),"0"===$(id).parent().parent().parent().find("tr.row:last").find("select option").val()&&Attendance.Settings.gracePeriod.addRemoveStaticAbsent(id))}},removeLeaveOption:function(obj){$(obj).parent().parent().parent().find("tr").each(function(index,id){var selectedvalue=$(id).find("select").val();id,$(id).nextAll().find("select option[value="+selectedvalue+"]").remove(),$(id).prevAll().find("select option[value="+selectedvalue+"]").remove()})},addLeaveOptions:function(parent,obj,newoption){var insertAt=$(obj).parent().find("select").attr("value")-1;if(void 0==newoption){var value=$(obj).parent().find("select").val();newoption="<option value="+value+" name ="+insertAt+">"+Attendance.Settings.gracePeriod.leaveObj[value]+"</option>"}else insertAt=parseInt($(newoption).attr("name"));parent.find("tr").each(function(index,id){var inserted=!1;$(id).find("select option").each(function(index,option){var idx=parseInt($(option).attr("name"));parseInt($(newoption).attr("name"))==idx&&(inserted=!0),!inserted&&idx>insertAt?($(newoption).insertBefore(option),inserted=!0):inserted||null!=option.nextSibling||(inserted=!0,$(newoption).insertAfter(option))})})},toggletooltip:function(obj,show){var id=$(obj).children().attr("id"),alreadyCheckedOrNot=Layout.Page.container.find(".grc_rlBx").find("input:checkbox[id="+id+"]").filter(":checked").length;0==$(obj).children().prop("checked")&&1==alreadyCheckedOrNot&&show?$(obj).tooltip("enable"):(show&&$(obj).children().prop("checked")||!show)&&$(obj).tooltip("disable")},enableOrDisableAddRule:function(obj,errCrt,ruleCount){var id=$(obj).attr("id"),alreadyCheckedOrNot=Layout.Page.container.find(".grc_rlBx").find("input:checkbox[id="+id+"]").filter(":checked").length;if($(obj).parent().parent().find(".errMsg").html(""),$(obj).parent().parent().find("#graceRoundOff").remove(),1==alreadyCheckedOrNot?($(obj).parent().parent().find('input[type="text"]').prop("disabled",!1),Layout.Page.container.find(".grc_rlBx").find("input:checkbox[id="+id+"]").not($(obj)).parent().parent().addClass("fld_dsbl")):0==alreadyCheckedOrNot?($(obj).parent().parent().find('input[type="text"]').attr("disabled","disabled"),Layout.Page.container.find(".grc_rlBx").find("input:checkbox[id="+id+"]").parent().parent().removeClass("fld_dsbl"),$(obj).parent().parent().find('input[type="text"]').timepicker("setTime","")):$(obj).prop("checked",!1),Layout.Page.container.find(".grc_rlBx").find('input[type="checkbox"]').filter(":checked").length>2){Layout.Page.container.find("#grace_rule_list").find("#addRule").addClass("DN");var isRemoved=!1;Layout.Page.container.find("#grace_rule_list").find(".grc_rlBx").each(function(index,obj){0==$(obj).find('input[type="checkbox"]').filter(":checked").length&&(Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+(index+1)).remove(),isRemoved=!0)}),isRemoved&&Attendance.Settings.gracePeriod.reiterateGraceRules(Layout.Page.container.find("#grace_rule_list"),!1,!1,!1)}else Layout.Page.container.find("#grace_rule_list").find(".grc_rlBx").length<3&&Layout.Page.container.find("#grace_rule_list").find("#addRule").removeClass("DN");if(errCrt){var pos=Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+ruleCount).find("#gmode1").is(":checked")?1:2;Attendance.Settings.gracePeriod.showAllowTimeErrMsg(ruleCount,pos)}},deleteLeaveRow:function(obj,rulecount){var parent=Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+rulecount),copiedObj=$(obj).parent();1!==parent.find("#leave_body > tr").length&&($(obj).parent().parent().remove(),parent.find("tr").each(function(index,id){$(id).find("select").attr("id","leave_types_"+(index+1))}),"0"!=parent.find("#leave_body > tr.row:last").find("select").val()&&(parent.find("#leave_body").find(".staticAbs").show(),parent.find("#leave_body").find(".IC-plus-fill").last().show()),1===parent.find("#leave_body > tr").find("select").length&&parent.find("#leave_body").find(".IC-cls-fill").hide(),$(copiedObj).find("option").each(function(index,option){var value=$(option).attr("value"),newoption="<option value ="+value+" name="+$(option).attr("name")+">"+Attendance.Settings.gracePeriod.leaveObj[value]+"</option>";Attendance.Settings.gracePeriod.addLeaveOptions(parent,copiedObj,newoption)}))},addLeaveRow:function(obj,rulecount){var parent=Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+rulecount),length=parent.find("#leave_body > tr").find("select").length;parent.find("#leave_body").find(".IC-cls-fill").show(),parent.find("#leave_body").find(".IC-plus-fill").hide();var trow='<tr class="row"><td class="zp-sm-12" style="border:0" ><select class="W150 ML10" value = '+(length+1)+'  id="leave_types_'+(length+1)+'" onchange="Attendance.Settings.gracePeriod.addRemoveStaticAbsent(this)"></select><i class="IC-cls-fill S14 gry ML10 CP" onclick=Attendance.Settings.gracePeriod.deleteLeaveRow(this,'+rulecount+')></i><i class="IC-plus-fill S14 gry ML5 CP" onclick=Attendance.Settings.gracePeriod.addLeaveRow(this,'+rulecount+")></i></td></tr>";parent.find("#leave_body").find("tr:last").prev().after(trow),Attendance.Settings.gracePeriod.isV2Leave&&Attendance.Settings.gracePeriod.consLeaveList(Attendance.Settings.gracePeriod.leaveList,Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+rulecount).find("#leave_types_"+(length+1)),length+1),Layout.Page.container.find("#grace_rule_list").find("select").select2({minimumResultsForSearch:10})},deleteGraceRules:function(id,ruleCount){var grcBox=$(id).parent(),parent=Layout.Page.container.find("#grace_rule_list"),entry=1==grcBox.find("input:checkbox[id=entryGrace]").filter(":checked").length,exit=1==grcBox.find("input:checkbox[id=exitGrace]").filter(":checked").length,work=1==grcBox.find("input:checkbox[id=workGrace]").filter(":checked").length;grcBox.remove(),Attendance.Settings.gracePeriod.reiterateGraceRules(parent,entry,exit,work),parent.find("#addRule").removeClass("DN"),0==parent.find(".grc_rlBx").length&&(parent.find("#addRule").addClass("DN"),Layout.Page.container.find("#gracetoggle").prop("checked",!1))},reiterateGraceRules:function(parent,entry,exit,work){parent.find(".grc_rlBx").each(function(index,obj){$(obj).attr("id","grc_rlBx_"+(index+1)),$(obj).attr("value",index+1),$(obj).find(".addSelectIcon").attr("onclick","Attendance.Settings.gracePeriod.deleteGraceRules(this,"+(index+1)+")"),$(obj).find(".addSelectIcon").attr("value",index+1),$(obj).find(".IC-cls-fill").attr("onclick","Attendance.Settings.gracePeriod.deleteLeaveRow(this,"+(index+1)+")"),$(obj).find(".IC-plus-fill").attr("onclick","Attendance.Settings.gracePeriod.addLeaveRow(this,"+(index+1)+")"),$(obj).find("#rule").text(ZPI18N.getString("zp.rule")+" "+(index+1)),$(obj).find("#rule").attr("value",index+1),$(obj).find("#entryGrace").attr("onclick","Attendance.Settings.gracePeriod.enableOrDisableAddRule(this, true, "+(index+1)+")"),$(obj).find("#exitGrace").attr("onclick","Attendance.Settings.gracePeriod.enableOrDisableAddRule(this, true, "+(index+1)+")"),$(obj).find("#workGrace").attr("onclick","Attendance.Settings.gracePeriod.enableOrDisableAddRule(this, true, "+(index+1)+")"),$(obj).find("#gmode1").attr("name","deduct "+(index+1)),$(obj).find("#gmode1").attr("onchange","Attendance.Settings.gracePeriod.onRadioValChange("+(index+1)+", 2)"),$(obj).find("#graceAdd").attr("onchange","Attendance.Settings.gracePeriod.showAllowTimeErrMsg("+(index+1)+", 1)"),$(obj).find("#punishPeriod").attr("onchange","Attendance.Settings.gracePeriod.periodChange("+(index+1)+", 1)"),$(obj).find("#gmode2").attr("name","deduct "+(index+1)),$(obj).find("#gmode2").attr("onchange","Attendance.Settings.gracePeriod.onRadioValChange("+(index+1)+", 1)"),$(obj).find("#graceMul").attr("onchange","Attendance.Settings.gracePeriod.showAllowTimeErrMsg("+(index+1)+", 2)"),$(obj).find("#punishMultiplePeriod").attr("onchange","Attendance.Settings.gracePeriod.periodChange("+(index+1)+", 2)"),entry&&$(obj).find("#entry").removeClass("fld_dsbl"),exit&&$(obj).find("#exit").removeClass("fld_dsbl"),work&&$(obj).find("#work").removeClass("fld_dsbl")})},addRuleForGrace:function(){Layout.Page.container.find("#grace_rule_list").find(".grc_rlBx").length<3&&Attendance.Settings.gracePeriod.constructGraceRotBox()},checkFieldDisable:function(newGraceBox){Layout.Page.container.find("#grace_rule_list #grc_rule");Layout.Page.container.find("#grace_rule_list #grc_rule").find("input:checkbox[id=entryGrace]").filter(":checked").length&&$(newGraceBox).find("#entry").addClass("fld_dsbl"),Layout.Page.container.find("#grace_rule_list #grc_rule").find("input:checkbox[id=exitGrace]").filter(":checked").length&&$(newGraceBox).find("#exit").addClass("fld_dsbl"),Layout.Page.container.find("#grace_rule_list #grc_rule").find("input:checkbox[id=workGrace]").filter(":checked").length&&$(newGraceBox).find("#work").addClass("fld_dsbl")},setConsTime:function(id){var graceObj={showMeridian:!1,disableMousewheel:!0,minuteStep:1,defaultTime:""};$(id).find("#InGracetime").timepicker(graceObj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>720&&$(this).timepicker("setTime","12:00")}),$(id).find("#OutGracetime").timepicker(graceObj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>720&&$(this).timepicker("setTime","12:00")}),$(id).find("#WorkGracetime").timepicker(graceObj).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>720&&$(this).timepicker("setTime","12:00")})},consGraceRules:function(id){$(id).prop("checked")?(Layout.Page.container.find("#graceMailToggleCont").removeClass("DN"),0==Layout.Page.container.find("#grace_rule_list").find(".grc_rlBx").length?Attendance.Settings.gracePeriod.constructGraceRotBox():Layout.Page.container.find("#grace_rule_list").find(".grc_rlBx").show(),Layout.Page.container.find("#grace_rule_list").find("#addRule").removeClass("DN")):(Layout.Page.container.find("#graceMailToggleCont").addClass("DN"),Layout.Page.container.find("#grace_rule_list").find(".grc_rlBx").remove(),Layout.Page.container.find("#grace_rule_list").find("#addRule").addClass("DN"))},addRemoveStaticAbsent:function(obj){var selectedValue=$(obj).select2("val"),parent=$(obj).parent().parent().parent();"0"==selectedValue?($(parent).find("tr.row").each(function(index,id){Attendance.Settings.gracePeriod.iterateOptionsForLeave(parent,id)}),$(obj).parent().parent().nextAll(".row").remove(),$(obj).parent().parent().siblings(".staticAbs").hide(),$(obj).parent().parent().find(".IC-plus-fill").hide(),2==parent.find("tr").length&&$(obj).parent().parent().find(".IC-cls-fill").hide()):"0"!==parent.find("tr.row:last").find("select").select2("val")&&($(obj).parent().parent().siblings(".staticAbs").show(),$(obj).parent().parent().parent().find(".IC-plus-fill").last().show(),Attendance.Settings.gracePeriod.iterateOptionsForLeave(parent,obj)),Attendance.Settings.gracePeriod.removeLeaveOption(obj)},iterateOptionsForLeave:function(parent,obj){$(obj).find("option").each(function(index,option){var value=$(option).attr("value"),parent=$(obj).parent().parent().parent(),newoption="<option value ="+value+" name="+$(option).attr("name")+">"+Attendance.Settings.gracePeriod.leaveObj[value]+"</option>";Attendance.Settings.gracePeriod.addLeaveOptions(parent,obj,newoption)})},showAllowTimeErrMsg:function(ruleCount,pos){var parent=Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+ruleCount),allDays="",set="",leaveNotes=0;parent.find("#gmode2").is(":checked")?1===pos?parent.find("#graceAdd").val(""):(allDays=parent.find("#graceMul").val(),set=parent.find("#punishMultiplePeriod").val(),leaveNotes=1):parent.find("#gmode1").is(":checked")&&(2===pos?parent.find("#graceMul").val(""):(allDays=parent.find("#graceAdd").val(),set=parent.find("#punishPeriod").val(),leaveNotes=1)),allDays=Attendance.Settings.gracePeriod.errorDisplay(parent,allDays,pos,set),1===leaveNotes&&Attendance.Settings.gracePeriod.setLeaveNotes(parent,set,allDays,pos)},constructGraceRotBox:function(){var alreadyDefined=Layout.Page.container.find(".grc_rlBx").length+1,graceBody='<div class="RotBox zpnotfy grc_rlBx" value='+alreadyDefined+' id="grc_rlBx_'+alreadyDefined+'"><div class="addSelectIcon" value='+alreadyDefined+" onclick = Attendance.Settings.gracePeriod.deleteGraceRules(this,"+alreadyDefined+')><a class="remove"><i class="IC-remove red CP"></i></a></div>';graceBody+='<h5 class="MB20"><span id="rule" value ='+alreadyDefined+">"+ZPI18N.getString("zp.rule")+" "+alreadyDefined+"</span></h5>",graceBody+='<div class="form-group"><label class="control-label col-sm-4"><span>'+ZPI18N.getString("zp.considerasdeviationwhen")+'</span></label><div class="zp-sm-6"><div class="filbox"><div class="zp-sm-12 P0I" id="entry"><label class="checkbox FL chklbl input" data-toggle="modal" data-tooltip="tooltip" data-placement="bottom"  title="'+ZPI18N.getString("zp.entrytooltip",new Array(""))+'" onmouseover="Attendance.Settings.gracePeriod.toggletooltip(this,true)" onmouseout="Attendance.Settings.gracePeriod.toggletooltip(this,false)"><input type="checkbox" id="entryGrace"  onclick="Attendance.Settings.gracePeriod.enableOrDisableAddRule(this, true, '+alreadyDefined+')"><span>'+ZPI18N.getString("zp.graceentry",new Array(""))+"</span></label>",graceBody+='<div class="zp-sm-6"><span class = "inpt_rel FL"><div class="input-group bootstrap-timepicker timepicker" style="width:100px"><input type="text" class="form-control DIBI" id="InGracetime" onkeyup="Attendance.Settings.maxValForRoundOff(this)" disabled><span class="input-group-addon"><div class="IC-clock gry CP"></div></span></div><div class = "errMsg red" id ="InTimeErrMsg"></div></span><span class="hrsDv">'+ZPI18N.getString("zp.gracehour")+"</span></div></div>",graceBody+='<div class="zp-sm-12 P0I" id="exit"><label class="checkbox FL chklbl input" data-toggle="modal" data-tooltip="tooltip" data-placement="bottom"  title="'+ZPI18N.getString("zp.exittooltip",new Array(""))+'" onmouseover="Attendance.Settings.gracePeriod.toggletooltip(this,true)" onmouseout="Attendance.Settings.gracePeriod.toggletooltip(this,false)""><input type="checkbox" id="exitGrace" onclick="Attendance.Settings.gracePeriod.enableOrDisableAddRule(this, true, '+alreadyDefined+')"><span>'+ZPI18N.getString("zp.graceexit",new Array(""))+"</span></label>",graceBody+='<div class="zp-sm-6"><span class = "inpt_rel FL"><div class="input-group bootstrap-timepicker timepicker" style="width:100px"><input type="text" class="form-control DIBI" id="OutGracetime" onkeyup="Attendance.Settings.maxValForRoundOff(this)" disabled><span class="input-group-addon"><div class="IC-clock gry CP"></div></span></div><div class = "errMsg red" id ="OutTimeErrMsg"></div></span><span class="hrsDv">'+ZPI18N.getString("zp.gracehour")+"</span></div></div>",graceBody+=' <div class="zp-sm-12 P0I" id="work"><label class="checkbox FL chklbl input" data-toggle="modal" data-tooltip="tooltip" data-placement="bottom"  title="'+ZPI18N.getString("zp.worktooltip",new Array(""))+'" onmouseover="Attendance.Settings.gracePeriod.toggletooltip(this,true)" onmouseout="Attendance.Settings.gracePeriod.toggletooltip(this,false)""><input type="checkbox" id="workGrace"  onclick="Attendance.Settings.gracePeriod.enableOrDisableAddRule(this, true, '+alreadyDefined+')"><span>'+ZPI18N.getString("zp.gracework",new Array(""))+"</span></label>",graceBody+='<div class="zp-sm-6"><span class = "inpt_rel FL"><div class="input-group bootstrap-timepicker timepicker" style="width:100px"><input type="text" class="form-control DIBI" id="WorkGracetime" onkeyup="Attendance.Settings.maxValForRoundOff(this)" disabled><span class="input-group-addon"><div class="IC-clock gry CP"></div></span></div><div class = "errMsg red" id ="WorkTimeErrMsg"></div></span><span class="hrsDv">'+ZPI18N.getString("zp.gracehour")+"</span></div></div></div></div></div>",graceBody+='<div class="form-group MT30"><label class="control-label col-sm-4 ">'+ZPI18N.getString("zp.dedwhen")+"</label>",graceBody+='<div class="zp-sm-8 flx-cntr"><label class="radio"><input type="radio" name="deduct '+alreadyDefined+'" id="gmode1" onchange="Attendance.Settings.gracePeriod.onRadioValChange('+alreadyDefined+', 2)"><span>'+ZPI18N.getString("zp.gracedev",new Array(""))+'</span></label><input class="form-control W50" type="text" id="graceAdd" onchange="Attendance.Settings.gracePeriod.showAllowTimeErrMsg('+alreadyDefined+', 1)"><span>'+ZPI18N.getString("zp.graceper")+"</span>",graceBody+='<select class="W100A" id="punishPeriod" onchange="Attendance.Settings.gracePeriod.periodChange('+alreadyDefined+', 1)"><option value="0">'+ZPI18N.getString("zp.sweek")+'</option><option value="1">'+ZPI18N.getString("zp.smonth")+'</option><option value="2">'+ZPI18N.getString("zp.spayperiod")+'</option></select></div><div id ="allTimeErrMsg_1"></div></div>',graceBody+='<div class="form-group"><div class="zp-sm-offset-4 zp-sm-8 flx-cntr"><label class="radio"><input type="radio" name="deduct '+alreadyDefined+'" id="gmode2" onchange="Attendance.Settings.gracePeriod.onRadioValChange('+alreadyDefined+', 1)"><span>'+ZPI18N.getString("zp.gracemultiple",new Array(""))+'</span></label><input class="form-control W50" type="text" id="graceMul" onchange="Attendance.Settings.gracePeriod.showAllowTimeErrMsg('+alreadyDefined+', 2)"><span>'+ZPI18N.getString("zp.ina",new Array(""))+"</span>",graceBody+='<select class="W100A" id="punishMultiplePeriod" onchange="Attendance.Settings.gracePeriod.periodChange('+alreadyDefined+', 2)"><option value="0">'+ZPI18N.getString("zp.sweek")+'</option><option value="1">'+ZPI18N.getString("zp.smonth")+'</option><option value="2">'+ZPI18N.getString("zp.spayperiod")+'</option></select></div><div id ="allTimeErrMsg_2"></div></div>',graceBody+='<div class="form-group" id="leavenotes"><div class="zp-sm-offset-4 zp-sm-8 label-message text-left label-note B0I"><p class="S13" id="note"></p></div></div>',Attendance.Settings.gracePeriod.isV2Leave?(graceBody+='<div class="form-group MT30"><label class="control-label col-sm-4"><span>'+ZPI18N.getString("zp.gracededuct")+'</span></label><div class="zp-sm-8 MB15"><select class="MR10 dayscnt W80" id="reduceCount"><option value="0.5">0.5</option><option value="1">1</option></select><span>'+ZPI18N.getString("zp.graceleave")+'</span></div><div class="zp-sm-6 zp-sm-offset-4" id="leave_table"><table class="table" id="leavetable"><tbody class="filbox" id="leave_body"><tr class="row"><td class="zp-sm-12 ML10" style="border:0" ><select class="W150"  value=1 id="leave_types_1" onchange="Attendance.Settings.gracePeriod.addRemoveStaticAbsent(this)"></select>',graceBody+='<i class="IC-cls-fill S14 gry ML10 CP" onclick=Attendance.Settings.gracePeriod.deleteLeaveRow(this,'+alreadyDefined+') style="display:none"></i><i class="IC-plus-fill S14 gry ML5 CP" onclick=Attendance.Settings.gracePeriod.addLeaveRow(this,'+alreadyDefined+')></i></td></tr><tr class="staticAbs"><td class="zp-sm-12" style="border:0"><input type="text" value='+ZPI18N.getString("zp.absent")+' disabled class="form-control dis_lop"></td></tr></tbody></table>'):graceBody+='<div class="form-group"><label class="control-label col-sm-4"><span>'+ZPI18N.getString("zp.markas",new Array(""))+'</span></label><div class="zp-sm-8 MB15"><select class="MR10 dayscnt W80" id="reduceCount"><option value="0.5">0.5</option><option value="1">1</option></select><span>'+ZPI18N.getString("zp.sdayabsent")+"</span>",graceBody+="</div></div></div>",$(graceBody).insertBefore("#grace_rule_list #grc_rule #emptyErrMsg"),Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+alreadyDefined).find("#gmode1").prop("checked",!0),Attendance.Settings.gracePeriod.setLeaveNotes(Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+alreadyDefined),0,"",1),Attendance.Settings.gracePeriod.isV2Leave&&Attendance.Settings.gracePeriod.consLeaveList(Attendance.Settings.gracePeriod.leaveList,Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+alreadyDefined).find("#leave_types_1"),1),Attendance.Settings.gracePeriod.checkFieldDisable(Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+alreadyDefined)),Layout.Page.container.find("#grace_rule_list").find("select").select2({minimumResultsForSearch:10}),Attendance.Settings.gracePeriod.setConsTime(Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+alreadyDefined)),3==alreadyDefined&&Layout.Page.container.find("#grace_rule_list").find("#addRule").addClass("DN")},onRadioValChange:function(ruleCount,pos){var parent=Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+ruleCount),loc="#allTimeErrMsg_"+pos;parent.find(loc).html(""),parent.find(loc).removeClass("ERR zp-sm-offset-4 zp-sm-3"),parent.find("#gmode2").is(":checked")?parent.find("#graceAdd").val(""):parent.find("#gmode1").is(":checked")&&parent.find("#graceMul").val(""),Attendance.Settings.gracePeriod.setLeaveNotes(parent,0,"",pos)},periodChange:function(ruleCount,pos){var parent=Layout.Page.container.find("#grace_rule_list").find("#grc_rlBx_"+ruleCount),set="",allDays="";if(1===pos&&parent.find("#gmode1").is(":checked"))set=parent.find("#punishPeriod").val(),allDays=parent.find("#graceAdd").val();else{if(2!==pos||!parent.find("#gmode2").is(":checked"))return;set=parent.find("#punishMultiplePeriod").val(),allDays=parent.find("#graceMul").val()}allDays=Attendance.Settings.gracePeriod.errorDisplay(parent,allDays,pos,set),Attendance.Settings.gracePeriod.setLeaveNotes(parent,set,allDays,pos)},errorDisplay:function(parent,allDays,pos,set){var isNum=/^\d+$/.test(allDays),len=Attendance.Settings.gracePeriod.rangeFinder(parent);len=0===len?1:len;var loc="#allTimeErrMsg_"+pos,max=0==set?7*len:31*len,errmsg=1===pos?ZPI18N.getString("zp.invalidinput"):ZPI18N.getString("zp.entervalinrange",new Array(1,max));return""!==allDays&&(!isNum||2===pos&&(allDays<1||allDays>max))?(parent.find(loc).addClass("ERR zp-sm-offset-4 zp-sm-3"),parent.find(loc).html(errmsg),allDays=""):(parent.find(loc).removeClass("ERR zp-sm-offset-4 zp-sm-3"),parent.find(loc).html("")),allDays},setLeaveNotes:function(parent,set,allDays,pos){if(""!==allDays){parent.find("#leavenotes").removeClass("DN");var sel=0==set?ZPI18N.getString("zp.sweek"):1==set?ZPI18N.getString("zp.smonth"):ZPI18N.getString("zp.spayperiod");if(1===pos)parent.find("#note").html(ZPI18N.getString("zp.gracetimenote",new Array(allDays,sel)));else if(2===pos){var exam="";for(i=1;i<4;i++)exam+=i*allDays+",";parent.find("#note").html(ZPI18N.getString("zp.gracemultiplenote",new Array(allDays,sel,exam.substring(0,exam.length-1))))}}else parent.find("#leavenotes").addClass("DN")},rangeFinder:function(parent){var len=0;return parent.find("#entryGrace").is(":checked")&&len++,parent.find("#exitGrace").is(":checked")&&len++,parent.find("#workGrace").is(":checked")&&len++,len},resetTimeValue:function(errLoc){var errGrace="In"===errLoc?"entryGrace":"Out"===errLoc?"exitGrace":"workGrace";Layout.Page.container.find("input:checkbox[id="+errGrace+"]").filter(":checked").parent().next().find("#"+errLoc+"TimeErrMsg").parent().parent().removeClass("MB10"),Layout.Page.container.find("input:checkbox[id="+errGrace+"]").filter(":checked").parent().next().find("#"+errLoc+"TimeErrMsg").html("")}},Attendance.Settings.DefaultPresent={ruleVal:null,settings:null,getAllDefPreRule:function(){if(null===Attendance.Settings.DefaultPresent.settings){Layout.Page.container.popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"bottom",delay:{show:50,hide:50}});var params={mode:"getAllDefaultPresentRule",conreqcsr:csrfToken};Layout.Page.container.find("#ZPAtt_defPreTo_myReqDaySort").hasClass("sort")||(params.isToDateSort=Layout.Page.container.find("#ZPAtt_defPreTo_myReqDaySort").hasClass("sort-u")),Layout.Page.container.find("#ZPAtt_defPreFrom_myReqDaySort").hasClass("sort")||(params.isFromDateSort=Layout.Page.container.find("#ZPAtt_defPreFrom_myReqDaySort").hasClass("sort-u")),Layout.Page.container.find("#ZPAtt_defPre_myReqNameSort").hasClass("sort")||(params.isNameSort=Layout.Page.container.find("#ZPAtt_defPre_myReqNameSort").hasClass("sort-u")),$.post("/AttendanceSettingsAction.zp",params,function(rdata){rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")),Attendance.Settings.DefaultPresent.settings=rdata.list,Attendance.Settings.DefaultPresent.constructSettings()})}else Attendance.Settings.DefaultPresent.constructSettings()},constructSettings:function(){var settings=Attendance.Settings.DefaultPresent.settings,defPreCont=Layout.Page.container.find("#ZPAtt_Sett_DefPre"),emptyDiv=defPreCont.find("#ZPAtt_SettDefPre_emptyRecInfo"),defPreTable=defPreCont.find("#ZPAtt_DefPre_Table"),setLength=settings.length;if(0===setLength){var empImg=emptyDiv.find("i").eq(0);0===empImg.children().length&&Attendance.noDataImg(8,"CR-at-set-user",empImg),emptyDiv.show(),defPreTable.hide()}else{emptyDiv.hide();var tbody=defPreTable.find("#ZPAtt_DefPre_TBoby");tbody.empty();for(var html="",index=0;index<setLength;index++){var currSet=settings[index];html+="<tr class='ZPLRow' id='"+currSet.settId+"'><td></td><td>"+currSet.groupName+"</td><td>"+currSet.fromDate,html+="</td><td>"+currSet.toDate+"</td><td class='POI'> <div class='over-display FR' id='ZPAtt_DefPreEditDelDiv'>",html+="<i class='IC-pen S14 gry MR15 CP' onclick='Attendance.Settings.DefaultPresent.editDefPreSet(this);'></i>",html+="<i class='IC-delete S14 gry MR15 CP' id='ZPAtt_DefPreDelBut' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_DefPreDel_Confirm','table-responsive');></i></div>",html+="<div style='display:none' id='ZPAtt_DefPreDel_Confirm' class='POI'>",html+="<button class='btn btn-default btn-sm FR' type='button' onclick=Attendance.deleteConfirmMsg(this,'ZPAtt_DefPreEditDelDiv','table-responsive');>"+ZPI18N.getString("zp.cancel")+"</button>",html+="<button class='btn btn-danger btn-sm FR MR10' type='button' onclick=Attendance.Settings.DefaultPresent.delDefPreSet(this);>"+ZPI18N.getString("zp.confirm")+"</button></div>",html+="</td><td></td></tr>"}tbody.append(html),defPreTable.show()}},deleteConfirmMsg:function(obj){Attendance.deleteConfirmMsg(obj,"ZPAtt_DefPreDelBut","table-responsive"),$(obj).closest("tr td:last-child").children().eq(0).show()},editDefPreSet:function(obj){Attendance.Settings.DefaultPresent.toggleAddNewPopUp(Attendance.Settings.DefaultPresent.settings[$(obj).closest("tr").index()])},delDefPreSet:function(obj){var params={mode:"deleteDefaultPresentSett",conreqcsr:csrfToken};params.scheduleId=Attendance.Settings.DefaultPresent.settings[$(obj).closest("tr").index()].settId,$.post("/AttendanceSettingsAction.zp",params,function(rdata){if(rdata.msg&&"success"===rdata.msg)return ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),Attendance.Settings.DefaultPresent.settings=null,void Attendance.Settings.DefaultPresent.getAllDefPreRule();rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess"))})},toggleAddNewPopUp:function(ruleVal){var popUpModal=Layout.Page.container.find("#ZPAtt_addRule");Attendance.Settings.DefaultPresent.resetDefPreRule(),ruleVal?(Attendance.Settings.DefaultPresent.ruleVal=ruleVal,popUpModal.find("#ZPAtt_defPreGroup").val(decodeHTML(ruleVal.groupName)),popUpModal.find("#ZPAtt_defPreFrom").val(ruleVal.fromDate),popUpModal.find("#ZPAtt_defPreTo").val("-"!==ruleVal.toDate?ruleVal.toDate:""),popUpModal.find("#ZPAtt_defPreReason").val(decodeHTML(ruleVal.reason)),popUpModal.find("#ZPAtt_popUpHeader_defPre").text(ZPI18N.getString("zp.editgroup")),-1!==ruleVal.user.indexOf("0")?(ZPPickList.allUsersSelected=!0,ZPPickList.setSelectedUsers(ZPPickList.allUsersObj)):ZPPickList.setSelectedUsers($.extend([],ruleVal.user,!0))):(Attendance.Settings.DefaultPresent.ruleVal=null,popUpModal.find("#ZPAtt_popUpHeader_defPre").text(ZPI18N.getString("zp.addgroup"))),Attendance.Settings.DefaultPresent.hideErrMsgs(popUpModal),popUpModal.modal("show")},hideErrMsgs:function(popUpModal){if(!popUpModal.find("#ZPAtt_defPreEmployeePickList_err")[0]){var errMsgDiv='<div class="error-msg" id="ZPAtt_defPreEmployeePickList_err">'+ZPI18N.getString("zp.selectappusers")+"</div>";popUpModal.find("#ZPAtt_defPreEmployeePickList").append(errMsgDiv)}popUpModal.find("#ZPAtt_defPreEmployeePickList_err").hide(),popUpModal.find("#ZPAtt_defPreGroup_err").hide(),popUpModal.find("#ZPAtt_defPreFrom_err").hide(),popUpModal.find("#ZPAtt_defPreTo_err").hide(),popUpModal.find("#ZPAtt_defPreReason_err").hide()},resetDefPreRule:function(){var popUpModal=Layout.Page.container.find("#ZPAtt_addRule");popUpModal.find("#ZPAtt_defPreGroup").val(""),popUpModal.find("#ZPAtt_defPreFrom").val(""),popUpModal.find("#ZPAtt_defPreTo").val(""),popUpModal.find("#ZPAtt_defPreReason").val(""),Attendance.Settings.setUserShiftPickList(!1,!0)},addEditDefaultPresent:function(){var popUpModal=Layout.Page.container.find("#ZPAtt_addRule");Attendance.Settings.DefaultPresent.hideErrMsgs(popUpModal);var groupName=popUpModal.find("#ZPAtt_defPreGroup").val(),fromDate=popUpModal.find("#ZPAtt_defPreFrom").val(),toDate=popUpModal.find("#ZPAtt_defPreTo").val(),reason=popUpModal.find("#ZPAtt_defPreReason").val(),appObj={};appObj=Timetracker.schedulerReminderSettings.returnParamsForRoleDeptDesignationForSchedules(appObj,Attendance.Settings.DefaultPresent.ruleVal);var isAllParamValid=!0;(groupName&&""!==groupName||(popUpModal.find("#ZPAtt_defPreGroup_err").show(),isAllParamValid=!1),fromDate&&""!==fromDate||(popUpModal.find("#ZPAtt_defPreFrom_err").show(),isAllParamValid=!1),reason&&""!==reason||(popUpModal.find("#ZPAtt_defPreReason_err").show(),isAllParamValid=!1),appObj.isAllCriteriaNull&&(popUpModal.find("#ZPAtt_defPreEmployeePickList_err").show(),isAllParamValid=!1),fromDate&&""!==fromDate&&toDate&&""!==toDate)&&(moment(toDate,dateFmt.toUpperCase()).diff(moment(fromDate,dateFmt.toUpperCase()),"days")<0&&(popUpModal.find("#ZPAtt_defPreTo_err").show(),isAllParamValid=!1));if(isAllParamValid){var params={conreqcsr:csrfToken,mode:"createDefaultPresentSett"};if(Attendance.Settings.DefaultPresent.ruleVal){params.mode="editDefaultPresentSett";var ruleVal=Attendance.Settings.DefaultPresent.ruleVal;if(params.scheduleId=ruleVal.settId,decodeHTML(ruleVal.groupName)===groupName&&decodeHTML(ruleVal.reason)===reason&&ruleVal.toDate===toDate&&ruleVal.fromDate===fromDate&&!appObj.isValid)return}params.applicableUsers=JSON.stringify(JSON.parse(appObj.appfor).user),params.scheduleName=groupName,params.fromDate=fromDate,params.toDate=toDate,params.reason=reason,popUpModal.find("#ZPAtt_DefPre_SaveBut").prop("disabled",!0),$.post("/AttendanceSettingsAction.zp",params,function(rdata){if(popUpModal.find("#ZPAtt_DefPre_SaveBut").prop("disabled",!1),rdata.msg&&"success"===rdata.msg){popUpModal.modal("hide");var successStr=ZPI18N.getString("zp.groupaddsuc");return"editDefaultPresentSett"===params.mode&&(successStr=ZPI18N.getString("zp.groupeditsuc")),ZPeople.Message.showSuccessMsg(successStr),Attendance.Settings.DefaultPresent.settings=null,void Attendance.Settings.DefaultPresent.getAllDefPreRule()}rdata.error&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess"))})}}},Attendance.Permissions={scrollIndex:0,SETTINGSURL:"/AttendanceSettingsAction.zp",init:function(){Attendance.Permissions.LayoutID="#"+Layout.Page.container[0].id,Attendance.Permissions.ParentCont=$(Attendance.Permissions.LayoutID),Attendance.Permissions.ParentCont.find("select").select2(),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMinTime , #ZPAtt_PermissionMaxTime").timepicker({defaultTime:"",showMeridian:!1,disableMousewheel:!0,minuteStep:1}),Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsAllowedMins").timepicker({defaultTime:"",showMeridian:!1,disableMousewheel:!0,minuteStep:1}),Attendance.Permissions.getApplicableElements(),void 0==Attendance.Permissions.permissionDetails&&Attendance.Permissions.getPermissionsList()},getApplicableElements:function(){if(!Attendance.Permissions.applicableFetched){ZPeople.Request.send(Attendance.Permissions.SETTINGSURL,{mode:"getPermissionApplicable"},function(data){Attendance.Permissions.constructApplicableElements(data)})}},constructApplicableElements:function(data){Attendance.Permissions.applicableFetched=!0,Attendance.Permissions.applicableFieldsCache=data,Attendance.Permissions.isOrgStructureEnabled=data.isOrgStructureEnabled;var resultKeys=["locationList","departmentList","designationList","roleList"],clientIds=["#ZPAtt_Permission_loc_","#ZPAtt_Permission_dept_","#ZPAtt_Permission_desg_","#ZPAtt_Permission_role_"];if(Attendance.Permissions.constructSelectValues(resultKeys,clientIds,data),Attendance.consResetEmpSearch("ZPAtt_PermissionUser_AppField_user",Layout.Page.container,!0),Attendance.consResetEmpSearch("ZPAtt_PermissionUser_ExpField_user",Layout.Page.container,!0),data.isOrgStructureEnabled){resultKeys=["entityList","businessUnitList","divisionList"],clientIds=["#ZPAtt_Permission_entity_","#ZPAtt_Permission_busunit_","#ZPAtt_Permission_division_"];Attendance.Permissions.constructSelectValues(resultKeys,clientIds,data),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_entity_AppField, #ZPAtt_Permission_entity_ExpField").removeClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_busunit_AppField, #ZPAtt_Permission_busunit_ExpField").removeClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_division_AppField, #ZPAtt_Permission_division_ExpField").removeClass("DN")}else Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_entity_AppField, #ZPAtt_Permission_entity_ExpField").addClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_busunit_AppField, #ZPAtt_Permission_busunit_ExpField").addClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_division_AppField, #ZPAtt_Permission_division_ExpField").addClass("DN");Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsName").on("focus",function(){Attendance.Permissions.ParentCont.find("#permissionNameEmptyErr").addClass("DN")}),Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsAllowedMins").on("focus",function(){Attendance.Permissions.ParentCont.find("#permissionTimeEmptyErr").addClass("DN")}),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMinTime").on("focus",function(){Attendance.Permissions.ParentCont.find("#permissionMinTimeErr").addClass("DN")}),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMaxTime").on("focus",function(){Attendance.Permissions.ParentCont.find("#permissionMaxTimeErr").addClass("DN"),Attendance.Permissions.ParentCont.find("#permissionMaxTimeGreaterErr").addClass("DN")})},setApprovalSettings:function(data){Attendance.Permissions.approvalSettings=data},approvalCallback:function(rdata,params){ZPApprovals.approveRejectDtlCallBack(rdata,params),void 0!=rdata&&void 0!=rdata.approvalJson&&void 0!=rdata.approvalJson.processed&&1==rdata.approvalJson.processed[0].approvalStatus&&Layout.Page.container.find("#cancelPermission").removeClass("DN"),Layout.Page.container.find("#closePermission").addClass("DN")},getPermissionApprovalDetails:function(formId,recordId,closeCallBack){var layout=Layout.Page.container,popupId="ZPAtt_Permission_Details",title=-1!==Layout.Page.pageId.indexOf("myapproval")?ZPI18N.getString("zp.myapprovals"):ZPI18N.getString("zp.myrequests");if(!layout.find("#"+popupId)[0]){var permissionPopUp='<div style="display: block;" aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" id="'+popupId+'" class="modal popRgtModel PopLgModel in"><div role="document" class="modal-dialog"><div class="modal-content"><div class="ZPNxtStep">';permissionPopUp+='<div class="modal-header"><div class="col-sm-3"><h6>'+title+' </h6> </div> <div class="col-sm-9"><div class="zp-recordsts zp_dyn" id="headerApprovalBtn"><span class="msg" id="headerApprovalMsg"></span><a id="zp_appproval_comment_btn" onclick="ZPApprovals.getApprovalDetails()">'+ZPI18N.getString("zp.view")+'</a></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div>',permissionPopUp+='<div class="modal-body ZPAprval PT0I"><div class="container-fluid MT25"><div class="row"><div class="col-sm-7"><form class="form-horizontal"><div class="form-group"><label class="col-sm-3 Matry PT8">'+ZPI18N.getString("zp.employee")+'</label><div class="col-sm-5 PL0 PT8" id="ZPAtt_Permission_Employee"></div></div></form></div></div></div>',permissionPopUp+='<div class="table-responsive MT30 feedModal"><table style="border-top: 1px solid #e9edf3;" class="table"><thead id="ZPAtt_Permission_DetListHeader" style="display: table-header-group;"></thead>',permissionPopUp+='<tbody class="B0" id="ZPAtt_Permission_DetListBody"></tbody></table></div></div><div class="modal-footer text-left ZPAprval" id="ZPAtt_Permission_AppHierarchy"><div class="Row"></div></div></div></div></div></div>',$(layout).append(permissionPopUp)}layout.find("#ZPAtt_Permission_DetListBody tr").remove(),layout.find("#ZPAtt_Permission_DetListHeader tr").remove(),ZPeople.BSModal.show(layout.find("#"+popupId)),layout.find("#"+popupId).off("hidden.bs.modal"),layout.find("#"+popupId).on("hidden.bs.modal",function(){-1!==Layout.Page.hash.indexOf("#approvals/myapproval")&&ZPUtil.Validation.isFunction(ZPApprovals.closePopCallback)?ZPApprovals.closePopCallback():ZPUtil.Validation.isFunction(closeCallBack)&&closeCallBack()}),ZPForm.LAYOUT=layout.find("#"+popupId),ZPForm.CURRFORM_PARAM={},formId||(formId=Layout.Page.childUrlParam.formId,recordId=Layout.Page.childUrlParam.recordId),Attendance.Permissions.approvalSettings||ZPApprovals.fetchApprovalSettings(formId,!1,Attendance.Permissions.setApprovalSettings),ZPApprovals.FORMID=formId,ZPApprovals.RECORDID=recordId,ZPForm.CURRFORM_PARAM.formId=formId,ZPForm.CURRFORM_PARAM.recordId=recordId,ZPForm.CURRFORM_PARAM.tableName="P_PermissionDetails",ZPApprovals.MODAL_CLASS="modal popRgtModel PopApModel PopApZI";var AppHierCont="<div class='col-sm-12 text-right PT8'>";AppHierCont+="<button type='button' name='approvalTypeBtn' class='btn btn-success ZpaprvrBtn RsltA DN'  approvaltype='1'  id='zp_appproval_approve_btn'> "+ZPI18N.getString("zp.approve")+" </button>",AppHierCont+="<button type='button'name='approvalTypeBtn' class='btn btn-danger ZpaprvrBtn RsltR DN'  approvaltype='0'  id='zp_appproval_reject_btn'> "+ZPI18N.getString("zp.rejectall")+" </button>",AppHierCont+="<button class='btn btn-cancel btn-default ML8 DN' id='cancelPermission'>"+ZPI18N.getString("zp.cancelpermission")+"</button>",AppHierCont+="<button type='button' data-dismiss='modal' class='btn btn-default cancel-model DN' id='closePermission'> "+ZPI18N.getString("zp.close")+" </button></div>",layout.find("#ZPAtt_Permission_AppHierarchy .Row").html(AppHierCont),delete Attendance.Permissions.permissionApprovalDetails;var params={mode:"getPermissionApprovalDetails"};if(params.recordId=recordId,params.formId=formId,-1!==Layout.Page.hash.indexOf("attendance/permission/viewmyrequest")){var filter=Layout.Page.container.find("#ZPAtt_permFilter");Attendance.Report.getEmpProfDateofExitFilter(filter,params,"myReqPerm")}ZPeople.Request.send("/AttendanceAction.zp",params,function(data){if(data.details){if(ZPForm.CONF.isadmin=isManageAttendanceData,data.approvalDetails){data.approvalDetails.isfromAttendence=!0,Attendance.Entry.isRecordOwner=!1;data.approvalDetails.isOwner;data.approvalDetails.recOwner&&(Attendance.Entry.isRecordOwner=!0,ZPForm.RecordApproval.CREATE_ERECNO=data.approvalDetails.recOwner,data.approvalDetails.recordowner.erecno&&(ZPForm.RecordApproval.OWNER_ERECNO=data.approvalDetails.recordowner.erecno))}if(0!=Object.keys($("#ZPAtt_Permission_DetListHeader").children()).length){var tableHeader='<tr class="TblGryBg ZPLHRow"><th class="B1 TBrdr W300">'+ZPI18N.getString("zp.date")+"</th>";tableHeader+='<th class="B1 TBrdr W300 text-center">Permission</th>',tableHeader+='<th class="B1 TBrdr W200 text-center">'+ZPI18N.getString("zp.fromtime")+"</th>",tableHeader+='<th class="B1 TBrdr W200 text-center">'+ZPI18N.getString("zp.totime")+"</th>",tableHeader+='<th class="B1 TBrdr W200 text-center">'+ZPI18N.getString("zp.hours")+"</th>",tableHeader+='<th class="B1 TBrdr W400 text-center">'+ZPI18N.getString("zp.reason")+"</th>",tableHeader+='<th class="text-center B1 TBrdr text-center" style="display: table-cell;" width="230">'+ZPI18N.getString("zp.approvalstatus")+"</th></tr>",layout.find("#ZPAtt_Permission_DetListHeader").append(tableHeader)}var displayDetails=data.details,empName=displayDetails.employeeName+" - "+$("<div/>").text(displayDetails.employeeId).html();layout.find("#ZPAtt_Permission_Employee").html(empName);var tableBody="<tr class='ZPLRow regRow'><td class='TBrdr'><div>"+displayDetails.date+"</div></td>";tableBody+="<td class='text-center TBrdr'><div>"+displayDetails.permissionName+"</div></td>",tableBody+="<td class='text-center TBrdr'><div>"+Attendance.disTime(displayDetails.fromTime)+"</div></td>",tableBody+="<td class='text-center TBrdr'><div>"+Attendance.disTime(displayDetails.toTime)+"</div></td>",tableBody+="<td class='text-center TBrdr'><div>"+displayDetails.totalTime+"</div></td>",tableBody+="<td class='text-center TBrdr'><div>"+$("<div></div>").text(displayDetails.reason).html()+"</div></td>",tableBody+="<td class='text-center TBrdr'><div>"+displayDetails.approvalStatus+"</div></td>",layout.find("#ZPAtt_Permission_DetListBody").append(tableBody),void 0!=displayDetails.isCancelPermitted&&1==displayDetails.isCancelPermitted&&layout.find("#cancelPermission").removeClass("DN"),void 0!=displayDetails.isClosePermitted&&1==displayDetails.isClosePermitted&&layout.find("#closePermission").removeClass("DN"),layout.find("#cancelPermission").off("click").on("click",function(){Attendance.Permissions.cancelPermissionWarning(data)}),Attendance.Permissions.permissionApprovalDetails=data;var otherDetails={isfromAttendence:!0};Attendance.Permissions.approvalSettings&&ZPApprovals.initApprovalSettings({approvalSettingsDetails:Attendance.Permissions.approvalSettings}),data.approvalDetails&&ZPApprovals.showApprovalHeader(data.approvalDetails.currentApprovalStatus,data.isRecordApprover,!!data.approvalDetails.isPrimaryAppr&&data.approvalDetails.isPrimaryAppr,otherDetails,data.approvalDetails)}else layout.find("#ZPAtt_Permission_Details div.modal-body ").empty().append('<div class="ZPNdata"><i id="norecfoundimg"></i><p class="no-para"><br>'+ZPI18N.getString("zp.norec")+"<br></p></div>"),Attendance.noDataImg(8,"CR-nodata",layout.find(".ZPNdata #norecfoundimg"))})},cancelPermissionWarning:function(data){ZPeople.BSModal.setup({id:"zp_confirmation_pop",type:1,header:'<div class="Icn grni"><i class="IC-tick whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.confirm")+"</h4>",body:'<div class="form-group"><p class="text-center MB15">'+ZPI18N.getString("zp.confirmregcancel")+'</p></div><div class="form-group" id="cancel_reason" style="height:90px"><div class="col-sm-12"><textarea class="form-control ZP-Input mandatory" style="width: 340px;margin: 0 auto;" name="remark" rows="5" placeholder="Reason For Cancellation"></textarea><span class="ERR text-center MT5 DN" id="cancel_reason_error" style="width: 100%;"></span></div></div>',modalClass:"modal fade ZPmdl in",buttonValue:ZPI18N.getString("zp.confirm"),successCallback:function(){Attendance.Permissions.cancelPermission(data.details.recordId)},hiddenCallback:ZPApprovals.approveOrRejectActionHidden}).find(".btn-default").text(ZPI18N.getString("zp.cancel"))},cancelPermission:function(recordId){var layout=Layout.Page.container,params={mode:"cancelPermission"};if(params.recordId=recordId,params.conreqcsr=csrfToken,void 0!==ZPeople.Module.MODULE_DATA.attendance.isPermissionCancelReason){if(!0===ZPeople.Module.MODULE_DATA.attendance.isPermissionCancelReason&&(void 0===layout.find("#cancel_reason textArea").val()||""===layout.find("#cancel_reason textArea").val().trim()))return void layout.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.providereason")).removeClass("DN");params.reason=layout.find("#cancel_reason textArea").val()}$.post("/AttendanceAction.zp",params,function(resultData){if(layout.find("#cancelPermission").addClass("DN"),void 0!==resultData&&void 0!==resultData.currentApprovalStatus&&void 0!==resultData.approvalDetail){ZPForm.Record.cancelRecCBforModule(resultData.currentApprovalStatus,{isfromAttendence:!0},resultData.approvalDetail)}void 0!=resultData&&"success"==resultData.status?(ZPeople.BSModal.hide("zp_confirmation_pop"),layout.find("#ZPAtt_Permission_DetListBody").find(".regRow td:last").html(ZPI18N.getString("zp.cancelled"))):void 0!=resultData&&void 0!=resultData.message&&(resultData.message==ZPI18N.getString("zp.leave.cancell.error.providereason")?(layout.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.providereason")).removeClass("DN"),layout.find("#cancelPermission").removeClass("DN")):(ZPeople.BSModal.hide("zp_confirmation_pop"),ZPeople.Message.showFailureMsg(resultData.message)))}).fail(function(data){void 0!=data.responseJSON&&void 0!=data.responseJSON.error&&layout.find("#cancel_reason_error").text(data.responseJSON.error).removeClass("DN")})},constructSelectValues:function(resultKeys,clientIds,data){for(var index in resultKeys){var selectOption="",filterJson=data[resultKeys[index]];for(var PKID in filterJson)selectOption+="<option value="+PKID+">"+filterJson[PKID].recName+"</option>";Attendance.Permissions.ParentCont.find(clientIds[index]+"AppField select,"+clientIds[index]+"ExpField select").html(selectOption)}},applicableValueChange:function(ele){Attendance.Permissions.ParentCont.find("#permissionApplicableErr").addClass("DN");var selectedValue=$(ele).val(),selectedFieldId=$(ele).parent().parent().attr("id");selectedFieldId=selectedFieldId.includes("ExpField")?selectedFieldId.replace("ExpField","AppField"):selectedFieldId.replace("AppField","ExpField"),0===selectedValue.length?Attendance.Permissions.ParentCont.find("#"+selectedFieldId).removeClass("DN"):Attendance.Permissions.ParentCont.find("#"+selectedFieldId).addClass("DN"),Attendance.Permissions.checkAndRemoveOR()},scrollIndex:0,onScroll:function(){Attendance.Permissions.orderedArray.length%25==0&&(Attendance.Permissions.scrollIndex+=25,Attendance.Permissions.getPermissionsList(!0))},orderedArray:[],getPermissionsList:function(isFromScroll){Attendance.Break.appendLoader(Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsDetails").parent(),!0,80),isFromScroll||(Attendance.Permissions.scrollIndex=0,Attendance.Permissions.orderedArray=[],Attendance.Permissions.permissionDetails={},Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsDetailsBody").empty());var params={mode:"getPermissions"};params.scrollIndex=Attendance.Permissions.scrollIndex+1,ZPeople.Request.send(Attendance.Permissions.SETTINGSURL,params,function(data){Attendance.Permissions.cacheLoadedData(data),Attendance.Permissions.constructPermissions(data)})},cacheLoadedData:function(data){var orderedArray=data.orderedArray,details=data.details;for(var index in orderedArray){var permissionId=orderedArray[index];Attendance.Permissions.orderedArray.push(permissionId)}for(var permissionId in details)Attendance.Permissions.permissionDetails[permissionId]=details[permissionId]},constructPermissions:function(data){var emptyMsg=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsEmpty");if(Attendance.Break.appendLoader(Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsDetails").parent(),!1),0!=Attendance.Permissions.orderedArray.length){$(emptyMsg).prev().show(),$(emptyMsg).hide(),25===data.orderedArray.length&&ZPeople.FireScroll.reset(),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsDetails").show();var tableBody=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsDetailsBody"),orderedArray=data.orderedArray,details=data.details;for(var index in 25===orderedArray.length&&ZPeople.FireScroll.reset(),orderedArray){var permissionId=orderedArray[index],detailsObj=details[permissionId],period=1==detailsObj.periodType?ZPI18N.getString("zp.week"):ZPI18N.getString("zp.month"),permissionRow='<tr id="'+permissionId+'" class="ZPLRow"><td><span class="CP" ';permissionRow+='onclick=Attendance.Permissions.togglePopup(true,"'+permissionId+'")>'+detailsObj.name+"</span></td>",permissionRow+="<td><span>"+period+"</span></td>",permissionRow+="<td><span>"+Attendance.disHours(detailsObj.allowedMinutes,!0)+"</span></td>",permissionRow+='<td><div class="btnactive"><input onclick=Attendance.Permissions.disablePermission(this,"'+permissionId+'") class="cmn-toggle-small cmn-toggle-round-small" id="permissionDisable_'+permissionId+'" ',detailsObj.isDisabled||(permissionRow+='checked="" '),permissionRow+='type="checkbox"><label class="M0" for="permissionDisable_'+permissionId+'"></label></div></td>',permissionRow+='<td class="text-right P0I"><div id="ZPAtt_DeletePermission" class="over-display">',permissionRow+='<i class="IC-delete S14 gry FR MR15 CP" onclick=Attendance.Permissions.deletePermissionPopup(this)></i><i class="IC-pen S14 gry FR MR15 CP" data-toggle="modal" onclick=Attendance.Permissions.togglePopup(true,"'+permissionId+'")></i></div>',permissionRow+="</td><td></td></tr>",tableBody.append(permissionRow)}$(Attendance.Permissions.ParentCont).find(" #ZPAtt_PermissionsDetails").parent().hasClass("tabcont")||ZPView.handleTablePosition()}else Attendance.Permissions.showPermissionEmptyMsg()},disablePermission:function(obj,permissionId){var params={mode:"changePermissionStatus"};params.permissionId=permissionId,params.statusType=$(obj).is(":checked")?1:0,ZPeople.Request.send(Attendance.Permissions.SETTINGSURL,params,function(data){var successMsg=$(obj).is(":checked")?ZPI18N.getString("zp.enablesuccessful"):ZPI18N.getString("zp.disablesuccessful");ZPeople.Message.showSuccessMsg(successMsg)})},deletePermission:function(obj){var params={mode:"changePermissionStatus"};params.permissionId=$(obj).closest("tr").attr("id"),params.statusType=-1,ZPeople.Request.send(Attendance.Permissions.SETTINGSURL,params,function(data){$(obj).closest("tr").fadeOut("fast",function(){$(obj).closest("tr").remove(),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsDetailsBody tr")[0]||Attendance.Permissions.showPermissionEmptyMsg()})})},showPermissionEmptyMsg:function(){var emptyMsg=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsEmpty");$(emptyMsg).prev().hide(),$(emptyMsg).show(),0===emptyMsg.find("i").eq(0).children().length&&Attendance.noDataImg(8,"CR-nodata",emptyMsg.find("i").eq(0))},deletePermissionPopup:function(obj){var popup=$("#confirmationPopup");popup.modal({backdrop:"static",keyboard:!1}),$("#textConfirmationPopupHeader").html(ZPI18N.getString("zp.confirm"));var popupConf=$("#confirmConfirmationPopup"),popupCancel=$("#cancelConfirmationPopup");popupConf.removeClass("btn-primary").addClass("btn-danger"),popupConf.html("").append(ZPI18N.getString("zp.delete")),$("#textConfirmationPopupBody").html(ZPI18N.getString("zp.deletePermissions")),popupConf.off("click"),popupCancel.off("click"),popupConf.on("click",function(event){Attendance.Permissions.deletePermission(obj)}),popupCancel.on("click",function(event){popup.modal("hide")})},togglePopup:function(isShow,dataId){if(isShow){var submitButton=Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_Save");$(submitButton).prop("disabled",!1);var popupTitle=dataId?ZPI18N.getString("zp.editpermission"):ZPI18N.getString("zp.addpermission");Attendance.Permissions.ParentCont.find("#ZPAtt_popUpHeader_Permissions").html(popupTitle),Attendance.Permissions.resetPopupFields(),Attendance.Permissions.getApplicableValueForId(dataId),Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsPopup").modal("show")}else Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsPopup").modal("hide")},savePermissions:function(){var permissionName=Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsName").val().trim(),periodType=Attendance.Permissions.ParentCont.find("#permissionWeek").prop("checked")?1:2,allowedTime=Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsAllowedMins").val().trim(),isApplicableToAll=Attendance.Permissions.ParentCont.find("#ZPAtt_AppliesToAllUsers").prop("checked"),allowedTimeInMins=AttendanceShift.convertTimePickValToMins(allowedTime),minTime=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMinTime").val().trim(),maxTime=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMaxTime").val().trim(),maxAllowedInstances=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMaxInstance").val().trim(),allowOutsideShift=!Attendance.Permissions.ParentCont.find("#limitWithinShift")[0].checked,applicableFields={};if(isApplicableToAll||(applicableFields=Attendance.Permissions.getApplicableFields()),!Attendance.Permissions.validateFields(permissionName,allowedTime,isApplicableToAll,applicableFields,minTime,maxTime,maxAllowedInstances)){var input={permissionName:permissionName,periodType:periodType,allowedTimeInMins:allowedTimeInMins,isApplicableToAll:isApplicableToAll,allowOutsideShift:allowOutsideShift};isApplicableToAll||(input.applicableFields=applicableFields),Attendance.Permissions.editingId&&(input.permissionId=Attendance.Permissions.editingId),""!=minTime&&(input.minTime=AttendanceShift.convertTimePickValToMins(minTime)),""!=maxTime&&(input.maxTime=AttendanceShift.convertTimePickValToMins(maxTime)),""!=maxAllowedInstances&&(input.maxAllowedInstances=maxAllowedInstances);var params={mode:"savePermissions"};params.input=JSON.stringify(input);var submitButton=Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_Save");$(submitButton).prop("disabled",!0),ZPeople.Request.send(Attendance.Permissions.SETTINGSURL,params,function(data){Attendance.Permissions.getPermissionsList(),Attendance.Permissions.togglePopup(!1)})}},validateFields:function(permissionName,allowedTime,isApplicableToAll,applicableFields,minTime,maxTime){var errorOccured=!1;if(Attendance.Permissions.isEmpty(permissionName)&&(errorOccured=!0,Attendance.Permissions.ParentCont.find("#permissionNameEmptyErr").removeClass("DN")),Attendance.Permissions.isEmpty(allowedTime))errorOccured=!0,Attendance.Permissions.ParentCont.find("#permissionTimeEmptyErr").removeClass("DN");else{var allowedTimeInMins=AttendanceShift.convertTimePickValToMins(allowedTime);""!=minTime&&AttendanceShift.convertTimePickValToMins(minTime)>allowedTimeInMins&&(errorOccured=!0,Attendance.Permissions.ParentCont.find("#permissionMinTimeErr").removeClass("DN")),""!=maxTime&&AttendanceShift.convertTimePickValToMins(maxTime)>allowedTimeInMins&&(errorOccured=!0,Attendance.Permissions.ParentCont.find("#permissionMaxTimeErr").removeClass("DN")),""!=minTime&&""!=maxTime&&AttendanceShift.convertTimePickValToMins(minTime)>AttendanceShift.convertTimePickValToMins(maxTime)&&(errorOccured=!0,Attendance.Permissions.ParentCont.find("#permissionMaxTimeGreaterErr").removeClass("DN"))}return isApplicableToAll||0!=Object.keys(applicableFields).length||(errorOccured=!0,Attendance.Permissions.ParentCont.find("#permissionApplicableErr").removeClass("DN")),errorOccured},getApplicableFields:function(){var applicableResult={},applicableKeys=["Location","Department","Designation","Role","Entity","BusinessUnit","Division"],applicableFields=["#ZPAtt_Permission_loc_AppField","#ZPAtt_Permission_dept_AppField","#ZPAtt_Permission_desg_AppField","#ZPAtt_Permission_role_AppField","#ZPAtt_Permission_entity_AppField","#ZPAtt_Permission_busunit_AppField","#ZPAtt_Permission_division_AppField"],exceptionFields=["#ZPAtt_Permission_loc_ExpField","#ZPAtt_Permission_dept_ExpField","#ZPAtt_Permission_desg_ExpField","#ZPAtt_Permission_role_ExpField","#ZPAtt_Permission_entity_ExpField","#ZPAtt_Permission_busunit_ExpField","#ZPAtt_Permission_division_ExpField"];for(var index in applicableFields){var appFieldVal=Attendance.Permissions.ParentCont.find(applicableFields[index]+" select").val(),excFieldVal=Attendance.Permissions.ParentCont.find(exceptionFields[index]+" select").val();appFieldVal.length>0?applicableResult["applicable"+applicableKeys[index]]=appFieldVal:excFieldVal.length>0&&(applicableResult["exception"+applicableKeys[index]]=excFieldVal)}return 0!=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionUser_AppField_user").select2("val").length?applicableResult.applicableUser=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionUser_AppField_user").select2("val"):0!=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionUser_ExpField_user").select2("val").length&&(applicableResult.exceptionUser=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionUser_ExpField_user").select2("val")),applicableResult},isEmpty:function(value){return void 0===value||""==value.trim()},resetPopupFields:function(){Attendance.Permissions.editingId=void 0,Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsName").val(""),Attendance.Permissions.ParentCont.find("#permissionWeek").prop("checked",!0),Attendance.Permissions.ParentCont.find("#limitWithinShift").prop("checked",!1),Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsAllowedMins").val(""),Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsApplicable").trigger("click"),Attendance.Permissions.ParentCont.find("select[name='ZPAtt_Permission_SystemAppl']").select2("val",""),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionUser_AppField_user,#ZPAtt_PermissionUser_ExpField_user").select2("val",""),Attendance.Permissions.ParentCont.find("#permissionNameEmptyErr").addClass("DN"),Attendance.Permissions.ParentCont.find("#permissionTimeEmptyErr").addClass("DN"),Attendance.Permissions.ParentCont.find("#permissionMinTimeErr").addClass("DN"),Attendance.Permissions.ParentCont.find("#permissionMaxTimeErr").addClass("DN"),Attendance.Permissions.ParentCont.find("#permissionMaxTimeGreaterErr").addClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_AppliesToAllUsers").trigger("click"),Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsAllowedMins").timepicker("setTime",""),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMinTime").val(""),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMaxTime").val(""),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMinTime").timepicker("setTime",""),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMaxTime").timepicker("setTime",""),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMaxInstance").val(""),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionApplicables div.zp-label.Rflds").removeClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionExceptions div.zp-label.Rflds").removeClass("DN"),Attendance.Permissions.isOrgStructureEnabled?(Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_entity_AppField, #ZPAtt_Permission_entity_ExpField").removeClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_busunit_AppField, #ZPAtt_Permission_busunit_ExpField").removeClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_division_AppField, #ZPAtt_Permission_division_ExpField").removeClass("DN")):(Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_entity_AppField, #ZPAtt_Permission_entity_ExpField").addClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_busunit_AppField, #ZPAtt_Permission_busunit_ExpField").addClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_division_AppField, #ZPAtt_Permission_division_ExpField").addClass("DN"))},getApplicableValueForId:function(dataId){if(void 0!==dataId){var cacheObj=Attendance.Permissions.permissionDetails[dataId];if(cacheObj.isApplicableToAll||cacheObj.applicableList)Attendance.Permissions.populateStoredFields(dataId);else{var params={mode:"getApplicableValueForId"};params.permissionId=dataId,ZPeople.Request.send(Attendance.Permissions.SETTINGSURL,params,function(data){Attendance.Permissions.permissionDetails[dataId].applicableList=data,Attendance.Permissions.populateStoredFields(dataId)})}}},populateStoredFields:function(dataId){Attendance.Permissions.editingId=dataId;var cacheObj=Attendance.Permissions.permissionDetails[dataId],periodType=1==cacheObj.periodType?0:1,applicableType=cacheObj.isApplicableToAll?0:1;if(Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsName").val(cacheObj.unEncodedName),Attendance.Permissions.ParentCont.find("input:radio[name=ZPAtt_PermissionPeriod]")[periodType].checked=!0,Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsAllowedMins").timepicker("setTime",Attendance.disHours(cacheObj.allowedMinutes,!0)),Attendance.Permissions.ParentCont.find("input:radio[name=ZPAtt_PermissionAppliesTo]")[applicableType].checked=!0,Attendance.Permissions.ParentCont.find("#limitWithinShift")[0].checked=!0,cacheObj.allowOutsideShift&&(Attendance.Permissions.ParentCont.find("#limitWithinShift")[0].checked=!1),cacheObj.minTime&&Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMinTime").timepicker("setTime",Attendance.disHours(cacheObj.minTime,!0)),cacheObj.maxTime&&Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMaxTime").timepicker("setTime",Attendance.disHours(cacheObj.maxTime,!0)),cacheObj.maxAllowedInstance&&Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionMaxInstance").val(cacheObj.maxAllowedInstance),0==applicableType)Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsApplicableCont").addClass("DN");else{Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsApplicableCont").removeClass("DN");var keyList=["locationList","departmentList","designationList","roleList","entityList","businessUnitList","divisionList","userList"],clientIds=["loc","dept","desg","role","entity","busunit","division","user"],applicableTypeKeys=["locationMapType","departmentMapType","designationMapType","roleMapType","entityMapType","businessUnitMapType","divisionMapType","userMapType"],applicableList=cacheObj.applicableList;for(var index in keyList){var key=keyList[index];if(void 0!=applicableList[key]){var applicableTypeKey=applicableTypeKeys[index],appTypeClientId=1==cacheObj[applicableTypeKey]?"_AppField":"_ExpField",removableClientId=1==cacheObj[applicableTypeKey]?"_ExpField":"_AppField";if("userList"==key){var applicableArray=applicableList[key],userList=ZPeople.getUserDetailsByIds(applicableArray,!1),values=[];for(var i in applicableArray){var id=applicableArray[i],userDtl=ZPeople.getUserDetailsByIdInList(id,userList);userDtl&&userDtl.name&&values.push({id:id,text:ZPeople.decodeTxt(userDtl.name),html:userDtl.name,photo:userDtl.photo})}Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionUser"+appTypeClientId+"_user").select2("data",values),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_user"+removableClientId).addClass("DN")}else Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_"+clientIds[index]+appTypeClientId+" select").select2("val",applicableList[key]),Attendance.Permissions.ParentCont.find("#ZPAtt_Permission_"+clientIds[index]+removableClientId).addClass("DN")}}Attendance.Permissions.checkAndRemoveOR()}},checkAndRemoveOR:function(){var ele=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionApplicables"),beforeOrIds=["loc","dept","desg","role","entity","busunit","division"],isAtleastOneAvail=!1;for(var index in beforeOrIds)ele.find("#ZPAtt_Permission_"+beforeOrIds[index]+"_AppField").hasClass("DN")||(isAtleastOneAvail=!0);for(var index in!isAtleastOneAvail||ele.find("#ZPAtt_Permission_user_AppField").hasClass("DN")?ele.find("#ZPAtt_Permission_OR_AppField").addClass("DN"):ele.find("#ZPAtt_Permission_OR_AppField").removeClass("DN"),ele=Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionExceptions"),isAtleastOneAvail=!1,beforeOrIds)ele.find("#ZPAtt_Permission_"+beforeOrIds[index]+"_ExpField").hasClass("DN")||(isAtleastOneAvail=!0);!isAtleastOneAvail||ele.find("#ZPAtt_Permission_user_ExpField").hasClass("DN")?ele.find("#ZPAtt_Permission_OR_ExpField").addClass("DN"):ele.find("#ZPAtt_Permission_OR_ExpField").removeClass("DN")},toggleAppliesTo:function(ele){"ZPAtt_AppliesToAllUsers"==$(ele).attr("id")?Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsApplicableCont").addClass("DN"):Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionsApplicableCont").removeClass("DN")},toggleApplicable:function(ele){"ZPAtt_AddPermissionsApplicable"==$(ele).attr("id")?(Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsApplicable").addClass("active"),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionApplicables").removeClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionExceptions").addClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsExceptions").removeClass("active")):(Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsExceptions").addClass("active"),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionExceptions").removeClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_PermissionApplicables").addClass("DN"),Attendance.Permissions.ParentCont.find("#ZPAtt_AddPermissionsApplicable").removeClass("active"))}},Attendance.Settings.CustomizeTemplate={title:{1:"zp.graceleavetemplate",2:"zp.graceabsenttemplate",3:"zp.attendance.notifyUserInTitle",4:"zp.attendance.notifyUserInTitle",5:"zp.attendance.notifyUserOutTitle",6:"zp.attendance.notifyUserOutTitle",7:"zp.notifyRepMsg",8:"zp.graceleavereverttemplate",9:"zp.graceabsentreverttemplate"},body:{3:"zp.attendance.notifyUserInBefore",4:"zp.attendance.notifyUserInAfter",5:"zp.attendance.notifyUserOutBefore",6:"zp.attendance.notifyUserOutAfter"},templateType:1,template:"",templateTypeJSON:{1:203,2:204,3:205,4:206,5:207,6:208,7:209,8:210,9:211},templateTypeName:{3:"checkInBefore",4:"checkInAfter",5:"checkOutBefore",6:"checkOutAfter",7:"notifyUserOutAfter"},templateIdJSON:{},templateMsgJSON:{},show:function(templateType,template){var curSettingObj=Attendance.Settings.userSettings[Attendance.Settings.settingsId];if(!curSettingObj||1!=curSettingObj.sendGraceMail||Attendance.Settings.templateLoaded){Attendance.Settings.CustomizeTemplate.templateType=templateType,Attendance.Settings.CustomizeTemplate.template=template;var mailContent=this.getMailContent(),customTemplatePopUp=Layout.Page.container.find("#attCustomizeTemplate");if(customTemplatePopUp.find("#graceOnlyTemplate").addClass("DN"),"graceMailTemplate"==template){customTemplatePopUp.find("#graceOnlyTemplate").removeClass("DN");var txt='<select class="select2-container W300A" id="graceOptions" onchange="Attendance.Settings.CustomizeTemplate.show(this.value, \'graceMailTemplate\')">';1==templateType||8==templateType?(txt+='<option value="1">When leave is deducted</option>',txt+='<option value="8">When leave is reverted</option>'):(txt+='<option value="2">When absent is marked</option>',txt+='<option value="9">When absent is reverted</option>'),txt+="</select>",customTemplatePopUp.find("#selectCont").html(txt),customTemplatePopUp.find("#graceOptions").select2(),customTemplatePopUp.find("#graceOptions").select2("val",templateType),customTemplatePopUp.find("selectCont").select2({minimumResultsForSearch:4});var templateTitle=1==templateType||8==templateType?ZPI18N.getString("zp.graceleavededucted"):ZPI18N.getString("zp.gracemarkedabsent");customTemplatePopUp.find("#mailTemplateTitle").text(templateTitle)}else customTemplatePopUp.find("#mailTemplateTitle").text(ZPI18N.getString("zp.mailtemplate"));if("shiftReminderTemplate"==template&&7!=templateType){var options="";3==templateType||4==templateType?options='<option value="3">'+ZPI18N.getString("zp.attendance.reminderInBefore")+'</option><option value="4">'+ZPI18N.getString("zp.attendance.reminderInAfter")+"</option>":5!=templateType&&6!=templateType||(options='<option value="5">'+ZPI18N.getString("zp.attendance.reminderOutBefore")+'</option><option value="6">'+ZPI18N.getString("zp.attendance.reminderOutAfter")+"</option>"),customTemplatePopUp.find("#shiftReminder_customizeList").removeClass("DN"),customTemplatePopUp.find("#shiftReminder_customizeList").html('<div class="modal-header form-group MB20"><label class="col-sm-3 MT6 text-right" id ="customizeList_Lable">'+ZPI18N.getString("zp.attendance.shift.customize")+'&nbsp;</label><div class="col-sm-3"><select name="depcal" onchange="Attendance.Settings.CustomizeTemplate.show(this.value,\'shiftReminderTemplate\')" id="shiftReminder_type">'+options+"</select></div></div>"),customTemplatePopUp.find("#shiftReminder_type").select2(),customTemplatePopUp.find("#shiftReminder_type").select2("val",templateType)}else customTemplatePopUp.find("#shiftReminder_customizeList").addClass("DN");"graceMailTemplate"==template&&customTemplatePopUp.find("select").select2({minimumResultsForSearch:4}),customTemplatePopUp.modal("show"),customTemplatePopUp.find("#msgTemplate").html('<div class="row"><div class="msgpreview-outer"><div class="msgpreview clearfix"><div id="tempViewCont" class="P10">'+mailContent+"</div></div></div></div>"),attCustomizeTemplate.appendTemplate(customTemplatePopUp,templateType,template)}},getMailContent:function(){var mailContent="",curSettingObj=Attendance.Settings.userSettings[Attendance.Settings.settingsId];delete Attendance.Settings.templateID;var isGraceTemplate="graceMailTemplate"==this.template,storedContent=void 0;if(isGraceTemplate)storedContent=1==this.templateType?Attendance.Settings.leaveTemplate:8==this.templateType?Attendance.Settings.leaveRevertTemplate:2==this.templateType?Attendance.Settings.absentTemplate:Attendance.Settings.absentRevertTemplate,curSettingObj&&1==curSettingObj.sendGraceMail?Attendance.Settings.templateID=1==this.templateType?curSettingObj.leaveTemplateID:8==this.templateType?curSettingObj.leaveRevertTemplateID:2==this.templateType?curSettingObj.absentTemplateID:curSettingObj.absentRevertTemplateID:Attendance.Settings.templateID=1==this.templateType?Attendance.Settings.leaveTemplateID:8==this.templateType?Attendance.Settings.leaveRevertTemplateID:2==this.templateType?Attendance.Settings.absentTemplateID:Attendance.Settings.absentRevertTemplateID;else{if(Attendance.Settings.CustomizeTemplate.templateIdJSON[this.templateType])Attendance.Settings.templateID=Attendance.Settings.CustomizeTemplate.templateIdJSON[this.templateType];else if(curSettingObj&&curSettingObj.shiftRminder_TemplateIds&&curSettingObj.shiftRminder_TemplateIds[this.templateType]&&"null"!=curSettingObj.shiftRminder_TemplateIds[this.templateType])Attendance.Settings.templateID=curSettingObj.shiftRminder_TemplateIds[this.templateType];else if(-1!==Layout.Page.urlmode.indexOf("attendance_settings_general")){var generalSettingObj=Attendance.Settings.generalSettings;generalSettingObj.shiftRminder_TemplateIds&&generalSettingObj.shiftRminder_TemplateIds[this.templateType]&&"null"!=generalSettingObj.shiftRminder_TemplateIds[this.templateType]&&(Attendance.Settings.templateID=generalSettingObj.shiftRminder_TemplateIds[this.templateType])}Attendance.Settings.templateID&&this.templateMsgJSON[Attendance.Settings.templateID]&&(storedContent=this.templateMsgJSON[Attendance.Settings.templateID])}if(void 0!=storedContent)mailContent=storedContent;else{for(var i=0;i<176;i++)mailContent+="&nbsp;";isGraceTemplate?(mailContent+="${CompanyLogo}<br><br>",mailContent+=ZPI18N.getString(this.title[this.templateType])):(mailContent+='<div style="font-size:13px; text-transform:color:#888;letter-spacing:0.5px;text-decoration:underline;margin-bottom:35px;">',mailContent+=ZPI18N.getString(this.title[this.templateType])+"</div>",3==this.templateType?mailContent+='<p style="margin-bottom:12px;font-size:14px;margin-bottom:15px; color:#333;">'+ZPI18N.getString(this.body[this.templateType],new Array("${Shift_StartTime}"))+"</p>":5==this.templateType?mailContent+='<p style="margin-bottom:12px;font-size:14px;margin-bottom:15px; color:#333;">'+ZPI18N.getString(this.body[this.templateType],new Array("${Shift_EndTime}"))+"</p>":4!=this.templateType&&6!=this.templateType||(mailContent+='<p style="margin-bottom:12px;font-size:14px;margin-bottom:15px; color:#333;">'+ZPI18N.getString(this.body[this.templateType])+"</p>"))}return mailContent},hide:function(){$("#attCustomizeTemplate").modal("hide")},save:function(obj){var modalPopup=$(obj).closest("#attCustomizeTemplate");if(modalPopup.find("#editorTextArea_attCustomizeTemplate").is(":visible")){if("<div><br></div>"==editor.getContent())return;var isLeaveTemplate=1==Attendance.Settings.CustomizeTemplate.templateType,isLeaveRevertTemplate=8==Attendance.Settings.CustomizeTemplate.templateType,isAbsentTemplate=2==Attendance.Settings.CustomizeTemplate.templateType,params=(Attendance.Settings.CustomizeTemplate.templateType,{conreqcsr:csrfToken,mode:"saveAttCustomizeTemplate"});params.templateType=this.templateTypeJSON[this.templateType],params.templateMode=this.template,params.templateMsg=editor.getContent(),Attendance.Settings.templateID&&"null"!=Attendance.Settings.templateID&&(params.templateId=Attendance.Settings.templateID),Attendance.Settings.settingsId&&(params.settingsId=Attendance.Settings.settingsId),modalPopup.find(".btn-primary").attr("disabled",!0),$.post("/AttendanceSettingsAction.zp",params,function(rdata){modalPopup.find(".btn-primary").prop("disabled",!1),Layout.Page.container.find("#attCustomizeTemplate").modal("hide"),"graceMailTemplate"==params.templateMode?isLeaveTemplate?(Attendance.Settings.leaveTemplateID=rdata.templateId,Attendance.Settings.leaveTemplate=params.templateMsg):isAbsentTemplate?(Attendance.Settings.absentTemplateID=rdata.templateId,Attendance.Settings.absentTemplate=params.templateMsg):isLeaveRevertTemplate?(Attendance.Settings.leaveRevertTemplateID=rdata.templateId,Attendance.Settings.leaveRevertTemplate=params.templateMsg):(Attendance.Settings.absentRevertTemplateID=rdata.templateId,Attendance.Settings.absentRevertTemplate=params.templateMsg):(Attendance.Settings.CustomizeTemplate.templateIdJSON[Attendance.Settings.CustomizeTemplate.templateType]=rdata.templateId,Attendance.Settings.CustomizeTemplate.templateMsgJSON[rdata.templateId]=params.templateMsg)})}},getTemplateFields:function(template,templateType){var fieldObj={System_Fields:{},System_Fields:{System_Fields:{}}},sysFields=fieldObj.System_Fields;return 7==templateType&&"graceMailTemplate"!=template||(sysFields.System_Fields.Employee_ID=ZPI18N.getString("zp.employeeid"),sysFields.System_Fields.Employee_DisplayName=ZPI18N.getString("zp.Empdname")),sysFields.System_Fields.Employee_FirstName=ZPI18N.getString("zp.employeefirstname"),sysFields.System_Fields.Employee_LastName=ZPI18N.getString("zp.employeelastname"),sysFields.System_Fields.Employee_MailID=ZPI18N.getString("zp.empemailid"),"graceMailTemplate"==template?(sysFields.System_Fields.ReportingTo_ID=ZPI18N.getString("zp.reportingtoid"),sysFields.System_Fields.ReportingTo_FirstName=ZPI18N.getString("zp.reportingtofname"),sysFields.System_Fields.ReportingTo_LastName=ZPI18N.getString("zp.reportingtolname"),sysFields.System_Fields.ReportingTo_DisplayName=ZPI18N.getString("zp.reportingtoname"),sysFields.System_Fields.ReportingTo_MailID=ZPI18N.getString("zp.reportingtomailid"),sysFields.System_Fields.FIRST_CHECKIN=ZPI18N.getString("zp.firstcheckin"),sysFields.System_Fields.LAST_CHECKOUT=ZPI18N.getString("zp.lastcheckout"),sysFields.System_Fields.Location=ZPI18N.getString("zp.location"),sysFields.System_Fields.CompanyLogo=ZPI18N.getString("zp.companylogo")):7!=templateType&&"shiftReminderTemplate"==template&&(sysFields.System_Fields.Shift_StartTime=ZPI18N.getString("zp.attendance.shiftStartTime"),sysFields.System_Fields.Shift_EndTime=ZPI18N.getString("zp.attendance.shiftEndTime"),sysFields.System_Fields.Shift_Name=ZPI18N.getString("zp.shiftname"),sysFields.System_Fields.CompanyLogo=ZPI18N.getString("zp.companylogo"),sysFields.System_Fields.Location=ZPI18N.getString("zp.location")),sysFields.System_Fields.Department=ZPI18N.getString("zp.department"),sysFields.System_Fields.Designation=ZPI18N.getString("zp.designation"),"graceMailTemplate"==template&&(1==templateType?(sysFields.System_Fields.DeductCount=ZPI18N.getString("zp.deductioncount"),sysFields.System_Fields.LeaveName=ZPI18N.getString("zp.leavename")):2==templateType?sysFields.System_Fields.DeductCount=ZPI18N.getString("zp.absentcount"):8!=templateType&&9!=templateType||(sysFields.System_Fields.RevertCount=ZPI18N.getString("zp.revertcount"),8==templateType&&(sysFields.System_Fields.LeaveName=ZPI18N.getString("zp.leavename")))),sysFields.System_Fields.Date=ZPI18N.getString("zp.date"),fieldObj},getTemplate:function(data){var params={conreqcsr:csrfToken};1==data.sendGraceMail&&(params.mode="getGraceTemplate");var templateIdArr=[];if(templateIdArr.push(data.leaveTemplateID),templateIdArr.push(data.absentTemplateID),data.shiftTemplateIDs)for(var templateType in data.shiftTemplateIDs)templateIdArr.push(data.shiftTemplateIDs[templateType]);params.templateIds=JSON.stringify(templateIdArr),$.post("/AttendanceSettingsAction.zp",params,function(rdata){if(Attendance.Settings.templateLoaded=!0,Attendance.Settings.leaveTemplate=rdata[data.leaveTemplateID],Attendance.Settings.absentTemplate=rdata[data.absentTemplateID],data.shiftTemplateIDs)for(var templateType in data.shiftTemplateIDs)Attendance.Settings.CustomizeTemplate.templateMsgJSON[data.shiftTemplateIDs[templateType]]=rdata[data.shiftTemplateIDs[templateType]]})},resetGraceTemplateFields:function(){Layout.Page.container.find("#graceMailToggleCont").addClass("DN"),Attendance.Settings.templateLoaded=!1,delete Attendance.Settings.leaveTemplateID,delete Attendance.Settings.absentTemplateID,delete Attendance.Settings.leaveRevertTemplateID,delete Attendance.Settings.absentRevertTemplateID,delete Attendance.Settings.leaveTemplate,delete Attendance.Settings.absentTemplate,delete Attendance.Settings.leaveRevertTemplate,delete Attendance.Settings.absentRevertTemplate},getGraceTemplates:function(data){if(1==data.sendGraceMail){var params={conreqcsr:csrfToken,mode:"getAttCustomTemplate"},templateIdArr=[];templateIdArr.push(data.leaveTemplateID),templateIdArr.push(data.absentTemplateID),templateIdArr.push(data.leaveRevertTemplateID),templateIdArr.push(data.absentRevertTemplateID),params.templateIds=JSON.stringify(templateIdArr),$.post("/AttendanceSettingsAction.zp",params,function(rdata){Attendance.Settings.templateLoaded=!0,Attendance.Settings.leaveTemplate=rdata[data.leaveTemplateID],Attendance.Settings.absentTemplate=rdata[data.absentTemplateID],Attendance.Settings.leaveRevertTemplate=rdata[data.leaveRevertTemplateID],Attendance.Settings.absentRevertTemplate=rdata[data.absentRevertTemplateID]})}},resetShiftReminderTemplateFields:function(){Attendance.Settings.CustomizeTemplate.templateMsgJSON={},Attendance.Settings.CustomizeTemplate.templateIdJSON={}},getShiftReminderTemplate:function(data){if(data.shiftRminder_TemplateIds){var shiftReminder_TemplateIds=data.shiftRminder_TemplateIds,params={conreqcsr:csrfToken,mode:"getAttCustomTemplate"},templateIdArr=[];for(var key in Attendance.Settings.CustomizeTemplate.templateMsgJSON={},shiftReminder_TemplateIds)shiftReminder_TemplateIds[key]&&"null"!=shiftReminder_TemplateIds[key]&&(templateIdArr.push(shiftReminder_TemplateIds[key]),Attendance.Settings.CustomizeTemplate.templateIdJSON[key]=shiftReminder_TemplateIds[key]);if(templateIdArr.length<=0)return;params.templateIds=JSON.stringify(templateIdArr),$.post("/AttendanceSettingsAction.zp",params,function(rdata){for(var i=0;i<templateIdArr.length;i++)rdata[templateIdArr[i]]&&(Attendance.Settings.CustomizeTemplate.templateMsgJSON[templateIdArr[i]]=rdata[templateIdArr[i]])})}}},FTPPlugin={initDataLoaded:!1,init:function(){FTPPlugin.LayoutId="#"+Layout.Page.container[0].id,FTPPlugin.initDataLoaded||(FTPPlugin.constructView(),FTPPlugin.fetchFTP(),FTPPlugin.getTimezoneList())},constructView:function(){var layout=Layout.Page.container;layout.find("select").select2({minimumResultsForSearch:5}),FTPPlugin.convertToTimepicker(layout.find("#ZPAtt_ftpRegularSyncTime"),!1),FTPPlugin.convertToTimepicker(layout.find("#ZPAtt_ftpDailyHrs"),!0),Attendance.CustomFireScroll.init(FTPPlugin.fetchMoreAuditData,$(FTPPlugin.LayoutId+" #ftpSync div.modal-body")),$(FTPPlugin.LayoutId).popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right",delay:{show:50,hide:50}}),$(FTPPlugin.LayoutId+" #syncFrequencyDiv input[type=radio][name=sss]").on("change",function(){FTPPlugin.syncFrequencyChanged()})},removeErrorMsgOnFocus:function(){$(FTPPlugin.LayoutId+" #ZPAtt_ftpHostName, #ZPAtt_ftpPortNo, #ZPAtt_ftpUserName, #ZPAtt_ftpPassword, #ZPAtt_ftpFileName, #ZPAtt_ftpFilePath, #ZPAtt_ftpDailyHrs, #ZPAtt_ftpRegularSyncTime, #ZPAtt_ftpInTypes, #ZPAtt_ftpOutTypes, #ZPAtt_ftpSkipRows, #ZPAtt_ftpEffectiveFrom").on("focus",function(ele){var selectedElementID=$(ele.currentTarget).attr("id");"ZPAtt_ftpInTypes"==selectedElementID||"ZPAtt_ftpOutTypes"==selectedElementID?$(FTPPlugin.LayoutId+" #ZPAtt_ftpInOutDiffErr").addClass("DN"):$(FTPPlugin.LayoutId+" #"+selectedElementID+"Err").addClass("DN")}),$("#ZPAtt_ftpFromTimezone").on("change",function(){$("#ZPAtt_ftpFromTimezoneErr").addClass("DN")}),$("#ZPAtt_ftpToTimezone").on("change",function(){$("#ZPAtt_ftpToTimezoneErr").addClass("DN")}),$("#ZPAtt_ftpDateFormat").on("change",function(){$("#ZPAtt_ftpDateFormatErr").addClass("DN")}),$("#ZPAtt_ftpDataMappingType1 select").on("change",function(ele){$(FTPPlugin.LayoutId+" #"+$(ele.currentTarget).attr("id")+"Err").addClass("DN")}),$("#ZPAtt_ftpDataMappingType2 select").on("change",function(ele){$(FTPPlugin.LayoutId+" #"+$(ele.currentTarget).attr("id")+"Err").addClass("DN")}),$("#ZPAtt_ftpDataMappingType3 select").on("change",function(ele){$(FTPPlugin.LayoutId+" #"+$(ele.currentTarget).attr("id")+"Err").addClass("DN")}),$("#ZPAtt_ftpDataMappingType4 select").on("change",function(ele){$(FTPPlugin.LayoutId+" #"+$(ele.currentTarget).attr("id")+"Err").addClass("DN")})},removeFocusListener:function(){$(FTPPlugin.LayoutId+" #ZPAtt_ftpHostName, #ZPAtt_ftpPortNo, #ZPAtt_ftpUserName, #ZPAtt_ftpPassword, #ZPAtt_ftpFileName, #ZPAtt_ftpFilePath, #ZPAtt_ftpDailyHrs, #ZPAtt_ftpRegularSyncTime, #ZPAtt_ftpInTypes, #ZPAtt_ftpOutTypes, #ZPAtt_ftpSkipRows, #ZPAtt_ftpEffectiveFrom").off("focus"),$("#ZPAtt_ftpFromTimezone").off("change"),$("#ZPAtt_ftpToTimezone").off("change"),$("#ZPAtt_ftpDateFormat").off("change"),$("#ZPAtt_ftpDataMappingType1 select").off("change"),$("#ZPAtt_ftpDataMappingType2 select").off("change"),$("#ZPAtt_ftpDataMappingType3 select").off("change"),$("#ZPAtt_ftpDataMappingType4 select").off("change")},isEditMode:!1,fetchFTP:function(){var param={mode:"getFTPConfiguration"};param[csrfParamName]=csrfToken,$(FTPPlugin.LayoutId+" #ZPAtt_ftpDisableGrp").addClass("DN"),$.post("/BiometricConfigAction.zp",param,function(rdata){0!=Object.keys(rdata.ftpConfig).length&&FTPPlugin.fetchFTPHeader(rdata.ftpConfig,!1===FTPPlugin.initDataLoaded),FTPPlugin.initDataLoaded=!0,FTPPlugin.cacheFTPData(rdata)})},refetchingFTPConfiguration:!1,refetchFTPConfiguration:function(){if(!FTPPlugin.refetchingFTPConfiguration){var param={mode:"getFTPConfiguration"};param[csrfParamName]=csrfToken,FTPPlugin.refetchingFTPConfiguration=!0,$.post("/BiometricConfigAction.zp",param,function(rdata){setTimeout(function(){FTPPlugin.refetchingFTPConfiguration=!1},1e3),FTPPlugin.additionalInfo=rdata.additionalInfo,FTPPlugin.constructHomePage()})}},cacheFTPData:function(rdata){FTPPlugin.isEditMode=Object.keys(rdata.ftpConfig).length>0,FTPPlugin.isEditMode?(FTPPlugin.ftpConfigData=rdata.ftpConfig,FTPPlugin.additionalInfo=rdata.additionalInfo,FTPPlugin.ftpConfig=rdata.ftpConfig,FTPPlugin.constructPageAfterDataFetch(),FTPPlugin.constructHomePage()):FTPPlugin.constructPageAfterDataFetch()},fetchFTPHeader:function(ftpConfig,isInitialLoad){var param={mode:"fetchFTPHeaders"};param[csrfParamName]=csrfToken,param.ftpDataObj=JSON.stringify(ftpConfig),FTPPlugin.fetchingFTPHeader=!0,$.post("/BiometricConfigAction.zp",param,function(rdata){if(FTPPlugin.fetchingFTPHeader=!1,rdata.returnCode)return FTPPlugin.isInErrorState=!0,void(isInitialLoad||FTPPlugin.displayFTPConnectionError(rdata.returnCode));FTPPlugin.headerArr=rdata.headerArr,FTPPlugin.constructDataMappingPage(rdata.headerArr)})},constructPageAfterDataFetch:function(){FTPPlugin.isEditMode?($(FTPPlugin.LayoutId+" #ZPAtt_ftpHomeIntro").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpHomeSummary").removeClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpShowSyncStatusBtn").removeClass("disabled"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDisableGrp").removeClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpAddEditBtn").text(ZPI18N.getString("zp.editdetails")),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDiableBtn").prop("checked",FTPPlugin.additionalInfo.isActive),FTPPlugin.additionalInfo.isActive?$(FTPPlugin.LayoutId+" #ZPAtt_ftpDisableGrp").attr("data-original-title",ZPI18N.getString("zp.disable")):$(FTPPlugin.LayoutId+" #ZPAtt_ftpDisableGrp").attr("data-original-title",ZPI18N.getString("zp.enable")),$(FTPPlugin.LayoutId+" #ZPAtt_ftpShowSyncStatusBtn").click(function(event){FTPPlugin.fetchSyncstatus(!1,!0)})):($(FTPPlugin.LayoutId+" #ZPAtt_ftpHomeSummary").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpHomeIntro").removeClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpShowSyncStatusBtn").addClass("disabled"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDisableGrp").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpAddEditBtn").text(ZPI18N.getString("zp.configure")))},constructHomePage:function(){$(FTPPlugin.LayoutId+" #ZPAtt_ftpHomeLastSync").text(FTPPlugin.additionalInfo.lastUpdatedTime),FTPPlugin.additionalInfo.nextUpdateTime&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpHomeNextSync").text(FTPPlugin.additionalInfo.nextUpdateTime),$(FTPPlugin.LayoutId+" #ZPAtt_ftpTotalCount").text(FTPPlugin.additionalInfo.totalCount),$(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncedCount").text(FTPPlugin.additionalInfo.syncedCount),$(FTPPlugin.LayoutId+" #ZPAtt_ftpToProcessCount").text(FTPPlugin.additionalInfo.inprogressCount),$(FTPPlugin.LayoutId+" #ZPAtt_ftpErrorCount").text(FTPPlugin.additionalInfo.errorCount)},disableFTP:function(){var param={mode:"disableFTPConfiguration"};param[csrfParamName]=csrfToken,param.configId=FTPPlugin.ftpConfig.configId,param.isDisable=!$(FTPPlugin.LayoutId+" #ZPAtt_ftpDiableBtn").prop("checked"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDiableBtn").prop("checked")?$(FTPPlugin.LayoutId+" #ZPAtt_ftpDisableGrp").attr("data-original-title",ZPI18N.getString("zp.disable")):$(FTPPlugin.LayoutId+" #ZPAtt_ftpDisableGrp").attr("data-original-title",ZPI18N.getString("zp.enable")),$.post("/BiometricConfigAction.zp",param,function(rdata){FTPPlugin.cacheFTPData(rdata.ftpConfig)})},getTimezoneList:function(){void 0===$(FTPPlugin.LayoutId+" #ZPAtt_ftpFromTimezone").data().list&&ZPeople.Request.send(ZPeople.COMMON_URL,{mode:"GET_TIMEZONE_LIST"},FTPPlugin.showTimezoneModal)},showTimezoneModal:function(data){if(data.success){var fromTimeZoneCont=$(FTPPlugin.LayoutId+" #ZPAtt_ftpFromTimezone");fromTimeZoneCont.data("list",data);var tZoneHtml='<option value="1">Select a timezone</option>';$.each(data.list,function(){ZPUtil.Validation.isEmpty(this.disName)||(tZoneHtml+='<option value="'+this.tzId+'">'+this.disName+"</option>")}),fromTimeZoneCont.html(tZoneHtml);var toTimeZoneCont=$(FTPPlugin.LayoutId+" #ZPAtt_ftpToTimezone");toTimeZoneCont.html(tZoneHtml),fromTimeZoneCont.select2("val",ZPeople.TIME.userTimeZone),toTimeZoneCont.select2("val",ZPeople.TIME.userTimeZone),null==toTimeZoneCont.select2("val")&&(fromTimeZoneCont.select2("val",0),toTimeZoneCont.select2("val",0))}},selectedTab:1,showConfigure:function(){FTPPlugin.initDataLoaded&&(FTPPlugin.resetPage(),FTPPlugin.fillValues(),FTPPlugin.isEditMode?($($(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigSteps").find("li")[1]).removeClass("disabled"),$($(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigSteps").find("li")[2]).removeClass("disabled")):($($(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigSteps").find("li")[1]).addClass("disabled"),$($(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigSteps").find("li")[2]).addClass("disabled")),$(FTPPlugin.LayoutId+" #ftpconfig").modal("show"))},fillValues:function(){FTPPlugin.isEditMode&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpEffectiveFromGrp").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpType").val(FTPPlugin.ftpConfigData.connectionType).change(),$(FTPPlugin.LayoutId+" #ZPAtt_ftpHostName").val(FTPPlugin.ftpConfigData.hostName),$(FTPPlugin.LayoutId+" #ZPAtt_ftpPortNo").val(FTPPlugin.ftpConfigData.portNo),$(FTPPlugin.LayoutId+" #ZPAtt_ftpUserName").val(FTPPlugin.ftpConfigData.userName),$(FTPPlugin.LayoutId+" #ZPAtt_ftpPassword").val(FTPPlugin.ftpConfigData.password),$(FTPPlugin.LayoutId+" #ZPAtt_ftpFileName").val(FTPPlugin.ftpConfigData.fileName),$(FTPPlugin.LayoutId+" #ZPAtt_ftpFilePath").val(FTPPlugin.ftpConfigData.filePath),FTPPlugin.syncFrequencyChanged()&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpProcessDay").val(FTPPlugin.ftpConfigData.scheduleDay).change(),1==FTPPlugin.ftpConfigData.scheduleType?($(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyOption").prop("checked",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrs").attr("disabled",!1),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrs").timepicker("setTime",Attendance.disTime(FTPPlugin.ftpConfigData.scheduleMinutes)),$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncOption").prop("checked",!1),$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").attr("disabled",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").val("")):($(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncOption").prop("checked",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").attr("disabled",!1),$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").timepicker("setTime",Attendance.disTime(FTPPlugin.ftpConfigData.scheduleMinutes)),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyOption").prop("checked",!1),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrs").attr("disabled",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrs").val("")),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDateFormat").val(FTPPlugin.ftpConfigData.dateFormat).change(),1==FTPPlugin.ftpConfigData.timeFormat?($(FTPPlugin.LayoutId+" #ZPAtt_ftp12HrsTimeFormat").prop("checked",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftp24HrsTimeFormat").prop("checked",!1)):($(FTPPlugin.LayoutId+" #ZPAtt_ftp24HrsTimeFormat").prop("checked",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftp12HrsTimeFormat").prop("checked",!1)),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataType").val(FTPPlugin.ftpConfigData.dataType).change(),FTPPlugin.ftpConfigData.columnDetails.checkInTypes&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpInTypes").val(FTPPlugin.ftpConfigData.columnDetails.checkInTypes),FTPPlugin.ftpConfigData.columnDetails.checkOutTypes&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpOutTypes").val(FTPPlugin.ftpConfigData.columnDetails.checkOutTypes),$(FTPPlugin.LayoutId+" #ZPAtt_ftpSkipRows").val(FTPPlugin.ftpConfigData.skipRows),$(FTPPlugin.LayoutId+" #ZPAtt_ftpFromTimezone").val(FTPPlugin.ftpConfigData.fromTimezone).change(),FTPPlugin.ftpConfigData.toTimezone?($(FTPPlugin.LayoutId+" #ZPAtt_ftpHasToTimezone").prop("checked",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpToTimezone").val(FTPPlugin.ftpConfigData.toTimezone).change(),$(FTPPlugin.LayoutId+" #ZPAtt_ftpToTimezoneDiv").removeClass("DN")):($(FTPPlugin.LayoutId+" #ZPAtt_ftpHasToTimezone").prop("checked",!1),$(FTPPlugin.LayoutId+" #ZPAtt_ftpToTimezoneDiv").addClass("DN")),$(FTPPlugin.LayoutId+" #ZPAtt_ftpLocationCol").val("-1").change(),FTPPlugin.ftpConfigData.columnDetails.locationCol&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpLocationCol").val(FTPPlugin.ftpConfigData.columnDetails.locationCol).change(),FTPPlugin.fillMappingPage())},fillMappingPage:function(){var tabGrpId="#ZPAtt_ftpDataMappingType"+FTPPlugin.ftpConfigData.dataType;$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpEmployeeIdCol").val(FTPPlugin.ftpConfigData.columnDetails.employeeIdCol).change(),$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpDownloadDateCol").val(FTPPlugin.ftpConfigData.columnDetails.downloadedTime).change(),1==FTPPlugin.ftpConfigData.dataType?($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDateTimeCol").val(FTPPlugin.ftpConfigData.columnDetails.punchCol).change(),$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDiffCol").val(FTPPlugin.ftpConfigData.columnDetails.punchTypeCol).change()):2==FTPPlugin.ftpConfigData.dataType?($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInDateTimeCol").val(FTPPlugin.ftpConfigData.columnDetails.checkInCol).change(),$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutDateTimeCol").val(FTPPlugin.ftpConfigData.columnDetails.checkOutCol).change()):3==FTPPlugin.ftpConfigData.dataType?($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInDateCol").val(FTPPlugin.ftpConfigData.columnDetails.checkInDateCol).change(),$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInTimeCol").val(FTPPlugin.ftpConfigData.columnDetails.checkInTimeCol).change(),$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutDateCol").val(FTPPlugin.ftpConfigData.columnDetails.checkOutDateCol).change(),$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutTimeCol").val(FTPPlugin.ftpConfigData.columnDetails.checkOutTimeCol).change()):4==FTPPlugin.ftpConfigData.dataType&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDateCol").val(FTPPlugin.ftpConfigData.columnDetails.punchDateCol).change(),$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchTimeCol").val(FTPPlugin.ftpConfigData.columnDetails.punchTimeCol).change(),$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDiffCol").val(FTPPlugin.ftpConfigData.columnDetails.punchTypeCol).change())},resetPage:function(){FTPPlugin.showtabs(1,!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigBody form.pad input").val(""),$(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigBody form.pad select").val("1").change(),$(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigBody span.ERR").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpProcessDay").val("0").change(),$(FTPPlugin.LayoutId+" #ZPAtt_ftpPassword").attr("type","password"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpProcessDayGrp").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpHasToTimezone").prop("checked",!0),FTPPlugin.syncIntervalChange($(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncOption")),$(FTPPlugin.LayoutId+" #ZPAtt_ftp12HrsTimeFormat").prop("checked",!0),FTPPlugin.selectedTab=1,FTPPlugin.dataAddedTab=1,FTPPlugin.reFetchDataHeader=!1},toTimezoneChange:function(){$(FTPPlugin.LayoutId+" #ZPAtt_ftpHasToTimezone").prop("checked")?$(FTPPlugin.LayoutId+" #ZPAtt_ftpToTimezoneDiv").removeClass("DN"):$(FTPPlugin.LayoutId+" #ZPAtt_ftpToTimezoneDiv").addClass("DN")},connectionTypeChange:function(){var connectionType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpType").val(),defaultPortNo=1==connectionType||2==connectionType?21:3==connectionType?990:22;$(FTPPlugin.LayoutId+" #ZPAtt_ftpPortNo").attr("placeholder",defaultPortNo)},togglePwdView:function(){var ele=$(FTPPlugin.LayoutId+" #ZPAtt_ftpPassword");"password"===ele.attr("type")?ele.attr("type","text"):ele.attr("type","password"),"password"===ele.attr("type")?$("#ZPAtt_ftpConfigBody i.IC-eye").attr("data-original-title",ZPI18N.getString("zp.showpassword")):$("#ZPAtt_ftpConfigBody i.IC-eye").attr("data-original-title",ZPI18N.getString("zp.hidepassword"))},syncIntervalChange:function(obj){"ZPAtt_ftpRegularSyncOption"==$(obj).attr("id")?($(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncOption").prop("checked",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").attr("disabled",!1),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyOption").prop("checked",!1),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrs").attr("disabled",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrs").val("")):($(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyOption").prop("checked",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrs").attr("disabled",!1),$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncOption").prop("checked",!1),$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").attr("disabled",!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").val(""))},convertToTimepicker:function(cont,showMeridian){cont.timepicker({defaultTime:"",showMeridian:showMeridian,disableMousewheel:!1,minuteStep:1})},scrollAuditIndex:0,fetchMoreAuditData:function(){FTPPlugin.auditData.length%50==0&&(FTPPlugin.scrollAuditIndex+=50,FTPPlugin.fetchSyncstatus(!0))},syncPeriodFilterChange:function(){if(3==$(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusPeriodFilter").val())return $("#ZPAtt_ftpSyncStatusFilterRow").addClass("DN"),void $("#ZPAtt_ftpSyncStatusCustomDatePicker").removeClass("DN");$("#ZPAtt_ftpSyncStatusCustomDateDisplay").addClass("DN"),FTPPlugin.fetchSyncstatus(!1,!0)},editCustomDates:function(){$("#ZPAtt_ftpSyncStatusFilterRow").addClass("DN"),$("#ZPAtt_ftpSyncStatusCustomDatePicker").removeClass("DN")},closeStatusCustomPicker:function(){$("#ZPAtt_ftpSyncStatusPeriodFilter").val(FTPPlugin.currentFilteredPeriod).change(),$("#ZPAtt_ftpSyncStatusFilterRow").removeClass("DN"),$("#ZPAtt_ftpSyncStatusCustomDatePicker").addClass("DN")},fetchCustomDate:function(){""!=$(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusFromDate").val()&&""!=$(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusToDate").val()&&($("#ZPAtt_ftpSyncStatusCustomDateDisplay").removeClass("DN"),$("#ZPAtt_ftpSyncStatusFilteredFromDate").text($(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusFromDate").val()),$("#ZPAtt_ftpSyncStatusFilteredToDate").text($(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusToDate").val()),$("#ZPAtt_ftpSyncStatusFilterRow").removeClass("DN"),$("#ZPAtt_ftpSyncStatusCustomDatePicker").addClass("DN"),FTPPlugin.fetchSyncstatus(!1,!0))},auditData:void 0,currentFilteredPeriod:1,fetchSyncstatus:function(isFromScroll,refetchData){if(FTPPlugin.initDataLoaded){isFromScroll||($(FTPPlugin.LayoutId+" #ZPAtt_ftpAuditTableBody").html(""),FTPPlugin.scrollAuditIndex=0,FTPPlugin.auditData=[]),$(FTPPlugin.LayoutId+" #ZPAtt_ftpShowSyncStatusBtn").unbind("click");var param={mode:"fetchSyncStatus"};param[csrfParamName]=csrfToken,FTPPlugin.currentFilteredPeriod=$(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusPeriodFilter").val();var syncStatusObj={};syncStatusObj.periodType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusPeriodFilter").val(),"3"==$(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusPeriodFilter").val()&&(syncStatusObj.startDate=$(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusFromDate").val(),syncStatusObj.endDate=$(FTPPlugin.LayoutId+" #ZPAtt_ftpSyncStatusToDate").val()),syncStatusObj.scrollAuditIndex=FTPPlugin.scrollAuditIndex+1,param.syncStatusObj=JSON.stringify(syncStatusObj),$.post("/BiometricConfigAction.zp",param,function(rdata){if($(FTPPlugin.LayoutId+" #ZPAtt_ftpAuditEmpty").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpAuditTable").removeClass("DN"),!rdata.auditData)return $(FTPPlugin.LayoutId+" #ZPAtt_ftpShowSyncStatusBtn").click(function(event){FTPPlugin.fetchSyncstatus(!1,!0)}),void(isFromScroll||($(FTPPlugin.LayoutId+" #ZPAtt_ftpAuditEmpty").removeClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpAuditTable").addClass("DN")));if(50===rdata.auditData.length&&Attendance.CustomFireScroll.reset(),isFromScroll)for(var index in rdata.auditData)FTPPlugin.auditData.push(rdata.auditData[index]);else FTPPlugin.auditData=rdata.auditData;FTPPlugin.constructAuditPage(rdata.auditData,isFromScroll)})}},constructAuditPage:function(auditDataArr,isFromScroll){for(var tableData="",index=0;index<auditDataArr.length;index++){var auditData=auditDataArr[index];tableData+='<tr class="ZPLRow">',tableData+="<td>"+auditData.fetchedFrom+"</td>",tableData+="<td>"+auditData.fetchedTo+"</td>",tableData+='<td><span class="blu">'+auditData.totalDataCount+"</span></td>",tableData+='<td><span class="grn">'+auditData.syncedDataCount+"</span></td>",tableData+="<td><span>"+auditData.inProgressDataCount+"</span></td>",tableData+='<td><span class="red">'+auditData.errorDataCount+"</span></td>",tableData+="<td><span>"+auditData.errorMessage+"</span></td>",tableData+="<td>"+auditData.timeOfAction+"</td>",auditData.errorDataCount>0?tableData+='<td><div class="over-display"><i class="IC-imprt gry" onclick="FTPPlugin.showExportPopup(\''+auditData.batchId+"')\"></i></div></td>":tableData+="<td></td>",tableData+="</tr>"}$(FTPPlugin.LayoutId+" #ZPAtt_ftpAuditLastSyncTime").text(FTPPlugin.additionalInfo.lastUpdatedTime),FTPPlugin.additionalInfo.nextUpdateTime&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpAuditNextSyncTime").text(FTPPlugin.additionalInfo.nextUpdateTime),$(FTPPlugin.LayoutId+" #ZPAtt_ftpAuditTableBody").append(tableData),$(FTPPlugin.LayoutId+" #ftpSync").modal("show"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpShowSyncStatusBtn").click(function(event){FTPPlugin.fetchSyncstatus(!1,!0)})},switchFTPConfiguration:function(){FTPPlugin.fetchingFTPHeader||FTPPlugin.validateError()?FTPPlugin.removeErrorMsgOnFocus():(FTPPlugin.removeFocusListener(),FTPPlugin.constructData())},validateError:function(){$(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigBody span.ERR").addClass("DN");var isError=!1;if(1==FTPPlugin.selectedTab)return""==$(FTPPlugin.LayoutId+" #ZPAtt_ftpHostName").val().trim()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpHostNameErr").removeClass("DN"),isError=!0),""==$(FTPPlugin.LayoutId+" #ZPAtt_ftpPortNo").val().trim()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpPortNoErr").removeClass("DN"),isError=!0),""==$(FTPPlugin.LayoutId+" #ZPAtt_ftpUserName").val().trim()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpUserNameErr").removeClass("DN"),isError=!0),""==$(FTPPlugin.LayoutId+" #ZPAtt_ftpPassword").val().trim()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpPasswordErr").removeClass("DN"),isError=!0),isError;if(2==FTPPlugin.selectedTab){""==$(FTPPlugin.LayoutId+" #ZPAtt_ftpFileName").val().trim()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpFileNameErr").removeClass("DN"),isError=!0),""==$(FTPPlugin.LayoutId+" #ZPAtt_ftpFilePath").val().trim()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpFilePathErr").removeClass("DN"),isError=!0);var scheduleType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncOption")[0].checked?2:1;if(1==scheduleType&&""==$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrs").val().trim())$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrsErr").removeClass("DN"),isError=!0;else if(2==scheduleType&&""==$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").val().trim())$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTimeErr").removeClass("DN"),isError=!0;else if(2==scheduleType){var scheduleMinutes=$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").val();AttendanceShift.convertTimePickValToMins(scheduleMinutes)<10&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpMinimumIntervalErr").removeClass("DN"),isError=!0)}return"1"==$(FTPPlugin.LayoutId+" #ZPAtt_ftpDateFormat").val()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpDateFormatErr").removeClass("DN"),isError=!0),"1"!=(dataType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataType").val())&&"4"!=dataType||""!=$(FTPPlugin.LayoutId+" #ZPAtt_ftpInTypes").val().trim()&&""!=$(FTPPlugin.LayoutId+" #ZPAtt_ftpOutTypes").val().trim()||($(FTPPlugin.LayoutId+" #ZPAtt_ftpInOutDiffErr").removeClass("DN"),isError=!0),"1"==$(FTPPlugin.LayoutId+" #ZPAtt_ftpFromTimezone").val()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpFromTimezoneErr").removeClass("DN"),isError=!0),$(FTPPlugin.LayoutId+" #ZPAtt_ftpHasToTimezone").prop("checked")&&"1"==$(FTPPlugin.LayoutId+" #ZPAtt_ftpToTimezone").val()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpToTimezoneErr").removeClass("DN"),isError=!0),""==$(FTPPlugin.LayoutId+" #ZPAtt_ftpSkipRows").val().trim()&&($(FTPPlugin.LayoutId+" #ZPAtt_ftpSkipRowsErr").removeClass("DN"),isError=!0),FTPPlugin.isEditMode||""!=$(FTPPlugin.LayoutId+" #ZPAtt_ftpEffectiveFrom").val()||($(FTPPlugin.LayoutId+" #ZPAtt_ftpEffectiveFromErr").removeClass("DN"),isError=!0),isError}if(3==FTPPlugin.selectedTab){var dataType,tabGrpId="#ZPAtt_ftpDataMappingType"+(dataType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataType").val());return"-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpEmployeeIdCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpEmployeeIdColErr").removeClass("DN"),isError=!0),"-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpDownloadDateCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpDownloadDateColErr").removeClass("DN"),isError=!0),1==dataType?("-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDateTimeCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDateTimeColErr").removeClass("DN"),isError=!0),"-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDiffCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDiffColErr").removeClass("DN"),isError=!0)):2==dataType?("-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutDateTimeCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutDateTimeColErr").removeClass("DN"),isError=!0),"-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInDateTimeCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInDateTimeColErr").removeClass("DN"),isError=!0)):3==dataType?("-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInDateCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInDateColErr").removeClass("DN"),isError=!0),"-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInTimeCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInTimeColErr").removeClass("DN"),isError=!0),"-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutDateCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutDateColErr").removeClass("DN"),isError=!0),"-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutTimeCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutTimeColErr").removeClass("DN"),isError=!0)):4==dataType&&("-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDateCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDateColErr").removeClass("DN"),isError=!0),"-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchTimeCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchTimeColErr").removeClass("DN"),isError=!0),"-1"==$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDiffCol").val()&&($(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDiffColErr").removeClass("DN"),isError=!0)),isError}},addFirstTabDetails:function(){FTPPlugin.isEditMode||1!=FTPPlugin.dataAddedTab||(FTPPlugin.ftpConfig={}),FTPPlugin.reFetchDataHeader=!1,!FTPPlugin.isEditMode&&(1==FTPPlugin.dataAddedTab||FTPPlugin.isInErrorState)||$(FTPPlugin.LayoutId+" #ZPAtt_ftpType").val()==FTPPlugin.ftpConfig.connectionType&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpHostName").val().trim()==FTPPlugin.ftpConfig.hostName&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpPortNo").val().trim()==FTPPlugin.ftpConfig.portNo&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpUserName").val().trim()==FTPPlugin.ftpConfig.userName&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpPassword").val().trim()==FTPPlugin.ftpConfig.password?FTPPlugin.isInErrorState&&(FTPPlugin.reFetchDataHeader=!0):FTPPlugin.reFetchDataHeader=!0;var connectionType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpType").val();FTPPlugin.ftpConfig.connectionType=connectionType;var hostName=$(FTPPlugin.LayoutId+" #ZPAtt_ftpHostName").val().trim();FTPPlugin.ftpConfig.hostName=hostName;var portNo=$(FTPPlugin.LayoutId+" #ZPAtt_ftpPortNo").val().trim();FTPPlugin.ftpConfig.portNo=portNo;var userName=$(FTPPlugin.LayoutId+" #ZPAtt_ftpUserName").val().trim();FTPPlugin.ftpConfig.userName=userName;var password=$(FTPPlugin.LayoutId+" #ZPAtt_ftpPassword").val().trim();FTPPlugin.ftpConfig.password=password},addSecondTabDetails:function(){FTPPlugin.isEditMode||(FTPPlugin.columnDetails={}),FTPPlugin.reFetchDataHeader=!1,!FTPPlugin.isEditMode&&(2==FTPPlugin.dataAddedTab||FTPPlugin.isInErrorState)||$(FTPPlugin.LayoutId+" #ZPAtt_ftpFileName").val().trim()==FTPPlugin.ftpConfig.fileName&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpFilePath").val().trim()==FTPPlugin.ftpConfig.filePath&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataType").val()==FTPPlugin.ftpConfig.dataType&&$(FTPPlugin.LayoutId+" #ZPAtt_ftpSkipRows").val().trim()==FTPPlugin.ftpConfig.skipRows?FTPPlugin.isInErrorState&&(FTPPlugin.reFetchDataHeader=!0):FTPPlugin.reFetchDataHeader=!0;var fileName=$(FTPPlugin.LayoutId+" #ZPAtt_ftpFileName").val().trim();FTPPlugin.ftpConfig.fileName=fileName;var filePath=$(FTPPlugin.LayoutId+" #ZPAtt_ftpFilePath").val().trim();FTPPlugin.ftpConfig.filePath=filePath;var scheduleType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncOption")[0].checked?2:1;FTPPlugin.ftpConfig.scheduleType=scheduleType;var scheduleMinutes=1==scheduleType?$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyHrs").val():$(FTPPlugin.LayoutId+" #ZPAtt_ftpRegularSyncTime").val();if(FTPPlugin.ftpConfig.scheduleMinutes=AttendanceShift.convertTimePickValToMins(scheduleMinutes),-1!=fileName.indexOf("DD")||-1!=fileName.indexOf("D")||-1!=fileName.indexOf("{DD}")||-1!=fileName.indexOf("{D}")){var scheduleDay=$(FTPPlugin.LayoutId+" #ZPAtt_ftpProcessDay").val();FTPPlugin.ftpConfig.scheduleDay=scheduleDay}var dateFormat=$(FTPPlugin.LayoutId+" #ZPAtt_ftpDateFormat").val();FTPPlugin.ftpConfig.dateFormat=dateFormat;var timeFormat=$(FTPPlugin.LayoutId+" #ZPAtt_ftp12HrsTimeFormat")[0].checked?1:2;FTPPlugin.ftpConfig.timeFormat=timeFormat;var dataType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataType").val();if(FTPPlugin.ftpConfig.dataType=dataType,"1"==dataType||"4"==dataType){var checkInTypes=$(FTPPlugin.LayoutId+" #ZPAtt_ftpInTypes").val();FTPPlugin.columnDetails.checkInTypes=checkInTypes;var checkOutTypes=$(FTPPlugin.LayoutId+" #ZPAtt_ftpOutTypes").val();FTPPlugin.columnDetails.checkOutTypes=checkOutTypes}var fromTimezone=$(FTPPlugin.LayoutId+" #ZPAtt_ftpFromTimezone").val();if(FTPPlugin.ftpConfig.fromTimezone=fromTimezone,delete FTPPlugin.ftpConfig.toTimezone,$(FTPPlugin.LayoutId+" #ZPAtt_ftpHasToTimezone").prop("checked")){var toTimezone=$(FTPPlugin.LayoutId+" #ZPAtt_ftpToTimezone").val();FTPPlugin.ftpConfig.toTimezone=toTimezone}var skipRows=$(FTPPlugin.LayoutId+" #ZPAtt_ftpSkipRows").val().trim();FTPPlugin.ftpConfig.skipRows=skipRows;var fileType=-1!=fileName.indexOf(".csv")?1:2;FTPPlugin.ftpConfig.fileType=fileType,FTPPlugin.isEditMode||(FTPPlugin.ftpConfig.fromDateToSync=$(FTPPlugin.LayoutId+" #ZPAtt_ftpEffectiveFrom").val(),FTPPlugin.ftpConfig.fromTimeToSync=0)},addThirdTabDetails:function(){var dataType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataType").val(),tabGrpId="#ZPAtt_ftpDataMappingType"+dataType;FTPPlugin.columnDetails.employeeIdCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpEmployeeIdCol").val(),delete FTPPlugin.columnDetails.locationCol,-1!=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpLocationCol").val()&&(FTPPlugin.columnDetails.locationCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpLocationCol").val()),FTPPlugin.columnDetails.downloadedTime=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpDownloadDateCol").val(),1==dataType?(FTPPlugin.columnDetails.punchCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDateTimeCol").val(),FTPPlugin.columnDetails.punchTypeCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDiffCol").val()):2==dataType?(FTPPlugin.columnDetails.checkOutCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutDateTimeCol").val(),FTPPlugin.columnDetails.checkInCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInDateTimeCol").val()):3==dataType?(FTPPlugin.columnDetails.checkInDateCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInDateCol").val(),FTPPlugin.columnDetails.checkInTimeCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckInTimeCol").val(),FTPPlugin.columnDetails.checkOutDateCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutDateCol").val(),FTPPlugin.columnDetails.checkOutTimeCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpCheckOutTimeCol").val()):4==dataType&&(FTPPlugin.columnDetails.punchDateCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDateCol").val(),FTPPlugin.columnDetails.punchTimeCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchTimeCol").val(),FTPPlugin.columnDetails.punchTypeCol=$(FTPPlugin.LayoutId+" "+tabGrpId+" #ZPAtt_ftpPunchDiffCol").val())},ftpConfig:{},columnDetails:{},constructData:function(){1==FTPPlugin.selectedTab?(FTPPlugin.addFirstTabDetails(),FTPPlugin.moveToNextTab()):2==FTPPlugin.selectedTab?(FTPPlugin.addSecondTabDetails(),FTPPlugin.moveToNextTab()):(FTPPlugin.addThirdTabDetails(),FTPPlugin.moveToNextTab())},moveToNextTab:function(skipCheckConfiguration){if(1==FTPPlugin.selectedTab||2==FTPPlugin.selectedTab){if(!skipCheckConfiguration&&(1==FTPPlugin.dataAddedTab||FTPPlugin.reFetchDataHeader)&&1==FTPPlugin.selectedTab)return void FTPPlugin.checkFTPConfiguration();if(!skipCheckConfiguration&&(2==FTPPlugin.dataAddedTab||FTPPlugin.reFetchDataHeader)&&2==FTPPlugin.selectedTab)return void FTPPlugin.establishFTPConnection(!0);FTPPlugin.isEditMode||$($(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigSteps").find("li")[FTPPlugin.selectedTab]).removeClass("disabled"),FTPPlugin.selectedTab==FTPPlugin.dataAddedTab&&(FTPPlugin.dataAddedTab=FTPPlugin.dataAddedTab+1),FTPPlugin.showtabs(FTPPlugin.selectedTab+1,!0)}else FTPPlugin.addFTP()},isInErrorState:!1,checkFTPConfiguration:function(){var param={mode:"checkFTPConfiguration"};param[csrfParamName]=csrfToken,param.ftpDataObj=JSON.stringify(FTPPlugin.ftpConfig),FTPPlugin.fetchingFTPHeader=!0,FTPPlugin.isInErrorState=!1,$.post("/BiometricConfigAction.zp",param,function(rdata){FTPPlugin.fetchingFTPHeader=!1,1==rdata.returnCode?FTPPlugin.moveToNextTab(!0):(FTPPlugin.isInErrorState=!0,FTPPlugin.displayFTPConnectionError(rdata.returnCode))})},displayFTPConnectionError:function(returnCode){101==returnCode||102==returnCode||103==returnCode||104==returnCode?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ftpconnectionerror")):105==returnCode||106==returnCode||107==returnCode||108==returnCode?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ftploginerror")):109==returnCode||110==returnCode||111==returnCode||112==returnCode?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ftpfileaccesserror")):113!=returnCode&&114!=returnCode&&115!=returnCode&&116!=returnCode||ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ftpfileaccesserror"))},showtabs:function(tabNum,skipAddPart){if(!(tabNum>FTPPlugin.dataAddedTab&&!FTPPlugin.isEditMode||FTPPlugin.fetchingFTPHeader)){if(FTPPlugin.isEditMode&&!skipAddPart){if(FTPPlugin.validateError()&&3!=FTPPlugin.selectedTab)return void FTPPlugin.removeErrorMsgOnFocus();if(1==FTPPlugin.selectedTab?FTPPlugin.addFirstTabDetails():2==FTPPlugin.selectedTab?FTPPlugin.addSecondTabDetails():FTPPlugin.addThirdTabDetails(),FTPPlugin.reFetchDataHeader)return void FTPPlugin.establishFTPConnection(!1,tabNum)}$(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigBody form.pad").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigSteps").find("li").removeClass("active"),$($(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigBody form.pad")[tabNum-1]).removeClass("DN"),$($(FTPPlugin.LayoutId+" #ZPAtt_ftpConfigSteps").find("li")[tabNum-1]).addClass("active"),3!=tabNum?$(FTPPlugin.LayoutId+" #connectSaveButton").text(ZPI18N.getString("zp.connectandnext")):$(FTPPlugin.LayoutId+" #connectSaveButton").text(ZPI18N.getString("zp.saveandnext")),FTPPlugin.selectedTab=tabNum}},fetchingFTPHeader:!1,establishFTPConnection:function(moveToNextTab,tabNo){var param={mode:"fetchFTPHeaders"};param[csrfParamName]=csrfToken,param.ftpDataObj=JSON.stringify(FTPPlugin.ftpConfig),FTPPlugin.fetchingFTPHeader=!0,FTPPlugin.isInErrorState=!1,$.post("/BiometricConfigAction.zp",param,function(rdata){if(FTPPlugin.fetchingFTPHeader=!1,rdata.returnCode)return FTPPlugin.isInErrorState=!0,void FTPPlugin.displayFTPConnectionError(rdata.returnCode);FTPPlugin.constructDataMappingPage(rdata.headerArr),moveToNextTab?FTPPlugin.moveToNextTab(!0):FTPPlugin.showtabs(tabNo,!0)})},constructDataMappingPage:function(headerArr){var dataType=FTPPlugin.ftpConfig.dataType;$(FTPPlugin.LayoutId+" #tabs3 div.label-body").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataMappingType"+dataType).removeClass("DN");var dataHeaders='<option value="-1">Select</option>';if(headerArr)for(var index=0;index<headerArr.length;index++)dataHeaders+='<option value="'+index+'">'+headerArr[index]+"  &nbsp;&nbsp; (Column: "+(index+1)+")</option>";$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataMappingType"+dataType+" select").html(dataHeaders),!FTPPlugin.isEditMode||FTPPlugin.isEditMode&&FTPPlugin.reFetchDataHeader?$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataMappingType"+dataType+" select").val("-1"):FTPPlugin.fillMappingPage()},syncFrequencyChanged:function(){return 1==$(FTPPlugin.LayoutId+" #ZPAtt_ftpDailyOption").prop("checked")?($(FTPPlugin.LayoutId+" #ZPAtt_ftpProcessDayGrp").removeClass("DN"),!0):($(FTPPlugin.LayoutId+" #ZPAtt_ftpProcessDayGrp").addClass("DN"),!1)},dataTypeChange:function(){var dataType=$(FTPPlugin.LayoutId+" #ZPAtt_ftpDataType").val();"1"==dataType||"4"==dataType?$(FTPPlugin.LayoutId+" #ZPAtt_ftpInOutDiff").removeClass("DN"):$(FTPPlugin.LayoutId+" #ZPAtt_ftpInOutDiff").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpSampleDataType table").addClass("DN"),$(FTPPlugin.LayoutId+" #ZPAtt_ftpSampleDataType"+dataType).removeClass("DN")},addFTP:function(){var mode=FTPPlugin.ftpConfig.configId?"editFTPConfiguration":"addFTPConfiguration",objName=FTPPlugin.ftpConfig.configId?"editFTPConfig":"addFTPConfig",param={mode:mode};param[csrfParamName]=csrfToken,FTPPlugin.ftpConfig.configId&&(param.configId=FTPPlugin.ftpConfig.configId),FTPPlugin.ftpConfig.columnDetails=FTPPlugin.columnDetails,param[objName]=JSON.stringify(FTPPlugin.ftpConfig),$.post("/BiometricConfigAction.zp",param,function(rdata){FTPPlugin.cacheFTPData(rdata.result),FTPPlugin.fetchFTPHeader(rdata.result.ftpConfig),$(FTPPlugin.LayoutId+" #ftpconfig").modal("hide")})},deleteFTP:function(){var param={mode:"deleteFTPConfiguration"};param[csrfParamName]=csrfToken,param.configId=FTPPlugin.ftpConfig.configId,$.post("/BiometricConfigAction.zp",param,function(rdata){})},showExportPopup:function(batchId){var hideOpt={};hideOpt.tohide=new Array("tsv"),FTPPlugin.exportBatchId=batchId,ZPExport.showExportContainer(FTPPlugin.exportAuditErrorLog,null,"",hideOpt)},exportAuditErrorLog:function(){var form=$(FTPPlugin.LayoutId+" #ZPAtt_ftpExport")[0],expType=$("#zp_export_container").find("input[name='zp_ftype']:checked").val(),path="mode=ftpAuditErrorExport&batchId="+FTPPlugin.exportBatchId+"&exportType="+expType;0===$(form).children().length&&$(form).append("<input type='hidden' name='conreqcsr' value='"+csrfToken+"'>"),path=encodeURI(path),form.action="AttendanceExport.zp?"+path,form.submit()}};