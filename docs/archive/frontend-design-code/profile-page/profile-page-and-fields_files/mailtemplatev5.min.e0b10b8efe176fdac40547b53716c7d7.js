var ZPA_Editor={FIELDS_LIST:[],initiateEditor:function(mode,formId,getEditorContent,editorId,pageContainer){var getBodyObj=void 0!=pageContainer?pageContainer:ZPA_Common.getMainContainer();getBodyObj.find("#msgTemplate").addClass("DN");var insertDivObj=getBodyObj.find("#msgEditor");void 0===editorId&&(editorId="editorTextArea_"+ZPA_Messages.getCurrentMode(),"messagetemplate"!=mode&&"postmessage"!=mode||(editorId="editorTextArea_"+mode,mode="postmessage")),getBodyObj.find("[id="+editorId+"]").remove(),ZPA_Editor.destroy();var getEditorHtml=ZPA_Editor.getEditorBaseHtml(editorId,mode);insertDivObj.html(getEditorHtml),ZPA_Editor.editorFieldsLoad(mode,formId,pageContainer),insertDivObj.removeClass("DNI"),ZPA_Editor.createEditor(editorId,getEditorContent,mode)},destroy:function(){var editor=ZPA_Common.getMainContainer().find("#msgEditor");ZPeopleComponents.isComponent(editor.find("#merge_fields"))&&ZPeopleComponents.select(editor.find("#merge_fields")).destroy(),ZPeopleComponents.isComponent(editor.find("#field_list"))&&ZPeopleComponents.select(editor.find("#field_list")).destroy()},createEditor:function(editorBoxId,getEditorContent,pageMode){ZPA_Messages.getCurrentMode();var isPostMessage=!1,isSmileyNeeded=!0;void 0!=pageMode&&"postmessage"==pageMode&&(pageMode,isPostMessage=!0,isSmileyNeeded=!1),ZPA_Common.getMainContainer().find("#"+editorBoxId).html("");var initobject;initobject={id:editorBoxId,mode:"richtext",content:getEditorContent,editorheight:250,avoidMoreOption:!0},editor=ZPUtil.createZEEditor(initobject,!1,!1,!1,isSmileyNeeded,!1,isPostMessage,!0)},getEditorBaseHtml:function(editorId,mode){return'<div class="zpl_msghd">\n                    <div class="zpl_secn zpl_twoclum">\n                      <div>\n                        <label>'+ZPI18N.getString("zp.availablemergefields")+'</label>\n                        <select id = "merge_fields"></select>\n                      </div>\n                      <div>\n                        <label>'+ZPI18N.getString("zp.selectfield")+'</label>\n                        <select id="field_list" placeholder="'+ZPI18N.getString("zp.select")+'"></select>\n                      </div>\n                      <div>\n                        <label>'+ZPI18N.getString("zp.fieldvalue")+'</label><input id="fieldLabelBox" readonly="" class="ztextbox" type="text">\n                      </div>\n                      <div class=""><label></label><button onclick="ZPA_Editor.insertText()" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.insert")+'</button></div>\n                      <div class="zpl_icncnt">\n                        <i class="PI_maxmz" onclick="ZPA_Editor.showMinMaxEditor(this)" id="minmaxIc"  title="'+ZPI18N.getString("zp.expand")+'"></i>\n                      </div>\n                    </div>\n                  </div>\n                 <div class="zpl_msgtxt"><div class="zpl_feedCompsr zpl_edtrply tlbarTop"><div class="feedCompsr_area"><div class="feedCompsr_cont" id='+editorId+"> </div></div></div></div>"},showMinMaxEditor:function(thisObj){var mode=ZPA_Messages.getCurrentMode(),editorDiv=$(thisObj).closest("#msgEditor"),editorAreaDiv=editorDiv.find("#editorTextArea_"+mode);if(editorAreaDiv.height()<="250"){editorDiv.find("#minmaxIc").removeClass("PI_maxmz"),editorDiv.find("#minmaxIc").addClass("PI_minmz");var currPageHeight=$(thisObj).closest(".zpl_crdcnt").height(),adjHeight=currPageHeight<500?500:Math.round(currPageHeight)-75;editorAreaDiv.height(adjHeight+"px"),$(thisObj).attr("title",ZPI18N.getString("zp.shrink"))}else editorDiv.find("#minmaxIc").removeClass("PI_minmz"),editorDiv.find("#minmaxIc").addClass("PI_maxmz"),editorAreaDiv.height("250px"),$(thisObj).attr("title",ZPI18N.getString("zp.expand"));editorDiv[0].scrollIntoView({behavior:"smooth",block:"end"})},getViewTemplateHtml:function(content){return'<div id="viewTempDiv" style="padding:10px; min-height:200px;">'+content+"</div>"},editorFieldsLoad:function(mode,formId,pageContainer){if(void 0!=formId&&""!=formId&&void 0==ZPA_Editor.FIELDS_LIST[formId]){var params={formId:formId,method:"getFormFields",mode:"editorFields",conreqcsr:csrfToken};$.ajax({url:"/getFormFields.zp",type:"POST",data:params,success:function(data){ZPA_Editor.FIELDS_LIST[formId]=data,ZPA_Editor.setFormFields(mode,formId,pageContainer)}})}else ZPA_Editor.setFormFields(mode,formId,pageContainer)},setFormFields:function(mode,formId,pageContainer){var editor=(void 0!=pageContainer?pageContainer:ZPA_Common.getMainContainer()).find("#msgEditor"),merge_fields=[],baseformkey="";if("attReminderTemplate"===mode||"graceMailTemplate"===mode||mode===ZP_Automation_Mode.OTPOLICY_MAILTEMPLATE||mode===ZP_Automation_Mode.AUTOSHIFTASSIGN_MAILTEMPLATE){(formDtls=[]).push({id:"other_fields",name:ZPI18N.getString("zp.systemfields")});let formListBxProp={options:formDtls,dataMapping:{label:"name",value:"id"}};ZPA_Common.ZCompProp.loadSelectListProp(formListBxProp),ZPeopleComponents.select(editor.find("#merge_fields"),formListBxProp),"attReminderTemplate"===mode?ZPA_Editor.setSystemFields(AttShiftCommon.CheckInOutReminders.MailTemplate.getTemplateFields()):mode===ZP_Automation_Mode.OTPOLICY_MAILTEMPLATE?ZPA_Editor.setSystemFields(AttPolicy.OTPolicy.MailTemplate.getTemplateFields()):mode===ZP_Automation_Mode.AUTOSHIFTASSIGN_MAILTEMPLATE?ZPA_Editor.setSystemFields(AutoShiftAssignment.MailTemplate.getTemplateFields()):ZPA_Editor.setSystemFields(AttPolicy.GracePeriod.MailTemplate.getTemplateFields())}else if("absmailtemplate"===mode){var param={mode:"getAbsSchSysFields",conreqcsr:csrfToken,value:AttAuto.AbsentSch.MailTemplate.notifySel,type:AttAuto.AbsentSch.MailTemplate.singleOrConsecVal};ZPeople.Request.send("/AttendanceSettingsAction.zp",param,ZPA_Editor.setSystemFields),(formDtls=[]).push({id:"other_fields",name:ZPI18N.getString("zp.systemfields")});let formListBxProp={options:formDtls,dataMapping:{label:"name",value:"id"}};ZPA_Common.ZCompProp.loadSelectListProp(formListBxProp),formListBxProp.dropdownList.appendTo="#msgEditor",ZPeopleComponents.select(editor.find("#merge_fields"),formListBxProp)}else if("liveLocTrkMailTemplate"===mode){param={mode:"getliveLocTrkSysFields",conreqcsr:csrfToken,value:AttPolicy.LiveLocationTrk.notifySel};ZPeople.Request.send("/AttendanceSettingsAction.zp",param,ZPA_Editor.setSystemFields),(formDtls=[]).push({id:"other_fields",name:ZPI18N.getString("zp.systemfields")});let formListBxProp={options:formDtls,dataMapping:{label:"name",value:"id"}};ZPA_Common.ZCompProp.loadSelectListProp(formListBxProp),formListBxProp.dropdownList.appendTo="#msgEditor",ZPeopleComponents.select(editor.find("#merge_fields"),formListBxProp)}else if(mode==ZP_Automation_Mode.EMAILSCHEDULER||mode==ZP_Automation_Mode.REPORTSCHEDULER){ZPeople.Request.send("/getSysFields.zp",{method:"getSystemField",conreqcsr:csrfToken},ZPA_Editor.setSystemFields),(formDtls=[]).push({id:"other_fields",name:ZPI18N.getString("zp.systemfields")});let formListBxProp={options:formDtls,dataMapping:{label:"name",value:"id"},width:215};ZPA_Common.ZCompProp.loadSelectListProp(formListBxProp),ZPeopleComponents.select(editor.find("#merge_fields"),formListBxProp)}else if("paCustomizeTemplate"==mode){(formDtls=[]).push({id:"other_fields",name:ZPI18N.getString("zp.systemfields")});let formListBxProp={options:formDtls,dataMapping:{label:"name",value:"id"}};ZPA_Common.ZCompProp.loadSelectListProp(formListBxProp),formListBxProp.dropdownList.appendTo="#msgEditor",ZPeopleComponents.select(editor.find("#merge_fields"),formListBxProp),ZPA_Editor.setSystemFields(PMSSetting.getSystemFields())}else if("cfsCustomizeTemplate"==mode){(formDtls=[]).push({id:"other_fields",name:ZPI18N.getString("zp.systemfields")});let formListBxProp={options:formDtls,dataMapping:{label:"name",value:"id"}};ZPA_Common.ZCompProp.loadSelectListProp(formListBxProp),formListBxProp.dropdownList.appendTo="#msgEditor",ZPeopleComponents.select(editor.find("#merge_fields"),formListBxProp),ZPA_Editor.setSystemFields(PMSSetting.getCRSystemFields())}else if("obFeedEditorTemplate"==mode){(formDtls=[]).push({id:"other_fields",name:ZPI18N.getString("zp.systemfields")});let formListBxProp={options:formDtls,dataMapping:{label:"name",value:"id"}};ZPA_Common.ZCompProp.loadSelectListProp(formListBxProp),formListBxProp.dropdownList.appendTo="#msgEditor",ZPeopleComponents.select(editor.find("#merge_fields"),formListBxProp);var fieldObj={System_Fields:{}};fieldObj.System_Fields={System_Fields:{"FEED USER MENTION":ZPI18N.getString("zp.feedusermention")}},ZPA_Editor.setSystemFields(fieldObj)}else if(void 0!=formId&&""!=formId){$.each(ZPA_Editor.FIELDS_LIST[formId].formNameJArray,function(ind,formNameJObj){$.each(formNameJObj,function(formNameKey,formObj){var fieldObj={};fieldObj.value=formNameKey,fieldObj.label=formObj.lookupFullName,merge_fields.push(fieldObj),0==ind&&(baseformkey=formNameKey)})}),merge_fields.push({value:"other_fields",label:ZPI18N.getString("zp.systemfields")}),ZPA_Editor.setFieldsList("",{value:baseformkey},formId,pageContainer);let formlistProp={options:merge_fields,dataMapping:{label:"label",value:"value"},change:ZPA_Editor.setFieldsList,formId:formId,pageContainer:pageContainer,width:215};ZPA_Common.ZCompProp.loadSelectListProp(formlistProp),ZPeopleComponents.select(editor.find("#merge_fields"),formlistProp)}else if("announcementMailTemplate"==mode){let fieldData=Announcement.Template.getAnnouncementSysFields();var formDtls;(formDtls=[]).push({id:"other_fields",name:ZPI18N.getString("zp.systemfields")});let formListBxProp={options:formDtls,dataMapping:{label:"name",value:"id"}};ZPA_Common.ZCompProp.loadSelectListProp(formListBxProp),formListBxProp.dropdownList.appendTo="#msgEditor",ZPeopleComponents.select(editor.find("#merge_fields"),formListBxProp),ZPA_Editor.setSystemFields(fieldData)}else"RL_PUBLISHED"===mode&&Compensation.MailNotifications.mergeFieldsNotificationReq(mode).then(mergeFields=>{for(const formObj of mergeFields)merge_fields.push({value:formObj.formKey,label:formObj.displayName});const formSelectProps={options:merge_fields,selectedValue:"",dataMapping:{label:"label",value:"value"},change:(event,data)=>{const editor=(pageContainer||ZPA_Common.getMainContainer()).find("#msgEditor");ZPeopleComponents.isComponent(editor.find("#field_list"))&&ZPeopleComponents.select(editor.find("#field_list")).destroy();const selectedValue=data.value;for(const formObj of mergeFields)if(formObj.formKey===selectedValue){const fields=formObj.fields;let options=[];if(Array.isArray(fields))for(const group of fields){const groupName=Object.keys(group)[0];Object.entries(group[groupName]).map(([fieldKey,displayName])=>{options.push({value:fieldKey,label:displayName,optgroupLabel:groupName})})}else Object.entries(fields).map(([fieldKey,displayName])=>{options.push({value:fieldKey,label:displayName})});const fieldSelectProps={options:options,pageContainer:pageContainer,dataMapping:{label:"label",value:"value",optgroupLabel:"optgroupLabel"},change:ZPA_Editor.showFieldValue,selectedValue:"",width:215,placeholder:ZPI18N.getString("zp.select")};ZPA_Common.ZCompProp.loadSelectListProp(fieldSelectProps),ZPeopleComponents.select(editor.find("#field_list"),fieldSelectProps),editor.find("#fieldLabelBox").val("");break}},pageContainer:pageContainer,width:215};ZPA_Common.ZCompProp.loadSelectListProp(formSelectProps),ZPeopleComponents.select(editor.find("#merge_fields"),formSelectProps).setValue(mergeFields[0].formKey)})},setSystemFields:function(data){ZPA_Common.getPageMode();var editor=ZPA_Common.getMainContainer().find("#msgEditor"),sysFields=[];void 0!=data&&$.each(data.System_Fields,function(fieldKey,systemFieldObj){$.each(systemFieldObj,function(key,value){var sysObjDtl={};sysObjDtl.id=key,sysObjDtl.name=value,sysObjDtl.type=fieldKey,sysFields.push(sysObjDtl)})});let fieldListBxProp={options:sysFields,dataMapping:{label:"name",value:"id",optgroupLabel:"type"},change:ZPA_Editor.showFieldValue,selectedValue:"",width:215,placeholder:ZPI18N.getString("zp.select")};ZPA_Common.ZCompProp.loadSelectListProp(fieldListBxProp),ZPeopleComponents.select(editor.find("#field_list"),fieldListBxProp),editor.find("#fieldLabelBox").val("")},setFieldsList:function(event,data,formId,pageContainer){var editor=(void 0!=pageContainer?pageContainer:ZPA_Common.getMainContainer()).find("#msgEditor");ZPeopleComponents.isComponent(editor.find("#field_list"))&&ZPeopleComponents.select(editor.find("#field_list")).destroy(),formId=void 0!=formId?formId:data.options.formId;var isOnboarding=settingsUrlProps.currentMode===NewZPOnboarding.MODE,field_arr=[];if("other_fields"==data.value){var sysFields=ZPA_Editor.FIELDS_LIST[formId].systemFieldsJArray;if($.each(sysFields,function(index,sysFldAry){$.each(sysFldAry,function(optGrp,syFldDtl){var sysFldKeys=Object.keys(syFldDtl);$.each(sysFldKeys,function(ind,sysKey){var fldKey=sysFldKeys[ind];if(!isOnboarding||!NewZPOnboarding.iscandidateemail||"companyLogo"!=fldKey){var field_obj={};field_obj.value=fldKey,field_obj.label=syFldDtl[fldKey],field_obj.optgroupLabel=optGrp,field_arr.push(field_obj)}})})}),isOnboarding){var optGrp=ZPI18N.getString("zp.Onboarding"),optjson={CandidateInvitationURL:ZPI18N.getString("zp.candinvlink"),CandidateLoginURL:ZPI18N.getString("zp.candloginlink"),EmployeeOnboardingURL:ZPI18N.getString("zp.emponblink"),CandidateHRPartner:ZPI18N.getString("zp.candhrmail")};$.each(optjson,function(fldKey,label){var field_obj={};field_obj.value=fldKey,field_obj.label=label,field_obj.optgroupLabel=optGrp,field_arr.push(field_obj)})}}else{var fields=ZPA_Editor.FIELDS_LIST[formId].formComponentJObj[data.value];$.each(fields,function(multiFormsName,fieldsArray){$.each(fieldsArray,function(indx,secFieldsObj){$.each(secFieldsObj,function(sectionName,fieldsObj){var field_obj={};field_obj.value=fieldsObj.label,field_obj.label=fieldsObj.displayName,field_obj.optgroupLabel=indx,field_arr.push(field_obj)})})})}let fieldlstProp={options:field_arr,dataMapping:{label:"label",value:"value",optgroupLabel:"optgroupLabel"},change:ZPA_Editor.showFieldValue,selectedValue:"",pageContainer:pageContainer,width:215,placeholder:ZPI18N.getString("zp.select")};ZPA_Common.ZCompProp.loadSelectListProp(fieldlstProp),ZPeopleComponents.select(editor.find("#field_list"),fieldlstProp),editor.find("#fieldLabelBox").val("")},showFieldValue:function(event,data){(void 0!=event&&void 0!=event.detail.options.pageContainer?event.detail.options.pageContainer:ZPA_Common.getMainContainer()).find("#msgEditor").find("#fieldLabelBox").val("${"+data.value+"}")},insertText:function(){editor.insertHTML(ZPA_Common.getMainContainer().find("#msgEditor").find("#fieldLabelBox").val())}},ZPA_Messages={RECIPIENT_ADDRESS:{},FORMFIELD_DTLS:{},HRCASE_NOTIFICATION:"hrcase_mailalert",OFCREADINESS_NOTIFICATION:"officereadiness_mailalert",TIMESHEET_NOTIFICATION:"timetracker_custappmail",OFFBOARDING_NOTIFICATION:"offboarding_notification",APPOINTMENT_NOTIFICATION:"appointment_notification",MAILADDRESS_KEY:["sysConfList","system","roles","departments","groups","locations","formfields"],getMessageTemplate:function(currMode,tabId){var msgTemp='<div class="zpl_secn zpl_mailtmp"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.from")+'</label></div><div><div class="zpl_idiv"><select id="from_address" data-width="350"></select>';if(currMode!=ZP_Automation_Mode.EMAILALERT&&currMode!=ZP_Automation_Mode.APPROVAL&&currMode!=ZP_Automation_Mode.EMAILSCHEDULER&&currMode!=ZP_Automation_Mode.REPORTSCHEDULER&&currMode!=ZP_Automation_Mode.OFFBOARDING_APPROVAL&&currMode!=ZPA_Messages.APPOINTMENT_NOTIFICATION||(ZPA_FromAddress.VERIFIED_DOMAINS.length>0&&(msgTemp+='<a class="zpl_lnkbg" onclick="ZPA_FromAddress.constructFromAddressPopUp(true)"><i class="PI_plus"></i></a>'),currMode==ZP_Automation_Mode.OFFBOARDING_APPROVAL?msgTemp+='<div class="zpl_cc" id="addRecipient"><span>'+ZPI18N.getString("zp.add")+':</span><a class="zpl_lnk" target="cc" onclick="ZPA_Messages.enableAddressBox(this)">'+ZPI18N.getString("zp.cc")+'</a><a class="zpl_lnk" target="bcc" onclick="ZPA_Messages.enableAddressBox(this)">'+ZPI18N.getString("zp.bcc")+"</a></div>":currMode==ZPA_Messages.APPOINTMENT_NOTIFICATION?msgTemp+="":msgTemp+='<div class="zpl_cc" id="addRecipient"><span>'+ZPI18N.getString("zp.add")+':</span><a class="zpl_lnk" target="cc" onclick="ZPA_Messages.enableAddressBox(this)">'+ZPI18N.getString("zp.cc")+'</a><a class="zpl_lnk" target="bcc" onclick="ZPA_Messages.enableAddressBox(this)">'+ZPI18N.getString("zp.bcc")+'</a><a class="zpl_lnk" target="reply" onclick="ZPA_Messages.enableAddressBox(this)">'+ZPI18N.getString("zp.replyto")+"</a></div>"),msgTemp+="</div></div></div>",msgTemp+='<div class="zpl_secn zpl_mailtmp"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.to")+'</label></div><div><div id="to_grp" class="zpl_inpgrp">',currMode==ZP_Automation_Mode.OFFBOARDING_APPROVAL){msgTemp+='<input name="ofr_notify_to" toSysVal="PEOPLE-APPROVER" autocomplete = "off" type="text" class="ztextbox"  value="'+ZPI18N.getString("zp.currentapprover")+'" disabled = "disabled"/>'}else msgTemp+='<div class="zpl_frmctrl" id="to_list" onmouseover="ZPA_Messages.showLink(this)" onmouseout="ZPA_Messages.hideLink(this)"><a elem="addLnk" class="zpl_lnk DN" onclick="ZPA_Messages.constructContactEmail(this, \'to_grp\')">'+ZPI18N.getString("zp.addconteml")+'</a></div><a class="grp_add" id="to_pop" targetid="to_grp" onclick="ZPA_TabbedListBox.initializeTabPanel(this, \'recipient\', \'to_tabPanel\', \'to_pop\', \'to_list\')"><i class="PI_addlist"></i></a><div id="to_tabPanel"></div>';return msgTemp+="</div></div></div>",msgTemp+='<div class="zpl_secn zpl_mailtmp DNI" id="ccDiv" name="otherrecip"><div><label>'+ZPI18N.getString("zp.cc")+'</label></div><div><div id="cc_grp" class="zpl_inpgrp" onmouseover="ZPA_Messages.showLink(this)" onmouseout="ZPA_Messages.hideLink(this)"><div class="zpl_frmctrl" id="cc_list"><a elem="addLnk" class="zpl_lnk DN" onclick="ZPA_Messages.constructContactEmail(this, \'cc_grp\')">'+ZPI18N.getString("zp.addconteml")+'</a></div><a class="grp_add" id="cc_pop" targetid="cc_grp" onclick="ZPA_TabbedListBox.initializeTabPanel(this, \'recipient\', \'cc_tabPanel\', \'cc_pop\', \'cc_list\')"><i class="PI_addlist"></i></a><div id="cc_tabPanel"></div></div></div></div>',msgTemp+='<div class="zpl_secn zpl_mailtmp DNI" id="bccDiv" name="otherrecip"><div><label>'+ZPI18N.getString("zp.bcc")+'</label></div><div><div id="bcc_grp" class="zpl_inpgrp" onmouseover="ZPA_Messages.showLink(this)" onmouseout="ZPA_Messages.hideLink(this)"><div class="zpl_frmctrl" id="bcc_list"><a elem="addLnk" class="zpl_lnk DN" onclick="ZPA_Messages.constructContactEmail(this, \'bcc_grp\')">'+ZPI18N.getString("zp.addconteml")+'</a></div><a class="grp_add" id="bcc_pop" targetid="bcc_grp" onclick="ZPA_TabbedListBox.initializeTabPanel(this, \'recipient\', \'bcc_tabPanel\', \'bcc_pop\', \'bcc_list\')"><i class="PI_addlist"></i></a><div id="bcc_tabPanel"></div></div></div></div>',msgTemp+='<div class="zpl_secn zpl_mailtmp DNI" id="replyDiv" name="otherrecip"><div><label>'+ZPI18N.getString("zp.replyto")+'</label></div><div><div id="reply_grp" class="zpl_inpgrp" onmouseover="ZPA_Messages.showLink(this)" onmouseout="ZPA_Messages.hideLink(this)"><div class="zpl_frmctrl" id="reply_list" ><a elem="addLnk" class="zpl_lnk DN" onclick="ZPA_Messages.constructContactEmail(this, \'reply_grp\')">'+ZPI18N.getString("zp.addconteml")+'</a></div><a class="grp_add" id="reply_pop" targetid="reply_grp" onclick="ZPA_TabbedListBox.initializeTabPanel(this, \'recipient\', \'reply_tabPanel\', \'reply_pop\', \'reply_list\')"><i class="PI_addlist"></i></a><div id="reply_tabPanel"></div></div></div></div>',msgTemp+='<div class="zpl_secn zpl_mailtmp"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.subject")+'</label></div><div><div class="ztextbox--group zh-alignright zpl_inpticfild"><i class="ztextbox__icon PI_addlist" style="width:50px; justify-content:center;" id="sub_pop" onclick="ZPA_Messages.initiateTabPanel(\'sub_tabpanel\', \'sub_pop\')"></i><input type="text" id="sub_list" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade()"><div id="sub_tabpanel"></div></div></div></div>',currMode==ZP_Automation_Mode.EMAILALERT||currMode==ZP_Automation_Mode.APPROVAL||currMode==ZP_Automation_Mode.OFFBOARDING_APPROVAL?msgTemp+='<div class="zpl_secn zpl_mailtmp"><div><label>'+ZPI18N.getString("zp.emailbody")+'</label></div><div><div class="zpl_idiv"><select id="chooseTemplate" data-width="250"></select><div id="tempAnker" class="zpl_cc DNI"><a class="zpl_lnk" onclick="ZPA_Messages.editTemplate(\''+currMode+"')\">"+ZPI18N.getString("zp.editemltemphdr")+"</a></div></div></div></div>":currMode==ZP_Automation_Mode.EMAILSCHEDULER||currMode==ZP_Automation_Mode.REPORTSCHEDULER?msgTemp+='<div class="zpl_secn zpl_mailtmp"><div><label>'+ZPI18N.getString("zp.emailbody")+'</label></div><div><div class="zpl_idiv"><div class="zpl_secn zpl_cc DNI" id="tempAnker"><a class="zpl_lnk" onclick="ZPA_Messages.editTemplate(\''+currMode+"')\">"+ZPI18N.getString("zp.edittemp")+"</a></div></div></div></div>":currMode!=ZPA_Messages.HRCASE_NOTIFICATION&&currMode!=ZPA_Messages.OFCREADINESS_NOTIFICATION&&currMode!=ZPA_Messages.TIMESHEET_NOTIFICATION&&currMode!=ZPA_Messages.OFFBOARDING_NOTIFICATION&&currMode!=ZPA_Messages.APPOINTMENT_NOTIFICATION||(msgTemp+='<div class="zpl_secn zpl_mailtmp"><div><label>'+ZPI18N.getString("zp.emailbody")+'</label></div><div><div class="zpl_idiv"><div class="zpl_secn zpl_cc DNI" id="tempAnker"><a class="zpl_lnk" onclick="ZPA_Messages.editTemplate(\''+ZP_Automation_Mode.EMAILALERT+"')\">"+ZPI18N.getString("zp.editemltemphdr")+"</a></div></div></div></div>"),msgTemp+='<div class="zpl_secn"><div><div class="zpl_msgedtr DNI" id="msgEditor"></div></div></div>',msgTemp+='<div class="zpl_secn"><div id="msgTemplate" class="zpl_msgedtr DN"></div></div>',currMode!=ZP_Automation_Mode.EMAILALERT&&currMode!=ZP_Automation_Mode.APPROVAL||(msgTemp+=ZPA_FileUpload.getFileUploadHtml(tabId)),msgTemp},editTemplate:function(mode){mode=ZPA_Common.isNotNull(mode)?mode:ZP_Automation_Mode.EMAILALERT;var pageId=ZPA_Common.getPageId(mode);pageId.find("#msgTemplate").addClass("DN"),pageId.find("#tempAnker").addClass("DNI");var templateMsg=pageId.find("#viewTempDiv").html();ZPA_Editor.initiateEditor(mode,ZPA_Common.getFormId(mode),templateMsg)},resetMailTemplate:function(pageMode,formId){ZPA_Common.CloseAlert.changesMade(pageMode,!1);var pageId=ZPA_Common.getPageId(pageMode);ZPA_Messages.RECIPIENT_ADDRESS={},ZPA_Messages.FORMFIELD_DTLS={},pageId.find("#to_list").find("[taggrpid]").remove(),pageId.find("#cc_list").find("[taggrpid]").remove(),pageId.find("#bcc_list").find("[taggrpid]").remove(),pageId.find("#reply_list").find("[taggrpid]").remove(),pageId.find("[elem=addLnk]").addClass("DN"),pageId.find("#constEmlDiv").addClass("DN"),pageId.find("#ccDiv").addClass("DNI"),pageId.find("#bccDiv").addClass("DNI"),pageId.find("#replyDiv").addClass("DNI"),pageId.find("[target=cc]").removeClass("DN"),pageId.find("[target=bcc]").removeClass("DN"),pageId.find("[target=reply]").removeClass("DN"),pageId.find("#addRecipient").removeClass("DNI"),ZPeopleComponents.isComponent("#to_tabPanel")&&ZPeopleComponents.tabbedlistboxpopup("#to_tabPanel").destroy(),ZPeopleComponents.isComponent("#cc_tabPanel")&&ZPeopleComponents.tabbedlistboxpopup("#cc_tabPanel").destroy(),ZPeopleComponents.isComponent("#bcc_tabPanel")&&ZPeopleComponents.tabbedlistboxpopup("#bcc_tabPanel").destroy(),ZPeopleComponents.isComponent("#reply_tabPanel")&&ZPeopleComponents.tabbedlistboxpopup("#reply_tabPanel").destroy(),pageId.find("#sub_list").val(""),pageId.find("#msgTemplate").addClass("DN"),pageId.find("#msgTemplate").empty(),pageId.find("#msgEditor").addClass("DNI"),pageId.find("#msgEditor").empty(),pageId.find("#tempAnker").addClass("DNI"),pageId.find("#attach_section").addClass("DN"),pageId.find("#attachedFiles").addClass("DN"),ZPA_Messages.loadTemplate(pageMode,formId),ZPeopleComponents.isComponent("#chooseTemplate")&&ZPeopleComponents.select("#chooseTemplate").destroy()},loadTemplate:function(mode,formId){mode!=ZP_Automation_Mode.REPORTSCHEDULER&&mode!=ZP_Automation_Mode.EMAILSCHEDULER||ZPA_Editor.initiateEditor(mode,formId,""),ZPA_Messages.loadAddresses(mode,formId)},loadAddresses:function(mode,formId){var pageId=ZPA_Common.getPageId(mode);let fromAddrProps={options:ZPA_FromAddress.getVerifiedFromAddressList(),dataMapping:{label:"displayName",value:"value"},change:function(event,data){ZPA_Common.CloseAlert.changesMade(mode),ZPA_Common.removeErrorDiv(pageId),ZPA_Common.enableSaveBtn(pageId);var selectedValue=data.selectedValue;if("myLogin"!=selectedValue&&"ORGEMAIL"!=selectedValue){var fromAddr=ZPA_FromAddress.getFromAddressDtl(selectedValue).fromAddress,fromDomain=fromAddr.substring(fromAddr.indexOf("@")+1);ZPA_FromAddress.DOMAIN_DKIM_AUTH_LIST[fromDomain]||ZPA_Messages.fromAddressDKIM_MandatoryError(pageId)}}};ZPA_Common.ZCompProp.loadSelectListProp(fromAddrProps),ZPeopleComponents.select(pageId.find("#from_address"),fromAddrProps),mode==ZP_Automation_Mode.APPROVAL&&(ZPA_MailAlert.fetchDefaultTemplateMessage(formId),ZPA_Messages.resetMessages(ApproverConstants.Type.AUTO_APPROVE)),ZPA_Messages.getPossibleDtls(formId,mode)},fromAddressDKIM_MandatoryError:function(pageId){ZPA_Common.appendErrorDiv(pageId.find("#from_address").parent(),ZPI18N.getString("zp.dkimmandatory"),pageId.find("#from_address")),pageId.find("#from_address").siblings("#from_address-container").addClass("ztextbox__error"),pageId.find("#from_address").parent().parent().find(".ztextbox--error__label").append("<a href='#settings/service/accountsetup/emailauthentication' target='_blank' class='zpl_lnk'>"+ZPI18N.getString("zp.authnow")+"</a>")},getPossibleDtls(formId,mode){var params={formId:formId,mode:mode,method:"getPossibleAddresses",conreqcsr:csrfToken};ZPeople.Request.send("/getPossibleMailAlertDtls.zp",params,function(data){var pageMode=ZPA_Common.getPageMode(),addrKey=void 0!=formId&&""!=formId?pageMode+"_"+formId:pageMode;ZPA_Messages.RECIPIENT_ADDRESS[addrKey]=data})},appendFromAddress:function(fromAddressId,fromAddress,displayName){var fromAddrList=[{value:fromAddressId,displayName:displayName+"<"+fromAddress+">"}];ZPeopleComponents.select("#from_address").addOption(fromAddrList),ZPeopleComponents.select("#from_address").setValue(fromAddrList)},getCurrentMode:function(){var tabId=settingsPage.tabId,serviceName=ZPA_Common.getServiceName(),currentMode=ZP_Automation_Mode.EMAILALERT;if(void 0!=tabId)if(-1!=tabId.indexOf("hrcase-agentnotifications")||-1!=tabId.indexOf("hrcase-requesternotifications"))currentMode=ZPA_Messages.HRCASE_NOTIFICATION;else if(tabId.indexOf(serviceName+"-approval")>=0)currentMode=ZP_Automation_Mode.APPROVAL;else if(-1!=tabId.indexOf("officereadiness"))currentMode=ZPA_Messages.OFCREADINESS_NOTIFICATION;else if(-1!=tabId.indexOf("timetracker-timesheets"))currentMode=ZPA_Messages.TIMESHEET_NOTIFICATION;else if("#tab-organization-mail"==tabId)currentMode=ZP_Automation_Mode.EMAILSCHEDULER;else if("#reports-scheduler"==tabId)currentMode=ZP_Automation_Mode.REPORTSCHEDULER;else if(tabId.indexOf("settings-service-performance-reviewsetting")>=0)currentMode=paReviewReminder.mode;else if(ZPA_Common.Offboarding.isNotificationPage())currentMode=ZPA_Messages.OFFBOARDING_NOTIFICATION;else if(tabId.indexOf(serviceName+"-postmessage")>=0)currentMode=ZP_Automation_Mode.POSTMESSAGE;else if(tabId.indexOf(serviceName+"-messagetemplate")>=0)currentMode=ZP_Automation_Mode.POSTMESSAGE;else if(ZPA_Common.Offboarding.isFlowApprovalPage())currentMode=ZP_Automation_Mode.OFFBOARDING_APPROVAL;else if(-1!=tabId.indexOf("#settings-service-onboarding-notifications")){let extraparam=ZPA_MailAlert.Slider.extraparam;extraparam&&extraparam.submode&&"appointment"==extraparam.submode&&(currentMode=ZPA_Messages.APPOINTMENT_NOTIFICATION)}else currentMode=ZP_Automation_Mode.EMAILALERT;return currentMode},getMailTemplateMode:function(){var niceUrl=settingsUrlProps.niceUrl,serviceName=ZPA_Common.getServiceName(),mailTempMode=ZP_Automation_Mode.EMAILALERT;return void 0!=niceUrl&&(mailTempMode=niceUrl.indexOf(serviceName+"/approval")>=0?ZP_Automation_Mode.APPROVAL:niceUrl.indexOf("organization/scheduler/mail")>=0?ZP_Automation_Mode.EMAILSCHEDULER:niceUrl.indexOf("reports/scheduler")>=0?ZP_Automation_Mode.REPORTSCHEDULER:niceUrl.indexOf("custombutton")>=0&&ZPA_CustomAction.getCAMode()==CAConstants.Mode.LINK?ZP_Automation_Mode.CUSTOMACTION:ZP_Automation_Mode.EMAILALERT),mailTempMode},initiateTabPanel:function(id,forEleId){var mailTempMode=ZPA_Messages.getMailTemplateMode();if(mailTempMode=ZPA_Common.isNotNull(mailTempMode)?mailTempMode:ZP_Automation_Mode.EMAILALERT,$.isEmptyObject(ZPA_Messages.FORMFIELD_DTLS)||!ZPeopleComponents.isComponent("#"+id)){var params={formId:ZPA_Common.getFormId(mailTempMode),method:"getFormFields",mode:mailTempMode,conreqcsr:csrfToken};$.ajax({url:"/getFormFields.zp",type:"POST",data:params,success:function(data){ZPA_Messages.FORMFIELD_DTLS=data;var tabPanelProps={id:id,forEleId:forEleId,appendTo:ZPA_Common.getPageCardContainerId(mailTempMode),select:ZPA_Messages.appendFormFieldToSubject};mailTempMode==ZP_Automation_Mode.REPORTSCHEDULER||mailTempMode==ZP_Automation_Mode.EMAILSCHEDULER?ZPA_Scheduler.TabPanel.loadSystemFields(ZPA_Messages.FORMFIELD_DTLS,tabPanelProps):ZPA_Util.TabPanel.loadFormFieldTabPanel(ZPA_Messages.FORMFIELD_DTLS,tabPanelProps),ZPeopleComponents.tabbedlistboxpopup("#"+id).open()}})}else ZPeopleComponents.tabbedlistboxpopup("#"+id).open()},appendFormFieldToSubject:function(event,opts){var mailTempMode=ZPA_Messages.getMailTemplateMode();mailTempMode=ZPA_Common.isNotNull(mailTempMode)?mailTempMode:ZP_Automation_Mode.EMAILALERT;var pageId=ZPA_Common.getPageId(mailTempMode),subject=pageId.find("#sub_list").val(),formFieldVal=event.detail.itemData.label;pageId.find("#sub_list").val(subject+"${"+formFieldVal+"}"),ZPA_Common.CloseAlert.changesMade(mailTempMode)},enableAddressBox:function(getThis){var pageId=$(settingsPage.mainWrapId),target=$(getThis).attr("target");"cc"==target?pageId.find("#ccDiv").removeClass("DNI"):"bcc"==target?pageId.find("#bccDiv").removeClass("DNI"):"reply"==target&&pageId.find("#replyDiv").removeClass("DNI"),pageId.find("[action="+target+"]").removeClass("DNI"),ZPA_Messages.getCurrentMode()==ZP_Automation_Mode.OFFBOARDING_APPROVAL?0==$(getThis).siblings("a").not(".DN").length&&$(getThis).closest("#addRecipient").addClass("DNI"):2==$(getThis).siblings(".DN").length&&$(getThis).closest("#addRecipient").addClass("DNI"),$(getThis).addClass("DN")},validateFromAddress:function(mode,fromAddr){var isValidFromAddr=!0,pageId=ZPA_Common.getPageId(mode);return"myLogin"!==fromAddr&&"mylogin"!==fromAddr&&-1===fromAddr.indexOf("ORGEMAIL")&&(isNaN(fromAddr)?ZPUtil.Validation.isEmail(fromAddr)?isNaN(fromAddr)&&fromAddr!==decodeHTML(ZPeople.CURR_USER.email)&&"noreply@zohopeople.com"!==fromAddr&&-1===ZPA_FromAddress.VERIFIED_DOMAINS.indexOf(fromAddr.substring(fromAddr.indexOf("@")+1))&&(ZPA_Common.appendErrorDiv(pageId.find("#from_address").parent(),ZPI18N.getString("zp.fromAddrdomainerror")),isValidFromAddr=!1):(ZPA_Common.appendErrorDiv(pageId.find("#from_address").parent(),ZPI18N.getString("zp.entervalidfrom")),isValidFromAddr=!1):(isValidFromAddr=ZPA_FromAddress.isValidFromAddressId(fromAddr))||ZPA_Common.appendErrorDiv(pageId.find("#from_address").parent(),ZPI18N.getString("zp.entervalidfrom"))),isValidFromAddr},emailAddressValidation:function(emailAddressObj){var resultObj={},configuredKeys=Object.keys(emailAddressObj);return $.each(configuredKeys,function(index,key){"sysConfList"===key&&emailAddressObj.sysConfList.length>10?resultObj.errormsg=ZPI18N.getString("zp.mailalert.systemoptions.errmsg"):"system"===key&&emailAddressObj.system.length>25?resultObj.errormsg=ZPI18N.getString("zp.mailalert.users.errmsg"):"roles"===key&&emailAddressObj.roles.length>25?resultObj.errormsg=ZPI18N.getString("zp.mailalert.roles.errmsg"):"departments"===key&&emailAddressObj.departments.length>25?resultObj.errormsg=ZPI18N.getString("zp.mailalert.depts.errmsg"):"groups"===key&&emailAddressObj.groups.length>20?resultObj.errormsg=ZPI18N.getString("zp.mailalert.groups.errmsg"):"locations"===key&&emailAddressObj.locations.length>20?resultObj.errormsg=ZPI18N.getString("zp.mailalert.locations.errmsg"):"formfields"===key&&emailAddressObj.formfields.length>10?resultObj.errormsg=ZPI18N.getString("zp.mailalert.formfields.errmsg"):"constantVal"===key&&emailAddressObj.constantVal.length>10&&(resultObj.errormsg=ZPI18N.getString("zp.mailalert.constants.errmsg"))}),resultObj},replyToAddressValidation:function(emailAddressObj){var resultObj={},configuredKeys=Object.keys(emailAddressObj);if(configuredKeys.length>1)resultObj.errormsg=ZPI18N.getString("zp.mailalert.replyto.errmsg");else if(1==configuredKeys.length){emailAddressObj[configuredKeys[0]].length>1&&(resultObj.errormsg=ZPI18N.getString("zp.mailalert.replyto.errmsg"))}return resultObj},validateMailTemplateObject:function(mode,mailObj){var isValidMail=!0,pageId=ZPA_Common.getPageId(mode),fromAddr=mailObj.from,subject=mailObj.subject,to=mailObj.to,cc=mailObj.cc,bcc=mailObj.bcc,reply=mailObj.reply,notifyAll=mailObj.notifyTo;if(isValidMail=ZPA_Messages.validateFromAddress(mode,fromAddr),!notifyAll){var containsEmailAddrErr=!1,errorMsg="";if($.isEmptyObject(to)&&(errorMsg=ZPI18N.getString("zp.toaddrnotempty"),containsEmailAddrErr=!0),!containsEmailAddrErr){var toResultObj=ZPA_Messages.emailAddressValidation(to);void 0!=toResultObj.errormsg&&(errorMsg=toResultObj.errormsg,containsEmailAddrErr=!0)}containsEmailAddrErr&&(ZPA_Common.appendErrorDiv(pageId.find("#to_grp"),errorMsg),isValidMail=!1)}var ccResultObj=ZPA_Messages.emailAddressValidation(cc);void 0!=ccResultObj.errormsg&&(ZPA_Common.appendErrorDiv(pageId.find("#cc_grp"),ccResultObj.errormsg),isValidMail=!1);var bccResultObj=ZPA_Messages.emailAddressValidation(bcc);void 0!=bccResultObj.errormsg&&(ZPA_Common.appendErrorDiv(pageId.find("#bcc_grp"),bccResultObj.errormsg),isValidMail=!1);var replyToResultObj=ZPA_Messages.replyToAddressValidation(reply);if(void 0!=replyToResultObj.errormsg&&(ZPA_Common.appendErrorDiv(pageId.find("#reply_grp"),replyToResultObj.errormsg),isValidMail=!1),""===subject&&(ZPA_Common.appendErrorDiv(pageId.find("#sub_list").parent(),ZPI18N.getString("zp.enteremailsubject")),isValidMail=!1),subject.length>300&&(ZPA_Common.appendErrorDiv(pageId.find("#sub_list").parent(),ZPI18N.getString("zp.emlalrtsubexc")),isValidMail=!1),void 0===mailObj.templateId||"-1"!=mailObj.templateId){var tempMsgHtml=$(mailObj.templateMessage);pageId.find("#msgEditor").is(":hidden")||(ZPUtil.Validation.isEmpty(tempMsgHtml.text())?(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.entcont")),isValidMail=!1):mailObj.templateMessage.length>1e5&&(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.lengthofmessage")),isValidMail=!1))}else"-1"===mailObj.templateId&&(ZPA_Common.appendErrorDiv(pageId.find("#chooseTemplate").parent(),ZPI18N.getString("zp.selemltemp")),ZPeopleComponents.select(pageId.find("#chooseTemplate")).container.addClass("ztextbox__error"),isValidMail=!1);return isValidMail},getConfDetails:function(mode,formId,currMode){var pageId=ZPA_Common.getPageId(mode),saveMailAlertJObj={},fromMailAddr=ZPeopleComponents.select(pageId.find("#from_address")).getValue(),notifyTo=!1,toMailAddr=ZPA_TabbedListBox.getTagConfig(pageId.find("#to_grp")),ccMailAddr=ZPA_TabbedListBox.getTagConfig(pageId.find("#cc_grp")),bccMailAddr=ZPA_TabbedListBox.getTagConfig(pageId.find("#bcc_grp")),replyMailAddr=ZPA_TabbedListBox.getTagConfig(pageId.find("#reply_grp"));void 0!==toMailAddr.NOTIFY_ALL&&(toMailAddr={},notifyTo=!0);var subject=pageId.find("#sub_list").val();saveMailAlertJObj.formId=formId,saveMailAlertJObj.notifyTo=notifyTo,saveMailAlertJObj.from=fromMailAddr,saveMailAlertJObj.to=toMailAddr,saveMailAlertJObj.reply=replyMailAddr,saveMailAlertJObj.cc=ccMailAddr,saveMailAlertJObj.bcc=bccMailAddr,saveMailAlertJObj.subject=subject;var mailTempId="";void 0!=(mailTempId=(currMode=void 0!=currMode&&""!=currMode?currMode:mode)==ZP_Automation_Mode.EMAILSCHEDULER||currMode==ZP_Automation_Mode.REPORTSCHEDULER||currMode==ZPA_Messages.OFCREADINESS_NOTIFICATION||currMode==ZPA_Messages.HRCASE_NOTIFICATION||currMode==ZPA_Messages.TIMESHEET_NOTIFICATION||currMode==ZPA_Messages.OFFBOARDING_NOTIFICATION||currMode==ZPA_Messages.APPOINTMENT_NOTIFICATION?pageId.find("#msgEditor").attr("mailTempId"):ZPeopleComponents.select(pageId.find("#chooseTemplate")).getValue())&&""!=mailTempId&&"0"!=mailTempId&&(saveMailAlertJObj.templateId=mailTempId);var createEditTemplateDiv=pageId.find("#msgEditor");if(currMode!==ZPA_Messages.TIMESHEET_NOTIFICATION&&currMode!==ZPA_Messages.HRCASE_NOTIFICATION&&currMode!=ZPA_Messages.OFFBOARDING_NOTIFICATION&&currMode!=ZP_Automation_Mode.OFFBOARDING_APPROVAL&&(saveMailAlertJObj.recordTempIds=ZPA_FileUpload.getUploadedRecordTempList()),currMode==ZPA_Messages.HRCASE_NOTIFICATION)pageId.find("#to_requestor").length>0?saveMailAlertJObj.to={formfields:[pageId.find("#to_requestor").attr("formfield")]}:pageId.find("#to_caseowner").length>0?saveMailAlertJObj.to={sysConfList:["ZP.HRCASE.CASEOWNER"]}:saveMailAlertJObj.to={sysConfList:[ZPeopleComponents.select(pageId.find("#togrp_hrcase")).getValue()]};else if(currMode==ZPA_Messages.OFCREADINESS_NOTIFICATION||currMode==ZP_Automation_Mode.OFFBOARDING_APPROVAL||currMode==ZPA_Messages.OFFBOARDING_NOTIFICATION){var toSysVal=pageId.find("input[name=ofr_notify_to]").attr("toSysVal");saveMailAlertJObj.to={sysConfList:[toSysVal]}}else if(currMode==ZPA_Messages.APPOINTMENT_NOTIFICATION){toSysVal=ZPeopleComponents.select(pageId.find("#togrp_apptLtrTo")).getValue();saveMailAlertJObj.to={sysConfList:[toSysVal]}}if(createEditTemplateDiv.find("#editorTextArea_"+currMode).is(":visible")){var orginalMessage=editor.getContent();saveMailAlertJObj.templateMessage=orginalMessage}return saveMailAlertJObj},isRecipientPresent:function(recipientAddr){var isRecPresent=!1;if(void 0!=recipientAddr&&""!=recipientAddr){var recipientKeys=Object.keys(recipientAddr);$.each(recipientKeys,function(index,recipientKey){var recipientObj=recipientAddr[recipientKey];Object.keys(recipientObj).length>0&&(isRecPresent=!0)})}return isRecPresent},getTemplates:function(mode,async){var formId=ZPA_Common.getFormId(mode),params={mode:mode,formId:formId.toString(),method:"getTemplates",conreqcsr:csrfToken};async=!(void 0!=async&&!async)||async,$.ajax({url:"/getTemplates.zp",type:"POST",async:async,data:params,success:function(respData){var templateItems=ZPA_Messages.getConstrutMsgTempAry(respData.messageTemplateJArray);ZPA_Messages.contructTemplatedDD(mode,templateItems)}})},contructTemplatedDD:function(mode,templateJArray){ZPA_Common.getPageId(mode);var empTempJson={TEMPLATEID:"-1",TEMPLATE_NAME:ZPI18N.getString("zp.choosefield"),TEMPLATE:""},createNewTempJson={TEMPLATEID:"0",TEMPLATE_NAME:ZPI18N.getString("zp.addnewemltemp"),TEMPLATE:"",isFooter:!0};templateJArray.splice(0,0,empTempJson),templateJArray.push(createNewTempJson);let tempProps={options:templateJArray,dataMapping:{label:"TEMPLATE_NAME",value:"TEMPLATEID"},change:ZPA_Messages.templateChangeCallback,mode:mode,footerSelectable:!0,removeExistingDropdown:!0};ZPA_Common.ZCompProp.loadSelectListProp(tempProps),ZPeopleComponents.select("#chooseTemplate",tempProps)},templateChangeCallback:function(event){var mode=event.detail.options.mode,pageId=ZPA_Common.getPageId(mode);ZPA_Common.removeErrorDiv(pageId.find("#chooseTemplate").closest(".zpl_secn"));var templateId=event.detail.optionData.TEMPLATEID,templateMsg=event.detail.optionData.TEMPLATE;pageId.find("#msgTemplate").addClass("DN"),pageId.find("#msgEditor").addClass("DNI"),pageId.find("#tempAnker").addClass("DNI"),pageId.find("#attach_section").addClass("DN"),-1!=templateId?(0!=templateId?(pageId.find("#msgTemplate").html(ZPA_Editor.getViewTemplateHtml(templateMsg)),pageId.find("#msgTemplate").removeClass("DN"),pageId.find("#tempAnker").removeClass("DNI")):ZPA_Editor.initiateEditor(mode,ZPA_Common.getFormId(mode),"","editorTextArea_"+ZPA_Messages.getCurrentMode(),pageId),pageId.find("#attach_section").removeClass("DN"),pageId.find("#fluplDiv").removeClass("DN"),ZPA_FileUpload.toggleAttachFileHeader(!0)):pageId.find("#fluplDiv").addClass("DN"),ZPA_Common.CloseAlert.changesMade(mode)},getConstrutMsgTempAry:function(msgTempAry){var templateItems=[];return $.each(msgTempAry,function(index,tempJSON){var tempItem={};tempItem.TEMPLATEID=tempJSON.TEMPLATEID,tempItem.TEMPLATE_NAME=decodeHTML(tempJSON.TEMPLATE_NAME),tempItem.TEMPLATE=decodeHTML(tempJSON.TEMPLATE),tempItem.title=decodeHTML(tempJSON.TEMPLATE_NAME),tempItem.TEMPLATE_TYPE=tempJSON.TEMPLATE_TYPE,templateItems.push(tempItem)}),templateItems},constructMailId:function(tabPanelId,configJson,tagInputObj,targetId){var dispValJson=$.extend({},ZPA_Messages.TabPanel.keyPairIdJson,{constantVal:{id:"constantVal",dispVal:ZPI18N.getString("zp.additoneml")}}),keyNameList=[dispValJson.constantVal.id,dispValJson.sysConfList.id,dispValJson.system.id,dispValJson.roles.id,dispValJson.departments.id,dispValJson.groups.id,dispValJson.locations.id,dispValJson.formfields.id];$.each(keyNameList,function(i,keyVal){configJson.hasOwnProperty(keyVal)&&$.each(configJson[keyVal],function(key,val){var parentJson=dispValJson[keyVal],parentTagJson={id:parentJson.id,value:parentJson.dispVal},childTagJson={id:key,value:ZSEC.Encoder.encodeForHTML(val)};ZPA_TabbedListBox.appendRecipientTag(tabPanelId,tagInputObj.find("#"+targetId),parentTagJson,childTagJson)})})},constructAactPerm:function(tabPanelId,configJson,tagInputObj,targetId){var dispValJson=ZPA_Messages.TabPanel.cActkeyPairIdJson,keyNameList=[dispValJson.system.id,dispValJson.roles.id,dispValJson.departments.id,dispValJson.groups.id];$.each(keyNameList,function(i,keyVal){configJson.hasOwnProperty(keyVal)&&$.each(configJson[keyVal],function(key,val){var parentJson=dispValJson[keyVal],parentTagJson={id:parentJson.id,value:parentJson.dispVal},childTagJson={id:key,value:val};ZPA_TabbedListBox.appendRecipientTag(tabPanelId,tagInputObj.find("#"+targetId),parentTagJson,childTagJson)})})},resetMessages(value,reset,excludeDefault){var defaultValue,mode=ZP_Automation_Mode.APPROVAL;if(void 0!=value&&void 0!=ZPA_MailAlert.defaultTempMsg[ZPA_Common.getFormId(mode)])switch(value){case ApproverConstants.Type.AUTO_APPROVE:defaultValue=ZPA_MailAlert.defaultTempMsg[ZPA_Common.getFormId(mode)][MAConstants.ApprovalType.AUTO_APPROVE],reset=!0;break;case ApproverConstants.Type.AUTO_REJECT:defaultValue=ZPA_MailAlert.defaultTempMsg[ZPA_Common.getFormId(mode)][MAConstants.ApprovalType.AUTO_REJECT],reset=!0;break;default:defaultValue=ZPA_MailAlert.defaultTempMsg[ZPA_Common.getFormId(mode)][MAConstants.ApprovalType.MANUAL_APPROVAL]}if(void 0!=defaultValue&&reset){ZPeopleComponents.isComponent(ZPA_Common.getPageId(mode).find("#chooseTemplate"))&&ZPeopleComponents.select(ZPA_Common.getPageId(mode).find("#chooseTemplate")).setValue(defaultValue.templateId);var pageId=ZPA_Common.getPageId(mode);pageId.find("#sub_list").val(defaultValue.subject),pageId.find("#to_list").find("[taggrpid]").remove(),pageId.find("#cc_list").find("[taggrpid]").remove(),pageId.find("#bcc_list").find("[taggrpid]").remove(),pageId.find("#reply_list").find("[taggrpid]").remove(),excludeDefault||ZPA_Messages.populateRecipient(ZPA_Common.getPageId(mode),{to:defaultValue.to})}},setMailTemplate:function(pageId,pageMode,data){pageId=ZPA_Common.getPageId(pageMode);var fromAddrId=data.from_address;if("myLogin"!=fromAddrId&&"ORGEMAIL"!=fromAddrId&&"noreply@zohopeople.com"!=fromAddrId){var newFromOpt=ZPA_FromAddress.getFromAddressItem(fromAddrId);null!=newFromOpt&&(ZPeopleComponents.select(pageId.find("#from_address")).addOption(newFromOpt),ZPA_Messages.fromAddressDKIM_MandatoryError(pageId))}data.subject;if(ZPeopleComponents.select(pageId.find("#from_address")).setValue(fromAddrId),ZPA_Messages.populateRecipient(pageId,data),pageMode==ZP_Automation_Mode.EMAILALERT||pageMode==ZP_Automation_Mode.APPROVAL){var templateItems=ZPA_Messages.getConstrutMsgTempAry(data.messageTemplateJArray);ZPA_Messages.contructTemplatedDD(pageMode,templateItems)}ZPA_Messages.setData(pageId,pageMode,data),pageMode!=ZP_Automation_Mode.EMAILALERT&&pageMode!=ZP_Automation_Mode.APPROVAL||(pageId.find("#attach_section").removeClass("DN"),ZPA_FileUpload.setFileUploadList(data))},populateRecipient:function(pageId,data){if(data.notifyTo){var targetDiv=pageId.find("#to_list");targetDiv.find(".zpl_tgrp:not('#constEmlDiv'), .zpl_tg").remove(),targetDiv.find("[elem=addLnk]").addClass("DNI");var childTagJson={id:"NotifyAll",value:ZPI18N.getString("zp.notifyall")};ZPA_TabbedListBox.appendRecipientTag("to_tabPanel",targetDiv,{id:"NOTIFY_ALL",value:""},childTagJson)}ZPA_Messages.constructMailId("to_tabPanel",data.to,pageId.find("#to_grp"),"to_list"),ZPA_Messages.isRecipientPresent(data.cc)&&(ZPA_Messages.enableAddressBox(pageId.find("[target=cc]")),ZPA_Messages.constructMailId("cc_tabPanel",data.cc,pageId.find("#cc_grp"),"cc_list")),ZPA_Messages.isRecipientPresent(data.bcc)&&(ZPA_Messages.enableAddressBox(pageId.find("[target=bcc]")),ZPA_Messages.constructMailId("bcc_tabPanel",data.bcc,pageId.find("#bcc_grp"),"bcc_list")),ZPA_Messages.isRecipientPresent(data.reply)&&(ZPA_Messages.enableAddressBox(pageId.find("[target=reply]")),ZPA_Messages.constructMailId("reply_tabPanel",data.reply,pageId.find("#reply_grp"),"reply_list"))},setData:function(pageId,pageMode,data){var currMode=ZPA_Messages.getCurrentMode();pageId.find("#sub_list").val(decodeHTML(data.subject)),pageId.find("#msgTemplate").addClass("DN"),pageId.find("#msgEditor").addClass("DNI"),pageId.find("#tempAnker").addClass("DNI"),pageId.find("#msgEditor").attr("mailTempId",data.templateId),pageId.find("#msgTemplate").removeClass("DN"),currMode==ZP_Automation_Mode.EMAILALERT||currMode==ZP_Automation_Mode.APPROVAL||currMode==ZP_Automation_Mode.OFFBOARDING_APPROVAL?(ZPeopleComponents.select(pageId.find("#chooseTemplate")).setValue(data.templateId),ZPA_Common.CloseAlert.changesMade(pageMode,!1)):pageId.find("#msgTemplate").html(ZPA_Editor.getViewTemplateHtml(data.templateMessage)),pageId.find("#tempAnker").removeClass("DNI")},showLink:function(thisObj){$(thisObj).find("[elem=addLnk]").removeClass("DN")},hideLink:function(thisObj){$(thisObj).find("[elem=addLnk]").addClass("DN")},constructContactEmail:function(thisObj,recipDivId){if(!ZPA_Messages.validateNotifyAll(recipDivId)){var tab=new Tab;tab.id="conteml_Popup",tab.cardId="conteml_Cards",tab.validate=function(){ZPA_Messages.saveContactEmail(recipDivId)},ZPA_Messages.POPUP_MODAL=new popupModal(ZPI18N.getString("zp.addconteml"),tab),ZPA_Messages.POPUP_MODAL.construct(),ZPA_Messages.POPUP_MODAL.setCloseCallback(function(){ZPA_Messages.POPUP_MODAL.remove()}),ZPA_Common.getPopUpId(ZPA_Messages.POPUP_MODAL).find("#"+tab.cardId).append(ZPA_Messages.getContEmlPopUphtml())}},getContEmlPopUphtml:function(){var contAddrHtml='<div class="zpl_crd"><div class="zpl_crdcnt">';return contAddrHtml+='<div class="zpl_secn"><div><input id="contactEml" type="email" placeholder="'+ZPI18N.getString("zp.enteremail")+'" class="ztextbox"></div></div>',contAddrHtml+="</div></div>"},saveContactEmail:function(recipDivId){var popUpId=ZPA_Common.getPopUpId(ZPA_Messages.POPUP_MODAL);ZPA_Common.removeErrorDiv(popUpId);var contactEmail=popUpId.find("#contactEml").val();if(ZPUtil.Validation.isEmpty(contactEmail))ZPA_Common.appendErrorDiv(popUpId.find("#contactEml"),ZPI18N.getString("zp.copycustomization.enteravalidemailaddress"));else{var emailValidation=ZPUtil.Validation.isEmail(contactEmail),recipDiv=ZPA_Common.getPageId(ZPA_Messages.getCurrentMode()).find("#"+recipDivId);if(0!==contactEmail.length)if(!ZPA_Messages.validateNotifyAll(recipDivId)&&emailValidation){if(0==recipDiv.find("[tagGrpId=constantVal").length){var tagGrp=ZPA_TabbedListBox.getRecipientTagGrpDiv("constantVal",ZPI18N.getString("zp.additoneml"));recipDiv.find(".zpl_frmctrl").append(tagGrp)}var systemTagDiv=recipDiv.find("[tagGrpId=constantVal]"),addrDtlDiv=ZPA_TabbedListBox.getRecipientTag(contactEmail,contactEmail);systemTagDiv.append(addrDtlDiv),ZPA_Messages.POPUP_MODAL.remove()}else ZPA_Common.appendErrorDiv(popUpId.find("#contactEml"),ZPI18N.getString("zp.copycustomization.enteravalidemailaddress"));else ZPA_Messages.POPUP_MODAL.remove()}},validateNotifyAll:function(recipDivId){var notifyPresent=!1;return ZPA_Common.getPageId(ZPA_Messages.getCurrentMode()).find("#"+recipDivId).find(".zpl_frmctrl [ctagid=NotifyAll]").length>0&&(ZPeople.Message.failure("Remove notify all to add additional email address"),ZPA_Messages.POPUP_MODAL.remove(),notifyPresent=!0),notifyPresent}};ZPA_Messages.TabPanel={keyPairIdJson:{sysConfList:{id:"sysConfList",dispVal:ZPI18N.getString("zp.systemopt")},system:{id:"system",dispVal:ZPI18N.getString("zp.users")},roles:{id:"roles",dispVal:ZPI18N.getString("zp.roles")},departments:{id:"departments",dispVal:ZPI18N.getString("zp.departments")},groups:{id:"groups",dispVal:ZPI18N.getString("zp.groups")},locations:{id:"locations",dispVal:ZPI18N.getString("zp.locations")},formfields:{id:"formfields",dispVal:ZPI18N.getString("zp.formfields")}},cActkeyPairIdJson:{empJObj:{id:"system",dispVal:ZPI18N.getString("zp.users")},roleJObj:{id:"roles",dispVal:ZPI18N.getString("zp.roles")},deptJObj:{id:"departments",dispVal:ZPI18N.getString("zp.departments")},grpJObj:{id:"groups",dispVal:ZPI18N.getString("zp.groups")}},loadMailAddrTabPanel:function(formId,idToLoad,forEleID,targetId){var pageMode=ZPA_Common.getPageMode(),addrKey=void 0!=formId&&""!=formId?pageMode+"_"+formId:pageMode,tabs=[],messKeys="ca_tabPanel"===idToLoad&&$("#tabCustomActionTab").length>0&&$("#tabCustomActionTab").hasClass("zpl_mopen")?["system","roles","departments","groups"]:ZPA_Messages.MAILADDRESS_KEY;$.each(messKeys,function(index,key){let keyPairOBj=ZPA_Messages.TabPanel.keyPairIdJson[key];if(void 0==keyPairOBj)return;let tabObj={};tabObj.label=keyPairOBj.dispVal,tabObj.panelId=key+"_panel",tabObj.id=keyPairOBj.id;var recipientAddr=ZPA_Messages.RECIPIENT_ADDRESS[addrKey],mailAddrList=void 0==recipientAddr?[]:recipientAddr[key];if(void 0!=mailAddrList&&Object.keys(mailAddrList).length>0){var mailAddrItems=[];$.each(mailAddrList,function(addressId,addrName){let mailAddrObj={};mailAddrObj.Id=ZPA_Common.getCustomFormComponentId(addressId),mailAddrObj.Value=addrName,mailAddrObj.title=decodeHTML(addrName),mailAddrItems.push(mailAddrObj)}),tabObj.items=mailAddrItems,tabs.push(tabObj)}else"system"==key&&(tabObj.listboxOptions={searchFieldOptions:{placeholder:ZPI18N.getString("zp.searchbyemp")},dataSource:{search:function(params){return new Promise(function(search,reject){var searchQry=params.query,userList=[];if(ZPA_Common.isNotNull(searchQry)){var searchRes;searchRes="to_list"==targetId?EmployeeSearch.getEmpList(searchQry,"emp","MAIL_RECEPIENT",null,null,null,null,!0):EmployeeSearch.getEmpList(searchQry,"emp","AUTOMATION",null,null,null,null,!0),$.each(searchRes,function(index,userData){if(userData.emailId){let mailAddrObj={};mailAddrObj.Id=userData.id,mailAddrObj.Value=userData.empid+" "+userData.value,mailAddrObj.imageUrl=userData.image,userList.push(mailAddrObj)}})}else{var orgUsersList=ZPeople.getUserListData();$.each(orgUsersList,function(index,userData){if(index>=AutomationConstants.Limit.LISTING_LIMIT)return!1;if("to_list"==targetId){if("false"==userData.isMobileUser&&userData.email){let mailAddrObj={};mailAddrObj.Id=userData.usererec,mailAddrObj.Value=userData.empid+" "+userData.name,mailAddrObj.title=userData.empid+" "+userData.name,mailAddrObj.imageUrl=userData.avatar,userList.push(mailAddrObj)}}else if("false"==userData.isNonUser){let mailAddrObj={};mailAddrObj.Id=userData.usererec,mailAddrObj.Value=userData.empid+" "+userData.name,mailAddrObj.title=userData.empid+" "+userData.name,mailAddrObj.imageUrl=userData.avatar,userList.push(mailAddrObj)}})}search({delay:20,results:userList,more:!1})})}},messages:{noResults:"to_list"==targetId?ZPI18N.getString("zp.noresultsfound"):ZPI18N.getString("zp.nologinusers")},serverSearch:!0,cacheData:!0},tabs.push(tabObj))});var tabPanelProps={tabs:tabs,id:idToLoad,forElement:"#"+forEleID,targetId:targetId,appendTo:ZPA_Common.getPageCardContainerId(ZPA_Messages.getCurrentMode()),select:ZPA_TabbedListBox.selectCallback,deselect:ZPA_TabbedListBox.deselectCallback,pointer:!0,type:ZPA_TabbedListBox.RECIPIENT};"to_tabPanel"==idToLoad&&(tabPanelProps.className="notfy",tabPanelProps.footer=ZPA_TabbedListBox.getFooterHtml(ZPI18N.getString("zp.toaddrnotifyall")),tabPanelProps.changenotification=ZPA_TabbedListBox.changeNotify),tabPanelProps.listboxOptions={dataMapping:{id:"Id",value:"Id",text:"Value"},showSearchField:!0,search:{by:"Value",criteria:"contains"},searchFieldOptions:{placeholder:ZPI18N.getString("zp.search")},messages:{noResults:ZPI18N.getString("zp.noresults")},isTextHTMLEncoded:!0},ZPeopleComponents.tabbedlistboxpopup("#"+idToLoad,tabPanelProps)},openTabPanel:function(id,forEleId,targetId){var pageMode=ZPA_Common.getPageMode(),formId=ZPA_Common.getFormId(pageMode),addrKey=void 0!=formId&&""!=formId?pageMode+"_"+formId:pageMode;if(void 0==ZPA_Messages.RECIPIENT_ADDRESS[addrKey]){var params={formId:formId,mode:pageMode,method:"getPossibleAddresses",async:!1,conreqcsr:csrfToken};ZPeople.Request.send("/getPossibleMailAlertDtls.zp",params,function(data){ZPA_Messages.RECIPIENT_ADDRESS={},ZPA_Messages.RECIPIENT_ADDRESS[addrKey]=data})}ZPA_Messages.TabPanel.loadMailAddrTabPanel(formId,id,forEleId,targetId)}};var ZPA_FromAddress={POPUP_MODAL:null,FROM_ADDR_DTLS:[],VERIFIED_DOMAINS:[],DOMAIN_DKIM_AUTH_LIST:{},DOMAIN_VERIFIED_DKIM_AUTH_LIST:[],initialCallBack:function(){var pageId=ZPA_Common.getParentPageId();pageId.addClass("zpl_tblfxd");var topMenuDiv=pageId.find("#topSettMenu");if(topMenuDiv.removeClass("zp_dyn"),topMenuDiv.find(".zpl_rgt").siblings().remove(),topMenuDiv.find(".zpl_rgt").remove(),isadmin||isManageAutoAdmin){pageId.append('<div class="zpl_rgtcnt"></div>');var topmenuHtml='<div class="zpl_rgt"> <button id="add_fromaddr" class="zlabel zlabel--blue zlabel--medium" onclick="ZPA_FromAddress.constructFromAddressPopUp(false)">'+ZPI18N.getString("zp.addemlfrom")+"</button></div>";topMenuDiv.append(topmenuHtml),ZPA_FromAddress.initPage()}else{new EmptyPages("zp_nd_permission",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"),"",pageId).show()}},initPage:function(){var pageId=ZPA_Common.getParentPageId();if(pageId.find(".zpl_rgtcnt").empty(),ZPA_Common.Loader.appendPageLoading(pageId),ZPA_FromAddress.fetchAllFromAddress(!1),ZPA_FromAddress.FROM_ADDR_DTLS.length>0){var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th width="50"></th><th>'+ZPI18N.getString("zp.displayname")+"</th><th>"+ZPI18N.getString("zp.emlfromaddr")+"</th><th>"+ZPI18N.getString("zp.verificationstatus")+"</th><th>"+ZPI18N.getString("zp.authenticationstatus")+'</th><th width="100"></th></tr></thead><tbody>';$.each(ZPA_FromAddress.FROM_ADDR_DTLS,function(index,value){var fromAddrDtl=JSON.parse(JSON.stringify(value)),isOrgEmail=fromAddrDtl.isOrgEmail,addrClass=isOrgEmail?"PI_fil_askus grn":"PI_star",title=isOrgEmail?ZPI18N.getString("zp.orgdefaultemail"):"",type=fromAddrDtl.type,verified=type==zpconst.FromAddressType.PreDefined||1==fromAddrDtl.isVerified?'<i class="PI_tick2_fil grn"></i>'+ZPI18N.getString("zp.domainverified"):"<a onclick=\"ZPA_FromAddress.captchaConfirmation('"+fromAddrDtl.fromAddressId+"')\">"+ZPI18N.getString("zp.verify")+"</a>",fromAddress=fromAddrDtl.fromAddress,domainName=fromAddress.substring(fromAddress.indexOf("@")+1),dkimHtml=(fromAddrDtl.displayName,"");dkimHtml=ZPA_FromAddress.DOMAIN_DKIM_AUTH_LIST[domainName]&&fromAddrDtl.isVerified?'<span class="grn">'+ZPI18N.getString("zp.authenticated")+"</span>":fromAddrDtl.isOrgEmail&&fromAddrDtl.isVerified?'<span class="grn">'+ZPI18N.getString("zp.authenticated")+"</span>":'<span class="red">'+ZPI18N.getString("zp.pendingauthentication")+"</span>";var editHtml=type!=zpconst.FromAddressType.PreDefined?"onclick=\"ZPA_FromAddress.editFromAddress('"+fromAddrDtl.fromAddressId+"')\"":"",delHtml=type==zpconst.FromAddressType.PreDefined||isOrgEmail?"":'<div class="zpl_hvr"><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" fromAddrId="'+fromAddrDtl.fromAddressId+'" onclick="ZPA_Common.deleteConfirmationPopup(this, \''+ZP_Automation_Mode.FROMADDRESS+"',  ZPA_FromAddress.deleteFromAddress)\"></i></div>";body+="<tr "+editHtml+"><td><i onclick=\"ZPA_FromAddress.changeDFA('"+fromAddrDtl.fromAddressId+'\')" class="'+addrClass+'" title="'+title+'"></i></td><td>'+ZSEC.Encoder.encodeForHTML(fromAddrDtl.displayName)+"</td><td><span>"+fromAddrDtl.fromAddress+'</span></td><td><span class="d-flexclmcap5">'+verified+"</span></td><td>"+dkimHtml+"</td><td>"+delHtml+"</td></tr>"}),pageId.find(".zpl_rgtcnt").append(body),ZPA_Common.Loader.removePageLoading(pageId)}},getFromAddrPopUphtml:function(){var fromAddrHtml='<div class="zpl_crd">';return fromAddrHtml+='<div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.displayname")+'</label></div><div><input id="fromAddrDispname" type="text" class="ztextbox"></div></div>',fromAddrHtml+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.emlfromaddr")+'</label></div><div class="zpl_idiv"><div><input id="fromAddrVal" type="text" class="ztextbox w300"></div><span id="atAddrSpn">@</span><select type="text" id="fromAddr_domainList" class="ztextbox" value=""></select></div></div>',fromAddrHtml+="</div></div>"},constructFromAddressPopUp:function(isDirectAdd,header){header=ZPA_Common.isNotNull(header)?header:ZPI18N.getString("zp.addemlfrom");var tab=new Tab;tab.id="fromAddr_Popup",tab.cardId="fromAddr_Cards",tab.validate=ZPA_FromAddress.saveFromAddress,ZPA_FromAddress.POPUP_MODAL=new popupModal(header,tab),ZPA_FromAddress.POPUP_MODAL.construct(),ZPA_FromAddress.POPUP_MODAL.setCloseCallback(function(){ZPA_FromAddress.closePopUp()}),ZPA_Common.getPopUpId(ZPA_FromAddress.POPUP_MODAL).find("#"+tab.cardId).append(ZPA_FromAddress.getFromAddrPopUphtml()),ZPA_FromAddress.populateDomains(isDirectAdd)},getFromAddressDtl:function(fromAddressId){var resultObj={};return $.each(ZPA_FromAddress.FROM_ADDR_DTLS,function(index,value){var fromAddrDtl=JSON.parse(JSON.stringify(value));fromAddrDtl.isOrgEmail;if(fromAddrDtl.fromAddressId==fromAddressId)return resultObj.fromAddress=fromAddrDtl.fromAddress,resultObj.displayName=fromAddrDtl.displayName,void(resultObj.type=fromAddrDtl.type)}),resultObj},getDefaultFromAddressDtl:function(){var resultObj={};return $.each(ZPA_FromAddress.FROM_ADDR_DTLS,function(index,value){var fromAddrDtl=JSON.parse(JSON.stringify(value)),isOrgEmail=fromAddrDtl.isOrgEmail;fromAddrDtl.fromAddressId;if(isOrgEmail)return resultObj.fromAddress=fromAddrDtl.fromAddress,resultObj.displayName=fromAddrDtl.displayName,void(resultObj.type=fromAddrDtl.type)}),resultObj},editFromAddress:function(fromAddressId){ZPA_FromAddress.constructFromAddressPopUp(!1,ZPI18N.getString("zp.edtemlfrom"));var popUpId=ZPA_Common.getPopUpId(ZPA_FromAddress.POPUP_MODAL);popUpId.data("fromAddressId",fromAddressId);var fromAddrDtl=ZPA_FromAddress.getFromAddressDtl(fromAddressId),fromAddr=fromAddrDtl.fromAddress,displayName=fromAddrDtl.displayName,type=fromAddrDtl.type;if(popUpId.find("#fromAddrDispname").val(displayName),type==zpconst.FromAddressType.Domain_Verified){var fromAddrTxt=fromAddr.substring(0,fromAddr.indexOf("@")),domain=fromAddr.substring(fromAddr.indexOf("@")+1,fromAddr.length);popUpId.find("#fromAddrVal").val(fromAddrTxt),ZPeopleComponents.select("#fromAddr_domainList").setValue(domain)}else type==zpconst.FromAddressType.Captcha_Verified&&(popUpId.find("#fromAddrVal").val(fromAddr),ZPeopleComponents.select("#fromAddr_domainList").setValue("other"));popUpId.find("#fromAddrVal").attr("disabled",!0),popUpId.find("#fromAddrVal").addClass("is-disabled"),ZPeopleComponents.select("#fromAddr_domainList").setAttribute("disabled",!0)},deleteFromAddress:function(thisObj){var delIcObj=thisObj.delIcObj,fromAddressId=$(delIcObj).attr("fromAddrId"),fromAddr=ZPA_FromAddress.getFromAddressDtl(fromAddressId).fromAddress;if(void 0!=fromAddressId&&""!=fromAddressId){var params={fromAddressId:fromAddressId,method:"deleteFromAddress",conreqcsr:csrfToken};ZPeople.Request.send("/v5/automation/fromaddress/delete",params,ZPA_FromAddress.successCallBack,fromAddr)}},closePopUp:function(){var popUpId=ZPA_Common.getPopUpId(ZPA_FromAddress.POPUP_MODAL);ZPeopleComponents.select(popUpId.find("#fromAddr_domainList")).destroy(),ZPA_FromAddress.POPUP_MODAL.remove(),ZPA_FromAddress.POPUP_MODAL=null},isDefaultFromAddress:function(fromAddressId){var isDefault=!1;return void 0!=ZPA_FromAddress.FROM_ADDR_DTLS&&ZPA_FromAddress.FROM_ADDR_DTLS.length>0&&$.each(ZPA_FromAddress.FROM_ADDR_DTLS,function(index,value){var fromAddrDtl=JSON.parse(JSON.stringify(value)),isOrgEmail=fromAddrDtl.isOrgEmail,fromAddrId=fromAddrDtl.fromAddressId;isOrgEmail&&fromAddrId==fromAddressId&&(isDefault=!0)}),isDefault},captchaConfirmation:function(fromAddressId){event.stopPropagation();var fromAddress=ZPA_FromAddress.getFromAddressDtl(fromAddressId).fromAddress,captchaHtml='<input id="fromCaptcha" type="text" class="ztextbox" fromAddrId ="'+fromAddressId+'"placeholder="'+ZPI18N.getString("zp.enterconfirmationcode")+'"><p><a onclick="ZPA_FromAddress.resendConfirmationCode(\''+fromAddressId+"')\">"+ZPI18N.getString("zp.orgresend")+"</a></p>";ZPA_FromAddress.confirmModal=new InfoAlertMessage(ZPI18N.getString("zp.orgconfirmmailaddr"),ZPI18N.getString("zp.provideconfirmationcode",["'<b>"+fromAddress+"</b>'"])),ZPA_FromAddress.confirmModal.yesButtonText=ZPI18N.getString("zp.confirm"),ZPA_FromAddress.confirmModal.setCenterHtml(captchaHtml),ZPA_FromAddress.confirmModal.setCallback(ZPA_FromAddress.verifyConfirmationCode),ZPA_FromAddress.confirmModal.show()},verifyConfirmationCode:function(){var fromAddrInp=$("#fromCaptcha"),fromAddrId=fromAddrInp.attr("fromAddrId"),confirmationCode=fromAddrInp.val();if(""===$.trim(confirmationCode)&&$.trim(confirmationCode).length<=3)return!1;var params={fromAddressId:fromAddrId,confirmationCode:confirmationCode,method:"verifyConfirmationCode",conreqcsr:csrfToken};ZPeople.Request.send("/v5/automation/fromaddress/verifyConfirmationCode",params,ZPA_FromAddress.successCallBack)},resendConfirmationCode:function(fromAddressId){if(ZPA_Common.isNotNull(fromAddressId)){var params={fromAddressId:fromAddressId,method:"resendConfirmationCode",conreqcsr:csrfToken};ZPeople.Request.send("/v5/automation/fromaddress/resendConfirmationCode",params,ZPA_FromAddress.successCallBack,"")}},confirmChangeDFA:function(infoAlrtObj){var fromAddressId=infoAlrtObj.fromAddressId;ZPA_FromAddress.setAsDFA(fromAddressId)},changeDFA:function(fromAddressId){if(event.stopPropagation(),void 0!=fromAddressId&&""!=fromAddressId&&!ZPA_FromAddress.isDefaultFromAddress(fromAddressId)){var dfaObj=ZPA_FromAddress.getDefaultFromAddressDtl(),infoAlert=new InfoAlertMessage,fromAddress=ZPA_FromAddress.getFromAddressDtl(fromAddressId).fromAddress;"noreply@zohopeople.com"==dfaObj.fromAddress||dfaObj.fromAddress==ZP_EMAIL_DEFAULT?(infoAlert.title=ZPI18N.getString("zp.setemailasdefault",[fromAddress]),infoAlert.despcription=ZPI18N.getString("zp.confirmsetemailasdefault",[fromAddress])+'<br><br><b class="red">'+ZPI18N.getString("zp.confirmremovenoreply",[ZP_EMAIL_DEFAULT])+"</b>"):(infoAlert.title=ZPI18N.getString("zp.setemailasdefault",[fromAddress]),infoAlert.despcription=ZPI18N.getString("zp.confirmsetemailasdefault",[fromAddress])),infoAlert.fromAddressId=fromAddressId,infoAlert.yesButtonText=ZPI18N.getString("zp.confirm"),infoAlert.setCallback(ZPA_FromAddress.confirmChangeDFA),infoAlert.show()}},setAsDFA:function(fromAddressId){var params={fromAddressId:fromAddressId,method:"setAsDefaultFromAddress",conreqcsr:csrfToken};ZPeople.Request.send("/v5/automation/fromaddress/setAsDefault",params,ZPA_FromAddress.successCallBack,"")},populateDomains:function(isDirectAdd,mode){var popUpId=ZPA_Common.getPopUpId(ZPA_FromAddress.POPUP_MODAL);if(popUpId.find("#fromAddrDispname").focus(),ZPA_FromAddress.VERIFIED_DOMAINS<=0)return popUpId.find("#fromAddrVal").closest(".zpl_idiv").removeClass("zpl_idiv"),popUpId.find("#fromAddr_domainList").addClass("DN"),popUpId.find("#fromAddrVal").removeClass("w300"),void ZPA_FromAddress.changePlaceholder();var dkimAuthDomains=[],domainList=void 0===isDirectAdd||isDirectAdd?ZPA_FromAddress.DOMAIN_VERIFIED_DKIM_AUTH_LIST:ZPA_FromAddress.VERIFIED_DOMAINS;$.each(domainList,function(index,domain){dkimAuthDomains.push(domain)}),settingsUrlProps.url.indexOf("fromaddress")>=0&&dkimAuthDomains.push("other");let domainListProps={options:dkimAuthDomains,dataMapping:{label:"value",value:"value"},change:ZPA_FromAddress.changePlaceholder};ZPA_Common.ZCompProp.loadSelectListProp(domainListProps),ZPeopleComponents.select("#fromAddr_domainList",domainListProps);var selDomain=ZPeopleComponents.select("#fromAddr_domainList").getValue();ZPA_FromAddress.changePlaceholder(selDomain)},changePlaceholder:function(domain){var popUpId=ZPA_Common.getPopUpId(ZPA_FromAddress.POPUP_MODAL);void 0==domain||"other"==domain?(popUpId.find("#fromAddrVal").attr("placeholder","john.smith@zylker.com"),popUpId.find("#atAddrSpn").html("")):(popUpId.find("#fromAddrVal").attr("placeholder","john.smith"),popUpId.find("#atAddrSpn").html("@"))},fetchAllFromAddress:function(async){if(async=void 0==async||async,ZPA_FromAddress.FROM_ADDR_DTLS.length<=0){$.ajax({url:"/v5/automation/fromaddress/all",type:"GET",data:{method:"fetchAllFromAddress"},async:async,success:function(data){ZPA_FromAddress.updateFromAddrDtls(data)}})}},getFromAddressItem:function(fromAddressId){var fromAddrItem=null;return void 0!=fromAddressId&&$.each(ZPA_FromAddress.FROM_ADDR_DTLS,function(index,fromItem){if(fromAddressId==fromItem.fromAddressId){var fromAddress=fromItem.fromAddress;if(!ZPA_FromAddress.isDKIMAuthenticated(fromAddress)){fromAddrItem={};var fromAddrTxt=fromItem.displayName+"<"+fromAddress+">";fromAddrItem={value:fromAddressId,displayName:fromAddrTxt,title:fromAddrTxt}}return!1}}),fromAddrItem},isDKIMAuthenticated:function(fromAddress){var isDMIMAuth=!1;if(void 0!=fromAddress&&""!=fromAddress){var atIndex=fromAddress.indexOf("@"),emailDomain=fromAddress.substring(atIndex+1,fromAddress.length);ZPA_FromAddress.DOMAIN_DKIM_AUTH_LIST[emailDomain]&&(isDMIMAuth=!0)}return isDMIMAuth},getVerifiedFromAddressList:function(){var fromAddrList=[{value:"myLogin",displayName:ZPI18N.getString("zp.personperformingaction"),title:ZPI18N.getString("zp.personperformingaction")}];if(ZPA_Common.isNotNull(ZPA_FromAddress.FROM_ADDR_DTLS)&&0!=ZPA_FromAddress.FROM_ADDR_DTLS.length||ZPA_FromAddress.fetchAllFromAddress(!1),void 0!=ZPA_FromAddress.FROM_ADDR_DTLS&&ZPA_FromAddress.FROM_ADDR_DTLS.length>0){var defOpt="";$.each(ZPA_FromAddress.FROM_ADDR_DTLS,function(index,value){var fromAddrDtl=JSON.parse(JSON.stringify(value)),isOrgEmail=fromAddrDtl.isOrgEmail,isVerified=fromAddrDtl.isVerified,fromAddress=fromAddrDtl.fromAddress,fromAddrTxt=fromAddrDtl.displayName+"<"+fromAddress+">",ddValue=fromAddrDtl.fromAddressId,isDMIMAuth=ZPA_FromAddress.isDKIMAuthenticated(fromAddress);if(isOrgEmail&&(fromAddrTxt=ZPI18N.getString("zp.orgdefaultemail")+"("+fromAddrTxt+")",defOpt={value:ddValue="ORGEMAIL",displayName:fromAddrTxt,title:fromAddrTxt},fromAddrList.push(defOpt)),isVerified&&isDMIMAuth&&!isOrgEmail){var opt={value:ddValue,displayName:fromAddrTxt,title:fromAddrTxt};fromAddrList.push(opt)}index==ZPA_FromAddress.FROM_ADDR_DTLS.length-1&&fromAddrList.slice(0,0,defOpt)})}return fromAddrList},updateFromAddrDtls:function(respJson){var fromAddrDtls=respJson.fromAddrDtls;void 0!=fromAddrDtls&&fromAddrDtls.length>0&&(ZPA_FromAddress.FROM_ADDR_DTLS=fromAddrDtls);var verifiedDomainList=respJson.verifiedDomainList;void 0!=verifiedDomainList&&verifiedDomainList.length>0&&(ZPA_FromAddress.VERIFIED_DOMAINS=verifiedDomainList);var domainDKIMList=respJson.domainDKIMList;void 0!=domainDKIMList&&(ZPA_FromAddress.DOMAIN_DKIM_AUTH_LIST=domainDKIMList),$.each(domainDKIMList,function(domain,authStatus){ZPA_FromAddress.VERIFIED_DOMAINS.indexOf(domain)>=0&&authStatus&&ZPA_FromAddress.DOMAIN_VERIFIED_DKIM_AUTH_LIST.push(domain)})},validateFromAddress:function(fromAddr,dispName){var isError=!1,popUpId=ZPA_Common.getPopUpId(ZPA_FromAddress.POPUP_MODAL);(void 0!=fromAddr&&""!=fromAddr&&ZPUtil.Validation.isEmail(fromAddr)||(ZPA_Common.appendErrorDiv(popUpId.find("#fromAddrVal"),ZPI18N.getString("zp.validfromaddr")),isError=!0),void 0==dispName||""==dispName)?(ZPA_Common.appendErrorDiv(popUpId.find("#fromAddrDispname"),ZPI18N.getString("zp.dispNamemandatory")),isError=!0):dispName.length>50&&(ZPA_Common.appendErrorDiv(popUpId.find("#fromAddrDispname"),ZPI18N.getString("zp.fromaddrdispmaxsize")),isError=!0);return isError},isValidFromAddressId:function(fromAddressId){var isValid=!1;return isNaN(fromAddressId)||void 0!=ZPA_FromAddress.FROM_ADDR_DTLS&&ZPA_FromAddress.FROM_ADDR_DTLS.length>0&&$.each(ZPA_FromAddress.FROM_ADDR_DTLS,function(index,value){JSON.parse(JSON.stringify(value)).fromAddressId!=fromAddressId||(isValid=!0)}),isValid},validateFromAddrConfig:function(fromAddr,dispName){var isError=!1,popUpId=ZPA_Common.getPopUpId(ZPA_FromAddress.POPUP_MODAL);if(void 0==fromAddr||""==fromAddr||!ZPUtil.Validation.isEmail(fromAddr)){var fromAddrParent=popUpId.find("#fromAddrVal").parent();ZPA_Common.appendErrorDiv(fromAddrParent,ZPI18N.getString("zp.validfromaddr")),isError=!0}if(void 0==dispName||""==dispName){var dispNameParent=popUpId.find("#fromAddrDispname").parent();ZPA_Common.appendErrorDiv(dispNameParent,ZPI18N.getString("zp.dispNamemandatory")),isError=!0}else{if(dispName.length>50){dispNameParent=popUpId.find("#fromAddrDispname").parent();ZPA_Common.appendErrorDiv(dispNameParent,ZPI18N.getString("zp.fromaddrdispmaxsize")),isError=!0}}return isError},saveFromAddress:function(){var popUpId=ZPA_Common.getPopUpId(ZPA_FromAddress.POPUP_MODAL);ZPA_Common.removeErrorDiv(popUpId);var fromAddressId=popUpId.data("fromAddressId"),fromAddrDiv=popUpId.find("#fromAddrVal"),dispNameDiv=popUpId.find("#fromAddrDispname"),selDomain=ZPeopleComponents.select(popUpId.find("#fromAddr_domainList")).getValue(),type=zpconst.FromAddressType.Captcha_Verified,fromAddr=void 0!=fromAddrDiv.val()?fromAddrDiv.val():"";void 0!=selDomain&&""!=selDomain&&"other"!=selDomain&&(fromAddr+="@"+selDomain,type=zpconst.FromAddressType.Domain_Verified);var dispName=dispNameDiv.val();if(void 0==fromAddressId||"undefined"==fromAddressId||""==fromAddressId){if(!ZPA_FromAddress.validateFromAddress(fromAddr,dispName)){var params={fromAddressId:"",fromAddress:fromAddr,displayName:dispName,type:type,method:"configureFromAddress",conreqcsr:csrfToken};ZPeople.Request.send("/v5/automation/fromaddress/configure",params,ZPA_FromAddress.successCallBack,"",ZPA_FromAddress.failureCallBack)}}else if(!ZPA_FromAddress.validateFromAddrConfig(fromAddr,dispName)){params={fromAddressId:fromAddressId,fromAddress:fromAddr,displayName:dispName,type:type,method:"configureFromAddress",conreqcsr:csrfToken};ZPeople.Request.send("/v5/automation/fromaddress/configure",params,ZPA_FromAddress.successCallBack,"",ZPA_FromAddress.failureCallBack)}},successCallBack:function(resultData,params){ZPA_Common.getPopUpId(ZPA_FromAddress.POPUP_MODAL);var mode=params.method,status=resultData.status;if("success"==status){if("configureFromAddress"==mode)if(ZPA_FromAddress.closePopUp(),settingsUrlProps.url.indexOf("fromaddress")>=0)ZPeople.Message.success(ZPI18N.getString("zp.fromaddresssave"));else{var fromAddrDtl=resultData.fromAddrDtl;ZPA_Messages.appendFromAddress(fromAddrDtl.fromAddressId,fromAddrDtl.fromAddress,fromAddrDtl.displayName)}else"setAsDefaultFromAddress"==mode?ZPeople.Message.success(ZPI18N.getString("zp.deffromaddrupdated")):"deleteFromAddress"==mode?ZPeople.Message.success(ZPI18N.getString("zp.fromaddrdeleted")):"verifyConfirmationCode"==mode?ZPeople.Message.success(ZPI18N.getString("zp.fromaddrverified")):"resendConfirmationCode"==mode&&(ZPA_FromAddress.confirmModal.remove(),ZPeople.Message.success(ZPI18N.getString("zp.triggercaptcha")));settingsUrlProps.url.indexOf("fromaddress")>=0&&(ZPA_FromAddress.FROM_ADDR_DTLS=[],ZPA_FromAddress.initPage())}else if("failure"==status)if("deleteFromAddress"==mode){var errMsg=resultData.errMsg,mappedActions=resultData.mappedActions;void 0!=mappedActions?ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.FROMADDRESS,mappedActions):void 0!=errMsg&&ZPeople.Message.failure(errMsg)}else{errMsg=resultData.errMsg;ZPeople.Message.failure(errMsg)}},failureCallBack:function(resultData,params,otherDetails){var responseJSON=resultData.responseJSON;"configureFromAddress"==params.method&&void 0!=responseJSON.code&&"MORE_THAN_MAX_LENGTH"==responseJSON.code&&(void 0!=responseJSON.paramName&&"displayName"==responseJSON.paramName?ZPeople.Message.failure(ZPI18N.getString("zp.fromaddrdispmaxsize")):void 0!=responseJSON.paramName&&"fromAddress"==responseJSON.paramName&&ZPeople.Message.failure(ZPI18N.getString("zp.copycustomization.enteravalidemailaddress"),"fromAddr_Popup"))}};ZPA_Template={initCallback:function(mode){var pageId=ZPA_Common.getParentPageId();pageId.addClass("zpl_tblfxd");var topMenuDiv=pageId.find("#topSettMenu");topMenuDiv.removeClass("zp_dyn"),topMenuDiv.find(".zpl_rgt").siblings().remove(),topMenuDiv.find(".zpl_rgt").remove(),pageId.append('<div class="zpl_rgtcnt"></div>');ZPA_Common.getServiceName();if(isadmin||isManageAutoAdmin)switch(mode){case ZP_Automation_Mode.EMAILTEMPLATE:var formLiId=ZPA_Template.getFormListId(mode),topmenuHtml="<div ><span>"+ZPI18N.getString("zp.form")+'</span><select id="'+formLiId+'"></select></div>'+'<div class="zpl_rgt"> <button id="add_emlTemp" class="zlabel zlabel--blue zlabel--medium" onclick="ZPA_EmailTemplate.addSlide()">'+ZPI18N.getString("zp.addemltempbtn")+"</button></div>";topMenuDiv.append(topmenuHtml),ZPA_Template.loadFormList(formLiId),ZPA_EmailTemplate.IS_LOADED=!1,ZPA_EmailTemplate.initPage();break;case ZP_Automation_Mode.LETTERTEMPLATE:formLiId=ZPA_Template.getFormListId(mode),topmenuHtml="<div ><span>"+ZPI18N.getString("zp.form")+'</span><select id="'+formLiId+'"></select></div>'+'<div class="zpl_rgt"> <button id="add_emlTemp" class="zlabel zlabel--blue zlabel--medium" onclick="ZPA_RecordTemplate.addSlide()">'+ZPI18N.getString("zp.addrcdtempbtn")+"</button></div>";topMenuDiv.append(topmenuHtml),ZPA_Template.loadFormList(formLiId),ZPA_RecordTemplate.IS_LOADED=!1,ZPA_RecordTemplate.initPage();break;case ZP_Automation_Mode.MAILMERGE:formLiId=ZPA_Template.getFormListId(mode),topmenuHtml="<div ><span>"+ZPI18N.getString("zp.form")+'</span><select id="'+formLiId+'"></select></div>'+'<div class="zpl_rgt"> <button id="add_mmTemp" class="zlabel zlabel--blue zlabel--medium" onclick="ZP_Mailmerge.loadAddTemplateSlider()">'+ZPI18N.getString("zp.template.add")+"</button></div>";topMenuDiv.append(topmenuHtml),ZPA_Template.loadFormList(formLiId),ZP_Mailmerge.init();break;case ZP_Automation_Mode.MESSAGETEMPLATE:formLiId=ZPA_Template.getFormListId(mode),topmenuHtml="<div ><span>"+ZPI18N.getString("zp.form")+'</span><select id="'+formLiId+'"></select></div>'+'<div class="zpl_rgt"> <button id="add_messageTemp" class="zlabel zlabel--blue zlabel--medium" onclick="ZPA_PostMessageTemplate.addSlide()">'+ZPI18N.getString("zp.addpostmessagetempbtn")+"</button></div>";topMenuDiv.append(topmenuHtml),ZPA_Template.loadFormList(formLiId),ZPA_PostMessageTemplate.IS_LOADED=!1,ZPA_PostMessageTemplate.initPage()}else new EmptyPages("zp_nd_permission",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"),"",pageId).show()},getFormListId:function(mode){var serviceName=ZPA_Common.getServiceName();return mode==ZP_Automation_Mode.EMAILTEMPLATE?serviceName+"_emlTempLi_FormLi":mode==ZP_Automation_Mode.LETTERTEMPLATE?serviceName+"_rcdTempLi_FormLi":mode==ZP_Automation_Mode.MESSAGETEMPLATE?serviceName+"_msgTempLi_FormLi":void 0},loadFormList:function(formListId){var mode=ZP_Automation_Mode.TEMPLATE,serviceName=ZPA_Common.getServiceName();ZPA_Common.getFormList(mode,serviceName);var copiedFormList=ZPA_Common[mode+"_"+serviceName+"_formList"].slice(0);copiedFormList.splice(0,0,{formId:"0",dispName:"All"});var selectedFormId=settingsUrlProps.urlParamsArr.formid,formListProp={options:copiedFormList,change:ZPA_Template.formChangeCallback,dataMapping:{label:"dispName",value:"formId",title:"dispName"}};ZPA_Common.isNotNull(selectedFormId)&&(formListProp.selectedValue=selectedFormId),ZPA_Common.ZCompProp.loadSelectListProp(formListProp),ZPeopleComponents.select("#"+formListId,formListProp)},formChangeCallback:function(){var mode=ZPA_Common.getPageMode();if(mode==ZP_Automation_Mode.EMAILTEMPLATE)ZPA_EmailTemplate.IS_LOADED=!1,void 0!=(formId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(mode)).getValue())&&""!=formId&&ZPA_Common.changeActionUrl("emailtemplate",formId);else if(mode==ZP_Automation_Mode.LETTERTEMPLATE){ZPA_RecordTemplate.IS_LOADED=!1,void 0!=(formId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(mode)).getValue())&&""!=formId&&ZPA_Common.changeActionUrl("recordtemplate",formId)}else if(mode==ZP_Automation_Mode.MESSAGETEMPLATE){var formId;ZPA_PostMessageTemplate.IS_LOADED=!1,void 0!=(formId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(mode)).getValue())&&""!=formId&&ZPA_Common.changeActionUrl("messagetemplate",formId)}},afterSaveCB:function(mode,formId){var formLiId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(mode)).getValue();mode==ZP_Automation_Mode.EMAILTEMPLATE?ZPA_EmailTemplate.IS_LOADED=!1:mode==ZP_Automation_Mode.LETTERTEMPLATE?ZPA_RecordTemplate.IS_LOADED=!1:mode==ZP_Automation_Mode.MESSAGETEMPLATE&&(ZPA_PostMessageTemplate.IS_LOADED=!1),formId!=formLiId&&ZPeopleComponents.select("#"+ZPA_Template.getFormListId(mode)).setValue(formId)}},ZPA_EmailTemplate={IS_LOADED:!1,LIMIT:{NAME:100,MESSAGE:1e5},initPage:function(formId){var pageId=ZPA_Common.getParentPageId();formId=void 0!=formId&&""!=formId?formId:ZPeopleComponents.select("#"+ZPA_Template.getFormListId(ZP_Automation_Mode.EMAILTEMPLATE)).getValue();var serviceName=ZPA_Common.getServiceName(),params={method:"getSelectedTemplateViewList",formId:formId,conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),ZPA_EmailTemplate.IS_LOADED||(pageId.find(".zpl_rgtcnt").empty(),ZPA_Common.Loader.appendPageLoading(pageId),$.post("/viewSelectedEmailTemplateList.zp",params,function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.EMAILTEMPLATE))return!1;if(ZPA_EmailTemplate.IS_LOADED=!0,data.length>0){pageId.find("#add_emlTemp").removeClass("DN");var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+'</th><th width="100"></th></tr></thead><tbody>';$.each(data,function(){body+="<tr onclick=\"ZPA_EmailTemplate.editSlide('"+this.TEMPLATEID+"', '"+this.FORMID+"',true)\"><td>"+this.TEMPLATE_NAME+"</td><td>"+this.DISPLAY_NAME+'</td><td><div class="zpl_hvr"><i action="clone" title="'+ZPI18N.getString("zp.clone")+'" data-title-display-type="callout" class="PI_clone" onclick="ZPA_EmailTemplate.cloneSlide(\''+this.TEMPLATEID+"', '"+this.FORMID+"')\"></i>","21"!==this.TEMPLATE_TYPE&&"22"!==this.TEMPLATE_TYPE&&"23"!==this.TEMPLATE_TYPE&&"101"!==this.TEMPLATE_TYPE&&"24"!==this.TEMPLATE_TYPE&&"25"!==this.TEMPLATE_TYPE&&"801"!=this.TEMPLATE_TYPE&&(body+='<i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" displayName="'+this.TEMPLATE_NAME+'" templateId="'+this.TEMPLATEID+'" onclick="ZPA_Common.deleteConfirmationPopup(this, \''+ZP_Automation_Mode.EMAILTEMPLATE+"', ZPA_EmailTemplate.deleteEmailTemplate)\"></i>"),body+="</div></td></tr>"}),pageId.find(".zpl_rgtcnt").append(body)}else{pageId.find("#add_emlTemp").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.EMAILTEMPLATE),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.EMAILTEMPLATE),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.EMAILTEMPLATE),pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.addemltempbtn"),ZPA_EmailTemplate.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)}))},getContainerBody:function(){var body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+'</label></div><div><select type="text" id="emlTemp_formList" class="ztextbox" value=""></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.emltempname")+'</label></div><div><input type="text" id="emltemp_name" placeholder="" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.EMAILTEMPLATE+"')\"></div></div></div></div>";return body+='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.message")+'</label></div><div id="msgEditor" class="zpl_msgedtr"></div></div></div>'},loadDefault:function(isEdit,formId){ZPA_Common.getPageMode();var serviceName=ZPA_Common.getServiceName();ZPA_Common.getFormList(ZP_Automation_Mode.TEMPLATE,serviceName);var formListId=ZP_Automation_Mode.TEMPLATE+"_"+serviceName+"_formList";formId=ZPA_Common.isNotNull(formId)?formId:settingsUrlProps.urlParamsArr.formid;let formListProp={options:ZPA_Common[formListId],dataMapping:{label:"dispName",value:"formId",title:"dispName"},change:ZPA_EmailTemplate.resetEmailTemplate,selectedValue:formId};void 0!=isEdit&&isEdit&&(formListProp.disabled=!0),ZPA_Common.ZCompProp.loadSelectListProp(formListProp),formListProp.dropdownList.appendTo="#"+ZPA_Common.getPageIdValue(ZP_Automation_Mode.EMAILTEMPLATE),ZPeopleComponents.select("#emlTemp_formList",formListProp),ZPA_Editor.initiateEditor(ZP_Automation_Mode.EMAILTEMPLATE,formId,"")},resetEmailTemplate:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILTEMPLATE),formId=ZPeopleComponents.select("#emlTemp_formList").getValue();pageId.find("#emltemp_name").val(""),ZPA_Editor.initiateEditor(ZP_Automation_Mode.EMAILTEMPLATE,formId,""),ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.EMAILTEMPLATE,!1)},construct:function(header){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.EMAILTEMPLATE),tab.cardId="emailTemp_cards",tab.validate=ZPA_EmailTemplate.save,ZPA_EmailTemplate.tempModal=new sliderModal(header,tab),ZPA_EmailTemplate.tempModal.mediumSize=!0,ZPA_EmailTemplate.tempModal.construct(),ZPA_Common.CloseAlert.construct(ZPA_EmailTemplate.tempModal),ZPA_EmailTemplate.tempModal.setCloseCallback(function(){ZPA_EmailTemplate.remove()});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILTEMPLATE);pageId.data("modalInstance",ZPA_EmailTemplate.tempModal);var $temp_cards=pageId.find("#"+tab.cardId);ZPA_Common.setRelativeContainer($temp_cards),$temp_cards.append(ZPA_EmailTemplate.getContainerBody())},addSlide:function(){var formId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(ZP_Automation_Mode.EMAILTEMPLATE)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/emailtemplate/add-formid:"+formId},add:function(){ZPA_EmailTemplate.construct(ZPI18N.getString("zp.addemltempbtn")),ZPA_EmailTemplate.loadDefault()},cloneSlide:function(templateId,formId){event.stopPropagation(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/emailtemplate/clone-formid:"+formId+"/templateid:"+templateId},clone:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_EmailTemplate.edit(editParams.templateid,editParams.formid,!0)},editSlide:function(templateId,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/emailtemplate/edit-formid:"+formId+"/templateid:"+templateId},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_EmailTemplate.edit(editParams.templateid,editParams.formid,!1)},edit:function(templateId,formId,isClone){ZPA_EmailTemplate.construct(isClone?ZPI18N.getString("zp.addemltempbtn"):ZPI18N.getString("zp.editemltemphdr")),ZPA_EmailTemplate.loadDefault(!0,formId);var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILTEMPLATE),params={templateId:templateId,method:"getSelectedTemplateRow",conreqcsr:csrfToken};$.post("/getEmailTemplateRow.zp",params,function(data){var emailTempRow=data[0],templateId=isClone?0:emailTempRow.TEMPLATEID,templateName=decodeHTML(emailTempRow.TEMPLATE_NAME),tempmsg=emailTempRow.TEMPLATE;pageId.data("emailTempId",templateId),pageId.find("#emltemp_name").val(templateName),editor.setContent(decodeHTML(tempmsg))})},deleteEmailTemplate:function(thisObj){var delIcObj=thisObj.delIcObj,templateId=$(delIcObj).attr("templateId"),params=($(delIcObj).attr("displayName"),{templateId:templateId,method:"deleteTemplate",conreqcsr:csrfToken});$.ajax({url:"/deleteEmailTemplateRow.zp",type:"POST",data:params,success:function(data){"success"===data.result?(ZPA_EmailTemplate.IS_LOADED=!1,ZPA_EmailTemplate.initPage()):ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.EMAILTEMPLATE,data.result)}})},validateEmailTemplate:function(paramJson){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILTEMPLATE),isValid=!0;ZPA_Common.removeErrorDiv(pageId);var tempName=paramJson.templateName,tempMsg=paramJson.templateMessage;""==$.trim(tempName)?(ZPA_Common.appendErrorDiv(pageId.find("#emltemp_name"),ZPI18N.getString("zp.template.namecantempty")),isValid=!1):tempName.length>ZPA_EmailTemplate.LIMIT.NAME&&(ZPA_Common.appendErrorDiv(pageId.find("#emltemp_name"),ZPI18N.getString("zp.maxemltempname")),isValid=!1);var tempMsgHtml=$(tempMsg);return ZPUtil.Validation.isEmpty(tempMsgHtml.text())?(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.entcont")),isValid=!1):tempMsg.length>ZPA_EmailTemplate.LIMIT.MESSAGE&&(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.lengthofmessage")),isValid=!1),isValid},save:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.EMAILTEMPLATE);ZPA_Common.disableSaveBtn(pageId);var emailTempId=void 0!=pageId.data("emailTempId")?pageId.data("emailTempId"):0,emailTempName=pageId.find("#emltemp_name").val(),formId=ZPeopleComponents.select(pageId.find("#emlTemp_formList")).getValue(),tempMsg=editor.getContent(),params={formid:formId,templateName:emailTempName,method:"saveTemplate",conreqcsr:csrfToken,templateMessage:tempMsg,templateId:emailTempId};ZPA_EmailTemplate.validateEmailTemplate(params)?ZPeople.Request.send("/saveEmailTemplate.zp",params,function(data){ZPA_Common.enableSaveBtn(pageId),ZPA_EmailTemplate.remove(),ZPA_Common.isNotNull(params.templateId)?ZPeople.Message.success(ZPI18N.getString("zp.emltmpupd")):ZPeople.Message.success(ZPI18N.getString("zp.emltmpadd")),ZPA_Template.afterSaveCB(ZP_Automation_Mode.EMAILTEMPLATE,formId)},"",function(data){ZPA_Common.enableSaveBtn(pageId),ZPA_Common.isNotNull(data.responseJSON)?ZPeople.Message.failure(data.responseJSON.error):ZPeople.Message.failure("Upgrade subscription to add more email template")}):ZPA_Common.enableSaveBtn(pageId)},remove:function(){var formId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(ZP_Automation_Mode.EMAILTEMPLATE)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/emailtemplate-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/emailtemplate",ZPA_EmailTemplate.tempModal.remove()}},ZPA_RecordTemplate={IS_LOADED:!1,LIMIT:{NAME:100,MESSAGE:1e5},initPage:function(formId){var pageId=ZPA_Common.getParentPageId();formId=void 0!=formId&&""!=formId?formId:ZPeopleComponents.select("#"+ZPA_Template.getFormListId(ZP_Automation_Mode.LETTERTEMPLATE)).getValue();var serviceName=ZPA_Common.getServiceName(),params={method:"getSelectedTemplateViewList",formId:formId,conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),ZPA_RecordTemplate.IS_LOADED||(pageId.find(".zpl_rgtcnt").empty(),ZPA_Common.Loader.appendPageLoading(pageId),$.post("/viewSelectedRecordTemplateList.zp",params,function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.LETTERTEMPLATE))return!1;ZPA_RecordTemplate.IS_LOADED=!0;var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+'</th><th width="100"></th></tr></thead><tbody>';if(data.length>0)pageId.find("#add_emlTemp").removeClass("DN"),$.each(data,function(){body+="<tr onclick=\"ZPA_RecordTemplate.editSlide('"+this.TEMPLATEID+"', '"+this.FORMID+"')\"><td>"+this.TEMPLATE_NAME+"</td><td>"+this.DISPLAY_NAME+'</td><td><div class="zpl_hvr"><i action="clone" title="'+ZPI18N.getString("zp.clone")+'" data-title-display-type="callout" class="PI_clone" onclick="ZPA_RecordTemplate.cloneSlide(\''+this.TEMPLATEID+"', '"+this.FORMID+'\')"></i><i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" displayName="'+this.TEMPLATE_NAME+'" templateId="'+this.TEMPLATEID+'" onclick="ZPA_Common.deleteConfirmationPopup(this, \''+ZP_Automation_Mode.LETTERTEMPLATE+"',  ZPA_RecordTemplate.deleteRecordTemplate)\"></i></div></td></tr>"}),pageId.find(".zpl_rgtcnt").append(body);else{pageId.find("#add_emlTemp").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.LETTERTEMPLATE),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.LETTERTEMPLATE),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.LETTERTEMPLATE),pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.addrcdtempbtn"),ZPA_RecordTemplate.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)}))},getContainerBody:function(){var body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+'</label></div><div><select type="text" id="rcdTemp_formList" class="ztextbox" value=""></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.rcdtempname")+'</label></div><div><input type="text" id="rcdtemp_name" placeholder="" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.LETTERTEMPLATE+"')\"></div></div></div></div>";return body+='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.message")+'</label></div><div id="msgEditor" class="zpl_msgedtr"></div></div></div>'},loadDefault:function(isEdit,formId){ZPA_Common.getPageMode();var serviceName=ZPA_Common.getServiceName();ZPA_Common.getFormList(ZP_Automation_Mode.TEMPLATE,serviceName);var formListId=ZP_Automation_Mode.TEMPLATE+"_"+serviceName+"_formList";formId=ZPA_Common.isNotNull(formId)?formId:settingsUrlProps.urlParamsArr.formid;let formListProp={options:ZPA_Common[formListId],dataMapping:{label:"dispName",value:"formId",title:"dispName"},change:ZPA_RecordTemplate.resetRecordTemplate,selectedValue:formId};(void 0!=isEdit&&isEdit||ZPA_Common.getPageMode()!=ZP_Automation_Mode.LETTERTEMPLATE)&&(formListProp.disabled=!0),ZPA_Common.ZCompProp.loadSelectListProp(formListProp),formListProp.dropdownList.appendTo="#"+ZPA_Common.getPageIdValue(ZP_Automation_Mode.LETTERTEMPLATE),ZPeopleComponents.select("#rcdTemp_formList",formListProp),ZPA_Editor.initiateEditor(ZP_Automation_Mode.LETTERTEMPLATE,formId,"")},resetRecordTemplate:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.LETTERTEMPLATE),formId=ZPeopleComponents.select("#rcdTemp_formList").getValue();pageId.find("#rcdtemp_name").val(""),ZPA_Editor.initiateEditor(ZP_Automation_Mode.LETTERTEMPLATE,formId,""),ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.EMAILTEMPLATE,!1)},construct:function(header){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.LETTERTEMPLATE),tab.cardId="rcdTemp_cards",tab.validate=ZPA_RecordTemplate.save,ZPA_RecordTemplate.tempModal=new sliderModal(header,tab),ZPA_RecordTemplate.tempModal.mediumSize=!0,ZPA_RecordTemplate.tempModal.construct(),ZPA_Common.CloseAlert.construct(ZPA_RecordTemplate.tempModal),ZPA_RecordTemplate.tempModal.setCloseCallback(function(){ZPA_RecordTemplate.remove()});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.LETTERTEMPLATE);pageId.data("modalInstance",ZPA_RecordTemplate.tempModal);var $temp_cards=pageId.find("#"+tab.cardId);ZPA_Common.setRelativeContainer($temp_cards),$temp_cards.append(ZPA_RecordTemplate.getContainerBody())},addSlide:function(){var formId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(ZP_Automation_Mode.LETTERTEMPLATE)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/recordtemplate/add-formid:"+formId},add:function(formId){ZPA_RecordTemplate.construct(ZPI18N.getString("zp.addrcdtempbtn")),ZPA_RecordTemplate.loadDefault(!1,formId)},cloneSlide:function(templateId,formId){event.stopPropagation(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/recordtemplate/clone-formid:"+formId+"/templateid:"+templateId},clone:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_RecordTemplate.edit(editParams.templateid,editParams.formid,!0)},editSlide:function(templateId,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/recordtemplate/edit-formid:"+formId+"/templateid:"+templateId},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_RecordTemplate.edit(editParams.templateid,editParams.formid,!1)},edit:function(templateId,formId,isClone){ZPA_RecordTemplate.construct(isClone?ZPI18N.getString("zp.addrcdtempbtn"):ZPI18N.getString("zp.editrcdtemphdr")),ZPA_RecordTemplate.loadDefault(!0,formId);var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.LETTERTEMPLATE),params={templateId:templateId,method:"getSelectedTemplateRow",conreqcsr:csrfToken};$.post("/getRecordTemplateRow.zp",params,function(data){var recordTempRow=data[0],templateId=isClone?0:recordTempRow.TEMPLATEID,templateName=decodeHTML(recordTempRow.TEMPLATE_NAME),tempmsg=recordTempRow.TEMPLATE;pageId.data("recordTempId",templateId),pageId.find("#rcdtemp_name").val(templateName),editor.setContent(decodeHTML(tempmsg))})},deleteRecordTemplate:function(thisObj){var delIcObj=thisObj.delIcObj,templateId=$(delIcObj).attr("templateId"),params=($(delIcObj).attr("displayName"),{templateId:templateId,method:"deleteTemplate",conreqcsr:csrfToken});$.ajax({url:"/deleteRecordTemplateRow.zp",type:"POST",data:params,success:function(data){"success"===data.result?(ZPA_RecordTemplate.IS_LOADED=!1,ZPA_RecordTemplate.initPage()):ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.LETTERTEMPLATE,data.result)}})},validateRecordTemplate:function(paramJson){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.LETTERTEMPLATE),isValid=!0;ZPA_Common.removeErrorDiv(pageId);var tempName=paramJson.templateName,tempMsg=paramJson.templateMessage;""==$.trim(tempName)?(ZPA_Common.appendErrorDiv(pageId.find("#rcdtemp_name"),ZPI18N.getString("zp.template.namecantempty")),isValid=!1):tempName.length>ZPA_RecordTemplate.LIMIT.NAME&&(ZPA_Common.appendErrorDiv(pageId.find("#rcdtemp_name"),ZPI18N.getString("zp.maxrcdtempname")),isValid=!1);var tempMsgHtml=$(tempMsg);return ZPUtil.Validation.isEmpty(tempMsgHtml.text())?(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.entcont")),isValid=!1):tempMsg.length>ZPA_RecordTemplate.LIMIT.MESSAGE&&(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.lengthofmessage")),isValid=!1),(tempMsg.indexOf("${Person performing this action}")>=0||tempMsg.indexOf("${Reporting To}")>=0)&&(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),"Document Template should not contains Person performing this action/Reporting to"),isValid=!1),isValid},save:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.LETTERTEMPLATE);ZPA_Common.disableSaveBtn(pageId);var recordTempId=void 0!=pageId.data("recordTempId")?pageId.data("recordTempId"):0,recordTempName=pageId.find("#rcdtemp_name").val(),formId=ZPeopleComponents.select(pageId.find("#rcdTemp_formList")).getValue(),tempMsg=editor.getContent(),params={formid:formId,templateName:recordTempName,method:"saveTemplate",conreqcsr:csrfToken,templateMessage:tempMsg,templateId:recordTempId};ZPA_RecordTemplate.validateRecordTemplate(params)?ZPeople.Request.send("/saveRecordTemplate.zp",params,function(data){ZPA_Common.enableSaveBtn(pageId),ZPA_RecordTemplate.remove(),ZPA_Common.isNotNull(params.templateId)&&0!=params.templateId?ZPeople.Message.success(ZPI18N.getString("zp.lettmpupd")):ZPeople.Message.success(ZPI18N.getString("zp.lettmpadd"));var pageMode=ZPA_Common.getPageMode(),tempObj={};tempObj.templateId=data.templateID,tempObj.templateName=recordTempName,pageMode==ZP_Automation_Mode.WORKFLOW||pageMode==ZP_Automation_Mode.CUSTOMACTION?ZPA_Actions.callBackActions(ZP_Automation_Mode.LETTERTEMPLATE,tempObj):ZPA_Template.afterSaveCB(ZP_Automation_Mode.LETTERTEMPLATE,formId)},"",function(data){ZPA_Common.enableSaveBtn(pageId),ZPA_Common.isNotNull(data.responseJSON)?ZPeople.Message.failure(data.responseJSON.error):ZPeople.Message.failure("Upgrade subscription to add more letter template")}):ZPA_Common.enableSaveBtn(pageId)},remove:function(){if(-1==settingsUrlProps.url.indexOf("custombutton")){var formId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(ZP_Automation_Mode.LETTERTEMPLATE)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/recordtemplate-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/recordtemplate"}ZPA_RecordTemplate.tempModal.remove()}},ZPA_PostMessageTemplate={IS_LOADED:!1,LIMIT:{NAME:100,MESSAGE:1e5},initPage:function(formId){var pageId=ZPA_Common.getParentPageId();formId=void 0!=formId&&""!=formId?formId:ZPeopleComponents.select("#"+ZPA_Template.getFormListId(ZP_Automation_Mode.MESSAGETEMPLATE)).getValue();var serviceName=ZPA_Common.getServiceName(),params={method:"getSelectedTemplateViewList",formId:formId,conreqcsr:csrfToken};serviceName!=ZPA_Common.COMMON_SERVICE&&(params.serviceName=serviceName),ZPA_PostMessageTemplate.IS_LOADED||(pageId.find(".zpl_rgtcnt").empty(),ZPA_Common.Loader.appendPageLoading(pageId),$.post("/postmessage/viewSelectedpostMessageTemplateList",params,function(data){if(!ZPA_Common.isProperPage(ZP_Automation_Mode.MESSAGETEMPLATE))return!1;if(ZPA_PostMessageTemplate.IS_LOADED=!0,data.length>0){pageId.find("#add_messageTemp").removeClass("DN");var body='<div name="action_body" class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.name")+"</th><th>"+ZPI18N.getString("zp.formname")+'</th><th width="100"></th></tr></thead><tbody>';$.each(data,function(){body+="<tr onclick=\"ZPA_PostMessageTemplate.editSlide('"+this.TEMPLATEID+"', '"+this.FORMID+"',true)\"><td>"+this.TEMPLATE_NAME+"</td><td>"+this.DISPLAY_NAME+'</td><td><div class="zpl_hvr"><i action="clone" title="'+ZPI18N.getString("zp.clone")+'" data-title-display-type="callout" class="PI_clone" onclick="ZPA_PostMessageTemplate.cloneSlide(\''+this.TEMPLATEID+"', '"+this.FORMID+"')\"></i>","21"!==this.TEMPLATE_TYPE&&"22"!==this.TEMPLATE_TYPE&&"23"!==this.TEMPLATE_TYPE&&"101"!==this.TEMPLATE_TYPE&&"24"!==this.TEMPLATE_TYPE&&"25"!==this.TEMPLATE_TYPE&&"801"!=this.TEMPLATE_TYPE&&(body+='<i action="delete" title="'+ZPI18N.getString("zp.delete")+'" data-title-display-type="callout" class="PI_delete" displayName="'+this.TEMPLATE_NAME+'" templateId="'+this.TEMPLATEID+'" onclick="ZPA_Common.deleteConfirmationPopup(this, \''+ZP_Automation_Mode.MESSAGETEMPLATE+"', ZPA_PostMessageTemplate.deletePostMessageTemplate)\"></i>"),body+="</div></td></tr>"}),pageId.find(".zpl_rgtcnt").append(body)}else{pageId.find("#add_messageTemp").addClass("DN");var emptyPageObj=new EmptyPages(ZPA_Common.getEmptyPageIcon(ZP_Automation_Mode.MESSAGETEMPLATE),ZPA_Common.getEmptyPageTitle(ZP_Automation_Mode.MESSAGETEMPLATE),ZPA_Common.getEmptyPageDesc(ZP_Automation_Mode.MESSAGETEMPLATE),pageId.find(".zpl_rgtcnt"));emptyPageObj.setButton(ZPI18N.getString("zp.addpostmessagetempbtn"),ZPA_PostMessageTemplate.addSlide),emptyPageObj.show()}ZPA_Common.Loader.removePageLoading(pageId)}))},getContainerBody:function(){var body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.formname")+'</label></div><div><select type="text" id="messageTemp_formList" class="ztextbox" value=""></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.messagetempname")+'</label></div><div><input type="text" id="messagetemp_name" placeholder="" class="ztextbox" onchange="ZPA_Common.CloseAlert.changesMade(\''+ZP_Automation_Mode.MESSAGETEMPLATE+"')\"></div></div></div></div>";return body+='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.message")+'</label></div><div id="msgEditor" class="zpl_msgedtr"></div></div></div>'},loadDefault:function(isEdit,formId){ZPA_Common.getPageMode();var serviceName=ZPA_Common.getServiceName();ZPA_Common.getFormList(ZP_Automation_Mode.TEMPLATE,serviceName);var formListId=ZP_Automation_Mode.TEMPLATE+"_"+serviceName+"_formList";formId=ZPA_Common.isNotNull(formId)?formId:settingsUrlProps.urlParamsArr.formid;let formListProp={options:ZPA_Common[formListId],dataMapping:{label:"dispName",value:"formId",title:"dispName"},change:ZPA_PostMessageTemplate.resetPostMessageTemplate,selectedValue:formId};void 0!=isEdit&&isEdit&&(formListProp.disabled=!0),ZPA_Common.ZCompProp.loadSelectListProp(formListProp),formListProp.dropdownList.appendTo="#"+ZPA_Common.getPageIdValue(ZP_Automation_Mode.MESSAGETEMPLATE),ZPeopleComponents.select("#messageTemp_formList",formListProp),ZPA_Editor.initiateEditor(ZP_Automation_Mode.MESSAGETEMPLATE,formId,"")},resetPostMessageTemplate:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.MESSAGETEMPLATE),formId=ZPeopleComponents.select("#messageTemp_formList").getValue();pageId.find("#messagetemp_name").val(""),ZPA_Editor.initiateEditor(ZP_Automation_Mode.MESSAGETEMPLATE,formId,""),ZPA_Common.CloseAlert.changesMade(ZP_Automation_Mode.MESSAGETEMPLATE,!1)},construct:function(header){var tab=new Tab;tab.id=ZPA_Common.getPageIdValue(ZP_Automation_Mode.MESSAGETEMPLATE),tab.cardId="messageTemp_cards",tab.validate=ZPA_PostMessageTemplate.save,ZPA_PostMessageTemplate.tempModal=new sliderModal(header,tab),ZPA_PostMessageTemplate.tempModal.mediumSize=!0,ZPA_PostMessageTemplate.tempModal.construct(),ZPA_Common.CloseAlert.construct(ZPA_PostMessageTemplate.tempModal),ZPA_PostMessageTemplate.tempModal.setCloseCallback(function(){ZPA_PostMessageTemplate.remove()});var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.MESSAGETEMPLATE);pageId.data("modalInstance",ZPA_PostMessageTemplate.tempModal);var $temp_cards=pageId.find("#"+tab.cardId);ZPA_Common.setRelativeContainer($temp_cards),$temp_cards.append(ZPA_PostMessageTemplate.getContainerBody())},addSlide:function(){var formId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(ZP_Automation_Mode.MESSAGETEMPLATE)).getValue();formId="0"!=formId?formId:ZPA_Common.getDefaultFormId(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/messagetemplate/add-formid:"+formId},add:function(){ZPA_PostMessageTemplate.construct(ZPI18N.getString("zp.addpostmessagetempbtn")),ZPA_PostMessageTemplate.loadDefault()},cloneSlide:function(templateId,formId){event.stopPropagation(),window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/messagetemplate/clone-formid:"+formId+"/templateid:"+templateId},clone:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_PostMessageTemplate.edit(editParams.templateid,editParams.formid,!0)},editSlide:function(templateId,formId){window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/messagetemplate/edit-formid:"+formId+"/templateid:"+templateId},editConfig:function(){var editParams=settingsUrlProps.urlParamsArr;ZPA_PostMessageTemplate.edit(editParams.templateid,editParams.formid,!1)},edit:function(templateId,formId,isClone){ZPA_PostMessageTemplate.construct(isClone?ZPI18N.getString(" zp.postmessagetemp"):ZPI18N.getString("zp.editmessagetemphdr")),ZPA_PostMessageTemplate.loadDefault(!0,formId);var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.MESSAGETEMPLATE),params={templateId:templateId,method:"getSelectedTemplateRow",conreqcsr:csrfToken};$.post("/postmessage/getPostMessageTemplateRow",params,function(data){var emailTempRow=data[0],templateId=isClone?0:emailTempRow.TEMPLATEID,templateName=decodeHTML(emailTempRow.TEMPLATE_NAME),tempmsg=emailTempRow.TEMPLATE;pageId.data("messageTempId",templateId),pageId.find("#messagetemp_name").val(templateName),editor.setContent(decodeHTML(tempmsg))})},deletePostMessageTemplate:function(thisObj){var delIcObj=thisObj.delIcObj,templateId=$(delIcObj).attr("templateId"),params=($(delIcObj).attr("displayName"),{templateId:templateId,method:"deleteTemplate",conreqcsr:csrfToken});$.ajax({url:"/postmessage/deletePostMessageTemplateRow",type:"POST",data:params,success:function(data){"success"===data.result?(ZPA_PostMessageTemplate.IS_LOADED=!1,ZPA_PostMessageTemplate.initPage()):ZPA_Common.showCannotDeleteModal(ZP_Automation_Mode.MESSAGETEMPLATE,data.result)}})},validatePostMessageTemplate:function(paramJson){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.MESSAGETEMPLATE),isValid=!0;ZPA_Common.removeErrorDiv(pageId);var tempName=paramJson.templateName,tempMsg=paramJson.templateMessage;""==$.trim(tempName)?(ZPA_Common.appendErrorDiv(pageId.find("#messagetemp_name"),ZPI18N.getString("zp.template.namecantempty")),isValid=!1):tempName.length>ZPA_PostMessageTemplate.LIMIT.NAME&&(ZPA_Common.appendErrorDiv(pageId.find("#messagetemp_name"),ZPI18N.getString("zp.maxmessagetempname")),isValid=!1);var tempMsgHtml=$(tempMsg);return ZPUtil.Validation.isEmpty(tempMsgHtml.text())?(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.entcont")),isValid=!1):tempMsg.length>ZPA_PostMessageTemplate.LIMIT.MESSAGE&&(ZPA_Common.appendErrorDiv(pageId.find("#msgEditor"),ZPI18N.getString("zp.lengthofmessage")),isValid=!1),isValid},save:function(){var pageId=ZPA_Common.getPageId(ZP_Automation_Mode.MESSAGETEMPLATE);ZPA_Common.disableSaveBtn(pageId);var emailTempId=void 0!=pageId.data("messageTempId")?pageId.data("messageTempId"):0,emailTempName=pageId.find("#messagetemp_name").val(),formId=ZPeopleComponents.select(pageId.find("#messageTemp_formList")).getValue(),tempMsg=editor.getContent(),params={formid:formId,templateName:emailTempName,method:"saveTemplate",conreqcsr:csrfToken,templateMessage:tempMsg,templateId:emailTempId};ZPA_PostMessageTemplate.validatePostMessageTemplate(params)?ZPeople.Request.send("/postmessage/savePostMessageTemplate",params,function(data){ZPA_Common.enableSaveBtn(pageId),ZPA_PostMessageTemplate.remove(),ZPA_Common.isNotNull(params.templateId)?ZPeople.Message.success(ZPI18N.getString("zp.messagetmpupd")):ZPeople.Message.success(ZPI18N.getString("zp.messagetmpadd")),ZPA_Template.afterSaveCB(ZP_Automation_Mode.MESSAGETEMPLATE,formId)},"",function(data){ZPA_Common.enableSaveBtn(pageId),ZPA_Common.isNotNull(data.responseJSON)?ZPeople.Message.failure(data.responseJSON.error):ZPeople.Message.failure("Upgrade subscription to add more email template")}):ZPA_Common.enableSaveBtn(pageId)},remove:function(){var formId=ZPeopleComponents.select("#"+ZPA_Template.getFormListId(ZP_Automation_Mode.MESSAGETEMPLATE)).getValue();ZPA_Common.isNotNull(formId)&&"0"!=formId?window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/messagetemplate-formid:"+formId:window.location.href="#settings/service/"+ZPA_Common.getServiceName()+"/messagetemplate",ZPA_PostMessageTemplate.tempModal.remove()}};var ZPA_FileUpload={getFileUploadHtml:function(tabId){Layout.Page.pageId;let isOnb=NewZPOnboarding.isOnbNotifyPage();var fileHtml='<div class="zpl_secn DN" id="attach_section"><div><label>'+ZPI18N.getString("zp.attachments")+"</label></div>";return fileHtml+='<div><div class="zpl_upld"><div class="zpl_fldrp"><h5><div class="zpl_flupld_img"></div>'+ZPI18N.getString("zp.lms.uploadfrom")+" ",fileHtml+='<a class="zpl_lnk" id="localUpload" onclick="ZPA_FileUpload.LocalUpload.loadLocalFile()"><i class="PI_case"></i>'+ZPI18N.getString("zp.files.desktop")+'</a> / <a class="zpl_lnk" id="cloudupload" onclick="ZPA_FileUpload.CloudUpload.init(\''+tabId+'\')"><i class="PI_cloud"></i>'+ZPI18N.getString("zp.files.cloud")+'</a> / <a id="triFileUplTemp" class="zpl_lnk" >'+ZPI18N.getString("zp.seltemps")+'</a><div id="fluplTemp"></div></h5></div><p><span>'+(isOnb?ZPI18N.getString("zp.allowedonbfileformat"):ZPI18N.getString("zp.allowedfileformat"))+"</span></p></div></div></div>",fileHtml+='<div class="zpl_secn"><div id="attachedFiles" class="DN"><h5>'+ZPI18N.getString("zp.attachmentfiles")+'</h5></div><div><div class="zpl_atchd" id="fluplDiv"></div></div></div>'},getAttachFileHtml:function(fileId,fileName,fileType){var attachFileHtml="<div fileId='"+fileId+"' fileType='"+fileType+"' fileName='"+ZSEC.Encoder.encodeForHTML(fileName)+'\' name="fileDiv"><div class="zpl_atchimg"><i class="'+ZPA_FileUpload.getFileTypeClass(fileType,fileName.substring(fileName.lastIndexOf(".")+1))+' zpl_fl_typ"></i></div>';return attachFileHtml+='<div class="zpl_atchdtl"><h4  title=\''+ZSEC.Encoder.encodeForHTML(fileName)+"' action='filename'>"+ZSEC.Encoder.encodeForHTML(fileName)+"</h4><p><span>"+ZPA_FileUpload.getFileDesc(fileType)+"</span></p></div>",attachFileHtml+='<div class="zpl_atchicn" onclick="ZPA_FileUpload.removeFile(this, \''+fileType+"')\"><i action='delete' class=\"PI_delete\"  title='"+ZPI18N.getString("zp.delete")+"'></i></div></div>"},getFileTypeClass:function(fileType,fileExtn){var fileTypeClass="PI_none";switch(fileType){case"2":case"4":fileTypeClass="PI_ft_pdf";break;default:fileTypeClass=FilesCommon.getFileIcon(fileExtn)}return fileTypeClass},getFileDesc:function(fileType){var fileDesc="";switch(fileType){case"2":fileDesc=ZPI18N.getString("zp.lettertemp");break;case"4":fileDesc=ZPI18N.getString("zp.mailmerge")}return fileDesc},loadFileUploadTemplates:function(mode){var pageId=ZPA_Common.getPageId(mode);ZPA_Util.getRecordTemplate(mode,ZPA_FileUpload.constructFileuploadTemplateList);var dropDown=pageId.find("#fluplTemp");pageId.find("#triFileUplTemp").off().on("click",function(){dropDown.is(":visible")?ZPeopleComponents.dropdownlist(dropDown).close():ZPeopleComponents.dropdownlist(dropDown).open({forElement:"#triFileUplTemp"})})},constructFileuploadTemplateList:function(mode,data){ZPA_Common.getMainContainer();var items=[];!$.isEmptyObject(data)&&(data.hasOwnProperty("rt")&&data.rt.length>0||data.hasOwnProperty("mt")&&data.mt.length>0)&&$.each(data,function(tempType,templateObj){$.each(templateObj,function(i,tempDtl){var tempOptDtl={};tempOptDtl.tempId=tempDtl.templateId,tempOptDtl.tempName=decodeHTML(tempDtl.tempName),tempOptDtl.title=decodeHTML(tempDtl.tempName),tempOptDtl.type="rt"==tempType?"2":"4",tempOptDtl.groupLabel="rt"==tempType?ZPI18N.getString("zp.lettertemp"):ZPI18N.getString("zp.mailmergetemps"),items.push(tempOptDtl)})});ZPeopleComponents.isComponent("#fluplTemp")&&ZPeopleComponents.dropdownlist("#fluplTemp").destroy();let tempDDProps={value:"",items:items,dataMapping:{text:"tempName",label:"tempName",value:"tempId",groupLabel:"groupLabel"},sort:!0,sortBy:"tempName",search:{by:["tempName"],criteria:"contains",highlightKeyword:!0},margin:{top:7},select:ZPA_FileUpload.selectFileCallback,deselect:ZPA_FileUpload.deselectFileCallback,multiple:!0,forElement:"#triFileUplTemp",appendTo:ZPA_Common.getPageCardContainerId(mode),positionAlterable:!0};ZPA_Common.ZCompProp.loadDropdownProp(tempDDProps),ZPeopleComponents.dropdownlist("#fluplTemp",tempDDProps)},selectFileCallback:function(event,data){var pageId=ZPA_Common.getMainContainer(),itemData=event.detail.itemData,selFileName=itemData.tempName,selFileId=itemData.tempId,selFileType=itemData.type,attachFileHtml=ZPA_FileUpload.getAttachFileHtml(selFileId,selFileName,selFileType);pageId.find("#fluplDiv").append(attachFileHtml),ZPA_FileUpload.toggleAttachFileHeader(),event.detail.fromUI&&ZPA_Common.CloseAlert.changesMade()},deselectFileCallback:function(event,data){var pageId=ZPA_Common.getMainContainer(),selFileId=event.detail.itemData.tempId;pageId.find("#fluplDiv [fileid="+selFileId+"]").remove(),ZPA_FileUpload.toggleAttachFileHeader(!0),ZPA_Common.CloseAlert.changesMade()},removeFile:function(thisObj,fileType){ZPA_Common.getMainContainer();if("5"!=fileType){var selTempId=$(thisObj).parent().attr("fileId");ZPeopleComponents.dropdownlist("#fluplTemp").deselect({tempId:selTempId}),ZPA_Common.CloseAlert.changesMade()}else ZPA_FileUpload.LocalUpload.removeLocalFile()},getUploadedRecordTempList:function(){var selFileDiv=ZPA_Common.getMainContainer().find("[name='fileDiv'][filetype!='5']"),recTempList=[];return $.each(selFileDiv,function(index,fileDtl){var recTempObj={};recTempObj.id=fileDtl.getAttribute("fileId"),recTempObj.dispName=fileDtl.getAttribute("fileName"),recTempObj.tempType=fileDtl.getAttribute("fileType"),recTempList.push(recTempObj)}),recTempList},setFileUploadList:function(data){var pageId=ZPA_Common.getMainContainer(),recTempList=data.recordTempIds,selectedTempIds=[];$.each(recTempList,function(index,tempObj){var tempId=tempObj.id,tempType=tempObj.type;if(5==tempType){pageId.find("#localUpload").data("existingFileObj",JSON.stringify(tempObj));var tempName=tempObj.dispName,attachFileHtml=ZPA_FileUpload.getAttachFileHtml(tempId,tempName,tempType);pageId.find("#fluplDiv").append(attachFileHtml),ZPA_FileUpload.toggleAttachFileHeader()}else selectedTempIds.push({tempId:tempId})}),$.isEmptyObject(selectedTempIds)||ZPeopleComponents.dropdownlist("#fluplTemp").setValues(selectedTempIds)},toggleAttachFileHeader:function(isRemoveFile){var pageId=ZPA_Common.getMainContainer();void 0!=isRemoveFile&&isRemoveFile?pageId.find("[name=fileDiv]").length<=0&&!pageId.find("#attachedFiles").hasClass("DN")&&pageId.find("#attachedFiles").addClass("DN"):pageId.find("#attachedFiles").hasClass("DN")&&pageId.find("#attachedFiles").removeClass("DN");pageId.find("#attachedFiles").length>0&&pageId.find("#attachedFiles")[0].scrollIntoView({behavior:"smooth",block:"center"})},isFileExtnAllowed:function(fileName){return!!/(\.pdf|\.doc|\.xls|\.csv|\.xlsx|\.zip)$/i.test(fileName)||(ZPeople.Message.warning(ZPI18N.getString("zp.supportedfileformat")),!1)},isOnbFileExtnAllowed:function(fileName){return!!/(\.jpg|\.jpeg|\.png|\.pdf|\.doc|\.xls|\.csv|\.xlsx|\.zip)$/i.test(fileName)||(ZPeople.Message.warning(ZPI18N.getString("zp.supportedfileformat")),!1)},appendUploadedFile:function(formData){ZPA_FileUpload.LocalUpload.appendLocalFile(formData),ZPA_FileUpload.CloudUpload.appendCloudFile(formData)}};ZPA_FileUpload.LocalUpload={loadLocalFile:function(){var pageId=ZPA_Common.getMainContainer();let isOnb=NewZPOnboarding.isOnbNotifyPage();var localFileInpBx=$('<div><input type="file" name="mailFlUpl"></div>');localFileInpBx.find("input").trigger("click"),localFileInpBx.find("input").off("change").on("change",function(event){var file=$(this)[0].files[0],fileName=file.name;file.size;if(fileName=fileName.replace("C:\\fakepath\\",""),!isOnb||ZPA_FileUpload.isOnbFileExtnAllowed(fileName))if(isOnb||ZPA_FileUpload.isFileExtnAllowed(fileName)){ZPA_FileUpload.LocalUpload.removeLocalFile(),pageId.find("#cloudupload").removeAttr("cloudUploadDoc"),pageId.find("#localUpload").data("fileObj",file);var attachFileHtml=ZPA_FileUpload.getAttachFileHtml("",fileName,"5");pageId.find("#fluplDiv").append(attachFileHtml),ZPA_FileUpload.toggleAttachFileHeader()}else ZPeople.Message.warning(ZPI18N.getString("zp.supportedfileformat"));else ZPeople.Message.warning(ZPI18N.getString("zp.supportedonbfileformat"))})},removeLocalFile:function(){var pageId=ZPA_Common.getMainContainer();pageId.find("#fluplDiv [filetype=5]").remove(),pageId.find("#localUpload").data("existingFileObj",""),pageId.find("#localUpload").data("fileObj",""),ZPA_FileUpload.toggleAttachFileHeader(!0),ZPA_Common.CloseAlert.changesMade()},appendLocalFile:function(formData){var pageId=ZPA_Common.getMainContainer();if(pageId.find("[name='fileDiv'][filetype='5']").length>0){var existingFileObj=pageId.find("#localUpload").data("existingFileObj"),file=pageId.find("#localUpload").data("fileObj");void 0!=existingFileObj&&""!==existingFileObj?(formData.append("existingData",existingFileObj),formData.append("recTempMode","localUpload")):void 0!=file&&""!==file&&(formData.append("attachment",file),formData.append("recTempMode","localUpload"),pageId.find("#cloudupload").data("cloudUploadDoc",!1))}ZPA_Common.CloseAlert.changesMade()}},ZPA_FileUpload.CloudUpload={init:function(tabId){CloudPicker.init(tabId,ZPA_FileUpload.CloudUpload.loadCloudUpload),CloudPicker.construct()},loadCloudUpload:function(){var pageId=ZPA_Common.getMainContainer();let isOnb=NewZPOnboarding.isOnbNotifyPage();var fileObj=JSON.parse(CloudPicker.getFileObj()),fileName=decodeURIComponent(fileObj.docName);if(!isOnb||ZPA_FileUpload.isOnbFileExtnAllowed(fileName))if(isOnb||ZPA_FileUpload.isFileExtnAllowed(fileName)){pageId.find("#fluplDiv [filetype=5]").remove(),pageId.find("#localUpload").data("existingFileObj",""),pageId.find("#localUpload").data("fileObj",""),pageId.find("#cloudupload").data("cloudUploadDoc",!0);var attachFileHtml=ZPA_FileUpload.getAttachFileHtml("",fileName,"5");pageId.find("#fluplDiv").append(attachFileHtml),ZPA_FileUpload.toggleAttachFileHeader()}else ZPeople.Message.warning(ZPI18N.getString("zp.supportedfileformat"));else ZPeople.Message.warning(ZPI18N.getString("zp.supportedonbfileformat"))},appendCloudFile:function(formData){var pageId=ZPA_Common.getMainContainer();if(pageId.find("[name='fileDiv'][filetype='5']").length>0){var isCloudUploadDoc=pageId.find("#cloudupload").data("cloudUploadDoc");void 0!=isCloudUploadDoc&&isCloudUploadDoc&&(formData.append("cloudUploadDoc",CloudPicker.getFileObj()),formData.append("recTempMode","cloudUpload"))}ZPA_Common.CloseAlert.changesMade()}};