class imgUpload{constructor(){this.coordinates={},this.container=$("body #modal_Container"),this.limit=5,this.aspectratio=1,this.message=""}show(){let thisObj=this,popup=this.createPopup();this.popup=popup,this.container.append(popup),popup.find("#imageUpload").change(function(){thisObj.validationcallback&&thisObj.validationcallback(this)?(thisObj.showMessage(),thisObj.readURL(this)):thisObj.validate(this.files)&&(thisObj.showMessage(),thisObj.readURL(this))})}createPopup(isCrop){let popupData={},thisObj=this;isCrop?(popupData.header=ZPI18N.getString("zp.cropcoverphoto"),popupData.class="zpl_mmd",popupData.innerHtml='<div class="zpl_upld-orignlimg">\n\t\t                            <img id="preview" src="" alt="">\n\t\t                        </div>'):(popupData.class="",popupData.header=ZPI18N.getString("zp.uploadphoto"),popupData.innerHtml=`<div fld="trag" class="zpl_fldrp">\n\t\t\t\t\t\t\t<div style="display:none"  class="ZPDrfile zpl_fupld-dragholder" id="dragdrop_layer"><div><i class="IC-file1x"></i><span> ${ZPI18N.getString("zp.dropfiletoattach")}</span></div></div>\n                            <div class="zpl_flupld_img"></div>\n                            <h4 class="zpl_h5">${ZPI18N.getString("zp.assessment.matches.drag_and_drop")}</h4> <p>or</p> \n                                        <input type="file" id="imageUpload" accept=".jpeg,.jpg,.png" style="display:none" >\n\t\t\t\t\t\t\t\t\t\t<button elem="fileUploadBtn" type="button" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.selectaphotofromyourcomputer")}</button>\n                        </div>\n                        <p field="message" >\n                            <span>${ZPI18N.getString("zp.supportsFileForCoverImg")}</span><span>${ZPI18N.getString("zp.resolution")}: 1200 X 140</span><span>${ZPI18N.getString("zp.lms.attachment.MaxfileSize")} ${thisObj.limit}MB</span><span><b>${ZPI18N.getString(this.message)}<b></span>\n                        </p>`);let popup=$(`<div class="zpl_mdl zpl_mcenter zpl_mopen ${popupData.class}" closemodelview="true" id="upload_orgcover" data-modal-box="companylogo">\n\t\t\t\t\t<div class="zpl_minr">\n\t\t\t\t\t\t<div class="zpl_mhder">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<h4>${popupData.header}</h4>\n\t\t\t\t\t\t\t</div><a field="close" class="_cls PI_cls"></a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="zpl_mcnt zpl_fm">\n\t\t\t\t\t\t            <div class="zpl_crd">\n\t\t\t\t\t\t                <div class="zpl_crdcnt zpl_pt5">\n\t\t\t\t\t\t                    <div class="zpl_upld">\n\t\t\t\t\t\t                       ${popupData.innerHtml}\n\t\t\t\t\t\t                    </div>\n\t\t\t\t\t\t                </div>\n\t\t\t\t\t\t            </div>\n\t\t\t\t\t\t        </div>\n\t\t\t\t\t\t${isCrop?`<div class="zpl_mfoter" ><button id="submitBtn" class="zlabel zlabel--blue zlabel--medium zbutton zbutton--medium zbutton--primary" onclick="">${ZPI18N.getString("zp.upload")}</button><button field="close" type="button" class="zlabel zlabel--outline zlabel--medium" onclick="">${ZPI18N.getString("zp.cancel")}</button></div>`:""}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`);if(isCrop)popup.find("#submitBtn").on("click",()=>{thisObj.submitcallback?thisObj.submitcallback(thisObj):thisObj.uploadToServer()});else{popup.find('[elem="fileUploadBtn"]').on("click",()=>{popup.find('[id="imageUpload"]input').click()});let trag=popup.find('[fld="trag"]');var dragLayer=trag.find("#dragdrop_layer");trag.on("dragenter",function(event){dragLayer.show()}),dragLayer.on("dragleave",function(e){e.preventDefault(),dragLayer.hide()}),dragLayer.on("drop",function(e){e.preventDefault();let fileInput=popup.find("#imageUpload"),files=e.originalEvent.dataTransfer.files;thisObj.validationcallback&&thisObj.validationcallback(files)?(fileInput[0].files=files,thisObj.showMessage(),thisObj.readURL(fileInput[0])):thisObj.validate(files)&&(fileInput[0].files=files,thisObj.showMessage(),thisObj.readURL(fileInput[0])),dragLayer.hide()}),dragLayer.on("dragover",function(e){e.preventDefault()})}return popup.find('[field="close"]').on("click",()=>{popup.remove()}),popup}showMessage(text,error){let message=this.popup.find('[field="message"]');message.show().text(text),error?message.html(`<span class="ztextbox--error__label">${text}<span>`):message.html(`<span>${ZPI18N.getString("zp.supportsFileForOrgLogo")}</span><span>Dimension: 1200 X 140</span><span>Maximum size: ${this.limit}MB</span>`)}readURL(input){if(input.files&&input.files[0]){var reader=new FileReader;let popup=this.createPopup(!0);this.cropView=popup,this.container.append(popup);let uploadObj=this;reader.onload=function(e){popup.find("#preview").attr("src",e.target.result),popup.find("#preview").show(),uploadObj.cropper&&uploadObj.cropper.destroy(),popup.find("#preview").Jcrop({bgColor:"white",onSelect:function(crop){let img=this.ui.holder.find("img")[0];uploadObj.imageDetails={originalWidth:img.naturalWidth,originalHeight:img.naturalHeight,renderedWidth:img.width,renderedHeight:img.height},uploadObj.updateCoordinates(crop)},bgFade:!0,bgOpacity:.7,aspectRatio:uploadObj.aspectratio},function(){uploadObj.cropper=this;this.setSelect((jcrop=>{let cropbox=jcrop.ui.holder;var cropbox_width=$(cropbox).width(),cropbox_height=$(cropbox).height();if(cropbox_width==cropbox_height)return[0,0,cropbox_width,cropbox_height];if(cropbox_width<cropbox_height){var a=cropbox_width;return[0,x=Math.round((cropbox_height-cropbox_width)/2),0,x+a]}if(cropbox_width>cropbox_height){var x;return a=cropbox_height,[x=Math.round((cropbox_width-cropbox_height)/2),0,x+a,0]}})(this))})},reader.readAsDataURL(input.files[0]),uploadObj.fileInput=input.files[0]}}updateCoordinates(crop){let imgDtls=this.imageDetails,newCropX=crop.x/imgDtls.renderedWidth*imgDtls.originalWidth,newCropY=crop.y/imgDtls.renderedHeight*imgDtls.originalHeight,newCropWidth=crop.w/imgDtls.renderedWidth*imgDtls.originalWidth,newCropHeight=crop.h/imgDtls.renderedHeight*imgDtls.originalHeight;this.coordinates={x:newCropX,y:newCropY,w:newCropWidth,h:newCropHeight}}uploadToServer(){if(!this.serverURL)return;this.cropView.find("#submitBtn").attr("disabled",!0).text(ZPI18N.getString("zp.uploading")).prepend(ZPFeeds.MINILOADER);let file=this.fileInput,coordinates=this.coordinates;if(file){const formData=new FormData;formData.append("img_file",file),formData.append("cropX",Math.round(coordinates.x)),formData.append("cropY",Math.round(coordinates.y)),formData.append("cropWidth",Math.round(coordinates.w)),formData.append("cropHeight",Math.round(coordinates.h)),ZPeople.Request.sendFormData(this.serverURL,formData,this.defaultSuccessCallback,this,this.defaultFailureCallback)}else alert("Please select a file to upload.")}defaultSuccessCallback(data,formData,thisObj){thisObj.cropView.find("#submitBtn").attr("disabled",!1).text(ZPI18N.getString("zp.upload")).find("#loader").remove(),thisObj.successcallback&&thisObj.successcallback(data,formData)}defaultFailureCallback(data,formData,thisObj){thisObj.cropView.find("#submitBtn").attr("disabled",!1).text(ZPI18N.getString("zp.upload")).find("#loader").remove(),thisObj.failurecallback&&thisObj.failurecallback(data,formData)}validate(file){let thisObj=this,fileObj=file[0];return fileObj.size>1024*thisObj.limit*1024?(thisObj.showMessage(`File size exceeds the ${thisObj.limit}MB limit!`,!0),!1):!!["image/jpeg","image/png","image/jpg "].includes(fileObj.type)||(thisObj.showMessage(ZPI18N.getString("zp.supportedcoverimageformat"),!0),!1)}destroy(){let popup=this.popup;popup.fadeOut(void 0,void 0,()=>{popup.remove()});let cropview=this.cropView;cropview.fadeOut(void 0,void 0,()=>{cropview.remove()})}}