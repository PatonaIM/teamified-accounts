Timetracker.jobs={referenceColumn:!1,ZProjectsPortals:{},ZProjectsTasks:{},fetchJob:!1,sorterObj:null,jobData:{},userJobs:null,formDetails:null,refreshData:!0,jobsPopulated:!1,isFromOperations:!1,pageLayout:null,FETCHED_JOB_COUNT:{},MAXJOB_FETCH_COUNT:25,VIEW_TYPE:null,defJobColor:"6",assignedbyoptions:{0:ZPI18N.getString("zp.allusers")},Listing:{constructSystemView:function(){var json={wrapperClass:"Nbar5",dataCallback:Timetracker.jobs.Listing.initSchedule,onchangeCallback:Timetracker.views.customViewActions,formId:Timetracker.jobs.formDetails.formId,formLoadCallback:Timetracker.jobs.Listing.initSchedule,searchCallback:Timetracker.jobs.Filters.constructFilterBasedOnView,systemViewName:Timetracker.util.jobDispName,exportCallback:Timetracker.ImportExport.showexportfld,tableName:"P_TimesheetJob"};if(TimetrackerOperations.init(),Timetracker.permissionCheckForOperPages())return Timetracker.jobs.pageLayout=settingsPage.container,Timetracker.jobs.isFromOperations=!0,json.importExportConstructionCallback=Timetracker.ImportExport.constructImportExportContainer,json},jobFormPermissionCheck(){if(!Timetracker.isDataAdminForAllUsers()&&(Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),0===Timetracker.jobs.formDetails.viewPerm)){var layout=settingsPage.container;return layout.html("<div class='zpl_rgtcnt'></div>"),Timetracker.Util.showHideNoData({div:layout,msg:ZPI18N.getString("zp.notallowedforpage"),cls:"zp_nd_permission"}),!1}return!0},constructOperationView:function(){var layout=settingsPage.container;layout.find("#viewFooter").addClass("zpl_DNI"),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").addClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").addClass("DNI"),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").addClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions").removeClass("DNI"),layout.find(".zpl_tblres:not(#zp_views_list_container)").hide(),layout.find("#zp_views_list_container.zpl_tblres").show(),layout.removeClass("zpl_colmaxwd zpl_crdwthful");var pageMode=Timetracker.Page.getPageMode();if(0===layout.find("#zp_views_list_container").length&&-1!=settingsUrlProps.niceUrl.indexOf("jobs/listview")){var moreBtnId="jobsMore_"+pageMode.split("_")[1]+"_",viewerHtml='<ul class="zpl_grpmnu" id="switchJobView"><li class="zpl_act" value="user" ref="switchView" aria-label="'+ZPI18N.getString("zp.employee")+'" tabindex="0" >'+ZPI18N.getString("zp.employee")+'</li><li value="department" ref="switchView" aria-label="'+ZPI18N.getString("zp.department")+'" tabindex="0">'+ZPI18N.getString("zp.department")+"</li>";if(Timetracker.generalSettings.isJobProLocApplicableEnabled()&&(viewerHtml+='<li value="location" ref="switchView" aria-label="'+ZPI18N.getString("zp.location")+'" tabindex="0">'+ZPI18N.getString("zp.location")+"</li>"),isOrgStructureEnabled){var divDispName=ZPI18N.getString("zp.divisionname");ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(divDispName=ZPeople.orgStructureDispNameMap.division),viewerHtml+='<li value="division" ref="switchView" class="zpl_nowrap"  aria-label="'+divDispName+'" tabindex="0">'+divDispName+"</li>"}viewerHtml+="</ul>";var jobLabelName=ZPI18N.getString("zp.tt.addentity",[Timetracker.util.getJobDisplayName(!0)]),html='<div class="zpl_rgt" id="zp_views_formrecactions">'+viewerHtml+'<button class="zlabel zlabel--blue zlabel--medium DB" id="addjobbutton" ref="addJob" aria-label="'+jobLabelName+'" tabindex="0" >'+jobLabelName+'</button><i id="fullScrn" ref="fullScreen" class="zpl_ibg PI_maxmz'+($("body").hasClass("zpl_newsrcn")?' zpl_act" title="'+ZPI18N.getString("zp.minimize"):'" title="'+ZPI18N.getString("zp.maximize"))+'"></i><i class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" aria-label="'+ZPI18N.getString("zp.filter")+'" tabindex="0" ref="toggleFilter"></i><i class="zpl_ibg PI_more" title="'+ZPI18N.getString("zp.more")+'"  aria-label="'+ZPI18N.getString("zp.more")+'" tabindex="0" ref="more" id="'+moreBtnId+'Btn"></i></div>';layout.find("#viewActionsContainer").append(html),html='<div class="actn_ovrly" id="zp_view_record_delete"></div>',layout.find("#viewActionsContainer").append(html),html='<div class="zpl_tblres" id="zp_views_list_container"></div>',layout.find(".zpl_rgtcnt").append(html),layout.addClass("zpl_tblfxd zpl_crdwthful zpl_act"),layout.find("#viewActionsContainer").find("#fullScreenBack,i.PI_back").attr("ref","exitFullScreen");var moreOpt=Timetracker.ImportExport.getImportExportArray(Timetracker.constants.JOB);moreOpt.length?Timetracker.Util.constructMoreOption(moreOpt,moreBtnId):layout.find("#"+moreBtnId+"Btn").hide(),Timetracker.jobs.VIEW_TYPE=null;var multiSelectBtnHtml=Timetracker.views.multiSelectActions.getMultiSelectHtml();layout.find("#zp_view_record_delete").html(multiSelectBtnHtml),Timetracker.Util.addEventListner(null,"click",Timetracker.jobs.Util.clickHandler,!0),Timetracker.Page.isSelectedUser(pageMode)&&layout.find("#switchJobView").addClass("zpl_DNI")}-1!=settingsUrlProps.niceUrl.indexOf("jobs/listview")&&Timetracker.Page.isSelectedUser(pageMode)&&layout.data("userId")!=Timetracker.Team.getSelectedUser()&&(Timetracker.jobs.Listing.setDefaultFilterParams(),Timetracker.jobs.refreshData=!0,layout.data("userId",Timetracker.Team.getSelectedUser()))},initSchedule:function(){var url=Layout.Page.hash;if(-1==url.indexOf("operations")){if(!Timetracker.jobs.Listing.jobFormPermissionCheck())return}else if(!Timetracker.permissionCheckForOperPages())return;if(Timetracker.jobs.isFromOperations=!0,Timetracker.jobs.pageLayout=Timetracker.Util.getLayout(),Timetracker.jobs.Listing.constructOperationView(),Timetracker.jobs.pageLayout.addClass("zpl_tblfxd zpl_crdwthful zpl_act"),-1!==url.indexOf("/jobs/add")||-1!==url.indexOf("/jobs/edit")||-1!==url.indexOf("/jobs/view")){Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),Timetracker.jobs.fetchJob=!0;let addEditJson={formId:Timetracker.jobs.formDetails.formId,tableName:"P_TimesheetJob",callback:Timetracker.forms.showListView,isEmbed:!0,formMode:"ADD"};-1!==url.indexOf("scheduler/jobs/edit")||-1!==url.indexOf("/jobs/edit")?(addEditJson.recordId=Layout.Page.urlparam.recordId,addEditJson.formMode="EDIT"):-1===url.indexOf("scheduler/jobs/view")&&-1===url.indexOf("/jobs/view")||(addEditJson.recordId=Layout.Page.urlparam.recordId,addEditJson.formMode="VIEW",addEditJson.editCallback=Timetracker.forms.editFormFromView,addEditJson.disableSingleEdit=!0),ZP5Form.isQuickAdd=!1,ZP5Form.formid=0,ZP5Form.load(addEditJson)}else if(-1!==url.indexOf("/jobs")){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;Timetracker.util.init(),0===layout.find("#joblist,#zp_empty_data").length||!Timetracker.jobs.jobsPopulated||Timetracker.jobs.refreshData?(Timetracker.jobs.Listing.loadDefaultSchedule(),Timetracker.jobs.jobsPopulated=!0,Timetracker.setWorkitemCache(),Timetracker.jobs.refreshData=!1):(Layout.Page.container.scrollTop(0),ZPeople.FireScroll.reset(Timetracker.jobs.FireScroll.getMode())),TimelyZComp.toolTip.intiliaze()}},loadDefaultSchedule:function(){var filterDiv;0!=(0!=(filterDiv=TimetrackerOperations.Filters.getFilterDiv()).find('[compname="jobName"]').length?TimelyZComp.select.getValue(filterDiv.find('[compname="jobName"]')):0)&&""==filterDiv.find('[compname="jobNameInput"]').val()&&TimelyZComp.select.setValue(filterDiv.find('[compname="jobName"]'),0),0!=(0!=(filterDiv=TimetrackerOperations.Filters.getFilterDiv("unassjob_filter_div")).find('[compname="jobName"]').length?TimelyZComp.select.getValue(filterDiv.find('[compname="jobName"]')):0)&&""==filterDiv.find('[compname="jobNameInput"]').val()&&TimelyZComp.select.setValue(filterDiv.find('[compname="jobName"]'),0),Timetracker.jobs.Listing.loadScheduleBasedOnView()},getViewType:function(){return null===Timetracker.jobs.VIEW_TYPE&&(Timetracker.jobs.VIEW_TYPE=Timetracker.constants.USER),Timetracker.jobs.VIEW_TYPE!=Timetracker.constants.USER&&Timetracker.Page.isSelectedUser()&&(Timetracker.jobs.VIEW_TYPE=Timetracker.constants.USER),Timetracker.jobs.VIEW_TYPE},switchView:function(ele){var viewType=$(ele).attr("value");if(viewType!==Timetracker.jobs.Listing.getViewType()&&!Timetracker.Page.isSelectedUser()){var divId;$(ele).addClass("zpl_act"),ZPUtil.Validation.isEmpty(viewType)?Timetracker.jobs.VIEW_TYPE=Timetracker.constants.USER:Timetracker.jobs.VIEW_TYPE=viewType,Timetracker.jobs.Listing.getViewType()===Timetracker.constants.USER?("job_filter_div",divId="joblist"):("unassjob_filter_div",Timetracker.jobs.Listing.getViewType()===Timetracker.constants.DEPARTMENT?divId="unassjoblist":Timetracker.jobs.Listing.getViewType()===Timetracker.constants.DIVISION?divId="unassjoblist_division":Timetracker.jobs.Listing.getViewType()===Timetracker.constants.LOCATION&&(divId="unassjoblist_location"));var filterDiv,layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;layout.find("#zp_views_list_container").find("#"+divId).css("display","block").siblings().css("display","none"),TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),0!=(0!=(filterDiv=TimetrackerOperations.Filters.getFilterDiv()).find('[compname="jobName"]').length?TimelyZComp.select.getValue(filterDiv.find('[compname="jobName"]')):0)&&""==filterDiv.find('[compname="jobNameInput"]').val()&&TimelyZComp.select.setValue(filterDiv.find('[compname="jobName"]'),0),TimetrackerOperations.Filters.isFilterOpen("unassjob_filter_div")&&TimetrackerOperations.Filters.toggleFilter("unassjob_filter_div"),0!=(0!=(filterDiv=TimetrackerOperations.Filters.getFilterDiv("unassjob_filter_div")).find('[compname="jobName"]').length?TimelyZComp.select.getValue(filterDiv.find('[compname="jobName"]')):0)&&""==filterDiv.find('[compname="jobNameInput"]').val()&&TimelyZComp.select.setValue(filterDiv.find('[compname="jobName"]'),0),Timetracker.Util.showHideNoData({remove:!0}),layout.find("#zp_views_list_container").children().css("display","none"),Timetracker.jobs.Listing.loadScheduleBasedOnView()}},loadScheduleBasedOnView:function(){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;layout.find("li[value="+Timetracker.jobs.Listing.getViewType()+"]").addClass("active zpl_act"),Timetracker.jobs.Listing.getViewType()===Timetracker.constants.DEPARTMENT?(layout.find("li[value=user]").removeClass("active zpl_act"),isOrgStructureEnabled&&layout.find("li[value=division]").removeClass("active zpl_act"),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&layout.find("li[value=location]").removeClass("active zpl_act"),Timetracker.jobs.UnAssignedJobs.getSchedule(Timetracker.constants.DEPARTMENT)):Timetracker.jobs.Listing.getViewType()===Timetracker.constants.DIVISION?(layout.find("li[value=user]").removeClass("active zpl_act"),layout.find("li[value=department]").removeClass("active zpl_act"),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&layout.find("li[value=location]").removeClass("active zpl_act"),Timetracker.jobs.UnAssignedJobs.getSchedule(Timetracker.constants.DIVISION)):Timetracker.jobs.Listing.getViewType()===Timetracker.constants.LOCATION?(layout.find("li[value=user]").removeClass("active zpl_act"),layout.find("li[value=department]").removeClass("active zpl_act"),isOrgStructureEnabled&&layout.find("li[value=division]").removeClass("active zpl_act"),Timetracker.jobs.UnAssignedJobs.getSchedule(Timetracker.constants.LOCATION)):(Timetracker.jobs.VIEW_TYPE=Timetracker.constants.USER,layout.find("li[value=department]").removeClass("active zpl_act"),isOrgStructureEnabled&&layout.find("li[value=division]").removeClass("active zpl_act"),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&layout.find("li[value=location]").removeClass("active zpl_act"),Timetracker.jobs.Listing.getSchedule())},getSchedule:function(sorterObj,isFunctionCallAfterStatusChange,latestCompletedJob,reloadFilter){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container,jobNameSearch=layout.find("#jobNameSearch").val(),jobNameType=0!=layout.find("#filterDiv").length?TimetrackerOperations.Filters.getSelectFilterValues(layout.find("#filterDiv").find('[compname="jobName"]')):0;if(""===jobNameSearch&&"0"!==jobNameType)return layout.find("#jobNameSearch").addClass("ztextbox__error"),layout.find("#jobNameSearch").parent().find("span").remove(),void layout.find("#jobNameSearch").after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.searchvaluescannotbeempty")+"</span>");0!=layout.find("#jobNameSearch").length&&(layout.find("#jobNameSearch").removeClass("ztextbox__error"),layout.find("#jobNameSearch").siblings().remove()),""!=jobNameSearch&&"0"==jobNameType&&(layout.find("#jobNameSearch").val(""),layout.find("#job_filter_div").data("previousName","0"),layout.find("#job_filter_div").data("previousSearchName",null)),Timetracker.jobs.FireScroll.resetDataOnLoad(),TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),TimetrackerOperations.Filters.isFilterOpen("unassjob_filter_div")&&TimetrackerOperations.Filters.toggleFilter("unassjob_filter_div"),layout.find("#joblist").hide(),layout.find('[comp="menu"]').each(function(){var id=$(this).attr("buttonId");ZPeopleComponents.isComponent("#"+id+"_opt")&&ZPeopleComponents.menu("#"+id+"_opt").destroy()}),layout.find("#joblist").parent().find("#tt_filterResultsHeader.timetracker").remove(),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(layout.find("#zp_views_list_container"));var params=Timetracker.jobs.Listing.getParamsToFetchJob(sorterObj,isFunctionCallAfterStatusChange,latestCompletedJob);layout.find("[bid=job_checkallbox]").prop("checked",!1),Timetracker.views.multiSelectActions.showHideMultiSelectOper(!1,layout),void 0!==sorterObj&&null!==sorterObj?(layout.find("[id^='jobSort']").removeClass("desc asc"),layout.find("[id^='jobSort']").attr("title",ZPI18N.getString("zp.sortbyasc")),params.isAscending?($(sorterObj).addClass("desc"),$(sorterObj).attr("title",ZPI18N.getString("zp.sortbyasc"))):($(sorterObj).addClass("asc"),$(sorterObj).attr("title",ZPI18N.getString("zp.sortbydesc")))):(layout.find("[id^='jobSort']").removeClass("desc asc"),params.isAscending?(layout.find("#jobSort"+params.sortType).addClass("desc"),layout.find("#jobSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbyasc"))):(layout.find("#jobSort"+params.sortType).addClass("asc"),layout.find("#jobSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbydesc")))),$.post(Timetracker.constants.URL,params,function(result){Timetracker.jobs.Listing.constructListOfJobs(result,"0"===params.assignedBy,!0,"job-listtbody"),Timetracker.util.addJobCheck(),Timetracker.util.removeLoading(layout),!0===reloadFilter&&Timetracker.cache.clearCache(Timetracker.constants.JOB_TABLE),TimelyZComp.toolTip.intiliaze(),Timetracker.FireScroll.resetFirescrollDtls(Timetracker.Page.getPageMode()+"_jobAssignees_","STARTS_WITH"),0==layout.find("#joblist").parent().find("#tt_filterResultsHeader.timetracker").length&&(html=TimetrackerOperations.Filters.filterHeaderHtml,layout.find("#joblist").before(html)),TimetrackerOperations.Filters.setFilterHeader(Timetracker.jobs.Listing.removeTopFilter);var filterdiv=layout.find("#tt_filterResultsHeader.timetracker");if(0!=filterdiv.find('[filterno="jobName"]').length){var jobSearchName=ZPeople.escapeHtml(layout.find("#jobNameSearch").val());filterdiv.find('[filterno="jobName"]').find("span").removeAttr("title"),filterdiv.find('[filterno="jobName"]').find("span").after('<span onclick="TimetrackerOperations.Filters.openFilterField(this);" title="'+jobSearchName+'" class="mxw100">'+jobSearchName+"</span>")}})},getDefaultJobParams:function(){var params={mode:"getSchedule",jobStatus:"0",projectId:"0",assignedBy:"0",assignedTo:erecno,isAssigneeCount:!0,fetchLoggedHrs:!0,conreqcsr:csrfToken};Timetracker.Util.getSortAscendingValues(Timetracker.constants.JOB,params);var pageMode=Timetracker.Page.getPageMode();return"ts_mydata"==pageMode?params.assignedTo=erecno:Timetracker.Page.isSelectedUser(pageMode)?params.assignedTo=Timetracker.Team.getSelectedUser():params.assignedTo="0",params},setDefaultFilterParams:function(){var filterDivId=void 0,viewType=Timetracker.jobs.Listing.getViewType();viewType!=Timetracker.constants.USER&&(filterDivId="unassjob_filter_div"),TimetrackerOperations.Filters.clearFilters(filterDivId);var filterDiv=TimetrackerOperations.Filters.getFilterDiv(filterDivId);if((!filterDiv||0!=filterDiv.length)&&(ZPeopleComponents.select(filterDiv.find('[compname="jobName"]')).setValue(0),filterDiv.find('[compname="jobNameInput"]').val(""),ZPeopleComponents.select(filterDiv.find('[compname="status"]')).setValue(0),viewType==Timetracker.constants.USER)){var pageMode=Timetracker.Page.getPageMode();if("ts_mydata"==pageMode||Timetracker.Page.isSelectedUser(pageMode)){var userDtls="ts_mydata"==pageMode?ZPeople.CURR_USER:ZPeople.getUserDetailsById(Timetracker.Team.getSelectedUser());result={},result.id=userDtls.usererec,result.zuid=userDtls.id,result.text=ZPeople.decodeTxt(userDtls.empid)+" "+ZPeople.decodeTxt(userDtls.name),result.html=userDtls.empid+" "+userDtls.name,result.photo=userDtls.thumb,result.decodedItemText=userDtls.empid+" "+userDtls.name,TimelyZComp.tokenField.addValues(filterDiv.find('[compname="assignedto"]'),[result]),ZPeopleComponents.tokenfield(filterDiv.find('[compname="assignedto"]')).setAttributes({disabled:!0})}}},removeTopFilter:function(event,clearAll){var viewType=Timetracker.jobs.Listing.getViewType();if(clearAll)Timetracker.jobs.Listing.setDefaultFilterParams();else{var ele=event.target,entity=$(ele).closest("li").attr("filterno"),filterDivId=void 0;viewType!=Timetracker.constants.USER&&(filterDivId="unassjob_filter_div"),filterDiv=TimetrackerOperations.Filters.getFilterDiv(filterDivId),"status"==entity?TimelyZComp.select.setValue(filterDiv.find('[compname="status"]'),0):"jobName"==entity?(TimelyZComp.select.setValue(filterDiv.find('[compname="jobName"]'),0),filterDiv.find('[compname="jobNameInput"]').val("")):TimelyZComp.tokenField.removeAllTokens(filterDiv.find('[compname="'+entity+'"]'))}viewType===Timetracker.constants.USER?Timetracker.jobs.Listing.getSchedule():Timetracker.jobs.UnAssignedJobs.getSchedule()},getParamsToFetchJob:function(sorterObj,isFunctionCallAfterStatusChange,latestCompletedJob){var params=Timetracker.jobs.Listing.getDefaultJobParams(),layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;return 0!==layout.find("#filterDiv").length&&(TimetrackerOperations.Filters.getFilterValues(params),params.searchJobName=layout.find("#jobNameSearch")&&!layout.find("#jobNameSearch").hasClass("DNI")?layout.find("#jobNameSearch").val():void 0,params.searchJobName&&params.searchJobName.length>255&&(params.searchJobName=params.searchJobName.substring(0,255))),"ts_team"==Timetracker.Page.getPageMode()&&(params.pageMode=1),isFunctionCallAfterStatusChange&&(params.latestCompletedJobId=latestCompletedJob),params.sIndex=Timetracker.jobs.FireScroll.getJobFetchCount(),params.limit=Timetracker.jobs.MAXJOB_FETCH_COUNT,void 0!==sorterObj&&null!==sorterObj?(Timetracker.jobs.sorterObj={},params.sortType=Timetracker.jobs.sorterObj.sortType=$(sorterObj).attr("type"),$(sorterObj).hasClass("desc")?params.isAscending=Timetracker.jobs.sorterObj.isAscending=!1:params.isAscending=Timetracker.jobs.sorterObj.isAscending=!0):null!==Timetracker.jobs.sorterObj&&(params.sortType=Timetracker.jobs.sorterObj.sortType,params.isAscending=Timetracker.jobs.sorterObj.isAscending),params},constructListOfJobs:function(result,flag,jobFlag,tbodyid){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;if(layout.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPeople.decodeTxt(Timetracker.jobs.formDetails.formDispName)]),tabindex:"0"}),Timetracker.jobs.Listing.constructJobViewTable(),layout.find("#joblist,#zp_empty_data").hide(),Timetracker.Util.showHideNoData({remove:!0}),null!==result&&""!==result&&result.schArr&&0!==result.schArr.length)result=result.schArr,layout.find("#"+tbodyid).find("[id^='mytable']").remove(),Timetracker.jobs.Listing.constructJobsHtml(result,flag,jobFlag,tbodyid),layout.find("#joblist").fadeIn(200).scrollTop(0);else{result=null===result||void 0===result.schArr||null===result.schArr?[]:result.schArr;var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.jobDispName]);Timetracker.util.checkAddJobPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.jobDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getJobDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:"zp_views_list_container"})}jobFlag&&(Timetracker.jobs.FireScroll.setJobFetchCount(result),Timetracker.jobs.FireScroll.resetJobFireScroll(result))},constructJobViewTable:function(){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;if(layout.find("#zp_views_container,.ZPNdata").remove(),0===layout.find("#joblist").length){var jobTable,pageCode=Timetracker.Page.getPageModeCode();jobTable='<div class="zpl_dtbl" id="joblist"><ul><li class="mw50"><div class="zcheckbox"><input type="checkbox" class="zcheckbox__helper" id="'+pageCode+'jcheckallbox" bid="job_checkallbox" ref="checkall"><label class="zcheckbox__label" for="'+pageCode+'jcheckallbox"></label></div></li><li class="w400"><b class="form_jobname">'+ZPI18N.getString("zp.jobname")+'</b><div class="zpl_icncnt"><i class="PI_sort" title="'+ZPI18N.getString("zp.sortbydesc")+'" id="jobSort0" type="0" ref="sort"></i></div></li><li class="mw50"></li><li class="mw150"><b>'+ZPI18N.getString("zp.sdate")+'</b><div class="zpl_icncnt"><i class="PI_sort" id="jobSort1" type="1" title="'+ZPI18N.getString("zp.sortbydesc")+'" ref="sort"></i></div></li><li class="mw150"><b>'+ZPI18N.getString("zp.edate")+'</b><div class="zpl_icncnt"><i class="PI_sort" id="jobSort2" type="2" title="'+ZPI18N.getString("zp.sortbydesc")+'" ref="sort"></i></div></li><li class="mw150"><b>'+ZPI18N.getString("zp.estimatedhours")+'</b></li><li class="mw150"><b>'+ZPI18N.getString("zp.loggedhours")+'</b></li><li class="mw50"></li><li class="mw150"><b>'+ZPI18N.getString("zp.status")+'</b></li><li class="mw100">'+ZPI18N.getString("zp.user(s)")+'</li><li class="mw100"></li></ul><div id="job-listtbody"></div></div>';var listDiv=layout.find("#zp_views_list_container");$(listDiv).children("[id!=unassjoblist]").remove(),isOrgStructureEnabled&&$(listDiv).children("[id!=unassjoblist_division]").remove();var jobListDiv=$(listDiv).find("#unassjoblist,#unassjoblist_division");let orderObj;0!==jobListDiv.length?($(jobListDiv).css("display","none"),$(listDiv).append(jobTable)):$(listDiv).html(jobTable);var sortType=(orderObj=Timetracker.jobs.sorterObj?Timetracker.jobs.sorterObj:Timetracker.Util.getSortAscendingValues(Timetracker.constants.JOB)).sortType,isAscending=orderObj.isAscending;layout.find("[id^='jobSort']").removeClass("desc asc"),isAscending?(layout.find("#jobSort"+sortType).addClass("desc"),layout.find("#jobSort"+sortType).attr("title",ZPI18N.getString("zp.sortbyasc"))):(layout.find("#jobSort"+sortType).addClass("asc"),layout.find("#jobSort"+sortType).attr("title",ZPI18N.getString("zp.sortbydesc"))),Timetracker.util.init()}ZPeople.FireScroll.init(Timetracker.jobs.FireScroll.loadMoreJobs,"",{mode:Timetracker.jobs.FireScroll.getMode()},!0)},constructJobsHtml:function(result,flag,jobFlag){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container,tbodyLayout=layout.find("#job-listtbody"),isFromPDPage=-1!=settingsUrlProps.niceUrl.indexOf("projectdashboard"),ownerObj={},pageCode=Timetracker.Page.getPageModeCode();$.each(result,function(index,data){jobFlag&&data.owner&&data.assignedBy&&""!==data.assignedBy&&(ownerObj[data.owner]=data.assignedBy),data.isFromPD=isFromPDPage,data.pageCode=pageCode;var row=Timetracker.jobs.Listing.constructJobRowHtml(data,jobFlag);tbodyLayout.append(row)}),0===layout.find("#job-listtbody").find('input[type="checkbox"]:enabled').length?layout.find("[bid=job_checkallbox]").attr("disabled",!0):layout.find("[bid=job_checkallbox]").attr("disabled",!1),0==layout.find(".zpl_projecticn").length?(layout.find("#joblist").find("ul li:nth-child(3)").addClass("DNI"),isFromPDPage&&layout.find("#job-listtbody").attr("style","min-width: 1300px;")):(layout.find("#joblist").find("ul li:nth-child(3)").removeClass("DNI"),isFromPDPage&&layout.find("#job-listtbody").attr("style","min-width: 1350px;"));var options=[];if(delete Timetracker.jobs.assignedbyoptions[0],Timetracker.jobs.assignedbyoptions=$.extend(!0,Timetracker.jobs.assignedbyoptions,ownerObj),0!==layout.find("#job_filter_div").length){for(var i in Timetracker.jobs.assignedbyoptions)i&&null!=i&&options.push({value:i,label:Timetracker.jobs.assignedbyoptions[i]});TimelyZComp.tokenField.addOptions(layout.find("#filterDiv").find("[compname=assignedby]"),options)}},constructJobRowHtml:function(data,jobFlag){var isJobEditAllowed=Timetracker.jobs.Util.isEditDeleteAllowed(Timetracker.isDataAdminForAllUsers(),data.owner,data.projectHead,data.projectManagers)&&jobFlag,isSelectAllowed=Timetracker.jobs.Util.isEditDeleteAllowed(Timetracker.jobs.Util.isEditDeleteAllowed(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit)),data.owner,data.projectHead,data.projectManagers)&&jobFlag,pageCode=data.pageCode?data.pageCode:Timetracker.Page.getPageModeCode(),row='<ul id= "mytable'+data.jobId+'"><li class="mw50" ref="skip"><div class="zcheckbox"><input type="checkbox" name="check" class="zcheckbox__helper" id="'+pageCode+data.jobId+'" recordId="'+data.jobId+'" owner="'+data.owner+'"';row+=isSelectAllowed?'ref="checkbox">':'disabled="true">',row+='<label class="zcheckbox__label" for="'+pageCode+data.jobId+'"></label></div></li>';var onclickeve="Timetracker.forms.showForm('"+Timetracker.constants.VIEW+"','"+data.jobId+"');";if(data.isFromPD&&(onclickeve="Timetracker.jobs.Operations.formAddEditView(undefined, '"+data.jobId+"', true);"),row+='<li class="w400 zpl_cp" onclick="'+onclickeve+'" aria-label=" '+ZPI18N.getString("zp.jobname")+":"+data.jobName+(data.projectName?" ProjectName:"+data.projectName:" ")+'" tabindex="0" ><div class="zpl_cstnmes"><span>'+data.jobName+"</span>",data.projectName&&(row+='<span class="zpl_dots"></span><em>'+data.projectName+"</em>"),row+="</div></li>",data.zProjectsProjectRefId&&data.zProjectsJobRefId?row+='<li class="mw50"><a class="zpl_projecticn" ref="ZProject_job" title="'+ZPI18N.getString("zp.tyex.projects")+'"></a></li>':row+='<li class="mw50"></li>',data.fromDate?row+='<li class="mw150" aria-label="'+ZPI18N.getString("zp.sdate")+":"+data.fromDate+'" tabindex="0" ><span>'+data.fromDate+"</span></li>":row+='<li class="mw150"></li>',data.toDate?row+='<li class="mw150" aria-label="'+ZPI18N.getString("zp.edate")+":"+data.toDate+'" tabindex="0"><span>'+data.toDate+"</span></li>":row+='<li class="mw150"></li>',void 0!==data.hours){var mins=data.hours%60,estimatedHrs=(data.hours-mins)/60+" "+ZPI18N.getString("zp.hrs")+" "+mins+" "+ZPI18N.getString("zp.mins");row+='<li class="mw150" aria-label="'+ZPI18N.getString("zp.estimatedhours")+":"+estimatedHrs+'" tabindex="0" ><span>'+estimatedHrs+"</span></li>"}else row+='<li class="mw150"><span>-</span></li>';data.totalhours=data.totalhours?data.totalhours:0;var totalmins=data.totalhours%60,totalhrsContent=(data.totalhours-totalmins)/60+ZPI18N.getString("zp.hrs")+" "+totalmins+" "+ZPI18N.getString("zp.mins");row+='<li class="mw150" aria-label=" '+ZPI18N.getString("zp.loggedhours")+":"+totalhrsContent+'" tabindex="0" ><div class="dblerw"><span>'+totalhrsContent+'</span><div id="progBar_'+data.jobId+'" style="width: 120px;""></div></div></li>',data.attachId||data.attachmentPath?row+='<li class="mw50" ref="skip"><span><i class="PI_attach zpl_cp" title="'+ZPI18N.getString("zp.downloadfile")+'" ref="attachment"></i></span></li>':row+='<li class="mw50"></li>';var statustitle=ZPI18N.getString("zp.inprogresschangestatus"),status=ZPI18N.getString("zp.inprogress"),color="";1===data.jobStatus&&(statustitle=ZPI18N.getString("zp.completedchangestatus"),status=ZPI18N.getString("zp.completed"),color="grn"),row+='<li class="mw150" ref="skip" aria-label="'+ZPI18N.getString("zp.status")+":"+status+'" tabindex="0"><span class="d-flexC" ref="skip"><i id="statusTgl_'+data.jobId+'" class="PI_tick2_fil zpl_cp '+color+'" title="'+statustitle+'" ref="changeStatus"></i><span ref="skip" class="CPD '+color+'">'+status+"</span></span></li>",sizeClass=data.isFromPD?"mw150":"mw100",data.assigneeCount>0?row+='<li class="'+sizeClass+'" ref="skip" aria-label="'+ZPI18N.getString("zp.users")+":"+data.assigneeCount+'" tabindex="0"><span class="zpl_icncont zpl_cp"><i class="PI_usr" title="'+ZPI18N.getString("zp.show")+" "+ZPI18N.getString("zp.users")+'" ref="showAssignees"><sup ref="showAssignees">'+data.assigneeCount+'</sup></i><a ref="addAssignees" class="DNI">'+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.user")])+"</a></span></li>":row+='<li class="'+sizeClass+'" ref="skip" aria-label="'+ZPI18N.getString("zp.mapassignees")+'" tabindex="0"><span><a ref="addAssignees">'+ZPI18N.getString("zp.mapassignees")+"</a></span></li>",row+='<li class="mw100" ref="skip"><i class="PI_cls zpl_cp DNI" title="'+ZPI18N.getString("zp.close")+'" ref="closeAssignees"></i>',isJobEditAllowed&&(row+='<div class="zpl_hvr" name="delete"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" ref="edit"></i><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" ref="delete"></i></div>'),row+="</li></ul>",(row=$(row)).data("schval",data);var temppercent=0;return temppercent=0!==data.totalhours&&data.totalhours?void 0!==data.hours&&0===data.hours?0:void 0!==data.hours&&data.totalhours>=data.hours?100:void 0===data.hours&&void 0!==data.totalhours?100:100*data.totalhours/data.hours:0,ZPeopleComponents.progressbar(row.find("#progBar_"+data.jobId),{value:temppercent}),row},showZProjects_jobs:function(portalId,zProjectsProjectRefId,zProjectsJobRefId){var portalName,tasklistId,skipPortal=!1;if(Timetracker.jobs.ZProjectsPortals&&Timetracker.jobs.ZProjectsPortals[portalId]&&(portalName=Timetracker.jobs.ZProjectsPortals[portalId],skipPortal=!0),Timetracker.jobs.ZProjectsTasks&&Timetracker.jobs.ZProjectsTasks[zProjectsJobRefId]&&(tasklistId=Timetracker.jobs.ZProjectsTasks[zProjectsJobRefId]),portalName&&tasklistId){var url=projects_url+"/portal/"+portalName+"#taskdetail/"+zProjectsProjectRefId+"/"+tasklistId+"/"+zProjectsJobRefId;window.open(url)}else{var params={mode:"getZohoProjectDetails",zProjectsPortalId:portalId,zProjectsProjectRefId:zProjectsProjectRefId,zProjectsJobRefId:zProjectsJobRefId,skipPortal:skipPortal};ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){if(resultData.res){var response=resultData.resObj;if(response)if(!skipPortal&&response.portalUrl&&(Timetracker.jobs.ZProjectsPortals[portalId]=response.portalUrl,portalName=Timetracker.jobs.ZProjectsPortals[portalId]),portalName&&response.tasklistId){Timetracker.jobs.ZProjectsTasks[zProjectsJobRefId]=response.tasklistId;var url=projects_url+"/portal/"+portalName+"#taskdetail/"+zProjectsProjectRefId+"/"+Timetracker.jobs.ZProjectsTasks[zProjectsJobRefId]+"/"+zProjectsJobRefId;window.open(url)}else Timetracker.util.showAlert(0,ZPI18N.getString("zp.prjctsync.jobnotfound"))}else{var errorMsg=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg)}})}},showHideAssignees:function(obj,jobFlag){var parentTag=$(obj).closest("ul"),jobData=$(parentTag).data().schval,result=$(parentTag).data().assignees,layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:settingsPage.container;if(void 0!==result&&null!==result)"showAssignees"===$(obj).attr("ref")?(layout.find("#mytable_assigneList_"+jobData.jobId).removeClass("DNI"),$(parentTag).find("[ref='showAssignees']").addClass("DNI"),$(parentTag).find("[ref='addAssignees']").removeClass("DNI"),$(parentTag).find("[ref='closeAssignees']").removeClass("DNI"),$(parentTag).find("[name='delete']").addClass("DNI")):(layout.find("#mytable_assigneList_"+jobData.jobId).addClass("DNI"),$(parentTag).find("[ref='showAssignees']").removeClass("DNI"),$(parentTag).find("[ref='addAssignees']").addClass("DNI"),$(parentTag).find("[ref='closeAssignees']").addClass("DNI"),$(parentTag).find("[name='delete']").removeClass("DNI"));else{if($(parentTag).data().isAssingneesLoaded)return void($(parentTag).data().permissionDenied&&Timetracker.util.showAlert(0,Timetracker.Util.getFailureMessageByCode(Timetracker.constants.ERROR_CODES.NO_PERM_CODE)));$(parentTag).data("isAssingneesLoaded",!0);let mode=Timetracker.Page.getPageMode()+"_jobAssignees_"+jobData.jobId;Timetracker.FireScroll.resetDataOnLoad(mode);let params={mode:"assigneesTotal",jobId:jobData.jobId,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,sIndex:0,conreqcsr:csrfToken};$.post("/timesheet.zp",params,function(result){if(result.res){Timetracker.jobs.Listing.listAssignees(obj,result.resArr,jobData,jobFlag);let otherDtls={scrollDiv:layout.find("#mytable_assigneList_"+jobData.jobId),obj:obj};Timetracker.FireScroll.initFireScroll(mode,"/timesheet.zp",params,Timetracker.jobs.Listing.loadMoreAssigneesList,"",otherDtls),Timetracker.FireScroll.setFetchCount(mode,result.resArr)}else $(parentTag).data("permissionDenied",!0),Timetracker.util.showAlert(0,Timetracker.Util.getFailureMessageByCode(result.errorCode))})}},listAssignees:function(obj,result,jobData,jobFlag){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:settingsPage.container,parentTag=$(obj).closest("ul");jobData=void 0===jobData?$(parentTag).data().schval:jobData;var iszprojAvailable=0!=layout.find(".zpl_projecticn").length,jobAssigneList=layout.find("#mytable_assigneList_"+jobData.jobId),row="";if($.each(result,function(index,data){row+='<ul><li class="mw60"></li><li class="w400"><div class="zpl_em"><div class="zpl_emimg">',row+='<img src="'+data.PhotoURL+'"></div><div class="zpl_emdts mw200"><div>'+data.name+"</div></div></div></li>",row+='<li class="mw50 '+(iszprojAvailable?"":"DNI")+'"></li>',row+='<li class="mw150"></li><li class="mw150"></li>';data.hours;var tempmins=data.hours%60,temphrs=(data.hours-tempmins)/60;if(row+='<li class="mw150"><span>'+temphrs+" "+ZPI18N.getString("zp.hrs")+" "+tempmins+" "+ZPI18N.getString("zp.mins")+"</span></li>","-"==data.totalhours)row+='<li class="mw150">-</li>';else{var totalhrs=data.totalhours?data.totalhours:0,mins=totalhrs%60,hrs=(totalhrs-mins)/60;totalhrs/=60,row+='<li class="mw150"><span>'+hrs+" "+ZPI18N.getString("zp.hrs")+" "+mins+" "+ZPI18N.getString("zp.mins")+"</span></li>"}row+='<li class="mw50"></li><li class="mw150"></li><li class="mw100"></li><li class="mw100"></li></ul>'}),0===jobAssigneList.length){$(parentTag).find("[ref='showAssignees']").addClass("DNI"),$(parentTag).find("[ref='addAssignees']").removeClass("DNI"),$(parentTag).find("[ref='closeAssignees']").removeClass("DNI"),$(parentTag).find("[name='delete']").addClass("DNI");let assigneListDiv=$('<div class="zpl_dtblsub" id="mytable_assigneList_'+jobData.jobId+'"></div>').append(row);$(parentTag).after(assigneListDiv),parentTag.data("assignees",result)}else jobAssigneList.append(row),$(parentTag).data().assignees.push(...result)},loadMoreAssigneesList:function(result,params,otherDtls){Timetracker.jobs.Listing.listAssignees(otherDtls.obj,result.resArr),Timetracker.FireScroll.setFetchCount(Timetracker.Page.getPageMode()+"_jobAssignees_"+params.jobId,result.resArr)}},UnAssignedJobs:{getDefaultJobParams:function(entity){var params={jobStatus:"0",projectId:"0",conreqcsr:csrfToken};return entity===Timetracker.constants.DIVISION?params.mode="getDivisionJobs":entity===Timetracker.constants.DEPARTMENT?params.mode="getDeptJobs":entity===Timetracker.constants.LOCATION&&(params.mode="getLocationJobs"),params},getParamsToFetchJob:function(entity){var params=Timetracker.jobs.UnAssignedJobs.getDefaultJobParams(entity);return params.sIndex=Timetracker.jobs.FireScroll.getJobFetchCount(),0!==Timetracker.jobs.pageLayout.find("#unassjob_filter_div").length&&TimetrackerOperations.Filters.getFilterValues(params,"unassjob_filter_div"),params},getSchedule:function(entity){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container,filterDiv=layout.find("#unassjob_filter_div");if(0!=filterDiv.find("#unassJobNameSearch").length&&""===layout.find("#unassJobNameSearch").val()&&"0"!==layout.find("#unassJobName").val())return layout.find("#unassJobNameSearch").addClass("ztextbox__error"),layout.find("#unassJobNameSearch").parent().find("span").remove(),void layout.find("#unassJobNameSearch").after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.searchvaluescannotbeempty")+"</span>");0!=layout.find("#unassJobNameSearch").length&&(layout.find("#unassJobNameSearch").removeClass("ztextbox__error"),layout.find("#unassJobNameSearch").siblings().remove()),0!=filterDiv.find("#unassJobNameSearch").length&&""!=filterDiv.find("#unassJobNameSearch").val()&&"0"==filterDiv.find("#unassJobName").val()&&(filterDiv.find("#unassJobNameSearch").val(""),filterDiv.find("#unassjob_filter_div").data("previousName","0"),filterDiv.find("#unassjob_filter_div").data("previousSearchName",null)),TimetrackerOperations.Filters.isFilterOpen("unassjob_filter_div")&&TimetrackerOperations.Filters.toggleFilter("unassjob_filter_div"),(entity=Timetracker.jobs.Listing.getViewType())==Timetracker.constants.DEPARTMENT?layout.find("#unassjoblist").hide():entity==Timetracker.constants.DIVISION?layout.find("#unassjoblist_division").hide():entity==Timetracker.constants.LOCATION&&layout.find("#unassjoblist_location").hide(),layout.find("#tt_filterResultsHeader.timetracker").addClass("zpl_DNI"),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(),Timetracker.jobs.FireScroll.resetDataOnLoad();var params=Timetracker.jobs.UnAssignedJobs.getParamsToFetchJob(entity);$.post(Timetracker.constants.URL,params,function(result){Timetracker.jobs.UnAssignedJobs.constructListOfJobs(result),Timetracker.util.removeLoading(layout),TimelyZComp.toolTip.intiliaze(),0==layout.find("#joblist").parent().find("#tt_filterResultsHeader.timetracker").length&&(html=TimetrackerOperations.Filters.filterHeaderHtml,layout.find("#joblist").before(html)),TimetrackerOperations.Filters.setFilterHeader(Timetracker.jobs.Listing.removeTopFilter,"unassjob_filter_div");var filterdiv=layout.find("#tt_filterResultsHeader.timetracker");if(0!=filterdiv.find('[filterno="jobName"]').length){var jobNameSearch=ZPeople.escapeHtml(layout.find("#unassJobNameSearch").val());filterdiv.find('[filterno="jobName"]').find("span").removeAttr("title"),filterdiv.find('[filterno="jobName"]').find("span").after('<span onclick="TimetrackerOperations.Filters.openFilterField(this, \'unassjob_filter_div\');" title="'+jobNameSearch+'" class="mxw100">'+jobNameSearch+"</span>")}})},constructListOfJobs:function(result){var entity=Timetracker.jobs.Listing.getViewType();Timetracker.jobs.UnAssignedJobs.constructJobViewTable(entity);var jobTableId="unassjoblist";entity===Timetracker.constants.DIVISION?jobTableId="unassjoblist_division":entity===Timetracker.constants.LOCATION&&(jobTableId="unassjoblist_location");var jobTableListId="unassjoblist-listtbody";entity===Timetracker.constants.DIVISION?jobTableListId="unassjoblist-division-listtbody":entity===Timetracker.constants.LOCATION&&(jobTableListId="unassjoblist-location-listtbody");var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;if(layout.find("#unassjoblist,#zp_empty_data").hide(),Timetracker.Util.showHideNoData({remove:!0}),entity===Timetracker.constants.DIVISION?layout.find("#unassjoblist_division").hide():entity===Timetracker.constants.LOCATION&&layout.find("#unassjoblist_location").hide(),null===result||0===result.length||""===result){result=null===result?[]:result;var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.jobDispName]);Timetracker.util.checkAddJobPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.jobDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getJobDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:"zp_views_list_container",layout:layout})}else layout.find("#"+jobTableListId).find("tr").remove(),Timetracker.jobs.UnAssignedJobs.constructJobsHtml(result,entity),layout.find("#"+jobTableId).fadeIn(200).scrollTop(0);Timetracker.jobs.FireScroll.setJobFetchCount(result),Timetracker.jobs.FireScroll.resetJobFireScroll(result)},constructJobViewTable:function(entity){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;layout.find("#zp_views_container,.ZPNdata").remove();var jobTableId="unassjoblist",jobTableListId="unassjoblist-listtbody",headerName=ZPI18N.getString("zp.departments");if(entity===Timetracker.constants.DIVISION?(jobTableId="unassjoblist_division",jobTableListId="unassjoblist-division-listtbody",headerName=ZPI18N.getString("zp.divisionname"),ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(headerName=ZPeople.orgStructureDispNameMap.division)):entity===Timetracker.constants.LOCATION&&(jobTableId="unassjoblist_location",jobTableListId="unassjoblist-location-listtbody",headerName=ZPI18N.getString("zp.location")),0===layout.find("#"+jobTableId).length){var jobTable;jobTable='<div id="'+jobTableId+'"><table class="zpl_tbl zpl_nocrsor" role="grid"><thead><tr><th scope="col" style="width: 40%;"><b class="form_jobname">Timetracker.jobs.formDetails.labelDetails.JOBNAME</b></th><th scope="col"><b>'+headerName+"</b></th>"+(Timetracker.isDataAdminForAllUsers()?'<th width="150"></th>':"")+'</tr></thead><tbody id="'+jobTableListId+'"></tbody></table></div>';var listDiv=layout.find("#zp_views_list_container");$(listDiv).children("[id!=joblist]").remove();var jobListDiv=$(listDiv).find("#joblist");0!==jobListDiv.length?($(jobListDiv).css("display","none"),$(listDiv).append(jobTable)):$(listDiv).html(jobTable),Timetracker.util.init()}ZPeople.FireScroll.init(Timetracker.jobs.FireScroll.loadMoreJobs,"",{mode:Timetracker.jobs.FireScroll.getMode()},!0)},constructJobsHtml:function(result,entity){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:settingsPage.container,jobTableListId="#unassjoblist-listtbody";entity===Timetracker.constants.DIVISION?jobTableListId="#unassjoblist-division-listtbody":entity===Timetracker.constants.LOCATION&&(jobTableListId="#unassjoblist-location-listtbody");var tbodyLayout=layout.find(jobTableListId);$.each(result,function(index,data){var clkEve=Timetracker.isDataAdminForAllUsers()?"Timetracker.forms.showForm(Timetracker.constants.VIEW, '"+data.jobId+"');":"",cpCls=Timetracker.isDataAdminForAllUsers()?"zpl_cp":"",row='<tr id="unassmytable'+data.jobId+'"><td scope="row" tabindex="0" class="flex-grow '+cpCls+'" onclick="'+clkEve+'"><div class="zpl_cstnmes"><span>'+data.jobName+"</span>";data.projectName&&(row+='<span class="zpl_dots"></span><em>'+data.projectName+"</em>"),row+='</div></td><td><div class="zpl_tglist">';var dataArr="";if(entity===Timetracker.constants.DEPARTMENT&&data.deptNames&&(dataArr=data.deptNames.split(", ")),entity===Timetracker.constants.DIVISION&&isOrgStructureEnabled&&data.divisionNames&&(dataArr=data.divisionNames.split(", ")),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&entity===Timetracker.constants.LOCATION&&data.locNames&&(dataArr=data.locNames.split(", ")),dataArr.length>0){var i=0;data.optArr=dataArr,$.each(dataArr,function(ind,name){if(!(i<3))return row+='<div class="zpl_tg zpl_cp"><span id="moreOptions_'+data.jobId+'_Btn" ref="optionsList">+'+(Object.keys(dataArr).length-3)+"</span></div>",!1;row+='<div class="zpl_tg"><span ref="skip" title="'+name+'">'+name+"</span></div>",i++})}row+="</div></td>",Timetracker.isDataAdminForAllUsers()&&(row+='<td ref="skip"><div class="zpl_hvr" name="delete"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" ref="edit"></i><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'"  ref="delete"></i></div></td>'),row+="</tr>",(row=$(row)).data("schval",data),tbodyLayout.append(row)})},constructFilter:function(){0==(null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:settingsPage.container).find("#unassjob_filter_div").length&&(filterOpt={jobName:{single:!0,label:Timetracker.jobs.formDetails.labelDetails.JOBNAME,id:"unassJobName",paramId:"searchJobKey",defValue:0},jobNameInput:{type:"input",id:"unassJobNameSearch",className:"ztextbox zpl_DNI",paramId:"searchJobName",showHeader:!1},client:{single:!1,label:Timetracker.util.clientDispName,paramId:"clientId",tokenField:!0},project:{single:!1,label:Timetracker.util.projectDispName,paramId:"projectId",tokenField:!0},status:{single:!0,label:ZPI18N.getString("zp.status"),paramId:"jobStatus",defValue:0}},TimetrackerOperations.Filters.constructFilterDiv(filterOpt,{id:"unassjob_filter_div"})),TimetrackerOperations.Filters.toggleFilter("unassjob_filter_div")}},FireScroll:{getMode:function(){var viewType=Timetracker.jobs.Listing.getViewType();return Timetracker.Page.getPageMode()+"_jobs_"+viewType},resetDataOnLoad:function(){var mode=Timetracker.jobs.FireScroll.getMode();Timetracker.jobs.FireScroll.resetJobFetchCount(),ZPeople.FireScroll.reset(mode),Timetracker.jobs.assignedbyoptions={0:ZPI18N.getString("zp.allusers")}},setJobFetchCount:function(result){var mode=Timetracker.jobs.FireScroll.getMode();Timetracker.jobs.FETCHED_JOB_COUNT[mode]=ZPUtil.Validation.isNumber(Timetracker.jobs.FETCHED_JOB_COUNT[mode])?Timetracker.jobs.FETCHED_JOB_COUNT[mode]:0,Timetracker.jobs.FETCHED_JOB_COUNT[mode]+=result.length},resetJobFetchCount:function(){var mode=Timetracker.jobs.FireScroll.getMode();Timetracker.jobs.FETCHED_JOB_COUNT[mode]=0},getJobFetchCount:function(){var mode=Timetracker.jobs.FireScroll.getMode();return Timetracker.jobs.FETCHED_JOB_COUNT[mode]=ZPUtil.Validation.isNumber(Timetracker.jobs.FETCHED_JOB_COUNT[mode])?Timetracker.jobs.FETCHED_JOB_COUNT[mode]:0,0===Timetracker.jobs.FETCHED_JOB_COUNT[mode]?Timetracker.jobs.FETCHED_JOB_COUNT[mode]:Timetracker.jobs.FETCHED_JOB_COUNT[mode]+1},adjustJobFetchCount:function(count){var mode=Timetracker.jobs.FireScroll.getMode();Timetracker.jobs.FETCHED_JOB_COUNT[mode]=Timetracker.jobs.FETCHED_JOB_COUNT[mode]-count},loadMoreJobs:function(limit){var params,url=Timetracker.constants.URL,viewType=Timetracker.jobs.Listing.getViewType();params=viewType===Timetracker.constants.DEPARTMENT||viewType===Timetracker.constants.DIVISION||viewType===Timetracker.constants.LOCATION?Timetracker.jobs.UnAssignedJobs.getParamsToFetchJob(viewType):Timetracker.jobs.Listing.getParamsToFetchJob(),limit&&limit<=Timetracker.jobs.MAXJOB_FETCH_COUNT&&(params.limit=limit),ZPeople.Request.send(url,params,Timetracker.jobs.FireScroll.constructJobsOnFireScrollTrigger)},constructJobsOnFireScrollTrigger:function(result,params){var viewType=Timetracker.jobs.Listing.getViewType();if(null!=result)viewType===Timetracker.constants.DEPARTMENT||viewType===Timetracker.constants.DIVISION||viewType===Timetracker.constants.LOCATION?0!==result.length&&Timetracker.jobs.UnAssignedJobs.constructJobsHtml(result,viewType):(result=result.schArr&&0!==result.schArr.length?result.schArr:[],Timetracker.jobs.Listing.constructJobsHtml(result,"0"===params.assignedBy,!0,"job-listtbody")),Timetracker.jobs.FireScroll.setJobFetchCount(result),Timetracker.jobs.FireScroll.resetJobFireScroll(result,params.limit);else{var jobtBodyid,operJobBody;viewType===Timetracker.constants.DEPARTMENT?(jobtBodyid="unassjoblist",operJobBody="unassjoblist-listtbody"):viewType===Timetracker.constants.DIVISION?(jobtBodyid="unassjoblist_division",operJobBody="unassjoblist-division-listtbody"):viewType===Timetracker.constants.LOCATION?(jobtBodyid="unassjoblist_location",operJobBody="unassjoblist-ocation-listtbody"):(jobtBodyid="joblist",operJobBody="job-listtbody");var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;if(0===layout.find("#"+operJobBody).length){layout.find("#"+jobtBodyid).hide(),layout.find("#zp_empty_data").show();var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.jobDispName]);Timetracker.util.checkAddJobPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.jobDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getJobDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:"zp_views_list_container"})}}},resetJobFireScroll:function(result,limit){var mode=Timetracker.jobs.FireScroll.getMode();result.length===Timetracker.jobs.MAXJOB_FETCH_COUNT||result.length===limit?ZPeople.FireScroll.reset(mode):result.length<Timetracker.jobs.MAXJOB_FETCH_COUNT&&ZPeople.FireScroll.setParam("triggered",!0,mode)}},Operations:{changeisCompleted:function(jobId,isCompleted,obj,isFromProjectsPage){var editData;isCompleted=1==isCompleted?0:1,editData=Timetracker.UserSpace.isMySpace()||"ts_homeuser"==Timetracker.Page.getPageMode()?Layout.Page.container.find("#job-"+jobId).data().schval:$(obj).closest("ul").data().schval;var isEditAllowed=Timetracker.jobs.Util.isEditDeleteAllowed(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit),editData.owner,editData.projectHead,editData.projectManagers);if(isEditAllowed||(isEditAllowed=void 0===editData.permissionToChangeStatus||void 0!==editData.permissionToChangeStatus&&"0"!==editData.permissionToChangeStatus),!isEditAllowed)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.permdeniedtoedit")),!1;var params={mode:"changeisCompleted",jobId:jobId,isCompleted:isCompleted,conreqcsr:csrfToken},arg={};arg.jobId=jobId,arg.isFromProjectsPage=isFromProjectsPage||!1,arg.params=params,arg.obj=obj,arg.isCompleted=isCompleted,arg.layout=Layout.Page.container,editData&&(arg.editData=editData),editData.projectId&&0===isCompleted?(null==Timetracker.projects.currProjectData&&Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE),Timetracker.projects.Filters.setProjectDataForUser("0").then(function(){var index=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.projects.currProjectData,editData.projectId,"projectId");if(-1!==index&&Timetracker.projects.currProjectData[index]&&1==Timetracker.projects.currProjectData[index].projectStatus){arg.constructProjectFilter=!0;var extraDtls={body:ZPI18N.getString("zp.reopenprojectconfirmation"),hiddenCallback:function(){$(obj).data().isprocessing=!1}};Timetracker.Util.confirmpopUp(jobId,Timetracker.jobs.Operations.changeisCompletedCallback,arg,1,extraDtls)}else Timetracker.jobs.Operations.changeisCompletedCallback(arg)})):Timetracker.jobs.Operations.changeisCompletedCallback(arg)},changeisCompletedCallback:function(arg){$.post("/timesheet.zp",arg.params,function(resultData){var layout=arg.layout?arg.layout:Layout.Page.container;if(""===resultData||"noPermissionToProject"===resultData||"timerRunning"===resultData){if(""===resultData)(-1!==Layout.Page.hash.indexOf("timetracker/scheduler/projects")||-1!==Layout.Page.hash.indexOf("operations/timetracker")?layout.find("#mytable"+arg.jobId):Timetracker.UserSpace.isMySpace()||"ts_homeuser"==Timetracker.Page.getPageMode()?Layout.Page.container.find("#job-"+arg.jobId):layout.find("#mytable"+arg.jobId)).data().schval.permissionToChangeStatus="0",Timetracker.util.showAlert(1,ZPI18N.getString("zp.permdeniedtoedit"));else"noPermissionToProject"===resultData?Timetracker.util.showAlert(1,ZPI18N.getString("zp.reopenprojectpermissionerror")):"timerRunning"===resultData&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerrunning",[Timetracker.util.jobDispName]))}else{if(Timetracker.util.showAlert(2,ZPI18N.getString("zp.statuschanged")),Timetracker.forms.refreshLookupOptions("jobs"),Timetracker.UserSpace.isMySpace()||"ts_homeuser"==Timetracker.Page.getPageMode())$("#job-"+arg.jobId).data().schval.jobStatus=arg.params.isCompleted?1:0,arg.params.isCompleted?($(arg.obj).addClass("grn").attr("title",ZPI18N.getString("zp.completedchangestatus")),$(arg.obj).siblings("span:first").html(ZPI18N.getString("zp.completed"))):($(arg.obj).removeClass("grn").attr("title",ZPI18N.getString("zp.inprogresschangestatus")),$(arg.obj).siblings("span:first").html(ZPI18N.getString("zp.inprogress"))),temp="Timetracker.jobs.Operations.changeisCompleted('"+arg.jobId+"','"+(arg.params.isCompleted?1:0)+"',this,"+arg.isFromProjectsPage+");",$(arg.obj).attr("onclick",temp);else{$(arg.obj).closest("ul").data().schval.jobStatus=arg.params.isCompleted?1:0;var statusObj=$(arg.obj).closest("li");arg.params.isCompleted?(statusObj.find("i").addClass("grn").attr("title",ZPI18N.getString("zp.completedchangestatus")),statusObj.find("i").siblings("span:first").addClass("grn").html(ZPI18N.getString("zp.completed"))):(statusObj.find("i").removeClass("grn").attr("title",ZPI18N.getString("zp.inprogresschangestatus")),statusObj.find("i").siblings("span:first").removeClass("grn").html(ZPI18N.getString("zp.inprogress")))}if(arg.isFromProjectsPage){var index=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.projects.currProjectData,arg.editData.projectId,"projectId");if(-1!==index&&Timetracker.projects.currProjectData[index]&&(1===Timetracker.projects.currProjectData[index].projectStatus||"1"===Timetracker.projects.currProjectData[index].projectStatus)&&!arg.params.isCompleted){layout=settingsPage.container;proObj=layout.find("#statusTgl_"+arg.editData.projectId),$(proObj).closest("ul").data().projdata.projectStatus=0,proObj.removeClass("grn").attr("title",ZPI18N.getString("zp.inprogresschangestatus")),$(proObj).siblings("span:first").removeClass("grn").html(ZPI18N.getString("zp.inprogress")),Timetracker.jobs.Util.updateCache(arg.editData.projectId,0,"projectStatus","project"),-1!=index&&(Timetracker.projects.currProjectData[index].projectStatus=0)}}else arg.constructProjectFilter&&Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE),$("#projectTable"+arg.editData.projectId).siblings().length&&Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE);Timetracker.cache.clearCache(Timetracker.constants.JOB_TABLE),Timetracker.jobs.Util.updateCache(arg.params.jobId,arg.params.isCompleted,"iscompleted","job")}$(arg.obj).data().isprocessing=!1})},checkAll:function(obj){if($(obj).is(":checked")){var prevCoutn=Layout.Page.container.find("#job-listtbody").siblings("table").find("input[type='checkbox']:checked").length;Layout.Page.container.find("#job-listtbody").siblings("table").find("input[type='checkbox']:not(:checked)").each(function(index){if(prevCoutn>199)return!1;$(this).attr("disabled")||(prevCoutn+=1,$(this).prop("checked",!0))})}else{Layout.Page.container.find("#job-listtbody").siblings("table").find("input[type='checkbox']:checked").each(function(){$(this).prop("checked",!1)})}Timetracker.views.multiSelectActions.showHideMultiSelectOper($(obj).is(":checked"))},checkParticularJob:function(obj){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container;if($(obj).is(":checked")){if((jobsSelected=layout.find("[id^='mytable']").find("input[type='checkbox']:checked")).length>200)return $(obj).prop("checked",!1),void Timetracker.util.showAlert(1,ZPI18N.getString("zp.cantselectmorethan200",[Timetracker.jobs.formDetails.formDispName]));jobsSelected.length!==layout.find("[id^='mytable']").length&&200!=jobsSelected.length||layout.find("[bid=job_checkallbox]").prop("checked",!0),Timetracker.views.multiSelectActions.showHideMultiSelectOper(!0,layout)}else{var jobsSelected;layout.find("[bid=job_checkallbox]").prop("checked",!1),(jobsSelected=layout.find("[id^='mytable']").find("input[type='checkbox']:checked")).length<1&&Timetracker.views.multiSelectActions.showHideMultiSelectOper(!1,layout)}},showDelete:function(mode,jobId){"multiple"===mode?Timetracker.jobs.Operations.multiSelectDelete():Timetracker.jobs.Operations.deleteJob(jobId,"single",Timetracker.jobs.Operations.jobDeleteCallback)},showOpDelete:function(jobId){Timetracker.jobs.Operations.deleteJob(jobId,"single",Timetracker.jobs.Operations.jobDeleteCallback)},multiSelectDelete:function(){var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container,jobs=layout.find("#job-listtbody").find("[id^='mytable']").find("input[type='checkbox']:checked");if(jobs.length<=0)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.nojobsprojectstodelete",[Timetracker.util.jobDispName])),layout.find("[bid=job_checkallbox]").prop("checked",!1),Timetracker.views.multiSelectActions.showHideMultiSelectOper(!1,layout),!1;for(var tempids="",i=0;i<jobs.length;i++){var projectHead,owner=$(jobs[i]).attr("owner"),jobId=$(jobs[i]).attr("recordid"),projectManagerArray=[],jobRow=layout.find("#mytable"+jobId);if(jobRow.length>0){var jobData=jobRow.data("schval");projectHead=jobData&&jobData.projectHead?jobData.projectHead:projectHead,projectManagerArray=jobData&&jobData.projectManagers?jobData.projectManagers:projectManagerArray}$(jobs[i]).attr("manager");Timetracker.jobs.Util.isEditDeleteAllowed(Timetracker.isDataAdminForAllUsers(),owner,projectHead,projectManagerArray)&&(tempids+=jobId,i!==jobs.length-1&&(tempids+=","))}tempids?Timetracker.jobs.Operations.deleteJob(tempids,"multiple",Timetracker.jobs.Operations.jobDeleteCallback):Timetracker.util.showAlert(1,ZPI18N.getString("zp.notallowedtodeletethisproject",[Timetracker.util.jobDispName]))},deleteJob:function(jobId,mode,callback,isCustomView,curViewObj){var params={mode:"deleteSchedule",jobId:jobId,conreqcsr:csrfToken},jobIds=jobId.split(","),jobstr=jobIds.length>1?Timetracker.util.getJobDisplayName():Timetracker.util.getJobDisplayName(!0);$.post("/timesheet.zp",params,function(resultData){if(resultData&&resultData.res){let resObj=resultData.resObj,result=resObj.deletedJobs;if(result){if(result.length===jobIds.length)Timetracker.util.showAlert(2,ZPI18N.getString("zp.deleted.successfully.msg",[jobstr]));else{var msg=ZPI18N.getString("zp.timerrunning",[Timetracker.util.jobDispName]);"multiple"===mode&&(msg=ZPI18N.getString("zp.skiptimerrunningjob",[Timetracker.util.jobDispName,Timetracker.util.jobDispName])),Timetracker.util.showAlert(1,msg)}if(isCustomView&&void 0!=curViewObj)return void curViewObj.reloadView(!0,!0);var layout=null!=Timetracker.jobs.pageLayout?Timetracker.jobs.pageLayout:Layout.Page.container,viewType=Timetracker.jobs.Listing.getViewType(),id="joblist",listId="job-listtbody";viewType===Timetracker.constants.DIVISION?(id="joblist_division",listId="unassjoblist_division"):viewType===Timetracker.constants.LOCATION?(id="joblist_location",listId="unassjoblist_location"):viewType===Timetracker.constants.DEPARTMENT&&(listId="unassjoblist");var tableId="mytable";for(var i in viewType!==Timetracker.constants.DEPARTMENT&&viewType!==Timetracker.constants.DIVISION&&viewType!==Timetracker.constants.LOCATION||(id="unass"+id,tableId="unass"+tableId),result)if(Timetracker.views.isSystemView()){var jobTable=layout.find("#"+id).find("#"+tableId+result[i]),jobDetails=jobTable.data("schval");if(0!=(projectTable=$("#projectlist").find("#projectTable"+jobDetails.projectId)).length){if(projDetails=projectTable.data("projdata"))"0"===projDetails.jobCount&&0===projDetails.jobCount||(projectTable.data("projdata").jobCount=projDetails.jobCount-1),void 0!==(countIconText=projectTable.find("#count_jobIcon_"+jobDetails.projectId).find("i sup").text())&&"1"!==countIconText&&1!==countIconText&&""!==countIconText?projectTable.find("#count_jobIcon_"+jobDetails.projectId).find("i sup").text(countIconText-1):(projectTable.find("#project_Jobs").html(""),projectTable.find("#project_Jobs").html('<div class="PR" onclick="Timetracker.projects.Validations.completedProjectCheck(\''+projDetails.projectId+"','"+projDetails.projectStatus+'\');"><i class="IC-jobs gry S20 ML10 sup-top empty-ics"><sup><i class="IC-add"></i></sup></i></div>'));projectTable.find("#mytable"+result[i]).remove()}jobTable.remove()}else if(null!==Timetracker.jobs.jobData&&0!==Object.keys(Timetracker.jobs.jobData).length&&result[i]in Timetracker.jobs.jobData){var projectTable;jobDetails=Timetracker.jobs.jobData[result[i]];if(projectTable=$("#projectlist").find("#projectTable"+jobDetails.projectId)){var projDetails,countIconText;if(projDetails=projectTable.data("projdata"))"0"===projDetails.jobCount&&0===projDetails.jobCount||(projectTable.data("projdata").jobCount=projDetails.jobCount-1),void 0!==(countIconText=projectTable.find("#count_jobIcon_"+jobDetails.projectId).find("i sup").text())&&"1"!==countIconText&&1!==countIconText&&""!==countIconText?projectTable.find("#count_jobIcon_"+jobDetails.projectId).find("i sup").text(countIconText-1):(projectTable.find("#project_Jobs").html(""),projectTable.find("#project_Jobs").html('<div class="PR" onclick="Timetracker.projects.Validations.completedProjectCheck(\''+projDetails.projectId+"','"+projDetails.projectStatus+'\');"><i class="IC-jobs gry S20 ML10 sup-top empty-ics"><sup><i class="IC-add"></i></sup></i></div>'));projectTable.find("#mytable"+result[i]).remove()}}else Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE);if(Timetracker.Page.isProjectDashboard())Timetracker.projectDashboard.DashboardJobs.getJobsList();else{if(Timetracker.jobs.FireScroll.adjustJobFetchCount(result.length),ZPeople.FireScroll.getFireScrollPropertie(Timetracker.jobs.FireScroll.getMode()).triggered){if(0===layout.find("#"+listId).children().length){layout.find("#"+listId).hide(),layout.find("#zp_empty_data").show();var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.jobDispName]);Timetracker.util.checkAddJobPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.jobDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getJobDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:"zp_views_list_container"})}}else Timetracker.jobs.FireScroll.loadMoreJobs(result.length);0===layout.find("#"+id).find("tbody").find('input[type="checkbox"]:enabled').length?layout.find("#"+id).find("thead").find('input[type="checkbox"]').attr("disabled",!0):layout.find("#"+id).find("thead").find('input[type="checkbox"]').attr("disabled",!1),void 0!==callback&&"function"==typeof callback&&(!0===isCustomView?callback(!0,Layout.Page.urlparam.viewId):callback()),layout.find("#zp_view_close_selection").trigger("click")}}else{let msg=ZPI18N.getString("zp.ttfailuremsg");1===jobIds.length&&(msg=resObj.currentlyRunningTimerJobs?ZPI18N.getString("zp.timerrunning",[Timetracker.util.jobDispName]):resObj.permissionDeniedJobs?ZPI18N.getString("zp.notallowedtodeletethisproject",[Timetracker.util.jobDispName]):msg),Timetracker.util.showAlert(0,msg)}}})},jobDeleteCallback:function(){Timetracker.forms.refreshLookupOptions("jobs")},showMultiUserMapperPopup:function(type,mode,jobId,entity,isCustom){var layout=settingsPage.container;if("multiple"!==mode||isCustom){if("multiple"===mode&&isCustom){if((chosenItems=layout.find("#viewsContainer tbody").find("input[type='checkbox']:checked")).length<1){message=ZPI18N.getString("zp.nojobsselected",[Timetracker.util.jobDispName]);return"project"===type&&(message=ZPI18N.getString("zp.noprojectsselected",[Timetracker.util.projectDispName])),Timetracker.util.showAlert(1,message),!1}}}else{var chosenItems=layout.find("#"+type+"list").find("input[type='checkbox']:checked"),lenCheck=1;if(0!==layout.find("[bid='"+type+"_checkallbox']:checked").length&&(lenCheck=2),chosenItems.length<lenCheck){var message=ZPI18N.getString("zp.nojobsselected",[Timetracker.util.jobDispName]);return"project"===type&&(message=ZPI18N.getString("zp.noprojectsselected",[Timetracker.util.projectDispName])),Timetracker.util.showAlert(1,message,!0),!1}}0!==(modal=Timetracker.Util.getMainContainer().find("#zp_modal_assignusersjobs")).length&&modal.remove();var label=ZPI18N.getString("zp.users"),fieldName="job"===type?ZPI18N.getString("zp.assignees"):ZPI18N.getString("zp.users");entity===Timetracker.constants.DEPARTMENT?label=fieldName=ZPI18N.getString("zp.departments"):entity===Timetracker.constants.DIVISION?(label=fieldName=ZPI18N.getString("zp.divisionname"),ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(label=fieldName=ZPeople.orgStructureDispNameMap.division)):entity===Timetracker.constants.LOCATION&&(label=ZPI18N.getString("zp.locations"));var modal,header=ZPI18N.getString("zp.assign",[label]),body='<form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label for="multiUserMappingSelect" tabindex="0">';body+=fieldName,body+='</label></div><div><textarea type="hidden" id="multiUserMappingSelect"></textarea></div></div></div></div></form>',(modal=ModuleComp.Modal.setup({id:"zp_modal_assignusersjobs",type:3,header:header,body:body,backdrop:!0,deleteOnHide:!1,closeOnSubmit:!1,buttonValue:ZPI18N.getString("zp.map",[label]),hiddenCallback:Timetracker.jobs.Operations.destroyZComp,successCallback:Timetracker.jobs.Operations.mapMultipleUsersToJobsOrProjects,closeonEsc:!0,extraDetails:{type:type,mode:mode,jobId:jobId,entity:entity,msg:label,isCustom:isCustom,isFromOp:!0}})).find(".zpl_minr").attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.mapassignees")])+ZPI18N.getString("zp.common.cancelpopup"),tabindex:"0"}),modal.find("#zp_modal_blubtn").attr({"aria-label":ZPI18N.getString("zp.map",[label]),tabindex:"0"}),modal.find("#zp_modal_whitebtn").attr({"aria-label":ZPI18N.getString("zp.cancel")+" "+ZPI18N.getString("zp.common.cancelpopup"),tabindex:"0"});var extraParam={tableName:"job"===type?Timetracker.constants.JOB_TABLE:"project"===type?Timetracker.constants.PROJECT_TABLE:""};if("job"===type)if(Timetracker.Page.isProjectDashboard("jobs"))extraParam.projectId=Layout.Page.urlparam.id;else if("single"==mode){var data=layout.find("#mytable"+jobId).data("schval");data&&data.projectId&&(extraParam.projectId=data.projectId)}if(entity===Timetracker.constants.DEPARTMENT||entity===Timetracker.constants.DIVISION||entity===Timetracker.constants.LOCATION){var searchParams={submode:"TIMETRACKER_FORMS",isMultiple:!0,noMatchMessage:ZPI18N.getString("zp.search"),maximumSelectionSize:25};entity===Timetracker.constants.DIVISION?searchParams.isDivision=!0:entity===Timetracker.constants.LOCATION&&(searchParams.isLocation=!0),Timetracker.Search.populateData("multiUserMappingSelect",searchParams,extraParam)}else{(searchParams={submode:"TIMETRACKER_FORMS"}).searchConf={isMultiple:!0,noMatchMessage:ZPI18N.getString("zp.search"),maximumSelectionSize:100},searchParams.placeHolder=ZPI18N.getString("zp.selectemployees"),"job"===type&&(extraParam.projectManagerPerm=!0),searchParams.inpFormat="token",searchParams.maxAllowedValues=100,searchParams.pModal="body",searchParams.extraParams=extraParam,Timetracker.Search.populateZCompUsers("multiUserMappingSelect",null,searchParams,!0,modal,Timetracker.constants.TTCustomAdmin.EntryEdit),ZPeopleComponents.tokenfield(modal.find("#multiUserMappingSelect")).setAttribute("className","zpl_maxhgt300")}},mapMultipleUsersToJobsOrProjects:function(modal){var layout=Timetracker.Util.getLayout(),type=modal.data("extraDetails").type,mode=modal.data("extraDetails").mode,entity=modal.data("extraDetails").entity,i18nmsg=modal.data("extraDetails").msg,isCustom=modal.data("extraDetails").isCustom,usersList=Timetracker.Util.gettokenFiledValues(modal.find("#multiUserMappingSelect")).join(",");if(Timetracker.util.removeErrorMsg("zp_modal_assignusersjobs",modal),0!==usersList.length){var params={mode:"mapUsersToJobsOrProjects",type:type,assigneesToBeMapped:usersList,conreqcsr:csrfToken};if(entity!==Timetracker.constants.DEPARTMENT&&entity!==Timetracker.constants.DIVISION&&entity!==Timetracker.constants.LOCATION||(params.mode="mapToJobProject",params.entity=entity),params.recordsToBeMapped="","multiple"===mode)if(isCustom)for(var chosenItems=layout.find("#viewsContainer tbody").find("input[type='checkbox']:checked"),looper=0;looper<chosenItems.length;looper++){var appendComma=!1;params.recordsToBeMapped+=$(chosenItems[looper]).closest("tr").attr("id"),(appendComma=!0)&&""!==params.recordsToBeMapped&&(params.recordsToBeMapped+=",")}else{chosenItems=layout.find("#"+type+"list").find("input[type='checkbox']:checked");"job_checkallbox"!=$(chosenItems[0]).attr("bid")&&"project_checkallbox"!=$(chosenItems[0]).attr("bid")||(chosenItems=chosenItems.slice(1,chosenItems.length));for(looper=0;looper<chosenItems.length;looper++){appendComma=!1;if("project"===type){var projectHead,projectManagerArray=[],projectId=$(chosenItems[looper]).attr("recordId"),projectRow=layout.find("#projectTable"+projectId);if(projectRow.length>0){var projectData=projectRow.data("projdata");projectHead=projectData&&projectData.projectHead?projectData.projectHead:projectHead,projectManagerArray=projectData&&projectData.projectManagers?projectData.projectManagers:projectManagerArray}Timetracker.projects.Util.isEditDeleteAllowed(projectId,Timetracker.isDataAdminForAllUsers(),$(chosenItems[looper]).attr("owner"),projectHead,projectManagerArray,"edit")&&(params.recordsToBeMapped+=projectId,appendComma=!0)}else params.recordsToBeMapped+=$(chosenItems[looper]).attr("recordId"),appendComma=!0;appendComma&&""!==params.recordsToBeMapped&&(params.recordsToBeMapped+=",")}}else if("single"===mode){var jobId=modal.data("extraDetails").jobId;params.recordsToBeMapped+=jobId}if(""===params.recordsToBeMapped.trim())return Timetracker.util.showAlert(1,ZPI18N.getString("zp.cannotadduserstoselectedproject",[Timetracker.util.projectDispName])),ModuleComp.Modal.hide("zp_modal_assignusersjobs"),!1;modal.find("#zp_modal_blubtn").addClass("disabled");var url="/timesheet.zp";entity!==Timetracker.constants.DEPARTMENT&&entity!==Timetracker.constants.DIVISION&&entity!==Timetracker.constants.LOCATION||(url=Timetracker.constants.URL),$.post(url,params,function(resultData){if(null!=resultData&&resultData.res){if("project"===type)Timetracker.util.showAlert(2,ZPI18N.getString("zp.usermappedsuccess",[i18nmsg])),Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE),isCustom?ZP5Views.refreshview(!0):Timetracker.projects.Listing.getProjectList(),Timetracker.forms.refreshLookupOptions("projects");else{var mesg=ZPI18N.getString("zp.skipentities",[ZPI18N.getString("zp.users"),ZPI18N.getString("zp.users"),Timetracker.util.getProjectDisplayName(!1,!0)]);entity!==Timetracker.constants.DEPARTMENT&&entity!==Timetracker.constants.DIVISION&&entity!==Timetracker.constants.LOCATION||(mesg=ZPI18N.getString("zp.skipentities",[i18nmsg,i18nmsg,Timetracker.util.getProjectDisplayName(!1,!0)])),Timetracker.util.showAlert(2,mesg),Timetracker.cache.clearCache(Timetracker.constants.JOB_TABLE),Timetracker.forms.refreshLookupOptions("jobs"),Timetracker.Page.isProjectDashboard("jobs")?Timetracker.projectDashboard.DashboardJobs.initDashboardJobs():isCustom?ZP5Views.refreshview(!0):Timetracker.jobs.Listing.getSchedule()}Timetracker.jobs.Operations.destroyZComp(),ModuleComp.Modal.hide("zp_modal_assignusersjobs")}else Timetracker.util.showAlert(2,ZPI18N.getString("zp.permissiondeniedtomap",[i18nmsg]))})}else{var entityKey=entity===Timetracker.constants.DEPARTMENT?ZPI18N.getString("zp.department"):entity===Timetracker.constants.DIVISION?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.user");Timetracker.util.appendErrorMsg({obj:modal.find("#multiUserMappingSelect").parent(),action:"append",msg:ZPI18N.getString("zp.maperror",[entityKey])})}},formAddEditView:function(formId,jobId,isViewJob){var addEditJson=null;if(Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),Timetracker.jobs.fetchJob=!0,addEditJson={formId:Timetracker.jobs.formDetails.formId,tableName:"P_TimesheetJob",callback:Timetracker.jobs.Operations.formAddEditViewCallback,isEmbed:!0},jobId&&(!0===isViewJob?(addEditJson.recordId=jobId,addEditJson.formMode="VIEW",addEditJson.editCallback=Timetracker.jobs.Operations.formAddEditView,addEditJson.disableSingleEdit=!0):(addEditJson.recordId=jobId,addEditJson.formMode="EDIT"),(Timetracker.Page.isProjectDashboard("jobs")||Timetracker.UserSpace.isMySpace()||"ts_homeuser"==Timetracker.Page.getPageMode())&&(addEditJson.noUrlChangeNeeded=!0)),null!==addEditJson){let form=ZP5Form._toForm(addEditJson);0!=$("#page-wrapper #zpntfn_modal").length&&(container=$("body #modal_Container"),form.setFormContainer(container)),form.init()}},formAddEditViewCallback:function(jobPkId){var projectId;jobPkId&&(Timetracker.Page.isProjectDashboard("jobs")?(projectId=Layout.Page.urlparam.id,Timetracker.projectDashboard.DashboardJobs.initDashboardJobs()):Timetracker.UserSpace.isMySpace()?Timetracker.UserSpace.Jobs.init(Layout.Page.container,{erecno:erecno}):-1!==Layout.Page.hash.indexOf("home/user/jobs")?Timetracker.UserSpace.Jobs.init(Layout.Page.container,{erecno:Timetracker.Team.getSelectedUser()}):(projectId=Layout.Page.container.find("#dashboardJob"+jobPkId).attr("projectId"),Timetracker.Widgets.PendingJobs.getJobs()),Timetracker.cache.clearCache(Timetracker.constants.JOB_TABLE),projectId&&Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE))},toggleJobStatus:function(event,toggleData){var ele=event.target,data=$(ele).closest("ul").data().schval,isCompleted=data.jobStatus,isFromProject=!1;-1!=Layout.Page.hash.indexOf("project")&&(isFromProject=!0),data&&Timetracker.jobs.Operations.changeisCompleted(data.jobId,isCompleted,ele,isFromProject,!0)},destroyZComp:function(){var modal=Timetracker.Util.getMainContainer().find("#zp_modal_assignusersjobs");ZPeopleComponents.isComponent(modal.find("#multiUserMappingSelect"))&&ZPeopleComponents.tokenfield(modal.find("#multiUserMappingSelect")).destroy()}},Filters:{constructFilterBasedOnView:function(){Timetracker.jobs.Listing.getViewType()===Timetracker.constants.USER?Timetracker.jobs.Filters.constructFilter():Timetracker.jobs.UnAssignedJobs.constructFilter()},constructFilter:function(){var layout=Timetracker.jobs.pageLayout;if(0==layout.find("#filterDiv").length){var filterOpt={jobName:{single:!0,label:Timetracker.jobs.formDetails.labelDetails.JOBNAME,paramId:"searchJobKey",defValue:0},jobNameInput:{type:"input",id:"jobNameSearch",className:"ztextbox zpl_DNI"},client:{single:!1,label:Timetracker.util.getClientDisplayName(),paramId:"clientId",tokenField:!0},project:{single:!1,label:Timetracker.util.getProjectDisplayName(),paramId:"projectId",tokenField:!0},assignedto:{single:!1,searchmode:"SETTINGS",label:ZPI18N.getString("zp.assignedto"),id:"assignedto",paramId:"assignedTo",tokenField:!0},assignedby:{single:!1,searchmode:"SETTINGS",label:ZPI18N.getString("zp.assignedby"),paramId:"assignedBy",tokenField:!0},status:{single:!0,label:ZPI18N.getString("zp.status"),paramId:"jobStatus",defValue:0}},pageMode=Timetracker.Page.getPageMode();("ts_mydata"==pageMode||"ts_teamuser"==pageMode||"ts_operuser"==pageMode)&&(filterOpt.assignedto.showHeader=!1),TimetrackerOperations.Filters.constructFilterDiv(filterOpt);var options=[];for(var i in Timetracker.jobs.assignedbyoptions)i&&null!=i&&options.push({value:i,label:Timetracker.jobs.assignedbyoptions[i]});var filterDiv=layout.find("#filterDiv");TimelyZComp.tokenField.addOptions(filterDiv.find("[compname=assignedby]"),options),Timetracker.jobs.Listing.setDefaultFilterParams()}TimetrackerOperations.Filters.toggleFilter()},createJobSelect:async function(userid,jobStatus,operation,projectId,clientId,viewEditPermissionType,othrDtls){var elementIds,isFromClientSelect=othrDtls&&othrDtls.isFromClientSelect;null!==projectId&&void 0!==projectId&&""!==projectId||(projectId="0"),void 0!==userid&&null!==userid&&""!==userid||(userid=erecno),""!==jobStatus&&null!==jobStatus&&void 0!==jobStatus||(jobStatus="-1"),(null===clientId||void 0===clientId||""===clientId.trim()||!isFromClientSelect&&"0"===projectId)&&(clientId="0");var appendToDiv,isClientDetailsNeeded=!1,elementId="",containerId="",setDefaultOption=!0,jobDispName=Timetracker.util.getJobDisplayName(!0),includeDeptJobs=!1,isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",othrDtls);if("timerLogTime"===operation)jobStatus="0",elementIds="timerjobs",includeDeptJobs=!0,isClientDetailsNeeded=!0,Timetracker.UserSpace.isMySpace()&&(appendToDiv=Layout.Page.parentContainer);else if("jobsch"===operation)isClientDetailsNeeded=!0,elementIds="jbsch_jobid",includeDeptJobs=!0;else if("dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation||"locationjobschedule"===operation)isClientDetailsNeeded=!0,includeDeptJobs=!0,jobStatus="0",operation.indexOf("dailyLogTime")>=0?"day":operation.indexOf("weeklyLogTime")>=0?"week":operation.indexOf("halfmonthlyLogTime")>=0?"halfmonth":operation.indexOf("monthlyLogTime")>=0?"month":operation.indexOf("locationjobschedule")>=0&&("locjobschd",userid=othrDtls&&othrDtls.locationId?othrDtls.locationId:"0");else if("addeditlogtime"===operation)jobStatus="0",isClientDetailsNeeded=!0,elementIds=-1!==Layout.Page.hash.indexOf("selfservice/user/calendar")||-1!==Layout.Page.hash.indexOf("timetracker/timelogs/calendarview")||ZPCal.Calendar.isDashboardCal()?"addeditlogtime":"timelogJob","timelogProject",includeDeptJobs=!0,appendToDiv=ZP5Form.getFormClassObj().LAYOUT;else if("addeditbreaklogtime"===operation)jobStatus="0",elementIds=-1!==Layout.Page.hash.indexOf("selfservice/user/calendar")||-1!==Layout.Page.hash.indexOf("timetracker/timelogs/calendarview")||ZPCal.Calendar.isDashboardCal()?"addeditbreaklogtime":"timelogJob",includeDeptJobs=!0;else if("calendarLogTime"===operation)jobStatus="0",elementIds="jobid","projectid",isClientDetailsNeeded=!0,includeDeptJobs=!0;else if("timesheetEdit"==operation){let data=$(projectId).closest("tr").data();elementIds=["ts_job_"+data.timelogId],projectId=data.projectId,setDefaultOption=!1,includeDeptJobs=!0}if("dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation||"locationjobschedule"===operation){elementId=$(projectId).closest("tr").find("[name='job']"),containerId=$(elementId).closest("tr").attr("id"),projectId=null===(projectId=isBreakLog||0==projectId.length?"0":TimelyZComp.select.getValue(projectId))||""===projectId?"0":projectId,clientId=isFromClientSelect||"0"!==projectId?clientId:"0";var params={mode:"getJobs",erecno:userid,getCurUserJobs:!0,jobStatus:jobStatus,projectId:projectId,includeDeptJobs:!0,isClientDetailsNeeded:isClientDetailsNeeded,conreqcsr:csrfToken};void 0!==clientId&&"0"!==clientId&&(params.clientId=clientId),isBreakLog&&(params.fetchBreakJobs=!0),"locationjobschedule"===operation&&(params.fetchOnlyLocationJobs=!0,params.assignedTo=userid,delete params.getCurUserJobs,delete params.erecno,delete params.includeDeptJobs,showAddJob=!1);var eleId=$(elementId).attr("id"),selJson={elementId:eleId,containerId:containerId,entity:Timetracker.constants.JOB,params:params},text=ZPI18N.getString("zp.select")+" "+(isBreakLog?ZPI18N.getString("zp.break"):jobDispName);selJson.defSelJson=selJson.initSelJson={id:"0",text:text,html:text},Timetracker.jobs.Util.populateSingleJobOrProject(selJson,projectId,operation,elementId).then(function(){Timetracker.zselect.create(!0,selJson);if(Timetracker.jobs.Filters.gettitle(eleId,containerId),Timetracker.util.checkAddJobPermVar&&!isBreakLog){var json={id:eleId,isFromProjects:!1,containerId:containerId};Timetracker.timelogs.forms.addFromSelect(containerId,eleId,ZPI18N.getString("zp.addcomponents",[jobDispName]),Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}Timetracker.jobs.Filters.gettitle(eleId,containerId)})}else{elementId=elementIds,params={mode:"getJobs",erecno:userid,getCurUserJobs:!0,jobStatus:jobStatus,projectId:projectId,includeDeptJobs:includeDeptJobs,isClientDetailsNeeded:isClientDetailsNeeded,conreqcsr:csrfToken};void 0!==clientId&&"0"!==clientId&&(params.clientId=clientId),viewEditPermissionType&&Timetracker.isTTCustomAdmin(viewEditPermissionType)&&(params.viewEditPermissionType=viewEditPermissionType),isBreakLog&&(params.fetchBreakJobs=!0);var single_job;selJson={elementId:elementId,entity:Timetracker.constants.JOB,params:params},text=ZPI18N.getString("zp.all")+" "+Timetracker.util.jobDispName;if("addeditlogtime"===operation||"calendarLogTime"===operation&&!isBreakLog||"jobsch"===operation?text=ZPI18N.getString("zp.select"):"timerjobs"===elementId||"timesheetEdit"===operation&&!isBreakLog?text=ZPI18N.getString("zp.select")+" "+jobDispName:isBreakLog&&(text=ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.break")),setDefaultOption&&(selJson.defSelJson=selJson.initSelJson={id:"0",text:text,html:text}),appendToDiv&&(selJson.appendTo=appendToDiv),Timetracker.generalSettings.isAutoPopulateSingleJob()&&("addeditlogtime"===operation||"calendarLogTime"===operation||isBreakLog)&&othrDtls&&othrDtls.isAdd&&(null==projectId||"0"==projectId||"-Select-"==projectId)){var cacheKey=selJson.elementId;selJson.hasOwnProperty("containerId")&&(cacheKey=selJson.containerId+"_"+selJson.elementId),selJson.logType=isBreakLog?Timetracker.constants.BREAK:Timetracker.constants.JOB,selJson.user=Timetracker.timelogs.tserecno,selJson.skipreset=!0;var skipReset=!1,prevSelJson=Timetracker.Filters.Configuartion.getProperty(cacheKey+"-"+selJson.entity);prevSelJson&&(skipReset=(skipReset=prevSelJson.user===selJson.user)&&prevSelJson.logType===selJson.logType),skipReset||Timetracker.Filters.Util.resetPropAndSearch(cacheKey+"-"+selJson.entity),Timetracker.Filters.Configuartion.setProperty(selJson),selJson.url="/timesheet.zp",searchresult=await Timetracker.Filters.Search.getSearchResults("",cacheKey+"-"+selJson.entity,!1),searchresult instanceof Array&&1===searchresult.length?single_job={id:searchresult[0].id,text:searchresult[0].text,html:ZPeople.decodeTxt(searchresult[0].html),detail:searchresult[0].detail}:searchresult instanceof Object&&searchresult.id&&(single_job=searchresult),single_job&&(selJson.initSelJson={id:single_job.id,text:single_job.text,html:ZPeople.decodeTxt(single_job.html)})}if(await Timetracker.jobs.Util.populateSingleJobOrProject(selJson,projectId,operation),Timetracker.zselect.create(!0,selJson),single_job&&(single_job.id&&(Timetracker.jobs.jobData||(Timetracker.jobs.jobData={}),Timetracker.jobs.jobData[single_job.id]||(Timetracker.jobs.jobData[single_job.id]=single_job.detail)),Timetracker.timelogs.jobChange(operation,null,{isBreakLog:isBreakLog,skipJobReset:!0})),Timetracker.util.checkAddJobPermVar&&"timerjobs"===elementId){var json={id:"timerjobs",isFromProjects:!1,optId:"timerjobadd"};Timetracker.timelogs.forms.addFromSelect("timerarea","timerjobs",ZPI18N.getString("zp.add")+" "+jobDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}else if(Timetracker.util.checkAddJobPermVar&&"jbsch_jobid"===elementId){json={id:"jbsch_jobid",containerId:"jobScheduleAddEditPopup",isFromProjects:!1,optId:"jsaddjob"};Timetracker.timelogs.forms.addFromSelect("jobsch_form","jbsch_jobid",ZPI18N.getString("zp.add")+" "+jobDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}else if("calendarLogTime"===operation&&Timetracker.util.checkAddJobPermVar&&"jobid"===elementId){json={id:"jobid",isFromProjects:!1,optId:"caljobadd"};Timetracker.timelogs.forms.addFromSelect("calAddPopup","jobid",ZPI18N.getString("zp.add")+" "+jobDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}Timetracker.jobs.Filters.gettitle(elementId)}if("addeditlogtime"===operation||"calendarLogTime"===operation||"timerLogTime"===operation||"dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation||"jobsch"===operation){var specificKeyReset=[];if("0"===clientId&&"0"===projectId?specificKeyReset=isFromClientSelect?["project"]:["project","client"]:null!==clientId&&"0"!==clientId&&"-select-"!==clientId||null===projectId||"0"===projectId||"-Select-"===projectId||void 0===Timetracker.projects.projectData[projectId]||void 0===Timetracker.projects.projectData[projectId].clientId||(specificKeyReset=["project","client"]),0!=specificKeyReset.length){var selectdetails={specificKeyReset:specificKeyReset,isNewKey:!0,isFromClientSelect:isFromClientSelect};null!=othrDtls&&othrDtls.hasOwnProperty("erecNo")&&(selectdetails.erecNo=othrDtls.erecNo),Timetracker.timelogs.setValuesInSelectInput(Timetracker.projects.projectData[projectId],operation,containerId,null,selectdetails)}}},gettitle:function(elementId,containerId,isEncoded=!0){var layout=Layout.Page.container;if(void 0!==containerId&&(layout=layout.find("#"+containerId)),ZPeopleComponents.isComponent(layout.find("#"+elementId))){var comp=ZPeopleComponents.select(layout.find("#"+elementId)),data=comp.getOptionData();Array.isArray(data)&&0!=data.length&&void 0!=data[0].text&&(comp.container[0].title=isEncoded?ZPeople.decodeTxt(data[0].text):data[0].text)}},setJobsList:async function(userid,reqJson){if(Timetracker.jobs.fetchJob||null===Timetracker.jobs.jobData||null===Timetracker.jobs.userJobs||void 0===Timetracker.jobs.userJobs[userid]){Timetracker.jobs.userJobs=Timetracker.jobs.fetchJob?null:Timetracker.jobs.userJobs,Timetracker.jobs.fetchJob=!1;var params={mode:"getJobs",erecno:userid,getCurUserJobs:!0,isClientDetailsNeeded:!0,conreqcsr:csrfToken};null!==reqJson&&0!==reqJson.length&&(params=Object.assign(params,reqJson));var[resultData]=await ZPeople.Request.sendRequestAsPromise("/timesheet.zp",params);Timetracker.jobs.userJobs=null===Timetracker.jobs.userJobs?{}:Timetracker.jobs.userJobs,Timetracker.jobs.userJobs[userid]=resultData,Timetracker.Filters.Util.convertResultFormat("timelogJob-job",resultData)}else Timetracker.jobs.userJobs[userid]?Timetracker.Filters.Util.convertResultFormat("timelogJob-job",Timetracker.jobs.userJobs[userid]):Timetracker.jobs.jobData={}},constructJobs:function(result,userid,jobStatus,operation,projectId){var userDtl,jobDispName=Timetracker.util.getJobDisplayName(!0),optvalts="",optvalrep="",nonCompletedDept="",dailyWeeklyRowObj=projectId;"0"!==userid&&(userDtl=ZPeople.getUserDetailsById(userid)),"dailyLogTime"!==operation&&"weeklyLogTime"!==operation&&"halfmonthlyLogTime"!==operation&&"monthlyLogTime"!==operation||(projectId=$(projectId).val()),projectId&&"-Select-"!==projectId||(projectId="0");var optvaltsData=[],optvalrepData=[],nonCompletedDeptData=[];$.each(result,function(index,data){if(void 0===projectId||null===projectId||"0"===projectId||data.projectId===projectId){var includeJob=!1,isDeptJob=!1;"0"===userid?(isDeptJob=data.deptIds&&data.deptIds.length>0,(includeJob=isDeptJob||data.erecno&&data.erecno.length>0)||(includeJob=Timetracker.isDataAdminForAllUsers())):($.each(data.erecno,function(i,assdata){assdata!==userid||(includeJob=!0)}),includeJob||(includeJob=isDeptJob=data.deptIds&&userDtl.deptId&&-1!==data.deptIds.indexOf(userDtl.deptId))),includeJob&&(isDeptJob&&1!==data.iscompleted?(nonCompletedDept+="<option value='"+data.jobId+"'>"+data.jobName+"</option>",nonCompletedDeptData.push({id:data.jobId,text:ZPeople.decodeTxt(data.jobName)})):1!==data.iscompleted?(optvalts+="<option value='"+data.jobId+"'>"+data.jobName+"</option>",optvaltsData.push({id:data.jobId,text:ZPeople.decodeTxt(data.jobName)})):(optvalrep+="<option value='"+data.jobId+"'>"+data.jobName+"</option>",optvalrepData.push({id:data.jobId,text:ZPeople.decodeTxt(data.jobName)})))}});var tempval1="<option value='0'>"+ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.jobDispName)+"</option>",tempval2="<option value='0'>"+ZPI18N.getString("zp.select")+" "+("Jobs"===Timetracker.util.jobDispName?ZPI18N.getString("zp.job"):Timetracker.util.jobDispName)+"</option>",tempval3='<option value="-Select-">'+ZPI18N.getString("zp.select")+"</option>",tempData1=new Array({id:"0",text:ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.jobDispName)}),tempData2=new Array({id:"0",text:ZPI18N.getString("zp.select")+" "+ZPeople.decodeTxt("Jobs"===Timetracker.util.jobDispName?ZPI18N.getString("zp.job"):Timetracker.util.jobDispName)}),singulartempData=new Array({id:"0",text:ZPI18N.getString("zp.select")+" "+ZPeople.decodeTxt(jobDispName)});if("tsexport"===operation)Layout.Page.container.find("#tsexportjobs").html(tempval1+optvalts+optvalrep),Layout.Page.container.find("#tsexportjobs").val("0");else if("timelogsList"===operation)tempData1=tempData1.concat(optvaltsData).concat(optvalrepData),Layout.Page.container.find("#tsjobs").select2({data:tempData1}).select2("val","0");else if("timelogsCalendar"===operation)tempData1=tempData1.concat(optvaltsData).concat(optvalrepData),Layout.Page.container.find("#tscaljobs").select2({data:tempData1}).select2("val","0");else if("timelogReport"===operation)tempData1="0"===jobStatus?tempData1.concat(optvaltsData):"1"===jobStatus?tempData1.concat(optvalrepData):tempData1.concat(optvaltsData).concat(optvalrepData),Layout.Page.container.find("#rjobName").select2({data:tempData1}).select2("val","0");else if("timerReport"===operation)tempData1=tempData1.concat(optvaltsData).concat(optvalrepData),Layout.Page.container.find("#tirjobName").select2({data:tempData1}).select2("val","0");else if("qbReport"===operation)"0"===jobStatus?Layout.Page.container.find("#qbrjobName").html(tempval1+optvalts).select2(Timetracker.select2.getSelect2Properties()):"1"===jobStatus?Layout.Page.container.find("#qbrjobName").html(tempval1+optvalrep).select2(Timetracker.select2.getSelect2Properties()):Layout.Page.container.find("#qbrjobName").html(tempval1+optvalts+optvalrep).select2(Timetracker.select2.getSelect2Properties()),Layout.Page.container.find("#qbrjobName").val("0");else if("jobReport"===operation)tempData1="0"===jobStatus?tempData1.concat(optvaltsData):"1"===jobStatus?tempData1.concat(optvalrepData):tempData1.concat(optvaltsData).concat(optvalrepData),Layout.Page.container.find("#jrjobName").select2({data:tempData1}).select2("val","0");else if("userReport"===operation)tempData1=tempData1.concat(optvaltsData).concat(optvalrepData),Layout.Page.container.find("#urjobName").select2({data:tempData1}).select2("val","0");else if("billing"===operation)tempData1=tempData1.concat(optvaltsData).concat(optvalrepData),Layout.Page.container.find("#billing-job").select2({data:tempData1}).select2("val","0");else if("timesheetList"===operation)tempData1=tempData1.concat(optvaltsData).concat(optvalrepData),Layout.Page.container.find("#crjobName").select2({data:tempData1}).select2("val","0");else if("editcalproject"===operation)Layout.Page.container.find("#jobid").html(tempval2+optvalts+optvalrep).select2(Timetracker.select2.getSelect2Properties());else if("timerLogTime"===operation){if(tempData2=tempData2.concat(optvaltsData).concat(nonCompletedDeptData),Layout.Page.container.find("#timerjobs").select2({data:tempData2}).select2("val","0"),Layout.Page.container.find("#jobid").html(tempval2+optvalts+nonCompletedDept).select2(Timetracker.select2.getSelect2Properties()),Timetracker.util.checkAddJobPermVar){var json={id:"timerjobs",isFromProjects:!1};Timetracker.timelogs.forms.addFromSelect("timerarea","timerjobs",ZPI18N.getString("zp.add")+" "+Timetracker.util.jobDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}}else if("jobsch"===operation){if(Layout.Page.container.find("#jbsch_jobid").select2({data:singulartempData.concat(optvaltsData).concat(nonCompletedDeptData)}).select2("val","0"),Timetracker.util.checkAddJobPermVar){json={id:"jbsch_jobid",containerId:"jobsch_form",isFromProjects:!1};Timetracker.timelogs.forms.addFromSelect("jobsch_form","jbsch_jobid",ZPI18N.getString("zp.add")+" "+jobDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}}else if("dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation){var id="dailyLogTime"===operation?Timetracker.constants.DAY:"weeklyLogTime"===operation?Timetracker.constants.WEEK:"halfmonthlyLogTime"===operation?Timetracker.constants.HALFMONTH:Timetracker.constants.MONTH;if($(dailyWeeklyRowObj).parent().parent().find("#"+id+"jobselect").select2({data:tempData2.concat(optvaltsData).concat(nonCompletedDeptData)}).select2("val","0"),Timetracker.util.checkAddJobPermVar){json={id:id+"jobselect",isFromProjects:!1,containerId:$(dailyWeeklyRowObj).parent().parent().attr("id")};Timetracker.timelogs.forms.addFromSelect($(dailyWeeklyRowObj).parent().parent().attr("id"),id+"jobselect",ZPI18N.getString("zp.add")+" "+Timetracker.util.jobDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}}else if("addeditlogtime"===operation||"calendarLogTime"===operation){var selDiv=Layout.Page.container.find('select[name="JobId"]'),curProDivSel=selDiv.val();selDiv.html(tempval3+optvalts+nonCompletedDept),Timetracker.util.checkIfSelectHasValue(selDiv,curProDivSel)?selDiv.val(curProDivSel).select2(Timetracker.select2.getSelect2Properties()):selDiv.select2(Timetracker.select2.getSelect2Properties())}else if(void 0===operation&&(tempData1=tempData1.concat(optvaltsData).concat(optvalrepData),Layout.Page.container.find("#tscaljobs,#tsjobs,#rjobName,#tirjobName,#jrjobName,#urjobName,#crjobName,#billing-job").select2({data:tempData1}).select2("val","0"),tempData2=tempData2.concat(optvaltsData).concat(nonCompletedDeptData),Layout.Page.container.find("#timerjobs").select2({data:tempData2}).select2("val","0"),Timetracker.util.checkAddJobPermVar)){json={id:"timerjobs",isFromProjects:!1};Timetracker.timelogs.forms.addFromSelect("timerarea","timerjobs",ZPI18N.getString("zp.add")+" "+Timetracker.util.jobDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}},setDtlsForSingleJobOrProjectData:async function(selJson,value,operation,obj){var cacheKey=selJson.elementId;selJson.skipreset=!0,selJson.hasOwnProperty("containerId")&&(cacheKey=selJson.containerId+"_"+selJson.elementId),Timetracker.Filters.Util.resetPropAndSearch(cacheKey+"-"+selJson.entity),Timetracker.Filters.Configuartion.setProperty(selJson),"project"===selJson.entity?searchresult=selJson.initSelJson={id:Timetracker.projects.projectData[value.index].projectId,text:Timetracker.projects.projectData[value.index].projectName,html:Timetracker.projects.projectData[value.index].projectName}:"job"===selJson.entity&&(void 0!==Timetracker.jobs.jobData.length&&void 0!==Timetracker.jobs.jobData[value.index]||await Timetracker.jobs.Filters.setJobsList(Timetracker.timelogs.tserecno,selJson.params),searchresult=selJson.initSelJson={id:Timetracker.jobs.jobData[value.index].jobId,text:Timetracker.jobs.jobData[value.index].jobName,html:Timetracker.jobs.jobData[value.index].jobName});var dtlsJson={result:searchresult,doSearch:!1};Timetracker.Filters.Search.setSearchDtlsAndKeys(cacheKey+"-"+selJson.entity,"#",dtlsJson),"job"===selJson.entity&&Timetracker.timelogs.setBillableStatusForSingleJob(selJson,operation,Timetracker.jobs.jobData[value.index].jobId,obj)}},Forms:{getScheduleDetailsForForm:function(params,formlayout){var totalHours=0,selectedAssignees=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users);if(selectedAssignees.length>0){var assignees="",assigneeHours="",assigneeRate="";$.each(selectedAssignees,function(index,data){0!==index&&(assignees+=";",assigneeHours+=";",assigneeRate+=";"),assignees+=data.recordId,void 0!==data.hours?(assigneeHours+=Calendar.minstohrs(data.hours),totalHours+=data.hours):assigneeHours+="00:00",void 0!==data.rate?assigneeRate+=data.rate:assigneeRate+="0"}),params.Assignees=assignees,params.AssigneeHours=assigneeHours,params.AssigneeRate=assigneeRate}if(params.Hours=totalHours,Timetracker.isDataAdminForAllUsers()){if(Timetracker.forms.appFor.isAllRecordSelected(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts,!0))params.departmentIds="0";else{var departmentIds="",selectedDepts=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts);selectedDepts.length>0&&$.each(selectedDepts,function(index,data){0!==index&&(departmentIds+=";"),departmentIds+=data.recordId}),params.departmentIds=departmentIds}if(Timetracker.generalSettings.isJobProLocApplicableEnabled())if(Timetracker.forms.appFor.isAllRecordSelected(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs,!0))params.locationIds="0";else{var locationIds="",selectedLocs=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs);selectedLocs.length>0&&$.each(selectedLocs,function(index,data){0!==index&&(locationIds+=";"),locationIds+=data.recordId}),params.locationIds=locationIds}if(isOrgStructureEnabled)if(Timetracker.forms.appFor.isAllRecordSelected(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs,!0))params.divisionIds="0";else{var divisionIds="",selectedDivs=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs);selectedDivs.length>0&&$.each(selectedDivs,function(index,data){0!==index&&(divisionIds+=";"),divisionIds+=data.recordId}),params.divisionIds=divisionIds}}var layout=null!=formlayout?formlayout:Layout.Page.container;if(Timetracker.jobSchedule.isJobScheduleEnabled()&&0!=layout.find("#jobColor").length){var jcClass=layout.find("#jobColor").attr("class").split(" ").find(value=>/jc_bg/.test(value));params.zp_jobcolor=jcClass.replace("jc_bg","")}params.BillableStatus=0!=layout.find("select[name=BillableStatus]").length?ZPeopleComponents.select(layout.find("select[name=BillableStatus]")).getValue():-1,params.isFromNewUI=!0;var errJson=Timetracker.timeLogSettings.workItems.updateWorkitemParams(params,layout);void 0!==errJson&&"duplicate"===errJson.errMsg?params.hasDuplicateWorkitems=!0:void 0!==errJson&&"exceedlength"===errJson.errMsg?params.hasExceedLength=!0:void 0!==errJson&&"workitemCountExceed"===errJson.errMsg&&(params.hasWorkitemCountExceeded=!0)}},Util:{cacheDataCurrentUser:null,isEditDeleteAllowed:function(isAdmin,owner,projectHead,projectManagerArray){return!(!isAdmin&&owner!==erecno&&projectHead!==erecno)||-1!==Timetracker.projects.Operations.findJSONArrayIndex(projectManagerArray,erecno,"erecno")},setAllJobsOrProjectsFetched:function(selJson){void 0!==selJson.params.clientId&&"0"!==selJson.params.clientId||void 0!==selJson.params.searchKey||("job"!==selJson.entity||void 0!==selJson.params.projectId&&"0"!==selJson.params.projectId||void 0===selJson.params.jobStatus||"-1"!==selJson.params.jobStatus?"project"===selJson.entity&&void 0!==selJson.params.projectStatus&&"-1"===selJson.params.projectStatus&&(Timetracker.clients.clientData.hasNoMoreData=!0):Timetracker.projects.projectData.hasNoMoreData=!0)},updateCache:function(id,keyValue,keyName,type){var data,subData;"job"===type?(data=Timetracker.jobs.jobData,subData=Timetracker.projects.projectData):"project"===type&&(data=Timetracker.projects.projectData,subData=Timetracker.clients.clientData),void 0!==data[id]&&(data[id][keyName]=keyValue),"iscompleted"!==keyName&&"projectStatus"!==keyName||(Timetracker.jobs.Util.clearSingleDataStatusJson(subData),"job"===type&&0===keyValue&&void 0!==data[id]&&void 0!==subData[data[id].projectId]&&1===subData[data[id].projectId].projectStatus&&(subData[data[id].projectId].projectStatus=keyValue,Timetracker.jobs.Util.updateCache(data[id.projectId],1,"projectStatus","project")),void 0!==data[id]&&void 0!==data[id].hasSingleDataStatusJson&&delete data[id].hasSingleDataStatusJson)},clearCache:function(id,type,clearSubData){var data,subData;"job"===type?(subData=Timetracker.projects.projectData,data=Timetracker.jobs.jobData):"project"===type?(subData=Timetracker.clients.clientData,data=Timetracker.projects.projectData):"client"===type&&(data=Timetracker.clients.clientData),void 0!==id?void 0!==data[id]&&delete data[id]:"job"===type?Timetracker.jobs.jobData={}:"project"===type&&(Timetracker.projects.projectData={}),void 0!==subData&&void 0!==subData.hasNoMoreData&&subData.hasNoMoreData&&delete subData.hasNoMoreData,clearSubData&&Timetracker.jobs.Util.clearSingleDataStatusJson(subData)},clearSingleDataStatusJson:function(data){if(void 0!==data)for(var i in data)void 0!==data[i].hasSingleDataStatusJson&&delete data[i].hasSingleDataStatusJson},populateSingleJobOrProject:async function(selJson,id,operation,obj){var data,keyName,subData,status,statusKeyName,value,userId;if("project"===selJson.entity)void 0!==id&&(userId=selJson.params.fetchOnlyLocationProjects?void 0!==selJson.params.assignedTo?selJson.params.assignedTo:"0":void 0!==selJson.params.proAssignedTo?selJson.params.proAssignedTo:"0"),data=Timetracker.clients.clientData,subData=Timetracker.projects.projectData,keyName="clientId",status=void 0!==selJson.params.projectStatus?parseInt(selJson.params.projectStatus):-1,statusKeyName="projectStatus";else if("job"===selJson.entity){if("projectReport"===operation)return;void 0!==id&&(userId=selJson.params.fetchOnlyLocationJobs?void 0!==selJson.params.assignedTo?selJson.params.assignedTo:"0":void 0!==selJson.params.erecno?selJson.params.erecno:"0"),data=Timetracker.projects.projectData,subData=Timetracker.jobs.jobData,keyName="projectId",status=void 0!==selJson.params.jobStatus?parseInt(selJson.params.jobStatus):-1,statusKeyName="iscompleted"}if(userId!==Timetracker.jobs.Util.cacheDataCurrentUser&&(Timetracker.jobs.Util.clearCache(void 0,"project",!0),Timetracker.jobs.Util.clearCache(void 0,"job",!0),"project"===selJson.entity?(data=Timetracker.clients.clientData,subData=Timetracker.projects.projectData):"job"===selJson.entity&&(data=Timetracker.projects.projectData,subData=Timetracker.jobs.jobData)),Timetracker.jobs.Util.cacheDataCurrentUser=userId,null!=id&&"0"!=id&&"-Select-"!=id&&void 0!==data[id])if(void 0!==data[id].hasSingleDataStatusJson&&(-1===status&&data[id].hasSingleDataStatusJson.all||0===status&&data[id].hasSingleDataStatusJson.inProgress||1===status&&data[id].hasSingleDataStatusJson.completed))-1===status&&data[id].hasSingleDataStatusJson.all?value={index:data[id].hasSingleDataStatusJson.id,count:1}:0===status&&data[id].hasSingleDataStatusJson.inProgress?value={index:data[id].hasSingleDataStatusJson.inProgressId,count:1}:1===status&&data[id].hasSingleDataStatusJson.completed&&(value={index:data[id].hasSingleDataStatusJson.completedId,count:1}),await Timetracker.jobs.Filters.setDtlsForSingleJobOrProjectData(selJson,value,operation,obj);else{if(void 0!==data[id].hasSingleDataStatusJson&&(-1===status&&void 0!==data[id].hasSingleDataStatusJson.all&&!data[id].hasSingleDataStatusJson.all||0===status&&void 0!==data[id].hasSingleDataStatusJson.inProgress&&!data[id].hasSingleDataStatusJson.inProgress||1===status&&void 0!==data[id].hasSingleDataStatusJson.completed&&!data[id].hasSingleDataStatusJson.completed||data[id].hasSingleDataStatusJson.inProgress&&data[id].hasSingleDataStatusJson.completed))return;if(value=Timetracker.jobs.Util.findProjectOrJobCountAndIndex(subData,id,keyName,operation,status,statusKeyName),(void 0===data.hasNoMoreData||!data.hasNoMoreData)&&value.count<2){var cacheKey=selJson.elementId;selJson.skipreset=!0,selJson.hasOwnProperty("containerId")&&(cacheKey=selJson.containerId+"_"+selJson.elementId),Timetracker.Filters.Util.resetPropAndSearch(cacheKey+"-"+selJson.entity),Timetracker.Filters.Configuartion.setProperty(selJson),selJson.entity===Timetracker.constants.PROJECT||selJson.entity===Timetracker.constants.CLIENT?selJson.url=Timetracker.constants.URL:selJson.url="/timesheet.zp",searchresult=await Timetracker.Filters.Search.getSearchResults("",cacheKey+"-"+selJson.entity,!1),1===searchresult.length?(data[id].hasSingleDataStatusJson=void 0===data[id].hasSingleDataStatusJson?{}:data[id].hasSingleDataStatusJson,-1===status?(data[id].hasSingleDataStatusJson.id=searchresult[0].id,data[id].hasSingleDataStatusJson.all=!0):0===status?(data[id].hasSingleDataStatusJson.inProgressId=searchresult[0].id,data[id].hasSingleDataStatusJson.inProgress=!0):1===status&&(data[id].hasSingleDataStatusJson.completedId=searchresult[0].id,data[id].hasSingleDataStatusJson.completed=!0),selJson.initSelJson={id:searchresult[0].id,text:searchresult[0].html,html:searchresult[0].html},"job"===selJson.entity&&Timetracker.timelogs.setBillableStatusForSingleJob(selJson,operation,searchresult[0].id,obj)):(data[id].hasSingleDataStatusJson=void 0===data[id].hasSingleDataStatusJson?{}:data[id].hasSingleDataStatusJson,-1===status?data[id].hasSingleDataStatusJson.all=!1:0===status?data[id].hasSingleDataStatusJson.inProgress=!1:1===status&&(data[id].hasSingleDataStatusJson.completed=!1))}else 1===value.count&&-1!==value.index&&await Timetracker.jobs.Filters.setDtlsForSingleJobOrProjectData(selJson,value,operation,obj)}},findProjectOrJobCountAndIndex:function(data,keyValue,keyName,operation,status,statusKeyName){var value={count:0,index:-1};if(keyValue&&keyName&&0!==Object.keys(data).length)for(var i in data)!data[i][keyName]||data[i][keyName]!==keyValue||-1!==status&&data[i][statusKeyName]!==status||(value.count++,value.index=i);return value},showExportNew:function(){ZP5Export.init("job",{moduleSysViewCallback:Timetracker.ImportExport.showExportNew})},clickHandler:function(eve){var ele=eve.target,ref=$(ele).attr("ref");if("skip"!=ref)if(0!=$(ele).closest("ul").length){if(void 0===(data=$(ele).closest("ul").data("schval")))return void("sort"==ref?Timetracker.jobs.Listing.getSchedule(ele,null,null,!0):"checkall"==ref?Timetracker.views.checkAllCheckBoxes(ele,"job-listtbody",settingsPage.container):"switchView"==ref&&Timetracker.jobs.Listing.switchView(ele));if("delete"==ref){var jobDispName=Timetracker.util.getJobDisplayName(!0,!0),extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[jobDispName]),body:ZPI18N.getString("zp.common.delEntityInfo2",[jobDispName])};Timetracker.Util.confirmpopUp(data.jobId,Timetracker.jobs.Operations.showOpDelete,data.jobId,0,extraDtls)}else if("ZProject_job"==ref)Timetracker.jobs.Listing.showZProjects_jobs(data.zProjectsPortalId,data.zProjectsProjectRefId,data.zProjectsJobRefId);else if("checkbox"==ref)Timetracker.jobs.Operations.checkParticularJob(ele);else if("attachment"==ref)data.attachId?Timetracker.util.downloadFile(data.attachId,data.jobId,"job"):data.attachmentPath&&window.open(ZPeople.decodeTxt(data.attachmentPath));else if("showAssignees"==ref)Timetracker.jobs.Listing.showHideAssignees(ele,!0);else if("closeAssignees"==ref)Timetracker.jobs.Listing.showHideAssignees(ele,!0);else if("changeStatus"==ref){if($(ele).data().isprocessing)return;$(ele).data().isprocessing=!0,Timetracker.jobs.Operations.changeisCompleted(data.jobId,data.jobStatus,ele)}else"sort"==ref?Timetracker.jobs.Listing.getSchedule(ele,null,null,!0):"addAssignees"==ref?Timetracker.jobs.Operations.showMultiUserMapperPopup("job","single",data.jobId,"user"):"view"==ref?Timetracker.forms.showForm(Timetracker.constants.VIEW,data.jobId):"edit"==ref&&Timetracker.forms.showForm(Timetracker.constants.EDIT,data.jobId)}else if(0!=$(ele).closest("tr").length){var data;if(void 0===(data=$(ele).closest("tr").data("schval")))return;if("delete"==ref){jobDispName=Timetracker.util.getJobDisplayName(!0,!0);if(!data.isDeleteAllowed)return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.notallowedtodeletethisproject",[jobDispName]),!0);extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[jobDispName]),body:ZPI18N.getString("zp.common.delEntityInfo2",[jobDispName])};Timetracker.Util.confirmpopUp(data.jobId,Timetracker.jobs.Operations.showOpDelete,data.jobId,0,extraDtls)}else if("optionsList"==ref){var opt=data.optArr;opt.length>3&&Timetracker.Util.constructOptionListing(opt,"moreOptions_"+data.jobId+"_"),ZPeopleComponents.menu("#moreOptions_"+data.jobId+"_").show()}else"edit"==ref&&Timetracker.forms.showForm(Timetracker.constants.EDIT,data.jobId)}else if("addJob"==ref){var niceUrl=settingsUrlProps.niceUrl.split("/");niceUrl=niceUrl.slice(0,niceUrl.length-1).join("/")+"/add",Timetracker.Page.isSelectedUser()&&(niceUrl+="-userId:"+Timetracker.Team.getSelectedUser()),window.location.href="#"+niceUrl}else"toggleFilter"==ref?Timetracker.jobs.Listing.getViewType()===Timetracker.constants.USER?Timetracker.jobs.Filters.constructFilter():Timetracker.jobs.UnAssignedJobs.constructFilter():"applyFilter"==ref?Timetracker.jobs.Listing.getViewType()===Timetracker.constants.USER?Timetracker.jobs.Listing.getSchedule():Timetracker.jobs.UnAssignedJobs.getSchedule():"resetFilter"==ref?Timetracker.jobs.Listing.setDefaultFilterParams():"view_close"==ref?Timetracker.views.isSystemView()?(settingsPage.container.find("#joblist").find("input[type='checkbox']:checked").prop("checked",!1),settingsPage.container.find("#zp_view_record_delete").removeClass("opn").fadeOut(200,function(){$(this).siblings("#zp_views_formrecactions").fadeIn(200)})):ZP5Views.currViewObj.showRecordActions(!1):"fullScreen"==ref?($("body").toggleClass("zpl_newsrcn"),Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").hasClass("zpl_act")?Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.maximize")).toggleClass("zpl_act"):Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.minimize")).toggleClass("zpl_act")):"exitFullScreen"==ref&&($("body").removeClass("zpl_newsrcn"),Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.maximize")).removeClass("zpl_act"))}}},Timetracker.projects={referenceColumn:!1,sorterObj:null,formDetails:null,refreshData:!1,projectsPopulated:!1,fetchProject:!1,userProjects:null,currProjectData:null,projectData:{},projectUsersArray:{},justNowCompletedProject:null,FETCHED_PROJECT_COUNT:{},MAXPROJECT_FETCH_COUNT:25,pageLayout:null,isFromOperations:!1,Listing:{constructSystemView:function(){var json={wrapperClass:"Nbar5",dataCallback:Timetracker.projects.Listing.initProjectList,onchangeCallback:Timetracker.views.customViewActions,formId:Timetracker.projects.formDetails.formId,formLoadCallback:Timetracker.projects.Listing.initProjectList,searchCallback:Timetracker.projects.Filters.constructFilterBasedOnView,systemViewName:Timetracker.util.projectDispName,exportCallback:Timetracker.ImportExport.showexportfld,tableName:"P_TimesheetJobsList"};if(TimetrackerOperations.init(),Timetracker.permissionCheckForOperPages())return Timetracker.projects.pageLayout=settingsPage.container,Timetracker.projects.isFromOperations=!0,json.importExportConstructionCallback=Timetracker.ImportExport.constructImportExportContainer,json},projectFormPermissionCheck(){if(!Timetracker.isDataAdminForAllUsers()&&(Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),0===Timetracker.projects.formDetails.viewPerm)){var layout=settingsPage.container;return layout.html("<div class='zpl_rgtcnt'></div>"),Timetracker.Util.showHideNoData({div:layout,msg:ZPI18N.getString("zp.notallowedforpage"),cls:"zp_nd_permission"}),!1}return!0},constructOperationView:function(){var layout=settingsPage.container;layout.find("#viewFooter").addClass("zpl_DNI"),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").addClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").addClass("DNI"),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").addClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions").removeClass("DNI"),layout.find(".zpl_tblres:not(#zp_views_list_container)").hide(),layout.find("#zp_views_list_container.zpl_tblres").show();var projectDispName=ZPI18N.getString("zp.tt.addentity",[Timetracker.util.getProjectDisplayName(!0)]),pageMode=Timetracker.Page.getPageMode();if(0===layout.find("#zp_views_list_container").length&&-1!=settingsUrlProps.niceUrl.indexOf("projects/listview")){var moreBtnId="projectsMore_"+pageMode.split("_")[1]+"_",viewerHtml='<ul class="zpl_grpmnu" id="switchProjectView"><li class="zpl_act" value="user" ref="switchView" aria-label="'+ZPI18N.getString("zp.employee")+'" tabindex="0">'+ZPI18N.getString("zp.employee")+'</li><li value="department" ref="switchView" aria-label="'+ZPI18N.getString("zp.department")+'" tabindex="0">'+ZPI18N.getString("zp.department")+"</li>";if(Timetracker.generalSettings.isJobProLocApplicableEnabled()&&(viewerHtml+='<li value="location" ref="switchView" aria-label="'+ZPI18N.getString("zp.location")+'" tabindex="0">'+ZPI18N.getString("zp.location")+"</li>"),isOrgStructureEnabled){var divDispName=ZPI18N.getString("zp.divisionname");ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(divDispName=ZPeople.orgStructureDispNameMap.division),viewerHtml+='<li value="division" ref="switchView" class="zpl_nowrap" aria-label="'+divDispName+'" tabindex="0">'+divDispName+"</li>"}var html='<div class="zpl_rgt" id="zp_views_formrecactions">'+(viewerHtml+="</ul>")+'<button class="zlabel zlabel--blue zlabel--medium DB" id="addProject" ref="addProject"  aria-label="'+projectDispName+'" tabindex="0" >'+projectDispName+'</button><i id="fullScrn" ref="fullScreen" class="zpl_ibg PI_maxmz'+($("body").hasClass("zpl_newsrcn")?' zpl_act" title="'+ZPI18N.getString("zp.minimize"):'" title="'+ZPI18N.getString("zp.maximize"))+'"></i><i class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" aria-label="'+ZPI18N.getString("zp.filter")+'" tabindex="0"  ref="toggleFilter"></i><i class="zpl_ibg PI_more" title="'+ZPI18N.getString("zp.more")+'" aria-label="'+ZPI18N.getString("zp.more")+'" tabindex="0"  ref="more" id="'+moreBtnId+'Btn"></i></div>';layout.find("#viewActionsContainer").append(html),html='<div class="actn_ovrly" id="zp_view_record_delete"></div>',layout.find("#viewActionsContainer").append(html),html='<div class="zpl_tblres" id="zp_views_list_container"></div>',layout.find(".zpl_rgtcnt").append(html),layout.find("#zp_views_list_container.zpl_tblres").append("<div id='zp_empty_data'></div>"),layout.addClass("zpl_tblfxd zpl_crdwthful"),layout.find("#viewActionsContainer").find("#fullScreenBack,i.PI_back").attr("ref","exitFullScreen"),layout.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPeople.decodeTxt(Timetracker.projects.formDetails.formDispName)]),tabindex:"0"});var moreOpt=Timetracker.ImportExport.getImportExportArray(Timetracker.constants.PROJECT);moreOpt.length?Timetracker.Util.constructMoreOption(moreOpt,moreBtnId):layout.find("#"+moreBtnId+"Btn").hide(),Timetracker.projects.VIEW_TYPE=null,header=Timetracker.ImportExport.showHideImportExportIcon(Timetracker.constants.PROJECT,layout);var multiSelectBtnHtml=Timetracker.views.multiSelectActions.getMultiSelectHtml();layout.find("#zp_view_record_delete").html(multiSelectBtnHtml),Timetracker.Util.addEventListner(null,"click",Timetracker.projects.Util.clickHandler,!0),Timetracker.Page.isSelectedUser(pageMode)&&layout.find("#switchProjectView").addClass("zpl_DNI")}-1!=settingsUrlProps.niceUrl.indexOf("projects/listview")&&Timetracker.Page.isSelectedUser(pageMode)&&layout.data("userId")!=Timetracker.Team.getSelectedUser()&&(Timetracker.projects.Listing.setDefaultFilterParams(),Timetracker.projects.refreshData=!0,layout.data("userId",Timetracker.Team.getSelectedUser()))},initProjectList:function(){var url=Layout.Page.hash;if(-1==url.indexOf("operations")){if(!Timetracker.projects.Listing.projectFormPermissionCheck())return}else if(!Timetracker.permissionCheckForOperPages())return;var addEditJson=null;if(Timetracker.projects.pageLayout=Timetracker.Util.getLayout(),Timetracker.projects.isFromOperations=!0,Timetracker.projects.Listing.constructOperationView(),Timetracker.projects.pageLayout.addClass("zpl_tblfxd zpl_act"),Timetracker.projects.pageLayout.removeClass("zpl_colmaxwd zpl_crdwthful"),-1!==url.indexOf("/projects/add")||-1!==url.indexOf("/projects/edit")||-1!==url.indexOf("/projects/view"))Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),(addEditJson={formId:Timetracker.projects.formDetails.formId,tableName:"P_TimesheetJobsList",callback:Timetracker.forms.showListView,isEmbed:!0}).formMode="ADD",-1!==Layout.Page.hash.indexOf("/projects/edit")?(addEditJson.recordId=Layout.Page.urlparam.recordId,addEditJson.formMode="EDIT"):-1!==Layout.Page.hash.indexOf("/projects/view")&&(addEditJson.recordId=Layout.Page.urlparam.recordId,addEditJson.formMode="VIEW",addEditJson.editCallback=Timetracker.forms.editFormFromView,addEditJson.disableSingleEdit=!0);else if(-1!==url.indexOf("/projects/jobs"))Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),Timetracker.jobs.fetchJob=!0,(addEditJson={formId:Timetracker.jobs.formDetails.formId,tableName:"P_TimesheetJob",callback:Timetracker.forms.showListView,isEmbed:!0}).formMode="ADD",-1!==Layout.Page.hash.indexOf("/projects/jobs/edit")?(addEditJson.recordId=Layout.Page.urlparam.recordId,addEditJson.formMode="EDIT"):-1!==Layout.Page.hash.indexOf("/projects/jobs/view")&&(addEditJson.recordId=Layout.Page.urlparam.recordId,addEditJson.formMode="VIEW",addEditJson.editCallback=Timetracker.forms.editFormFromView,addEditJson.disableSingleEdit=!0);else if(-1!==url.indexOf("/projects")){var layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container;Timetracker.util.init(),layout.find("#project_filter_div").is(".TEbnd,.TEbnd1")&&Timetracker.util.showHideFilters(layout.find("#projectFilter"),"project_filter_div",""),0===layout.find("#projectlist,#emptPage").length||!Timetracker.projects.projectsPopulated||Timetracker.projects.refreshData?(Timetracker.projects.Listing.loadDefaultProjects(),Timetracker.projects.projectsPopulated=!0,Timetracker.projects.refreshData=!1):(Layout.Page.container.scrollTop(0),ZPeople.FireScroll.reset(Timetracker.projects.FireScroll.getMode()))}null!==addEditJson&&(ZP5Form.isQuickAdd=!1,ZP5Form.formid=0,ZP5Form.load(addEditJson))},loadDefaultProjects:function(){var filterDiv;0!=(0!=(filterDiv=TimetrackerOperations.Filters.getFilterDiv()).find('[compname="projectName"]').length?TimelyZComp.select.getValue(filterDiv.find('[compname="projectName"]')):0)&&""==filterDiv.find('[compname="projectNameInput"]').val()&&TimelyZComp.select.setValue(filterDiv.find('[compname="projectName"]'),0),0!=(0!=(filterDiv=TimetrackerOperations.Filters.getFilterDiv("unassprojectlist_filter_div")).find('[compname="projectName"]').length?TimelyZComp.select.getValue(filterDiv.find('[compname="projectName"]')):0)&&""==filterDiv.find('[compname="projectNameInput"]').val()&&TimelyZComp.select.setValue(filterDiv.find('[compname="projectName"]'),0),Timetracker.projects.Listing.loadProjectsBasedOnView()},getViewType:function(){return null===Timetracker.projects.VIEW_TYPE&&(Timetracker.projects.VIEW_TYPE=Timetracker.constants.USER),Timetracker.projects.VIEW_TYPE!=Timetracker.constants.USER&&Timetracker.Page.isSelectedUser()&&(Timetracker.projects.VIEW_TYPE=Timetracker.constants.USER),Timetracker.projects.VIEW_TYPE},switchView:function(ele){var viewType=$(ele).attr("value");if(viewType!==Timetracker.projects.Listing.getViewType()&&!Timetracker.Page.isSelectedUser()){var divId;$(ele).addClass("zpl_act"),ZPUtil.Validation.isEmpty(viewType)?Timetracker.projects.VIEW_TYPE=Timetracker.constants.USER:Timetracker.projects.VIEW_TYPE=viewType,(viewType=Timetracker.projects.Listing.getViewType())===Timetracker.constants.USER?("project_filter_div",divId="projectlist"):viewType===Timetracker.constants.DIVISION?("unassprojectlist_filter_div",divId="unassprojectlist_division"):viewType===Timetracker.constants.LOCATION?("unassprojectlist_filter_div",divId="unassprojectlist_location"):("unassprojectlist_filter_div",divId="unassprojectlist");var filterDiv,layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container;layout.find("#zp_views_list_container").find("#"+divId).css("display","block").siblings().css("display","none"),TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),0!=(0!=(filterDiv=TimetrackerOperations.Filters.getFilterDiv()).find('[compname="projectName"]').length?TimelyZComp.select.getValue(filterDiv.find('[compname="projectName"]')):0)&&""==filterDiv.find('[compname="projectNameInput"]').val()&&TimelyZComp.select.setValue(filterDiv.find('[compname="projectName"]'),0),TimetrackerOperations.Filters.isFilterOpen("unassprojectlist_filter_div")&&TimetrackerOperations.Filters.toggleFilter("unassprojectlist_filter_div"),0!=(0!=(filterDiv=TimetrackerOperations.Filters.getFilterDiv("unassprojectlist_filter_div")).find('[compname="projectName"]').length?TimelyZComp.select.getValue(filterDiv.find('[compname="projectName"]')):0)&&""==filterDiv.find('[compname="projectNameInput"]').val()&&TimelyZComp.select.setValue(filterDiv.find('[compname="projectName"]'),0),Timetracker.Util.showHideNoData({remove:!0}),layout.find("#zp_views_list_container").children().css("display","none"),Timetracker.projects.Listing.loadProjectsBasedOnView()}},loadProjectsBasedOnView:function(){var layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container,viewType=Timetracker.projects.Listing.getViewType();viewType===Timetracker.constants.DEPARTMENT?(layout.find("li[value=user]").removeClass("zpl_act"),isOrgStructureEnabled&&layout.find("li[value=division]").removeClass("zpl_act"),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&layout.find("li[value=location]").removeClass("zpl_act"),Timetracker.projects.UnAssignedProjects.getProjectList(Timetracker.constants.DEPARTMENT)):viewType===Timetracker.constants.DIVISION?(layout.find("li[value=user]").removeClass("zpl_act"),layout.find("li[value=department]").removeClass("zpl_act"),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&layout.find("li[value=location]").removeClass("zpl_act"),Timetracker.projects.UnAssignedProjects.getProjectList(Timetracker.constants.DIVISION)):viewType===Timetracker.constants.LOCATION?(layout.find("li[value=user]").removeClass("zpl_act"),layout.find("li[value=department]").removeClass("zpl_act"),isOrgStructureEnabled&&layout.find("li[value=division]").removeClass("zpl_act"),Timetracker.projects.UnAssignedProjects.getProjectList(Timetracker.constants.LOCATION)):(Timetracker.projects.VIEW_TYPE=Timetracker.constants.USER,layout.find("li[value=department]").removeClass("zpl_act"),isOrgStructureEnabled&&layout.find("li[value=division]").removeClass("zpl_act"),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&layout.find("li[value=location]").removeClass("zpl_act"),Timetracker.projects.Listing.getProjectList())},getProjectList:function(sorterObj,callAfterStatusChange,reloadFilter){var layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container,projectNameSearch=layout.find("#projectNameSearch").val(),projectNameType=0!=layout.find("#filterDiv").find('[compname="projectName"]').length?TimetrackerOperations.Filters.getSelectFilterValues(layout.find("#filterDiv").find('[compname="projectName"]')):0;if(""===projectNameSearch&&"0"!==projectNameType)return layout.find("#projectNameSearch").addClass("ztextbox__error"),layout.find("#projectNameSearch").parent().find("span").remove(),void layout.find("#projectNameSearch").after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.searchvaluescannotbeempty")+"</span>");0!=layout.find("#projectNameSearch").length&&(layout.find("#projectNameSearch").removeClass("ztextbox__error"),layout.find("#projectNameSearch").siblings().remove()),""!=projectNameSearch&&"0"==projectNameType&&(layout.find("#projectNameSearch").val(""),layout.find("#project_filter_div").data("previousName","0"),layout.find("#project_filter_div").data("previousSearchName",null)),TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),TimetrackerOperations.Filters.isFilterOpen("unassprojectlist_filter_div")&&TimetrackerOperations.Filters.toggleFilter("unassprojectlist_filter_div"),layout.find("#projectlist").hide(),layout.find("#projectlist").parent().find("#tt_filterResultsHeader.timetracker").remove(),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(),Timetracker.projects.FireScroll.resetDataOnLoad(),!0===reloadFilter&&Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE);var params=Timetracker.projects.Listing.getParamsToFetchProject(sorterObj,callAfterStatusChange);void 0!==sorterObj&&null!==sorterObj?(layout.find("[id^='projectSort']").removeClass("desc asc"),layout.find("[id^='projectSort']").attr("title",ZPI18N.getString("zp.sortbyasc")),params.isAscending?($(sorterObj).addClass("asc"),$(sorterObj).attr("title",ZPI18N.getString("zp.sortbydesc"))):($(sorterObj).addClass("desc"),$(sorterObj).attr("title",ZPI18N.getString("zp.sortbyasc")))):(layout.find("[id^='projectSort']").removeClass("desc asc"),params.isAscending?(layout.find("#projectSort"+params.sortType).addClass("asc"),layout.find("#projectSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbydesc"))):(layout.find("#projectSort"+params.sortType).addClass("desc"),layout.find("#projectSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbyasc")))),$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.projects.Listing.groupAccordingToProjects(resultData,!0,"project-listtbody"),Timetracker.util.addProjectCheck(),Timetracker.util.removeLoading(layout),TimelyZComp.toolTip.intiliaze(),Timetracker.FireScroll.resetFirescrollDtls(Timetracker.Page.getPageMode()+"_jobsList_","STARTS_WITH"),0==layout.find("#projectlist").parent().find("#tt_filterResultsHeader.timetracker").length&&(html=TimetrackerOperations.Filters.filterHeaderHtml,layout.find("#projectlist").before(html)),TimetrackerOperations.Filters.setFilterHeader(Timetracker.projects.Listing.removeTopFilter);var filterdiv=layout.find("#tt_filterResultsHeader.timetracker");if(0!=filterdiv.find('[filterno="projectName"]').length){var projSearchName=ZPeople.escapeHtml(layout.find("#projectNameSearch").val());filterdiv.find('[filterno="projectName"]').find("span").removeAttr("title"),filterdiv.find('[filterno="projectName"]').find("span").after('<span onclick="TimetrackerOperations.Filters.openFilterField(this);" title="'+projSearchName+'" class="mxw100">'+projSearchName+"</span>")}})},getParamsToFetchProject:function(sorterObj,callAfterStatusChange){var params=Timetracker.projects.Listing.getDefaultProjectParams();0!=Timetracker.projects.pageLayout.find("#filterDiv").length&&(TimetrackerOperations.Filters.getFilterValues(params),params.searchProjectName=Timetracker.projects.pageLayout.find("#projectNameSearch").hasClass("DNI")?void 0:Timetracker.projects.pageLayout.find("#projectNameSearch").val(),params.searchProjectName&&params.searchProjectName.length>255&&(params.searchProjectName=params.searchProjectName.substring(0,255)));var pageMode=Timetracker.Page.getPageMode();return"ts_team"!=pageMode&&"ts_hometeam"!=pageMode||(params.pageMode=1),callAfterStatusChange&&!0===callAfterStatusChange&&null!==Timetracker.projects.justNowCompletedProject&&(params.latestCompletedProject=Timetracker.projects.justNowCompletedProject),params.sIndex=Timetracker.projects.FireScroll.getProjectFetchCount(),params.limit=Timetracker.projects.MAXPROJECT_FETCH_COUNT,sorterObj&&null!==sorterObj?(Timetracker.projects.sorterObj={},params.sortType=Timetracker.projects.sorterObj.sortType=$(sorterObj).attr("type"),$(sorterObj).hasClass("asc")?params.isAscending=Timetracker.projects.sorterObj.isAscending=!1:params.isAscending=Timetracker.projects.sorterObj.isAscending=!0):null!==Timetracker.projects.sorterObj&&(params.sortType=Timetracker.projects.sorterObj.sortType,params.isAscending=Timetracker.projects.sorterObj.isAscending),params},getDefaultProjectParams:function(){var params={mode:"getTimesheetProjectList",projectStatus:"0",clientId:"0",projectHead:"0",projectManager:"0",proAssignedTo:erecno,isJobCount:!0,conreqcsr:csrfToken,searchProjectKey:"0",searchProjectName:null};Timetracker.Util.getSortAscendingValues(Timetracker.constants.PROJECT,params);var pageMode=Timetracker.Page.getPageMode();return"ts_mydata"==pageMode?params.proAssignedTo=erecno:Timetracker.Page.isSelectedUser(pageMode)?params.proAssignedTo=Timetracker.Team.getSelectedUser():params.proAssignedTo="0",params},setDefaultFilterParams:function(){var filterDivId=void 0,viewType=Timetracker.projects.Listing.getViewType();viewType!=Timetracker.constants.USER&&(filterDivId="unassprojectlist_filter_div"),TimetrackerOperations.Filters.clearFilters(filterDivId);var filterDiv=TimetrackerOperations.Filters.getFilterDiv(filterDivId);if((!filterDiv||0!=filterDiv.length)&&(ZPeopleComponents.select(filterDiv.find('[compname="projectName"]')).setValue(0),filterDiv.find('[compname="projectNameInput"]').val(""),ZPeopleComponents.select(filterDiv.find('[compname="status"]')).setValue(0),viewType==Timetracker.constants.USER)){var pageMode=Timetracker.Page.getPageMode();if("ts_mydata"==pageMode||Timetracker.Page.isSelectedUser(pageMode)){var userDtls="ts_mydata"==pageMode?ZPeople.CURR_USER:ZPeople.getUserDetailsById(Timetracker.Team.getSelectedUser());result={},result.id=userDtls.usererec,result.zuid=userDtls.id,result.text=ZPeople.decodeTxt(userDtls.empid)+" "+ZPeople.decodeTxt(userDtls.name),result.html=userDtls.empid+" "+userDtls.name,result.photo=userDtls.thumb,result.decodedItemText=userDtls.empid+" "+userDtls.name,TimelyZComp.tokenField.addValues(filterDiv.find('[compname="assignedto"]'),[result]),ZPeopleComponents.tokenfield(filterDiv.find('[compname="assignedto"]')).setAttributes({disabled:!0})}}},removeTopFilter:function(event,clearAll){var viewType=Timetracker.projects.Listing.getViewType();if(clearAll)Timetracker.projects.Listing.setDefaultFilterParams();else{var ele=event.target,entity=$(ele).closest("li").attr("filterno"),filterDivId=void 0;viewType!=Timetracker.constants.USER&&(filterDivId="unassprojectlist_filter_div");var filterDiv=TimetrackerOperations.Filters.getFilterDiv(filterDivId);"status"==entity?TimelyZComp.select.setValue(filterDiv.find('[compname="status"]'),0):"projectName"==entity?(TimelyZComp.select.setValue(filterDiv.find('[compname="projectName"]'),0),filterDiv.find('[compname="projectNameInput"]').val("")):TimelyZComp.tokenField.removeAllTokens(filterDiv.find('[compname="'+entity+'"]'))}viewType===Timetracker.constants.USER?Timetracker.projects.Listing.getProjectList():Timetracker.projects.UnAssignedProjects.getProjectList(Timetracker.projects.Listing.getViewType())},groupAccordingToProjects:function(result,jobFlag,tbodyid){jobFlag&&(Timetracker.projects.FireScroll.setProjectFetchCount(result),Timetracker.projects.FireScroll.resetProjectFireScroll(result),Timetracker.projects.Listing.constructProjectViewTable());var layout=null!=Timetracker.projects.pageLayout&&jobFlag?Timetracker.projects.pageLayout:Layout.Page.container;if(layout.find("[bid=project_checkallbox]").prop("checked",!1),jobFlag&&Timetracker.views.multiSelectActions.showHideMultiSelectOper(!1,layout),layout.find("#"+tbodyid).find("[id^='projectTable']").remove(),layout.find("#"+tbodyid).find("[id^='jobList_']").remove(),void 0===result.length||0===result.length){var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.projectDispName]);Timetracker.util.checkAddProjectPermVar&&jobFlag&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.projectDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getProjectDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:jobFlag?"zp_views_list_container":tbodyid})}else Timetracker.projects.Listing.constructProjectListing(result,jobFlag,tbodyid),layout.find("#projectlist").fadeIn(200).scrollTop(0)},constructProjectViewTable:function(){var layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container;if(layout.find("#zp_views_container,.ZPNdata").remove(),0===layout.find("#projectlist").length){var pageCode=Timetracker.Page.getPageModeCode(),projectTable='<div class="zpl_dtbl" id="projectlist" style="display: none;"><ul><li class="mw50"><div class="zcheckbox"><input type="checkbox" class="zcheckbox__helper" id="'+pageCode+'_pcheckallbox" bid="project_checkallbox" ref="checkall"><label class="zcheckbox__label" for="'+pageCode+'_pcheckallbox"></label></div></li><li class="w400"><b class="form_projectname">'+ZPI18N.getString("zp.projectname")+'</b><div class="zpl_icncnt"><i class="PI_sort" id="projectSort0" type="0" ref="sort" title="'+ZPI18N.getString("zp.sortbydesc")+'"></i></div></li><li class="mw50"></li><li class="mw200"><b>'+ZPI18N.getString("zp.estimatedhours")+'</b></li><li class="mw200"><b>'+ZPI18N.getString("zp.loggedhours")+'</b></li><li class="mw150"><b>'+ZPI18N.getString("zp.status")+'</b></li><li class="mw100 zpl_ellipsis" title="'+Timetracker.util.getJobDisplayName()+'">'+Timetracker.util.getJobDisplayName()+'</li><li class="mw100"></li></ul><div id="project-listtbody"></div></div>',listDiv=layout.find("#zp_views_list_container");$(listDiv).children("[id!=unassprojectlist]").remove(),$(listDiv).children("[id!=unassprojectlist_division]").remove();var projectListDiv=$(listDiv).find("#unassprojectlist");isOrgStructureEnabled&&(projectListDiv=$(listDiv).find("#unassprojectlist_division")),0!==projectListDiv.length?($(projectListDiv).css("display","none"),$(listDiv).append(projectTable)):$(listDiv).html(projectTable);var sortType=Timetracker.Validations.isDefiniteValue(Timetracker.generalSettings.userBasedSettings.projectSortType)?Timetracker.generalSettings.userBasedSettings.projectSortType:"0";Timetracker.Validations.isDefiniteValue(Timetracker.generalSettings.userBasedSettings.projectSortOrder)&&(layout.find("[id^='projectSort']").removeClass("desc asc"),"1"===Timetracker.generalSettings.userBasedSettings.projectSortOrder?(layout.find("#projectSort"+sortType).addClass("desc"),layout.find("#projectSort"+sortType).attr("title",ZPI18N.getString("zp.sortbyasc"))):(layout.find("#projectSort"+sortType).addClass("asc"),layout.find("#projectSort"+sortType).attr("title",ZPI18N.getString("zp.sortbydesc")))),Timetracker.util.init()}ZPeople.FireScroll.init(Timetracker.projects.FireScroll.loadMoreProjects,"",{mode:Timetracker.projects.FireScroll.getMode()},!0)},constructProjectListing:function(result,jobFlag,tbodyid){var layout=null!=Timetracker.projects.pageLayout&&jobFlag?Timetracker.projects.pageLayout:Layout.Page.container,tbodyLayout=layout.find("#"+tbodyid);Timetracker.Util.showHideNoData({remove:!0});var pageCode=Timetracker.Page.getPageModeCode();$.each(result,function(index,projdata){projdata.pageCode=pageCode,jobFlag?tbodyLayout.append(Timetracker.projects.Listing.constructProjectRowHtml(projdata)):tbodyLayout.append(Timetracker.projects.Listing.constructProjectRowHtmlForReports(projdata))}),0===layout.find("#project-listtbody").find('input[type="checkbox"]:enabled').length?layout.find("[bid=project_checkallbox]").attr("disabled",!0):layout.find("[bid=project_checkallbox]").attr("disabled",!1),0==layout.find("#project-listtbody").find(".zpl_projecticn").length?layout.find("#projectlist").find("ul li:nth-child(3)").addClass("DNI"):layout.find("#projectlist").find("ul li:nth-child(3)").removeClass("DNI")},constructProjectRowHtml:function(projdata,jobFlag){Timetracker.projects.Util.isEditDeleteAllowed(projdata.projectId,Timetracker.isDataAdminForAllUsers(),projdata.ownerId,projdata.projectHead,projdata.projectManagers,"edit");var isProjectDeleteAllowed=Timetracker.projects.Util.isEditDeleteAllowed(projdata.projectId,Timetracker.isDataAdminForAllUsers(),projdata.ownerId,projdata.projectHead,projdata.projectManagers,"delete"),isSelectAllowed=Timetracker.projects.Util.isEditDeleteAllowed(projdata.projectId,Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit),projdata.ownerId,projdata.projectHead,projdata.projectManagers,"edit"),onclickEve="Timetracker.projects.Listing.showProjectDashboard('"+projdata.projectId+"');",pageCode=projdata.pageCode?projdata.pageCode:Timetracker.Page.getPageModeCode(),jobDisplayName=ZPI18N.getString("zp.tt.addentity",[Timetracker.util.getJobDisplayName(!0)]),row='<ul id= "projectTable'+projdata.projectId+'"><li class="mw50" ref="skip"><div class="zcheckbox"><input type="checkbox" name="check" class="zcheckbox__helper" id="'+pageCode+projdata.projectId+'" recordId="'+projdata.projectId+'" owner="'+projdata.ownerId+'"';if(row+=isSelectAllowed?'ref="checkbox">':'disabled="true">',row+='<label class="zcheckbox__label" for="'+pageCode+projdata.projectId+'"></label></div></li>',row+='<li class="w400 zpl_cp" onclick="'+onclickEve+'" tabindex="0" aria-label="'+ZPI18N.getString("zp.projectname")+":"+projdata.projectName+" "+(projdata.clientName?ZPI18N.getString("zp.clientname")+":"+projdata.clientName:"")+'"><div class="zpl_cstnmes"><span>'+projdata.projectName+"</span>",projdata.clientName&&(row+='<span class="zpl_dots"></span><em>'+projdata.clientName+"</em>"),row+="</div></li>",projdata.zProjectsProjectRefId?row+='<li class="mw50" ref="skip"><a class="zpl_projecticn" ref="ZProject_project" title="Zoho Projects"></a></li>':row+='<li class="mw50"></li>',void 0!==projdata.hours){var mins=projdata.hours%60;row+='<li class="mw200"><span>'+(projdata.hours-mins)/60+" "+ZPI18N.getString("zp.hrs")+" "+mins+" "+ZPI18N.getString("zp.mins")+"</span></li>"}else row+='<li class="mw200"><span>-</span></li>';if(void 0!==projdata.totalhours){mins=projdata.hours%60;row+='<li class="mw200"><span>'+(projdata.hours-mins)/60+" "+ZPI18N.getString("zp.hrs")+" "+mins+" "+ZPI18N.getString("zp.mins")+"</span></li>"}else row+='<li class="mw200"><span>-</span></li>';var compclass="",comptitle=ZPI18N.getString("zp.inprogresschangestatus"),status=ZPI18N.getString("zp.inprogress");return 1===projdata.projectStatus&&(compclass=" grn",comptitle=ZPI18N.getString("zp.completedchangestatus"),status=ZPI18N.getString("zp.completed")),row+='<li class="mw150" ref="skip" aria-label="'+ZPI18N.getString("zp.status")+":"+status+'" tabindex="0"><span class="d-flexC" ref="skip"><i class="PI_tick2_fil zpl_cp '+compclass+'" id="statusTgl_'+projdata.projectId+'" title="'+comptitle+'" ref="changeStatus"></i><span ref="skip" class="CPD '+compclass+'">'+status+"</span></span></li>",0===projdata.jobCount?row+='<li class="mw100" ref="skip" aria-label="'+jobDisplayName+'" tabindex="0"><span class="zpl_icncont" ><a ref="addJobs">'+jobDisplayName+"</a></span></li>":row+='<li class="mw100" ref="skip" aria-label="'+Timetracker.util.getJobDisplayName(!0)+":"+projdata.jobCount+'" tabindex="0"><span class="zpl_icncont zpl_cp"><i class="PI_jobs" title="'+ZPI18N.getString("zp.show")+" "+Timetracker.jobs.formDetails.formDispName+'" ref="showJobs"><sup ref="showJobs">'+projdata.jobCount+'</sup></i><a ref="addJobs" class="DNI">'+jobDisplayName+"</a></span></li>",row+='<li class="mw100" ref="skip"><i class="PI_cls zpl_cp DNI" title="'+ZPI18N.getString("zp.close")+'" ref="closeJobs"></i>',isProjectDeleteAllowed&&(row+='<div class="zpl_hvr" name="delete"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" ref="edit"></i><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" ref="delete"></i></div>'),row+="</li></ul>",(row=$(row)).data("projdata",projdata),row},constructProjectRowHtmlForReports:function(projdata){var row='<ul id= "projectTable'+projdata.projectId+'">';if(row+='<li class="w400"><div class="zpl_cstnmes"><span>'+projdata.projectName+"</span>"+(projdata.clientName?'<span class="zpl_dots"></span><em>'+projdata.clientName+"</em>":"")+"</div></li>",row+='<li class="mw50">'+(projdata.zProjectsProjectRefId?'<a class="zpl_projecticn" onclick="Timetracker.projects.Listing.showZProjects(\''+projdata.zProjectsPortalId+"', '"+projdata.zProjectsProjectRefId+'\');" title="'+ZPI18N.getString("zp.tyex.projects")+'"></a>':"")+"</li>",void 0!==projdata.hours){var mins=projdata.hours%60;row+='<li class="mw200"><span>'+(projdata.hours-mins)/60+" "+ZPI18N.getString("zp.hrs")+" "+mins+" "+ZPI18N.getString("zp.mins")+"</span></li>"}else row+='<li class="mw200"><span>-</span></li>';if(void 0!==projdata.totalhours){mins=projdata.hours%60;row+='<li class="mw200"><span>'+(projdata.hours-mins)/60+" "+ZPI18N.getString("zp.hrs")+" "+mins+" "+ZPI18N.getString("zp.mins")+"</span></li>"}else row+='<li class="mw200"><span>-</span></li>';var compclass="",status=ZPI18N.getString("zp.inprogress");return 1===projdata.projectStatus&&(compclass=" grn",status=ZPI18N.getString("zp.completed")),row+='<li class="mw150"><span class="d-flexC" ref="skip"><i class="PI_tick2_fil '+compclass+'" id="statusTgl_'+projdata.projectId+'"></i><span ref="skip" class="CPD '+compclass+'">'+status+"</span></span></li>",0==projdata.jobCount?row+='<li class="mw100"><span class="zpl_icncont"><i class="PI_jobs"><sup>'+projdata.jobCount+"</sup></i></span></li>":row+='<li class="mw100"><span class="zpl_icncont"><i class="PI_jobs zpl_cp" title="'+ZPI18N.getString("zp.show")+" "+Timetracker.jobs.formDetails.formDispName+'" onclick="Timetracker.projects.Listing.showJobsForProject(this, false, \'repClient-jobTbody\');"><sup>'+projdata.jobCount+"</sup></i></span></li>",row+="</ul>",(row=$(row)).data("projdata",projdata),row},showProjectDashboard:function(projectId){Timetracker.projectDashboard.getProjectDtls(projectId).then(function(data){if(Timetracker.projectDashboard.projectDtls&&Timetracker.projectDashboard.projectDtls.isViewAllowed){var replaceStr=settingsUrlProps.niceUrl.startsWith("operations/timetracker/projects/")?"projects/projectdashboard/feeds":"projectdashboard/feeds",niceUrl=settingsUrlProps.niceUrl.replace("projects/listview",replaceStr)+"-id:"+projectId;Timetracker.Page.isSelectedUser()&&(niceUrl+="/userId:"+Timetracker.Team.getSelectedUser()),window.location.href="#"+niceUrl}else Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttpermdenied"))})},showZProjects:function(portalId,zProjectsProjectRefId){var portalName;if(Timetracker.jobs.ZProjectsPortals&&Timetracker.jobs.ZProjectsPortals[portalId]&&(portalName=Timetracker.jobs.ZProjectsPortals[portalId]),portalName){var url=projects_url+"/portal/"+portalName+"#dashboard/"+zProjectsProjectRefId;window.open(url)}else{var params={mode:"getZohoProjectDetails",zProjectsPortalId:portalId};ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){if(resultData.res){var response=resultData.resObj;if(response.portalUrl){Timetracker.jobs.ZProjectsPortals[portalId]=response.portalUrl,portalName=Timetracker.jobs.ZProjectsPortals[portalId];var url=projects_url+"/portal/"+portalName+"#dashboard/"+zProjectsProjectRefId;window.open(url)}else Timetracker.util.showAlert(0,ZPI18N.getString("zp.prjctsync.projectnotfound"))}else{var errorMsg=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg)}})}},showJobsForProject:function(obj,jobFlag,tbodyid){var parentTag=$(obj).closest("ul"),projectData=$(parentTag).data().projdata,result=$(parentTag).data().jobsData,layout=null!=Timetracker.projects.pageLayout&&jobFlag?Timetracker.projects.pageLayout:Layout.Page.container,isClientsummary="repClient-jobTbody"==tbodyid;if(void 0!==result&&null!==result)"showJobs"===$(obj).attr("ref")?(layout.find("#jobList_"+projectData.projectId).removeClass("DNI"),!jobFlag&&$(obj).attr("ref",""),$(parentTag).find("[ref='showJobs']").addClass("DNI"),$(parentTag).find("[ref='addJobs']").removeClass("DNI"),$(parentTag).find("[ref='closeJobs']").removeClass("DNI"),$(parentTag).find("[name='delete']").addClass("DNI")):(layout.find("#jobList_"+projectData.projectId).addClass("DNI"),$(parentTag).find("[ref='showJobs']").removeClass("DNI"),$(parentTag).find("[ref='addJobs']").addClass("DNI"),$(parentTag).find("[ref='closeJobs']").addClass("DNI"),$(parentTag).find("[name='delete']").removeClass("DNI"),!jobFlag&&$(obj).attr("ref","showJobs"));else{if($(parentTag).data().isJobsLoaded)return;$(parentTag).data("isJobsLoaded",!0);let mode=Timetracker.Page.getPageMode()+"_jobsList_"+projectData.projectId;!isClientsummary&&Timetracker.FireScroll.resetDataOnLoad(mode);var params={mode:"getSchedule",projectId:projectData.projectId,assignedTo:"0",fetchLoggedHrs:!0,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,sIndex:0,conreqcsr:csrfToken};isClientsummary&&(delete params.sIndex,delete params.limit),$.post(Timetracker.constants.URL,params,function(result){if(null!=result&&result.schArr&&0!==result.schArr.length&&(Timetracker.projects.Listing.constructProjectJobs(result.schArr,jobFlag,tbodyid,projectData.projectId),!isClientsummary)){let otherDtls={scrollDiv:layout.find("#jobList_"+projectData.projectId)};Timetracker.FireScroll.initFireScroll(mode,Timetracker.constants.URL,params,Timetracker.projects.Listing.loadMoreJobsList,"",otherDtls),Timetracker.FireScroll.setFetchCount(mode,result.schArr)}})}},constructProjectJobs:function(result,jobFlag,tbodyid,projectId){var layout=null!=Timetracker.projects.pageLayout&&jobFlag?Timetracker.projects.pageLayout:settingsPage.container,parentTag=layout.find("#"+tbodyid).find("#projectTable"+projectId),jobsDiv=layout.find("#"+tbodyid).find("#jobList_"+projectId);0===jobsDiv.length?(row='<div class="zpl_dtblsub" id="jobList_'+projectId+'"></div>',$(parentTag).after(row),jobsDiv=layout.find("#"+tbodyid).find("#jobList_"+projectId),$(parentTag).find("[ref='showJobs']").addClass("DNI"),$(parentTag).find("[ref='addJobs']").removeClass("DNI"),$(parentTag).find("[ref='closeJobs']").removeClass("DNI"),$(parentTag).find("[name='delete']").addClass("DNI"),parentTag.data("jobsData",result)):parentTag.data().jobsData.push(...result),$.each(result,function(index,data){if(row='<ul ref="projectJob" id="mytable'+data.jobId+'">',jobFlag&&(row+='<li class="w50" ref="skip"></li>'),row+='<li class="flex-grow w400'+(jobFlag?" zpl_cp":"")+'" title="'+(jobFlag?ZPI18N.getString("zp.clicktoviewjob"):"")+'"><div class="d-flexclmcap5"><a '+(jobFlag?"":'class="CPD"')+">"+data.jobName+"</a>",jobFlag&&1!==data.jobStatus&&void 0!==data.toDate){var todaysDate=new Date,toDate=Calendar.parseDate(data.toDate,uidateFormat);if(todaysDate>toDate){var diff=Math.floor((todaysDate-toDate)/864e5);row+='<em class="red">',0!==Number(diff)?row+=ZPI18N.getString("zp.joboverdue",[diff]):row+=ZPI18N.getString("zp.todayenddate"),row+="</em>"}}if(row+='</div></li><li class="w50" ref="skip"></li>',void 0!==data.hours){var mins=data.hours%60,hrs=(data.hours-mins)/60;row+='<li class="w200" ref="skip"><span ref="skip">'+hrs+" "+ZPI18N.getString("zp.hrs")+" "+mins+" "+ZPI18N.getString("zp.mins")+"</span></li>"}else row+='<li class="w200" ref="skip"><span ref="skip">-</span></li>';var totalmins,totalhrs;data.totalhours||(data.totalhours=0),totalmins=data.totalhours%60,totalhrs=(data.totalhours-totalmins)/60,row+='<li class="w200" ref="skip"><span ref="skip">'+totalhrs+" "+ZPI18N.getString("zp.hrs")+" "+totalmins+" "+ZPI18N.getString("zp.mins")+"</span></li>";var statustitle=ZPI18N.getString("zp.inprogresschangestatus"),status=ZPI18N.getString("zp.inprogress"),color="";1===data.jobStatus&&(statustitle=ZPI18N.getString("zp.completedchangestatus"),status=ZPI18N.getString("zp.completed"),color="grn"),statustitle=jobFlag?statustitle:"",row+='<li class="w150" ref="skip"><span class="d-flexC" ref="skip"><i id="jobStatusTgl_'+data.jobId+'" ref="changeJobStatus" class="PI_tick2_fil '+color+(jobFlag?" zpl_cp":"")+'" title="'+statustitle+'"></i><span ref="skip" class="CPD '+color+'">'+status+"</span></span></li>",jobFlag&&(row+='<li class="w100" ref="skip"></li>'),row+='<li class="w100" ref="skip"></li></ul>',row=$(row),row.data("schval",data),jobsDiv.append(row)})},loadMoreJobsList:function(result,params,otherDtls){null!=result&&result.schArr&&0!==result.schArr.length?(Timetracker.projects.Listing.constructProjectJobs(result.schArr,!0,"project-listtbody",params.projectId),Timetracker.FireScroll.setFetchCount(Timetracker.Page.getPageMode()+"_jobsList_"+params.projectId,result.schArr)):Timetracker.FireScroll.setFetchCount(Timetracker.Page.getPageMode()+"_jobsList_"+params.projectId,[])}},UnAssignedProjects:{getDefaultProjectParams:function(){var viewType=Timetracker.projects.Listing.getViewType(),params={projectStatus:"0",clientId:"0",conreqcsr:csrfToken};return viewType===Timetracker.constants.DEPARTMENT?params.mode="getDeptProjects":viewType===Timetracker.constants.DIVISION?params.mode="getDivisionProjects":viewType===Timetracker.constants.LOCATION&&(params.mode="getLocationProjects"),params},getParamsToFetchProject:function(){var params=Timetracker.projects.UnAssignedProjects.getDefaultProjectParams();return params.sIndex=Timetracker.projects.FireScroll.getProjectFetchCount(),0!==(null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container).find("#unassprojectlist_filter_div").length&&TimetrackerOperations.Filters.getFilterValues(params,"unassprojectlist_filter_div"),params},getProjectList:function(entity){var layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container;if(0!=layout.find("#unassProjectNameSearch").length&&""===layout.find("#unassProjectNameSearch").val()&&"0"!==layout.find("#unassProjectName").val())return layout.find("#unassProjectNameSearch").addClass("ztextbox__error"),layout.find("#unassProjectNameSearch").parent().find("span").remove(),void layout.find("#unassProjectNameSearch").after('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.searchvaluescannotbeempty")+"</span>");0!=layout.find("#unassProjectNameSearch").length&&(layout.find("#unassProjectNameSearch").removeClass("ztextbox__error"),layout.find("#unassProjectNameSearch").siblings().remove()),""!=layout.find("#unassProjectNameSearch").val()&&"0"==layout.find("#unassProjectName").val()&&(layout.find("#unassProjectNameSearch").val(""),layout.find("#unassprojectlist_filter_div").data("previousName","0"),layout.find("#unassprojectlist_filter_div").data("previousSearchName",null)),TimetrackerOperations.Filters.isFilterOpen("unassprojectlist_filter_div")&&TimetrackerOperations.Filters.toggleFilter("unassprojectlist_filter_div"),layout.find("#tt_filterResultsHeader.timetracker").addClass("zpl_DNI"),Timetracker.Util.showHideNoData({remove:!0}),(entity=Timetracker.projects.Listing.getViewType())==Timetracker.constants.DEPARTMENT?layout.find("#unassprojectlist").hide():entity==Timetracker.constants.DIVISION?layout.find("#unassprojectlist_division").hide():entity==Timetracker.constants.LOCATION&&layout.find("#unassprojectlist_location").hide(),Timetracker.util.appendLoading(),Timetracker.projects.FireScroll.resetDataOnLoad();var params=Timetracker.projects.UnAssignedProjects.getParamsToFetchProject();$.post(Timetracker.constants.URL,params,function(result){Timetracker.projects.UnAssignedProjects.constructProjectListing(result),Timetracker.util.removeLoading(layout),TimelyZComp.toolTip.intiliaze(),0==layout.find("#projectlist").parent().find("#tt_filterResultsHeader.timetracker").length&&(html=TimetrackerOperations.Filters.filterHeaderHtml,layout.find("#projectlist").before(html)),TimetrackerOperations.Filters.setFilterHeader(Timetracker.projects.Listing.removeTopFilter,"unassprojectlist_filter_div");var filterdiv=layout.find("#tt_filterResultsHeader.timetracker");if(0!=filterdiv.find('[filterno="projectName"]').length){var projSearchName=ZPeople.escapeHtml(layout.find("#unassProjectNameSearch").val());filterdiv.find('[filterno="projectName"]').find("span").removeAttr("title"),filterdiv.find('[filterno="projectName"]').find("span").after('<span onclick="TimetrackerOperations.Filters.openFilterField(this,  \'unassprojectlist_filter_div\');" title="'+projSearchName+'" class="mxw100">'+projSearchName+"</span>")}})},constructProjectListing:function(result){var viewType=Timetracker.projects.Listing.getViewType();Timetracker.projects.FireScroll.setProjectFetchCount(result),Timetracker.projects.FireScroll.resetProjectFireScroll(result),Timetracker.projects.UnAssignedProjects.constructProjectViewTable();var prjDivId="unassprojectlist";viewType===Timetracker.constants.DIVISION?prjDivId="unassprojectlist_division":viewType===Timetracker.constants.LOCATION&&(prjDivId="unassprojectlist_location");var prjTableId="unassprojectlist-listtbody";viewType===Timetracker.constants.DIVISION?prjTableId="unassprojectlist-division-listtbody":viewType===Timetracker.constants.LOCATION&&(prjTableId="unassprojectlist-location-listtbody");var layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container;if(layout.find("#unassprojectlist,#zp_empty_data").hide(),Timetracker.Util.showHideNoData({remove:!0}),viewType===Timetracker.constants.DIVISION?layout.find("#unassprojectlist_division,#zp_empty_data").hide():viewType===Timetracker.constants.LOCATION&&layout.find("#unassprojectlist_location,#zp_empty_data").hide(),0===result.length||""===result){var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.projectDispName]);Timetracker.util.checkAddProjectPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.projectDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getProjectDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:"zp_views_list_container",layout:layout})}else layout.find("#"+prjTableId).find("tr").remove(),Timetracker.projects.UnAssignedProjects.constructProjectsHtml(result),layout.find("#"+prjDivId).fadeIn(200).scrollTop(0)},constructProjectViewTable:function(){var viewType=Timetracker.projects.Listing.getViewType(),prjDivId="unassprojectlist",header=ZPI18N.getString("zp.departments"),prjTableId="unassprojectlist-listtbody";viewType===Timetracker.constants.DIVISION?(prjDivId="unassprojectlist_division",header=ZPI18N.getString("zp.divisionname"),ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(header=ZPeople.orgStructureDispNameMap.division)):viewType===Timetracker.constants.LOCATION&&(prjDivId="unassprojectlist_location",header=ZPI18N.getString("zp.location")),viewType===Timetracker.constants.DIVISION?prjTableId="unassprojectlist-division-listtbody":viewType===Timetracker.constants.LOCATION&&(prjTableId="unassprojectlist-location-listtbody");var layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container;if(layout.find("#zp_views_container").remove(),Timetracker.Util.showHideNoData({remove:!0}),0===layout.find("#"+prjDivId).length){var projectTable='<div id="'+prjDivId+'"><table class="zpl_tbl zpl_nocrsor" role="grid"><thead><tr><th style="width: 40%;" scope="col"><b class="form_projectname">'+ZPI18N.getString("zp.projectname")+'</b></th><th scope="col"><b>'+header+"</b></th>"+(Timetracker.isDataAdminForAllUsers()?'<th width="150"></th>':"")+'</tr></thead><tbody id="'+prjTableId+'"></tbody></table></div>',listDiv=layout.find("#zp_views_list_container");$(listDiv).children("[id!=projectlist]").remove();var projectListDiv=$(listDiv).find("#projectlist");0!==projectListDiv.length?($(projectListDiv).css("display","none"),$(listDiv).append(projectTable)):$(listDiv).html(projectTable),Timetracker.util.init()}ZPeople.FireScroll.init(Timetracker.projects.FireScroll.loadMoreProjects,"",{mode:Timetracker.projects.FireScroll.getMode()},!0)},constructProjectsHtml:function(result){var layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container,prjTableId="unassprojectlist-listtbody",viewType=Timetracker.projects.Listing.getViewType();viewType===Timetracker.constants.DIVISION?prjTableId="unassprojectlist-division-listtbody":viewType===Timetracker.constants.LOCATION&&(prjTableId="unassprojectlist-location-listtbody");var tbodyLayout=layout.find("#"+prjTableId);$.each(result,function(index,data){var clkEve=Timetracker.isDataAdminForAllUsers()?"Timetracker.projects.Listing.showProjectDashboard('"+data.projectId+"');":"",cpCls=Timetracker.isDataAdminForAllUsers()?"zpl_cp":"",row='<tr id="unassmytable'+data.projectId+'"><td class="flex-grow '+cpCls+'" onclick="'+clkEve+'" scope="row" tabindex="0"><div class="zpl_cstnmes"><span>'+data.projectName+"</span>";data.clientName&&(row+='<span class="zpl_dots"></span><em>'+data.clientName+"</em>"),row+='</div></td><td><div class="zpl_tglist">';var optArr=[];if(viewType===Timetracker.constants.DEPARTMENT&&data.deptNames&&(optArr=data.deptNames.split(", ")),viewType===Timetracker.constants.DIVISION&&isOrgStructureEnabled&&data.divisionNames&&(optArr=data.divisionNames.split(", ")),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&viewType===Timetracker.constants.LOCATION&&data.locationNames&&(optArr=data.locationNames.split(", ")),optArr.length>0){var i=0;data.optArr=optArr,$.each(optArr,function(ind,name){if(!(i<3))return row+='<div class="zpl_tg zpl_cp"><span id="moreOptions_'+data.projectId+'_Btn" ref="optionsList">+'+(Object.keys(optArr).length-3)+"</span></div>",!1;row+='<div class="zpl_tg"><span title="'+name+'">'+name+"</span></div>",i++})}row+="</div></td>",Timetracker.isDataAdminForAllUsers()&&(row+='<td ref="skip"><div class="zpl_hvr" name="delete"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" ref="edit"></i><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" ref="delete"></i></div></td>'),row+="</tr>",(row=$(row)).data("projdata",data),tbodyLayout.append(row)})},constructFilter:function(){0==(null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container).find("#unassprojectlist_filter_div").length&&(filterOpt={projectName:{single:!0,label:Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME,id:"unassProjectName",paramId:"searchProjectKey",defValue:0},projectNameInput:{type:"input",id:"unassProjectNameSearch",className:"ztextbox zpl_DNI",paramId:"searchProjectName",showHeader:!1},client:{single:!1,label:Timetracker.util.getClientDisplayName(),paramId:"clientId",tokenField:!0},projectHead:{single:!1,searchmode:"SETTINGS",label:ZPI18N.getString("zp.projecthead"),id:"unass_projecthead_filter",paramId:"projectHead",tokenField:!0},projectManager:{single:!1,searchmode:"SETTINGS",label:ZPI18N.getString("zp.projectmanager"),id:"unass_projectmanager_filter",paramId:"projectManager",tokenField:!0},status:{single:!0,label:ZPI18N.getString("zp.status"),paramId:"projectStatus",defValue:0}},TimetrackerOperations.Filters.constructFilterDiv(filterOpt,{id:"unassprojectlist_filter_div"})),TimetrackerOperations.Filters.toggleFilter("unassprojectlist_filter_div")}},FireScroll:{getMode:function(){var viewType=Timetracker.projects.Listing.getViewType();return Timetracker.Page.getPageMode()+"_projects_"+viewType},setProjectFetchCount:function(result){var mode=Timetracker.projects.FireScroll.getMode();Timetracker.projects.FETCHED_PROJECT_COUNT[mode]=ZPUtil.Validation.isNumber(Timetracker.projects.FETCHED_PROJECT_COUNT[mode])?Timetracker.projects.FETCHED_PROJECT_COUNT[mode]:0,Timetracker.projects.FETCHED_PROJECT_COUNT[mode]+=result.length},resetProjectFetchCount:function(){var mode=Timetracker.projects.FireScroll.getMode();Timetracker.projects.FETCHED_PROJECT_COUNT[mode]=0},getProjectFetchCount:function(){var mode=Timetracker.projects.FireScroll.getMode();return Timetracker.projects.FETCHED_PROJECT_COUNT[mode]=ZPUtil.Validation.isNumber(Timetracker.projects.FETCHED_PROJECT_COUNT[mode])?Timetracker.projects.FETCHED_PROJECT_COUNT[mode]:0,0===Timetracker.projects.FETCHED_PROJECT_COUNT[mode]?Timetracker.projects.FETCHED_PROJECT_COUNT[mode]:Timetracker.projects.FETCHED_PROJECT_COUNT[mode]+1},adjustProjectsFetchCount:function(count){var mode=Timetracker.projects.FireScroll.getMode();Timetracker.projects.FETCHED_PROJECT_COUNT[mode]=Timetracker.projects.FETCHED_PROJECT_COUNT[mode]-count},resetProjectFireScroll:function(result,limit){var mode=Timetracker.projects.FireScroll.getMode();result.length===Timetracker.projects.MAXPROJECT_FETCH_COUNT||result.length===limit?ZPeople.FireScroll.reset(mode):result.length<Timetracker.projects.MAXPROJECT_FETCH_COUNT&&ZPeople.FireScroll.setParam("triggered",!0,mode)},resetDataOnLoad:function(){var mode=Timetracker.projects.FireScroll.getMode();Timetracker.projects.FireScroll.resetProjectFetchCount(),ZPeople.FireScroll.reset(mode)},loadMoreProjects:function(limit){var params,viewType=Timetracker.projects.Listing.getViewType();params=viewType===Timetracker.constants.DEPARTMENT||viewType===Timetracker.constants.DIVISION||viewType===Timetracker.constants.LOCATION?Timetracker.projects.UnAssignedProjects.getParamsToFetchProject():Timetracker.projects.Listing.getParamsToFetchProject(),limit&&limit<=Timetracker.projects.MAXPROJECT_FETCH_COUNT&&(params.limit=limit),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.projects.FireScroll.constructProjectsOnFireScrollTrigger)},constructProjectsOnFireScrollTrigger:function(result,params){var viewType=Timetracker.projects.Listing.getViewType();if(0!==result.length)viewType===Timetracker.constants.DEPARTMENT||viewType===Timetracker.constants.DIVISION||viewType===Timetracker.constants.LOCATION?Timetracker.projects.UnAssignedProjects.constructProjectsHtml(result):Timetracker.projects.Listing.constructProjectListing(result,!0,"project-listtbody"),Timetracker.projects.FireScroll.setProjectFetchCount(result),Timetracker.projects.FireScroll.resetProjectFireScroll(result,params.limit);else{var protBodyId;protBodyId=viewType===Timetracker.constants.DEPARTMENT?"unassprojectlist":viewType===Timetracker.constants.DEPARTMENT?"unassprojectlist_division":viewType===Timetracker.constants.LOCATION?"unassprojectlist_location":"projectlist";var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.projectDispName]);Timetracker.util.checkAddProjectPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.projectDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getProjectDisplayName(!0)])])),viewType==Timetracker.constants.USER?1==settingsPage.container.find("#"+protBodyId).find("ul").children().length&&(settingsPage.container.find("#"+protBodyId).hide(),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:"zp_views_list_container"})):0==settingsPage.container.find("#"+protBodyId).find("table>tbody").children().length&&(settingsPage.container.find("#"+protBodyId).hide(),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:"zp_views_list_container"}))}}},Operations:{changeProjectStatus:function(currObj,projectId,presentStatus){var data=$(currObj).closest("ul").data().projdata,isEditAllowed=Timetracker.projects.Util.isEditDeleteAllowed(data.projectId,Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit),data.ownerId,data.projectHead,data.projectManagers,"edit");if(isEditAllowed||(isEditAllowed=void 0===data.permissionToChangeStatus||void 0!==data.permissionToChangeStatus&&"0"!==data.permissionToChangeStatus),!isEditAllowed)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.permdeniedtoedit"),!0),!1;var projObj={};if(projObj.projectId=projectId,projObj.presentStatus=presentStatus,projObj.currObj=currObj,projObj.projData=data,void 0!=presentStatus&&"0"==presentStatus&&"0"!=data.jobCount){var extraDtls={body:ZPI18N.getString("zp.changeprojectstatusconfirmation")};Timetracker.Util.confirmpopUp(projObj,Timetracker.projects.Operations.changeProjectStatusCallback,projObj,1,extraDtls)}else Timetracker.projects.Operations.changeProjectStatusCallback(projObj)},changeProjectStatusCallback:function(projObj){var params={mode:"changeTimesheetProjectStatus",projectId:projObj.projectId,status:"1"==projObj.presentStatus?0:1,conreqcsr:csrfToken};$.post("/timesheet.zp",params,function(result){var projdata=projObj.projData;if(null===result||result.error){var message=ZPI18N.getString("zp.permdeniedtoedit");message="associatedJobsNotCompleted"===result.error?ZPI18N.getString("zp.associatedjobsnotcompleted"):message,projdata.permissionToChangeStatus="0",Timetracker.util.showAlert(1,message),$(projObj.currObj).closest("ul").data("projdata",projdata)}else{Timetracker.util.showAlert(2,ZPI18N.getString("zp.statuschanged")),Timetracker.forms.refreshLookupOptions("projects"),Timetracker.jobs.Util.updateCache(result.projectId,result.isCompleted,"projectStatus","project");var index=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.projects.currProjectData,projObj.projectId,"projectId");-1!=index&&(Timetracker.projects.currProjectData[index].projectStatus=result.isCompleted);var statusObj=$(projObj.currObj).closest("li");"0"==result.isCompleted?(statusObj.find("i").removeClass("grn").attr("title",ZPI18N.getString("zp.inprogresschangestatus")),statusObj.find("i").siblings("span:first").removeClass("grn").html(ZPI18N.getString("zp.inprogress"))):(statusObj.find("i").addClass("grn").attr("title",ZPI18N.getString("zp.completedchangestatus")),statusObj.find("i").siblings("span:first").addClass("grn").html(ZPI18N.getString("zp.completed")));var layout=settingsPage.container;$(projObj.currObj).closest("ul").data().projdata.projectStatus=result.isCompleted;var jobList=layout.find("#jobList_"+projObj.projectId);"1"==result.isCompleted&&void 0!=jobList&&0!=jobList.length&&(jobList.hasClass("DN")||layout.find("#projectTable"+projObj.projectId).find("[ref='closeJobs']").trigger("click"),jobList.remove(),layout.find("#projectTable"+projObj.projectId).data().isJobsLoaded=!1,layout.find("#projectTable"+projObj.projectId).data().jobsData=null)}$(projObj.currObj).data().isprocessing=!1})},checkAll:function(obj){if($(obj).is(":checked")){var prevCoutn=Layout.Page.container.find("#project-listtbody").siblings("table").find("input[type='checkbox']:checked").length;Layout.Page.container.find("#project-listtbody").siblings("table").find("input[type='checkbox']:not(:checked)").each(function(index){if(prevCoutn>199)return!1;$(this).attr("disabled")||(prevCoutn+=1,$(this).prop("checked",!0))})}else{Layout.Page.container.find("#project-listtbody").siblings("table").find("input[type='checkbox']:checked").each(function(){$(this).prop("checked",!1)})}Timetracker.views.multiSelectActions.showHideMultiSelectOper($(obj).is(":checked"))},checkParticularProject:function(obj){var layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container;if($(obj).is(":checked")){if((projectsSelected=layout.find("[id^='projectTable']").find("input[type='checkbox']:checked")).length>200)return $(obj).prop("checked",!1),void Timetracker.util.showAlert(1,ZPI18N.getString("zp.cantselectmorethan200",[Timetracker.projects.formDetails.formDispName]));projectsSelected.length!==layout.find("[id^='projectTable']").length&&200!=projectsSelected.length||layout.find("[bid=project_checkallbox]").prop("checked",!0),Timetracker.views.multiSelectActions.showHideMultiSelectOper(!0,layout)}else{var projectsSelected;layout.find("[bid=project_checkallbox]").prop("checked",!1),(projectsSelected=layout.find("[id^='projectTable']").find("input[type='checkbox']:checked")).length<1&&Timetracker.views.multiSelectActions.showHideMultiSelectOper(!1,layout)}},showDelete:function(mode,projectId,owner,projectHead,projectManagerArray){if("multiple"===mode)Timetracker.projects.Operations.multiSelectDelete();else{if(!Timetracker.projects.Util.isEditDeleteAllowed(projectId,Timetracker.isDataAdminForAllUsers(),owner,projectHead,projectManagerArray,"delete"))return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.notallowedtodeletethisproject",[Timetracker.util.getProjectDisplayName(!0,!0)]));Timetracker.projects.Operations.deleteProject(projectId,Timetracker.projects.Operations.projectDeleteCallback)}},showOpDelete:function(projectId){Timetracker.projects.Operations.deleteProject(projectId,Timetracker.projects.Operations.projectDeleteCallback)},multiSelectDelete:function(){var layout=void 0!==Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container,projects=layout.find("#project-listtbody").children("ul").find("input[type='checkbox']:checked");if(projects.length<=0)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.nojobsprojectstodelete",[Timetracker.util.projectDispName])),layout.find("[bid=project_checkallbox]").prop("checked",!1),Timetracker.views.multiSelectActions.showHideMultiSelectOper(!1),!1;for(var tempids="",i=0;i<projects.length;i++){var projectHead,owner=$(projects[i]).attr("owner"),projectManagerArray=[],projectId=$(projects[i]).attr("recordid"),projectRow=$("#projectTable"+projectId);if(projectRow.length>0){var projectData=projectRow.data("projdata");projectHead=projectData&&projectData.projectHead?projectData.projectHead:projectHead,projectManagerArray=projectData&&projectData.projectManagers?projectData.projectManagers:projectManagerArray}Timetracker.projects.Util.isEditDeleteAllowed(projectId,Timetracker.isDataAdminForAllUsers(),owner,projectHead,projectManagerArray,"delete")&&(tempids+=projectId,i!==projects.length-1&&(tempids+=","))}tempids?Timetracker.projects.Operations.deleteProject(tempids,Timetracker.projects.Operations.projectDeleteCallback):Timetracker.util.showAlert(1,ZPI18N.getString("zp.notallowedtodeletethisproject",[Timetracker.util.projectDispName]))},findJSONArrayIndex:function(dataArray,keyValue,keyName){var index=-1;if(dataArray&&keyValue&&keyName)for(var i in dataArray)if(dataArray[i][keyName]===keyValue){index=i;break}return index},deleteProject:function(projectId,callback,isCustomView,curViewObj){var params={mode:"deleteTimesheetProject",projectId:projectId,conreqcsr:csrfToken};$.post("/timesheet.zp",params,function(resultData){if(Timetracker.projects.Members.setRefreshValue(!0),resultData&&resultData.res){let resObj=resultData.resObj,projectIds=resObj.deletedProjects,givenProjects=projectId.split(",");var projStr=givenProjects.length>1?Timetracker.util.getProjectDisplayName():Timetracker.util.getProjectDisplayName(!0),layout=null!=Timetracker.projects.pageLayout?Timetracker.projects.pageLayout:Layout.Page.container;if(projectIds){if(Timetracker.util.showAlert(2,ZPI18N.getString("zp.deleted.successfully.msg",[projStr])),isCustomView&&void 0!=curViewObj)return void curViewObj.reloadView(!0,!0);var viewType=Timetracker.projects.Listing.getViewType(),id="projectlist",listId="project-listtbody";viewType===Timetracker.constants.DIVISION?(id="projectlist_division",listId="unassprojectlist_division"):viewType===Timetracker.constants.LOCATION?(id="projectlist_location",listId="unassprojectlist_location"):viewType===Timetracker.constants.DEPARTMENT&&(listId="unassprojectlist-listtbody");var tableId="projectTable";for(var i in viewType!==Timetracker.constants.DEPARTMENT&&viewType!==Timetracker.constants.DIVISION&&viewType!==Timetracker.constants.LOCATION||(id="unass"+id,tableId="unassmytable"),projectIds)layout.find("#"+tableId+projectIds[i]).remove(),layout.find("#jobList_"+projectIds[i]).remove(),Timetracker.jobs.Util.clearCache(projectIds[i],"project",!0);if(Timetracker.projects.FireScroll.adjustProjectsFetchCount(projectIds.length),ZPeople.FireScroll.getFireScrollPropertie(Timetracker.projects.FireScroll.getMode()).triggered){if(0===layout.find("#"+listId).children().length){layout.find("#"+listId).parent().closest("div").hide();var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.projectDispName]);Timetracker.util.checkAddProjectPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.projectDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getProjectDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:"zp_views_list_container"})}}else Timetracker.projects.FireScroll.loadMoreProjects(projectIds.length);0===layout.find("#"+listId).find('input[type="checkbox"]:enabled').length?layout.find("[bid=project_checkallbox]").attr("disabled",!0):layout.find("[bid=project_checkallbox]").attr("disabled",!1),void 0!==callback&&"function"==typeof callback&&(!0===isCustomView?callback(!0,Layout.Page.urlparam.viewId):callback())}else{let msg=ZPI18N.getString("zp.ttfailuremsg");1===givenProjects.length&&resObj.permissionDeniedProjects&&(msg=ZPI18N.getString("zp.notallowedtodeletethisproject",[Timetracker.util.projectDispName])),Timetracker.util.showAlert(0,msg)}layout.find("#zp_view_close_selection").trigger("click")}})},projectDeleteCallback:function(){Timetracker.forms.refreshLookupOptions("projects")},formAddEditView:function(formId,projectId,isViewProject){var addEditJson=null;if(Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),Timetracker.projects.fetchProject=!0,addEditJson={formId:Timetracker.projects.formDetails.formId,tableName:"P_TimesheetJobsList",callback:Timetracker.projects.Operations.formAddEditViewCallback,isEmbed:!0},projectId&&(!0===isViewProject?(addEditJson.recordId=projectId,addEditJson.formMode="VIEW",addEditJson.editCallback=Timetracker.projects.Operations.formAddEditView,addEditJson.disableSingleEdit=!0):(addEditJson.recordId=projectId,addEditJson.formMode="EDIT")),null!==addEditJson){let form=ZP5Form._toForm(addEditJson);0!=$("#page-wrapper #zpntfn_modal").length&&(container=$("body #modal_Container"),form.setFormContainer(container)),form.init()}},formAddEditViewCallback:function(projectPkId){projectPkId&&(Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE),Timetracker.forms.resetFormCache(projectPkId,Timetracker.constants.PROJECT_TABLE),Timetracker.Page.isProjectDashboard()&&Timetracker.projectDashboard.init())}},Filters:{constructFilterBasedOnView:function(){Timetracker.projects.Listing.getViewType()===Timetracker.constants.USER?Timetracker.projects.Filters.constructFilter():Timetracker.projects.UnAssignedProjects.constructFilter()},constructFilter:function(){if(0==Timetracker.projects.pageLayout.find("#filterDiv").length){var filterOpt={projectName:{single:!0,label:Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME,paramId:"searchProjectKey",defValue:0},projectNameInput:{type:"input",id:"projectNameSearch",className:"ztextbox zpl_DNI"},client:{single:!1,label:Timetracker.util.getClientDisplayName(),paramId:"clientId",tokenField:!0},projectHead:{single:!1,searchmode:"SETTINGS",label:ZPI18N.getString("zp.projecthead"),id:"projecthead_filter",paramId:"projectHead",tokenField:!0},projectManager:{single:!1,searchmode:"SETTINGS",label:ZPI18N.getString("zp.projectmanager"),id:"projectmanager_filter",paramId:"projectManager",tokenField:!0},assignedto:{single:!1,searchmode:"SETTINGS",label:ZPI18N.getString("zp.assignedto"),id:"projectuser_filter",paramId:"proAssignedTo",tokenField:!0},status:{single:!0,label:ZPI18N.getString("zp.status"),paramId:"projectStatus",defValue:0}},pageMode=Timetracker.Page.getPageMode();("ts_mydata"==pageMode||"ts_teamuser"==pageMode||"ts_operuser"==pageMode)&&(filterOpt.assignedto.showHeader=!1),TimetrackerOperations.Filters.constructFilterDiv(filterOpt),Timetracker.projects.Listing.setDefaultFilterParams()}TimetrackerOperations.Filters.toggleFilter()},createProjectSelect:async function(updateJob,userid,clientId,operation,jobStatus,projectId,prStatus,viewEditPermissionType,othrDtls){null!==clientId&&void 0!==clientId&&""!==clientId||(clientId="0");var elementIds,elementId="",projectStatus=void 0!==prStatus?prStatus:"-1";null!==userid&&void 0!==userid&&""!==userid||(userid=erecno);var includeDeptProjects=!1,id="",orderObj=Timetracker.Util.getSortAscendingValues(Timetracker.constants.PROJECT),sortType=orderObj.sortType,isAscending=orderObj.isAscending,projectDispName=Timetracker.util.getProjectDisplayName(!0);if(operation.indexOf("editcalproject")>=0)elementIds="projectid",includeDeptProjects=!0;else if("timerLogTime"===operation){if(projectStatus="0",jobStatus="0",elementIds="timerprojects",Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar){var json={id:"timerprojects",isFromProjects:!0,optId:"timerprojectadd"};Timetracker.timelogs.forms.addFromSelect("timerarea","timerprojects",ZPI18N.getString("zp.addcomponents",[projectDispName]),Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json,!0)}includeDeptProjects=!0}else"dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation||"locationjobschedule"===operation?operation.indexOf("locationjobschedule")>=0?(id="locjobschd",userid=othrDtls&&othrDtls.locationId?othrDtls.locationId:"0"):(id="dailyLogTime"===operation?Timetracker.constants.DAY:"weeklyLogTime"===operation?Timetracker.constants.WEEK:"monthlyLogTime"===operation?Timetracker.constants.MONTH:Timetracker.constants.HALFMONTH,includeDeptProjects=!0):"addeditlogtime"===operation?(projectStatus="0",jobStatus="0",elementIds=-1!==Layout.Page.hash.indexOf("selfservice/user/calendar")||-1!==Layout.Page.hash.indexOf("timetracker/timelogs/calendarview")||ZPCal.Calendar.isDashboardCal()?"addeditlogtime":"timelogProject","timelogClient",includeDeptProjects=!0):"calendarLogTime"===operation?(projectStatus="0",jobStatus="0",elementIds="projectid","caltimelogClient",includeDeptProjects=!0):"jobsch"===operation?(projectStatus="0",jobStatus="0",elementIds="jbsch_projectid",includeDeptProjects=!0):"project_filter_div"===operation?elementIds="project_client_filter":"jobs_filter"===operation&&(elementIds="projectNames");if("dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation||"locationjobschedule"===operation||othrDtls&&othrDtls.isBulkView){var showAddJobProject=Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar;projectStatus="0",jobStatus="0",id+"clientselect",elementId=$(projectId).attr("id");var cacheId=$(projectId).parents("tr").attr("id"),params={mode:"getTimesheetProjectList",projectStatus:projectStatus,proAssignedTo:userid,isFromFilter:!0,sortType:sortType,isAscending:isAscending,includeDeptProjects:!0,clientId:clientId,conreqcsr:csrfToken};"locationjobschedule"===operation&&(params.fetchOnlyLocationProjects=!0,params.assignedTo=userid,delete params.getCurUserJobs,delete params.proAssignedTo,delete params.includeDeptProjects,showAddJobProject=!1);var selJson={elementId:elementId,containerId:cacheId,entity:Timetracker.constants.PROJECT,params:params},text=ZPI18N.getString("zp.orgselectlabel",[projectDispName]);if(selJson.defSelJson=selJson.initSelJson={id:"0",text:text,html:text},await Timetracker.jobs.Util.populateSingleJobOrProject(selJson,clientId,operation),void 0!=(projectSel=Timetracker.zselect.create(!0,selJson))&&projectSel.setValue(""+selJson.initSelJson.id),Timetracker.jobs.Filters.gettitle(id+"projectselect",cacheId),showAddJobProject){json={id:id+"projectselect",isFromProjects:!0,containerId:cacheId};Timetracker.timelogs.forms.addFromSelect(cacheId,elementId,ZPI18N.getString("zp.addcomponents",[projectDispName]),Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}Timetracker.jobs.Filters.gettitle(elementId,cacheId)}else{"timerprojects"===(elementId=elementIds)&&(projectStatus="0",null!==$(projectId).val()&&(projectId=$(projectId).val()));selJson={elementId:elementId,entity:Timetracker.constants.PROJECT,params:{mode:"getTimesheetProjectList",projectStatus:projectStatus,proAssignedTo:userid,isFromFilter:!0,sortType:sortType,isAscending:isAscending,includeDeptProjects:includeDeptProjects,clientId:clientId,conreqcsr:csrfToken}};viewEditPermissionType&&Timetracker.isTTCustomAdmin(viewEditPermissionType)&&(selJson.params.viewEditPermissionType=viewEditPermissionType);var projectSel;text=ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName);if("calendarLogTime"===operation||"addeditlogtime"===operation||"jobsch"===operation?text=ZPI18N.getString("zp.select"):"timerprojects"===elementId&&(text=ZPI18N.getString("zp.orgselectlabel",[projectDispName])),selJson.defSelJson=selJson.initSelJson={id:"0",text:text,html:text},await Timetracker.jobs.Util.populateSingleJobOrProject(selJson,clientId,operation),Timetracker.UserSpace.isMySpace()&&(selJson.appendTo=Layout.Page.parentContainer),void 0!=(projectSel=Timetracker.zselect.create(!0,selJson))&&projectSel.setValue(""+selJson.initSelJson.id),selJson.defSelJson.id!==selJson.initSelJson.id&&(projectId=selJson.initSelJson.id),"timerprojects"===elementId&&Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar){json={id:"timerprojects",isFromProjects:!0,optId:"timerprojectadd"};Timetracker.timelogs.forms.addFromSelect("timerarea","timerprojects",ZPI18N.getString("zp.addcomponents",[projectDispName]),Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}else if("jbsch_projectid"===elementId&&Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar){json={id:"jbsch_projectid",containerId:"jsaddproject",isFromProjects:!0,optId:"jsaddproject"};Timetracker.timelogs.forms.addFromSelect("jobsch_form","jbsch_projectid",ZPI18N.getString("zp.addcomponents",[projectDispName]),Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}else if("calendarLogTime"===operation&&"projectid"===elementId&&Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar){json={id:"projectid",isFromProjects:!0,optId:"calprojectadd"};Timetracker.timelogs.forms.addFromSelect("calAddPopup","projectid",ZPI18N.getString("zp.addcomponents",[projectDispName]),Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}Timetracker.jobs.Filters.gettitle(elementId)}!0===updateJob&&(void 0==othrDtls?othrDtls={isFromClientSelect:!0}:othrDtls.isFromClientSelect=!0,Timetracker.jobs.Filters.createJobSelect(userid,jobStatus,operation,projectId,clientId,viewEditPermissionType,othrDtls))},setProjectDataForUser:async function(userid){if(Timetracker.projects.fetchProject||null===Timetracker.projects.currProjectData||null===Timetracker.projects.userProjects||void 0===Timetracker.projects.userProjects[userid]){Timetracker.projects.userProjects=Timetracker.projects.fetchProject?null:Timetracker.projects.userProjects,Timetracker.projects.projectUsersArray={},Timetracker.projects.fetchProject=!1;var params={mode:"getTimesheetProjectList",proAssignedTo:userid,isFromFilter:!0,conreqcsr:csrfToken},[data]=await $.ajax({type:"POST",url:Timetracker.constants.URL,data:params});Timetracker.projects.userProjects=null===Timetracker.projects.userProjects?{}:Timetracker.projects.userProjects,Timetracker.projects.userProjects[userid]=Timetracker.projects.currProjectData=data}else Timetracker.projects.userProjects[userid]?Timetracker.projects.currProjectData=Timetracker.projects.userProjects[userid]:Timetracker.projects.currProjectData={}},constructProjectFilter:function(projectsList,clientId,operation,jobStatus,projectId,userid){var projectDispName=Timetracker.util.getProjectDisplayName(!0),altOptions1='<option value="0">'+ZPI18N.getString("zp.select")+"</option>",altOptions2='<option value="0">'+ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)+"</option>",altOptions3='<option value="0">'+ZPI18N.getString("zp.select")+" "+("Projects"===Timetracker.util.projectDispName?ZPI18N.getString("zp.project"):Timetracker.util.projectDispName)+"</option>",altOptions4='<option value="-Select-">'+ZPI18N.getString("zp.select")+"</option>",altOptions2Arr=[{id:"0",text:ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)}],altOptions3Arr=[{id:"0",text:ZPI18N.getString("zp.select")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)}],singulartempData=new Array({id:"0",text:ZPI18N.getString("zp.select")+" "+ZPeople.decodeTxt(projectDispName)}),allMyProjs="",onlyMyNonCompletedProjects="",deptNonCompletedProjects="",allMyProjsArr=[],onlyMyNonCompletedProjectsArr=[],deptNonCompletedProjectsArr=[],deptAllProjectsArr=[];if($.each(projectsList,function(index,data){void 0!==clientId&&null!==clientId&&"-1"!==clientId&&"0"!==clientId&&data.clientId!==clientId||(data.isDeptProject&&!0===data.isDeptProject?(0!==data.projectStatus&&"0"!==data.projectStatus||(deptNonCompletedProjects+='<option value="'+data.projectId+'">'+data.projectName+"</option>",deptNonCompletedProjectsArr.push({id:data.projectId,text:ZPeople.decodeTxt(data.projectName)})),'<option value="'+data.projectId+'">'+data.projectName+"</option>",deptAllProjectsArr.push({id:data.projectId,text:ZPeople.decodeTxt(data.projectName)})):(allMyProjs+='<option value="'+data.projectId+'">'+data.projectName+"</option>",allMyProjsArr.push({id:data.projectId,text:ZPeople.decodeTxt(data.projectName)}),0!==data.projectStatus&&"0"!==data.projectStatus||(onlyMyNonCompletedProjects+='<option value="'+data.projectId+'">'+data.projectName+"</option>",onlyMyNonCompletedProjectsArr.push({id:data.projectId,text:ZPeople.decodeTxt(data.projectName)}))))}),"timelogReport"===operation)Layout.Page.container.find("#rprojectName").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0");else if("timerReport"===operation)Layout.Page.container.find("#tirprojectName").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0");else if("qbReport"===operation)Layout.Page.container.find("#qbrprojectName").html(altOptions2+allMyProjs).val("0").select2(Timetracker.select2.getSelect2Properties());else if("jobReport"===operation)Layout.Page.container.find("#jrprojectName").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0");else if("projectReport"===operation)Layout.Page.container.find("#prprojectName").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0");else if("userReport"===operation)Layout.Page.container.find("#urprojectName").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0");else if("billing"===operation)Layout.Page.container.find("#billing-project").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0");else if("timesheetList"===operation)Layout.Page.container.find("#crprojectName").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0");else if("editcalproject"===operation)Layout.Page.container.find("#projectid").html(altOptions3+onlyMyNonCompletedProjects+deptNonCompletedProjects).val("0").select2(Timetracker.select2.getSelect2Properties());else if("timelogsList"===operation)Layout.Page.container.find("#tsprojectNames").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0");else if("timelogsCalendar"===operation)Layout.Page.container.find("#tscalprojectNames").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0");else if("tsexport"===operation)Layout.Page.container.find("#exportDiv").find("#tsexportproject").html(altOptions2+allMyProjs).val("0").select2(Timetracker.select2.getSelect2Properties());else if("timerLogTime"===operation){if(Layout.Page.container.find("#projectid").html(altOptions3+onlyMyNonCompletedProjects+deptNonCompletedProjects).select2(Timetracker.select2.getSelect2Properties()),Layout.Page.container.find("#timerprojects").select2({data:altOptions3Arr.concat(onlyMyNonCompletedProjectsArr).concat(deptNonCompletedProjectsArr)}).select2("val","0"),Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar){var json={id:"timerprojects",isFromProjects:!0};Timetracker.timelogs.forms.addFromSelect("timerarea","timerprojects",ZPI18N.getString("zp.add")+" "+Timetracker.util.projectDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}}else if("jobsch"===operation){if(Layout.Page.container.find("#jbsch_projectid").select2({data:singulartempData.concat(onlyMyNonCompletedProjectsArr).concat(deptNonCompletedProjectsArr)}).select2("val","0"),Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar){json={id:"jbsch_projectid",containerId:"jobsch_form",isFromProjects:!0};Timetracker.timelogs.forms.addFromSelect("jobsch_form","jbsch_projectid",ZPI18N.getString("zp.add")+" "+projectDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}}else if("dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation){var id="dailyLogTime"===operation?Timetracker.constants.DAY:"weeklyLogTime"===operation?Timetracker.constants.WEEK:"halfmonthlyLogTime"===operation?Timetracker.constants.HALFMONTH:Timetracker.constants.MONTH;if($(projectId).parent().parent().find("#"+id+"projectselect").select2({data:altOptions3Arr.concat(onlyMyNonCompletedProjectsArr).concat(deptNonCompletedProjectsArr)}).select2("val","0"),Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar){json={id:id+"projectselect",isFromProjects:!0,containerId:$(projectId).parent().parent().attr("id")};Timetracker.timelogs.forms.addFromSelect($(projectId).parent().parent().attr("id"),id+"projectselect",ZPI18N.getString("zp.add")+" "+Timetracker.util.projectDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}}else if("addeditlogtime"===operation||"calendarLogTime"===operation){var selDiv=Layout.Page.container.find("select[name='Project']"),curProDivSel=selDiv.val();selDiv.html(altOptions4+onlyMyNonCompletedProjects+deptNonCompletedProjects),Timetracker.util.checkIfSelectHasValue(selDiv,curProDivSel)?selDiv.val(curProDivSel).select2(Timetracker.select2.getSelect2Properties()):selDiv.select2(Timetracker.select2.getSelect2Properties())}else if(void 0===operation&&(Layout.Page.container.find("#projectNames,#tsprojectNames,#tscalprojectNames,#jrprojectName,#rprojectName,#tirprojectName,#urprojectName,#prprojectName,#billing-project,#crprojectName").select2({data:altOptions2Arr.concat(allMyProjsArr)}).select2("val","0"),Layout.Page.container.find("#unass_projectNames").select2({data:altOptions2Arr.concat(allMyProjsArr).concat(deptAllProjectsArr)}).select2("val","0"),Layout.Page.container.find("#adddefalutproject").html(altOptions1+onlyMyNonCompletedProjects+deptNonCompletedProjects).val("0").select2(Timetracker.select2.getSelect2Properties()),Layout.Page.container.find("#timerprojects").select2({data:altOptions3Arr.concat(onlyMyNonCompletedProjectsArr).concat(deptNonCompletedProjectsArr)}).select2("val","0"),Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar)){json={id:"timerprojects",isFromProjects:!0};Timetracker.timelogs.forms.addFromSelect("timerarea","timerprojects",ZPI18N.getString("zp.add")+" "+Timetracker.util.projectDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}}},Validations:{completedProjectCheck:function(projectId,projectStatus){if(Timetracker.projects.Validations.hasProjectUser(projectId))if(1===Number(projectStatus))Timetracker.util.showAlert(1,ZPI18N.getString("zp.completedProjectCheckForAddingJob",[Timetracker.util.jobDispName,Timetracker.util.projectDispName]));else{var otherDetails="/jobs/"+projectId;Timetracker.forms.showForm(Timetracker.constants.ADD,void 0,otherDetails)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.cannotaddjobtoanonuserproject",[Timetracker.util.jobDispName,Timetracker.util.projectDispName]))},isProjectJobAddAllowed:function(projectId,projectStatus){return 1===Number(projectStatus)?(Timetracker.util.showAlert(1,ZPI18N.getString("zp.completedProjectCheckForAddingJob",[Timetracker.util.jobDispName,Timetracker.util.projectDispName]),!0),!1):!!Timetracker.projects.Validations.hasProjectUser(projectId)||(Timetracker.util.showAlert(1,ZPI18N.getString("zp.cannotaddjobtoanonuserproject",[Timetracker.util.jobDispName,Timetracker.util.projectDispName]),!0),!1)},hasProjectUser:function(projectId){let hasUser=!1;Timetracker.projects.Util.getProjectDtlsById(projectId);let projectDtl=Timetracker.projects.projectUsersArray[projectId];return projectDtl&&((hasUser=projectDtl.projectHeadDtls&&!projectDtl.projectHeadDtls.loginDisabledUser)||projectDtl.projectManagers&&$.each(projectDtl.projectManagers,function(index,data){data.loginDisabledUser||(hasUser=!0)}),hasUser||projectDtl.projectUsers&&$.each(projectDtl.projectUsers,function(index,data){data.loginDisabledUser||(hasUser=!0)})),!hasUser&&Timetracker.isDataAdminForAllUsers()&&(!(hasUser=Object.keys(Timetracker.projects.Util.getProjectDepts(projectId)).length>0)&&Timetracker.generalSettings.isJobProLocApplicableEnabled()&&(hasUser=Object.keys(Timetracker.projects.Util.getProjectLocations(projectId)).length>0),!hasUser&&isOrgStructureEnabled&&(hasUser=Object.keys(Timetracker.projects.Util.getProjectDivisions(projectId)).length>0)),hasUser}},Forms:{getProjectDetailsForForm:function(params,formlayout){var layout=null!=formlayout?formlayout:Layout.Page.container;if(params.ProjectHead&&"-Select-"!==params.ProjectHead&&"-select-"!==params.ProjectHead){var projectHeadRate=layout.find("#projectHeadRate").val();params.ProjectHeadRate=Timetracker.Validations.isDecimal(projectHeadRate)?projectHeadRate:"0"}var projectManager="",projectManagerRate="",selectedManagers=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.ProjectManager,Timetracker.forms.appFor.ENTITIES.Users);selectedManagers.length>0&&$.each(selectedManagers,function(index,data){0!==index&&(projectManager+=";",projectManagerRate+=";"),projectManager+=data.recordId,void 0!==data.rate?projectManagerRate+=data.rate:projectManagerRate+="0"}),params.ProjectManager=projectManager,params.ProjectManagerRate=projectManagerRate;var projectUsers="",projectUserRate="",selectedUsers=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Users);if(selectedUsers.length>0&&$.each(selectedUsers,function(index,data){0!==index&&(projectUsers+=";",projectUserRate+=";"),projectUsers+=data.recordId,void 0!==data.rate?projectUserRate+=data.rate:projectUserRate+="0"}),params.ProjectUsers=projectUsers,params.ProjectUserRate=projectUserRate,Timetracker.isDataAdminForAllUsers()){if(Timetracker.forms.appFor.isAllRecordSelected(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Depts,!0))params.departmentIds="0";else{var departmentIds="",selectedDepts=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Depts);selectedDepts.length>0&&$.each(selectedDepts,function(index,data){0!==index&&(departmentIds+=";"),departmentIds+=data.recordId}),params.departmentIds=departmentIds}if(Timetracker.generalSettings.isJobProLocApplicableEnabled())if(Timetracker.forms.appFor.isAllRecordSelected(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Locs,!0))params.locationIds="0";else{var locationIds="",selectedLocs=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Locs);selectedLocs.length>0&&$.each(selectedLocs,function(index,data){0!==index&&(locationIds+=";"),locationIds+=data.recordId}),params.locationIds=locationIds}if(isOrgStructureEnabled)if(Timetracker.forms.appFor.isAllRecordSelected(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Divs,!0))params.divisionIds="0";else{var divisionIds="",selectedDivs=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Divs);selectedDivs.length>0&&$.each(selectedDivs,function(index,data){0!==index&&(divisionIds+=";"),divisionIds+=data.recordId}),params.divisionIds=divisionIds}}if(params.isFromNewUI=!0,Timetracker.CRM.clientFromCRM){var crmaccount_name=layout.find("#CRM_text").find("#CRM_client").val(),crmaccount_id=layout.find("#CRM_text").find("#CRM_client").attr("clientId"),crmClientype=layout.find("#CRM_text").find("#CRM_client").attr("clientType"),crmCurrency=layout.find("#CRM_text").find("#CRM_client").attr("currency");null!==crmaccount_name&&void 0!==crmaccount_name&&""!==crmaccount_name&&null!==crmaccount_id&&void 0!==crmaccount_id&&""!==crmaccount_id&&null!==crmClientype&&void 0!==crmClientype&&""!==crmClientype&&(params.accountName=crmaccount_name,params.accountId=crmaccount_id,params.crmClientype=crmClientype,params.clientFromCRM=!0,params.crmCurrency=crmCurrency)}else params.ClientId=ZPeopleComponents.select(layout.find("input[name=ClientId]")).getValue()},getUsersBasedOnFormPerm:function(permission,formId){let formObj=ZP5Form.getCurrFormsOperation();return formId=formId||formObj.formId,void 0===permission&&(permission=formObj.getAddPerm(),ZP5Form.getFormClassObj().isEditMode()&&(permission=formObj.getEditPerm())),FormsCommon.getPrimaryLookupValues(permission,"",formId)},projectBasedUsersList:function(currentProjectId,permission,options,formId){let projectUserList=[],projectUserIds=[];Timetracker.projects.Util.getProjectDtlsById(currentProjectId);let projectDtl=Timetracker.projects.projectUsersArray[currentProjectId];if(projectDtl){if(projectDtl.projectHeadDtls&&!projectDtl.projectHeadDtls.loginDisabledUser){let displayName=projectDtl.projectHeadDtls.firstName+" "+projectDtl.projectHeadDtls.lastName+" "+projectDtl.projectHeadDtls.employeeId;projectUserList.push({recordId:projectDtl.projectHeadDtls.erecno,name:displayName}),projectUserIds.push(projectDtl.projectHeadDtls.erecno)}projectDtl.projectManagers&&$.each(projectDtl.projectManagers,function(index,data){if(!data.loginDisabledUser&&-1===projectUserIds.indexOf(data.erecno)){let displayName=data.firstName+" "+data.lastName+" "+data.employeeId;projectUserList.push({recordId:data.erecno,name:displayName}),projectUserIds.push(data.erecno)}}),projectDtl.projectUsers&&$.each(projectDtl.projectUsers,function(index,data){if(!data.loginDisabledUser&&-1===projectUserIds.indexOf(data.erecno)){let displayName=data.firstName+" "+data.lastName+" "+data.employeeId;projectUserList.push({recordId:data.erecno,name:displayName}),projectUserIds.push(data.erecno)}})}if(Timetracker.isDataAdminForAllUsers()||Timetracker.projects.Util.isProjectHeadOrManager(currentProjectId))return projectUserList;{let projectUsers=[],permBasedUserList=options||Timetracker.projects.Forms.getUsersBasedOnFormPerm(permission,formId);for(let i=0;i<permBasedUserList.length;i++)projectUserIds.indexOf(permBasedUserList[i].Id)>-1&&projectUsers.push({recordId:permBasedUserList[i].Id,name:permBasedUserList[i].Value});return projectUsers}},projectBasedDeptsList:function(currentProjectId){let depts=[],projectDepts=Timetracker.projects.Util.getProjectDepts(currentProjectId);return Object.keys(projectDepts).length>0&&$.each(projectDepts,function(deptId,dept){dept.isActive&&depts.push({recordId:deptId,name:dept.recName})}),depts},projectBasedDivisionsList:function(currentProjectId){let divs=[],projectDivs=Timetracker.projects.Util.getProjectDivisions(currentProjectId);return Object.keys(projectDivs).length>0&&$.each(projectDivs,function(divId,div){div.isActive&&divs.push({recordId:divId,name:div.recName})}),divs},projectBasedLocationsList:function(currentProjectId){let locs=[],projectLocs=Timetracker.projects.Util.getProjectLocations(currentProjectId);return Object.keys(projectLocs).length>0&&$.each(projectLocs,function(locId,loc){loc.isActive&&locs.push({recordId:locId,name:loc.recName})}),locs}},Util:{getProjectDtlsById:function(projectId){(void 0===Timetracker.projects.projectUsersArray[projectId]||Timetracker.projects.projectUsersArray[projectId].refresh&&!0===Timetracker.projects.projectUsersArray[projectId].refresh)&&$.ajax({type:"POST",async:!1,url:Timetracker.constants.URL,data:{mode:"getProjectDetailsById",projectId:projectId,conreqcsr:csrfToken},success:function(result){result.res&&"0"!==result.res&&result.resObj[projectId]&&(Timetracker.projects.projectUsersArray[projectId]=result.resObj[projectId])}})},getProjectDepts:function(projectId){Timetracker.projects.Util.getProjectDtlsById(projectId);var projectDtl=Timetracker.projects.projectUsersArray[projectId];return projectDtl&&projectDtl.projectDepts?projectDtl.projectDepts:{}},getProjectLocations:function(projectId){Timetracker.projects.Util.getProjectDtlsById(projectId);var projectDtl=Timetracker.projects.projectUsersArray[projectId];return projectDtl&&projectDtl.projectLocations?projectDtl.projectLocations:{}},getProjectDivisions:function(projectId){Timetracker.projects.Util.getProjectDtlsById(projectId);var projectDtl=Timetracker.projects.projectUsersArray[projectId];return projectDtl&&projectDtl.projectDivisions?projectDtl.projectDivisions:{}},getProjectName:function(projectId){Timetracker.projects.Util.getProjectDtlsById(projectId);var projectDtl=Timetracker.projects.projectUsersArray[projectId];return projectDtl&&projectDtl.projectName?projectDtl.projectName:""},getProjectManagerArray:function(projectId){Timetracker.projects.Util.getProjectDtlsById(projectId);var projectDtl=Timetracker.projects.projectUsersArray[projectId];return projectDtl&&projectDtl.projectManagers?projectDtl.projectManagers:[]},isProjectHeadOrManager:function(projectId,isFromForm){var isProjectHeadOrManager=!1;if(!ZP5Form.isEmbedForm()&&void 0===projectId&&isFromForm&&ZP5Form.getFormClassObj().isAddMode()&&(Timetracker.Page.isProjectDashboard("jobs")?projectId=Layout.Page.urlparam.id:Layout.Page.hash.indexOf("projects/jobs")&&(projectId=Layout.Page.urlparam.projectId)),void 0!==projectId){var currentProjectManagerArray=Timetracker.projects.Util.getProjectManagerArray(projectId),projectDtl=Timetracker.projects.projectUsersArray[projectId];projectDtl&&projectDtl.projectHeadDtls&&(isProjectHeadOrManager=erecno===projectDtl.projectHeadDtls.erecno),isProjectHeadOrManager||(isProjectHeadOrManager=-1!==Timetracker.projects.Operations.findJSONArrayIndex(currentProjectManagerArray,erecno,"erecno"))}return isProjectHeadOrManager},isEditDeleteAllowed:function(projectId,isAdmin,owner,projectHeadDtls,projectManagers,operation){if(isAdmin||erecno===owner)return!0;if(void 0===projectHeadDtls||void 0===projectManagers){var projectDtls=Layout.Page.container.find("#projectlist").find("#projectTable"+projectId).data("projdata");projectDtls&&(projectHeadDtls=projectDtls.projectHead,projectManagers=projectDtls.projectManagers)}return!(!projectHeadDtls||projectHeadDtls.erecno!==erecno)||!!("delete"!==operation&&projectManagers&&projectManagers.length>0)&&-1!==Timetracker.projects.Operations.findJSONArrayIndex(projectManagers,erecno,"erecno")},setProjectCacheValues:function(params){var projectsJson={};projectsJson.projectId=params.projectId,projectsJson.projectName=params.Project_Name,projectsJson.projectManager=params.ProjectManager,projectsJson.ownerId=params.ProjectManager,projectsJson.ownerName=ZPeople.getUserDetailsById(params.ProjectManager).name,projectsJson.projectStatus=0,projectsJson.projectUsersList=[],projectsJson.projectCost=0,Timetracker.projects.userProjects=null===Timetracker.projects.userProjects?{}:Timetracker.projects.userProjects,Timetracker.projects.userProjects[params.ProjectManager].push(projectsJson),Timetracker.projects.currProjectData=Timetracker.projects.userProjects[params.ProjectManager],Timetracker.projects.refreshData=!0,Timetracker.forms.refreshLookupOptions("projects")},showExportNew:function(){ZP5Export.init("project",{moduleSysViewCallback:Timetracker.ImportExport.showExportNew})},clickHandler:function(event){var ele=event.target,ref=$(ele).attr("ref");if("skip"!=ref)if(0!=$(ele).closest("ul").length){if(void 0===(data=$(ele).closest("ul").data("projdata"))){if($(ele).closest("ul").data("schval"))if("changeJobStatus"==ref){if($(ele).data().isprocessing)return;$(ele).data().isprocessing=!0,Timetracker.jobs.Operations.toggleJobStatus(event)}else{if($(ele).hasClass("zcheckbox__label")||$(ele).attr("class")&&-1!=$(ele).attr("class").indexOf("zswitch"))return;var data=$(ele).closest("ul").data("schval");Timetracker.forms.showForm(Timetracker.constants.VIEW,data.jobId,"/jobs")}return void("sort"==ref?Timetracker.projects.Listing.getProjectList(ele,null,!0):"checkall"==ref?Timetracker.views.checkAllCheckBoxes(ele,"project-listtbody",settingsPage.container):"switchView"==ref&&Timetracker.projects.Listing.switchView(ele))}if("delete"==ref){var projDispName=Timetracker.util.getProjectDisplayName(!0,!0);if(!Timetracker.projects.Util.isEditDeleteAllowed(data.projectId,Timetracker.isDataAdminForAllUsers(),data.owner,data.projectHead,data.projectManagerArray,"delete"))return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.notallowedtodeletethisproject",[projDispName]),!0);var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[projDispName]),body:ZPI18N.getString("zp.common.delEntityInfo2",[projDispName])};Timetracker.Util.confirmpopUp(data.projectId,Timetracker.projects.Operations.showOpDelete,data.projectId,0,extraDtls)}else if("ZProject_project"==ref)Timetracker.projects.Listing.showZProjects(data.zProjectsPortalId,data.zProjectsProjectRefId);else if("checkbox"==ref)Timetracker.projects.Operations.checkParticularProject(ele);else if("showJobs"==ref)Timetracker.projects.Listing.showJobsForProject(ele,!0,"project-listtbody");else if("closeJobs"==ref)Timetracker.projects.Listing.showJobsForProject(ele,!0,"project-listtbody");else if("changeStatus"==ref){if($(ele).data().isprocessing)return;$(ele).data().isprocessing=!0,Timetracker.projects.Operations.changeProjectStatus(ele,data.projectId,data.projectStatus),Timetracker.jobs.Operations.toggleJobStatus}else"addJobs"==ref?Timetracker.projects.Validations.isProjectJobAddAllowed(data.projectId,data.projectStatus)&&Timetracker.forms.showForm(Timetracker.constants.ADD,data.projectId,"/jobs"):"edit"==ref&&Timetracker.forms.showForm(Timetracker.constants.EDIT,data.projectId)}else if(0!=$(ele).closest("tr").length){if(void 0===(data=$(ele).closest("tr").data("projdata")))return;if("delete"==ref){projDispName=Timetracker.util.getProjectDisplayName(!0,!0);if(!data.isDeleteAllowed)return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.notallowedtodeletethisproject",[projDispName]),!0);extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[projDispName]),body:ZPI18N.getString("zp.common.delEntityInfo2",[projDispName])};Timetracker.Util.confirmpopUp(data.projectId,Timetracker.projects.Operations.showOpDelete,data.projectId,0,extraDtls)}else if("optionsList"==ref){var opt=data.optArr;opt.length>3&&Timetracker.Util.constructOptionListing(opt,"moreOptions_"+data.projectId+"_"),ZPeopleComponents.menu("#moreOptions_"+data.projectId+"_").show()}else"edit"==ref&&Timetracker.forms.showForm(Timetracker.constants.EDIT,data.projectId)}else if("addProject"==ref){var niceUrl=settingsUrlProps.url.replace("listview","add");window.location.href="#"+niceUrl}else"toggleFilter"==ref?Timetracker.projects.Listing.getViewType()===Timetracker.constants.USER?Timetracker.projects.Filters.constructFilter():Timetracker.projects.UnAssignedProjects.constructFilter():"applyFilter"==ref?Timetracker.projects.Listing.getViewType()===Timetracker.constants.USER?Timetracker.projects.Listing.getProjectList():Timetracker.projects.UnAssignedProjects.getProjectList(Timetracker.projects.Listing.getViewType()):"resetFilter"==ref?Timetracker.projects.Listing.setDefaultFilterParams():"view_close"==ref?Timetracker.views.isSystemView()?(settingsPage.container.find("#projectlist").find("input[type='checkbox']:checked").prop("checked",!1),settingsPage.container.find("#zp_view_record_delete").removeClass("opn").fadeOut(200,function(){$(this).siblings("#zp_views_formrecactions").fadeIn(200)})):ZP5Views.currViewObj.showRecordActions(!1):"fullScreen"==ref?($("body").toggleClass("zpl_newsrcn"),Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").hasClass("zpl_act")?Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.maximize")).toggleClass("zpl_act"):Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.minimize")).toggleClass("zpl_act")):"exitFullScreen"==ref&&($("body").removeClass("zpl_newsrcn"),Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.maximize")).removeClass("zpl_act"))}},Team:{refresh:!0,defaultProjectsList:null,init:()=>{Layout.Page.container.find(".zpl_Emptydata").remove(),Timetracker.projects.Team.getDefaultProjectsList().then(function(defaultProjects){defaultProjects.length>0?window.location.href="#home/team/projectdashboard/feeds-id:"+defaultProjects[0].id:Layout.Page.container.append('<div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_permission"></div><p>'+ZPI18N.getString("zp.notauthorised")+"</p></div></div>")})},setRefreshValue:refreshValue=>{Timetracker.projects.Team.refresh=refreshValue,refreshValue&&Timetracker.projects.Team.clearDefaultProjectsList()},refreshNeeded:()=>Timetracker.projects.Team.refresh,clearDefaultProjectsList:()=>{Timetracker.projects.Team.defaultProjectsList=null},setDefaultProjectsList:async()=>{null==Timetracker.projects.Team.defaultProjectsList&&(Timetracker.projects.Team.defaultProjectsList=await Timetracker.projects.Team.getProjectsList())},getDefaultProjectsList:async()=>(await Timetracker.projects.Team.setDefaultProjectsList(),Timetracker.projects.Team.defaultProjectsList),getProjectsList:async filterParams=>{let sIndex=0,searchKey="";filterParams&&filterParams.query&&(void 0!==filterParams.query.page&&filterParams.query.page>1&&(sIndex=(filterParams.query.page-1)*Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT+1),filterParams.query.term&&""!==filterParams.query.term&&(searchKey=filterParams.query.term));let params={mode:"getTeamProjects",sIndex:sIndex,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,conreqcsr:csrfToken};searchKey&&(params.searchKey=searchKey);let projects=[];var[response]=await ZPeople.Request.sendRequestAsPromise(Timetracker.constants.URL,params);return response.res&&$.each(response.resArr,function(index,data){projects.push({id:data.projectId,html:data.projectName,text:data.projectName})}),projects}},Members:{refreshCache:{},userFetchDelay:void 0,firescrollMode:"TT_PROJECT_MEMBERS",setRefreshValue:(flag,pageId)=>{flag?Timetracker.projects.Members.refreshCache={}:Timetracker.projects.Members.refreshCache[pageId]=!1},isRefreshNeeded:pageId=>void 0==Timetracker.projects.Members.refreshCache[pageId]||Timetracker.projects.Members.refreshCache[pageId],loadPage:()=>{Timetracker.initSetup();let pageId=Layout.Page.pageId,refreshProjects=Timetracker.projects.Members.isRefreshNeeded(pageId),containerId=pageId+"_container";if(0===Layout.Page.container.find("#"+containerId).length){let html='<div class="zpl_container"><div class="zpl_iwrpr"><div class="zpl_iwrprrgt"><div id="'+containerId+'" class="zpl_act zpl_tblfxd" scroll="enabled"><div id="project_members_topband" class="zpl_btnmnu"><div class="zpl_lft"><div class="zpl_brdcrmp"><div><span class="d-flexC flexclmcap" aria-label="'+ZPI18N.getString("zp.project")+' Listbox" tabindex="0"><span>'+ZPI18N.getString("zp.project")+'</span><input id="project_id_input"></span></div></div></div><div class="search-cmn"><i class="PI_lens"></i><input type="text" class="ztextbox" id="searchfield" placeholder="'+ZPI18N.getString("zp.mincharsearch",[3])+'"><i class="PI_cls" onclick="Timetracker.projects.Members.toggleSearchBar();"></i></div><div class="zpl_rgt"><ul class="zpl_grpmnu"><li class="zpl_c-d" aria-label="'+ZPI18N.getString("zp.members")+':0" tabindex="0"><span>'+ZPI18N.getString("zp.members")+'</span><div class="zpl_tg"><span id="projectUserCount"></span></div> </li></ul><i class="zpl_ibg PI_lens" id="searchicon" aria-label="'+ZPI18N.getString("zp.searchemployee")+'" tabindex="0" onclick="Timetracker.projects.Members.toggleSearchBar();" title="'+ZPI18N.getString("zp.searchemployee")+'"></i></div></div><div class="zpl_rgtcnt zpl_mdltmvw" id="project_members_list_container"><div class="zpl_emcrdlst" id="project_members_list"></div></div></div></div></div></div>';Layout.Page.container.html(html),refreshProjects=!0}let container=Layout.Page.container.find("#"+containerId);if(container.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.projectmembers")]),tabindex:"0"}),refreshProjects){container.find("#project_id_input").off("zselectchange");let selectJson={elementId:"project_id_input",containerId:containerId,callbackToFetchOptions:Timetracker.projects.Members.getProjectsForFilter,cacheData:!0},zselectObj=Timetracker.zselect.create(!0,selectJson);void 0!=zselectObj&&Timetracker.projects.Members.getProjectsForFilter().then(function(projects){if(!(projects.length>0))return container.find("#project_members_topband").addClass("DNI"),container.find("#project_members_list").html(""),void Timetracker.Util.showHideNoData({divId:"project_members_list_container",cls:"zp_nd_permission",msg:ZPI18N.getString("zp.permissiondeniedtoaccessthispage")});container.find("#project_members_topband").removeClass("DNI"),zselectObj.addOption(projects),zselectObj.setValue(projects[0]),Timetracker.projects.Members.setRefreshValue(!1,pageId),Timetracker.projects.Members.loadMembers(projects[0].id)}),container.find("#project_id_input").off("zselectchange").on("zselectchange",function(event){let projectId=ZPeopleComponents.select($(this)).getValue();Timetracker.projects.Members.loadMembers(projectId)}),container.find("#searchfield").off("input").on("input",function(){let searchKey=$(this).val();(""===searchKey||searchKey.length>2)&&(clearTimeout(Timetracker.projects.Members.userFetchDelay),Timetracker.projects.Members.userFetchDelay=setTimeout(()=>{let projectId=ZPeopleComponents.select(Layout.Page.container.find("#project_id_input")).getValue();Timetracker.projects.Members.loadMembers(projectId,searchKey)},500))})}},getProjectsForFilter:async function(filterParams){let sIndex=0,searchKey="";filterParams&&filterParams.query&&(void 0!==filterParams.query.page&&filterParams.query.page>1&&(sIndex=(filterParams.query.page-1)*Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT+1),filterParams.query.term&&""!==filterParams.query.term&&(searchKey=filterParams.query.term));let requestParams={mode:"getPH_PMProjects",sIndex:sIndex,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,conreqcsr:csrfToken};""!==searchKey&&(requestParams.searchKey=searchKey);let projects=[];var[result]=await ZPeople.Request.sendRequestAsPromise(Timetracker.constants.URL,requestParams);return result&&result.res&&result.resArr&&$.each(result.resArr,function(index,data){projects.push({id:data.projectId,html:data.projectName})}),projects},toggleSearchBar:function(){let icon=Layout.Page.container.find("#searchicon"),input=Layout.Page.container.find(".search-cmn");if(icon.toggleClass("opened"),icon.hasClass("opened"))input.addClass("opn"),input.find("#searchfield").focus();else{input.find("#searchfield").blur();let searchKey=input.find("#searchfield").val();if(input.find("#searchfield").val(""),input.removeClass("opn"),""!==searchKey){let projectId=ZPeopleComponents.select(Layout.Page.container.find("#project_id_input")).getValue();Timetracker.projects.Members.loadMembers(projectId)}}},loadMembers:function(projectId,searchKey){let container=Layout.Page.container,mainContainer=container.find("#project_members_list");if(void 0===projectId||"0"===projectId){var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.jobDispName]);return Timetracker.util.checkAddJobPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.jobDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getJobDisplayName(!0)])])),Timetracker.Util.showHideNoData({divId:"project_members_list_container",msg:noDataMsg}),void mainContainer.html("")}Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(null,{divId:"project_members_list_container"}),mainContainer.html("");let requestParams={mode:"getProjectUsers",projectId:projectId,onlyPHPMAuthorization:!0,getUserCount:!0,getWeeklyLoggedHours:!0,getCurrentlyRunningTimerInfo:!0,getAttendanceStatus:!0,sIndex:0,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT};""!==searchKey&&(requestParams.searchKey=searchKey),ZPeople.Request.send(Timetracker.constants.URL,requestParams,function(result){if(ZPeople.FireScroll.setParam("triggered",!0,Timetracker.projects.Members.firescrollMode),mainContainer.html(""),Timetracker.util.removeLoading(),0===result.res||0===result.resArr.length)container.find("#projectUserCount").text(0),Timetracker.Util.showHideNoData({divId:"project_members_list_container",msg:ZPI18N.getString("zp.payroll.search.norecordbody")});else{container.find("#projectUserCount").text(result.userCount),container.find("#projectUserCount").parent().parent().attr("aria-label",ZPI18N.getString("zp.members")+" : "+result.userCount),$.each(result.resArr,function(index,data){let memberDiv=$(Timetracker.projects.Members.constructMemberRow(data));mainContainer.append(memberDiv)}),delete requestParams.getUserCount;let firescrollDtls={mode:Timetracker.projects.Members.firescrollMode,requestParams:requestParams};ZPeople.FireScroll.init(Timetracker.projects.Members.loadMoreMembers,void 0,firescrollDtls),ZPeople.FireScroll.setRecordCount(result.resArr.length,Timetracker.projects.Members.firescrollMode),result.resArr.length===Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(Timetracker.projects.Members.firescrollMode)}})},constructMemberRow:function(projectMember){let redirectionUrl=(Timetracker.Page.Projects.isHomeMembersView()?"#home/user/profile-id:":"#timetracker/team/user/timelogs-mode:list/userId:")+projectMember.erecno;var projectRole=2==projectMember.role?ZPI18N.getString("zp.projecthead"):1==projectMember.role?ZPI18N.getString("zp.projectmanager"):ZPI18N.getString("zp.projectuser");let html='<div class="zpl_dfcrd zpl_tmusrcrd" onclick="window.location.href=\''+redirectionUrl+'\'"><div class="zpl_emcrdcnt"><div class="zpl_em" aria-label="'+projectMember.name+" - "+ZPI18N.getString("zp.lms.trainers.id")+"  "+ZPI18N.getString("zp.number")+projectMember.employeeId+" "+projectRole+" "+(projectMember.leaveAttStat?projectMember.leaveAttStat:"")+" "+ZPI18N.getString("zp.weeklylogged")+" "+Calendar.minstohrs(projectMember.timelogHours)+" "+ZPI18N.getString("zp.smallhrs")+'" tabindex="0"><div class="zpl_emimg"><img src="'+projectMember.photo+'"></div><div class="zpl_emdts zpl_ellipsis" style=""><div title="'+projectMember.name+'">'+projectMember.employeeId+" - <b>"+projectMember.name+" </b></div><div><em>"+projectRole+"</em></div>";return projectMember.leaveAttStat&&(html+='<div><b class="'+Attendance.setClassToShowStatus(projectMember.colourCode)+'">'+projectMember.leaveAttStat+"</b></div>"),html+="</div>"+("true"==ZPeople.ISCHAT&&projectMember.isCommunicationApplicable&&projectMember.zuid!=_LOGGEDIN_ZUID?'<div class="MLauto d-flexclm4 zpl_hvr zpl_hvrsw"><i class="PI_pharw zpl_drpdwn-js" aria-label="'+ZPI18N.getString("zp.common.calloption")+'" tabindex="0" chat_comm="true" uid="'+projectMember.zuid+'"></i></div>':"")+'</div></div><div class="a-itm-left d-flexclm8 zpl_empTmInfo"><div class="d-flexclmcap5 zpl_ellipsis"><i class="PI_jobs"></i><span class="zpl_ellipsis">'+(projectMember.currentlyRunningTimerJobInfo?projectMember.currentlyRunningTimerJobInfo.jobName:"-")+"</span></div><div><em>"+ZPI18N.getString("zp.weeklylogged")+" - </em><span>"+Calendar.minstohrs(projectMember.timelogHours)+" "+ZPI18N.getString("zp.smallhrs")+"</span></div></div></div>"},loadMoreMembers:function(firescrollDtls){let requestParams=firescrollDtls.requestParams;requestParams.sIndex=ZPeople.FireScroll.getRecordCount(Timetracker.projects.Members.firescrollMode)+1,ZPeople.Request.send(Timetracker.constants.URL,requestParams,function(result){if(result.res&&result.resArr.length>0){let container=Layout.Page.container.find("#project_members_list");$.each(result.resArr,function(index,data){let memberDiv=$(Timetracker.projects.Members.constructMemberRow(data));container.append(memberDiv)}),ZPeople.FireScroll.increaseRecordCount(result.resArr.length,Timetracker.projects.Members.firescrollMode),result.resArr.length===Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(Timetracker.projects.Members.firescrollMode)}})}}},Timetracker.clients={FETCHED_CLIENT_COUNT:0,MAXCLIENT_FETCH_COUNT:25,referenceColumn:!1,fetchData:!1,editdata:null,editMode:!1,clientData:{},sorterObj:null,pageLayout:null,isFromOperations:!1,formDetails:null,clientsPopulated:!1,refreshData:!1,Listing:{constructSystemView:function(){var json={wrapperClass:ZPeople.isZPNewUI()?"Nbar5":"Nbar2",dataCallback:Timetracker.clients.initClientList,onchangeCallback:Timetracker.views.customViewActions,formId:Timetracker.clients.formDetails.formId,formLoadCallback:Timetracker.clients.initClientList,systemViewName:Timetracker.util.clientDispName,exportCallback:Timetracker.ImportExport.showexportfld,tableName:Timetracker.constants.CLIENT_TABLE};if(TimetrackerOperations.init(),Timetracker.permissionCheckForOperPages())return Timetracker.clients.pageLayout=settingsPage.container,Timetracker.clients.isFromOperations=!0,json.importExportConstructionCallback=Timetracker.ImportExport.constructImportExportContainer,json},constructOperationView:function(){Timetracker.clients.pageLayout=settingsPage.container;var layout=settingsPage.container,clientDispName=ZPI18N.getString("zp.tt.addentity",[Timetracker.util.getClientDisplayName(!0)]);if(layout.find("#viewFooter").addClass("zpl_DNI"),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").addClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").addClass("DNI"),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").addClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions").removeClass("DNI"),layout.find(".zpl_tblres:not(#clientlist)").hide(),layout.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPeople.decodeTxt(Timetracker.clients.formDetails.formDispName)]),tabindex:"0"}),0===layout.find("#clientlist").length&&-1!=settingsUrlProps.niceUrl.indexOf("clients/listview")){var html='<div class="zpl_rgt" id="zp_views_formrecactions"><button class="zlabel zlabel--blue zlabel--medium DB" ref="addClient" id="addClientBar" aria-label="'+clientDispName+'" tabindex="0">'+clientDispName+'</button><i id="fullScrn" ref="fullScreen" class="zpl_ibg PI_maxmz'+($("body").hasClass("zpl_newsrcn")?' zpl_act" title="'+ZPI18N.getString("zp.minimize"):'" title="'+ZPI18N.getString("zp.maximize"))+'"></i><i class="zpl_ibg PI_more" aria-label="'+ZPI18N.getString("zp.more")+'" tabindex="0" title="'+ZPI18N.getString("zp.more")+'" id="clientsMoreOptionsBtn" ref="more"></i></div>';layout.find("#viewActionsContainer").append(html),html='<div class="actn_ovrly" id="zp_view_record_delete"></div>',layout.find("#viewActionsContainer").append(html),layout.addClass("zpl_tblfxd zpl_crdwthful"),layout.removeClass(""),layout.find(".zpl_rgtcnt").append("<div id='zp_empty_data'></div>"),layout.find("#viewActionsContainer").find("#fullScreenBack,i.PI_back").attr("ref","exitFullScreen");var multiSelectBtnHtml=Timetracker.views.multiSelectActions.getMultiSelectHtml();layout.find("#zp_view_record_delete").html(multiSelectBtnHtml);var moreOpt=Timetracker.ImportExport.getImportExportArray(Timetracker.constants.CLIENT);moreOpt.length?Timetracker.Util.constructMoreOption(moreOpt,"clientsMoreOptions"):layout.find("#clientsMoreOptionsBtn").hide(),Timetracker.Util.addEventListner(null,"click",Timetracker.clients.clickHandler,!0),Timetracker.clients.clientsPopulated=!1}}},showExportNew:function(){ZP5Export.init("client",{moduleSysViewCallback:Timetracker.ImportExport.showExportNew})},clickHandler:function(event){var ele=event.target,ref=$(ele).attr("ref");if("skip"!=ref)if(0!=$(ele).closest("tr").length){var data=$(ele).closest("tr").data();if(0===Object.keys(data).length)return void("sort"==ref?Timetracker.clients.getClientList(ele):"checkall"==ref&&Timetracker.views.checkAllCheckBoxes(ele,"client-listtbody",settingsPage.container));if("delete"==ref){var cdispname=Timetracker.util.getClientDisplayName(!0,!0),extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[cdispname]),body:ZPI18N.getString("zp.common.delEntityInfo2",[cdispname])};Timetracker.Util.confirmpopUp(data.clientId,Timetracker.clients.deleteClient,data.clientId,void 0,extraDtls)}else if("CRM"==ref){var type=$(ele).attr("type");type=-1==type?3:type;Timetracker.clients.viewCRMClient(data.referenceId,["Accounts","Contacts","Potentials","Leads"][type])}else if("checkbox"==ref)Timetracker.clients.checkParticularClient(ele,"client-listtbody",settingsPage.container);else{if("contact"==ref)return;"edit"==ref?Timetracker.forms.showForm(Timetracker.constants.EDIT,data.clientId):"view"==ref&&Timetracker.forms.showForm(Timetracker.constants.VIEW,data.clientId)}}else"addClient"==ref?window.location.href="#"+settingsUrlProps.niceUrl.replace("listview","add"):"view_close"==ref?Timetracker.views.isSystemView()?(settingsPage.container.find("#clientlist").children("table").find("input[type='checkbox']:checked").prop("checked",!1),settingsPage.container.find("#zp_view_record_delete").removeClass("opn").fadeOut(200,function(){$(this).siblings("#zp_views_formrecactions").fadeIn(200)})):ZP5Views.currViewObj.showRecordActions(!1):"bulk_delete"==ref?Timetracker.views.multiSelectActions.deleteMultiRecords():"fullScreen"==ref?($("body").toggleClass("zpl_newsrcn"),Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").hasClass("zpl_act")?Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.maximize")).toggleClass("zpl_act"):Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.minimize")).toggleClass("zpl_act")):"exitFullScreen"==ref&&($("body").removeClass("zpl_newsrcn"),Layout.Page.container.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.maximize")).removeClass("zpl_act"))},initClientList:async function(){if(Timetracker.permissionCheckForOperPages()){Timetracker.initSetup(),await Timetracker.CRM.getIntegDetails(),Timetracker.clients.isFromOperations=!0,Timetracker.clients.pageLayout=settingsPage.container,Timetracker.clients.Listing.constructOperationView();var url=Timetracker.clients.isFromOperations?settingsUrlProps.niceUrl:Layout.Page.hash;if(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryView)||Timetracker.forms.isPermAllowed(Timetracker.constants.CLIENT_TABLE,"VIEW")){if(-1!==url.indexOf("/clients/add")||-1!==url.indexOf("/clients/edit")||-1!==url.indexOf("/clients/view")){var addEditJson=null;Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,"P_ClientDetails"),(addEditJson={formId:Timetracker.clients.formDetails.formId,tableName:"P_ClientDetails",callback:Timetracker.forms.showListView,isEmbed:!0}).formMode="ADD",-1!==url.indexOf("/clients/edit")?(addEditJson.recordId=Layout.Page.urlparam.recordId,addEditJson.formMode="EDIT"):-1!==url.indexOf("/clients/view")&&(addEditJson.recordId=Layout.Page.urlparam.recordId,addEditJson.formMode="VIEW",addEditJson.editCallback=Timetracker.forms.editFormFromView,addEditJson.disableSingleEdit=!0),null!==addEditJson&&(ZP5Form.isQuickAdd=!1,ZP5Form.formid=0,ZP5Form.load(addEditJson))}else if(-1!==url.indexOf("/clients/listview")){var layout=null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container;0===layout.find("#clientlist,#zp_empty_data").length||!Timetracker.clients.clientsPopulated||Timetracker.clients.refreshData?(layout.find("#zp_empty_data,#clientlist").hide(),Timetracker.clients.fetchData=!0,Timetracker.clients.getClientList(),Layout.Page.container.find("#zp_clients").show(),Timetracker.clients.clientsPopulated=!0,Timetracker.clients.refreshData=!1,Timetracker.Filters.Util.resetPropAndSearch("project_client_filter"),Timetracker.util.addClientCheck()):(Layout.Page.container.scrollTop(0),ZPeople.FireScroll.reset(Timetracker.constants.MODES.CLIENTSOP_LISTVIEW))}}else Timetracker.util.appendPermissionDenied()}},getParamsToFetchClients:function(sorterObj){var layout=null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container,params={mode:"getClientList",conreqcsr:csrfToken,fetchRecPerm:!0};return void 0!==sorterObj&&null!==sorterObj?(Timetracker.clients.sorterObj={},params.sortType=Timetracker.clients.sorterObj.sortType=$(sorterObj).attr("type"),$(sorterObj).hasClass("asc")?params.isAscending=Timetracker.clients.sorterObj.isAscending=!1:params.isAscending=Timetracker.clients.sorterObj.isAscending=!0,layout.find("[id^='clientSort']").removeClass("asc desc"),layout.find("[id^='clientSort']").attr("title",ZPI18N.getString("zp.sortbyasc")),params.isAscending?($(sorterObj).addClass("asc"),$(sorterObj).attr("title",ZPI18N.getString("zp.sortbydesc"))):($(sorterObj).addClass("desc"),$(sorterObj).attr("title",ZPI18N.getString("zp.sortbyasc")))):null!==Timetracker.clients.sorterObj?(params.sortType=Timetracker.clients.sorterObj.sortType,params.isAscending=Timetracker.clients.sorterObj.isAscending):(Timetracker.Util.getSortAscendingValues(Timetracker.constants.CLIENT,params),layout.find("[id^='clientSort']").removeClass("asc desc"),params.isAscending?(layout.find("#clientSort"+params.sortType).addClass("asc"),layout.find("#clientSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbydesc"))):(layout.find("#clientSort"+params.sortType).addClass("desc"),layout.find("#clientSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbyasc")))),params.sIndex=0,params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,params},getClientList:function(sorterObj){var layout=null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container;layout.find("#clientlist").off("scroll"),layout.find("#clientlist").scrollTop(0),layout.find("#clientlist").hide(),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading();var mode=Timetracker.constants.MODES.CLIENTSOP_LISTVIEW;Timetracker.FireScroll.resetDataOnLoad(mode),layout.find("[bid=client_checkallbox]").prop("checked",!1),layout.find("#client_multischdel").addClass("DN").siblings().removeClass("DN");var params=Timetracker.clients.getParamsToFetchClients(sorterObj);void 0!==sorterObj&&null!==sorterObj?(layout.find("[id^='clientSort']").removeClass("desc asc"),layout.find("[id^='clientSort']").attr("title",ZPI18N.getString("zp.sortbyasc")),params.isAscending?($(sorterObj).addClass("asc"),$(sorterObj).attr("title",ZPI18N.getString("zp.sortbydesc"))):($(sorterObj).addClass("desc"),$(sorterObj).attr("title",ZPI18N.getString("zp.sortbyasc")))):(layout.find("[id^='clientSort']").removeClass("desc asc"),params.isAscending?(layout.find("#clientSort"+params.sortType).addClass("asc"),layout.find("#clientSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbydesc"))):(layout.find("#clientSort"+params.sortType).addClass("desc"),layout.find("#clientSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbyasc"))));var json={};json.url=Timetracker.constants.URL,json.params=params,json.callback=Timetracker.clients.getclientListCallback,Timetracker.Request.send(json)},loadMoreDataInClientsListView:function(result){if(result&&result.res&&result.clientArr&&result.clientArr.length>0)Timetracker.clients.constructTable(result.clientArr);else{result.errorCode&&Timetracker.util.showAlert(Timetracker.constants.RESPONSE_CODES.FAILURE,Timetracker.Util.getFailureMessageByCode(result.errorCode));var layout=null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container;if(0===layout.find("#clientlist").find("tbody[id=client-listtbody]").find("tr").length){layout.find("#clientlist").hide();var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.clientDispName]);Timetracker.util.checkAddClientPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.clientDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getClientDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg,divId:"zp_views_list_container"})}}Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.CLIENTSOP_LISTVIEW,result.clientArr)},getclientListCallback:function(resultData,params){if(resultData&&resultData.res&&resultData.clientArr){var layout=null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container;layout.find("#client-listtbody").html("");var response=resultData.clientArr;if(0==layout.find("#clientlist").length&&Timetracker.clients.constructClientViewTable(),layout.find("#zp_empty_data").hide(),0===response.length){var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.clientDispName]);Timetracker.util.checkAddClientPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.clientDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getClientDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg}),layout.find("#zp_empty_data").show()}else Timetracker.clients.constructTable(response),layout.find("#clientlist").show().scrollTop(0);Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.CLIENTSOP_LISTVIEW,Timetracker.constants.URL,params,Timetracker.clients.loadMoreDataInClientsListView,""),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.CLIENTSOP_LISTVIEW,response)}else Timetracker.util.showAlert(Timetracker.constants.RESPONSE_CODES.FAILURE,Timetracker.Util.getFailureMessageByCode(resultData?resultData.errorCode:resultData));Timetracker.util.removeLoading(layout),TimelyZComp.toolTip.intiliaze()},constructTable:function(result){var clientlistLayout=(null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container).find("#client-listtbody");if(result[0]===Timetracker.constants.PERM_DENIED)Timetracker.util.appendPermissionDenied();else{var isCRMRecordFound=!1,thead=clientlistLayout.siblings()[0];isCRMRecordFound=!$(thead).find("tr th:eq(2)").hasClass("DN");var pageCode=Timetracker.Page.getPageModeCode();if($.each(result,function(index,data){data.firstName=data.firstName?data.firstName:"",data.lastName=data.lastName?data.lastName:"",data.email=data.email?data.email:"",data.mobileNo=data.mobileNo?data.mobileNo:"",data.industry=data.industry?data.industry:"",data.referenceType=data.referenceType?data.referenceType:"",data.pageCode=pageCode;var txt=Timetracker.clients.constructClientRow(data);isCRMRecordFound=isCRMRecordFound||""!=data.referenceType,clientlistLayout.append(txt)}),isCRMRecordFound){thead=clientlistLayout.siblings()[0];$(thead).find("tr th:eq(2)").removeClass("DN"),clientlistLayout.find("tr").each(function(){$(this).find("td:eq(2)").removeClass("DN")})}}},constructClientRow:function(rowData){var cntPer=rowData.firstName+" "+rowData.lastName,pageCode=rowData.pageCode?rowData.pageCode:Timetracker.Page.getPageModeCode(),txt='<tr id="trclient_'+rowData.clientId+'">';return txt+='<td ref="skip"><div class="zcheckbox"><input type="checkbox" name="check" value="" ref="checkbox" class="zcheckbox__helper" id="'+pageCode+rowData.clientId+'" recordId="'+rowData.clientId+'"><label class="zcheckbox__label" for="'+pageCode+rowData.clientId+'"></label></div></td>',txt+='<td tabindex="0" scope="row" ref="view" class="zpl_whtspnrml zpl_cp"><span ref="view">'+rowData.clientName+"</span></td>",""===rowData.referenceType?txt+='<td class="DN"></td>':txt+='<td ref="skip"><div class="zpl_flexcolumnalign"><a class="zpl_crmicn" ref="CRM" type="'+rowData.referenceType+'" title="'+ZPI18N.getString("zp.zohocrm")+'"></a></div></td>',txt+='<td><span title="'+cntPer+'">'+cntPer+"</span></td>",txt+='<td><div class="dblerw">',rowData.email&&(txt+='<div><a ref="contact">'+rowData.email+"</a></div>"),txt+='<em ref="contact">'+rowData.mobileNo+"</em></div></td>",txt+='<td><span title="'+rowData.industry+'">'+rowData.industry+"</span></td>",txt+='<td ref="skip">',void 0!==rowData.isDeleteAllowed&&rowData.isDeleteAllowed&&(txt+='<div class="zpl_hvr"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" ref="edit"></i><i title="'+ZPI18N.getString("zp.delete")+'" class="PI_delete" ref="delete"></i></div>'),txt+="</td></tr>",(txt=$(txt)).data(rowData),txt},constructClientViewTable:function(){var layout=null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container;if(0===layout.find("#clientlist").length){var pageCode=Timetracker.Page.getPageModeCode();html='<div class="zpl_tblres" id="clientlist" scroll="enabled" style="display: none;"><table class="zpl_tbl zpl_nocrsor clm40" role="grid"><thead><tr><th width="50"><div class="zcheckbox"><input type="checkbox" name="check" value="" class="zcheckbox__helper" id="'+pageCode+'ccheckallbox" bid="client_checkallbox" ref="checkall"><label for="'+pageCode+'ccheckallbox" class="zcheckbox__label"></label></div></th><th class="w400" scope="col">'+ZPI18N.getString("zp.clientname")+'<div class="zpl_icncnt"><i class="PI_sort" title="'+ZPI18N.getString("zp.sortbydesc")+'" id="clientSort0" type="0" ref="sort"></i></div></th><th width="5%" scope="col" class="DN"></th><th scope="col">'+ZPI18N.getString("zp.contactperson")+'</th><th scope="col">'+ZPI18N.getString("zp.contactinfo")+'</th><th scope="col">'+ZPI18N.getString("zp.industry")+'</th><th class="mw100"></th></tr></thead><tbody id="client-listtbody"></tbody></table></div>',layout.find(".zpl_rgtcnt").append(html);var sortType=Timetracker.Validations.isDefiniteValue(Timetracker.generalSettings.userBasedSettings.clientSortType)?Timetracker.generalSettings.userBasedSettings.clientSortType:"0";Timetracker.Validations.isDefiniteValue(Timetracker.generalSettings.userBasedSettings.clientSortOrder)&&(layout.find("[id^='clientSort']").removeClass("desc asc"),"1"===Timetracker.generalSettings.userBasedSettings.clientSortOrder?(layout.find("#clientSort"+sortType).addClass("desc"),layout.find("#clientSort"+sortType).attr("title",ZPI18N.getString("zp.sortbyasc"))):(layout.find("#clientSort"+sortType).addClass("asc"),layout.find("#clientSort"+sortType).attr("title",ZPI18N.getString("zp.sortbydesc")))),Timetracker.util.init()}},viewCRMClient:function(refId,type){Timetracker.clients.showExternalPopup(crmurl+"/crm/EntityInfo.do?module="+type+"&id="+refId)},showExternalPopup:function(B,C){var A="https:"===document.location.protocol?"https://":"http://";ExternalFieldName=C,window.open(A+B,"creatorwindow","location=1,status=1,scrollbars=1,width=700,height=600")},getClients:function(elementId,flag,obj,multipleSelections,Erecno,viewEditPermissionType,otherDtls){if(Timetracker.clients.fetchData&&Timetracker.Filters.Util.resetPropAndSearch(elementId+"_"+Timetracker.constants.CLIENT),void 0===Timetracker.Filters.Configuartion.getProperty(elementId+"_"+Timetracker.constants.CLIENT)){var clientDispName=Timetracker.util.getClientDisplayName(),defaultOpt_sel=new Array("billing-client","timerclients"),defaultOpt_Sel_form=new Array("timelogClient","caltimelogClient","jbsch_clientid"),params={mode:"getClientList",conreqcsr:csrfToken,isFromFilter:!0};viewEditPermissionType&&Timetracker.isTTCustomAdmin(viewEditPermissionType)&&(params.viewEditPermissionType=viewEditPermissionType);var orderObj=Timetracker.Util.getSortAscendingValues(Timetracker.constants.CLIENT);if(params.sortType=orderObj.sortType,params.isAscending=orderObj.isAscending,void 0!=Erecno&&null!=Erecno&&"0"!=Erecno&&(params.assignedTo=Erecno),-1!=["timelogClient","caltimelogClient","jbsch_clientid","dayclientselect","weekclientselect","halfmonthclientselect","monthclientselect","timerclients"].indexOf(elementId)&&(params.includeDeptClients=!0,params.includeDivClients=!0),"dayclientselect"===elementId||"weekclientselect"===elementId||"halfmonthclientselect"===elementId||"monthclientselect"===elementId||"locjobschdclientselect"===elementId||otherDtls&&otherDtls.isBulkView){"locjobschdclientselect"===elementId&&(params.fetchOnlyLocationClients=!0,params.assignedto=otherDtls&&otherDtls.locationId?otherDtls.locationId:"0",delete params.assignedTo,delete params.includeDeptClients,delete params.includeDivClients,delete params.includeLocClients);var containerId=$(obj).parents("tr").attr("id");(selJson={elementId:elementId=$(obj).attr("id"),containerId:containerId,entity:Timetracker.constants.CLIENT,params:params}).defSelJson=selJson.initSelJson={id:"0",text:ZPI18N.getString("zp.orgselectlabel",[clientDispName]),html:ZPI18N.getString("zp.select")+" "+clientDispName},void 0!=(clientSelect=Timetracker.zselect.create(!0,selJson))&&clientSelect.setValue(selJson.initSelJson.id),Timetracker.jobs.Filters.gettitle(elementId,containerId)}else{var selJson,clientSelect;(selJson={elementId:elementId,entity:Timetracker.constants.CLIENT,params:params}).defSelJson=selJson.initSelJson={id:"0",text:ZPI18N.getString("zp.allclients"),html:ZPI18N.getString("zp.allclients")},defaultOpt_sel.indexOf(elementId)>=0?selJson.defSelJson=selJson.initSelJson={id:"0",text:ZPI18N.getString("zp.orgselectlabel",[clientDispName]),html:ZPI18N.getString("zp.select")+" "+clientDispName}:defaultOpt_Sel_form.indexOf(elementId)>=0&&(selJson.defSelJson=selJson.initSelJson={id:"0",text:ZPI18N.getString("zp.select"),html:ZPI18N.getString("zp.select")}),multipleSelections&&(selJson.multipleSelections=!0,selJson.maximumSelectionSize=10),Timetracker.UserSpace.isMySpace()&&(selJson.appendTo=Layout.Page.parentContainer),void 0!=(clientSelect=Timetracker.zselect.create(!0,selJson))&&clientSelect.setValue(selJson.initSelJson.id),Timetracker.jobs.Filters.gettitle(elementId)}}},checkParticularClient:function(obj){var clientsSelected=null,layout=null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container;if($(obj).is(":checked")){if((clientsSelected=layout.find("#client-listtbody").find("input[type='checkbox']:checked")).length>200)return $(obj).prop("checked",!1),void Timetracker.util.showAlert(1,ZPI18N.getString("zp.cantselectmorethan200",[Timetracker.clients.formDetails.formDispName]),Timetracker.clients.isFromOperations);clientsSelected.length!==layout.find("#client-listtbody").find("tr").length&&200!=clientsSelected.length||layout.find("[bid=client_checkallbox]").prop("checked",!0),Timetracker.views.multiSelectActions.showHideMultiSelectOper(!0,layout)}else layout.find("[bid=client_checkallbox]").prop("checked",!1),(clientsSelected=layout.find("#client-listtbody").find("input[type='checkbox']:checked")).length<1&&Timetracker.views.multiSelectActions.showHideMultiSelectOper(!1,layout)},showDelete:function(mode,clientId){"multiple"===mode?Timetracker.clients.multiSelectDelete():Timetracker.clients.deleteClient(clientId)},multiSelectDelete:function(){var layout=null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container,clients=layout.find("#client-listtbody").find("input[type='checkbox']:checked");if(clients.length<=0)return Timetracker.util.showAlert(Timetracker.constants.RESPONSE_CODES.WARNING,ZPI18N.getString("zp.noclientstodelete"),Timetracker.clients.isFromOperations),layout.find("[bid=client_checkallbox]").attr("checked",!1),layout.find("#client_multischdel").addClass("DN").siblings().removeClass("DN"),!1;for(var tempids="",i=0;i<clients.length;i++)tempids+=$(clients[i]).attr("recordid"),i!==clients.length-1&&(tempids+=",");Timetracker.clients.deleteClient(tempids)},deleteClient:function(clientIds,extrDtls){var params={mode:"deleteRecords",recordIds:clientIds,formId:Timetracker.clients.formDetails.formId};void 0!==clientIds&&""!==clientIds.trim()&&ZPeople.Request.send(ZP5Form.URL,params,Timetracker.clients.deleteClientResCallback,extrDtls)},deleteClientResCallback:function(response,params,extrDtls){var layout=null!=Timetracker.clients.pageLayout?Timetracker.clients.pageLayout:Layout.Page.container;if(7e3===response.code){var selectedRecIdsLen=params.recordIds.length,deletedRecIdsLen=0;Timetracker.forms.refreshLookupOptions("clients");var clientIds="";if(void 0!==params.recordIds){var ids=params.recordIds;deletedRecIdsLen=ids.length,clientIds=ids.split(",")}var clientStr=clientIds.length>1?Timetracker.util.getClientDisplayName():Timetracker.util.getClientDisplayName(!0),succMsg=ZPI18N.getString("zp.deleted.successfully.msg",[clientStr]);if(selectedRecIdsLen!==deletedRecIdsLen&&(succMsg=ZPI18N.getString("zp.clientsdeletedskip",[clientStr])),Timetracker.util.showAlert(Timetracker.constants.RESPONSE_CODES.SUCCESS,succMsg),extrDtls&&extrDtls.isCustomView&&extrDtls.curViewObj)return void extrDtls.curViewObj.reloadView(!0,!0);for(var i in clientIds)layout.find("#trclient_"+clientIds[i]).remove();if(0===layout.find("#clientlist").find("tbody[id=client-listtbody]").find("tr").length){layout.find("#clientlist").hide();var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.clientDispName]);Timetracker.util.checkAddClientPermVar&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.clientDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getClientDisplayName(!0)])])),Timetracker.Util.showHideNoData({msg:noDataMsg})}else Timetracker.FireScroll.checkAndLoadMoreData(Timetracker.constants.MODES.CLIENTSOP_LISTVIEW,clientIds.length);var id="clientlist";layout.find("[bid=client_checkallbox]").prop("checked",!1),0===layout.find("#"+id).find("tbody").find('input[type="checkbox"]:enabled').length?layout.find("#"+id).find("thead").find('input[type="checkbox"]').attr("disabled",!0):layout.find("#"+id).find("thead").find('input[type="checkbox"]').attr("disabled",!1),Timetracker.views.checkAllCheckBoxes(layout.find("[bid=client_checkallbox]"),"client-listtbody",layout),layout.find("#zp_view_close_selection").trigger("click")}else void 0!==response.message?Timetracker.util.showAlert(Timetracker.constants.RESPONSE_CODES.FAILURE,response.message):Timetracker.util.showAlert(Timetracker.constants.RESPONSE_CODES.SUCCESS,ZPI18N.getString("zp.deleted.successfully.msg",[Timetracker.util.clientDispName]));!0===Timetracker.clients.referenceColumn&&0===layout.find(".ReferenceColumnClients").length&&(Timetracker.clients.referenceColumn=!1,layout.find(".ReferenceColumnClients").addClass("DN"),layout.find(".NoReferenceColumnClients").addClass("DN"),layout.find(".HeaderReferenceColumnClients").addClass("DN"))}},Timetracker.timesheet={TsList:{},currentTsUser:null,currentAppUser:null,timesheetData:{},approvalData:{},userRates:null,tslerecno:null,currentApprover:!1,editListData:null,approverList:{},isApprovalConf:!1,isEmpChooseApp:!1,tempStoreForTimesheetDetails:{},approvalDtls:null,isfromFeeds:!1,FETCHED_MYAPPROVAL_COUNT:0,MAXTIMESHEET_FETCH_COUNT:25,FETCHED_MYTIMESHEET_COUNT:0,MAXAPPROVAL_FETCH_COUNT:20,timesheetTmpDate:null,approvalTmpDate:null,init:function(){TimetrackerOperations.init(),Timetracker.permissionCheckForOperPages()&&Timetracker.timesheet.getTimesheetPage()},getTimesheetPage:function(isLoad){var url=Layout.Page.hash;(void 0==isLoad&&(Timetracker.initSetup(),Timetracker.timesheet.approvalConfig()),TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),-1===url.indexOf("/edittimesheet")&&-1===url.indexOf("/timesheetlist"))?(0==Timetracker.Util.getLayout().find("#timesheetPage").length&&(Timetracker.timesheet.constructTSPage(),TimelyZComp.toolTip.intiliaze(),Timetracker.Util.addEventListner(null,"click",Timetracker.timesheet.clickHandler,!0),Timetracker.timesheet.resetFilter()),Timetracker.timesheet.initTimesheetList()):Timetracker.timesheet.getTimesheetDetails()},initTimesheetList:function(){var layout=Timetracker.Util.getLayout();if(Timetracker.timelogs.originTimelogs)return Timetracker.timesheet.setTimesheetFilterOptions(),void Timetracker.timesheet.constructListData(Timetracker.timelogs.timesheetData,!0);var refreshPage=!!Timetracker.Page.isSelectedUser()&&layout.data("userId")!=Timetracker.Team.getSelectedUser();(0==layout.find("#timesheet-listtbody").children().length||0==layout.find("#timesheetlist,#zp_empty_data").length||Timetracker.timesheet.refreshData||refreshPage)&&(layout.find("#timesheetlist").addClass("zpl_DNI"),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.timesheet.fetchData=!0,Timetracker.timesheet.getTimesheetList(),Timetracker.timesheet.refreshData=!1)},approvalConfig:function(){Timetracker.timesheet.isApprovalConf=ZPeople.Module.MODULE_DATA.timetracker.isApprovalConf,Timetracker.timesheet.isEmpChooseApp=ZPeople.Module.MODULE_DATA.timetracker.isEmpChooseApp,Timetracker.timesheet.isApprovalConf&&Timetracker.timesheet.isEmpChooseApp&&(Timetracker.timesheet.approverList=ZPeople.Module.MODULE_DATA.timetracker.approverList)},isTimesheetExportAllowed:function(){return Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryView)},constructTSPage:function(){var mode=Timetracker.timesheet.Firescroll.getMode(),pageCode=Timetracker.Page.getPageModeCode(),html='<div class="zpl_btnmnu" id="TimesheetHeader"><div class="actn_ovrly" id="timesheet_multi"><div><button class="zlabel zlabel--red zlabel--medium" ref="multi_delete">'+ZPI18N.getString("zp.delete")+'</button></div><i class="PI_cls" ref="view_close"></i></div><div></div><div class="j-cnt-cntr"><div class="zpl_inav"><i class="PI_alft" title="'+ZPI18N.getString("zp.previous")+'" aria-label="'+ZPI18N.getString("zp.common.previous")+'" tabindex="0" id="goToPreviousBtn"></i><i class="PI_monthly" id="tl_datePicker"></i><i class="PI_argt" title="'+ZPI18N.getString("zp.next")+'" aria-label="'+ZPI18N.getString("zp.common.next")+'" tabindex="0" id="goToNextBtn"></i></div><b id="dateNavigatorText"></b></div><div class="zpl_rgt"> <div><select class="select-js" compname="tsapprovalStatus"  searchmode=" " id=""></select></div>'+("Timesheet_team"===mode?'<div compname="dataSelect"><ul class="zpl_grpmnu"><li value="1" aria-label="'+ZPI18N.getString("zp.directreportees")+'" tabindex="0" ><span ref="empFilter">'+ZPI18N.getString("zp.local.Direct")+'</span></li><li class="zpl_act" value="0" aria-label="'+ZPI18N.getString("zp.allsubordinates")+'" tabindex="0"><span ref="empFilter">'+ZPI18N.getString("zp.all")+"</span></li></ul></div>":"")+'<button class="zlabel zlabel--blue zlabel--medium" ref="createTSheet" aria-label="'+ZPI18N.getString("zp.createtimesheet")+'" tabindex="0">'+ZPI18N.getString("zp.createtimesheet")+'</button><i class="zpl_ibg PI_fltr" aria-label="'+ZPI18N.getString("zp.filter")+'" tabindex="0" title="'+ZPI18N.getString("zp.filter")+'" ref="toggleFilter"></i><i class="zpl_ibg PI_more zpl_DNI" title="'+ZPI18N.getString("zp.more")+'" ref="more" id="tsMoreOptionsBtn"></i></div></div>'+TimetrackerOperations.Filters.filterHeaderHtml+'<div class="zpl_rgtcnt"><div class="zpl_tblres" id="timesheetPage"><table class="zpl_tbl clm40" role="grid" id="timesheetlist"><thead><tr><th width="40"><div class="zcheckbox"><input type="checkbox" class="zcheckbox__helper" id="'+pageCode+'checkallbox" bid="ts_checkallbox" ref="checkall"><label class="zcheckbox__label" for="'+pageCode+'checkallbox"></label></div></th><th scope="col">'+ZPI18N.getString("zp.timesheetname")+'</th><th scope="col">'+ZPI18N.getString("zp.employee")+'</th><th scope="col">'+ZPI18N.getString("zp.submittedhrs")+'</th><th scope="col">'+ZPI18N.getString("zp.approvedhrs")+'</th><th scope="col">'+ZPI18N.getString("zp.status")+'</th><th width="80"></th></tr></thead><tbody id="timesheet-listtbody"></tbody></table></div></div>',layout=Timetracker.Util.getLayout(),pageMode=Timetracker.Page.getPageMode();layout.append(html);var details={},ele=layout.find('[compname="tsapprovalStatus"]');details.element=ele,options=[{label:ZPI18N.getString("zp.all"),value:-3},{label:ZPI18N.getString("zp.draft"),value:-2},{label:ZPI18N.getString("zp.pending"),value:-1},{label:ZPI18N.getString("zp.approved"),value:1},{label:ZPI18N.getString("zp.rejected"),value:0}],details.data=options,details.defaultOpt="ts_mydata"==pageMode||Timetracker.Page.isSelectedUser(pageMode)?-3:-1,TimetrackerOperations.Filters.createSelectFieldComponent(details),ele.on("zselectchange",function(event){Timetracker.timesheet.getTimesheetList()});var dateNavigationDtls={};dateNavigationDtls.mode=mode,dateNavigationDtls.containerId=settingsPage.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.displayDateAsText=!0,dateNavigationDtls.navigationCallback=Timetracker.timesheet.getTimesheetList,ZPCommonUtil.DateNavigator.init(dateNavigationDtls),ZPCommonUtil.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPCommonUtil.DateNavigator.TYPE.MONTHLY,ZPCommonUtil.DateNavigator.TENSE.CURRENT);var dateperiod=layout.find("#dateNavigatorText").text();layout.find("#dateNavigatorText").attr({tabindex:"0","aria-label":ZPI18N.getString("zp.common.period")+dateperiod});var callback=function(dateVal,obj,data){settingsPage.container.find("#tl_datePicker").html("");var filterDiv=TimetrackerOperations.Filters.getFilterDiv(),viewType=0!=filterDiv.find("[compname='period']").length?TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find("[compname='period']")):2,extraDtls={},hideDateNav=!1;if(1==viewType||4==viewType)extraDtls.from=data.fromDate,extraDtls.to=data.toDate,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.WEEKLY;else if(6==viewType){var calDiv=settingsPage.container.find("#tl_datePicker");if("fromcalendar"==obj.calcontId)return obj.clickedEle&&($(obj.clickedEle).closest("tbody").find(".leave").removeClass("leave"),$(obj.clickedEle).addClass("leave")),void calDiv.data({fromValue:dateVal});if(void 0==(data=calDiv.data()).fromValue||data.fromValue>dateVal)return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.greaterfromdate"));if(Timetracker.DateTime.getDateDiff(data.fromValue,dateVal)>31)return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.datewithindays",["31"]));extraDtls.from=data.fromValue,extraDtls.to=dateVal,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.CUSTOM,hideDateNav=!0}else if(0==viewType||3==viewType)extraDtls.day=dateVal,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.DAILY;else{extraDtls.from=dateVal;var curyear=dateVal.getFullYear(),curmonth=dateVal.getMonth(),toVal=new Date(curyear,curmonth);toVal.setDate(new Date(curyear,curmonth+1,0).getDate()),extraDtls.to=toVal,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.MONTHLY}ZPCommonUtil.DateNavigator.setPeriod(dateNavigationDtls.mode,extraDtls.type,void 0,hideDateNav,extraDtls),Timetracker.timesheet.getTimesheetList()};if(settingsPage.container.find("#tl_datePicker").off().on("click",function(event){var filterDiv=TimetrackerOperations.Filters.getFilterDiv(),viewType=0!=filterDiv.find("[compname='period']").length?TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find("[compname='period']")):2;if(6==viewType)Calendar.setUpDoubleCalendar(event,this,0,void 0,callback);else if(1==viewType||4==viewType)Calendar.setUpCalendar(event,this,void 0,void 0,callback,void 0,{weekselection:!0,constructOnWeekstarts:!0});else{var type=2==viewType||5==viewType?2:0;Calendar.setUpCalendar(event,this,type,void 0,callback,void 0,{constructOnWeekstarts:!0})}}),"ts_operations"==pageMode&&Timetracker.timesheet.isTimesheetExportAllowed()){layout.find("#tsMoreOptionsBtn").removeClass("zpl_DNI");var moreOpt=[{id:"tsExport",name:ZPI18N.getString("zp.export"),callback:"Timetracker.timesheet.showExportTimesheets",iClass:"PI_exprt"}];Timetracker.Util.constructMoreOption(moreOpt,"tsMoreOptions")}else layout.find("#tsMoreOptionsBtn").remove();layout.addClass("zpl_tblfxd zpl_crdwthful"),layout.parent().parent().attr({tabindex:"0","aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.timesheet")])})},constructFilter:async function(){var layout=Timetracker.Util.getLayout();if(0==layout.find("#filterDiv").length){filterOpt={period:{single:!0,label:ZPI18N.getString("zp.period"),defValue:2},fromdate:{label:ZPI18N.getString("zp.fromdate"),type:"input",id:"ts_fromdate"},todate:{label:ZPI18N.getString("zp.todate"),type:"input",id:"ts_todate"},employee:{searchmode:"TIMETRACKER_DATA",currentUser:!0,label:ZPI18N.getString("zp.employee"),id:"tl_emp",paramId:"tslerecno",filterCallback:!0,tokenField:!0},directReportees:{type:"checkbox",checkLabel:ZPI18N.getString("zp.showdirectreportees"),id:"jobsch_includeOnlyDirectSubordinates",paramId:"isDirectSubOnlyNeeded",defValue:!1}};var pageMode=Timetracker.Page.getPageMode();"ts_team"==pageMode||"ts_operations"==pageMode?(filterOpt.department={label:ZPI18N.getString("zp.department"),paramId:"departmentId",tokenField:!0},filterOpt.location={label:ZPI18N.getString("zp.location"),paramId:"locationId",tokenField:!0},Timetracker.generalSettings.isOrgTagEnabled()&&(filterOpt.orgTag={label:ZPeople.orgTagDisplayName,paramId:"orgTagId",tokenField:!0}),filterOpt.designation={label:ZPI18N.getString("zp.designation"),paramId:"designationId",tokenField:!0},isOrgStructureEnabled&&(filterOpt.division={label:ZPeople.orgStructureDispNameMap.division,paramId:"divisionId",tokenField:!0},filterOpt.businessUnit={label:ZPeople.orgStructureDispNameMap.unit,paramId:"businessUnitId",tokenField:!0},filterOpt.legalEntity={label:ZPeople.orgStructureDispNameMap.entity,paramId:"legalEntityId",tokenField:!0}),filterOpt.employeeStatus={label:ZPI18N.getString("zp.local.Employeestatus"),paramId:"employeeStatus",tokenField:!0},"ts_team"==pageMode&&delete filterOpt.directReportees):(delete filterOpt.employee,delete filterOpt.directReportees),await TimetrackerOperations.Filters.constructFilterDiv(filterOpt);var config={calendarIcon:!0,format:dateFmt,picker:!0,spinButtons:"none",clearButton:"none"},filterDiv=layout.find("#filterDiv");ZPeopleComponents.datefield(filterDiv.find("#ts_fromdate"),config),ZPeopleComponents.datefield(filterDiv.find("#ts_todate"),config),$(filterDiv).find(".zpl_search").remove(),$(filterDiv).find(".sel_postion").css("min-height","300px"),filterDiv.find('[compname="period"]').off().on("zselectchange",function(){var container=layout.find("#filterDiv"),preiodDiv=container.find('[compname="period"]');if(6==TimelyZComp.select.getValue(preiodDiv)){if(Timetracker.util.removeErrorMsg("filterDiv"),ZPCommonUtil.DateNavigator.getType(Timetracker.timesheet.Firescroll.getMode())!==ZPCommonUtil.DateNavigator.TYPE.CUSTOM)ZPeopleComponents.datefield(filterDiv.find("#ts_fromdate")).clear(),ZPeopleComponents.datefield(filterDiv.find("#ts_todate")).clear();else{let customPeriodDate=ZPCommonUtil.DateNavigator.getPeriod(Timetracker.timesheet.Firescroll.getMode());void 0!==customPeriodDate.from&&void 0!==customPeriodDate.to&&(ZPeopleComponents.datefield(filterDiv.find("#ts_fromdate")).setValue(customPeriodDate.from),ZPeopleComponents.datefield(filterDiv.find("#ts_todate")).setValue(customPeriodDate.to))}container.find("#ts_fromdate").parent().parent().removeClass("zpl_DNI"),container.find("#ts_todate").parent().parent().removeClass("zpl_DNI")}else container.find("#ts_fromdate").parent().parent().addClass("zpl_DNI"),container.find("#ts_todate").parent().parent().addClass("zpl_DNI")});var empFilter=settingsPage.container.find('[compname="employee"]');0!=empFilter.length&&(empFilter.off().on("ztokenfieldtokenadd ztokenfieldtokenremove",TimetrackerOperations.Filters.filterOnChangeCallback),ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?settingsPage.container.find('[compname="directReportees"]').closest(".zpl_secn").removeClass("zpl_DNI"):settingsPage.container.find('[compname="directReportees"]').closest(".zpl_secn").addClass("zpl_DNI")),Timetracker.timesheet.resetFilter()}layout.find("#filterDiv").find('[compname="period"]').trigger("zselectchange"),TimetrackerOperations.Filters.toggleFilter(),TimelyZComp.toolTip.intiliaze(filterDiv)},clickHandler:function(event){var ele=event.target,ref=$(ele).attr("ref");if("skip"!=ref)if(0!=$(ele).closest("tr").length&&"timesheet-listtbody"==$(ele).closest("tbody").attr("id")){var data=$(ele).closest("tr").data();if(0===Object.keys(data).length)return;if("delete"==ref){var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.stimesheet")]),body:ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.stimesheet")])};Timetracker.Util.confirmpopUp(data.recordId,Timetracker.timesheet.deleteTimesheet,data.recordId,0,extraDtls)}else if("checkbox"==ref)Timetracker.timesheet.checkUncheckAllApproval(ele);else{if($(ele).hasClass("zcheckbox__label"))return;var url=settingsUrlProps.niceUrl+"/edittimesheet-formId:"+data.formId+"/recordId:"+data.recordId;void 0!=settingsUrlProps.urlParamsArr.userId&&(url+="/userId:"+settingsUrlProps.urlParamsArr.userId),window.location.href="#"+url}}else if("createTSheet"==ref)Timetracker.timesheet.getCreateTimesheet(1);else if("checkall"==ref)Timetracker.timesheet.checkUncheckAllApproval(ele,!0);else if("toggleFilter"==ref)Timetracker.timesheet.constructFilter();else if("applyFilter"==ref)Timetracker.timesheet.applyFilter();else if("empFilter"==ref)$(ele).parent().hasClass("zpl_act")||($(ele).parent().siblings().removeClass("zpl_act"),$(ele).parent().addClass("zpl_act"),Timetracker.timesheet.getTimesheetList());else if("resetFilter"==ref)Timetracker.timesheet.resetFilter();else if("view_close"==ref){var layout=Timetracker.Util.getLayout();layout.find("#timesheetlist").find("input[type='checkbox']:checked").prop("checked",!1),layout.find("#timesheet_multi").removeClass("opn").fadeOut(200,function(){$(this).siblings().removeClass("zpl_DNI")})}else if("multi_delete"==ref){extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.stimesheets")]),body:ZPI18N.getString("zp.common.delEntityInfo3",[ZPI18N.getString("zp.stimesheets")]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp("timesheet_multi_delete",Timetracker.timesheet.multiSelectDelete,ele,0,extraDtls)}},applyFilter:function(){Timetracker.util.removeErrorMsg("filterDiv"),Timetracker.timesheet.setDateHeader()&&(Timetracker.Util.getLayout().find("#tt_filterResultsHeader.timetracker").addClass("zpl_DNI"),Timetracker.timesheet.getTimesheetList(),TimetrackerOperations.Filters.setFilterHeader(Timetracker.timesheet.removeTopFilter))},resetFilter:function(){var filterDiv=Timetracker.Util.getLayout().find("#filterDiv");Timetracker.util.removeErrorMsg("filterDiv",filterDiv),0!=filterDiv.length&&(TimetrackerOperations.Filters.clearFilters(),filterDiv.find("#ts_fromdate").parent().parent().addClass("zpl_DNI"),filterDiv.find("#ts_todate").parent().parent().addClass("zpl_DNI"),TimelyZComp.select.setValue(filterDiv.find('[compname="period"]'),2),0!=filterDiv.find('[compname="employeeStatus"]').length&&TimelyZComp.tokenField.setValues(filterDiv.find('[compname="employeeStatus"]'),["19","-2","18"]))},removeTopFilter:function(event,clearAll){if(clearAll)Timetracker.timesheet.resetFilter();else{var ele=event.target,entity=$(ele).closest("li").attr("filterno");filterDiv=settingsPage.container.find("#filterDiv"),"directReportees"==entity?filterDiv.find('[compname="'+entity+'"]').prop("checked",!1):TimelyZComp.tokenField.removeAllTokens(filterDiv.find('[compname="'+entity+'"]'))}Timetracker.timesheet.applyFilter()},setDateHeader:function(){var layout=Timetracker.Util.getLayout().find("#filterDiv"),preiodDiv=layout.find('[compname="period"]'),periodtype=TimelyZComp.select.getValue(preiodDiv),type=ZPCommonUtil.DateNavigator.TYPE.MONTHLY,tense=ZPCommonUtil.DateNavigator.TENSE.CURRENT,hideNavigation=!1,customDatePeriod=void 0;switch(periodtype){case"0":type=ZPCommonUtil.DateNavigator.TYPE.DAILY,tense=ZPCommonUtil.DateNavigator.TENSE.CURRENT;break;case"1":type=ZPCommonUtil.DateNavigator.TYPE.WEEKLY,tense=ZPCommonUtil.DateNavigator.TENSE.CURRENT;break;case"3":type=ZPCommonUtil.DateNavigator.TYPE.DAILY,tense=ZPCommonUtil.DateNavigator.TENSE.PREVIOUS;break;case"4":type=ZPCommonUtil.DateNavigator.TYPE.WEEKLY,tense=ZPCommonUtil.DateNavigator.TENSE.PREVIOUS;break;case"5":type=ZPCommonUtil.DateNavigator.TYPE.MONTHLY,tense=ZPCommonUtil.DateNavigator.TENSE.PREVIOUS;break;case"6":if(type=ZPCommonUtil.DateNavigator.TYPE.CUSTOM,tense=void 0,hideNavigation=!0,customDatePeriod={},TimetrackerOperations.Filters.getFormToDatefromPeriodFilter(customDatePeriod,layout,"ts_fromdate","ts_todate","2"),void 0==customDatePeriod.fromDate&&void 0==customDatePeriod.toDate)return!1;customDatePeriod={from:Calendar.parseDate(customDatePeriod.fromDate,uidateFormat),to:Calendar.parseDate(customDatePeriod.toDate,uidateFormat)}}return ZPCommonUtil.DateNavigator.setPeriod(Timetracker.timesheet.Firescroll.getMode(),type,tense,hideNavigation,customDatePeriod),!0},getParamsToFetchTimesheet:function(){var params=Timetracker.timesheet.getDefaultTimesheetParams(),layout=Timetracker.Util.getLayout();if(TimetrackerOperations.Filters.getFormToDatefromPeriodFilter(params,layout.find("#filterDiv"),"ts_fromdate","ts_todate","2"),void 0==params.fromDate||void 0==params.toDate)return null;if(void 0==params.fromDate||void 0==params.toDate)return null;0!=layout.find("#filterDiv").length&&(TimetrackerOperations.Filters.getFilterValues(params),0==params.employeeStatus&&(params.employeeStatus="17,-2,18,19"));var datePeriod=ZPCommonUtil.DateNavigator.getPeriod(Timetracker.timesheet.Firescroll.getMode());void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(params.fromDate=Calendar.formatDate(datePeriod.from),params.toDate=Calendar.formatDate(datePeriod.to)):(params.fromDate=Calendar.formatDate(datePeriod.day),params.toDate=Calendar.formatDate(datePeriod.day)));var appStatusSel=layout.find('[compname="tsapprovalStatus"]');0!==appStatusSel.length&&(((value=ZPeopleComponents.select(appStatusSel).getValue())||""!=value)&&(params.tslstatus=value));var value,dataSel=layout.find('[compname="dataSelect"]');0!==dataSel.length&&0==params.tslerecno&&((value=dataSel.find(".zpl_act").attr("value"))&&1==value&&(params.isDirectSubOnlyNeeded=!0));var pageMode=Timetracker.Page.getPageMode();return"ts_mydata"==pageMode?params.tslerecno=erecno:Timetracker.Page.isSelectedUser(pageMode)?params.tslerecno=Timetracker.Team.getSelectedUser():"ts_team"==pageMode&&(params.pageMode=1),params},getDefaultTimesheetParams:function(){var params={mode:"getTimesheetList",employeeStatus:"19,-2,18",tslstatus:-3,tslerecno:0,conreqcsr:csrfToken,departmentId:0,designationId:"0",locationId:"0",isDirectSubOnlyNeeded:!1,sIndex:0};return params.limit=Timetracker.timesheet.MAXTIMESHEET_FETCH_COUNT,params},getTimesheetList:function(){var layout=Timetracker.Util.getLayout(),filterDiv=TimetrackerOperations.Filters.getFilterDiv();if(0!=filterDiv.length&&"6"==TimelyZComp.select.getValue(filterDiv.find("[compname='period']"))){fromDate=ZPeopleComponents.datefield(filterDiv.find("#ts_fromdate")).getValue().dateString,toDate=ZPeopleComponents.datefield(filterDiv.find("#ts_todate")).getValue().dateString;var resetPeriod=void 0==fromDate||void 0==toDate||!Calendar.isvalidDate(fromDate)||!Calendar.isvalidDate(toDate);if(!resetPeriod){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);resetPeriod=fdate>tdate||Timetracker.DateTime.getDateDiff(fdate,tdate)>31}resetPeriod&&TimelyZComp.select.setValue(filterDiv.find("[compname='period']"),2)}var params=Timetracker.timesheet.getParamsToFetchTimesheet();if(null!=params){layout.off("scroll"),layout.find("#timesheetlist").scrollTop(0),Timetracker.FireScroll.resetDataOnLoad(Timetracker.timesheet.Firescroll.getMode()),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(),TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),Timetracker.timesheet.hideMultiApproveDelete(layout),layout.find("[bid=ts_checkallbox]").prop("checked",!1).prop("disabled",!0),layout.find("#ts_multischdel").addClass("zpl_DNI"),layout.find("#timesheetlist").addClass("zpl_DNI"),Timetracker.Page.isSelectedUser()&&layout.data("userId",Timetracker.Team.getSelectedUser());var json={};json.url=Timetracker.constants.URL,json.params=params,json.callback=Timetracker.timesheet.getTimesheetListCallback,json.otherdetails={layout:layout},Timetracker.Request.send(json)}},getTimesheetListCallback:function(result,params,extraDtls){var layout=extraDtls.layout?extraDtls.layout:Timetracker.Util.getLayout();if(Timetracker.util.removeLoading(layout),result&&result.timesheetArr&&result.timesheetArr.length>0){var tslisttbody=layout.find("#timesheet-listtbody");Timetracker.Util.showHideNoData({remove:!0}),tslisttbody.html("");var pageCode=Timetracker.Page.getPageModeCode(),isCheckBoxEnabled=!1;$.each(result.timesheetArr,function(index,data){data.pageCode=pageCode,isCheckBoxEnabled=isCheckBoxEnabled||data.isDeleteAllowed;var row=Timetracker.timesheet.constructTSRow(data);tslisttbody.append(row)}),layout.find("#timesheetlist").removeClass("zpl_DNI").scrollTop(0),isCheckBoxEnabled&&layout.find("[bid=ts_checkallbox]").prop("disabled",!1),Timetracker.FireScroll.initFireScroll(Timetracker.timesheet.Firescroll.getMode(),Timetracker.constants.URL,Timetracker.timesheet.getParamsToFetchTimesheet(),Timetracker.timesheet.Firescroll.loadMoreData,""),Timetracker.FireScroll.setFetchCount(Timetracker.timesheet.Firescroll.getMode(),result.timesheetArr)}else if(result.errorCode){var flag;flag=result.errorCode!=Timetracker.constants.ERROR_CODES.BUDGET.ER_BUDGET_DATE_CMP,Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(result.errorCode,null,flag)),0===Timetracker.timesheet.FETCHED_MYTIMESHEET_COUNT&&(Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.nojobsfoundforcriteria",[ZPI18N.getString("zp.stimesheets")])+ZPI18N.getString("zp.nodataclickadd",[ZPI18N.getString("zp.stimesheets"),ZPI18N.getString("zp.createtimesheet")]),layout:layout}),layout.find("#timesheetlist").addClass("zpl_DNI"))}else(null==result||void 0==result.timesheetArr||result.timesheetArr&&0==result.timesheetArr.length)&&0===Timetracker.timesheet.FETCHED_MYTIMESHEET_COUNT&&(Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.nojobsfoundforcriteria",[ZPI18N.getString("zp.stimesheets")])+ZPI18N.getString("zp.nodataclickadd",[ZPI18N.getString("zp.stimesheets"),ZPI18N.getString("zp.createtimesheet")]),layout:layout}),layout.find("#timesheetlist").addClass("zpl_DNI"))},constructTSRow:function(data){var isDelAllowed=data.isDeleteAllowed,appHoursTabVal=-2===data.status?"NA":-1===data.status?ZPI18N.getString("zp.waitforapproval"):Calendar.minstohrs(data.approvedTotalHours),appClass="",appTitle="";1!==data.status||data.isPartiallyApproved?1===data.status&&data.isPartiallyApproved?(appClass="ylw",appTitle=ZPI18N.getString("zp.partiallyapproved")):0===data.status?(appClass="red",appTitle=ZPI18N.getString("zp.rejected")):-1===data.status?(appClass="ylw",appTitle=ZPI18N.getString("zp.pending")):-2===data.status&&(appClass="gry9",appTitle=ZPI18N.getString("zp.draft")):(appClass="grn",appTitle=ZPI18N.getString("zp.approved"));var pageCode=data.pageCode?data.pageCode:Timetracker.Page.getPageModeCode(),txt='<tr id="list-'+data.recordId+'"><td ref="skip"><div class="zcheckbox" ref="skip"><input type="checkbox" name="check" value="" ref="checkbox" class="zcheckbox__helper" recordId="'+data.recordId+'" id="'+pageCode+data.recordId+'" '+(isDelAllowed?"":'disabled="true"')+'><label class="zcheckbox__label" for="'+pageCode+data.recordId+'"></label></div></td><td scope="row" tabindex="0" ><span>'+data.timesheetName+"<span></td><td>"+data.employeeId+" "+data.employeeName+"</td><td>"+Calendar.minstohrs(data.totalHours)+"</td><td>"+appHoursTabVal+'</td><td><span class="'+appClass+'">'+appTitle+'</span></td><td ref="skip">'+(isDelAllowed?'<div class="zpl_hvr"><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" ref="delete"></i></div>':"")+"</td>";return(txt=$(txt)).data(data),txt},showExportTimesheets:function(){Timetracker.ImportExport.showExportOptions(Timetracker.timesheet.exportTimesheets,"timesheet",!1,void 0,!0)},exportTimesheets:function(mode,exp_params,downloadType){var params=Timetracker.timesheet.getParamsToFetchTimesheet();if(null!=params){delete params.mode,delete params.conreqcsr,delete params.sIndex,delete params.limit,params.fileType=downloadType;var path=(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+Timetracker.constants.URL+"?mode=exportTimesheets";for(var param in params)path+="&"+param+"="+params[param];Timetracker.ImportExport.submiteFormForExport(path)}},checkUncheckAllApproval:function(ele,checkAllButton){var layout=Timetracker.Util.getLayout();if(checkAllButton){var isChecked=layout.find("[bid=ts_checkallbox]").is(":checked");layout.find("#timesheet-listtbody").find("input[type=checkbox]:not(:disabled)").prop("checked",isChecked)}else{var allTimesheets=layout.find("#timesheet-listtbody").find("input[type=checkbox]"),selectedTimesheets=layout.find("#timesheet-listtbody").find("input[type=checkbox]:checked"),enabledTimesheets=layout.find("#timesheet-listtbody").find("input[type=checkbox]:enabled");selectedTimesheets.length===allTimesheets.length||selectedTimesheets.length===enabledTimesheets.length?layout.find("[bid=ts_checkallbox]").prop("checked",!0):layout.find("[bid=ts_checkallbox]").prop("checked",!1)}0!==(selectedTimesheets=layout.find("#timesheet-listtbody").find("input[type=checkbox]:checked")).length?layout.find("#timesheet_multi").addClass("opn").fadeIn(200,function(){$(this).siblings().addClass("zpl_DNI")}):(checkAllButton&&layout.find("#timesheet-listtbody").find("input[type=checkbox]:not(:disabled)").prop("checked",!1),layout.find("#timesheet_multi").removeClass("opn").siblings().removeClass("zpl_DNI"))},multiSelectDeleteChkboxReset:function(layout){Timetracker.timesheet.hideMultiApproveDelete(layout),0===layout.find("#timesheetlist").find("table tbody").find('input[type="checkbox"]:enabled').length&&1!==layout.find("#timesheetlist").find("table thead").find('input[type="checkbox"]:enabled').length&&layout.find("#timesheetlist").find("table thead").find('input[type="checkbox"]').prop("disabled",!0)},multiSelectDelete:function(obj){obj&&$(obj).attr("disabled",!0);for(var layout=Timetracker.Util.getLayout(),selectedTimesheets=layout.find("#timesheet-listtbody").find("input[type=checkbox]:checked"),recordArr=new Array,ind=0;ind<selectedTimesheets.length;ind++){var timesheetData=$(selectedTimesheets[ind]).parents("tr").data(),cri=-2===timesheetData.status||Timetracker.isDataAdminForUser(timesheetData.erecno)||Timetracker.isTTCustomAdminForUser(Timetracker.constants.TTCustomAdmin.EntryEdit,timesheetData.erecno);0!==Object.keys(timesheetData).length&&cri&&recordArr.push(timesheetData.recordId)}0!=recordArr.length?Timetracker.timesheet.deleteTimesheet(recordArr.join(",")):(Timetracker.util.showAlert(1,ZPI18N.getString("zp.notimesheetstodelete")),Timetracker.timesheet.multiSelectDeleteChkboxReset(layout))},deleteTimesheet:function(listId){var layout=Timetracker.Util.getLayout(),params={mode:"deleteTimesheetList",timesheetId:listId,conreqcsr:csrfToken};$.post(Timetracker.constants.URL,params,function(resultData){if("0"===resultData.res){var message=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);Timetracker.util.showAlert(0,message),Timetracker.timesheet.multiSelectDeleteChkboxReset(layout)}else{var response=resultData.resObj,deletedTimesheetIds=response.deletedTimesheetIds,givenTimesheetIds=listId.trim().split(",");if(deletedTimesheetIds.length>0){for(var refreshList=layout.find("#timesheet-listtbody").children().length>=Timetracker.timesheet.MAXTIMESHEET_FETCH_COUNT,i=0;i<deletedTimesheetIds.length;i++)layout.find("#timesheet-listtbody").find("#list-"+deletedTimesheetIds[i]).remove();refreshList&&!1===ZPeople.FireScroll.getFireScrollPropertie(Timetracker.timesheet.Firescroll.getMode()).triggered?Timetracker.timesheet.getTimesheetList():0===layout.find("#timesheet-listtbody").find("tr").length&&(Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.nojobsfoundforcriteria",[ZPI18N.getString("zp.stimesheets")])+ZPI18N.getString("zp.nodataclickadd",[ZPI18N.getString("zp.stimesheets"),ZPI18N.getString("zp.createtimesheet")])}),layout.find("#timesheetlist").addClass("zpl_DNI"))}var isError=!1;message=1==deletedTimesheetIds.length?ZPI18N.getString("zp.deleted.successfully.msg",[ZPI18N.getString("zp.timesheet")]):ZPI18N.getString("zp.timesheetdeleted");deletedTimesheetIds.length<givenTimesheetIds.length&&(message=ZPI18N.getString("zp.timesheetdelerror"),isError=!0),1===givenTimesheetIds.length?response.skippedInfo&&(isError=!0,response.skippedInfo.payperiodErrorIds?message=ZPI18N.getString("zp.singletimesheetdelpayperioderror"):response.skippedInfo.budgetErrorIds&&(message=ZPI18N.getString("zp.singletimesheetdelbudgeterror"))):response.skippedInfo&&(isError=!0,response.skippedInfo.payperiodErrorIds?message=ZPI18N.getString("zp.timesheetdelpayperioderror"):response.skippedInfo.budgetErrorIds&&(message=ZPI18N.getString("zp.timesheetdelbudgeterror"))),isError?Timetracker.util.showAlert(0,message):Timetracker.util.showAlert(2,message),Timetracker.timelogs.refreshData=!0,Timetracker.UserSpace.Timelogs.isRefreshNeeded=!0,Timetracker.UserSpace.Timesheets.refreshData=!0,Timetracker.timelogs.calendar.refreshData=!0,Timetracker.timesheet.hideMultiApproveDelete(layout),0===layout.find("#timesheetlist").find("table tbody").find('input[type="checkbox"]:enabled').length&&1!==layout.find("#timesheetlist").find("table thead").find('input[type="checkbox"]:enabled').length&&layout.find("#timesheetlist").find("table thead").find('input[type="checkbox"]').prop("disabled",!0)}})},hideMultiApproveDelete:function(layout){layout.find("[bid=ts_checkallbox]").prop("checked",!1),layout.find("input[id=zp_approval_check]:checked").prop("checked",!1),layout.find("#timesheet_multi").find("button").attr("disabled",!1),layout.find("#timesheet_multi").removeClass("opn").siblings().removeClass("zpl_DNI")},getTimesheetPopup:function(layout){if(0!=(layout=layout&&0!=layout.length?layout:Timetracker.Util.getLayout()).find("#timesheet_view_create").length){var modal=layout.find("#timesheet_view_create");return ModuleComp.Modal.show(modal),modal}var header='<div><a class="clsArw" id="timesheet_create_back" onclick="Timetracker.timesheet.showCreateTimesheet(true);"><i class="PI_back"></i></a><div class="zpl_em"><div class="zpl_emimg"><img id="timesheet_uimg"></div><div class="zpl_emdts"><div id="timesheet_uname"></div></div></div><span id="timesheet_date"></span></div><span class="zpl_mhderrgt"><div id="headerApprovalBtn"></div><button class="zlabel zlabel--blue zlabel--outline zlabel--medium zpl_DNI" id="zp_appproval_comment_btn" onclick="ZPApprovals.getApprovalDetails()">'+ZPI18N.getString("zp.view")+'</button><a class="PI_print zpl_btnic" title="'+ZPI18N.getString("zp.print")+'" id="timesheet_create_moreopt" onclick="Timetracker.timesheet.printTimesheet()"></a><a class="PI_audit zpl_btnic" id="zp_tt_audithistory" title="'+ZPI18N.getString("zp.audithistory")+'"></a></span><a class="_cls PI_cls" title="'+ZPI18N.getString("zp.close")+'"></a>',mainbody='<div class="zpl_crd wd100_per"><div class="zpl_crdhdr"><div class="zpl_crdcnt"><div class="d-flex j-cnt-btwen">'+('<div><div class="zpl_secn"><div><label class="zpl_mtry" for="timesheet_name" tabindex="0">'+ZPI18N.getString("zp.timesheetname")+'</label></div><div><input type="text" class="ztextbox w400" id="timesheet_name"></div></div><div class="zpl_secn "><div><label for="timesheet_desc" tabindex="0">'+ZPI18N.getString("zp.description")+'</label></div><div><textarea class="ztextbox w400" rows="2" id="timesheet_desc"></textarea></div></div><div class="zpl_secn"><div><label for="timesheetBeforeUpload" tabindex="0">'+ZPI18N.getString("zp.attachment")+'</label></div><div class="zpl_DNI" id="timesheetBeforeUpload"><div class="zpl_upld tmpslct"><div class="zpl_fldrp"><input type="file" id="timesheet_attach_file" class="zpl_DNI" onchange="Timetracker.util.addFileNameAttachment(this,\'Desktop\');" istabular="false" value="" name="Attachment"><h5><a class="zpl_lnk" onclick="$(\'#timesheet_attach_file\').trigger(\'click\')"><i class="PI_desktop"></i>'+ZPI18N.getString("zp.files.desktop")+"</a>/"+(isWorkdriveAllowed?'<a class="zpl_lnk" onclick="WorkDriveInt.showWorkDriveModal(\'TT_Timesheets\')"><i class="PI_workdrive zpl_icnobg"></i>'+ZPI18N.getString("zp.workdrive")+"</a>/ ":"")+'<a class="zpl_lnk" onclick="Timetracker.timesheet.cloudInit()"><i class="PI_cloud"></i>'+ZPI18N.getString("zp.others")+'</a></h5></div></div></div><div class="zpl_atchd zpl_DNI"  id="timesheetAfterUpload"></div><div id="zp_timesheet_file_disp"><a id="file_name"></a></div><div><a class ="zpl_lnkbg zpl_DNI" id="file_name_change" onclick="Timetracker.util.removeFileAttachment()">'+ZPI18N.getString("zp.changefile")+'</a></div></div><div class="zpl_secn"><div><label id="timesheet_logsName" for="timesheet_logsValue" tabindex="0"></label></div><div><div class="zpl_cstnmes" id="timesheet_logsValue"></div></div></div><div class="zpl_secn w400 zpl_DNI" id="sendappdiv"><div><label>'+ZPI18N.getString("zp.selectapprover")+'</label></div><div><select class="select-js" id="empChoosenApprErecno" placeholder="'+ZPI18N.getString("zp.selectapprover")+'"></select></div></div></div>')+('<div><div class="zpl_gbox"><table class="zpl_itbl zpl_nocrsor"><tbody id="ts_hoursBanner"><tr><td></td><td><em id="tsapproval-subdata">'+ZPI18N.getString("zp.submittedhrs")+'</em></td><td><em id="tsapproval-appdata">'+ZPI18N.getString("zp.approvedhrs")+'</em></td></tr><tr><td><div class="d-flexclmcap10 a-itm-cntr"><span class="zpl_lbdr lv_bg1"></span><span>'+ZPI18N.getString("zp.billtimelogs")+'</span></div></td><td id="timesheet_billhours"></td><td id="apptimesheet_billhours"></td></tr><tr><td><div class="d-flexclmcap10 a-itm-cntr"><span class="zpl_lbdr lv_bg2"></span><span>'+ZPI18N.getString("zp.nonbilltimelogs")+'</span></div></td><td id="timesheet_nonbillhours"></td><td id="apptimesheet_nonbillhours"></td></tr><tr><td><div class="d-flexclmcap10 a-itm-cntr"><span class="zpl_lbdr lv_bg3"></span><span>'+ZPI18N.getString("zp.paidbreak")+'</span></div></td><td id="timesheet_paidBrkhours"></td><td id="apptimesheet_paidBrkhours"></td></tr><tr><td><div class="d-flexclmcap10 a-itm-cntr"><span class="zpl_lbdr lv_bg4"></span><span>'+ZPI18N.getString("zp.unpaidbreak")+'</span></div></td><td id="timesheet_unpaidBrkhours"></td><td id="apptimesheet_unpaidBrkhours"></td></tr><tr><td><b>'+ZPI18N.getString("zp.totalhours")+'</b></td><td><b id="timesheet_totalhours"></b></td><td><b id="apptimesheet_totalhours"></b></td></tr></tbody></table></div></div>')+'</div></div></div></div><div class="zpl_secn"><div class="zpl_flex zpl_DNI"><button type="button" class="zlabel zlabel--blue zlabel--medium zlabel--outline zpl_ml-auto" id="ts_tladd">'+ZPI18N.getString("zp.logtime")+'</button></div><div class="zpl_tmln zpl_adhstry zpl_tsheetlst" id="tsdatatbody"></div></div>',tot_amnt_formula='<div id="ts_totalamnt_formula" class="zpl_secn"><p class="zpl_info"><em>'+ZPI18N.getString("zp.totalamount")+" = "+ZPI18N.getString("zp.totalpayablehours")+" * "+ZPI18N.getString("zp.tt.emloyeeRPH.rateperhour")+"</em></p></div>",body='<div class="zpl_mmnu"><div class="zpl_mmnurgt"><div class="zpl_act">'+mainbody+('<div class="zpl_crd zpl_tsheetcalc wd100_per"><div class="zpl_crdcnt "><div class="fl-rgt"><table class="zpl_itbl zpl_nocrsor w400"><tbody><tr><td class="mw200"><b id="timesheet_totaltext">'+ZPI18N.getString("zp.totalpayablehours")+'</b></td><td class="mw200"><span id="timesheetbill_hours"></span></td></tr><tr id="ts_ratePerHour"><td><b>'+ZPI18N.getString("zp.tt.emloyeeRPH.rateperhour")+'</b></td><td><span id="timesheetbill_rate"></span><em id="timesheetbill_ratecur"></em></td></tr><tr id="ts_totalamt"><td><b>'+ZPI18N.getString("zp.totalamount")+'</b></td><td><b id="timesheetbill_amount"></b><em id="timesheetbill_amountcur"></em></td></tr></tbody></table>'+tot_amnt_formula+"</div></div></div>")+"</div></div></div>",footer='<div class="zpl_mfoter d-flexclmcap"><div class="d-flexC flexclmcap12 zpl_DNI" id="zp_approvereject_box"><div><label>'+ZPI18N.getString("zp.lms.approvals.addComment")+'</label></div><div class="flex-grow"><textarea type="text" rows="4" class="ztextbox" id="zp_approval_comment" placeholder="'+ZPI18N.getString("zp.writeacomment")+'"></textarea></div></div><div class="zpl_btnsplt"><div id="createtsbutton"><button class="zlabel zlabel--blue zlabel--outline zlabel--medium" type="button" id="timesheet_draft_submit" aria-label="'+ZPI18N.getString("zp.saveasdraft")+'" tabindex="0" onclick="Timetracker.timesheet.createTimesheetList();">'+ZPI18N.getString("zp.saveasdraft")+'</button><button id="timesheet_create_submit" class="zlabel zlabel--blue zlabel--medium zpl_DNI" type="button"  aria-label="'+ZPI18N.getString("zp.sendforapproval")+'" tabindex="0" onclick="Timetracker.timesheet.createTimesheetList(true);">'+ZPI18N.getString("zp.sendforapproval")+'</button><button id="timesheet_create_cancel" class="zlabel zlabel--outline zlabel--medium" type="button" aria-label="'+ZPI18N.getString("zp.close")+"."+ZPI18N.getString("zp.common.cancelpopup")+"\" tabindex=\"0\" onclick=\"$(this).parents('#timesheet_view_create').find('.zpl_mhder .PI_cls').trigger('click')\">"+ZPI18N.getString("zp.close")+'</button></div><div class="zpl_DNI" id="approvetsbutton"><button id="zp_appproval_approve_btn" name="approvalTypeBtn" class="zlabel zlabel--blue zlabel--medium" approvaltype="1"  onclick="Timetracker.timesheet.showHideApproveRejCommentBox(this)">'+ZPI18N.getString("zp.approve")+'</button><button id="zp_appproval_approveall_btn" name="approvalTypeBtn" class="zlabel zlabel--blue zlabel--medium" approvaltype="2"  onclick="Timetracker.timesheet.showHideApproveRejCommentBox(this)">'+ZPI18N.getString("zp.approveall")+'</button><button id="zp_appproval_reject_btn" name="approvalTypeBtn" class="zlabel zlabel--red zlabel--medium" approvaltype="0" onclick="Timetracker.timesheet.showHideApproveRejCommentBox(this)">'+ZPI18N.getString("zp.reject")+'</button><button name="approvalTypeBtn" class="zlabel zlabel--outline zlabel--medium" type="button" onclick="$(this).parents(\'#timesheet_view_create\').find(\'.zpl_mhder .PI_cls\').trigger(\'click\')">'+ZPI18N.getString("zp.close")+'</button><button name="confirmTypeBtn" class="zlabel zlabel--blue zlabel--medium zpl_DNI" id="zp_appproval_confirm_btn" onclick="Timetracker.timesheet.approveRejectConfirm()">'+ZPI18N.getString("zp.confirm")+'</button><button name="confirmTypeBtn" class="zlabel zlabel--outline zlabel--medium zpl_DNI" onclick="Timetracker.timesheet.showHideApproveRejCommentBox(this, true)">'+ZPI18N.getString("zp.cancel")+'</button></div><div class="zpl_viewdays" id="ts_leaveTypes"><div class="zpl_dytyp lv_bdr5" id="ts_unpaid"><span>'+ZPI18N.getString("zp.unpaidleave")+'</span></div><div class="zpl_dytyp lv_bdr4" id="ts_absent"><span>'+ZPI18N.getString("zp.absent")+'</span></div><div class="zpl_dytyp lv_bdr7" id="ts_paid"><span>'+ZPI18N.getString("zp.paidleave")+'</span></div><div class="zpl_dytyp lv_bdr9" id="ts_weekend"><span>'+ZPI18N.getString("zp.weekend")+'</span></div><div class="zpl_dytyp lv_bdr3" id="ts_onDuty"><span>'+ZPI18N.getString("zp.onduty")+'</span></div><div class="zpl_dytyp lv_bdr1" id="ts_holiday"><span>'+ZPI18N.getString("zp.holiday")+"</span></div></div></div></div>",modalClass="zpl_mfull"+(Timetracker.timesheet.isfromFeeds?" zpl_ntzindx":"");return(modal=ModuleComp.Modal.setup({id:"timesheet_view_create",type:1,headerHtml:header,body:body,footer:footer,backdrop:!0,closeOnSubmit:!1,modalClass:modalClass,buttonValue:ZPI18N.getString("zp.next"),hiddenCallback:Timetracker.timesheet.closeTimsheetPage,deleteOnHide:!0,LayerId:layout[0].id,closeonEsc:!0})).find(".zpl_minr").focus(),modal},cloudInit:function(){CloudPicker.init("",Timetracker.timesheet.cloudCallback,"TT_Timesheets"),CloudPicker.construct(ZPeople.cloudPickerGadgetsUrl)},cloudCallback:function(){var docObj=CloudPicker.getFileObj();try{docObj=JSON.parse(docObj)}catch(error){return void ZPeople.Message.failure(ZPI18N.getString("zp.photovalidationservererror"))}Timetracker.util.addFileNameAttachment(docObj,"cloudUpload")},createTimesheetList:function(sendforapproval){Timetracker.util.freezeSubmit("timesheet_view_create","timesheet_draft_submit"),Timetracker.util.freezeSubmit("timesheet_view_create","timesheet_create_submit"),Timetracker.util.removeErrorMsg("timesheet_view_create");var layout=Timetracker.Util.getLayout().find("#timesheet_view_create"),tscheck=!1,tsName=layout.find("#timesheet_name").val().trim(),tsDesc=layout.find("#timesheet_desc").val();if(""===tsName?(tscheck=!0,layout.find("#timesheet_name").parent().find(".error-msg").length<1&&(layout.find("#timesheet_name").parent().append('<div class="ztextbox--error__label">'+ZPI18N.getString("zp.timesheetnameemptyalert")+"</div>"),layout.find("#timesheet_name").addClass("ztextbox__error"))):tsName.length>100&&(tscheck=!0,layout.find("#timesheet_name").parent().find(".error-msg").length<1&&(layout.find("#timesheet_name").parent().append('<div class="ztextbox--error__label">'+ZPI18N.getString("zp.namecharlimit",["Timesheet Name","100"])+"</div>"),layout.find("#timesheet_name").addClass("ztextbox__error"))),tsDesc.length>5e3&&(tscheck=!0,layout.find("#timesheet_desc").parent().find(".error-msg").length<1&&(layout.find("#timesheet_desc").parent().append('<div class="ztextbox--error__label">'+ZPI18N.getString("zp.namecharlimit",["Description","5000"])+"</div>"),layout.find("#timesheet_desc").addClass("ztextbox__error"))),tscheck)return Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_draft_submit"),Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_create_submit"),!1;var mode="createTimesheetList",formData=new FormData;formData.append("timesheetName",tsName),formData.append("description",tsDesc),formData.append("conreqcsr",csrfToken);var paramsJson={timesheetName:tsName,description:tsDesc};if(-1!==Layout.Page.hash.indexOf("/edittimesheet")||-1!==Layout.Page.hash.indexOf("/timesheetlist")||Timetracker.timesheet.isfromFeeds||Timetracker.UserSpace.isMySpace()&&0!==layout.find("#tsdatatbody").length&&void 0!==layout.find("#tsdatatbody").attr("recordId")){mode="modifyTimesheetList";var listId=layout.find("#tsdatatbody").attr("recordId");formData.append("timesheetId",listId),paramsJson.timesheetId=listId,null!==Timetracker.timesheet.editListData&&0===Timetracker.timesheet.editListData.status&&(formData.append("isResubmit","true"),paramsJson.isResubmit="true")}else formData.append("userErecNo",Timetracker.timesheet.TsList.userErecNum),formData.append("fromDate",Timetracker.timesheet.TsList.fromDate),formData.append("toDate",Timetracker.timesheet.TsList.toDate),Timetracker.UserSpace.isMySpaceActionList()||(formData.append("clientId",Timetracker.timesheet.TsList.clientId),formData.append("projectId",Timetracker.timesheet.TsList.projectId),formData.append("jobId",Timetracker.timesheet.TsList.jobId),formData.append("billableStatus",Timetracker.timesheet.TsList.billStatus));if(formData.append("mode",mode),paramsJson.mode=mode,Timetracker.timesheet.isApprovalConf&&1==sendforapproval){if(layout.find("#tsdatatbody").find("tr").length<1)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.approvalalert2")),Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_draft_submit"),Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_create_submit"),!1;if(formData.append("sendforApproval","true"),paramsJson.sendforApproval="true",Timetracker.timesheet.isEmpChooseApp){layout.find("#empChoosenApprErecno").parent().find("#error_div").remove();var empApprover=TimelyZComp.select.getValue(layout.find("#empChoosenApprErecno"));if(""===empApprover||"0"==empApprover)return TimelyZComp.select.setAttributes(layout.find("#empChoosenApprErecno"),{className:"ztextbox__error"}),layout.find("#empChoosenApprErecno").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.selectapprover")+"</span>"),Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_draft_submit"),Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_create_submit"),!1;var empChoosenApprErecno=empApprover;formData.append("empChoosenApprErecno",empChoosenApprErecno)}}else 0===layout.find("#timesheetlist").find("table thead").find('input[type="checkbox"]:enabled').length&&layout.find("#timesheetlist").find("table thead").find('input[type="checkbox"]').prop("disabled",!1);var existingAttachmentName=Timetracker.timesheet.editListData&&Timetracker.timesheet.editListData.attachmentName?Timetracker.timesheet.editListData.attachmentName:"",attachmentElement=layout.find("[id=timesheetAfterUpload]:visible");if(layout.find("[id=timesheetBeforeUpload]:visible").length>0)""!==existingAttachmentName&&formData.append("removeAttachment","true");else{var attachmentType=$(attachmentElement).data("uploadType"),attachment=$(attachmentElement).data("fileUploadData");if(attachment)if("Desktop"===attachmentType){if(attachment.name&&(-1!==attachment.name.indexOf("<")||-1!==attachment.name.indexOf(">")))return Timetracker.util.showAlert(1,ZPI18N.getString("zp.projectattachmentnameerror")),Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_draft_submit"),Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_create_submit"),!1;if(UDS_UPLOAD_IS_ACTIVE)return void Timetracker.util.uploadFile(attachment,Timetracker.constants.TIMELOG,function(uploadResponse){uploadResponse&&uploadResponse.fileInfo?(formData.append("attachmentId",uploadResponse.fileInfo.fileId),formData.append("attachmentName",uploadResponse.fileInfo.fileName),$.ajax({url:Timetracker.constants.URL,type:"POST",data:formData,contentType:!1,processData:!1,success:function(successData){Timetracker.timesheet.createTimesheetCallback(successData,paramsJson)}})):Timetracker.util.showAlert(0,ZPI18N.getString("zp.filenotuploaded"))});formData.append("attachment",attachment)}else if("cloudUpload"===attachmentType||"workDrive"===attachmentType){var attachmentObj=attachment;attachmentObj=JSON.parse(attachmentObj),(attachment=[]).push(attachmentObj),attachment=JSON.stringify(attachment);var key="workDrive"==attachmentType?"workDriveAttachment":"cloudAttachment";attachment.name!==existingAttachmentName&&formData.append(key,attachment)}}$.ajax({url:Timetracker.constants.URL,type:"POST",data:formData,contentType:!1,processData:!1,success:function(successData){Timetracker.timesheet.createTimesheetCallback(successData,paramsJson)}})},createTimesheetCallback:function(response,paramsJson){if(Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_draft_submit"),Timetracker.util.unfreezeSubmit("timesheet_view_create","timesheet_create_submit"),"0"===response.res){var message;message=response.message&&!response.errorCode?response.message:Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0),Timetracker.util.showAlert(0,message)}else{var layout=Timetracker.Util.getLayout().find("#timesheet_view_create");if("true"===paramsJson.sendforApproval)Timetracker.timesheet.isfromFeeds&&"function"==typeof Timetracker.timesheet.approvalCallback&&layout.find("#tsdatatbody").attr("approvalStatus","-1"),Timetracker.util.showAlert(2,ZPI18N.getString("zp.timesheetsubmittedforapproval")),Timetracker.timesheet.approvalData=Timetracker.timesheet.timesheetData={};else{Timetracker.timesheet.isfromFeeds&&"function"==typeof Timetracker.timesheet.approvalCallback&&layout.find("#tsdatatbody").attr("approvalStatus","");var msg=ZPI18N.getString("zp.timesheetcreated");"modifyTimesheetList"===paramsJson.mode&&(msg=ZPI18N.getString("zp.timesheetedited")),Timetracker.util.showAlert(2,msg)}"modifyTimesheetList"===paramsJson.mode?(0!==Object.keys(Timetracker.timesheet.timesheetData).length&&void 0!==Timetracker.timesheet.timesheetData[paramsJson.timesheetId]&&(Timetracker.timesheet.timesheetData[paramsJson.timesheetId].timesheetName=ZPeople.escapeHtml(paramsJson.timesheetName),Timetracker.timesheet.timesheetData[paramsJson.timesheetId].description=ZPeople.escapeHtml(paramsJson.description)),"true"===paramsJson.isResubmit&&(Timetracker.timesheet.timesheetData={},0!=Object.keys(Timetracker.timesheet.approvalData).length&&Timetracker.timesheet.approvalData[paramsJson.timesheetId]&&delete Timetracker.timesheet.approvalData[paramsJson.timesheetId])):Timetracker.timesheet.timesheetData={},Timetracker.timelogs.originTimelogs=!1,Timetracker.timelogs.refreshData=!0,Timetracker.timesheet.refreshData=!0,Timetracker.UserSpace.Timelogs.isRefreshNeeded=!0,Timetracker.timelogs.calendar.refreshData=!0,Timetracker.UserSpace.Timesheets.refreshData=!0,ModuleComp.Modal.hide("timesheet_view_create",!0),Timetracker.UserSpace.isMySpaceActionList()?(Timetracker.Util.getLayout().find("#list-"+paramsJson.timesheetId).remove(),Timetracker.Util.getLayout().find("#createTSCard").remove()):Timetracker.UserSpace.isMySpaceTimesheets()&&Timetracker.UserSpace.Timesheets.init(Timetracker.Util.getLayout(),{erecno:erecno})}},closeTimsheetPage:function(openPage){var layout=Timetracker.Util.getLayout();if(0!=layout.find("#timesheet_view_create").length&&(layout.find("#timesheet_view_create").find("select").each(function(ind,ele){ZPeopleComponents.isComponent(ele)&&TimelyZComp.select.destroy(ele)}),layout.find("#timesheet_view_create").find("input").each(function(ind,ele){ZPeopleComponents.isComponent(ele)&&TimelyZComp.timeField.destroy(ele)})),0!=layout.find("#descPopup").length&&ModuleComp.Modal.hide("descPopup",!0),1!=openPage){if(Timetracker.timelogs.originTimelogs&&Timetracker.timelogs.originUrl)return Timetracker.timelogs.originTimelogs=!1,window.location.href=Timetracker.timelogs.originUrl,void(Timetracker.timelogs.originUrl=void 0);if(Timetracker.timelogs.originTimelogs=!1,Timetracker.timesheet.approvalDtls=Timetracker.timesheet.editListData=null,Timetracker.timesheet.isfromFeeds=!1,"function"==typeof Timetracker.timesheet.approvalCallback){var approvalStatus=layout.find("#tsdatatbody").attr("approvalStatus");Timetracker.timesheet.approvalCallback(layout.find("#tsdatatbody").attr("recordId"),approvalStatus),Timetracker.timesheet.approvalCallback=null}if(-1!=(url=settingsUrlProps.niceUrl).indexOf("/edittimesheet")||-1!=url.indexOf("/timesheetlist"))if(void 0==Timetracker.Page.getPageMode()||-1!=url.indexOf("/timesheetlist"))window.location.href="#timetracker/mydata/timelogs-mode:list";else{var ind=url.indexOf("/edittimesheet"),url=settingsUrlProps.niceUrl.slice(0,ind);void 0!=settingsUrlProps.urlParamsArr.userId&&(url+="-userId:"+settingsUrlProps.urlParamsArr.userId),window.location.href="#"+url}else ModuleComp.Modal.hide("timesheet_view"),Timetracker.UserSpace.isMySpaceTimesheets()?Timetracker.UserSpace.Timesheets.init(Timetracker.Util.getLayout(),{erecno:erecno}):"ts_homeuser"==Timetracker.Page.getPageMode()?Timetracker.UserSpace.Timesheets.init(Timetracker.Util.getLayout(),{erecno:Timetracker.Team.getSelectedUser()}):-1!=url.indexOf("/timesheets")&&Timetracker.timesheet.initTimesheetList()}},showHideApproveRejCommentBox:function(ele,hideCommentBox){var modal=Timetracker.Util.getLayout().find(".zpl_mfoter");if(Timetracker.util.removeErrorMsg(void 0,modal),hideCommentBox)modal.find("#zp_approvereject_box").addClass("zpl_DNI"),modal.find('[name="approvalTypeBtn"]').removeClass("zpl_DNI"),modal.find('[name="confirmTypeBtn"]').addClass("zpl_DNI");else{modal.find("#zp_approvereject_box").removeClass("zpl_DNI"),modal.find('[name="approvalTypeBtn"]').addClass("zpl_DNI"),modal.find('[name="confirmTypeBtn"]').removeClass("zpl_DNI");var type=$(ele).attr("approvaltype");"0"==type?(modal.find("#zp_appproval_confirm_btn").addClass("zlabel--red").removeClass("zlabel--blue"),modal.find("#zp_appproval_confirm_btn").attr("approvaltype",0)):(modal.find("#zp_appproval_confirm_btn").removeClass("zlabel--red").addClass("zlabel--blue"),"1"==type?modal.find("#zp_appproval_confirm_btn").attr("approvaltype",1):"2"==type&&modal.find("#zp_appproval_confirm_btn").attr("approvaltype",2))}},timesheetApproval:function(dfaid,status,recordId,comments,feedObj){var params={mode:"approval",timesheetId:recordId,isFeedAction:"true",comments:comments,status:status,dfaid:dfaid,conreqcsr:csrfToken};$.post(Timetracker.constants.URL,params,function(resultData){if("1"===resultData.res)ApprovalHome.updateApprovalCount(),void 0!==Timetracker.timesheet.timesheetData&&0!==Object.keys(Timetracker.timesheet.timesheetData).length&&void 0!==Timetracker.timesheet.timesheetData[recordId]&&(Timetracker.timesheet.timesheetData={}),void 0!==Timetracker.timesheet.approvalData&&0!==Object.keys(Timetracker.timesheet.approvalData).length&&void 0!==Timetracker.timesheet.approvalData[recordId]&&(Timetracker.timesheet.approvalData={});else{var commentBoxObj=feedObj.find("#zp_feeds_approvereject_comment"),appRejectButton=feedObj.find("#zp_feeds_approverreject").find("#zp_feeds_submit_approval");if(void 0!==resultData.errorCode&&resultData.errorCode===Timetracker.constants.ERROR_CODES.APPROVAL.COMMENT_MANDATORY)1===feedObj.find("#zp_feeds_approverreject").find("#cmtErrMsg").length&&feedObj.find("#zp_feeds_approverreject").find("#cmtErrMsg").remove(),$(ZPApprovals.getMandatoryCommentErrHTML(ZPI18N.getString("zp.apprCmtMandatoryErr"))).insertAfter(commentBoxObj),appRejectButton.attr("disabled",!1);else{Layout.Page.container.find("#timesheet_view_create").find("#zp_approval_confirm_btn").removeClass("disabled");var errorMessage=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);Timetracker.util.showAlert(0,errorMessage)}}})},approveRejectConfirm:function(){var modalFooter=Timetracker.Util.getLayout().find(".zpl_mfoter"),status=modalFooter.find("#zp_appproval_confirm_btn").attr("approvaltype"),comment=modalFooter.find("#zp_approval_comment").val(),approvalType=0==status?"0":"1",isApproveAllLevel=Timetracker.isDataAdminForAllUsers()&&1==approvalType&&2==status,tsLayout=Timetracker.Util.getLayout().find("#timesheet_view_create"),data=tsLayout.data(),approveRejObj=new ApproveReject(data.appParam,data.layoutParam,approvalType,comment,isApproveAllLevel);Timetracker.util.removeErrorMsg(void 0,tsLayout),Timetracker.timesheet.approverejectTsList(approveRejObj)},approverejectTsList:function(appObject){var status=appObject.status,comments=appObject.comment,isAllLevelApprove=appObject.isApproveAllLevel,layout=Timetracker.Util.getLayout(),tsdatatbody=layout.find("#timesheet_view_create").find("#tsdatatbody"),formId=tsdatatbody.attr("formId"),recordId=tsdatatbody.attr("recordId"),tsArr=new Array,appflag=!1,isBudgetEnabled=Timetracker.generalSettings.isBudgetEnabled(),errorFlag=!1,workItemErr=!1,isRefreshTLData=!1,approvalSettings=Timetracker.timesheet.approvalDtls.approvalSettingsDetails,isShiftEnabled=Timetracker.isTTSthiftEnabled(),showBillable=Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS);if((approvalSettings.isApprMandatory&&"1"===status||approvalSettings.isRejMandatory&&"0"===status)&&""===comments.trim())return Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#zp_approval_comment"),msg:ZPI18N.getString("zp.apprCmtMandatoryErr")}),!1;if(tsdatatbody.find("tr.timelog").each(function(){var sheetId=$(this).attr("id"),type=$(this).attr("type"),data=$(this).data(),curstatus=$(this).find("#opt"+sheetId);curstatus.hasClass("grn")?(curstatus="1",appflag=!0):curstatus="0";var tsObj={sheetId:sheetId,status:curstatus};if("1"==Timetracker.generalSettings.settingDetails.TS_isApproverEditLogtime){var jobId=TimelyZComp.isComponent($(this).find("#ts_job_"+sheetId))?TimelyZComp.select.getValue($(this).find("#ts_job_"+sheetId)):null;if(void 0!=jobId&&null!=jobId&&""!=jobId&&jobId!=$(this).find("#ts_job_"+sheetId).attr("jobId")&&(tsObj.jobId=jobId),showBillable){var billable=$(this).find("#statusEdit_"+sheetId).val();billable!=$(this).find("#statusView_"+sheetId).attr("status")&&(tsObj.billable=billable)}if("0"==type){let totalHours=$(this).find("#timesheetListlogEntry"+sheetId).val().trim();if(!totalHours.match(Timetracker.util.maxhrsRegex))return $(this).find("#timesheetListlogEntry"+sheetId).addClass("ztextbox__error"),errorFlag=!0,!1;let min=Timetracker.DateTime.convertToMins(totalHours);if(Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timesheet.TsList.userErecNum)&&0==min)return $(this).find("#timesheetListlogEntry"+sheetId).addClass("ztextbox__error"),Timetracker.util.showAlert(1,ZPI18N.getString("zp.logalert9")),errorFlag=!0,!1;min!=data.hours&&(tsObj.totalHours=min)}else if("1"==type&&ZPeopleComponents.isComponent($(this).find("#timesheetListlogFrom"+sheetId)))if(isShiftEnabled){let date_val=Calendar.parseDate(data.workDate,uidateFormat),fTime=TimelyZComp.datetimefield.getDateObj($(this).find("#timesheetListlogFrom"+sheetId)),tTime=TimelyZComp.datetimefield.getDateObj($(this).find("#timesheetListlogTo"+sheetId));var fromTime,toTime;if(date_val&&fTime&&(fromTime=date_val.getDiff(fTime,Timetracker.constants.MINUTES)),date_val&&tTime&&(toTime=date_val.getDiff(tTime,Timetracker.constants.MINUTES)),fromTime!=data.fromTime||toTime!=data.toTime){let msg,isError=!1;if(void 0==fromTime||void 0==toTime||fromTime<-Timetracker.constants.PER_DAY_MIN||fromTime>=2*Timetracker.constants.PER_DAY_MIN||toTime<-Timetracker.constants.PER_DAY_MIN||toTime>=2*Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.entervalidtime")):toTime-fromTime>Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.timeexceeded24")):toTime<fromTime&&(isError=!0,msg=ZPI18N.getString("zp.fromtimegreater")),isError)return Timetracker.Util.addError($(this).find("#timesheetListlogFrom"+sheetId)),Timetracker.Util.addError($(this).find("#timesheetListlogTo"+sheetId)),Timetracker.Util.mandOptnErrMsg("showTimesheetEditEntry"+sheetId,$(this),msg),errorFlag=!0,!1;tsObj.fromTime=fromTime,tsObj.toTime=toTime}}else{var oldFromTime=$(this).find("#timesheetListlogFrom"+sheetId).attr("value"),oldToTime=$(this).find("#timesheetListlogTo"+sheetId).attr("value"),fromhrstot=$(this).find("#timesheetListlogFrom"+sheetId).val(),tohrstot=$(this).find("#timesheetListlogTo"+sheetId).val();if(""==fromhrstot||""==tohrstot)return Timetracker.Util.addError($(this).find("#timesheetListlogFrom"+sheetId)),Timetracker.Util.addError($(this).find("#timesheetListlogTo"+sheetId)),Timetracker.Util.mandOptnErrMsg("showTimesheetEditEntry"+sheetId,$(this),ZPI18N.getString("zp.entervalidtime")),errorFlag=!0,!1;oldFromTime==fromhrstot&&oldToTime==tohrstot||(tsObj.fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.split(":")),tsObj.toTime=Timetracker.util.getTotalTimeForHours(tohrstot.split(":")))}else if("2"==type&&ZPeopleComponents.isComponent($(this).find("[id^=timerlogFrom_]")[0])){var timerArr=[];let date_val=Calendar.parseDate(data.workDate,uidateFormat);if($(this).find("#timerlogEdit_"+sheetId).children().each(function(){var timerId=$(this).attr("timerId");if(isShiftEnabled){let fromTime,toTime,fTime=TimelyZComp.datetimefield.getDateObj($(this).find("#timerlogFrom_"+timerId)),tTime=TimelyZComp.datetimefield.getDateObj($(this).find("#timerlogTo_"+timerId));date_val&&fTime&&(fromTime=date_val.getDiff(fTime,Timetracker.constants.MINUTES)),date_val&&tTime&&(toTime=date_val.getDiff(tTime,Timetracker.constants.MINUTES));let isError=!1;if(void 0==fromTime||void 0==toTime||fromTime<-Timetracker.constants.PER_DAY_MIN||fromTime>=2*Timetracker.constants.PER_DAY_MIN||toTime<-Timetracker.constants.PER_DAY_MIN||toTime>=2*Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.entervalidtime")):toTime-fromTime>Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.timeexceeded24")):toTime<fromTime&&(isError=!0,msg=ZPI18N.getString("zp.fromtimegreater")),isError)return Timetracker.Util.addError($(this).find("#timerlogFrom_"+timerId)),Timetracker.Util.addError($(this).find("#timerlogTo_"+timerId)),Timetracker.Util.mandOptnErrMsg("timerlogEdit_"+timelogId,$(this).parents("td"),msg),errorFlag=!0,!1;let fromSec=null!=$(this).find("#timerlogFrom_"+timerId).attr("valInSec")?$(this).find("#timerlogFrom_"+timerId).attr("valInSec"):0,toSec=$(this).find("#timerlogTo_"+timerId).attr("valInSec")?$(this).find("#timerlogTo_"+timerId).attr("valInSec"):0;toTime=60*toTime+toSec%60,(fromTime=60*fromTime+fromSec%60)==fromSec&&toTime==toSec||timerArr.push({timerId:timerId,fromTime:fromTime,toTime:toTime})}else{let fromhrstot=$(this).find("#timerlogFrom_"+timerId).val(),tohrstot=$(this).find("#timerlogTo_"+timerId).val();if(void 0==fromhrstot||""==fromhrstot||void 0==tohrstot||""==tohrstot)return Timetracker.Util.addError($(this).find("#timerlogFrom_"+timerId)),Timetracker.Util.addError($(this).find("#timerlogTo_"+timerId)),Timetracker.Util.mandOptnErrMsg("timerlogEdit_"+timelogId,$(this).parents("td"),ZPI18N.getString("zp.entervalidtime")),errorFlag=!0,!1;let fromSec=null!=$(this).find("#timerlogFrom_"+timerId).attr("valInSec")?$(this).find("#timerlogFrom_"+timerId).attr("valInSec"):0,toSec=$(this).find("#timerlogTo_"+timerId).attr("valInSec")?$(this).find("#timerlogTo_"+timerId).attr("valInSec"):0,fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.split(":")),toTime=Timetracker.util.getTotalTimeForHours(tohrstot.split(":"));toTime=60*toTime+toSec%60,(fromTime=60*fromTime+fromSec%60)==fromSec&&toTime==toSec||timerArr.push({timerId:timerId,fromTime:fromTime,toTime:toTime})}}),errorFlag)return!1;0!=timerArr.length&&(tsObj.timerArr=timerArr)}if($(this).find(".workItemEdit").is(":visible")){let editedTaskName="";$(this).find("#tsWorkItemInput").is(":visible")?editedTaskName=$(this).find("#tsWorkItemInput").val():(ZPeopleComponents.isComponent($(this).find("[name='tsWorkItemSelect']"))&&(editedTaskName=ZPeople.decodeTxt(TimelyZComp.select.getValue($(this).find("[name='tsWorkItemSelect']")))),"0"===editedTaskName&&(editedTaskName=""));let data=$(this).data();if(editedTaskName!=ZPeople.decodeTxt(data.taskName)&&(tsObj.taskName=editedTaskName,""==editedTaskName&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem_Mandatory)){var errorDiv=$(this).find("#tsWorkItemInput").is(":visible")?$(this).find("#tsWorkItemInput"):$(this).find("[name='tsWorkItemSelect']");return Timetracker.Util.addError(errorDiv),errorFlag=workItemErr=!0,!1}}}if(isBudgetEnabled){var approval_comment=$(this).find("#td_tsapproval_comment").find("textarea").val();tsObj.approval_comment=approval_comment}tsArr.push(tsObj),!isRefreshTLData&&Object.keys(tsObj).length>2&&(isRefreshTLData=!0)}),errorFlag)return workItemErr?Timetracker.util.showAlert(1,ZPI18N.getString("zp.entervalforfield",[Timetracker.util.workitemDispName])):Timetracker.util.showAlert(1,ZPI18N.getString("zp.approvalalert3")),layout.find("#timesheet_view_create").find("#zp_approval_confirm_btn").removeClass("disabled"),!1;if("1"===status&&!appflag)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.approvalalert1")),layout.find("#timesheet_view_create").find("#zp_approval_confirm_btn").removeClass("disabled"),!1;var rateperhour=layout.find("#timesheet_view_create").find("#timesheetbill_rate").html();if(rateperhour=Number(rateperhour),isNaN(rateperhour)||rateperhour<0)return!1;layout.find("#approvetsbutton").find("button").addClass("disabled");var params={mode:"approval",timesheetId:recordId,tsArr:JSON.stringify(tsArr),comments:comments,status:status,isAllLevelApprove:isAllLevelApprove,dfaid:Timetracker.timesheet.approvalDtls.dataForApprovalId,ratePerHour:rateperhour,conreqcsr:csrfToken},tsParams={};tsParams.reqParams=params;var tsDtl={};tsDtl.status=status,tsDtl.formId=formId,tsParams.tsDtl=tsDtl,tsParams.approvalObj=appObject;var extraDtls={};extraDtls.isRefreshTLData=isRefreshTLData,tsParams.extraDtls=extraDtls,Timetracker.timesheet.sendApproveTimesheet(tsParams)},successcallbackModifyTS:function(extraDetails){var reqParams=extraDetails.params,addtnlParams=extraDetails.additionalParams;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0;var tsParams={};tsParams.currObj=addtnlParams.currObj,tsParams.timelogId=addtnlParams.timelogId,tsParams.isFromEditTimesheet=addtnlParams.isFromEditTimesheet,tsParams.type=addtnlParams.type,tsParams.timelogId=addtnlParams.timelogId,tsParams.billableStatus=addtnlParams.billableStatus,tsParams.jobId=addtnlParams.jobId,tsParams.reqParams=reqParams,Timetracker.timesheet.sendModifyTimesheetReq(tsParams)},sendModifyTimesheetReq:function(tlDetailsJson){var params=tlDetailsJson.reqParams,currObj=tlDetailsJson.hasOwnProperty("currObj")?tlDetailsJson.currObj:null,timelogId=tlDetailsJson.timelogId,type=tlDetailsJson.type,isFromEditTimesheet=tlDetailsJson.isFromEditTimesheet,billableStatus=tlDetailsJson.billableStatus,jobId=tlDetailsJson.jobId,layout=Timetracker.Util.getLayout();$.post("/timesheet.zp",params,function(result){null!==currObj&&$(currObj).off().on("click",function(e){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)});var allowTSReconstruct=!0;if(result&&(0===result.res||"0"===result.res)){if(result.errorCode!==Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMELOG_ENTRY_OVERLAP){if(result.errorCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAXLOGHOURRESTRICT)return Timetracker.util.showAlert(1,result.message),!1;errorMessage=Timetracker.Util.getFailureMessageByCode(result.errorCode,result.extraDtls,!0);return Timetracker.util.showAlert(1,errorMessage),!1}if("1"!==Timetracker.generalSettings.getTimelogOverlapType()){var errorMessage=Timetracker.Util.getFailureMessageByCode(result.errorCode,result.extraDtls,!0);return Timetracker.util.showAlert(1,errorMessage),!1}var additionalParams={currObj:currObj,timelogId:timelogId,type:type,isFromEditTimesheet:isFromEditTimesheet,billableStatus:billableStatus,jobId:jobId};Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.timesheet.successcallbackModifyTS,additionalParams),allowTSReconstruct=!1}if(Timetracker.timelogs.refreshData=!0,Timetracker.UserSpace.Timelogs.isRefreshNeeded=!0,Timetracker.timelogs.calendar.refreshData=!0,allowTSReconstruct&&Timetracker.util.showAlert(2,ZPI18N.getString("zp.editedHoliday",[ZPI18N.getString("zp.local.TimeLog")])),Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_name=layout.find("#timesheet_name").val(),Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_desc=layout.find("#timesheet_desc").val(),layout.find("#timesheetAfterUpload").is(":visible")&&(Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment={},Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileObj=layout.find("#timesheetAfterUpload").data("fileUploadData"),Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileType=layout.find("#timesheetAfterUpload").data("uploadType"),"Desktop"==Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileType?Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileName=Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileObj.name:"cloudUpload"==Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileType?Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileName=JSON.parse(Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileObj).docName:"workDrive"==Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileType&&(Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileName=JSON.parse(Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileObj).name)),isFromEditTimesheet){if(allowTSReconstruct){var formId=layout.find("#tsdatatbody").attr("formId"),recordId=layout.find("#tsdatatbody").attr("recordId");Timetracker.timesheet.getTimesheetDetails(formId,recordId,null,null,{refreshDataInTsRow:!0})}}else params={mode:"getTimesheet",userErecNo:Timetracker.timesheet.TsList.userErecNum,fromDate:Timetracker.timesheet.TsList.fromDate,toDate:Timetracker.timesheet.TsList.toDate,jobId:Timetracker.timesheet.TsList.jobId,typeMode:Timetracker.timesheet.TsList.billStatus,list:!0,includeLeave:!0,conreqcsr:csrfToken},0===Object.keys(Timetracker.leave.leaveTypeMap).length&&(params.leaveTypeNeeded=!0),$.post(Timetracker.constants.URL,params,function(timelogs){params.leaveTypeNeeded&&Timetracker.leave.setLeaveTypesMap(timelogs.leaveData),Timetracker.timesheet.constructListData(timelogs,!0)})})},successcallbackTimesheetApprove:function(extraDetails){var reqParams=extraDetails.params,addtnlParams=extraDetails.additionalParams;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0;var tsParams={};tsParams.tsDtl=addtnlParams,tsParams.reqParams=reqParams,Timetracker.timesheet.sendApproveTimesheet(tsParams)},sendApproveTimesheet:function(tsParams){var params=tsParams.reqParams,tsDtls=tsParams.tsDtl,status=tsDtls.status,formId=tsDtls.formId,recordId=params.timesheetId;$.post(Timetracker.constants.URL,params,function(resultData){var layout=Timetracker.Util.getLayout();if(Timetracker.timesheet.refreshData=!0,Timetracker.UserSpace.Timesheets.refreshData=!0,layout.find("#approvetsbutton").find("button").removeClass("disabled"),"1"===resultData.res){Timetracker.timesheet.isfromFeeds&&null!==Timetracker.timesheet.approvalCallback&&void 0!==Timetracker.timesheet.approvalCallback&&"function"==typeof Timetracker.timesheet.approvalCallback&&layout.find("#timesheet_view_create").find("#tsdatatbody").attr("approvalStatus",status),"1"===status?Timetracker.util.showAlert(2,ZPI18N.getString("zp.approvedsuccessful")):Timetracker.util.showAlert(2,ZPI18N.getString("zp.rejectedsuccessful"));var extraDtsl={isFromTSView:!0,appObj:tsParams.approvalObj};Timetracker.timesheet.getTimesheetDetails(formId,recordId,!1,null,extraDtsl)}else{var resCode="";if(resultData.hasOwnProperty("errorCode")&&(resCode=resultData.errorCode),layout.find("#timesheet_view_create").find("#zp_approval_confirm_btn").removeClass("disabled"),resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMELOG_ENTRY_OVERLAP)if("1"===Timetracker.generalSettings.getTimelogOverlapType())Timetracker.timesheet.showErrorTimelogs(resultData),Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.timesheet.successcallbackTimesheetApprove,tsDtls);else{var errorMessage=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);Timetracker.util.showAlert(0,errorMessage),Timetracker.timesheet.showErrorTimelogs(resultData)}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAXLOGHOURRESTRICT)Timetracker.util.showAlert(0,resultData.message),Timetracker.timesheet.showErrorTimelogs(resultData);else{errorMessage=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);Timetracker.util.showAlert(0,errorMessage),Timetracker.timesheet.showErrorTimelogs(resultData)}}})},showCreateTimesheet:function(isFromPrevious){isFromPrevious&&(Timetracker.timelogs.originTimelogs=!1),ModuleComp.Modal.hide("timesheet_view_create"),!0!==isFromPrevious&&Timetracker.timesheet.setTimesheetFilterOptions();var layout=Timetracker.Util.getLayout();ModuleComp.Modal.show(layout.find("#timesheet_view"))},setTimesheetFilterOptions:function(){var layout=Timetracker.Util.getLayout();if(modal=layout.find("#timesheet_view"),0==modal.length)modal=Timetracker.timesheet.constructTimesheetCriteriaPopup(),ModuleComp.Modal.hide("timesheet_view");else{var periodHtml=Timetracker.timesheet.constructTSPeriodSelect();if(TimelyZComp.select.destroy(modal.find('[compname="period"]')),modal.find('[compname="period"]').replaceWith(periodHtml),layout.find("#customDateDiv").addClass("zpl_DNI"),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)){var billableHtml='<select class="select-js" compname="billableStatus"><option value="-1">'+ZPI18N.getString("zp.all")+'</option><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select>";TimelyZComp.select.destroy(modal.find('[compname="billableStatus"]')),modal.find('[compname="billableStatus"]').replaceWith(billableHtml)}ZPeopleComponents.tokenfield(modal.find('[compname="client"]')).destroy(),ZPeopleComponents.tokenfield(modal.find('[compname="project"]')).destroy(),ZPeopleComponents.tokenfield(modal.find('[compname="job"]')).destroy(),Timetracker.util.removeErrorMsg("timesheet_view",modal)}var pageMode=Timetracker.Page.getPageMode(),userErecno="0";if("ts_team"==pageMode||"ts_operations"==pageMode){modal.find("#crUser").closest(".zpl_secn").removeClass("zpl_DNI");var extraDtls={submode:"TIMETRACKER_DATA",inpFormat:"select",placeHolder:ZPI18N.getString("zp.selectemployee")};extraDtls.changeCallback=Timetracker.timesheet.filterOnChangeCallback,"ts_operations"==pageMode&&(extraDtls.initCurrentUser=!0);var dataType="ts_operations"==pageMode?Timetracker.constants.TTCustomAdmin.EntryEdit:void 0;Timetracker.Search.populateZCompUsers("crUser",void 0,extraDtls,!1,modal,dataType,modal.find("#crUser"))}else modal.find("#crUser").closest(".zpl_secn").addClass("zpl_DNI"),userErecno="ts_mydata"==pageMode?erecno:Timetracker.Team.getSelectedUser();var defPeriod=modal.find("[compname=period]").attr("value"),ddown={dropdownList:{appendTo:modal.find(".sel_postion").length>0?modal.find(".sel_postion"):void 0}};TimelyZComp.select.intialize(modal.find("[compname=period]"),ddown),TimelyZComp.select.setValue(modal.find("[compname=period]"),defPeriod),modal.find("[compname=period]").on("zselectchange",Timetracker.timesheet.filterOnChangeCallback),0!=modal.find("[compname=billableStatus]").length&&TimelyZComp.select.intialize(modal.find("[compname=billableStatus]"),ddown);var details={};details.element=modal.find("[compname=client]"),details.tokenField=!0,details.key="client",details.extraDtls={filterDiv:modal,userErecNo:userErecno},details.mapping={value:"clientId",label:"clientName"},details.placeholder=ZPI18N.getString("zp.AllOrgStructureElements",[ZPeople.decodeTxt(Timetracker.util.getClientDisplayName())]),details.callback=Timetracker.timesheet.filterOnChangeCallback,TimetrackerOperations.Filters.constructTTFormFilters(details),(details={}).element=modal.find('[compname="project"]'),details.key="project",details.tokenField=!0,details.mapping={value:"projectId",label:"projectName"},details.placeholder=ZPI18N.getString("zp.AllOrgStructureElements",[ZPeople.decodeTxt(Timetracker.util.getProjectDisplayName())]),details.extraDtls={filterDiv:modal,userErecNo:userErecno},details.callback=Timetracker.timesheet.filterOnChangeCallback,TimetrackerOperations.Filters.constructTTFormFilters(details),(details={}).element=modal.find('[compname="job"]'),details.key="job",details.tokenField=!0,details.extraDtls={filterDiv:modal,userErecNo:userErecno},details.mapping={value:"jobId",label:"jobName"},details.placeholder=ZPI18N.getString("zp.AllOrgStructureElements",[ZPeople.decodeTxt(Timetracker.util.getJobDisplayName())]),details.callback=Timetracker.timesheet.filterOnChangeCallback,TimetrackerOperations.Filters.constructTTFormFilters(details);var config={calendarIcon:!0,format:dateFmt,picker:!0,spinButtons:"none",clearButton:"none"};TimelyZComp.dateField.intialize(modal.find("[name=date]"),config)},filterOnChangeCallback:function(event){var entity;entity=null==event||"string"==typeof event?this.ele.attr("compname"):$(event.target).attr("compname");var container=Timetracker.Util.getLayout().find("#timesheet_view");switch(entity){case"employee":TimetrackerOperations.Filters.clearCache(!1,"client"),filterDiv=container.find('[compname="client"]'),TimelyZComp.tokenField.removeAllTokens(filterDiv);case"client":TimetrackerOperations.Filters.clearCache(!1,"project"),filterDiv=container.find('[compname="project"]'),TimelyZComp.tokenField.removeAllTokens(filterDiv);case"project":TimetrackerOperations.Filters.clearCache(!1,"job"),filterDiv=container.find('[compname="job"]'),TimelyZComp.tokenField.removeAllTokens(filterDiv);break;case"period":filterDiv=container.find('[compname="period"]'),6==TimelyZComp.select.getValue(filterDiv)?(TimetrackerOperations.Filters.resetFromToDate(container,"ts_fromdate","ts_todate"),container.find("#customDateDiv").removeClass("zpl_DNI")):container.find("#customDateDiv").addClass("zpl_DNI")}},getUserRates:async function(isFromTS){null==Timetracker.timesheet.userRates&&(isFromTS=void 0!=isFromTS&&isFromTS,[data]=await ZPeople.Request.sendRequestAsPromise(Timetracker.constants.URL,{mode:"getUserRates",isFromTS:isFromTS,conreqcsr:csrfToken}),Timetracker.timesheet.userRates=data)},constructTSPeriodSelect:function(){var options,defaultVal,pageMode=Timetracker.Page.getPageMode(),user=Timetracker.Page.isSelectedUser()?Timetracker.Team.getSelectedUser():"ts_mydata"===pageMode?erecno:"-1",tsPeriod="-1"!=user?Timetracker.generalSettings.getTSPeriod(user):"-1";return tsPeriod===Timetracker.constants.TS_PERIOD.DAY?(options='<option value="0">'+ZPI18N.getString("zp.today")+'</option><option value="3">'+ZPI18N.getString("zp.yesterday")+'</option><option value="6">'+ZPI18N.getString("zp.custom")+"</option>",defaultVal="0"):tsPeriod===Timetracker.constants.TS_PERIOD.WEEK?(options='<option value="1">'+ZPI18N.getString("zp.thisweek")+'</option><option value="4">'+ZPI18N.getString("zp.lastweek")+'</option><option value="6">'+ZPI18N.getString("zp.custom")+"</option>",defaultVal="1"):tsPeriod===Timetracker.constants.TS_PERIOD.MONTH?(options='<option value="2">'+ZPI18N.getString("zp.tt_thismonth")+'</option><option value="5">'+ZPI18N.getString("zp.lastmonth")+'</option><option value="6">'+ZPI18N.getString("zp.custom")+"</option>",defaultVal="2"):(options='<option value="0">'+ZPI18N.getString("zp.today")+'</option><option value="1">'+ZPI18N.getString("zp.thisweek")+'</option><option value="2">'+ZPI18N.getString("zp.tt_thismonth")+'</option><option value="3">'+ZPI18N.getString("zp.yesterday")+'</option><option value="4">'+ZPI18N.getString("zp.lastweek")+'</option><option value="5">'+ZPI18N.getString("zp.lastmonth")+'</option><option value="6">'+ZPI18N.getString("zp.custom")+"</option>",defaultVal="-1"!=user?Timetracker.generalSettings.getDefaultViewType(user):"1"),'<select class="select-js" compname="period" value="'+defaultVal+'" viewPeriodType="'+defaultVal+'">'+options+"</select>"},constructTimesheetCriteriaPopup:function(){var body='<form><div class="zpl_crd"><div class="zpl_crdcnt sel_postion" style="position: relative;"><div class="zpl_secn"><div><label for="period" tabindex="0">'+ZPI18N.getString("zp.period")+"</label></div><div>"+Timetracker.timesheet.constructTSPeriodSelect()+'</div></div><div class="zpl_secn zpl_idivingrp zpl_DNI" id="customDateDiv"><div><label>'+ZPI18N.getString("zp.fromtodate")+'</label></div><div><div><div><input name="date" class="datepicker-js W100" id="ts_fromdate"></div><div><input name="date" class="datepicker-js W100" id="ts_todate"></div></div></div></div><div class="zpl_secn"><div><label for="crUser" tabindex="0" >'+ZPI18N.getString("zp.employee")+'</label></div><div><input id="crUser" compname="employee"></div></div><div class="zpl_secn"><div><label for="client" tabindex="0">'+Timetracker.util.clientDispName+'</label></div><div><textarea type="tokenField" compname="client"></textarea></div></div><div class="zpl_secn"><div><label for="project" tabindex="0">'+Timetracker.util.projectDispName+'</label></div><div><textarea type="tokenField" compname="project"></textarea></div></div><div class="zpl_secn"><div><label for="job" tabindex="0">'+Timetracker.util.jobDispName+'</label></div><div><textarea type="tokenField" compname="job" ></textarea></div></div><div class="zpl_secn" id="ts_billableStatus_field"><div><label for="billableStatus" tabindex="0">'+ZPI18N.getString("zp.billablestatus")+'</label></div><div><select class="select-js" compname="billableStatus"><option value="-1">'+ZPI18N.getString("zp.all")+'</option><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select></div></div></div></div></form>",modal=ModuleComp.Modal.setup({id:"timesheet_view",type:1,header:ZPI18N.getString("zp.createtimesheet"),body:body,backdrop:!0,closeOnSubmit:!1,buttonValue:ZPI18N.getString("zp.next"),deleteOnHide:!1,successCallback:Timetracker.timesheet.getCreateTimesheet,closeonEsc:!0});return modal.find('[compname="period"]').on("zselectchange",Timetracker.timesheet.filterOnChangeCallback),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)||modal.find("#ts_billableStatus_field").remove(),modal.find(".zpl_minr").attr({"aria-label":ZPI18N.getString("zp.common.addreqpage"),tabindex:"0"}),modal.find("#zp_modal_blubtn").attr({"aria-label":ZPI18N.getString("zp.next"),tabindex:"0"}),modal.find("#zp_modal_whitebtn").attr({"aria-label":ZPI18N.getString("zp.cancel")+"."+ZPI18N.getString("zp.common.cancelpopup"),tabindex:"0"}),modal.find(".zpl_minr").focus(),modal},getCreateTimesheet:function(flag){var pageMode=Timetracker.Page.getPageMode();if(1===flag){if(Timetracker.timesheet.setTimesheetFilterOptions(),"ts_team"==pageMode){var timesheetDiv=Timetracker.Util.getLayout().find("#timesheet_view");return ModuleComp.Modal.show(timesheetDiv),void timesheetDiv.find(".zpl_minr").focus()}}else Timetracker.util.removeErrorMsg("timesheet_view");var userErecNo,layout=Timetracker.Util.getLayout().find("#timesheet_view"),params={mode:"getTimesheet",list:!0,includeLeave:!0,requireClientDetails:!0,conreqcsr:csrfToken};if(0===Object.keys(Timetracker.leave.leaveTypeMap).length&&(params.leaveTypeNeeded=!0),TimetrackerOperations.Filters.getFormToDatefromPeriodFilter(params,layout,"ts_fromdate","ts_todate","2"),Timetracker.UserSpace.isMySpaceActionList()&&(params.fromDate=Timetracker.UserSpace.Jobs.ts_fromDate,params.toDate=Timetracker.UserSpace.Jobs.ts_toDate),void 0==params.fromDate||void 0==params.toDate)return null;TimetrackerOperations.Filters.setSelectedPeriodDetails(layout,"ts_fromdate","ts_todate"),Timetracker.UserSpace.isMySpaceActionList()||(params.clientId=TimetrackerOperations.Filters.gettokenFieldValues(layout.find('[compname="client"]')),params.projectId=TimetrackerOperations.Filters.gettokenFieldValues(layout.find('[compname="project"]')),params.jobId=TimetrackerOperations.Filters.gettokenFieldValues(layout.find('[compname="job"]')),params.typeMode=0!=layout.find('[compname="billableStatus"]').length&&TimetrackerOperations.Filters.getSelectFilterValues(layout.find('[compname="billableStatus"]'))||-1),void 0!=(userErecNo="ts_operations"==pageMode||"ts_team"==pageMode?TimetrackerOperations.Filters.getSelectFilterValues(layout.find('[compname="employee"]')):Timetracker.UserSpace.isMySpaceActionList()?erecno:"ts_mydata"==pageMode?erecno:Timetracker.Team.getSelectedUser())?(params.userErecNo=userErecNo,Timetracker.timesheet.tslerecno=params.userErecNo,Timetracker.timesheet.TsList.fromDate=params.fromDate,Timetracker.timesheet.TsList.toDate=params.toDate,Timetracker.timesheet.TsList.billStatus=params.typeMode,Timetracker.timesheet.TsList.clientId=params.clientId,Timetracker.timesheet.TsList.projectId=params.projectId,Timetracker.timesheet.TsList.jobId=params.jobId,Timetracker.timesheet.TsList.userErecNum=params.userErecNo,Timetracker.timesheet.TsList.userName=ZPeople.getUserDetailsById(userErecNo).name,Timetracker.timesheet.TsList.empId=ZPeople.getUserDetailsById(userErecNo).empid,Timetracker.timesheet.TsList.image=ZPeople.decodeTxt(ZPeople.getUserDetailsById(userErecNo).avatar),$.post(Timetracker.constants.URL,params,function(result){if("NotAllowed"===result.error)return"1"===Timetracker.generalSettings.getTSPermission(Timetracker.timesheet.tslerecno)&&1===flag?Timetracker.timesheet.showCreateTimesheet(!0):Timetracker.util.showAlert(1,ZPI18N.getString("zp.timesheetcreationnotallowed")),!1;if(result.hasOwnProperty("errorCode")){var message=Timetracker.Util.getFailureMessageByCode(result.errorCode,null,isNaN(parseInt(result.errorCode)));Timetracker.util.showAlert(0,message)}else if(0!==Layout.Page.container.find("#timesheet_view_create").find("#zp_approval_followupbtn").length&&Layout.Page.container.find("#zp_approval_followupbtn").remove(),0!==result.tsArr.length)params.leaveTypeNeeded&&Timetracker.leave.setLeaveTypesMap(result.leaveData),Timetracker.timesheet.constructListData(result,!0);else{if(1!==flag)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.nologhours",[ZPI18N.getString("zp.smallsubmit")])),!1;Timetracker.timesheet.showCreateTimesheet(!0)}})):Timetracker.Util.appenErrorMsgForElem({obj:layout.find('[compname="employee"]'),msg:ZPI18N.getString("zp.files.operations.selemp")})},constructListData:function(resultData,isFromTSCreate){var tsViewLayout=Timetracker.timesheet.getTimesheetPopup();Timetracker.util.removeErrorMsg("timesheet_view_create");var excludeProjRow=!1,excludeProjinJobRow=!1,excludeClientInProjRow=!1,isSingleProject=!1,isSingleClient=!1;""==resultData.projectName?(excludeProjRow=!0,tsViewLayout.find("#timesheet_logsName").parent().parent().addClass("zpl_DNI")):""==resultData.clientName?(excludeClientInProjRow=!0,1==resultData.isSingleProject&&""!=resultData.projectName?(isSingleProject=!0,tsViewLayout.find("#timesheet_logsName").parent().parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_logsName").html(Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME),tsViewLayout.find("#timesheet_logsValue").html("<span>"+resultData.projectName+"</span>"),excludeProjRow=!0,excludeProjinJobRow=!0):tsViewLayout.find("#timesheet_logsName").parent().parent().addClass("zpl_DNI")):1==resultData.isSingleClient&&""!=resultData.clientName?(isSingleClient=!0,tsViewLayout.find("#timesheet_logsName").parent().parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_logsName").html(Timetracker.clients.formDetails.labelDetails?Timetracker.clients.formDetails.labelDetails.CLIENTNAME:ZPI18N.getString("zp.clientname")),tsViewLayout.find("#timesheet_logsValue").html("<span>"+resultData.clientName+"</span>"),excludeClientInProjRow=!0,1==resultData.isSingleProject&&""!=resultData.projectName&&(isSingleProject=!0,tsViewLayout.find("#timesheet_logsName").html(Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME),tsViewLayout.find("#timesheet_logsValue").html("<span>"+resultData.projectName+"</span><font>.</font><em>"+resultData.clientName+"</em>"),excludeProjRow=!0,excludeProjinJobRow=!0)):tsViewLayout.find("#timesheet_logsName").parent().parent().addClass("zpl_DNI"),!excludeProjRow&&(excludeProjinJobRow=!0),tsViewLayout.find("#timesheet_create_submit").html(ZPI18N.getString("zp.sendforapproval")),tsViewLayout.find("#tsapproval-subdata").html(ZPI18N.getString("zp.hourstobesubmitted")),tsViewLayout.find("#tsdatatbody").attr("approvalStatus",-2);var tserecNo=Timetracker.timesheet.TsList.userErecNum,tsdatatbody=tsViewLayout.find("#tsdatatbody");tsdatatbody.html("");var extraDtls={};extraDtls.hasDescription=Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)&&resultData.hasDescription,extraDtls.hasAttachment=resultData.hasAttachment,extraDtls.hasWorkItem="1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem,extraDtls.showBillable=Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS),extraDtls.isHourlyType=resultData.isHourlyType,extraDtls.excludeProjRow=excludeProjRow,extraDtls.excludeProjinJobRow=excludeProjinJobRow,extraDtls.excludeClientInProjRow=excludeClientInProjRow,extraDtls.layout=tsdatatbody,extraDtls.recordAppStatus=-2,extraDtls.isTimesheetEdit=!isFromTSCreate||!isFromTSCreate,extraDtls.tsfromDate=resultData.DB_fromDate,extraDtls.tsToDate=resultData.DB_toDate;var billHours=0,nonbillHours=0,billedCount=0,nonBilledCount=0,paidBrkCount=0,unpaidBrkCount=0,isBreakLogAvlbl=!!resultData.hasOwnProperty("isBreakLogAvlbl")&&resultData.isBreakLogAvlbl,isBreakEnabled=Timetracker.generalSettings.isBreakEnabled();Timetracker.timesheet.TsList.paidBreakHours=resultData.paidBreakHours,Timetracker.timesheet.TsList.unpaidBreakHours=resultData.unpaidBreakHours,Timetracker.timesheet.TsList.billableHours=resultData.billableHours,Timetracker.timesheet.TsList.nonbillableHours=resultData.nonbillableHours,Timetracker.timesheet.TsList.app_billableHours=resultData.app_billableHours,Timetracker.timesheet.TsList.app_billableHours=resultData.app_billableHours;var isTLFromTSAllowed=Timetracker.generalSettings.isTimelogAddEnabledInTimesheet(),isNBlogsPayable=Timetracker.generalSettings.isNonBillableTLforPayableHours(tserecNo);if(resultData.isNBlogsPayable=isNBlogsPayable,tsdatatbody.data("isNBlogsPayable",isNBlogsPayable),isTLFromTSAllowed){var manualLog,fromToTimeLog;if(manualLog=!(!resultData.hasOwnProperty("isManualLog")||!resultData.isManualLog),fromToTimeLog=!(!resultData.hasOwnProperty("isfromToLog")||!resultData.isfromToLog),manualLog||fromToTimeLog||(isTLFromTSAllowed=!1),isTLFromTSAllowed){extraDtls.ts_tl_manuallog=manualLog,extraDtls.ts_tl_fromToLog=fromToTimeLog;var ts_tladd_dom=tsdatatbody.parent().find("#ts_tladd");$(ts_tladd_dom).parent().removeClass("zpl_DNI"),$(ts_tladd_dom).off().on("click",function(event){event.preventDefault(),Timetracker.timesheet.timelogAddForm(this,extraDtls)})}}$.each(resultData.tsArr,function(index,data){extraDtls.index=index;var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",data),billstatus="";0===data.billableStatus?(billstatus=isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[0]):ZPI18N.getString("zp.billable"),billHours+=data.hours,isBreakLog?(paidBrkCount+=1,data.hours):billedCount+=1):(billstatus=isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[1]):ZPI18N.getString("zp.nonbillable"),nonbillHours+=data.hours,isBreakLog?(unpaidBrkCount+=1,data.hours):nonBilledCount+=1),extraDtls.billstatus=billstatus,extraDtls.isTimelogEditAllowed=data.isEditAllowed,isSingleProject&&(extraDtls.projectId=data.projectId),isSingleClient&&(extraDtls.clientId=data.clientId),Timetracker.timesheet.constructTimesheetLogRow(data,extraDtls)}),Timetracker.timesheet.TsList.billHours=billHours,Timetracker.timesheet.TsList.nonbillHours=nonbillHours,Timetracker.timesheet.TsList.totalHours=billHours+nonbillHours;var weekendListDates=[],leaveTypeDiv=Timetracker.Util.getLayout().find("#ts_leaveTypes");if(leaveTypeDiv.find("div").addClass("zpl_DNI"),void 0!=resultData.leaveData.leaveJson.leaveDetails){for(var leaveData=resultData.leaveData.leaveJson.leaveDetails,typeSet=new Set,i=0;i<leaveData.length;i++){if(leaveData[i].hasOwnProperty("isweekend")&&leaveData[i].isweekend&&weekendListDates.push(leaveData[i].workdate),6!=leaveData[i].leaveType||6==leaveData[i].leaveType&&1==leaveData[i].isHalfWeekend)typeSet.add(leaveData[i].leaveType);else{var tlDayResetictDates=void 0!==resultData.timelogDates?resultData.timelogDates:[];if(1!=leaveData[i].isweekend||0==tsdatatbody.find("[dateDiv="+leaveData[i].workdate+"]").length||!tlDayResetictDates.includes(leaveData[i].workdate))continue;typeSet.add(leaveData[i].leaveType)}Timetracker.timesheet.constructTimesheetLeaveRow(leaveData[i],extraDtls,"leave")}typeSet.forEach(function(val){0==val||4==val?leaveTypeDiv.find("#ts_paid").removeClass("zpl_DNI"):1==val?leaveTypeDiv.find("#ts_onDuty").removeClass("zpl_DNI"):2==val?leaveTypeDiv.find("#ts_absent").removeClass("zpl_DNI"):3==val?leaveTypeDiv.find("#ts_unpaid").removeClass("zpl_DNI"):5==val?leaveTypeDiv.find("#ts_holiday").removeClass("zpl_DNI"):6==val&&leaveTypeDiv.find("#ts_weekend").removeClass("zpl_DNI")})}if(void 0!==resultData.isMinRestrict&&void 0!==resultData.isPerDayMinRestrict&&resultData.isPerDayMinRestrict)for(var tsFDate=new Date(resultData.DB_fromDate.split("-")),tsTDate=new Date(resultData.DB_toDate.split("-")),msgdata={errorMsg:minPeyDayEMsg=ZPI18N.getString("zp.minperdaywarning",[Calendar.minstohrs(resultData.minHrsDay)])},d=tsFDate;d<=tsTDate;d.setDate(d.getDate()+1)){var workDate=Timetracker.DateTime.getDateinDBformat(d,!0);weekendListDates.includes(workDate)||(msgdata.workdate=workDate,Timetracker.timesheet.constructTimesheetLeaveRow(msgdata,extraDtls,"deviation"))}var firstTableOfBody=tsdatatbody.find("table")[0],txt='<thead class="zpl_PRI"><tr>';if(extraDtls.excludeProjRow||(txt+='<th class="mw180" width ="180"><div class="txtbrk zpl_whtspnrml">'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+"</div></th>"),txt+="<th "+(extraDtls.excludeProjRow?'class="mw300" width="300"':'min-width="150px" class="mw150"')+'><div class="txtbrk zpl_whtspnrml">'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+"</div></th>",extraDtls.hasWorkItem&&(txt+='<th class="mw180" width="180"><div class="txtbrk zpl_whtspnrml">'+Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM)+"</div></th>"),(extraDtls.hasDescription||extraDtls.hasAttachment)&&(txt+='<th class="mw80" width="80"></th>'),extraDtls.showBillable&&(txt+='<th class="mw150" width="150"></th>'),extraDtls.isHourlyType||(txt+='<th class="mw280" width="280">'+ZPI18N.getString("zp.fromtotime")+"</th>"),txt+='<th class="mw100" width="100">'+ZPI18N.getString("zp.hours")+"</th>",txt+='<th class="mw80"  width="80"></th></tr></thead>',$(firstTableOfBody).prepend(txt),void 0!=resultData.deviatedDays){var minPeyDayEMsg=ZPI18N.getString("zp.minperdaywarning",[Calendar.minstohrs(resultData.minHrsDay)]);for(i=0;i<resultData.deviatedDays.length;i++){var date=resultData.deviatedDays[i],div=tsdatatbody.find("[dateDiv="+date+"]")[0];$(div).addClass("ts_exced").append('<i class="PI_fil_alert" title="'+minPeyDayEMsg+'"></i>')}}if(void 0!=resultData.maxDeviatedDays){var maxPeyDayEMsg=ZPI18N.getString("zp.maxperdaywarning",[Calendar.minstohrs(resultData.maxHrsDay)]);for(i=0;i<resultData.maxDeviatedDays.length;i++){date=resultData.maxDeviatedDays[i],div=tsdatatbody.find("[dateDiv="+date+"]")[0];$(div).addClass("ts_exced").append('<i class="PI_fil_alert" title="'+maxPeyDayEMsg+'"></i>')}}if(1==resultData.isPerDayMinRestrict){var dates=void 0!=resultData.absentDates&&0!=resultData.absentDates.length?resultData.absentDates:[];void 0!=resultData.leaveDevDates&&0!=resultData.leaveDevDates.length&&(dates=dates.concat(resultData.leaveDevDates));var tooltipMsg=ZPI18N.getString("zp.minperdaywarning",[Calendar.minstohrs(resultData.minHrsDay)]);for(i=0;i<dates.length;i++){date=dates[i],div=tsdatatbody.find("[dateDiv="+date+"]")[0];$(div).addClass("ts_exced").append('<i class="PI_fil_alert" title="'+tooltipMsg+'"></i>')}}Timetracker.timesheet.showCreateList(resultData),Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_name&&(tsViewLayout.find("#timesheet_name").val(Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_name),tsViewLayout.find("#timesheet_name").attr("value",Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_name)),Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_desc&&tsViewLayout.find("#timesheet_desc").val(Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_desc),tsViewLayout.find("#timesheet_create_moreopt,#zp_tt_audithistory").addClass("zpl_DNI"),tsViewLayout.find("#timesheetBeforeUpload").removeClass("zpl_DNI"),Timetracker.timesheet.isApprovalConf?(tsViewLayout.find("#timesheet_create_submit").removeClass("zpl_DNI"),Timetracker.timesheet.isEmpChooseApp&&(Timetracker.timesheet.constructApproverList(),tsViewLayout.find("#sendappdiv").removeClass("zpl_DNI"))):tsViewLayout.find("#timesheet_draft_submit").addClass("btn_filled").removeClass("btn_lined btn_linedClr"),Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment&&""!=Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment?(tsViewLayout.find("#timesheetAfterUpload").data("uploadType",Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileType),tsViewLayout.find("#timesheetAfterUpload").data("fileUploadData",Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileObj),tsViewLayout.find("#timesheetBeforeUpload").addClass("zpl_DNI"),tsViewLayout.find("#timesheetAfterUpload").removeClass("zpl_DNI")):(tsViewLayout.find("#timesheet_view_create").find("#timesheetBeforeUpload").removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_view_create").find("#timesheetAfterUpload").addClass("zpl_DNI")),Timetracker.timesheet.tempStoreForTimesheetDetails={};var isRPHdata=void 0!=tsViewLayout.find("#timesheetbill_rate").data().rate,totHrsHtml=Timetracker.timesheet.constructWarningHtmlWeek(resultData,!0);isBreakEnabled&&isBreakLogAvlbl?(tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().removeClass("zpl_DNI"),0!=paidBrkCount&&0==unpaidBrkCount?(tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().removeClass("zpl_DNI")):0!=unpaidBrkCount&&0==paidBrkCount?(tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().removeClass("zpl_DNI")):0==unpaidBrkCount&&0==paidBrkCount?(tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().addClass("zpl_DNI")):(tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().removeClass("zpl_DNI"))):(tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().addClass("zpl_DNI")),0!=billedCount&&0==nonBilledCount?(tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().removeClass("zpl_DNI"),isRPHdata&&tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").removeClass("zpl_DNI")):0==billedCount&&0!=nonBilledCount?(tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().removeClass("zpl_DNI"),!isNBlogsPayable&&tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").addClass("zpl_DNI"),0!=paidBrkCount||isNBlogsPayable||(tsViewLayout.find("#timesheetbill_hours").html(Calendar.minstohrs(0)),"no_deviation"!==totHrsHtml&&(tsViewLayout.find("#timesheetbill_hours").siblings().remove(),tsViewLayout.find("#timesheetbill_hours").parent().append(totHrsHtml)))):0==billedCount&&0==nonBilledCount?(tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().addClass("zpl_DNI")):(tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_totalhours").parent().parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().removeClass("zpl_DNI"),isRPHdata&&tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").removeClass("zpl_DNI")),tsViewLayout.find("#ts_hoursBanner tr > *:nth-child(3)").addClass("zpl_DNI")},getTimesheetDetails:function(formId,recordId,isFromFeeds,approvalCallback,otherDetails){null!=Timetracker.generalSettings.settingDetails&&null!=Timetracker.jobs.formDetails||(Timetracker.generalSettings.getSyncTimesheetSettings(),Timetracker.util.init()),Timetracker.timesheet.isfromFeeds=isFromFeeds;var layout=otherDetails&&otherDetails.layout?otherDetails.layout:Layout.Page.container,params={mode:"getTimesheetDetails",conreqcsr:csrfToken};0===Object.keys(Timetracker.leave.leaveTypeMap).length&&(params.leaveTypeNeeded=!0),void 0!==ZPeople.Module.MODULE_DATA.timetracker&&void 0!==ZPeople.Module.MODULE_DATA.timetracker.isApprovalConf||(params.getApprovalConfig=!0);var urlParams=settingsUrlProps.urlParamsArr;formId=void 0===formId?urlParams.formId:formId,recordId=void 0===recordId?urlParams.recordId:recordId,params.timesheetId=recordId,$.post(Timetracker.constants.URL,params,function(resultData){if("0"===resultData.res){var errorMessage=Timetracker.Util.getFailureMessageByCode(resultData.errorCode);Timetracker.util.showAlert(0,errorMessage),Timetracker.timesheet.refreshData=!0,Timetracker.UserSpace.Timesheets.refreshData=!0;var ind=settingsUrlProps.niceUrl.indexOf("/edittimesheet");if(-1!=ind){var url=settingsUrlProps.niceUrl.slice(0,ind);void 0!=settingsUrlProps.urlParamsArr.userId&&(url+="-userId:"+settingsUrlProps.urlParamsArr.userId),window.location.href="#"+url}else settingsUrlProps.niceUrl.indexOf("timetracker/timesheets/timesheetlist")&&(window.location.href="#timetracker/mydata/timesheets")}else if(params.leaveTypeNeeded&&Timetracker.leave.setLeaveTypesMap(resultData.resObj.leaveData),0===Object.keys(resultData.resObj.details).length)Timetracker.util.showAlert(0,ZPI18N.getString("zp.deletedtimesheet"));else{var result=resultData.resObj,data=result.details,isBreakEnabled=Timetracker.generalSettings.isBreakEnabled(),tsViewLayout=Timetracker.timesheet.getTimesheetPopup(layout),isNBlogsPayable=data.isNonBillLogsforPayable,isTLFromTSAllowed=Timetracker.generalSettings.isTimelogAddEnabledInTimesheet();ZPApprovals.TIMESHEET_RECORD_DTL[recordId]=result.approvalDetails,Timetracker.timesheet.approvalDtls=result.approvalDetails,Timetracker.timesheet.editListData=data;var recordAppStatus=data.status,isBreakLogAvlbl=!!data.hasOwnProperty("isBreakLogAvlbl")&&data.isBreakLogAvlbl,appbillHours=isBreakEnabled&&isBreakLogAvlbl?data.app_billableHours:data.appbillHours,appnonbillHours=isBreakEnabled&&isBreakLogAvlbl?data.app_nonbillableHours:data.appnonbillHours,billHours=isBreakEnabled&&isBreakLogAvlbl?data.billableHours:data.billHours,nonbillHours=isBreakEnabled&&isBreakLogAvlbl?data.nonbillableHours:data.nonbillHours;1===recordAppStatus||0===recordAppStatus||-1===recordAppStatus&&1!=result.approvalDetails.pendingApprovalLevel&&void 0!==result.approvalDetails.processed&&0!=result.approvalDetails.processed.length||(appbillHours=billHours,appnonbillHours=nonbillHours);var paidBreakHrs=0,unPaidBreakHrs=0,apppaidBreakHrs=0,appUnPaidreakHrs=0;isBreakEnabled&&(paidBreakHrs=data.paidBreakHours,unPaidBreakHrs=data.unpaidBreakHours,apppaidBreakHrs=1===recordAppStatus||0===recordAppStatus?data.app_paidBreak_Hours:data.paidBreakHours,appUnPaidreakHrs=1===recordAppStatus||0===recordAppStatus?data.app_unpaidBreak_Hours:data.unpaidBreakHours);var totalAmount=0;if(isTLFromTSAllowed&&-1===recordAppStatus&&(1==result.approvalDetails.pendingApprovalLevel||void 0===result.approvalDetails.processed||0==result.approvalDetails.processed.length)){var newVal=Timetracker.timesheet.computeTimesheetValues(result.tsArr);appbillHours=newVal.billable,appnonbillHours=newVal.nonbillable,apppaidBreakHrs=newVal.paid,appUnPaidreakHrs=newVal.unpaid,void 0!=data.ratePerHour&&(totalAmount=(isNBlogsPayable?newVal.totalhrs:appbillHours+apppaidBreakHrs)*data.ratePerHour/60)}1==isFromFeeds&&(Timetracker.timesheet.isfromFeeds=isFromFeeds,null!==approvalCallback&&void 0!==approvalCallback&&"function"==typeof approvalCallback&&(Timetracker.timesheet.approvalCallback=approvalCallback)),!0===params.getApprovalConfig&&(ZPeople.Module.MODULE_DATA.timetracker=void 0===ZPeople.Module.MODULE_DATA.timetracker?{}:ZPeople.Module.MODULE_DATA.timetracker,ZPeople.Module.MODULE_DATA.timetracker.isManageTimeData=result.isManageTimeData,Timetracker.timesheet.isApprovalConf=ZPeople.Module.MODULE_DATA.timetracker.isApprovalConf=result.approvalConfig.isApprovalConf,Timetracker.timesheet.isEmpChooseApp=ZPeople.Module.MODULE_DATA.timetracker.isEmpChooseApp=result.approvalConfig.isEmpChooseApp,Timetracker.timesheet.isApprovalConf&&Timetracker.timesheet.isEmpChooseApp&&(Timetracker.timesheet.approverList=ZPeople.Module.MODULE_DATA.timetracker.approverList=result.approvalConfig.approverList)),tsViewLayout.find("#tsdatatbody").attr("approvalStatus",recordAppStatus),tsViewLayout.find("#tsdatatbody").data("isNBlogsPayable",isNBlogsPayable);var userName="<em>"+data.employeeId+" - </em><b>"+data.empName+"</b>";if(tsViewLayout.find("#timesheet_uname").html(userName),tsViewLayout.find("#timesheet_uimg").attr("src",ZPeople.decodeTxt(ZPeople.getUserDetailsById(data.erecno).avatar)),tsViewLayout.find("#tsdatatbody").attr("tserecNo",data.erecno),data.fromDate===data.toDate?tsViewLayout.find("#timesheet_date").html(data.fromDate):tsViewLayout.find("#timesheet_date").html(data.fromDate+" - "+data.toDate),-2===recordAppStatus||0===recordAppStatus?(tsViewLayout.find("#timesheet_name").val(ZPeople.decodeTxt(data.listName)),tsViewLayout.find("#timesheet_name").attr("value",ZPeople.decodeTxt(data.listName)),tsViewLayout.find("#timesheet_desc").val(ZPeople.decodeTxt(data.desc)),data.attachmentId&&data.attachmentName?(tsViewLayout.find("#timesheetBeforeUpload").addClass("zpl_DNI"),tsViewLayout.find("#file_name_change").removeClass("zpl_DNI")):(tsViewLayout.find("#timesheetBeforeUpload").removeClass("zpl_DNI"),0===recordAppStatus&&tsViewLayout.find("#zp_timesheet_file_disp").parent().addClass("zpl_DNI"))):(data.desc=data.desc.replace(/\n/gim,"<br>"),tsViewLayout.find("#timesheet_name").val(ZPeople.decodeTxt(data.listName)),tsViewLayout.find("#timesheet_name").attr("value",ZPeople.decodeTxt(data.listName)),tsViewLayout.find("#timesheet_desc").val(ZPeople.decodeTxt(data.desc)),tsViewLayout.find("#timesheet_name,#timesheet_desc").prop("readonly",!0),tsViewLayout.find("#timesheetBeforeUpload").addClass("zpl_DNI"),data.attachmentId&&data.attachmentName||tsViewLayout.find("#zp_timesheet_file_disp").parent().addClass("zpl_DNI")),data.attachmentId&&data.attachmentName){if("-1"===data.attachmentId){var path=ZPeople.decodeTxt(data.attachmentPath);tsViewLayout.find("#file_name").html(data.attachmentName).on("click",function(){window.open(path)})}else tsViewLayout.find("#file_name").html(data.attachmentName).on("click",function(){Timetracker.util.downloadFile(data.attachmentId,data.recordId,"timesheet")});tsViewLayout.find("#zp_timesheet_file_disp").removeClass("zpl_DNI"),tsViewLayout.find("#file_name").removeClass("zpl_DNI"),tsViewLayout.find("#file_name_change").data("restore",!1),tsViewLayout.find("#file_name_change").text(" "+ZPI18N.getString("zp.changefile")),0!==recordAppStatus&&-2!==recordAppStatus||tsViewLayout.find("#file_name_change").removeClass("zpl_DNI")}else tsViewLayout.find("#zp_timesheet_file_disp").addClass("zpl_DNI");Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_name&&(tsViewLayout.find("#timesheet_name").val(Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_name),tsViewLayout.find("#timesheet_name").attr("value",Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_name)),void 0!=Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_desc&&tsViewLayout.find("#timesheet_desc").val(Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_desc),void 0!=Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment&&(""!=Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment?(tsViewLayout.find("#timesheetAfterUpload").data("uploadType",Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileType),tsViewLayout.find("#timesheetAfterUpload").data("fileUploadData",Timetracker.timesheet.tempStoreForTimesheetDetails.timesheet_attachment.fileObj),tsViewLayout.find("#timesheetBeforeUpload").addClass("zpl_DNI"),tsViewLayout.find("#timesheetAfterUpload").removeClass("zpl_DNI")):(tsViewLayout.find("#timesheetBeforeUpload").removeClass("zpl_DNI"),tsViewLayout.find("#timesheetAfterUpload").addClass("zpl_DNI")),tsViewLayout.find("#zp_timesheet_file_disp").removeClass("zpl_DNI"),tsViewLayout.find("#zp_timesheet_file_disp").find("#file_name").addClass("zpl_DNI"),tsViewLayout.find("#file_name_change").data("restore",!0),tsViewLayout.find("#file_name_change").text(ZPI18N.getString("zp.restore"))),Timetracker.timesheet.tempStoreForTimesheetDetails={};var totalHours=billHours+nonbillHours;if(isBreakEnabled&&(tsViewLayout.find("#timesheet_paidBrkhours").html(Calendar.minstohrs(data.paidBreakHours)),tsViewLayout.find("#timesheet_unpaidBrkhours").html(Calendar.minstohrs(data.unpaidBreakHours)),tsViewLayout.find("#timesheet_paidBrkhours").data().hours=data.paidBreakHours,tsViewLayout.find("#timesheet_unpaidBrkhours").data().hours=data.unpaidBreakHours,totalHours+=data.paidBreakHours+data.unpaidBreakHours),tsViewLayout.find("#timesheet_billhours").html(Calendar.minstohrs(billHours)),tsViewLayout.find("#timesheet_nonbillhours").html(Calendar.minstohrs(nonbillHours)),tsViewLayout.find("#timesheet_totalhours").html(Calendar.minstohrs(totalHours)),tsViewLayout.find("#timesheet_billhours").data().hours=billHours,tsViewLayout.find("#timesheet_nonbillhours").data().hours=nonbillHours,tsViewLayout.find("#timesheet_totalhours").data().hours=totalHours,-1===recordAppStatus||-2===recordAppStatus)if(void 0!=data.ratePerHour?(tsViewLayout.find("#ts_ratePerHour").removeClass("zpl_DNI"),tsViewLayout.find("#ts_totalamt,#ts_totalamnt_formula").removeClass("zpl_DNI"),0===data.appratePerHour?(tsViewLayout.find("#timesheetbill_rate").text(data.ratePerHour),tsViewLayout.find("#timesheetbill_rate").data("rate",data.ratePerHour)):(tsViewLayout.find("#timesheetbill_rate").text(data.appratePerHour),tsViewLayout.find("#timesheetbill_rate").data("rate",data.appratePerHour)),tsViewLayout.find("#timesheetbill_amountcur").text(data.currency),tsViewLayout.find("#timesheetbill_ratecur").text(" "+data.currency),tsViewLayout.find("#timesheetbill_rate").data("currency",data.currency),-1===recordAppStatus?1!=result.approvalDetails.pendingApprovalLevel&&void 0!==result.approvalDetails.processed&&0!=result.approvalDetails.processed.length?tsViewLayout.find("#timesheetbill_amount").text(data.apptotalAmount.toFixed(2)):isTLFromTSAllowed?tsViewLayout.find("#timesheetbill_amount").text(totalAmount.toFixed(2)):tsViewLayout.find("#timesheetbill_amount").text(parseFloat(data.totalAmount).toFixed(2)):tsViewLayout.find("#timesheetbill_amount").text(parseFloat(data.totalAmount).toFixed(2))):(Layout.Page.container.find("#ts_ratePerHour").addClass("zpl_DNI"),Layout.Page.container.find("#ts_totalamt").addClass("zpl_DNI"),Layout.Page.container.find("#ts_totalamnt_formula").addClass("zpl_DNI")),-1===recordAppStatus&&(1!=result.approvalDetails.pendingApprovalLevel&&void 0!==result.approvalDetails.processed&&0!=result.approvalDetails.processed.length||isTLFromTSAllowed)){var payableDispHours=appbillHours+apppaidBreakHrs;isNBlogsPayable&&(payableDispHours+=appnonbillHours+appUnPaidreakHrs),isBreakEnabled&&(Timetracker.timesheet.TsList.payableDispHours=payableDispHours),tsViewLayout.find("#timesheetbill_hours").html(Calendar.minstohrs(payableDispHours)),tsViewLayout.find("#timesheetbill_hours").data("displayHrs",Calendar.minstohrs(payableDispHours))}else{payableDispHours=billHours+paidBreakHrs;isNBlogsPayable&&(payableDispHours+=nonbillHours+unPaidBreakHrs),isBreakEnabled&&(Timetracker.timesheet.TsList.payableDispHours=payableDispHours),tsViewLayout.find("#timesheetbill_hours").html(Calendar.minstohrs(payableDispHours)),tsViewLayout.find("#timesheetbill_hours").data("displayHrs",Calendar.minstohrs(payableDispHours))}else if(1===recordAppStatus||0===recordAppStatus){payableDispHours=appbillHours+apppaidBreakHrs+(isNBlogsPayable?appnonbillHours+appUnPaidreakHrs:0);tsViewLayout.find("#timesheetbill_hours").html(Calendar.minstohrs(payableDispHours)),tsViewLayout.find("#timesheetbill_hours").data("displayHrs",Calendar.minstohrs(payableDispHours)),void 0!=data.apptotalAmount?(tsViewLayout.find("#ts_ratePerHour").removeClass("zpl_DNI"),tsViewLayout.find("#ts_totalamt").removeClass("zpl_DNI"),tsViewLayout.find("#ts_totalamnt_formula").removeClass("zpl_DNI"),tsViewLayout.find("#timesheetbill_rate").text(data.appratePerHour),tsViewLayout.find("#timesheetbill_rate").data("rate",data.appratePerHour),tsViewLayout.find("#timesheetbill_amount").text(parseFloat(data.apptotalAmount).toFixed(2)),tsViewLayout.find("#timesheetbill_amountcur").text(data.currency),tsViewLayout.find("#timesheetbill_ratecur").text(" "+data.currency)):(tsViewLayout.find("#ts_ratePerHour").addClass("zpl_DNI"),tsViewLayout.find("#ts_totalamt").addClass("zpl_DNI"),tsViewLayout.find("#ts_totalamnt_formula").addClass("zpl_DNI"))}tsViewLayout.find("#apptimesheet_billhours").data("bappHours",appbillHours),tsViewLayout.find("#apptimesheet_billhours").html(Calendar.minstohrs(appbillHours)),tsViewLayout.find("#apptimesheet_nonbillhours").data("nbappHours",appnonbillHours),tsViewLayout.find("#apptimesheet_nonbillhours").html(Calendar.minstohrs(appnonbillHours));var totHrsHtml=Timetracker.timesheet.constructWarningHtmlWeek(data,!0),dispHrs=tsViewLayout.find("#timesheetbill_hours").data("displayHrs");tsViewLayout.find("#timesheetbill_hours").html(dispHrs),"no_deviation"!==totHrsHtml&&(tsViewLayout.find("#timesheetbill_hours").siblings().remove(),tsViewLayout.find("#timesheetbill_hours").parent().append(totHrsHtml)),Timetracker.timesheet.currentApprover=!1,void 0!==Timetracker.timesheet.approvalDtls&&((Timetracker.timesheet.approvalDtls.isOwner||Timetracker.isDataAdminForUser(data.erecno))&&(Timetracker.timesheet.currentApprover=!0),void 0!==Timetracker.timesheet.approvalDtls.current&&$.each(ZPeople.SUB_USERLIST,function(index,data){Timetracker.timesheet.approvalDtls.current.erecno===data&&(Timetracker.timesheet.currentApprover=!0)}));var excludeProjRow=!1,excludeProjinJobRow=!1,excludeClientInProjRow=!1,isSingleProject=!1,isSingleClient=!1;""==data.projectName?(excludeProjRow=!0,tsViewLayout.find("#timesheet_logsName").parent().parent().addClass("zpl_DNI")):""==data.clientName?(excludeClientInProjRow=!0,1==data.isSingleProject&&""!=data.projectName?(isSingleProject=!0,tsViewLayout.find("#timesheet_logsName").parent().parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_logsName").html(Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME),tsViewLayout.find("#timesheet_logsValue").html('<span class="DI LH20">'+data.projectName+"</span>"),excludeProjRow=!0,excludeProjinJobRow=!0):tsViewLayout.find("#timesheet_logsName").parent().parent().addClass("zpl_DNI")):1==data.isSingleClient&&""!=data.clientName?(isSingleClient=!0,tsViewLayout.find("#timesheet_logsName").parent().parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_logsName").html(Timetracker.clients.formDetails.labelDetails?Timetracker.clients.formDetails.labelDetails.CLIENTNAME:ZPI18N.getString("zp.clientname")),tsViewLayout.find("#timesheet_logsValue").html("<span>"+data.clientName+"</span>"),excludeClientInProjRow=!0,1==data.isSingleProject&&""!=data.projectName&&(isSingleProject=!0,tsViewLayout.find("#timesheet_logsName").html(Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME),tsViewLayout.find("#timesheet_logsValue").html("<span>"+data.projectName+"</span><font>.</font><em>"+data.clientName+"</em>"),excludeProjRow=!0,excludeProjinJobRow=!0)):tsViewLayout.find("#timesheet_logsName").parent().parent().addClass("zpl_DNI"),!excludeProjRow&&(excludeProjinJobRow=!0);var tsdatatbody=tsViewLayout.find("#tsdatatbody");Timetracker.timesheet.closeTimsheetPage(!0),tsdatatbody.html(""),tsdatatbody.attr("formId",formId),tsdatatbody.attr("recordId",recordId);var approverTimelogEdit="1"==Timetracker.generalSettings.settingDetails.TS_isApproverEditLogtime;approverTimelogEdit=approverTimelogEdit&&Timetracker.timesheet.currentApprover&&-1==recordAppStatus;var extraDtls={};if(extraDtls.hasDescription=Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)&&data.hasDescription,extraDtls.hasAttachment=data.hasAttachment,extraDtls.hasWorkItem="1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem,extraDtls.showBillable=Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS),extraDtls.isHourlyType=data.isHourlyType,extraDtls.excludeProjRow=excludeProjRow,extraDtls.excludeProjinJobRow=excludeProjinJobRow,extraDtls.excludeClientInProjRow=excludeClientInProjRow,extraDtls.layout=tsdatatbody,extraDtls.recordAppStatus=recordAppStatus,extraDtls.approverTimelogEdit=approverTimelogEdit,extraDtls.tsfromDate=result.details.DB_fromDate,extraDtls.tsToDate=result.details.DB_toDate,isTLFromTSAllowed){var manualLog,fromToTimeLog;if(manualLog=!(!result.details.hasOwnProperty("isManualLog")||!result.details.isManualLog),fromToTimeLog=!(!result.details.hasOwnProperty("isfromToLog")||!result.details.isfromToLog),manualLog||fromToTimeLog||(isTLFromTSAllowed=!1),isTLFromTSAllowed){var isProjectManagerBasedApproval=data.isProjectManagerBasedApproval;if(void 0!==isProjectManagerBasedApproval&&null!==isProjectManagerBasedApproval&&isProjectManagerBasedApproval&&(isSingleClient&&(extraDtls.isSingleClient=!0,extraDtls.clientName=data.clientName),isSingleProject&&(extraDtls.isSingleProject=!0,extraDtls.projectName=data.projectName,isSingleClient||(extraDtls.isSingleClient=!0,extraDtls.clientName="-"))),extraDtls.ts_tl_manuallog=manualLog,extraDtls.ts_tl_fromToLog=fromToTimeLog,-1==recordAppStatus&&Timetracker.timesheet.currentApprover||-2===recordAppStatus||0===recordAppStatus){var ts_tladd_dom=tsdatatbody.parent().find("#ts_tladd");$(ts_tladd_dom).parent().removeClass("zpl_DNI"),$(ts_tladd_dom).off().on("click",function(event){event.preventDefault(),Timetracker.timesheet.timelogAddForm(this,extraDtls)})}}}var tsArr=result.tsArr,tlApprovedCount=0,service=result.service,isZFPushedCnt=0,isZFPushAllowCnt=0,isZPPushedCnt=0,isZPPushAllowCnt=0,billedCount=0,nonBilledCount=0,paidBrkCount=0,unpaidBrkCount=0,isEditAllowed=void 0!=data.isTimelogEditAllowed&&data.isTimelogEditAllowed;extraDtls.isTimelogEditAllowed=isEditAllowed,$.each(tsArr,function(index,data){extraDtls.index=index;var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",data),billstatus="";0===data.billableStatus?(billstatus=isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[0]):ZPI18N.getString("zp.billable"),isBreakLog?paidBrkCount+=1:billedCount+=1):(billstatus=isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[1]):ZPI18N.getString("zp.nonbillable"),data.hours,isBreakLog?unpaidBrkCount+=1:nonBilledCount+=1),extraDtls.billstatus=billstatus,-1!==recordAppStatus||!Timetracker.timesheet.currentApprover||-1!==data.approvalStatus&&1!==data.approvalStatus||(tlApprovedCount+=1),Timetracker.timesheet.constructTimesheetLogRow(data,extraDtls),data.isPushAllowToZF&&isZFPushAllowCnt++,1===recordAppStatus&&data.isTimelogPushedToZF&&isZFPushedCnt++,data.isPushAllowToZP&&isZPPushAllowCnt++,1===recordAppStatus&&data.isTimelogPushedToZP&&isZPPushedCnt++,isSingleProject&&(extraDtls.projectId=data.projectId),isSingleClient&&(extraDtls.clientId=data.clientId)});var weekendListDates=[],leaveTypeDiv=Timetracker.Util.getLayout().find("#ts_leaveTypes");if(leaveTypeDiv.find("div").addClass("zpl_DNI"),void 0!=result.leaveData.leaveJson.leaveDetails){for(var leaveData=result.leaveData.leaveJson.leaveDetails,typeSet=new Set,i=0;i<leaveData.length;i++){if(leaveData[i].hasOwnProperty("isweekend")&&leaveData[i].isweekend&&weekendListDates.push(leaveData[i].workdate),6!=leaveData[i].leaveType||6==leaveData[i].leaveType&&1==leaveData[i].isHalfWeekend)typeSet.add(leaveData[i].leaveType);else{var tlDayResetictDates=void 0!==result.details.timelogDates?result.details.timelogDates:[];if(0==tsdatatbody.find("[dateDiv="+leaveData[i].workdate+"]").length||!tlDayResetictDates.includes(leaveData[i].workdate))continue;typeSet.add(leaveData[i].leaveType)}Timetracker.timesheet.constructTimesheetLeaveRow(leaveData[i],extraDtls,"leave")}typeSet.forEach(function(val){0==val||4==val?leaveTypeDiv.find("#ts_paid").removeClass("zpl_DNI"):1==val?leaveTypeDiv.find("#ts_onDuty").removeClass("zpl_DNI"):2==val?leaveTypeDiv.find("#ts_absent").removeClass("zpl_DNI"):3==val?leaveTypeDiv.find("#ts_unpaid").removeClass("zpl_DNI"):5==val?leaveTypeDiv.find("#ts_holiday").removeClass("zpl_DNI"):6==val&&leaveTypeDiv.find("#ts_weekend").removeClass("zpl_DNI")})}if(void 0!==result.details.isMinRestrict&&void 0!==result.details.isPerDayMinRestrict&&result.details.isPerDayMinRestrict)for(var tsFDate=new Date(result.details.DB_fromDate.split("-")),tsTDate=new Date(result.details.DB_toDate.split("-")),msgdata={errorMsg:minPeyDayEMsg=ZPI18N.getString("zp.minperdaywarning",[Calendar.minstohrs(result.details.minHrsDay)])},d=tsFDate;d<=tsTDate;d.setDate(d.getDate()+1)){var workDate=Timetracker.DateTime.getDateinDBformat(d,!0);weekendListDates.includes(workDate)||(msgdata.workdate=workDate,Timetracker.timesheet.constructTimesheetLeaveRow(msgdata,extraDtls,"deviation"))}var firstTableOfBody=tsdatatbody.find("table")[0],txt="<thead><tr>";if(extraDtls.excludeProjRow||(txt+='<th class="mw180" width ="180"><div class="txtbrk zpl_whtspnrml">'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+"</div></th>"),txt+="<th "+(extraDtls.excludeProjRow?'class="mw300" width="300"':'min-width="150px" class="mw150"')+'><div class="txtbrk zpl_whtspnrml">'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+"</div></th>",extraDtls.hasWorkItem&&(txt+='<th class="mw180" width="180"><div class="txtbrk zpl_whtspnrml">'+Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM)+"</div></th>"),(extraDtls.hasDescription||extraDtls.hasAttachment)&&(txt+='<th class="mw80" width="80"></th>'),extraDtls.showBillable&&(txt+='<th class="mw150" width="150"></th>'),extraDtls.isHourlyType||(txt+='<th class="mw280" width="280">'+ZPI18N.getString("zp.fromtotime")+"</th>"),txt+='<th class="w100" width="100">'+ZPI18N.getString("zp.hours")+"</th>",txt+='<th class="mw100 text-right" width="100"><i class="PI_tick2_fil grn" id="all_approval" onclick="Timetracker.timesheet.allcheckAppRej(this);" title="'+ZPI18N.getString("zp.clicktoreject")+'"></i></th></tr></thead>',$(firstTableOfBody).prepend(txt),void 0!=result.details.deviatedDays){var minPeyDayEMsg=ZPI18N.getString("zp.minperdaywarning",[Calendar.minstohrs(result.details.minHrsDay)]);for(i=0;i<result.details.deviatedDays.length;i++){var date=result.details.deviatedDays[i],div=tsdatatbody.find("[dateDiv="+date+"]")[0];$(div).addClass("ts_exced").append('<i class="PI_fil_alert" title="'+minPeyDayEMsg+'"></i>')}}if(void 0!=result.details.maxDeviatedDays){var maxPeyDayEMsg=ZPI18N.getString("zp.maxperdaywarning",[Calendar.minstohrs(result.details.maxHrsDay)]);for(i=0;i<result.details.maxDeviatedDays.length;i++){date=result.details.maxDeviatedDays[i],div=tsdatatbody.find("[dateDiv="+date+"]")[0];$(div).addClass("ts_exced").append('<i class="PI_fil_alert" title="'+maxPeyDayEMsg+'"></i>')}}if(1==result.details.isPerDayMinRestrict){var dates=void 0!=result.details.absentDates&&0!=result.details.absentDates.length?result.details.absentDates:[];void 0!=result.details.leaveDevDates&&0!=result.details.leaveDevDates.length&&(dates=dates.concat(result.details.leaveDevDates));var tooltipMsg=ZPI18N.getString("zp.minperdaywarning",[Calendar.minstohrs(result.details.minHrsDay)]);for(i=0;i<dates.length;i++){date=dates[i],div=tsdatatbody.find("[dateDiv="+date+"]")[0];$(div).addClass("ts_exced").append('<i class="PI_fil_alert" title="'+tooltipMsg+'"></i>')}}tsViewLayout.find("#tsapproval-appdata,#approvedatabody").removeClass("zpl_DNI"),tsViewLayout.find("#ts_hoursBanner tr > *:nth-child(3)").removeClass("zpl_DNI");var apptotHours=appbillHours+appnonbillHours;if(isBreakEnabled&&isBreakLogAvlbl){tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().removeClass("zpl_DNI");var appPaidBreakHrs=1===recordAppStatus||0===recordAppStatus?Timetracker.timesheet.editListData.app_paidBreak_Hours:Timetracker.timesheet.editListData.paidBreakHours;tsViewLayout.find("#apptimesheet_paidBrkhours").data("bappHours",appPaidBreakHrs),tsViewLayout.find("#apptimesheet_paidBrkhours").html(Calendar.minstohrs(appPaidBreakHrs));var appUnPaidBreakHrs=1===recordAppStatus||0===recordAppStatus?Timetracker.timesheet.editListData.app_unpaidBreak_Hours:Timetracker.timesheet.editListData.unpaidBreakHours;tsViewLayout.find("#apptimesheet_unpaidBrkhours").data("nbappHours",appUnPaidBreakHrs),tsViewLayout.find("#apptimesheet_unpaidBrkhours").html(Calendar.minstohrs(appUnPaidBreakHrs)),0!=paidBrkCount&&0==unpaidBrkCount?(tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().removeClass("zpl_DNI")):0!=unpaidBrkCount&&0==paidBrkCount?(tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().removeClass("zpl_DNI")):0==unpaidBrkCount&&0==paidBrkCount?(tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().addClass("zpl_DNI")):(tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().removeClass("zpl_DNI")),apptotHours+=appPaidBreakHrs+appUnPaidBreakHrs}else tsViewLayout.find("#timesheet_paidBrkhours,#apptimesheet_paidBrkhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_unpaidBrkhours,#apptimesheet_unpaidBrkhours").parent().addClass("zpl_DNI");if(tsViewLayout.find("#apptimesheet_totalhours").data("tappHours",apptotHours),tsViewLayout.find("#apptimesheet_totalhours").html(Calendar.minstohrs(apptotHours)),0!=billedCount&&0==nonBilledCount&&0==data.nonbillHours)tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().removeClass("zpl_DNI"),null!=data.ratePerHour&&tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").removeClass("zpl_DNI");else if(0==billedCount&&0!=nonBilledCount&&0==data.billHours){tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().removeClass("zpl_DNI"),tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").addClass("zpl_DNI");var payableHrs=0;if(isNBlogsPayable&&(payableHrs=apptotHours,tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").removeClass("zpl_DNI")),0==paidBrkCount){totHrsHtml=Timetracker.timesheet.constructWarningHtmlWeek(resultData.resObj.details,!0);tsViewLayout.find("#timesheetbill_hours").html(Calendar.minstohrs(payableHrs)),"no_deviation"!==totHrsHtml&&(tsViewLayout.find("#timesheetbill_hours").siblings().remove(),tsViewLayout.find("#timesheetbill_hours").parent().append(totHrsHtml))}}else 0==billedCount&&0==nonBilledCount&&0==billHours&&0==nonbillHours?(tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().addClass("zpl_DNI")):(tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_totalhours").parent().parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().removeClass("zpl_DNI"),null!=data.ratePerHour&&tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").removeClass("zpl_DNI"));var qbodata=result.qboDetails;if(Layout.Page.container.find("#ts_qbo").length&&Layout.Page.container.find("#ts_qbo").remove(),tsViewLayout.find("#zp_approval_comment").val(""),-1===recordAppStatus)tsViewLayout.find("#all_approval").removeClass("gry zpl_DNI").addClass("grn").attr("title",ZPI18N.getString("zp.clicktoreject")),tsViewLayout.find("#tsapproval-subdata").html(ZPI18N.getString("zp.submittedhrs")),tsViewLayout.find("#tsapproval-appdata").html(ZPI18N.getString("zp.hourstobeapproved")),tsViewLayout.find("#timesheet_create_submit,#timesheet_draft_submit").addClass("zpl_DNI"),tsViewLayout.find("#zp_approvereject_box").addClass("zpl_DNI"),tsViewLayout.find("#approvetsbutton").addClass("zpl_DNI"),Timetracker.timesheet.currentApprover&&(tsViewLayout.find("#approvetsbutton").removeClass("zpl_DNI"),tsViewLayout.find('[name="approvalTypeBtn"]').removeClass("zpl_DNI"),tsViewLayout.find('[name="confirmTypeBtn"]').addClass("zpl_DNI"),tsViewLayout.find("#createtsbutton").addClass("zpl_DNI"),Timetracker.isDataAdminForAllUsers()&&Timetracker.timesheet.approvalDtls.pending.length>0?tsViewLayout.find("#zp_appproval_approveall_btn").removeClass("zpl_DNI"):tsViewLayout.find("#zp_appproval_approveall_btn").addClass("zpl_DNI"));else if(1===recordAppStatus){tsViewLayout.find("#all_approval").addClass("zpl_DNI"),tsViewLayout.find("#tsapproval-subdata").html(ZPI18N.getString("zp.submittedhrs")),tsViewLayout.find("#tsapproval-appdata").html(ZPI18N.getString("zp.approvedhrs")),tsViewLayout.find("#timesheet_create_submit,#timesheet_draft_submit").addClass("zpl_DNI"),tsViewLayout.find("#approvetsbutton").addClass("zpl_DNI"),tsViewLayout.find("#createtsbutton").removeClass("zpl_DNI"),tsViewLayout.find("#zp_approvereject_box").addClass("zpl_DNI");let opt=[],customAttributes={};var integCnt=0,zbooksAllowed=!1,zprojectsAllowed=!1;if(qbodata&&(opt.push({id:"ts_qbooks",callback:"Timetracker.timesheet.pushToQBOEvent",name:ZPI18N.getString("zp.tt.qboonline")}),customAttributes.ts_qbooks={sheetId:recordId,isPushed:qbodata.alreadyPushed},integCnt++),Timetracker.ZBooksInvoice.isZBooksPushAllowed(service,isZFPushAllowCnt,isZFPushedCnt)&&(opt.push({id:"ts_zbooks",callback:"Timetracker.timesheet.pushTimelogsFromTS",name:service}),customAttributes.ts_zbooks={sheetId:recordId,service:service,tlcount:isZFPushAllowCnt},zbooksAllowed=!0,integCnt++),Timetracker.ZOHOPROJECTS.isZProjectsPushAllowed(result.isZProjectsIntegEnabled,isZPPushAllowCnt,isZPPushedCnt)&&(opt.push({id:"ts_zprojects",callback:"Timetracker.timesheet.pushTimelogsFromTS",name:Timetracker.constants.integration.zprjct}),customAttributes.ts_zprojects={sheetId:recordId,service:Timetracker.constants.integration.zprjct,tlcount:isZPPushAllowCnt},zprojectsAllowed=!0,integCnt++),1===integCnt&&(qbodata?Timetracker.timesheet.qbPushButton(recordId,qbodata.alreadyPushed,!0):zbooksAllowed?Timetracker.ZBooksInvoice.checkAndAddPushIcon(tsViewLayout.find(".zpl_mhder"),recordId,service,tsArr.length,isZFPushAllowCnt,isZFPushedCnt,!0):zprojectsAllowed&&Timetracker.ZOHOPROJECTS.checkAndAddPushIcon(tsViewLayout.find(".zpl_mhder"),recordId,result.isZProjectsIntegEnabled,isZPPushAllowCnt,isZPPushedCnt)),integCnt>1){var pushHtml='<button id="ts_pushBtn" class="zpl_drpdwn-js zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.pushto")+'<i class="PI_abtm"></i></button>';tsViewLayout.find(".zpl_mhderrgt").prepend($(pushHtml)),Timetracker.Util.constructMoreOption(opt,"ts_push",!1,void 0,{skipIcon:!0});for(let key in customAttributes)ZPeopleComponents.menu("#ts_push").setMenuItemsAttribute(["#"+key],"customAttributes",customAttributes[key])}}else 0===recordAppStatus?(tsViewLayout.find("#all_approval").addClass("zpl_DNI"),tsViewLayout.find("#tsapproval-subdata").html(ZPI18N.getString("zp.submittedhrs")),tsViewLayout.find("#tsapproval-appdata").html(ZPI18N.getString("zp.approvedhrs")),tsViewLayout.find("#timesheet_create_submit").html(ZPI18N.getString("zp.resendforapproval")),tsViewLayout.find("#approvetsbutton").addClass("zpl_DNI"),tsViewLayout.find("#createtsbutton").removeClass("zpl_DNI"),tsViewLayout.find("#zp_approvereject_box").addClass("zpl_DNI"),data.owner===erecno||data.isTimelogEditAllowed?Timetracker.timesheet.isApprovalConf?(tsViewLayout.find("#timesheet_create_submit, #timesheet_draft_submit").removeClass("zpl_DNI"),Timetracker.timesheet.isEmpChooseApp&&(Timetracker.timesheet.constructApproverList(),tsViewLayout.find("#sendappdiv").removeClass("zpl_DNI"))):tsViewLayout.find("#timesheet_draft_submit").addClass("btn_filled").removeClass("btn_lined btn_linedClr"):tsViewLayout.find("#timesheet_create_submit,#timesheet_draft_submit").addClass("zpl_DNI")):-2===recordAppStatus&&(tsViewLayout.find("#tsapproval-appdata,#approvedatabody,#approvetsbutton,#sendappdiv").addClass("zpl_DNI"),tsViewLayout.find("#ts_hoursBanner tr > *:nth-child(3)").addClass("zpl_DNI"),tsViewLayout.find("#tsapproval-txtdiv,#createtsbutton").removeClass("zpl_DNI"),Timetracker.timesheet.isApprovalConf?(tsViewLayout.find("#timesheet_create_submit").removeClass("zpl_DNI"),tsViewLayout.find("#headerApprovalBtn").length&&(tsViewLayout.find("#headerApprovalBtn").addClass("zpl_DNI"),tsViewLayout.find("#zp_appproval_comment_btn").addClass("zpl_DNI")),Timetracker.timesheet.isEmpChooseApp&&(Timetracker.timesheet.constructApproverList(),tsViewLayout.find("#sendappdiv").removeClass("zpl_DNI"))):tsViewLayout.find("#timesheet_draft_submit").addClass("btn_filled").removeClass("btn_lined btn_linedClr"),tsViewLayout.find("#tsapproval-subdata").html(ZPI18N.getString("zp.hourstobesubmitted")));if(-1===recordAppStatus&&Timetracker.timesheet.currentApprover&&tlApprovedCount!=tsArr.length&&(tsViewLayout.find("#all_approval").removeClass("grn").addClass("gry"),tsViewLayout.find("#all_approval").attr("title",ZPI18N.getString("zp.clicktoapprove"))),(1===recordAppStatus||-2===recordAppStatus||0===recordAppStatus||-1===recordAppStatus&&!Timetracker.timesheet.currentApprover)&&tsViewLayout.find("#all_approval").addClass("zpl_DNI"),Timetracker.Audit.checkAndAddAuditIcon(tsViewLayout.find(".zpl_mhder").find(".zpl_mhderrgt"),recordId),-2!==data.status&&void 0!==Timetracker.timesheet.approvalDtls){Timetracker.timesheet.approvalDtls.isfromTimesheet=!0,OPApprovals.Common.RecordOwner.setOwner(recordId,Timetracker.timesheet.approvalDtls.recOwner),OPApprovals.Common.RecordOwner.setAddedBy(recordId,Timetracker.timesheet.approvalDtls.recOwner);let apprParam=new ApprovalParam(formId,recordId,Timetracker.constants.TIMESHEET_TABLE,data.status,Timetracker.isDataAdminForUser(data.erecno)),layoutParam=new LayoutParam(tsViewLayout,tsViewLayout.find(".zpl_mhder"),tsViewLayout.find(".zpl_mfoter"),"Timesheet");new ApprovalRecordHeader(apprParam,layoutParam,{isRecordApprover:Timetracker.timesheet.approvalDtls.isRecordApprover,isPrimaryApprover:Timetracker.timesheet.approvalDtls.isPrimaryAppr,isResubmitApplicable:!1}).show(),tsViewLayout.data({appParam:apprParam,layoutParam:layoutParam})}else tsViewLayout.find(".modal-body,.modal-footer").removeClass("ZPAprval");if(tsViewLayout.find("#timesheet_view").addClass("zpl_DNI"),tsViewLayout.find("#timesheet_create_back").addClass("zpl_DNI"),tsViewLayout.find("#timesheet_create_moreopt,#timesheet_export").removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_create").removeClass("zpl_DNI"),ZPeople.registerFileInput(),void 0!==otherDetails&&null!==otherDetails){if(otherDetails.isFromTSView){var appObj=otherDetails.appObj;if(void 0!=appObj&&"function"==typeof appObj.approveRejectDtlCallBack){var apprData={};apprData.approvalJson=Timetracker.timesheet.approvalDtls,appObj.approveRejectDtlCallBack(apprData,null),otherDetails.refreshDataInTsRow=!0}}otherDetails.refreshDataInTsRow&&(Timetracker.timesheet.updateTSListRow(data),otherDetails.refreshDataInTsRow=!1)}}})},computeTimesheetValues:function(tsArr){let billable=nonbillable=paid=unpaid=totalhrs=0;return $.each(tsArr,function(index,data){totalhrs+=data.hours;var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",data);0===data.billableStatus?isBreakLog?paid+=data.hours:billable+=data.hours:isBreakLog?unpaid+=data.hours:nonbillable+=data.hours}),{billable:billable,nonbillable:nonbillable,paid:paid,unpaid:unpaid,totalhrs:totalhrs}},updateTSListRow:function(data){var tsRecordRow=$('tr[id="list-'+data.recordId+'"]');(Timetracker.UserSpace.isMySpaceTimesheets()||Timetracker.UserSpace.isMySpaceActionList())&&(tsRecordRow=Timetracker.Util.getLayout().find("#list-"+data.recordId));var rowData={recordId:data.recordId,timesheetName:data.listName,description:data.desc,erecno:data.erecno,employeeId:data.employeeId,status:data.status,isPartiallyApproved:data.isPartiallyApproved,billableHours:data.billHours,nonbillableHours:data.nonbillHours,totalHours:data.totalHours,approvedBillableHours:data.appbillHours,approvedNonBillableHours:data.appnonbillHours,approvedTotalHours:data.apptotalHours,currency:data.currency,employeeName:data.empName,fromDate:data.fromDate,toDate:data.toDate,formId:data.formId,owner:data.owner,isDeleteAllowed:data.isDeleteAllowed};if(void 0!=Timetracker.timesheet.approvalDtls&&void 0!==Timetracker.timesheet.approvalDtls.current&&(rowData.approver=Timetracker.timesheet.approvalDtls.current.name),0!==tsRecordRow.length)if(Timetracker.UserSpace.isMySpaceActionList())Timetracker.UserSpace.ActionListTimesheets.timesheetRowReplace($(tsRecordRow),rowData);else if(Timetracker.UserSpace.isMySpaceTimesheets())Timetracker.UserSpace.Timesheets.timesheetRowReplace($(tsRecordRow),rowData);else{let timesheetDiv=Timetracker.timesheet.constructTSRow(rowData);$(tsRecordRow).replaceWith(timesheetDiv)}},modifyTimelogModalFromTimesheet:function(){var layout=Timetracker.Util.getLayout();0!==layout.find("div[id^='zp_addedit_record_']").length&&(Layout.Page.hash.indexOf("home/myspace/overview-approval")>=0||Layout.Page.hash.indexOf("home/team/approvals")>=0)&&layout.find("div[id^='zp_addedit_record_']").addClass("zpl_ntzindx")},isTimelogFromTimesheet:function(){var fromObj=ZP5Form.getFormClassObj();return!(void 0==fromObj||!fromObj.getParams().isTLAddFromTS)},getTimesheetIdForTimelog:function(){var recordId=null;Timetracker.timesheet.isTimelogFromTimesheet()&&(recordId=Timetracker.Util.getLayout().find("#tsdatatbody").attr("recordId"));return recordId},setFormTimelogAddCallback:function(){let formsClassObj=ZP5Form.getFormClassObj();$.each(formsClassObj.LAYOUT.find("[zcomponentname]"),function(){formsClassObj.destroyZComponents($(this))}),window.location.href=Layout.Page.hash;var layout=Timetracker.Util.getLayout(),formId=layout.find("#tsdatatbody").attr("formId"),recordId=layout.find("#tsdatatbody").attr("recordId");void 0==recordId||null==recordId?Timetracker.timelogs.getCreateTimesheetList({isTLAddFromTS:!0}):Timetracker.timesheet.getTimesheetDetails(formId,recordId,null,null,null)},isAddTimelogFromTSAllowed:function(){var isEnabled=!1;return Timetracker.timesheet.isTimelogFromTimesheet()&&(isEnabled=Timetracker.generalSettings.isTimelogAddEnabledInTimesheet()),isEnabled},timelogAddForm:function(thisDom,extraDtls){var tsFromDate=extraDtls.hasOwnProperty("tsfromDate")?extraDtls.tsfromDate:null,tsToDate=extraDtls.hasOwnProperty("tsToDate")?extraDtls.tsToDate:null,dateFldJson={isTLAddFromTS:!0};null!=tsFromDate&&null!=tsToDate&&(dateFldJson.tsFromDate=tsFromDate,dateFldJson.tsToDate=tsToDate,extraDtls.hasOwnProperty("isSingleProject")&&(dateFldJson.projectId=extraDtls.projectId,dateFldJson.projectName=extraDtls.projectName,dateFldJson.isSingleProject=extraDtls.isSingleProject),extraDtls.hasOwnProperty("isSingleClient")&&(dateFldJson.clientId=extraDtls.clientId,dateFldJson.clientName=extraDtls.clientName,dateFldJson.isSingleClient=extraDtls.isSingleClient),extraDtls.hasOwnProperty("ts_tl_manuallog")&&(dateFldJson.ts_tl_manuallog=extraDtls.ts_tl_manuallog),extraDtls.hasOwnProperty("ts_tl_fromToLog")&&(dateFldJson.ts_tl_fromToLog=extraDtls.ts_tl_fromToLog)),Timetracker.timelogs.Operations.formAddEditView(null,null,!1,!1,!1,dateFldJson)},constructTimesheetLogRow:function(data,extraDtls){var dateDiv,tsdatatbody=extraDtls.layout?extraDtls.layout:Timetracker.Util.getLayout().find("#tsdatatbody"),workDate=data.db_workDate.split(" ")[0],recordAppStatus=extraDtls.recordAppStatus,approverTimelogEdit=extraDtls.approverTimelogEdit,isEditAllowed=void 0!=extraDtls.isTimelogEditAllowed&&extraDtls.isTimelogEditAllowed,isTimesheetEdit=void 0==extraDtls.isTimesheetEdit||extraDtls.isTimesheetEdit,isShiftEnabled=Timetracker.isTTSthiftEnabled();if(0==tsdatatbody.find("[dateDiv="+workDate+"]").length){var datee=data.db_workDate.split(" ")[0].split("-"),dt=new Date(datee[0],parseInt(datee[1])-1,datee[2]),html='<div class="zpl_tmlnrow" dateDiv="'+workDate+'"><div class="zpl_tmlnlft"><div><b>'+months[dt.getMonth()]+" "+dt.getDate()+"</b><span>"+days[dt.getDay()]+'</span></div></div><div class="zpl_tmlnrgt"><div class="zpl_tblres"><table class="zpl_tbl zpl_nocrsor"><tbody date="'+workDate+'" ></tbody></table></div></div><div class="zpl_ttlgcir"></div></div>';dateDiv=$(html),tsdatatbody.append(dateDiv)}else dateDiv=tsdatatbody.find("[dateDiv="+workDate+"]");var txt='<tr class="timelog" id="'+data.timelogId+'" type="'+data.type+'" date="'+workDate+'">';if(extraDtls.excludeProjRow||(data.projectName?txt+='<td class="mw180" width ="180"><div class="zpl_cstnmes"><span>'+data.projectName+"</span>"+(!extraDtls.excludeClientInProjRow&&data.clientName?"<font>.</font><em>"+data.clientName+"</em></div>":"")+"</tb>":txt+='<td class="mw180" width ="180"></tb>'),!extraDtls.excludeProjinJobRow&&data.projectName?txt+="<td "+(extraDtls.excludeProjRow?'class="mw300" width ="300"':'min-width="150px" class="mw150"')+'><div class="zpl_cstnmes"><span name="jobView">'+data.jobName+"</span><font>.</font><em>"+data.projectName+"</em></div>":txt+="<td "+(extraDtls.excludeProjRow?'class="mw300" width ="300"':'min-width="150px" class="mw150"')+'><span name="jobView">'+data.jobName+"</span>",txt+='<div class="zpl_DNI"><input id="ts_job_'+data.timelogId+'" name="job" jobId = "'+data.jobId+'"></div>',txt+="</td>",extraDtls.hasWorkItem&&(data.taskName?(txt+='<td class="workItemVal mw180" width="180">'+data.taskName+"</td>",(-1!==recordAppStatus&&1!==recordAppStatus||approverTimelogEdit)&&(txt+='<td class="workItemEdit zpl_DNI mw180" width="180"><div class="mw150" name="tsWorkItemSelect" id="tsWorkItemSelect'+extraDtls.index+'" ></div><input type="text" class="mw150 ztextbox" id="tsWorkItemInput" placeholder="'+ZPI18N.getString("zp.whatareyouworkingon")+'"></td>')):(txt+='<td class="workItemVal mw180" width="180">--</td>',(-1!==recordAppStatus&&1!==recordAppStatus||approverTimelogEdit)&&(txt+='<td class="workItemEdit zpl_DNI mw180" width="180"><div class="mw150" name="tsWorkItemSelect" id="tsWorkItemSelect'+extraDtls.index+'" ></div><input type="text" class="mw150 ztextbox" id="tsWorkItemInput" placeholder="'+ZPI18N.getString("zp.whatareyouworkingon")+'"></td>'))),extraDtls.hasDescription||extraDtls.hasAttachment){if(txt+='<td class="mw80" width="80"><div class="zpl_tshticnsprtn">',extraDtls.hasDescription&&(data.description||data.notes&&0!=data.notes.length)){var title=data.description&&data.notes&&0!=data.notes.length?Timetracker.util.descriptionDispName+" & "+ZPI18N.getString("zp.notes"):data.description?Timetracker.util.descriptionDispName:ZPI18N.getString("zp.notes");txt+='<i class="PI_note zpl_cp" id="descIcon_'+data.timelogId+'" onclick="Timetracker.timesheet.showDescPopup(\''+data.timelogId+'\')" title="'+ZPI18N.getString("zp.viewComp",[title])+'"></i>'}extraDtls.hasAttachment&&(data.attachId?txt+='<i class="PI_attach" title="'+ZPI18N.getString("zp.downloadfile")+'" onclick="Timetracker.util.downloadFile(\''+data.attachId+"','"+data.timelogId+"','timelog');\"></i>":data.attachPath&&(txt+='<i class="PI_attach" title="'+ZPI18N.getString("zp.downloadfile")+'" onclick="window.open(\''+ZPeople.decodeTxt(data.attachPath)+"')\"></i>")),txt+="</div></td>"}extraDtls.showBillable&&(txt+='<td class="mw150" width="150"><span id="statusView_'+data.timelogId+'" status="'+data.billableStatus+'" >'+extraDtls.billstatus+"</span>",(-1!==recordAppStatus&&1!==recordAppStatus||approverTimelogEdit)&&(txt+='<div class="zpl_DNI"><select id="statusEdit_'+data.timelogId+'" class="W120" ><option value="0" '+("0"==data.billableStatus?"selected":"")+">"+ZPI18N.getString("zp.billable")+'</option><option value="1" '+("1"==data.billableStatus?"selected":"")+">"+ZPI18N.getString("zp.nonbillable")+"</option></select></div>"),txt+="</td>");var timeFieldIs=[];if(0==extraDtls.isHourlyType){if(txt+='<td class="mw280" width="280">',"1"==data.type){let title=Timetracker.util.getShiftDatebyTimeStr(data.fromTime,data.workDate,Timetracker.constants.MINUTES)+" - "+Timetracker.util.getShiftDatebyTimeStr(data.toTime,data.workDate,Timetracker.constants.MINUTES);txt+='<span id="actualHours'+data.timelogId+'" title="'+title+'">'+Timetracker.util.getShiftDatebyTimeStr(data.fromTime,data.workDate,Timetracker.constants.MINUTES,!0)+" - "+Timetracker.util.getShiftDatebyTimeStr(data.toTime,data.workDate,Timetracker.constants.MINUTES,!0)+"</span>",isShiftEnabled?(txt+='<div id="showTimesheetEditEntry'+data.timelogId+'" class="dblerw zpl_DNI">',txt+='<div class="zpl_w-80"><input id="timesheetListlogFrom'+data.timelogId+'" type="text" valInSec="'+data.fromTime+'" class="ztextbox w100"></div>',txt+='<div class="zpl_w-80"><input id="timesheetListlogTo'+data.timelogId+'" type="text" valInSec="'+data.toTime+'" class="ztextbox w100"></div></div>'):(txt+='<div id="showTimesheetEditEntry'+data.timelogId+'" class="d-flexclmcap5 a-itm-cntr zpl_DNI">',txt+='<input id="timesheetListlogFrom'+data.timelogId+'" type="text" value="'+Calendar.minstotimeFormat(data.fromTime)+'"><em>-</em>',txt+='<input id="timesheetListlogTo'+data.timelogId+'" type="text" value="'+Calendar.minstotimeFormat(data.toTime)+'"></div>'),timeFieldIs.push("timesheetListlogFrom"+data.timelogId),timeFieldIs.push("timesheetListlogTo"+data.timelogId)}else if("2"==data.type&&data.timearr){txt+='<div id="timerlogShow_'+data.timelogId+'" class="dblerw">';for(var i=0;i<data.timearr.length;i++){txt+='<span title="'+(Timetracker.util.getShiftDatebyTimeStr(data.timearr[i].fromTime,data.workDate,Timetracker.constants.SECONDS)+" - "+Timetracker.util.getShiftDatebyTimeStr(data.timearr[i].toTime,data.workDate,Timetracker.constants.SECONDS))+'">'+Timetracker.util.getShiftDatebyTimeStr(data.timearr[i].fromTime,data.workDate,Timetracker.constants.SECONDS,!0)+" - "+Timetracker.util.getShiftDatebyTimeStr(data.timearr[i].toTime,data.workDate,Timetracker.constants.SECONDS,!0)+" </span>"}if(txt+="</div>",-1!==recordAppStatus&&1!==recordAppStatus||approverTimelogEdit){txt+='<div id="timerlogEdit_'+data.timelogId+'"  class="d-flexclm8 zpl_DNI">';for(i=0;i<data.timearr.length;i++)isShiftEnabled?(txt+='<div class="dblerw" timerId="'+data.timearr[i].timerId+'"><div class="zpl_w-80 zpl_mb1"><input id="timerlogFrom_'+data.timearr[i].timerId+'" type="text"  valInSec = '+data.timearr[i].fromTime+"></div>",txt+='<div class="zpl_w-80"><input id="timerlogTo_'+data.timearr[i].timerId+'" class="form-control" type="text"  valInSec = '+data.timearr[i].toTime+"></div></div>"):(txt+='<div class="d-flexclmcap5 a-itm-cntr" timerId="'+data.timearr[i].timerId+'"><input id="timerlogFrom_'+data.timearr[i].timerId+'" type="text" valInSec = '+data.timearr[i].fromTime+">",txt+='<em>-</em><input id="timerlogTo_'+data.timearr[i].timerId+'" class="form-control" type="text"  valInSec = '+data.timearr[i].toTime+"></div>"),timeFieldIs.push("timerlogFrom_"+data.timearr[i].timerId),timeFieldIs.push("timerlogTo_"+data.timearr[i].timerId);txt+="</div>"}}txt+="</td>"}(txt+='<td class="mw100" width="100"><span id="'+("0"==data.type?"actualHours":"timelogHours_")+data.timelogId+'">'+Calendar.minstohrs(data.hours)+"</span>","0"==data.type&&(-1!==recordAppStatus&&1!==recordAppStatus||approverTimelogEdit)&&(txt+='<div id="showTimesheetEditEntry'+data.timelogId+'" class="zpl_DNI"><input id="timesheetListlogEntry'+data.timelogId+'" type="text"  value="'+Calendar.minstohrs(data.hours)+'" class="ztextbox w80"></div>'),txt+="</td>",txt+='<td class="mw100" width="100">',1==recordAppStatus)?txt+='<i class="'+(1===data.approvalStatus?"PI_like grn":"PI_unlike red")+'"></i>':(txt+='<div class="zpl_ttshtactitms a-itm-cntr '+(-1==recordAppStatus?"d-flex-btw":"d-flexclmcap10")+'">',(-1==recordAppStatus&&approverTimelogEdit&&0==data.billingStatus||-1!=recordAppStatus&&isEditAllowed)&&(txt+='<div class="zpl_hvr"><i class="PI_edt" onclick="Timetracker.timesheet.showEditTimesheetListEntry(\''+data.timelogId+"',"+recordAppStatus+');" title="'+ZPI18N.getString("zp.edit")+'"></i></div>'),-1!=recordAppStatus&&isEditAllowed&&(txt+='<i class="PI_tick grn zpl_DNI zpl_cp" id="saveTimesheetListEdit'+data.timelogId+'" title="'+ZPI18N.getString("zp.save")+'" onclick="Timetracker.timesheet.editTimesheetListEntry(this,\''+data.timelogId+"','"+data.type+"',"+isTimesheetEdit+",'"+data.billableStatus+"','"+data.jobId+"');\"></i>"),(-1==recordAppStatus&&approverTimelogEdit&&0==data.billingStatus||-1!=recordAppStatus&&isEditAllowed)&&(txt+='<i class="PI_cls red zpl_DNI zpl_cp" title="'+ZPI18N.getString("zp.cancel")+'" id="cancelTimesheetListEdit'+data.timelogId+'" onclick="Timetracker.timesheet.hideEditTimesheetListEntry(\''+data.timelogId+"');\"></i>"),-1===recordAppStatus&&Timetracker.timesheet.currentApprover&&(void 0===data.approvalStatus||-1!==data.approvalStatus&&1!==data.approvalStatus?txt+='<i class="PI_tick2_fil gry choose_app zpl_cp" onclick="Timetracker.timesheet.allcheckAppRej(this);" value="0" id="opt'+data.timelogId+'" title="'+ZPI18N.getString("zp.clicktoapprove")+'"></i>':txt+='<i class="PI_tick2_fil grn choose_app zpl_cp" onclick="Timetracker.timesheet.allcheckAppRej(this);" value="1" id="opt'+data.timelogId+'" title="'+ZPI18N.getString("zp.clicktoreject")+'"></i>'),(0===recordAppStatus||-1===recordAppStatus&&!Timetracker.timesheet.currentApprover)&&(1===data.approvalStatus?txt+='<i class="PI_like grn"></i>':0===data.approvalStatus?txt+='<i class="PI_unlike red"></i>':-1===data.approvalStatus&&(txt+='<i class="PI_pending3 ylw"></i>')),txt+="</div>");txt+="</td></tr>",txt=$(txt),$(txt).data(data),$(dateDiv).find("tbody").append(txt)},constructDescPopup:function(data){if(0==Layout.Page.container.find("#descPopup").length){var header='<div></div><a class="_cls PI_cls" onclick="Timetracker.timesheet.closeDescPopup()" title="'+ZPI18N.getString("zp.close")+'"></a>';ModuleComp.Modal.setup({id:"descPopup",type:1,headerHtml:header,body:'<form><div class="zpl_crd"><div class="zpl_crdcnt" id="descBodyTag"></div></div></form>',backdrop:!0,modalClass:"zpl_mdl zpl_mcenter zpl_ntzindx",closeonEsc:!0,disableFooter:!0})}else Layout.Page.container.find("#descPopup").find("#descBodyTag").html("");if(data.description&&Layout.Page.container.find("#descPopup").find("#descBodyTag").append('<div class="zpl_secn"><b>'+Timetracker.util.descriptionDispName+"</b><p>"+data.description+"</p></div>"),data.notes&&0!=data.notes.length){for(var txt='<div class="zpl_secn"><b>'+ZPI18N.getString("zp.notes")+"</b>",i=0;i<data.notes.length;i++)txt+="<p>"+data.notes[i].comment+"</p>";txt+="</div></div>",Layout.Page.container.find("#descPopup").find("#descBodyTag").append(txt)}},showDescPopup:function(timelogId){Timetracker.timesheet.constructDescPopup(Layout.Page.container.find("#"+timelogId).data()),ModuleComp.Modal.show(Layout.Page.container.find("#descPopup"))},closeDescPopup:function(){ModuleComp.Modal.hide("descPopup")},constructApproverList:function(){if(Timetracker.timesheet.approverList){var txt='<option value="0">'+ZPI18N.getString("zp.selectapprover")+"</option>";for(var key in Timetracker.timesheet.approverList)txt+='<option value="'+key+'">'+Timetracker.timesheet.approverList[key]+"</option>";Layout.Page.container.find("#timesheet_view_create").find("#empChoosenApprErecno").html(txt)}TimelyZComp.select.intialize(Layout.Page.container.find("#timesheet_view_create").find("#empChoosenApprErecno"))},constructTimesheetLeaveRow:function(data,extraDtls,type){var dateDiv,tsdatatbody=extraDtls.layout?extraDtls.layout:Timetracker.Util.getLayout().find("#tsdatatbody"),workDate=data.workdate;if(0==tsdatatbody.find("[dateDiv="+workDate+"]").length){if(6==data.leaveType&&data.isweekend)return;var datee=workDate.split("-"),dt=new Date(datee[0],parseInt(datee[1])-1,datee[2]),html='<div class="zpl_tmlnrow" dateDiv="'+workDate+'"><div class="zpl_tmlnlft"><div><b>'+months[dt.getMonth()]+" "+dt.getDate()+"</b><span>"+days[dt.getDay()]+'</span></div></div><div class="zpl_tmlnrgt"><div class="zpl_tblres "><table class="zpl_tbl zpl_nocrsor"><tbody date="'+workDate+'" ></tbody></table></div></div><div class="zpl_ttlgcir"></div></div>';dateDiv=$(html),"deviation"==type&&($(dateDiv).addClass("ts_exced"),$(dateDiv).append('<i class="PI_fil_alert" title="'+data.errorMsg+'"></i>'));for(var tsRows=tsdatatbody.children(),insertFlag=0,temp=0;temp<tsRows.length;temp++){datee=$(tsRows[temp]).attr("dateDiv").split("-");if(!(dt>new Date(datee[0],parseInt(datee[1])-1,datee[2]))){dateDiv.insertBefore(tsRows[temp]),insertFlag=1;break}}0==insertFlag&&$(tsdatatbody).append(dateDiv)}else{if("deviation"==type)return;dateDiv=tsdatatbody.find("[dateDiv="+workDate+"]")}if(!extraDtls.colspan){var cntr=7;extraDtls.excludeProjRow&&cntr--,extraDtls.hasWorkItem||cntr--,extraDtls.hasDescription||extraDtls.hasAttachment||cntr--,extraDtls.isHourlyType&&cntr--,extraDtls.showBillable||cntr--,extraDtls.colspan=cntr}var txt="";"leave"==type?(txt='<tr><td width="300px" colspan="2"><div class="d-flexC flexclmcap"><span class="zpl_lbdr _bx '+Timetracker.leave.getFillerClassByLeaveType(data.leaveType,!0)+'"></span><span title="'+data.name+'">'+data.name+"</span>",void 0!=data.hours&&0!=data.hours&&(txt+="<span>"+Calendar.minstohrs(data.hours)+" "+ZPI18N.getString("zp.hrs")+"</span>"),txt+='</td><td colspan="'+(extraDtls.colspan-1)+'">'+ZPeople.escapeHtml(data.reason)+"</td></tr>"):txt='<tr><td colspan="'+(extraDtls.colspan+1)+'"></td></tr>',dateDiv.find("tbody").append(txt)},allcheckAppRej:function(ele){var isAllCheck="all_approval"==$(ele).attr("id"),tsViewLayout=Timetracker.Util.getLayout().find("#timesheet_view_create");if(1==isAllCheck){var obj=tsViewLayout.find("#all_approval"),isChecked=!0;obj.hasClass("grn")?(isChecked=!1,obj.removeClass("grn").addClass("gry"),obj.attr("title",ZPI18N.getString("zp.clicktoapprove"))):(isChecked=!0,obj.removeClass("gry").addClass("grn"),obj.attr("title",ZPI18N.getString("zp.clicktoreject"))),tsViewLayout.find("tr.timelog").each(function(){var inputObj=$(this).find(".choose_app");isChecked?$(inputObj).removeClass("gry").addClass("grn"):$(inputObj).removeClass("grn").addClass("gry"),$(inputObj).attr("title",isChecked?ZPI18N.getString("zp.clicktoreject"):ZPI18N.getString("zp.clicktoapprove"))})}else $(ele).hasClass("choose_app")&&($(ele).hasClass("grn")?($(ele).removeClass("grn").addClass("gry"),$(ele).attr("title",ZPI18N.getString("zp.clicktoapprove"))):($(ele).removeClass("gry").addClass("grn"),$(ele).attr("title",ZPI18N.getString("zp.clicktoreject"))));Timetracker.util.removeErrorMsg("timesheet_view_create");var tsdatatbody=tsViewLayout.find("#tsdatatbody"),tappHours=0,bappHours=0,nbappHours=0,p_appHours=0,up_appHours=0,billedCount=0,nonBilledCount=0,paidBreakCount=0,subbhrs=tsViewLayout.find("#timesheet_billhours").data().hours,subnbhrs=tsViewLayout.find("#timesheet_nonbillhours").data().hours,ratePerHour=(tsViewLayout.find("#timesheet_paidBrkhours").data().hours,tsViewLayout.find("#timesheet_unpaidBrkhours").data().hours,tsViewLayout.find("#timesheetbill_rate").data().rate),flag=0,approverTimelogEdit="1"==Timetracker.generalSettings.settingDetails.TS_isApproverEditLogtime,isBreakEnabled=Timetracker.generalSettings.isBreakEnabled(),isShiftEnabled=Timetracker.isTTSthiftEnabled(),recStatus=tsViewLayout.find("#tsdatatbody").attr("approvalStatus");tsdatatbody.find("tr.timelog").each(function(){var status,tr=$(this),data=tr.data(),inputObj=tr.find(".choose_app"),isBreakLog=!!data.hasOwnProperty("isBreakLog")&&data.isBreakLog;if(-1==recStatus&&(status=!!inputObj.hasClass("grn")),status=void 0==status||status,$(inputObj).attr("title",status?ZPI18N.getString("zp.clicktoreject"):ZPI18N.getString("zp.clicktoapprove")),approverTimelogEdit||-1!=recStatus){var tlId=data.timelogId,type=tr.attr("type");if(hours=0,1==type)if(isShiftEnabled)if(ZPeopleComponents.isComponent(tr.find("#timesheetListlogFrom"+tlId))){var date_val=Calendar.parseDate(data.workDate,uidateFormat);let fTime=TimelyZComp.datetimefield.getDateObj(tr.find("#timesheetListlogFrom"+tlId)),tTime=TimelyZComp.datetimefield.getDateObj(tr.find("#timesheetListlogTo"+tlId));date_val&&fTime&&(fromTime=date_val.getDiff(fTime,Timetracker.constants.MINUTES)),date_val&&tTime&&(toTime=date_val.getDiff(tTime,Timetracker.constants.MINUTES));let msg,isError=!1;if(fromTime<-Timetracker.constants.PER_DAY_MIN||fromTime>=2*Timetracker.constants.PER_DAY_MIN||toTime<-Timetracker.constants.PER_DAY_MIN||toTime>=2*Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.entervalidtime")):toTime-fromTime>Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.timeexceeded24")):toTime<fromTime&&(isError=!0,msg=ZPI18N.getString("zp.fromtimegreater")),isError)return Timetracker.Util.addError($(tr).find("#timesheetListlogFrom"+tlId)),Timetracker.Util.addError($(tr).find("#timesheetListlogTo"+tlId)),Timetracker.Util.mandOptnErrMsg("showTimesheetEditEntry"+tlId,tr,msg),flag=1,!1;hours=toTime-fromTime,$(tr).find("#timelogHours_"+tlId).html(Calendar.minstohrs(hours))}else hours=data.hours,$(tr).find("#timelogHours_"+tlId).html(Calendar.minstohrs(hours));else{var hours;if(TimelyZComp.isComponent($(tr).find("#timesheetListlogFrom"+tlId))&&TimelyZComp.isComponent($(tr).find("#timesheetListlogTo"+tlId))){if(fromhrstot=TimelyZComp.timeField.getValue($(tr).find("#timesheetListlogFrom"+tlId)),tohrstot=TimelyZComp.timeField.getValue($(tr).find("#timesheetListlogTo"+tlId)),""==fromhrstot||""==tohrstot)return Timetracker.Util.addError($(tr).find("#timesheetListlogFrom"+tlId)),Timetracker.Util.addError($(tr).find("#timesheetListlogTo"+tlId)),flag=1,!1;var fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.split(":")),toTime=Timetracker.util.getTotalTimeForHours(tohrstot.split(":"));hours=fromTime>toTime?toTime+1440-fromTime:toTime-fromTime}else hours=data.hours;$(tr).find("#timelogHours_"+tlId).html(Calendar.minstohrs(hours))}else if(0==type){if(!(hours=$(tr).find("#timesheetListlogEntry"+tlId).val()).match(Timetracker.util.maxhrsRegex))return $(tr).find("#timesheetListlogEntry"+tlId).addClass("ztextbox__error"),flag=1,!1;hours=Timetracker.DateTime.convertToMins(hours)}else if(2==type){if(isShiftEnabled)if(ZPeopleComponents.isComponent(tr.find("[id^=timerlogFrom_]")[0])){date_val=Calendar.parseDate(data.workDate,uidateFormat);if($(tr).find("#timerlogEdit_"+tlId).children().each(function(){var timerId=$(this).attr("timerId");let fromTime,toTime,fTime=TimelyZComp.datetimefield.getDateObj($(this).find("#timerlogFrom_"+timerId)),tTime=TimelyZComp.datetimefield.getDateObj($(this).find("#timerlogTo_"+timerId));date_val&&fTime&&(fromTime=date_val.getDiff(fTime,Timetracker.constants.MINUTES)),date_val&&tTime&&(toTime=date_val.getDiff(tTime,Timetracker.constants.MINUTES));let msg,isError=!1;if(fromTime<-Timetracker.constants.PER_DAY_MIN||fromTime>=2*Timetracker.constants.PER_DAY_MIN||toTime<-Timetracker.constants.PER_DAY_MIN||toTime>=2*Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.entervalidtime")):toTime-fromTime>Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.timeexceeded24")):toTime<fromTime&&(isError=!0,msg=ZPI18N.getString("zp.fromtimegreater")),isError)return Timetracker.Util.addError($(tr).find("#timerlogFrom_"+timerId)),Timetracker.Util.addError($(tr).find("#timerlogTo_"+timerId)),Timetracker.Util.mandOptnErrMsg("timerlogEdit_"+tlId,tr,msg),flag=1,!1;var fromSec=null!=$(this).find("#timerlogFrom_"+timerId).attr("valInSec")?$(this).find("#timerlogFrom_"+timerId).attr("valInSec"):0,toSec=$(this).find("#timerlogTo_"+timerId).attr("valInSec")?$(this).find("#timerlogTo_"+timerId).attr("valInSec"):0;if((hours+=(fromTime=60*fromTime+fromSec%60)>(toTime=60*toTime+toSec%60)?toTime+86400-fromTime:toTime-fromTime)>86400)return Timetracker.Util.addError($(tr).find("#timerlogFrom_"+timerId)),Timetracker.Util.addError($(tr).find("#timerlogTo_"+timerId)),Timetracker.Util.mandOptnErrMsg("timerlogEdit_"+tlId,tr,ZPI18N.getString("zp.timeexceeded24")),flag=1,!1;fromTime!=fromSec||toTime!=toSec?$(tr).find("#timerlogFrom_"+timerId).parent().addClass("brclrseled"):$(tr).find("#timerlogFrom_"+timerId).parent().removeClass("brclrseled")}),flag)return!1;hours=parseInt(hours/60)}else hours=data.hours;else ZPeopleComponents.isComponent(tr.find("[id^=timerlogFrom_]")[0])?($(tr).find("#timerlogEdit_"+tlId).children().each(function(){var timerId=$(this).attr("timerId"),fromhrstot=TimelyZComp.timeField.getValue($(this).find("#timerlogFrom_"+timerId)),tohrstot=TimelyZComp.timeField.getValue($(this).find("#timerlogTo_"+timerId));if(""==fromhrstot||""==tohrstot)return Timetracker.Util.addError($(tr).find("#timerlogFrom_"+timerId)),Timetracker.Util.addError($(tr).find("#timerlogTo_"+timerId)),Timetracker.Util.mandOptnErrMsg("timerlogEdit_"+tlId,tr,ZPI18N.getString("zp.entervalidtime")),flag=1,!1;var fromSec=null!=$(this).find("#timerlogFrom_"+timerId).attr("valInSec")?$(this).find("#timerlogFrom_"+timerId).attr("valInSec"):0,toSec=$(this).find("#timerlogTo_"+timerId).attr("valInSec")?$(this).find("#timerlogTo_"+timerId).attr("valInSec"):0,fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.split(":")),toTime=Timetracker.util.getTotalTimeForHours(tohrstot.split(":"));hours+=(fromTime=60*fromTime+fromSec%60)>(toTime=60*toTime+toSec%60)?toTime+86400-fromTime:toTime-fromTime,fromTime!=fromSec||toTime!=toSec?$(tr).find("#timerlogFrom_"+timerId).parent().addClass("brclrseled"):$(tr).find("#timerlogFrom_"+timerId).parent().removeClass("brclrseled")}),hours=parseInt(hours/60)):hours=data.hours;if(flag)return!1;$(tr).find("#timelogHours_"+tlId).html(Calendar.minstohrs(hours))}billableStatus=data.billableStatus;!Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)||isBreakLog||$(tr).find("#statusEdit_"+tlId).parent().hasClass("zpl_DNI")||(billableStatus=$(tr).find("#statusEdit_"+tlId).val()),status&&(tappHours+=hours),0==billableStatus?(billedCount++,isBreakLog?(paidBreakCount++,status&&(p_appHours+=hours)):status&&(bappHours+=hours)):1==billableStatus&&(nonBilledCount++,isBreakLog?(0,status&&(up_appHours+=hours)):status&&(nbappHours+=hours))}else{hours=data.nonoverlapHours?data.nonoverlapHours:data.hours;var billableStatus=data.billableStatus;status&&(tappHours+=hours),0==billableStatus?isBreakLog?(paidBreakCount++,status&&(p_appHours+=hours)):(billedCount++,status&&(bappHours+=hours)):1==billableStatus&&(isBreakLog?(0,status&&(up_appHours+=hours)):(nonBilledCount++,status&&(nbappHours+=hours)))}});var allAppObj=tsViewLayout.find("#all_approval");if(tsViewLayout.find("#tsdatatbody").find(".choose_app.grn").length===tsViewLayout.find("#tsdatatbody").find(".choose_app").length?($(allAppObj).removeClass("gry").addClass("grn"),$(allAppObj).attr("title",isChecked?ZPI18N.getString("zp.clicktoreject"):ZPI18N.getString("zp.clicktoapprove"))):($(allAppObj).removeClass("grn").addClass("gry"),$(allAppObj).attr("title",isChecked?ZPI18N.getString("zp.clicktoreject"):ZPI18N.getString("zp.clicktoapprove"))),1==flag)return!1;-1==recStatus?(tsViewLayout.find("#apptimesheet_billhours").data("bappHours",bappHours),tsViewLayout.find("#apptimesheet_billhours").html(Calendar.minstohrs(bappHours)),tsViewLayout.find("#apptimesheet_nonbillhours").data("nbappHours",nbappHours),tsViewLayout.find("#apptimesheet_nonbillhours").html(Calendar.minstohrs(nbappHours)),tsViewLayout.find("#apptimesheet_paidBrkhours").data("nbappHours",p_appHours),tsViewLayout.find("#apptimesheet_paidBrkhours").html(Calendar.minstohrs(p_appHours)),tsViewLayout.find("#apptimesheet_unpaidBrkhours").data("nbappHours",up_appHours),tsViewLayout.find("#apptimesheet_unpaidBrkhours").html(Calendar.minstohrs(up_appHours)),tsViewLayout.find("#apptimesheet_totalhours").data("tappHours",tappHours),tsViewLayout.find("#apptimesheet_totalhours").html(Calendar.minstohrs(tappHours))):0!=recStatus&&(tsViewLayout.find("#timesheet_billhours").data("bappHours",bappHours),tsViewLayout.find("#timesheet_billhours").html(Calendar.minstohrs(bappHours)),tsViewLayout.find("#timesheet_nonbillhours").data("nbappHours",nbappHours),tsViewLayout.find("#timesheet_nonbillhours").html(Calendar.minstohrs(nbappHours)),tsViewLayout.find("#timesheet_paidBrkhours").data("nbappHours",p_appHours),tsViewLayout.find("#timesheet_paidBrkhours").html(Calendar.minstohrs(p_appHours)),tsViewLayout.find("#timesheet_unpaidBrkhours").data("nbappHours",up_appHours),tsViewLayout.find("#timesheet_unpaidBrkhours").html(Calendar.minstohrs(up_appHours)),tsViewLayout.find("#timesheet_totalhours").data("tappHours",tappHours),tsViewLayout.find("#timesheet_totalhours").html(Calendar.minstohrs(tappHours)));var isNBlogsPayable=tsViewLayout.find("#tsdatatbody").data("isNBlogsPayable"),totHrsHtml=Timetracker.timesheet.constructWarningHtmlWeek(Timetracker.timesheet.TsList,!0),payableDispHrs=bappHours+p_appHours;isNBlogsPayable&&(payableDispHrs=tappHours),0==recStatus&&(payableDispHrs=0),tsViewLayout.find("#timesheetbill_hours").html(Calendar.minstohrs(payableDispHrs)),"no_deviation"!==totHrsHtml&&(tsViewLayout.find("#timesheetbill_hours").siblings().remove(),tsViewLayout.find("#timesheetbill_hours").parent().append(totHrsHtml)),tsViewLayout.find("#timesheetbill_amount").html((payableDispHrs/60*ratePerHour).toFixed(2));var isRPHdata=void 0!=ratePerHour;if(-1==recStatus&&0!=billedCount&&0==nonBilledCount&&0==subnbhrs||-1!=recStatus&&0!=billedCount&&0==nonBilledCount)tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().removeClass("zpl_DNI"),isRPHdata&&tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").removeClass("zpl_DNI");else if(-1==recStatus&&0==billedCount&&0!=nonBilledCount&&0==subbhrs||-1!=recStatus&&0==billedCount&&0!=nonBilledCount){tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().removeClass("zpl_DNI"),tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").addClass("zpl_DNI");payableDispHrs=nbappHours;isBreakEnabled&&0==paidBreakCount&&(payableDispHrs=0),isNBlogsPayable&&(tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").removeClass("zpl_DNI"),payableDispHrs=tappHours);totHrsHtml=Timetracker.timesheet.constructWarningHtmlWeek(Timetracker.timesheet.TsList,!0);tsViewLayout.find("#timesheetbill_hours").html(Calendar.minstohrs(payableDispHrs)),"no_deviation"!==totHrsHtml&&(tsViewLayout.find("#timesheetbill_hours").siblings().remove(),tsViewLayout.find("#timesheetbill_hours").parent().append(totHrsHtml))}else-1==recStatus&&0==billedCount&&0==nonBilledCount&&0==subbhrs&&0==subnbhrs||-1!=recStatus&&0==billedCount&&0==nonBilledCount?(tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().addClass("zpl_DNI"),tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().addClass("zpl_DNI")):(tsViewLayout.find("#timesheet_billhours,#apptimesheet_billhours").parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_totalhours").parent().parent().removeClass("zpl_DNI"),tsViewLayout.find("#timesheet_nonbillhours,#apptimesheet_nonbillhours").parent().removeClass("zpl_DNI"),isRPHdata&&tsViewLayout.find("#ts_totalamt,#ts_ratePerHour,#ts_totalamnt_formula").removeClass("zpl_DNI"))},qbPushButton:function(tsId,alreadyPushed,isButton){$("#ts_qbo").length&&$("#ts_qbo").remove();var timesheetlay=Layout.Page.container.find("#timesheet_view_create"),butTxt=isButton?alreadyPushed?ZPI18N.getString("zp.tt.qbotimebutpushed"):ZPI18N.getString("zp.tt.qbotimebutpush"):ZPI18N.getString("zp.tt.qboonline");if(isButton){if(0===timesheetlay.find("#ts_qbo").length){var pushHtml='<button id="ts_qbo" class="zpl_drpdwn-js zlabel zlabel--outline zlabel--medium">'+butTxt+"</button>";timesheetlay.find(".zpl_mhderrgt").prepend($(pushHtml)),timesheetlay=timesheetlay.find("#ts_qbo")}$(timesheetlay).off().on("click",function(){Timetracker.timesheet.pushToQBO(tsId,alreadyPushed)})}},constructWarningHtmlWeek:function(tsData,isPerWeek){var msg="no_deviation";if(Timetracker.timesheet.TsList.deviatedWeeks=tsData.deviatedWeeks,Timetracker.timesheet.TsList.minHrsWeek=tsData.minHrsWeek,Timetracker.timesheet.TsList.maxDeviatedWeeks=tsData.maxDeviatedWeeks,Timetracker.timesheet.TsList.maxHrsWeek=tsData.maxHrsWeek,isPerWeek){var dvtdWeeks,weekMsg="",devWeekArr=[];if(tsData.hasOwnProperty("deviatedWeeks")&&null!=tsData.deviatedWeeks)if((dvtdWeeks=tsData.deviatedWeeks).length>0){for(var i=0;i<dvtdWeeks.length;i++){var fromDate=(weekRange=dvtdWeeks[i]).split("_")[0],toDate=weekRange.split("_")[1];i>0&&(weekMsg+=", "),weekMsg+=moment(fromDate,"YYYY-MM-DD").format(dateFmt.toUpperCase())+" to "+moment(toDate,"YYYY-MM-DD").format(dateFmt.toUpperCase())}msg='<i class="PI_fil_alert ylw" title="'+(tooltip_msg=ZPI18N.getString("zp.minperweekwarning",[Calendar.minstohrs(tsData.minHrsWeek)," "])+weekMsg)+'"></i>',devWeekArr.push({weekMsg:tooltip_msg})}if(tsData.hasOwnProperty("maxDeviatedWeeks")&&null!=tsData.maxDeviatedWeeks)if((dvtdWeeks=tsData.maxDeviatedWeeks).length>0){for(i=0;i<dvtdWeeks.length;i++){var weekRange;fromDate=(weekRange=dvtdWeeks[i]).split("_")[0],toDate=weekRange.split("_")[1];i>0&&(weekMsg+=", "),weekMsg+=moment(fromDate,"YYYY-MM-DD").format(dateFmt.toUpperCase())+" to "+moment(toDate,"YYYY-MM-DD").format(dateFmt.toUpperCase())}var tooltip_msg="";0!==devWeekArr.length&&devWeekArr.hasOwnProperty(weekMsg)&&(tooltip_msg=devWeekArr[weekMsg]+"\n"),msg='<i class="PI_fil_alert ylw" title="'+(tooltip_msg+=ZPI18N.getString("zp.maxperweekwarning",[Calendar.minstohrs(tsData.maxHrsWeek)," "])+weekMsg)+'"></i>'}}return msg},showErrorTimelogs:function(resultData){var code=resultData.errorCode,fromDate="",todate="";if(code==Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ESTIMATEDHOURRESTRICT)return!1;if(code!=Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ZEROHOURSRESTRICT&&code!=Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MANUALLOGDISABLED&&code!=Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_BILLED&&code!=Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_FROMTOTIMELOGDISABLED)try{if(code==Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAXLOGHOURRESTRICT)if(void 0!=resultData&&void 0!=resultData.errorDate&&-1!=resultData.errorDate.indexOf("_")){var date=resultData.errorDate.split("_");fromDate=new Date(date[0]),todate=new Date(date[1])}else fromDate=void 0!=resultData&&void 0!=resultData.errorDate?new Date(resultData.errorDate):"",todate=new Date(fromDate.getTime());else fromDate=void 0!=resultData&&void 0!=resultData.extraDtls.errorDate?new Date(resultData.extraDtls.errorDate):"",todate=new Date(fromDate.getTime());if(!isNaN(fromDate.getDay())&&!isNaN(todate.getDay()))for(var day=fromDate;day<=todate;day.setDate(day.getDate()+1)){day=new Date(Date.UTC(day.getFullYear(),day.getMonth(),day.getDate())),obj=Layout.Page.container.find("#timesheet_view_create").find('[date="'+day.toISOString().slice(0,10)+'"]');for(i=0;i<obj.length;i++){object=obj[i],sheetId=$(object).attr("id");if("0"==(type=$(object).attr("type"))){var totalHours=$(object).find("#timesheetListlogEntry"+sheetId).val().trim(),billable=$(object).find("#statusEdit_"+sheetId).val();totalHours==$(object).find("#timesheetListlogEntry"+sheetId).attr("value")&&billable==$(object).find("#statusView_"+sheetId).attr("status")||$(object).find("#timesheetListlogEntry"+sheetId).addClass("ztextbox__error")}else if("1"==type){var oldFromTime=$(object).find("#timesheetListlogFrom"+sheetId).attr("valInSec"),oldToTime=$(object).find("#timesheetListlogTo"+sheetId).attr("valInSec"),fromhrstot=$(object).find("#timesheetListlogFrom"+sheetId).val(),tohrstot=$(object).find("#timesheetListlogTo"+sheetId).val();billable=$(object).find("#statusEdit_"+sheetId).val();oldFromTime==fromhrstot&&oldToTime==tohrstot&&billable==$(object).find("#statusView_"+sheetId).attr("status")||(Timetracker.Util.addError($(object).find("#timesheetListlogFrom"+sheetId)),Timetracker.Util.addError($(object).find("#timesheetListlogTo"+sheetId)))}else if("2"==type){(billable=$(object).find("#statusEdit_"+sheetId).val())!=$(object).find("#statusView_"+sheetId).attr("status")&&Timetracker.Util.addError($(object).find("#statusEdit_"+sheetId)),$(object).find(".brclrseled").find("input").each(function(){Timetracker.Util.addError(this)})}}}}catch(error){}else for(var timelogs=void 0!=resultData&&void 0!=resultData.extraDtls.errorLogs?resultData.extraDtls.errorLogs:[],i=0;i<timelogs.length;i++){var type,sheetId=timelogs[i],object=Layout.Page.container.find("#"+sheetId);"0"==(type=$(object).attr("type"))?$(object).find("#timesheetListlogEntry"+sheetId).addClass("ztextbox__error"):"1"==type?(Timetracker.Util.addError($(object).find("#timesheetListlogFrom"+sheetId)),Timetracker.Util.addError($(object).find("#timesheetListlogTo"+sheetId))):"2"==type&&$(object).find("#timerlogEdit_"+sheetId).find("input").each(function(){Timetracker.Util.addError(this)})}},showCreateList:function(resultData){var layout=Timetracker.Util.getLayout().find("#timesheet_view_create");layout.find(".zpl_minr").attr({tabindex:"0","aria-label":ZPI18N.getString("zp.common.addreqpage")}),layout.find(".zpl_minr").focus();var userName='<span class="dgry ZP_Font">'+Timetracker.timesheet.TsList.empId+" - </span>"+Timetracker.timesheet.TsList.userName;layout.find("#timesheet_uname").html(userName),layout.find("#timesheet_uimg").attr("src",Timetracker.timesheet.TsList.image),layout.find("#tsdatatbody").attr("tserecNo",Timetracker.timesheet.TsList.userErecNum);var isNBlogsPayable=resultData.isNBlogsPayable,dispPayableHrs=0,from=Timetracker.timesheet.TsList.fromDate,to=Timetracker.timesheet.TsList.toDate,isBreakLogAvlbl=!!resultData.hasOwnProperty("isBreakLogAvlbl")&&resultData.isBreakLogAvlbl;layout.find("#timesheet_desc").val(""),from===to?(layout.find("#timesheet_date").html(from),Timetracker.timesheet.TsList.timesheetNameStr="Timesheet ("+from+")"):(layout.find("#timesheet_date").html(from+" - "+to),Timetracker.timesheet.TsList.timesheetNameStr="Timesheet ("+from+" - "+to+")"),layout.find("#timesheet_name").val(Timetracker.timesheet.TsList.timesheetNameStr),layout.find("#timesheet_name").attr("value",Timetracker.timesheet.TsList.timesheetNameStr);var ratePerHour=null,currency=null;void 0!==resultData.ratePerHour&&(ratePerHour=Number(resultData.ratePerHour),resultData.currency&&(currency=resultData.currency),null===currency&&null!=Timetracker.billingSettings.currenciesData&&0!=Timetracker.billingSettings.currenciesData.length&&(currency=Timetracker.billingSettings.currenciesData[0].currencyCode));isBreakLogAvlbl=!!Timetracker.generalSettings.isBreakEnabled()&&resultData.isBreakLogAvlbl;var dispBillHours=dispPayableHrs=Number(Timetracker.timesheet.TsList.billHours);isBreakLogAvlbl&&resultData.hasOwnProperty("billableHours")&&(dispBillHours=dispPayableHrs=resultData.billableHours);var dispNonbillHours=Timetracker.timesheet.TsList.nonbillHours;isBreakLogAvlbl&&resultData.hasOwnProperty("nonbillableHours")&&(dispNonbillHours=resultData.nonbillableHours),isNBlogsPayable&&(dispPayableHrs+=dispNonbillHours);var dispTotalHours=Timetracker.timesheet.TsList.totalHours;isBreakLogAvlbl&&resultData.hasOwnProperty("billableHours")&&resultData.hasOwnProperty("nonbillableHours")&&(dispTotalHours=resultData.billableHours+resultData.nonbillableHours),layout.find("#timesheet_billhours").html(Calendar.minstohrs(dispBillHours)),layout.find("#timesheet_nonbillhours").html(Calendar.minstohrs(dispNonbillHours)),layout.find("#timesheet_billhours").data().hours=dispBillHours,layout.find("#timesheet_nonbillhours").data().hours=dispNonbillHours;dispTotalHours=dispBillHours+dispNonbillHours;isBreakLogAvlbl&&(layout.find("#timesheet_paidBrkhours").html(Calendar.minstohrs(Timetracker.timesheet.TsList.paidBreakHours)),layout.find("#timesheet_unpaidBrkhours").html(Calendar.minstohrs(Timetracker.timesheet.TsList.unpaidBreakHours)),layout.find("#timesheet_paidBrkhours").data().hours=Timetracker.timesheet.TsList.paidBreakHours,layout.find("#timesheet_unpaidBrkhours").data().hours=Timetracker.timesheet.TsList.unpaidBreakHours,dispPayableHrs+=Timetracker.timesheet.TsList.paidBreakHours+(isNBlogsPayable?Timetracker.timesheet.TsList.unpaidBreakHours:0),dispTotalHours+=Timetracker.timesheet.TsList.paidBreakHours+Timetracker.timesheet.TsList.unpaidBreakHours),layout.find("#timesheet_totalhours").html(Calendar.minstohrs(dispTotalHours)),layout.find("#timesheet_totalhours").data().hours=dispTotalHours;var totHrsHtml=Timetracker.timesheet.constructWarningHtmlWeek(resultData,!0);if(layout.find("#timesheetbill_hours").html(Calendar.minstohrs(dispPayableHrs)),"no_deviation"!==totHrsHtml&&(layout.find("#timesheetbill_hours").siblings().remove(),layout.find("#timesheetbill_hours").parent().append(totHrsHtml)),null!=ratePerHour){layout.find("#ts_ratePerHour").show(),layout.find("#ts_totalamt").show(),layout.find("#ts_totalamnt_formula").show(),layout.find("#timesheetbill_rate").text(ratePerHour),layout.find("#timesheetbill_rate").data("rate",ratePerHour),Timetracker.timesheet.TsList.ratePerHour=ratePerHour;var totalAmount=dispPayableHrs/60*ratePerHour;Timetracker.timesheet.TsList.totalAmount=totalAmount,layout.find("#timesheetbill_amount").text(totalAmount.toFixed(2)),null===currency?ZPeople.Request.sendRequestAsPromise("/timesheet.zp",{mode:"getCurrencies",conreqcsr:csrfToken}).then(function(data){Timetracker.billingSettings.currenciesData=data,currency=Timetracker.billingSettings.currenciesData[0].currencyCode,layout.find("#timesheetbill_amountcur").text(" "+currency),layout.find("#timesheetbill_ratecur").text(" "+currency)}):(layout.find("#timesheetbill_amountcur").text(" "+currency),layout.find("#timesheetbill_ratecur").text(" "+currency))}else layout.find("#ts_ratePerHour").hide(),layout.find("#ts_totalamt").hide(),layout.find("#ts_totalamnt_formula").hide()},editTimesheetListEntry:function(obj,timelogId,type,isFromEditTimesheet,billableStatus,jobId){$(obj).attr("onclick",""),$(obj).off("click"),Timetracker.util.getTTLocation(Timetracker.timesheet.editTimesheetListEntryCallback,obj,timelogId,type,isFromEditTimesheet,billableStatus,jobId)},editTimesheetListEntryCallback:function(currObj,timelogId,type,isFromEditTimesheet,billableStatus,jobId){Timetracker.util.removeErrorMsg("timesheet_view_create");var row=$(currObj).closest("tr"),data=$(row).data(),isEdited=(type=data.type,!1),isShiftEnabled=Timetracker.isTTSthiftEnabled();let showBillable=Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS);var editedTaskName;showBillable&&((billableStatus=$(row).find("#statusEdit_"+timelogId).val())!=$(row).find("#statusView_"+timelogId).attr("status")&&(isEdited=!0));if(timelogId=void 0!=timelogId&&null!=timelogId?timelogId:data.timelogId,$(row).find(".workItemEdit").is(":visible")){let tempEditedTaskName;$(row).find("#tsWorkItemInput").is(":visible")?tempEditedTaskName=$(row).find("#tsWorkItemInput").val():"0"===(tempEditedTaskName=ZPeople.decodeTxt(TimelyZComp.select.getValue($(row).find("[name='tsWorkItemSelect']"))))&&(tempEditedTaskName="");let data=$(row).data();if(tempEditedTaskName!=ZPeople.decodeTxt(data.taskName)&&(isEdited=!0,""==(editedTaskName=tempEditedTaskName)&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem_Mandatory)){var errorDiv=$(row).find("#tsWorkItemInput").is(":visible")?$(row).find("#tsWorkItemInput"):$(row).find("[name='tsWorkItemSelect']");return Timetracker.Util.addError(errorDiv),$(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),!1}}var params={mode:"modifyTimesheet",sheetId:timelogId,type:type,isFromTimesheetListEdit:!0,userErecNo:Timetracker.timesheet.TsList.userErecNum,conreqcsr:csrfToken},jobDiv=$(row).find("#ts_job_"+timelogId);if(ZPeopleComponents.isComponent(jobDiv)?(params.jobId=TimelyZComp.select.getValue(jobDiv),isEdited=isEdited||params.jobId!=data.jobId):void 0!==data.jobId&&null!==data.jobId&&(params.jobId=data.jobId),"0"===type){if(params.loghrs=$(row).find("#timesheetListlogEntry"+timelogId).val().trim(),!params.loghrs.match(Timetracker.util.maxhrsRegex))return $(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),$(row).find("#timesheetListlogEntry"+timelogId).addClass("ztextbox__error"),!1;if(params.loghrs==$(row).find("#timesheetListlogEntry"+timelogId).attr("value")&&!isEdited)return $(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),Timetracker.timesheet.hideEditTimesheetListEntry(timelogId),Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")),!1;if(Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timesheet.TsList.userErecNum)&&0==Timetracker.DateTime.convertToMins(params.loghrs))return $(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),Timetracker.timesheet.hideEditTimesheetListEntry(timelogId),Timetracker.util.showAlert(1,ZPI18N.getString("zp.logalert9")),!1}else if("1"===type)if(isShiftEnabled){let date_val=Calendar.parseDate(data.workDate,uidateFormat),fTime=TimelyZComp.datetimefield.getDateObj(row.find("#timesheetListlogFrom"+timelogId)),tTime=TimelyZComp.datetimefield.getDateObj(row.find("#timesheetListlogTo"+timelogId));date_val&&fTime&&(fromTime=date_val.getDiff(fTime,Timetracker.constants.MINUTES)),date_val&&tTime&&(toTime=date_val.getDiff(tTime,Timetracker.constants.MINUTES));let msg,isError=!1;if(void 0==fromTime||void 0==toTime||fromTime<-Timetracker.constants.PER_DAY_MIN||fromTime>=2*Timetracker.constants.PER_DAY_MIN||toTime<-Timetracker.constants.PER_DAY_MIN||toTime>=2*Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.entervalidtime")):toTime-fromTime>Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.timeexceeded24")):toTime<fromTime?(isError=!0,msg=ZPI18N.getString("zp.fromtimegreater")):toTime-fromTime==0&&Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timesheet.TsList.userErecNum)&&(isError=!0,msg=ZPI18N.getString("zp.logalert9")),isError)return Timetracker.Util.addError($(row).find("#timesheetListlogFrom"+timelogId)),Timetracker.Util.addError($(row).find("#timesheetListlogTo"+timelogId)),Timetracker.Util.mandOptnErrMsg("showTimesheetEditEntry"+timelogId,row,msg),flag=1,$(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),!1;params.fromTime=fromTime,params.toTime=toTime}else{var fromhrstot=$(row).find("#timesheetListlogFrom"+timelogId).val(),tohrstot=$(row).find("#timesheetListlogTo"+timelogId).val();if(void 0==fromhrstot||""==fromhrstot||void 0==tohrstot||""==tohrstot)return Timetracker.Util.addError($(row).find("#timesheetListlogFrom"+timelogId)),Timetracker.Util.addError($(row).find("#timesheetListlogTo"+timelogId)),Timetracker.Util.mandOptnErrMsg("showTimesheetEditEntry"+timelogId,row,msg),flag=1,$(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),!1;var fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.trim().split(":")),toTime=Timetracker.util.getTotalTimeForHours(tohrstot.trim().split(":"));if(!isEdited&&$(row).find("#timesheetListlogFrom"+timelogId).attr("value")===Timetracker.DateTime.minstoTimeMeridian(fromTime)&&$(row).find("#timesheetListlogTo"+timelogId).attr("value")===Timetracker.DateTime.minstoTimeMeridian(toTime))return $(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),Timetracker.timesheet.hideEditTimesheetListEntry(timelogId),Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")),!1;if(fromTime-toTime==0&&Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timesheet.TsList.userErecNum))return $(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),Timetracker.timesheet.hideEditTimesheetListEntry(timelogId),Timetracker.util.showAlert(1,ZPI18N.getString("zp.logalert9")),!1;params.fromTime=fromTime,params.toTime=toTime}else if("2"===type){var timerArr=[],flag=0,timerData=data.timearr;let date_val=Calendar.parseDate(data.workDate,uidateFormat);for(var i=0;i<timerData.length;i++){var timerId=timerData[i].timerId;let fromTime,toTime,isError=!1,msg="";if(isShiftEnabled){let fTime=TimelyZComp.datetimefield.getDateObj($(row).find("#timerlogFrom_"+timerId)),tTime=TimelyZComp.datetimefield.getDateObj($(row).find("#timerlogTo_"+timerId));date_val&&fTime&&(fromTime=date_val.getDiff(fTime,Timetracker.constants.MINUTES)),date_val&&tTime&&(toTime=date_val.getDiff(tTime,Timetracker.constants.MINUTES)),void 0==fromTime||void 0==toTime||fromTime<-Timetracker.constants.PER_DAY_MIN||fromTime>=2*Timetracker.constants.PER_DAY_MIN||toTime<-Timetracker.constants.PER_DAY_MIN||toTime>=2*Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.entervalidtime")):toTime-fromTime>Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.timeexceeded24")):toTime<fromTime&&(isError=!0,msg=ZPI18N.getString("zp.fromtimegreater"))}else{fromhrstot=$(row).find("#timerlogFrom_"+timerId).val(),tohrstot=$(row).find("#timerlogTo_"+timerId).val();""==fromhrstot||""==tohrstot?(isError=!0,msg=ZPI18N.getString("zp.entervalidtime")):(fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.trim().split(":")),toTime=Timetracker.util.getTotalTimeForHours(tohrstot.trim().split(":")))}if(isError)return Timetracker.Util.addError($(row).find("#timerlogFrom_"+timerId)),Timetracker.Util.addError($(row).find("#timerlogTo_"+timerId)),Timetracker.Util.mandOptnErrMsg("timerlogEdit_"+timelogId,row,msg),flag=1,!1;var fromSec=null!=$(row).find("#timerlogFrom_"+timerId).attr("valInSec")?$(row).find("#timerlogFrom_"+timerId).attr("valInSec"):0,toSec=$(row).find("#timerlogTo_"+timerId).attr("valInSec")?$(row).find("#timerlogTo_"+timerId).attr("valInSec"):0;fromTime=60*fromTime+fromSec%60,toTime=60*toTime+toSec%60,timerArr.push({timerId:timerId,fromTime:fromTime,toTime:toTime}),fromTime==fromSec&&toTime==toSec||(isEdited=!0)}if(1==flag)return!1;if(!isEdited)return $(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),Timetracker.timesheet.hideEditTimesheetListEntry(timelogId),Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")),!1;params.timerArr=JSON.stringify(timerArr)}if(void 0!==editedTaskName&&null!==editedTaskName&&(params.taskName=editedTaskName),showBillable&&void 0!==billableStatus&&null!==billableStatus&&(params.billable=billableStatus),void 0==params.jobId||null==params.jobId)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.cannotbeempty",[Timetracker.util.getJobDisplayName(!0)])),!1;if(0!==Object.keys(Timetracker.location.latLongParam).length){var obj=Timetracker.location.latLongParam;obj.hasOwnProperty("latitude")&&null!==obj.latitude&&obj.hasOwnProperty("longitude")&&null!==obj.longitude&&obj.hasOwnProperty("accuracy")&&null!==obj.accuracy&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}if(0==params.type&&void 0==params.loghrs||1==params.type&&(void 0==params.fromTime||void 0==params.toTime))return Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")),$(currObj).off("click").on("click",function(){Timetracker.timesheet.editTimesheetListEntry(this,timelogId,type,isFromEditTimesheet,billableStatus,jobId)}),!1;var tlDetailsJson={};tlDetailsJson.reqParams=params,tlDetailsJson.currObj=currObj,tlDetailsJson.timelogId=timelogId,tlDetailsJson.type=type,tlDetailsJson.isFromEditTimesheet=isFromEditTimesheet,tlDetailsJson.billableStatus=billableStatus,tlDetailsJson.jobId=jobId,Timetracker.timesheet.sendModifyTimesheetReq(tlDetailsJson)},showEditTimesheetListEntry:function(timelogId,timelogStatus){var tsViewLayout=Timetracker.Util.getLayout().find("#timesheet_view_create");if(-1!=timelogStatus&&(1===tsViewLayout.find("[id^='actualHours'].zpl_DNI").length||1===tsViewLayout.find("[id^='timerlogShow'].zpl_DNI").length)){var tid=tsViewLayout.find("[id^='actualHours'].zpl_DNI,[id^='timerlogShow'].zpl_DNI").closest("tr").attr("id");void 0!=tid&&Timetracker.timesheet.hideEditTimesheetListEntry(tid)}var status=tsViewLayout.find("#statusView_"+timelogId).attr("status"),row=tsViewLayout.find("tr[id='"+timelogId+"']"),rowData=$(row).data(),hours=rowData.hours,type=rowData.type,jobBillableStatus=rowData.jobBillableStatus,isBreakLog=rowData.isBreakLog,date=rowData.workDate,isShiftEnabled=Timetracker.isTTSthiftEnabled();$(row).find("#actualHours"+timelogId).addClass("zpl_DNI"),$(row).find(".PI_edt").parent().addClass("zpl_DNI"),$(row).find("#showTimesheetEditEntry"+timelogId+",#saveTimesheetListEdit"+timelogId+",#cancelTimesheetListEdit"+timelogId+",#editView_"+timelogId).removeClass("zpl_DNI");var timeFieldCallback=function(event,data){event.target.val(data.value),data.fromUI&&Timetracker.timesheet.allcheckAppRej(event)};if(!isBreakLog){$(row).find('[name="jobView"]').addClass("zpl_DNI");var jobDiv=$(row).find("#ts_job_"+timelogId);jobDiv.parent().removeClass("zpl_DNI");let data={jobId:rowData.jobId,jobName:rowData.jobName,erecno:rowData.erecno,projectId:rowData.projectId};if(Timetracker.timelogs.setValuesInSelectInput(data,"timesheetEdit",null,"ts_job_"+timelogId,{specificKeyReset:["job"],isNewKey:!0}),jobDiv.off("zselectchange").on("zselectchange",function(eve,data){data.fromUI&&Timetracker.timelogs.jobChange("timesheetEdit",jobDiv,{jobVal:data.value,skipUpdate:!0,erecno:rowData.erecno})}),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS))$(row).find("#statusView_"+timelogId).addClass("zpl_DNI"),$(row).find("#statusEdit_"+timelogId).parent().removeClass("zpl_DNI"),(opt={change:timeFieldCallback}).dropdownList={appendTo:tsViewLayout.find("#tsdatatbody")},jobBillableStatus&&jobBillableStatus==status&&(status=jobBillableStatus,opt.disabled=!0),ZPeopleComponents.select($(row).find("#statusEdit_"+timelogId),opt).setValue(status)}if(0==type)row.find("#timesheetListlogEntry"+timelogId).val(Calendar.minstohrs(hours)).removeClass("ztextbox__error"),row.find("#timesheetListlogEntry"+timelogId).off("change").on("change",Timetracker.timesheet.allcheckAppRej);else if("1"==type)if(isShiftEnabled){let pickerOptions={},logDate=Calendar.parseDate(date,uidateFormat),shitDt=new Date(logDate.getTime());shitDt.setDate(shitDt.getDate()-1),pickerOptions.minDate=Calendar.formatDate(shitDt).toString(),shitDt.setDate(shitDt.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(shitDt).toString();let attr={pickerOptions:pickerOptions,change:timeFieldCallback},toTime=rowData.toTime<rowData.fromTime?rowData.toTime+Timetracker.constants.PER_DAY_MIN:rowData.toTime;attr.value=Timetracker.util.getShiftDatebyTime(rowData.fromTime,logDate,Timetracker.constants.MINUTES),rowData.fromTimeDateField=attr.value,TimelyZComp.datetimefield.intialize($(row).find("#timesheetListlogFrom"+timelogId),attr),attr.value=Timetracker.util.getShiftDatebyTime(toTime,logDate,Timetracker.constants.MINUTES),rowData.toTimeDateField=attr.value,TimelyZComp.datetimefield.intialize($(row).find("#timesheetListlogTo"+timelogId),attr)}else{(opt={clearButton:"none",change:timeFieldCallback,className:"w120"}).format=timeFormat.replace("a","tt"),ZPeopleComponents.timefield($(row).find("#timesheetListlogFrom"+timelogId),opt).setValue(rowData.fromTimeInTimeFormat),ZPeopleComponents.timefield($(row).find("#timesheetListlogTo"+timelogId),opt).setValue(rowData.toTimeInTimeFormat)}else if("2"==type){$(row).find("#timerlogShow_"+timelogId).addClass("zpl_DNI"),$(row).find("#timerlogEdit_"+timelogId).removeClass("zpl_DNI");var timerData=rowData.timearr;if(isShiftEnabled){let logDate=Calendar.parseDate(date,uidateFormat),pickerOptions={},shitDt=new Date(logDate.getTime());shitDt.setDate(shitDt.getDate()-1),pickerOptions.minDate=Calendar.formatDate(shitDt).toString(),shitDt.setDate(shitDt.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(shitDt).toString();let attr={pickerOptions:pickerOptions,change:timeFieldCallback};for(var ind=0;ind<timerData.length;ind++){let toTime=timerData[ind].toTime<timerData[ind].fromTime?timerData[ind].toTime+Timetracker.constants.PER_DAY_SEC:timerData[ind].toTime;attr.value=Timetracker.util.getShiftDatebyTime(timerData[ind].fromTime,logDate),timerData[ind].fromTimeDateField=attr.value,TimelyZComp.datetimefield.intialize($(row).find("#timerlogFrom_"+timerData[ind].timerId),attr),attr.value=Timetracker.util.getShiftDatebyTime(toTime,logDate),timerData[ind].toTimeDateField=attr.value,TimelyZComp.datetimefield.intialize($(row).find("#timerlogTo_"+timerData[ind].timerId),attr)}}else{var opt;timerData=rowData.timearr;(opt={clearButton:"none",change:timeFieldCallback,className:"w120"}).format=timeFormat.replace("a","tt");for(ind=0;ind<timerData.length;ind++)ZPeopleComponents.timefield($(row).find("#timerlogFrom_"+timerData[ind].timerId),opt).setValue(timerData[ind].fromTimeInTimeFormat),ZPeopleComponents.timefield($(row).find("#timerlogTo_"+timerData[ind].timerId),opt).setValue(timerData[ind].toTimeInTimeFormat)}}if(!isBreakLog&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem){let taskName=rowData.taskName;Timetracker.setWorkitemCache();let extraJson={};extraJson.jobId=rowData.jobId,extraJson.erecno=rowData.erecno,Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem(extraJson)?(extraJson.elementId=$(row).find("[name='tsWorkItemSelect']").attr("id"),extraJson.layout=$(row).find("[name='tsWorkItemSelect']"),extraJson.layout.html(""),extraJson.toAppendOption=taskName,extraJson.dropdownAppendTo=tsViewLayout.find("#tsdatatbody"),extraJson.moveOnScroll=!1,Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson),$(row).find(".workItemEdit,[name='tsWorkItemSelect']").removeClass("zpl_DNI"),$(row).find("#tsWorkItemInput").addClass("zpl_DNI")):($(row).find("#tsWorkItemInput").val(ZPeople.decodeTxt(taskName)),$(row).find(".workItemEdit,[name='tsWorkItemSelect']").removeClass("zpl_DNI"),$(row).find("[name='tsWorkItemSelect']").addClass("zpl_DNI")),$(row).find(".workItemVal").addClass("zpl_DNI")}},hideEditTimesheetListEntry:function(timelogId){var row=Timetracker.Util.getLayout().find("#timesheet_view_create").find("tr[id='"+timelogId+"']"),rowData=$(row).data();if($(row).find("#actualHours"+timelogId).removeClass("zpl_DNI"),$(row).find(".PI_edt").parent().removeClass("zpl_DNI"),$(row).find("#showTimesheetEditEntry"+timelogId+",#saveTimesheetListEdit"+timelogId+",#cancelTimesheetListEdit"+timelogId).addClass("zpl_DNI"),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)){var status=$(row).find("#statusView_"+timelogId).removeClass("zpl_DNI").attr("status");$(row).find("#statusEdit_"+timelogId).parent().addClass("zpl_DNI"),!rowData.isBreakLog&&ZPeopleComponents.select($(row).find("#statusEdit_"+timelogId)).setValue(status)}var type=rowData.type,isShiftEnabled=Timetracker.isTTSthiftEnabled();if(1==type)isShiftEnabled?(TimelyZComp.datetimefield.setValue($(row).find("#timesheetListlogFrom"+timelogId),rowData.fromTimeDateField),TimelyZComp.datetimefield.setValue($(row).find("#timesheetListlogTo"+timelogId),rowData.toTimeDateField)):(ZPeopleComponents.timefield($(row).find("#timesheetListlogFrom"+timelogId)).setValue(rowData.fromTimeInTimeFormat),ZPeopleComponents.timefield($(row).find("#timesheetListlogTo"+timelogId)).setValue(rowData.toTimeInTimeFormat));else if(0==type){var value=$(row).find("#timesheetListlogEntry"+timelogId).attr("value");$(row).find("#timesheetListlogEntry"+timelogId).val(value)}else if(2==type){$(row).find("#timerlogShow_"+timelogId).removeClass("zpl_DNI"),$(row).find("#timerlogEdit_"+timelogId).addClass("zpl_DNI");for(var timerData=rowData.timearr,ind=0;ind<timerData.length;ind++)isShiftEnabled?(TimelyZComp.datetimefield.setValue($(row).find("#timerlogFrom_"+timerData[ind].timerId),timerData[ind].fromTimeDateField),TimelyZComp.datetimefield.setValue($(row).find("#timerlogTo_"+timerData[ind].timerId),timerData[ind].toTimeDateField)):(ZPeopleComponents.timefield($(row).find("#timerlogFrom_"+timerData[ind].timerId)).setValue(timerData[ind].fromTimeInTimeFormat),ZPeopleComponents.timefield($(row).find("#timerlogTo_"+timerData[ind].timerId)).setValue(timerData[ind].toTimeInTimeFormat))}$(row).find(".workItemVal").removeClass("zpl_DNI"),$(row).find(".workItemEdit").addClass("zpl_DNI"),$(row).find('[name="jobView"]').removeClass("zpl_DNI");var jobDiv=$(row).find("#ts_job_"+timelogId);jobDiv.parent().addClass("zpl_DNI"),ZPeopleComponents.isComponent(jobDiv)&&TimelyZComp.select.setValue(jobDiv,jobDiv.attr("jobId")),Timetracker.timesheet.allcheckAppRej(this)},printTimesheet:function(){var newContent="",layout=Timetracker.Util.getLayout().find("#timesheet_view_create"),layoutCont=$(layout).clone();layoutCont.find("#timesheet_desc").html(Timetracker.timesheet.editListData.hasOwnProperty("desc")&&""!==Timetracker.timesheet.editListData.desc.trim()?Timetracker.timesheet.editListData.desc:"-").attr("disabled",!0),layoutCont.find("#timesheet_name").attr("disabled",!0),-1!=Timetracker.timesheet.editListData.status&&-2!=Timetracker.timesheet.editListData.status&&0!=Timetracker.timesheet.editListData.status||layout.find("#tsdatatbody .timelog").each(function(){var data=$(this).data(),trRow=layoutCont.find("#"+data.timelogId),tdLrow="";-1==data.approvalStatus?tdLrow='<i class="PI_pending3 ylw"></i>':0==data.approvalStatus?tdLrow='<i class="PI_unlike red"></i>':1==data.approvalStatus&&(tdLrow='<i class="PI_like grn"></i>'),trRow.find("td:last-child").html(tdLrow),trRow.find("#statusView_"+data.timelogId).removeClass("zpl_DNI").siblings().remove(),trRow.find("#actualHours"+data.timelogId).removeClass("zpl_DNI").siblings().remove(),trRow.find(".workItemVal").removeClass("zpl_DNI"),trRow.find(".workItemEdit").remove(),2!=data.type&&1!=data.type||(trRow.find("#timerlogShow_"+data.timelogId).removeClass("zpl_DNI").siblings().remove(),trRow.find("#timelogHours_"+data.timelogId).html(Calendar.minstohrs(data.totaltime/60)))}),layoutCont.find("#zp_timesheet_file_disp").hasClass("zpl_DNI")?layoutCont.find("#zp_timesheet_file_disp").parent().remove():layoutCont.find("#file_name").removeClass("zpl_DNI").addClass("zpl_cpd"),layoutCont.find(".zpl_mfoter,.zpl_mhderrgt,#file_name_change,#timesheet_create_back,#timesheetBeforeUpload,#timesheetAfterUpload,.PI_edt,.PI_tick2_fil,.PI_cls,#ts_tladd").remove(),layoutCont.find("#tsdatatbody").parent().css("overflow","auto"),newContent+='<div class="zpl_mcnt" id="zp_form_outer_container"><div class="zpl_mprintcont" id="bodyparent"><div class="zpl_rgtcnt" id="sectionsparent">'+layoutCont.find(".zpl_mhder").get(0).outerHTML+layoutCont.find(".zpl_act").html()+"</div></div></div>",FormsCommon.constructPrintForm(newContent,layout.find("#tsdatatbody").attr("formId"),layout.find("#tsdatatbody").attr("recordId"),{isApproval:Timetracker.Validations.isDefiniteValue(Timetracker.timesheet.approvalDtls),approvalDtl:Timetracker.timesheet.approvalDtls,isHeaderConstruct:!0,isClose:!0})},qbopushdata:{},pushToQBOEvent:function(event,params){var sheetID=$(params.menuitem).attr("sheetId"),isPushedAlready="true"==$(params.menuitem).attr("isPushed");Timetracker.timesheet.pushToQBO(sheetID,isPushedAlready)},pushToQBO:function(sheetId,isPushedAlready){if(isPushedAlready)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.tt.qbotimesheetpushedalready")),!1;Timetracker.timesheet.qbopushdata&&Timetracker.timesheet.qbopushdata.isAPICalled?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.tt.qbotimesheetebeingpushed")):(Timetracker.timesheet.qbopushdata.timesheetId=sheetId,Timetracker.timesheet.qbopushdata.isAPICalled=!0,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.tt.qbotimesheetebeingpushed")),$.post("/quickbooks/pushTimeActivityToQBO",{tsheetId:sheetId,conreqcsr:csrfToken},function(resultData){if(Timetracker.timesheet.qbopushdata.isAPICalled=!1,resultData&&resultData.qboResponse)if(resultData.qboResponse.msg&&"success"==resultData.qboResponse.msg){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.tt.qbotimesheetsuccessful"));var formId=Layout.Page.container.find("#timesheet_view_create").find("#tsdatatbody").attr("formId"),recordId=Layout.Page.container.find("#timesheet_view_create").find("#tsdatatbody").attr("recordId");Timetracker.timesheet.getTimesheetDetails(formId,recordId)}else resultData.qboResponse.msg&&"failed"==resultData.qboResponse.msg&&resultData.qboResponse.errmsg?ZPeople.Message.showFailureMsg(resultData.qboResponse.errmsg):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.tt.qbotimesheetfail"))}))},pushTimelogsFromTS:function(event,params){var sheetId=$(params.menuitem).attr("sheetId"),service=$(params.menuitem).attr("service"),pushAllowTLCnt=$(params.menuitem).attr("tlcount"),layout=Timetracker.Util.getLayout();service===Timetracker.constants.integration.zb||service===Timetracker.constants.integration.zi?Timetracker.ZBooksInvoice.pushTimelogsFromTS(layout,sheetId,service,0==pushAllowTLCnt,!1):service===Timetracker.constants.integration.zprjct&&Timetracker.ZOHOPROJECTS.pushTimelogsFromTS(layout,sheetId,0==pushAllowTLCnt,!1)},Firescroll:{getMode:function(){var pageMode=Timetracker.Page.getPageMode();return"ts_mydata"==pageMode?"Timesheet_user":"ts_teamuser"==pageMode?"Timesheet_teamuser":"ts_operations"==pageMode?"Timesheet_operations":"ts_operuser"==pageMode?"Timesheet_operuser":"Timesheet_team"},loadMoreData:function(resultData,params){var result=null!=resultData&&resultData.timesheetArr?resultData.timesheetArr:new Array,tslisttbody=Timetracker.Util.getLayout().find("#timesheet-listtbody"),pageCode=Timetracker.Page.getPageModeCode();$.each(result,function(index,data){data.pageCode=pageCode;var row=Timetracker.timesheet.constructTSRow(data);tslisttbody.append(row)}),Timetracker.FireScroll.setFetchCount(Timetracker.timesheet.Firescroll.getMode(),result)}}},Timetracker.reports={},Timetracker.reports.util={closeAndResetCustomDate:function(){var dateObj=Layout.Page.container.find(".date-range");$(dateObj).find("input[date=from]").val(""),$(dateObj).find("input[date=to]").val(""),Layout.Page.container.find("#periodfilter").find("select[selecttype=searchType]").val("0").select2({minimumResultsForSearch:1/0}).trigger("change")}},Timetracker.reports.projectReport={FETCHED_COUNT:0,MAX_FETCH_COUNT:25,isprojectreportdatafetched:!1,generateProjectReport:function(isLoad,params,downloadType){if(Layout.Page.container.find("#zp_project_report").show(),Timetracker.initSetup(),void 0===isLoad){if(Layout.Page.container.find("#prClientName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.clientDispName)),Layout.Page.container.find("#prprojectName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)),Timetracker.reports.projectReport.isprojectreportdatafetched)ZPComponents.Search.Configuration.JSON.defaultOption=void 0;else{Timetracker.projects.Filters.updateProjectListForFilters(!0,erecno,"0","projectReport",void 0,void 0,void 0,Timetracker.constants.TTCustomAdmin.ReportView);var filterparams=Timetracker.Filters.getParamsForFilter("projectReport");isOrgStructureEnabled&&(Timetracker.Division.constructDivisionFilter("prDivisionName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.BusinessUnit.constructBusinessUnitFilter("prBusinessUnitName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.LegalEntity.constructLegalEntityFilter("prLegalEntityName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView)),Timetracker.Department.constructDepartmentFilter("prDepartmentName",filterparams,void 0,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Designation.constructDesignationFilter("prDesignationName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Location.constructLocationFilter("prLocationName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#prDepartmentName").val("0").select2(Timetracker.select2.getSelect2Properties()),Timetracker.util.resetSelectInFilters("projectReportfilter",Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#prempstatus").select2("val",["19","-2","18"]),Layout.Page.container.find("#pruser").on("change",function(){"0"===(Layout.Page.container.find("#pruser").val()||"0")&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?Layout.Page.container.find("#princludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show():Layout.Page.container.find("#princludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide()}),Timetracker.clients.getClients("prClientName",null,null,!0,Layout.Page.container.find("#pruser").val(),Timetracker.constants.TTCustomAdmin.ReportView)}Timetracker.util.isFilterOpen("projectReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_project_report_filter"),"projectReportfilter",""),Layout.Page.container.find("#zp_empty_data,#projectreportlist").hide(),Layout.Page.container.find("#pruser").on("change",function(){Timetracker.clients.getClients("prClientName",null,null,!0,Layout.Page.container.find("#pruser").val(),Timetracker.constants.TTCustomAdmin.ReportView)})}Layout.Page.container.find(".ERR").remove(),Layout.Page.container.find("#prbillstatus,#prprojectStatus").select2({minimumResultsForSearch:1/0}),Layout.Page.container.find("#showcorrespondingJobs").hide();params=Timetracker.Filters.getAndValidateParams("PROJECTREPORT");if(void 0!==downloadType){var form=Layout.Page.container.find("#downloadprojectpdf");Layout.Page.container.find("#downloadprojectpdf").attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheetDispAction.zp?mode=exportProjectReport"),Layout.Page.container.find("#projectpdfidentity").val(csrfToken),Layout.Page.container.find("#projectpdfbillStatus").val(params.billStatus),Layout.Page.container.find("#projectpdfprojectStatus").val(params.projectStatus),Layout.Page.container.find("#projectpdfclientId").val(params.clientId),Layout.Page.container.find("#projectpdfprojectId").val(params.projectId),Layout.Page.container.find("#projectpdfuserErecNo").val(params.userErecNo),Layout.Page.container.find("#projectpdfempStatus").val(params.employeeStatus),Layout.Page.container.find("#projectapprovalStatus").val(params.approvalStatus),Layout.Page.container.find("#projectpdflegalEntityId").val(params.legalEntityId),Layout.Page.container.find("#projectpdfbusinessUnitId").val(params.businessUnitId),Layout.Page.container.find("#projectpdfdivisionId").val(params.divisionId),Layout.Page.container.find("#projectpdflocId").val(params.locId),Layout.Page.container.find("#projectpdfdeptId").val(params.deptId),Layout.Page.container.find("#projectpdfdesignationId").val(params.designationId),Layout.Page.container.find("#projectpdfisDirectSubOnlyNeeded").val(params.isDirectSubOnlyNeeded),Layout.Page.container.find("#fileType").val(downloadType),form.trigger("submit")}else Timetracker.util.isFilterOpen("projectReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_project_report_filter"),"projectReportfilter",""),Timetracker.reports.projectReport.FireScroll.resetDataOnLoad(),ZPeople.FireScroll.init(Timetracker.reports.projectReport.FireScroll.loadMoreProjectData),params.startIndex=Timetracker.reports.projectReport.FireScroll.getFetchCount(),Timetracker.reports.projectReport.FireScroll.params=params,Timetracker.util.appendLoading(),$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.reports.projectReport.isprojectreportdatafetched=!0,Layout.Page.container.find("#timesheetProjectreport").html(""),0===resultData.length?(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6"}),Layout.Page.container.find("#projectreportlist").fadeOut(200)):(Timetracker.reports.projectReport.constructProjectReport(resultData,params.billStatus),Timetracker.reports.projectReport.FireScroll.setFetchCount(resultData),Timetracker.reports.projectReport.FireScroll.resetFireScroll(resultData),Layout.Page.container.find("#zp_empty_data").fadeOut(200),Layout.Page.container.find("#projectreportlist").fadeIn(200),ZPView.handleTablePosition()),Timetracker.util.removeLoading()});Layout.Page.container.find("#zp_project_report").show()},constructProjectReport:function(resultData,billStatus){var txt="";$.each(resultData,function(index,data){txt+='<tr class="ZPLRow" id="'+data.projectId+'">',data.clientName?txt+='<td><span class="ellipsis W150" title="'+data.clientName+'">'+data.clientName+"</span></td>":txt+="<td>---</td>",txt+='<td class="MoreLoad"><span class="ellipsis W150 CP" onclick="Timetracker.reports.projectReport.showCorrespondingjobs(this,event,\''+data.projectId+"','"+billStatus+'\')" title="'+data.projectName+'"> '+data.projectName+"</span></td>",data.totalEstimatedHours?txt+="<td>"+Calendar.minstohrs(data.totalEstimatedHours)+"</td>":txt+="<td>"+Calendar.minstohrs(0)+"</td>";var totalHours=0;"1"!==billStatus&&data.billablehours?(txt+="<td>"+Calendar.minstohrs(data.billablehours)+"</td>",totalHours+=Number(data.billablehours)):txt+="<td>-</td>","0"!==billStatus&&data.nonbillablehours?(txt+="<td>"+Calendar.minstohrs(data.nonbillablehours)+"</td>",totalHours+=Number(data.nonbillablehours)):txt+="<td>-</td>",txt+="<td>"+Calendar.minstohrs(totalHours)+"</td>",void 0!==data.projectStatus&&0===data.projectStatus?txt+="<td>"+ZPI18N.getString("zp.inprogress")+"</td>":txt+="<td>"+ZPI18N.getString("zp.completed")+"</td>",txt+="</tr>"}),Layout.Page.container.find("#timesheetProjectreport").append(txt)},showCorrespondingjobs:function(obj,event,projectId,billStatus){var otherDetails={tbodyId:$(obj).closest("tbody").attr("id"),trId:$(obj).closest("tr").attr("id")};Layout.Page.container.find("#correspondingjobs").html("");var jobsdata=$(obj).data().jobsdata,params={mode:"getSchedule",assignedTo:"0",assignedBy:"0",projectId:projectId,billStatus:billStatus,fetchLoggedHrs:!0,conreqcsr:csrfToken};Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)&&(params.viewEditPermissionType=Timetracker.constants.TTCustomAdmin.ReportView),jobsdata&&0!==jobsdata.length?(Timetracker.reports.projectReport.constructCorrespondingjobs(jobsdata,event,obj),!0===$(obj).data().moreLoad?(Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.PROJECT_REPORT_JOBS,Timetracker.constants.URL,params,Timetracker.reports.projectReport.loadMoreCorrespondingJobs,void 0,otherDetails),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.PROJECT_REPORT_JOBS,jobsdata)):!1===$(obj).data().moreLoad&&Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.MODES.PROJECT_REPORT_JOBS)):(params.sIndex=0,params.limit=Timetracker.FireScroll.getMaxFetchCount(Timetracker.constants.MODES.PROJECT_REPORT_JOBS),$.post(Timetracker.constants.URL,params,function(resultData){resultData=resultData&&resultData.schArr?resultData.schArr:[],Timetracker.reports.projectReport.constructCorrespondingjobs(resultData,event,obj),resultData.length<Timetracker.reports.projectReport.MAX_FETCH_COUNT?($(obj).data("moreLoad",!1),Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.MODES.PROJECT_REPORT_JOBS)):(Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.PROJECT_REPORT_JOBS,Timetracker.constants.URL,params,Timetracker.reports.projectReport.loadMoreCorrespondingJobs,void 0,otherDetails),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.PROJECT_REPORT_JOBS,resultData)),$(obj).data("jobsdata",resultData)}))},constructCorrespondingjobs:function(correspondinglogs,event,obj){var empty="";0===correspondinglogs.length||""===correspondinglogs?(empty+='<tr><td colspan="5" style="text-align:center;">'+ZPI18N.getString("zp.nodatafound")+"</td></tr></table>",Layout.Page.container.find("#correspondingjobs").html(empty)):(Layout.Page.container.find("#correspondingjobs").html(""),Timetracker.reports.projectReport.constructCorrespondingjobshtml(correspondinglogs)),Timetracker.util.setPopupPosition(obj,"showcorrespondingJobs",event,!1,40),Layout.Page.container.find("#showcorrespondingJobs").fadeIn(200)},constructCorrespondingjobshtml:function(correspondinglogs){var estimatedhrs,txt="";$.each(correspondinglogs,function(index,data){txt+='<tr><td width="30%" class="WBBW">'+data.jobName+"</td>",estimatedhrs=0,data.hours&&(estimatedhrs=data.hours),txt+='<td width="25%">'+Calendar.minstohrs(estimatedhrs)+"</td>",txt+='<td width="25%">'+Calendar.minstohrs(data.totalhours)+"</td>",0===Number(data.jobStatus)?txt+='<td width="20%">'+ZPI18N.getString("zp.inprogress")+"</td>":txt+='<td width="20%">'+ZPI18N.getString("zp.completed")+"</td>",txt+="</tr>"}),txt+="</table>",Layout.Page.container.find("#correspondingjobs").append(txt)},loadMoreCorrespondingJobs:function(result,params,otherDtls){result=result&&result.schArr?result.schArr:[];var dom=Layout.Page.container.find("tbody#"+otherDtls.tbodyId).find("tr#"+otherDtls.trId).find("td.MoreLoad").find("span");dom.removeData("moreLoad"),result.length<Timetracker.reports.projectReport.MAX_FETCH_COUNT&&Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.MODES.PROJECT_REPORT_JOBS),dom.data("moreLoad",!(result.length<Timetracker.reports.projectReport.MAX_FETCH_COUNT));var list=dom.data().jobsdata;$.merge(list,result),dom.data("jobsdata",list),Timetracker.reports.projectReport.constructCorrespondingjobshtml(result),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.PROJECT_REPORT_JOBS,result)},FireScroll:{params:{},resetDataOnLoad:function(){Timetracker.reports.projectReport.FireScroll.resetFetchCount(),Timetracker.reports.projectReport.FireScroll.params={},ZPeople.FireScroll.reset()},setFetchCount:function(result){Timetracker.reports.projectReport.FETCHED_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.projectReport.FETCHED_COUNT)?Timetracker.reports.projectReport.FETCHED_COUNT:0,Timetracker.reports.projectReport.FETCHED_COUNT+=result.length},resetFetchCount:function(){Timetracker.reports.projectReport.FETCHED_COUNT=0},getFetchCount:function(){return Timetracker.reports.projectReport.FETCHED_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.projectReport.FETCHED_COUNT)?Timetracker.reports.projectReport.FETCHED_COUNT:0,0===Timetracker.reports.projectReport.FETCHED_COUNT?Timetracker.reports.projectReport.FETCHED_COUNT:Timetracker.reports.projectReport.FETCHED_COUNT+1},loadMoreProjectData:function(limit){var params=Timetracker.reports.projectReport.FireScroll.params;params.startIndex=Timetracker.reports.projectReport.FireScroll.getFetchCount(),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.reports.projectReport.FireScroll.constructProjectDataOnFireScrollTrigger)},resetFireScroll:function(result){Timetracker.reports.projectReport.MAX_FETCH_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.projectReport.MAX_FETCH_COUNT)?Timetracker.reports.projectReport.MAX_FETCH_COUNT:25,result.length===Timetracker.reports.projectReport.MAX_FETCH_COUNT?ZPeople.FireScroll.reset():result.length<Timetracker.reports.projectReport.MAX_FETCH_COUNT&&ZPeople.FireScroll.setParam("triggered",!0)},constructProjectDataOnFireScrollTrigger:function(result,params){result&&0!==result.length&&(Timetracker.reports.projectReport.constructProjectReport(result,params.billStatus),Timetracker.reports.projectReport.FireScroll.setFetchCount(result),Timetracker.reports.projectReport.FireScroll.resetFireScroll(result))}}},Timetracker.reports.timerReport=function(){"use strict";var search_params;function loadTimerReport(retainParams){Timetracker.initSetup();var json={};json.url=Timetracker.constants.URL,json.params=function(retainParams){var resetUser=!1;void 0===retainParams&&(retainParams=search_params,resetUser=!0);if(resetUser||!retainParams){Timetracker.util.setUserErecno();var user=Timetracker.util.getUserErecno(),userDtls=ZPeople.getUserDetailsById(user);Timetracker.Search.populateUsers("tirUser",user,{projectManagerPerm:!0}),Layout.Page.container.find("#tirUserphoto").attr("src",userDtls.avatar)}if(!retainParams){var filterparam=Timetracker.Filters.getParamsForFilter("TimerReport");Timetracker.Department.constructDepartmentFilter("tirDepartmentName",filterparam),Timetracker.clients.getClients("tirClientName"),Timetracker.projects.Filters.updateProjectListForFilters(!0,null,Layout.Page.container.find("#tirUser").val(),"timerReport"),Timetracker.Filters.loadEmployeeType("tirEmpType"),Timetracker.util.resetSelectInFilters("timerReportfilter"),Timetracker.reports.timerReport.daterange=Calendar.getCurrentWeek(),Timetracker.util.isFilterOpen("timerReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_timer_report_filter"),"timerReportfilter","tiradvanced",Layout.Page.container.find("#tirperiod").val()),Layout.Page.container.find("#ticustomreportfromtodate,#new_ticustomreportfromtodate").hide(),Layout.Page.container.find(".ERR").remove(),Layout.Page.container.find("#urperiod,#urbillstatus,#urApprovalstatus,#tirEmpType").select2({minimumResultsForSearch:1/0})}var params=Timetracker.Filters.getAndValidateParams("TIMERREPORT");params.sIndex=0,params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT;var periodType=Layout.Page.container.find("#tirperiod").val();if("0"===periodType)params.fromDate=Timetracker.DateTime.getDateinDBformat(Timetracker.reports.timerReport.daterange.from,!0),params.toDate=Timetracker.DateTime.getDateinDBformat(Timetracker.reports.timerReport.daterange.to,!0);else if("2"===periodType){var dateLayout=Layout.Page.container.find("#new_ticustomreportfromtodate"),fromDate=dateLayout.find("#tirfromdate").val(),toDate=dateLayout.find("#tirtodate").val(),compcheck=!0;if(compcheck=Timetracker.util.validateFunction("tirfromdate","",ZPI18N.getString("zp.emptyfromdate"),"div",compcheck,dateLayout),compcheck=Timetracker.util.validateFunction("tirtodate","",ZPI18N.getString("zp.emptytodate"),"div",compcheck,dateLayout),Calendar.isvalidDate(fromDate)||(compcheck=Timetracker.util.validateFunction("tirfromdate",null,ZPI18N.getString("zp.invaliddate"),"div",compcheck,dateLayout)),Calendar.isvalidDate(toDate)||(compcheck=Timetracker.util.validateFunction("tirtodate",null,ZPI18N.getString("zp.invaliddate"),"div",compcheck,dateLayout)),compcheck){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);fdate>tdate&&(compcheck=Timetracker.util.validateFunction("tirfromdate",null,ZPI18N.getString("zp.greaterfromdate"),"div",compcheck,dateLayout))}if(compcheck){var diff=Timetracker.DateTime.getDateDiff(fromDate,toDate);diff>7&&(compcheck=Timetracker.util.validateFunction("tirfromdate",null,ZPI18N.getString("zp.daterangewithinoneweek"),"div",compcheck,dateLayout))}if(!compcheck){if(!0===retainParams)return;fromDate=Calendar.formatDate(Calendar.weekfromdate),toDate=Calendar.formatDate(Calendar.weektodate),dateLayout.find("#tirfromdate").val(fromDate),dateLayout.find("#tirtodate").val(toDate),Layout.Page.container.find(".ERR").remove()}params.fromDate=Timetracker.DateTime.getDateinDBformat(Calendar.parseDate(fromDate,uidateFormat),!0),params.toDate=Timetracker.DateTime.getDateinDBformat(Calendar.parseDate(toDate,uidateFormat),!0)}return search_params=params,params}(retainParams),json.callback=Timetracker.reports.timerReport.loadTimerReportCallback,json.params&&Timetracker.Request.send(json)}function constructTimerRow(timerObjs){var txt=$("<div></div>");return $.each(timerObjs,function(erecno,timerJson){for(var workdate,timerArr=timerJson.empTimerArr,totalHours=timerJson.totalHours,totalLogs=timerJson.totalLogs,workDateObj=timerJson.workDateObj,workdate_cnt=0,rowspan=0;rowspan<timerArr.length;rowspan++){var timerObj=timerArr[rowspan];workdate&&workdate===timerObj.workDate?workdate_cnt++:(workdate=timerObj.workDate,workdate_cnt=0);for(var workdateJson=workDateObj[workdate],timers=timerObj.timerArr,timer_cnt=0;timer_cnt<timers.length;timer_cnt++){var timer=timers[timer_cnt];timerObj.fromTime=timer.fromTime,timerObj.toTime=timer.toTime,timerObj.timerId=timer.timerId,timerObj.isTimerEditAllowed=timer.isTimerEditAllowed,timerObj.isLastTimer=timer.isLastTimer;var row=constructTimerRowDOM(timerObj,rowspan,totalLogs,workdate_cnt,workdateJson.logCnt,workdateJson.workdate_total_hrs,timer_cnt,timers.length);txt.append(row)}}row=function(user,totalHours){var row=$('<tr id="tr_total_log_hours'+user+'" class="ZPLNRow"><td></td><td></td><td><b class="FR">'+ZPI18N.getString("zp.total")+'</b></td><td class="TBrdr text-center"><b id="user_total_log_hrs">'+Calendar.minstohrs(totalHours)+"</b></td></tr>");return row.data("totalHours",totalHours),row}(erecno,totalHours);txt.append(row)}),$(txt).children()}function constructTimerRowDOM(timerObj,rowCnt,rowspan,workdate_cnt,work_date_rowspan,work_date_total_hours,timer_cnt,timer_rowspan){var row=$('<tr id="tr_'+timerObj.timerId+'" user="'+timerObj.user+'" workdate="'+timerObj.workDate+'" class="ZPLNRow">'+(0===rowCnt&&0===timer_cnt?'<td rowspan="'+(rowspan+1)+'"><img class="FL" src="'+timerObj.empPhoto+'"><div class="ZPusrName"><span class="ellipsis" style="width:150px" data-toggle="tooltip" data-placement="bottom" data-container="body" data-original-title="'+timerObj.empName+'"><b>'+timerObj.empId+"</b> "+timerObj.empName+"</span></div></td>":"")+(0===workdate_cnt&&0===timer_cnt?'<td class="PL8I TBrdr" rowspan="'+work_date_rowspan+'"><div>'+timerObj.workDate+"</div></td>":"")+(0===timer_cnt?'<td class="PL8I TBrdr" rowspan="'+timer_rowspan+'"><div class="ellipsis" style="width:150px" data-toggle="tooltip" data-placement="bottom" data-container="body" data-original-title="'+timerObj.jobName+'">'+timerObj.jobName+"</div></td>":"")+'<td class="TBrdr PL8I hrsDts"><div id="timer_from_to">'+(timerObj.fromTime?Calendar.minstotimeFormat(Math.round(timerObj.fromTime/60)):ZPI18N.getString("zp.nil"))+" - "+(timerObj.toTime?Calendar.minstotimeFormat(Math.round(timerObj.toTime/60)):ZPI18N.getString("zp.nil"))+"</div></td>"+(0===workdate_cnt&&0===timer_cnt?'<td id="total_log_hours'+timerObj.user+"_"+timerObj.workDate+'" class="TBrdr" rowspan="'+work_date_rowspan+'"><div class="text-center">'+Calendar.minstohrs(work_date_total_hours)+"</div></td>":"")+"</tr>");return row.data("timerObj",timerObj),row.data("rowCnt",rowCnt),row.data("rowspan",rowspan),row.data("workdate_cnt",workdate_cnt),row.data("work_date_rowspan",work_date_rowspan),row.data("work_date_total_hours",work_date_total_hours),row.data("timer_cnt",timer_cnt),row.data("timer_rowspan",timer_rowspan),row}return{loadTimerReport:loadTimerReport,loadPreviousWeekTimerReport:function(){Timetracker.reports.timerReport.daterange=Calendar.getPreviousWeek(Timetracker.reports.timerReport.daterange),loadTimerReport(!0)},loadNextWeekTimerReport:function(){Timetracker.reports.timerReport.daterange=Calendar.getNextWeek(Timetracker.reports.timerReport.daterange),loadTimerReport(!0)},loadTimerReportCallback:function(result,params){var isError=!1;if(Timetracker.util.isFilterOpen("timerReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_timer_report_filter"),"timerReportfilter","tiradvanced",Layout.Page.container.find("#tirperiod").val()),ZPUtil.Validation.isEmpty(""+result)?(isError=!0,Timetracker.Request.failureCallback()):result.errorCode&&(isError=!0,Timetracker.Request.failureCallback(result.errorCode)),!isError){!function(timerArr){var layout=Layout.Page.container;if(layout.find("#zp_empty_data,#ts_timer_report").addClass("DN"),0===timerArr.length)Timetracker.util.appendEmptyData(ZPI18N.getString("zp.notimerlogs"),{classname:"CR-nodata-rpt",path:"path6"}),layout.find("#zp_empty_data").removeClass("DN");else{for(var txt=$("<div></div>"),i=0;i<timerArr.length;i++)txt.append(constructTimerRow(timerArr[i]));layout.find("#ts_timer_report_tbody").html("").append(txt.children()),layout.find("#ts_timer_report").removeClass("DN")}}(result.timerArr),Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.TS_TIMER_REPORT,Timetracker.constants.URL,params,Timetracker.reports.timerReport.loadMoreTimerData),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.TS_TIMER_REPORT,result.timerArr),Timetracker.util.init(),Timetracker.Util.handleTablePosition();var periodType=Layout.Page.container.find("#tirperiod").val();Layout.Page.container.find("#timerWeekReportChanger").hide(),"0"===periodType&&(Layout.Page.container.find("#timerWeekReportChanger").show(),Layout.Page.container.find("#calmonth3").html(Timetracker.DateTime.getDateinTSformat(Timetracker.reports.timerReport.daterange.from)+" - "+Timetracker.DateTime.getDateinTSformat(Timetracker.reports.timerReport.daterange.to)))}},loadMoreTimerData:function(result){var timerArr=result&&result.timerArr?result.timerArr:[];if(timerArr){for(var txt=$("<div></div>"),i=0;i<timerArr.length;i++)txt.append(constructTimerRow(timerArr[i]));Layout.Page.container.find("#ts_timer_report_tbody").append(txt.children())}Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.TS_TIMER_REPORT,timerArr)},reportTypechange:function(obj){"2"===$(obj).val()?(Layout.Page.container.find(".ERR").remove(),Layout.Page.container.find("#new_ticustomreportfromtodate").toggle(),Timetracker.util.showAdvanced("timerReportfilter","tiradvanced")):(Layout.Page.container.find("#new_ticustomreportfromtodate").hide(),Layout.Page.container.find("#periodfilter").show())}}}(),Timetracker.reports.payrollReport={ispayrollreportdatafetched:!1,dataPeriod:{},locationsForAllLocationsPayperiodDatafetched:!1,locationsForAllLocationsPayperiod:{},tmpDate:null,isLocationFilterForAllLocations:!1,generatePayrollReport:function(isLoad){if(void 0===isLoad&&(Timetracker.initSetup(),Layout.Page.container.find("#urClientName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.clientDispName)),Layout.Page.container.find("#urprojectName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)),Layout.Page.container.find("#urjobName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.jobDispName))),Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)){var filterparam;if(Layout.Page.container.find("#zp_payroll_report").removeClass("DN"),void 0===isLoad&&(Timetracker.reports.payrollReport.ispayrollreportdatafetched?ZPComponents.Search.Configuration.JSON.defaultOption=void 0:(filterparam=Timetracker.Filters.getParamsForFilter("PayrollReport"),Timetracker.projects.Filters.updateProjectListForFilters(!0,null,"0","userReport",void 0,void 0,void 0,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.reports.payrollReport.constructPayPeriodFilter(filterparam),Timetracker.Filters.loadEmployeeType("urEmpType"),isOrgStructureEnabled&&(Timetracker.Division.constructDivisionFilter("urDivisionName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.BusinessUnit.constructBusinessUnitFilter("urBusinessUnitName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.LegalEntity.constructLegalEntityFilter("urLegalEntityName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView)),Timetracker.Department.constructDepartmentFilter("urDepartmentName",filterparam,void 0,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Designation.constructDesignationFilter("urDesignationName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.util.resetSelectInFilters("userReportfilter",Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#urUser").on("change",function(){"0"===(Layout.Page.container.find("#urUser").val()||"0")&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?(Layout.Page.container.find("#urincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show(),Layout.Page.container.find("#urincludeOnlyDirectSubordinates").prop("checked",!1)):(Layout.Page.container.find("#urincludeOnlyDirectSubordinates").prop("checked",!1),Layout.Page.container.find("#urincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide())}),ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?(Layout.Page.container.find("#urincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show(),Layout.Page.container.find("#urincludeOnlyDirectSubordinates").prop("checked",!1)):(Layout.Page.container.find("#urincludeOnlyDirectSubordinates").prop("checked",!1),Layout.Page.container.find("#urincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide()),Layout.Page.container.find("#urEmpStatus").on("change",function(){var empStatus=Layout.Page.container.find("#urEmpStatus").val();null!=empStatus&&-1!==empStatus.toString().indexOf("18")?Layout.Page.container.find("#uremployeeDateOfExitBased").parents(".dateOfExit").is(":visible")||(Layout.Page.container.find("#uremployeeDateOfExitBased").parents(".dateOfExit").show(),Layout.Page.container.find("#uremployeeDateOfExitBased").prop("checked",!0)):(Layout.Page.container.find("#uremployeeDateOfExitBased").prop("checked",!1),Layout.Page.container.find("#uremployeeDateOfExitBased").parents(".dateOfExit").hide())}),Timetracker.clients.getClients("urClientName",null,null,!0,Layout.Page.container.find("#urUser").val(),Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#urUser").on("change",function(){Timetracker.clients.getClients("urClientName",null,null,!0,Layout.Page.container.find("#urUser").val(),Timetracker.constants.TTCustomAdmin.ReportView)})),Timetracker.util.isFilterOpen("userReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_user_report_filter"),"userReportfilter","uradvanced",Layout.Page.container.find("#urperiod").val()),Layout.Page.container.find("#userreportlist,#zp_empty_data,#urcustomreportfromtodate,#new_urcustomreportfromtodate").hide()),!Timetracker.reports.payrollReport.ispayrollreportdatafetched)Layout.Page.container.find("#urEmpStatus").select2("val",["19","-2","18"]).trigger("change"),Layout.Page.container.find("#urDepartmentName").select2("val","0"),Object.keys(Timetracker.reports.payrollReport.dataPeriod).length>0?(Layout.Page.container.find("#urperiod").select2("val",Object.keys(Timetracker.reports.payrollReport.dataPeriod)[0]).trigger("change"),Timetracker.reports.payrollReport.payperiodLocationFilter("urLocation",filterparam,Object.keys(Timetracker.reports.payrollReport.dataPeriod)[0])):(Timetracker.reports.payrollReport.isLocationFilterForAllLocations=!0,Timetracker.Location.constructLocationFilter("urLocation",filterparam));Layout.Page.container.find(".ERR").remove(),Layout.Page.container.find("#urbillstatus,#urApprovalstatus,#urEmpType,#urperiod,#urEmpStatus").select2({minimumResultsForSearch:1/0});var fromDate,toDate,rperiod=Layout.Page.container.find("#urperiod").val();if("6"===rperiod){Layout.Page.container.find("#new_urcustomreportfromtodate").show();var dateLayout=ZPeople.isZPNewUI()?Layout.Page.container.find("#new_urcustomreportfromtodate"):Layout.Page.container.find("#urcustomreportfromtodate");fromDate=dateLayout.find("#urfromdate").val(),toDate=dateLayout.find("#urtodate").val();var compcheck=!0;if(compcheck=Timetracker.util.validateFunction("urfromdate","",ZPI18N.getString("zp.emptyfromdate"),"div",compcheck,dateLayout),compcheck=Timetracker.util.validateFunction("urtodate","",ZPI18N.getString("zp.emptytodate"),"div",compcheck,dateLayout),Calendar.isvalidDate(fromDate)||(compcheck=Timetracker.util.validateFunction("urfromdate",null,ZPI18N.getString("zp.invaliddate"),"div",compcheck,dateLayout)),Calendar.isvalidDate(toDate)||(compcheck=Timetracker.util.validateFunction("urtodate",null,ZPI18N.getString("zp.invaliddate"),"div",compcheck,dateLayout)),compcheck){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);if(fdate>tdate)compcheck=Timetracker.util.validateFunction("urfromdate",null,ZPI18N.getString("zp.greaterfromdate"),"div",compcheck,dateLayout);else Timetracker.DateTime.getDateDiff(fdate,tdate)>31&&(compcheck=Timetracker.util.validateFunction("urfromdate",null,ZPI18N.getString("zp.datewithindays",["31"]),"div",compcheck,dateLayout))}if(!compcheck){if(!1===isLoad)return!1;rperiod=Timetracker.generalSettings.getDefaultViewType(),Layout.Page.container.find("#urperiod").val(rperiod).select2(),Layout.Page.container.find("#new_urcustomreportfromtodate").hide(),Layout.Page.container.find(".ERR").remove()}}if(rperiod<=6&&Timetracker.util.setViewType(rperiod,"ur"),"0"===rperiod||"3"===rperiod)fromDate=Calendar.formatDate(Timetracker.reports.payrollReport.tmpDate.day),toDate=Calendar.formatDate(Timetracker.reports.payrollReport.tmpDate.day),Layout.Page.container.find("#calmonth3").html(Timetracker.timelogs.getDateinTSformat(Timetracker.reports.payrollReport.tmpDate.day)),Layout.Page.container.find("#calmonth3").addClass("day").removeClass("wek mon");else if("1"===rperiod||"4"===rperiod)fromDate=Calendar.formatDate(Timetracker.reports.payrollReport.tmpDate.from),toDate=Calendar.formatDate(Timetracker.reports.payrollReport.tmpDate.to),Layout.Page.container.find("#calmonth6").html(Timetracker.timelogs.getDateinTSformat(Calendar.weekfromdate)+" - "+Timetracker.timelogs.getDateinTSformat(Calendar.weektodate)),Layout.Page.container.find("#calmonth6").addClass("wek").removeClass("day mon");else if("2"===rperiod||"5"===rperiod){fromDate=Calendar.formatDate(Timetracker.reports.payrollReport.tmpDate.from),toDate=Calendar.formatDate(Timetracker.reports.payrollReport.tmpDate.to);var month=Calendar.monthfromdate.getMonth(),year=Calendar.monthfromdate.getFullYear();Layout.Page.container.find("#calmonth7").html(months[month]+" "+year),Layout.Page.container.find("#calmonth7").addClass("mon").removeClass("day wek")}else if("6"!=rperiod){var idx=Timetracker.reports.payrollReport.dataPeriod[rperiod],payPeriod=Timetracker.reports.payrollReport.getPayperiod(idx);fromDate=Calendar.formatDate(payPeriod.start),toDate=Calendar.formatDate(payPeriod.end),"4"==payPeriod.conf.rsFrequency&&"1"==payPeriod.pos&&(fromDate=Calendar.formatDate(payPeriod.startSec),toDate=Calendar.formatDate(payPeriod.endSec)),Layout.Page.container.find("#payperiod_name").html(idx.rsName),Layout.Page.container.find("#calmonth8").html(fromDate+" - "+toDate),Layout.Page.container.find("#calmonth8").addClass("per").removeClass("day wek mon"),Layout.Page.container.find("#calmonth8").data("payperiod",payPeriod)}Timetracker.util.isFilterOpen("userReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_user_report_filter"),"userReportfilter","uradvanced",Layout.Page.container.find("#urperiod").val()),Timetracker.reports.payrollReport.getPayrollReport(rperiod,fromDate,toDate),"0"==$("#urperiod").val()||"1"==$("#urperiod").val()||"2"==$("#urperiod").val()||"3"==$("#urperiod").val()||"4"==$("#urperiod").val()||"5"==$("#urperiod").val()||"6"==$("#urperiod").val()?Layout.Page.container.find(".adpexp").hasClass("DN")||Layout.Page.container.find(".adpexp").addClass("DN"):Layout.Page.container.find(".adpexp").hasClass("DN")&&Layout.Page.container.find(".adpexp").removeClass("DN"),Layout.Page.container.find("#zp_payroll_report").removeClass("DN")}else Timetracker.util.appendPermissionDenied()},payperiodLocationFilter:function(id,param,rsId){var payperiodData=Timetracker.reports.payrollReport.dataPeriod[rsId];if(0!==Timetracker.Location.loc_List.length){if(Layout.Page.container.find("#"+id).parents(".location").removeClass("DNI"),payperiodData&&payperiodData.isAllLocation){if(!Timetracker.reports.payrollReport.locationsForAllLocationsPayperiodDatafetched){Timetracker.Location.loc_List.load&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues);var locations=[];for(var i in Timetracker.reports.payrollReport.dataPeriod)if(!Timetracker.reports.payrollReport.dataPeriod[i].isAllLocation)for(var j in Timetracker.reports.payrollReport.dataPeriod[i].rsLocations)locations.push(j);$.each(Timetracker.Location.loc_List,function(key,value){-1==locations.indexOf(Timetracker.Location.loc_List[key].locationId)&&(Timetracker.reports.payrollReport.locationsForAllLocationsPayperiod[Timetracker.Location.loc_List[key].locationId]=Timetracker.Location.loc_List[key].locationName)}),Timetracker.reports.payrollReport.locationsForAllLocationsPayperiodDatafetched=!0}payperiodData.rsLocations=Timetracker.reports.payrollReport.locationsForAllLocationsPayperiod}var deptTxt=$("<div></div>");payperiodData&&$.each(payperiodData.rsLocations,function(key,value){deptTxt.append($('<option value="'+key+'">'+ZPeople.decodeTxt(value)+"</option>"))}),Layout.Page.container.find("#"+id).html($(deptTxt).html()).select2(Timetracker.select2.getSelect2Properties(!1,{multipleSelections:!0}))}},constructPayPeriodFilter:function(filterparam){void 0!==Timetracker.reports.payrollReport.dataPeriod&&null!==Timetracker.reports.payrollReport.dataPeriod&&0!==Object.keys(Timetracker.reports.payrollReport.dataPeriod).length||(filterparam.payperiodfetch=!0),Timetracker.util.getCommonData(filterparam,Timetracker.Filters.setCacheForFilterValues);var deptTxt=$("<div></div>");deptTxt.append($('<option value="0">'+ZPI18N.getString("zp.today")+"</option>")),deptTxt.append($('<option value="1">'+ZPI18N.getString("zp.thisweek")+"</option>")),deptTxt.append($('<option value="2">'+ZPI18N.getString("zp.tt_thismonth")+"</option>")),deptTxt.append($('<option value="3">'+ZPI18N.getString("zp.yesterday")+"</option>")),deptTxt.append($('<option value="4">'+ZPI18N.getString("zp.lastweek")+"</option>")),deptTxt.append($('<option value="5">'+ZPI18N.getString("zp.lastmonth")+"</option>")),deptTxt.append($('<option value="6">'+ZPI18N.getString("zp.custom")+"</option>")),$.each(Timetracker.reports.payrollReport.dataPeriod,function(key,value){deptTxt.append($('<option value="'+value.rsID+'">'+ZPeople.decodeTxt(value.rsName)+"</option>"))}),Layout.Page.container.find("#urperiod").html($(deptTxt).html()).val("7").select2(Timetracker.select2.getSelect2Properties())},getPayperiod:function(reportConf){var curDate=new Date,payperiod={conf:reportConf,cur_date:curDate},reportEnd=new Date(curDate),reportStart=new Date(curDate),reportClosure=new Date(curDate),payrollReportClosure=new Date(curDate);if("1"==reportConf.rsFrequency)(reportClosure=32==reportConf.rsClosureDay?new Date(reportClosure.getFullYear(),reportClosure.getMonth()+1,0):new Date(reportClosure.setDate(reportConf.rsClosureDay)))<curDate&&reportClosure.setMonth(reportClosure.getMonth()+1),32==reportConf.rsToDay?(reportEnd=(reportEnd=new Date(reportClosure.getFullYear(),reportClosure.getMonth()+1,0))>reportClosure?new Date(reportEnd.getFullYear(),reportEnd.getMonth(),0):reportEnd,reportStart=new Date(reportEnd.getFullYear(),reportEnd.getMonth(),1)):(reportEnd=(reportEnd=new Date(reportClosure.getFullYear(),reportClosure.getMonth(),reportConf.rsToDay))>reportClosure?new Date(reportEnd.setMonth(reportEnd.getMonth()-1)):reportEnd,reportStart=new Date(reportEnd.getFullYear(),reportEnd.getMonth()-1,reportEnd.getDate()+1)),payrollReportClosure=new Date(reportClosure),ZPUtil.setDate(payrollReportClosure,reportConf.rsPayrollClosure),payrollReportClosure<reportClosure&&payrollReportClosure.setMonth(payrollReportClosure.getMonth()+1);else if(2==reportConf.rsFrequency){(reportClosure=new Date(curDate)).setDay(reportConf.rsClosureDay),reportClosure<curDate&&reportClosure.setDate(reportClosure.getDate()+7),(reportEnd=new Date(reportClosure)).setDay(reportConf.rsToDay),reportEnd=reportEnd>reportClosure?new Date(reportEnd.setDate(reportEnd.getDate()-7)):reportEnd;reportStart=new Date(reportEnd);reportStart=new Date(reportStart.setDate(reportStart.getDate()-6)),(payrollReportClosure=new Date(reportClosure)).setDay(reportConf.rsPayrollClosure),payrollReportClosure<reportClosure&&payrollReportClosure.setDate(payrollReportClosure.getDate()+7)}else if(3==reportConf.rsFrequency){(reportClosure=new Date(curDate)).setDay(reportConf.rsClosureDay),reportClosure<curDate&&reportClosure.setDate(reportClosure.getDate()+7),(reportEnd=new Date(reportClosure)).setDay(reportConf.rsToDay),reportEnd=reportEnd>reportClosure?new Date(reportEnd.setDate(reportEnd.getDate()-7)):reportEnd;reportStart=new Date(reportEnd);reportStart=new Date(reportStart.setDate(reportStart.getDate()-13)),(payrollReportClosure=new Date(reportClosure)).setDay(reportConf.rsPayrollClosure),payrollReportClosure<reportClosure&&payrollReportClosure.setDate(reportClosure.getDate()+7)}else if(4==reportConf.rsFrequency){var reportClosureSec=new Date(curDate);reportClosureSec=32==reportConf.rsSecClosureDay?new Date(reportClosureSec.getFullYear(),reportClosureSec.getMonth()+1,0):new Date(reportClosureSec.setDate(reportConf.rsSecClosureDay));var reportEndSec=new Date(reportClosureSec);reportClosureSec<(reportEndSec=32==reportConf.rsSecToDay?new Date(reportClosureSec.getFullYear(),reportClosureSec.getMonth()+1,0):new Date(reportEndSec.setDate(reportConf.rsSecToDay)))&&reportClosureSec.setMonth(reportClosureSec.getMonth()+1);var payrollReportClosureSec=new Date(reportClosureSec);ZPUtil.setDate(payrollReportClosureSec,reportConf.rsSecPayrollClosure),payrollReportClosureSec<reportClosureSec&&payrollReportClosureSec.setMonth(payrollReportClosureSec.getMonth()+1);var reportStartSec=new Date(reportEndSec);reportStartSec=32==reportStartSec.rsSecFromDay?new Date(reportEndSec.getFullYear(),reportEndSec.getMonth()+1,0):new Date(reportStartSec.setDate(reportConf.rsSecFromDay)),payperiod.conf.rsSecFromDay!=reportStartSec.getDate()&&2!=reportEndSec.getMonth()&&(reportStartSec=new Date(reportStartSec.setMonth(reportEndSec.getMonth()-1)),reportStartSec=new Date(reportStartSec.setDate(payperiod.conf.rsSecFromDay))),reportEndSec<reportStartSec&&reportStartSec.setMonth(reportStartSec.getMonth()-1);reportClosure=new Date(curDate);reportClosureSec<(reportClosure=32==reportConf.rsClosureDay?new Date(reportClosure.getFullYear(),reportClosure.getMonth()+1,0):new Date(reportClosure.setDate(reportConf.rsClosureDay)))&&reportClosure.setMonth(reportClosure.getMonth()-1);reportEnd=new Date(reportClosure);reportClosure<(reportEnd=32==reportConf.rsToDay?new Date(reportClosure.getFullYear(),reportClosure.getMonth()+1,0):new Date(reportEnd.setDate(reportConf.rsToDay)))&&reportClosure.setMonth(reportClosure.getMonth()+1),payrollReportClosure=new Date(reportClosure),ZPUtil.setDate(payrollReportClosure,reportConf.rsPayrollClosure),payrollReportClosure<reportClosure&&payrollReportClosure.setMonth(payrollReportClosure.getMonth()+1);reportStart=new Date(reportEnd);reportStart=32==reportConf.rsFromDay?new Date(reportEnd.getFullYear(),reportEnd.getMonth()+1,0):new Date(reportStart.setDate(reportConf.rsFromDay)),payperiod.conf.rsFromDay!=reportStart.getDate()&&2!=reportEnd.getMonth()&&(reportStart=new Date(reportStart.setMonth(reportEnd.getMonth()-1)),reportStart=new Date(reportStart.setDate(payperiod.conf.rsFromDay))),reportEnd<reportStart&&reportStart.setMonth(reportStart.getMonth()-1),payperiod.pos=curDate<=reportClosure?0:1,payperiod.startSec=reportStartSec,payperiod.endSec=reportEndSec,payperiod.closureSec=reportClosureSec,payperiod.payrollReportClosureSec=payrollReportClosureSec}return payperiod.start=reportStart,payperiod.end=reportEnd,payperiod.closure=reportClosure,payperiod.payrollReportClosure=payrollReportClosure,payperiod},generatePrevDayPayrollReport:function(){var rperiod=Layout.Page.container.find("#urperiod").val(),d=Calendar.getPreviousDay(),date=Calendar.formatDate(d.day);Layout.Page.container.find("#calmonth3").html(Timetracker.timelogs.getDateinTSformat(d.day)),Layout.Page.container.find("#calmonth3").addClass("day").removeClass("wek mon"),Timetracker.reports.payrollReport.getPayrollReport(rperiod,date,date)},generateNextDayPayrollReport:function(){var rperiod=Layout.Page.container.find("#urperiod").val(),d=Calendar.getNextDay(),date=Calendar.formatDate(d.day);Layout.Page.container.find("#calmonth3").html(Timetracker.timelogs.getDateinTSformat(d.day)),Layout.Page.container.find("#calmonth3").addClass("day").removeClass("wek mon"),Timetracker.reports.payrollReport.getPayrollReport(rperiod,date,date)},generatePrevWeekPayrollReport:function(){var rperiod=Layout.Page.container.find("#urperiod").val(),d=Calendar.getPreviousWeek(),fromdate=Calendar.formatDate(d.from),todate=Calendar.formatDate(d.to);Layout.Page.container.find("#calmonth6").html(Timetracker.timelogs.getDateinTSformat(d.from)+" - "+Timetracker.timelogs.getDateinTSformat(d.to)),Layout.Page.container.find("#calmonth6").addClass("wek").removeClass("day mon"),Timetracker.reports.payrollReport.getPayrollReport(rperiod,fromdate,todate)},generateNextWeekPayrollReport:function(){var rperiod=Layout.Page.container.find("#urperiod").val(),d=Calendar.getNextWeek(),fromdate=Calendar.formatDate(d.from),todate=Calendar.formatDate(d.to);Layout.Page.container.find("#calmonth6").html(Timetracker.timelogs.getDateinTSformat(d.from)+" - "+Timetracker.timelogs.getDateinTSformat(d.to)),Layout.Page.container.find("#calmonth6").addClass("wek").removeClass("day mon"),Timetracker.reports.payrollReport.getPayrollReport(rperiod,fromdate,todate)},generatePrevMonthPayrollReport:function(){var rperiod=$("#urperiod").val(),d=Calendar.getPreviousMonth(),fromdate=Calendar.formatDate(d.from),todate=Calendar.formatDate(d.to),month=Calendar.monthfromdate.getMonth(),year=Calendar.monthfromdate.getFullYear();Layout.Page.container.find("#calmonth7").html(months[month]+" "+year),Layout.Page.container.find("#calmonth7").addClass("mon").removeClass("day wek"),Timetracker.reports.payrollReport.getPayrollReport(rperiod,fromdate,todate)},generateNextMonthPayrollReport:function(){var rperiod=Layout.Page.container.find("#urperiod").val(),d=Calendar.getNextMonth(),fromdate=Calendar.formatDate(d.from),todate=Calendar.formatDate(d.to),month=Calendar.monthfromdate.getMonth(),year=Calendar.monthfromdate.getFullYear();Layout.Page.container.find("#calmonth7").html(months[month]+" "+year),Layout.Page.container.find("#calmonth7").addClass("mon").removeClass("day wek"),Timetracker.reports.payrollReport.getPayrollReport(rperiod,fromdate,todate)},generateNextorBeforePayrollReport:function(input){var payperiod=Layout.Page.container.find("#calmonth8").data("payperiod"),cur_payperiod=(payperiod.conf,Timetracker.reports.payrollReport.getFromToForPayPeriod(input,payperiod));payperiod.start=cur_payperiod.fromDay,payperiod.end=cur_payperiod.toDay,payperiod.closure=cur_payperiod.closureDay,"4"==payperiod.conf.rsFrequency&&(payperiod.startSec=cur_payperiod.fromDaySec,payperiod.endSec=cur_payperiod.toDaySec,payperiod.closureSec=cur_payperiod.closureDaySec,payperiod.pos=cur_payperiod.pos);var fromdate=Calendar.formatDate(payperiod.start),todate=Calendar.formatDate(payperiod.end);"1"==payperiod.pos&&"4"==payperiod.conf.rsFrequency&&(fromdate=Calendar.formatDate(payperiod.startSec),todate=Calendar.formatDate(payperiod.endSec)),Layout.Page.container.find("#calmonth8").html(fromdate+" - "+todate),Layout.Page.container.find("#calmonth8").addClass("per").removeClass("day wek mon"),Layout.Page.container.find("#calmonth8").data("payperiod",payperiod),Timetracker.reports.payrollReport.getPayrollReport(payperiod.conf.rsFrequency,fromdate,todate)},getPayrollReport:function(rperiod,fromDate,toDate){var params=Timetracker.Filters.getAndValidateParams("PAYROLLREPORT");params.fromDate=Timetracker.timelogs.getDateinDBformat(Calendar.parseDate(fromDate,uidateFormat),!0),params.toDate=Timetracker.timelogs.getDateinDBformat(Calendar.parseDate(toDate,uidateFormat),!0),params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,params.sIndex=0,Timetracker.util.appendLoading(),$.post(Timetracker.constants.URL,params,function(resultData){0===resultData.res?(Layout.Page.container.find("#userDayReportChanger,#userWeekReportChanger,#zp_empty_data,#userMonthReportChanger,#userreportlist,#periodChanger").hide(),Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(resultData.errorCode,null,!0)),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6"}),Timetracker.util.removeLoading()):(Timetracker.reports.payrollReport.ispayrollreportdatafetched=!0,Timetracker.reports.payrollReport.constructPayRollReport(rperiod,resultData,params),Timetracker.util.removeLoading(),Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.PAYROLL_REPORT,Timetracker.constants.URL,params,Timetracker.reports.payrollReport.loadMoreDataInPayrollReport,"zp_payroll_report"),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.PAYROLL_REPORT,resultData),-1!==JSON.stringify(resultData).indexOf("hasLeaveDataOnly")&&Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.MODES.PAYROLL_REPORT),Layout.Page.parentContainer.find("[scroll=enabled]").scrollTop(0))})},loadMoreDataInPayrollReport:function(result){0===result.length?Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.PAYROLL_REPORT,0):(Layout.Page.container.find("#ureportbody").append(Timetracker.reports.payrollReport.constructPayrollHtml(result,!1,!0)),Layout.Page.container.find(".th_pay_ot").hasClass("DN")?Layout.Page.container.find(".td_pay_ot").addClass("DN"):Layout.Page.container.find(".td_pay_ot").removeClass("DN"),Layout.Page.container.find(".th_pay_dot").hasClass("DN")?Layout.Page.container.find(".td_pay_dot").addClass("DN"):Layout.Page.container.find(".td_pay_dot").removeClass("DN"),Layout.Page.container.find(".th_pay_leave").hasClass("DN")?Layout.Page.container.find(".td_pay_leave").addClass("DN"):Layout.Page.container.find(".td_pay_leave").removeClass("DN"),Layout.Page.container.find(".th_pay_tot").hasClass("DN")?Layout.Page.container.find(".td_pay_tot").addClass("DN"):Layout.Page.container.find(".td_pay_tot").removeClass("DN"),Timetracker.Util.handleTableHeader(),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.PAYROLL_REPORT,result),-1!=JSON.stringify(result).indexOf("hasLeaveDataOnly")&&Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.MODES.PAYROLL_REPORT))},exportPayrollReport:function(mode,params,downloadType){if(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)){if(void 0!==downloadType&&(params=null!==mode&&void 0!==mode&&mode.hasOwnProperty("payrollDrillDown")?mode:Layout.Page.container.find("#ureportbody").data("params")),void 0!==downloadType){var form=Layout.Page.container.find("#userdownloadpdf");Layout.Page.container.find("#userdownloadpdf").attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheetDispAction.zp?mode=exportUserReport"),Layout.Page.container.find("#userpdfidentity").val(csrfToken),Layout.Page.container.find("#userpdfuserErecNo").val(params.userErecNo),Layout.Page.container.find("#userpdffromDate").val(params.fromDate),Layout.Page.container.find("#userpdftoDate").val(params.toDate),Layout.Page.container.find("#userpdfapprovalStatus").val(params.approvalStatus),Layout.Page.container.find("#userpdfemployeeType").val(params.employeeType?params.employeeType:"0"),Layout.Page.container.find("#userpdfjobId").val(params.jobId),Layout.Page.container.find("#userpdfclientId").val(params.clientId),Layout.Page.container.find("#userpdfprojectId").val(params.projectId),Layout.Page.container.find("#userpdflegalEntityId").val(params.legalEntityId),Layout.Page.container.find("#userpdfbusinessUnitId").val(params.businessUnitId),Layout.Page.container.find("#userpdfdivisionId").val(params.divisionId),Layout.Page.container.find("#userpdfdeptId").val(params.deptId),Layout.Page.container.find("#userpdfdesignationId").val(params.designationId),Layout.Page.container.find("#userpdflocationId").val(params.locationId),Layout.Page.container.find("#userpdfempStatus").val(params.employeeStatus),Layout.Page.container.find("#fileType").val(downloadType),Layout.Page.container.find("#userpdfisDirectSubOnlyNeeded").val(params.isDirectSubOnlyNeeded),Layout.Page.container.find("#userpdfemployeeDateOfExitBased").val(params.employeeDateOfExitBased),Layout.Page.container.find("#userpdfrsId").val(params.rsId);var payperiod=Layout.Page.container.find("#calmonth8").data("payperiod");payperiod&&Layout.Page.container.find("#userpdffrequency").val(payperiod.conf.rsFrequency),params.hasOwnProperty("isTotalNeeded")?(0===Layout.Page.container.find("#userdownloadpdf").find("#userisTotalNeeded").length&&Layout.Page.container.find("#userdownloadpdf").append('<input type="hidden" name="isTotalNeeded" id="userisTotalNeeded"/>'),Layout.Page.container.find("#userisTotalNeeded").val(params.isTotalNeeded)):Layout.Page.container.find("#userdownloadpdf").find("#userisTotalNeeded").remove(),"pdf"!=downloadType&&"adpCsv"!=downloadType||"supCsv"!=downloadType?Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!1):Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!0),form.trigger("submit")}}else Timetracker.util.appendPermissionDenied()},constructPayRollReport:function(rperiod,result,params){Layout.Page.container.find("#userDayReportChanger,#userWeekReportChanger,#zp_empty_data,#userMonthReportChanger,#userreportlist,#periodChanger").hide(),"0"===rperiod||"3"===rperiod?Layout.Page.container.find("#userDayReportChanger").show():"1"===rperiod||"4"===rperiod?Layout.Page.container.find("#userWeekReportChanger").show():"2"===rperiod||"5"===rperiod?Layout.Page.container.find("#userMonthReportChanger").show():"6"!==rperiod&&Layout.Page.container.find("#periodChanger").show();Layout.Page.container.find("#urUser").val(),Layout.Page.container.find("#urbillstatus").val();if(Layout.Page.container.find("#ureportbody").data("params",params),0===result.length)Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6"});else{Layout.Page.container.find("#ureportbody").html("");var txt=Timetracker.reports.payrollReport.constructPayrollHtml(result,!1);Layout.Page.container.find("#ureportbody").html(txt),Layout.Page.container.find(".th_pay_ot").hasClass("DN")?Layout.Page.container.find(".td_pay_ot").addClass("DN"):Layout.Page.container.find(".td_pay_ot").removeClass("DN"),Layout.Page.container.find(".th_pay_dot").hasClass("DN")?Layout.Page.container.find(".td_pay_dot").addClass("DN"):Layout.Page.container.find(".td_pay_dot").removeClass("DN"),Layout.Page.container.find(".th_pay_leave").hasClass("DN")?Layout.Page.container.find(".td_pay_leave").addClass("DN"):Layout.Page.container.find(".td_pay_leave").removeClass("DN"),Layout.Page.container.find(".th_pay_tot").hasClass("DN")?Layout.Page.container.find(".td_pay_tot").addClass("DN"):Layout.Page.container.find(".td_pay_tot").removeClass("DN"),Layout.Page.container.find("#userreportlist").fadeIn(200),Timetracker.Util.handleTableHeader()}},constructPayrollHtml:function(result,isDataBased,isfromLoadMoreData){var domTxt,txt="",docFrag=document.createDocumentFragment();return 0===result.length?txt="no data":(isDataBased||isfromLoadMoreData||Layout.Page.container.find(".th_pay_ot,.th_pay_dot,.th_pay_leave,.th_pay_tot").addClass("DN"),$.each(result,function(index,data){if(txt="",isDataBased)txt+='<tr class="ZPLRow">',txt+="<td>"+data.workdate+"</td>";else{var userErecNo=data.userErecNo,empId=data.EMPLOYEEID,empPhoto=data.EMPLOYEEPHOTO,empDispName=data.firstName;if(Layout.Page.container.find("#zp_tt_payroll_"+userErecNo).length>0)return!0;var hasLeaveDataOnly=data.hasLeaveDataOnly&&!0===data.hasLeaveDataOnly;if(txt+='<tr id="zp_tt_payroll_'+userErecNo+'" class="ZPLNRow CP"',hasLeaveDataOnly){var msg=ZPI18N.getString("zp.tsbudgetnotimelogs");txt+='onclick="Timetracker.util.showAlert('+Timetracker.constants.RESPONSE_CODES.WARNING+", '"+msg+"')\""}else txt+="onclick=\"Timetracker.reports.payrollReport.constructDateBasedReport(this,'"+userErecNo+"', '"+empPhoto+"');\"";txt+=">",txt+='<td class="fxdtd" style="max-width:300px;width:300px;"><img class="FL" src="'+empPhoto+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+empDispName+'"><b>'+empId+"</b> "+empDispName+"</span><div></td>"}var total_amt=0,rate=0,ot_singlepayrate=data.ot_singleRatePerHour?data.ot_singleRatePerHour:0,ot_doublepayrate=data.ot_doubleRatePerHour?data.ot_doubleRatePerHour:0,billableHours=void 0!==data.payable?data.payable:0;if(data.ratePerHour&&(rate=data.ratePerHour,total_amt=data.ratePerHour*(data.payable/60)),txt+=isDataBased?"<td>"+Calendar.minstohrs(billableHours)+"</td>":'<td class="P0I TBrdr"><table class="table i_table"><tr><td class="text-center" width="33%"><div class="W80"><span>'+Calendar.minstohrs(billableHours)+'</span></div></td><td class="text-center" width="33%"><div class="W90"><span>'+rate+'</span></div></td><td class="text-center" width="33%"><div class="W80"><span>'+total_amt.toFixed(2)+'</span></div></td></tr></table></td><td class="td_pay_ot P0I TBrdr DN"><table class="table i_table"><tr><td class="text-center" width="33%"><div class="W80"><span>$OT_SINGLE_HRS$</span></div></td><td class="text-center" width="33%"><div class="W90"><span>$OT_SINGLE_RATE$</span></div></td><td class="text-center" width="33%"><div class="W80"><span>$OT_SINGLE_AMT$</span></div></td></tr></table></td><td class="td_pay_dot P0I TBrdr DN"><table class="table i_table"><tr><td class="text-center" width="33%"><div class="W80"><span>$OT_DOUBLE_HRS$</span></div></td><td class="text-center" width="33%"><div class="W90"><span>$OT_DOUBLE_RATE$</span></div></td><td class="text-center" width="33%"><div class="W80"><span>$OT_DOUBLE_AMT$</span></div></td></tr></table></td><td class="td_pay_leave P0I TBrdr DN"><table class="table i_table"><tr><td class="text-center" width="33%"><div class="W80"><span>$LEAVE_HRS$</span></div></td><td class="text-center" width="33%"><div class="W90"><span>$LEAVE_RATE$</span></div></td><td class="text-center" width="33%"><div class="W80"><span>$LEAVE_AMT$</span></div></td></tr></table></td><td class="td_pay_tot P0I TBrdr text-center DN"><div class="W120"><span>$TOTAL$</span></div></td>',!isDataBased){if(void 0!==data.ot_hours||void 0!==data.weekend_ot_hrs||void 0!==data.holiday_ot_hrs){void 0===data.single_ot_hours&&void 0===data.weekend_ot_hrs&&void 0===data.holiday_ot_hrs||Layout.Page.container.find(".th_pay_ot,.th_pay_tot").removeClass("DN");var wknd_holOT=0;if(void 0!==data.weekend_ot_hrs&&(wknd_holOT+=data.weekend_ot_hrs),void 0!==data.holiday_ot_hrs&&(wknd_holOT+=data.holiday_ot_hrs),void 0!==data.single_ot_hours||void 0!==data.weekend_ot_hrs||void 0!==data.holiday_ot_hrs){var singleothrs=0;void 0!==data.single_ot_hours&&(singleothrs=data.single_ot_hours),txt=txt.replace("$OT_SINGLE_HRS$",Calendar.minstohrs(singleothrs+wknd_holOT))}txt=txt.replace("$OT_SINGLE_RATE$",ot_singlepayrate);var ot_single_amt=0;if(ot_single_amt=void 0!==data.single_ot_hours?ot_singlepayrate*(wknd_holOT+data.single_ot_hours)/60:ot_singlepayrate*wknd_holOT/60,txt=txt.replace("$OT_SINGLE_AMT$",ot_single_amt.toFixed(2)),total_amt+=ot_single_amt,void 0!==data.double_ot_hours){Layout.Page.container.find(".th_pay_dot,.th_pay_tot").removeClass("DN"),txt=(txt=txt.replace("$OT_DOUBLE_HRS$",Calendar.minstohrs(data.double_ot_hours))).replace("$OT_DOUBLE_RATE$",ot_doublepayrate);var ot_double_amt=ot_doublepayrate*data.double_ot_hours/60;txt=txt.replace("$OT_DOUBLE_AMT$",ot_double_amt.toFixed(2)),total_amt+=ot_double_amt}else txt=(txt=(txt=txt.replace("$OT_DOUBLE_HRS$",Calendar.minstohrs(0))).replace("$OT_DOUBLE_RATE$",0)).replace("$OT_DOUBLE_AMT$",(0).toFixed(2))}if(void 0!==data.paidLeaveHours){Layout.Page.container.find(".th_pay_leave,.th_pay_tot").removeClass("DN");var paidLeaveHrs=data.paidLeaveHours,paidLeaveAmt=paidLeaveHrs*rate/60;total_amt+=paidLeaveAmt,txt=(txt=(txt=txt.replace("$LEAVE_HRS$",Calendar.minstohrs(paidLeaveHrs))).replace("$LEAVE_RATE$",rate)).replace("$LEAVE_AMT$",paidLeaveAmt.toFixed(2))}txt=(txt=(txt=(txt=(txt=(txt=(txt=(txt=(txt=(txt=txt.replace("$OT_SINGLE_HRS$",Calendar.minstohrs(0))).replace("$OT_SINGLE_RATE$",0)).replace("$OT_SINGLE_AMT$",(0).toFixed(2))).replace("$OT_DOUBLE_HRS$",Calendar.minstohrs(0))).replace("$OT_DOUBLE_RATE$",0)).replace("$OT_DOUBLE_AMT$",(0).toFixed(2))).replace("$LEAVE_HRS$",Calendar.minstohrs(0))).replace("$LEAVE_RATE$",0)).replace("$LEAVE_AMT$",(0).toFixed(2))).replace("$TOTAL$",total_amt.toFixed(2))}txt+="</tr>",(domTxt=$(txt)).data("payrollempData",data),docFrag.appendChild(domTxt[0])})),docFrag},ureportTypechange:function(obj){"6"===$(obj).val()?(Layout.Page.container.find(".ERR").remove(),Layout.Page.container.find("#new_urcustomreportfromtodate").toggle(),Timetracker.util.showAdvanced("userReportfilter","uradvanced")):(Layout.Page.container.find("#new_urcustomreportfromtodate").hide(),Layout.Page.container.find("#periodfilter").show());var filterparam=Timetracker.Filters.getParamsForFilter("PayrollReport");"0"!=$(obj).val()&&"1"!=$(obj).val()&&"2"!=$(obj).val()&&"3"!=$(obj).val()&&"4"!=$(obj).val()&&"5"!=$(obj).val()&&"6"!=$(obj).val()?(Timetracker.reports.payrollReport.isLocationFilterForAllLocations=!1,Timetracker.reports.payrollReport.payperiodLocationFilter("urLocation",filterparam,$(obj).val())):Timetracker.reports.payrollReport.isLocationFilterForAllLocations||(Timetracker.reports.payrollReport.isLocationFilterForAllLocations=!0,Timetracker.Location.constructLocationFilter("urLocation",filterparam))},constructDateBasedReport:function(tr,erecNo,photo){var empName=$(tr).data("payrollempData").firstName,actualParam=Layout.Page.container.find("#ureportbody").data("params"),params=JSON.parse(JSON.stringify(actualParam));params.userErecNo=erecNo,params.sIndex=0,params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,delete params.isTotalNeeded,params.payrollDrillDown=!0,$.post(Timetracker.constants.URL,params,function(resultData){if(0===Layout.Page.container.find("#payrollDrillDown").length){var txt=$('<div id="payrollDrillDown" class="modal popRgtModel PopMdxModel" aria-hidden="false"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h6 class="addPopTitle"></h6><div class="FR MR25 MT5"><span class="FL PR dropdown ZPcusPos1 ZPCusDrs MR10"><i class="IC-more  S18 gry CP" data-toggle="dropdown" aria-expanded="false"></i><ul class="dropdown-menu ZPCmn-Arrow top gray"><li id="payroll_report_export_icon"><a><span class="IC-exprt DIB gry MR5"></span>'+ZPI18N.getString("zp.export")+'</a></li><li id="payroll_report_pdf_icon"><a><span class="IC-xls DIB gry MR5"></span>'+ZPI18N.getString("zp.downloadpdf")+'</a></li><li id="payroll_report_print_icon"><a><span class="IC-print DIB gry MR5"></span>'+ZPI18N.getString("zp.print")+'</a></li></ul></span><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div></div><div id="drilledreportprint" class="modal-body PT0I"><div class="table-responsive tabcont DN" id="drilleduserreportlist" scroll="enabled"><table class="table table-hover"><thead id="drilledureporthead"><tr class="ZPLHRow"><th width="175">'+ZPI18N.getString("zp.date")+'</th><th width="175">'+ZPI18N.getString("zp.billablehours")+'</th></tr></thead><tbody id="drilledureportbody"></tbody></table></div></div><div class="modal-footer text-left"><button data-dismiss="modal" class="btn btn-default" type="button">'+ZPI18N.getString("zp.close")+"</button></div></div></div></div>");Layout.Page.container.append(txt)}if(Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.PAYROLL_DRILLDOWN,Timetracker.constants.URL,params,Timetracker.reports.payrollReport.loadMoreDataInPayrollDrillDown,"payrollDrillDown"),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.PAYROLL_DRILLDOWN,resultData),Layout.Page.container.find("#payrollDrillDown").find("#payroll_report_export_icon").off("click").on("click",function(){Timetracker.ImportExport.showExportOptions(Timetracker.reports.payrollReport.exportPayrollReport,params)}),Layout.Page.container.find("#payrollDrillDown").find("#payroll_report_pdf_icon").off("click").on("click",function(){Timetracker.reports.payrollReport.exportPayrollReport(params,null,Timetracker.constants.DOWNLOAD_TYPES.PDF)}),Layout.Page.container.find("#payrollDrillDown").find("#payroll_report_print_icon").off("click").on("click",function(){Timetracker.util.printReport("drilledreportprint",!1,params.userErecNo,params.fromDate+" "+ZPI18N.getString("zp.to")+" "+params.toDate)}),Layout.Page.container.find("#payrollDrillDown").find(".addPopTitle").html('<span class="FL">'+ZPI18N.getString("zp.datebasedreport",[""])+'</span><div class="FL ML3 ZP-UserProfAct ZP-UserProfPop"><img class="Usrimg ML5" src="'+photo+'"><span class="ML5">'+empName+" ("+params.fromDate+" "+ZPI18N.getString("zp.to")+" "+params.toDate+")</span>"),0==resultData.length)Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"drilledreportprint"}),Layout.Page.container.find("#drilleduserreportlist").hide();else{Layout.Page.container.find("#drilledureportbody").html("");var tbody=Timetracker.reports.payrollReport.constructPayrollHtml(resultData,!0);Layout.Page.container.find("#drilledureportbody").html(tbody),Layout.Page.container.find("#zp_empty_data").hide(),Layout.Page.container.find("#drilleduserreportlist").show(),Layout.Page.container.find("#drilleduserreportlist").scrollTop(0)}Layout.Page.container.find("#payrollDrillDown").off("hide.bs.modal").on("hide.bs.modal",function(e){Timetracker.FireScroll.hasMoreData(Timetracker.constants.MODES.PAYROLL_REPORT)&&(ZPeople.FireScroll.getFireScrollPropertie().triggered=!1),Layout.Page.container.find("#drilleduserreportlist").scrollTop(0)}),Layout.Page.container.find("#payrollDrillDown").modal("show")})},loadMoreDataInPayrollDrillDown:function(resultData){0===resultData.length?Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.PAYROLL_DRILLDOWN,0):(Layout.Page.container.find("#drilledureportbody").append(Timetracker.reports.payrollReport.constructPayrollHtml(resultData,!0)),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.PAYROLL_DRILLDOWN,resultData))},getFromToForPayPeriod:function(nav,payperiod){var freq=payperiod.conf.rsFrequency,type="month";moment([])._d;"2"==freq?type="week":"3"==freq?type="biWeek":"4"==freq&&(type="semMonth");var fromDay,toDay,closureDay,payrollReportClosure,obj={conf:payperiod.conf,cur_date:new Date};return closureDay=new Date(payperiod.closure),payrollReportClosure=new Date(payperiod.payrollReportClosure),toDay=new Date(payperiod.end),"week"==type?(nav<1?(closureDay=new Date(closureDay.setDate(payperiod.closure.getDate()-7)),toDay=new Date(toDay.setDate(payperiod.end.getDate()-7)),payrollReportClosure=new Date(closureDay.setDate(payperiod.payrollReportClosure.getDate()-7))):(closureDay=new Date(closureDay.setDate(payperiod.closure.getDate()+7)),payrollReportClosure=new Date(closureDay.setDate(payperiod.payrollReportClosure.getDate()+7)),toDay=new Date(toDay.setDate(payperiod.end.getDate()+7))),fromDay=new Date(toDay),fromDay=new Date(fromDay.setDate(toDay.getDate()-6))):"month"==type?(fromDay=new Date(payperiod.start),nav<0?(toDay=32==payperiod.conf.rsToDay?new Date(payperiod.end.getFullYear(),payperiod.end.getMonth(),0):new Date(toDay.setMonth(toDay.getMonth()-1)),fromDay=new Date(fromDay.setMonth(fromDay.getMonth()-1)),closureDay=32==payperiod.conf.rsClosureDay?new Date(closureDay.getFullYear(),closureDay.getMonth(),0):new Date(closureDay.setMonth(closureDay.getMonth()-1)),payrollReportClosure=32==payperiod.conf.rsPayrollClosure?new Date(payrollReportClosure.getFullYear(),payrollReportClosure.getMonth(),0):new Date(closureDay.setMonth(payrollReportClosure.getMonth()-1))):(toDay=32==payperiod.conf.rsToDay?new Date(toDay.getFullYear(),toDay.getMonth()+2,0):new Date(toDay.setMonth(toDay.getMonth()+1)),fromDay=new Date(fromDay.setMonth(fromDay.getMonth()+1)),closureDay=32==payperiod.conf.rsClosureDay?new Date(closureDay.getFullYear(),closureDay.getMonth()+2,0):new Date(closureDay.setMonth(closureDay.getMonth()+1)),payrollReportClosure=32==payperiod.conf.rsPayrollClosure?new Date(payrollReportClosure.getFullYear(),payrollReportClosure.getMonth()+2,0):new Date(closureDay.setMonth(payrollReportClosure.getMonth()+1))),payperiod.conf.rsFromDay!=fromDay.getDate()&&2!=toDay.getMonth()&&(fromDay=new Date(fromDay.setMonth(toDay.getMonth()-1)),fromDay=new Date(fromDay.setDate(payperiod.conf.rsFromDay)))):"biWeek"==type?(nav<1?(closureDay=new Date(closureDay.setDate(payperiod.closure.getDate()-14)),payrollReportClosure=new Date(payrollReportClosure.setDate(payperiod.payrollReportClosure.getDate()-14)),toDay=new Date(toDay.setDate(payperiod.end.getDate()-14))):(closureDay=new Date(closureDay.setDate(payperiod.closure.getDate()+14)),payrollReportClosure=new Date(payrollReportClosure.setDate(payperiod.payrollReportClosure.getDate()+14)),toDay=new Date(toDay.setDate(payperiod.end.getDate()+14))),fromDay=new Date(toDay),fromDay=new Date(fromDay.setDate(toDay.getDate()-13))):"semMonth"==type&&(fromDay=new Date(payperiod.start),closureDaySec=new Date(payperiod.closureSec),payrollReportClosureSec=new Date(payperiod.payrollReportClosureSec),toDaySec=new Date(payperiod.endSec),fromDaySec=new Date(payperiod.startSec),"1"==payperiod.pos&&-1==nav||0==payperiod.pos&&1==nav?obj.pos="1"==payperiod.pos?"0":"1":(nav<0?(toDaySec=32==payperiod.conf.rsSecToDay?new Date(toDaySec.getFullYear(),toDaySec.getMonth(),0):new Date(toDaySec.setMonth(toDaySec.getMonth()-1)),toDay=32==payperiod.conf.rsToDay?new Date(toDay.getFullYear(),toDay.getMonth(),0):new Date(toDay.setMonth(toDay.getMonth()-1)),fromDaySec=new Date(fromDaySec.setMonth(fromDaySec.getMonth()-1)),fromDay=new Date(fromDay.setMonth(fromDay.getMonth()-1)),closureDaySec=32==payperiod.conf.rsSecClosureDay?new Date(closureDaySec.getFullYear(),closureDaySec.getMonth(),0):new Date(closureDaySec.setMonth(closureDaySec.getMonth()-1)),closureDay=32==payperiod.conf.rsClosureDay?new Date(closureDay.getFullYear(),closureDay.getMonth(),0):new Date(closureDay.setMonth(closureDay.getMonth()-1)),payrollReportClosureSec=32==payperiod.conf.rsSecPayrollClosure?new Date(payrollReportClosureSec.getFullYear(),payrollReportClosureSec.getMonth(),0):new Date(payrollReportClosureSec.setMonth(payrollReportClosureSec.getMonth()-1)),payrollReportClosure=32==payperiod.conf.rsPayrollClosure?new Date(payrollReportClosure.getFullYear(),payrollReportClosure.getMonth(),0):new Date(payrollReportClosure.setMonth(payrollReportClosure.getMonth()-1)),obj.pos="1"):(toDaySec=32==payperiod.conf.rsSecToDay?new Date(toDaySec.getFullYear(),toDaySec.getMonth()+2,0):new Date(toDaySec.setMonth(toDaySec.getMonth()+1)),toDay=32==payperiod.conf.rsToDay?new Date(toDay.getFullYear(),toDay.getMonth()+2,0):new Date(toDay.setMonth(toDay.getMonth()+1)),fromDaySec=new Date(fromDaySec.setMonth(fromDaySec.getMonth()+1)),fromDay=new Date(fromDay.setMonth(fromDay.getMonth()+1)),closureDaySec=32==payperiod.conf.rsSecClosureDay?new Date(closureDaySec.getFullYear(),closureDaySec.getMonth()+2,0):new Date(closureDaySec.setMonth(closureDaySec.getMonth()+1)),closureDay=32==payperiod.conf.rsClosureDay?new Date(closureDay.getFullYear(),closureDay.getMonth()+2,0):new Date(closureDay.setMonth(closureDay.getMonth()+1)),payrollReportClosureSec=32==payperiod.conf.rsSecPayrollClosure?new Date(payrollReportClosureSec.getFullYear(),payrollReportClosureSec.getMonth()+2,0):new Date(payrollReportClosureSec.setMonth(payrollReportClosureSec.getMonth()+1)),payrollReportClosure=32==payperiod.conf.rsPayrollClosure?new Date(payrollReportClosure.getFullYear(),payrollReportClosure.getMonth()+2,0):new Date(payrollReportClosure.setMonth(payrollReportClosure.getMonth()+1)),obj.pos="0"),payperiod.conf.rsSecFromDay!=fromDaySec.getDate()&&2!=toDaySec.getMonth()&&(fromDaySec=new Date(fromDaySec.setMonth(toDaySec.getMonth()-1)),fromDaySec=new Date(fromDaySec.setDate(payperiod.conf.rsSecFromDay))),payperiod.conf.rsFromDay!=fromDay.getDate()&&2!=toDay.getMonth()&&(fromDay=new Date(fromDay.setMonth(toDay.getMonth()-1)),fromDay=new Date(fromDay.setDate(payperiod.conf.rsFromDay)))),obj.fromDaySec=obj.startSec=fromDaySec,obj.toDaySec=obj.endSec=toDaySec,obj.closureDaySec=obj.closureSec=closureDaySec,obj.payrollReportClosureSec=payrollReportClosureSec),obj.fromDay=obj.start=fromDay,obj.toDay=obj.end=toDay,obj.closure=obj.closureDay=closureDay,obj.payrollReportClosure=payrollReportClosure,obj}},Timetracker.reports.integrationReport=function(){"use strict";var selectedReportIndex,selectedReport,integListOptions,getIntegrationDtlsForReport,getIntegrationDtlsForReportCallback,setReportSelection,toggleViewButtons,getFormattedDate,reportGeneration,navigatePrevious,navigateNext,navigateToCurrent,calInfoTextChange,getReportLogs,getReportLogsParams,getReportLogsCallback,getExtraParamsForCorrespondinglogs,constructCorrespondinglogs;return{util:(integListOptions=new Array,getIntegrationDtlsForReport=function(){ZPeople.Request.send(Timetracker.constants.URL,{mode:"getIntegrationDtlsForReport",conreqcsr:csrfToken},getIntegrationDtlsForReportCallback)},getIntegrationDtlsForReportCallback=function(result){if(null!=result)if(0===(integListOptions=result).length)Timetracker.util.appendPermissionDenied();else{var integList="";for(var service in integListOptions)integList+='<option value="'+service+'">'+integListOptions[service]+" Report</option>";Timetracker.reports.integrationReport.isintegrationreportdetailfetched?reportGeneration(!1):(Layout.Page.container.find("#zp_select_ttinteglist").html(integList).select2({minimumResultsForSearch:1/0}),Layout.Page.container.find("#qbtimelog_infobar").show(),setReportSelection(),toggleViewButtons("qb_Report_weekview"),reportGeneration(!0,0))}else Timetracker.util.appendPermissionDenied()},setReportSelection=function(){selectedReportIndex=Layout.Page.container.find("#zp_select_ttinteglist").val(),selectedReport=integListOptions[selectedReportIndex]},toggleViewButtons=function(id){Layout.Page.container.find("button[toggle-type=cal_views]").removeClass("btn-primary").addClass("btn-default"),Layout.Page.container.find("#"+id).removeClass("btn-default").addClass("btn-primary")},reportGeneration=function(isLoad,prevnext){if(isLoad){Timetracker.initSetup(),Layout.Page.container.find("#qbrClientName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.clientDispName)),Layout.Page.container.find("#qbrprojectName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)),Layout.Page.container.find("#qbrjobName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.jobDispName));var filterparam=Timetracker.Filters.getParamsForFilter("integrationReport");isOrgStructureEnabled&&(Timetracker.Division.constructDivisionFilter("qbrDivisionName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.BusinessUnit.constructBusinessUnitFilter("qbrBusinessUnitName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.LegalEntity.constructLegalEntityFilter("qbrLegalEntityName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView)),Timetracker.Department.constructDepartmentFilter("qbrdepartmentname",filterparam,void 0,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Designation.constructDesignationFilter("qbrdesignationname",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Location.constructLocationFilter("qbrlocationname",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Filters.loadEmployeeType("qbrEmpType"),Timetracker.util.resetSelectInFilters("qbReportfilter",Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.clients.getClients("qbrClientName",null,null,!0,Layout.Page.container.find("#qbrUser").val(),Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#qbrUser").on("change",function(){"0"===(Layout.Page.container.find("#qbrUser").val()||"0")&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?(Layout.Page.container.find("#qbincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show(),Layout.Page.container.find("#qbincludeOnlyDirectSubordinates").prop("checked",!1)):(Layout.Page.container.find("#qbincludeOnlyDirectSubordinates").prop("checked",!1),Layout.Page.container.find("#qbincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide())}),ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?(Layout.Page.container.find("#qbincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show(),Layout.Page.container.find("#qbincludeOnlyDirectSubordinates").prop("checked",!1)):(Layout.Page.container.find("#qbincludeOnlyDirectSubordinates").prop("checked",!1),Layout.Page.container.find("#qbincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide()),Layout.Page.container.find("#qbrUser").on("change",function(){Timetracker.clients.getClients("qbrClientName",null,null,!0,Layout.Page.container.find("#qbrUser").val(),Timetracker.constants.TTCustomAdmin.ReportView)}),Timetracker.util.isFilterOpen("qbReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_integ_report_filter"),"qbReportfilter","qbradvanced"),Timetracker.util.setUserErecno();ZPeople.getUserDetailsById(Timetracker.timelogs.tserecno);var user=$("#qbrUser").val()||"0";Timetracker.projects.Filters.updateProjectListForFilters(!0,user,$("#qbrClientName").val(),"qbReportfilter",null,"0",void 0,Timetracker.constants.TTCustomAdmin.ReportView)}else ZPComponents.Search.Configuration.JSON.defaultOption=void 0;Timetracker.util.isFilterOpen("qbReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_integ_report_filter"),"qbReportfilter","qbradvanced"),-1===prevnext?navigatePrevious():1===prevnext?navigateNext():0===prevnext&&navigateToCurrent(),calInfoTextChange(),getReportLogs()},navigatePrevious=function(){"2"===Timetracker.reports.integrationReport.util.calview?Timetracker.reports.integrationReport.util.currentDate=Calendar.getPreviousMonth(Timetracker.reports.integrationReport.util.currentDate):"0"===Timetracker.reports.integrationReport.util.calview?Timetracker.reports.integrationReport.util.currentDate=Calendar.getPreviousDay(Timetracker.reports.integrationReport.util.currentDate):Timetracker.reports.integrationReport.util.currentDate=Calendar.getPreviousWeek(Timetracker.reports.integrationReport.util.currentDate)},navigateNext=function(){"2"===Timetracker.reports.integrationReport.util.calview?Timetracker.reports.integrationReport.util.currentDate=Calendar.getNextMonth(Timetracker.reports.integrationReport.util.currentDate):"0"===Timetracker.reports.integrationReport.util.calview?Timetracker.reports.integrationReport.util.currentDate=Calendar.getNextDay(Timetracker.reports.integrationReport.util.currentDate):Timetracker.reports.integrationReport.util.currentDate=Calendar.getNextWeek(Timetracker.reports.integrationReport.util.currentDate)},navigateToCurrent=function(){"2"===Timetracker.reports.integrationReport.util.calview?Timetracker.reports.integrationReport.util.currentDate=Calendar.getCurrentMonth():"0"===Timetracker.reports.integrationReport.util.calview?Timetracker.reports.integrationReport.util.currentDate=Calendar.getCurrentDay():Timetracker.reports.integrationReport.util.currentDate=Calendar.getCurrentWeek()},calInfoTextChange=function(){var calInfoDiv=Layout.Page.container.find("#qbcalInfo");calInfoDiv.removeClass("mon day week");var calinfo="";if("2"===Timetracker.reports.integrationReport.util.calview||"1"===Timetracker.reports.integrationReport.util.calview){var frommonth=Timetracker.reports.integrationReport.util.currentDate.from.getMonth(),startday=Timetracker.reports.integrationReport.util.currentDate.from.getDate(),tomonth=Timetracker.reports.integrationReport.util.currentDate.to.getMonth(),maxdays=Timetracker.reports.integrationReport.util.currentDate.to.getDate(),fromyear=Timetracker.reports.integrationReport.util.currentDate.from.getFullYear(),toyear=Timetracker.reports.integrationReport.util.currentDate.to.getFullYear();"2"===Timetracker.reports.integrationReport.util.calview?(calinfo=months[month]+" "+year,calInfoDiv.addClass("mon")):(calinfo=startday+" "+months[frommonth]+" "+fromyear+" - "+maxdays+" "+months[tomonth]+" "+toyear,calInfoDiv.addClass("week"))}else if("0"===Timetracker.reports.integrationReport.util.calview){var month=Timetracker.reports.integrationReport.util.currentDate.day.getMonth(),selday=Timetracker.reports.integrationReport.util.currentDate.day.getDate(),year=Timetracker.reports.integrationReport.util.currentDate.day.getFullYear();calinfo=selday+" "+months[month]+" "+year,calInfoDiv.addClass("day")}calInfoDiv.html(calinfo)},getReportLogs=function(){var jobId=Layout.Page.container.find("#qbrjobName").val()||"0",userErecNo=Layout.Page.container.find("#qbrUser").val()||"0",clientId=Layout.Page.container.find("#qbrClientName").val()||"0",projectId=Layout.Page.container.find("#qbrprojectName").val()||"0",billableStatus=Layout.Page.container.find("#qbrbillstatus").val(),locationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrlocationname").val());locationId="0"!=locationId?locationId.toString():locationId;var departmentId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrdepartmentname").val());departmentId="0"!=departmentId?departmentId.toString():departmentId;var designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrdesignationname").val());designationId="0"!=designationId?designationId.toString():designationId;var dateObj=getFormattedDate(),params={mode:"getIntegReportTimesheet",userErecNo:userErecNo,clientId:clientId,jobId:jobId,projectId:projectId,fromDate:dateObj.fromdate,toDate:dateObj.todate,approvalStatus:"1",billStatus:billableStatus,sIndex:0,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,conreqcsr:csrfToken,locationId:locationId,departmentId:departmentId,designationId:designationId};isOrgStructureEnabled&&(params.legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrLegalEntityName").val()),params.legalEntityId="0"!=params.legalEntityId?params.legalEntityId.toString():params.legalEntityId,params.businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrBusinessUnitName").val()),params.businessUnitId="0"!=params.businessUnitId?params.businessUnitId.toString():params.businessUnitId,params.divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrDivisionName").val()),params.divisionId="0"!=params.divisionId?params.divisionId.toString():params.divisionId),"0"===params.userErecNo&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?params.isDirectSubOnlyNeeded=Layout.Page.container.find("#qbincludeOnlyDirectSubordinates").is(":checked"):params.isDirectSubOnlyNeeded=!1,Timetracker.generalSettings.isBudgetEnabled()&&(params.employeeType=Layout.Page.container.find("#qbrEmpType").val()),getReportLogsParams(params),Timetracker.util.appendLoading(),ZPeople.Request.send(Timetracker.constants.URL,params,getReportLogsCallback),Timetracker.reports.integrationReport.isintegrationreportdetailfetched=!0,Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.INTEG_REPORT,Timetracker.constants.URL,params,Timetracker.reports.integrationReport.util.loadMoreDataInIntegReport)},getReportLogsParams=function(params){selectedReport===Timetracker.constants.integration.qb?params.service="quickBooks":selectedReport===Timetracker.constants.integration.zb?params.service="ZBooks":selectedReport===Timetracker.constants.integration.zi?params.service="ZInvoice":selectedReport===Timetracker.constants.integration.zprjct&&(params.service="Zoho Projects")},getReportLogsCallback=function(resultData){resultData&&!$.isEmptyObject(resultData)&&-1!==integListOptions.indexOf(selectedReport)?(selectedReport===Timetracker.constants.integration.qb?Timetracker.reports.integrationReport.quickBooks.constructReportView(resultData):Timetracker.reports.integrationReport.ZBooks.constructReportView(resultData,selectedReport),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.INTEG_REPORT,resultData)):(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.nodatafound"),{classname:"CR-nodata-rpt",path:"path6",type:"prepend"}),Layout.Page.container.find("#qb_list").hide(),Layout.Page.container.find("#qbtimesheetreport").html("").hide(),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.INTEG_REPORT,0)),Timetracker.util.removeLoading()},getExtraParamsForCorrespondinglogs=function(params){return selectedReport===Timetracker.constants.integration.qb?params.excludeJobWithProject=!0:selectedReport!==Timetracker.constants.integration.zb&&selectedReport!==Timetracker.constants.integration.zi||(params.excludeLogWith0Hours=!0),params},constructCorrespondinglogs=function(correspondinglogs,params,otherDetails){var userErecNo=otherDetails.userErecNo,obj=otherDetails.obj,event=otherDetails.event,txt="";0===correspondinglogs.length||""===correspondinglogs?txt='<tr><td colspan="5" style="text-align:center;">'+ZPI18N.getString("zp.nodatafound")+"</td></tr>":$.each(correspondinglogs,function(index,data){if(selectedReport===Timetracker.constants.integration.zprjct&&!data.employeeZuid)return!0;txt+="<tr ","0"===userErecNo&&(txt+="title="+data.employeename),txt+='><td width="30%">'+data.workDate+"</td>",data.jobName?txt+='<td width="30%">'+data.jobName+"</td>":txt+='<td width="30%">---</td>',data.taskName?txt+='<td width="30%">'+data.taskName+"</td>":txt+='<td width="30%">---</td>',0===data.billableStatus?txt+='<td width="25%">'+ZPI18N.getString("zp.billable")+"</td>":txt+='<td width="25%">'+ZPI18N.getString("zp.nonbillable")+"</td>",txt+='<td width="15%">'+Calendar.minstohrs(data.hours)+"</td></tr>"}),Layout.Page.container.find(".Scrcont:visible").find("#correspondinglogs").html(txt),Timetracker.util.setPopupPosition(obj,"showcorrespondingLogtime",event,!1,40),Layout.Page.container.find(".Scrcont:visible").find("#showcorrespondingLogtime").fadeIn(100)},{initialLoad:function(){Timetracker.initSetup(),Timetracker.util.isFilterOpen("qbReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_integ_report_filter"),"qbReportfilter","qbradvanced"),Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)?getIntegrationDtlsForReport():Timetracker.util.appendPermissionDenied()},changeReport:function(){setReportSelection(),reportGeneration(!1)},changeViews:function(isLoad,th){var id=$(th).attr("id");Timetracker.reports.integrationReport.util.calview="1","qb_Report_dayview"===id?Timetracker.reports.integrationReport.util.calview="0":"qb_Report_monthview"===id&&(Timetracker.reports.integrationReport.util.calview="2"),toggleViewButtons(id),reportGeneration(!1,0)},reportGeneration:reportGeneration,showCorrespondinglogs:function(obj,event,billtype,fromDate,toDate){if(event.stopPropagation(),0===Layout.Page.container.find(".Scrcont:visible").find("#showcorrespondingLogtime").length){var workitemDispName=Timetracker.util.workitemDispName,timelogDetailPopup='<div class="time-detail-pop lt gray W450 DN" id="showcorrespondingLogtime"><p class="FL">'+ZPI18N.getString("zp.timelogs")+'</p><i class="IC-cls CP red FR MR5 MT5" onclick="Layout.Page.container.find(\'.Scrcont:visible\').find(\'#showcorrespondingLogtime\').hide();"></i><table class="table popFxd-hd"><thead><tr><th width="30%">'+ZPI18N.getString("zp.date")+'</th><th width="30%">'+ZPI18N.getString("zp.jobname")+'</th><th width="30%" >'+workitemDispName+'</th><th width="25%">'+ZPI18N.getString("zp.billablestatus")+'<div style="width: 50px;"></div></th><th width="15%">'+ZPI18N.getString("zp.total")+'</th></tr></thead><tbody id="correspondinglogs"></tbody></table></div>';Layout.Page.container.find(".Scrcont:visible").append(timelogDetailPopup)}var correspondinglogs=$(obj).data().logsdata,rowData=$(obj).parent().parent().data().rowdata,userErecNo=rowData.ERECNO,otherDetails={userErecNo:userErecNo,obj:obj,event:event},params={mode:"getTimesheet",userErecNo:userErecNo,typeMode:billtype,jobId:rowData.JOBID,clientId:rowData.CLIENTID||"0",projectId:rowData.PROJECTID||"0",approvalStatus:"1",isRequestFromReport:!0,conreqcsr:csrfToken};void 0!==fromDate&&null!==fromDate&&(params.fromDate=fromDate),void 0!==toDate&&null!==toDate&&(params.toDate=toDate),Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)&&(params.viewEditPermissionType=Timetracker.constants.TTCustomAdmin.ReportView),selectedReport===Timetracker.constants.integration.zprjct&&(params.service=Timetracker.constants.integration.zprjct),void 0===correspondinglogs?ZPeople.Request.send(Timetracker.constants.URL,getExtraParamsForCorrespondinglogs(params),constructCorrespondinglogs,otherDetails):constructCorrespondinglogs(correspondinglogs,params,otherDetails)},getFormattedDate:getFormattedDate=function(){var fromsdate,tosdate,dateObj={};return"1"===Timetracker.reports.integrationReport.util.calview||"2"===Timetracker.reports.integrationReport.util.calview?(fromsdate=Timetracker.reports.integrationReport.util.currentDate.from,tosdate=Timetracker.reports.integrationReport.util.currentDate.to):(fromsdate=Timetracker.reports.integrationReport.util.currentDate.day,tosdate=Timetracker.reports.integrationReport.util.currentDate.day),dateObj.fromdate=Calendar.formatDate(fromsdate),dateObj.todate=Calendar.formatDate(tosdate),dateObj},loadMoreDataInIntegReport:function(resultData,params){var tbodyDOM=Layout.Page.container.find("#qbtimesheetreport"),fromsdate=params.fromDate,tosdate=params.toDate;resultData&&!$.isEmptyObject(resultData)&&-1!==integListOptions.indexOf(selectedReport)?(selectedReport===Timetracker.constants.integration.qb?$.each(resultData,function(index,data){tbodyDOM.append(Timetracker.reports.integrationReport.quickBooks.constructReportRow(data,fromsdate,tosdate))}):$.each(resultData,function(index,data){tbodyDOM.append(Timetracker.reports.integrationReport.ZBooks.constructReportRow(data,fromsdate,tosdate))}),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.INTEG_REPORT,resultData)):Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.INTEG_REPORT,0)},currentDate:void 0,calview:"1"})}}(),Timetracker.reports.integrationReport.ZBooks=function(){"use strict";var isAPICalled=!1,service="Zoho Books";function constructReportRow(data,fromsdate,tosdate){var txt="";txt+='<tr class="ZPLRow">';var clientName="---";void 0!==data.CLIENTNAME&&(clientName=data.CLIENTNAME);var projectName="---";void 0!==data.PROJECTNAME&&(projectName=data.PROJECTNAME),txt+='<td><img class="FL" src="'+data.EMPLOYEEPHOTO+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+data.EMPNAME+'"><b>'+data.EMPLOYEEID+"</b> "+data.EMPNAME+"</span></div></td>",txt+='<td><span class="ellipsis W150" title="'+clientName+'">'+clientName+"</span></td>",txt+='<td><span class="ellipsis W150" title="'+projectName+'">'+projectName+"</span></td>";var billStatus=Layout.Page.container.find("#qbrbillstatus").val(),pushedtime=data.pushedHrs||0,unpushedtime=data.unpushedHrs||0,totalapprovedhrs=data.totalHrs||0;txt+='<td><span class="ellipsis W150 CP" title="'+data.JOBNAME+'" onclick="Timetracker.reports.integrationReport.util.showCorrespondinglogs(this,event,\''+billStatus+"','"+fromsdate+"','"+tosdate+"');\">"+data.JOBNAME+"</span></td>";var totalhrs=Calendar.minstohrs(totalapprovedhrs),pushedhrs=Calendar.minstohrs(pushedtime),unpushedhrs=Calendar.minstohrs(unpushedtime);txt+="<td>"+totalhrs+"</td>";var isPushedAlready=data.isPushedAlready||!1;txt+='<td><button id="pushIcon_'+data.ERECNO+"_"+data.PROJECTID+'" class="btn btn-primary btn-sm popHover '+(isPushedAlready?"togg":"")+"\" data-popover=\"true\" data-html=\"true\" data-content=\"<ul><li class='ML10 MT5 MB5'><span class='S13'><i class='MR2 gry'></i> "+ZPI18N.getString("zp.tt.qbohourspushed")+" : "+pushedhrs+"</span></li><li class='ML10 MT5 MB5'><span class='S13'><i class='MR2 gry'></i> "+ZPI18N.getString("zp.tt.qbohoursunpushed")+" : "+unpushedhrs+'</span></li></ul>" onclick="Timetracker.reports.integrationReport.ZBooks.pushTimelogs(this,\''+billStatus+"',"+isPushedAlready+')">'+service+"</button></td>",txt+="<td></td>",txt+="</tr>";var yTxt=$(txt);return yTxt.data({rowdata:data}),yTxt}return{constructReportView:function(resultData,servicename){service=servicename;var docFrag=document.createDocumentFragment(),dateObj=Timetracker.reports.integrationReport.util.getFormattedDate(),fromsdate=dateObj.fromdate,tosdate=dateObj.todate;$.each(resultData,function(index,data){docFrag.appendChild(constructReportRow(data,fromsdate,tosdate)[0])}),Layout.Page.container.find("#qbtimesheetreport").html(docFrag),Layout.Page.parentContainer.find("[scroll=enabled]").scrollTop(0),Layout.Page.container.find("#zp_empty_data").hide(),Layout.Page.container.find("#qb_list").show(),Layout.Page.container.find("#qbtimesheetreport").show(),Layout.Page.container.popover({selector:"[data-popover].popHover",trigger:"click hover",placement:function(context,th){var pos=$(th).offset(),height=$(th).height(),pos1=$("#qb_list").offset(),height1=$("#qb_list").height();return pos1.top+height1-(pos.top+height)<50?"top":"bottom"}})},constructReportRow:constructReportRow,pushTimelogs:function(th,billStatus,isPushedAlready){if(isPushedAlready)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.zbtimelogpushedalready")),!1;if(isAPICalled)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.zbtimelogbeingpushed",service));else{isAPICalled=!0;var rowData=$(th).parent().parent().data().rowdata,userErecNo=rowData.ERECNO||"0",jobId=rowData.JOBID||"0",clientId=rowData.CLIENTID||"0",projectId=rowData.PROJECTID||"0",dateObj=Timetracker.reports.integrationReport.util.getFormattedDate(),fromdate=dateObj.fromdate,todate=dateObj.todate,jobstatus=Layout.Page.container.find("#qbrjobstatus").val(),params={mode:"pushTimelogsToOtherService",userErecNo:userErecNo,service:service,clientId:clientId,projectId:projectId,jobId:jobId,fromDate:fromdate,toDate:todate,jobStatus:jobstatus,billStatus:billStatus,conreqcsr:csrfToken};if(service===Timetracker.constants.integration.zprjct){isAPICalled=!1;var objID="#pushIcon_"+rowData.ERECNO+"_"+rowData.PROJECTID;if(rowData.PORTALID)rowData.PORTALID&&rowData.REFERENCEID&&(params.zProjectsPortalId=rowData.PORTALID,params.projectReferenceId=rowData.REFERENCEID,Timetracker.ZOHOPROJECTS.pushTimelogsToZProjects(params,objID));else{var modalParams={integReportParams:params,objID:objID};Timetracker.ZOHOPROJECTS.showSyncModal(modalParams)}}else Timetracker.util.appendLoading(),$.post(Timetracker.constants.URL,params,function(result){isAPICalled=!1,null!=result&&result.message?result.isSuccess?(Timetracker.util.showAlert(2,result.message),Timetracker.reports.integrationReport.util.reportGeneration(!1)):(Timetracker.util.showAlert(0,result.message),result.isReload&&!0===result.isReload&&Timetracker.reports.integrationReport.util.reportGeneration(!1)):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg")),Timetracker.util.removeLoading()})}}}}(),Timetracker.reports.integrationReport.quickBooks=function(){"use strict";var USER_POPUPDETAIL_INTERVAl,isAPICalled=!1,constructReportRow=function(data,fromsdate,tosdate){var txt="";txt+='<tr class="ZPLRow">';var clientName="---";void 0!==data.CLIENTNAME&&(clientName=data.CLIENTNAME);var projectName="---";void 0!==data.PROJECTNAME&&(projectName=data.PROJECTNAME),txt+='<td><img class="FL" src="'+data.EMPLOYEEPHOTO+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+data.EMPNAME+'"><b>'+data.EMPLOYEEID+"</b> "+data.EMPNAME+"</span></div></td>",txt+='<td><span class="ellipsis W150" title="'+clientName+'">'+clientName+"</span></td>",txt+='<td><span class="ellipsis W150" title="'+projectName+'">'+projectName+"</span></td>";var billStatus=Layout.Page.container.find("#qbrbillstatus").val(),pushedtime=data.pushedHrs||0,unpushedtime=data.unpushedHrs||0,totalapprovedhrs=data.totalHrs||0;txt+='<td><span class="ellipsis W150 CP" title="'+data.JOBNAME+'" onclick="Timetracker.reports.integrationReport.util.showCorrespondinglogs(this,event,\''+billStatus+"','"+fromsdate+"','"+tosdate+"');\">"+data.JOBNAME+"</span></td>";var totalhrs=Calendar.minstohrs(totalapprovedhrs),pushedhrs=Calendar.minstohrs(pushedtime),unpushedhrs=Calendar.minstohrs(unpushedtime);txt+="<td>"+totalhrs+"</td>";var qbcls="SP-qbooks",ispushedAlready=!1;0!==unpushedtime&&"0"!==unpushedtime||(ispushedAlready=!0,qbcls="SP-qbooks ZPInact"),txt+='<td><i onmouseleave="Timetracker.reports.integrationReport.quickBooks.hideDetPopup(this)" onmouseenter="Timetracker.reports.integrationReport.quickBooks.showDetPopup(this,\''+pushedhrs+"','"+unpushedhrs+'\')" class="'+qbcls+'" data-toggle="tooltip" onclick="Timetracker.reports.integrationReport.quickBooks.pushTimelogs(this,\''+billStatus+"',"+ispushedAlready+')"></i></td>',txt+="<td></td>",txt+="</tr>";var yTxt=$(txt);return yTxt.data({rowdata:data}),yTxt},reportDetPopup=function(pushed,unpushed,isBottom){if(isBottom)var pop='<ul id="reportPopup" class="dropdown-menu ZPCmn-Arrow bottom rt gray" style="display:block;">';else pop='<ul id="reportPopup" class="dropdown-menu ZPCmn-Arrow top rt gray" style="display:block;">';return pop+='<li class="ML10 MT5 MB5">',pop+='<span class="S12">'+ZPI18N.getString("zp.tt.qbopushedastimeact")+"</span>",pop+="</li>",pop+='<li class="ML10 MT5 MB5">',pop+='<span class="S13"><i class="MR2 gry"></i> '+ZPI18N.getString("zp.tt.qbohourspushed")+" : "+pushed+"</span>",pop+="</li>",pop+='<li class="ML10 MT5 MB5">',pop+='<span class="S13"><i class="MR2 gry"></i> '+ZPI18N.getString("zp.tt.qbohoursunpushed")+" : "+unpushed+"</span>",pop+="</li>",pop+="</ul>"};return{constructReportView:function(resultData){var docFrag=document.createDocumentFragment(),dateObj=Timetracker.reports.integrationReport.util.getFormattedDate(),fromsdate=dateObj.fromdate,tosdate=dateObj.todate;$.each(resultData,function(index,data){docFrag.appendChild(constructReportRow(data,fromsdate,tosdate)[0])}),Layout.Page.container.find("#qbtimesheetreport").html(docFrag),Layout.Page.parentContainer.find("[scroll=enabled]").scrollTop(0),Layout.Page.container.find("#zp_empty_data").hide(),Layout.Page.container.find("#qb_list").show(),Layout.Page.container.find("#qbtimesheetreport").show()},constructReportRow:constructReportRow,hideDetPopup:function(th){null!==USER_POPUPDETAIL_INTERVAl&&($("#reportPopup").remove(),clearInterval(USER_POPUPDETAIL_INTERVAl))},showDetPopup:function(th,pushed,unpushed){USER_POPUPDETAIL_INTERVAl=setInterval(function(){if(!$("#reportPopup").length){var pos=$(th).offset(),height=$(th).height(),pos1=$("#qb_list").offset(),height1=$("#qb_list").height();if(pos1.top+height1-(pos.top+height)<50)var popUp=$(reportDetPopup(pushed,unpushed,!0));else popUp=$(reportDetPopup(pushed,unpushed));$("body").append(popUp);var popwidth=popUp.width(),popheight=popUp.height();pos1.top+height1-(pos.top+height)<50?popUp.css({top:pos.top-popheight-height-5,left:pos.left-popwidth+40}):popUp.css({top:pos.top+height+10,left:pos.left-popwidth+40})}},1e3)},pushTimelogs:function(th,billStatus,isPushedAlready){if(isPushedAlready)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.tt.qbotimesheetpushedalready")),!1;if(isAPICalled)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.tt.qbotimesheetebeingpushed"));else{isAPICalled=!0,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.tt.qbotimesheetebeingpushed"));var rowData=$(th).parent().parent().data().rowdata,userErecNo=rowData.ERECNO,jobId=rowData.jobId,clientId=rowData.CLIENTID||"0",projectId=rowData.PROJECTID||"0",dateObj=Timetracker.reports.integrationReport.util.getFormattedDate(),params={jobId:jobId,fromDate:dateObj.fromdate,toDate:dateObj.todate,erecno:userErecNo,clientId:clientId,projectId:projectId,jobStatus:Layout.Page.container.find("#qbrjobstatus").val(),billStatus:billStatus,conreqcsr:csrfToken};$.post("/quickbooks/pushReportTimeActivityToQBO",params,function(resultData){isAPICalled=!1,resultData.qboResponse&&(resultData.qboResponse.msg&&"success"==resultData.qboResponse.msg?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.tt.qbotimesheetsuccessful")),Timetracker.reports.integrationReport.util.reportGeneration(!1)):resultData.qboResponse.msg&&"failed"==resultData.qboResponse.msg&&resultData.qboResponse.errmsg?ZPeople.Message.showFailureMsg(resultData.qboResponse.errmsg):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.tt.qbotimesheetfail")))})}}}}(),Timetracker.reports.userLogHoursReport={params:void 0,currentMode:Timetracker.util.WEEKLY,currentReportDate:null,init:function(){if(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)){if(void 0===Timetracker.reports.userLogHoursReport.params){Layout.Page.container.find("#logPeriod").val("1").select2({minimumResultsForSearch:1/0}),Layout.Page.container.find("#logHoursValue").val("0").select2({minimumResultsForSearch:1/0}),Layout.Page.container.find("#logApprovalstatus").select2(Timetracker.select2.getSelect2Properties(!1,{multipleSelections:!0})),Layout.Page.container.find("#sortByEmployeeName").removeClass("sort-u sort-d").addClass("sort-u"),Layout.Page.container.find("#sortByEmployeeName").attr("title",ZPI18N.getString("zp.sortbydesc")),Layout.Page.container.find("#sortByTotalHours,#sortByReportingToName").removeClass("sort-u sort-d"),Layout.Page.container.find("#userLogHoursReportEmpStatus").select2({minimumResultsForSearch:1/0});var filterparam=Timetracker.Filters.getParamsForFilter("UserLogHoursReport");isOrgStructureEnabled&&(Timetracker.Division.constructDivisionFilter("userLogHoursReportDivision",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.BusinessUnit.constructBusinessUnitFilter("userLogHoursReportBusinessUnit",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.LegalEntity.constructLegalEntityFilter("userLogHoursReportLegalEntity",filterparam,Timetracker.constants.TTCustomAdmin.ReportView)),Layout.Page.container.find("#userLogHoursReportEmpStatus").on("change",function(){var empStatus=Layout.Page.container.find("#userLogHoursReportEmpStatus").val();null!=empStatus&&-1!==empStatus.toString().indexOf("18")?Layout.Page.container.find("#userLogHoursReportemployeeDateOfExitBased").parents(".dateOfExit").is(":visible")||(Layout.Page.container.find("#userLogHoursReportemployeeDateOfExitBased").parents(".dateOfExit").show(),Layout.Page.container.find("#userLogHoursReportemployeeDateOfExitBased").prop("checked",!0)):(Layout.Page.container.find("#userLogHoursReportemployeeDateOfExitBased").prop("checked",!1),Layout.Page.container.find("#userLogHoursReportemployeeDateOfExitBased").parents(".dateOfExit").hide())}),Timetracker.Department.constructDepartmentFilter("userLogHoursReportDepartment",filterparam,"0",Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Location.constructLocationFilter("userLogHoursReportLocation",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Designation.constructDesignationFilter("userLogHoursReportDesignation",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#userLogHoursReportEmpStatus").select2("val",["19","-2","18"]).trigger("change"),Layout.Page.container.find("#includeusersWithoutTimelogs").prop("checked",!0),Layout.Page.container.find("#logPeriod").off("change").on("change",function(){"6"===$(this).val()?Layout.Page.container.find("#customPeriodDiv").removeClass("DNI"):Layout.Page.container.find("#customPeriodDiv").addClass("DNI")}),Layout.Page.container.find("#logHoursValue").off("change").on("change",function(){"0"===$(this).val()||"1"===$(this).val()?Layout.Page.container.find("#checkBoxLabel").removeClass("DNI"):Layout.Page.container.find("#checkBoxLabel").addClass("DNI"),"1"===$(this).val()||"2"===$(this).val()||"3"===$(this).val()?Layout.Page.container.find("#hoursTxtBox").removeClass("DNI"):Layout.Page.container.find("#hoursTxtBox").addClass("DNI"),"4"===$(this).val()?(Layout.Page.container.find("#logApprovalstatus").select2("val",null),Layout.Page.container.find("#logApprovalstatus").attr("disabled",!0)):Layout.Page.container.find("#logApprovalstatus").attr("disabled",!1)}),Layout.Page.container.find("#hoursTxtBox").off("keyup").on("keyup",function(){$(this).val()||$(this).val().match(Timetracker.util.maxhrsRegex)?$(this).removeClass("error-clr"):$(this).addClass("error-clr")}),Layout.Page.container.find("#sortByEmployeeName").off("click").on("click",function(){$(this).hasClass("sort-u")?($(this).removeClass("sort-u").addClass("sort-d"),$(this).attr("title",ZPI18N.getString("zp.sortbyasc"))):($(this).removeClass("sort-d").addClass("sort-u"),$(this).attr("title",ZPI18N.getString("zp.sortbydesc"))),Layout.Page.container.find("#sortByTotalHours,#sortByReportingToName").removeClass("sort-d sort-u"),Layout.Page.container.find("#sortByTotalHours,#sortByReportingToName").attr("title",""),Timetracker.reports.userLogHoursReport.generateUserLogHoursReport(!1)}),Layout.Page.container.find("#sortByReportingToName").off("click").on("click",function(){$(this).hasClass("sort-u")?($(this).removeClass("sort-u").addClass("sort-d"),$(this).attr("title",ZPI18N.getString("zp.sortbyasc"))):($(this).removeClass("sort-d").addClass("sort-u"),$(this).attr("title",ZPI18N.getString("zp.sortbydesc"))),Layout.Page.container.find("#sortByTotalHours,#sortByEmployeeName").removeClass("sort-d sort-u"),Layout.Page.container.find("#sortByTotalHours,#sortByEmployeeName").attr("title",""),Timetracker.reports.userLogHoursReport.generateUserLogHoursReport(!1)}),Layout.Page.container.find("#sortByTotalHours").off("click").on("click",function(){$(this).hasClass("sort-u")?($(this).removeClass("sort-u").addClass("sort-d"),$(this).attr("title",ZPI18N.getString("zp.sortbyasc"))):($(this).removeClass("sort-d").addClass("sort-u"),$(this).attr("title",ZPI18N.getString("zp.sortbydesc"))),Layout.Page.container.find("#sortByEmployeeName,#sortByReportingToName").removeClass("sort-d sort-u"),Layout.Page.container.find("#sortByEmployeeName,#sortByReportingToName").attr("title",""),Timetracker.reports.userLogHoursReport.generateUserLogHoursReport(!1)})}Timetracker.util.isFilterOpen("userLogHoursReportFilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_user_loghours_report_filter"),"userLogHoursReportFilter"),Timetracker.reports.userLogHoursReport.setPreviousFilterParams(),Timetracker.reports.userLogHoursReport.generateUserLogHoursReport(!1)}else Timetracker.util.appendPermissionDenied()},generateUserLogHoursReport:function(isFromNavigation,isFromFilter){if(Layout.Page.container.find(".ERR").remove(),isFromNavigation||Timetracker.reports.userLogHoursReport.setViewType(),!isFromFilter&&"6"==Layout.Page.container.find("#logPeriod").val()){var fromDate=Layout.Page.container.find("#custom_fromdate").val().trim(),toDate=Layout.Page.container.find("#custom_todate").val().trim();if(""==fromDate.trim()&&""==toDate.trim()){var defaultVeiw=Timetracker.generalSettings.getDefaultViewType();Layout.Page.container.find("#logPeriod").val(defaultVeiw).select2(),Layout.Page.container.find("#customPeriodDiv").addClass("DNI"),Timetracker.reports.userLogHoursReport.setViewType()}}var params=Timetracker.Filters.getAndValidateParams(Timetracker.constants.FILTERS.USERLOGHOURSREPORT);if(params.sIndex=0,params.limit=25,void 0!==params.hours){if(""===params.hours.trim()||!Timetracker.util.maxhrsRegex.test(params.hours))return void Layout.Page.container.find("#hoursTxtBox").addClass("error-clr");Layout.Page.container.find("#hoursTxtBox").removeClass("error-clr")}else Layout.Page.container.find("#hoursTxtBox").removeClass("error-clr");var isErrorOccured=!1;""!==params.fromDate.trim()&&Calendar.isvalidDate(params.fromDate)||(Layout.Page.container.find("#customFromDate").append('<div class="ERR MB10I MT5I">'+ZPI18N.getString("zp.invaliddate")+"</div>"),isErrorOccured=!0),""!==params.toDate.trim()&&Calendar.isvalidDate(params.toDate)||(Layout.Page.container.find("#customToDate").append('<div class="ERR MB10I MT5I">'+ZPI18N.getString("zp.invaliddate")+"</div>"),isErrorOccured=!0);var fdate=Calendar.parseDate(params.fromDate,uidateFormat),tdate=Calendar.parseDate(params.toDate,uidateFormat);fdate>tdate?(Layout.Page.container.find("#customToDate").append('<div class="ERR MB10I MT5I">'+ZPI18N.getString("zp.greaterfromdate")+"</div>"),isErrorOccured=!0):Timetracker.DateTime.getDateDiff(fdate,tdate)>31&&(Layout.Page.container.find("#customToDate").append('<div class="ERR MB10I MT5I">'+ZPI18N.getString("zp.datewithindays",[31])+"</div>"),isErrorOccured=!0);isErrorOccured?Timetracker.util.isFilterOpen("userLogHoursReportFilter")||Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_user_loghours_report_filter"),"userLogHoursReportFilter"):(Timetracker.util.isFilterOpen("userLogHoursReportFilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_user_loghours_report_filter"),"userLogHoursReportFilter"),Layout.Page.container.find("#userLogHoursList").off("scroll").scrollTop(0),Layout.Page.container.find("#userLogHoursList").find("#tableBody").html(""),Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.MODES.USERLOGHOURS_REPORT),Timetracker.util.removeEmptyData(),Timetracker.util.appendLoading(),Timetracker.reports.userLogHoursReport.params=params,ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){Timetracker.util.removeLoading();var resObj={},repObj={};1===response.res&&(resObj=response.resObj.data,repObj=response.resObj.reportingToDtls),0===Object.keys(resObj).length?(Layout.Page.container.find("#userLogHoursList").fadeOut(200),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6"})):(Timetracker.reports.userLogHoursReport.constructReport(resObj,repObj),Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.USERLOGHOURS_REPORT,Timetracker.constants.URL,params,Timetracker.reports.userLogHoursReport.loadMoreData),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.USERLOGHOURS_REPORT,resObj),Layout.Page.container.find("#userLogHoursList").fadeIn(200),Layout.Page.container.find("#zp_empty_data").fadeOut(200)),ZPView.handleTablePosition()}))},loadMoreData:function(response,params){var resObj=1===response.res?response.resObj.data:{},repObj=1===response.res?response.resObj.reportingToDtls:{};Timetracker.reports.userLogHoursReport.constructReport(resObj,repObj),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.USERLOGHOURS_REPORT,resObj)},setViewType:function(){switch(Layout.Page.container.find("#logPeriod").val()){case"0":Timetracker.reports.userLogHoursReport.currentReportDate=Calendar.getCurrentDay(),Timetracker.reports.userLogHoursReport.currentMode=Timetracker.util.DAILY;break;case"1":Timetracker.reports.userLogHoursReport.currentReportDate=Calendar.getCurrentWeek(),Timetracker.reports.userLogHoursReport.currentMode=Timetracker.util.WEEKLY;break;case"2":Timetracker.reports.userLogHoursReport.currentReportDate=Calendar.getCurrentMonth(),Timetracker.reports.userLogHoursReport.currentMode=Timetracker.util.MONTHLY;break;case"3":Timetracker.reports.userLogHoursReport.currentReportDate=Calendar.getCurrentDay(),Timetracker.reports.userLogHoursReport.currentReportDate=Calendar.getPreviousDay(Timetracker.reports.userLogHoursReport.currentReportDate),Timetracker.reports.userLogHoursReport.currentMode=Timetracker.util.DAILY;break;case"4":Timetracker.reports.userLogHoursReport.currentReportDate=Calendar.getCurrentWeek(),Timetracker.reports.userLogHoursReport.currentReportDate=Calendar.getPreviousWeek(Timetracker.reports.userLogHoursReport.currentReportDate),Timetracker.reports.userLogHoursReport.currentMode=Timetracker.util.WEEKLY;break;case"5":Timetracker.reports.userLogHoursReport.currentReportDate=Calendar.getCurrentMonth(),Timetracker.reports.userLogHoursReport.currentReportDate=Calendar.getPreviousMonth(Timetracker.reports.userLogHoursReport.currentReportDate),Timetracker.reports.userLogHoursReport.currentMode=Timetracker.util.MONTHLY;break;case"6":Timetracker.reports.userLogHoursReport.currentMode=Timetracker.util.CUSTOM}Timetracker.reports.userLogHoursReport.setDateValuesInNavigator()},navigateDate:function(isPrevious){switch(Timetracker.reports.userLogHoursReport.currentMode){case Timetracker.util.DAILY:Timetracker.reports.userLogHoursReport.currentReportDate=isPrevious?Calendar.getPreviousDay(Timetracker.reports.userLogHoursReport.currentReportDate):Calendar.getNextDay(Timetracker.reports.userLogHoursReport.currentReportDate);break;case Timetracker.util.WEEKLY:Timetracker.reports.userLogHoursReport.currentReportDate=isPrevious?Calendar.getPreviousWeek(Timetracker.reports.userLogHoursReport.currentReportDate):Calendar.getNextWeek(Timetracker.reports.userLogHoursReport.currentReportDate);break;case Timetracker.util.MONTHLY:Timetracker.reports.userLogHoursReport.currentReportDate=isPrevious?Calendar.getPreviousMonth(Timetracker.reports.userLogHoursReport.currentReportDate):Calendar.getNextMonth(Timetracker.reports.userLogHoursReport.currentReportDate)}Timetracker.reports.userLogHoursReport.setDateValuesInNavigator(),Timetracker.reports.userLogHoursReport.generateUserLogHoursReport(!0)},setDateValuesInNavigator:function(){var element=Layout.Page.container.find("#userLogHoursReportPeriod");Timetracker.reports.userLogHoursReport.currentMode===Timetracker.util.DAILY?(Layout.Page.container.find("#userLogHoursReportPeriodNavigator").removeClass("DN"),element.removeClass("wek mon").addClass("day"),element.html(Timetracker.timelogs.getDateinTSformat(Timetracker.reports.userLogHoursReport.currentReportDate.day))):Timetracker.reports.userLogHoursReport.currentMode===Timetracker.util.WEEKLY?(Layout.Page.container.find("#userLogHoursReportPeriodNavigator").removeClass("DN"),element.removeClass("day mon").addClass("wek"),element.html(Timetracker.timelogs.getDateinTSformat(Timetracker.reports.userLogHoursReport.currentReportDate.from)+" - "+Timetracker.timelogs.getDateinTSformat(Timetracker.reports.userLogHoursReport.currentReportDate.to))):Timetracker.reports.userLogHoursReport.currentMode===Timetracker.util.MONTHLY?(Layout.Page.container.find("#userLogHoursReportPeriodNavigator").removeClass("DN"),element.removeClass("day wek").addClass("mon"),element.html(months[Timetracker.reports.userLogHoursReport.currentReportDate.from.getMonth()]+" "+Timetracker.reports.userLogHoursReport.currentReportDate.from.getFullYear())):Timetracker.reports.userLogHoursReport.currentMode===Timetracker.util.CUSTOM&&Layout.Page.container.find("#userLogHoursReportPeriodNavigator").addClass("DN")},setPreviousFilterParams:function(){if(void 0!==Timetracker.reports.userLogHoursReport.params){if(void 0!==Timetracker.reports.userLogHoursReport.params.hoursComparator&&Layout.Page.container.find("#logHoursValue").select2("val",Timetracker.reports.userLogHoursReport.params.hoursComparator).trigger("change"),void 0!==Timetracker.reports.userLogHoursReport.params.hours&&Layout.Page.container.find("#hoursTxtBox").val(Timetracker.reports.userLogHoursReport.params.hours),Timetracker.util.checkIsParamNotEmpty(Timetracker.reports.userLogHoursReport.params.departmentId)){var departments=Timetracker.reports.userLogHoursReport.params.departmentId.split(",");Layout.Page.container.find("#userLogHoursReportDepartment").select2("val",departments)}else Layout.Page.container.find("#userLogHoursReportDepartment").select2("val",null);if(Timetracker.util.checkIsParamNotEmpty(Timetracker.reports.userLogHoursReport.params.locationId)){var locations=Timetracker.reports.userLogHoursReport.params.locationId.split(",");Layout.Page.container.find("#userLogHoursReportLocation").select2("val",locations)}else Layout.Page.container.find("#userLogHoursReportLocation").select2("val",null)}},constructReport:function(response,reportingToData){var container=Layout.Page.container.find("#userLogHoursList").find("#tableBody");if(null!=response&&void 0!=response&&0!==response.length)for(var i=0;i<response.length;i++){var html='<tr class="ZPLRow"><td class="P_AM"><div class="ZPusrName W300"><img class="FL" src="'+response[i].employeePhoto+'"><span class="usrDts"><span class="usrEmpID">'+response[i].employeeId+" - </span> "+response[i].employeeName+"</span>";response[i].empDateOfExit&&(html+='<em class="ZPsecName">( '+ZPI18N.getString("zp.exitdate")+"-"+response[i].empDateOfExit+")</em>"),html+='</div></td><td class="P_AM"><div class="ZPusrName W300">',response[i].reportingto_Erecno?html+='<img class="FL" src="'+reportingToData[response[i].reportingto_Erecno].reporting_Photo+'"><span class="usrDts"><span class="usrEmpID">'+reportingToData[response[i].reportingto_Erecno].reportingTo_empId+" - </span> "+reportingToData[response[i].reportingto_Erecno].reportingTo_Name+"</span>":html+="-",html+="</div></td><td>"+Calendar.minstohrs(response[i].billableHours)+"</td><td>"+Calendar.minstohrs(response[i].nonBillableHours)+"</td>",Timetracker.generalSettings.isBreakEnabled()&&(html+="<td>"+Calendar.minstohrs(response[i].paidBreakHours)+"</td>",html+="<td>"+Calendar.minstohrs(response[i].nonPaidBreakHours)+"</td>"),html+="<td>"+Calendar.minstohrs(response[i].totalHours)+"</td></tr>",container.append(html)}},exportUserLogHoursReport:function(mode,params,downloadType){if(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)){if(downloadType){params=Timetracker.reports.userLogHoursReport.params;var form=Layout.Page.container.find("#userLogHours_download");form.attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheetDispAction.zp?mode=exportUserLogHoursReport"),form.find("#userloghours_fromDate").val(params.fromDate),form.find("#userloghours_toDate").val(params.toDate),form.find("#userloghours_legalEntityId").val(params.legalEntityId),form.find("#userloghours_businessUnitId").val(params.businessUnitId),form.find("#userloghours_divisionId").val(params.divisionId),form.find("#userloghours_locationId").val(params.locationId),form.find("#userloghours_departmentId").val(params.departmentId),form.find("#userloghours_designationId").val(params.designationId),form.find("#userloghours_hoursComparator").val(params.hoursComparator),form.find("#userloghours_hours").val(params.hours),form.find("#userloghours_includeUsersWithoutTimelogs").val(params.includeUsersWithoutTimelogs),form.find("#userloghours_employeeDateOfExitBased").val(params.employeeDateOfExitBased),form.find("#userloghours_approvalStatus").val(params.approvalStatus),form.find("#userloghours_sortType").val(params.sortType),form.find("#userloghours_empStatus").val(params.employeeStatus),form.find("#userloghours_isAscending").val(params.isAscending),form.find("#userloghours_fileType").val(downloadType),form.find("#userloghours_csrfToken").val(csrfToken),"pdf"!=downloadType?Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!1):Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!0),form.trigger("submit")}}else Timetracker.util.appendPermissionDenied()}},Timetracker.reports.jobReport={FETECHED_COUNT:0,MAX_FETCH_COUNT:25,CHART_EXTREME_MAX:9,isjobreportdatafetched:!1,generatejobReport:function(isLoad,params,downloadType){void 0===isLoad&&(Timetracker.initSetup(),Layout.Page.container.find("#jrClientName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.clientDispName)),Layout.Page.container.find("#jrprojectName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)),Layout.Page.container.find("#jrjobName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.jobDispName)),Timetracker.reports.jobReport.isjobreportdatafetched||(Timetracker.clients.getClients("jrClientName",null,null,!0,erecno,Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#jrUser").on("change",function(){Timetracker.clients.getClients("jrClientName",null,null,!0,Layout.Page.container.find("#jrUser").val()||"0",Timetracker.constants.TTCustomAdmin.ReportView)}),Layout.Page.container.find("#jrEmpStatus").select2("val",["19","-2","18"]),Layout.Page.container.find("#jrUser").on("change",function(){"0"===(Layout.Page.container.find("#jrUser").val()||"0")&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?Layout.Page.container.find("#jrincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show():Layout.Page.container.find("#jrincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide()}),Timetracker.Filters.loadEmployeeType("jrEmpType"),Timetracker.util.resetSelectInFilters("jobReportfilter",Timetracker.constants.TTCustomAdmin.ReportView)),Timetracker.reports.jobReport.isjobreportdatafetched||Timetracker.projects.Filters.updateProjectListForFilters(!0,Timetracker.timelogs.tserecno,$("#jrClientName").val(),"jobReport",$("#jrjobstatus").val(),"0",void 0,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.util.isFilterOpen("jobReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_job_report_filter"),"jobReportfilter","jradvanced"),Layout.Page.container.find("#zp_empty_data,#job_charts,#jobreportlist,#jobreportdiv_charts,#jobreportdiv_list").hide(),Layout.Page.container.find("#job_Report_Chart").addClass("btn-primary").removeClass("btn-default").siblings().removeClass("btn-primary").addClass("btn-default")),Layout.Page.container.find("#jrjobstatus,#jrbillstatus,#jrApprovalstatus,#jrUnApprovalstatus,#jrEmpType").select2({minimumResultsForSearch:1/0}),Layout.Page.container.find("#showcorrespondingLogtime").hide();var filterparams=Timetracker.Filters.getParamsForFilter("JOBREPORT");Timetracker.reports.jobReport.isjobreportdatafetched||(isOrgStructureEnabled&&(Timetracker.Division.constructDivisionFilter("jrDivisionName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.BusinessUnit.constructBusinessUnitFilter("jrBusinessUnitName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.LegalEntity.constructLegalEntityFilter("jrLegalEntityName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView)),Timetracker.Designation.constructDesignationFilter("jrDesignationName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Department.constructDepartmentFilter("jrDepartmentName",filterparams,void 0,Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#jrDepartmentName").val("0").select2(Timetracker.select2.getSelect2Properties(!1,{multipleSelections:!0})),Timetracker.Location.constructLocationFilter("jrLocationName",filterparams,Timetracker.constants.TTCustomAdmin.ReportView));params=Timetracker.Filters.getAndValidateParams("JOBREPORT");if(void 0!==downloadType){var form=Layout.Page.container.find("#downloadjobpdf");Layout.Page.container.find("#downloadjobpdf").attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheetDispAction.zp?mode=exportJobReport"),Layout.Page.container.find("#jobpdfidentity").val(csrfToken),Layout.Page.container.find("#jobpdfuserErecNo").val(params.userErecNo),Layout.Page.container.find("#jobpdfempStatus").val(params.employeeStatus),Layout.Page.container.find("#jobpdfemployeeType").val(params.employeeType?params.employeeType:"0"),Layout.Page.container.find("#jobpdfbillStatus").val(params.billStatus),Layout.Page.container.find("#jobpdfapprovalStatus").val(params.approvalStatus),Layout.Page.container.find("#jobpdfjobStatus").val(params.jobStatus),Layout.Page.container.find("#jobpdfjobId").val(params.jobId),Layout.Page.container.find("#jobpdfclientId").val(params.clientId),Layout.Page.container.find("#jobpdfprojectId").val(params.projectId),Layout.Page.container.find("#jobpdflegalEntityId").val(params.legalEntityId),Layout.Page.container.find("#jobpdfbusinessUnitId").val(params.businessUnitId),Layout.Page.container.find("#jobpdfisDirectSubOnlyNeeded").val(params.isDirectSubOnlyNeeded),Layout.Page.container.find("#jobpdfdivisionId").val(params.divisionId),Layout.Page.container.find("#jobpdfdeptId").val(params.deptId),Layout.Page.container.find("#jobpdflocId").val(params.locId),Layout.Page.container.find("#jobpdfdesignationId").val(params.designationId),Layout.Page.container.find("#fileType").val(downloadType),form.trigger("submit")}else Timetracker.util.isFilterOpen("jobReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_job_report_filter"),"jobReportfilter","jradvanced"),Timetracker.reports.jobReport.FireScroll.resetDataOnLoad(),ZPeople.FireScroll.init(Timetracker.reports.jobReport.FireScroll.loadMoreJobData),params.startIndex=Timetracker.reports.jobReport.FireScroll.getFetchCount(),Timetracker.reports.jobReport.FireScroll.params=params,Timetracker.util.appendLoading(),$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.reports.jobReport.isjobreportdatafetched=!0,Timetracker.reports.jobReport.FireScroll.setFetchCount(resultData),Timetracker.reports.jobReport.FireScroll.resetFireScroll(resultData),Timetracker.reports.jobReport.constructjobReport(resultData,params.userErecNo,params.billStatus),Timetracker.util.removeLoading()})},showCorrespondinglogs:function(obj,event,jobId,userErecNo,billtype,fromDate,toDate,isJobReport){event.stopPropagation();var otherDetails={tbodyId:$(obj).closest("tbody").attr("id"),trId:$(obj).closest("tr").attr("id")};if(0===Layout.Page.container.find(".Scrcont:visible").find("#showcorrespondingLogtime").length){var timelogDetailPopup='<div class="time-detail-pop lt gray W400 DN" id="showcorrespondingLogtime"><p class="FL">'+ZPI18N.getString("zp.timelogs")+'</p><i class="IC-cls CP red FR MR5 MT5" onclick="Layout.Page.container.find(\'.Scrcont:visible\').find(\'#showcorrespondingLogtime\').hide();"></i><table class="table popFxd-hd"><thead><tr><th width="30%">'+ZPI18N.getString("zp.date")+'</th><th width="30%">'+Timetracker.util.workitemDispName+'</th><th width="25%">'+ZPI18N.getString("zp.billablestatus")+'</th><th width="15%">'+ZPI18N.getString("zp.total")+'</th></tr></thead><tbody id="correspondinglogs" scroll="enabled"></tbody></table></div>';Layout.Page.container.find(".Scrcont:visible").append(timelogDetailPopup)}var correspondinglogs=$(obj).data().logsdata,params={mode:"getTimesheet",userErecNo:userErecNo,typeMode:billtype,jobId:jobId,conreqcsr:csrfToken,isRequestFromReport:!0};isJobReport&&(params.skipDateValidation=!0),Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)&&(params.viewEditPermissionType=Timetracker.constants.TTCustomAdmin.ReportView),void 0===correspondinglogs?(void 0!==fromDate&&null!==fromDate&&(params.fromDate=fromDate),void 0!==toDate&&null!==toDate&&(params.toDate=toDate),params.limit=Timetracker.FireScroll.getMaxFetchCount(Timetracker.constants.MODES.TL_REPORT_LOGS),params.sIndex=0,$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.reports.jobReport.constructCorrespondinglogs(resultData,userErecNo,obj,event),resultData.length<Timetracker.reports.jobReport.MAX_FETCH_COUNT?($(obj).data("moreLoad",!1),Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.MODES.TL_REPORT_LOGS)):(Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.TL_REPORT_LOGS,Timetracker.constants.URL,params,Timetracker.reports.jobReport.loadMoreCorrespondingLogs,void 0,otherDetails),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.TL_REPORT_LOGS,resultData)),$(obj).data("logsdata",resultData)})):(Timetracker.reports.jobReport.constructCorrespondinglogs(correspondinglogs,userErecNo,obj,event),!0===$(obj).data().moreLoad?(Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.TL_REPORT_LOGS,Timetracker.constants.URL,params,Timetracker.reports.jobReport.loadMoreCorrespondingLogs,void 0,otherDetails),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.TL_REPORT_LOGS,correspondinglogs)):!1===$(obj).data().moreLoad&&Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.MODES.TL_REPORT_LOGS))},constructCorrespondinglogs:function(correspondinglogs,userErecNo,obj,event){var empty="";Layout.Page.container.find(".Scrcont:visible").find("#correspondinglogs").html(""),0===correspondinglogs.length||""===correspondinglogs?(empty='<tr><td colspan="4" style="text-align:center;">'+ZPI18N.getString("zp.nodatafound")+"</td></tr>",Layout.Page.container.find(".Scrcont:visible").find("#correspondinglogs").append(empty)):Timetracker.reports.jobReport.constructCorrespondinglogsHtml(correspondinglogs,userErecNo),Timetracker.util.setPopupPosition(obj,"showcorrespondingLogtime",event,!1,40),Layout.Page.container.find(".Scrcont:visible").find("#showcorrespondingLogtime").fadeIn(100)},constructCorrespondinglogsHtml:function(correspondinglogs,userErecNo){var txt="";$.each(correspondinglogs,function(index,data){txt+="<tr ","0"===userErecNo&&(txt+="title="+data.employeename),txt+='><td width="30%">'+data.workDate+"</td>",data.taskName?txt+='<td width="30%">'+data.taskName+"</td>":txt+='<td width="30%">---</td>',0===data.billableStatus?txt+='<td width="25%">'+ZPI18N.getString("zp.billable")+"</td>":txt+='<td width="25%">'+ZPI18N.getString("zp.nonbillable")+"</td>",txt+='<td width="15%">'+Calendar.minstohrs(data.hours)+"</td></tr>"}),Layout.Page.container.find(".Scrcont:visible").find("#correspondinglogs").append(txt)},loadMoreCorrespondingLogs:function(result,params,otherDtls){result=result&&null!==result?result:[];var dom=Layout.Page.container.find("tbody#"+otherDtls.tbodyId).find("tr#"+otherDtls.trId).find("td.MoreLoad").find("span");dom.removeData("moreLoad"),result.length<Timetracker.reports.jobReport.MAX_FETCH_COUNT&&Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.MODES.TL_REPORT_LOGS),dom.data("moreLoad",!(result.length<Timetracker.reports.jobReport.MAX_FETCH_COUNT));var list=dom.data().logsdata;$.merge(list,result),dom.data("logsdata",list),Timetracker.reports.jobReport.constructCorrespondinglogsHtml(result,params.userErecNo),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.TL_REPORT_LOGS,result)},generatePrintReport:function(){var isChart=!0;Layout.Page.container.find("#job_Report_List").hasClass("btn-primary")&&(isChart=!1),Timetracker.util.printReport(null,isChart,Layout.Page.container.find("#jrUser").val())},constructjobReport:function(resultData,userErecNo,billStatus){Layout.Page.container.find("#jobreportdiv_charts").show(),Layout.Page.container.find("#timesheetJobreport").html("");var scrollNeeded=!0;if(0===resultData.length)Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"jobreportdiv_charts"}),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"jobreportdiv_list"}),Layout.Page.container.find("#job_charts,#jobreportlist").hide();else{resultData.length<=Timetracker.reports.jobReport.CHART_EXTREME_MAX+1&&(scrollNeeded=!1,resultData.length!==Timetracker.reports.jobReport.CHART_EXTREME_MAX+1&&(Timetracker.reports.jobReport.CHART_EXTREME_MAX=resultData.length-1));var jsonObj=Timetracker.reports.jobReport.calculateValuesForChart(resultData,userErecNo,billStatus);Layout.Page.container.find("#job_charts,#jobreportlist").show(),Layout.Page.container.find("#zp_empty_data").hide(),Timetracker.reports.jobReport.constructHighChartsforJobReport(jsonObj.label,jsonObj.dstot,jsonObj.dsdur,jsonObj.dsbdur,jsonObj.dsbtot,scrollNeeded),Layout.Page.container.find("#timesheetJobreport").html(jsonObj.txt)}Layout.Page.container.find("#job_Report_Chart").hasClass("btn-primary")?Layout.Page.container.find("#jobreportdiv_list").hide():(Layout.Page.container.find("#jobreportdiv_charts").hide(),Layout.Page.container.find("#jobreportdiv_list").fadeIn(),ZPView.handleTablePosition())},calculateValuesForChart:function(resultData,userErecNo,billStatus){var txt,label=[],dstot=[],dsdur=[],dsbtot=[],dsbdur=[],k=0;$.each(resultData,function(index,data){txt+='<tr class="ZPLRow" id="'+data.JOBID+"_"+userErecNo+'">',data.CLIENTNAME?txt+='<td><span class="ellipsis W150" title="'+data.CLIENTNAME+'">'+data.CLIENTNAME+"</span></td>":txt+="<td>---</td>",data.PROJECTNAME?txt+='<td><span class="ellipsis W150" title="'+data.PROJECTNAME+'">'+data.PROJECTNAME+"</span></td>":txt+="<td>---</td>",txt+='<td class="MoreLoad"><span class="ellipsis W150 CP" title="'+data.JOBNAME+'" onclick="Timetracker.reports.jobReport.showCorrespondinglogs(this,event,\''+data.JOBID+"','"+userErecNo+"','"+billStatus+"',undefined,undefined,true);\">"+data.JOBNAME+"</span></td>",data.duration?txt+="<td>"+Calendar.minstohrs(data.duration)+"</td>":txt+="<td>"+Calendar.minstohrs(0)+"</td>",data.billablehours?txt+="<td>"+Calendar.minstohrs(data.billablehours)+"</td>":txt+="<td>-</td>",data.nonbillablehours?txt+="<td>"+Calendar.minstohrs(data.nonbillablehours)+"</td>":txt+="<td>-</td>",data.totalhours?txt+="<td>"+Calendar.minstohrs(data.totalhours)+"</td>":txt+="<td>-</td>",void 0!==data.JOBSTATUS&&0===data.JOBSTATUS?txt+="<td>"+ZPI18N.getString("zp.inprogress")+"</td>":txt+="<td>"+ZPI18N.getString("zp.completed")+"</td>",txt+="</tr>",label[k]=ZPeople.decodeTxt(data.JOBNAME),dstot[k]=data.totalhours/60,0===dstot[k]&&(dstot[k]=0),data.duration?dsdur[k]=data.duration/60:dsdur[k]=0,dsbtot[k]=data.billablehours/60,dsbdur[k]=data.nonbillablehours/60,0===dsbtot[k]&&(dsbtot[k]=0),0===dsbdur[k]&&(dsbdur[k]=0),k++});var jsonObj={};return jsonObj.dstot=dstot,jsonObj.dsdur=dsdur,jsonObj.dsbdur=dsbdur,jsonObj.dsbtot=dsbtot,jsonObj.label=label,jsonObj.txt=txt,jsonObj},reconstructJobReport:function(resultData,userErecNo,billStatus){var jsonObj=Timetracker.reports.jobReport.calculateValuesForChart(resultData,userErecNo,billStatus);Layout.Page.container.find("#timesheetJobreport").append(jsonObj.txt);for(var chart1=$("#jreport2").highcharts(),chart2=$("#jreport3").highcharts(),categories=chart1.xAxis[0].categories,i=0;i<jsonObj.dstot.length;i++)categories.push(jsonObj.label[i]),chart1.series[0].addPoint(jsonObj.dstot[i],!1,!1),chart1.series[1].addPoint(jsonObj.dsdur[i],!1,!1),chart2.series[0].addPoint(jsonObj.dsbdur[i],!1,!1),chart2.series[1].addPoint(jsonObj.dsbtot[i],!1,!1);chart1.xAxis[0].setCategories(categories,!1),chart2.xAxis[0].setCategories(categories,!1),chart1.redraw(),chart2.redraw()},constructHighChartsforJobReport:function(label,dstot,dsdur,dsbdur,dsbtot,scrollNeeded){Highcharts.setOptions({colors:["#b2d7ad","#f7cccc"]});new Highcharts.Chart({chart:{renderTo:"jreport2",type:"column",spacingBottom:50,spacingTop:10,spacingLeft:10,spacingRight:50,plotBorderWidth:1,plotBorderColor:"#f3f3f3"},scrollbar:{enabled:scrollNeeded,barBackgroundColor:"#cfd6d9",barBorderRadius:7,barBorderWidth:0,barBorderHeight:2,buttonBackgroundColor:"#cfd6d9",buttonBorderWidth:0,buttonArrowColor:"white",buttonBorderRadius:4,rifleColor:"#cfd6d9",trackBorderWidth:1,trackBorderColor:"white",trackBorderRadius:7},credits:{enabled:!1},title:{text:ZPI18N.getString("zp.hours")+" Vs "+ZPeople.decodeTxt(Timetracker.util.jobDispName),align:"left",x:50,style:{color:"black",fontWeight:"bold"}},xAxis:{title:{text:ZPeople.decodeTxt(Timetracker.util.jobDispName),style:{color:"black",fontWeight:"bold",fontSize:"14px"}},categories:label,labels:{rotation:-45},events:{afterSetExtremes:function(){ZPeople.FireScroll.getFireScrollPropertie().triggered||this.getExtremes().max>Timetracker.reports.jobReport.FETCHED_COUNT-10&&(ZPeople.FireScroll.setParam("triggered",!0),Timetracker.reports.jobReport.FireScroll.loadMoreJobData())}},min:0,max:Timetracker.reports.jobReport.CHART_EXTREME_MAX},yAxis:{title:{text:ZPI18N.getString("zp.hours"),style:{color:"black",fontWeight:"bold",fontSize:"14px"}},gridLineColor:"#f3f3f3"},tooltip:{valueDecimals:2,formatter:function(){return this.series.name+","+this.x+","+Math.round(100*this.point.y)/100}},exporting:{enabled:!1,buttons:{contextButton:{theme:{states:{hover:{stroke:"#bfbfbf",fill:null},select:{stroke:"#bfbfbf",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"JobChart2"},plotOptions:{column:{pointPadding:.1,borderWidth:0,borderRadius:0,dataLabels:{enabled:!0,formatter:function(){return 0===this.point.y?"0":Math.round(100*this.point.y)/100},style:{fontWeight:"normal",fontSize:"13px",fontFamily:"Verdana, sans-serif"}}}},series:[{name:ZPI18N.getString("zp.totalhours"),data:dstot},{name:ZPI18N.getString("zp.estimatedhours"),data:dsdur}]});Highcharts.setOptions({colors:["#9cc6e5","#ffe5a3"]}),new Highcharts.Chart({chart:{renderTo:"jreport3",type:"column",spacingBottom:50,spacingTop:10,spacingLeft:10,spacingRight:50,plotBorderColor:"#f3f3f3",plotBorderWidth:1},credits:{enabled:!1},scrollbar:{enabled:scrollNeeded,barBackgroundColor:"#cfd6d9",barBorderRadius:7,barBorderWidth:0,barBorderHeight:2,buttonBackgroundColor:"#cfd6d9",buttonBorderWidth:0,buttonArrowColor:"white",buttonBorderRadius:4,rifleColor:"#cfd6d9",trackBorderWidth:1,trackBorderColor:"white",trackBorderRadius:7},title:{text:ZPI18N.getString("zp.billable")+" Vs "+ZPI18N.getString("zp.nonbillable"),align:"left",x:50,style:{color:"black",fontWeight:"bold"}},subtitle:{},xAxis:{title:{text:ZPeople.decodeTxt(Timetracker.util.jobDispName),style:{color:"black",fontWeight:"bolder",fontSize:"14px"}},categories:label,labels:{rotation:-45},events:{afterSetExtremes:function(){ZPeople.FireScroll.getFireScrollPropertie().triggered||this.getExtremes().max>Timetracker.reports.jobReport.FETCHED_COUNT-10&&(ZPeople.FireScroll.setParam("triggered",!0),Timetracker.reports.jobReport.FireScroll.loadMoreJobData())}},min:0,max:Timetracker.reports.jobReport.CHART_EXTREME_MAX},yAxis:{title:{text:ZPI18N.getString("zp.hours"),style:{color:"black",fontWeight:"bolder",fontSize:"14px"}},gridLineColor:"#f3f3f3"},tooltip:{valueDecimals:2,formatter:function(){return this.series.name+","+this.x+","+Math.round(100*this.point.y)/100}},exporting:{enabled:!1,buttons:{contextButton:{theme:{states:{hover:{stroke:"#bfbfbf",fill:null},select:{stroke:"#bfbfbf",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"JobChart3"},plotOptions:{column:{stacking:"normal",pointPadding:.3,borderWidth:0,borderRadius:0,dataLabels:{enabled:!0,y:-5,formatter:function(){return 0===this.point.y?"0":Math.round(100*this.point.y)/100},color:"black",style:{fontWeight:"normal"}}}},series:[{name:ZPI18N.getString("zp.nonbillablehours"),data:dsbdur},{name:ZPI18N.getString("zp.billablehours"),data:dsbtot}]})},changeViews:function(isChartView,obj){Layout.Page.container.find(obj).removeClass("btn-default").addClass("btn-primary").siblings().removeClass("btn-primary").addClass("btn-default"),isChartView?(Layout.Page.container.find("#jobreportdiv_charts").fadeIn(200),Layout.Page.container.find("#jobreportdiv_list").hide()):(Layout.Page.container.find("#jobreportdiv_charts").hide(),Layout.Page.container.find("#jobreportdiv_list").fadeIn(200),ZPView.handleTablePosition())},FireScroll:{params:{},resetDataOnLoad:function(){Timetracker.reports.jobReport.CHART_EXTREME_MAX=9,Timetracker.reports.jobReport.FireScroll.resetFetchCount(),Timetracker.reports.jobReport.FireScroll.params={},ZPeople.FireScroll.reset()},setFetchCount:function(result){Timetracker.reports.jobReport.FETCHED_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.jobReport.FETCHED_COUNT)?Timetracker.reports.jobReport.FETCHED_COUNT:0,Timetracker.reports.jobReport.FETCHED_COUNT+=result.length},resetFetchCount:function(){Timetracker.reports.jobReport.FETCHED_COUNT=0},getFetchCount:function(){return Timetracker.reports.jobReport.FETCHED_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.jobReport.FETCHED_COUNT)?Timetracker.reports.jobReport.FETCHED_COUNT:0,0===Timetracker.reports.jobReport.FETCHED_COUNT?Timetracker.reports.jobReport.FETCHED_COUNT:Timetracker.reports.jobReport.FETCHED_COUNT+1},loadMoreJobData:function(){var params=Timetracker.reports.jobReport.FireScroll.params;params.startIndex=Timetracker.reports.jobReport.FireScroll.getFetchCount(),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.reports.jobReport.FireScroll.constructJobDataOnFireScrollTrigger)},resetFireScroll:function(result){Timetracker.reports.jobReport.MAX_FETCH_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.jobReport.MAX_FETCH_COUNT)?Timetracker.reports.jobReport.MAX_FETCH_COUNT:25,result.length===Timetracker.reports.jobReport.MAX_FETCH_COUNT?ZPeople.FireScroll.reset():result.length<Timetracker.reports.jobReport.MAX_FETCH_COUNT&&ZPeople.FireScroll.setParam("triggered",!0)},constructJobDataOnFireScrollTrigger:function(result,params){result&&0!==result.length&&(Timetracker.reports.jobReport.FireScroll.setFetchCount(result),Timetracker.reports.jobReport.reconstructJobReport(result,params.userErecNo,params.billStatus),Timetracker.reports.jobReport.FireScroll.resetFireScroll(result))}}},Timetracker.reports.timeLogReport={istimelogreportdatafetched:!1,tmpDate:null,reportTypechange:function(obj){"6"===$(obj).val()?(Layout.Page.container.find(".ERR").remove(),Layout.Page.container.find("#rfromtodate").val(""),Layout.Page.container.find("#new_rcustomreportfromtodate").toggle(),Timetracker.util.showAdvanced("timelogReportfilter","radvanced")):(Layout.Page.container.find("#new_rcustomreportfromtodate").hide(),Layout.Page.container.find("#periodfilter").show())},generateTimelogReport:function(isLoad,params,downloadType){if(void 0===isLoad){if(Timetracker.initSetup(),Layout.Page.container.find("#rClientName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.clientDispName)),Layout.Page.container.find("#rprojectName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)),Layout.Page.container.find("#rjobName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.jobDispName)),Timetracker.reports.timeLogReport.istimelogreportdatafetched||(Timetracker.clients.getClients("rClientName",null,null,!0,erecno,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Filters.loadEmployeeType("rEmpType"),Timetracker.util.resetSelectInFilters("timelogReportfilter",Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#rUser").on("change",function(){var user=Layout.Page.container.find("#rUser").val()||"0";Timetracker.clients.getClients("rClientName",null,null,!0,user,Timetracker.constants.TTCustomAdmin.ReportView)})),Timetracker.util.isFilterOpen("timelogReportfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_timelog_report_filter"),"timelogReportfilter","radvanced",Layout.Page.container.find("#rperiod").val()),Layout.Page.container.find("#rEmpStatus").on("change",function(){var empStatus=Layout.Page.container.find("#rEmpStatus").val();null!=empStatus&&-1!==empStatus.toString().indexOf("18")?Layout.Page.container.find("#remployeeDateOfExitBased").parents(".dateOfExit").is(":visible")||(Layout.Page.container.find("#remployeeDateOfExitBased").parents(".dateOfExit").show(),Layout.Page.container.find("#remployeeDateOfExitBased").prop("checked",!0)):(Layout.Page.container.find("#remployeeDateOfExitBased").prop("checked",!1),Layout.Page.container.find("#remployeeDateOfExitBased").parents(".dateOfExit").hide())}),!Timetracker.reports.timeLogReport.istimelogreportdatafetched){var filterparam=Timetracker.Filters.getParamsForFilter("TimelogReport");isOrgStructureEnabled&&(Timetracker.Division.constructDivisionFilter("rDivisionName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.BusinessUnit.constructBusinessUnitFilter("rBusinessUnitName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.LegalEntity.constructLegalEntityFilter("rLegalEntityName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView)),Layout.Page.container.find("#rEmpStatus").select2("val",["19","-2","18"]).trigger("change"),Timetracker.Department.constructDepartmentFilter("rDepartmentName",filterparam,void 0,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Designation.constructDesignationFilter("rDesignationName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Location.constructLocationFilter("rLocationName",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.projects.Filters.updateProjectListForFilters(!0,erecno,$("#rClientName").val(),"timelogReport",$("#rjobstatus").val(),"0",void 0,Timetracker.constants.TTCustomAdmin.ReportView)}Layout.Page.container.find("#rUser").on("change",function(){"0"===(Layout.Page.container.find("#rUser").val()||"0")&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?Layout.Page.container.find("#rincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show():Layout.Page.container.find("#rincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide()}),Layout.Page.container.find("#timelogreportdiv_charts,#timelogreportdiv_list,#timelog_list,#zp_empty_data,#timelog_charts,#monthreportbody,#customreportlist,#rcustomreportfromtodate,#new_rcustomreportfromtodate,#monthreport,#customreport").hide(),Layout.Page.container.find("#timelog_Report_Chart").addClass("btn-primary").removeClass("btn-default").siblings().removeClass("btn-primary").addClass("btn-default")}if(Timetracker.reports.timeLogReport.istimelogreportdatafetched||Layout.Page.container.find("#rDepartmentName").select2("val","0"),Layout.Page.container.find("#rprojectName,#rjobName,#rClientName").find("select.form-select").select2(Timetracker.select2.getSelect2Properties()),Layout.Page.container.find("#rperiod,#rjobstatus,#rbillstatus,#rbillingstatus,#rApprovalstatus,#rUnApprovalstatus,#rEmpType").select2({minimumResultsForSearch:1/0}),Layout.Page.container.find("[id^=showcorrespondingLogtime]").hide(),Timetracker.isDataAdmin()||Layout.Page.container.find("#rbillingStatusFilter").remove(),void 0===isLoad){var viewType=Timetracker.generalSettings.getDefaultViewType(Timetracker.timelogs.tserecno);Layout.Page.container.find("#rperiod").val(viewType).select2({minimumResultsForSearch:1/0})}var fromdate,todate,rperiod=Layout.Page.container.find("#rperiod").val();downloadType||Timetracker.util.setViewType(rperiod,"r");var closeFilter=!0;if("0"===rperiod||"3"===rperiod)date=Calendar.formatDate(Timetracker.reports.timeLogReport.tmpDate.day),Timetracker.reports.timeLogReport.constructDayReport(date,downloadType),void 0===downloadType&&(Layout.Page.container.find("#timelogWeekReportChanger,#timelogMonthReportChanger,#monthreport,#customreport,#timelogreportdiv_list,#timelogreportdiv_charts,#timelog_Report_Chart,#timelog_Report_List").hide(),Layout.Page.container.find("#daytimelogreport").fadeIn(200),Layout.Page.container.find("#calmonth1").html(Timetracker.timelogs.getDateinTSformat(Timetracker.reports.timeLogReport.tmpDate.day)),Layout.Page.container.find("#calmonth1").addClass("day").removeClass("wek mon"),Layout.Page.container.find("#daytimelogreportdiv_charts,#timelogdayReportChanger,#daytimelog_Report_Chart,#daytimelog_Report_List").show());else if("1"===rperiod||"4"===rperiod)fromdate=Calendar.formatDate(Timetracker.reports.timeLogReport.tmpDate.from),todate=Calendar.formatDate(Timetracker.reports.timeLogReport.tmpDate.to),Timetracker.reports.timeLogReport.constructWeekReport(fromdate,todate,downloadType),void 0===downloadType&&(Layout.Page.container.find("#timelogdayReportChanger,#timelogWeekReportChanger,#timelogMonthReportChanger,#monthreport,#customreport,#daytimelog_Report_List,#daytimelog_Report_Chart,#daytimelogreportdiv_list,#daytimelogreportdiv_charts").hide(),Layout.Page.container.find("#calmonth3").html(Timetracker.timelogs.getDateinTSformat(Timetracker.reports.timeLogReport.tmpDate.from)+" - "+Timetracker.timelogs.getDateinTSformat(Timetracker.reports.timeLogReport.tmpDate.to)),Layout.Page.container.find("#calmonth3").addClass("wek").removeClass("day mon"),Layout.Page.container.find("#timelogWeekReportChanger,#timelog_Report_List,#timelog_Report_Chart").show());else if("2"===rperiod||"5"===rperiod){fromdate=Calendar.formatDate(Timetracker.reports.timeLogReport.tmpDate.from),todate=Calendar.formatDate(Timetracker.reports.timeLogReport.tmpDate.to);var month=Calendar.monthfromdate.getMonth(),year=Calendar.monthfromdate.getFullYear();Timetracker.reports.timeLogReport.constructMonthReport(fromdate,todate,month,year,downloadType),void 0===downloadType&&(Layout.Page.container.find("#timelogdayReportChanger,#timelogWeekReportChanger,#timelogMonthReportChanger,#customreport,#timelogreportdiv_list,#timelogreportdiv_charts,#timelog_Report_List,#timelog_Report_Chart,#daytimelogreportdiv_list,#daytimelogreportdiv_charts,#daytimelog_Report_List,#daytimelog_Report_Chart").hide(),Layout.Page.container.find("#timelogMonthReportChanger").show(),Layout.Page.container.find("#monthreport").fadeIn(200))}else if("6"===rperiod){var dateLayout=Layout.Page.container.find("#new_rcustomreportfromtodate"),isValid=Timetracker.reports.timeLogReport.generateCustomReport(downloadType,isLoad);closeFilter=isValid,void 0===downloadType&&isValid&&(Layout.Page.container.find("#timelogdayReportChanger,#timelogWeekReportChanger,#timelogMonthReportChanger,#monthreport,#timelog_Report_List,#timelog_Report_Chart,#timelogreportdiv_charts,#timelogreportdiv_list,#daytimelogreportdiv_list,#daytimelogreportdiv_charts,#daytimelog_Report_List,#daytimelog_Report_Chart").hide(),Layout.Page.container.find("#customreport").fadeIn(200)),"6"===rperiod&&dateLayout.is(":hidden")&&dateLayout.show()}!downloadType&&Timetracker.util.isFilterOpen("timelogReportfilter")&&closeFilter&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_timelog_report_filter"),"timelogReportfilter","radvanced",Layout.Page.container.find("#rperiod").val())},generateCustomReport:function(downloadType,isLoad){Layout.Page.container.find("#timelogReportfilter").find(".ERR").remove();var params=Timetracker.Filters.getAndValidateParams("CUSTOMTIMELOGREPORT");delete params.isChartView;var dateLayout=Layout.Page.container.find("#new_rcustomreportfromtodate"),fromDate=dateLayout.find("#rfromdate").val(),toDate=dateLayout.find("#rtodate").val(),compcheck=!0;if(compcheck=Timetracker.util.validateFunction("rfromdate","",ZPI18N.getString("zp.emptyfromdate"),"div",compcheck,dateLayout),compcheck=Timetracker.util.validateFunction("rtodate","",ZPI18N.getString("zp.emptytodate"),"div",compcheck,dateLayout),Calendar.isvalidDate(fromDate)||(compcheck=Timetracker.util.validateFunction("rfromdate",null,ZPI18N.getString("zp.invaliddate"),"div",compcheck,dateLayout)),Calendar.isvalidDate(toDate)||(compcheck=Timetracker.util.validateFunction("rtodate",null,ZPI18N.getString("zp.invaliddate"),"div",compcheck,dateLayout)),compcheck){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);if(fdate>tdate)compcheck=Timetracker.util.validateFunction("rfromdate",null,ZPI18N.getString("zp.greaterfromdate"),"div",compcheck,dateLayout);else Timetracker.DateTime.getDateDiff(fdate,tdate)>92&&(compcheck=Timetracker.util.validateFunction("rfromdate",null,ZPI18N.getString("zp.datewithindays",["92"]),"div",compcheck,dateLayout))}if(!compcheck){if(!1===isLoad)return!1;fromDate=Calendar.formatDate(Calendar.weekfromdate),toDate=Calendar.formatDate(Calendar.weektodate),dateLayout.find("#rfromdate").val(fromDate),dateLayout.find("#rtodate").val(toDate),Layout.Page.container.find("#timelogReportfilter").find(".ERR").remove()}if(params.fromDate=fromDate,params.toDate=toDate,void 0!==downloadType){var form=Layout.Page.container.find("#downloadpdf");Layout.Page.container.find("#downloadpdf").attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheetDispAction.zp?mode=exportTimesheetReport"),Layout.Page.container.find("#pdfidentity").val(csrfToken),Layout.Page.container.find("#pdfuserErecNo").val(params.userErecNo),Layout.Page.container.find("#pdffromDate").val(fromDate),Layout.Page.container.find("#pdftoDate").val(toDate),Layout.Page.container.find("#pdfempStatus").val(params.employeeStatus),Layout.Page.container.find("#pdfempType").val(params.employeeType?params.employeeType:"0"),Layout.Page.container.find("#pdfbillStatus").val(params.billStatus),Layout.Page.container.find("#pdfbillingStatus").val(params.billingStatus),Layout.Page.container.find("#pdfjobStatus").val(params.jobStatus),Layout.Page.container.find("#pdfapprovalStatus").val(params.approvalStatus),Layout.Page.container.find("#pdfjobId").val(params.jobId),Layout.Page.container.find("#pdfprojectId").val(params.projectId),Layout.Page.container.find("#pdfclientId").val(params.clientId),Layout.Page.container.find("#pdflegalEntityId").val(params.legalEntityId),Layout.Page.container.find("#pdfbusinessUnitId").val(params.businessUnitId),Layout.Page.container.find("#pdfdivisionId").val(params.divisionId),Layout.Page.container.find("#pdfdeptId").val(params.deptId),Layout.Page.container.find("#pdfdesignationId").val(params.designationId),Layout.Page.container.find("#pdflocId").val(params.locId),Layout.Page.container.find("#pdfisDirectSubOnlyNeeded").val(params.isDirectSubOnlyNeeded),Layout.Page.container.find("#pdfemployeeDateOfExitBased").val(params.employeeDateOfExitBased),Layout.Page.container.find("#fileType").val(downloadType),"pdf"!=downloadType?Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!1):Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!0),form.trigger("submit")}else Timetracker.util.appendLoading(),Timetracker.reports.timeLogReport.FireScroll.resetDataOnLoad(),Timetracker.reports.timeLogReport.FireScroll.params=params,params.sIndex=0,Timetracker.reports.timeLogReport.FireScroll.mode=Timetracker.constants.CUSTOM,Layout.Page.container.find("#customtimelog_list").off("scroll").scrollTop(0),$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.reports.timeLogReport.istimelogreportdatafetched=!0,Layout.Page.container.find("#timesheetmreport").html(""),0===resultData.length?(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"customreport",type:"prepend"}),Layout.Page.container.find(".table-responsive.tabcont").hide()):resultData.errorCode?(Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(resultData.errorCode,null,!0)),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"customreport",type:"prepend"}),Layout.Page.container.find(".table-responsive.tabcont").hide()):(ZPeople.FireScroll.init(Timetracker.reports.timeLogReport.FireScroll.loadMoreTimeLogData),Timetracker.reports.timeLogReport.FireScroll.setFetchCount(resultData),Timetracker.reports.timeLogReport.FireScroll.resetFireScroll(resultData),Timetracker.reports.timeLogReport.constructCustomTimesheetReport(resultData,params),ZPView.handleTablePosition()),Timetracker.util.removeLoading()});return!0},constructCustomTimesheetReport:function(resultData,params,isDayReport,isFromScroll){var txt="",hrs=0,timelogReportTotalId=isDayReport?"daytimelogtotal":"timesheetmtotal",timesheetTotalDivId=isDayReport?"timesheetDayTotalDiv":"timesheetcustomtotal",timelogReportContentId=isDayReport?"daytimesheetmreport":"timesheetmreport";isFromScroll&&(hrs=parseInt($("#"+timelogReportTotalId).attr("gtotal"))),$.each(resultData,function(index,data){txt+='<tr class="ZPLRow" id="'+data.userErecNo+"_"+data.JOBID+'">',txt+='<td><img class="FL" src="'+data.EMPLOYEEPHOTO+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+data.firstName+'"><b>'+data.EMPLOYEEID+"</b> "+data.firstName+"</span></div></td>",txt+="<td>"+data.workdate+"</td>",txt+='<td class="MoreLoad"><span class="ellipsis CP" title="'+data.JOBNAME+'" onclick="Timetracker.reports.jobReport.showCorrespondinglogs(this,event,\''+data.JOBID+"','"+data.userErecNo+"','"+params.billStatus+"','"+data.workdate+"','"+data.workdate+"');\">"+data.JOBNAME+"</span></td>";var clientName="---";void 0!==data.CLIENTNAME&&(clientName=data.CLIENTNAME),txt+='<td><span class="ellipsis" title="'+clientName+'">'+clientName+"</span></td>";var projectName="---";void 0!==data.PROJECTNAME&&(projectName=data.PROJECTNAME),txt+='<td><span class="ellipsis" title="'+projectName+'">'+projectName+"</span></td>",txt+="<td>"+Calendar.minstohrs(data.totalhours)+"</td>",hrs+=data.totalhours,txt+="<td></td></tr>"}),isDayReport||Layout.Page.container.find("#customreportlist").fadeIn(200),Layout.Page.container.find("#"+timelogReportContentId).append(txt),Layout.Page.container.find("#"+timesheetTotalDivId).hide(),25!==resultData.length?(Layout.Page.container.find("#"+timelogReportTotalId).html(Calendar.minstohrs(hrs)),Layout.Page.container.find("#"+timesheetTotalDivId).show()):Layout.Page.container.find("#"+timelogReportTotalId).attr("gtotal",hrs),isDayReport?Layout.Page.container.find("#daytimelogreportdiv_list").find("#zp_empty_data").hide():Layout.Page.container.find("#customreport").find("#zp_empty_data").hide(),Layout.Page.container.find(".table-responsive.tabcont").fadeIn(200)},generatePreviousDay:function(){var d=Calendar.getPreviousDay();Timetracker.reports.timeLogReport.tmpDate=d;var date=Calendar.formatDate(d.day);Layout.Page.container.find("#calmonth1").html(Timetracker.timelogs.getDateinTSformat(d.day)),Layout.Page.container.find("#calmonth1").addClass("day").removeClass("wek mon"),this.constructDayReport(date)},generateNextDay:function(){var d=Calendar.getNextDay();Timetracker.reports.timeLogReport.tmpDate=d;var date=Calendar.formatDate(d.day);Layout.Page.container.find("#calmonth1").html(Timetracker.timelogs.getDateinTSformat(d.day)),Layout.Page.container.find("#calmonth1").addClass("day").removeClass("wek mon"),this.constructDayReport(date)},generateWeekReportNext:function(){var d=Calendar.getNextWeek();Timetracker.reports.timeLogReport.tmpDate=d;var fromdate=Calendar.formatDate(d.from),todate=Calendar.formatDate(d.to);Layout.Page.container.find("#calmonth3").html(Timetracker.timelogs.getDateinTSformat(d.from)+" - "+Timetracker.timelogs.getDateinTSformat(d.to)),Layout.Page.container.find("#calmonth3").addClass("wek").removeClass("day mon"),this.constructWeekReport(fromdate,todate)},generateWeekReportPrevious:function(){var d=Calendar.getPreviousWeek();Timetracker.reports.timeLogReport.tmpDate=d;var fromdate=Calendar.formatDate(d.from),todate=Calendar.formatDate(d.to);Layout.Page.container.find("#calmonth3").html(Timetracker.timelogs.getDateinTSformat(d.from)+" - "+Timetracker.timelogs.getDateinTSformat(d.to)),Layout.Page.container.find("#calmonth3").addClass("wek").removeClass("day mon"),this.constructWeekReport(fromdate,todate)},constructDayReport:function(date,downloadType,isFromChangeView){var params;if(isFromChangeView&&Timetracker.reports.timeLogReport.FireScroll&&Timetracker.reports.timeLogReport.FireScroll.params?(params=Timetracker.reports.timeLogReport.FireScroll.params,Timetracker.reports.timeLogReport.FireScroll.params.isChartView=!1,Layout.Page.container.find("#daytimelog_Report_Chart").hasClass("btn-primary")&&(Timetracker.reports.timeLogReport.FireScroll.params.isChartView=!0)):params=Timetracker.Filters.getAndValidateParams("CUSTOMTIMELOGREPORT"),params.fromDate=date,params.toDate=date,void 0!==downloadType){var form=Layout.Page.container.find("#downloadpdf");Layout.Page.container.find("#downloadpdf").attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheetDispAction.zp?mode=exportTimesheetReport"),Layout.Page.container.find("#pdfidentity").val(csrfToken),Layout.Page.container.find("#pdfuserErecNo").val(params.userErecNo),Layout.Page.container.find("#pdffromDate").val(date),Layout.Page.container.find("#pdftoDate").val(date),Layout.Page.container.find("#pdfempStatus").val(params.employeeStatus),Layout.Page.container.find("#pdfempType").val(params.employeeType?params.employeeType:"0"),Layout.Page.container.find("#pdfbillStatus").val(params.billStatus),Layout.Page.container.find("#pdfbillingStatus").val(params.billingStatus),Layout.Page.container.find("#pdfjobStatus").val(params.jobStatus),Layout.Page.container.find("#pdfapprovalStatus").val(params.approvalStatus),Layout.Page.container.find("#pdfjobId").val(params.jobId),Layout.Page.container.find("#pdfprojectId").val(params.projectId),Layout.Page.container.find("#pdfclientId").val(params.clientId),Layout.Page.container.find("#pdflegalEntityId").val(params.legalEntityId),Layout.Page.container.find("#pdfbusinessUnitId").val(params.businessUnitId),Layout.Page.container.find("#pdfdivisionId").val(params.divisionId),Layout.Page.container.find("#pdfdeptId").val(params.deptId),Layout.Page.container.find("#pdfdesignationId").val(params.designationId),Layout.Page.container.find("#pdflocId").val(params.locId),Layout.Page.container.find("#pdfweekstarts").val(weekstarts),Layout.Page.container.find("#pdfmonthReport").val(!1),Layout.Page.container.find("#pdfisDirectSubOnlyNeeded").val(params.isDirectSubOnlyNeeded),Layout.Page.container.find("#pdfemployeeDateOfExitBased").val(params.employeeDateOfExitBased),Layout.Page.container.find("#fileType").val(downloadType),"pdf"!=downloadType?Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!1):Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!0),form.trigger("submit")}else{Timetracker.util.appendLoading(),Timetracker.reports.timeLogReport.FireScroll.mode=Timetracker.constants.DAY,isFromChangeView||(Layout.Page.container.find("#daytimelog_list").off("scroll").scrollTop(0),Timetracker.reports.timeLogReport.FireScroll.resetDataOnLoad(),params.sIndex=0),Timetracker.reports.timeLogReport.FireScroll.params=params,$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.reports.timeLogReport.istimelogreportdatafetched=!0,isFromChangeView||Layout.Page.container.find("#daytimesheetmreport").html("");if(0===resultData.length)Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"daytimelogreportdiv_charts"}),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"daytimelogreportdiv_list"}),Layout.Page.container.find(".table-responsive.tabcont").hide(),Layout.Page.container.find("#daytimelog_charts,#daytimelogreportdiv_list").hide();else{if(Layout.Page.container.find("#daytimelog_Report_Chart").hasClass("btn-primary")){var extraDtls={a:7,b:17};Timetracker.reports.timeLogReport.drawHighChartsForWeekReport(resultData[0],null,extraDtls)}else ZPeople.FireScroll.init(Timetracker.reports.timeLogReport.FireScroll.loadMoreTimeLogData),Timetracker.reports.timeLogReport.constructCustomTimesheetReport(resultData,params,!0,!1),Timetracker.reports.timeLogReport.FireScroll.setFetchCount(resultData),Timetracker.reports.timeLogReport.FireScroll.resetFireScroll(resultData);Layout.Page.container.find("div#zp_empty_data").hide(),Layout.Page.container.find("#daytimelog_charts,#daytimelog_list").show(),Layout.Page.container.find("#daytimelogreport").find("#zp_empty_data").hide(),Layout.Page.container.find(".table-responsive.tabcont").fadeIn(200),ZPView.handleTablePosition()}Layout.Page.container.find("#daytimelog_Report_Chart").hasClass("btn-primary")?(Layout.Page.container.find("#daytimelogreportdiv_list").attr("chartViewDataFetched",!0),isFromChangeView||Layout.Page.container.find("#daytimelogreportdiv_list").attr("listViewDataFetched",!1),Layout.Page.container.find("#daytimelogreportdiv_list").hide(),Layout.Page.container.find("#daytimelogreportdiv_charts").show()):(Layout.Page.container.find("#daytimelogreportdiv_list").attr("listViewDataFetched",!0),isFromChangeView||Layout.Page.container.find("#daytimelogreportdiv_list").attr("chartViewDataFetched",!1),Layout.Page.container.find("#daytimelogreportdiv_charts").hide(),Layout.Page.container.find("#daytimelogreportdiv_list").show(),ZPView.handleTablePosition()),Timetracker.util.removeLoading()})}},constructWeekTimesheetReport:function(resData,params,isFromScroll){var cnt=0;for(var tempKey in resData)cnt++;var txt="",jobobj={},keys=new Array;for(var k in resData)keys.push(k);keys.sort();var len=keys.length,jobsTempObj={},gtotal=0;isFromScroll&&(gtotal=parseInt($("#timesheettotal").attr("grandtotal")),jobobj=$("#timesheettotal").attr("rowTotal").split(","));for(var tempI=0;tempI<len;tempI++){var key=keys[tempI],dayobj={},value=resData[key],rdata=value.JOBS,jobtotal=0;txt+='<tr class="ZPLRow" id="'+value.ERECNO+"_"+value.jobId+'">';var clientName="---";void 0!==value.CLIENTNAME&&(clientName=value.CLIENTNAME);var projectName="---";void 0!==value.PROJECTNAME&&(projectName=value.PROJECTNAME),txt+='<td><img class="FL" src="'+value.EMPLOYEEPHOTO+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+value.EMPNAME+'"><b>'+value.EMPLOYEEID+"</b> "+value.EMPNAME+"</span></div></td>",txt+='<td><span class="ellipsis W150" title="'+clientName+'">'+clientName+"</span></td>",txt+='<td><span class="ellipsis W150" title="'+projectName+'">'+projectName+"</span></td>",txt+='<td class ="MoreLoad"><span class="ellipsis W150 CP" title="'+value.JOBNAME+'" onclick="Timetracker.reports.jobReport.showCorrespondinglogs(this,event,\''+value.jobId+"','"+value.ERECNO+"','"+params.billStatus+"','"+params.fromDate+"','"+params.toDate+"');\">"+value.JOBNAME+"</span></td>";for(var looper=0;looper<rdata.length;looper++){var data=rdata[looper];data.day=data.day-weekstarts,data.day<1&&(data.day=data.day+7),dayobj[data.day]=data.objval,void 0===jobobj[data.day]||""===jobobj[data.day]?jobobj[data.day]=data.objval:jobobj[data.day]=parseInt(jobobj[data.day])+data.objval}for(var i=1;i<=7;i++)dayobj[i]?(txt+='<td class="text-center">'+Calendar.minstohrs(dayobj[i])+"</td>",jobtotal+=dayobj[i]):txt+='<td class="text-center">00:00</td>';var tempSubKey=key.split("_")[1];void 0!==jobsTempObj[tempSubKey]?jobsTempObj[tempSubKey].hours+=jobtotal:(jobsTempObj[tempSubKey]={},jobsTempObj[tempSubKey].hours=jobtotal,jobsTempObj[tempSubKey].jobName=value.JOBNAME),txt+="0"!==jobtotal?'<th class="text-center">'+Calendar.minstohrs(jobtotal)+"</th>":'<th class="text-center">00:00</th>',txt+="</tr>"}if(Layout.Page.container.find("#timesheetreport").append(txt),isFromScroll||(0===cnt?(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"timelogreportdiv_charts"}),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"timelogreportdiv_list"}),Layout.Page.container.find("#timelog_charts,#timelog_list").hide()):(Layout.Page.container.find("div#zp_empty_data").hide(),Layout.Page.container.find("#timelog_charts,#timelog_list").show())),resData&&25===Object.keys(resData).length){var str=",";for(i=1;i<=7;i++)void 0!==jobobj[i]?str+=jobobj[i]+",":str+=",";$("#timesheettotal").attr("rowTotal",str),$("#timesheettotal").attr("grandtotal",gtotal),Layout.Page.container.find("#timesheettotal").hide()}else{for(Layout.Page.container.find("#timesheettotal").html(""),txt='<tr class="ZPLRow">',txt+='<th colspan="3" class="B0I"></th>',txt+="<th>"+ZPI18N.getString("zp.total")+"</th>",i=1;i<=7;i++)jobobj[i]?(txt+='<th class="text-center">'+Calendar.minstohrs(jobobj[i])+"</th>",gtotal+=parseInt(jobobj[i])):txt+='<th class="text-center">00:00</th>';txt+="0"!==gtotal?'<th class="text-center">'+Calendar.minstohrs(gtotal)+"</th>":'<th class="text-center">00:00</th>',txt+="</tr>",Layout.Page.container.find("#timesheettotal").html(txt),Layout.Page.container.find("#timesheettotal").show()}},constructWeekReport:function(fromdate,todate,downloadType,isFromChangeView){var params;if(isFromChangeView&&Timetracker.reports.timeLogReport.FireScroll&&Timetracker.reports.timeLogReport.FireScroll.params?(params=Timetracker.reports.timeLogReport.FireScroll.params,Timetracker.reports.timeLogReport.FireScroll.params.isChartView=!1,Layout.Page.container.find("#timelog_Report_Chart").hasClass("btn-primary")&&(Timetracker.reports.timeLogReport.FireScroll.params.isChartView=!0)):params=Timetracker.Filters.getAndValidateParams("WEEKTIMELOGREPORT"),params.fromDate=fromdate,params.toDate=todate,void 0!==downloadType){var form=Layout.Page.container.find("#downloadpdf");Layout.Page.container.find("#downloadpdf").attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheetDispAction.zp?mode=exportWeekTimesheet"),Layout.Page.container.find("#pdfidentity").val(csrfToken),Layout.Page.container.find("#pdfuserErecNo").val(params.userErecNo),Layout.Page.container.find("#pdffromDate").val(fromdate),Layout.Page.container.find("#pdftoDate").val(todate),Layout.Page.container.find("#pdfempStatus").val(params.employeeStatus),Layout.Page.container.find("#pdfempType").val(params.employeeType?params.employeeType:"0"),Layout.Page.container.find("#pdfbillStatus").val(params.billStatus),Layout.Page.container.find("#pdfbillingStatus").val(params.billingStatus),Layout.Page.container.find("#pdfjobStatus").val(params.jobStatus),Layout.Page.container.find("#pdfapprovalStatus").val(params.approvalStatus),Layout.Page.container.find("#pdfjobId").val(params.jobId),Layout.Page.container.find("#pdfprojectId").val(params.projectId),Layout.Page.container.find("#pdfclientId").val(params.clientId),Layout.Page.container.find("#pdflegalEntityId").val(params.legalEntityId),Layout.Page.container.find("#pdfbusinessUnitId").val(params.businessUnitId),Layout.Page.container.find("#pdfdivisionId").val(params.divisionId),Layout.Page.container.find("#pdfdeptId").val(params.deptId),Layout.Page.container.find("#pdfdesignationId").val(params.designationId),Layout.Page.container.find("#pdflocId").val(params.locId),Layout.Page.container.find("#pdfweekstarts").val(weekstarts),Layout.Page.container.find("#pdfmonthReport").val(!1),Layout.Page.container.find("#pdfisDirectSubOnlyNeeded").val(params.isDirectSubOnlyNeeded),Layout.Page.container.find("#pdfemployeeDateOfExitBased").val(params.employeeDateOfExitBased),Layout.Page.container.find("#fileType").val(downloadType),"pdf"!=downloadType?Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!1):Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!0),form.trigger("submit")}else{if(Timetracker.util.appendLoading(),!Layout.Page.container.find("#timelog_Report_Chart").hasClass("btn-primary")){var wstime=Calendar.weekfromdate.getTime(),weekStarts=new Date;for(weekStarts.setTime(wstime),i=0;i<7;i++){i>0&&weekStarts.setDate(weekStarts.getDate()+1);var date=Timetracker.util.convertDateTo2digit(weekStarts.getDate());Layout.Page.container.find("#day"+i).html("<span class='DB MB3'>"+months[weekStarts.getMonth()]+" "+date+"</span><span class='DB gry S13 ZPregI'>"+days[weekStarts.getDay()]+"</span>")}}Timetracker.reports.timeLogReport.FireScroll.mode=Timetracker.constants.WEEK,isFromChangeView||(Layout.Page.container.find("#timelog_list").off("scroll").scrollTop(0),Timetracker.reports.timeLogReport.FireScroll.resetDataOnLoad(),params.sIndex=0),Timetracker.reports.timeLogReport.FireScroll.params=params,$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.reports.timeLogReport.istimelogreportdatafetched=!0,isFromChangeView||Layout.Page.container.find("#timesheetreport").html("");var resData=resultData[0],cnt=0;if(Layout.Page.container.find("#timelog_Report_Chart").hasClass("btn-primary")){if((cnt=resData?Object.keys(resData).length:0)>0){var extraDtls={a:1,b:4};Timetracker.reports.timeLogReport.drawHighChartsForWeekReport(resData,null,extraDtls),Layout.Page.container.find("#timelogreportdiv_charts").show()}Layout.Page.container.find("#timelogreportdiv_list").attr("chartViewDataFetched",!0),isFromChangeView||Layout.Page.container.find("#timelogreportdiv_list").attr("listViewDataFetched",!1),0===cnt?(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"timelogreportdiv_charts"}),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"timelogreportdiv_list"}),Layout.Page.container.find("#timelog_charts,#timelog_list").hide()):(Layout.Page.container.find("div#zp_empty_data").hide(),Layout.Page.container.find("#timelog_charts,#timelog_list").show())}else ZPeople.FireScroll.init(Timetracker.reports.timeLogReport.FireScroll.loadMoreTimeLogData),Timetracker.reports.timeLogReport.constructWeekTimesheetReport(resData,params),Timetracker.reports.timeLogReport.FireScroll.setFetchCount(resData),Timetracker.reports.timeLogReport.FireScroll.resetFireScroll(resData),Layout.Page.container.find("#timelogreportdiv_list").attr("listViewDataFetched",!0),isFromChangeView||Layout.Page.container.find("#timelogreportdiv_list").attr("chartViewDataFetched",!1);Layout.Page.container.find("#timelog_Report_Chart").hasClass("btn-primary")?(Layout.Page.container.find("#timelogreportdiv_list").hide(),Layout.Page.container.find("#timelogreportdiv_charts").show()):(Layout.Page.container.find("#timelogreportdiv_charts").hide(),Layout.Page.container.find("#timelogreportdiv_list").show(),ZPView.handleTablePosition()),Timetracker.util.removeLoading()})}},drawHighChartsForWeekReport:function(jobsTempObj,jobobj,extraDtls){var chartColors=["#f0989a","#fccaa1","#ffe5a3","#b2d7ad","#9fc5c9","#9cc6e5","#b6a7d2","#d9a6bb"];Highcharts.setOptions({colors:chartColors});var cat=[],dat=[],i=0,j=0,txt="<ul>";for(var x in jobsTempObj)cat[i]=jobsTempObj[x].jobName,dat[i]=jobsTempObj[x].hours/60,txt+='<li><div style="background-color:'+chartColors[j++]+'"></div><desc>'+cat[i]+"</desc><span>"+dat[i].toFixed(2)+"</span></li>",cat[i]=ZPeople.decodeTxt(jobsTempObj[x].jobName),i++,8===j&&(j=0);txt+="</ul>",Layout.Page.container.find("#report"+extraDtls.a+"_list,#report"+extraDtls.b+"_list").html(txt);new Highcharts.Chart({chart:{renderTo:"report"+extraDtls.a,type:"column",plotBorderWidth:1,plotBorderColor:"#f3f3f3",spacingBottom:50,spacingTop:10,spacingLeft:10,spacingRight:50},credits:{enabled:!1},title:{text:ZPeople.decodeTxt(Timetracker.util.jobDispName)+" Vs "+ZPI18N.getString("zp.hours"),align:"left",x:50,style:{color:"black",fontWeight:"bold"}},xAxis:{title:{text:ZPeople.decodeTxt(Timetracker.util.jobDispName),style:{color:"black",fontWeight:"bold",fontSize:"14px"}},categories:cat,labels:{rotation:-45}},yAxis:{title:{text:ZPI18N.getString("zp.hours"),style:{color:"black",fontWeight:"bold",fontSize:"14px"}},gridLineColor:"#f3f3f3"},tooltip:{formatter:function(){return this.x+","+Math.round(100*this.point.y)/100}},legend:{enabled:!1},exporting:{enabled:!1,buttons:{contextButton:{theme:{states:{hover:{stroke:"#bfbfbf",fill:null},select:{stroke:"#bfbfbf",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"TimelogChart-JobsVsHours"},plotOptions:{column:{colorByPoint:!0,pointPadding:.3,borderWidth:0,borderRadius:0,dataLabels:{enabled:!0,formatter:function(){return 0===this.point.y?"0":Math.round(100*this.point.y)/100},style:{fontWeight:"normal",fontSize:"13px",fontFamily:"Verdana, sans-serif"}}}},series:[{data:dat}]});for(var arr=[],s=0;s<cat.length;s++)arr[s]=new Array(cat[s],dat[s]);new Highcharts.Chart({chart:{renderTo:"report"+extraDtls.b,type:"pie",plotShadow:!1,spacingBottom:50,spacingTop:10,spacingLeft:50,spacingRight:50,plotBorderColor:"#f3f3f3",plotBorderWidth:1},credits:{enabled:!1},title:{text:ZPI18N.getString("zp.dayscomparison"),align:"left",style:{color:"black",fontWeight:"bold"}},tooltip:{percentageDecimals:2,pointFormat:"{point.name} ,<b>{point.percentage:.2f}%</b>"},legend:{enabled:!1},exporting:{enabled:!1,buttons:{contextButton:{theme:{states:{hover:{stroke:"#bfbfbf",fill:null},select:{stroke:"#bfbfbf",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"TimelogChart-DaysComparison"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return this.point.name+","+Math.round(100*this.point.y)/100},style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black",fontWeight:"normal"}},style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},series:[{type:"pie",data:arr}]})},daysofWeek:[ZPI18N.getString("zp.sun"),ZPI18N.getString("zp.mon"),ZPI18N.getString("zp.tue"),ZPI18N.getString("zp.wed"),ZPI18N.getString("zp.thu"),ZPI18N.getString("zp.fri"),ZPI18N.getString("zp.sat")],generateMonthReportNext:function(){var d=Calendar.getNextMonth();Timetracker.reports.timeLogReport.tmpDate=d;var fromdate=Calendar.formatDate(d.from),todate=Calendar.formatDate(d.to),month=d.from.getMonth(),year=d.from.getFullYear();this.constructMonthReport(fromdate,todate,month,year)},generateMonthReportPrevious:function(){var d=Calendar.getPreviousMonth();Timetracker.reports.timeLogReport.tmpDate=d;var fromdate=Calendar.formatDate(d.from),todate=Calendar.formatDate(d.to),month=d.from.getMonth(),year=d.from.getFullYear();this.constructMonthReport(fromdate,todate,month,year)},constructMonthTimesheetReport:function(result,month,year,fromdate,todate,userErecNo,billStatus,isFromFireScroll){var d=new Date(year,month+1,0),maxDays=d.getDate(),reportText="",empData=[],subreportText=[],counter=0,grandtotal=0,rowTotal=[],empTotal=[],dayObj=[];isFromFireScroll&&(grandtotal=parseInt($("#monthtotal").attr("grandtotal")),rowTotal=$("#monthtotal").attr("rowTotal").split(","));var keys=new Array;for(k in result)keys.push(k);keys.sort();for(var len=keys.length,tempI=0;tempI<len;tempI++){var key=keys[tempI];dayObj[key]=[],subreportText="",reportText+='<tr class="ZPLRow" id="'+key+'">';for(var subArray=result[key],days=1;days<=maxDays;days++){for(var km=0;km<subArray.length;km++){var subObj=subArray[km];if(subObj[""+days]){dayObj[key][days]=subObj[""+days].objval;var hoursVal=subObj[""+days].objval,clientName="---",projectName="---";void 0!==subObj[""+days].CLIENTNAME&&(clientName=subObj[""+days].CLIENTNAME),void 0!==subObj[""+days].PROJECTNAME&&(projectName=subObj[""+days].PROJECTNAME),empData[counter]='<td><img class="FL" src="'+subObj[""+days].EMPLOYEEPHOTO+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+subObj[""+days].EMPNAME+'"><b>'+subObj[""+days].EMPLOYEEID+"</b> "+subObj[""+days].EMPNAME+"</span></div></td>",empData[counter]+='<td><span class="ellipsis" title="'+clientName+'">'+clientName+"</span></td>",empData[counter]+='<td><span class="ellipsis" title="'+projectName+'">'+projectName+"</span></td>",empData[counter]+='<td class="MoreLoad"><span class="ellipsis CP" title="'+subObj[""+days].JOBNAME+'" onclick="Timetracker.reports.jobReport.showCorrespondinglogs(this,event,\''+subObj[""+days].jobId+"','"+subObj[""+days].ERECNO+"','"+billStatus+"','"+fromdate+"','"+todate+"');\">"+subObj[""+days].JOBNAME+"</span></td>",void 0!==rowTotal[days]&&""!==rowTotal[days]?rowTotal[days]=parseInt(rowTotal[days])+hoursVal:rowTotal[days]=hoursVal,void 0!==empTotal[key]?empTotal[key]+=hoursVal:empTotal[key]=hoursVal,grandtotal+=hoursVal}}void 0!==dayObj[key][days]?subreportText+='<td class="text-center">'+Calendar.minstohrs(dayObj[key][days])+"</td>":subreportText+='<td class="text-center">00:00</td>'}reportText+=empData[counter]+subreportText+"<th>"+Calendar.minstohrs(empTotal[key])+"</th></tr>",counter++}if(25!==Object.keys(result).length){for(var totalText='<tr class="ZPLRow"><th colspan="3" class="B0I"></th><th>'+ZPI18N.getString("zp.total")+"</th>",day=1;day<=maxDays;day++)void 0!==rowTotal[day]&&""!==rowTotal[day]?totalText+='<th class="text-center">'+Calendar.minstohrs(rowTotal[day])+"</th>":totalText+='<th class="text-center">00:00</th>';totalText+="<th>"+Calendar.minstohrs(grandtotal)+"</th></tr>",Layout.Page.container.find("#monthtotal").html(totalText),Layout.Page.container.find("#monthtotal").show()}else{var str=",";for(day=1;day<=maxDays;day++)void 0!==rowTotal[day]?str+=rowTotal[day]+",":str+=",";$("#monthtotal").attr("rowTotal",str),$("#monthtotal").attr("grandtotal",grandtotal),Layout.Page.container.find("#monthtotal").hide()}if(Layout.Page.container.find("#monthfullcontent").append(reportText),!isFromFireScroll){for(var i=1;i<=maxDays;i++){d.setDate(i);var date=Timetracker.util.convertDateTo2digit(i);Layout.Page.container.find("#monthday"+i).html('<span class="DB MB3">'+months[month]+" "+date+'</span><span class="DB gry S13 ZPregI">'+Timetracker.reports.timeLogReport.daysofWeek[d.getDay()]+"</span>")}Layout.Page.container.find("[id^='monthday']").show();for(var k=maxDays;k<31;k++)Layout.Page.container.find("#monthday"+(k+1)).hide()}},constructMonthReport:function(fromdate,todate,month,year,downloadType){var params=Timetracker.Filters.getAndValidateParams("MONTHTIMELOGREPORT");if(params.fromDate=fromdate,params.toDate=todate,Layout.Page.container.find("#calmonth5").html(months[month]+" "+year),Layout.Page.container.find("#calmonth5").addClass("mon").removeClass("day wek"),void 0!==downloadType){var form=Layout.Page.container.find("#downloadpdf");Layout.Page.container.find("#downloadpdf").attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheetDispAction.zp?mode=exportWeekTimesheet"),Layout.Page.container.find("#pdfidentity").val(csrfToken),Layout.Page.container.find("#pdfuserErecNo").val(params.userErecNo),Layout.Page.container.find("#pdffromDate").val(fromdate),Layout.Page.container.find("#pdftoDate").val(todate),Layout.Page.container.find("#pdfempStatus").val(params.employeeStatus),Layout.Page.container.find("#pdfempType").val(params.employeeType?params.employeeType:"0"),Layout.Page.container.find("#pdfbillStatus").val(params.billStatus),Layout.Page.container.find("#pdfbillingStatus").val(params.billingStatus),Layout.Page.container.find("#pdfjobStatus").val(params.jobStatus),Layout.Page.container.find("#pdfapprovalStatus").val(params.approvalStatus),Layout.Page.container.find("#pdfjobId").val(params.jobId),Layout.Page.container.find("#pdfprojectId").val(params.projectId),Layout.Page.container.find("#pdfclientId").val(params.clientId),Layout.Page.container.find("#pdflegalEntityId").val(params.legalEntityId),Layout.Page.container.find("#pdfbusinessUnitId").val(params.businessUnitId),Layout.Page.container.find("#pdfdivisionId").val(params.divisionId),Layout.Page.container.find("#pdfdeptId").val(params.deptId),Layout.Page.container.find("#pdfdesignationId").val(params.designationId),Layout.Page.container.find("#pdflocId").val(params.locId),Layout.Page.container.find("#pdfweekstarts").val(weekstarts),Layout.Page.container.find("#pdfmonthReport").val(!0),Layout.Page.container.find("#fileType").val(downloadType),Layout.Page.container.find("#pdfisDirectSubOnlyNeeded").val(params.isDirectSubOnlyNeeded),Layout.Page.container.find("#pdfemployeeDateOfExitBased").val(params.employeeDateOfExitBased),"pdf"!=downloadType?Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!1):Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!0),form.trigger("submit")}else Timetracker.util.appendLoading(),Timetracker.reports.timeLogReport.FireScroll.resetDataOnLoad(),Timetracker.reports.timeLogReport.FireScroll.params=params,Timetracker.reports.timeLogReport.FireScroll.params.month=month,Timetracker.reports.timeLogReport.FireScroll.params.year=year,params.sIndex=0,Timetracker.reports.timeLogReport.FireScroll.mode=Timetracker.constants.MONTH,Layout.Page.container.find("#monthtimelog_list").off("scroll").scrollTop(0),$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.reports.timeLogReport.istimelogreportdatafetched=!0,Layout.Page.container.find("#monthfullcontent").html(""),0===Object.keys(resultData).length?(Layout.Page.container.find("#monthreport").find("div.table-responsive").hide(),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",type:"prepend",id:"monthreport"})):(Layout.Page.container.find("#monthreport").find("div.table-responsive").fadeIn(200),Layout.Page.container.find("#monthreportbody").fadeIn(200),Layout.Page.container.find("#monthreport").find("#zp_empty_data").hide(),ZPeople.FireScroll.init(Timetracker.reports.timeLogReport.FireScroll.loadMoreTimeLogData),Timetracker.reports.timeLogReport.constructMonthTimesheetReport(resultData,month,year,fromdate,todate,params.userErecNo,params.billStatus),Timetracker.reports.timeLogReport.FireScroll.setFetchCount(resultData),Timetracker.reports.timeLogReport.FireScroll.resetFireScroll(resultData),ZPView.handleTablePosition()),Timetracker.util.removeLoading()})},changeViews:function(isChartView,obj){var id;Layout.Page.container.find(obj).removeClass("btn-default").addClass("btn-primary").siblings().removeClass("btn-primary").addClass("btn-default"),id="timelog_Report_Chart"===obj.id||"timelog_Report_List"===obj.id?"timelog":"daytimelog";var datFetchedId=isChartView?"chartViewDataFetched":"listViewDataFetched";if("true"!=Layout.Page.container.find("#"+id+"reportdiv_list").attr(datFetchedId))if("daytimelog"===id){var date=Calendar.formatDate(Timetracker.reports.timeLogReport.tmpDate.day);Timetracker.reports.timeLogReport.constructDayReport(date,void 0,!0)}else{var fromdate=Calendar.formatDate(Timetracker.reports.timeLogReport.tmpDate.from),todate=Calendar.formatDate(Timetracker.reports.timeLogReport.tmpDate.to);Timetracker.reports.timeLogReport.constructWeekReport(fromdate,todate,void 0,!0)}else Timetracker.reports.timeLogReport.FireScroll.params.isChartView=!!isChartView;isChartView?(Layout.Page.container.find("#"+id+"reportdiv_charts").fadeIn(200),Layout.Page.container.find("#"+id+"reportdiv_list").hide()):(Layout.Page.container.find("#"+id+"reportdiv_charts").hide(),Layout.Page.container.find("#"+id+"reportdiv_list").fadeIn(200),ZPView.handleTablePosition())},generatePrintReport:function(){var isChart=!1;Layout.Page.container.find("#timelog_Report_Chart:visible").hasClass("btn-primary")&&(isChart=!0),Timetracker.util.printReport(null,isChart,Layout.Page.container.find("#rUser").val(),Layout.Page.container.find(".well.ZPPhed").find("nav:visible").find("[id^='calmonth']").text())},FireScroll:{FETCHED_COUNT:0,MAX_FETCH_COUNT:25,resetDataOnLoad:function(){Timetracker.reports.timeLogReport.FireScroll.resetFetchCount(),Timetracker.reports.timeLogReport.FireScroll.params={},ZPeople.FireScroll.reset()},setFetchCount:function(resultData){Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT)?Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT:0,Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT+=resultData?Object.keys(resultData).length:0},resetFetchCount:function(){Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT=0},getFetchCount:function(){return Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT)?Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT:0,0===Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT?Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT:Timetracker.reports.timeLogReport.FireScroll.FETCHED_COUNT+1},loadMoreTimeLogData:function(){var params=Timetracker.reports.timeLogReport.FireScroll.params;params.sIndex=Timetracker.reports.timeLogReport.FireScroll.getFetchCount(),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.reports.timeLogReport.FireScroll.constructTimelogReportOnFireScrollTrigger)},resetFireScroll:function(resultData){resultData&&Object.keys(resultData).length===Timetracker.reports.timeLogReport.FireScroll.MAX_FETCH_COUNT?ZPeople.FireScroll.reset():resultData&&Object.keys(resultData).length<Timetracker.reports.timeLogReport.FireScroll.MAX_FETCH_COUNT&&ZPeople.FireScroll.setParam("triggered",!0)},constructTimelogReportOnFireScrollTrigger:function(result,params){if(result)if(Timetracker.reports.timeLogReport.FireScroll.mode==Timetracker.constants.WEEK&&(result=result[0]),Timetracker.reports.timeLogReport.FireScroll.setFetchCount(result),Timetracker.reports.timeLogReport.FireScroll.resetFireScroll(result),Timetracker.reports.timeLogReport.FireScroll.mode==Timetracker.constants.MONTH){params=Timetracker.reports.timeLogReport.FireScroll.params;Timetracker.reports.timeLogReport.constructMonthTimesheetReport(result,params.month,params.year,params.fromDate,params.toDate,params.userErecNo,params.billStatus,!0)}else Timetracker.reports.timeLogReport.FireScroll.mode==Timetracker.constants.CUSTOM?Timetracker.reports.timeLogReport.constructCustomTimesheetReport(result,Timetracker.reports.timeLogReport.FireScroll.params,!1,!0):Timetracker.reports.timeLogReport.FireScroll.mode==Timetracker.constants.DAY?Timetracker.reports.timeLogReport.constructCustomTimesheetReport(result,Timetracker.reports.timeLogReport.FireScroll.params,!0,!0):Timetracker.reports.timeLogReport.FireScroll.mode==Timetracker.constants.WEEK&&Timetracker.reports.timeLogReport.constructWeekTimesheetReport(result,Timetracker.reports.timeLogReport.FireScroll.params,!0)}}},Timetracker.reports.clientReport={clientId:null,billMethod:new Array(ZPI18N.getString("zp.hourlyjobrate"),ZPI18N.getString("zp.hourlyuserrate"),ZPI18N.getString("zp.hourlyjobuserrate"),ZPI18N.getString("zp.hourlyprouserrate")),initClientReport:function(){Timetracker.isDataAdminForAllUsers()?(Timetracker.initSetup(),Timetracker.reports.clientReport.getClientReport(),Layout.Page.container.find("#zp_client_report").show(),Layout.Page.container.find("#zp_client_report h5")[0].innerHTML=Timetracker.util.clientDispName+" "+ZPI18N.getString("zp.report")):Timetracker.util.appendPermissionDenied()},getClientReport:function(mode,params,downloadType){if(void 0!==downloadType){var form=Layout.Page.container.find("#clientdownloadpdf");Layout.Page.container.find("#clientdownloadpdf").attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheetDispAction.zp?mode=exportClientReport"),Layout.Page.container.find("#clientpdfidentity").val(csrfToken),Layout.Page.container.find("#fileType").val(downloadType),form.trigger("submit")}else{Layout.Page.container.find("#repclientlist").off("scroll"),Layout.Page.container.find("#repclientlist").scrollTop(0),Timetracker.reports.clientReport.FireScroll.resetDataOnLoad(),Layout.Page.container.find("#repclientlist,#zp_empty_data").hide(),Timetracker.util.appendLoading(),(params=Timetracker.Filters.getAndValidateParams("CLIENTREPORT")).startIndex=Timetracker.reports.clientReport.FireScroll.getFetchCount(),$.post(Timetracker.constants.URL,params,function(resultData){ZPeople.FireScroll.init(Timetracker.reports.clientReport.FireScroll.loadMoreClientData),Timetracker.reports.clientReport.constructReport(resultData),Timetracker.util.removeLoading()})}},constructReport:function(result){Layout.Page.container.find("#repclient-listtbody").html(""),0===result.length?(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.notfound",[Timetracker.util.clientDispName]),{classname:"CR-tt-clients",path:"path6"}),Layout.Page.container.find("#repclientlist").fadeOut(200)):(Timetracker.reports.clientReport.FireScroll.setFetchCount(result),Timetracker.reports.clientReport.FireScroll.resetFireScroll(result),Timetracker.reports.clientReport.constructReportHtml(result),Layout.Page.container.find("#repclientlist").fadeIn(200),Layout.Page.container.find("#zp_empty_data").fadeOut(200),ZPView.handleTablePosition())},constructReportHtml:function(result){$.each(result,function(index,data){data.totalHours||(data.totalHours=0);var txt='<tr class="ZPLRow">';txt+='<td onclick="Timetracker.reports.clientReport.showViewPage(this);" title="'+data.clientName+'" class="CP">'+data.clientName+"</td>",txt+="<td>"+Calendar.minstohrs(data.billable)+"</td>",txt+="<td>"+Calendar.minstohrs(data.nonBillable)+"</td>",txt+="<td>"+Calendar.minstohrs(data.totalHours)+"</td>",txt+="<td></td></tr>",(txt=$(txt)).data(data),$("#repclient-listtbody").append(txt)})},showViewPage:function(obj){var modal=Layout.Page.container.find("#repclientsummary");if(0==modal.length){var json=Timetracker.reports.clientReport.constructViewPagePopup();modal=ZPeople.BSModal.get(json);var footer='<button data-dismiss="modal" type="button" class="btn btn-default btn-md">'+ZPI18N.getString("zp.close")+"</button>";modal.find(".modal-footer").html(footer)}var data=$(obj).parent().data(),clientId=data.clientId;Timetracker.reports.clientReport.clientId=clientId,Layout.Page.container.find("#repclientsummary").find("#repbilling-viewclientName").html(data.clientName),"-1"!=data.billingMethod?Layout.Page.container.find("#repclientsummary").find("#repbilling-viewbillingMethod").text(Timetracker.reports.clientReport.billMethod[data.billingMethod]):Layout.Page.container.find("#repclientsummary").find("#repbilling-viewbillingMethod").text("-"),$.post("/timesheet.zp",{mode:"getBillingLogs",clientId:clientId,conreqcsr:csrfToken},function(result){var data=result[0],billedHours=0,unBilledHours=0,nonBillableHours=0;data.billedHours&&(billedHours=data.billedHours),data.unBilledHours&&(unBilledHours=data.unBilledHours),data.nonBillableHours&&(nonBillableHours=data.nonBillableHours),Layout.Page.container.find("#repclientsummary").find("#repclient-billedhours").html(Calendar.minstohrs(billedHours)+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#repclientsummary").find("#repclient-nonbillablehours").html(Calendar.minstohrs(nonBillableHours)+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#repclientsummary").find("#repclient-unbilledhours").html(Calendar.minstohrs(unBilledHours)+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#repclientsummary").find("#repclient-totalhours").html(Calendar.minstohrs(Number(billedHours)+Number(unBilledHours)+Number(nonBillableHours))+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#repclientsummary").find(".PArds").parent().remove(),Timetracker.util.init(),Timetracker.projects.Listing.groupAccordingToProjects(data.projects,!1,"repclient-jobtbody"),ZPeople.BSModal.show(modal)})},getCRMclient:function(clientName){var json=Timetracker.reports.clientReport.constructViewPagePopup();modal=ZPeople.BSModal.get(json),ZPeople.BSModal.show(modal),$("#repclientsummary").css("left","0px"),$("#repclientsummary").css("top","70px"),$(".modal-backdrop").css("top","70px"),$(".close").hide(),$(".modal-footer").hide(),$("#generateBillModal").attr("onclick","").off("click"),$("#generateBillModal").removeClass("CP"),$.post("/timesheet.zp",{mode:"getBillingLogs",crmclient:clientName,conreqcsr:csrfToken},function(result){var data=result[0],billedHours=0,unBilledHours=0,nonBillableHours=0;data.billedHours&&(billedHours=data.billedHours),data.unBilledHours&&(unBilledHours=data.unBilledHours),data.nonBillableHours&&(nonBillableHours=data.nonBillableHours),$("#repbilling-viewclientName").text(data.clientName),"-1"!==data.billingMethod?$("#repbilling-viewbillingMethod").text(Timetracker.reports.clientReport.billMethod[data.billingMethod]):$("#repbilling-viewbillingMethod").text("-"),$("#repclient-billedhours").html(Calendar.minstohrs(billedHours)+" "+ZPI18N.getString("zp.hrs")),$("#repclient-nonbillablehours").html(Calendar.minstohrs(nonBillableHours)+" "+ZPI18N.getString("zp.hrs")),$("#repclient-unbilledhours").html(Calendar.minstohrs(unBilledHours)+" "+ZPI18N.getString("zp.hrs")),$("#repclient-totalhours").html(Calendar.minstohrs(Number(billedHours)+Number(unBilledHours)+Number(nonBillableHours))+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#repclientsummary").find(".PArds").parent().remove(),Timetracker.util.init(),Timetracker.projects.Listing.groupAccordingToProjects(data.projects,!1,"repclient-jobtbody")})},constructViewPagePopup:function(){var body='<div class="row"><div class="col-sm-6"><form class="form-horizontal pad" role="form"><div class="form-group"><label class="control-label col-sm-4"><b>'+ZPI18N.getString("zp.clientname")+' :</b></label><div class="col-sm-8"><div class="PT5" id="repbilling-viewclientName"></div></div></div><div class="form-group"><label class="control-label col-sm-4"><b>'+ZPI18N.getString("zp.billingmethod")+' :</b></label><div class="col-sm-8"><div class="PT5" id="repbilling-viewbillingMethod"></div></div></div></form></div><div class="col-sm-6"><label class="MT10 MB10"><b>'+ZPI18N.getString("zp.summary")+'</b></label><div class="row"><div class="col-sm-3"><div class="Dtyps ZPBC12"><span>'+ZPI18N.getString("zp.loggedhours")+'</span><div class="gry" id="repclient-totalhours"></div></div></div><div class="col-sm-3"><div class="Dtyps ZPBC3"><span>'+ZPI18N.getString("zp.nonbillablehours")+'</span><div class="gry" id="repclient-nonbillablehours"></div></div></div><div class="col-sm-3"><div class="Dtyps ZPBC3"><span>'+ZPI18N.getString("zp.billedhrs")+'</span><div class="gry" id="repclient-billedhours"></div></div></div><div class="col-sm-3"><div id="generateBillModal" class="Dtyps ZPBC11 CP" onclick="TimetrackerOperations.billing.generateBillForClientReport()"><span>'+ZPI18N.getString("zp.unbilledhrs")+'</span><div class="gry" id="repclient-unbilledhours"></div></div></div></div></div></div><div class="zpl_dtbl" ><ul><li class="w400"><b class="form_projectname">'+ZPI18N.getString("zp.projectname")+'</b></li><li class="mw50"></li><li class="mw200"><b>'+ZPI18N.getString("zp.estimatedhours")+'</b></li><li class="mw200"><b>'+ZPI18N.getString("zp.loggedhours")+'</b></li><li class="mw150"><b>'+ZPI18N.getString("zp.status")+'</b></li><li class="w100" ><b class="form_jobs ellipsis WP90">'+ZPI18N.getString("zp.jobs")+'</b></li></ul><div id="repClient-jobTbody"></div></div></div>';return{id:"repclientsummary",type:2,modalClass:"popRgtModel PopLgModel",header:ZPI18N.getString("zp.clientsummary",[Timetracker.util.clientDispName]),body:body}},FireScroll:{FETCHED_COUNT:0,MAX_FETCH_COUNT:25,resetDataOnLoad:function(){Timetracker.reports.clientReport.FireScroll.resetFetchCount(),ZPeople.FireScroll.reset()},setFetchCount:function(result){Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT)?Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT:0,Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT+=result.length},resetFetchCount:function(){Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT=0},getFetchCount:function(){return Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT=ZPUtil.Validation.isNumber(Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT)?Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT:0,0===Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT?Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT:Timetracker.reports.clientReport.FireScroll.FETCHED_COUNT+1},loadMoreClientData:function(limit){var params={mode:"getClientReport",conreqcsr:csrfToken};params.startIndex=Timetracker.reports.clientReport.FireScroll.getFetchCount(),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.reports.clientReport.FireScroll.constructClientDataOnFireScrollTrigger)},resetFireScroll:function(result){result.length===Timetracker.reports.clientReport.FireScroll.MAX_FETCH_COUNT?ZPeople.FireScroll.reset():result.length<Timetracker.reports.clientReport.FireScroll.MAX_FETCH_COUNT&&ZPeople.FireScroll.setParam("triggered",!0)},constructClientDataOnFireScrollTrigger:function(result,params){result&&(Timetracker.reports.clientReport.FireScroll.setFetchCount(result),Timetracker.reports.clientReport.FireScroll.resetFireScroll(result),0!==result.length&&Timetracker.reports.clientReport.constructReportHtml(result))}}},Timetracker.reports.billing={BillEditRow:{data:null,editMode:!1,viewMode:!1},BillingCriteria:{},taxforBill:null,currenciesData:null,qbopushdata:{},isQBOEnabled:!1,isZBEnabled:!1,isZIEnabled:!1,isPushBillEnabled:!1,initBillingReport:function(){Timetracker.isDataAdminForAllUsers()?(Timetracker.initSetup(),Timetracker.reports.billing.getBills(),Layout.Page.container.find("#zp_billing_report").show()):Timetracker.util.appendPermissionDenied()},getBills:function(){Layout.Page.container.find("#zp_empty_data,#billingreportdiv").hide();var params=Timetracker.Filters.getAndValidateParams("BILLINGREPORT");params.sIndex=0,params.limit=25,Timetracker.util.appendLoading(),$.post(Timetracker.constants.URL,params,function(resultData){resultData.isZBEnabled&&(Timetracker.reports.billing.isZBEnabled=resultData.isZBEnabled),resultData.isZIEnabled&&(Timetracker.reports.billing.isZIEnabled=resultData.isZIEnabled),resultData.isQBOEnabled&&(Timetracker.reports.billing.isQBOEnabled=resultData.isQBOEnabled),Timetracker.reports.billing.isPushBillEnabled=Timetracker.reports.billing.isZBEnabled||Timetracker.reports.billing.isZIEnabled||Timetracker.reports.billing.isQBOEnabled,Timetracker.reports.billing.construct(resultData.billDetails),!Timetracker.FireScroll.hasScrollBar()&&Timetracker.FireScroll.getFirescrollDtls(Timetracker.constants.MODES.BILLING_REPORT)&&25==Timetracker.FireScroll.getFirescrollDtls(Timetracker.constants.MODES.BILLING_REPORT).fetchedCount&&Timetracker.FireScroll.loadMoreData(Timetracker.FireScroll.getFirescrollDtls(Timetracker.constants.MODES.BILLING_REPORT)),Timetracker.util.removeLoading()})},construct:function(result){0===result.length?(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.nodatafound"),{classname:"CR-nodata-rpt",path:"path6"}),Layout.Page.container.find("#zp_empty_data").fadeIn(200),Layout.Page.container.find("#billingreportdiv").fadeOut(200)):(Layout.Page.container.find("#billing-listtbody").html(""),Layout.Page.container.find("#tt_push_bills").show(),Timetracker.reports.billing.constructBillRow(result),Layout.Page.container.find("#billingreportdiv").fadeIn(200).scrollTop(0),Layout.Page.container.find("#billing-listtbody").show(),Layout.Page.container.find("#zp_empty_data").fadeOut(200),Timetracker.reports.billing.isPushBillEnabled||Layout.Page.container.find("#tt_push_bills").hide(),ZPView.handleTablePosition()),Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.BILLING_REPORT,Timetracker.constants.URL,Timetracker.Filters.getAndValidateParams("BILLINGREPORT"),Timetracker.reports.billing.constructBillsOnFireScrollTrigger),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.BILLING_REPORT,result)},constructBillsOnFireScrollTrigger:function(resultData,params){Timetracker.reports.billing.constructBillRow(resultData.billDetails),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.BILLING_REPORT,resultData.billDetails)},constructBillRow:function(result){$.each(result,function(index,data){var txt='<tr id="'+data.billingId+'" class="ZPLRow">';if(txt+='<td class="CP" onclick="Timetracker.reports.billing.viewBill(\''+data.billingId+"');\">"+data.billno+"</td>",data.clientName||(data.clientName=""),txt+="<td>"+data.clientName+"</td>",txt+="<td>"+data.billDate+"</td>",txt+="<td>"+data.dueDate+"</td>",txt+="<td>"+Number(data.totalAmount).toFixed(2)+' <span class="dgry">'+data.currencyCode+"</span></td>",Timetracker.reports.billing.isPushBillEnabled){if(txt+="<td>",Timetracker.reports.billing.isZIEnabled&&(txt+='<i class="SP-invoice MR10" data-toggle="tooltip" title="'+ZPI18N.getString("zp.tt.pushtoinvoice")+'" onclick="Timetracker.reports.billing.pushToInvoice(\''+data.billingId+"','"+data.isPushedToInvoice+"');\"></i>"),Timetracker.reports.billing.isZBEnabled&&(txt+='<i class="SP-books MR10" data-toggle="tooltip" title="'+ZPI18N.getString("zp.tt.pushtobooks")+'" onclick="Timetracker.reports.billing.pushToInvoice(\''+data.billingId+"','"+data.isPushedToBooks+"',undefined,1);\"></i>"),Timetracker.reports.billing.isQBOEnabled){var qbclass="SP-qbooks",qbtitle=ZPI18N.getString("zp.tt.qbotimebutpush");data.isPushedToQBO&&(qbclass="SP-qbooks ZPInact",qbtitle=ZPI18N.getString("zp.tt.qbotimebutpushed")),txt+='<i class="'+qbclass+'" data-toggle="tooltip" title="'+qbtitle+'" onclick="Timetracker.reports.billing.pushToQBO(\''+data.billingId+"','"+data.isPushedToQBO+"');\"></i>"}txt+="</td>"}txt+="<td><i onclick=\"Timetracker.reports.billing.showSendMailPopup('"+data.billingId+'\',this);" data-toggle="tooltip"  title="'+ZPI18N.getString("zp.tt.seninvoiceviamail")+'" class="IC-mail2x S16 gry DIB ML30 CP"></i></td>',txt+='<td class="text-right P0I">',txt+='<div id="action_button" class="over-display">',txt+="<i onclick=\"Timetracker.util.showHideConfirmDeleteButtons(this,'action_confirm_button','table-responsive');\" title=\""+ZPI18N.getString("zp.delete")+'" class="IC-delete S14 gry FR MR15 CP"></i><i title="'+ZPI18N.getString("zp.edit")+'" onclick="Timetracker.reports.billing.confirmEditBill(\''+data.billingId+'\');" class="IC-pen S14 gry FR MR15 CP"></i></div>',txt+='<div id="action_confirm_button" style="display:none"><button type="button" class="btn btn-default btn-sm FR MR15" onclick="Timetracker.util.showHideConfirmDeleteButtons(this,\'action_button\',\'table-responsive\');">'+ZPI18N.getString("zp.cancel")+'</button><button type="button" class="btn btn-danger btn-sm FR MR10" onclick="Timetracker.reports.billing.deleteBill(\''+data.billingId+"');\">"+ZPI18N.getString("zp.confirm")+"</button></div></td>",txt+="</tr>",(txt=$(txt)).data(data),Layout.Page.container.find("#billing-listtbody").append(txt)})},createTypechange:function(obj){"6"===$(obj).val()?(Layout.Page.container.find("#addBillsPage").find("#billing-fromdate,#billing-todate").val(""),Layout.Page.container.find("#addBillsPage").find("#tcustomfromtodate").show()):Layout.Page.container.find("#addBillsPage").find("#tcustomfromtodate").hide()},constructAddPagePopup:function(){0==Layout.Page.container.find("#addBillsPage").length&&Timetracker.util.constructTwoStepsModal({id:"addBillsPage",step1Id:"billGenerateStep1",step2Id:"billGenerateStep2"}),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep1").find(".addPopTitle").text(ZPI18N.getString("zp.generatebill"));var body='<div class="row"><div class="col-sm-7"><form class="form-horizontal pad" role="form"><div class="form-group"><label class="control-label col-sm-4"><span class="red">*</span> '+ZPI18N.getString("zp.client")+' :</label><div class="col-sm-6"><input id="billing-client" onchange="Timetracker.projects.Filters.updateProjectListForFilters(true, Layout.Page.container.find(\'#billing-user\').val(), this.value, \'billing\');"></input></div></div><div class="form-group"><label class="control-label col-sm-4">'+ZPI18N.getString("zp.period")+' :</label><div class="col-sm-6"><select id="billingperiod" onchange="Timetracker.reports.billing.createTypechange(this);"><option value="1">'+ZPI18N.getString("zp.today")+'</option><option value="0">'+ZPI18N.getString("zp.thisweek")+'</option><option value="4">'+ZPI18N.getString("zp.tt_thismonth")+'</option><option value="3">'+ZPI18N.getString("zp.yesterday")+'</option><option value="2">'+ZPI18N.getString("zp.lastweek")+'</option><option value="5">'+ZPI18N.getString("zp.lastmonth")+'</option><option value="6">'+ZPI18N.getString("zp.custom")+'</option></select></div></div><div class="form-group" style="display: none;" id="tcustomfromtodate"><label class="control-label col-sm-4">'+ZPI18N.getString("zp.fromtodate")+' :</label><div class="date-range"><div class="col-sm-3"><div class="btnCal"><input type="text" id="billing-fromdate" date="from" class="form-control W100I" placeholder="'+ZPI18N.getString("zp.from")+'" caltype="popup" onclick="Calendar.setUpCalendar(event, this);"></div></div><div class="col-sm-3"><label class="control-label to-label">-</label><div class="btnCal"><input type="text" id="billing-todate" date="to" class="form-control W100I" placeholder="'+ZPI18N.getString("zp.to")+'" caltype="popup" onclick="Calendar.setUpCalendar(event, this);"></div></div></div></div><div class="form-group"><label class="control-label col-sm-4">'+ZPI18N.getString("zp.employee")+' :</label><div class="col-sm-6"><input id="billing-user" type="hidden" selectClassification="allUsers" defaultSelectType="allUsers" onchange="Timetracker.projects.Filters.updateProjectListForFilters(true, Layout.Page.container.find(\'#billing-user\').val(), Layout.Page.container.find(\'#billing-client\').val(), \'billing\');"></div></div><div class="form-group"><label class="control-label col-sm-4 zptbjbs"><span class="form_projects zptbjbs_fnt" title="'+Timetracker.util.projectDispName+'">'+Timetracker.util.projectDispName+'</span> :</label><div class="col-sm-6"><input id="billing-project" placeholder= "'+ZPI18N.getString("zp.all")+" "+Timetracker.util.projectDispName+'"  onchange="Timetracker.jobs.Filters.getJobs(Layout.Page.container.find(\'#billing-user\').val(), undefined, \'billing\', this.value,Layout.Page.container.find(\'#billing-client\').val());"></input></div></div><div class="form-group"><label class="control-label col-sm-4 zptbjbs"><span class="form_jobs zptbjbs_fnt" title="'+Timetracker.util.jobDispName+'">'+Timetracker.util.jobDispName+'</span> :</label><div class="col-sm-6"><input id="billing-job" placeholder= "'+ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.jobDispName)+'" onchange="Timetracker.jobs.Filters.gettitle(id);"></input></div></div><div class="form-group"><label class="control-label col-sm-4">'+ZPI18N.getString("zp.approvalstatus")+' :</label><div class="col-sm-6"><select id="billing-approval"><option value="0">'+ZPI18N.getString("zp.all")+'</option><option value="1">'+ZPI18N.getString("zp.approvedlogs")+'</option><option value="2">'+ZPI18N.getString("zp.unapprovedlogs")+"</option></select></div></div></form></div></div>";Layout.Page.container.find("#addBillsPage").find("#billGenerateStep1").find(".modal-body").html(body);var footer='<button class="btn btn-primary" type="button" onclick="Timetracker.reports.billing.generateBill();">'+ZPI18N.getString("zp.next")+'</button><button data-dismiss="modal" aria-label="Close" class="btn btn-default cancel-model" type="button">'+ZPI18N.getString("zp.cancel")+"</button>";Layout.Page.container.find("#addBillsPage").find("#billGenerateStep1").find(".modal-footer").html(footer)},constructBillGenerationPopup:function(){0==Layout.Page.container.find("#addBillsPage").length&&Timetracker.util.constructTwoStepsModal({id:"addBillsPage",step1Id:"billGenerateStep1",step2Id:"billGenerateStep2"});var body='<div class="ZPBillDt PT20 PB40"><div class="row"><div class="col-sm-5"><div class="form-group row"><b class="col-sm-4 text-right">'+ZPI18N.getString("zp.customername")+' :</b><div class="col-sm-6"><p id="billing-clientName"></p></div></div><div class="form-group row"><b class="col-sm-4 text-right">'+ZPI18N.getString("zp.address")+' :</b><div class="col-sm-6"><p id="billing-clientAddress"></p></div></div></div><div class="col-sm-7"><div class="form-horizontal col-sm-offset-5 col-sm-6"><div class="form-group"><label class="control-label col-sm-4"><b>'+ZPI18N.getString("zp.billno")+' :</b></label><div class="col-sm-7"><input class="form-control W220" id="billing-billno"><p class="DN" id="billing-billno_view"></p></div></div><div class="form-group"><label class="control-label col-sm-4"><b>'+ZPI18N.getString("zp.billdate")+' :</b></label><div class="col-sm-7"><div class="btnCal"><input class="form-control" id="billing-billdate" caltype="popup" onclick="Calendar.setUpCalendar(event,this);"></div><p class="DN" id="billing-billdate_view"></p></div></div><div class="form-group"><label class="control-label col-sm-4"><b>'+ZPI18N.getString("zp.duedate")+' :</b></label><div class="col-sm-7"><div class="btnCal"><input class="form-control" id="billing-duedate" caltype="popup" onclick="Calendar.setUpCalendar(event,this);"></div><p class="DN" id="billing-duedate_view"></p></div></div></div></div></div></div><div class="PB40"><p id="deletedtaxesindication" class="notfin DN"><span class="blu ZPstr">**</span> - Indiactes deleted taxes</p><table class="table table-hover"><thead><tr class="TblGryBg"><th width="15"></th><th width="20">'+ZPI18N.getString("zp.sno")+'</th><th class="form_jobname">'+ZPI18N.getString("zp.jobname")+'</th><th width="50" class="text-right">'+ZPI18N.getString("zp.hours")+'</th><th width="105">'+ZPI18N.getString("zp.rateperhour")+'</th><th width="100" class="text-right">'+ZPI18N.getString("zp.discount")+'</th><th width="240" class="text-right">'+ZPI18N.getString("zp.taxes")+'</th><th width="90">'+ZPI18N.getString("zp.amount")+'</th><th width="15"></th></tr></thead><tbody id="billing-billtbody"></tbody><tfoot><tr><th class="B0I" colspan="6"></th><th>'+ZPI18N.getString("zp.subtotal")+' (<b id="billing-stotalcur"></b>)</th><th><span id="billing-subtotal"></span></th><th></th></tr><tr id="billing-totaltbody"><th class="B0I" colspan="6"></th><th>'+ZPI18N.getString("zp.total")+' (<b id="billing-totalcur"></b>)</th><th><span id="billing-total"></span></th><th></th></tr></tfoot></table></div>';Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find(".modal-body").html(body).attr("id","generate_bill_print");var footer='<div class="row"><div class="col-sm-6"><button id="generatebill_submit" class="btn btn-primary" type="button" onclick="Timetracker.reports.billing.createBill();">'+ZPI18N.getString("zp.submit")+'</button><button id="generatebill_close" data-dismiss="modal" aria-label="Close" class="btn btn-default" type="button">'+ZPI18N.getString("zp.cancel")+'</button></div><div class="col-sm-6 text-right" id="generatebill_back"><button class="btn btn-default" type="button" onclick="Timetracker.reports.billing.showAddPage();">'+ZPI18N.getString("zp.back")+"</button></div></div>";Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find(".modal-footer").html(footer),Timetracker.util.init()},showAddPage:function(){0!=Layout.Page.container.find("#addBillsPage").length&&""!=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep1").find(".modal-body").html()||Timetracker.reports.billing.constructAddPagePopup(),Layout.Page.container.find("#billGenerateStep1").show(),Layout.Page.container.find("#billGenerateStep2").hide(),ZPeople.BSModal.show(Layout.Page.container.find("#addBillsPage")),Timetracker.projects.Filters.updateProjectListForFilters(!0,"0","0","billing"),Timetracker.clients.getClients("billing-client"),Layout.Page.container.find("#billingperiod").val("4").select2({minimumResultsForSearch:1/0}),Timetracker.jobs.Filters.gettitle("billing-client"),Layout.Page.container.find("#billing-approval").val("0").select2({minimumResultsForSearch:1/0}),Timetracker.Search.populateUsers("billing-user",void 0,void 0,!0),Layout.Page.container.find("#billing-fromdate,#billing-todate").val(""),Timetracker.util.removeErrorMsg("addBillsPage")},generateBill:function(isFromClientReport){Timetracker.reports.billing.BillEditRow.data=null,Timetracker.reports.billing.BillEditRow.editMode=!1,Timetracker.reports.billing.BillEditRow.viewMode=!1,Timetracker.util.removeErrorMsg("addBillsPage");var params={mode:"getBillingByClinet",conreqcsr:csrfToken},clientId=Timetracker.reports.clientReport.clientId;Timetracker.reports.billing.BillingCriteria.mode=!1;var billcheck=!0;if(isFromClientReport)params.fromClientReport=!0,ZPeople.BSModal.hide("repclientsummary");else{clientId=Layout.Page.container.find("#billing-client").val();var toDate,fromDate,d,projectId=Layout.Page.container.find("#billing-project").val()||"0",jobId=Layout.Page.container.find("#billing-job").val()||"0",userErecNo=Layout.Page.container.find("#billing-user").val()||"0",approvalStatus=Layout.Page.container.find("#billing-approval").val(),crperiod=Layout.Page.container.find("#addBillsPage").find("#billingperiod").val();if("0"===crperiod)d=Calendar.getCurrentWeek(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("1"===crperiod)d=Calendar.getCurrentDay(),fromDate=Calendar.formatDate(d.day),toDate=Calendar.formatDate(d.day);else if("2"===crperiod)d=Calendar.getCurrentWeek(),d=Calendar.getPreviousWeek(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("3"===crperiod)d=Calendar.getCurrentDay(),d=Calendar.getPreviousDay(),fromDate=Calendar.formatDate(d.day),toDate=Calendar.formatDate(d.day);else if("4"===crperiod)d=Calendar.getCurrentMonth(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("5"===crperiod)d=Calendar.getCurrentMonth(),d=Calendar.getPreviousMonth(),fromDate=Calendar.formatDate(d.from),toDate=Calendar.formatDate(d.to);else if("6"===crperiod&&(fromDate=Layout.Page.container.find("#addBillsPage").find("#billing-fromdate").val(),toDate=Layout.Page.container.find("#addBillsPage").find("#billing-todate").val(),billcheck=Timetracker.util.validateFunction("billing-fromdate","",ZPI18N.getString("zp.enterfromtodate"),"div",billcheck,null,"zp-sm-6 W50 zp-sm-offset-4 MT4"),billcheck=Timetracker.util.validateFunction("billing-todate","",ZPI18N.getString("zp.enterfromtodate"),"div",billcheck,null,"zp-sm-6 W50 zp-sm-offset-4 MT4"),""===fromDate||Calendar.isvalidDate(fromDate)||(billcheck=Timetracker.util.validateFunction("billing-fromdate",null,ZPI18N.getString("zp.invalidfromdate"),"div",billcheck,null,"zp-sm-6 W50 zp-sm-offset-4 MT4")),""===toDate||Calendar.isvalidDate(toDate)||(billcheck=Timetracker.util.validateFunction("billing-todate",null,ZPI18N.getString("zp.invalidtodate"),"div",billcheck,null,"zp-sm-6 W50 zp-sm-offset-4 MT4")),""!=fromDate&&""!=toDate)){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);if(fdate>tdate)billcheck=Timetracker.util.validateFunction("billing-todate",null,ZPI18N.getString("zp.greaterfromdate"),"div",billcheck,null,"zp-sm-6 W50 zp-sm-offset-4 MT4");else Timetracker.DateTime.getDateDiff(fdate,tdate)>31&&(billcheck=Timetracker.util.validateFunction("billing-fromdate",null,ZPI18N.getString("zp.datewithindays",["31"]),"div",billcheck,null,"zp-sm-6 W50 zp-sm-offset-4 MT4"))}if(!(billcheck=Timetracker.util.validateFunction("billing-client","",ZPI18N.getString("zp.chooseclienterror"),"div",billcheck)))return!1;var tempObj={mode:!0};tempObj.fromDate=params.fromDate=fromDate,tempObj.toDate=params.toDate=toDate,tempObj.jobId=params.jobId=jobId,tempObj.userErecNo=params.userErecNo=userErecNo,tempObj.approvalStatus=params.approvalStatus=approvalStatus,tempObj.projectId=params.projectId=projectId,Timetracker.reports.billing.BillingCriteria=tempObj}params.clientId=clientId,$.post(Timetracker.constants.URL,params,function(result){if(1===result.length)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nologhours",[ZPI18N.getString("zp.smallbill")])),!1;Timetracker.reports.billing.constructNewBill(result)})},constructNewBill:function(result){var clientdata;if(0!=Layout.Page.container.find("#addBillsPage").length&&""!=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find(".modal-body").html()||Timetracker.reports.billing.constructBillGenerationPopup(),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billtbody,#billing-taxtbody").html(""),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billno,#billing-billdate,#billing-duedate").attr("disabled",!1).show(),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billgenerate_print").remove(),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#deletedtaxesindication,#billing-billno_view,#billing-billdate_view,#billing-duedate_view").hide(),Timetracker.reports.billing.BillEditRow.viewMode){var header='<div id="billgenerate_print" class="FR MR25 MT5"><span class="FL PR dropdown ZPcusPos1 ZPCusDrs MR10"><i data-toggle="dropdown" class="IC-more  S18 gry CP" aria-expanded="false"></i><ul class="dropdown-menu ZPCmn-Arrow top gray"><li onclick="Timetracker.reports.billing.exportBill();"><a><span class="IC-xls DIB gry MR2"></span>'+ZPI18N.getString("zp.downloadpdf")+'</a><form method="post" id="downloadbillpdf" enctype="multipart/form-data"><input type="hidden" name="billId" id="pdfbillId"/><input type="hidden" name="convertPDF" id="billpdfconvert"/><input type="hidden" name="conreqcsr" id="billpdfidentity"/></form></li><li onclick="Timetracker.util.printReport(\'generate_bill_print\');"><a><span class="IC-print DIB gry MR2"></span> '+ZPI18N.getString("zp.print")+"</a></li></ul></span></div>";Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find(".addPopTitle").after(header)}if(!Timetracker.reports.billing.BillEditRow.viewMode){var taxopt='<select class="table-select" onchange="Timetracker.reports.billing.calculateTax(this);" placeholder="'+ZPI18N.getString("zp.selecttax")+'">';taxopt+="<option></option>",null===Timetracker.reports.billing.taxforBill&&$.ajax({type:"POST",async:!1,url:"/timesheet.zp",data:{mode:"getTaxes",conreqcsr:csrfToken},success:function(data){Timetracker.reports.billing.taxforBill=data}}),$.each(Timetracker.reports.billing.taxforBill,function(index,data){taxopt+='<option value="'+data.taxId+'" taxPerCent="'+data.taxPerCent+'">'+data.taxName+" - "+data.taxPerCent+"% </option>"})}var totamt=0;$.each(result,function(index,data){if(0===index)clientdata=data;else{var txt='<tr class="ZPLRow">';txt+="<td></td><td>"+index+"</td>",data.empName?txt+='<td><label class="DI">'+data.jobName+" ("+data.empName+")</label>":txt+='<td><label class="DI">'+data.jobName+"</label>",data.projectName&&(txt+='<span class="timelg-dot DI">.</span> <span class="sub-clr DI">'+data.projectName+"</span>"),txt+="</td>";var hours=0,amount=0,ratePerHour=0,discount=0;if(Timetracker.reports.billing.BillEditRow.editMode||Timetracker.reports.billing.BillEditRow.viewMode?(hours=data.hours,amount=data.amount,ratePerHour=data.rate,discount=data.discount):(data.totalHours&&(hours=Calendar.minstodecimal(data.totalHours)),data.ratePerHour&&(amount=(hours*data.ratePerHour).toFixed(2),ratePerHour=data.ratePerHour)),ratePerHour=Number(ratePerHour).toFixed(2),discount=Number(discount).toFixed(2),totamt+=Number(amount),Timetracker.reports.billing.BillEditRow.viewMode)txt+='<td class="text-right">'+hours+"</td>",txt+='<td class="text-right">'+ratePerHour+"</td>",txt+='<td class="text-right">'+discount+"</td>",data.taxName?txt+='<td class="text-right"><div class="viewTax" taxId="'+data.taxId+'" taxPercent="'+data.taxPercent+'"><label class="dgry">'+data.taxName+"</label> - "+data.taxPercent+"% </div></td>":txt+='<td class="text-right">-</td>';else if(txt+='<td><input type="text" class="form-control FR text-right table-inptFxd W60" value="'+hours+'"  onkeyup="Timetracker.reports.billing.calculate(this);"/></td>',txt+='<td><input type="text" class="form-control FR text-right table-inptFxd" value="'+ratePerHour+'"  onkeyup="Timetracker.reports.billing.calculate(this);"/></td>',txt+='<td><input type="text" class="form-control FR text-right table-inptFxd" value="'+discount+'"  onkeyup="Timetracker.reports.billing.calculate(this);"/></td>',Timetracker.reports.billing.BillEditRow.editMode)if(!1===data.isActive)txt+="<td>"+(taxopt+'<option value="'+data.taxId+'" taxPerCent="'+data.taxPercent+'">'+data.taxName+" - "+data.taxPercent+"%  ** </option></select>")+"</td>",Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#deletedtaxesindication").show();else txt+="<td>"+taxopt+"</select></td>";else txt+="<td>"+taxopt+"</select></td>";txt+='<td id="job_total_amt">'+Number(amount).toFixed(2)+"</td>",txt+="<td></td></tr>",txt=$(txt),Timetracker.reports.billing.BillEditRow.editMode&&data.taxId&&!Timetracker.reports.billing.BillEditRow.viewMode&&txt.find("select").val(data.taxId),txt.data(data),Layout.Page.container.find("#addBillsPage").find("#billing-billtbody").append(txt)}}),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-subtotal").data("amount",totamt),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-subtotal").html(totamt.toFixed(2)),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-total").data("amount",totamt),"0"===clientdata.currencyCode&&(null===Timetracker.reports.billing.currenciesData&&$.ajax({type:"POST",async:!1,url:"/timesheet.zp",data:{mode:"getCurrencies",conreqcsr:csrfToken},success:function(data){Timetracker.reports.billing.currenciesData=data}}),clientdata.currencyCode=Timetracker.reports.billing.currenciesData[0].currencyCode),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-stotalcur,#billing-totalcur").html(clientdata.currencyCode),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-total").html(totamt.toFixed(2)),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-clientName").html(clientdata.clientName),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-clientName").data("clientId",clientdata.clientId),clientdata.billno&&null!=clientdata.billno?(Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billno").val(clientdata.billno),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billno").attr("disabled",!0)):Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billno").val("");var address="";clientdata.streetAddr&&null!=clientdata.streetAddr&&"null"!=clientdata.streetAddr&&(address+=clientdata.streetAddr),clientdata.city&&null!=clientdata.city&&"null"!=clientdata.city&&(address+="\n"+clientdata.city),clientdata.state&&null!=clientdata.state&&"null"!=clientdata.state&&(address+="\n"+clientdata.state),clientdata.country&&"0"!==clientdata.country&&"null"!==clientdata.country&&(address+="\n"+clientdata.country),clientdata.pincode&&null!=clientdata.pincode&&"null"!=clientdata.pincode&&(address+=" - "+clientdata.pincode),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-clientAddress").html(address),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billdate").val(Calendar.formatDate(Calendar.getCurrentDay().day,uidateFormat)),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-duedate").val(""),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find(".table-select").select2({allowClear:!0}),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find(".addPopTitle").html(ZPI18N.getString("zp.billfor",[" "])+clientdata.clientName),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#generatebill_back,#billgeneration_totalsteps,#generatebill_submit").show(),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#generatebill_close").html(ZPI18N.getString("zp.cancel")),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("[id^='billing-billtrow']").remove(),(Timetracker.reports.billing.BillEditRow.editMode||Timetracker.reports.billing.BillEditRow.viewMode)&&(Timetracker.reports.billing.calculateTax(),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billdate").val(clientdata.billDate),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-duedate").val(clientdata.dueDate),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billno").val(clientdata.billno),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billno").attr("disabled",!1),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-clientAddress").html(address)),Timetracker.reports.billing.BillEditRow.viewMode&&(Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#pdfbillId").val(Timetracker.reports.billing.BillEditRow.data.billingId),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#generatebill_submit,#billing-billno,#billing-billdate,#billing-duedate").hide(),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#generatebill_close").html(ZPI18N.getString("zp.close")),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billdate_view").html(clientdata.billDate),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-duedate_view").html(clientdata.dueDate),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billno_view").html(clientdata.billno),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billno_view,#billing-billdate_view,#billing-duedate_view").show()),(Timetracker.reports.billing.BillEditRow.editMode||Timetracker.reports.billing.BillEditRow.viewMode||!Timetracker.reports.billing.BillingCriteria.mode)&&Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#generatebill_back,#billgeneration_totalsteps").hide(),Timetracker.util.removeErrorMsg("addBillsPage"),Layout.Page.container.find("#billGenerateStep2").show(),Layout.Page.container.find("#billGenerateStep1").hide(),(Timetracker.reports.billing.BillEditRow.editMode||Timetracker.reports.billing.BillEditRow.viewMode||!Timetracker.reports.billing.BillingCriteria.mode)&&ZPeople.BSModal.show(Layout.Page.container.find("#addBillsPage"))},calculate:function(obj){obj=$(obj);var subtotal=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-subtotal").data("amount"),trObj=obj.parent().parent(),inputs=trObj.find("input"),hours=0,rateperhour=0,discount=0;if(""!==$(inputs[0]).val()&&(hours=$(inputs[0]).val()),isNaN(hours)||hours<0)return $(inputs[0]).parent().addClass("error"),!1;if($(inputs[0]).parent().removeClass("error"),""!==$(inputs[1]).val()&&(rateperhour=$(inputs[1]).val()),isNaN(rateperhour)||rateperhour<0)return $(inputs[1]).parent().addClass("error"),!1;if($(inputs[1]).parent().removeClass("error"),""!==$(inputs[2]).val()&&(discount=$(inputs[2]).val()),isNaN(discount)||discount<0||discount>100)return $(inputs[2]).parent().addClass("error"),!1;$(inputs[2]).parent().removeClass("error");var oldamt=trObj.find("#job_total_amt").html(),newamt=hours*rateperhour,diffamt=(newamt=(newamt-=newamt*discount/100).toFixed(2))-(oldamt=(oldamt=Number(oldamt)).toFixed(2));trObj.find("#job_total_amt").html(newamt),subtotal+=diffamt,(isNaN(subtotal)||subtotal<0)&&(subtotal=0),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-subtotal").data("amount",subtotal),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-subtotal").html(subtotal.toFixed(2)),Timetracker.reports.billing.calculateTax()},calculateTax:function(){var allObj={};Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billtbody").find("tr").each(function(){var trObj=$(this),selectEle=trObj.find("select option:selected"),taxPerCent=selectEle.attr("taxPerCent"),taxName=selectEle.text().trim(),taxId=selectEle.val();if(Timetracker.reports.billing.BillEditRow.viewMode){var obj=trObj.find(".viewTax");0==obj.length?(taxId=taxName="",taxPerCent=0):(taxPerCent=$(obj).attr("taxPercent"),taxName=$(obj).html(),taxId=$(obj).attr("taxId"))}var amount=trObj.find("#job_total_amt").html();""===amount&&(amount=0),amount=Number(amount);allObj[taxId]?allObj[taxId].amount=allObj[taxId].amount+amount:allObj[taxId]={taxId:taxId,taxName:taxName,taxPerCent:taxPerCent,amount:amount}}),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("[id^='billing-billtrow']").remove();var totAmt=0;for(var key in allObj){var name=key,value=allObj[key],taxAmt=0;if(""!==name&&(taxAmt=(taxAmt=value.amount*value.taxPerCent/100).toFixed(2))>0){var tName=Timetracker.reports.billing.BillEditRow.viewMode?value.taxName:ZPeople.escapeHtml(value.taxName),txt='<tr id="billing-billtrow-'+value.taxId+'"><th class="B0I" colspan="6"></th><th>'+tName+":</th><th>"+taxAmt+"</th><th></th></tr>";Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-totaltbody").before(txt)}totAmt+=Number(taxAmt)}totAmt=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-subtotal").data("amount")+totAmt,(isNaN(totAmt)||totAmt<0)&&(totAmt=0),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-total").data("amount",totAmt),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-total").html(totAmt.toFixed(2))},createBill:function(){Timetracker.util.removeErrorMsg("addBillsPage");var clientId=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-clientName").data().clientId,billno=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billno").val().trim(),billDate=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billdate").val().trim(),dueDate=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-duedate").val().trim(),subTotal=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-subtotal").data("amount"),totalAmount=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-total").data("amount"),currencyCode=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-stotalcur").html().trim(),billcheck=!0;billcheck=Timetracker.util.validateFunction("billing-billno","",ZPI18N.getString("zp.billnoempty"),"span",billcheck),billcheck=Timetracker.util.validateFunction("billing-billdate","",ZPI18N.getString("zp.billdateempty"),"span",billcheck),billcheck=Timetracker.util.validateFunction("billing-duedate","",ZPI18N.getString("zp.duedateempty"),"span",billcheck);var billingbilldate=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billdate").val(),billingduedate=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-duedate").val();(Calendar.isvalidDate(billingbilldate)||(billcheck=Timetracker.util.validateFunction("billing-billdate",null,ZPI18N.getString("zp.invaliddate"),"span",billcheck)),Calendar.isvalidDate(billingduedate)||(billcheck=Timetracker.util.validateFunction("billing-duedate",null,ZPI18N.getString("zp.invaliddate"),"span",billcheck)),""!=billingbilldate&&""!=billingduedate)&&(Calendar.parseDate(billingbilldate,uidateFormat)>Calendar.parseDate(billingduedate,uidateFormat)&&(billcheck=Timetracker.util.validateFunction("billing-duedate",null,ZPI18N.getString("zp.duedateless"),"span",billcheck)));if(!billcheck)return!1;(isNaN(totalAmount)||totalAmount<0)&&(totalAmount=0);var itemArray=[];if(0===Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billtbody").find("tr").length)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nologhours",[ZPI18N.getString("zp.smallbill")])),!1;var editCount=0;if(Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billing-billtbody").find("tr").each(function(index){var trObj=$(this),data=trObj.data(),inputEle=trObj.find("input"),itemObj={},hours=$(inputEle.get(0)).val().trim(),rate=$(inputEle.get(1)).val().trim(),discount=$(inputEle.get(2)).val().trim(),taxId=trObj.find("select").val();if(""===hours&&(hours=0),(isNaN(hours)||hours<0)&&($(inputEle[0]).parent().addClass("error"),billcheck=!1),""===rate&&(rate=0),(isNaN(rate)||rate<0)&&($(inputEle[1]).parent().addClass("error"),billcheck=!1),""===discount&&(discount=0),(isNaN(discount)||discount<0||discount>100)&&($(inputEle[2]).parent().addClass("error"),billcheck=!1),itemObj.hours=hours,itemObj.rate=rate,itemObj.discount=discount,itemObj.amount=rate*hours-rate*hours*discount/100,itemObj.jobId=data.jobId,data.erecno&&(itemObj.erecno=data.erecno),data.itemId&&(itemObj.itemId=data.itemId),""!==taxId&&(itemObj.taxId=taxId),itemArray.push(itemObj),Timetracker.reports.billing.BillEditRow.editMode){var jobBillingDetails=Timetracker.reports.billing.BillEditRow.data.details[index+1];jobBillingDetails.hours==itemObj.hours&&jobBillingDetails.rate==itemObj.rate&&jobBillingDetails.discount==itemObj.discount&&jobBillingDetails.taxId==itemObj.taxId&&jobBillingDetails.jobId==itemObj.jobId&&editCount++}}),!billcheck)return!1;var isEdited=!0;if(Timetracker.reports.billing.BillEditRow.editMode&&Timetracker.reports.billing.BillEditRow.data.billno==billno&&Timetracker.reports.billing.BillEditRow.data.billDate==billDate&&Timetracker.reports.billing.BillEditRow.data.dueDate==dueDate&&editCount===itemArray.length&&(isEdited=!1),isEdited){var params={mode:"createBill",clientId:clientId,billno:billno,billDate:billDate,dueDate:dueDate,itemArray:JSON.stringify(itemArray),subTotal:subTotal,totalAmount:totalAmount,currencyCode:currencyCode,conreqcsr:csrfToken};Timetracker.reports.billing.BillEditRow.editMode?(params.mode="modifyBill",params.billingId=Timetracker.reports.billing.BillEditRow.data.billingId):Timetracker.reports.billing.BillingCriteria.mode&&(params.fromDate=Timetracker.reports.billing.BillingCriteria.fromDate,params.toDate=Timetracker.reports.billing.BillingCriteria.toDate,params.jobId=Timetracker.reports.billing.BillingCriteria.jobId,params.approvalStatus=Timetracker.reports.billing.BillingCriteria.approvalStatus,params.userErecNo=Timetracker.reports.billing.BillingCriteria.userErecNo,params.approvalStatus=Timetracker.reports.billing.BillingCriteria.approvalStatus,params.projectId=Timetracker.reports.billing.BillingCriteria.projectId),Layout.Page.container.find("#generatebill_submit").prop("disabled",!0),$.post("/timesheet.zp",params,function(resultData){ZPeople.BSModal.hide("addBillsPage"),"createBill"===params.mode?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.billgeneratedsuccess")):"modifyBill"===params.mode&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.billeditsuccess")),Layout.Page.container.find("#generatebill_submit").prop("disabled",!1),-1!==Layout.Page.hash.indexOf("reports/admin/timetracker/billing")?Timetracker.Reports.billing.loadBills():Timetracker.reports.billing.getBills()})}else ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nochangesmade")),ZPeople.BSModal.hide("addBillsPage")},viewBill:function(billId){var obj=Layout.Page.container.find("#billing-listtbody").find("#"+billId),data=$(obj).data();Timetracker.reports.billing.BillEditRow.data=data,Timetracker.reports.billing.BillEditRow.editMode=!1,Timetracker.reports.billing.BillEditRow.viewMode=!0,Timetracker.reports.billing.getBillDetails(billId,data)},confirmEditBill:function(billId){var obj=Layout.Page.container.find("#billing-listtbody").find("#"+billId),data=$(obj).data();Timetracker.reports.billing.BillEditRow.data=data,Timetracker.reports.billing.BillEditRow.editMode=!0,Timetracker.reports.billing.BillEditRow.viewMode=!1,Timetracker.reports.billing.BillEditRow.data.isMailSent?ZPeople.BSModal.setup({id:"zp_modal_confirmpop",type:3,header:ZPI18N.getString("zp.zpalert"),body:ZPI18N.getString("zp.billeditalertbody"),deleteOnHide:!0,closeOnSubmit:!0,buttonValue:ZPI18N.getString("zp.edit"),successCallback:Timetracker.reports.billing.getBillDetails,extraDetails:{billId:billId,data:data}}):Timetracker.reports.billing.getBillDetails(billId,data)},getBillDetails:function(billId,data){if(void 0===billId||void 0==data){var modal=ZPeople.BSModal.get({id:"zp_modal_confirmpop"});billId=modal.data("extraDetails").billId,data=modal.data("extraDetails").data}var result,obj=Layout.Page.container.find("#billing-listtbody").find("#"+billId);$(obj).data("details")?(result=$(obj).data("details"),Timetracker.reports.billing.constructNewBill(result)):$.post("/timesheet.zp",{mode:"getBillsDetails",billId:data.billingId,conreqcsr:csrfToken},function(result){$(obj).data("details",result),result.splice(0,0,data),Timetracker.reports.billing.constructNewBill(result)})},deleteBill:function(billingId,isFromPeopleLite){$.post("/timesheet.zp",{mode:"deleteBill",billId:billingId,conreqcsr:csrfToken},function(){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.billdeleted")),isFromPeopleLite?Timetracker.Reports.billing.loadBills():Timetracker.reports.billing.getBills()})},showSendMailPopup:function(billId,obj){var mailDetails=$(obj).parents(":nth(1)").data().mailDetails;void 0===mailDetails||null===mailDetails?$.post("/timesheet.zp",{mode:"getDetailsMailInvoice",billId:billId,conreqcsr:csrfToken},function(resultData){Timetracker.reports.billing.showSendMailPopupDetails(billId,resultData),$(obj).parents(":nth(1)").data("mailDetails",resultData)}):Timetracker.reports.billing.showSendMailPopupDetails(billId,mailDetails)},showSendMailPopupDetails:function(billId,resultData){var modal=Layout.Page.container.find("#mailBill");0==modal.length&&(modal=Timetracker.reports.billing.constructSendMailPopup()),Layout.Page.container.find("#mailBill").find("#invoice_from").val(resultData.emailId);var subject=ZPI18N.getString("zp.invoicemailsubject",[resultData.companyName,resultData.billNo]);Layout.Page.container.find("#mailBill").find("#invoice_subject").val(subject),Layout.Page.container.find("#mailBill").find("#templatemailtextarea").text(resultData.bodyContent),Layout.Page.container.find("#mailBill").find("#templatecomposetextarea").find(".ze").remove(),Timetracker.reports.billing.createEditor(),Layout.Page.container.find("#mailBill").find("#invoice_to,#invoice_cc").val(""),Layout.Page.container.find("#mailBill").find("#invoice_attachment").attr("checked",!0),Layout.Page.container.find("#mailBill").find("#invoice_filename").html("<i class='IC-xls gry'></i>INV-"+resultData.billNo+".pdf"),Layout.Page.container.find("#mailBill").find("#zp_modal_blubtn").data("billId",billId),Layout.Page.container.find("#mailBill").find("#zp_modal_blubtn").data("billNo",resultData.billNo),Timetracker.util.removeErrorMsg("mailBill"),ZPeople.BSModal.show(modal)},createEditor:function(){var contents=Layout.Page.container.find("#mailBill").find("#templatemailtextarea").text(),initobject={id:"templatecomposetextarea",mode:"richtext",content:contents=contents.replace(/\n\r?/g,"<br />"),editorheight:200};editor=ZPUtil.createZEEditor(initobject)},constructSendMailPopup:function(){var body='<form class="form-horizontal pad txtLft" role="form">';return body+='<div class="form-group"><label class="control-label col-sm-2">'+ZPI18N.getString("zp.from")+' :</label><div class="col-sm-9"><input id="invoice_from" type="text" class="form-control"></div></div><div class="form-group"><label class="control-label col-sm-2">'+ZPI18N.getString("zp.to")+' :</label><div class="col-sm-9"><input id="invoice_to" type="text" class="form-control"></div></div><div class="form-group"><label class="control-label col-sm-2">'+ZPI18N.getString("zp.cc")+' :</label><div class="col-sm-9"><input id="invoice_cc" type="text" class="form-control"></div></div><div class="form-group"><label class="control-label col-sm-2">'+ZPI18N.getString("zp.subject")+' :</label><div class="col-sm-9"><input id="invoice_subject" type="text" class="form-control"></div></div><div class="form-group"><label class="checkbox col-sm-offset-2 col-sm-9"> <input type="checkbox" id="invoice_attachment"><span id="invoice_filename" class="ML2 S13 dgry"><span></label></div><div class="form-group text-editorBox"><label class="control-label col-sm-2">'+ZPI18N.getString("zp.message")+' :</label><div class="clearfix MB10"></div><div class="col-sm-12"><div class="msgpreview"><div id="templatecomposetextarea" class="fieldn"><textarea id="templatemailtextarea" name="templatemailtextarea" style="width:628px;display:none"></textarea></div></div></form>',ZPeople.BSModal.get({id:"mailBill",type:2,modalClass:"popRgtModel",header:ZPI18N.getString("zp.invoice"),body:body,deleteOnHide:!1,closeOnSubmit:!1,buttonValue:ZPI18N.getString("zp.send"),successCallback:Timetracker.reports.billing.sendInvoiceMail})},sendInvoiceMail:function(){var obj=Layout.Page.container.find("#mailBill").find("#zp_modal_blubtn");Timetracker.util.removeErrorMsg("mailBill");var toAddr=Layout.Page.container.find("#mailBill").find("#invoice_to").val(),ccAddr=Layout.Page.container.find("#mailBill").find("#invoice_cc").val(),mailSubject=Layout.Page.container.find("#mailBill").find("#invoice_subject").val(),mailContent=editor.getContent();mailContent=mailContent.replace(/\n\r?/g,"<br />");var params={mode:"sendMailInvoice",conreqcsr:csrfToken,mailAttachment:!1};if(Layout.Page.container.find("#mailBill").find("#invoice_attachment").is(":checked")&&(params.mailAttachment=!0),params.billId=$(obj).data().billId,""===toAddr.trim())return Layout.Page.container.find("#mailBill").find("#invoice_to").parent().append("<div class='error-msg'>"+ZPI18N.getString("zp.emptytoaddress")+"</div>"),!1;if(""!==toAddr.trim()){for(var toAddrs=toAddr.split(","),i=0;i<toAddrs.length;i++)if(!toAddrs[i].match(Timetracker.util.emailRegex))return Layout.Page.container.find("#mailBill").find("#invoice_to").parent().append("<div class='error-msg'>"+ZPI18N.getString("zp.invalidtoaddress")+"</div>"),!1;params.toAddr=toAddr}if(""!==ccAddr.trim()){var ccAddrs=ccAddr.split(",");for(i=0;i<ccAddrs.length;i++)if(!ccAddrs[i].match(Timetracker.util.emailRegex))return Layout.Page.container.find("#mailBill").find("#invoice_cc").parent().append("<div class='error-msg'>"+ZPI18N.getString("zp.invalidccaddress")+"</div>"),!1;params.ccAddr=ccAddr}return""===mailSubject.trim()?(Layout.Page.container.find("#mailBill").find("#invoice_subject").parent().append("<div class='error-msg'>"+ZPI18N.getString("zp.emptysubject")+"</div>"),!1):(params.mailSubject=mailSubject,""===mailContent.trim()?(Layout.Page.container.find("#mailBill").find("#templatecomposetextarea").parent().append("<div class='error-msg'>"+ZPI18N.getString("zp.emptybody")+"</div>"),!1):(params.mailAttachment?params.mailContent=mailContent:params.mailContent=mailContent.replace("The invoice INV-"+$(obj).data().billNo+" is attached with this email.",""),void ZPeople.Request.send("/timesheet.zp",params,Timetracker.reports.billing.mailSentSuccess)))},mailSentSuccess:function(resultData){resultData&&(ZPeople.BSModal.hide("mailBill"),"success"===resultData.isSent?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.mailsent")),resultData.isQBOEnabled&&(Timetracker.reports.billing.isQBOEnabled=resultData.isQBOEnabled),Timetracker.reports.billing.construct(resultData.billDetails)):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.mailnotsent")))},isBooksInteg:!1,pushToInvoice:function(billId,isPushedAlready,organisationId,isBooks){if("true"===isPushedAlready)return void 0!==isBooks?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.pushedtobooksalready")):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.pushedtoinvoicealready")),!1;$.post("/timesheet.zp",{mode:"pushToInvoice",billId:billId,invoiceOrgId:organisationId,isBooks:isBooks,conreqcsr:csrfToken},function(resultData){if(resultData)if(resultData.isQBOEnabled&&(Timetracker.reports.billing.isQBOEnabled=resultData.isQBOEnabled),Timetracker.reports.billing.construct(resultData.billDetails),(resultData=resultData.invoiceResponse).response&&!0===resultData.response)void 0!==isBooks?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.bookspushedsuccess")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.invoicepushedsuccess"));else if("authError"===resultData.message)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invoiceautherror"));else if("orgError"===resultData.message){var orgArray=resultData.orgArray;0==orgArray.length?void 0!==isBooks?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.nobooksorgfound")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.noinvoiceorgfound")):(Timetracker.reports.billing.isBooksInteg=void 0!==isBooks,Timetracker.reports.billing.showInvoiceOrgdetails(billId,orgArray))}else ZPeople.Message.showFailureMsg(resultData.message)})},pushToQBO:function(billId,isPushedAlready){if("true"===isPushedAlready)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.tt.qboinvoicepushedalready")),!1;Timetracker.reports.billing.qbopushdata&&Timetracker.reports.billing.qbopushdata.isAPICalled?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.tt.qboinvoicebeingpushed")):(Timetracker.reports.billing.qbopushdata.billId=billId,Timetracker.reports.billing.qbopushdata.isAPICalled=!0,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.tt.qboinvoicebeingpushed")),$.post("/quickbooks/pushToQBO",{billId:billId,conreqcsr:csrfToken},function(resultData){if(Timetracker.reports.billing.qbopushdata.isAPICalled=!1,resultData&&(resultData.isQBOEnabled&&(Timetracker.reports.billing.isQBOEnabled=resultData.isQBOEnabled),Timetracker.reports.billing.construct(resultData.billDetails),resultData.qboResponse)){var msg=resultData.qboResponse.msg;msg&&"success"==msg?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.tt.qboinvoicesuccessful")):msg&&"failed"==msg&&resultData.qboResponse.errmsg?ZPeople.Message.showFailureMsg(resultData.qboResponse.errmsg):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.tt.qboinvoicefail"))}}))},showInvoiceOrgdetails:function(billId,orgArray){for(var header='<h4 id="zp_modal_header" class="modal-title">'+ZPI18N.getString("zp.chooseyourorganization")+"</h4>",body='<div class="container-fluid"><p class="text-center LH20">You belong to the following organization.<br>Please Select the organization to which the data is to be pushed</p><div class="org-main">',i=0;i<orgArray.length;i++){var orgobj=orgArray[i];body+=0===i?'<div class="org-box active MT10"':'<div class="org-box MT10"',body+=' id="org_'+orgobj.organization_id+'" billId="'+billId+'" orgId="'+orgobj.organization_id+'" onclick="Timetracker.reports.billing.changeOrgSelection(\''+orgobj.organization_id+"');\"><h5>"+orgobj.name+'</h5><p class="gry"><label>Created Date :</label><span>'+orgobj.account_created_date_formatted+'</span></p><p class="gry"><label>Currency Type:</label><span>'+orgobj.currency_code+"</span></p></div>"}body+="</div></div>",ZPeople.BSModal.get({id:"billing-alert-multipleOrg-Invoice",type:1,body:body,deleteOnHide:!0,closeOnSubmit:!0,buttonValue:ZPI18N.getString("zp.submit"),successCallback:Timetracker.reports.billing.onChoosingOrganisation}),Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".modal-header").find("#zp_modal_header").remove(),0==Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".modal-header").find(".Icn.orgbg").length&&Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".modal-header").prepend('<div class="Icn orgbgi"><i class="IC-org-l whi S24"></i></div>'),Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".modal-header").append(header),ZPeople.BSModal.show(Layout.Page.container.find("#billing-alert-multipleOrg-Invoice"))},changeOrgSelection:function(orgId){Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".org-main").find(".active").removeClass("active"),Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find("#org_"+orgId).addClass("active")},onChoosingOrganisation:function(){var billId=Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".active").attr("billId"),invoiceOrgId=Layout.Page.container.find("#billing-alert-multipleOrg-Invoice").find(".active").attr("orgId");Timetracker.reports.billing.isBooksInteg?Timetracker.reports.billing.pushToInvoice(billId,!1,invoiceOrgId,"1"):Timetracker.reports.billing.pushToInvoice(billId,!1,invoiceOrgId)},exportBill:function(){var form=Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#downloadbillpdf");Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#downloadbillpdf").attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+"/timesheet.zp?mode=exportBillsDetails"),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billpdfidentity").val(csrfToken),Layout.Page.container.find("#addBillsPage").find("#billGenerateStep2").find("#billpdfconvert").val(!0),form.trigger("submit")}},Timetracker.Reports={init:function(moduleData){ZPeople.Module.isInitiated("timetracker")||(ZPeople.Module.MODULE_DATA.timetracker=moduleData),Timetracker.initSetup()},Constants:{timelogReport:"TT_TIMELOG_REPORT",timelogLeaveReport:"TT_TIMELOG_LEAVE_REPORT",jobReport:"TT_JOB_REPORT",projectReport:"TT_PROJECT_REPORT",jobScheduleReport:"TT_JOBSCHEDULE_REPORT",userReport:"TT_USER_REPORT",clientReport:"TT_CLIENT_REPORT",payrollReport:"TT_PAYROLL_REPORT",billing:"TT_BILLING",integrations:"TT_INTEGRATIONS"},Util:{getReportTypeParam:function(){return ZPLite.Reports.selectedTab},getCommonData:function(fetchPayPeriod){var params={};Timetracker.Department.reports_dept_List.load&&(params.deptfetch=!0),Timetracker.Designation.reports_desg_List.load&&(params.desgfetch=!0),Timetracker.Location.reports_loc_List.load&&(params.locfetch=!0),Timetracker.generalSettings.isOrgTagEnabled()&&Timetracker.organizationTags.reports_orgTagList.refresh&&(params.fecthOrgTags=!0),Timetracker.generalSettings.isRoleFilterEnabled()&&Timetracker.roles.reports_roleList.refresh&&(params.fetchRoles=!0),!fetchPayPeriod||Timetracker.reports.payrollReport.dataPeriod&&0!==Object.keys(Timetracker.reports.payrollReport.dataPeriod).length||(params.payperiodfetch=!0),isOrgStructureEnabled&&(Timetracker.Division.reports_divisionList.refresh&&(params.fetchDivisions=!0),Timetracker.BusinessUnit.reports_businessUnitList.refresh&&(params.fetchBusinessUnits=!0),Timetracker.LegalEntity.reports_legalEntityList.refresh&&(params.fetchLegalEntities=!0)),Object.keys(params).length>0&&(params.mode="getDeptAndLocList",Timetracker.isTTCustomAdminForAny()&&(params.submode="TIMETRACKER_REPORTS"),params.conreqcsr=csrfToken,Timetracker.util.getCommonData(params,Timetracker.Filters.setCacheForFilterValues))},showCorrespondingTimeLogs:function(obj,event,jobId,userErecNo,billtype,fromDate,toDate,isJobReport){event.stopPropagation();var containerId="#timetrackerTimelogReport";Timetracker.Reports.timelogReport.Firescroll.correspondingLogsMode,Timetracker.Reports.timelogReport.Firescroll.loadMoreCorrespondingLogs,Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT;isJobReport&&(containerId="#timetrackerJobReport",Timetracker.Reports.jobReport.Firescroll.correspondingLogsMode,Timetracker.Reports.jobReport.Firescroll.loadMoreCorrespondingLogs);var container=Layout.Page.container.find(containerId);if(0===container.find("#correspondingTimeLogsDiv").length){var timelogDetailPopup='<div class="time-detail-pop lt gray W400  zpl_zindex2 DN" id="correspondingTimeLogsDiv"><p class="FL">'+ZPI18N.getString("zp.timelogs")+'</p><i class="IC-cls CP red FR MR5 MT5" onclick="Layout.Page.container.find(\''+containerId+'\').find(\'#correspondingTimeLogsDiv\').hide();"></i><table class="table popFxd-hd"><thead><tr><th width="30%">'+ZPI18N.getString("zp.date")+'</th><th width="30%">'+Timetracker.util.workitemDispName+'</th><th width="25%">'+ZPI18N.getString("zp.billablestatus")+'</th><th width="15%">'+ZPI18N.getString("zp.total")+'</th></tr></thead><tbody id="correspondingTimeLogs" scroll="enabled"></tbody></table></div>';container.append(timelogDetailPopup)}var params={mode:"getTimesheet",userErecNo:userErecNo,typeMode:billtype,jobId:jobId,conreqcsr:csrfToken,isRequestFromReport:!0};isJobReport?params.skipDateValidation=!0:(fromDate&&(params.fromDate=fromDate),toDate&&(params.toDate=toDate)),Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)&&(params.viewEditPermissionType=Timetracker.constants.TTCustomAdmin.ReportView),$.post(Timetracker.constants.URL,params,function(resultData){if(container.find("#correspondingTimeLogs").html(""),resultData&&0!==resultData.length)Timetracker.Reports.Util.constructCorrespondinglogsHtml(resultData,userErecNo,containerId);else{var noDataHtml='<tr><td colspan="4" style="text-align:center;">'+ZPI18N.getString("zp.nodatafound")+"</td></tr>";container.find("#correspondingTimeLogs").append(noDataHtml)}container.find("#correspondingTimeLogsDiv").fadeIn(100),Timetracker.util.setPopupPosition(obj,"correspondingTimeLogsDiv",event,!1,40)})},constructCorrespondinglogsHtml:function(timelogData,userErecNo,containerId){var txt="";$.each(timelogData,function(index,data){txt+="<tr ",txt+='><td width="30%">'+data.workDate+"</td>",data.taskName?txt+='<td width="30%">'+data.taskName+"</td>":txt+='<td width="30%">---</td>',0===data.billableStatus?txt+='<td width="25%">'+ZPI18N.getString("zp.billable")+"</td>":txt+='<td width="25%">'+ZPI18N.getString("zp.nonbillable")+"</td>",txt+='<td width="15%">'+Calendar.minstohrs(data.hours)+"</td></tr>"}),Layout.Page.container.find(containerId).find("#correspondingTimeLogs").append(txt)},getReportUrl:function(isExport){let url=Timetracker.constants.URLS.reports;return ZPLite.Reports.getCurrentReport()===Timetracker.Reports.Constants.timelogReport&&(url+="/timelog"+(Timetracker.Reports.timelogReport.isChartView()?"/chart":"/list")),isExport&&(url+="/export"),url}},Filters:{cache:{},searchCache:{},constructFilter:function(obj,entity,isSingle,filterOnChangeCallback,firescrollMode,isPayrollReport){if(obj.addClass("DNI"),"department"===entity){if(0===Timetracker.Department.reports_dept_List.length)return}else if("location"===entity){if(0===Timetracker.Location.reports_loc_List.length)return}else if("designation"===entity){if(0===Timetracker.Designation.reports_desg_List.length)return}else if("legalEntity"===entity){if(!isOrgStructureEnabled||0===Timetracker.LegalEntity.reports_legalEntityList.length)return}else if("businessUnit"===entity){if(!isOrgStructureEnabled||0===Timetracker.BusinessUnit.reports_businessUnitList.length)return}else if("division"===entity){if(!isOrgStructureEnabled||0===Timetracker.Division.reports_divisionList.length)return}else if("orgTag"===entity){if(!Timetracker.generalSettings.isOrgTagEnabled()||0===Timetracker.organizationTags.reports_orgTagList.length)return}else if("role"===entity&&(!Timetracker.generalSettings.isRoleFilterEnabled()||0===Timetracker.roles.reports_roleList.length))return;obj.removeClass("DNI");var details={entity:entity,isSingle:isSingle};switch(filterOnChangeCallback&&(details.filterOnChangeCallback=filterOnChangeCallback),isSingle||(details.maxSelection="employee"===entity?25:10),entity){case"datePeriod":details.text=ZPI18N.getString("zp.period"),details.staticOptions=[{id:"0",text:ZPI18N.getString("zp.today"),periodType:ZPLite.DateNavigator.TYPE.DAILY,tense:ZPLite.DateNavigator.TENSE.CURRENT},{id:"1",text:ZPI18N.getString("zp.thisweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:ZPLite.DateNavigator.TENSE.CURRENT},{id:"2",text:ZPI18N.getString("zp.tt_thismonth"),periodType:ZPLite.DateNavigator.TYPE.MONTHLY,tense:ZPLite.DateNavigator.TENSE.CURRENT},{id:"3",text:ZPI18N.getString("zp.yesterday"),periodType:ZPLite.DateNavigator.TYPE.DAILY,tense:ZPLite.DateNavigator.TENSE.PREVIOUS},{id:"4",text:ZPI18N.getString("zp.lastweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:ZPLite.DateNavigator.TENSE.PREVIOUS},{id:"5",text:ZPI18N.getString("zp.lastmonth"),periodType:ZPLite.DateNavigator.TYPE.MONTHLY,tense:ZPLite.DateNavigator.TENSE.PREVIOUS},{id:"6",text:ZPI18N.getString("zp.custom"),periodType:"custom"}],isPayrollReport&&(jQuery.isEmptyObject(Timetracker.reports.payrollReport.dataPeriod)||$.each(Timetracker.reports.payrollReport.dataPeriod,function(payperiodID,payperiod){details.staticOptions.push({id:payperiodID,text:payperiod.rsName,periodType:ZPLite.DateNavigator.TYPE.PAYPERIOD,tense:ZPLite.DateNavigator.TENSE.CURRENT})}));break;case"hoursComparator":details.text=ZPI18N.getString("zp.loggedhours"),details.staticOptions=[{id:"0",text:ZPI18N.getString("zp.all")},{id:"1",text:ZPI18N.getString("zp.lesserthan")},{id:"2",text:ZPI18N.getString("zp.greaterthan")},{id:"3",text:ZPI18N.getString("zp.equalto")},{id:"4",text:ZPI18N.getString("zp.notimelogoption")}];break;case"billableStatus":details.text=ZPI18N.getString("zp.billablestatus"),details.staticOptions=[{id:"-1",text:ZPI18N.getString("zp.all")},{id:"0",text:ZPI18N.getString("zp.billable")},{id:"1",text:ZPI18N.getString("zp.nonbillable")}];break;case"billingStatus":details.text=ZPI18N.getString("zp.billingstatus"),details.staticOptions=[{id:"-1",text:ZPI18N.getString("zp.all")},{id:"1",text:ZPI18N.getString("zp.billed")},{id:"0",text:ZPI18N.getString("zp.unbilled")}];break;case"approvalStatus":details.text=ZPI18N.getString("zp.approvalstatus"),isSingle?details.staticOptions=isPayrollReport?[{id:"0",text:ZPI18N.getString("zp.all")},{id:"1",text:ZPI18N.getString("zp.approved")},{id:"2",text:ZPI18N.getString("zp.unapproved")}]:[{id:"0",text:ZPI18N.getString("zp.all")},{id:"-2",text:ZPI18N.getString("zp.draft")},{id:"-1",text:ZPI18N.getString("zp.pending")},{id:"1",text:ZPI18N.getString("zp.approved")},{id:"-3",text:ZPI18N.getString("zp.rejected")},{id:"3",text:ZPI18N.getString("zp.notsubmitted")}]:(details.enableClear=!0,details.staticOptions=[{id:"-2",text:ZPI18N.getString("zp.draft")},{id:"-1",text:ZPI18N.getString("zp.pending")},{id:"1",text:ZPI18N.getString("zp.approved")},{id:"0",text:ZPI18N.getString("zp.rejected")},{id:"-3",text:ZPI18N.getString("zp.notsubmitted")}]);break;case"projectStatus":details.text=Timetracker.util.getProjectDisplayName()+" "+ZPI18N.getString("zp.status"),details.staticOptions=[{id:"-1",text:ZPI18N.getString("zp.all")},{id:"0",text:ZPI18N.getString("zp.inprogress")},{id:"1",text:ZPI18N.getString("zp.completed")}];break;case"jobStatus":details.text=Timetracker.util.getJobDisplayName()+" "+ZPI18N.getString("zp.status"),details.staticOptions=[{id:"-1",text:ZPI18N.getString("zp.all")},{id:"0",text:ZPI18N.getString("zp.inprogress")},{id:"1",text:ZPI18N.getString("zp.completed")}];break;case"employee":details.text=ZPI18N.getString("zp.employee"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.loadOptionsCallback=Timetracker.Reports.Filters.getOptionsForFilter,details.searchDtls={text:ZPI18N.getString("zp.search")},firescrollMode&&(details.firescrollDtls={mode:firescrollMode,maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT});break;case"client":details.text=Timetracker.util.getClientDisplayName(),details.showSelectedOptionCount=!0,details.enableClear=!0,details.loadOptionsCallback=Timetracker.Reports.Filters.getOptionsForFilter,details.searchDtls={text:ZPI18N.getString("zp.search")},firescrollMode&&(details.firescrollDtls={mode:firescrollMode,maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT});break;case"project":details.text=Timetracker.util.getProjectDisplayName(),details.showSelectedOptionCount=!0,details.enableClear=!0,details.loadOptionsCallback=Timetracker.Reports.Filters.getOptionsForFilter,details.searchDtls={text:ZPI18N.getString("zp.search")},firescrollMode&&(details.firescrollDtls={mode:firescrollMode,maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT});break;case"job":details.text=Timetracker.util.getJobDisplayName(),details.showSelectedOptionCount=!0,details.enableClear=!0,details.loadOptionsCallback=Timetracker.Reports.Filters.getOptionsForFilter,details.searchDtls={text:ZPI18N.getString("zp.search")},firescrollMode&&(details.firescrollDtls={mode:firescrollMode,maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT});break;case"department":details.text=ZPI18N.getString("zp.department"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")},Timetracker.Department.reports_dept_List instanceof Array&&Timetracker.Department.reports_dept_List.length>0?details.staticOptions=Timetracker.Reports.Filters.formatFilterData(Timetracker.Department.reports_dept_List,entity):details.staticOptions=[];break;case"location":details.text=ZPI18N.getString("zp.location"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")},Timetracker.Location.reports_loc_List instanceof Array&&Timetracker.Location.reports_loc_List.length>0?details.staticOptions=Timetracker.Reports.Filters.formatFilterData(Timetracker.Location.reports_loc_List,entity):details.staticOptions=[];break;case"orgTag":details.text=ZPeople.orgTagDisplayName,details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")},Timetracker.organizationTags.reports_orgTagList instanceof Array&&Timetracker.organizationTags.reports_orgTagList.length>0?details.staticOptions=Timetracker.Reports.Filters.formatFilterData(Timetracker.organizationTags.reports_orgTagList,entity):details.staticOptions=[];break;case"role":details.text=ZPI18N.getString("zp.role"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")},Timetracker.roles.reports_roleList instanceof Array&&Timetracker.roles.reports_roleList.length>0?details.staticOptions=Timetracker.Reports.Filters.formatFilterData(Timetracker.roles.reports_roleList,entity):details.staticOptions=[];break;case"designation":details.text=ZPI18N.getString("zp.designation"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")},Timetracker.Designation.reports_desg_List instanceof Array&&Timetracker.Designation.reports_desg_List.length>0?details.staticOptions=Timetracker.Reports.Filters.formatFilterData(Timetracker.Designation.reports_desg_List,entity):details.staticOptions=[];break;case"legalEntity":details.text=ZPeople.orgStructureDispNameMap.entity,details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")},Timetracker.LegalEntity.reports_legalEntityList instanceof Array&&Timetracker.LegalEntity.reports_legalEntityList.length>0?details.staticOptions=Timetracker.Reports.Filters.formatFilterData(Timetracker.LegalEntity.reports_legalEntityList,entity):details.staticOptions=[];break;case"businessUnit":details.text=ZPeople.orgStructureDispNameMap.unit,details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")},Timetracker.BusinessUnit.reports_businessUnitList instanceof Array&&Timetracker.BusinessUnit.reports_businessUnitList.length>0?details.staticOptions=Timetracker.Reports.Filters.formatFilterData(Timetracker.BusinessUnit.reports_businessUnitList,entity):details.staticOptions=[];break;case"division":details.text=ZPeople.orgStructureDispNameMap.division,details.showSelectedOptionCount=!0,details.enableClear=!0,details.searchDtls={text:ZPI18N.getString("zp.search")},Timetracker.Division.reports_divisionList instanceof Array&&Timetracker.Division.reports_divisionList.length>0?details.staticOptions=Timetracker.Reports.Filters.formatFilterData(Timetracker.Division.reports_divisionList,entity):details.staticOptions=[];break;case"employeeStatus":details.text=ZPI18N.getString("zp.employeestatus"),details.showSelectedOptionCount=!0,details.enableClear=!0,details.staticOptions=[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")},{id:"17",text:ZPI18N.getString("zp.logindisabledemp")}],details.searchDtls={text:ZPI18N.getString("zp.search")}}ZPLite.Filters.init(obj,details)},getAdditionalParams:function(data,params){if("employee"===data.entity){var extraParams={};ZPLite.Reports.Util.isTeamReport()?(extraParams.peopleLiteReportType="teamReport",params.key&&""!==params.key&&(extraParams.projectManagerPerm=!0),params.extraparam=JSON.stringify(extraParams)):ZPLite.Reports.Util.isOrgReport()&&(extraParams.ignoreReportees=ZPLite.Reports.getCurrentReport()===Timetracker.Reports.Constants.payrollReport||ZPLite.Reports.getCurrentReport()===Timetracker.Reports.Constants.integrations,extraParams.peopleLiteReportType="orgReport",!Timetracker.isDataAdminForAllUsers()&&params.key&&""!==params.key&&(extraParams.projectManagerPerm=ZPLite.Reports.getCurrentReport()!==Timetracker.Reports.Constants.payrollReport&&ZPLite.Reports.getCurrentReport()!==Timetracker.Reports.Constants.integrations,Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)&&(extraParams.customAdminAction=Timetracker.constants.TTCustomAdmin.ReportView)));var employeeStatusfilterDiv=Layout.Page.container.find("#filterDiv").find('[name="employeeStatusFilter"]');if(0!=employeeStatusfilterDiv.length)if((values=ZPLite.Filters.getValues(employeeStatusfilterDiv))&&values.length>0){var employeeStatus=[];$.each(values,function(index,option){employeeStatus.push(option.id)}),extraParams.employeeStatusarr=employeeStatus}params.extraparam=JSON.stringify(extraParams)}else if("client"===data.entity||"project"===data.entity||"job"===data.entity){var values,userErecNo="0",clientId="0",projectId="0",filterDiv=Layout.Page.container.find("#filterDiv");ZPLite.Reports.Util.isPersonalReport()?userErecNo=erecno:(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0&&(userErecNo="",$.each(values,function(index,option){0!==index&&(userErecNo+=","),userErecNo+=option.id})),"client"===data.entity?"0"!==userErecNo&&(params.assignedTo=userErecNo):"project"!==data.entity&&"job"!==data.entity||((values=ZPLite.Filters.getValues(filterDiv.find('[name="clientFilter"]')))&&values.length>0&&(clientId="",$.each(values,function(index,option){0!==index&&(clientId+=","),clientId+=option.id})),"project"===data.entity?(params.proAssignedTo=userErecNo,params.clientId=clientId,ZPLite.Reports.getCurrentReport()===Timetracker.Reports.Constants.projectReport&&(values=ZPLite.Filters.getValues(filterDiv.find('[name="projectStatusFilter"]')))&&values.length>0&&(params.projectStatus=values[0].id)):"job"===data.entity&&((values=ZPLite.Filters.getValues(filterDiv.find('[name="projectFilter"]')))&&values.length>0&&(projectId="",$.each(values,function(index,option){0!==index&&(projectId+=","),projectId+=option.id})),params.erecno=userErecNo,"0"!==clientId&&(params.clientId=clientId),params.projectId=projectId,ZPLite.Reports.getCurrentReport()!==Timetracker.Reports.Constants.timelogReport&&ZPLite.Reports.getCurrentReport()!==Timetracker.Reports.Constants.jobReport||(values=ZPLite.Filters.getValues(filterDiv.find('[name="jobStatusFilter"]')))&&values.length>0&&(params.jobStatus=values[0].id)))}return params},getOptionsForFilter:function(data,searchText,fetchedRecordCount){fetchedRecordCount=fetchedRecordCount||0;var options=[],result=Timetracker.Reports.Filters.getOptionsFromCache(data,searchText,fetchedRecordCount);if(result.makeRequest){var entity=data.entity;if("employee"===entity){var params={mode:"SEARCH",isDef:!0,searchType:"emp",searchMode:"TIMETRACKER_DATA",conreqcsr:csrfToken};searchText&&""!==searchText&&(params.key=encodeURIComponent(searchText)),params.start=fetchedRecordCount>0?fetchedRecordCount+1:1,params=Timetracker.Reports.Filters.getAdditionalParams(data,params),ZPeople.Request.sendAsyncPost(ZPComponents.Search.URL,params,function(response){return response.success&&(options=Timetracker.Reports.Filters.formatFilterData(ZPLite.Modules.Filters.getEmpMatchData(response,searchText),entity)),searchText&&""!==searchText?Timetracker.Reports.Filters.searchCache[entity][searchText]?Timetracker.Reports.Filters.searchCache[entity][searchText]=Timetracker.Reports.Filters.searchCache[entity][searchText].concat(options):Timetracker.Reports.Filters.searchCache[entity][searchText]=options:void 0!==Timetracker.Reports.Filters.cache[entity]?Timetracker.Reports.Filters.cache[entity]=Timetracker.Reports.Filters.cache[entity].concat(options):Timetracker.Reports.Filters.cache[entity]=options,options})}else if("client"===entity){params={mode:"getClientList",isFromFilter:!0,sortType:"0",isAscending:!0,conreqcsr:csrfToken};params=Timetracker.Reports.Filters.getAdditionalParams(data,params),searchText&&""!==searchText&&(params.searchKey=searchText),params.sIndex=fetchedRecordCount>0?fetchedRecordCount+1:0,params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,ZPeople.Request.sendAsyncPost(Timetracker.constants.URL,params,function(response){return response.res&&response.clientArr&&response.clientArr.length>0&&(options=Timetracker.Reports.Filters.formatFilterData(response.clientArr,entity)),searchText&&""!==searchText?Timetracker.Reports.Filters.searchCache[entity][searchText]?Timetracker.Reports.Filters.searchCache[entity][searchText]=Timetracker.Reports.Filters.searchCache[entity][searchText].concat(options):Timetracker.Reports.Filters.searchCache[entity][searchText]=options:void 0!==Timetracker.Reports.Filters.cache[entity]?Timetracker.Reports.Filters.cache[entity]=Timetracker.Reports.Filters.cache[entity].concat(options):Timetracker.Reports.Filters.cache[entity]=options,options})}else if("project"===entity){params={mode:"getTimesheetProjectList",projectStatus:"-1",isFromFilter:!0,includeDeptProjects:!1,sortType:"0",isAscending:!0,conreqcsr:csrfToken};params=Timetracker.Reports.Filters.getAdditionalParams(data,params),searchText&&""!==searchText&&(params.searchKey=searchText),params.sIndex=fetchedRecordCount>0?fetchedRecordCount+1:0,params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,ZPeople.Request.sendAsyncPost(Timetracker.constants.URL,params,function(response){return response&&response.length>0&&(options=Timetracker.Reports.Filters.formatFilterData(response,entity)),searchText&&""!==searchText?Timetracker.Reports.Filters.searchCache[entity][searchText]?Timetracker.Reports.Filters.searchCache[entity][searchText]=Timetracker.Reports.Filters.searchCache[entity][searchText].concat(options):Timetracker.Reports.Filters.searchCache[entity][searchText]=options:void 0!==Timetracker.Reports.Filters.cache[entity]?Timetracker.Reports.Filters.cache[entity]=Timetracker.Reports.Filters.cache[entity].concat(options):Timetracker.Reports.Filters.cache[entity]=options,options})}else if("job"===entity){params={mode:"getJobs",isFromFilter:!0,includeDeptJobs:!1,isClientDetailsNeeded:!1,jobStatus:"-1",conreqcsr:csrfToken};params=Timetracker.Reports.Filters.getAdditionalParams(data,params),searchText&&""!==searchText&&(params.searchKey=searchText),params.sIndex=fetchedRecordCount>0?fetchedRecordCount+1:0,params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,ZPeople.Request.sendAsyncPost("/timesheet.zp",params,function(response){return response&&response.length>0&&(options=Timetracker.Reports.Filters.formatFilterData(response,entity)),searchText&&""!==searchText?Timetracker.Reports.Filters.searchCache[entity][searchText]?Timetracker.Reports.Filters.searchCache[entity][searchText]=Timetracker.Reports.Filters.searchCache[entity][searchText].concat(options):Timetracker.Reports.Filters.searchCache[entity][searchText]=options:void 0!==Timetracker.Reports.Filters.cache[entity]?Timetracker.Reports.Filters.cache[entity]=Timetracker.Reports.Filters.cache[entity].concat(options):Timetracker.Reports.Filters.cache[entity]=options,options})}}else options=result.options;return options},getOptionsFromCache:function(data,searchText,fetchedRecordCount){var makeRequest=!0,entity=data.entity,firescrollDtls=data.firescrollDtls,options=[];if(searchText&&""!==searchText){if(void 0===Timetracker.Reports.Filters.searchCache[entity]&&(Timetracker.Reports.Filters.searchCache[entity]={}),void 0!==Timetracker.Reports.Filters.searchCache[entity][searchText])if(0===Timetracker.Reports.Filters.searchCache[entity][searchText].length)makeRequest=!1;else if(Timetracker.Reports.Filters.searchCache[entity][searchText].length>fetchedRecordCount){for(var itr=fetchedRecordCount;itr<Timetracker.Reports.Filters.searchCache[entity][searchText].length&&options.length<firescrollDtls.maxFetchLimit;itr++)options.push(Timetracker.Reports.Filters.searchCache[entity][searchText][itr]);makeRequest=!1}}else if(void 0!==Timetracker.Reports.Filters.cache[entity])if(0===Timetracker.Reports.Filters.cache[entity].length)makeRequest=!1;else if(Timetracker.Reports.Filters.cache[entity].length>fetchedRecordCount){for(itr=fetchedRecordCount;itr<Timetracker.Reports.Filters.cache[entity].length&&options.length<firescrollDtls.maxFetchLimit;itr++)options.push(Timetracker.Reports.Filters.cache[entity][itr]);makeRequest=!1}return{makeRequest:makeRequest,options:options}},clearCache:function(clearAll,entity){clearAll?(Timetracker.Reports.Filters.cache={},Timetracker.Reports.Filters.searchCache={}):entity&&(void 0!==Timetracker.Reports.Filters.cache[entity]&&(Timetracker.Reports.Filters.cache[entity]=void 0),void 0!==Timetracker.Reports.Filters.searchCache[entity]&&(Timetracker.Reports.Filters.searchCache[entity]=void 0))},formatFilterData:function(options,entity){var results=[];if(options)for(var itr in options){var res,option=options[itr];"employee"===entity?((res={id:option[0]}).text=option[1]+" "+ZPeople.getUserDisplayName(option[2],option[3]),""===option[6].trim()?""===option[5].trim()?res.photoUrl=ZPeople.getDefaultUserImagePath():res.photoUrl=contactUrl+"/file?ID="+option[5]+"&fs=thumb":0==option[6].indexOf("/newhr/images/sampleemployeephotos/")?res.photoUrl=option[6]:res.photoUrl="viewPhoto?filename="+option[6]):"client"===entity?res={id:option.clientId,text:option.clientName}:"project"===entity?res={id:option.projectId,text:option.projectName}:"job"===entity?res={id:option.jobId,text:option.jobName}:"department"===entity?res={id:option.dept_ID,text:option.dept_Name}:"location"===entity?res={id:option.locationId,text:option.locationName}:"orgTag"===entity?res={id:option.ORGANIZATION_TAG_ID,text:option.NAME}:"role"===entity?res={id:option.ROLEID,text:option.ROLENAME}:"designation"===entity?res={id:option.desg_ID,text:option.desg_Name}:"legalEntity"===entity?res={id:option.EntityID,text:option.Name}:"businessUnit"===entity?res={id:option.UnitID,text:option.Name}:"division"===entity&&(res={id:option.DivisionID,text:option.Name}),results.push(res)}return results},getFormattedCurrentUserOption:function(isDept){var response,userDtl=ZPeople.getUserDetailsById(erecno);return isDept?void 0!==userDtl.deptId&&""!==userDtl.deptId.trim()&&(response={id:userDtl.deptId,text:ZPeople.decodeTxt(userDtl.deptName)}):(response={id:erecno,text:userDtl.name},userDtl.thumb&&(response.photoUrl=userDtl.thumb)),response},showHideFromToDateFilter:function(container,values,reportName){let fromDateFilter=container.find('[name="fromDateFilter"]'),toDateFilter=container.find('[name="toDateFilter"]');if(jQuery.isEmptyObject(values)||"6"!==values[0].id)fromDateFilter.addClass("DNI"),toDateFilter.addClass("DNI");else{let fromDateFilterText=container.find('[name="fromDateFilterText"]'),toDateFilterText=container.find('[name="toDateFilterText"]');if(ZPLite.DateNavigator.getType(reportName)!==ZPLite.DateNavigator.TYPE.CUSTOM)fromDateFilter.val("").data("selectedDate","").removeClass("selected"),fromDateFilterText.text(""),toDateFilter.val("").data("selectedDate","").removeClass("selected"),toDateFilterText.text("");else{let customPeriodDate=ZPLite.DateNavigator.getPeriod(reportName);void 0!==customPeriodDate.from&&void 0!==customPeriodDate.to&&(fromDateFilter.val(Calendar.formatDate(customPeriodDate.from)).data("selectedDate",customPeriodDate.from),fromDateFilterText.text(Calendar.formatDate(customPeriodDate.from)),toDateFilter.val(Calendar.formatDate(customPeriodDate.to)).data("selectedDate",customPeriodDate.to),toDateFilterText.text(Calendar.formatDate(customPeriodDate.to)))}fromDateFilter.removeClass("DNI"),toDateFilter.removeClass("DNI")}}},timelogReport:{init:function(){ZPLite.Reports.setCurrentModule(ZPLite.Modules.Timetracker),ZPLite.Reports.setCurrentReport(Timetracker.Reports.Constants.timelogReport);var initParams={isModuleDataNeeded:!0,moduleDataCallback:Timetracker.Reports.init,callback:Timetracker.Reports.timelogReport.initCallback};ZPLite.Reports.initPage(initParams)},initCallback:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Modules.Timetracker),Timetracker.Reports.Util.getCommonData(),Timetracker.Reports.Filters.clearCache(!0);var filterDiv=Layout.Page.container.find("#filterDiv");Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="datePeriodFilter"]'),"datePeriod",!0,Timetracker.Reports.timelogReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="clientFilter"]'),"client",!1,Timetracker.Reports.timelogReport.filterOnChangeCallback,"TT_TIMELOG_REPORT_FILTER_CLIENT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="projectFilter"]'),"project",!1,Timetracker.Reports.timelogReport.filterOnChangeCallback,"TT_TIMELOG_REPORT_FILTER_PROJECT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="jobFilter"]'),"job",!1,Timetracker.Reports.timelogReport.filterOnChangeCallback,"TT_TIMELOG_REPORT_FILTER_JOB_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="jobStatusFilter"]'),"jobStatus",!0,Timetracker.Reports.timelogReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="approvalStatusFilter"]'),"approvalStatus",!1),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)?(filterDiv.find('[name="billableStatusFilter"]').removeClass("DNI"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="billableStatusFilter"]'),"billableStatus",!0)):filterDiv.find('[name="billableStatusFilter"]').addClass("DNI"),Timetracker.isDataAdmin()?(filterDiv.find('[name="billingStatusFilter"]').removeClass("DNI"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="billingStatusFilter"]'),"billingStatus",!0)):filterDiv.find('[name="billingStatusFilter"]').addClass("DNI"),ZPLite.Reports.Util.isPersonalReport()?(filterDiv.find('[name="includeExEmployeesFilter"]').addClass("DNI"),filterDiv.find('[name="employeeFilter"]').addClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').addClass("DNI"),filterDiv.find('[name="departmentFilter"]').addClass("DNI"),filterDiv.find('[name="locationFilter"]').addClass("DNI"),filterDiv.find('[name="orgTagFilter"]').addClass("DNI"),filterDiv.find('[name="roleFilter"]').addClass("DNI"),filterDiv.find('[name="designationFilter"]').addClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').addClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').addClass("DNI"),filterDiv.find('[name="divisionFilter"]').addClass("DNI"),filterDiv.find('[name="showDirectReporteesFilter"]').addClass("DNI")):(filterDiv.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Timetracker.Reports.timelogReport.filterOnChangeCallback,"TT_TIMELOG_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Timetracker.Reports.timelogReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})});var dateNavigationDtls={};dateNavigationDtls.mode=Timetracker.Reports.Constants.timelogReport,dateNavigationDtls.containerId=Layout.Page.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.navigationCallback=Timetracker.Reports.timelogReport.generateReport,ZPLite.DateNavigator.init(dateNavigationDtls),ZPLite.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPLite.DateNavigator.TYPE.WEEKLY,ZPLite.DateNavigator.TENSE.CURRENT),Layout.Page.container.find('[name="viewChanger"]').removeClass("DNI"),Timetracker.Reports.timelogReport.switchView(!0,!0),Timetracker.Reports.timelogReport.setDefaultFilterParams(),Timetracker.Reports.timelogReport.generateReport()},switchView:function(isChartView,preventRequest){isChartView?(Layout.Page.container.find('[name="listviewbtn"]').removeClass("sel"),Layout.Page.container.find("#timetrackerTimelogReportTable").addClass("DN"),Layout.Page.container.find('[name="chartviewbtn"]').addClass("sel"),Layout.Page.container.find("#timetrackerTimelogReportChart").removeClass("DN")):(Layout.Page.container.find('[name="chartviewbtn"]').removeClass("sel"),Layout.Page.container.find("#timetrackerTimelogReportChart").addClass("DN"),Layout.Page.container.find('[name="listviewbtn"]').addClass("sel"),Layout.Page.container.find("#timetrackerTimelogReportTable").removeClass("DN")),preventRequest||Timetracker.Reports.timelogReport.generateReport()},isChartView:function(){return Layout.Page.container.find('[name="chartviewbtn"]').hasClass("sel")},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");filterDiv.find('[name="fromDateFilter"]').addClass("DNI"),filterDiv.find('[name="toDateFilter"]').addClass("DNI"),ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"1",text:ZPI18N.getString("zp.thisweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:ZPLite.DateNavigator.TENSE.CURRENT}]),ZPLite.Reports.Util.isPersonalReport()?(ZPLite.Filters.clearValues(filterDiv.find('[name="clientFilter"]')),filterDiv.find('[name="includeExEmployeesFilter"]').addClass("DNI")):(ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),filterDiv.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0)),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),ZPLite.Filters.setValues(filterDiv.find('[name="jobStatusFilter"]'),[{id:"0",text:ZPI18N.getString("zp.inprogress")}]),ZPLite.Filters.clearValues(filterDiv.find('[name="approvalStatusFilter"]')),ZPLite.Filters.setValues(filterDiv.find('[name="billableStatusFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),Timetracker.isDataAdmin()&&ZPLite.Filters.setValues(filterDiv.find('[name="billingStatusFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]')),filterDiv.find('[name="showDirectReporteesFilter"]').find("input").prop("checked",!1)},resetFilter:function(){Timetracker.Reports.timelogReport.setDefaultFilterParams()},applyFilter:function(){var tense,customDatePeriod,container=Layout.Page.container.find("#filterDiv"),values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),type=values[0].periodType,hideNavigation=!1,errorFilters=container.find(".error-clr");if(errorFilters.length>0&&$.each(errorFilters,function(){$(this).removeClass("error-clr")}),Layout.Page.container.find('[name="viewChanger"]').removeClass("DNI"),"6"===values[0].id){var errorMessage;Layout.Page.container.find('[name="viewChanger"]').addClass("DNI"),Timetracker.Reports.timelogReport.switchView(!1,!0);var fromDate=container.find('[name="fromDateFilter"]').data("selectedDate"),toDate=container.find('[name="toDateFilter"]').data("selectedDate");if(void 0===fromDate||""===fromDate)container.find('[name="fromDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptyfromdate");else if(void 0===toDate||""===toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptytodate");else{if(fromDate>toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.greaterfromdate");else ZPDateTime.getDateDiff(fromDate,toDate)>92&&(container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.datewithindays",[92]))}if(errorMessage)return void ZPeople.Message.showWarningMsg(errorMessage);customDatePeriod={from:fromDate,to:toDate},hideNavigation=!0}else hideNavigation=!1,tense=values[0].tense,"2"!==values[0].id&&"5"!==values[0].id||(Layout.Page.container.find('[name="viewChanger"]').addClass("DNI"),Timetracker.Reports.timelogReport.switchView(!1,!0));ZPLite.DateNavigator.setPeriod(Timetracker.Reports.Constants.timelogReport,type,tense,hideNavigation,customDatePeriod),Timetracker.Reports.timelogReport.generateReport()},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("datePeriod"===data.entity){var values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]'));Timetracker.Reports.Filters.showHideFromToDateFilter(container,values,Timetracker.Reports.Constants.timelogReport)}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));-1===Timetracker.projects.Operations.findJSONArrayIndex(values,"18","id")?(container.find('[name="includeExEmployeesFilter"]').addClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!1)):container.find('[name="includeExEmployeesFilter"]').hasClass("DNI")&&(container.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0)),Timetracker.Reports.Filters.clearCache(!1,"employee");var filterDiv=container.find('[name="employeeFilter"]');ZPLite.Filters.clearOptions(filterDiv)}else{if("employee"===data.entity)0===(values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'))).length&&!ZPLite.Reports.Util.isPersonalReport()&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?container.find('[name="showDirectReporteesFilter"]').removeClass("DNI"):container.find('[name="showDirectReporteesFilter"]').addClass("DNI"),Timetracker.Reports.Filters.clearCache(!1,"client"),filterDiv=container.find('[name="clientFilter"]');else"client"===data.entity?(Timetracker.Reports.Filters.clearCache(!1,"project"),filterDiv=container.find('[name="projectFilter"]')):"project"!==data.entity&&"jobStatus"!==data.entity||(Timetracker.Reports.Filters.clearCache(!1,"job"),filterDiv=container.find('[name="jobFilter"]'));filterDiv&&(ZPLite.Filters.clearValues(filterDiv),ZPLite.Filters.clearOptions(filterDiv))}},getDefaultParams:function(fileType){var params={filter:{jobStatus:"-1",billStatus:"-1",employeeStatus:["19","-2","18"],employeeDateOfExitBased:!0},repType:Timetracker.Reports.Util.getReportTypeParam(),conreqcsr:csrfToken},periodType=ZPLite.DateNavigator.getType(Timetracker.Reports.Constants.timelogReport);let viewType=1;if(periodType===ZPLite.DateNavigator.TYPE.WEEKLY?viewType=2:periodType===ZPLite.DateNavigator.TYPE.MONTHLY?viewType=3:periodType===ZPLite.DateNavigator.TYPE.CUSTOM&&(viewType=4),params.viewType=viewType,fileType){if(params.fileType=fileType,"pdf"!==fileType){var exportContainer=Layout.Page.container.find("#tabZP5Export");exportContainer.length>0&&Timetracker.Filters.getParamsForEmpAddnFields(params,exportContainer)}delete params.conreqcsr}return params},getParamsForReport:function(fileType){var values,params=Timetracker.Reports.timelogReport.getDefaultParams(fileType),filterDiv=Layout.Page.container.find("#filterDiv");let filter=params.filter;if(ZPLite.Reports.Util.isPersonalReport())filter.userErecNo=JSON.stringify([erecno]),filter.employeeStatus=JSON.stringify(filter.employeeStatus);else{if(filter.employeeDateOfExitBased=filterDiv.find('[name="includeExEmployeesFilter"]').find("input").is(":checked"),filterDiv.find('[name="showDirectReporteesFilter"]').is(":visible")&&(filter.isDirectSubOnlyNeeded=filterDiv.find('[name="showDirectReporteesFilter"]').find("input").is(":checked")),(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0&&(1!=values.length||"0"!=values[0])){let userErecNo=[];$.each(values,function(index,option){userErecNo.push(option.id)}),filter.userErecNo=JSON.stringify(userErecNo)}else filter.showOnlyTeamData=ZPLite.Reports.Util.isTeamReport();Timetracker.Filters.getParamsForFormReltFilters(filter,filterDiv,!0,!0),Timetracker.Filters.getParamsForEmpReltFilters(filter,filterDiv,!0,!0)}if(Timetracker.Filters.getParamsForFormReltFilters(filter,filterDiv,!0,!0),(values=ZPLite.Filters.getValues(filterDiv.find('[name="jobStatusFilter"]')))&&values.length>0&&(filter.jobStatus=values[0].id),(values=ZPLite.Filters.getValues(filterDiv.find('[name="billableStatusFilter"]')))&&values.length>0&&(filter.billStatus=values[0].id),(values=ZPLite.Filters.getValues(filterDiv.find('[name="approvalStatusFilter"]')))&&values.length>0){let approvalStatusArr=[];$.each(values,function(index,option){approvalStatusArr.push(option.id)}),filter.approvalStatus=JSON.stringify(approvalStatusArr)}Timetracker.isDataAdmin()&&(values=ZPLite.Filters.getValues(filterDiv.find('[name="billingStatusFilter"]')))&&values.length>0&&(filter.billingStatus=values[0].id);var datePeriod=ZPLite.DateNavigator.getPeriod(Timetracker.Reports.Constants.timelogReport);return void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(filter.fromDate=Calendar.formatDate(datePeriod.from),filter.toDate=Calendar.formatDate(datePeriod.to)):(filter.fromDate=Calendar.formatDate(datePeriod.day),filter.toDate=Calendar.formatDate(datePeriod.day))),params.filter=JSON.stringify(filter),params.sIndex=0,params},failureCallBack:function(){var layout=Layout.Page.container;layout.find("#timetrackerTimelogReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsyet"))),layout.find("#timetrackerTimelogReport").addClass("DN")},generateReport:async function(){var params=Timetracker.Reports.timelogReport.getParamsForReport(),layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#timetrackerTimelogReport"),Timetracker.Reports.timelogReport.Firescroll.mode),layout.find("#timetrackerTimelogReport").scrollTop(0),layout.find(".ZPNdata").remove(),layout.find("#timetrackerTimelogReport").before(ZPeople.LOADING_HTML),layout.find("#timetrackerTimelogReport").addClass("DN"),layout.find("#correspondingTimeLogsDiv").fadeOut(0);let url=Timetracker.Reports.Util.getReportUrl(),isChartView=-1!==url.indexOf("/chart"),isCustomTablularView=Layout.Page.container.find('[name="tabularviewbtn"]').is(".sel:not(.DNI)");const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(url,params);layout.find(".ZPNdata").remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove();let data=0!==response.status?response.data:response.errors;if(0===response.status&&(data.hasOwnProperty("message")&&Timetracker.util.showAlert(0,data.message),"PERMISSION_DENIED_ERROR"===data.code))return layout.find("#timetrackerTimelogReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),void layout.find(".lt_nav").addClass("DN");if(jQuery.isEmptyObject(data)||jQuery.isEmptyObject(data.dataArr))layout.find("#timetrackerTimelogReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsyet"))),layout.find("#timetrackerTimelogReport").addClass("DN");else{var periodType=ZPLite.DateNavigator.getType(Timetracker.Reports.Constants.timelogReport);isChartView?(Timetracker.Reports.timelogReport.switchView(!0,!0),periodType===ZPLite.DateNavigator.TYPE.DAILY?(Timetracker.Reports.timelogReport.switchView(!0,!0),Timetracker.Reports.timelogReport.constructDailyReportChart(data.dataArr,params)):periodType===ZPLite.DateNavigator.TYPE.WEEKLY&&(Layout.Page.container.find('[name="tabularviewbtn"]').addClass("DNI"),Layout.Page.container.find('[name="chartviewbtn"]').removeClass("DNI"),Timetracker.Reports.timelogReport.constructWeekReportChart(data.dataArr,params))):isCustomTablularView&&periodType===ZPLite.DateNavigator.TYPE.CUSTOM?Timetracker.Reports.timelogReport.constructReport(data.dataArr,params,ZPLite.DateNavigator.TYPE.CUSTOM,!1):(periodType===ZPLite.DateNavigator.TYPE.MONTHLY?(layout.find("#timetrackerTimelogReportTable").attr("style","width: 3500px;"),Timetracker.Reports.timelogReport.constructReport(data.dataArr,params,periodType)):periodType===ZPLite.DateNavigator.TYPE.WEEKLY?(Timetracker.Reports.timelogReport.switchView(!1,!0),Layout.Page.container.find('[name="tabularviewbtn"]').addClass("DNI"),Layout.Page.container.find('[name="chartviewbtn"]').removeClass("DNI"),Timetracker.Reports.timelogReport.constructReport(data.dataArr,params)):Timetracker.Reports.timelogReport.constructCustomReport(data.dataArr,params,periodType),ZPLite.Firescroll.init(layout.find("#timetrackerTimelogReport"),Timetracker.Reports.timelogReport.Firescroll.mode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.timelogReport.Firescroll.loadMoreData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.timelogReport.Firescroll.mode,data.dataArr.length),Timetracker.util.init()),layout.find("#timetrackerTimelogReport").removeClass("DN"),layout.find("#timetrackerTimelogReportTable").removeAttr("style")}},constructDailyReportChart:function(resultDataArr,params){var legendHtml="",columnChartLabel=[],chartDataArray=[],chartColors=["#f0989a","#fccaa1","#ffe5a3","#b2d7ad","#9fc5c9","#9cc6e5","#b6a7d2","#d9a6bb"],colorIndex=0;resultDataArr.forEach((jobData,index)=>{legendHtml+='<li><div style="background-color: '+chartColors[colorIndex]+'"></div><desc>'+jobData.jobName+"</desc><span>"+(jobData.hours/60).toFixed(2)+"</span></li>";var jobName=ZPeople.escapeHtml(ZPeople.decodeTxt(jobData.jobName));columnChartLabel[index]=jobName,chartDataArray[index]={name:jobName,y:jobData.hours/60,color:chartColors[colorIndex]},index++,++colorIndex>=chartColors.length&&(colorIndex=0)});var chartDetails={};chartDetails.renderTo=Layout.Page.container.find("#timetrackerTimelogReportChart1").get(0),chartDetails.title=ZPI18N.getString("zp.jobs")+" Vs "+ZPI18N.getString("zp.hours"),chartDetails.spacingTop=10,chartDetails.spacingBottom=50,chartDetails.spacingLeft=50,chartDetails.spacingRight=50,chartDetails.enableScroll=columnChartLabel.length>10,chartDetails.enableLegend=!1,chartDetails.enableExport=!0,chartDetails.dataArray=[{data:chartDataArray}],chartDetails.xAxisTitle=ZPI18N.getString("zp.jobs"),chartDetails.xAxisLabel=columnChartLabel,columnChartLabel.length>10?(chartDetails.enableScroll=!0,chartDetails.xAxisMaxPointsOnFocus=9):chartDetails.xAxisMaxPointsOnFocus=columnChartLabel.length-1,chartDetails.yAxisTitle=ZPI18N.getString("zp.hours"),ZPLite.Reports.Util.constructColumnChart(chartDetails);Layout.Page.container.find("#timetrackerTimelogReportChart1").highcharts();Layout.Page.container.find("#timetrackerTimelogReportChartLegend1").html("<ul>"+legendHtml+"</ul>"),(chartDetails={}).renderTo=Layout.Page.container.find("#timetrackerTimelogReportChart2").get(0),chartDetails.title=ZPI18N.getString("zp.dayscomparison"),chartDetails.marginTop=60,chartDetails.spacingTop=30,chartDetails.spacingBottom=50,chartDetails.spacingLeft=50,chartDetails.spacingRight=50,chartDetails.enableExport=!0,chartDetails.enableLegend=!1,chartDetails.enableDataLabels=!0,chartDetails.dataArray=chartDataArray,ZPLite.Reports.Util.constructPieChart(chartDetails),Layout.Page.container.find("#timetrackerTimelogReportChart2").highcharts(),Layout.Page.container.find("#timetrackerTimelogReportChartLegend2").html("<ul>"+legendHtml+"</ul>")},constructDailyReport:function(resultData,params,periodType,isFromFirescroll){var container=Layout.Page.container.find("#timetrackerTimelogReport"),reportTotalHours=0;isFromFirescroll&&(reportTotalHours=periodType===ZPLite.DateNavigator.TYPE.DAILY?container.data("dailyReportTotalHours"):container.data("customReportTotalHours"));var html="";if($.each(resultData,function(index,data){html+='<tr class="ZPLRow">',html+='<td><img class="FL" src="'+data.employeePhoto+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+data.employeeName+'"><b>'+data.employeeId+"</b> "+data.employeeName+"</span></div></td>",html+="<td>"+data.timelogDate+"</td>",void 0!==data.clientName?html+='<td title="'+data.clientName+'">'+data.clientName+"</td>":html+="<td>---</td>",void 0!==data.projectName?html+='<td title="'+data.projectName+'">'+data.projectName+"</td>":html+="<td>---</td>",html+='<td class="CP" title="'+data.jobName+'" onclick="Timetracker.Reports.Util.showCorrespondingTimeLogs(this, event, \''+data.jobId+"','"+data.employeeErecno+"','"+params.billStatus+"', '"+data.timelogDate+"','"+data.timelogDate+"', false);\">"+data.jobName+"</td>",html+="<th>"+Calendar.minstohrs(data.hours)+"</th>",html+="</tr>",reportTotalHours+=parseInt(data.hours)}),periodType===ZPLite.DateNavigator.TYPE.DAILY?container.data("dailyReportTotalHours",reportTotalHours):container.data("customReportTotalHours",reportTotalHours),resultData.length<Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&(html+='<tr><th colspan="4" class="B0I"></th><th>'+ZPI18N.getString("zp.total")+"</th><th>"+Calendar.minstohrs(reportTotalHours)+"</th></tr>"),isFromFirescroll)container.find("#timetrackerTimelogReportTable").append(html);else{var headerHtml='<thead id="timetrackerTimelogReportHead"><tr class="ZPLHRow"><th>'+ZPI18N.getString("zp.employee")+"</th><th>"+ZPI18N.getString("zp.date")+"</th><th>"+ZPI18N.getString("zp.clientname")+'</th><th class="form_projectname tt_add_title" >'+ZPI18N.getString("zp.projectname")+'</th><th class="form_jobname tt_add_title" >'+ZPI18N.getString("zp.jobname")+"</th><th>"+ZPI18N.getString("zp.hours")+"</th></tr></thead>";html=headerHtml+'<tbody id="timetrackerTimelogReportBody">'+html+"</tbody>",container.find("#timetrackerTimelogReportTable").html(html)}},constructWeekReportChart:function(resultDataArr,params){var legendHtml="",columnChartLabel=[],chartDataArray=[],chartColors=["#f0989a","#fccaa1","#ffe5a3","#b2d7ad","#9fc5c9","#9cc6e5","#b6a7d2","#d9a6bb"],colorIndex=0;resultDataArr.forEach((jobData,index)=>{legendHtml+='<li><div style="background-color: '+chartColors[colorIndex]+'"></div><desc>'+jobData.jobName+"</desc><span>"+(jobData.hours/60).toFixed(2)+"</span></li>";var jobName=ZPeople.escapeHtml(ZPeople.decodeTxt(jobData.jobName));columnChartLabel[index]=jobName,chartDataArray[index]={name:jobName,y:jobData.hours/60,color:chartColors[colorIndex]},index++,++colorIndex>=chartColors.length&&(colorIndex=0)});var chartDetails={};chartDetails.renderTo=Layout.Page.container.find("#timetrackerTimelogReportChart1").get(0),chartDetails.title=ZPI18N.getString("zp.jobs")+" Vs "+ZPI18N.getString("zp.hours"),chartDetails.spacingTop=20,chartDetails.spacingBottom=50,chartDetails.spacingLeft=50,chartDetails.spacingRight=50,chartDetails.enableScroll=columnChartLabel.length>10,chartDetails.enableLegend=!1,chartDetails.enableExport=!0,chartDetails.dataArray=[{data:chartDataArray}],chartDetails.xAxisTitle=ZPI18N.getString("zp.jobs"),chartDetails.xAxisLabel=columnChartLabel,columnChartLabel.length>10?(chartDetails.enableScroll=!0,chartDetails.xAxisMaxPointsOnFocus=9):chartDetails.xAxisMaxPointsOnFocus=columnChartLabel.length-1,chartDetails.yAxisTitle=ZPI18N.getString("zp.hours"),ZPLite.Reports.Util.constructColumnChart(chartDetails);Layout.Page.container.find("#timetrackerTimelogReportChart1").highcharts();Layout.Page.container.find("#timetrackerTimelogReportChartLegend1").html("<ul>"+legendHtml+"</ul>"),(chartDetails={}).renderTo=Layout.Page.container.find("#timetrackerTimelogReportChart2").get(0),chartDetails.title=ZPI18N.getString("zp.dayscomparison"),chartDetails.marginTop=60,chartDetails.spacingTop=30,chartDetails.spacingBottom=50,chartDetails.spacingLeft=50,chartDetails.spacingRight=50,chartDetails.enableLegend=!1,chartDetails.enableExport=!0,chartDetails.enableDataLabels=!0,chartDetails.dataArray=chartDataArray,ZPLite.Reports.Util.constructPieChart(chartDetails),Layout.Page.container.find("#timetrackerTimelogReportChart2").highcharts(),Layout.Page.container.find("#timetrackerTimelogReportChartLegend2").html("<ul>"+legendHtml+"</ul>")},constructReport:function(resultData,params,periodType,isFromFirescroll){var html="",container=Layout.Page.container.find("#timetrackerTimelogReport");let keyName="timelogReportColumnWiseTotalHours";var columnWiseTotalHours=isFromFirescroll?container.data(keyName):{};let isMonth=periodType===ZPLite.DateNavigator.TYPE.MONTHLY,filter=JSON.parse(params.filter),dateObj=Timetracker.Reports.timelogReport.getDateRangeObj();for(var itr=0;itr<resultData.length;itr++){var timelogObj,value=resultData[itr],timelogDtls=value.timelogDtls;for(let key in timelogDtls){var rowWiseTotalHours=0;let jobObj=timelogDtls[key].jobTimelogDate,jobObjDtls=timelogDtls[key].jobObjDtls;html+='<tr class="ZPLRow">',html+='<td class="'+(isMonth?"colM1_sticky":"")+'"><img class="FL" src="'+value.employeePhoto+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+value.employeeName+'"><b>'+value.employeeId+"</b> "+value.employeeName+"</span></div></td>",void 0!==jobObjDtls.clientName?html+='<td class="'+(isMonth?"colM2_sticky":"")+'"  title="'+jobObjDtls.clientName+'">'+jobObjDtls.clientName+"</td>":html+='<td class="'+(isMonth?"colM2_sticky":"")+'"  >---</td>',void 0!==jobObjDtls.projectName?html+='<td class="'+(isMonth?"colM3_sticky":"")+'"  title="'+jobObjDtls.projectName+'">'+jobObjDtls.projectName+"</td>":html+='<td class="'+(isMonth?"colM3_sticky":"")+'" >---</td>',void 0!==jobObjDtls.jobName?html+='<td class="'+(isMonth?"CP colM4_sticky":"CP")+'"  title="'+jobObjDtls.jobName+'" onclick="Timetracker.Reports.Util.showCorrespondingTimeLogs(this, event, \''+jobObjDtls.jobId+"','"+value.employeeErecNo+"','"+filter.billStatus+"', '"+filter.fromDate+"','"+filter.toDate+"', false);\">"+jobObjDtls.jobName+"</td>":html+='<td class="'+(isMonth?"colM4_sticky":"")+'"  >---</td>',Object.keys(dateObj).forEach((tempDate,dateNo)=>{jobObj[tempDate]?(timelogObj=jobObj[tempDate],html+='<td class="text-center">'+Calendar.minstohrs(timelogObj.hours)+"</td>",rowWiseTotalHours+=timelogObj.hours,void 0===columnWiseTotalHours[tempDate]?columnWiseTotalHours[tempDate]=timelogObj.hours:columnWiseTotalHours[tempDate]+=timelogObj.hours):html+='<td class="text-center">00:00</td>'}),html+="<th>"+Calendar.minstohrs(rowWiseTotalHours)+"</th>",html+="</tr>"}}if(container.data(keyName,columnWiseTotalHours),resultData.length<Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT){var grandTotal=0;html+="<tr>",html+='<th class="'+(isMonth?"colM1_sticky gry_bg":"gry_bg")+'" colspan="3"></th>',html+='<th class="'+(isMonth?"colM4_sticky gry_bg":"gry_bg")+'">'+ZPI18N.getString("zp.total")+"</th>",Object.keys(dateObj).forEach((tempDate,dateNo)=>{columnWiseTotalHours[tempDate]?(html+='<th class="text-center">'+Calendar.minstohrs(columnWiseTotalHours[tempDate])+"</th>",grandTotal+=columnWiseTotalHours[tempDate]):html+='<th class="text-center">00:00</th>'}),html+="<th>"+Calendar.minstohrs(grandTotal)+"</th>",html+="</tr>"}if(isFromFirescroll)container.find("#timetrackerTimelogReportTable").append(html);else{var headerHtml='<thead id="timetrackerTimelogReportHead"><tr class="ZPLHRow"><th class="'+(isMonth?"colM1_sticky":"")+'">'+ZPI18N.getString("zp.employee")+'</th><th class="'+(isMonth?"colM2_sticky":"")+'">'+ZPI18N.getString("zp.clientname")+'</th><th class="'+(isMonth?"colM3_sticky":"")+' form_projectname tt_add_title">'+ZPI18N.getString("zp.projectname")+'</th><th class="'+(isMonth?"colM4_sticky":"")+' form_jobname tt_add_title">'+ZPI18N.getString("zp.jobname")+"</th>";for(var tempDate in dateObj){var curDate=dateObj[tempDate],date=curDate.getDate();date<10&&(date="0"+date),headerHtml+='<th class="text-center"><span>'+months[curDate.getMonth()]+" "+date+'</span><span class="DB gry S13 MT5">'+days[curDate.getDay()]+"</span></th>"}headerHtml+="<th>"+ZPI18N.getString("zp.total")+"</th></tr></thead>",html=headerHtml+'<tbody id="timetrackerTimelogReportBody">'+html+"</tbody>",container.find("#timetrackerTimelogReportTable").html(html)}},constructCustomReport:function(resultData,params,periodType,isFromFirescroll){var container=Layout.Page.container.find("#timetrackerTimelogReport");let filter=JSON.parse(params.filter);var reportTotalHours=0;isFromFirescroll&&(reportTotalHours=periodType===ZPLite.DateNavigator.TYPE.DAILY?container.data("dailyReportTotalHours"):container.data("customReportTotalHours"));for(var html="",itr=0;itr<resultData.length;itr++){var value=resultData[itr],timelogDtls=value.timelogDtls;for(let key in timelogDtls){let jobObj=timelogDtls[key].jobTimelogDate,jobObjDtls=timelogDtls[key].jobObjDtls;for(var timelogDate in jobObj){let timelogObj=jobObj[timelogDate];html+='<tr class="ZPLRow">',html+='<td><img class="FL" src="'+value.employeePhoto+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+value.employeeName+'"><b>'+value.employeeId+"</b> "+value.employeeName+"</span></div></td>",html+="<td>"+timelogObj.timelogDate+"</td>",void 0!==jobObjDtls.clientName?html+='<td title="'+jobObjDtls.clientName+'">'+jobObjDtls.clientName+"</td>":html+="<td>---</td>",void 0!==jobObjDtls.projectName?html+='<td title="'+jobObjDtls.projectName+'">'+jobObjDtls.projectName+"</td>":html+="<td>---</td>",html+='<td class="CP" title="'+jobObjDtls.jobName+'" onclick="Timetracker.Reports.Util.showCorrespondingTimeLogs(this, event, \''+jobObjDtls.jobId+"','"+value.employeeErecNo+"','"+filter.billStatus+"', '"+timelogObj.timelogDate+"','"+timelogObj.timelogDate+"', false);\">"+jobObjDtls.jobName+"</td>",html+="<th>"+Calendar.minstohrs(timelogObj.hours)+"</th>",html+="</tr>",reportTotalHours+=parseInt(timelogObj.hours)}}}(periodType===ZPLite.DateNavigator.TYPE.DAILY?container.data("dailyReportTotalHours",reportTotalHours):container.data("customReportTotalHours",reportTotalHours),resultData.length<Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&(html+='<tr><th colspan="4" class="B0I"></th><th>'+ZPI18N.getString("zp.total")+"</th><th>"+Calendar.minstohrs(reportTotalHours)+"</th></tr>"),isFromFirescroll)?container.find("#timetrackerTimelogReportTable").append(html):(html='<thead id="timetrackerTimelogReportHead"><tr class="ZPLHRow"><th>'+ZPI18N.getString("zp.employee")+"</th><th>"+ZPI18N.getString("zp.date")+"</th><th>"+ZPI18N.getString("zp.clientname")+'</th><th class="form_projectname tt_add_title" >'+ZPI18N.getString("zp.projectname")+'</th><th class="form_jobname tt_add_title" >'+ZPI18N.getString("zp.jobname")+"</th><th>"+ZPI18N.getString("zp.hours")+"</th></tr></thead>"+'<tbody id="timetrackerTimelogReportBody">'+html+"</tbody>",container.find("#timetrackerTimelogReportTable").html(html))},constructWeekReport:function(resultData,params,isFromFirescroll){var html="",container=Layout.Page.container.find("#timetrackerTimelogReport"),columnWiseTotalHours=isFromFirescroll?container.data("weekReportColumnWiseTotalHours"):{};let dateObj=Timetracker.Reports.timelogReport.getDateRangeObj();for(var itr=0;itr<resultData.length;itr++){var timelogObj,rowWiseTotalHours=0,value=resultData[itr],timelogDtls=value.timelogDtls;for(let key in timelogDtls){let jobObj=timelogDtls[key].jobTimelogDate,jobObjDtls=timelogDtls[key].jobObjDtls;html+='<tr class="ZPLRow">',html+='<td><img class="FL" src="'+value.employeePhoto+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+value.employeeName+'"><b>'+value.employeeId+"</b> "+value.employeeName+"</span></div></td>",void 0!==jobObjDtls.clientName?html+='<td title="'+jobObjDtls.clientName+'">'+jobObjDtls.clientName+"</td>":html+="<td>---</td>",void 0!==jobObjDtls.projectName?html+='<td title="'+jobObjDtls.projectName+'">'+jobObjDtls.projectName+"</td>":html+="<td>---</td>",void 0!==jobObjDtls.jobName?html+='<td class="CP" title="'+jobObjDtls.jobName+'" onclick="Timetracker.Reports.Util.showCorrespondingTimeLogs(this, event, \''+jobObjDtls.jobId+"','"+value.employeeErecNo+"','"+params.billStatus+"', '"+params.fromDate+"','"+params.toDate+"', false);\">"+jobObjDtls.jobName+"</td>":html+="<td>---</td>",Object.keys(dateObj).forEach((tempDate,dateNo)=>{jobObj[tempDate]?(timelogObj=jobObj[tempDate],html+='<td class="text-center">'+Calendar.minstohrs(timelogObj.hours)+"</td>",rowWiseTotalHours+=timelogObj.hours,void 0===columnWiseTotalHours[tempDate]?columnWiseTotalHours[tempDate]=timelogObj.hours:columnWiseTotalHours[tempDate]+=timelogObj.hours):html+='<td class="text-center">00:00</td>'}),html+="<th>"+Calendar.minstohrs(rowWiseTotalHours)+"</th>",html+="</tr>"}}if(container.data("weekReportColumnWiseTotalHours",columnWiseTotalHours),resultData.length<Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT){var grandTotal=0;html+="<tr>",html+='<th colspan="3"></th>',html+="<th>"+ZPI18N.getString("zp.total")+"</th>",Object.keys(dateObj).forEach((tempDate,dateNo)=>{columnWiseTotalHours[tempDate]?(html+='<th class="text-center">'+Calendar.minstohrs(columnWiseTotalHours[tempDate])+"</th>",grandTotal+=columnWiseTotalHours[tempDate]):html+='<th class="text-center">00:00</th>'}),html+="<th>"+Calendar.minstohrs(grandTotal)+"</th>",html+="</tr>"}if(isFromFirescroll)container.find("#timetrackerTimelogReportTable").append(html);else{var headerHtml='<thead id="timetrackerTimelogReportHead"><tr class="ZPLHRow"><th>'+ZPI18N.getString("zp.employee")+"</th><th>"+ZPI18N.getString("zp.clientname")+'</th><th class="form_projectname tt_add_title">'+ZPI18N.getString("zp.projectname")+'</th><th class="form_jobname tt_add_title">'+ZPI18N.getString("zp.jobname")+"</th>",weekFromDate=ZPLite.DateNavigator.getPeriod(Timetracker.Reports.Constants.timelogReport).from.getTime(),weekStarts=new Date;for(weekStarts.setTime(weekFromDate),i=0;i<7;i++){i>0&&weekStarts.setDate(weekStarts.getDate()+1);var date=weekStarts.getDate();date<10&&(date="0"+date),headerHtml+='<th class="text-center"><span>'+months[weekStarts.getMonth()]+" "+date+'</span><span class="DB gry S13 MT5">'+days[weekStarts.getDay()]+"</span></th>"}headerHtml+="<th>"+ZPI18N.getString("zp.total")+"</th></tr></thead>",html=headerHtml+'<tbody id="timetrackerTimelogReportBody">'+html+"</tbody>",container.find("#timetrackerTimelogReportTable").html(html)}},constructMonthReport:function(resultData,params,isFromFirescroll){var container=Layout.Page.container.find("#timetrackerTimelogReport"),lastDate=ZPLite.DateNavigator.getPeriod(Timetracker.Reports.Constants.timelogReport).to,lastDay=lastDate.getDate(),html="",columnWiseTotalHours=isFromFirescroll?container.data("monthReportColumnWiseTotalHours"):{};let dateObj=Timetracker.Reports.timelogReport.getDateRangeObj();for(var itr=0;itr<resultData.length;itr++){var empObj=resultData[itr],dayWiseLogHoursArray=empObj.timelogDtls;for(let key in dayWiseLogHoursArray){var currentRowHtml="",currentRowHoursHtml="",currentRowTotalHours=0;let jobObj=dayWiseLogHoursArray[key].jobTimelogDate,jobObjDtls=dayWiseLogHoursArray[key].jobObjDtls;Object.keys(dateObj).forEach((tempDate,dateNo)=>{if(jobObj[tempDate]){var hoursVal=jobObj[tempDate].hours,clientName="---",projectName="---";void 0!==jobObjDtls.clientName&&(clientName=jobObjDtls.clientName),void 0!==jobObjDtls.projectName&&(projectName=jobObjDtls.projectName),""===currentRowHtml&&(currentRowHtml='<tr class="ZPLRow"><td class="colM1_sticky"><img class="FL" src="'+empObj.employeePhoto+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+empObj.employeeName+'"><b>'+empObj.employeeId+"</b> "+empObj.employeeName+"</span></div></td>",currentRowHtml+='<td class="colM2_sticky" title="'+clientName+'">'+clientName+"</td>",currentRowHtml+='<td class="colM3_sticky" title="'+projectName+'">'+projectName+"</td>",currentRowHtml+='<td class="CP colM4_sticky" title="'+jobObjDtls.jobName+'" onclick="Timetracker.Reports.Util.showCorrespondingTimeLogs(this,event,\''+jobObjDtls.jobId+"','"+empObj.employeeErecno+"','"+params.billStatus+"', '"+params.fromDate+"','"+params.toDate+"', false);\">"+jobObjDtls.jobName+"</td>"),void 0!==columnWiseTotalHours[tempDate]?columnWiseTotalHours[tempDate]+=hoursVal:columnWiseTotalHours[tempDate]=hoursVal,currentRowTotalHours+=hoursVal}currentRowHoursHtml+=void 0!==hoursVal?'<td class="text-center">'+Calendar.minstohrs(hoursVal)+"</td>":'<td class="text-center">00:00</td>'}),html+=currentRowHtml+currentRowHoursHtml+"<th>"+Calendar.minstohrs(currentRowTotalHours)+"</th></tr>"}}if(container.data("monthReportColumnWiseTotalHours",columnWiseTotalHours),resultData.length<Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT){var grandTotal=0;html+='<tr><th class="colM1_sticky gry_bg" colspan="3"></th><th class="colM4_sticky gry_bg">'+ZPI18N.getString("zp.total")+"</th>",Object.keys(dateObj).forEach((tempDate,dateNo)=>{void 0!==columnWiseTotalHours[tempDate]?(html+='<th class="text-center">'+Calendar.minstohrs(columnWiseTotalHours[tempDate])+"</th>",grandTotal+=columnWiseTotalHours[tempDate]):html+='<th class="text-center">00:00</th>'}),html+="<th>"+Calendar.minstohrs(grandTotal)+"</th></tr>"}if(isFromFirescroll)Layout.Page.container.find("#timetrackerTimelogReportTable").append(html);else{for(var headerHtml='<thead id="timetrackerTimelogReportHead"><tr class="ZPLHRow"><th class="colM1_sticky">'+ZPI18N.getString("zp.employee")+'</th><th class="colM2_sticky">'+ZPI18N.getString("zp.clientname")+'</th><th class="colM3_sticky form_projectname tt_add_title">'+ZPI18N.getString("zp.projectname")+'</th><th class="colM4_sticky form_jobname tt_add_title">'+ZPI18N.getString("zp.jobname")+"</th>",i=1;i<=lastDay;i++)lastDate.setDate(i),headerHtml+='<th class="text-center"><span class="min_wd50">'+months[lastDate.getMonth()]+" "+i+'</span><span class="DB gry S13 MT5">'+days[lastDate.getDay()]+"</span></th>";headerHtml+='<th class="text-center">'+ZPI18N.getString("zp.total")+"</th></tr></thead>",Layout.Page.container.find("#timetrackerTimelogReportTable").html(headerHtml+'<tbody id="timetrackerTimelogReportBody">'+html+"</tbody>")}},getDateRangeObj:function(){var dateArr={};let datePeriod=ZPLite.DateNavigator.getPeriod(Timetracker.Reports.Constants.timelogReport),fromDate=datePeriod.from||datePeriod.day,toDate=datePeriod.to||datePeriod.day,curDate=new Date(fromDate);for(;curDate<=toDate;){var date=curDate.getDate();date<10&&(date="0"+date);var month=curDate.getMonth()+1;month<10&&(month="0"+month),dateArr[curDate.getFullYear()+"-"+month+"-"+date]=new Date(curDate),curDate.setDate(curDate.getDate()+1)}return dateArr},Firescroll:{mode:"TT_TIMELOG_REPORT_FIRESCROLL",correspondingLogsMode:"TT_TIMELOG_REPORT_TIMELOGS_FIRESCROLL",loadMoreData:async function(extraDtls){var params=extraDtls.params;params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.timelogReport.Firescroll.mode);let url=Timetracker.Reports.Util.getReportUrl();const[response]=await Timetracker.Request.sendRequestAsPromiseWithCatch(url,params);response.data;ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.timelogReport.Firescroll.mode,!1);let dataArr=response.data&&response.data.dataArr||[];var periodType=ZPLite.DateNavigator.getType(Timetracker.Reports.Constants.timelogReport);periodType===ZPLite.DateNavigator.TYPE.DAILY||periodType===ZPLite.DateNavigator.TYPE.CUSTOM?(Timetracker.Reports.timelogReport.constructCustomReport(dataArr,params,periodType,!0),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.timelogReport.Firescroll.mode,dataArr.length)):periodType===ZPLite.DateNavigator.TYPE.WEEKLY?(Timetracker.Reports.timelogReport.constructReport(dataArr,params,periodType,!0),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.timelogReport.Firescroll.mode,dataArr.length)):periodType===ZPLite.DateNavigator.TYPE.MONTHLY&&(Timetracker.Reports.timelogReport.constructReport(dataArr,params,periodType,!0),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.timelogReport.Firescroll.mode,dataArr.length))},loadMoreCorrespondingLogs:function(extraDtls){var params=extraDtls.params;params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.timelogReport.Firescroll.correspondingLogsMode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.timelogReport.Firescroll.correspondingLogsMode,!1),response=response||[],Timetracker.Reports.Util.constructCorrespondinglogsHtml(response,params.userErecNo,"#timetrackerTimelogReport"),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.timelogReport.Firescroll.correspondingLogsMode,response.length)})}},showExport:function(currentObj){$(currentObj).hasClass("open")?$(currentObj).removeClass("open"):(Timetracker.Reports.Util.getCommonData(),$(currentObj).addClass("open"))},exportReport:function(mode,extraParams,fileType){var requestUrl="timetracker/report/timelog/export?",params=Timetracker.Reports.timelogReport.getParamsForReport(fileType);params.filter=encodeURIComponent(params.filter),$.each(params,function(key,value){requestUrl+=key+"="+value+"&"}),requestUrl=requestUrl.substring(0,requestUrl.length-1),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.generatingreport"),5e3),Timetracker.ImportExport.submiteFormForExport(requestUrl)},printReport:function(){Timetracker.Reports.timelogReport.getParamsForReport();Timetracker.util.printReport()}},timelogLeaveReport:{init:function(){ZPLite.Reports.setCurrentModule(ZPLite.Modules.Timetracker),ZPLite.Reports.setCurrentReport(Timetracker.Reports.Constants.timelogLeaveReport);var initParams={isModuleDataNeeded:!0,moduleDataCallback:Timetracker.Reports.init,callback:Timetracker.Reports.timelogLeaveReport.initCallback};ZPLite.Reports.initPage(initParams)},initCallback:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Modules.Timetracker),Timetracker.Reports.Util.getCommonData(),Timetracker.Reports.Filters.clearCache(!0);let filterDiv=Layout.Page.container.find("#filterDiv");Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="datePeriodFilter"]'),"datePeriod",!0,Timetracker.Reports.timelogLeaveReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="clientFilter"]'),"client",!1,Timetracker.Reports.timelogLeaveReport.filterOnChangeCallback,"TT_JOB_REPORT_FILTER_CLIENT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="projectFilter"]'),"project",!1,Timetracker.Reports.timelogLeaveReport.filterOnChangeCallback,"TT_JOB_REPORT_FILTER_PROJECT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="jobFilter"]'),"job",!1,Timetracker.Reports.timelogLeaveReport.filterOnChangeCallback,"TT_JOB_REPORT_FILTER_JOB_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="approvalStatusFilter"]'),"approvalStatus",!0),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)?(filterDiv.find('[name="billableStatusFilter"]').removeClass("DNI"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="billableStatusFilter"]'),"billableStatus",!0)):filterDiv.find('[name="billableStatusFilter"]').addClass("DNI"),Timetracker.isDataAdmin()?(filterDiv.find('[name="billingStatusFilter"]').removeClass("DNI"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="billingStatusFilter"]'),"billingStatus",!0)):filterDiv.find('[name="billingStatusFilter"]').addClass("DNI"),ZPLite.Reports.Util.isPersonalReport()?(filterDiv.find('[name="includeExEmployeesFilter"]').addClass("DNI"),filterDiv.find('[name="employeeFilter"]').addClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').addClass("DNI"),filterDiv.find('[name="departmentFilter"]').addClass("DNI"),filterDiv.find('[name="locationFilter"]').addClass("DNI"),filterDiv.find('[name="orgTagFilter"]').addClass("DNI"),filterDiv.find('[name="roleFilter"]').addClass("DNI"),filterDiv.find('[name="designationFilter"]').addClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').addClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').addClass("DNI"),filterDiv.find('[name="divisionFilter"]').addClass("DNI")):(filterDiv.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Timetracker.Reports.timelogLeaveReport.filterOnChangeCallback,"TT_TIMELOG_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Timetracker.Reports.timelogLeaveReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})});var dateNavigationDtls={};dateNavigationDtls.mode=Timetracker.Reports.Constants.timelogLeaveReport,dateNavigationDtls.containerId=Layout.Page.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.navigationCallback=Timetracker.Reports.timelogLeaveReport.generateReport,ZPLite.DateNavigator.init(dateNavigationDtls),ZPLite.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPLite.DateNavigator.TYPE.WEEKLY,ZPLite.DateNavigator.TENSE.CURRENT),Timetracker.Reports.timelogLeaveReport.setDefaultFilterParams(),Timetracker.Reports.timelogLeaveReport.generateReport()},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");filterDiv.find('[name="fromDateFilter"]').addClass("DNI"),filterDiv.find('[name="toDateFilter"]').addClass("DNI"),ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"1",text:ZPI18N.getString("zp.thisweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:ZPLite.DateNavigator.TENSE.CURRENT}]),ZPLite.Reports.Util.isPersonalReport()?(ZPLite.Filters.clearValues(filterDiv.find('[name="clientFilter"]')),filterDiv.find('[name="includeExEmployeesFilter"]').addClass("DNI")):(ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),filterDiv.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0)),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),ZPLite.Filters.setValues(filterDiv.find('[name="approvalStatusFilter"]'),[{id:"0",text:ZPI18N.getString("zp.all")}]),ZPLite.Filters.setValues(filterDiv.find('[name="billableStatusFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),Timetracker.isDataAdmin()&&ZPLite.Filters.setValues(filterDiv.find('[name="billingStatusFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]')),filterDiv.find('[name="showDirectReporteesFilter"]').find("input").prop("checked",!1)},resetFilter:function(){Timetracker.Reports.timelogLeaveReport.setDefaultFilterParams()},applyFilter:function(){var tense,customDatePeriod,container=Layout.Page.container.find("#filterDiv"),values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),type=values[0].periodType,hideNavigation=!1,errorFilters=container.find(".error-clr");if(errorFilters.length>0&&$.each(errorFilters,function(){$(this).removeClass("error-clr")}),"6"===values[0].id){var errorMessage,fromDate=container.find('[name="fromDateFilter"]').data("selectedDate"),toDate=container.find('[name="toDateFilter"]').data("selectedDate");if(void 0===fromDate||""===fromDate)container.find('[name="fromDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptyfromdate");else if(void 0===toDate||""===toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptytodate");else{if(fromDate>toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.greaterfromdate");else ZPDateTime.getDateDiff(fromDate,toDate)>32&&(container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.datewithindays",[32]))}if(errorMessage)return void ZPeople.Message.showWarningMsg(errorMessage);customDatePeriod={from:fromDate,to:toDate},hideNavigation=!0}else hideNavigation=!1,tense=values[0].tense;ZPLite.DateNavigator.setPeriod(Timetracker.Reports.Constants.timelogLeaveReport,type,tense,hideNavigation,customDatePeriod),Timetracker.Reports.timelogLeaveReport.generateReport()},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("datePeriod"===data.entity){var values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]'));Timetracker.Reports.Filters.showHideFromToDateFilter(container,values,Timetracker.Reports.Constants.timelogLeaveReport)}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));-1===Timetracker.projects.Operations.findJSONArrayIndex(values,"18","id")?(container.find('[name="includeExEmployeesFilter"]').addClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!1)):container.find('[name="includeExEmployeesFilter"]').hasClass("DNI")&&(container.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0)),Timetracker.Reports.Filters.clearCache(!1,"employee");var filterDiv=container.find('[name="employeeFilter"]');ZPLite.Filters.clearOptions(filterDiv)}else{if("employee"===data.entity)0===(values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'))).length&&!ZPLite.Reports.Util.isPersonalReport()&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?container.find('[name="showDirectReporteesFilter"]').removeClass("DNI"):container.find('[name="showDirectReporteesFilter"]').addClass("DNI"),Timetracker.Reports.Filters.clearCache(!1,"client"),filterDiv=container.find('[name="clientFilter"]');else"client"===data.entity?(Timetracker.Reports.Filters.clearCache(!1,"project"),filterDiv=container.find('[name="projectFilter"]')):"project"!==data.entity&&"jobStatus"!==data.entity||(Timetracker.Reports.Filters.clearCache(!1,"job"),filterDiv=container.find('[name="jobFilter"]'));filterDiv&&(ZPLite.Filters.clearValues(filterDiv),ZPLite.Filters.clearOptions(filterDiv))}},getDefaultParams:function(fileType){var params={mode:void 0===fileType?"getTimelogLeaveReport":"exportTimelogLeaveReport",userErecNo:"0",clientId:"0",projectId:"0",jobId:"0",billStatus:"-1",approvalStatus:"0",employeeStatus:"19,-2,18",departmentId:"0",locationId:"0",designationId:"0",isDirectSubOnlyNeeded:!1,employeeDateOfExitBased:!0,repType:Timetracker.Reports.Util.getReportTypeParam(),conreqcsr:csrfToken};if(fileType){if(params.fileType=fileType,"pdf"!==fileType){var exportContainer=Layout.Page.container.find("#tabZP5Export");exportContainer.length>0&&Timetracker.Filters.getParamsForEmpAddnFields(params,exportContainer)}delete params.conreqcsr}return params},getParamsForReport:function(fileType){var values,params=Timetracker.Reports.timelogLeaveReport.getDefaultParams(fileType),filterDiv=Layout.Page.container.find("#filterDiv");if((Layout.Page.container.find("#sortByEmployeeName").hasClass("sort-u")||Layout.Page.container.find("#sortByEmployeeName").hasClass("sort-d"))&&(params.sortType=Layout.Page.container.find("#sortByEmployeeName").hasClass("sort-u")?"0":"1"),ZPLite.Reports.Util.isPersonalReport())params.userErecNo=erecno;else{if(params.employeeDateOfExitBased=filterDiv.find('[name="includeExEmployeesFilter"]').find("input").is(":checked"),filterDiv.find('[name="showDirectReporteesFilter"]').is(":visible")&&(params.isDirectSubOnlyNeeded=filterDiv.find('[name="showDirectReporteesFilter"]').find("input").is(":checked")),(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var userErecNo="";$.each(values,function(index,option){0!==index&&(userErecNo+=","),userErecNo+=option.id}),params.userErecNo=userErecNo}else params.showOnlyTeamData=ZPLite.Reports.Util.isTeamReport();Timetracker.Filters.getParamsForEmpReltFilters(params,filterDiv)}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="clientFilter"]')))&&values.length>0){var clientId="";$.each(values,function(index,option){0!==index&&(clientId+=","),clientId+=option.id}),params.clientId=clientId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="projectFilter"]')))&&values.length>0){var projectId="";$.each(values,function(index,option){0!==index&&(projectId+=","),projectId+=option.id}),params.projectId=projectId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="jobFilter"]')))&&values.length>0){var jobId="";$.each(values,function(index,option){0!==index&&(jobId+=","),jobId+=option.id}),params.jobId=jobId}(values=ZPLite.Filters.getValues(filterDiv.find('[name="billableStatusFilter"]')))&&values.length>0&&(params.billStatus=values[0].id),(values=ZPLite.Filters.getValues(filterDiv.find('[name="approvalStatusFilter"]')))&&values.length>0&&(params.approvalStatus=values[0].id),Timetracker.isDataAdmin()&&(values=ZPLite.Filters.getValues(filterDiv.find('[name="billingStatusFilter"]')))&&values.length>0&&(params.billingStatus=values[0].id);var datePeriod=ZPLite.DateNavigator.getPeriod(Timetracker.Reports.Constants.timelogLeaveReport);return void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(params.fromDate=Calendar.formatDate(datePeriod.from),params.toDate=Calendar.formatDate(datePeriod.to)):(params.fromDate=Calendar.formatDate(datePeriod.day),params.toDate=Calendar.formatDate(datePeriod.day))),params.sIndex=0,params},generateReport:function(){var params=Timetracker.Reports.timelogLeaveReport.getParamsForReport(),layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#timetrackerTimelogLeaveReport"),Timetracker.Reports.timelogLeaveReport.Firescroll.mode),layout.find("#timetrackerTimelogLeaveReport").scrollTop(0),layout.find(".ZPNdata").remove(),layout.find("#timetrackerTimelogLeaveReport").before(ZPeople.LOADING_HTML),layout.find("#timetrackerTimelogLeaveReport").addClass("DN"),ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){if(layout.find(".ZPNdata").remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),null===response||response&&("permissionDenied"===response.error||response.errorCode==Timetracker.constants.ERROR_CODES.NO_PERM_CODE))return layout.find("#timetrackerTimelogLeaveReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),void layout.find(".lt_nav").addClass("DN");response=void 0!==response&&response.length>0?response[0]:null,jQuery.isEmptyObject(response)?(layout.find("#timetrackerTimelogLeaveReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsyet"))),layout.find("#timetrackerTimelogLeaveReport").addClass("DN")):(Timetracker.Reports.timelogLeaveReport.constructReport(response,params),ZPLite.Firescroll.init(layout.find("#timetrackerTimelogLeaveReport"),Timetracker.Reports.timelogLeaveReport.Firescroll.mode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.timelogLeaveReport.Firescroll.loadMoreData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.timelogLeaveReport.Firescroll.mode,Object.keys(response).length),Timetracker.util.init(),layout.find("#timetrackerTimelogLeaveReport").removeClass("DN"),layout.find("#timetrackerTimelogLeaveReportTable").removeAttr("style"))})},getJobColumnHtml:function(jobData,isPdNeeded){let rowSpan=jobData.maxTimelogRowsPerDay||1,jobRowHtml='<td rowspan="'+rowSpan+'"   title="'+(void 0!==jobData.clientName?jobData.clientName:"")+'" class="colM2_sticky'+(isPdNeeded?" pd8":"")+'">'+(void 0!==jobData.clientName?jobData.clientName:"-")+"</td>";return jobRowHtml+='<td rowspan="'+rowSpan+'"  title="'+(void 0!==jobData.projectName?jobData.projectName:"")+'" class="colM3_sticky'+(isPdNeeded?" pd8":"")+'">'+(void 0!==jobData.projectName?jobData.projectName:"-")+"</td>",jobRowHtml+='<td rowspan="'+rowSpan+'"  title="'+(void 0!==jobData.jobName?jobData.jobName:"")+'"  class="colM4_sticky'+(isPdNeeded?" pd8":"")+'">'+(void 0!==jobData.jobName?jobData.jobName:"-")+"</td>"},getDateRangeObj:function(){var dateArr={};let datePeriod=ZPLite.DateNavigator.getPeriod(Timetracker.Reports.Constants.timelogLeaveReport),fromDate=datePeriod.from||datePeriod.day,toDate=datePeriod.to||datePeriod.day,curDate=new Date(fromDate);for(;curDate<=toDate;){var date=curDate.getDate();date<10&&(date="0"+date);var month=curDate.getMonth()+1;month<10&&(month="0"+month),dateArr[curDate.getFullYear()+"-"+month+"-"+date]=new Date(curDate),curDate.setDate(curDate.getDate()+1)}return dateArr},constructReport:function(resultData,params,isFromFirescroll){const container=Layout.Page.container.find("#timetrackerTimelogLeaveReport"),tableBody=container.find("#timetrackerTimelogLeaveReportBody"),isBreakEnabled=Timetracker.generalSettings.isBreakEnabled();isFromFirescroll||container.find("#timetrackerTimelogLeaveReportBody").html("");let timelogDateArr,leaveArr,empObj,jobTimelogObj,leaveData,leaveDateObj,jobObject,jobDateObj,timelogObj,employeeDetailsNeeded,jobDetailsNeeded,maxEmpRows,maxJobRows,dateObj=Timetracker.Reports.timelogLeaveReport.getDateRangeObj();for(let result=0;result<resultData.length;result++){employeeDetailsNeeded=!0,jobTimelogObj=(empObj=resultData[result]).jobTimelogsData,maxEmpRows=empObj.maxTimelogRowsPerDay,leaveData=empObj.leaveData||{},leaveDateObj=leaveData.leaveDetails||{};var empRowsHtml='<tr class="ZPLRow bdrbtmtr"><td class="colM1_sticky bdrbtm" rowspan="'+maxEmpRows+'"><div class="d-flexC"><img class="FL" src="'+empObj.employeePhoto+'"><div class="ZPusrName padt0"><span class="ellipsis W150" title="'+empObj.employeeName+'"><b>'+empObj.employeeId+"</b> "+empObj.employeeName+"</span>";if(empObj.empDateOfExit&&(empRowsHtml+='<em class="ZPsecName">( '+ZPI18N.getString("zp.exitdate")+"-"+empObj.empDateOfExit+")</em>"),empRowsHtml+="</div></div></td>",0==Object.keys(jobTimelogObj).length)empRowsHtml+=Timetracker.Reports.timelogLeaveReport.getJobColumnHtml({}),Object.keys(dateObj).forEach((tempDate,dateNo)=>{let className="minw150px"+(dateNo%2==1?" ZPlgrybg":"");if(empRowsHtml+='<td class="'+className+'">-</td><td class="'+className+'">-</td><td class="'+className+'">-</td>',employeeDetailsNeeded){leaveArr=leaveDateObj[tempDate]||[];var leaveText="";for(let leave=0;leave<leaveArr.length;leave++)leaveText+=leaveArr[leave].name,leaveArr[leave].hours&&(leaveText+="("+Calendar.minstohrs(leaveArr[leave].hours)+")"),leave!=leaveArr.length-1&&(leaveText+=", ");empRowsHtml+='<td class="bdrbtm '+className+'" rowspan="'+maxEmpRows+'" style="border-left: 1px solid #e9edf3;">'+(leaveText||"-")+"</td>"}}),empRowsHtml+="</tr>";else for(const job in jobTimelogObj){employeeDetailsNeeded||(empRowsHtml+='<tr class="ZPLRow">'),jobObject=jobTimelogObj[job],jobDateObj=jobObject.timelogData,maxJobRows=jobObject.maxTimelogRowsPerDay,jobDetailsNeeded=!0,empRowsHtml+=Timetracker.Reports.timelogLeaveReport.getJobColumnHtml(jobObject,!employeeDetailsNeeded);for(var jobRow=0;jobRow<maxJobRows;jobRow++)jobDetailsNeeded||(empRowsHtml+='<tr class="ZPLRow">'),Object.keys(dateObj).forEach((tempDate,dateNo)=>{timelogDateArr=jobDateObj[tempDate]||[],timelogObj=timelogDateArr[jobRow]||{};let className="minw150px"+(dateNo%2==1?" ZPlgrybg":""),hours=isBreakEnabled?timelogObj.nonoverlapHours:timelogObj.hours;if(empRowsHtml+='<td class="'+className+'">'+(void 0!==timelogObj.fromTime?Timetracker.DateTime.minstoTimeMeridian(timelogObj.fromTime):"-")+'</td><td class="'+className+'">'+(void 0!==timelogObj.toTime?Timetracker.DateTime.minstoTimeMeridian(timelogObj.toTime):"-")+'</td><td class="'+className+'">'+(void 0!==hours?Calendar.minstohrs(hours):"-")+"</td>",employeeDetailsNeeded){leaveArr=leaveDateObj[tempDate]||[];var leaveText="";for(let leave=0;leave<leaveArr.length;leave++)leaveText+=leaveArr[leave].name,leaveArr[leave].hours&&(leaveText+="("+Calendar.minstohrs(leaveArr[leave].hours)+")"),leave!=leaveArr.length-1&&(leaveText+=", ");empRowsHtml+='<td class="bdrbtm '+className+'" rowspan="'+maxEmpRows+'" style="border-left: 1px solid #e9edf3;">'+(leaveText||"-")+"</td>"}}),empRowsHtml+="</tr>",jobDetailsNeeded=!1,employeeDetailsNeeded=!1}tableBody.append(empRowsHtml)}if(isFromFirescroll)container.find("#timetrackerTimelogLeaveReportTable").append("");else{var sortClass="";void 0!==params.sortType&&(sortClass="0"===params.sortType?"sort-u":"sort-d");let headerHtml='<tr class="ZPLHRow"><th class="colM1_sticky" rowspan="2" ><span>'+ZPI18N.getString("zp.employee")+'</span><i id="sortByEmployeeName" class="sort-img  CP '+sortClass+'"  data-toggle="tooltip" data-placement="bottom" data-container="body" data-original-title=" Sort "></i></th><th class="colM2_sticky" rowspan="2">'+ZPI18N.getString("zp.clientname")+'</th><th class="colM3_sticky form_projectname tt_add_title" rowspan="2" >'+ZPI18N.getString("zp.projectname")+'</th><th class="colM4_sticky form_jobname tt_add_title" rowspan="2" >'+ZPI18N.getString("zp.jobname")+"</th>",headerSubHtml="<tr>";for(var tempDate in dateObj){var curDate=dateObj[tempDate],date=curDate.getDate();date<10&&(date="0"+date),headerHtml+='<th colspan="4" class="text-center"><span class="DB MB3">'+months[curDate.getMonth()]+" "+date+'</span><span class="DB dgry ZPreg">'+days[curDate.getDay()]+"</span></th>",headerSubHtml+='<th class="minw150px text-center bdrbtm toppx"><div>'+ZPI18N.getString("zp.starttime")+'</div></th><th class="minw150px  text-center bdrbtm toppx"><div class="W60">'+ZPI18N.getString("zp.endtime")+'</div></th></th><th class="minw150px text-center bdrbtm toppx"><div>'+ZPI18N.getString("zp.totalhours")+'</div></th><th class="minw150px text-center bdrbtm toppx"><div>'+ZPI18N.getString("zp.status")+"</div></th>"}headerHtml+="</tr>",headerSubHtml+="</tr>",container.find("#timetrackerTimelogLeaveReportHead").html(headerHtml+headerSubHtml),container.find("#sortByEmployeeName").off("click").on("click",function(){$(this).hasClass("sort-u")?$(this).removeClass("sort-u").addClass("sort-d"):$(this).removeClass("sort-d").addClass("sort-u"),Timetracker.Reports.timelogLeaveReport.generateReport()}),container.find("#sortByEmployeeName").attr("title",ZPI18N.getString(container.find("#sortByEmployeeName").hasClass("sort-u")?"zp.sortbydesc":"zp.sortbyasc"))}},Firescroll:{mode:"TT_TIMELOG_LEAVE_REPORT_FIRESCROLL",correspondingLogsMode:"TT_TIMELOG_LEAVE_REPORT_TIMELOGS_FIRESCROLL",loadMoreData:function(extraDtls){var params=extraDtls.params;params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.timelogLeaveReport.Firescroll.mode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.timelogLeaveReport.Firescroll.mode,!1),response=void 0!==response&&response.length>0?response[0]:null,Timetracker.Reports.timelogLeaveReport.constructReport(response,params,!0),ZPLite.Firescroll.init(Layout.Page.container.find("#timetrackerTimelogLeaveReport"),Timetracker.Reports.timelogLeaveReport.Firescroll.mode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.timelogLeaveReport.Firescroll.loadMoreData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.timelogLeaveReport.Firescroll.mode,response.length)})},loadMoreCorrespondingLogs:function(extraDtls){var params=extraDtls.params;params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.timelogLeaveReport.Firescroll.correspondingLogsMode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.timelogLeaveReport.Firescroll.correspondingLogsMode,!1),response=response||[],Timetracker.Reports.Util.constructCorrespondinglogsHtml(response,params.userErecNo,"#timetrackerTimelogLeaveReport"),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.timelogLeaveReport.Firescroll.correspondingLogsMode,response.length)})}},showExport:function(currentObj){$(currentObj).hasClass("open")?$(currentObj).removeClass("open"):(Timetracker.Reports.Util.getCommonData(),$(currentObj).addClass("open"))},exportReport:function(mode,extraParams,fileType){var requestUrl="timesheetDispAction.zp?",params=Timetracker.Reports.timelogLeaveReport.getParamsForReport(fileType);$.each(params,function(key,value){requestUrl+=key+"="+value+"&"}),requestUrl=requestUrl.substring(0,requestUrl.length-1),Timetracker.ImportExport.submiteFormForExport(requestUrl)}},jobReport:{init:function(){ZPLite.Reports.setCurrentModule(ZPLite.Modules.Timetracker),ZPLite.Reports.setCurrentReport(Timetracker.Reports.Constants.jobReport);var initParams={isModuleDataNeeded:!0,moduleDataCallback:Timetracker.Reports.init,callback:Timetracker.Reports.jobReport.initCallback};ZPLite.Reports.initPage(initParams)},initCallback:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Modules.Timetracker),Timetracker.Reports.Util.getCommonData(),Timetracker.Reports.Filters.clearCache(!0);var filterDiv=Layout.Page.container.find("#filterDiv");Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="clientFilter"]'),"client",!1,Timetracker.Reports.jobReport.filterOnChangeCallback,"TT_JOB_REPORT_FILTER_CLIENT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="projectFilter"]'),"project",!1,Timetracker.Reports.jobReport.filterOnChangeCallback,"TT_JOB_REPORT_FILTER_PROJECT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="jobFilter"]'),"job",!1,Timetracker.Reports.jobReport.filterOnChangeCallback,"TT_JOB_REPORT_FILTER_JOB_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="jobStatusFilter"]'),"jobStatus",!0,Timetracker.Reports.jobReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="approvalStatusFilter"]'),"approvalStatus",!0),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="billableStatusFilter"]'),"billableStatus",!0),ZPLite.Reports.Util.isPersonalReport()?(filterDiv.find('[name="employeeFilter"]').addClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').addClass("DNI"),filterDiv.find('[name="departmentFilter"]').addClass("DNI"),filterDiv.find('[name="locationFilter"]').addClass("DNI"),filterDiv.find('[name="orgTagFilter"]').addClass("DNI"),filterDiv.find('[name="roleFilter"]').addClass("DNI"),filterDiv.find('[name="designationFilter"]').addClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').addClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').addClass("DNI"),filterDiv.find('[name="divisionFilter"]').addClass("DNI"),filterDiv.find('[name="showDirectReporteesFilter"]').addClass("DNI")):(Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Timetracker.Reports.jobReport.filterOnChangeCallback,"TT_JOB_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Timetracker.Reports.jobReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Timetracker.Reports.jobReport.setDefaultFilterParams(),Timetracker.Reports.jobReport.generateReport()},switchView:function(isChartView){isChartView?(Layout.Page.container.find('[name="listviewbtn"]').removeClass("sel"),Layout.Page.container.find("#timetrackerJobReportTable").addClass("DN"),Layout.Page.container.find('[name="chartviewbtn"]').addClass("sel"),Layout.Page.container.find("#timetrackerJobReportChart").removeClass("DN")):(Layout.Page.container.find('[name="chartviewbtn"]').removeClass("sel"),Layout.Page.container.find("#timetrackerJobReportChart").addClass("DN"),Layout.Page.container.find('[name="listviewbtn"]').addClass("sel"),Layout.Page.container.find("#timetrackerJobReportTable").removeClass("DN"))},isChartView:function(){return Layout.Page.container.find('[name="chartviewbtn"]').hasClass("sel")},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");ZPLite.Reports.Util.isPersonalReport()?ZPLite.Filters.clearValues(filterDiv.find('[name="clientFilter"]')):ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),ZPLite.Filters.setValues(filterDiv.find('[name="billableStatusFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),ZPLite.Filters.setValues(filterDiv.find('[name="jobStatusFilter"]'),[{id:"0",text:ZPI18N.getString("zp.inprogress")}]),ZPLite.Filters.setValues(filterDiv.find('[name="approvalStatusFilter"]'),[{id:"0",text:ZPI18N.getString("zp.all")}]),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]')),filterDiv.find('[name="showDirectReporteesFilter"]').find("input").prop("checked",!1)},resetFilter:function(){Timetracker.Reports.jobReport.setDefaultFilterParams()},applyFilter:function(){Timetracker.Reports.jobReport.generateReport()},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("employeeStatus"===data.entity){Timetracker.Reports.Filters.clearCache(!1,"employee");var filterDiv=container.find('[name="employeeFilter"]');ZPLite.Filters.clearOptions(filterDiv)}else{if("employee"===data.entity)0===ZPLite.Filters.getValues(container.find('[name="employeeFilter"]')).length&&!ZPLite.Reports.Util.isPersonalReport()&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?container.find('[name="showDirectReporteesFilter"]').removeClass("DNI"):container.find('[name="showDirectReporteesFilter"]').addClass("DNI"),Timetracker.Reports.Filters.clearCache(!1,"client"),filterDiv=container.find('[name="clientFilter"]');else"client"===data.entity?(Timetracker.Reports.Filters.clearCache(!1,"project"),filterDiv=container.find('[name="projectFilter"]')):"project"!==data.entity&&"jobStatus"!==data.entity||(Timetracker.Reports.Filters.clearCache(!1,"job"),filterDiv=container.find('[name="jobFilter"]'));filterDiv&&(ZPLite.Filters.clearValues(filterDiv),ZPLite.Filters.clearOptions(filterDiv))}},getDefaultParams:function(fileType){var params={mode:"getJobReport",userErecNo:"0",clientId:"0",projectId:"0",jobId:"0",jobStatus:"-1",billStatus:"-1",approvalStatus:"0",employeeStatus:"19,-2,18",deptId:"0",locId:"0",isDirectSubOnlyNeeded:!1,repType:Timetracker.Reports.Util.getReportTypeParam(),conreqcsr:csrfToken};return fileType&&(params.mode="exportJobReport",params.fileType=fileType,delete params.conreqcsr),params},getParamsForReport:function(fileType){var values,params=Timetracker.Reports.jobReport.getDefaultParams(fileType),filterDiv=Layout.Page.container.find("#filterDiv");if(ZPLite.Reports.Util.isPersonalReport())params.userErecNo=erecno;else{if(filterDiv.find('[name="showDirectReporteesFilter"]').is(":visible")&&(params.isDirectSubOnlyNeeded=filterDiv.find('[name="showDirectReporteesFilter"]').find("input").is(":checked")),(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var userErecNo="";$.each(values,function(index,option){0!==index&&(userErecNo+=","),userErecNo+=option.id}),params.userErecNo=userErecNo}else params.showOnlyTeamData=ZPLite.Reports.Util.isTeamReport();if((values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus="";$.each(values,function(index,option){0!==index&&(employeeStatus+=","),employeeStatus+=option.id}),params.employeeStatus=employeeStatus}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId="";$.each(values,function(index,option){0!==index&&(departmentId+=","),departmentId+=option.id}),params.deptId=departmentId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId="";$.each(values,function(index,option){0!==index&&(locationId+=","),locationId+=option.id}),params.locId=locationId}if(Timetracker.organizationTags.fetchParams(filterDiv,params,!0),Timetracker.roles.fetchParams(filterDiv,params,!0),(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId="";$.each(values,function(index,option){0!==index&&(designationId+=","),designationId+=option.id}),params.designationId=designationId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId="";$.each(values,function(index,option){0!==index&&(legalEntityId+=","),legalEntityId+=option.id}),params.legalEntityId=legalEntityId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId="";$.each(values,function(index,option){0!==index&&(businessUnitId+=","),businessUnitId+=option.id}),params.businessUnitId=businessUnitId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId="";$.each(values,function(index,option){0!==index&&(divisionId+=","),divisionId+=option.id}),params.divisionId=divisionId}}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="clientFilter"]')))&&values.length>0){var clientId="";$.each(values,function(index,option){0!==index&&(clientId+=","),clientId+=option.id}),params.clientId=clientId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="projectFilter"]')))&&values.length>0){var projectId="";$.each(values,function(index,option){0!==index&&(projectId+=","),projectId+=option.id}),params.projectId=projectId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="jobFilter"]')))&&values.length>0){var jobId="";$.each(values,function(index,option){0!==index&&(jobId+=","),jobId+=option.id}),params.jobId=jobId}return(values=ZPLite.Filters.getValues(filterDiv.find('[name="jobStatusFilter"]')))&&values.length>0&&(params.jobStatus=values[0].id),(values=ZPLite.Filters.getValues(filterDiv.find('[name="billableStatusFilter"]')))&&values.length>0&&(params.billStatus=values[0].id),(values=ZPLite.Filters.getValues(filterDiv.find('[name="approvalStatusFilter"]')))&&values.length>0&&(params.approvalStatus=values[0].id),fileType||(params.startIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.jobReport.Firescroll.mode)),params},generateReport:function(){Timetracker.util.init();var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#timetrackerJobReportTable"),Timetracker.Reports.jobReport.Firescroll.mode),layout.find("#timetrackerJobReportTable").scrollTop(0),layout.find("#timetrackerJobReport").scrollTop(0),layout.find(".ZPNdata").remove(),layout.find("#timetrackerJobReport").before(ZPeople.LOADING_HTML),layout.find("#timetrackerJobReport").addClass("DN"),layout.find("#correspondingTimeLogsDiv").fadeOut(0);var params=Timetracker.Reports.jobReport.getParamsForReport();ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){if(layout.find(".ZPNdata").remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),response&&"permissionDenied"===response.error)layout.find("#timetrackerJobReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),layout.find(".lt_nav").addClass("DN");else if(void 0!==response&&response.length>0){layout.find("#timetrackerJobReport").removeClass("DN");var details=Timetracker.Reports.jobReport.constructDetails(response,params),chartDetails={};chartDetails.renderTo=layout.find("#timetrackerJobReportChart1").get(0),chartDetails.title=ZPI18N.getString("zp.hours")+" Vs "+ZPI18N.getString("zp.jobs"),chartDetails.spacingTop=10,chartDetails.spacingBottom=50,chartDetails.spacingLeft=50,chartDetails.spacingRight=50,chartDetails.enableScroll=response.length>10,chartDetails.enableLegend=!0,chartDetails.dataArray=[{name:ZPI18N.getString("zp.totalhours"),color:"#b2d7ad",data:details.totalHours},{name:ZPI18N.getString("zp.estimatedhours"),color:"#f0989a",data:details.estimatedHours}],chartDetails.xAxisTitle=ZPI18N.getString("zp.jobs"),chartDetails.xAxisLabel=details.label,response.length>10?(chartDetails.enableScroll=!0,chartDetails.xAxisMaxPointsOnFocus=9):chartDetails.xAxisMaxPointsOnFocus=response.length-1,chartDetails.yAxisTitle=ZPI18N.getString("zp.hours"),chartDetails.fireScrollMode=Timetracker.Reports.jobReport.Firescroll.mode,chartDetails.fireScrollCallback=Timetracker.Reports.jobReport.Firescroll.loadMoreData,chartDetails.fireScrollExtraDtls={params:params},ZPLite.Reports.Util.constructColumnChart(chartDetails),chartDetails.renderTo=layout.find("#timetrackerJobReportChart2").get(0),chartDetails.title=ZPI18N.getString("zp.billable")+" Vs "+ZPI18N.getString("zp.nonbillable"),chartDetails.dataArray=[{name:ZPI18N.getString("zp.billablehours"),color:"#b2d7ad",data:details.billableHours},{name:ZPI18N.getString("zp.nonbillablehours"),color:"#f0989a",data:details.nonBillableHours}],ZPLite.Reports.Util.constructColumnChart(chartDetails),layout.find("#timetrackerJobReportBody").html(details.html),ZPLite.Firescroll.init(layout.find("#timetrackerJobReportTable"),Timetracker.Reports.jobReport.Firescroll.mode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.jobReport.Firescroll.loadMoreData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.jobReport.Firescroll.mode,response.length)}else layout.find("#timetrackerJobReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsyet")))})},constructDetails:function(data,params){for(var html="",label=[],totalHours=[],estimatedHours=[],billableHours=[],nonBillableHours=[],itr=0;itr<data.length;itr++){html+='<tr class="ZPLRow">',data[itr].CLIENTNAME?html+='<td title="'+data[itr].CLIENTNAME+'">'+data[itr].CLIENTNAME+"</td>":html+="<td>---</td>",data[itr].PROJECTNAME?html+='<td title="'+data[itr].PROJECTNAME+'">'+data[itr].PROJECTNAME+"</td>":html+="<td>---</td>",html+='<td class="CP" onclick="Timetracker.Reports.Util.showCorrespondingTimeLogs(this, event, \''+data[itr].JOBID+"', '0', '"+params.billStatus+'\', undefined, undefined, true);" title="'+data[itr].JOBNAME+'"> '+data[itr].JOBNAME+"</td>",data[itr].duration?html+="<td>"+Calendar.minstohrs(data[itr].duration)+"</td>":html+="<td>"+Calendar.minstohrs(0)+"</td>";var total=0;1!==Number(params.billStatus)&&data[itr].billablehours?(html+="<td>"+Calendar.minstohrs(data[itr].billablehours)+"</td>",total+=Number(data[itr].billablehours)):html+="<td>-</td>",0!==Number(params.billStatus)&&data[itr].nonbillablehours?(html+="<td>"+Calendar.minstohrs(data[itr].nonbillablehours)+"</td>",total+=Number(data[itr].nonbillablehours)):html+="<td>-</td>",html+="<td>"+Calendar.minstohrs(total)+"</td>",void 0!==data[itr].JOBSTATUS&&0===data[itr].JOBSTATUS?html+="<td>"+ZPI18N.getString("zp.inprogress")+"</td>":html+="<td>"+ZPI18N.getString("zp.completed")+"</td>",html+="</tr>",label[itr]=ZPeople.escapeHtml(ZPeople.decodeTxt(data[itr].JOBNAME)),totalHours[itr]=total/60,estimatedHours[itr]=data[itr].duration?data[itr].duration/60:0,billableHours[itr]=data[itr].billablehours?data[itr].billablehours/60:0,nonBillableHours[itr]=data[itr].nonbillablehours?data[itr].nonbillablehours/60:0}var details={};return details.totalHours=totalHours,details.estimatedHours=estimatedHours,details.billableHours=billableHours,details.nonBillableHours=nonBillableHours,details.label=label,details.html=html,details},Firescroll:{mode:"TT_JOB_REPORT_FIRESCROLL",correspondingLogsMode:"TT_JOB_REPORT_TIMELOGS_FIRESCROLL",loadMoreData:function(extraDtls){var params=extraDtls.params;params.startIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.jobReport.Firescroll.mode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(void 0!==response&&response.length>0){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.jobReport.Firescroll.mode,!1);for(var details=Timetracker.Reports.jobReport.constructDetails(response,params),chart1=Layout.Page.container.find("#timetrackerJobReportChart1").highcharts(),chart2=Layout.Page.container.find("#timetrackerJobReportChart2").highcharts(),categories=chart1.xAxis[0].categories,i=0;i<details.label.length;i++)categories.push(details.label[i]),chart1.series[0].addPoint(details.totalHours[i],!1,!1),chart1.series[1].addPoint(details.estimatedHours[i],!1,!1),chart2.series[0].addPoint(details.billableHours[i],!1,!1),chart2.series[1].addPoint(details.nonBillableHours[i],!1,!1);chart1.xAxis[0].setCategories(categories,!1),chart2.xAxis[0].setCategories(categories,!1),chart1.redraw(),chart2.redraw(),Layout.Page.container.find("#timetrackerJobReportBody").append(details.html),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.jobReport.Firescroll.mode,response.length)}else ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.jobReport.Firescroll.mode,0)})},loadMoreCorrespondingLogs:function(extraDtls){var params=extraDtls.params;params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.jobReport.Firescroll.correspondingLogsMode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.jobReport.Firescroll.correspondingLogsMode,!1),response=response||[],Timetracker.Reports.Util.constructCorrespondinglogsHtml(response,params.userErecNo,"#timetrackerJobReport"),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.jobReport.Firescroll.correspondingLogsMode,response.length)})}},showExport:function(currentObj){$(currentObj).hasClass("open")?$(currentObj).removeClass("open"):$(currentObj).addClass("open")},exportReport:function(mode,extraParams,fileType){var requestUrl="timesheetDispAction.zp?",params=Timetracker.Reports.jobReport.getParamsForReport(fileType);$.each(params,function(key,value){requestUrl+=key+"="+value+"&"}),requestUrl=requestUrl.substring(0,requestUrl.length-1),Timetracker.ImportExport.submiteFormForExport(requestUrl)},printReport:function(){var params=Timetracker.Reports.jobReport.getParamsForReport();Timetracker.util.printReport("timetrackerJobReport",Timetracker.Reports.jobReport.isChartView(),params.userErecNo,void 0,void 0,!0)}},projectReport:{init:function(){ZPLite.Reports.setCurrentModule(ZPLite.Modules.Timetracker),ZPLite.Reports.setCurrentReport(Timetracker.Reports.Constants.projectReport),ZPLite.Reports.initPage({isModuleDataNeeded:!0,moduleDataCallback:Timetracker.Reports.init,callback:Timetracker.Reports.projectReport.initCallback})},initCallback:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Modules.Timetracker),Timetracker.Reports.Util.getCommonData(),Timetracker.Reports.Filters.clearCache(!0);var filterDiv=Layout.Page.container.find("#filterDiv");Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="clientFilter"]'),"client",!1,Timetracker.Reports.projectReport.filterOnChangeCallback,"TT_PROJECT_REPORT_FILTER_CLIENT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="projectFilter"]'),"project",!1,Timetracker.Reports.projectReport.filterOnChangeCallback,"TT_PROJECT_REPORT_FILTER_PROJECT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="projectStatusFilter"]'),"projectStatus",!0,Timetracker.Reports.projectReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="approvalStatusFilter"]'),"approvalStatus",!0),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="billableStatusFilter"]'),"billableStatus",!0),ZPLite.Reports.Util.isPersonalReport()?(filterDiv.find('[name="employeeFilter"]').addClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').addClass("DNI"),filterDiv.find('[name="departmentFilter"]').addClass("DNI"),filterDiv.find('[name="locationFilter"]').addClass("DNI"),filterDiv.find('[name="orgTagFilter"]').addClass("DNI"),filterDiv.find('[name="roleFilter"]').addClass("DNI"),filterDiv.find('[name="designationFilter"]').addClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').addClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').addClass("DNI"),filterDiv.find('[name="divisionFilter"]').addClass("DNI"),filterDiv.find('[name="showDirectReporteesFilter"]').addClass("DNI")):(Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Timetracker.Reports.projectReport.filterOnChangeCallback,"TT_PROJECT_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Timetracker.Reports.projectReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),Timetracker.Reports.projectReport.setDefaultFilterParams(),Timetracker.Reports.projectReport.generateReport()},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");ZPLite.Reports.Util.isPersonalReport()?ZPLite.Filters.clearValues(filterDiv.find('[name="clientFilter"]')):ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),ZPLite.Filters.setValues(filterDiv.find('[name="billableStatusFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),ZPLite.Filters.setValues(filterDiv.find('[name="projectStatusFilter"]'),[{id:"0",text:ZPI18N.getString("zp.inprogress")}]),ZPLite.Filters.setValues(filterDiv.find('[name="approvalStatusFilter"]'),[{id:"0",text:ZPI18N.getString("zp.all")}]),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]')),filterDiv.find('[name="showDirectReporteesFilter"]').find("input").prop("checked",!1)},resetFilter:function(){Timetracker.Reports.projectReport.setDefaultFilterParams()},applyFilter:function(){Timetracker.Reports.projectReport.generateReport()},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("employeeStatus"===data.entity){Timetracker.Reports.Filters.clearCache(!1,"employee");var filterDiv=container.find('[name="employeeFilter"]');ZPLite.Filters.clearOptions(filterDiv)}else{if("employee"===data.entity)0===ZPLite.Filters.getValues(container.find('[name="employeeFilter"]')).length&&!ZPLite.Reports.Util.isPersonalReport()&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?container.find('[name="showDirectReporteesFilter"]').removeClass("DNI"):container.find('[name="showDirectReporteesFilter"]').addClass("DNI"),Timetracker.Reports.Filters.clearCache(!1,"client"),filterDiv=container.find('[name="clientFilter"]');else"client"!==data.entity&&"projectStatus"!==data.entity||(Timetracker.Reports.Filters.clearCache(!1,"project"),filterDiv=container.find('[name="projectFilter"]'));filterDiv&&(ZPLite.Filters.clearValues(filterDiv),ZPLite.Filters.clearOptions(filterDiv))}},getDefaultParams:function(fileType){var params={mode:"getProjectReport",clientId:"0",projectId:"0",projectStatus:"-1",billStatus:"-1",approvalStatus:"0",employeeStatus:"19,-2,18",deptId:"0",locId:"0",isDirectSubOnlyNeeded:!1,repType:Timetracker.Reports.Util.getReportTypeParam(),conreqcsr:csrfToken};return ZPLite.Reports.Util.isPersonalReport()?params.userErecNo=erecno:params.userErecNo="0",fileType&&(params.mode="exportProjectReport",params.fileType=fileType,delete params.conreqcsr),params},getParamsForReport:function(fileType){var values,params=Timetracker.Reports.projectReport.getDefaultParams(fileType),filterDiv=Layout.Page.container.find("#filterDiv");if(ZPLite.Reports.Util.isPersonalReport())params.userErecNo=erecno;else{if(filterDiv.find('[name="showDirectReporteesFilter"]').is(":visible")&&(params.isDirectSubOnlyNeeded=filterDiv.find('[name="showDirectReporteesFilter"]').find("input").is(":checked")),(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var userErecNo="";$.each(values,function(index,option){0!==index&&(userErecNo+=","),userErecNo+=option.id}),params.userErecNo=userErecNo}else params.showOnlyTeamData=ZPLite.Reports.Util.isTeamReport();if((values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeStatusFilter"]')))&&values.length>0){var employeeStatus="";$.each(values,function(index,option){0!==index&&(employeeStatus+=","),employeeStatus+=option.id}),params.employeeStatus=employeeStatus}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="departmentFilter"]')))&&values.length>0){var departmentId="";$.each(values,function(index,option){0!==index&&(departmentId+=","),departmentId+=option.id}),params.deptId=departmentId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="locationFilter"]')))&&values.length>0){var locationId="";$.each(values,function(index,option){0!==index&&(locationId+=","),locationId+=option.id}),params.locId=locationId}if(Timetracker.organizationTags.fetchParams(filterDiv,params,!0),Timetracker.roles.fetchParams(filterDiv,params,!0),(values=ZPLite.Filters.getValues(filterDiv.find('[name="designationFilter"]')))&&values.length>0){var designationId="";$.each(values,function(index,option){0!==index&&(designationId+=","),designationId+=option.id}),params.designationId=designationId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="legalEntityFilter"]')))&&values.length>0){var legalEntityId="";$.each(values,function(index,option){0!==index&&(legalEntityId+=","),legalEntityId+=option.id}),params.legalEntityId=legalEntityId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="businessUnitFilter"]')))&&values.length>0){var businessUnitId="";$.each(values,function(index,option){0!==index&&(businessUnitId+=","),businessUnitId+=option.id}),params.businessUnitId=businessUnitId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="divisionFilter"]')))&&values.length>0){var divisionId="";$.each(values,function(index,option){0!==index&&(divisionId+=","),divisionId+=option.id}),params.divisionId=divisionId}}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="clientFilter"]')))&&values.length>0){var clientId="";$.each(values,function(index,option){0!==index&&(clientId+=","),clientId+=option.id}),params.clientId=clientId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="projectFilter"]')))&&values.length>0){var projectId="";$.each(values,function(index,option){0!==index&&(projectId+=","),projectId+=option.id}),params.projectId=projectId}return(values=ZPLite.Filters.getValues(filterDiv.find('[name="projectStatusFilter"]')))&&values.length>0&&(params.projectStatus=values[0].id),(values=ZPLite.Filters.getValues(filterDiv.find('[name="billableStatusFilter"]')))&&values.length>0&&(params.billStatus=values[0].id),(values=ZPLite.Filters.getValues(filterDiv.find('[name="approvalStatusFilter"]')))&&values.length>0&&(params.approvalStatus=values[0].id),fileType||(params.startIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.projectReport.Firescroll.mode)),params},generateReport:function(){Timetracker.util.init();var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#timetrackerProjectReport"),Timetracker.Reports.projectReport.Firescroll.mode),layout.find("#timetrackerProjectReport").scrollTop(0),layout.find(".ZPNdata").remove(),layout.find("#timetrackerProjectReport").before(ZPeople.LOADING_HTML),layout.find("#timetrackerProjectReport").addClass("DN"),layout.find("#correspondingJobsDiv").fadeOut(0);var params=Timetracker.Reports.projectReport.getParamsForReport();ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){if(layout.find(".ZPNdata").remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),response&&"permissionDenied"===response.error)layout.find("#timetrackerProjectReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),layout.find(".lt_nav").addClass("DN");else if(void 0!==response&&response.length>0){layout.find("#timetrackerProjectReport").removeClass("DN");var tableBody=layout.find("#timetrackerProjectReportBody");tableBody.html(""),$.each(response,function(index,data){tableBody.append(Timetracker.Reports.projectReport.constructReportRowHtml(data,params))}),ZPLite.Firescroll.init(layout.find("#timetrackerProjectReport"),Timetracker.Reports.projectReport.Firescroll.mode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.projectReport.Firescroll.loadMoreData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.projectReport.Firescroll.mode,response.length)}else layout.find("#timetrackerProjectReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsyet")))})},constructReportRowHtml:function(data,params){var html='<tr class="ZPLRow">';data.clientName?html+='<td title="'+data.clientName+'">'+data.clientName+"</td>":html+="<td>---</td>",html+='<td class="CP" onclick="Timetracker.Reports.projectReport.showCorrespondingJobs(this, event, \''+data.projectId+"','"+params.billStatus+'\')" title="'+data.projectName+'"> '+data.projectName+"</td>",data.totalEstimatedHours?html+="<td>"+Calendar.minstohrs(data.totalEstimatedHours)+"</td>":html+="<td>"+Calendar.minstohrs(0)+"</td>";var totalHours=0;return 1!==Number(params.billStatus)&&data.billablehours?(html+="<td>"+Calendar.minstohrs(data.billablehours)+"</td>",totalHours+=Number(data.billablehours)):html+="<td>-</td>",0!==Number(params.billStatus)&&data.nonbillablehours?(html+="<td>"+Calendar.minstohrs(data.nonbillablehours)+"</td>",totalHours+=Number(data.nonbillablehours)):html+="<td>-</td>",html+="<td>"+Calendar.minstohrs(totalHours)+"</td>",void 0!==data.projectStatus&&0===data.projectStatus?html+="<td>"+ZPI18N.getString("zp.inprogress")+"</td>":html+="<td>"+ZPI18N.getString("zp.completed")+"</td>",html+="</tr>"},showCorrespondingJobs:function(obj,event,projectId,billStatus){var container=Layout.Page.container.find("#timetrackerProjectReport");if(0===container.find("#correspondingJobsDiv").length){var html='<div class="time-detail-pop lt gray W400" id="correspondingJobsDiv" style="display: none;"><p class="FL">'+ZPI18N.getString("zp.correspondingjobs")+'</p><i class="IC-cls red CP FR MR5 MT5" onclick="Layout.Page.container.find(\'#correspondingJobsDiv\').fadeOut(200);"></i><table class="table popFxd-hd"><thead><tr><th width="30%" class="form_jobname">'+Timetracker.util.getFormsLabelDisplayName("jobName")+'</th><th width="25%">'+ZPI18N.getString("zp.estimatedhours")+'</th><th width="25%">'+ZPI18N.getString("zp.loggedhours")+'</th><th width="20%">'+ZPI18N.getString("zp.status")+'</th></tr></thead><tbody id="correspondingJobs"></tbody></table></div>';container.append(html)}container.find("#correspondingJobsDiv").fadeOut(200);var params={mode:"getSchedule",assignedTo:"0",assignedBy:"0",projectId:projectId,billStatus:billStatus,fetchLoggedHrs:!0,conreqcsr:csrfToken};Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)&&(params.viewEditPermissionType=Timetracker.constants.TTCustomAdmin.ReportView),$.post(Timetracker.constants.URL,params,function(resultData){0===(resultData=resultData&&resultData.schArr?resultData.schArr:[]).length?container.find("#correspondingJobs").html('<tr><td colspan="5" style="text-align:center;">'+ZPI18N.getString("zp.nodatafound")+"</td></tr>"):(container.find("#correspondingJobs").html(""),Timetracker.Reports.projectReport.constructCorrespondingJobshtml(resultData)),container.find("#correspondingJobsDiv").fadeIn(200),Timetracker.util.setPopupPosition(obj,"correspondingJobsDiv",event,!1,40)})},constructCorrespondingJobshtml:function(correspondingJobs){var txt="";$.each(correspondingJobs,function(index,data){txt+='<tr><td width="30%" class="WBBW">'+data.jobName+"</td>",txt+='<td width="25%">'+Calendar.minstohrs(data.hours?data.hours:0)+"</td>",txt+='<td width="25%">'+Calendar.minstohrs(data.totalhours)+"</td>",0===Number(data.jobStatus)?txt+='<td width="20%">'+ZPI18N.getString("zp.inprogress")+"</td>":txt+='<td width="20%">'+ZPI18N.getString("zp.completed")+"</td>",txt+="</tr>"}),Layout.Page.container.find("#correspondingJobs").append(txt)},Firescroll:{mode:"TT_PROJECT_REPORT_FIRESCROLL",loadMoreData:function(extraDtls){var params=extraDtls.params;params.startIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.projectReport.Firescroll.mode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(void 0!==response&&response.length>0){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.projectReport.Firescroll.mode,!1);var tableBody=Layout.Page.container.find("#timetrackerProjectReportBody");$.each(response,function(index,data){tableBody.append(Timetracker.Reports.projectReport.constructReportRowHtml(data,params))}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.projectReport.Firescroll.mode,response.length)}else ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.projectReport.Firescroll.mode,0)})}},showExport:function(currentObj){$(currentObj).hasClass("open")?$(currentObj).removeClass("open"):$(currentObj).addClass("open")},exportReport:function(mode,extraParams,fileType){var requestUrl="timesheetDispAction.zp?",params=Timetracker.Reports.projectReport.getParamsForReport(fileType);$.each(params,function(key,value){requestUrl+=key+"="+value+"&"}),requestUrl=requestUrl.substring(0,requestUrl.length-1),Timetracker.ImportExport.submiteFormForExport(requestUrl)},printReport:function(){var params=Timetracker.Reports.projectReport.getParamsForReport();Timetracker.util.printReport("timetrackerProjectReport",!1,params.userErecNo,void 0,void 0,!0)}},jobScheduleReport:{init:function(){ZPLite.Reports.setCurrentModule(ZPLite.Modules.Timetracker),ZPLite.Reports.setCurrentReport(Timetracker.Reports.Constants.jobScheduleReport);var initParams={isModuleDataNeeded:!0,moduleDataCallback:Timetracker.Reports.init,callback:Timetracker.Reports.jobScheduleReport.initCallback};ZPLite.Reports.initPage(initParams)},initCallback:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Modules.Timetracker),Timetracker.Reports.Util.getCommonData(),Timetracker.Reports.Filters.clearCache(!0);var filterDiv=Layout.Page.container.find("#filterDiv");if(Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="datePeriodFilter"]'),"datePeriod",!0,Timetracker.Reports.jobScheduleReport.filterOnChangeCallback),Timetracker.jobSchedule.Form.isClientFilterAllowed()?Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="clientFilter"]'),"client",!1,Timetracker.Reports.jobScheduleReport.filterOnChangeCallback,"TT_JOBSCHEDULE_REPORT_FILTER_CLIENT_FIRESCROLL"):filterDiv.find('[name="clientFilter"]').addClass("DNI"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="projectFilter"]'),"project",!1,Timetracker.Reports.jobScheduleReport.filterOnChangeCallback,"TT_JOBSCHEDULE_REPORT_FILTER_PROJECT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="jobFilter"]'),"job",!1,Timetracker.Reports.jobScheduleReport.filterOnChangeCallback,"TT_JOBSCHEDULE_REPORT_FILTER_JOB_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="approvalStatusFilter"]'),"approvalStatus",!0),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="billableStatusFilter"]'),"billableStatus",!0),ZPLite.Reports.Util.isPersonalReport()?(filterDiv.find('[name="showDirectReporteesFilter"]').addClass("DNI"),filterDiv.find('[name="includeExEmployeesFilter"]').addClass("DNI"),filterDiv.find('[name="employeeFilter"]').addClass("DNI"),filterDiv.find('[name="employeeStatusFilter"]').addClass("DNI"),filterDiv.find('[name="departmentFilter"]').addClass("DNI"),filterDiv.find('[name="locationFilter"]').addClass("DNI"),filterDiv.find('[name="orgTagFilter"]').addClass("DNI"),filterDiv.find('[name="roleFilter"]').addClass("DNI"),filterDiv.find('[name="designationFilter"]').addClass("DNI"),filterDiv.find('[name="legalEntityFilter"]').addClass("DNI"),filterDiv.find('[name="businessUnitFilter"]').addClass("DNI"),filterDiv.find('[name="divisionFilter"]').addClass("DNI")):(filterDiv.find('[name="showDirectReporteesFilter"]').removeClass("DNI"),filterDiv.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Timetracker.Reports.jobScheduleReport.filterOnChangeCallback,"TT_JOBSCHEDULE_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Timetracker.Reports.jobScheduleReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1)),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),Timetracker.jobSchedule.hasCustomFields()&&0===filterDiv.find(".customFieldFilter").length){var customFields=Timetracker.jobSchedule.getCustomFields();for(var iterator in customFields){var field=customFields[iterator];if(25===field.componentType){var customFieldFilterHtml='<div class="lt_btn reportsFilter customFieldFilter" name="'+field.labelName+'Filter"></div>';$(customFieldFilterHtml).insertBefore(filterDiv.find('[name="employeeStatusFilter"]'));var details={entity:field.labelName,isSingle:!1,maxSelection:10,text:field.displayName,showSelectedOptionCount:!0,enableClear:!0};if(void 0!==field.options){var staticOptions=[];for(var index in field.options)staticOptions.push({id:field.options[index].optionId,text:field.options[index].optionValue});details.staticOptions=staticOptions}ZPLite.Filters.init(filterDiv.find('[name="'+field.labelName+'Filter"]'),details)}}}var dateNavigationDtls={};dateNavigationDtls.mode=Timetracker.Reports.Constants.jobScheduleReport,dateNavigationDtls.containerId=Layout.Page.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.navigationCallback=Timetracker.Reports.jobScheduleReport.generateReport,ZPLite.DateNavigator.init(dateNavigationDtls),ZPLite.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPLite.DateNavigator.TYPE.WEEKLY,ZPLite.DateNavigator.TENSE.CURRENT),Timetracker.Reports.jobScheduleReport.isSummaryReport()||(Layout.Page.container.find('[name="datePeriodFilter"]').find("#2").addClass("DNI"),Layout.Page.container.find('[name="datePeriodFilter"]').find("#5").addClass("DNI")),Timetracker.Reports.jobScheduleReport.setDefaultFilterParams(),Timetracker.Reports.jobScheduleReport.generateReport()},switchView:function(isSummaryReport){var container=Layout.Page.container;isSummaryReport?(container.find('[name="detailedreportbtn"]').removeClass("active"),container.find("#timetrackerJobScheduleDetailedReportTable").addClass("DN"),container.find('[name="summaryreportbtn"]').addClass("active"),container.find("#timetrackerJobScheduleSummaryReportTable").removeClass("DN"),container.find('[name="datePeriodFilter"]').find("#2").removeClass("DNI"),container.find('[name="datePeriodFilter"]').find("#5").removeClass("DNI")):(container.find('[name="summaryreportbtn"]').removeClass("active"),container.find("#timetrackerJobScheduleSummaryReportTable").addClass("DN"),container.find('[name="detailedreportbtn"]').addClass("active"),container.find("#timetrackerJobScheduleDetailedReportTable").removeClass("DN"),container.find('[name="datePeriodFilter"]').find("#2").addClass("DNI"),container.find('[name="datePeriodFilter"]').find("#5").addClass("DNI")),ZPLite.Filters.setValues(container.find('[name="datePeriodFilter"]'),[{id:"1",text:ZPI18N.getString("zp.thisweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:ZPLite.DateNavigator.TENSE.CURRENT}]),ZPLite.DateNavigator.setPeriod(Timetracker.Reports.Constants.jobScheduleReport,ZPLite.DateNavigator.TYPE.WEEKLY,ZPLite.DateNavigator.TENSE.CURRENT),Timetracker.Reports.jobScheduleReport.setDefaultFilterParams(),Timetracker.Reports.jobScheduleReport.generateReport()},isSummaryReport:function(){return Layout.Page.container.find('[name="summaryreportbtn"]').hasClass("active")},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");if(filterDiv.find('[name="fromDateFilter"]').addClass("DNI"),filterDiv.find('[name="toDateFilter"]').addClass("DNI"),ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"1",text:ZPI18N.getString("zp.thisweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:ZPLite.DateNavigator.TENSE.CURRENT}]),ZPLite.Reports.Util.isPersonalReport()?(Timetracker.jobSchedule.Form.isClientFilterAllowed()?ZPLite.Filters.clearValues(filterDiv.find('[name="clientFilter"]')):ZPLite.Filters.clearValues(filterDiv.find('[name="projectFilter"]')),filterDiv.find('[name="includeExEmployeesFilter"]').addClass("DNI"),filterDiv.find('[name="showDirectReporteesFilter"]').addClass("DNI")):(ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),filterDiv.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),filterDiv.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0),filterDiv.find('[name="showDirectReporteesFilter"]').removeClass("DNI"),filterDiv.find('[name="showDirectReporteesFilter"]').find("input").prop("checked",!1)),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),ZPLite.Filters.setValues(filterDiv.find('[name="approvalStatusFilter"]'),[{id:"0",text:ZPI18N.getString("zp.all")}]),ZPLite.Filters.setValues(filterDiv.find('[name="billableStatusFilter"]'),[{id:"-1",text:ZPI18N.getString("zp.all")}]),ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]')),filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),Timetracker.jobSchedule.hasCustomFields()){var customFields=Timetracker.jobSchedule.getCustomFields();for(var iterator in customFields){var field=customFields[iterator];25===field.componentType&&ZPLite.Filters.clearValues(filterDiv.find('[name="'+field.labelName+'Filter"]'))}}},resetFilter:function(){Timetracker.Reports.jobScheduleReport.setDefaultFilterParams()},applyFilter:function(){var tense,customDatePeriod,container=Layout.Page.container.find("#filterDiv"),values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),type=values[0].periodType,hideNavigation=!1,errorFilters=container.find(".error-clr");if(errorFilters.length>0&&$.each(errorFilters,function(){$(this).removeClass("error-clr")}),"6"===values[0].id){var errorMessage,fromDate=container.find('[name="fromDateFilter"]').data("selectedDate"),toDate=container.find('[name="toDateFilter"]').data("selectedDate");if(void 0===fromDate||""===fromDate)container.find('[name="fromDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptyfromdate");else if(void 0===toDate||""===toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptytodate");else if(fromDate>toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.greaterfromdate");else{var dateLimit=Timetracker.Reports.jobScheduleReport.isSummaryReport()?31:7;ZPDateTime.getDateDiff(fromDate,toDate)>dateLimit&&(container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.datewithindays",[dateLimit]))}if(errorMessage)return void ZPeople.Message.showWarningMsg(errorMessage);customDatePeriod={from:fromDate,to:toDate},hideNavigation=!0}else hideNavigation=!1,tense=values[0].tense;ZPLite.DateNavigator.setPeriod(Timetracker.Reports.Constants.jobScheduleReport,type,tense,hideNavigation,customDatePeriod),Timetracker.Reports.jobScheduleReport.generateReport()},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("datePeriod"===data.entity){var values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]'));Timetracker.Reports.Filters.showHideFromToDateFilter(container,values,Timetracker.Reports.Constants.jobScheduleReport)}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));-1===Timetracker.projects.Operations.findJSONArrayIndex(values,"18","id")?(container.find('[name="includeExEmployeesFilter"]').addClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!1)):container.find('[name="includeExEmployeesFilter"]').hasClass("DNI")&&(container.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0)),Timetracker.Reports.Filters.clearCache(!1,"employee");var filterDiv=container.find('[name="employeeFilter"]');ZPLite.Filters.clearOptions(filterDiv)}else{if("employee"===data.entity)0===(values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'))).length&&!ZPLite.Reports.Util.isPersonalReport()&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?container.find('[name="showDirectReporteesFilter"]').removeClass("DNI"):container.find('[name="showDirectReporteesFilter"]').addClass("DNI"),Timetracker.jobSchedule.Form.isClientFilterAllowed()?(Timetracker.Reports.Filters.clearCache(!1,"client"),filterDiv=container.find('[name="clientFilter"]')):(Timetracker.Reports.Filters.clearCache(!1,"project"),filterDiv=container.find('[name="projectFilter"]'));else"client"===data.entity?(Timetracker.Reports.Filters.clearCache(!1,"project"),filterDiv=container.find('[name="projectFilter"]')):"project"===data.entity&&(Timetracker.Reports.Filters.clearCache(!1,"job"),filterDiv=container.find('[name="jobFilter"]'));filterDiv&&(ZPLite.Filters.clearValues(filterDiv),ZPLite.Filters.clearOptions(filterDiv))}},getDefaultParams:function(fileType){var params={mode:"getJobScheduleReport",userErecNo:"0",clientId:"0",projectId:"0",jobId:"0",billableStatus:"-1",approvalStatus:"0",employeeStatus:"19,-2,18",departmentId:"0",locationId:"0",designationId:"0",legalEntityId:"0",businessUnitId:"0",divisionId:"0",isDirectSubOnlyNeeded:!1,repType:Timetracker.Reports.Util.getReportTypeParam(),conreqcsr:csrfToken};if(Timetracker.Reports.jobScheduleReport.isSummaryReport()?params.reportType=1:params.reportType=2,fileType){if(params.mode="exportJobScheduleReport",params.fileType=fileType,"pdf"!==fileType){var exportContainer=Layout.Page.container.find("#tabZP5Export");exportContainer.length>0&&Timetracker.Filters.getParamsForEmpAddnFields(params,exportContainer)}delete params.conreqcsr}return params},getParamsForReport:function(fileType){var values,params=Timetracker.Reports.jobScheduleReport.getDefaultParams(fileType),filterDiv=Layout.Page.container.find("#filterDiv");if(ZPLite.Reports.Util.isPersonalReport())params.userErecNo=erecno;else{if(params.employeeDateOfExitBased=filterDiv.find('[name="includeExEmployeesFilter"]').find("input").is(":checked"),filterDiv.find('[name="showDirectReporteesFilter"]').is(":visible")&&(params.isDirectSubOnlyNeeded=filterDiv.find('[name="showDirectReporteesFilter"]').find("input").is(":checked")),(values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]')))&&values.length>0){var users="";$.each(values,function(index,option){0!==index&&(users+=","),users+=option.id}),params.userErecNo=users}else params.showOnlyTeamData=ZPLite.Reports.Util.isTeamReport();Timetracker.Filters.getParamsForEmpReltFilters(params,filterDiv)}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="clientFilter"]')))&&values.length>0&&Timetracker.jobSchedule.Form.isClientFilterAllowed()){var clientId="";$.each(values,function(index,option){0!==index&&(clientId+=","),clientId+=option.id}),params.clientId=clientId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="projectFilter"]')))&&values.length>0){var projectId="";$.each(values,function(index,option){0!==index&&(projectId+=","),projectId+=option.id}),params.projectId=projectId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="jobFilter"]')))&&values.length>0){var jobId="";$.each(values,function(index,option){0!==index&&(jobId+=","),jobId+=option.id}),params.jobId=jobId}(values=ZPLite.Filters.getValues(filterDiv.find('[name="billableStatusFilter"]')))&&values.length>0&&(params.billableStatus=values[0].id),(values=ZPLite.Filters.getValues(filterDiv.find('[name="approvalStatusFilter"]')))&&values.length>0&&(params.approvalStatus=values[0].id);var datePeriod=ZPLite.DateNavigator.getPeriod(Timetracker.Reports.Constants.jobScheduleReport);if(void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(params.fromDate=Timetracker.DateTime.getDateinDBformat(datePeriod.from,!0),params.toDate=Timetracker.DateTime.getDateinDBformat(datePeriod.to,!0)):(params.fromDate=Timetracker.DateTime.getDateinDBformat(datePeriod.day,!0),params.toDate=Timetracker.DateTime.getDateinDBformat(datePeriod.day,!0))),Timetracker.jobSchedule.hasCustomFields()){var customFieldDetails={},customFields=Timetracker.jobSchedule.getCustomFields();for(var iterator in customFields){var field=customFields[iterator];if(25===field.componentType&&(values=ZPLite.Filters.getValues(filterDiv.find('[name="'+field.labelName+'Filter"]')))&&values.length>0){var idList="";$.each(values,function(index,option){0!==index&&(idList+=","),idList+=option.id}),customFieldDetails[field.labelName]=idList}}Object.keys(customFieldDetails).length>0&&(params.customFieldDetails=JSON.stringify(customFieldDetails),"exportJobScheduleReport"===params.mode&&(params.customFieldDetails=encodeURIComponent(params.customFieldDetails)))}return fileType||(params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.jobScheduleReport.Firescroll.mode),params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT),params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#timetrackerJobScheduleReport"),Timetracker.Reports.jobScheduleReport.Firescroll.mode),layout.find("#timetrackerJobScheduleReport").scrollTop(0),layout.find(".ZPNdata").remove(),layout.find("#timetrackerJobScheduleReport").before(ZPeople.LOADING_HTML),layout.find("#timetrackerJobScheduleReport").addClass("DN"),layout.find("#timetrackerJobScheduleSummaryReportTable").addClass("DN"),layout.find("#timetrackerJobScheduleDetailedReportTable").addClass("DN");var params=Timetracker.Reports.jobScheduleReport.getParamsForReport();ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){if(layout.find(".ZPNdata").remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),response&&("permissionDenied"===response.error||response.errorCode==Timetracker.constants.ERROR_CODES.NO_PERM_CODE))return layout.find("#timetrackerJobScheduleReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),void layout.find(".lt_nav").addClass("DN");var empDtls=response&&response.resObj&&response.resObj.data?response.resObj.data:{};if(Object.keys(empDtls).length>0){if(1===params.reportType){response.resObj.data.jobObj&&response.resObj.data.jobDtls;if(layout.find("#timetrackerJobScheduleSummaryReportTable").removeClass("DN"),""===layout.find("#timetrackerJobScheduleSummaryReportHead").html()){var html='<tr class="ZPLHRow"><th rowspan="2">'+ZPI18N.getString("zp.employee")+'</th><th rowspan="2"><span class="form_jobname">'+ZPI18N.getString("zp.jobname")+'</span></th><th rowspan="2">'+ZPI18N.getString("zp.scheduledhours")+'</th><th colspan="2">'+ZPI18N.getString("zp.withintheschd")+'</th><th colspan="2">'+ZPI18N.getString("zp.total")+'</th></tr><tr><th style="padding-left:10px;">'+ZPI18N.getString("zp.loggedhrs")+'</th><th title="'+ZPI18N.getString("zp.actualworkedhours")+" - "+ZPI18N.getString("zp.scheduledhours")+'">'+ZPI18N.getString("zp.deviation")+"</th><th>"+ZPI18N.getString("zp.loggedhrs")+'</th><th title="'+ZPI18N.getString("zp.loggedhrs")+" - "+ZPI18N.getString("zp.scheduledhours")+'">'+ZPI18N.getString("zp.overtimedeviation")+"</th></tr>";Layout.Page.container.find("#timetrackerJobScheduleSummaryReportHead").html($(html))}(tableBody=layout.find("#timetrackerJobScheduleSummaryReportBody")).html(""),$.each(empDtls,function(erecNo,empDtl){tableBody.append(Timetracker.Reports.jobScheduleReport.constructSummaryReportRowHtml(empDtl))})}else{layout.find("#timetrackerJobScheduleDetailedReportTable").removeClass("DN");var tableBody,dateArr=Timetracker.Reports.jobScheduleReport.constructDetailedReportDtls(!1,params);(tableBody=layout.find("#timetrackerJobScheduleDetailedReportBody")).html(""),$.each(empDtls,function(erecNo,empDtl){tableBody.append(Timetracker.Reports.jobScheduleReport.constructDetailedReportRowHtml(empDtl,dateArr))})}Timetracker.util.init(),layout.find("#timetrackerJobScheduleReport").removeClass("DN"),ZPLite.Firescroll.init(layout.find("#timetrackerJobScheduleReport"),Timetracker.Reports.jobScheduleReport.Firescroll.mode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.jobScheduleReport.Firescroll.loadMoreData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.jobScheduleReport.Firescroll.mode,Object.keys(empDtls).length)}else layout.find("#timetrackerJobScheduleReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsyet")))})},constructSummaryReportRowHtml:function(empDtl){var html="",empName=empDtl.employeeName,empId=empDtl.employeeId;if(empId){empName=empName||"";var jobDtl=empDtl.jobSchedDtls,rowspan=0;0!==Object.keys(jobDtl).length&&(html+='<tr class="ZPLRow"><td rowspan="$ROWSPAN$"><div class="d-flexC"><img class="FL" src="'+empDtl.employeePhoto+'"><div class="ZPusrName DIBI padt0"><span class="ellipsis W150" data-toggle="tooltip" data-placement="bottom" data-container="body" title="'+empName+'" data-original-title="'+empName+'"><b>'+empId+"</b> "+empName+"</span>",empDtl.empDateOfExit&&(html+='<em class="ZPsecName">( '+ZPI18N.getString("zp.exitdate")+"-"+empDtl.empDateOfExit+")</em>"),html+="</div></div></td>"),$.each(jobDtl,function(jobId,schdtls){0!==rowspan&&(html+='<tr class="ZPLRow">');var jobName=schdtls.jobName||"",schdHrs=void 0!==schdtls.schdHrs?schdtls.schdHrs:"-",workedHrs=void 0!==schdtls.workedHrs?schdtls.workedHrs:"-",actualHrs=void 0!==schdtls.actualHrs?schdtls.actualHrs:"-",overtime=void 0!==schdtls.overtime?schdtls.overtime:"-",deviation=void 0!==schdtls.deviation?schdtls.deviation:"-";html+="<td "+(0!==rowspan?'class="PL8I"':'""')+'><label data-toggle="tooltip" data-placement="bottom" data-container="body" title="'+jobName+'" data-original-title="'+jobName+'">'+jobName+"</label></td><td>"+(ZPUtil.Validation.isNumber(schdHrs)?Calendar.minstohrs(schdHrs):"-")+"</td><td>"+(ZPUtil.Validation.isNumber(actualHrs)?Calendar.minstohrs(actualHrs):"-")+'</td><td class="'+(deviation>=0?"grn":"red")+'">'+(ZPUtil.Validation.isNumber(deviation)?deviation>=0?Calendar.minstohrs(deviation):"-"+Calendar.minstohrs(Math.abs(deviation)):"-")+"</td><td>"+(ZPUtil.Validation.isNumber(workedHrs)?Calendar.minstohrs(workedHrs):"-")+'</td><td class="'+(overtime>=0?"grn":"red")+'">'+(ZPUtil.Validation.isNumber(overtime)?overtime>=0?Calendar.minstohrs(overtime):"-"+Calendar.minstohrs(Math.abs(overtime)):"-")+"</td></tr>",rowspan++}),html=html.replace("$ROWSPAN$",rowspan)}return html},constructDetailedReportDtls:function(isFromFireScroll,params){var html='<tr class="ZPLHRow"><th class="col1_sticky">'+ZPI18N.getString("zp.employee")+"</th>",fromDate=Calendar.parseDate(params.fromDate,Calendar.DB_DATEFORMAT),toDate=Calendar.parseDate(params.toDate,Calendar.DB_DATEFORMAT),wstime=fromDate.getTime(),weekStarts=new Date;weekStarts.setTime(wstime);for(var dateCnt=0,dateArr=new Array;weekStarts<=toDate;){var date=Timetracker.util.convertDateTo2digit(weekStarts.getDate());dateArr.push(weekStarts.getFullYear()+"-"+Timetracker.util.convertDateTo2digit(weekStarts.getMonth()+1)+"-"+date),isFromFireScroll||(html+='<th class="text-center TBrdr P0I" style="min-width: 291px; max-width: initial;"><table class="table i_table" $TB_FXD_STYLE$><tbody><tr><th colspan="4" class="text-center B1"><span class="DB MB3">'+months[weekStarts.getMonth()]+" "+date+'</span><span class="DB gry S13 ZPregI">'+days[weekStarts.getDay()]+'</span></th></tr><tr><th width=25%><div class="form_jobname ellipsis W150">'+ZPI18N.getString("zp.jobname")+'</div></th><th width=25%><div class="W120 text-center">'+ZPI18N.getString("zp.scheduledhours")+'</div></th><th width=25%><div class="W120 text-center">'+ZPI18N.getString("zp.actualworkedhours")+'</div></th><th width=25% title="'+ZPI18N.getString("zp.actualworkedhours")+" - "+ZPI18N.getString("zp.scheduledhours")+'"><div class="W130 text-center">'+ZPI18N.getString("zp.overtimedeviation")+"</div></th></tr></tbody></table></th>"),weekStarts.setDate(weekStarts.getDate()+1),dateCnt++}return isFromFireScroll||(html=html.replace("$TB_FXD_STYLE$",1===dateCnt?'style="table-layout: fixed;"':""),html+="</thead>",Layout.Page.container.find("#timetrackerJobScheduleDetailedReportHead").html($(html))),dateArr},constructDetailedReportRowHtml:function(empDtl,dateArr){var html="",empName=empDtl.employeeName,empId=empDtl.employeeId;if(empId){empName=empName||"";var workDateObj=empDtl.jobSchedDtls;0!==Object.keys(workDateObj).length&&(html+='<tr class="ZPLRow"><td rowspan="$ROWSPAN$" class="col1_sticky"><div class="d-flexC"><img class="FL" src="'+empDtl.employeePhoto+'"><div class="ZPusrName DIBI padt0"><span class="ellipsis W120" data-toggle="tooltip" data-placement="bottom" data-container="body" title="'+empName+'" data-original-title="'+empName+'"><b>'+empId+"</b> "+empName+"</span>",empDtl.empDateOfExit&&(html+='<em class="ZPsecName">( '+ZPI18N.getString("zp.exitdate")+"-"+empDtl.empDateOfExit+")</em>"),html+="</div></div></td>");for(var rowspan=0,isRepeat=!0;isRepeat;){isRepeat=!1,0!==rowspan&&(html+='<tr class="ZPLRow">');for(var i=0;i<dateArr.length;i++){var jobArr=workDateObj[dateArr[i]],splicedArr=null;if(jobArr&&0!==jobArr.length&&(splicedArr=jobArr.splice(0,1)),isRepeat=isRepeat||jobArr&&0!==jobArr.length,null!=splicedArr&&0!==splicedArr.length){var schdtls=splicedArr[0],jobName=schdtls.jobName||"",schdHrs=void 0!==schdtls.schdHrs?schdtls.schdHrs:"-",actualHrs=void 0!==schdtls.actualHrs?schdtls.actualHrs:"-",deviation=void 0!==schdtls.deviation?schdtls.deviation:"-",fromToTime="",fromTime=schdtls.fromTime,toTime=schdtls.toTime;fromTime&&toTime&&(fromToTime="("+Calendar.minstotime(fromTime)+" - "+Calendar.minstotime(toTime)+")"),html+='<td class="P0I TBrdr"><table class="table i_table"><tbody><td width=25%><div class="W150"><span class="ellipsis W150" data-toggle="tooltip" data-placement="bottom" data-container="body" title="'+jobName+'" data-original-title="'+jobName+'">'+jobName+'</span><label class="dgry S13">'+fromToTime+'</label></div></td><td width=25%><div class="W120 text-center">'+(ZPUtil.Validation.isNumber(schdHrs)?Calendar.minstohrs(schdHrs):"-")+'</div></td><td width=25%><div class="W120 text-center">'+(ZPUtil.Validation.isNumber(actualHrs)?Calendar.minstohrs(actualHrs):"-")+'</div></td><td width=25%><div class="W130 text-center '+(deviation>=0?"grn":"red")+'">'+(ZPUtil.Validation.isNumber(deviation)?deviation>=0?Calendar.minstohrs(deviation):"-"+Calendar.minstohrs(Math.abs(deviation)):"-")+"</div></td></tbody></table></td>"}else html+='<td class="P0I TBrdr"><table class="table i_table"><tbody><td width=100%><div class="W60 Mauto text-center" style="min-width:561px;">-</div></td></tbody></table></td>'}html+="</tr>",rowspan++}html=html.replace("$ROWSPAN$",rowspan)}return html},Firescroll:{mode:"TT_JOBSCHEDULE_REPORT_FIRESCROLL",loadMoreData:function(extraDtls){var layout=Layout.Page.container,params=extraDtls.params;params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.jobScheduleReport.Firescroll.mode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){var empDtls=response&&response.resObj&&response.resObj.data?response.resObj.data:{};if(Object.keys(empDtls).length>0){if(ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.jobScheduleReport.Firescroll.mode,!1),1===params.reportType){var tableBody=layout.find("#timetrackerJobScheduleSummaryReportBody");$.each(empDtls,function(erecNo,empDtl){tableBody.append(Timetracker.Reports.jobScheduleReport.constructSummaryReportRowHtml(empDtl))})}else{var dateArr=Timetracker.Reports.jobScheduleReport.constructDetailedReportDtls(!0,params);tableBody=layout.find("#timetrackerJobScheduleDetailedReportBody");$.each(empDtls,function(erecNo,empDtl){tableBody.append(Timetracker.Reports.jobScheduleReport.constructDetailedReportRowHtml(empDtl,dateArr))})}ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.jobScheduleReport.Firescroll.mode,Object.keys(empDtls).length)}else ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.jobScheduleReport.Firescroll.mode,0)})}},showExport:function(currentObj){$(currentObj).hasClass("open")?$(currentObj).removeClass("open"):(Timetracker.Reports.Util.getCommonData(),$(currentObj).addClass("open"))},exportReport:function(mode,extraParams,fileType){var requestUrl="timesheetDispAction.zp?",params=Timetracker.Reports.jobScheduleReport.getParamsForReport(fileType);$.each(params,function(key,value){requestUrl+=key+"="+value+"&"}),requestUrl=requestUrl.substring(0,requestUrl.length-1),Timetracker.ImportExport.submiteFormForExport(requestUrl)}},userReport:{init:function(){ZPLite.Reports.setCurrentModule(ZPLite.Modules.Timetracker),ZPLite.Reports.setCurrentReport(Timetracker.Reports.Constants.userReport);var initParams={isModuleDataNeeded:!0,moduleDataCallback:Timetracker.Reports.init,callback:Timetracker.Reports.userReport.initCallback};ZPLite.Reports.initPage(initParams)},initCallback:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Modules.Timetracker),Timetracker.Reports.Util.getCommonData(),Timetracker.Reports.Filters.clearCache(!0);var container=Layout.Page.container;container.find("#sortByEmployeeName").removeClass("sort-u sort-d").addClass("sort-u"),container.find("#sortByEmployeeName").attr("title",ZPI18N.getString("zp.sortbydesc")),container.find("#sortByTotalHours,#sortByReportingToName").removeClass("sort-u sort-d"),container.find("#sortByEmployeeName").off("click").on("click",function(){$(this).hasClass("sort-u")?($(this).removeClass("sort-u").addClass("sort-d"),$(this).attr("title",ZPI18N.getString("zp.sortbyasc"))):($(this).removeClass("sort-d").addClass("sort-u"),$(this).attr("title",ZPI18N.getString("zp.sortbydesc"))),Layout.Page.container.find("#sortByTotalHours,#sortByReportingToName").removeClass("sort-d sort-u"),Layout.Page.container.find("#sortByTotalHours,#sortByReportingToName").attr("title",""),Timetracker.Reports.userReport.generateReport()}),container.find("#sortByReportingToName").off("click").on("click",function(){$(this).hasClass("sort-u")?($(this).removeClass("sort-u").addClass("sort-d"),$(this).attr("title",ZPI18N.getString("zp.sortbyasc"))):($(this).removeClass("sort-d").addClass("sort-u"),$(this).attr("title",ZPI18N.getString("zp.sortbydesc"))),Layout.Page.container.find("#sortByTotalHours,#sortByEmployeeName").removeClass("sort-d sort-u"),Layout.Page.container.find("#sortByTotalHours,#sortByEmployeeName").attr("title",""),Timetracker.Reports.userReport.generateReport()}),container.find("#sortByTotalHours").off("click").on("click",function(){$(this).hasClass("sort-u")?($(this).removeClass("sort-u").addClass("sort-d"),$(this).attr("title",ZPI18N.getString("zp.sortbyasc"))):($(this).removeClass("sort-d").addClass("sort-u"),$(this).attr("title",ZPI18N.getString("zp.sortbydesc"))),Layout.Page.container.find("#sortByEmployeeName,#sortByReportingToName").removeClass("sort-d sort-u"),Layout.Page.container.find("#sortByEmployeeName,#sortByReportingToName").attr("title",""),Timetracker.Reports.userReport.generateReport()});var filterDiv=container.find("#filterDiv");Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="datePeriodFilter"]'),"datePeriod",!0,Timetracker.Reports.userReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="hoursComparatorFilter"]'),"hoursComparator",!0,Timetracker.Reports.userReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Timetracker.Reports.userReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="approvalStatusFilter"]'),"approvalStatus",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})});var dateNavigationDtls={};dateNavigationDtls.mode=Timetracker.Reports.Constants.userReport,dateNavigationDtls.containerId=Layout.Page.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.navigationCallback=Timetracker.Reports.userReport.generateReport,ZPLite.DateNavigator.init(dateNavigationDtls),ZPLite.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPLite.DateNavigator.TYPE.WEEKLY,ZPLite.DateNavigator.TENSE.CURRENT),Timetracker.Reports.userReport.setDefaultFilterParams(),Timetracker.Reports.userReport.generateReport()},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");filterDiv.find('[name="fromDateFilter"]').addClass("DNI"),filterDiv.find('[name="toDateFilter"]').addClass("DNI"),filterDiv.find('[name="hoursFilter"]').addClass("DNI"),filterDiv.find('[name="hoursFilter"]').find("input").val(""),filterDiv.find('[name="userInclusionFilter"]').removeClass("DNI"),filterDiv.find('[name="userInclusionFilter"]').find("input").prop("checked",!0),filterDiv.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),filterDiv.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0),filterDiv.find('[name="approvalStatusFilter"]').removeClass("disabled"),ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"1",text:ZPI18N.getString("zp.thisweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:ZPLite.DateNavigator.TENSE.CURRENT}]),ZPLite.Filters.setValues(filterDiv.find('[name="hoursComparatorFilter"]'),[{id:"0",text:ZPI18N.getString("zp.all")}]),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]),ZPLite.Filters.clearValues(filterDiv.find('[name="approvalStatusFilter"]')),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]'))},resetFilter:function(){Timetracker.Reports.userReport.setDefaultFilterParams()},applyFilter:function(){var errorMessage,tense,customDatePeriod,container=Layout.Page.container.find("#filterDiv"),values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),type=values[0].periodType,hideNavigation=!1,errorFilters=container.find(".error-clr");if(errorFilters.length>0&&$.each(errorFilters,function(){$(this).removeClass("error-clr")}),"6"===values[0].id){var fromDate=container.find('[name="fromDateFilter"]').data("selectedDate"),toDate=container.find('[name="toDateFilter"]').data("selectedDate");if(void 0===fromDate||""===fromDate)container.find('[name="fromDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptyfromdate");else if(void 0===toDate||""===toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptytodate");else{if(fromDate>toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.greaterfromdate");else ZPDateTime.getDateDiff(fromDate,toDate)>31&&(container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.datewithindays",[31]))}customDatePeriod={from:fromDate,to:toDate},hideNavigation=!0}else hideNavigation=!1,tense=values[0].tense;var hoursFilter=container.find('[name="hoursFilter"]');if(!hoursFilter.hasClass("DNI")){var hours=hoursFilter.find("input").val();void 0!==hours&&""!==hours&&Timetracker.util.maxhrsRegex.test(hours)||(hoursFilter.addClass("error-clr"),errorMessage=ZPI18N.getString("zp.invalidhours"))}errorMessage?ZPeople.Message.showWarningMsg(errorMessage):(ZPLite.DateNavigator.setPeriod(Timetracker.Reports.Constants.userReport,type,tense,hideNavigation,customDatePeriod),Timetracker.Reports.userReport.generateReport())},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("datePeriod"===data.entity){var values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]'));Timetracker.Reports.Filters.showHideFromToDateFilter(container,values,Timetracker.Reports.Constants.userReport)}else if("hoursComparator"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="hoursComparatorFilter"]'));if(!jQuery.isEmptyObject(values)){var hideHoursFilter="0"===values[0].id||"4"===values[0].id,hideUserInclusionFilter="0"!==values[0].id&&"1"!==values[0].id,hideApprovalStatusFilter="4"===values[0].id;hideHoursFilter?container.find('[name="hoursFilter"]').addClass("DNI"):container.find('[name="hoursFilter"]').removeClass("DNI"),hideUserInclusionFilter?container.find('[name="userInclusionFilter"]').addClass("DNI"):container.find('[name="userInclusionFilter"]').removeClass("DNI"),hideApprovalStatusFilter?(ZPLite.Filters.clearValues(container.find('[name="approvalStatusFilter"]')),container.find('[name="approvalStatusFilter"]').addClass("disabled")):container.find('[name="approvalStatusFilter"]').removeClass("disabled")}}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));-1===Timetracker.projects.Operations.findJSONArrayIndex(values,"18","id")?(container.find('[name="includeExEmployeesFilter"]').addClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!1)):container.find('[name="includeExEmployeesFilter"]').hasClass("DNI")&&(container.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0))}},getDefaultParams:function(fileType){var params={mode:"getUserLogHoursReport",hoursComparator:"0",departmentId:"0",locationId:"0",designationId:"0",legalEntityId:"0",businessUnitId:"0",divisionId:"0",employeeStatus:"19,-2,18",repType:Timetracker.Reports.Util.getReportTypeParam(),conreqcsr:csrfToken};if(fileType){if(params.mode="exportUserLogHoursReport",params.fileType=fileType,"pdf"!==fileType){var exportContainer=Layout.Page.container.find("#tabZP5Export");exportContainer.length>0&&Timetracker.Filters.getParamsForEmpAddnFields(params,exportContainer)}delete params.conreqcsr}return params},getParamsForReport:function(fileType){var params=Timetracker.Reports.userReport.getDefaultParams(fileType),container=Layout.Page.container.find("#filterDiv"),values=ZPLite.Filters.getValues(container.find('[name="hoursComparatorFilter"]'));if(values&&values.length>0&&(params.hoursComparator=values[0].id,"0"!==params.hoursComparator&&"4"!==params.hoursComparator&&(params.hours=container.find('[name="hoursFilter"]').find("input").val()),"0"!==params.hoursComparator&&"1"!==params.hoursComparator||(params.includeUsersWithoutTimelogs=container.find('[name="userInclusionFilter"]').find("input").is(":checked"))),(values=ZPLite.Filters.getValues(container.find('[name="approvalStatusFilter"]')))&&values.length>0){var approvalStatus="";$.each(values,function(index,option){0!==index&&(approvalStatus+=";"),approvalStatus+=option.id}),params.approvalStatus=approvalStatus}Timetracker.Filters.getParamsForEmpReltFilters(params,container),params.employeeDateOfExitBased=container.find('[name="includeExEmployeesFilter"]').find("input").is(":checked"),Layout.Page.container.find("#sortByEmployeeName").hasClass("sort-u")||Layout.Page.container.find("#sortByEmployeeName").hasClass("sort-d")?(params.sortType="0",params.isAscending=Layout.Page.container.find("#sortByEmployeeName").hasClass("sort-u")):Layout.Page.container.find("#sortByTotalHours").hasClass("sort-u")||Layout.Page.container.find("#sortByTotalHours").hasClass("sort-d")?(params.sortType="1",params.isAscending=Layout.Page.container.find("#sortByTotalHours").hasClass("sort-u")):(Layout.Page.container.find("#sortByReportingToName").hasClass("sort-u")||Layout.Page.container.find("#sortByReportingToName").hasClass("sort-d"))&&(params.sortType="2",params.isAscending=Layout.Page.container.find("#sortByReportingToName").hasClass("sort-u"));var datePeriod=ZPLite.DateNavigator.getPeriod(Timetracker.Reports.Constants.userReport);return void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(params.fromDate=Calendar.formatDate(datePeriod.from),params.toDate=Calendar.formatDate(datePeriod.to)):(params.fromDate=Calendar.formatDate(datePeriod.day),params.toDate=Calendar.formatDate(datePeriod.day))),fileType||(params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.userReport.Firescroll.mode),params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT),params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#timetrackerUserReport"),Timetracker.Reports.userReport.Firescroll.mode),layout.find("#timetrackerUserReport").scrollTop(0),layout.find(".ZPNdata").remove(),layout.find("#timetrackerUserReport").before(ZPeople.LOADING_HTML),layout.find("#timetrackerUserReport").addClass("DN");var params=Timetracker.Reports.userReport.getParamsForReport();ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){if(layout.find(".ZPNdata").remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),!response||"permissionDenied"!==response.error&&response.errorCode!=Timetracker.constants.ERROR_CODES.NO_PERM_CODE){var dataArr=1===response.res?response.resObj.data:[];if(dataArr.length>0){var reportingToDtls=response.resObj.reportingToDtls;layout.find("#timetrackerUserReport").removeClass("DN");var tableBody=layout.find("#timetrackerUserReportBody");tableBody.html(""),$.each(dataArr,function(index,data){tableBody.append(Timetracker.Reports.userReport.constructReportRowHtml(data,reportingToDtls))}),ZPLite.Firescroll.init(layout.find("#timetrackerUserReport"),Timetracker.Reports.userReport.Firescroll.mode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.userReport.Firescroll.loadMoreData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.userReport.Firescroll.mode,dataArr.length)}else layout.find("#timetrackerUserReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsyet")))}else layout.find("#timetrackerUserReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),layout.find(".lt_nav").addClass("DN")})},constructReportRowHtml:function(data,reportingToDtls){var html='<tr class="ZPLRow">';return html+='<td class="P_AM"><div class="ZPusrName PL10I"><img class="FL" src="'+data.employeePhoto+'"><span class="usrDts" title="'+data.employeeName+'"><span class="usrEmpID">'+data.employeeId+" - </span> "+data.employeeName+"</span>",data.empDateOfExit&&(html+='<em class="ZPsecName">( '+ZPI18N.getString("zp.exitdate")+"-"+data.empDateOfExit+")</em>"),html+="</div></td>",data.reportingto_Erecno&&reportingToDtls[data.reportingto_Erecno]?html+='<td class="P_AM"><div class="ZPusrName PL10I"><img class="FL" src="'+reportingToDtls[data.reportingto_Erecno].reporting_Photo+'"><span class="usrDts" title="'+reportingToDtls[data.reportingto_Erecno].reportingTo_Name+'"><span class="usrEmpID">'+reportingToDtls[data.reportingto_Erecno].reportingTo_empId+" - </span> "+reportingToDtls[data.reportingto_Erecno].reportingTo_Name+"</span></div></td>":html+='<td class="P_AM"><div class="ZPusrName PL10I">-</div></td>',html+="<td>"+Calendar.minstohrs(data.billableHours)+"</td>",html+="<td>"+Calendar.minstohrs(data.nonBillableHours)+"</td>",Timetracker.generalSettings.isBreakEnabled()&&(html+="<td>"+Calendar.minstohrs(data.paidBreakHours)+"</td>",html+="<td>"+Calendar.minstohrs(data.nonPaidBreakHours)+"</td>"),html+="<td>"+Calendar.minstohrs(data.totalHours)+"</td>",html+="</tr>"},Firescroll:{mode:"TT_USER_REPORT_FIRESCROLL",loadMoreData:function(extraDtls){var params=extraDtls.params;params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.userReport.Firescroll.mode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(1===response.res){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.userReport.Firescroll.mode,!1);var dataArr=response.resObj.data,reportingToDtls=response.resObj.reportingToDtls,tableBody=Layout.Page.container.find("#timetrackerUserReportBody");$.each(dataArr,function(index,data){tableBody.append(Timetracker.Reports.userReport.constructReportRowHtml(data,reportingToDtls))}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.userReport.Firescroll.mode,dataArr.length)}else ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.userReport.Firescroll.mode,0)})}},showExport:function(currentObj){$(currentObj).hasClass("open")?$(currentObj).removeClass("open"):(Timetracker.Reports.Util.getCommonData(),$(currentObj).addClass("open"))},exportReport:function(mode,extraParams,fileType){var requestUrl="timesheetDispAction.zp?",params=Timetracker.Reports.userReport.getParamsForReport(fileType);$.each(params,function(key,value){requestUrl+=key+"="+value+"&"}),requestUrl=requestUrl.substring(0,requestUrl.length-1),Timetracker.ImportExport.submiteFormForExport(requestUrl)},printReport:function(){Timetracker.Reports.userReport.getParamsForReport();Timetracker.util.printReport("timetrackerUserReport",!1,"0",Layout.Page.container.find("#dateNavigatorText").text(),void 0,!0)}},clientReport:{clientId:null,billMethod:new Array(ZPI18N.getString("zp.hourlyjobrate"),ZPI18N.getString("zp.hourlyuserrate"),ZPI18N.getString("zp.hourlyjobuserrate"),ZPI18N.getString("zp.hourlyprouserrate")),init:function(){ZPLite.Reports.setCurrentModule(ZPLite.Modules.Timetracker),ZPLite.Reports.setCurrentReport(Timetracker.Reports.Constants.clientReport),ZPLite.Reports.initPage({isModuleDataNeeded:!0,moduleDataCallback:Timetracker.Reports.init,callback:Timetracker.Reports.clientReport.initCallback})},initCallback:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Modules.Timetracker),Timetracker.Reports.clientReport.generateReport()},getParamsForReport:function(fileType){var params={mode:"getClientReport",repType:Timetracker.Reports.Util.getReportTypeParam(),conreqcsr:csrfToken};return fileType?(params.mode="exportClientReport",params.fileType=fileType,delete params.conreqcsr):params.startIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.clientReport.Firescroll.mode),params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#timetrackerClientReport"),Timetracker.Reports.clientReport.Firescroll.mode),layout.find("#timetrackerClientReport").scrollTop(0),layout.find(".ZPNdata").remove(),layout.find("#timetrackerClientReport").before(ZPeople.LOADING_HTML),layout.find("#timetrackerClientReport").addClass("DN");var params=Timetracker.Reports.clientReport.getParamsForReport();ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){if(layout.find(".ZPNdata").remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),response&&"9000"===response.errorCode)layout.find("#timetrackerClientReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),layout.find(".lt_nav").addClass("DN");else if(void 0!==response&&response.length>0){layout.find("#timetrackerClientReport").removeClass("DN");var tableBody=layout.find("#timetrackerClientReportBody");tableBody.html(""),$.each(response,function(index,data){tableBody.append(Timetracker.Reports.clientReport.constructReportRowHtml(data))}),ZPLite.Firescroll.init(layout.find("#timetrackerClientReport"),Timetracker.Reports.clientReport.Firescroll.mode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.clientReport.Firescroll.loadMoreData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.clientReport.Firescroll.mode,response.length)}else layout.find("#timetrackerClientReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsyet")))})},constructReportRowHtml:function(data){var html='<tr class="ZPLRow">';return html+='<td class="CP" title="'+data.clientName+'" onclick="Timetracker.Reports.clientReport.showClientSummary(this);">'+data.clientName+"</td>",html+="<td>"+Calendar.minstohrs(data.billable)+"</td>",html+="<td>"+Calendar.minstohrs(data.nonBillable)+"</td>",html+="<td>"+Calendar.minstohrs(data.totalHours)+"</td>",html+="</tr>",(html=$(html)).data(data),html},showClientSummary:function(obj){var modal=Layout.Page.container.find("#repclientsummary");if(0==modal.length){var json=Timetracker.Reports.clientReport.constructViewPagePopup();modal=ZPeople.BSModal.get(json);var footer='<button data-dismiss="modal" type="button" class="btn btn-default btn-md">'+ZPI18N.getString("zp.close")+"</button>";modal.find(".modal-footer").html(footer)}var data=$(obj).parent().data(),clientId=data.clientId;Timetracker.Reports.clientReport.clientId=clientId,Layout.Page.container.find("#repclientsummary").find("#repbilling-viewclientName").html(data.clientName),"-1"!=data.billingMethod?Layout.Page.container.find("#repclientsummary").find("#repbilling-viewbillingMethod").text(Timetracker.Reports.clientReport.billMethod[data.billingMethod]):Layout.Page.container.find("#repclientsummary").find("#repbilling-viewbillingMethod").text("-"),$.post("/timesheet.zp",{mode:"getBillingLogs",clientId:clientId,conreqcsr:csrfToken},function(result){var data=result[0],billedHours=0,unBilledHours=0,nonBillableHours=0;data.billedHours&&(billedHours=data.billedHours),data.unBilledHours&&(unBilledHours=data.unBilledHours),data.nonBillableHours&&(nonBillableHours=data.nonBillableHours),Layout.Page.container.find("#repclientsummary").find("#repclient-billedhours").html(Calendar.minstohrs(billedHours)+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#repclientsummary").find("#repclient-nonbillablehours").html(Calendar.minstohrs(nonBillableHours)+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#repclientsummary").find("#repclient-unbilledhours").html(Calendar.minstohrs(unBilledHours)+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#repclientsummary").find("#repclient-totalhours").html(Calendar.minstohrs(Number(billedHours)+Number(unBilledHours)+Number(nonBillableHours))+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#repclientsummary").find(".PArds").parent().remove(),Timetracker.util.init(),Timetracker.projects.Listing.groupAccordingToProjects(data.projects,!1,"repClient-jobTbody"),ZPeople.BSModal.show(modal)})},constructViewPagePopup:function(){var body='<div class="row"><div class="col-sm-6"><form class="form-horizontal pad" role="form"><div class="form-group"><label class="control-label col-sm-4"><b>'+ZPI18N.getString("zp.clientname")+' :</b></label><div class="col-sm-8"><div class="PT5" id="repbilling-viewclientName"></div></div></div><div class="form-group"><label class="control-label col-sm-4"><b>'+ZPI18N.getString("zp.billingmethod")+' :</b></label><div class="col-sm-8"><div class="PT5" id="repbilling-viewbillingMethod"></div></div></div></form></div><div class="col-sm-6"><label class="MT10 MB10"><b>'+ZPI18N.getString("zp.summary")+'</b></label><div class="row"><div class="col-sm-3"><div class="Dtyps ZPBC12"><span>'+ZPI18N.getString("zp.loggedhours")+'</span><div class="gry" id="repclient-totalhours"></div></div></div><div class="col-sm-3"><div class="Dtyps ZPBC3"><span>'+ZPI18N.getString("zp.nonbillablehours")+'</span><div class="gry" id="repclient-nonbillablehours"></div></div></div><div class="col-sm-3"><div class="Dtyps ZPBC3"><span>'+ZPI18N.getString("zp.billedhrs")+'</span><div class="gry" id="repclient-billedhours"></div></div></div><div class="col-sm-3"><div id="generateBillModal" class="Dtyps ZPBC11 CP" onclick="TimetrackerOperations.billing.generateBillForClientReport()"><span>'+ZPI18N.getString("zp.unbilledhrs")+'</span><div class="gry" id="repclient-unbilledhours"></div></div></div></div></div></div><div class="zpl_dtbl" ><ul><li class="w400"><b class="form_projectname">'+ZPI18N.getString("zp.projectname")+'</b></li><li class="mw50"></li><li class="mw200"><b>'+ZPI18N.getString("zp.estimatedhours")+'</b></li><li class="mw200"><b>'+ZPI18N.getString("zp.loggedhours")+'</b></li><li class="mw150"><b>'+ZPI18N.getString("zp.status")+'</b></li><li class="w100" ><b class="form_jobs ellipsis WP90">'+ZPI18N.getString("zp.jobs")+'</b></li></ul><div id="repClient-jobTbody"></div></div></div>';return{id:"repclientsummary",type:2,modalClass:"popRgtModel PopLgModel",header:ZPI18N.getString("zp.clientsummary",[Timetracker.util.clientDispName]),body:body}},Firescroll:{mode:"TT_CLIENT_REPORT_FIRESCROLL",loadMoreData:function(extraDtls){extraDtls.params.startIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.clientReport.Firescroll.mode),ZPeople.Request.send(Timetracker.constants.URL,extraDtls.params,function(response){if(void 0!==response&&response.length>0){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.clientReport.Firescroll.mode,!1);var tableBody=Layout.Page.container.find("#timetrackerClientReportBody");$.each(response,function(index,data){tableBody.append(Timetracker.Reports.clientReport.constructReportRowHtml(data))}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.clientReport.Firescroll.mode,response.length)}else ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.clientReport.Firescroll.mode,0)})}},showExport:function(currentObj){$(currentObj).hasClass("open")?$(currentObj).removeClass("open"):$(currentObj).addClass("open")},exportReport:function(mode,extraParams,fileType){var requestUrl="timesheetDispAction.zp?",params=Timetracker.Reports.clientReport.getParamsForReport(fileType);$.each(params,function(key,value){requestUrl+=key+"="+value+"&"}),requestUrl=requestUrl.substring(0,requestUrl.length-1),Timetracker.ImportExport.submiteFormForExport(requestUrl)},printReport:function(){Timetracker.util.printReport("timetrackerClientReport",!1,"0",void 0,void 0,!0)}},payrollReport:{init:function(){ZPLite.Reports.setCurrentModule(ZPLite.Modules.Timetracker),ZPLite.Reports.setCurrentReport(Timetracker.Reports.Constants.payrollReport);var initParams={isModuleDataNeeded:!0,moduleDataCallback:Timetracker.Reports.init,callback:Timetracker.Reports.payrollReport.initCallback};ZPLite.Reports.initPage(initParams)},initCallback:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Modules.Timetracker),Timetracker.Reports.Util.getCommonData(!0),Timetracker.Reports.Filters.clearCache(!0);var filterDiv=Layout.Page.container.find("#filterDiv");Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="datePeriodFilter"]'),"datePeriod",!0,Timetracker.Reports.payrollReport.filterOnChangeCallback,void 0,!0),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeFilter"]'),"employee",!1,Timetracker.Reports.payrollReport.filterOnChangeCallback,"TT_PAYROLL_REPORT_FILTER_EMPLOYEE_FIRESCROLL"),Timetracker.generalSettings.isPayRollPayPeriodFormFiltersHiding()?filterDiv.find('[name="clientFilter"], [name="projectFilter"], [name="jobFilter"], [name="approvalStatusFilter"]').addClass("DNI"):(Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="clientFilter"]'),"client",!1,Timetracker.Reports.payrollReport.filterOnChangeCallback,"TT_PAYROLL_REPORT_FILTER_CLIENT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="projectFilter"]'),"project",!1,Timetracker.Reports.payrollReport.filterOnChangeCallback,"TT_PAYROLL_REPORT_FILTER_PROJECT_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="jobFilter"]'),"job",!1,Timetracker.Reports.payrollReport.filterOnChangeCallback,"TT_PAYROLL_REPORT_FILTER_JOB_FIRESCROLL"),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="approvalStatusFilter"]'),"approvalStatus",!0,void 0,void 0,!0)),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="employeeStatusFilter"]'),"employeeStatus",!1,Timetracker.Reports.payrollReport.filterOnChangeCallback),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="departmentFilter"]'),"department",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="locationFilter"]'),"location",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="orgTagFilter"]'),"orgTag",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="roleFilter"]'),"role",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="designationFilter"]'),"designation",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="legalEntityFilter"]'),"legalEntity",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="businessUnitFilter"]'),"businessUnit",!1),Timetracker.Reports.Filters.constructFilter(filterDiv.find('[name="divisionFilter"]'),"division",!1),filterDiv.find('[name="fromDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="fromDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})}),filterDiv.find('[name="toDateFilter"]').off("click").on("click",function(){Calendar.setUpCalendar(event,$(this).find('[name="toDateFilterText"]'),null,null,function(value,obj){$(obj).parent().val(Calendar.formatDate(value)),$(obj).parent().data("selectedDate",value),$(obj).parent().addClass("selected")})});var dateNavigationDtls={};dateNavigationDtls.mode=Timetracker.Reports.Constants.payrollReport,dateNavigationDtls.containerId=Layout.Page.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.navigationCallback=Timetracker.Reports.payrollReport.generateReport,dateNavigationDtls.getDateForCustomNavigationCallback=Timetracker.Reports.payrollReport.getDateDtlsForPayPeriodNavigation,ZPLite.DateNavigator.init(dateNavigationDtls),Timetracker.Reports.payrollReport.setDefaultFilterParams();var selectedPeriod=ZPLite.Filters.getValues(filterDiv.find('[name="datePeriodFilter"]'));selectedPeriod&&selectedPeriod.length>0&&(selectedPeriod[0].periodType===ZPLite.DateNavigator.TYPE.PAYPERIOD?(Timetracker.Reports.payrollReport.setPayPeriod(selectedPeriod[0].id),Timetracker.generalSettings.isPayRollPayPeriodPersistenceEnabled()&&(isadmin&&Layout.Page.container.find("#regeneratepayrollpop").html('<button type="button" class="lt_btn primary" id="ZP-Regenerate" onclick="Timetracker.Reports.payrollReport.generateReportPopup()">'+ZPI18N.getString("zp.reports.regeneratereport")+"</button>"),Layout.Page.container.find('[name="includeExEmployeesFilter"]').addClass("disabled"))):(ZPLite.DateNavigator.setPeriod(dateNavigationDtls.mode,selectedPeriod[0].periodType,selectedPeriod[0].tense),Timetracker.generalSettings.isPayRollPayPeriodPersistenceEnabled()&&Layout.Page.container.find('[name="includeExEmployeesFilter"]').removeClass("disabled"))),Timetracker.Reports.payrollReport.generateReport()},setPayPeriod:function(payPeriodId){var container=Layout.Page.container.find("#filterDiv").find('[name="datePeriodFilter"]'),payPeriodDtls=Timetracker.reports.payrollReport.dataPeriod[payPeriodId];if(payPeriodDtls){var period,payPeriod=Timetracker.reports.payrollReport.getPayperiod(payPeriodDtls);period="4"==payPeriod.conf.rsFrequency&&"1"==payPeriod.pos?{from:payPeriod.startSec,to:payPeriod.endSec}:{from:payPeriod.start,to:payPeriod.end},container.data("currentPayPeriod",payPeriod),ZPLite.DateNavigator.setPeriod(Timetracker.Reports.Constants.payrollReport,ZPLite.DateNavigator.TYPE.PAYPERIOD,ZPLite.DateNavigator.TENSE.CURRENT,!1,period)}},generateReportPopup:function(){var selectedPeriod=ZPLite.Filters.getValues(Layout.Page.container.find('[name="datePeriodFilter"]'));if(selectedPeriod&&selectedPeriod.length>0&&selectedPeriod[0].periodType===ZPLite.DateNavigator.TYPE.PAYPERIOD){var payPeriodDtls=Timetracker.reports.payrollReport.dataPeriod[selectedPeriod[0].id],payPeriod=Timetracker.reports.payrollReport.getPayperiod(payPeriodDtls),newPayPeriod=Timetracker.reports.payrollReport.getFromToForPayPeriod(-1,payPeriod),currentDate=Calendar.getCurrentDate();newPayPeriod.payrollReportClosure&&newPayPeriod.payrollReportClosure>currentDate&&(newPayPeriod=Timetracker.reports.payrollReport.getFromToForPayPeriod(-1,newPayPeriod));let fromDay=newPayPeriod.fromDay,toDay=newPayPeriod.toDay;"1"==newPayPeriod.pos&&"4"==newPayPeriod.conf.rsFrequency&&(fromDay=newPayPeriod.startSec,toDay=newPayPeriod.endSec);var msg=ZPI18N.getString("zp.tspayrollreport.payroll.regenerate.warning",[Calendar.formatDate(fromDay),Calendar.formatDate(toDay)]),extraDtls={header:ZPI18N.getString("zp.alert"),body:msg,btnVal:ZPI18N.getString("zp.confirm")};newPayPeriod.payPeriodId=selectedPeriod[0].id,Timetracker.Util.confirmpopUp(selectedPeriod[0].id,Timetracker.Reports.payrollReport.generatePayRolReport,newPayPeriod,1,extraDtls),Layout.Page.container.find("#zp_modal_confirmpop  #zp_modal_content").addClass("w500 zpl_mcenter")}},generatePayRolReport:function(data){let fromDate=data.fromDay,toDate=data.toDay;"1"==data.pos&&"4"==data.conf.rsFrequency&&(fromDate=data.startSec,toDate=data.endSec);var params={mode:"persistPayRollReport",payPeriod:data.payPeriodId,fromDate:Timetracker.DateTime.getDateinDBformat(fromDate,!0),toDate:Timetracker.DateTime.getDateinDBformat(toDate,!0),conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(respObj){1==respObj.res?Timetracker.util.showAlert(2,respObj.message):Timetracker.util.showAlert(0,respObj.message)},{},Timetracker.Util.generalFailureCallback)},getDateDtlsForPayPeriodNavigation:function(mode,isNext){var period,container=Layout.Page.container.find("#filterDiv").find('[name="datePeriodFilter"]'),selectedPeriod=ZPLite.Filters.getValues(container);if(selectedPeriod&&selectedPeriod.length>0&&void 0!==Timetracker.reports.payrollReport.dataPeriod[selectedPeriod[0].id]){var currentPayPeriod=container.data("currentPayPeriod"),newPayPeriod=Timetracker.reports.payrollReport.getFromToForPayPeriod(isNext?1:-1,currentPayPeriod);currentPayPeriod.start=newPayPeriod.fromDay,currentPayPeriod.end=newPayPeriod.toDay,currentPayPeriod.closure=newPayPeriod.closureDay,"4"==currentPayPeriod.conf.rsFrequency&&(currentPayPeriod.startSec=newPayPeriod.fromDaySec,currentPayPeriod.endSec=newPayPeriod.toDaySec,currentPayPeriod.closureSec=newPayPeriod.closureDaySec,currentPayPeriod.pos=newPayPeriod.pos);var fromDate=currentPayPeriod.start,toDate=currentPayPeriod.end;"1"==currentPayPeriod.pos&&"4"==currentPayPeriod.conf.rsFrequency&&(fromDate=currentPayPeriod.startSec,toDate=currentPayPeriod.endSec),period={from:fromDate,to:toDate},container.data("currentPayPeriod",currentPayPeriod)}return period},setDefaultFilterParams:function(){var filterDiv=Layout.Page.container.find("#filterDiv");if(filterDiv.find('[name="fromDateFilter"]').addClass("DNI"),filterDiv.find('[name="toDateFilter"]').addClass("DNI"),Object.keys(Timetracker.reports.payrollReport.dataPeriod).length>0){var defaultPayPeriodId=Object.keys(Timetracker.reports.payrollReport.dataPeriod)[0],defaultPayPeriodDtls=Timetracker.reports.payrollReport.dataPeriod[defaultPayPeriodId];ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:defaultPayPeriodId,text:defaultPayPeriodDtls.rsName,periodType:ZPLite.DateNavigator.TYPE.PAYPERIOD,tense:ZPLite.DateNavigator.TENSE.CURRENT}])}else ZPLite.Filters.setValues(filterDiv.find('[name="datePeriodFilter"]'),[{id:"1",text:ZPI18N.getString("zp.thisweek"),periodType:ZPLite.DateNavigator.TYPE.WEEKLY,tense:ZPLite.DateNavigator.TENSE.CURRENT}]);ZPLite.Filters.clearValues(filterDiv.find('[name="employeeFilter"]')),ZPLite.Filters.setValues(filterDiv.find('[name="employeeStatusFilter"]'),[{id:"19",text:ZPI18N.getString("zp.activeusers")},{id:"-2",text:ZPI18N.getString("zp.activeprofiles")},{id:"18",text:ZPI18N.getString("zp.exemployees")}]);let approValStatusDefVal=Timetracker.generalSettings.getTTPayRollApprovalFilterDefaultVal();ZPLite.Filters.setValues(filterDiv.find('[name="approvalStatusFilter"]'),[{id:approValStatusDefVal,text:ZPI18N.getString(["zp.all","zp.approved","zp.unapproved"][approValStatusDefVal]||"zp.approved")}]),filterDiv.find('[name="departmentFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="departmentFilter"]')),filterDiv.find('[name="locationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="locationFilter"]')),filterDiv.find('[name="orgTagFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="orgTagFilter"]')),filterDiv.find('[name="roleFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="roleFilter"]')),filterDiv.find('[name="designationFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="designationFilter"]')),filterDiv.find('[name="legalEntityFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="legalEntityFilter"]')),filterDiv.find('[name="businessUnitFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="businessUnitFilter"]')),filterDiv.find('[name="divisionFilter"]').is(":visible")&&ZPLite.Filters.clearValues(filterDiv.find('[name="divisionFilter"]')),filterDiv.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),filterDiv.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0),filterDiv.find('[name="showDirectReporteesFilter"]').removeClass("DNI"),filterDiv.find('[name="showDirectReporteesFilter"]').find("input").prop("checked",!1)},resetFilter:function(){Timetracker.Reports.payrollReport.setDefaultFilterParams()},applyFilter:function(){var container=Layout.Page.container.find("#filterDiv"),values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]')),errorFilters=container.find(".error-clr");if(errorFilters.length>0&&$.each(errorFilters,function(){$(this).removeClass("error-clr")}),Number(values[0].id)<=6&&Timetracker.generalSettings.isPayRollPayPeriodPersistenceEnabled()&&(Layout.Page.container.find("#regeneratepayrollpop").html(""),Layout.Page.container.find('[name="includeExEmployeesFilter"]').removeClass("disabled")),6===Number(values[0].id)){var errorMessage,fromDate=container.find('[name="fromDateFilter"]').data("selectedDate"),toDate=container.find('[name="toDateFilter"]').data("selectedDate");if(void 0===fromDate||""===fromDate)container.find('[name="fromDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptyfromdate");else if(void 0===toDate||""===toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.emptytodate");else{if(fromDate>toDate)container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.greaterfromdate");else ZPDateTime.getDateDiff(fromDate,toDate)>31&&(container.find('[name="toDateFilter"]').addClass("error-clr"),errorMessage=ZPI18N.getString("zp.datewithindays",[31]))}if(errorMessage)return void ZPeople.Message.showWarningMsg(errorMessage);ZPLite.DateNavigator.setPeriod(Timetracker.Reports.Constants.payrollReport,values[0].periodType,values[0].tense,!0,{from:fromDate,to:toDate})}else Number(values[0].id)<6?ZPLite.DateNavigator.setPeriod(Timetracker.Reports.Constants.payrollReport,values[0].periodType,values[0].tense):(Timetracker.Reports.payrollReport.setPayPeriod(values[0].id),Timetracker.generalSettings.isPayRollPayPeriodPersistenceEnabled()&&(isadmin&&Layout.Page.container.find("#regeneratepayrollpop").html('<button type="button" class="lt_btn primary" id="ZP-Regenerate" onclick="Timetracker.Reports.payrollReport.generateReportPopup()">'+ZPI18N.getString("zp.reports.regeneratereport")+"</button>"),Layout.Page.container.find('[name="includeExEmployeesFilter"]').addClass("disabled")));Timetracker.Reports.payrollReport.generateReport()},filterOnChangeCallback:function(data){var container=Layout.Page.container.find("#filterDiv");if("datePeriod"===data.entity){var values=ZPLite.Filters.getValues(container.find('[name="datePeriodFilter"]'));Timetracker.Reports.Filters.showHideFromToDateFilter(container,values,Timetracker.Reports.Constants.payrollReport),Timetracker.generalSettings.isPayRollPayPeriodPersistenceEnabled()&&(Number(values[0].id)<=6?Layout.Page.container.find('[name="includeExEmployeesFilter"]').removeClass("disabled"):Layout.Page.container.find('[name="includeExEmployeesFilter"]').addClass("disabled"))}else if("employeeStatus"===data.entity){values=ZPLite.Filters.getValues(container.find('[name="employeeStatusFilter"]'));-1===Timetracker.projects.Operations.findJSONArrayIndex(values,"18","id")?(container.find('[name="includeExEmployeesFilter"]').addClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!1)):container.find('[name="includeExEmployeesFilter"]').hasClass("DNI")&&(container.find('[name="includeExEmployeesFilter"]').removeClass("DNI"),container.find('[name="includeExEmployeesFilter"]').find("input").prop("checked",!0)),Timetracker.Reports.Filters.clearCache(!1,"employee");var filterDiv=container.find('[name="employeeFilter"]');ZPLite.Filters.clearOptions(filterDiv)}else{if("employee"===data.entity)0===(values=ZPLite.Filters.getValues(container.find('[name="employeeFilter"]'))).length&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?container.find('[name="showDirectReporteesFilter"]').removeClass("DNI"):container.find('[name="showDirectReporteesFilter"]').addClass("DNI"),Timetracker.Reports.Filters.clearCache(!1,"client"),filterDiv=container.find('[name="clientFilter"]');else"client"===data.entity?(Timetracker.Reports.Filters.clearCache(!1,"project"),filterDiv=container.find('[name="projectFilter"]')):"project"===data.entity&&(Timetracker.Reports.Filters.clearCache(!1,"job"),filterDiv=container.find('[name="jobFilter"]'));filterDiv&&(ZPLite.Filters.clearValues(filterDiv),ZPLite.Filters.clearOptions(filterDiv))}},getDefaultParams:function(fileType){var params={mode:"getUserReport",userErecNo:"0",clientId:"0",projectId:"0",jobId:"0",approvalStatus:Timetracker.generalSettings.getTTPayRollApprovalFilterDefaultVal(),departmentId:"0",locationId:"0",isTotalNeeded:!0,employeeStatus:"19,-2,18",isDirectSubOnlyNeeded:!1,employeeDateOfExitBased:!0,repType:Timetracker.Reports.Util.getReportTypeParam(),conreqcsr:csrfToken};if(fileType){if(params.mode="exportUserReport",params.fileType=fileType,"pdf"!==fileType){var exportContainer=Layout.Page.container.find("#tabZP5Export");exportContainer.length>0&&Timetracker.Filters.getParamsForEmpAddnFields(params,exportContainer)}delete params.conreqcsr}return params},getParamsForReport:function(fileType){var params=Timetracker.Reports.payrollReport.getDefaultParams(fileType),filterDiv=Layout.Page.container.find("#filterDiv");params.employeeDateOfExitBased=filterDiv.find('[name="includeExEmployeesFilter"]').find("input").is(":checked"),filterDiv.find('[name="showDirectReporteesFilter"]').is(":visible")&&(params.isDirectSubOnlyNeeded=filterDiv.find('[name="showDirectReporteesFilter"]').find("input").is(":checked"));var values=ZPLite.Filters.getValues(filterDiv.find('[name="employeeFilter"]'));if(values&&values.length>0){var userErecNo="";$.each(values,function(index,option){0!==index&&(userErecNo+=","),userErecNo+=option.id}),params.userErecNo=userErecNo}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="clientFilter"]')))&&values.length>0){var clientId="";$.each(values,function(index,option){0!==index&&(clientId+=","),clientId+=option.id}),params.clientId=clientId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="projectFilter"]')))&&values.length>0){var projectId="";$.each(values,function(index,option){0!==index&&(projectId+=","),projectId+=option.id}),params.projectId=projectId}if((values=ZPLite.Filters.getValues(filterDiv.find('[name="jobFilter"]')))&&values.length>0){var jobId="";$.each(values,function(index,option){0!==index&&(jobId+=","),jobId+=option.id}),params.jobId=jobId}(values=ZPLite.Filters.getValues(filterDiv.find('[name="approvalStatusFilter"]')))&&values.length>0&&(params.approvalStatus=values[0].id),Timetracker.Filters.getParamsForEmpReltFilters(params,filterDiv),(values=ZPLite.Filters.getValues(filterDiv.find('[name="datePeriodFilter"]')))&&"0"!==values[0].id&&"1"!==values[0].id&&"2"!==values[0].id&&"3"!==values[0].id&&"4"!==values[0].id&&"5"!==values[0].id&&"6"!==values[0].id&&(params.rsId=values[0].id);var datePeriod=ZPLite.DateNavigator.getPeriod(Timetracker.Reports.Constants.payrollReport);return void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(params.fromDate=Timetracker.DateTime.getDateinDBformat(datePeriod.from,!0),params.toDate=Timetracker.DateTime.getDateinDBformat(datePeriod.to,!0)):(params.fromDate=Timetracker.DateTime.getDateinDBformat(datePeriod.day,!0),params.toDate=Timetracker.DateTime.getDateinDBformat(datePeriod.day,!0))),fileType||(params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.payrollReport.Firescroll.mode),params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT),params},generateReport:function(){var layout=Layout.Page.container;ZPLite.Firescroll.reset(layout.find("#timetrackerPayrollReport"),Timetracker.Reports.payrollReport.Firescroll.mode),layout.find("#timetrackerPayrollReport").scrollTop(0),layout.find(".ZPNdata").remove(),layout.find("#timetrackerPayrollReport").before(ZPeople.LOADING_HTML),layout.find("#timetrackerPayrollReport").addClass("DN");var params=Timetracker.Reports.payrollReport.getParamsForReport();ZPeople.Request.send(Timetracker.constants.URL,params,function(response,params){if(layout.find(".ZPNdata").remove(),layout.find("[id=zp_page_loading]").fadeOut(200).remove(),params.rsId){layout.find("#adpExport").removeClass("DN"),layout.find("#supExport").removeClass("DN"),Timetracker.Reports.payrollReport.showXeroPushOption(params.rsId);var payPeriod=Timetracker.reports.payrollReport.dataPeriod[params.rsId];payPeriod&&(layout.find("#payPeriodName").removeClass("DN"),layout.find("#payPeriodName").html(payPeriod.rsName),layout.find("#payPeriodName").attr("title",ZPeople.decodeTxt(payPeriod.rsName)))}else layout.find("#supExport").addClass("DN"),layout.find("#adpExport").addClass("DN"),layout.find("#payPeriodName").addClass("DN"),Timetracker.generalSettings.isTTXeroEnabled()&&layout.find("#xeroPayroll").hide();if(!response||"permissionDenied"!==response.error&&response.errorCode!=Timetracker.constants.ERROR_CODES.NO_PERM_CODE)if(response&&response.length>0){layout.find("#timetrackerPayrollReport").removeClass("DN");var tableBody=layout.find("#timetrackerPayrollReportBody");tableBody.html(""),layout.find(".th_pay_ot,.th_pay_dot,.th_pay_leave,.th_pay_tot").addClass("DN"),$.each(response,function(index,data){tableBody.append(Timetracker.Reports.payrollReport.constructReportRowHtml(data,!1,!1))}),layout.find("#timetrackerPayrollReport").find(".th_pay_ot").hasClass("DN")?layout.find("#timetrackerPayrollReport").find(".td_pay_ot").addClass("DN"):layout.find("#timetrackerPayrollReport").find(".td_pay_ot").removeClass("DN"),layout.find("#timetrackerPayrollReport").find(".th_pay_dot").hasClass("DN")?layout.find("#timetrackerPayrollReport").find(".td_pay_dot").addClass("DN"):layout.find("#timetrackerPayrollReport").find(".td_pay_dot").removeClass("DN"),layout.find("#timetrackerPayrollReport").find(".th_pay_leave").hasClass("DN")?layout.find("#timetrackerPayrollReport").find(".td_pay_leave").addClass("DN"):layout.find("#timetrackerPayrollReport").find(".td_pay_leave").removeClass("DN"),layout.find("#timetrackerPayrollReport").find(".th_pay_tot").hasClass("DN")?layout.find("#timetrackerPayrollReport").find(".td_pay_tot").addClass("DN"):layout.find("#timetrackerPayrollReport").find(".td_pay_tot").removeClass("DN"),ZPLite.Firescroll.init(layout.find("#timetrackerPayrollReport"),Timetracker.Reports.payrollReport.Firescroll.mode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.payrollReport.Firescroll.loadMoreData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.payrollReport.Firescroll.mode,response.length)}else layout.find("#timetrackerPayrollReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.noreportsyet")));else layout.find("#timetrackerPayrollReport").before(ZPUtil.newNoDataHTML("CR-nodata-rpt","path6",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"))),layout.find(".lt_nav").addClass("DN")})},constructReportRowHtml:function(data,isDateBased,isfromLoadMoreData){var html="";if(isDateBased)html+='<tr class="ZPLRow">',html+="<td>"+data.workdate+"</td>";else{var userErecNo=data.userErecNo,empId=data.employeeId,empPhoto=data.employeePhoto,empDispName=data.employeeDisplayName;if(Layout.Page.container.find("#zp_tt_payroll_"+userErecNo).length>0)return;if(html+='<tr id="zp_tt_payroll_'+userErecNo+'" class="ZPLRow ZPLNRow CP"',data.hasTimelogs&&!0===data.hasTimelogs)html+="onclick=\"Timetracker.Reports.payrollReport.constructDateBasedReport(this, '"+userErecNo+"', '"+empPhoto+"');\"";else{var msg=ZPI18N.getString("zp.tsbudgetnotimelogs");html+='onclick="Timetracker.util.showAlert('+Timetracker.constants.RESPONSE_CODES.WARNING+", '"+msg+"')\""}html+=">",html+='<td class="colM1_sticky"><img class="FL" src="'+empPhoto+'"><div class="ZPusrName"><span class="ellipsis W150" title="'+empDispName+'"><b>'+empId+"</b> "+empDispName+"</span>",data.empDateOfExit&&(html+='<em class="ZPsecName">( '+ZPI18N.getString("zp.exitdate")+"-"+data.empDateOfExit+")</em>"),html+="<div></td>"}var total_amt=0,rate=0,ot_singlepayrate=data.otRatePerHour?data.otRatePerHour:0,ot_doublepayrate=data.extendedOtRatePerHour?data.extendedOtRatePerHour:0,billableHours=void 0!==data.regularHours?data.regularHours:0;if(data.ratePerHour&&(rate=data.ratePerHour,total_amt=data.ratePerHour*(billableHours/60)),isDateBased?(html+="<td>"+Calendar.minstohrs(billableHours)+"</td>",void 0!==data.overtimeHours?(html+='<td class="td_pay_otdetailed DN">'+Calendar.minstohrs(data.overtimeHours)+"</td>",Layout.Page.container.find("#ot_payroll").removeClass("DN")):html+='<td class="td_pay_otdetailed DN">'+Calendar.minstohrs(0)+"</td>",void 0!==data.extendedOvertimeHours?(html+='<td class="td_pay_dotdetailed">'+Calendar.minstohrs(data.extendedOvertimeHours)+"</td>",Layout.Page.container.find("#dot_payroll").removeClass("DN")):html+='<td class="td_pay_dotdetailed DN">'+Calendar.minstohrs(0)+"</td>"):html+='<td class="P0I TBrdr"><table class="table i_table"><tr><td class="text-center" width="33%"><div class="W80"><span>'+Calendar.minstohrs(billableHours)+'</span></div></td><td class="text-center" width="33%"><div class="W90"><span>'+rate+'</span></div></td><td class="text-center" width="33%"><div class="W80"><span>'+total_amt.toFixed(2)+'</span></div></td></tr></table></td><td class="td_pay_ot P0I TBrdr DN"><table class="table i_table"><tr><td class="text-center" width="33%"><div class="W80"><span>$OT_SINGLE_HRS$</span></div></td><td class="text-center" width="33%"><div class="W90"><span>$OT_SINGLE_RATE$</span></div></td><td class="text-center" width="33%"><div class="W80"><span>$OT_SINGLE_AMT$</span></div></td></tr></table></td><td class="td_pay_dot P0I TBrdr DN"><table class="table i_table"><tr><td class="text-center" width="33%"><div class="W80"><span>$OT_DOUBLE_HRS$</span></div></td><td class="text-center" width="33%"><div class="W90"><span>$OT_DOUBLE_RATE$</span></div></td><td class="text-center" width="33%"><div class="W80"><span>$OT_DOUBLE_AMT$</span></div></td></tr></table></td><td class="td_pay_leave P0I TBrdr DN"><table class="table i_table"><tr><td class="text-center" width="33%"><div class="W80"><span>$LEAVE_HRS$</span></div></td><td class="text-center" width="33%"><div class="W90"><span>$LEAVE_RATE$</span></div></td><td class="text-center" width="33%"><div class="W80"><span>$LEAVE_AMT$</span></div></td></tr></table></td><td class="td_pay_tot P0I TBrdr text-center DN"><div class="W120"><span>$TOTAL$</span></div></td>',!isDateBased){if(void 0!==data.totalOvertimeHours||void 0!==data.weekendOvertimeHours||void 0!==data.holidayOvertimeHours){void 0===data.overtimeHours&&void 0===data.weekendOvertimeHours&&void 0===data.holidayOvertimeHours||Layout.Page.container.find(".th_pay_ot,.th_pay_tot").removeClass("DN");var wknd_holOT=0;if(void 0!==data.weekendOvertimeHours&&(wknd_holOT+=data.weekendOvertimeHours),void 0!==data.holidayOvertimeHours&&(wknd_holOT+=data.holidayOvertimeHours),void 0!==data.overtimeHours||void 0!==data.weekendOvertimeHours||void 0!==data.holidayOvertimeHours){var singleothrs=0;void 0!==data.overtimeHours&&(singleothrs=data.overtimeHours),html=html.replace("$OT_SINGLE_HRS$",Calendar.minstohrs(singleothrs+wknd_holOT))}html=html.replace("$OT_SINGLE_RATE$",ot_singlepayrate);var ot_single_amt=0;if(ot_single_amt=void 0!==data.overtimeHours?ot_singlepayrate*(wknd_holOT+data.overtimeHours)/60:ot_singlepayrate*wknd_holOT/60,html=html.replace("$OT_SINGLE_AMT$",ot_single_amt.toFixed(2)),total_amt+=ot_single_amt,void 0!==data.extendedOvertimeHours){Layout.Page.container.find(".th_pay_dot,.th_pay_tot").removeClass("DN"),html=(html=html.replace("$OT_DOUBLE_HRS$",Calendar.minstohrs(data.extendedOvertimeHours))).replace("$OT_DOUBLE_RATE$",ot_doublepayrate);var ot_double_amt=ot_doublepayrate*data.extendedOvertimeHours/60;html=html.replace("$OT_DOUBLE_AMT$",ot_double_amt.toFixed(2)),total_amt+=ot_double_amt}else html=(html=(html=html.replace("$OT_DOUBLE_HRS$",Calendar.minstohrs(0))).replace("$OT_DOUBLE_RATE$",0)).replace("$OT_DOUBLE_AMT$",(0).toFixed(2))}if(void 0!==data.paidLeaveHours){Layout.Page.container.find(".th_pay_leave,.th_pay_tot").removeClass("DN");var paidLeaveHrs=data.paidLeaveHours,paidLeaveAmt=paidLeaveHrs*rate/60;total_amt+=paidLeaveAmt,html=(html=(html=html.replace("$LEAVE_HRS$",Calendar.minstohrs(paidLeaveHrs))).replace("$LEAVE_RATE$",rate)).replace("$LEAVE_AMT$",paidLeaveAmt.toFixed(2))}html=(html=(html=(html=(html=(html=(html=(html=(html=(html=html.replace("$OT_SINGLE_HRS$",Calendar.minstohrs(0))).replace("$OT_SINGLE_RATE$",0)).replace("$OT_SINGLE_AMT$",(0).toFixed(2))).replace("$OT_DOUBLE_HRS$",Calendar.minstohrs(0))).replace("$OT_DOUBLE_RATE$",0)).replace("$OT_DOUBLE_AMT$",(0).toFixed(2))).replace("$LEAVE_HRS$",Calendar.minstohrs(0))).replace("$LEAVE_RATE$",0)).replace("$LEAVE_AMT$",(0).toFixed(2))).replace("$TOTAL$",total_amt.toFixed(2))}html+="</tr>";var domElement=$(html);return domElement.data("payrollempData",data),domElement},constructDateBasedReport:function(tr,erecNo,photo){var container=Layout.Page.container,empName=$(tr).data("payrollempData").employeeDisplayName,actualParam=Timetracker.Reports.payrollReport.getParamsForReport(),params=JSON.parse(JSON.stringify(actualParam));params.userErecNo=erecNo,params.sIndex=0,delete params.isTotalNeeded,params.payrollDrillDown=!0,$.post(Timetracker.constants.URL,params,function(resultData){if(0===container.find("#payrollDrillDown").length){var txt=$('<div id="payrollDrillDown" class="modal popRgtModel PopMdxModel" aria-hidden="false"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h6 class="addPopTitle"></h6><div class="FR MR25 MT5"><span class="FL PR dropdown ZPcusPos1 ZPCusDrs MR10"><i class="IC-more  S18 gry CP" data-toggle="dropdown" aria-expanded="false" title="'+ZPI18N.getString("zp.more")+'"></i><ul class="dropdown-menu ZPCmn-Arrow top gray"><li id="payroll_report_export_icon"><a><span class="IC-exprt DIB gry MR5"></span>'+ZPI18N.getString("zp.export")+'</a></li><li id="payroll_report_pdf_icon"><a><span class="IC-xls DIB gry MR5"></span>'+ZPI18N.getString("zp.downloadpdf")+'</a></li><li id="payroll_report_print_icon"><a><span class="IC-print DIB gry MR5"></span>'+ZPI18N.getString("zp.print")+'</a></li></ul></span><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div></div><div id="drilledreportprint" class="modal-body PT0I"><div class="table-responsive tabcont DN" id="drilleduserreportlist" scroll="enabled"><table class="table table-hover"><thead id="drilledureporthead"><tr class="ZPLHRow"><th width="175">'+ZPI18N.getString("zp.date")+"</th><th>"+ZPI18N.getString("zp.tt.overtimepolicies.regularhours")+'</th><th id="ot_payroll" class="DN">'+ZPI18N.getString("zp.tt.timelogsettings.covertimehours")+'</th><th id="dot_payroll" class="DN">'+ZPI18N.getString("zp.tt.overtimepolicies.doubletimehours")+'</th></tr></thead><tbody id="drilledureportbody"></tbody></table></div></div><div class="modal-footer text-left"><button data-dismiss="modal" class="btn btn-default" type="button">'+ZPI18N.getString("zp.close")+"</button></div></div></div></div>");container.append(txt)}else ZPLite.Firescroll.reset(container.find("#drilleduserreportlist"),Timetracker.Reports.payrollReport.Firescroll.dateBasedReportMode);ZPLite.Firescroll.init(container.find("#drilleduserreportlist"),Timetracker.Reports.payrollReport.Firescroll.dateBasedReportMode,{maxFetchLimit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,callback:Timetracker.Reports.payrollReport.Firescroll.loadMoreDateBasedData,extraDtls:{params:params}}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.payrollReport.Firescroll.dateBasedReportMode,resultData.length),container.find("#payrollDrillDown").data("#selectedUser",erecNo),container.find("#payrollDrillDown").find("#payroll_report_export_icon").off("click").on("click",function(){Timetracker.ImportExport.showExportOptions(Timetracker.Reports.payrollReport.exportReport,"DateBasedPayrollReport")}),container.find("#payrollDrillDown").find("#payroll_report_pdf_icon").off("click").on("click",function(){Timetracker.Reports.payrollReport.exportReport(null,null,Timetracker.constants.DOWNLOAD_TYPES.PDF,"DateBasedPayrollReport")});var fromDate=Calendar.formatDate(Calendar.parseDate(params.fromDate,Calendar.DB_DATEFORMAT)),toDate=Calendar.formatDate(Calendar.parseDate(params.toDate,Calendar.DB_DATEFORMAT));container.find("#payrollDrillDown").find("#payroll_report_print_icon").off("click").on("click",function(){Timetracker.Print.printPage({divId:"drilledreportprint",isReports:!0,isUserNeeded:!0,date:fromDate+" "+ZPI18N.getString("zp.sto")+" "+toDate})}),container.find("#payrollDrillDown").find(".addPopTitle").html('<span class="FL">'+ZPI18N.getString("zp.datebasedreport",[""])+'</span><div class="FL ML3 ZP-UserProfAct ZP-UserProfPop" title="'+empName+" ("+fromDate+" "+ZPI18N.getString("zp.to")+" "+toDate+')"><img class="Usrimg ML5" src="'+photo+'"><span class="ML5">'+empName+" ("+fromDate+" "+ZPI18N.getString("zp.to")+" "+toDate+")</span>"),0==resultData.length?(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6",id:"drilledreportprint"}),container.find("#drilleduserreportlist").hide()):(container.find("#drilledureportbody").html(""),Layout.Page.container.find("#dot_payroll,#ot_payroll").addClass("DN"),$.each(resultData,function(index,data){container.find("#drilledureportbody").append(Timetracker.Reports.payrollReport.constructReportRowHtml(data,!0,!1))}),container.find("#ot_payroll").hasClass("DN")?container.find(".td_pay_otdetailed").addClass("DN"):container.find(".td_pay_otdetailed").removeClass("DN"),container.find("#dot_payroll").hasClass("DN")?container.find(".td_pay_dotdetailed").addClass("DN"):container.find(".td_pay_dotdetailed").removeClass("DN"),container.find("#zp_empty_data").hide(),container.find("#drilleduserreportlist").show(),container.find("#drilleduserreportlist").scrollTop(0)),container.find("#payrollDrillDown").off("hide.bs.modal").on("hide.bs.modal",function(e){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.payrollReport.Firescroll.dateBasedReportMode,!1),Layout.Page.container.find("#drilleduserreportlist").scrollTop(0)}),container.find("#payrollDrillDown").modal("show")})},Firescroll:{mode:"TT_PAYROLL_REPORT_FIRESCROLL",dateBasedReportMode:"TT_DATE_BASED_PAYROLL_REPORT_FIRESCROLL",loadMoreData:function(extraDtls){var params=extraDtls.params;params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.payrollReport.Firescroll.mode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response&&response.length>0){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.payrollReport.Firescroll.mode,!1);var container=Layout.Page.container.find("#timetrackerPayrollReport"),tableBody=container.find("#timetrackerPayrollReportBody");$.each(response,function(index,data){tableBody.append(Timetracker.Reports.payrollReport.constructReportRowHtml(data,!1,!0))}),container.find(".th_pay_ot").hasClass("DN")?container.find(".td_pay_ot").addClass("DN"):container.find(".td_pay_ot").removeClass("DN"),container.find(".th_pay_dot").hasClass("DN")?container.find(".td_pay_dot").addClass("DN"):container.find(".td_pay_dot").removeClass("DN"),container.find(".th_pay_leave").hasClass("DN")?container.find(".td_pay_leave").addClass("DN"):container.find(".td_pay_leave").removeClass("DN"),container.find(".th_pay_tot").hasClass("DN")?container.find(".td_pay_tot").addClass("DN"):container.find(".td_pay_tot").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.payrollReport.Firescroll.mode,response.length)}else ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.payrollReport.Firescroll.mode,0)})},loadMoreDateBasedData:function(extraDtls){var params=extraDtls.params;params.sIndex=ZPLite.Firescroll.getStartIndex(Timetracker.Reports.payrollReport.Firescroll.dateBasedReportMode),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response&&response.length>0){ZPLite.Firescroll.setActiveStatus(Timetracker.Reports.payrollReport.Firescroll.dateBasedReportMode,!1);var tableBody=Layout.Page.container.find("#payrollDrillDown").find("#drilledureportbody");$.each(response,function(index,data){tableBody.append(Timetracker.Reports.payrollReport.constructReportRowHtml(data,!0,!0))}),ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.payrollReport.Firescroll.dateBasedReportMode,response.length)}else ZPLite.Firescroll.setFetchedCount(Timetracker.Reports.payrollReport.Firescroll.dateBasedReportMode,0)})}},showExport:function(currentObj){$(currentObj).hasClass("open")?$(currentObj).removeClass("open"):(Timetracker.Reports.Util.getCommonData(),$(currentObj).addClass("open"))},exportReport:function(container,params,fileType,mode){var requestUrl="timesheetDispAction.zp?";params=Timetracker.Reports.payrollReport.getParamsForReport(fileType);"DateBasedPayrollReport"===mode&&(params.userErecNo=Layout.Page.container.find("#payrollDrillDown").data("#selectedUser"),delete params.isTotalNeeded,params.payrollDrillDown=!0),$.each(params,function(key,value){requestUrl+=key+"="+value+"&"}),requestUrl=requestUrl.substring(0,requestUrl.length-1),Timetracker.ImportExport.submiteFormForExport(requestUrl)},pushToXero:function(){if(isadmin){var params=Timetracker.Reports.payrollReport.getParamsForReport();if(params.rsId){var payPeriod=Timetracker.reports.payrollReport.dataPeriod[params.rsId];if(payPeriod)payPeriod.rsName;var infoPopUp=new InfoAlertMessage;infoPopUp.title=ZPI18N.getString("zp.xeroTimeSheetConheader");const date=new Date(params.fromDate);var fromdate=Timetracker.Reports.payrollReport.formatDate(date);const date1=new Date(params.toDate);var toDate=Timetracker.Reports.payrollReport.formatDate(date1);infoPopUp.despcription=ZPI18N.getString("zp.xeroTimeSheetConbody",[new Array(fromdate),new Array(toDate)]),infoPopUp.yesButtonText=ZPI18N.getString("zp.confirm"),infoPopUp.cancelButtonText=ZPI18N.getString("zp.cancel"),infoPopUp.callback=function(){var payPeriodId=params.rsId,fromDate=params.fromDate,toDate=params.toDate;ZPeople.Request.send("/integrations/payroll/pushTimeSheetDataToPayroll",{payPeriodID:payPeriodId,fromDate:fromDate,toDate:toDate,serviceName:"Xero"},function(result){ZAlertBanner.show({message:ZPI18N.getString("zp.timeSheetSyncMsg"),type:"success",hideDelay:5e3,closeButton:!0,icon:!0})})},infoPopUp.show()}else ZAlertBanner.show({message:ZPI18N.getString("zp.xerotimesheethaveSomeFilter"),type:"error",hideDelay:5e3,closeButton:!0,icon:!0})}else Timetracker.util.showAlert(0,ZPI18N.getString("zp.permdenied"))},formatDate:function(date){return`${String(date.getDate()).padStart(2,"0")}-${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][date.getMonth()]}-${date.getFullYear()}`},printReport:function(){var name,params=Timetracker.Reports.payrollReport.getParamsForReport();if(params.rsId){var payPeriod=Timetracker.reports.payrollReport.dataPeriod[params.rsId];payPeriod&&(name=payPeriod.rsName)}Timetracker.util.printReport("timetrackerPayrollReport",!1,"0",Layout.Page.container.find("#dateNavigatorText").text(),name,!0)},showXeroPushOption:async function(payPeriodId){if(Timetracker.generalSettings.isTTXeroEnabled()&&payPeriodId){let xeroMappedPayPeriodIds=Timetracker.Reports.payrollReport.xeroMappedPayPeriodId;void 0!==xeroMappedPayPeriodIds&&null!==xeroMappedPayPeriodIds||(await Timetracker.Reports.payrollReport.setAndFethXeroMappedIds(),xeroMappedPayPeriodIds=Timetracker.Reports.payrollReport.xeroMappedPayPeriodId),xeroMappedPayPeriodIds&&xeroMappedPayPeriodIds.includes(payPeriodId)?Layout.Page.container.find("#xeroPayroll").show():Layout.Page.container.find("#xeroPayroll").hide()}},setAndFethXeroMappedIds:async function(){let xeroMappedPayPeriodIds=Timetracker.Reports.payrollReport.xeroMappedPayPeriodIds;if(void 0===xeroMappedPayPeriodIds||null===xeroMappedPayPeriodIds){let details=await Timetracker.Request.sendRequestAsPromise("/integrations/payroll/getPaycycleList",{});Timetracker.Reports.payrollReport.xeroMappedPayPeriodId=details&&details[0]&&details[0].data||[]}}}},Timetracker.Break={breakDetails:null,userBreaks:null,scrollBreakIndex:0,TYPE_STATUS:{0:"zp.leavetype.paid",1:"zp.leavetype.unpaid"},ICON_CLASS:{1:"PI_brktime",2:"PI_brk",3:"PI_lunch",4:"PI_jobs",5:"PI_holiday",6:"PI_sleep",7:"PI_play1",8:"PI_emrg"},Mode:{GETBREAK:"getbreaks"},init:function(){Attendance.timeFormatIs12hr="hh:mm a"===timeFormat;var cont=Layout.Page.container;cont.find("[data-toggle=tooltip]").tooltip({trigger:"click"});var filterparam=Timetracker.Filters.getParamsForFilter("TTBreak");Timetracker.Location.constructLocationFilter("breakLocTT",filterparam),Timetracker.Break.consBreakPage(),cont.find("#ZPAtt_breakTime").timepicker({defaultTime:"",showMeridian:!1,disableMousewheel:!0,minuteStep:1}).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>600&&$(this).timepicker("setTime","10:00")}),Attendance.Break.convertToTimepicker(cont.find(".ZPAtt_breakFromTime")),Attendance.Break.convertToTimepicker(cont.find(".ZPAtt_breakToTime")),cont.find("#ZPAtt_sNewPopupRecSave").unbind("click").bind("click",function(){Attendance.Break.addShiftBreak(cont.find("#ZPAtt_shiftBreakConfAddPopup").attr("breakId"))}),cont.find("#ZPAtt_shiftBreakConfAddPopup [removeerr='true']").unbind("focus").bind("focus",function(){Attendance.Break.hideAllBreakErrTexts()}),cont.find("#ZPAtt_breakAppLocations").unbind("change").bind("change",function(){Attendance.Break.hideAllBreakErrTexts()}),$("#ZPAtt_isBreakSystemCalc").find("label"),$(cont.find("#ZPAtt_isBreakSystemCalc").find("label")[0]).attr("data-original-title",ZPI18N.getString("zp.allowsystembreaktooltip")),cont.popover({selector:"[data-popover].popHover",trigger:"click hover",delay:{show:50,hide:50}})},consBreakPage:function(){Layout.Page.container.find("#ZPTT_Break_filter").hasClass("ZPFilsel")&&Attendance.Break.toggleBreakFilter(),Timetracker.Break.breakDetails||Attendance.Break.getBreakDetails()},updateBreakParams:function(reqParams){reqParams.mode="getBreaks"},onBreakScroll:function(){if(Timetracker.Break.breakDetails.breakList.breakDetailsArr.length%20==0){var scrollObj={isScroll:!0};Timetracker.Break.scrollBreakIndex+=20,Attendance.Break.getBreakDetails(scrollObj)}},displayBreakErrorMessages:function(rdata){var cont=Layout.Page.container;if(rdata.hasOwnProperty("errors")){var errObj=rdata.errors,errCode=void 0!==errObj.errorCode?errObj.errorCode:null,errMsg=void 0!==errObj.errorMsg?errObj.errorMsg:ZPI18N.getString("zp.ttfailuremsg");switch(errCode){case"breakNameEmpty":cont.find("#breakNameErr").show();break;case"breakTimeInValid":cont.find("#breakTimeErr").show();break;case"applicableLocationsEmpty":cont.find("#breakAppLocErr").show();break;case"restTimeError":case"intervalsBreakTimeMismatch":case"intervalsBreakTimeExceeded":case"invalid From and To":case"breakTimeCantBeMoreThan10Hr":$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(errMsg).show();break;case"manualBreakLimitExceeded":case"autoBreakLimitExceeded":case Timetracker.constants.ERROR_CODES.TAB_DISABLED:case Timetracker.constants.ERROR_CODES.NO_PERM_CODE:Timetracker.util.showAlert(0,errMsg);break;case"breakOverlapsBreak":case"sameBreakOverlapped":var ftime=errObj.fromTime,ttime=errObj.toTime;Attendance.Break.iterateAndShowError("breakOverlapsBreak",ftime,ttime),$(cont.find("#ZPAtt_breakFromTimeErr1")[0]).html(errMsg).show();break;default:Timetracker.util.showAlert(0,errMsg)}}else Timetracker.util.showAlert(0,errMsg)},isTTBreakPage:function(){return-1!==Layout.Page.pageId.indexOf("timetracker-settings-break")},getBreakImageClass:function(breakInfo){return breakInfo&&breakInfo.breakImageCode?Timetracker.Break.ICON_CLASS[breakInfo.breakImageCode]:"PI_brktime"}},Timetracker.BreakTimelogs={isBreakLog:function(mode,obj){return void 0!==mode&&"DATA"===mode?void 0!==obj&&obj.hasOwnProperty("isBreakLog")&&obj.isBreakLog:Timetracker.BreakTimelogs.Forms.isFromBreakLog},isBreakTimerRunning:function(timelogId,user){var isRunning=null!==Timetracker.timelogs.currentTimerJobData&&Timetracker.BreakTimelogs.isBreakLog("DATA",Timetracker.timelogs.currentTimerJobData);return Timetracker.Validations.isDefiniteValue(timelogId)?isRunning&&timelogId==Timetracker.timelogs.currentTimerJobData.timelogId:Timetracker.Validations.isDefiniteValue(user)?isRunning&&user==Timetracker.timelogs.currentTimerJobData.erecno:isRunning},skipAnotherTimerRunningValidation:function(mode,data){var isBreakLog=Timetracker.BreakTimelogs.isBreakLog(mode,data),isBreakTimerRunning=Timetracker.BreakTimelogs.isBreakTimerRunning();return isBreakTimerRunning&&!isBreakLog||isBreakLog&&!isBreakTimerRunning},List:{showHideBreakButton:function(user){Layout.Page.container.find("#breakStartButton,#breakStopButton").addClass("zpl_DNI"),Timetracker.generalSettings.isBreakConfigured(user)&&(Timetracker.Page.isSelectedUser(Timetracker.Page.getPageMode())&&"true"!==Timetracker.generalSettings.getTSSettings(user).TS_fromToTimeLog||Timetracker.BreakTimelogs.List.isBreakIconEnabledForUser(user)&&(Timetracker.BreakTimelogs.isBreakTimerRunning(null,user)?Layout.Page.container.find("#breakStopButton").removeClass("zpl_DNI"):Layout.Page.container.find("#breakStartButton").removeClass("zpl_DNI")))},setValuesInBreakButton:function(mode){if("SET"===mode){Layout.Page.container.find("#breakStartButton").addClass("zpl_DNI"),Layout.Page.container.find("#breakPopup").addClass("zpl_DNI"),Layout.Page.container.find("#breakStopButton").removeClass("zpl_DNI");var layout=Layout.Page.container.find("#breakStopButton");layout.attr("title",ZPI18N.getString("zp.stopbreaktimer")),layout.attr("timesheetId",Timetracker.timelogs.currentTimerJobData.timelogId),layout.attr("jobId",Timetracker.timelogs.currentTimerJobData.jobId),layout.attr("timeId",Timetracker.timelogs.timeid),Timetracker.BreakTimelogs.List.updateImageInBreakButton(Timetracker.timelogs.currentTimerJobData.breakInfo),layout.off("click").on("click",function(){Timetracker.BreakTimelogs.List.pauseBreakTimer(this)})}else"RESET"===mode&&(Layout.Page.container.find("#breakStopButton").addClass("zpl_DNI"),Layout.Page.container.find("#breakStartButton").removeClass("zpl_DNI"),Layout.Page.container.find("#breakPopup").remove());Timetracker.BreakTimelogs.List.showHideBreakButton(Timetracker.timelogs.tserecno)},pauseBreakTimer:function(obj){var timerButton=Layout.Page.container.find("#breakStopButton");$(timerButton).attr("onclick","").unbind("click").off("click"),Timetracker.util.getTTLocation(Timetracker.timelogs.timer.pauseclockCallback,obj)},updateImageInBreakButton:function(breakInfo){var imgContainer=Layout.Page.container.find("#breakStopButton").find("#brkRunImg");$(imgContainer).removeClass(),$(imgContainer).addClass(Timetracker.Break.getBreakImageClass(breakInfo))},isBreakIconEnabledForUser:function(erecno){var breakRow=Timetracker.BreakTimelogs.List.getUsrBreakRows(erecno);return!!breakRow&&breakRow.length>0},showHideBreakLogTimer:function(id,type){var brkpopupRow=Layout.Page.container.find("#breakPopup").find("#breakRow_"+id);Timetracker.util.removeErrorMsg(void 0,brkpopupRow,!0),"1"==type?(Timetracker.BreakTimelogs.List.setDefaultTime(brkpopupRow),brkpopupRow.find("#startBrkTimerBtn_"+id).addClass("zpl_DNI"),brkpopupRow.find("#saveBrkBtn_"+id).removeClass("zpl_DNI"),brkpopupRow.find("#breakFromTime_"+id).parent().parent().removeClass("zpl_DNI")):"2"==type&&(brkpopupRow.find("#breakFromTime_"+id).parent().parent().addClass("zpl_DNI"),brkpopupRow.find("#saveBrkBtn_"+id).addClass("zpl_DNI"),brkpopupRow.find("#startBrkTimerBtn_"+id).removeClass("zpl_DNI"))},showAddBreakPopup:function(obj){if(Timetracker.generalSettings.isBreakEnabled()){if(0===Layout.Page.container.find("#breakPopup").length){var popup='<div id="breakPopup" class="zpl_popovr" style="display:none"><div class="zpl_breakpop '+(Timetracker.isTTSthiftEnabled()?"zpl_w520":"")+'"><h5>'+ZPI18N.getString("zp.breaks")+"</h5>";popup=popup+Timetracker.BreakTimelogs.List.constructBreakPopupRows(Timetracker.BreakTimelogs.List.getUsrBreakRows(Timetracker.timelogs.tserecno),Timetracker.timelogs.tserecno)+"</div></div>",Layout.Page.container.find("#breakStartButton").parent().append(popup);var fromToTimeEnabled="true"===Timetracker.generalSettings.getTSSettings(Timetracker.timelogs.tserecno).TS_fromToTimeLog,timerEnabled="true"===Timetracker.generalSettings.getTSSettings(Timetracker.timelogs.tserecno).TS_automaticLog,brkPopup=Layout.Page.container.find("#breakPopup");fromToTimeEnabled?brkPopup.find("[id^=breakStartEnd_]").prop("checked",!0):(brkPopup.find("[id^=breakStartEnd_],[id^=breakFromTime_]").parent().addClass("zpl_DNI"),brkPopup.find("[id^=saveBrkBtn_").addClass("zpl_DNI"),timerEnabled&&(brkPopup.find("[id^=startBrkTimerBtn_").removeClass("zpl_DNI"),brkPopup.find("[id^=breakTimer_]").prop("checked",!0))),timerEnabled&&Timetracker.timelogs.tserecno==erecno||(brkPopup.find("[id^=breakTimer_]").parent().addClass("zpl_DNI"),brkPopup.find("[id^=startBrkTimerBtn_").addClass("zpl_DNI")),ZPeopleComponents.popover(brkPopup,{displayType:"box",closeOnBodyClick:!0,forElement:Layout.Page.container.find("#breakStartButton")});var showHideCallback=function(isHidden){isHidden?Layout.Page.container.find("#timelogs_list_view").find(".zpl_btnmnu").removeClass("zpl_onbrkopn"):Layout.Page.container.find("#timelogs_list_view").find(".zpl_btnmnu").addClass("zpl_onbrkopn")};brkPopup.on("zpopoverbeforeclose",function(){showHideCallback(!0)}),brkPopup.on("zpopoverbeforeopen",function(){showHideCallback(!1)})}Timetracker.BreakTimelogs.List.showHideBreakPopup()}},constructBreakPopupRows:function(breaks,user){var breakRows="",pageModeCode=Timetracker.Page.getPageModeCode();return $.each(breaks,function(ind,val){var id=val.jobId,breakRow='<div id="breakRow_'+id+'" jobId="'+id+'" class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_breakrow d-flexC"><div id="breakName_'+id+'" class="d-flexC flexclmcap"><span class="'+Timetracker.Break.getBreakImageClass(val)+' icn lv_bgclr2"></span> <b>'+val.jobName+'</b> </div><div class="MLauto"> <span class="org">'+(1==val.breakPayType?ZPI18N.getString("zp.leavetype.paid"):ZPI18N.getString("zp.leavetype.unpaid"))+'</span> </div></div><div class="zpl_breakrow d-flexC"><div><div class="zradiobutton zradiobutton--horizontal"><input id="breakStartEnd_'+pageModeCode+id+'" type="radio" name="breakType_'+id+'" class="zradiobutton__helper" onclick="Timetracker.BreakTimelogs.List.showHideBreakLogTimer(\''+id+"','1');\"><label for=\"breakStartEnd_"+pageModeCode+id+'" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.startandend")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="breakTimer_'+pageModeCode+id+'" type="radio" name="breakType_'+id+'" class="zradiobutton__helper" onclick="Timetracker.BreakTimelogs.List.showHideBreakLogTimer(\''+id+"','2');\"><label for=\"breakTimer_"+pageModeCode+id+'" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.timer")+'</span></label></div></div></div><div class="zpl_breakrow flex-dirC"><div class="flexclmcap d-flexC"><input id="breakFromTime_'+id+'" type="text" class="ztextbox w100" value="00:00"><em>-</em><input id="breakToTime_'+id+'" type="text" class="ztextbox w100" value="00:00"></div></div>'+(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)?'<div class="zpl_breakrow flex-dirC"><textarea id="breakDesc_'+id+'" class="ztextbox" placeholder="'+ZPI18N.getString("zp.workitemplaceholder",[Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC)])+'"></textarea></div>':"")+'<div class="zpl_breakrow d-flexC"><div class="flexclmcap d-flexC"><div id="startBrkTimerBtn_'+id+'"  class="zpl_lnkbg MLauto"zpl_DNI" jobid="'+id+'" type="2" name="breakTimer" onclick="Timetracker.BreakTimelogs.List.startBreak(this);"> <i class="PI_fil_play grn"></i>'+ZPI18N.getString("zp.start")+'</div> <div id="saveBrkBtn_'+id+'" type="1" class="zpl_lnkbg MLauto" jobid="'+id+'" name="breakTimer" onclick="Timetracker.BreakTimelogs.List.startBreak(this);">'+ZPI18N.getString("zp.save")+'</div></div></div><div class="zpl_breakrow d-flexC grybg"><div class="d-flexclmcap10"><em>'+ZPI18N.getString("zp.allow")+"</em><b>"+Calendar.minstohrs(val.breakTimeInMins)+" "+ZPI18N.getString("zp.leavetype.hrs")+"</b></div></div>";if(val.additionalConf&&""!=val.additionalConf.trim()){var addConf=JSON.parse(val.additionalConf),breakTimings=Timetracker.Validations.isDefiniteValue(addConf)?JSON.parse(addConf.breakTimings):[];Timetracker.Break.userBreaks[user][ind].breakTimings=breakTimings,breakTimings.length>0&&(breakRow+='<div class="zpl_breakrow zpl_info"><b>'+ZPI18N.getString("zp.allowedtiming")+"</b>",$.each(breakTimings,function(ind,timeRange){breakRow+=ind%2==0?'<div class="d-flexclmcap10 M0I"><em>'+Calendar.minstotime(timeRange.fromTime)+"-"+Calendar.minstotime(timeRange.toTime)+"</em>":"<em>|</em><em>"+Calendar.minstotime(timeRange.fromTime)+" - "+Calendar.minstotime(timeRange.toTime)+"</em></div>"}),breakTimings.length%2==1&&(breakRow+="</div>"),breakRow+="</div>")}breakRows+=breakRow+="</div></div>"}),breakRows},getUsrBreakRows:function(erecno){return null!=Timetracker.Break.userBreaks&&Timetracker.Break.userBreaks.hasOwnProperty(erecno)||Timetracker.BreakTimelogs.List.setBreakDtlsCache(erecno),Timetracker.Break.userBreaks[erecno]?Timetracker.Break.userBreaks[erecno]:[]},setBreakDtlsCache:function(erecno){Timetracker.Break.userBreaks=null==Timetracker.Break.userBreaks?{}:Timetracker.Break.userBreaks,Timetracker.BreakTimelogs.List.getUsrBreakDtls(erecno)},getUsrBreakDtls:function(erecno){var params={mode:"getJobs"};params.erecno=erecno,params.getCurUserJobs=!0,params.jobStatus="0",params.projectId="0",params.includeDeptJobs="false",params.isClientDetailsNeeded="false",params.conreqcsr=csrfToken,params.fetchBreakJobs=!0,params.needBreakDetails=!0,params.sIndex=0,params.limit=25,ZPeople.Request.send("/timesheet.zp",params,Timetracker.BreakTimelogs.List.getUsrBreakDtlsCallback)},getUsrBreakDtlsCallback:function(result,params){var erecno=params.erecno;result&&(Timetracker.Break.userBreaks[erecno]=result),Timetracker.BreakTimelogs.List.enableDisableBreakIcon(erecno)},enableDisableBreakIcon:function(erecno){Timetracker.Break.userBreaks.hasOwnProperty(erecno)&&Timetracker.Break.userBreaks[erecno].length>0?Timetracker.BreakTimelogs.isBreakTimerRunning(null,erecno)?Layout.Page.container.find("#breakStopButton").removeClass("zpl_DNI"):Layout.Page.container.find("#breakStartButton").removeClass("zpl_DNI"):(Layout.Page.container.find("#breakStartButton").addClass("zpl_DNI"),Layout.Page.container.find("#breakStopButton").addClass("zpl_DNI"))},showHideBreakPopup:function(){var breakPopup=Layout.Page.container.find("#breakPopup");breakPopup.is(":visible")?ZPeopleComponents.popover(breakPopup).close():(Timetracker.BreakTimelogs.List.resetFields(breakPopup),breakPopup.find(".zpl_breakpop").animate({scrollTop:0}),ZPeopleComponents.popover(breakPopup).open())},resetFields:function(breakPopup){Timetracker.util.removeErrorMsg(void 0,breakPopup,!0),breakPopup.find("[id^=breakDesc_").val(""),breakPopup.find("[id^=breakStartEnd_").parent().hasClass("zpl_DNI")||breakPopup.find("[id^=breakStartEnd_").prop("checked",!0).trigger("click")},setDefaultTime:function(row){if(0!=row.find("[id^=breakStartEnd_").length&&!row.find("[id^=breakStartEnd_").hasClass("zpl_DNI")){var jobId=$(row).attr("jobId"),fromTime=$(row).find("#breakFromTime_"+jobId),toTime=$(row).find("#breakToTime_"+jobId),val=Timetracker.DateTime.getUserTimeZoneCurrDateTime();if(Timetracker.isTTSthiftEnabled())if(ZPeopleComponents.isComponent(fromTime)&&ZPeopleComponents.isComponent(toTime))TimelyZComp.datetimefield.setValue(fromTime,val),TimelyZComp.datetimefield.setValue(toTime,val);else{var shiftDate=Timetracker.generalSettings.getTSSettings(Timetracker.timelogs.tserecno).TS_shiftDate;shiftDate=void 0==shiftDate?Calendar.formatDate(new Date):shiftDate;var pickerOptions={},shitDt=Calendar.parseDate(shiftDate,uidateFormat);shitDt.setDate(shitDt.getDate()-1),pickerOptions.minDate=Calendar.formatDate(shitDt).toString(),shitDt.setDate(shitDt.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(shitDt).toString();var attr={pickerOptions:pickerOptions,value:val};TimelyZComp.datetimefield.intialize(fromTime,attr),TimelyZComp.datetimefield.intialize(toTime,attr)}else if(ZPeopleComponents.isComponent(fromTime)&&ZPeopleComponents.isComponent(toTime))TimelyZComp.timeField.setValue(fromTime,val),TimelyZComp.timeField.setValue(toTime,val);else{var opt={clearButton:"none",change:function(event,data){event.target.val(data.value)},className:"w150"};opt.format=timeFormat.replace("a","tt"),opt.value=val,ZPeopleComponents.timefield(fromTime,opt),ZPeopleComponents.timefield(toTime,opt)}}},setParamsForAddBreak:function(jobId){var breakRow=Layout.Page.container.find("#breakRow_"+jobId),params={zp_mode:"addRecord"};if(params.JobId=jobId,params.User_Name=Timetracker.timelogs.tserecno,params.Date=Calendar.formatDate(Timetracker.DateTime.getUserTimeZoneCurrDateTime()),params.conreqcsr=csrfToken,params.isFromNewUI=!0,params.loginUserZUID=_LOGGEDIN_ZUID,params.zp_formId=Timetracker.timelogs.formDetails.formId,params.zp_tableName="P_Timesheet",0!==Object.keys(Timetracker.location.latLongParam).length){var obj=Timetracker.location.latLongParam;obj.hasOwnProperty("latitude")&&null!==obj.latitude&&obj.hasOwnProperty("longitude")&&null!==obj.longitude&&obj.hasOwnProperty("accuracy")&&null!==obj.accuracy&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}if(params.timelogtype="1",Timetracker.isTTSthiftEnabled()){var logDate=Timetracker.DateTime.getCurrDate(),fTime=TimelyZComp.datetimefield.getDateObj(breakRow.find("#breakFromTime_"+jobId)),tTime=TimelyZComp.datetimefield.getDateObj(breakRow.find("#breakToTime_"+jobId));params.fromTime=logDate.getDiff(fTime,Timetracker.constants.MINUTES),params.toTime=logDate.getDiff(tTime,Timetracker.constants.MINUTES)}else params.fromTime=Timetracker.util.getTotalTimeForHours(TimelyZComp.timeField.getValue(breakRow.find("#breakFromTime_"+jobId)).split(":")),params.toTime=Timetracker.util.getTotalTimeForHours(TimelyZComp.timeField.getValue(breakRow.find("#breakToTime_"+jobId)).split(":"));if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var descTxt=breakRow.find("#breakDesc_"+jobId).val();""!==descTxt&&(params.Description=descTxt)}return params},validateAndShowErrorBreakLog:function(jobId,type){Timetracker.util.removeErrorMsg(void 0,Layout.Page.container.find("#breakPopup"),!0);var breakRow=Layout.Page.container.find("#breakRow_"+jobId),desc="";if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)&&(desc=breakRow.find("#breakDesc_"+jobId).val(),Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC)&&""==desc.trim())){var descFieldName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC);return Timetracker.Util.appenErrorMsgForElem({obj:breakRow.find("#breakDesc_"+jobId),msg:ZPI18N.getString("zp.entervalforfield",[descFieldName])}),!1}var usrBreakInfo,usrBreaks=Timetracker.BreakTimelogs.List.getUsrBreakRows(Timetracker.timelogs.tserecno);if($.each(usrBreaks,function(ind,row){row.jobId!=jobId||(usrBreakInfo=row)}),"1"==type){var msg,isError=!1,fromTimeInMins=0,toTimeInMins=0;if(Timetracker.isTTSthiftEnabled()){var logDate=Timetracker.DateTime.getCurrDate(),fromTime=TimelyZComp.datetimefield.getDateObj(breakRow.find("#breakFromTime_"+jobId)),toTime=TimelyZComp.datetimefield.getDateObj(breakRow.find("#breakToTime_"+jobId));if(void 0==fromTime||void 0==toTime)isError=!0,msg=ZPI18N.getString("zp.entervalidtime");else if(fromTime.getTime()>toTime.getTime())isError=!0,msg=ZPI18N.getString("zp.fromtimegreater");else if(logDate.diffTo(fromTime)>1||logDate.diffTo(toTime)>1)isError=!0,msg=ZPI18N.getString("zp.timelogfromtodate");else{var ttime=toTime.diffTo(fromTime,"minutes");ttime>Timetracker.constants.PER_DAY_MIN?(isError=!0,msg=ZPI18N.getString("zp.timeralert16")):0==ttime&&Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timelogs.tserecno)&&(isError=!0,msg=ZPI18N.getString("zp.logalert9"))}fromTimeInMins=60*fromTime.getHours()+fromTime.getMinutes(),toTimeInMins=60*toTime.getHours()+toTime.getMinutes()}else{fromTime=TimelyZComp.timeField.getValue(breakRow.find("#breakFromTime_"+jobId)),toTime=TimelyZComp.timeField.getValue(breakRow.find("#breakToTime_"+jobId));if(fromTime&&toTime&&""!=fromTime&&""!=toTime||(isError=!0,msg=ZPI18N.getString("zp.entervalidtime")),"hh:mm a"===timeFormat){var fromHrs=fromTime.split(/(\s+)/)[0],fampm=fromTime.split(/(\s+)/)[2].toLowerCase();fromTimeInMins=Calendar.timetomins(fromHrs,0,fampm).tottime;var toHrs=toTime.split(/(\s+)/)[0],tampm=toTime.split(/(\s+)/)[2].toLowerCase();toTimeInMins=Calendar.timetomins(toHrs,0,tampm).tottime}else fromTimeInMins=Calendar.hrstomins(fromTime),toTimeInMins=Calendar.hrstomins(toTime);toTimeInMins-fromTimeInMins==0&&Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timelogs.tserecno)&&(isError=!0,msg=ZPI18N.getString("zp.logalert9"))}if(isError)return Timetracker.Util.appenErrorMsgForElem({obj:breakRow.find("#breakFromTime_"+jobId),msg:msg,appendTo:breakRow.find("#breakFromTime_"+jobId).parent().parent()}),Timetracker.Util.appenErrorMsgForElem({obj:breakRow.find("#breakToTime_"+jobId)}),!1;if(usrBreakInfo&&usrBreakInfo.breakTimings){var isAllowed=!1;if($.each(usrBreakInfo.breakTimings,function(ind,allowedRange){var allowedFromTime=allowedRange.fromTime,allowedToTime=allowedRange.toTime;fromTimeInMins>=allowedFromTime&&toTimeInMins<=allowedToTime&&(isAllowed=!0)}),!isAllowed)return Timetracker.Util.appenErrorMsgForElem({obj:breakRow.find("#breakFromTime_"+jobId),msg:ZPI18N.getString("zp.tsbreaklogoutsideerror"),appendTo:breakRow.find("#breakFromTime_"+jobId).parent().parent()}),Timetracker.Util.appenErrorMsgForElem({obj:breakRow.find("#breakToTime_"+jobId)}),!1}}else if("2"==type&&Timetracker.timelogs.tserecno!==erecno)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert7")),!1;return!0},startBreak:function(obj){var type=$(obj).attr("type");Layout.Page.container.find("#breakPopup").find("[id^=saveBrkBtn_],[id^=startBrkTimerBtn_]").addClass("disabled").off().on("click","").attr("onclick",""),"1"==type?Timetracker.util.getTTLocation(Timetracker.BreakTimelogs.List.addBreakLog,obj):"2"==type&&Timetracker.util.getTTLocation(Timetracker.timelogs.timer.pauseclockCallback,obj)},addBreakLog:function(obj){Timetracker.util.removeErrorMsg(void 0,Layout.Page.container.find("#breakPopup"),!0);var jobId=$(obj).attr("jobid");if(Timetracker.BreakTimelogs.List.validateAndShowErrorBreakLog(jobId,"1")){var params=Timetracker.BreakTimelogs.List.setParamsForAddBreak(jobId);Timetracker.BreakTimelogs.List.sendAddBreakRequest(params)}else Timetracker.BreakTimelogs.List.rebindTimerEvents()},getBreakObjFromParam:function(params,res){var breakLog={};breakLog.timelogId=res.pkId,breakLog.workDate=params.Date,breakLog.type=params.timelogtype,breakLog.hours=params.fromTime>params.toTime?params.toTime+Timetracker.constants.PER_DAY_MIN-params.fromTime:params.toTime-params.fromTime,breakLog.fromTime=params.fromTime,breakLog.toTime=params.toTime,breakLog.fromTimeInTimeFormat=Calendar.minstotimeFormat(params.fromTime),breakLog.toTimeInTimeFormat=Calendar.minstotimeFormat(params.toTime),breakLog.isBreakLog=!0,breakLog.isEditAllowed=!0,breakLog.billingStatus=0,Timetracker.Validations.isDefiniteValue(params.latitude)&&Timetracker.Validations.isDefiniteValue(params.longitude)&&Timetracker.Validations.isDefiniteValue(params.accuracy)&&(breakLog.latitude=params.latitude,breakLog.longitude=params.longitude,breakLog.accuracy=params.accuracy);var breakInd=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.BreakTimelogs.List.getUsrBreakRows(Timetracker.timelogs.tserecno),params.JobId,"jobId");if(-1!=breakInd){var breakDtls=Timetracker.BreakTimelogs.List.getUsrBreakRows(Timetracker.timelogs.tserecno)[breakInd];breakLog.billableStatus=breakDtls.billableStatus,breakLog.jobName=breakDtls.jobName}return breakLog},sendAddBreakReqCallback:function(extraDetails){var reqParams=extraDetails.params;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0,Timetracker.BreakTimelogs.List.sendAddBreakRequest(reqParams)},sendAddBreakRequest:function(params){ZPeople.Request.send("/addUpdateRecord.zp",params,function(result){Timetracker.BreakTimelogs.List.rebindTimerEvents();var resObj=result[0];if(resObj.hasOwnProperty("code")&&7e3!==resObj.code)if(resObj.hasOwnProperty("showOverlapWarn")&&resObj.showOverlapWarn)if("1"===Timetracker.generalSettings.getTimelogOverlapType(params.User_Name)){ZPeopleComponents.popover(Layout.Page.container.find("#breakPopup")).setAttribute("closeOnBodyClick",!1);Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.BreakTimelogs.List.sendAddBreakReqCallback,{hiddenCallback:function(){0!=Layout.Page.container.find("#breakPopup").length&&ZPeopleComponents.popover(Layout.Page.container.find("#breakPopup")).setAttribute("closeOnBodyClick",!0)}})}else if("object"==typeof resObj.message){var msgObj=resObj.message;Timetracker.BreakTimelogs.List.breakLogErrDisp(msgObj,params)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.ttfailuremsg"));else if("object"==typeof resObj.message){msgObj=resObj.message;Timetracker.BreakTimelogs.List.breakLogErrDisp(msgObj,params)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.ttfailuremsg"));else{if(!!resObj.true_refresh&&resObj.true_refresh)Timetracker.timelogs.refreshData=!0,Timetracker.UserSpace.Timelogs.isRefreshNeeded=!0,Timetracker.timelogs.calendar.refreshData=!0,Timetracker.timelogs.getTimelogsListView(!0,-1);else{var breakLogData=Timetracker.BreakTimelogs.List.getBreakObjFromParam(params,resObj);Timetracker.timelogs.constructTimelogRow(breakLogData)}Timetracker.util.showAlert(2,ZPI18N.getString("zp.recordaddedsuccessfully")),Timetracker.BreakTimelogs.List.showHideBreakPopup()}})},breakLogErrDisp:function(msgObj,params){var msgKey=Object.keys(msgObj)[0],errMsg=msgObj[msgKey],jobId=params.JobId,breakRow=Layout.Page.container.find("#breakPopup");switch(msgKey){case"TotalHours":case"Date":Timetracker.Util.appenErrorMsgForElem({obj:breakRow.find("#breakFromTime_"+jobId),msg:errMsg,appendTo:breakRow.find("#breakFromTime_"+jobId).parent().parent()}),Timetracker.Util.appenErrorMsgForElem({obj:breakRow.find("#breakToTime_"+jobId)});break;case"JobId":Timetracker.Util.appenErrorMsgForElem({obj:breakRow.find("#breakFromTime_"+jobId).parent(),msg:errMsg});break;case"Description":Timetracker.Util.appenErrorMsgForElem({obj:breakRow.find("#breakDesc_"+jobId),msg:ZPI18N.getString("zp.entervalforfield",[Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC)])});break;default:Timetracker.util.showAlert(1,errMsg)}},startBreakTimerlog:function(jobId){Timetracker.util.getTTLocation(Timetracker.BreakTimelogs.List.startBreakTimerCallback,jobId)},startBreakTimerCallback:function(jobId){var breakPopup=Layout.Page.container.find("#breakPopup"),desc="";Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)&&(desc=breakPopup.find("#breakDesc_"+jobId).val());var params={jobId:jobId,mode:"timeradd",returnTimelog:!0,type:2,conreqcsr:csrfToken};if(null!==desc&&""!==desc&&(params.desc=desc),0!==Object.keys(Timetracker.location.latLongParam).length){var obj=Timetracker.location.latLongParam;obj.hasOwnProperty("latitude")&&null!==obj.latitude&&obj.hasOwnProperty("longitude")&&null!==obj.longitude&&obj.hasOwnProperty("accuracy")&&null!==obj.accuracy&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}Timetracker.BreakTimelogs.List.sendTimeraddRequest(params)},sendTimeraddRequestsCallback:function(extraDetails){var reqParams=extraDetails.params;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0,Timetracker.timelogs.timer.sendTimeraddRequest(reqParams)},sendTimeraddRequest:function(params){$.post("/timesheet.zp",params,function(result){Timetracker.BreakTimelogs.List.rebindTimerEvents(),Timetracker.timelogs.timer.hideTimerLoadIcon("timerstart");var resCode="",resMsg="",isSuccess=!1;if(null!==result&&!(isSuccess=result.res)&&result.hasOwnProperty("errorCode"))if(resCode=result.errorCode,result.hasOwnProperty("extraDtls"))if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMELOG_ENTRY_OVERLAP)if("1"===Timetracker.generalSettings.getTimelogOverlapType()){ZPeopleComponents.popover(Layout.Page.container.find("#breakPopup")).setAttribute("closeOnBodyClick",!1);Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.BreakTimelogs.List.sendTimeraddRequestsCallback,{hiddenCallback:function(){0!=Layout.Page.container.find("#breakPopup").length&&ZPeopleComponents.popover(Layout.Page.container.find("#breakPopup")).setAttribute("closeOnBodyClick",!0)}})}else resMsg=Timetracker.Util.getFailureMessageByCode(resCode,result.extraDtls,!0),Timetracker.util.showAlert(1,resMsg);else resMsg=Timetracker.Util.getFailureMessageByCode(resCode,result.extraDtls,!0),Timetracker.util.showAlert(1,resMsg);else resMsg=Timetracker.Util.getFailureMessageByCode(resCode,null,!0),Timetracker.util.showAlert(1,resMsg);if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.IPRESTRICTION||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.GEORESTRICTION||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ESTIMATEDHOURRESTRICT||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAXLOGHOURRESTRICT||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_PAYPERIOD||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_BUDGET)Timetracker.timelogs.timer.resetTimer();else if(isSuccess){var timelog=result.resArr;if(timelog=0!==timelog.length?timelog[0]:null){if(Timetracker.timelogs.currentTimerJobData&&result.extraDtls&&result.extraDtls.pausedTimelog){Timetracker.timelogs.timer.hideTimerLoadIcon("timerrunning");var pausedTimelog=result.extraDtls.pausedTimelog;Timetracker.timelogs.timer.resetComponentsOnTimerPause(pausedTimelog,Timetracker.BreakTimelogs.isBreakLog("DATA",pausedTimelog))}if(Timetracker.timelogs.constructTimelogRow(timelog),Timetracker.BreakTimelogs.List.setValuesInBreakButton("SET"),Timetracker.jobSchedule.hasCustomFields()){var otherDtls={};null!==Timetracker.timelogs.currentTimerJobData&&(otherDtls.runningJobId=Timetracker.timelogs.currentTimerJobData.jobId,Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("FREEZE_OTHER_JSCH",null,otherDtls))}Timetracker.util.showAlert(2,ZPI18N.getString("zp.timelogentryadded"))}}Timetracker.util.removeErrorMsg(void 0,Layout.Page.container.find("#breakPopup"),!0)})},rebindTimerEvents:function(){Layout.Page.container.find("#breakPopup").find("[id^=saveBrkBtn_],[id^=startBrkTimerBtn_]").removeClass("disabled").off("click").on("click",function(){Timetracker.BreakTimelogs.List.startBreak(this)})}},Calendar:{populateCalendarEditPopUpBreak:async function(logDtls){var popupModal=Layout.Page.container.find("#calAddPopup");if(popupModal.find("#titleid").html(ZPI18N.getString("zp.editbreak")),popupModal.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").parent().remove(),2==logDtls.type)popupModal.find("#timelog_type").parent().parent().addClass("zpl_DNI");else{if(popupModal.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_timer']").parent().remove(),1==logDtls.type){if(popupModal.find("#timelog_type").parent().parent().removeClass("zpl_DNI"),popupModal.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").prop("checked",!1),popupModal.find("#timelog_hours_time").addClass("zpl_DNI"),popupModal.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").prop("checked",!0),Timetracker.isTTSthiftEnabled()){var pickerOptions={};let logDate=Calendar.parseDate(logDtls.workDate,uidateFormat);logDate.setDate(logDate.getDate()-1),pickerOptions.minDate=Calendar.formatDate(logDate).toString(),logDate.setDate(logDate.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(logDate).toString(),logDate=Calendar.parseDate(logDtls.workDate,uidateFormat);var attr={pickerOptions:pickerOptions};attr.value=Timetracker.util.getShiftDatebyTime(logDtls.fromTime,logDate,Timetracker.constants.MINUTES),TimelyZComp.datetimefield.intialize(popupModal.find("#timelog_fromtime"),attr,!0),attr.value=Timetracker.util.getShiftDatebyTime(logDtls.toTime,logDate,Timetracker.constants.MINUTES),TimelyZComp.datetimefield.intialize(popupModal.find("#timelog_totime"),attr,!0)}else{var options={clearButton:"none",format:timeFormat.replace("a","tt"),minuteStep:1,className:"w150"};options.value=Timetracker.DateTime.minstoTimeMeridian(logDtls.fromTime),TimelyZComp.timeField.intialize(popupModal.find("#timelog_fromtime"),options),options.value=Timetracker.DateTime.minstoTimeMeridian(logDtls.toTime),TimelyZComp.timeField.intialize(popupModal.find("#timelog_totime"),options)}popupModal.find("#timelog_hrstime").val(Calendar.minstohrs(0)),popupModal.find("#timelog_start_end_time").removeClass("zpl_DNI")}""===popupModal.find("#timelog_type").html()&&popupModal.find("#timelog_type").parent().parent().remove()}"0"===logDtls.billableStatus||0===logDtls.billableStatus?popupModal.find("#brkTypevalCal").html(ZPI18N.getString(Timetracker.Break.TYPE_STATUS[0])):popupModal.find("#brkTypevalCal").html(ZPI18N.getString(Timetracker.Break.TYPE_STATUS[1])),logDtls.hasOwnProperty("description")&&popupModal.find("#cal_log_descid").val(ZPeople.decodeTxt(logDtls.description));var user=Timetracker.util.getUserErecno();await Timetracker.jobs.Filters.createJobSelect(user,"-1","calendarLogTime",null,void 0,Timetracker.constants.TTCustomAdmin.EntryView,{isV5:!0,isBreakLog:!0});var data={};logDtls.hasOwnProperty("jobId")&&(logDtls.jobIsActive||void 0==logDtls.jobIsActive)&&(data.jobId=logDtls.jobId,data.jobName=logDtls.jobName),Timetracker.timelogs.setValuesInSelectInput(data,"calendarLogTime","calAddPopup",null,{allowAll:!0,isNewKey:!0,isBreakLog:!0,isV5:!0}),popupModal.find("#jobid").off("zselectchange").on("zselectchange",function(event,data){data.fromUI&&Timetracker.timelogs.jobChange("calendarLogTime",void 0,{isBreakLog:!0,isV5:!0})}),popupModal.find("#submitLogtime").attr("onclick","").unbind("click").click(function(){popupModal.find("#submitLogtime").addClass("disabled"),logDtls.isBreakLog=!0,Timetracker.timelogs.calendar.submitEditTimelog(logDtls)})},setParamsForEditCal:function(arg,curYear,curMonth,caldate1){var hrsregexerr,date_val=0,integerform=0,date_format=0,newdiffT=0,diffmins=0,params={},tablename=Timetracker.constants.TIMELOG_TABLE,modal=Layout.Page.container.find("#calAddPopup");Timetracker.util.removeErrorMsg(void 0,modal,!0);var User_Name,jobid=TimelyZComp.select.getValue(modal.find("#jobid"));params.jobid=jobid,User_Name=ZPCal.Calendar.isDashboardCal()?erecno:ZPCal.Calendar.isSelfServiceCal()?SelfService.getUserId():null===Timetracker.timelogs.tserecno?erecno:Timetracker.timelogs.tserecno,Timetracker.timelogs.formDetails=Timetracker.util.getFormDetails(Timetracker.timelogs.formDetails,"P_Timesheet"),params.zp_mode="updateRecord",params.zp_recordId=arg.timelogId;var argworkdate=arg.workDate;if(String(argworkdate).indexOf("GMT")>=0){if(arg.hasOwnProperty("fordatepart")){arg.fordatepart;date_format=Calendar.formatDate(argworkdate),!1;var day=arg.workDate.getDate(),month=arg.workDate.getMonth(),year=arg.workDate.getFullYear();date_val=new Date(year,month,day),integerform=month+1+"-"+day+"-"+year}}else{if(0!=argworkdate.substr(0,argworkdate.indexOf(" ")).length)argworkdate.substr(0,argworkdate.indexOf(" "));else if(arg.hasOwnProperty("fordatepart"))arg.fordatepart;else arg.workDate;var workDate=Calendar.parseDate(arg.workDate,uidateFormat);day=workDate.getDate(),month=workDate.getMonth(),year=workDate.getFullYear();date_val=new Date(year,month,day),integerform=month+1+"-"+day+"-"+year,date_format=Calendar.formatDate(date_val)}if(params.Date=date_format,params.JobId=jobid,params.User_Name=User_Name,params.conreqcsr=csrfToken,params.isFromNewUI=!0,params.loginUserZUID=_LOGGEDIN_ZUID,params.zp_formId=Timetracker.timelogs.formDetails.formId,params.zp_tableName=tablename,0!==Object.keys(Timetracker.location.latLongParam).length){var obj=Timetracker.location.latLongParam;obj.hasOwnProperty("latitude")&&null!==obj.latitude&&obj.hasOwnProperty("longitude")&&null!==obj.longitude&&obj.hasOwnProperty("accuracy")&&null!==obj.accuracy&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}if(0!==Layout.Page.container.find("#timelog_type").length)if(selectedType=Layout.Page.container.find("#timelog_type").find("input[name='timelogTime']:checked").val(),params.timelogtype=selectedType,"2"===arg.type||2===arg.type)newdiffT=Calendar.minstohrs(arg.hours),hrsregexerr=!0,params.timelogtype=arg.type,params.loggedHrs=arg.hours,arg.hours;else if("1"===selectedType&&(hrsregexerr=!0,Layout.Page.container.find("#timelog_fromtime").val()&&Layout.Page.container.find("#timelog_totime").val())){var fromhrstot=TimelyZComp.timeField.getValue(modal.find("#timelog_fromtime")),tohrstot=TimelyZComp.timeField.getValue(modal.find("#timelog_totime"));if(!fromhrstot||!tohrstot)return null;if(fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.split(":")),toTime=Timetracker.util.getTotalTimeForHours(tohrstot.split(":")),isNaN(fromTime)||isNaN(toTime))return null;toTime>=fromTime?(diffmins=toTime-fromTime,newdiffT=Calendar.minstohrs(diffmins)):(diffmins=toTime+Timetracker.constants.PER_DAY_MIN-fromTime,newdiffT=Calendar.minstohrs(diffmins)),params.fromTime=fromTime,params.toTime=toTime}if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var descTxt=Layout.Page.container.find("#cal_log_descid").val();""!==descTxt&&(params.Description=descTxt)}return params.date_val=date_val,params.hrsregexerr=hrsregexerr,params.diffmins=diffmins,params.integerform=integerform,params.newdiffT=newdiffT,params.jobid=jobid,params}},Forms:{isFromBreakLog:!1,load:function(mode,othrDtls){"ADD"===mode?Timetracker.generalSettings.isBreakEnabled()&&(Timetracker.BreakTimelogs.Forms.isFromBreakLog=!0,window.location.href="#"+settingsUrlProps.niceUrl+"/addtimelog"):"SET"===mode?(Timetracker.BreakTimelogs.Forms.isFromBreakLog||Timetracker.BreakTimelogs.isBreakLog("DATA",othrDtls))&&(Timetracker.BreakTimelogs.Forms.isFromBreakLog=!0):"CLOSE"===mode&&(Timetracker.BreakTimelogs.Forms.isFromBreakLog&&(Timetracker.BreakTimelogs.Forms.isFromBreakLog=!1),void 0===Timetracker.jobs.jobData.length&&(Timetracker.jobs.jobData={}))},bindAddEditBreaksList:async function(){var formRef=ZP5Form.getFormClassObj(),layout=formRef.LAYOUT,jobSelDiv=layout.find('input[name="JobId"]'),jobId=jobSelDiv.val(),jobName=jobSelDiv.text(),eno=Timetracker.util.getUserErecno();if(await Timetracker.jobs.Filters.createJobSelect(eno,"-1","addeditbreaklogtime",null,void 0,Timetracker.constants.TTCustomAdmin.EntryView,{isBreakLog:!0,isAdd:formRef.isAddMode(),isV5:!0}),formRef.isEditMode()){var data={jobId:jobId,jobName:jobName};Timetracker.timelogs.setValuesInSelectInput(data,"addeditbreaklogtime",null,null,{allowAll:!0,isNewKey:!0,isBreakLog:!0})}jobSelDiv.off("zselectchange").on("zselectchange",function(event,data){data.fromUI&&Timetracker.timelogs.jobChange("addeditbreaklogtime",null,{isBreakLog:!0,isV5:!0})}),Timetracker.isTTSthiftEnabled()&&layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").length&&layout.find("input[name=Date]").off("zdatefieldchange").on("zdatefieldchange",function(eve,data){var date=data.dateValue,pickerOptions={};date.setDate(date.getDate()-1),pickerOptions.minDate=Calendar.formatDate(date).toString(),date.setDate(date.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(date).toString(),TimelyZComp.datetimefield.setAttribute(layout.find("#timelog_fromtime"),"pickerOptions",pickerOptions),TimelyZComp.datetimefield.setAttribute(layout.find("#timelog_totime"),"pickerOptions",pickerOptions)})}}},Timetracker.Request={send:function(json){ZPeople.Request.send(json.url,json.params,json.callback,json.otherdetails,json.failureCallback)},sendAsyncPost:function(json){ZPeople.Request.sendAsyncPost(json.url,json.params,json.callback,json.otherdetails,json.failureCallback)},failureCallback:function(code,extraDtls){var emsg=Timetracker.Util.getFailureMessageByCode(code,extraDtls);Timetracker.util.showAlert(0,emsg)},sendAsPromise:function(url,params){return new Promise((resolve,reject)=>{ZPeople.Request.send(url,params,resolve,void 0,reject)})},sendAsPromiseWithTimeOut:function(url,params,reason,delay,resolveCallBack){const timeOutPromise=new Promise(resolve=>{setTimeout(()=>{resolve(reason)},delay)});return Promise.any([Timetracker.Request.sendAsPromise(url,params).then(response=>(resolveCallBack&&resolveCallBack([response,params]),response)),timeOutPromise])},sendRequestAsPromise:function(url,params,otherDetails,method){return method=method||"POST",new Promise((resolve,reject)=>{ZPeople.Request.sendRequest(url,params,method,function(response,params,otherDetails){response=response||Timetracker.Request.getStandardSucessResponse(),resolve([response,params,otherDetails])},otherDetails,function(response,params,otherDetails){reject([response,params,otherDetails])})})},sendRequestAsPromiseWithCatch:function(url,params,otherDetails,method){return Timetracker.Request.sendRequestAsPromise(url,params,otherDetails,method).catch(error=>[error[0].responseJSON&&Timetracker.Request.skipGenericErrors(error[0].responseJSON)||Timetracker.Request.getStandardErrorResponse()])},skipGenericErrors:function(response){return Timetracker.Request.isIdcSetup()&&0==response.status&&response.errors&&"INTERNAL_ERROR"===response.errors.code?Timetracker.Request.getStandardSucessResponse():response},getStandardSucessResponse:function(){return{status:1,data:{}}},getStandardErrorResponse:function(){return Timetracker.Request.isIdcSetup()?Timetracker.Request.getStandardSucessResponse():{status:0,errors:{message:ZPI18N.getString("zp.lms.messages.unexpectederror")}}},isIdcSetup:function(){return!(Layout.ISLOCALIDCSETUP||Layout.ISDEV)}},Timetracker.cache={clearCache:function(tableName){tableName&&null!==tableName&&(tableName===Timetracker.constants.JOB_TABLE?(Timetracker.jobs.refreshData=!0,Timetracker.jobs.fetchJob=!0):tableName===Timetracker.constants.PROJECT_TABLE?(Timetracker.projects.refreshData=!0,Timetracker.projects.fetchProject=!0):tableName===Timetracker.constants.CLIENT_TABLE&&(Timetracker.clients.refreshData=!0,Timetracker.clients.fetchData=!0))},refreshTimerData:function(){document.removeEventListener("visibilitychange",Timetracker.cache.refreshTimerData),Timetracker.currentlyRunningTimer.removeTimerDom(),Timetracker.timelogs.currentTimerJobData=null,Timetracker.timelogs.resetTLFetch(),Timetracker.UserSpace.isMySpaceTimelogs()?Timetracker.UserSpace.Timelogs.init(Layout.Page.container,{erecno:erecno}):Timetracker.Page.Timelogs.isListView()?Timetracker.timelogs.initTimelogs():Timetracker.Page.Timelogs.isCalendarView()&&Timetracker.timelogs.calendar.initTimesheetCalendar()}},Date.prototype.getDiff=function(dte,k){var timeDiff=new Date(dte).getTime()-this.getTime();return"hours"==k?Math.floor(timeDiff/36e5):"minutes"==k?Math.floor(timeDiff/6e4):"seconds"==k?Math.floor(timeDiff/1e3):Math.floor(timeDiff/864e5)},Timetracker.select2={getSelect2Properties:function(isInput,selJson){var options={formatNoMatches:function(){return ZPI18N.getString("zp.nomatchesfound")}};if(isInput&&1==isInput&&selJson){var cacheKey=selJson.elementId;selJson.hasOwnProperty("containerId")&&(cacheKey=selJson.containerId+"_"+selJson.elementId),!isInput||void 0!==selJson.skipreset&&selJson.skipreset||Timetracker.Filters.Util.resetPropAndSearch(cacheKey+"-"+selJson.entity);var initSelJson=selJson.initSelJson;selJson.multipleSelections&&(initSelJson=""),Timetracker.Filters.initSelect(selJson),selJson.entity===Timetracker.constants.PROJECT||selJson.entity===Timetracker.constants.CLIENT?selJson.url=Timetracker.constants.URL:selJson.url="/timesheet.zp",selJson.limit=Timetracker.constants.SELECT_OPTLIMIT,options=$.extend(options,{query:function(query){var searchResults,results=[],defSelJson=selJson.defSelJson;!defSelJson||selJson.params&&selJson.multipleSelections||results.push(defSelJson);var index=-1;if(cacheKey&&selJson.entity){query.term;selJson.query=query,searchResults=Timetracker.Filters.Search.getSearchResults(query.term,cacheKey+"-"+selJson.entity,!1)}if(selJson.defSelJson.hasOwnProperty("isNewKey")){var newKeyIdVal=selJson.defSelJson.newEle.id;null!==searchResults&&void 0!==searchResults&&(index=Timetracker.projects.Operations.findJSONArrayIndex(searchResults,newKeyIdVal,"id")),-1===index&&results.push(selJson.defSelJson.newEle),results=results.concat(searchResults)}else results=results.concat(searchResults);query.callback({results:results})},initSelection:function(element,callback){callback(initSelJson||"")}})}return selJson&&selJson.multipleSelections&&(options.maximumSelectionSize=10,options.closeOnSelect=!1,isInput&&(options.multiple=!0)),selJson&&selJson.noSearch&&(options.minimumResultsForSearch="Infinity"),options}},Timetracker.zselect={create:function(isInput,json){var inpObj;if(json.elementId?0==(inpObj=Layout.Page.parentContainer.find("#"+json.elementId)).length&&(inpObj=$("#"+json.elementId)):json.ele&&json.ele.length>0&&(inpObj=$(json.ele)),void 0==inpObj||0==inpObj.length)return;inpObj.data("searchJson",json);var cacheKey=json.elementId;json.hasOwnProperty("containerId")&&(cacheKey=json.containerId+"_"+json.elementId),!isInput||void 0!==json.skipreset&&json.skipreset||Timetracker.Filters.Util.resetPropAndSearch(cacheKey+"-"+json.entity);var selElement,appendTo=Timetracker.Util.getLayout();if(json.appendTo&&(appendTo=json.appendTo),void 0===json.scrollStart&&(json.scrollStart=1),void 0===json.limit&&(json.limit=Timetracker.constants.SELECT_OPTLIMIT),Timetracker.Filters.initZSelect(json),void 0===json.url&&(json.entity===Timetracker.constants.PROJECT||json.entity===Timetracker.constants.CLIENT?json.url=Timetracker.constants.URL:json.url="/timesheet.zp"),ZPeopleComponents.isComponent(inpObj))return Timetracker.Util.removeError(inpObj),(selElement=ZPeopleComponents.select(inpObj)).setValue(json.initSelJson),selElement;let props={dataSource:{search:function(params){return new Promise(async function(search,reject){var tempjson=inpObj.data("searchJson");tempjson.query={term:params.query,page:params.pages};var result=[],options=[];tempjson.limit=tempjson.limit?tempjson.limit:Timetracker.constants.SELECT_OPTLIMIT;let limit=tempjson.limit;if(1==params.pages){tempjson.scrollStart=0;var defSelJson=tempjson.defSelJson;defSelJson&&(result.push(defSelJson),tempjson.limit--,tempjson.defSelJson.hasOwnProperty("isNewKey")&&(result.push(tempjson.defSelJson.newEle),tempjson.limit--))}!ZPUtil.Validation.isFunction(tempjson.callbackToFetchOptions)||params.query.length>0&&tempjson.useCommonFlowForSearch?(cacheKey&&tempjson.entity&&(options=await Timetracker.Filters.Search.getOptionsForFilter(tempjson,cacheKey+"-"+tempjson.entity)),options=options.slice(tempjson.scrollStart,tempjson.scrollStart+tempjson.limit)):options=await tempjson.callbackToFetchOptions(tempjson);let isLoadMore=options.length===tempjson.limit;if(tempjson.scrollStart+=tempjson.limit,tempjson.defSelJson&&tempjson.defSelJson.hasOwnProperty("isNewKey")&&(null!==options&&void 0!==options&&(index=Timetracker.projects.Operations.findJSONArrayIndex(options,tempjson.defSelJson.newEle.id,"id"),-1!==index&&options.splice(index,1)),isLoadMore&&options.length<tempjson.limit)){let extraOptions=[];tempjson.limit=tempjson.limit-options.length,tempjson.fetchExtraOption=!Timetracker.Validations.isDefiniteValue(tempjson.fetchExtraOption)||tempjson.fetchExtraOption,!ZPUtil.Validation.isFunction(tempjson.callbackToFetchOptions)||params.query.length>0&&tempjson.useCommonFlowForSearch?(cacheKey&&tempjson.entity&&(extraOptions=await Timetracker.Filters.Search.getOptionsForFilter(tempjson,cacheKey+"-"+tempjson.entity)),extraOptions=extraOptions.slice(tempjson.scrollStart,tempjson.scrollStart+tempjson.limit)):extraOptions=await tempjson.callbackToFetchOptions(tempjson),isLoadMore=extraOptions.length===tempjson.limit,tempjson.scrollStart+=tempjson.limit,options=options.concat(extraOptions),tempjson.fetchExtraOption=!1}result=result.concat(options),tempjson.limit=limit,respObj={results:result,more:isLoadMore},search(respObj)})},paginated:!0},search:{searchIncrementsInCache:!1,showNoResultsMessage:!0},isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0,appendTo:inpObj.parents(".sel_postion").length>0?inpObj.parents(".sel_postion"):appendTo,width:"300px",height:"300px",className:"zpl_ddoptnrml",moveOnScroll:!0},randomDropdownListId:!0,messages:{noResults:ZPI18N.getString("zp.nomatchesfound")},serverSearch:!0,cacheData:!!json.cacheData,lazyLoading:!0,showSearchField:!0,viewPerPage:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,dataMapping:{value:"id",label:"html"}};if(json.selectComponentExtraProperties&&(props={...props,...json.selectComponentExtraProperties}),selElement=ZPeopleComponents.select(inpObj,props),json.defSelJson){let defOption=[];defOption.push(json.defSelJson),json.defSelJson.isNewKey&&defOption.push(json.initSelJson),selElement.addOption(defOption)}return selElement.setValue(json.initSelJson),selElement}},Timetracker.select2ForWorkitem={getSelect2Properties:function(selJson){var options={formatNoMatches:function(){return ZPI18N.getString("zp.nomatchesfound")}};return options=$.extend(options,{query:function(query){var searchResults,results=[];if(searchResults=selJson.data,void 0!==selJson&&selJson.hasOwnProperty("isNewKey")){var newKeyIdVal=selJson.newEle.id;null!==searchResults&&void 0!==searchResults&&(index=Timetracker.projects.Operations.findJSONArrayIndex(searchResults,newKeyIdVal,"id")),-1===index&&results.push(selJson.newEle),results=results.concat(searchResults)}else results=results.concat(searchResults);query.callback({results:results})}})}},Timetracker.DateTime={is12hrFormat:function(format){return format?"hh:mm a"===format:Calendar.is12HrFormat()},isDate:function(value){return ZPUtil.Validation.isDate(value)},getDateinDBformat:function(userDate,convertTo2Digit){var year=userDate.getFullYear(),month=userDate.getMonth()+1,date=userDate.getDate();return userDate=year+"-"+(!0===convertTo2Digit?Timetracker.DateTime.convertTo2digit(month):month)+"-"+(!0===convertTo2Digit?Timetracker.DateTime.convertTo2digit(date):date)},getDateinTSformat:function(userDate){return userDate=Calendar.formatDate(userDate)},getCurrDate:function(){return Calendar.parseDate(Calendar.formatDate(new Date),uidateFormat)},convertTo2digit:function(val){return ZPUtil.Validation.isNumber(val)&&val<10?"0"+val:val},convertStringhrstoMins:function(strhrs){var splitHrsstring=strhrs.split(" ");return Timetracker.DateTime.convertToMins(splitHrsstring[0])},minstoTimeMeridian:function(totaltime){var mins=totaltime%60,hrs=(totaltime-mins)/60;if(!0===("HH:mm"!==timeFormat)){var meridian="AM";hrs>12?(hrs-=12,meridian="PM"):12===hrs?meridian="PM":0===hrs&&(hrs=12)}else meridian="";return(hrs=(hrs=hrs<1?"00":hrs)>=1&&hrs<10?"0"+hrs:hrs)+":"+(mins=(mins=mins<1?"00":mins)>=1&&mins<10?"0"+mins:mins)+" "+meridian},minstoTimeMeridianAP:function(totaltime){var mins=totaltime%60,hrs=(totaltime-mins)/60;if(!0===("HH:mm"!==timeFormat)){var meridian="a";hrs>12?(hrs-=12,meridian="p"):12===hrs?meridian="p":0===hrs&&(hrs=12)}else meridian="";return(hrs=(hrs=hrs<1?"00":hrs)>=1&&hrs<10?"0"+hrs:hrs)+":"+(mins=(mins=mins<1?"00":mins)>=1&&mins<10?"0"+mins:mins)+meridian},convertToMins:function(loghrs){var totalHours=0,loghours=0,strloghrs=loghrs.toString();if(strloghrs.indexOf(".")>=0){var logvalue=parseFloat(strloghrs);totalHours=parseInt((60*logvalue).toFixed(2))}else if(strloghrs.indexOf(":")>=0){var splitArr=new Array;null!=(splitArr=strloghrs.split(":"))[0]&&0!==splitArr[0].length&&(loghours=Number(splitArr[0]));var logmins=0;splitArr.length>1&&null!=splitArr[1]&&0!==splitArr[1].length&&(logmins=Number(splitArr[1])),totalHours=60*loghours+logmins}else loghours=0,null!=strloghrs&&0!==strloghrs.length&&(loghours=Number(strloghrs)),totalHours=60*loghours;return totalHours},splittime:function(totval){var calmins,calhrs,minsval;if(2===(totval=totval.toString()).split(":").length){var spltval=totval.split(":");calhrs=spltval[0],calmins=spltval[1],minsval=60*(calhrs=Number(calhrs))+(calmins=Number(calmins))}else calmins=0,minsval=calhrs=Number(totval);return minsval},isDateInRange:function(date,fromDate,toDate,dateFormat){dateFormat=dateFormat||uidateFormat;for(var fromDateObj=Calendar.parseDate(fromDate,dateFormat),toDateObj=Calendar.parseDate(toDate,dateFormat),dateObj=Calendar.parseDate(date,dateFormat),dummyFromDateObj=fromDateObj;dummyFromDateObj<=toDateObj;){if(dummyFromDateObj.toDateString()===dateObj.toDateString())return!0;dummyFromDateObj.setDate(dummyFromDateObj.getDate()+1)}return!1},isValidDateRange:function(fromDate,toDate,dateFormat){dateFormat=dateFormat||uidateFormat;var dummyFromDate=Calendar.parseDate(fromDate,dateFormat),dummyToDate=Calendar.parseDate(toDate,dateFormat);return dummyFromDate.getTime()<=dummyToDate.getTime()},getMonth:function(monVal){monVal=ZPUtil.Validation.isNumber(monVal)?monVal-1:0;var month=Calendar.months[monVal];return ZPUtil.Validation.isEmpty(month)?Calendar.months[0]:month},getDateDiff:function(fromDate,toDate,dateFormat){dateFormat=dateFormat||uidateFormat;for(var diff=0,fromDateObj="[object Date]"===Object.prototype.toString.call(fromDate)?new Date(fromDate):Calendar.parseDate(fromDate,dateFormat),toDateObj="[object Date]"===Object.prototype.toString.call(toDate)?new Date(toDate):Calendar.parseDate(toDate,dateFormat),dummyFromDateObj=fromDateObj;dummyFromDateObj<=toDateObj;)diff++,dummyFromDateObj.setDate(dummyFromDateObj.getDate()+1);return diff},getDateRangeBeforeAfter:function(dateRange,noOfMonths,isBefore,isAfter,dateFormat){dateFormat=dateFormat||uidateFormat;var datesArr=[],fromDate=dateRange.fromDate,toDate=dateRange.toDate;if(fromDate&&toDate&&noOfMonths>0)for(var dummyFromDate=Calendar.parseDate(fromDate,dateFormat),dummyToDate=Calendar.parseDate(toDate,dateFormat),dFromDate=isBefore?new Date(dummyFromDate.getTime()-4*noOfMonths*7*Timetracker.constants.PER_DAY_MIN*60*1e3):new Date(dummyFromDate.getTime()+7*Timetracker.constants.PER_DAY_MIN*60*1e3),dToDate=isBefore?new Date(dummyToDate.getTime()-4*noOfMonths*7*Timetracker.constants.PER_DAY_MIN*60*1e3):new Date(dummyToDate.getTime()+7*Timetracker.constants.PER_DAY_MIN*60*1e3),iCnt=isBefore&&isAfter?4*noOfMonths*2:noOfMonths,i=0;i<iCnt;i++)datesArr.push(Timetracker.DateTime.getDateinTSformat(dFromDate)+" "+ZPI18N.getString("zp.to")+" "+Timetracker.DateTime.getDateinTSformat(dToDate)),dFromDate.setDate(dFromDate.getDate()+7),dToDate.setDate(dToDate.getDate()+7);return datesArr},constructDayOfWeekOptions:function(isArrayneeded,defaulValueNeeded){var daysofweekarr=new Array(ZPI18N.getString("zp.sunday"),ZPI18N.getString("zp.monday"),ZPI18N.getString("zp.tuesday"),ZPI18N.getString("zp.wednesday"),ZPI18N.getString("zp.thursday"),ZPI18N.getString("zp.friday"),ZPI18N.getString("zp.saturday"));if(isArrayneeded){daysOfWeek=[];defaulValueNeeded&&daysOfWeek.push({label:ZPI18N.getString("zp.select"),value:"-1"});for(i=0;i<daysofweekarr.length;i++)daysOfWeek.push({label:daysofweekarr[i],value:i});return daysOfWeek}for(var daysOfWeek="",i=0;i<daysofweekarr.length;i++)daysOfWeek+='<option value="'+i+'"> '+daysofweekarr[i]+" </option>";return daysOfWeek},constructDayOfMonthOptions:function(maxDays,isArrayneeded,defaulValueNeeded){if(maxDays=maxDays||31,isArrayneeded){daysOfMonth=[];defaulValueNeeded&&daysOfMonth.push({label:ZPI18N.getString("zp.select"),value:"-1"});for(i=1;i<maxDays;i++)daysOfMonth.push({label:i+this.getNumberSuffix(i),value:i});return daysOfMonth.push({label:ZPI18N.getString("zp.lastday"),value:"32"}),daysOfMonth}for(var daysOfMonth="",i=1;i<maxDays;i++)daysOfMonth+='<option value="'+i+'">'+i+this.getNumberSuffix(i)+"</option>";return daysOfMonth+='<option value="32">'+ZPI18N.getString("zp.lastday")+"</option>"},getNumberSuffix:function(num){if(-1===[11,12,13].indexOf(num)){var mod=num%10;switch(mod){case 1:case 2:case 3:return Timetracker.constants.NUMBER_SUPERSCRIPT[mod+""];default:return Timetracker.constants.NUMBER_SUPERSCRIPT[4]}}return Timetracker.constants.NUMBER_SUPERSCRIPT[4]},getDayOfWeek:function(indx){return indx<Timetracker.constants.WEEK_NAME.length?Timetracker.constants.WEEK_NAME[indx]:Timetracker.constants.WEEK_NAME[0]},getDayOfMonth:function(val,isLastDayInLowerCase){return val>0&&val<32?val+this.getNumberSuffix(val):32===val?isLastDayInLowerCase?ZPI18N.getString("zp.slastday"):ZPI18N.getString("zp.lastday"):1+this.getNumberSuffix(1)},getUserTimeZoneCurrDateTime:function(){var userDateTime=new Date;return userDateTime.setTime(ZPDateTime.convertToTimezone(userDateTime.getTime()+60*userDateTime.getTimezoneOffset()*1e3)),userDateTime}},Timetracker.Hours={convertMinsToHrs:function(mins,decimal){return(!ZPUtil.Validation.isNumber(decimal)||decimal<0||decimal>2)&&(decimal=2),(mins/60).toFixed(decimal)},convertSecToTimeFormat:function(sec){var timeStr="";if(ZPUtil.Validation.isNumber(sec)&&(timeStr=Calendar.minstotimeFormat((sec-sec%60)/60),Calendar.is12HrFormat())){var meridian=timeStr.substr(timeStr.length-2);return"AM"===meridian?meridian=ZPI18N.getString("zp.am"):"PM"===meridian&&(meridian=ZPI18N.getString("zp.pm")),timeStr.substr(0,timeStr.length-2)+meridian}return timeStr}},Timetracker.Util={isVersionFive:function(){return showNewTab||-1!=Layout.Page.hash.indexOf("#settings")||-1!=Layout.Page.hash.indexOf("projectdashboard")&&Timetracker.projects.isFromOperations},getLayout:function(){return Layout.Page.hash&&(0==Layout.Page.hash.indexOf("#settings")||0==Layout.Page.hash.indexOf("#operations")||Timetracker.UserSpace.isMySpace())?settingsPage.container:Layout.Page.container},setLayout:function(dom){Layout.Page.container=$(dom)},tabChangeCallback:function(callback){ZP5Views.restViewPage(),callback()},addEventListner:function(Id,eventType,callBack,rmPrevLsnr){var layout=void 0!=Id?Timetracker.Util.getLayout().find("#"+Id):Timetracker.Util.getLayout();rmPrevLsnr?layout.off().on(eventType,callBack):layout.on(eventType,callBack)},getFailureMessageByCode:function(code,extraDtls,excludeParse){var error_msg=ZPI18N.getString("zp.ttfailuremsg");if((code=code&&!excludeParse?parseInt(code):code)===Timetracker.constants.ERROR_CODES.NO_PERM_CODE)error_msg=ZPI18N.getString("zp.ttpermdenied");else if(code===Timetracker.constants.ERROR_CODES.TAB_DISABLED)error_msg=ZPI18N.getString("zp.tttabdisabled");else if(code==Timetracker.constants.ERROR_CODES.RECORD_NOT_FOUND)error_msg=ZPI18N.getString("zp.recordnotfound");else if(code===Timetracker.constants.ERROR_CODES.TS_SETTING_ALREADY_AVAIL){var avail_cnt=extraDtls&&extraDtls.avail_cnt?extraDtls.avail_cnt:1;error_msg=ZPI18N.getString("zp.useralreadymappedsett",[avail_cnt])}else if(code===Timetracker.constants.ERROR_CODES.TS_USER_NOT_IN_JOB)error_msg=ZPI18N.getString("zp.usernotinjob");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMERDISABLED)error_msg=ZPI18N.getString("zp.timeralert9");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ANOTHER_TIMER_RUNNING)error_msg=ZPI18N.getString("zp.timerlogalert6");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_FOR_OTHERUSER)error_msg=ZPI18N.getString("zp.timeralert7");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_PREDOJ_RESTRICT)error_msg=ZPI18N.getString("zp.timeralert22");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_JOBSCH_TL_RESTRICT)error_msg=ZPI18N.getString("zp.timeralert23");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ESTIMATEDHOURRESTRICT)error_msg=ZPI18N.getString("zp.timeralert10");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAXLOGHOURRESTRICT){var action=extraDtls&&extraDtls.text1?extraDtls.text1:"",perday_week=extraDtls&&extraDtls.text2?"day"===extraDtls.text2?"day":"week":"";error_msg=ZPI18N.getString("zp.loghrsexceedmaxhrstimererror",[action,perday_week])}else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_RESTRICTTIMELOGINLEAVES)error_msg=ZPI18N.getString("zp.timeralert18",[holiday_disName]);else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMELOG_ENTRY_OVERLAP)error_msg=ZPI18N.getString("zp.tlweb.overlap");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMELOG_NO_NEWROW)error_msg=ZPI18N.getString("zp.timeralert6");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_INTERVAL_OVERLAP)error_msg=ZPI18N.getString("zp.timer.editoverlap");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_INTERVAL_24HOURS_CROSSED)error_msg=ZPI18N.getString("zp.timeexceeded24");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_INTERVAL_INVALID)error_msg=extraDtls.msg?extraDtls.msg:ZPI18N.getString("zp.attendance.regInvalidToEntry");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_FUTURE_ENTRIES_ERROR)error_msg=ZPI18N.getString("zp.timer.futureintervalfound");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_EDIT_DEL_BILLED_APP){var del_edit=extraDtls&&extraDtls.text?extraDtls.text:"edit/delete";error_msg=ZPI18N.getString("zp.timeralert19",[del_edit])}else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMERALREADYSTOPPED)error_msg=ZPI18N.getString("zp.alreadytimerstopped");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ANOTHER_TIMER_RUNNING)error_msg=ZPI18N.getString("zp.timeralert8");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMELOG_DEL_JOB){var jobName=Timetracker.util.jobDispName;error_msg=ZPI18N.getString("zp.timeralert1",[jobName])}else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMELOG_COMPLETED_JOB){jobName=Timetracker.util.jobDispName;error_msg=ZPI18N.getString("zp.timeralert2",[jobName])}else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMERSTART)error_msg=ZPI18N.getString("zp.timeralert11");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_RESTRICTFUTURETIMELOG)error_msg=ZPI18N.getString("zp.timeralert17");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_BILLED)error_msg=ZPI18N.getString("zp.logalert12");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_SUBMITTED_OR_APPROVED_OR_PENDING)error_msg=ZPI18N.getString("zp.logalert13");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMELOG_ALREADY_APPROVED)error_msg=ZPI18N.getString("zp.timeralert3");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMELOG_REJECTED)error_msg=ZPI18N.getString("zp.timeralert4");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMELOG_WAITING_APPROVAL)error_msg=ZPI18N.getString("zp.timeralert5");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMELOG_ALREADY_BILLED)error_msg=ZPI18N.getString("zp.timeralert6");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIME_EXCEED_ERROR)error_msg=ZPI18N.getString("zp.timeexceeded24");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_NEXT_DAY)error_msg=ZPI18N.getString("zp.timerstopped");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_EDIT_DEL_PERM){action=extraDtls&&extraDtls.text?extraDtls.text:"";error_msg=ZPI18N.getString("zp.timeralert12",[action])}else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MANUALLOGDISABLED)error_msg=ZPI18N.getString("zp.logalert2");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_FROMTOTIMELOGDISABLED)error_msg=ZPI18N.getString("zp.logalert8");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ZEROHOURSRESTRICT)error_msg=ZPI18N.getString("zp.logalert9");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ATTCHECKINTIMERSTART)error_msg=ZPI18N.getString("zp.timeralert24");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_PERMISSIONDENIED)error_msg=ZPI18N.getString("zp.timerlogalert5");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_PAYPERIOD){var payperiod_date=extraDtls&&extraDtls.date?extraDtls.date:"";error_msg=ZPI18N.getString("zp.tspayperioderror",[payperiod_date])}else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_BUDGET)error_msg=ZPI18N.getString("zp.tsbudgeterror");else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.IPRESTRICTION)error_msg=ZPI18N.getString("zp.geoiprestriction",["IP"]);else if(code===Timetracker.constants.ERROR_CODES.TIMELOG.GEORESTRICTION){error_msg=!0===(!!Timetracker.util.geoerrorreturn||"")?ZPI18N.getString("zp.geoiprestriction",["Geo"]):ZPI18N.getString("zp.enableaccesstolocation")}else error_msg=code===Timetracker.constants.ERROR_CODES.BUDGET.ER_NOT_DEPT_LEAD?ZPI18N.getString("zp.tsbudgetnotadeptlead"):code===Timetracker.constants.ERROR_CODES.BUDGET.ER_BUDGET_OVERLAP?ZPI18N.getString("zp.tsbudgetoverlap"):code===Timetracker.constants.ERROR_CODES.BUDGET.ER_BUDGET_APPROVAL?ZPI18N.getString("zp.tsbudgetapproval"):code===Timetracker.constants.ERROR_CODES.BUDGET.ER_BUDGET_NOT_IN_WEEK?ZPI18N.getString("zp.tsbudgetnotinweek"):code===Timetracker.constants.ERROR_CODES.BUDGET.ER_BUDGET_DATE_CMP?ZPI18N.getString("zp.greaterfromdate"):code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAPPING_ERROR?ZPI18N.getString("zp.invalidmapping"):code===Timetracker.constants.ERROR_CODES.DATE_RANGE_MONTH_DIFF_CODE?ZPI18N.getString("zp.daterangewithinonemonth"):code===Timetracker.constants.ERROR_CODES.DATE_RANGE_YEAR_DIFF_CODE?ZPI18N.getString("zp.datewithindays",["366"]):code===Timetracker.constants.ERROR_CODES.DATE_RANGE_THREE_MONTH_DIFF_CODE?ZPI18N.getString("zp.datewithindays",["92"]):code===Timetracker.constants.ERROR_CODES.TIMESHEET.PERM_DENIED_TO_CREATE?ZPI18N.getString("zp.timesheetcreationnotallowed"):code===Timetracker.constants.ERROR_CODES.TIMESHEET.NO_TIMELOGS_FOUND?ZPI18N.getString("zp.nologhours",[ZPI18N.getString("zp.smallsubmit")]):code===Timetracker.constants.ERROR_CODES.TIMESHEET.DATE_LIMIT_EXCEED?ZPI18N.getString("zp.timesheetcreationerrormessage6"):code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ATTENDANCEHOURS?ZPI18N.getString("zp.timeralert20"):code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_RESTRICTPRESENT_JOBPERIOD?ZPI18N.getString("zp.timeralert21",[ZPI18N.getString("zp.smallthepresentdate"),Timetracker.util.getJobDisplayName(!0),Timetracker.jobs.formDetails.labelDetails.STARTDATE,Timetracker.jobs.formDetails.labelDetails.ENDDATE]):code===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_RESTRICTTIMELOGDATE_JOBPERIOD?ZPI18N.getString("zp.timeralert21",[ZPI18N.getString("zp.tldate"),Timetracker.util.getJobDisplayName(!0),Timetracker.jobs.formDetails.labelDetails.STARTDATE,Timetracker.jobs.formDetails.labelDetails.ENDDATE]):code===Timetracker.constants.ERROR_CODES.JOBSCHEDULE.ER_TS_JOBSCHD_IMPORT_ROWSERROR?ZPI18N.getString("zp.jbschimportcountexceederror",["1000"]):code===Timetracker.constants.ERROR_CODES.INTEGRATION.ZPRJCTS.NOT_PORTAL_ADMIN?ZPI18N.getString("zp.prjctsync.notaportaladmin"):code===Timetracker.constants.ERROR_CODES.INTEGRATION.ZPRJCTS.PORTAL_UPGRADE_ERROR?ZPI18N.getString("zp.prjctsync.portalnotupgradederror"):code===Timetracker.constants.ERROR_CODES.INTEGRATION.ZPRJCTS.PROJECT_ALREADY_CREATED?ZPI18N.getString("zp.prjctsync.zprojectalreadycreated"):code===Timetracker.constants.ERROR_CODES.INTEGRATION.ZPRJCTS.PERM_DENIED_TO_CREATE_PROJECT?ZPI18N.getString("zp.prjctsync.permdeniedtocreateproject"):code===Timetracker.constants.ERROR_CODES.INTEGRATION.ZPRJCTS.NO_PORTALS_AVAILABLE?ZPI18N.getString("zp.prjctsync.noportalsavailable"):code===Timetracker.constants.ERROR_CODES.INTEGRATION.ZPRJCTS.SYNC_INPROGRESS?ZPI18N.getString("zp.prjctsync.syncinprogress"):code===Timetracker.constants.ERROR_CODES.INTEGRATION.ZPRJCTS.ENABLED_DISABLED?ZPI18N.getString("zp.prjctsync.settingenableddisabled"):code===Timetracker.constants.ERROR_CODES.INVALID_DATE?ZPI18N.getString("zp.invaliddateerr"):code===Timetracker.constants.ERROR_CODES.INTEGRATION.ZCRM.NO_ACCOUNT?ZPI18N.getString("zp.zcrm.nocrmaccount"):extraDtls&&extraDtls.errorMsg?extraDtls.errorMsg:ZPI18N.getString("zp.ttfailuremsg");return error_msg},displayFailureMessage:function(message,isPageView){message?message.toLowerCase()===Timetracker.constants.PERM_DENIED.toLowerCase()?isPageView?Timetracker.util.appendPermissionDenied(!0):Timetracker.util.showAlert(0,ZPI18N.getString("zp.permdenied")):message.toLowerCase()===Timetracker.constants.TS_DATE_RANGE_YEAR_DIFF_ER.toLowerCase()?Timetracker.util.showAlert(0,ZPI18N.getString("zp.daterangewithinoneyear")):message.toLowerCase()===Timetracker.constants.TS_DATE_RANGE_WEEK_DIFF_ER.toLowerCase()?Timetracker.util.showAlert(0,ZPI18N.getString("zp.daterangewithinoneweek")):message.toLowerCase()===Timetracker.constants.TS_DATE_RANGE_MONTH_DIFF_ER.toLowerCase()?Timetracker.util.showAlert(0,ZPI18N.getString("zp.daterangewithinonemonth")):Timetracker.util.showAlert(0,message):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg"))},handleTablePosition:function(){ZPView.handleTablePosition()},resetTablePosition:function(){Layout.Page.container.find("[statictable=true]:visible").closest(".Scrcont").removeClass("section"),ZPView.resetTablePosition()},handleTableHeader:function(){if(0!==Layout.Page.container.find("#day_view_jobsch").length)Timetracker.jobSchedule.setPositionForHeader();else if(-1!==Layout.Page.hash.indexOf("timetracker/timelogs/listview")&&(Layout.Page.container.find("#addweeklyLog").is(":visible")||Layout.Page.container.find("#addhalfmonthlyLog").is(":visible")||Layout.Page.container.find("#addmonthlyLog").is(":visible"))){if(Layout.Page.container.find("#addweeklyLog").is(":visible"));else if(Layout.Page.container.find("#addmonthlyLog").is(":visible"));else if(Layout.Page.container.find("#addhalfmonthlyLog").is(":visible"));}else{if(!Layout.Page.container.find(".Scrcont").hasClass("fixTable"))return;var tableCont=Layout.Page.container.find(".Scrcont table:first");if(tableCont.length){var headerCont=tableCont.find("thead:visible"),layoutLefPos=Layout.Page.container.offset().left,bodyLeft=tableCont.offset().left;headerCont.css("left",bodyLeft+"px"),headerCont.find("th:first").css("left",layoutLefPos+"px"),tableCont.parent().off("scroll").on("scroll",function(){headerCont.css("left",tableCont.parent().offset().left-$(this).scrollLeft()+"px")});var headTh=headerCont.find("> tr > th"),bodyTd=tableCont.find("tbody[bodyCont=true]:visible > tr > td");headTh.each(function(indx){if($(this).outerWidth(bodyTd.eq(indx).outerWidth()),$(this).find("table.i_table:visible").length&&bodyTd.eq(indx).find("table.i_table:visible").length){var childHeadTr=$(this).find("table.i_table:visible > tbody > tr").not(":first"),childBodyTr=bodyTd.eq(indx).find("table.i_table:visible > tbody > tr");$(childHeadTr).outerWidth(childBodyTr.outerWidth()),$(childHeadTr).siblings("tr").outerWidth(childBodyTr.outerWidth());var childHeadTh=childHeadTr.children(),childBodyTd=childBodyTr.children();childHeadTh.each(function(index){$(this).outerWidth(childBodyTd.eq(index).outerWidth())})}})}}},getSortAscendingValues:function(name,params){var sortType="0",isAscending=!0;return params||(params={}),Timetracker.Validations.isDefiniteValue(Timetracker.generalSettings.userBasedSettings)&&(Timetracker.Validations.isDefiniteValue(Timetracker.generalSettings.userBasedSettings[name+"SortType"])&&(sortType=Timetracker.generalSettings.userBasedSettings[name+"SortType"]),Timetracker.Validations.isDefiniteValue(Timetracker.generalSettings.userBasedSettings[name+"SortOrder"])&&(isAscending="1"!==Timetracker.generalSettings.userBasedSettings[name+"SortOrder"])),params.sortType=sortType,params.isAscending=isAscending,params},gettokenFiledValues:function(obj,reqID){var values=ZPeopleComponents.tokenfield(obj).getAllValues(),res=[];return $.each(values,function(ind,data){var id=void 0==reqID?"id":reqID;res.push(data[id])}),res},mandOptnErrMsg:function(id,pageContainer,msg){return pageContainer.find("#"+id).append('<div class="ztextbox--error__label MB10">'+(msg||ZPI18N.getString("zp.selectoption"))+"</div>"),{isError:!0}},appenErrorMsgForElem:function(json){if(json.obj&&0!=json.obj.length){if(Timetracker.Util.addError(json.obj),json.msg){(json.appendTo||$(json.obj).parent()).append('<span id="'+(json.errorDivId?json.errorDivId:"errorDiv")+'" class="ztextbox--error__label">'+json.msg+"</span>")}json.isScrollViewNotNeeded||$(json.obj)[0].scrollIntoView({behavior:"smooth",block:"center"})}},addError:function(obj){obj=Timetracker.Util.getZComponentElement(obj),$(obj).addClass("ztextbox__error")},removeError:function(obj){obj=Timetracker.Util.getZComponentElement(obj),$(obj).removeClass("ztextbox__error")},getZComponentElement:function(obj){if(ZPeopleComponents.isComponent($(obj))){var compName=$(obj).data("componentName");"zselect"==compName?obj=ZPeopleComponents.select($(obj)).getElement():"ztimefield"==compName?obj=ZPeopleComponents.timefield($(obj)).getElement():"zdatefield"==compName?obj=ZPeopleComponents.datefield($(obj)).getElement():"ztokenfield"==compName?obj=ZPeopleComponents.tokenfield($(obj)).getElement():"zdatetimefield"==compName&&(obj=ZPeopleComponents.datetimefield($(obj)).getElement())}return obj},showHideNoData:function(obj){var layout=(obj=obj||{}).layout?obj.layout:Timetracker.Util.getLayout(),pageContainer=obj.div?obj.div:layout;if(pageContainer=obj.divId?pageContainer.find("#"+obj.divId):pageContainer,"undefined"!=typeof EmptyPages)if(obj.remove){if(0===pageContainer.find("#zp_empty_data").find("#emptPage").length)return;pageContainer.find("#emptPage").hide(),TimelySettings.showHideTopBand(!0)}else{0===pageContainer.find("#zp_empty_data").length&&(obj.divId||obj.appendToDiv?pageContainer.append("<div id='zp_empty_data'></div>"):pageContainer.find(".zpl_rgtcnt").append("<div id='zp_empty_data'></div>"));var div=pageContainer.find("#zp_empty_data");if(div.show(),0==div.find("#emptPage").length||obj.cls){let cls=obj.cls||"zp_nd_nodata",emptyhtml=new EmptyPages(cls,obj.msg?obj.msg:ZPI18N.getString("zp.nodatafound"),obj.desc?obj.desc:"",div);obj.buttonName&&obj.buttonCallBack&&emptyhtml.setButton(obj.buttonName,obj.buttonCallBack),emptyhtml.show()}else div.find("#emptPage").show();TimelySettings.showHideTopBand()}},constructMoreOption:function(moreopt,Id,forElementId,isCustomView,extraDtls){if(moreopt.length>0){var container,mhtml='<div id="'+Id+'" class="zpl_drpdwn zmenu" data-type="list" ';extraDtls&&extraDtls.skipIcon&&!0===extraDtls.skipIcon||(mhtml+='data-content-type="icon-text"'),mhtml+=' role="menu"><ul data-body="true" class="zmenu__body">',$.each(moreopt,function(indx,value){value.iClass?(mhtml+='<li data-action="'+value.callback+'" data-icon-class="'+value.iClass+'" id="'+value.id+'" class="zmenu__item'+(value.listClass?" "+value.listClass:"")+'">',mhtml+='<div class="zmenu__iconcontainer"><i class="zmenu__icon '+value.iClass+'"></i></div>'):value.separator?mhtml+='<li class="zmenu__separator" data-item-type="separator" role="separator"></li>':mhtml+='<li id="'+value.id+'" class="zmenu__item" data-action="'+value.callback+'">',value.separtor||(mhtml+='<span class="zmenu__text">'+value.name+"</span></li>")}),mhtml+="</ul></div>",isCustomView?container=Timetracker.Util.getMainContainer():extraDtls&&extraDtls.container?(container=extraDtls.container,forElementId=Id+"Btn"):(container=Timetracker.Util.getMainContainer(),forElementId=Id+"Btn"),container.find("#"+Id).remove(),container.append(mhtml);var prop={forElement:"#"+forElementId};extraDtls&&extraDtls.appendTo&&(prop.appendTo=extraDtls.appendTo),ZPeopleComponents.menu("#"+Id,prop),container.find("#"+forElementId).off().on("click",()=>{ZPeopleComponents.menu("#"+Id).show()}),extraDtls&&extraDtls.direction&&ZPeopleComponents.menu(container.find("#"+Id)).setAttribute("direction",extraDtls.direction),extraDtls&&extraDtls.title&&settingsPage.container.find("#"+forElementId).attr("title",extraDtls.title)}},constructOptionListing:function(moreopt,Id){if(Object.keys(moreopt).length>0){ZPeopleComponents.isComponent(settingsPage.container.find("#"+Id))&&(ZPeopleComponents.menu("#"+Id).destroy(),settingsPage.container.find("#"+Id).remove());var mhtml='<div id="'+Id+'" class="zpl_drpdwn zpl_tagdrpdwn zmenu zposition--bottomright zh-radiustopright" data-type="list"><ul data-body="true" style="height: auto;">';let count=0;$.each(moreopt,function(key,name){count>2&&(mhtml+='<li data-item-type="custom"><div class="zpl_tg"><span title="'+name+'">'+name+"</span></div></li>"),count++}),mhtml+="</ul></div>",$(settingsPage.container).append(mhtml);let forElementId=Id+"Btn";ZPeopleComponents.menu("#"+Id,{forElement:"#"+forElementId,appendTo:settingsPage.container})}},constZPLocFilter:function(id,param,extraDtls,pageContainer,isOptionsNeeded){param.submode===Timetracker.constants.Perm.SETTINGS?Timetracker.Location.settings_loc_list.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues):Timetracker.Location.loc_List.load&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues);var locList=param.submode===Timetracker.constants.Perm.SETTINGS?Timetracker.Location.settings_loc_list:Timetracker.Location.loc_List,options=[];for(var index in locList){var obj={};obj.value=locList[index].locationId,obj.label=ZPeople.decodeTxt(locList[index].locationName),options.push(obj)}if(isOptionsNeeded)return options;var arr={};arr.data=options,TimelyZComp.tokenField.intialize(pageContainer.find("#"+id),arr,!0)},getMainContainer:function(){let layout=$(settingsPage.mainWrapId);return 0===layout.length&&(layout=settingsPage.container),layout},confirmpopUp:function(Id,callBack,callBackparams,type,extraDtls){extraDtls||(extraDtls={});var func=ModuleComp.Modal.delete;1==type?func=ModuleComp.Modal.confirm:2==type&&(func=ModuleComp.Modal.info),Timetracker.Util.confirmpopUpExtraDtls(extraDtls,type),void 0!==callBack&&void 0!==Id&&func(function(){callBack(callBackparams)},extraDtls.header,extraDtls.body,extraDtls.btnVal,{calId:Id},extraDtls.cancelButtonValue,extraDtls.hiddenCallback)},confirmpopUpExtraDtls:function(dtls,type){dtls.module;var header="",body=ZPI18N.getString("zp.doyouwishtoproceed"),button=ZPI18N.getString("zp.confirm");return 1==type?header=ZPI18N.getString("zp.confirm"):2==type?(header=ZPI18N.getString("zp.alert"),button=ZPI18N.getString("zp.proceed")):(header=dtls.header?dtls.header:ZPI18N.getString("zp.delete"),body=-1==settingsUrlProps.niceUrl.indexOf("settings/")?ZPI18N.getString("zp.tt.commmon.deletepopupdescforrecord"):ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.sconfig")]),button=ZPI18N.getString("zp.confirm")),dtls.header=dtls.header?dtls.header:header,dtls.body=dtls.body?dtls.body:body,dtls.btnVal=dtls.btnVal?dtls.btnVal:button,dtls},isCurrentPage:function(key){let pageId;switch(key){case Timetracker.constants.SETTINGS.MODE.TIMELOGSETTINGS:pageId="timelogs";break;case Timetracker.constants.SETTINGS.MODE.TIMESHEETSETTINGS:pageId="timesheets";break;case Timetracker.constants.SETTINGS.MODE.SPECIFICPOLICY:pageId="specificpolicies";break;case Timetracker.constants.SETTINGS.MODE.REMAINDER:pageId="reminders";break;case Timetracker.constants.SETTINGS.MODE.TIMESHEETSCHEDULER:pageId="timesheetscheduler";break;case Timetracker.constants.SETTINGS.MODE.OVERTIMEPOLICY:pageId="overtimepolicy"}return!!pageId&&-1!==settingsUrlProps.niceUrl.indexOf(pageId)},getOverlappingTime:function(base_from_mins,base_to_mins,input_from_mins,input_to_mins){var overlapMins=0;return input_to_mins>=base_from_mins&&input_from_mins<=base_to_mins&&(overlapMins=(input_to_mins>base_to_mins?base_to_mins:input_to_mins)-(input_from_mins<base_from_mins?base_from_mins:input_from_mins)),overlapMins},findJSONArrayIndex:function(dataArray,keyValue,keyName){var index=-1;if(dataArray&&keyValue&&keyName)for(var i in dataArray)if(dataArray[i][keyName]===keyValue){index=i;break}return index},getRecordsFromCache:function(cache,searchText,sIndex,limit,extraDtls){if(void 0==sIndex||null==sIndex)return cache;if(cache)if(searchText&&""!=searchText){if(!cache[searchText])return Timetracker.Util.getRecordSearchResultsFromSubString(cache,searchText,sIndex,limit,extraDtls);if(0==cache[searchText].length)return[];if(cache[searchText].length>=sIndex)return cache[searchText].slice(sIndex,sIndex+limit)}else{if(0==cache.length)return[];if(cache.length>=sIndex)return cache.slice(sIndex,sIndex+limit)}return null},getRecordSearchResultsFromSubString:function(cache,searchText,sIndex,limit,extraDtls){if(0==sIndex&&searchText.length>1){let tempSearchResults=null,tempSearchText=searchText.substring(0,searchText.length-1);for(;tempSearchText.length>0;){if(cache[tempSearchText]){cache[tempSearchText].length<limit&&(tempSearchResults=cache[tempSearchText]);break}tempSearchText=tempSearchText.substring(0,tempSearchText.length-1)}if(null!=tempSearchResults){let searchResults=[],recordNameKey=extraDtls&&extraDtls.recordNameKey?extraDtls.recordNameKey:"name";return $.each(tempSearchResults,function(index,data){-1!==data[recordNameKey].toLowerCase().indexOf(searchText.toLowerCase())&&searchResults.push(data)}),cache[searchText]=searchResults,searchResults}}return null}},Timetracker.Validations={isDefiniteValue:function(value){return void 0!==value&&null!==value},isEmpty:function(value){return ZPUtil.Validation.isEmpty(value)},isDecimal:function(value,precision){if(value&&""!==value.trim()&&value.match(Timetracker.util.rateRegex)){if(void 0!==precision&&value.indexOf(".")>=0){var valueAfterDecimalPoint=value.split(".")[1];return""===valueAfterDecimalPoint||valueAfterDecimalPoint.length<=precision}return!0}return!1},isHours:function(value){return value&&(value.match(Timetracker.util.jobAddhrsRegex)||value.match(Timetracker.util.timeRegex))&&""!==value.trim()},isTrue:function(json,key){return this.isDefiniteValue(json)&&this.isDefiniteValue(json[key])&&1==json[key]},isNumber:function(value){return ZPUtil.Validation.isNumber(value)}},Timetracker.events={registerEvents:function(layout,callback){ZPUtil.Validation.isFunction(callback)&&(layout=layout?$(layout):Layout.Page.container,$(".ZP-SwitchView",layout).each(function(){var cur_ele=$(this);cur_ele.hasClass("ZP-SwitchView")&&cur_ele.off("click").on("click",callback)}))}},Timetracker.mailAlert={mailAlertId:null,formId:null,openAlert:function(isV5){null!=Timetracker.mailAlert.mailAlertId&&null!=Timetracker.mailAlert.formId?Timetracker.mailAlert.editMailAlertTemplate(Timetracker.mailAlert.mailAlertId,Timetracker.mailAlert.formId,isV5):(params={mode:"getTSMailAlertDetails",conreqcsr:csrfToken},$.post(Timetracker.constants.URL,params,function(result){void 0!=result&&void 0!=result.mailAlertId&&void 0!=result.formId?(Timetracker.mailAlert.mailAlertId=result.mailAlertId,Timetracker.mailAlert.formId=result.formId,Timetracker.mailAlert.editMailAlertTemplate(result.mailAlertId,result.formId,isV5)):Timetracker.util.showAlert(1,ZPI18N.getString("zp.nomailconfigured"),isV5)}))},editMailAlertTemplate:function(templateId,formid,isV5){isV5?ZPA_MailAlert.edit(templateId,formid):(Mailalerts.edit(templateId,formid),Layout.Page.container.find("#mailalert").removeClass("zpl_DNI"),Layout.Page.container.find("#mailalert #malertBodyCont #dvShowmail").remove(),Layout.Page.container.find("#mailalert #malertBodyCont #recTempAttDiv").remove(),Layout.Page.container.find("#mailalert #malertBodyCont #toInputTag").closest(".form-group").addClass("NM OP5"),Layout.Page.container.find("#mailalert #mailAlertFormId").addClass("zpl_DNI"),Layout.Page.container.find("#mailalert #mAlertName").closest(".form-group").addClass("NM OP5"),Layout.Page.container.find("#mailalert #malertBodyCont #messageOptDiv #newTemplateDiv").closest(".form-group").addClass("zpl_DNI"),Layout.Page.container.find("#mailalert #malertBodyCont #tempListDD").hide())},callbackByAction:function(){Layout.Page.container.find("#mailalert").addClass("zpl_DNI")}},Timetracker.constants={TIMETRACKER:"timetracker",URL:"/timesheetDispAction.zp",URLS:{reports:"/timetracker/report"},tableNames:["P_Timesheet","P_TimesheetJob","P_TimesheetJobsList","P_ClientDetails"],TIMELOG_TABLE:"P_Timesheet",JOB_TABLE:"P_TimesheetJob",PROJECT_TABLE:"P_TimesheetJobsList",CLIENT_TABLE:"P_ClientDetails",TIMESHEET_TABLE:"P_TimesheetList",TIMELOG:"timelog",TIMESHEET:"timesheet",JOB:"job",PROJECT:"project",PROJECTDASHBOARD:"projectdashboard",CLIENT:"client",BREAK:"break",WORKITEM:"workitem",DESC:"description",ATTACHMENT:"attachment",BILLABLE_STATUS:"Billable_Status",WORKDATE:"WORKDATE",TOTALHOURS:"TOTALHOURS",BILLABLE:"BILLABLE",FROMTIME:"FROMTIME",TOTIME:"TOTIME",AUDIT_FLD_DISPNAMES:{BILLABLE:ZPI18N.getString("zp.billablestatus"),WORKDATE:ZPI18N.getString("zp.date"),FROMTIME:ZPI18N.getString("zp.fromtime"),TOTIME:ZPI18N.getString("zp.totime"),TOTALHOURS:ZPI18N.getString("zp.totalhours")},ADD:"add",EDIT:"edit",VIEW:"view",DAY:"day",WEEK:"week",MONTH:"month",HALFMONTH:"halfmonth",CUSTOM:"Custom",LEAVE_TYPE:{PAID:0,ONDUTY:1,ABSENT:2,UNPAID:3,COMP_OFF:4,RESTRICTED_HOLIDAY:5,WEEKEND:6},MAX_LOGHRS_PERDAY:6e4,MAX_LOGHRS_PERWEEK:42e4,PER_DAY_MIN:1440,PER_DAY_LAST_MIN:1439,PER_DAY_SEC:86400,MINUTES:"minutes",SECONDS:"seconds",DEPARTMENT:"department",USER:"user",DIVISION:"division",LOCATION:"location",CLIENT_CONST:1,PROJECT_CONST:2,JOB_CONST:3,TIMELOG_CONST:4,TIMESHEET_CONST:5,DEFAULT_FIRESCROLL_LIMIT:25,SELECT_OPTLIMIT:25,SELECT_OPT_ALL:"#",PERM_DENIED:"Permission denied",TS_DATE_RANGE_YEAR_DIFF_ER:"TS_DATE_RANGE_YEAR_DIFF_ER",TS_DATE_RANGE_WEEK_DIFF_ER:"TS_DATE_RANGE_WEEK_DIFF_ER",TS_DATE_RANGE_MONTH_DIFF_ER:"TS_DATE_RANGE_MONTH_DIFF_ER",JOB_SCHD_REPORT:{SUMMARY:"summary",DETAILED:"detailed"},DOWNLOAD_TYPES:{PDF:"pdf",XLS:"xls",CSV:"csv",XLSX:"xlsx",TSV:"tsv",ADPCSV:"adpCsv",SUPCSV:"supCsv"},TS_PERIOD:{ANY_DATE_RANGE:"-1",DAY:"0",WEEK:"1",MONTH:"2"},NUMBER_SUPERSCRIPT:{1:"st",2:"nd",3:"rd",4:"th"},WEEK_NAME:[ZPI18N.getString("zp.sunday"),ZPI18N.getString("zp.monday"),ZPI18N.getString("zp.tuesday"),ZPI18N.getString("zp.wednesday"),ZPI18N.getString("zp.thursday"),ZPI18N.getString("zp.friday"),ZPI18N.getString("zp.saturday")],integration:{zcrm:"ZohoCRM",qb:"QuickBooks",zb:"Zoho Books",zi:"Zoho Invoice",zf:"Zoho Finance Suite",zprjct:"Zoho Projects",DISABLE_CURRENT:0,ENABLE_CURRENT:1},widgets:{TIMELOGS:"TIMELOGS",TIMESHEETS:"TIMESHEETS",PENDINGJOBS:"PENDINGJOBS",BILLABLE_NONBILLABLE:"BILLABLE_NONBILLABLE"},TTCustomAdmin:{ReportView:"TTReportViewAdmin",EntryView:"TTEntryViewAdmin",EntryEdit:"TTEntryEditAdmin"},Perm:{DATA:"TIMETRACKER_DATA",SETTINGS:"TIMETRACKER_SETTINGS",FORMS:"TIMETRACKER_FORMS",REPORTS:"TIMETRACKER_REPORTS"},ERROR_CODES:{NO_PERM_CODE:9e3,GENERAL_ERROR:9001,TAB_DISABLED:9005,RECORD_NOT_FOUND:9008,TS_SETTING_ALREADY_AVAIL:2e3,TS_USER_NOT_IN_JOB:1025,INVALID_DATE:"INVALID_DATE_001",DATE_RANGE_MONTH_DIFF_CODE:"RANGE_001",DATE_RANGE_YEAR_DIFF_CODE:"RANGE_002",DATE_RANGE_THREE_MONTH_DIFF_CODE:"RANGE_003",BUDGET:{ER_NOT_DEPT_LEAD:9020,ER_BUDGET_OVERLAP:9021,ER_BUDGET_APPROVAL:9022,ER_BUDGET_NOT_IN_WEEK:1027,ER_BUDGET_DATE_CMP:1030},TIMELOG:{IPRESTRICTION:"IP_011",GEORESTRICTION:"GEO_012",ER_TL_TIMERDISABLED:"TL_0001",ANOTHER_TIMER_RUNNING:"TIME_007",ER_TL_ESTIMATEDHOURRESTRICT:"TL_0007",ER_TL_MAXLOGHOURRESTRICT:"TL_0006",ER_TL_LOGHOUREXCEEED24HR:"TL_0009",ER_TL_PAYPERIOD:"TL_0004",ER_TL_BUDGET:"TL_0013",TIMER_FOR_OTHERUSER:"TIME_005",ER_TL_TIMERSTART:"TL_0005",ER_TL_RESTRICTTIMELOGINLEAVES:"TL_0011",ER_TL_RESTRICTPASTTIMELOG:"TL_0030",ER_TL_RESTRICTFUTURETIMELOG:"TL_0010",ER_TL_PERMISSIONDENIED:"TT_0000",ER_TL_MANUALLOGDISABLED:"TL_0002",ER_TL_FROMTOTIMELOGDISABLED:"TL_0020",ER_TL_ZEROHOURSRESTRICT:"TL_0021",ER_TL_ATTCHECKINTIMERSTART:"TL_0029",ER_TL_MAPPING_ERROR:"TL_9065",TIME_EXCEED_ERROR:"TIME_011",TIMER_NEXT_DAY:"TIME_012",TIMELOG_DEL_JOB:"TIME_017",TIMELOG_COMPLETED_JOB:"TIME_018",TIMELOG_ALREADY_APPROVED:"TIME_013",TIMELOG_REJECTED:"TIME_014",TIMELOG_WAITING_APPROVAL:"TIME_015",TIMELOG_ALREADY_BILLED:"TIME_016",TIMER_EDIT_DEL_PERM:"TIME_019",TIMER_EDIT_DEL_BILLED_APP:"TIME_020",TIMELOG_NO_NEWROW:"TIME_021",TIMER_INTERVAL_OVERLAP:"TIME_022",TIMER_INTERVAL_24HOURS_CROSSED:"TIME_023",TIMER_INTERVAL_INVALID:"TIME_024",TIMER_FUTURE_ENTRIES_ERROR:"TIME_025",ER_TL_ATTENDANCEHOURS:"TL_0014",ER_TL_RESTRICTPRESENT_JOBPERIOD:"TL_0015",ER_TL_RESTRICTTIMELOGDATE_JOBPERIOD:"TL_0016",ER_TL_TIMERALREADYSTOPPED:"TL_0017",ER_TL_TIMELOG_ENTRY_OVERLAP:"TL_0018",ER_TL_TIMELOG_ENTRY_BREAK:"TL_0019",ER_TL_PREDOJ_RESTRICT:"TL_0027",ER_TL_JOBSCH_TL_RESTRICT:"TL_0028",ER_TL_MAND_FIELDS:7052,ER_TL_SUBMITTED_OR_APPROVED_OR_PENDING:"TL_0023",ER_TL_BILLED:"TL_0024",WORKITEMS:{TS_WORKITEM_NODATA_CODE:"TL_WI_0001",TS_WORKITEM_NOGENERALDATA_CODE:"TL_WI_0002"}},TIMESHEET:{PERM_DENIED_TO_CREATE:"TS_0001",NO_TIMELOGS_FOUND:"TS_0002",DATE_LIMIT_EXCEED:"TS_0003"},APPROVAL:{COMMENT_MANDATORY:"TS_APP_7328"},JOBSCHEDULE:{ER_TS_JOBSCHD_IMPORT_ROWSERROR:"TS_JOBSCHEDULE_001",ER_TS_JOBSCH_LOC_EXISTS:1033},INTEGRATION:{ZPRJCTS:{NOT_PORTAL_ADMIN:"ZPROJECTS_INTEG_001",PORTAL_UPGRADE_ERROR:"ZPROJECTS_INTEG_002",PROJECT_ALREADY_CREATED:"ZPROJECTS_INTEG_003",PERM_DENIED_TO_CREATE_PROJECT:"ZPROJECTS_INTEG_004",NO_PORTALS_AVAILABLE:"ZPROJECTS_INTEG_005",ENABLED_DISABLED:"ZPROJECTS_INTEG_016",SYNC_INPROGRESS:"ZPROJECTS_INTEG_015"},ZCRM:{NO_ACCOUNT:"ZCRM_INTEG_001"}}},RESPONSE_CODES:{FAILURE:0,WARNING:1,SUCCESS:2},MODES:{USERLOGHOURS_REPORT:"USERLOGHOURS_REPORT",PAYROLL_DRILLDOWN:"PAYROLL_DRILLDOWN",PAYROLL_REPORT:"PAYROLL_REPORT",INTEG_REPORT:"INTEG_REPORT",USER_TS_SETTINGS:"USER_TS_SETTINGS",TL_LISTVIEW:"TL_LISTVIEW",BILLING_REPORT:"BILLING_REPORT",CRM_LEADS:"CRM_LEADS",CRM_ACCOUNTS:"CRM_ACCOUNTS",CRM_CONTACTS:"CRM_CONTACTS",CRM_DEALS:"CRM_DEALS",CRM_LEADS_SEARCH:"CRM_LEADS_SEARCH",CRM_ACCOUNTS_SEARCH:"CRM_ACCOUNTS_SEARCH",CRM_CONTACTS_SEARCH:"CRM_CONTACTS_SEARCH",CRM_DEALS_SEARCH:"CRM_DEALS_SEARCH",PROJECT_DB_USERJOBS:"PROJECT_DB_USERJOBS",PROJECT_DB_LOGHRS:"PROJECT_DB_LOGHRS",PROJECT_DB_OVERDUEDAYS:"PROJECT_DB_OVERDUEDAYS",PROJECT_DB_TIMELOGS:"PROJECT_DB_TIMELOGS",PROJECT_DB_JOBS:"PROJECT_DB_JOBS",PROJECT_DB_USERS:"PROJECT_DB_USERS",PROJECT_DB_USERS_SEARCH:"PROJECT_DB_USERS_SEARCH",CLIENTS_LISTVIEW:"CLIENTS_LISTVIEW",CLIENTSOP_LISTVIEW:"CLIENTSOP_LISTVIEW"},FILTERS:{WEEKTIMELOGREPORT:"WEEKTIMELOGREPORT",MONTHTIMELOGREPORT:"MONTHTIMELOGREPORT",CUSTOMTIMELOGREPORT:"CUSTOMTIMELOGREPORT",TIMERREPORT:"TIMERREPORT",JOBREPORT:"JOBREPORT",PROJECTREPORT:"PROJECTREPORT",USERLOGHOURSREPORT:"USERLOGHOURSREPORT",PAYROLLREPORT:"PAYROLLREPORT",BILLINGREPORT:"BILLINGREPORT",CLIENTREPORT:"CLIENTREPORT",INTEGRATIONREPORT:"INTEGRATIONREPORT",JOBSCHEDULEREPORT:"JOBSCHEDULEREPORT"},PROJECT_ROLES:{USER:0,MANAGER:1,HEAD:2},SETTINGS:{MODE:{TIMELOGSETTINGS:"timelogSettings",TIMESHEETSETTINGS:"timesheetSettings",JOBSCHEDULESETTINGS:"jobScheduleSettings",OTHERSETTINGS:"otherSettings",SPECIFICPOLICY:"specificpolicy",EMPLOYEERPH:"payroll",TIMESHEETSCHEDULER:"timesheetscheduler",REMAINDER:"reminders",OVERTIMEPOLICY:"overtimepolicys"}}},Timetracker.ImportExport={showHideImportExportIcon:function(type,header){switch(header=void 0===header?Layout.Page.container:$(header),type){case Timetracker.constants.JOB:header.find("#jobImportIcon,#jobExportIcon").addClass("zpl_DNI").parents("#jobImpExpIcon").addClass("zpl_DNI"),Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),Timetracker.util.checkAddJobPermVar&&Timetracker.ImportExport.isImportExportAllowed(Timetracker.jobs.formDetails,!0)&&header.find("#jobImportIcon").removeClass("zpl_DNI").parents("#jobImpExpIcon").removeClass("zpl_DNI"),Timetracker.ImportExport.isImportExportAllowed(Timetracker.jobs.formDetails,!1)&&header.find("#jobExportIcon").removeClass("zpl_DNI").parents("#jobImpExpIcon").removeClass("zpl_DNI");break;case Timetracker.constants.PROJECT:header.find("#projectImportIcon,#projectExportIcon,#zohoprjctImport").addClass("zpl_DNI").parents("#projectImpExpIcon").addClass("zpl_DNI"),Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),Timetracker.util.checkAddProjectPermVar&&Timetracker.ImportExport.isImportExportAllowed(Timetracker.projects.formDetails,!0)&&header.find("#projectImportIcon").removeClass("zpl_DNI").parents("#projectImpExpIcon").removeClass("zpl_DNI"),Timetracker.ImportExport.isImportExportAllowed(Timetracker.projects.formDetails,!1)&&header.find("#projectExportIcon").removeClass("zpl_DNI").parents("#projectImpExpIcon").removeClass("zpl_DNI"),Timetracker.isDataAdminForAllUsers()&&"1"===Timetracker.generalSettings.settingDetails.TS_projectsInteg&&header.find("#zohoprjctImport").removeClass("zpl_DNI").parents("#projectImpExpIcon").removeClass("zpl_DNI");break;case Timetracker.constants.CLIENT:header.find("#clientImportIcon,#clientExportIcon,#importFromCRM").addClass("zpl_DNI").parents("#clientImpExpIcon").addClass("zpl_DNI"),Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,Timetracker.constants.CLIENT_TABLE),Timetracker.ImportExport.isImportExportAllowed(Timetracker.clients.formDetails,!0)&&(header.find("#clientImportIcon").removeClass("zpl_DNI").parents("#clientImpExpIcon").removeClass("zpl_DNI"),null!==Timetracker.CRM.integDtls&&Timetracker.CRM.integDtls.isActive&&header.find("#importFromCRM").removeClass("zpl_DNI").parents("#clientImpExpIcon").removeClass("zpl_DNI")),Timetracker.ImportExport.isImportExportAllowed(Timetracker.clients.formDetails,!1)&&header.find("#clientExportIcon").removeClass("zpl_DNI").parents("#clientImpExpIcon").removeClass("zpl_DNI")}return header},getImportExportArray:function(type){var optArray=[];switch(type){case Timetracker.constants.JOB:Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),Timetracker.util.checkAddJobPermVar&&Timetracker.ImportExport.isImportExportAllowed(Timetracker.jobs.formDetails,!0)&&optArray.push({id:"jobImportIcon",name:ZPI18N.getString("zp.import"),callback:"Timetracker.ImportExport.showImportNew",iClass:"PI_imprt"}),Timetracker.ImportExport.isImportExportAllowed(Timetracker.jobs.formDetails,!1)&&optArray.push({id:"jobExportIcon",name:ZPI18N.getString("zp.export"),callback:"Timetracker.jobs.Util.showExportNew",iClass:"PI_exprt"});break;case Timetracker.constants.PROJECT:Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),Timetracker.util.checkAddProjectPermVar&&Timetracker.ImportExport.isImportExportAllowed(Timetracker.projects.formDetails,!0)&&optArray.push({id:"projectImportIcon",name:ZPI18N.getString("zp.import"),callback:"Timetracker.ImportExport.showImportNew",iClass:"PI_imprt"}),Timetracker.isDataAdminForAllUsers()&&"1"===Timetracker.generalSettings.settingDetails.TS_projectsInteg&&optArray.push({id:"zohoprjctImport",name:ZPI18N.getString("zp.prjctsync.importzprjct"),callback:"Timetracker.ZOHOPROJECTS.operations.showSyncModal",iClass:"PI_imprt"}),Timetracker.ImportExport.isImportExportAllowed(Timetracker.projects.formDetails,!1)&&optArray.push({id:"projectExportIcon",name:ZPI18N.getString("zp.export"),callback:"Timetracker.projects.Util.showExportNew",iClass:"PI_exprt"});break;case Timetracker.constants.CLIENT:Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,Timetracker.constants.CLIENT_TABLE),Timetracker.ImportExport.isImportExportAllowed(Timetracker.clients.formDetails,!0)&&(optArray.push({id:"clientImportIcon",name:ZPI18N.getString("zp.import"),callback:"Timetracker.ImportExport.showImportNew",iClass:"PI_imprt"}),null!==Timetracker.CRM.integDtls&&Timetracker.CRM.integDtls.isActive&&optArray.push({id:"importFromCRM",name:ZPI18N.getString("zp.zcrm.importfromcrm"),callback:"Timetracker.CRM.constructCRMPopup_OP",iClass:"PI_imprt"})),Timetracker.ImportExport.isImportExportAllowed(Timetracker.clients.formDetails,!1)&&optArray.push({id:"clientExportIcon",name:ZPI18N.getString("zp.export"),callback:"Timetracker.clients.showExportNew",iClass:"PI_exprt"})}return optArray},isImportExportAllowed:function(formDetails,isImport){return isImport&&formDetails.hasOwnProperty("isImportAllowed")?formDetails.isImportAllowed:!(isImport||!formDetails.hasOwnProperty("isExportAllowed"))&&formDetails.isExportAllowed},showExportOptions:function(callback,mode,isExpOptnsNeeded,viewPermissionType,isV5,showOptionsByDefault,skipCacheChecks){var optns={};mode=void 0==mode?isExpOptnsNeeded?"tt_report_fields":"tt_reports":mode,isExpOptnsNeeded&&(optns.showOptionsByDefault=showOptionsByDefault,optns.skipCacheChecks=skipCacheChecks,optns=Timetracker.ImportExport.showExportDataOptions(optns,viewPermissionType,callback),ZPI18N.getString("zp.incempfields")),ZP5Export.init(mode,{submitCallback:callback,optns:optns})},additionalHtmlCallback:function(container,optns){optns&&optns.additionalHtml&&container.append(optns.additionalHtml)},constructImportExportContainer:function(){var mode=Timetracker.forms.URLs.getModeByURL(),elementId=mode+"_"+Timetracker.Page.getPageMode()+"_Export",importExportOptions=Timetracker.ImportExport.getImportExportArray(mode);importExportOptions.length&&Timetracker.Util.constructMoreOption(importExportOptions,elementId,"formsviewmenuicontxt",!0)},showexportfld:function(){var mode=Timetracker.forms.URLs.getModeByURL();ZPExport.showExportContainer(Timetracker.ImportExport.exportData,mode)},showExportDataOptions:function(optns,viewPermissionType,callback){var isFromReports=Timetracker.constants.TTCustomAdmin.ReportView==viewPermissionType,location=isFromReports?"reports_loc_List":"loc_List",department=isFromReports?"reports_dept_List":"dept_List",designation=isFromReports?"reports_desg_List":"desg_List",legalEntityList=isFromReports?"reports_legalEntityList":"legalEntityList",businessUnitList=isFromReports?"reports_businessUnitList":"businessUnitList",divisionList=isFromReports?"reports_divisionList":"divisionList",orgtagsList=isFromReports?"reports_orgTagList":"orgTagList",roleList=isFromReports?"reports_roleList":"";if(optns.showOptionsByDefault||Timetracker.isDataAdmin()||ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1||viewPermissionType&&Timetracker.isTTCustomAdmin(viewPermissionType)){if(optns.additionalHtml='<div><div class="zpl_secn"  id="zp_export_inctabularsec" style="display: block;"><div><div><div class="zcheckbox"><input type="checkbox" onclick = "Timetracker.ImportExport.displayFields(this)" id="empFields" class="zcheckbox__helper"><label for="empFields" class="zcheckbox__label">'+ZPI18N.getString("zp.includeemployeefieldsforexport")+'</lable></div></div><div class="zpl_tbox" id="exportEmpOptions" style="display: none;"><div class="zpl_ttlexpchkbx"><div class="zcheckbox zcheckbox--horizontal"><input id="reportingToExport" type="checkbox" class="zcheckbox__helper"><label for="reportingToExport" class="zcheckbox__label" title="'+ZPI18N.getString("zp.reportingto")+'">'+ZPI18N.getString("zp.reportingto")+"</label></div>",isOrgStructureEnabled){if(optns.skipCacheChecks||void 0!==Timetracker.LegalEntity[legalEntityList].length&&0!==Timetracker.LegalEntity[legalEntityList].length){var entitiyName=ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname");optns.additionalHtml+='<div class="zcheckbox zcheckbox--horizontal"><input id="leaglEntityExport" type="checkbox" class="zcheckbox__helper"><label for="leaglEntityExport" class="zcheckbox__label" title="'+entitiyName+'">'+entitiyName+"</label></div>"}if(optns.skipCacheChecks||void 0!==Timetracker.BusinessUnit[businessUnitList].length&&0!==Timetracker.BusinessUnit[businessUnitList].length){var unitName=ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.businessunitname");optns.additionalHtml+='<div class="zcheckbox zcheckbox--horizontal"><input id="businessUnitExport" type="checkbox" class="zcheckbox__helper"><label for="businessUnitExport" class="zcheckbox__label" title="'+unitName+'">'+unitName+"</label></div>"}if(optns.skipCacheChecks||void 0!==Timetracker.Division[divisionList].length&&0!==Timetracker.Division[divisionList].length){var divisionName=ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname");optns.additionalHtml+='<div class="zcheckbox zcheckbox--horizontal"><input id="divisionExport" type="checkbox" class="zcheckbox__helper"><label for="divisionExport" class="zcheckbox__label" title="'+divisionName+'">'+divisionName+"</label></div>"}}return(optns.skipCacheChecks||void 0!==Timetracker.Department[department].length&&0!==Timetracker.Department[department].length)&&(optns.additionalHtml+='<div class="zcheckbox zcheckbox--horizontal"><input id="departmentExport" type="checkbox" class="zcheckbox__helper"><label for="departmentExport" class="zcheckbox__label" title="'+ZPI18N.getString("zp.department")+'">'+ZPI18N.getString("zp.department")+"</label></div>"),(optns.skipCacheChecks||void 0!==Timetracker.Designation[designation].length&&0!==Timetracker.Designation[designation].length)&&(optns.additionalHtml+='<div class="zcheckbox zcheckbox--horizontal"><input id="designationExport" type="checkbox" class="zcheckbox__helper"><label for="designationExport" class="zcheckbox__label" title="'+ZPI18N.getString("zp.designation")+'">'+ZPI18N.getString("zp.designation")+"</label></div>"),(optns.skipCacheChecks||void 0!==Timetracker.Location[location].length&&0!==Timetracker.Location[location].length)&&(optns.additionalHtml+='<div class="zcheckbox zcheckbox--horizontal"><input id="locationExport" type="checkbox" class="zcheckbox__helper"><label for="locationExport" class="zcheckbox__label" title="'+ZPI18N.getString("zp.location")+'">'+ZPI18N.getString("zp.location")+" </label></div>"),isFromReports&&Timetracker.generalSettings.isRoleFilterEnabled()&&(optns.skipCacheChecks||void 0!==Timetracker.roles[roleList].length&&0!==Timetracker.roles[roleList].length)&&(optns.additionalHtml+='<div class="zcheckbox zcheckbox--horizontal"><input id="roleExport" type="checkbox" class="zcheckbox__helper"><label for="roleExport" class="zcheckbox__label" title="'+ZPI18N.getString("zp.role")+'">'+ZPI18N.getString("zp.role")+" </label></div>"),Timetracker.generalSettings.isOrgTagEnabled()&&(optns.skipCacheChecks||void 0!==Timetracker.organizationTags[orgtagsList].length&&0!==Timetracker.organizationTags[orgtagsList].length)&&(optns.additionalHtml+='<div class="zcheckbox zcheckbox--horizontal"><input id="orgTagExport" type="checkbox" class="zcheckbox__helper"><label for="orgTagExport" class="zcheckbox__label" title="'+ZPeople.orgTagDisplayName+'">'+ZPeople.orgTagDisplayName+" </label></div>"),optns.additionalHtml+="</div></div></div></div></div>",callback==Timetracker.jobSchedule.dataOperations.downloadJobSchedule&&(optns.additionalHtml+='<div><div class="zpl_secn"><div><div><div class="zcheckbox"><input id="recordsExportType" type="checkbox" class="zcheckbox__helper"><label for="recordsExportType" class="zcheckbox__label">'+ZPI18N.getString("zp.exportrowformat")+"</label></div></div></div></div></div>"),optns}if(callback==Timetracker.jobSchedule.dataOperations.downloadJobSchedule)return optns.additionalHtml='<div><div class="zpl_secn"><div><div><div class="zcheckbox"><input id="recordsExportType" type="checkbox" class="zcheckbox__helper"><label for="recordsExportType" class="zcheckbox__label">'+ZPI18N.getString("zp.exportrowformat")+"</label></div></div></div></div></div>",optns},displayFields:function(obj){if($(obj).is(":checked"))$("#exportEmpOptions").show();else{$("#exportEmpOptions").hide();$("#exportEmpOptions").find("input[type='checkbox']:checked").each(function(){$(this).prop("checked",!1)})}},submiteFormForExport:function(path){var form=document.createElement("form");form.id="ttformexport";var logexport=document.createElement("input");form.setAttribute("method","post"),form.setAttribute("action",path),form.setAttribute("target","exportresp"),logexport.setAttribute("type","hidden"),logexport.setAttribute("name","conreqcsr"),logexport.setAttribute("value",csrfToken),form.appendChild(logexport),document.body.appendChild(form),form.submit(),form.reset(),$("#ttformexport").remove(),$("#zp_export_container").modal("hide"),$("#zp_export_container").find("#zp_export_inctabularsec").show(),$("#zp_export_container").find("input[name='zp_ftype'][value='tsv']").parent().show()},exportData:function(mode){if(Layout.UrlConf.isModuleForm()&&!ZPView.isSystemView())ZPExport.exportData();else{var path=(contextPath?"/"+contextPath:"")+Timetracker.constants.URL+"?entity="+("projectdashboard"===mode?"job":mode)+"&mode=exportData&",ftype=$("#zp_export_container:visible").find("input[name=zp_ftype]:checked").val();$("#zp_export_container:visible").find("#zp_export_inctabularsec>label>input").is(":checked"),$("#zp_export_container:visible").find("#zp_export_incAttachements>label>input").is(":checked");if("job"===mode){Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),Timetracker.jobs.formDetails.formId,Timetracker.jobs.formDetails.viewId;var searchJobKey=Layout.Page.container.find("#jobName").val(),key="searchJobKey="+(searchJobKey=void 0===searchJobKey?"0":searchJobKey);if("0"!=searchJobKey&&void 0!=searchJobKey){var searchJobName=Layout.Page.container.find("#jobNameSearch").val();searchJobName&&searchJobName.length>255&&(searchJobName=searchJobName.substring(0,255)),key+="&searchJobName="+searchJobName}clientId=void 0===(clientId=Layout.Page.container.find("#job_client_filter").val()||"0")?"0":clientId,path+=key+"&projectId="+(projectId=void 0===(projectId=Layout.Page.container.find("#projectNames").val()||"0")?"0":projectId)+"&clientId="+clientId+"&jobStatus="+(jobStatus=void 0===(jobStatus=Layout.Page.container.find("#jobStatus").val())?"0":jobStatus)+"&assignedby="+(assignedby=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#assignedby").val()))+"&assignedto="+Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#assignedto").val())+"&"}else if("projectdashboard"===mode){var projectId,jobStatus,assignedby;Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),Timetracker.jobs.formDetails.formId,Timetracker.jobs.formDetails.viewId,path+="projectId="+(projectId=void 0===(projectId=Layout.Page.urlparam.id)?"0":projectId)+"&jobStatus="+(jobStatus=void 0===(jobStatus=Layout.Page.container.find("#pdbod_jobStatus").val())?"0":jobStatus)+"&assignedby="+(assignedby="0"!=(assignedby=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#pdbod_assignedby").val()))?assignedby.toString():assignedby)+"&assignedto="+Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#pdbod_assignedto").val())+"&"}else if("project"===mode){Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),Timetracker.projects.formDetails.formId,Timetracker.projects.formDetails.viewId;var clientId,searchProjectKey=Layout.Page.container.find("#projectName").val();key="searchProjectKey="+(searchProjectKey=void 0===searchProjectKey?"0":searchProjectKey);if("0"!=searchProjectKey&&void 0!=searchProjectKey){var searchProjectName=Layout.Page.container.find("#projectNameSearch").val();searchProjectName&&searchProjectName.length>255&&(searchProjectName=searchProjectName.substring(0,255)),key+="&searchProjectName="+searchProjectName}clientId=void 0===(clientId=Layout.Page.container.find("#project_client_filter").val()||"0")?"0":clientId;var projectManager=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#projectmanager_filter").val()),projectUser=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#projectuser_filter").val()),projectStatus=Layout.Page.container.find("#project_status_filter").val();path+=key+"&clientId="+clientId+"&projectManager="+projectManager+"&projectUser="+projectUser+"&projectStatus="+(projectStatus=void 0===projectStatus?"0":projectStatus)+"&"}else"client"===mode&&(Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,"P_ClientDetails"),Timetracker.clients.formDetails.formId,Timetracker.clients.formDetails.viewId);path+="includeRecordUsers="+$("#zp_export_container:visible").find("#zp_export_includerecordusers>label>input").is(":checked")+"&fileExtension="+ftype;var form=document.createElement("form");form.id="ttformexport";var logexport=document.createElement("input");form.setAttribute("method","post"),form.setAttribute("action",path),form.setAttribute("target","exportresp"),logexport.setAttribute("type","hidden"),logexport.setAttribute("name","conreqcsr"),logexport.setAttribute("value",csrfToken),form.appendChild(logexport),document.body.appendChild(form),form.submit(),form.reset(),$("#ttformexport").remove(),$("#zp_export_container").modal("hide")}},showImportNew:function(event){var mode=Timetracker.forms.URLs.getModeByURL(),formId=null,viewId=null;mode===Timetracker.constants.JOB?(Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),formId=Timetracker.jobs.formDetails.formId,viewId=Timetracker.jobs.formDetails.viewId):mode===Timetracker.constants.PROJECT?(Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),formId=Timetracker.projects.formDetails.formId,viewId=Timetracker.projects.formDetails.viewId):mode===Timetracker.constants.CLIENT&&(Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,"P_ClientDetails"),formId=Timetracker.clients.formDetails.formId,viewId=Timetracker.clients.formDetails.viewId);var obj={viewObj:{formId:formId,viewId:viewId,mandatoryValidation:!0}},ele=event.target;$(ele).off().on("impcustom",obj,function(event){ZP5Import.init(mode)}),$(ele).trigger("impcustom")},showExportNew:function(container,params,ftype){if(Layout.UrlConf.isModuleForm()&&!ZP5Views.isSystemView())ExportNew.exportData();else{var mode=Timetracker.forms.URLs.getModeByURL(),path=(contextPath?"/"+contextPath:"")+Timetracker.constants.URL+"?entity="+("projectdashboard"===mode?"job":mode)+"&mode=exportData&",layout=Timetracker.Util.getLayout(),pageMode=Timetracker.Page.getPageMode();if("job"===mode){Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),formId=Timetracker.jobs.formDetails.formId,viewId=Timetracker.jobs.formDetails.viewId;var clientId=0,assignedby=0,jobStatus=0,projectId=Timetracker.Page.isProjectDashboard("jobs")?Layout.Page.urlparam.id:0,assignedto="ts_mydata"==pageMode?erecno:Timetracker.Page.isSelectedUser(pageMode)?Timetracker.Team.getSelectedUser():"0",key="searchJobKey=0";if(0!=(filterDiv=layout.find("#filterDiv")).length){if(!Timetracker.Page.isProjectDashboard("jobs")){var searchJobKey=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find('[compname="jobName"]'));if(key="searchJobKey="+searchJobKey,"0"!=searchJobKey&&void 0!=searchJobKey){var searchJobName=filterDiv.find("#jobNameSearch").val();searchJobName&&searchJobName.length>255&&(searchJobName=searchJobName.substring(0,255)),key+="&searchJobName="+searchJobName}clientId=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find('[compname="client"]')),projectId=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find('[compname="project"]'))}assignedto=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find('[compname="assignedto"]')),assignedby=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find('[compname="assignedby"]')),jobStatus=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find('[compname="status"]'))}"ts_team"==Timetracker.Page.getPageMode()&&(path+="&pageMode=1&"),path+=key+"&projectId="+projectId+"&clientId="+clientId+"&jobStatus="+jobStatus+"&assignedby="+assignedby+"&assignedto="+assignedto+"&"}else if("project"===mode){Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),formId=Timetracker.projects.formDetails.formId,viewId=Timetracker.projects.formDetails.viewId;clientId=0;var projectHead=0,projectManager=0,projectUser=0,projectStatus=0;projectUser="ts_mydata"==pageMode?erecno:Timetracker.Page.isSelectedUser(pageMode)?Timetracker.Team.getSelectedUser():"0";var filterDiv;key="searchProjectKey=0";if(0!=(filterDiv=layout.find("#filterDiv")).length){var searchProjectKey=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find("[compname=projectName]"));if(key="searchProjectKey="+(searchProjectKey=void 0===searchProjectKey?"0":searchProjectKey),"0"!=searchProjectKey&&void 0!=searchProjectKey){var searchProjectName=filterDiv.find("#projectNameSearch").val();searchProjectName&&searchProjectName.length>255&&(searchProjectName=searchProjectName.substring(0,255)),key+="&searchProjectName="+searchProjectName}clientId=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find('[compname="client"]')),projectHead=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find('[compname="projectHead"]')),projectManager=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find('[compname="projectManager"]')),projectUser=TimetrackerOperations.Filters.gettokenFieldValues(filterDiv.find('[compname="assignedto"]')),projectStatus=TimetrackerOperations.Filters.getSelectFilterValues(filterDiv.find('[compname="status"]'))}"ts_team"==Timetracker.Page.getPageMode()&&(path+="&pageMode=1&"),path+=key+"&clientId="+clientId+"&projectHead="+projectHead+"&projectManager="+projectManager+"&projectUser="+projectUser+"&projectStatus="+projectStatus+"&"}else"client"===mode&&(Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,"P_ClientDetails"),formId=Timetracker.clients.formDetails.formId,viewId=Timetracker.clients.formDetails.viewId);path+="includeRecordUsers="+container.find("#exportIncludeUsers").is(":checked")+"&fileExtension="+ftype,Timetracker.ImportExport.submiteFormForExport(path)}}},Timetracker.Search={populateUsers:function(elementId,userErecno,extraParam,isMultiple,isDataType){var initialValue=Timetracker.Search.getInitialValue(elementId,userErecno),defaultOption=Timetracker.Search.getDefaultOption(elementId),searchJson={id:elementId,inpFormat:"select",placeHolder:ZPI18N.getString("zp.allusers"),searchMode:"TIMETRACKER_DATA",type:1,limit:10,searchType:"emp",searchInputPlaceholder:ZPI18N.getString("zp.searchUser")};isDataType&&Timetracker.isTTCustomAdmin(isDataType)&&(extraParam||(extraParam={}),extraParam.customAdminAction=isDataType),searchJson.initDefaultValues=!0,0!==Object.keys(initialValue).length&&"0"!=initialValue?searchJson.initialSelection=initialValue:Layout.Page.container.find("#"+elementId).val(""),isMultiple&&(searchJson.initDefaultValues=!0,searchJson.isMultiple=!0,searchJson.maximumSelectionSize=10,searchJson.maxselectionmsg=ZPI18N.getString("zp.maxuserselect"),defaultOption="",0!==Object.keys(initialValue).length&&"0"==initialValue.id&&(searchJson.initialSelection="",Layout.Page.container.find("#"+elementId).val(""))),""!==defaultOption&&0!==Object.keys(defaultOption).length&&(searchJson.defaultOption=defaultOption,searchJson.alwaysShowDefOpt=defaultOption.id!==ZPeople.CURR_USER.usererec);var searchConf=extraParam?extraParam.searchConf:void 0;searchConf&&(searchConf.initialSelection&&(searchJson.initialSelection=searchConf.initialSelection),searchConf.isMultiple&&(searchJson.isMultiple=searchConf.isMultiple),searchConf.noMatchMessage&&(searchJson.noMatchMessage=searchConf.noMatchMessage),searchConf.maximumSelectionSize&&(searchJson.maximumSelectionSize=searchConf.maximumSelectionSize),delete extraParam.searchConf),extraParam&&extraParam.submode&&(searchJson.searchMode=extraParam.submode,delete extraParam.submode),searchJson.extraparam=extraParam||{},searchJson.extraParamCallback=Timetracker.Search.setExtraSearchParam,ZPComponents.Search.reset(searchJson,!0),ZPComponents.Search.create(searchJson)},populateZCompUsers:function(eleId,initialSel,extraDtls,isMultiple,pageContainer,isDataType){pageContainer=pageContainer||settingsPage.container,extraDtls=extraDtls||{};var ele=pageContainer.find("#"+eleId),pModal=extraDtls.pModal||$(ele).parents(".zpl_mcnt"),defaultValue={id:"0",text:ZPI18N.getString("zp.allemployees"),html:ZPI18N.getString("zp.allemployees"),value:"0",photo:ZPeople.getDefaultUserImagePath()},jsonParam={ele:ele,inpFormat:"TEXTAREA"===$(ele)[0].nodeName?"token":"select",isMultiple:!!isMultiple,initCurrentUser:!1,type:1,limit:10,searchMode:"TIMETRACKER_DATA",searchType:"emp",initialSelection:initialSel||null,placeHolder:extraDtls.placeHolder||ZPI18N.getString("zp.allusers"),initDefaultValues:!0,pModal:pModal.length>0?pModal:void 0};extraDtls&&0!==Object.keys(extraDtls).length&&(extraDtls.hasOwnProperty("submode")&&(jsonParam.searchMode=extraDtls.submode),extraDtls.hasOwnProperty("inpFormat")&&(jsonParam.inpFormat=extraDtls.inpFormat),extraDtls.hasOwnProperty("defaultOptionNeeded")&&(jsonParam.defaultOption=extraDtls.defaultOptionNeeded?defaultValue:null),extraDtls.changeCallback&&(jsonParam.changeCallback=extraDtls.changeCallback),extraDtls.noMatchMessage&&(jsonParam.noMatchMessage=extraDtls.noMatchMessage),extraDtls.defaultValueText&&(defaultValue.text=extraDtls.defaultValueText,defaultValue.html=extraDtls.defaultValueText),extraDtls.hasOwnProperty("skipDefaultValues")&&(jsonParam.initDefaultValues=!extraDtls.skipDefaultValues),extraDtls.initCurrentUser&&(defaultValue.zuid=ZPeople.CURR_USER.zuid,defaultValue.id=ZPeople.CURR_USER.usererec,defaultValue.text=ZPeople.decodeTxt(ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name),defaultValue.html=ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name,defaultValue.photo=ZPeople.CURR_USER.thumb,jsonParam.initCurrentUser=!0),void 0!==extraDtls.modulesearchcallback&&""!==extraDtls.modulesearchcallback&&(jsonParam.modulesearchcallback=extraDtls.modulesearchcallback),void 0!==extraDtls.className&&""!==extraDtls.className&&(jsonParam.className=extraDtls.className),void 0!==extraDtls.randomDropdownListId&&(jsonParam.randomDropdownListId=extraDtls.randomDropdownListId),extraDtls.closeOnScroll&&(jsonParam.closeOnScroll=extraDtls.closeOnScroll),extraDtls.fitForElement&&(jsonParam.fitForElement=extraDtls.fitForElement)),jsonParam.extraparam=extraDtls.extraParams||{};var pageMode=Timetracker.Page.getPageMode();if(isDataType&&"ts_teamuser"!=pageMode&&Timetracker.isTTCustomAdmin(isDataType)&&(jsonParam.extraparam.customAdminAction=isDataType),extraDtls.maxAllowedValues&&(jsonParam.maxAllowedValues=extraDtls.maxAllowedValues),!extraDtls.skipPageMode){var url=settingsUrlProps.niceUrl;(-1!=url.indexOf("timetracker/")&&"ts_team"==pageMode||-1!=url.indexOf("home/team/projects/listview")&&"ts_hometeam"==pageMode)&&(jsonParam.extraparam.pageMode="TT_Team")}if(extraDtls.useDefaultValuesCache&&jsonParam.initDefaultValues)if(extraDtls.refreshDefaultValuesCache)Timetracker.Search.refreshDefaultValuesCache(),jsonParam.setDefaultValueCacheFun=Timetracker.Search.setDefaultValuesCache;else{let defaultValuesCache=Timetracker.Search.getDefaultValuesCache(jsonParam);void 0!==defaultValuesCache?jsonParam.defaultValuesCache=defaultValuesCache:jsonParam.setDefaultValueCacheFun=Timetracker.Search.setDefaultValuesCache}return jsonParam.extraParamCallback=Timetracker.Search.setExtraSearchParam,ModuleComp.Search.reset(jsonParam,!0),ModuleComp.Search.create(jsonParam)},getDefaultValuesCache:function(json){if(void 0===Timetracker.Search.defaultValues)return;let key=json.searchMode+"_"+json.searchType;return json.extraparam&&json.extraparam.pageMode&&(key=key+"_"+json.extraparam.pageMode),Timetracker.Search.defaultValues[key]},setDefaultValuesCache:function(json,param,respData){Timetracker.Search.defaultValues=Timetracker.Search.defaultValues||{};let key=json.searchMode+"_"+json.searchType;json.extraparam&&json.extraparam.pageMode&&(key=key+"_"+json.extraparam.pageMode),Timetracker.Search.defaultValues[key]=respData},refreshDefaultValuesCache:function(){Timetracker.Search.defaultValues=void 0},populateData:function(elementId,searchParams,extraParam){searchParams||(searchParams={});var searchJson={id:elementId,inpFormat:"select",placeHolder:ZPI18N.getString("zp.search"),searchMode:"TIMETRACKER_DATA",type:2,limit:10,searchType:"dept"};if(searchParams.submode&&(searchJson.searchMode=searchParams.submode),searchParams.isDivision?searchJson.searchType="division":searchParams.isLocation&&(searchJson.searchType="location"),searchParams.initialSelection&&(searchJson.initialSelection=searchParams.initialSelection),searchParams.initDefaultValues&&(searchJson.initDefaultValues=searchParams.initDefaultValues),searchParams.isMultiple&&(searchJson.isMultiple=searchParams.isMultiple,searchJson.maximumSelectionSize=searchParams.maximumSelectionSize?searchParams.maximumSelectionSize:10),searchParams.noMatchMessage&&(searchJson.noMatchMessage=searchParams.noMatchMessage),searchJson.extraparam=extraParam||{},searchJson.extraParamCallback=Timetracker.Search.setExtraSearchParam,Timetracker.Util.isVersionFive())return searchJson.inpFormat="token",searchJson.selecttype="text",ModuleComp.Search.reset(searchJson,!0),ModuleComp.Search.create(searchJson);Layout.Page.container.find("#"+elementId).val(""),ZPComponents.Search.reset(searchJson,!0),ZPComponents.Search.create(searchJson)},setExtraSearchParam:function(extraParams){var extraParam;if(ZPComponents.Search.Configuration.JSON)return extraParams&&extraParams.employeeStatusarr&&ZPComponents.Search.Configuration.JSON.extraparam.employeeStatusarr&&(ZPComponents.Search.Configuration.JSON.extraparam.employeeStatusarr=extraParams.employeeStatusarr),(extraParam=$.extend(!0,ZPComponents.Search.Configuration.JSON.extraparam,extraParams||{}))&&(extraParam.locationId&&"0"===extraParam.locationId&&delete extraParam.locationId,extraParam.departmentId&&"0"===extraParam.departmentId&&delete extraParam.departmentId,Timetracker.generalSettings.isProjectManagerPerm()||delete extraParam.projectManagerPerm),extraParam;if(Timetracker.Util.isVersionFive()){var jsonExtraParams=this.extraparam?this.extraparam:{};return(extraParam=$.extend(!0,jsonExtraParams,extraParams||{}))&&(extraParam.locationId&&"0"===extraParam.locationId&&delete extraParam.locationId,extraParam.departmentId&&"0"===extraParam.departmentId&&delete extraParam.departmentId,Timetracker.generalSettings.isProjectManagerPerm()||delete extraParam.projectManagerPerm),extraParam}},getInitialValue:function(elementId,userErecno){var tempResultObj=[],selectNoValue=new Array("tssettings-ratinguser","zp_ts_budget_allocateto","multiUserMappingSelect","zp_ts_budget_applicablefor","notifyToSEmpUsers"),allUsers=new Array("pruser","billing-user","qbrUser","projectowner_filter","projecthead_filter","projectmanager_filter","jobsch_assignedto","jschdrUser","unass_projecthead_filter","unass_projectmanager_filter","urUser","assignedby","pdbod_assignedto","pdbod_assignedby");if(userErecno){userErecno=(userErecno=null===userErecno?erecno:userErecno).split(",");var j=0,userDtls=ZPeople.getUserDetailsByIds(userErecno);for(var i in userDtls){var tempResultObjtemp={};if(tempResultObjtemp.text=ZPeople.decodeTxt(userDtls[i].empid+" "+userDtls[i].name),tempResultObjtemp.html=userDtls[i].empid+" "+userDtls[i].name,tempResultObjtemp.id=userErecno[j],j++,tempResultObjtemp.photo=userDtls[i].thumb,tempResultObj.push(tempResultObjtemp),1==userDtls.length)return tempResultObjtemp}return tempResultObj}return-1!==allUsers.indexOf(elementId)?tempResultObj=Timetracker.Search.getAllUserOption():-1===selectNoValue.indexOf(elementId)&&(tempResultObj=Timetracker.Search.getLoggedInUserOption()),tempResultObj},getDefaultOption:function(elementId){var tempResultObj={},elementObj=Layout.Page.container.find("#"+elementId);return elementObj&&0!==elementObj.length&&("allUsers"===elementObj.attr("defaultSelectType")?tempResultObj=Timetracker.Search.getAllUserOption():"loggedInUser"===elementObj.attr("defaultSelectType")?tempResultObj=Timetracker.Search.getLoggedInUserOption():"noUser"===elementObj.attr("defaultSelectType")&&(tempResultObj=Timetracker.Search.getNoUserOption())),tempResultObj},getLoggedInUserOption:function(){var tempResultObj={};return tempResultObj.text=ZPeople.decodeTxt(ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name),tempResultObj.html=ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name,tempResultObj.id=ZPeople.CURR_USER.usererec,tempResultObj.photo=ZPeople.CURR_USER.thumb,tempResultObj},getAllUserOption:function(){var tempResultObj={};return tempResultObj.text=tempResultObj.html=ZPI18N.getString("zp.allusers"),tempResultObj.id="0",tempResultObj.photo=ZPeople.getDefaultUserImagePath(),tempResultObj},getNoUserOption:function(){var tempResultObj={};return tempResultObj.text=tempResultObj.html=ZPI18N.getString("zp.select"),tempResultObj.id="-1",tempResultObj}},Timetracker.Print={printPage:function(printJson){var newWindow=window.open();$(newWindow).trigger("focus");var newContent="<!doctype html><head><title>"+$("head").find("title").text()+"</title>",css=$("head").find("[rel=stylesheet]");for(i=0;i<css.length;i++)newContent+=css[i].outerHTML;var layout=Layout.Page.container.clone(),divId=printJson.divId;void 0!==divId&&(layout=(layout=0!=Layout.Page.container.find("#"+divId).length?Layout.Page.container.find("#"+divId):$("#"+divId)).clone());var userErecNo,isUserNeeded=printJson.isUserNeeded;void 0!==isUserNeeded&&!0===isUserNeeded&&(void 0!==(userErecNo=printJson.userErecNo)&&null!==userErecNo||(userErecNo=erecno)),newContent+="</head><body onload ='self.print()' class='zpl_lmin zpl_newpl zpl_themelight' >",newContent+='<div class="zpl_mdl zpl_mopen zpl_mfull zpl_mprint" role="dialog" data-keyboard="false" id="zp_print_record"><div class="zpl_minr">'+FormsCommon.getPrintHeaderHtml();var headerText=printJson.header,headerClass=printJson.headerClass;if(newContent+=headerClass?'<div class="'+headerClass+'">':'<div class="zpl_mhder">',headerText)newContent+="<h6><b>"+ZPeople.escapeHtml(headerText)+"</b></h6>";else if(void 0!==userErecNo&&"0"!==userErecNo){var userDtls=ZPeople.getUserDetailsById(userErecNo);newContent+='<div><div class="zpl_em"><div class="zpl_emimg"><img class="Usrimg" src="'+userDtls.avatar+'"></div><div class="zpl_emdts"><h6><span>'+userDtls.name+"</span></h6></div></div></div>"}var date=printJson.date;void 0!==date&&(newContent+='<div class="zpl_mhdercnt"><div class="zpl_inav zpl_cpd"><i class="PI_monthly"></i></div><b>'+date+"</b></div><div></div>"),newContent+="</div>",newContent+='<div class="zpl_mcnt zpl_fm"><div class="zpl_mprintcont" id="bodyparent"><div class="zpl_rgtcnt" id="sectionsparent">',newContent+=printJson.isReports?Timetracker.Print.getReportContent(layout):layout.get(0).outerHTML,newContent+="</div></div></div></body></html>",newWindow.document.write(newContent),newWindow.document.close()},getReportContent:function(layout){return'<div class="zpl_crd zpl_allreports"><div class="zpl_crdcnt">'+layout.get(0).outerHTML+"</div></div>"}},Timetracker.Audit={constants:{BILLABLEHRS:"billablehours",NONBILLABLEHRS:"nonbillablehours",TOTALHRS:"totalhours",APP_BILLABLEHRS:"app_billablehours",APP_NONBILLABLEHRS:"app_nonbillablehours",APP_TOTALHRS:"app_totalhours",COLUMN_MAP:{billablehours:"BILLABLE_HOURS",nonbillablehours:"NONBILLABLE_HOURS",totalhours:"TOTAL_HOURS",type:"TYPE"},TS_TL_EDIT:"1000",TS_TL_DELETE:"1001",TS_SCHEDULER:"1003",TS_APPROVED:"1005",TS_REJECTED:"1006",TL_APPROVED:"1012",TL_REJECTED:"1013",TS_AUTO_APPROVED:"1014",TS_AUTO_REJECTED:"1015",TS_PARTIAL_APPROVED:"1018",TS_EDITED_APPROVED:"1019",TS_EDITED_REJECTED:"1020",TS_EDITED_PARTIAL_APPROVED:"1021",TS_EDIT_NONOVERLAPHOURS_DEDUCTION:"1022",TS_TL_ADD:"1023"},isAuditEnabled:function(){return!0},checkAndAddAuditIcon:function(ele,recordId){Timetracker.Audit.isAuditEnabled()&&0===$(ele).find("#zp_tt_audithistory").length&&$(ele).append('<span class="btn btn-default btn-min" id="zp_tt_audithistory"><i class="IC-addit" data-toggle="tooltip" data-placement="bottom" data-original-title="'+ZPI18N.getString("zp.audithistory")+'"></i></span>'),0!==$(ele).find("#zp_tt_audithistory").length&&$(ele).find("#zp_tt_audithistory").off("click").on("click",function(){Timetracker.Audit.getAuditHistoryForRecord(recordId,ZPI18N.getString("zp.timesheet"))})},getAuditHistoryForRecord:function(recordId,formDispName){var params={mode:"getAuditHistory",recordId:recordId,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.Audit.showAuditHistoryForRecord,{formDispName:formDispName})},showAuditHistoryForRecord:function(result,params,extraDtls){Timetracker.Audit.resetPrevHistory(),result&&null!==result?0!==result.length&&"Permission Denied"===result[0]?Timetracker.util.showAlert(1,ZPI18N.getString("zp.permdenied")):Timetracker.Audit.constructAuditHistoryModal(result,params,extraDtls):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg"))},constructAuditHistoryModal:function(result,params,extraDtls){var header='<div><h4 id="zp_modal_header">'+ZPI18N.getString("zp.audithistory")+'</h4></div><span id="headeropt" class="zpl_mhderrgt"><a class="PI_print zpl_btnic" id="timesheet_audit_print" onclick="Timetracker.Audit.printAudit(\'Timesheet\')" title="'+ZPI18N.getString("zp.print")+'"></a></span><a class="_cls PI_cls tooltip-js" data-title-position="bottom" title="'+ZPI18N.getString("zp.close")+'"></a>',bodyHtml="";result.length>0?bodyHtml+='<div id="zp_ttaudit_modal_body" class="zpl_tmln zpl_adhstry wd100_per tsheet_adthsty">'+Timetracker.Audit.constructAuditHistory(result)+"</div>":bodyHtml=0===result.length?$('<div class="col-lg-12 text-center"><div id="zp_tt_audit_norec" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.nodataavailable",[ZPI18N.getString("zp.shistory")])+"</h2></div>"):$('<div class="col-lg-12 text-center"><div id="zp_tt_audit_norec" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.sorryservererror")+"</h2></div>");var modalClass="zpl_mmd zpl_mfull"+(Timetracker.timesheet.isfromFeeds?" zpl_ntzindx":"");return ModuleComp.Modal.setup({id:"zp_tt_audit_history",type:1,headerHtml:header,body:bodyHtml,backdrop:!0,closeOnSubmit:!1,modalClass:modalClass,deleteOnHide:!0,disableFooter:!0,closeonEsc:!0})},constructAuditHistory:function(result,userDataList,propJson){var isDependantAct=propJson&&void 0!==propJson.isDependantAct&&!0===propJson.isDependantAct,isDateNeeded=!propJson||void 0===propJson.isDateNeeded||propJson.isDateNeeded,displayMsg=!(!propJson||void 0===propJson.displayMsg)&&propJson.displayMsg;if(0===(userDataList=void 0===userDataList?[]:userDataList).length||!isDependantAct){var userList=[];$.each(result,function(index,histdata){-1===userList.indexOf(histdata.ownerErecNo)&&userList.push(histdata.ownerErecNo)}),userDataList=ZPeople.getUserDetailsByIds(userList,!1)}var bodyHtml="";return $.each(result,function(index,histdata){var fldhistdata=histdata.fieldDtls,info=histdata.info,type=histdata.type;if(!isDependantAct){var auditId=histdata.auditId,isSystemAction=!(!info||!info.isSystemAction||!0!==info.isSystemAction);if(bodyHtml+='<div class="zpl_tmlnrow"><div class="zpl_tmlnlft">',isDateNeeded&&(bodyHtml+="<div><b>"+Timetracker.DateTime.getMonth(histdata.monthVal)+" "+histdata.day+"</b><span>"+histdata.year+"</span><div><em>"+histdata.formattedTime+"</em></div></div>"),bodyHtml+="</div>",bodyHtml+='<div class="zpl_tmlnrgt"><div class="zpl_crd zpl_w-100"><div><div class="zpl_usrpfl">',isSystemAction)bodyHtml+='<img class="Usrimg" src="/people/images/auto-app.jpg"><span>';else{var userDtl=ZPeople.getUserDetailsByIdInList(histdata.ownerErecNo,userDataList);bodyHtml+='<img class="Usrimg" src="'+userDtl.avatar+'"><div class="zpl_usrdtls"><div><span><b>'+userDtl.name+" </b>"}bodyHtml+=histdata.message+"</span></div></div>"+(isSystemAction?"":"</div></div>"),0!==fldhistdata.length&&(bodyHtml+='<div class="d-flex flex-dirC" id="ul_'+auditId+'">')}var msg=info&&info.message?info.message:null;if(isDependantAct&&!displayMsg&&info&&info.jobName){var field=Timetracker.jobs.formDetails&&null!==Timetracker.jobs.formDetails&&Timetracker.jobs.formDetails.labelDetails?Timetracker.jobs.formDetails.labelDetails.JOBNAME:ZPI18N.getString("zp.jobname"),value='<span class="wauto">'+info.jobName+"</span>";info.projectName&&(value+="<font>.</font><em>"+info.projectName+"</em>"),bodyHtml+="<li><span>"+field+'</span><div class="zpl_cstnmes">'+value+"</div></li>"}info&&Timetracker.Audit.updateDtlsFromInfo(type,info);var showHeader=!0;if(histdata.extraDtls){var propJson={},isApproval=null!==msg&&(msg===Timetracker.Audit.constants.TS_APPROVED||msg===Timetracker.Audit.constants.TS_REJECTED||msg===Timetracker.Audit.constants.TS_PARTIAL_APPROVED||msg===Timetracker.Audit.constants.TS_AUTO_APPROVED||msg===Timetracker.Audit.constants.TS_AUTO_REJECTED||msg===Timetracker.Audit.constants.TS_EDITED_APPROVED||msg===Timetracker.Audit.constants.TS_EDITED_REJECTED||msg===Timetracker.Audit.constants.TS_EDITED_PARTIAL_APPROVED);propJson.isDependantAct=null!==msg&&(msg===Timetracker.Audit.constants.TS_TL_EDIT||msg===Timetracker.Audit.constants.TS_TL_ADD||msg===Timetracker.Audit.constants.TS_TL_DELETE||isApproval),propJson.isDependantAct&&(propJson.displayMsg=isApproval||msg===Timetracker.Audit.constants.TS_TL_DELETE),propJson.isDateNeeded=!1;var getExtraFlds=!0;if(null!==msg&&isApproval&&(getExtraFlds=msg==Timetracker.Audit.constants.TS_PARTIAL_APPROVED||msg==Timetracker.Audit.constants.TS_EDITED_APPROVED||msg==Timetracker.Audit.constants.TS_EDITED_REJECTED||msg==Timetracker.Audit.constants.TS_EDITED_PARTIAL_APPROVED),getExtraFlds){null===msg||msg!==Timetracker.Audit.constants.TS_TL_EDIT&&msg!==Timetracker.Audit.constants.TS_TL_ADD||(bodyHtml+="<b>"+ZPI18N.getString("zp.timelogdtls")+' : </b><div class="zpl_secn"><ul class="wd100_per">',showHeader=!1);var constTable=isApproval||msg===Timetracker.Audit.constants.TS_TL_DELETE,editedTable=msg===Timetracker.Audit.constants.TS_EDITED_APPROVED||msg===Timetracker.Audit.constants.TS_EDITED_REJECTED||msg===Timetracker.Audit.constants.TS_EDITED_PARTIAL_APPROVED;bodyHtml+=constTable?editedTable?Timetracker.Audit.constructAuditDiffTable(histdata.extraDtls,isApproval,msg===Timetracker.Audit.constants.TS_EDITED_PARTIAL_APPROVED):Timetracker.Audit.constructAuditTable(histdata.extraDtls,isApproval):Timetracker.Audit.constructAuditHistory(histdata.extraDtls,userDataList,propJson),null===msg||msg!==Timetracker.Audit.constants.TS_TL_EDIT&&msg!==Timetracker.Audit.constants.TS_TL_ADD||(bodyHtml+="</ul></div>")}}displayMsg&&histdata.message&&(bodyHtml+='<li class="ML10 MB10"><label>'+histdata.message+"</label></li>");var isDivOpen=!1,isTLEDIT=!1;if($.each(fldhistdata,function(i,fieldDtl){var field=fieldDtl.field;isTLEDIT=!0,Timetracker.Audit.allowFieldDisp(type,field,isTLEDIT)?(type===Timetracker.constants.TIMESHEET_CONST&&showHeader&&(bodyHtml+='<div class="zpl_secn"><ul class="wd100_per">',showHeader=!1,isDivOpen=!0),bodyHtml+=Timetracker.Audit.constructAuditFlds(field,fieldDtl.oldValue,fieldDtl.newValue?fieldDtl.newValue:"-")):type===Timetracker.constants.TIMESHEET_CONST&&Timetracker.Audit.Timesheet.updateTSHour(field,fieldDtl.newValue)}),info&&!isTLEDIT&&Object.keys(info).forEach(key=>{if(Timetracker.Audit.allowFieldDisp(type,key,isTLEDIT)){var correctDipsName=Timetracker.constants.AUDIT_FLD_DISPNAMES[key];bodyHtml+=Timetracker.Audit.constructAuditFlds(correctDipsName,info[key],"")}}),isDivOpen&&(bodyHtml+="</ul></div>"),!isDependantAct){0!==fldhistdata.length&&(bodyHtml+="</div>");var statusHtml='<div class="flex-dirC zpl_secn">';if(type===Timetracker.constants.TIMESHEET_CONST){var billableHrs=Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.BILLABLEHRS),nonbillableHrs=Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.NONBILLABLEHRS),totalHours=Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.TOTALHRS);null===msg||msg!==Timetracker.Audit.constants.TS_APPROVED&&msg!==Timetracker.Audit.constants.TS_AUTO_APPROVED&&msg!==Timetracker.Audit.constants.TS_PARTIAL_APPROVED&&msg!==Timetracker.Audit.constants.TS_EDITED_APPROVED&&msg!==Timetracker.Audit.constants.TS_EDITED_PARTIAL_APPROVED||(billableHrs=Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_BILLABLEHRS),nonbillableHrs=Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_NONBILLABLEHRS),totalHours=Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_TOTALHRS),statusHtml+="<b>"+ZPI18N.getString("zp.approvedtimelog")+" : </b>"),statusHtml+='<div class="zpl_tshetwd d-flex"><div class="d-flexclmcap10 a-itm-cntr"><span class="zpl_lbdr lv_bg1"></span><span>'+ZPI18N.getString("zp.billablehours")+'<br> <b id="repclient-totalhours"> '+Calendar.minstohrs(billableHrs)+"</b> "+ZPI18N.getString("zp.hrs")+'</span></div><div class="d-flexclmcap10 a-itm-cntr"><span class="zpl_lbdr lv_bg2"></span><span>'+ZPI18N.getString("zp.nonbillablehours")+'<br> <b id="repclient-totalhours"> '+Calendar.minstohrs(nonbillableHrs)+"</b> "+ZPI18N.getString("zp.hrs")+'</span></div><div class="d-flexclmcap10 a-itm-cntr"><span class="zpl_lbdr lv_bg3"></span><span>'+ZPI18N.getString("zp.totalhours")+'<br> <b id="repclient-totalhours"> '+Calendar.minstohrs(totalHours)+"</b> "+ZPI18N.getString("zp.hrs")+"</span></div></div>",statusHtml+="</div>"}if(bodyHtml+=statusHtml+"</div>",bodyHtml+="</div></div>",""===$(bodyHtml).find("ul#ul_"+auditId).html()){var tempHtml=$("<div/>");tempHtml.append($(bodyHtml)),tempHtml.find("ul#ul_"+auditId).parent().remove(),bodyHtml=$(tempHtml).html()}}}),bodyHtml},resetPrevHistory:function(){Timetracker.Audit.Timesheet.HOURS_JSON={}},constructAuditTable:function(timelogdtls,isApproval){var tbodyHtml="";$.each(timelogdtls,function(index,timelog){var info=timelog.info;if(info){var msg=info.message;tbodyHtml+='<tr><td><div class="zpl_cstnmes"><span>'+ZPUtil.getNoValueString(info.jobName)+"</span>",info.projectName&&(tbodyHtml+="<font>.</font><em>"+info.projectName+"</em>"),tbodyHtml+="</div></td>",tbodyHtml+='<td class="mw100">'+ZPUtil.getNoValueString(info.TOTALHOURS)+'</td><td class="mw100">'+ZPUtil.getNoValueString(info.BILLABLE)+"</td>"+(isApproval?'<td class="mw100"><i class="'+(msg&&msg===Timetracker.Audit.constants.TL_APPROVED?"PI_like grn":"PI_unlike red")+'"></i></td>':"")+"</tr>"}});var bodyHtml="";""!==tbodyHtml&&(bodyHtml='<div class="zpl_tshetwd"><div class="zpl_tblres"><table class="zpl_tbl reg_tbl zpl_nocrsor"><thead><tr><th>'+(Timetracker.jobs.formDetails&&null!==Timetracker.jobs.formDetails&&Timetracker.jobs.formDetails.labelDetails?Timetracker.jobs.formDetails.labelDetails.JOBNAME:ZPI18N.getString("zp.jobname"))+"</th><th>"+ZPI18N.getString("zp.hours")+"</th><th>"+ZPI18N.getString("zp.billablestatus")+"</th>"+(isApproval?"<th>"+ZPI18N.getString("zp.approvalstatus")+"</th>":"")+"</tr></thead><tbody>"+tbodyHtml+"</tbody></table></div></div>");return bodyHtml},constructTimelogDetailsInfo:function(message,typeConst,info){if(typeConst==Timetracker.constants.TIMELOG_CONST&&info){info.jobName,info.WORKDATE;"<tr>"}},constructAuditDiffTable:function(timelogdtls,isApproval,isPartial){var tbodyHtml="";$.each(timelogdtls,function(index,timelog){if(timelog.fieldDtls.length&&(1!=timelog.fieldDtls.length||"Approval Status"!=timelog.fieldDtls[0].field)||isPartial){for(var fields=timelog.fieldDtls,billable=null,hours=null,job=null,witem=null,i=0;i<fields.length;i++)"Total Hours"==fields[i].field?hours=fields[i].oldValue:"Billable Status"==fields[i].field?billable=fields[i].oldValue:"JOBID"==fields[i].field?job=fields[i].oldValue:"TASK"==fields[i].field&&(witem=fields[i].oldValue);var info=timelog.info;if(info){billable=null==billable?info.BILLABLE:billable,hours=null==hours?info.TOTALHOURS:hours;var msg=info.message;tbodyHtml+="<tr>",tbodyHtml+='<td class="tblbody"><table class="zpl_tblcntr zpl_itbl"><tbody><tr>',tbodyHtml+=null==job?'<td class="mw200">'+ZPUtil.getNoValueString(info.jobName)+"</td>":'<td class="mw100">'+ZPUtil.getNoValueString(job)+'</td><td class="mw100">'+ZPUtil.getNoValueString(info.jobName)+"</td>",tbodyHtml+=null==witem?'<td class="mw200">'+ZPUtil.getNoValueString(info.TASK)+"</td>":'<td class="mw100">'+ZPUtil.getNoValueString(witem)+'</td><td class="mw100">'+ZPUtil.getNoValueString(info.TASK)+"</td>",tbodyHtml+='<td class="mw100">'+ZPUtil.getNoValueString(billable)+'</td><td class="mw100">'+ZPUtil.getNoValueString(info.BILLABLE)+'</td><td class="mw100">'+ZPUtil.getNoValueString(hours)+'</td><td class="mw100">'+ZPUtil.getNoValueString(info.TOTALHOURS)+"</td></tr></tbody></table></td>"+(isPartial?'<td class="mw100"><i class="'+(msg&&msg===Timetracker.Audit.constants.TL_APPROVED?"PI_like grn":"PI_unlike red")+'"></i></td></tr>':"</tr>")}}});var bodyHtml="";if(""!==tbodyHtml){Timetracker.jobs.formDetails&&null!==Timetracker.jobs.formDetails&&Timetracker.jobs.formDetails.labelDetails?Timetracker.jobs.formDetails.labelDetails.JOBNAME:ZPI18N.getString("zp.jobname");bodyHtml='<div class="zpl_tshetwd"><div class="zpl_tblres"><table class="zpl_tbl reg_tbl zpl_nocrsor"><thead><tr>',bodyHtml+='<th class="tblthead"><table class="zpl_tblcntr zpl_itbl"><thead><tr><th class="mw200" colspan="2">'+ZPI18N.getString("zp.job")+'</th><th class="mw200" colspan="2">'+ZPI18N.getString("zp.workitem")+'</th><th class="mw200" colspan="2">'+ZPI18N.getString("zp.billablestatus")+'</th><th class="mw200" colspan="2">'+ZPI18N.getString("zp.hours")+'</th></tr><tr><th class="mw100">'+ZPI18N.getString("zp.oldvalue")+'</th><th class="mw100">'+ZPI18N.getString("zp.newvalue")+'</th><th class="mw100">'+ZPI18N.getString("zp.oldvalue")+'</th><th class="mw100">'+ZPI18N.getString("zp.newvalue")+'</th><th class="mw100">'+ZPI18N.getString("zp.oldvalue")+'</th><th class="mw100">'+ZPI18N.getString("zp.newvalue")+'</th><th class="mw100">'+ZPI18N.getString("zp.oldvalue")+'</th><th class="mw100">'+ZPI18N.getString("zp.newvalue")+"</th></tr></thead></table></th>"+(isPartial?"<th>"+ZPI18N.getString("zp.approvalstatus")+"</th>":"")+"</tr></thead><tbody>"+tbodyHtml+"</tbody></table></div></div>"}return bodyHtml},constructAuditFlds:function(field,left,right){var fldHtml="";return(left||right)&&(fldHtml+="<li><span>"+field+'</span><div class="zpl_idiv">'),left&&(fldHtml+="<em>"+ZPUtil.getNoValueString(left)+"</em>"),right&&(fldHtml+=(left?'<i class="PI_frwd"></i>':"")+"<em>"+ZPUtil.getNoValueString(right)+"</em>"),(left||right)&&(fldHtml+="</div></li>"),fldHtml},allowFieldDisp:function(type,field,isTLEDIT){var allowedList;return type===Timetracker.constants.TIMESHEET_CONST?allowedList=new Array(ZPI18N.getString("zp.timesheetname"),ZPI18N.getString("zp.description"),ZPI18N.getString("zp.attachment")):type===Timetracker.constants.TIMELOG_CONST&&(allowedList=isTLEDIT?new Array(ZPI18N.getString("zp.billablestatus"),ZPI18N.getString("zp.fromtime"),ZPI18N.getString("zp.totime"),ZPI18N.getString("zp.totalhours")):new Array(Timetracker.constants.BILLABLE,Timetracker.constants.FROMTIME,Timetracker.constants.TOTIME,Timetracker.constants.TOTALHOURS,Timetracker.constants.WORKDATE)),ZPUtil.checkIsExistInArray(allowedList,field)},getColumn:function(field){var column=Timetracker.Audit.constants.COLUMN_MAP[field];return column||field},updateDtlsFromInfo:function(type,info){if(type===Timetracker.constants.TIMESHEET_CONST){var billableHours=info[Timetracker.Audit.getColumn(Timetracker.Audit.constants.BILLABLEHRS)],nonbillableHours=info[Timetracker.Audit.getColumn(Timetracker.Audit.constants.NONBILLABLEHRS)],totalHours=info[Timetracker.Audit.getColumn(Timetracker.Audit.constants.TOTALHRS)];void 0!==billableHours&&void 0!==nonbillableHours&&void 0!==totalHours&&Timetracker.Audit.Timesheet.updateTSHours(Timetracker.Audit.Timesheet.getMinsFromHrs(billableHours),Timetracker.Audit.Timesheet.getMinsFromHrs(nonbillableHours),Timetracker.Audit.Timesheet.getMinsFromHrs(totalHours))}},printAudit:function(formName){var empName=Timetracker.timesheet.editListData.hasOwnProperty("empName")?Timetracker.timesheet.editListData.empName:"-",header=formName+" ( "+ZPUtil.escapeHtml(Layout.Page.container.find("#timesheet_name").val())+" - "+empName+" ) "+ZPI18N.getString("zp.audithistory");Timetracker.Print.printPage({divId:"zp_ttaudit_modal_body",header:header,headerClass:"zpl_mhder"})},Timesheet:{HOURS_JSON:{},getMinsFromHrs:function(value){var mins=Calendar.hrstomins(value);return ZPUtil.Validation.isNumber(mins)?mins:0},updateTSHour:function(field,value){value=Timetracker.Audit.Timesheet.getMinsFromHrs(value),field===ZPI18N.getString("zp.billablehours")?Timetracker.Audit.Timesheet.updateTSHours(value,Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.NONBILLABLEHRS),Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.TOTALHRS)):field===ZPI18N.getString("zp.nonbillablehours")?Timetracker.Audit.Timesheet.updateTSHours(Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.BILLABLEHRS),value,Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.TOTALHRS)):field===ZPI18N.getString("zp.totalhours")?Timetracker.Audit.Timesheet.updateTSHours(Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.BILLABLEHRS),Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.NONBILLABLEHRS),value):field===ZPI18N.getString("zp.approved")+" "+ZPI18N.getString("zp.billablehours")?Timetracker.Audit.Timesheet.updateTSHours(value,Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_NONBILLABLEHRS),Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_TOTALHRS),!0):field===ZPI18N.getString("zp.approved")+" "+ZPI18N.getString("zp.nonbillablehours")?Timetracker.Audit.Timesheet.updateTSHours(Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_BILLABLEHRS),value,Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_TOTALHRS),!0):field===ZPI18N.getString("zp.approved")+" "+ZPI18N.getString("zp.totalhours")&&Timetracker.Audit.Timesheet.updateTSHours(Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_BILLABLEHRS),Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_NONBILLABLEHRS),value,!0)},updateTSHours:function(billableHrs,nonbillableHrs,totalHrs,isApproval){void 0!==isApproval&&!0===isApproval?(Timetracker.Audit.Timesheet.HOURS_JSON[Timetracker.Audit.constants.APP_BILLABLEHRS]=ZPUtil.Validation.isNumber(billableHrs)?billableHrs:Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_BILLABLEHRS),Timetracker.Audit.Timesheet.HOURS_JSON[Timetracker.Audit.constants.APP_NONBILLABLEHRS]=ZPUtil.Validation.isNumber(nonbillableHrs)?nonbillableHrs:Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_NONBILLABLEHRS),Timetracker.Audit.Timesheet.HOURS_JSON[Timetracker.Audit.constants.APP_TOTALHRS]=ZPUtil.Validation.isNumber(totalHrs)?totalHrs:Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.APP_TOTALHRS)):(Timetracker.Audit.Timesheet.HOURS_JSON[Timetracker.Audit.constants.BILLABLEHRS]=ZPUtil.Validation.isNumber(billableHrs)?billableHrs:Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.BILLABLEHRS),Timetracker.Audit.Timesheet.HOURS_JSON[Timetracker.Audit.constants.NONBILLABLEHRS]=ZPUtil.Validation.isNumber(nonbillableHrs)?nonbillableHrs:Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.NONBILLABLEHR),Timetracker.Audit.Timesheet.HOURS_JSON[Timetracker.Audit.constants.TOTALHRS]=ZPUtil.Validation.isNumber(totalHrs)?totalHrs:Timetracker.Audit.Timesheet.getTSHours(Timetracker.Audit.constants.TOTALHRS))},getTSHours:function(key){return Timetracker.Audit.Timesheet.HOURS_JSON[key]?Timetracker.Audit.Timesheet.HOURS_JSON[key]:0}}},Timetracker.FireScroll={FIRESCROLL_DTLS:{},initFireScroll:function(mode,url,params,callback,id,otherDtls){var extraDtls={mode:mode,url:url,params:params,callback:callback};void 0!==otherDtls&&(extraDtls.otherDtls=otherDtls,otherDtls.maxFetchCount&&(extraDtls.maxFetchCount=otherDtls.maxFetchCount),otherDtls.scrollDiv&&(extraDtls.scrollDiv=otherDtls.scrollDiv)),Timetracker.FireScroll.resetFirescrollDtls(mode),Timetracker.FireScroll.setFirescrollDtls(mode,extraDtls),ZPeople.FireScroll.init(Timetracker.FireScroll.loadMoreData,id,extraDtls,!0)},resetDataOnLoad:function(mode){Timetracker.FireScroll.resetFirescrollDtls(mode),Timetracker.FireScroll.resetFetchCount(mode),Timetracker.FireScroll.setMaxFetchCount(mode),ZPeople.FireScroll.reset(mode)},getFirescrollDtls:function(mode){return Timetracker.FireScroll.FIRESCROLL_DTLS[mode]?Timetracker.FireScroll.FIRESCROLL_DTLS[mode]:{}},setFirescrollDtls:function(mode,dtlsJson){Timetracker.FireScroll.FIRESCROLL_DTLS[mode]?Timetracker.FireScroll.FIRESCROLL_DTLS[mode]=$.extend(Timetracker.FireScroll.FIRESCROLL_DTLS[mode],dtlsJson,!0):Timetracker.FireScroll.FIRESCROLL_DTLS[mode]=dtlsJson},resetFirescrollDtls:function(mode,type){"STARTS_WITH"===type?Object.keys(Timetracker.FireScroll.FIRESCROLL_DTLS).forEach(function(key){key.includes(mode)&&delete Timetracker.FireScroll.FIRESCROLL_DTLS[key]}):Timetracker.FireScroll.FIRESCROLL_DTLS[mode]&&delete Timetracker.FireScroll.FIRESCROLL_DTLS[mode]},setFetchCount:function(mode,result){var length=0;result instanceof Object?length=Object.keys(result).length:result instanceof Array&&(length=result.length);var json=Timetracker.FireScroll.getFirescrollDtls(mode);json.fetchedCount=ZPUtil.Validation.isNumber(json.fetchedCount)?json.fetchedCount:0,json.fetchedCount+=length,Timetracker.FireScroll.setFirescrollDtls(mode,json),json.skipFireScrollReset||Timetracker.FireScroll.resetFireScroll(mode,result),json.skipFireScrollReset=!1},reduceFetchedCountByGivenLimit:function(mode,limit){if(void 0!==limit){var json=Timetracker.FireScroll.getFirescrollDtls(mode);json.fetchedCount=json.fetchedCount>=limit?json.fetchedCount-limit:0,Timetracker.FireScroll.setFirescrollDtls(mode,json)}},resetFetchCount:function(mode){var json=Timetracker.FireScroll.getFirescrollDtls(mode);json.fetchedCount=0,Timetracker.FireScroll.setFirescrollDtls(mode,json)},getFetchCount:function(mode){var json=Timetracker.FireScroll.getFirescrollDtls(mode);return json.fetchedCount=ZPUtil.Validation.isNumber(json.fetchedCount)?json.fetchedCount:0,0===json.fetchedCount?json.fetchedCount:json.fetchedCount+1},setMaxFetchCount:function(mode,maxLimit){var json=Timetracker.FireScroll.getFirescrollDtls(mode);json.maxFetchCount=maxLimit||Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,Timetracker.FireScroll.setFirescrollDtls(mode,json)},getMaxFetchCount:function(mode){var json=Timetracker.FireScroll.getFirescrollDtls(mode);return json.maxFetchCount=ZPUtil.Validation.isNumber(json.maxFetchCount)?json.maxFetchCount:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,json.maxFetchCount},loadMoreData:function(extraDtls,limit){var mode=extraDtls.mode,url=extraDtls.url,params=extraDtls.params,callback=extraDtls.callback,otherDtls=extraDtls.otherDtls;if(void 0!==otherDtls&&otherDtls.forFormLookup)params.startInd=Timetracker.FireScroll.getFetchCount(mode);else{if(void 0!==otherDtls&&otherDtls.loadCacheData)return void callback(Timetracker.FireScroll.getFetchCount(mode)-1);params.sIndex=Timetracker.FireScroll.getFetchCount(mode),params.limit=limit||Timetracker.FireScroll.getMaxFetchCount(mode)}extraDtls.skipFireScrollReset=!!limit,Timetracker.FireScroll.sendRequest(mode)&&(void 0!==otherDtls?ZPeople.Request.send(url,params,callback,otherDtls):ZPeople.Request.send(url,params,callback))},sendRequest:function(mode){return mode!==Timetracker.constants.JOB_SCHD_REPORT.SUMMARY&&mode!==Timetracker.constants.JOB_SCHD_REPORT.DETAILED||Timetracker.jobSchedule.getActiveView()===mode},resetFireScroll:function(mode,result){var maxFetchCount=Timetracker.FireScroll.getMaxFetchCount(mode),length=0;result instanceof Object?length=Object.keys(result).length:result instanceof Array&&(length=result.length),length>=maxFetchCount?ZPeople.FireScroll.reset(mode):(Timetracker.FireScroll.resetFirescrollDtls(mode),ZPeople.FireScroll.setParam("triggered",!0,mode))},hasMoreData:function(mode){return Object.keys(Timetracker.FireScroll.getFirescrollDtls(mode)).length>0},checkAndLoadMoreData:function(mode,limit){Timetracker.FireScroll.hasMoreData(mode)&&(Timetracker.FireScroll.reduceFetchedCountByGivenLimit(mode,limit),Timetracker.FireScroll.loadMoreData(Timetracker.FireScroll.getFirescrollDtls(mode),limit))},hasScrollBar:function(id){var scrollObj="";return scrollObj=id?Layout.Page.container.find("#"+id).find("[scroll=enabled]"):Layout.Page.container.find("[scroll=enabled]"),$(scrollObj).get(0).scrollHeight>$(scrollObj).get(0).clientHeight},increaseFetchedCount:function(mode,count){if(Timetracker.FireScroll.hasMoreData(mode)){var json=Timetracker.FireScroll.getFirescrollDtls(mode);json.fetchedCount+=count,Timetracker.FireScroll.setFirescrollDtls(mode,json)}}},Timetracker.Filters={ISSCROLLED:!0,TRIGGER_SCROLL:!0,initSelect:function(selJson){if(selJson){var cacheKey=selJson.elementId;if(selJson.hasOwnProperty("containerId")&&(cacheKey=selJson.containerId+"_"+selJson.elementId),selJson.elementId&&selJson.entity)void 0===Timetracker.Filters.Configuartion.getProperty(cacheKey+"-"+selJson.entity)&&Timetracker.Filters.Configuartion.setProperty(selJson),(selJson.hasOwnProperty("containerId")?Layout.Page.container.find("#"+selJson.containerId).find("#"+selJson.elementId):Layout.Page.container.find("#"+selJson.elementId)).off("open").on("open",function(){$("#select2-drop .select2-results").addClass("timetrackerSelect2");var isMulti=void 0!=selJson.multipleSelections&&1==selJson.multipleSelections;$(".timetrackerSelect2").off("scroll").on("scroll",function(){this.offsetHeight+this.scrollTop>=this.scrollHeight-150&&(selJson.callback&&ZPUtil.Validation.isFunction(selJson.callback)?selJson.callback(selJson):Timetracker.Filters.TRIGGER_SCROLL&&Timetracker.Filters.Search.loadMoreOptions(cacheKey+"-"+selJson.entity,this.scrollTop,isMulti))})})}},initZSelect:function(selJson){if(selJson){var eleId=selJson.elementId,cacheKey=eleId;selJson.hasOwnProperty("containerId")&&(cacheKey=selJson.containerId+"_"+eleId),eleId&&selJson.entity&&void 0===Timetracker.Filters.Configuartion.getProperty(cacheKey+"-"+selJson.entity)&&Timetracker.Filters.Configuartion.setProperty(selJson)}},Configuartion:{CONFIG_DTLS:{},setProperty:function(selJson){if(selJson&&selJson.elementId&&selJson.entity){var cacheKey=selJson.elementId;selJson.hasOwnProperty("containerId")&&(cacheKey=selJson.containerId+"_"+selJson.elementId),Timetracker.Filters.Configuartion.CONFIG_DTLS[cacheKey+"-"+selJson.entity]=selJson}},getProperty:function(entity){var conf;return entity&&Timetracker.Filters.Configuartion.CONFIG_DTLS[entity]&&(conf=Timetracker.Filters.Configuartion.CONFIG_DTLS[entity]),conf},resetProperty:function(entity){entity&&Timetracker.Filters.Configuartion.CONFIG_DTLS[entity]&&delete Timetracker.Filters.Configuartion.CONFIG_DTLS[entity]},resetAll:function(){Timetracker.Filters.Configuartion.CONFIG_DTLS={}}},Search:{SEARCH_DTLS:{},SEARCH_KEYS:{},setSearchDtlsAndKeys:function(entity,searchKey,dtlsJson){Timetracker.Filters.Search.setSearchKeys(entity,searchKey,dtlsJson),Timetracker.Filters.Search.setSearchDtls(entity,searchKey,dtlsJson)},setSearchKeys:function(entity,searchKey,dtlsJson){if(entity&&searchKey&&dtlsJson){Timetracker.Filters.Search.SEARCH_KEYS[entity]=Timetracker.Filters.Search.SEARCH_KEYS[entity]?Timetracker.Filters.Search.SEARCH_KEYS[entity]:{};var firstKey=searchKey.substring(0,1),searchKeyDtls=Timetracker.Filters.Search.getSearchKeyDtls(entity,firstKey),patterns=[],pushKey=!0,doSearch=firstKey!==searchKey||!(dtlsJson.result&&0===dtlsJson.result.length||void 0!==dtlsJson.doSearch&&!1===dtlsJson.doSearch);if(searchKeyDtls){for(var pattern in patterns=Timetracker.Filters.Search.SEARCH_KEYS[entity][firstKey].patterns)if(patterns[pattern]===searchKey){pushKey=!1;break}}else Timetracker.Filters.Search.SEARCH_KEYS[entity][firstKey]={};pushKey&&patterns.push(searchKey),Timetracker.Filters.Search.SEARCH_KEYS[entity][firstKey].patterns=patterns,Timetracker.Filters.Search.SEARCH_KEYS[entity][firstKey].doSearch=doSearch}},getHasSearchDtls:function(entity){return void 0!=Timetracker.Filters.Search.SEARCH_DTLS[entity]},getSearchKeyDtls:function(entity,firstKey,isFullKey){var searchKeyDtls;return entity&&firstKey&&Timetracker.Filters.Search.SEARCH_KEYS[entity]&&(!0===isFullKey&&(firstKey=firstKey.substring(0,1)),searchKeyDtls=Timetracker.Filters.Search.SEARCH_KEYS[entity][firstKey]),searchKeyDtls},setSearchDtls:function(entity,searchKey,dtlsJson){entity&&searchKey&&dtlsJson&&(Timetracker.Filters.Search.SEARCH_DTLS[entity]=Timetracker.Filters.Search.SEARCH_DTLS[entity]?Timetracker.Filters.Search.SEARCH_DTLS[entity]:{},Timetracker.Filters.Search.SEARCH_DTLS[entity][searchKey]=dtlsJson)},getSearchDtls:function(entity,searchKey){var searchDtls;return entity&&searchKey&&Timetracker.Filters.Search.SEARCH_DTLS[entity]&&Timetracker.Filters.Search.SEARCH_DTLS[entity][searchKey]&&(searchDtls=Timetracker.Filters.Search.SEARCH_DTLS[entity][searchKey]),searchDtls},resetSearchDtls:function(entity,searchKey){entity&&searchKey&&delete Timetracker.Filters.Search.SEARCH_DTLS[entity][searchKey]},resetAllSearchKeyDtls:function(entity){entity&&delete Timetracker.Filters.Search.SEARCH_KEYS[entity]},resetAllSearchDtls:function(entity){entity&&delete Timetracker.Filters.Search.SEARCH_DTLS[entity]},resetAllSearch:function(){Timetracker.Filters.Search.SEARCH_DTLS={}},getPatterns:function(entity,searchKey,searchKeyDtls){return void 0===searchKeyDtls&&(searchKeyDtls=Timetracker.Filters.Search.getSearchKeyDtls(entity,searchKey,!0)),searchKeyDtls&&searchKeyDtls.patterns?searchKeyDtls.patterns:[]},isKeyInitiated:function(entity,searchKey,searchKeyDtls){var index=Timetracker.Filters.Search.getPatterns(entity,searchKey,searchKeyDtls).indexOf(searchKey);if(-1!==index)return index},getPrfxDoSearch:function(entity,searchKey){var doSearchPrfx=!0,prefix=searchKey.slice(0,-1);0===prefix.length&&(prefix=Timetracker.constants.SELECT_OPT_ALL);var prfxDtls=Timetracker.Filters.Search.getSearchDtls(entity,prefix);return void 0!==prfxDtls&&(doSearchPrfx=prfxDtls.doSearch),doSearchPrfx},isPrfxKeyInitiated:function(entity,searchKey,searchKeyDtls){return void 0===searchKeyDtls&&(searchKeyDtls=Timetracker.Filters.Search.getSearchKeyDtls(entity,searchKey,!0)),void 0!==searchKeyDtls},doSearch:function(entity,searchKey,isFromScroll){var searchKeyDtls=Timetracker.Filters.Search.getSearchKeyDtls(entity,searchKey,!0),allowRequestSend=!0,isKeyInitiated=Timetracker.Filters.Search.isKeyInitiated(entity,searchKey,searchKeyDtls);if(void 0===isKeyInitiated||-1===isKeyInitiated)allowRequestSend=Timetracker.Filters.Search.getPrfxDoSearch(entity,searchKey,isFromScroll);else{var searchDtls=Timetracker.Filters.Search.getSearchDtls(entity,searchKey);allowRequestSend=!!isFromScroll&&searchDtls.doSearch}return allowRequestSend},getMatches:function(entity,searchKey){var searchResults;return entity&&void 0!==searchKey&&(searchKey=(searchKey=""===searchKey?Timetracker.constants.SELECT_OPT_ALL:searchKey).toLowerCase(),searchResults=Timetracker.Filters.Search.getSearchDtls(entity,searchKey)),searchResults},getSearchResults:async function(searchKey,entity,isFromScroll){var doSearch=!1,searchResults=[];if(entity&&void 0!==searchKey&&(searchKey=(searchKey=""===searchKey?Timetracker.constants.SELECT_OPT_ALL:searchKey).toLowerCase(),doSearch=Timetracker.Filters.Search.doSearch(entity,searchKey,isFromScroll)),doSearch){searchResults=Timetracker.Filters.Search.getMatches(entity,searchKey);var conf=Timetracker.Filters.Configuartion.getProperty(entity);if(conf.doSearch=!0,conf&&conf.url&&conf.params){var params=conf.params,searchlen=0;void 0!==searchResults&&(searchlen=searchResults.result.length),params.sIndex=0===searchlen?searchlen:searchlen+1,params.limit=conf.limit?conf.limit:Timetracker.constants.SELECT_OPTLIMIT,searchKey!==Timetracker.constants.SELECT_OPT_ALL?params.searchKey=searchKey:delete params.searchKey;var extraDtls={searchKey:searchKey,conf:conf,entity:entity,params:params},[result]=await ZPeople.Request.sendRequestAsPromise(conf.url,params);searchResults=Timetracker.Filters.Search.afterSearchResultFetch(searchResults,result,extraDtls)}else searchResults=[]}else searchResults=Timetracker.Filters.Search.getSearchResultsFromCache(searchKey,entity);return searchResults},afterSearchResultFetch:function(searchResults,result,extraDtls){if(result&&null!=result){if(result.constructor!==Array){var type,typeArr=extraDtls.entity.split("-");typeArr.length>0&&typeArr[1]&&(type=typeArr[1]),result=result.res&&type&&result[type+"Arr"]?result[type+"Arr"]:[]}searchResults=void 0===searchResults?Timetracker.Filters.Util.convertResultFormat(extraDtls.entity,result):searchResults.result.concat(Timetracker.Filters.Util.convertResultFormat(extraDtls.entity,result));var doSearch=!(extraDtls.params.limit&&result.length<extraDtls.params.limit||0===result.length);Timetracker.Filters.TRIGGER_SCROLL=doSearch;var dtlsJson={result:searchResults,doSearch:doSearch};return Timetracker.Filters.Search.setSearchDtlsAndKeys(extraDtls.entity,extraDtls.searchKey,dtlsJson),doSearch||Timetracker.jobs.Util.setAllJobsOrProjectsFetched(extraDtls.conf),searchResults}},checkCacheForData:function(conf,element){var id,data=null;if("project"==element)data=Timetracker.projects.projectData,id="clientId";else{if("job"!=element)return;data=Timetracker.jobs.jobData,id="projectId"}if(0!=Object.keys(data).length&&"0"!=conf.params[id]){var flag=!1,elementIds=conf.params[id];elementIds=elementIds.split(",");var removeElements=[],result=[];for(i in data)elementIds.includes(data[i][id])&&(flag=!0,removeElements.push(data[i][id]),result.push(data[i]));for(i in removeElements){var index=elementIds.indexOf(removeElements[i]);index>-1&&elementIds.splice(index,1)}return flag&&(conf.params[id]=elementIds.toString(),Timetracker.Filters.Configuartion.setProperty(conf)),result.sendRequest=!0,0==elementIds.length&&(result.sendRequest=!1),result}},searchForPrefxFromCache:function(searchDtls,searchKey){for(var newSearchDtls=[],itr=0;itr<searchDtls.length;itr++)-1!==ZPeople.decodeTxt(searchDtls[itr].text).toLowerCase().indexOf(searchKey)&&newSearchDtls.push(searchDtls[itr]);return newSearchDtls},getSearchResultsFromCache:function(searchKey,entity){var searchResults=[],prefx=searchKey.slice(0,-1);0===prefx.length&&(prefx=Timetracker.constants.SELECT_OPT_ALL);var fireScrollDosearch=!0;if(void 0===(searchDtls=Timetracker.Filters.Search.getSearchDtls(entity,searchKey))){var newSearchDtls=Timetracker.Filters.Search.getSearchDtls(entity,prefx).result,dtlsJson={result:newSearchDtls=Timetracker.Filters.Search.searchForPrefxFromCache(newSearchDtls,searchKey),doSearch:!1};Timetracker.Filters.Search.setSearchDtlsAndKeys(entity,searchKey,dtlsJson),searchResults=newSearchDtls,fireScrollDosearch=!1}else if(void 0!==searchDtls){var searchDtls;searchResults=(searchDtls=Timetracker.Filters.Search.getSearchDtls(entity,searchKey)).result,fireScrollDosearch=searchDtls.doSearch}return Timetracker.Filters.TRIGGER_SCROLL=fireScrollDosearch,searchResults},loadMoreOptions:function(entity,st,isMulti){var searchKey,query,conf=Timetracker.Filters.Configuartion.getProperty(entity);conf&&conf.elementId&&(searchKey=(conf.hasOwnProperty("containerId")?Layout.Page.container.find("#"+conf.containerId).find("#"+conf.elementId):Layout.Page.container.find("#"+conf.elementId)).data("select2").search[0].value,query=conf.query);if(query){var results=[],defSelJson=conf.defSelJson;defSelJson&&!isMulti&&results.push(defSelJson);let res=Timetracker.Filters.Search.getSearchResults(searchKey||"",entity,!0);results=results.concat(res),query.callback({results:results}),$(".select2-results").scrollTop(st)}},getOptionsForFilter:async function(json,entity){var doSearch=!1,searchResults=[],searchKey=json.query.term;if(entity&&void 0!==searchKey&&(searchKey=(searchKey=""===searchKey?Timetracker.constants.SELECT_OPT_ALL:searchKey).toLowerCase(),doSearch=Timetracker.Filters.Search.doSearch(entity,searchKey,1!=json.query.page||json.fetchExtraOption)),doSearch){searchResults=Timetracker.Filters.Search.getMatches(entity,searchKey);var conf=Timetracker.Filters.Configuartion.getProperty(entity);if(conf.doSearch=!0,conf&&conf.url&&conf.params){var params=conf.params,searchlen=0;void 0!==searchResults&&(searchlen=searchResults.result.length),params.sIndex=0===searchlen?searchlen:searchlen+1,params.limit=conf.limit?conf.limit:Timetracker.constants.SELECT_OPTLIMIT,searchKey!==Timetracker.constants.SELECT_OPT_ALL?params.searchKey=searchKey:delete params.searchKey,params.conreqcsr||(params.conreqcsr=csrfToken);var extraDtls={searchKey:searchKey,conf:conf,entity:entity,params:params},[result]=await ZPeople.Request.sendRequestAsPromise(conf.url,params);searchResults=ZPUtil.Validation.isFunction(conf.callbackToProcessSearchResults)?conf.callbackToProcessSearchResults(searchResults,result,extraDtls):Timetracker.Filters.Search.afterSearchResultFetch(searchResults,result,extraDtls)}else searchResults=[]}else searchResults=searchResults.concat(Timetracker.Filters.Search.getSearchResultsFromCache(searchKey,entity));return searchResults}},Util:{convertResultFormat:function(entity,result){var type,id,name,resultArr=[],typeArr=entity.split("-");switch(typeArr.length>0&&typeArr[1]&&(type=typeArr[1]),type){case Timetracker.constants.CLIENT:id="clientId",name="clientName";break;case Timetracker.constants.PROJECT:id="projectId",name="projectName";break;case Timetracker.constants.JOB:id="jobId",name="jobName"}if(id&&name)for(var i in result)switch(resultArr.push({id:result[i][id],text:result[i][name],html:result[i][name],clientId:result[i][id],detail:result[i]}),type){case Timetracker.constants.CLIENT:void 0===Timetracker.clients.clientData[result[i][id]]&&(Timetracker.clients.clientData[result[i][id]]=result[i]);break;case Timetracker.constants.PROJECT:void 0===Timetracker.projects.projectData[result[i][id]]&&(Timetracker.projects.projectData[result[i][id]]=result[i]);break;case Timetracker.constants.JOB:Timetracker.jobs.jobData[result[i][id]]=result[i]}return resultArr},resetPropAndSearch:function(entity){Timetracker.Filters.Configuartion.resetProperty(entity),Timetracker.Filters.Search.resetAllSearchDtls(entity),Timetracker.Filters.Search.resetAllSearchKeyDtls(entity)}},emp_Types:null,loadEmployeeType:function(id){if(id)if(Timetracker.generalSettings.isBudgetEnabled())if(Timetracker.Filters.emp_Types)Timetracker.Filters.constructEmployeeTypeFilter(id);else{var json={url:Timetracker.constants.URL,params:{mode:"getEmployeeTypes"},callback:Timetracker.Filters.loadEmployeeTypeCallback,otherdetails:{id:id}};Timetracker.Request.send(json)}else Layout.Page.container.find("#"+id).closest("div.col-md-2").remove()},loadEmployeeTypeCallback:function(result,params,otherdetails){var id;Timetracker.Filters.emp_Types=result&&result.employeeTypes?result.employeeTypes:[],otherdetails&&(id=otherdetails.id),Timetracker.Filters.constructEmployeeTypeFilter(id)},constructEmployeeTypeFilter:function(id){if(id){var optionsHtml='<option value="0">'+ZPI18N.getString("zp.all")+"</option>";Timetracker.Filters.emp_Types&&$.each(Timetracker.Filters.emp_Types,function(index,empTypeJson){optionsHtml+='<option value="'+empTypeJson.optionId+'">'+empTypeJson.optionValue+"</option>"}),Layout.Page.container.find("#"+id).html(optionsHtml).val("0").select2({minimumResultsForSearch:1/0})}},desg_list:["UserLogHoursReport","PayrollReport","TimelogReport","SchVsWorkedReport","JobSchedule","MyTimeSheet","integrationReport","JOBREPORT","projectReport"],dept_list:["UserLogHoursReport","PayrollReport","TimelogReport","SchVsWorkedReport","JobSchedule","TimerReport","JOBREPORT","projectReport","MyTimeSheet","MyApproval","UnassJob","integrationReport","UnassProject"],loc_list:["UserLogHoursReport","PayrollReport","SchVsWorkedReport","JobSchedule","TimelogReport","JOBREPORT","projectReport","MyTimeSheet","MyApproval","integrationReport","TTBreak","LocationJobSchedule"],division_list:["TimelogReport","JOBREPORT","projectReport","UserLogHoursReport","SchVsWorkedReport","PayrollReport","integrationReport","MyTimeSheet","JobSchedule"],business_unit_list:["TimelogReport","JOBREPORT","projectReport","UserLogHoursReport","SchVsWorkedReport","PayrollReport","integrationReport","MyTimeSheet","JobSchedule"],legal_entity_list:["TimelogReport","JOBREPORT","projectReport","UserLogHoursReport","SchVsWorkedReport","PayrollReport","integrationReport","MyTimeSheet","JobSchedule"],org_tag_list:["UserLogHoursReport","PayrollReport","TimelogReport","SchVsWorkedReport","JobSchedule","MyTimeSheet","integrationReport","JOBREPORT","projectReport"],setting_list:["TTBreak"],report_list:["UserLogHoursReport","PayrollReport","TimelogReport","SchVsWorkedReport","integrationReport","JOBREPORT","projectReport"],data_list:["MyTimeSheet","JobSchedule"],getParamsForFilter:function(operation){var params={mode:"getDeptAndLocList",conreqcsr:csrfToken},isFromReports=!!ZPUtil.checkIsExistInArray(Timetracker.Filters.report_list,operation),location=isFromReports?"reports_loc_List":"loc_List",department=isFromReports?"reports_dept_List":"dept_List",designation=isFromReports?"reports_desg_List":"desg_List",legalEntityList=isFromReports?"reports_legalEntityList":"legalEntityList",businessUnitList=isFromReports?"reports_businessUnitList":"businessUnitList",divisionList=isFromReports?"reports_divisionList":"divisionList",orgtagsList=isFromReports?"reports_orgTagList":"orgTagList";return ZPUtil.checkIsExistInArray(Timetracker.Filters.dept_list,operation)&&Timetracker.Department[department].load&&(params.deptfetch=!0),(ZPUtil.checkIsExistInArray(Timetracker.Filters.loc_list,operation)&&Timetracker.Location[location].load||ZPUtil.checkIsExistInArray(Timetracker.Filters.setting_list,operation)&&Timetracker.Location.settings_loc_list.refresh)&&(params.locfetch=!0),ZPUtil.checkIsExistInArray(Timetracker.Filters.desg_list,operation)&&Timetracker.Designation[designation].load&&(params.desgfetch=!0),isOrgStructureEnabled&&(ZPUtil.checkIsExistInArray(Timetracker.Filters.division_list,operation)&&Timetracker.Division[divisionList].refresh&&(params.fetchDivisions=!0),ZPUtil.checkIsExistInArray(Timetracker.Filters.business_unit_list,operation)&&Timetracker.BusinessUnit[businessUnitList].refresh&&(params.fetchBusinessUnits=!0),ZPUtil.checkIsExistInArray(Timetracker.Filters.legal_entity_list,operation)&&Timetracker.LegalEntity[legalEntityList].refresh&&(params.fetchLegalEntities=!0)),Timetracker.generalSettings.isOrgTagEnabled()&&ZPUtil.checkIsExistInArray(Timetracker.Filters.org_tag_list,operation)&&Timetracker.organizationTags[orgtagsList].refresh&&(params.fecthOrgTags=!0),ZPUtil.checkIsExistInArray(Timetracker.Filters.setting_list,operation)?params.submode=Timetracker.constants.Perm.SETTINGS:Timetracker.isTTCustomAdminForAny()&&(ZPUtil.checkIsExistInArray(Timetracker.Filters.data_list,operation)?params.submode=Timetracker.constants.Perm.DATA:isFromReports&&(params.submode=Timetracker.constants.Perm.REPORTS)),params},setCacheForFilterValues:function(resultData,param){var isTTCustomAdmin=Timetracker.isTTCustomAdminForAny();param.deptfetch&&(isTTCustomAdmin?param.submode&&(param.submode==Timetracker.constants.Perm.REPORTS?Timetracker.Department.reports_dept_List=resultData.departmentlist:param.submode==Timetracker.constants.Perm.DATA&&(Timetracker.Department.dept_List=resultData.departmentlist)):Timetracker.Department.dept_List=Timetracker.Department.reports_dept_List=resultData.departmentlist),param.desgfetch&&(isTTCustomAdmin?param.submode&&(param.submode==Timetracker.constants.Perm.REPORTS?Timetracker.Designation.reports_desg_List=resultData.designationlist:param.submode==Timetracker.constants.Perm.DATA&&(Timetracker.Designation.desg_List=resultData.designationlist)):Timetracker.Designation.desg_List=Timetracker.Designation.reports_desg_List=resultData.designationlist),param.locfetch&&(isTTCustomAdmin?param.submode&&(param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.Location.reports_loc_List=resultData.locationlist:param.submode&&param.submode==Timetracker.constants.Perm.DATA?Timetracker.Location.loc_List=resultData.locationlist:param.submode===Timetracker.constants.Perm.SETTINGS&&(Timetracker.Location.settings_loc_list=resultData.locationlist)):isadmin?Timetracker.Location.loc_List=Timetracker.Location.reports_loc_List=Timetracker.Location.settings_loc_list=resultData.locationlist:param.submode===Timetracker.constants.Perm.SETTINGS?Timetracker.Location.settings_loc_list=resultData.locationlist:Timetracker.Location.loc_List=Timetracker.Location.reports_loc_List=resultData.locationlist),param.fetchDivisions&&(isTTCustomAdmin?param.submode&&(param.submode==Timetracker.constants.Perm.REPORTS?Timetracker.Division.reports_divisionList=resultData.divisionList:param.submode==Timetracker.constants.Perm.DATA&&(Timetracker.Division.divisionList=resultData.divisionList)):Timetracker.Division.divisionList=Timetracker.Division.reports_divisionList=resultData.divisionList),param.fetchBusinessUnits&&(isTTCustomAdmin?param.submode&&(param.submode&&param.submode==Timetracker.constants.Perm.REPORTS?Timetracker.BusinessUnit.reports_businessUnitList=resultData.businessUnitList:param.submode&&param.submode==Timetracker.constants.Perm.DATA&&(Timetracker.BusinessUnit.businessUnitList=resultData.businessUnitList)):Timetracker.BusinessUnit.businessUnitList=Timetracker.BusinessUnit.reports_businessUnitList=resultData.businessUnitList),param.fetchLegalEntities&&(isTTCustomAdmin?param.submode&&(param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.LegalEntity.reports_legalEntityList=resultData.legalEntityList:param.submode&&param.submode==Timetracker.constants.Perm.DATA&&(Timetracker.LegalEntity.legalEntityList=resultData.legalEntityList)):Timetracker.LegalEntity.legalEntityList=Timetracker.LegalEntity.reports_legalEntityList=resultData.legalEntityList),param.payperiodfetch&&$.each(resultData.reportsettinglist,function(key,value){Timetracker.reports.payrollReport.dataPeriod[value.rsID]=value}),param.fecthOrgTags&&(isTTCustomAdmin?param.submode&&(param.submode==Timetracker.constants.Perm.REPORTS?Timetracker.organizationTags.reports_orgTagList=resultData.organizationTagsList:param.submode==Timetracker.constants.Perm.DATA&&(Timetracker.organizationTags.orgTagList=resultData.organizationTagsList)):Timetracker.organizationTags.reports_orgTagList=Timetracker.organizationTags.orgTagList=resultData.organizationTagsList),param.fetchRoles&&(Timetracker.roles.reports_roleList=resultData.roleList)},getDefaultParams:function(type){var params={};switch(type){case Timetracker.constants.FILTERS.WEEKTIMELOGREPORT:case Timetracker.constants.FILTERS.MONTHTIMELOGREPORT:case Timetracker.constants.FILTERS.CUSTOMTIMELOGREPORT:params={jobId:"0",projectId:"0",clientId:"0",userErecNo:Timetracker.util.getUserErecno(),billStatus:"-1",jobStatus:"0",approvalStatus:"0",deptId:"0",locId:"0",employeeStatus:["17","18","-2","19"]};break;case Timetracker.constants.FILTERS.TIMERREPORT:params={user:Timetracker.util.getUserErecno(),deptId:"0",clientId:"0",projectId:"0",jobId:"0",approvalStatus:"0"};break;case Timetracker.constants.FILTERS.JOBREPORT:params={jobId:"0",userErecNo:Timetracker.util.getUserErecno(),employeeStatus:["17","18","-2","19"],billStatus:"-1",approvalStatus:"0",clientId:"0",jobStatus:"0",projectId:"0",deptId:"0",locId:"0"};break;case Timetracker.constants.FILTERS.PROJECTREPORT:params={projectId:"0",billStatus:"-1",clientId:"0",projectStatus:"0",deptId:"0",locId:"0",userErecNo:"0",employeeStatus:["17","18","-2","19"],approvalStatus:"0"};break;case Timetracker.constants.FILTERS.PAYROLLREPORT:params={jobId:"0",userErecNo:"0",approvalStatus:"0",clientId:"0",projectId:"0",deptId:"0",locationId:"0",rsId:null,employeeStatus:["17","18","-2","19"]};break;case Timetracker.constants.FILTERS.INTEGRATIONREPORT:params={jobId:"0",userErecNo:"0",clientId:"0",projectId:"0",jobstatus:"0",billStatus:"-1"};break;case Timetracker.constants.FILTERS.JOBSCHEDULEREPORT:params={deptId:"0",locId:"0",billableStatus:"-1",approvalStatus:"0",users:"0",employeeStatus:["17","18","-2","19"]}}return params},getAndValidateParams:function(type){var params=Timetracker.Filters.getDefaultParams(type);switch(type){case Timetracker.constants.FILTERS.WEEKTIMELOGREPORT:case Timetracker.constants.FILTERS.MONTHTIMELOGREPORT:case Timetracker.constants.FILTERS.CUSTOMTIMELOGREPORT:params.mode=type===Timetracker.constants.FILTERS.CUSTOMTIMELOGREPORT?"getTimesheetReport":"getWeekTimesheet",params.jobId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rjobName").val(),params.jobId),params.projectId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rprojectName").val(),params.projectId),params.clientId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rClientName").val(),params.clientId),params.userErecNo=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rUser").val()),params.billStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rbillstatus").val(),params.billStatus),params.jobStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rjobstatus").val(),params.jobStatus),params.approvalStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rApprovalstatus").val(),params.approvalStatus),params.employeeStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rEmpStatus").val(),params.employeeStatus),isOrgStructureEnabled&&(params.legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rLegalEntityName").val()),params.legalEntityId="0"!=params.legalEntityId?params.legalEntityId.toString():params.legalEntityId,params.businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rBusinessUnitName").val()),params.businessUnitId="0"!=params.businessUnitId?params.businessUnitId.toString():params.businessUnitId,params.divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rDivisionName").val()),params.divisionId="0"!=params.divisionId?params.divisionId.toString():params.divisionId),params.deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rDepartmentName").val()),params.deptId="0"!=params.deptId?params.deptId.toString():params.deptId,params.designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rDesignationName").val()),params.designationId="0"!=params.designationId?params.designationId.toString():params.designationId,params.locId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rLocationName").val(),params.locId),params.locId="0"!=params.locId?params.locId.toString():params.locId,params.projectId="0"!=params.projectId?params.projectId.toString():params.projectId,params.jobId="0"!=params.jobId?params.jobId.toString():params.jobId;var billingStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rbillingstatus").val(),"-1");Timetracker.isDataAdmin()&&(params.billingStatus=billingStatus),type===Timetracker.constants.FILTERS.MONTHTIMELOGREPORT&&(params.isMonthReport=!0),Timetracker.generalSettings.isBudgetEnabled()&&(params.employeeType=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#rEmpType").val(),"0")),"0"===params.userErecNo&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?params.isDirectSubOnlyNeeded=Layout.Page.container.find("#rincludeOnlyDirectSubordinates").is(":checked"):params.isDirectSubOnlyNeeded=!1,params.employeeStatus=params.employeeStatus.toString(),0!=Layout.Page.container.find("#rEmpStatus").val().length&&-1!==params.employeeStatus.indexOf("18")?params.employeeDateOfExitBased=Layout.Page.container.find("#remployeeDateOfExitBased").is(":checked"):params.employeeDateOfExitBased=!1,params.isChartView=type===Timetracker.constants.FILTERS.WEEKTIMELOGREPORT?Layout.Page.container.find("#timelog_Report_Chart").hasClass("btn-primary"):type===Timetracker.constants.FILTERS.CUSTOMTIMELOGREPORT&&Layout.Page.container.find("#daytimelog_Report_Chart").hasClass("btn-primary");break;case Timetracker.constants.FILTERS.TIMERREPORT:params.mode="getTimerReport",params.user=Layout.Page.container.find("#tirUser").val()||params.user,params.deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#tirDepartmentName").val(),ZPeople.CURR_USER.deptId?ZPeople.CURR_USER.deptId:params.deptId),params.clientId=Layout.Page.container.find("#tirClientName").val()||params.clientId,params.projectId=Layout.Page.container.find("#tirprojectName").val()||params.projectId,params.jobId=Layout.Page.container.find("#tirjobName").val()||params.jobId,params.approvalStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#tirApprovalstatus").val(),params.approvalStatus),Timetracker.generalSettings.isBudgetEnabled()&&(params.employeeType=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#tirEmpType").val()));break;case Timetracker.constants.FILTERS.USERLOGHOURSREPORT:params.mode="getUserLogHoursReport";var logPeriod=Layout.Page.container.find("#logPeriod").val(),mode="1"===logPeriod||"4"===logPeriod?Timetracker.util.WEEKLY:"2"===logPeriod||"5"===logPeriod?Timetracker.util.MONTHLY:"6"===logPeriod?Timetracker.util.CUSTOM:Timetracker.util.DAILY;mode===Timetracker.util.DAILY?(params.fromDate=Timetracker.DateTime.getDateinTSformat(Timetracker.reports.userLogHoursReport.currentReportDate.day),params.toDate=Timetracker.DateTime.getDateinTSformat(Timetracker.reports.userLogHoursReport.currentReportDate.day)):mode===Timetracker.util.WEEKLY||mode===Timetracker.util.MONTHLY?(params.fromDate=Timetracker.DateTime.getDateinTSformat(Timetracker.reports.userLogHoursReport.currentReportDate.from),params.toDate=Timetracker.DateTime.getDateinTSformat(Timetracker.reports.userLogHoursReport.currentReportDate.to)):mode===Timetracker.util.CUSTOM&&(params.fromDate=Layout.Page.container.find("#custom_fromdate").val(),params.toDate=Layout.Page.container.find("#custom_todate").val());var hoursComparator=Layout.Page.container.find("#logHoursValue").val();Timetracker.util.checkIsParamNotEmpty(hoursComparator)&&(params.hoursComparator=hoursComparator,"0"!==params.hoursComparator&&"4"!==params.hoursComparator&&(params.hours=Layout.Page.container.find("#hoursTxtBox").val()),"0"!==params.hoursComparator&&"1"!==params.hoursComparator||(params.includeUsersWithoutTimelogs=Layout.Page.container.find("#includeusersWithoutTimelogs").is(":checked"))),isOrgStructureEnabled&&(params.legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#userLogHoursReportLegalEntity").val()),params.legalEntityId="0"!=params.legalEntityId?params.legalEntityId.toString():params.legalEntityId,params.businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#userLogHoursReportBusinessUnit").val()),params.businessUnitId="0"!=params.businessUnitId?params.businessUnitId.toString():params.businessUnitId,params.divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#userLogHoursReportDivision").val()),params.divisionId="0"!=params.divisionId?params.divisionId.toString():params.divisionId),params.departmentId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#userLogHoursReportDepartment").val()),params.departmentId="0"!=params.departmentId?params.departmentId.toString():params.departmentId,params.designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#userLogHoursReportDesignation").val()),params.designationId="0"!=params.designationId?params.designationId.toString():params.designationId,params.locationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#userLogHoursReportLocation").val()),params.locationId="0"!=params.locId?params.locationId.toString():params.locationId;var approvalStatus=Layout.Page.container.find("#logApprovalstatus").val();Timetracker.util.checkIsParamNotEmpty(approvalStatus)&&approvalStatus.length>0&&(params.approvalStatus="",$.each(approvalStatus,function(index,element){params.approvalStatus+=element+";"}),params.approvalStatus=params.approvalStatus.substr(0,params.approvalStatus.length-1)),Layout.Page.container.find("#sortByEmployeeName").hasClass("sort-u")||Layout.Page.container.find("#sortByEmployeeName").hasClass("sort-d")?(params.sortType="0",params.isAscending=Layout.Page.container.find("#sortByEmployeeName").hasClass("sort-u")):Layout.Page.container.find("#sortByTotalHours").hasClass("sort-u")||Layout.Page.container.find("#sortByTotalHours").hasClass("sort-d")?(params.sortType="1",params.isAscending=Layout.Page.container.find("#sortByTotalHours").hasClass("sort-u")):(Layout.Page.container.find("#sortByReportingToName").hasClass("sort-u")||Layout.Page.container.find("#sortByReportingToName").hasClass("sort-d"))&&(params.sortType="2",params.isAscending=Layout.Page.container.find("#sortByReportingToName").hasClass("sort-u")),params.employeeStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#userLogHoursReportEmpStatus").val(),["17","18","-2","19"]),params.employeeStatus=params.employeeStatus.toString(),0!=Layout.Page.container.find("#userLogHoursReportEmpStatus").val().lenght&&-1!==params.employeeStatus.indexOf("18")?params.employeeDateOfExitBased=Layout.Page.container.find("#userLogHoursReportemployeeDateOfExitBased").is(":checked"):params.employeeDateOfExitBased=!1;break;case Timetracker.constants.FILTERS.JOBREPORT:params.mode="getJobReport",params.jobId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jrjobName").val())?Layout.Page.container.find("#jrjobName").val():params.jobId,params.userErecNo=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jrUser").val())?Layout.Page.container.find("#jrUser").val():"0","0"===params.userErecNo&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?params.isDirectSubOnlyNeeded=Layout.Page.container.find("#jrincludeOnlyDirectSubordinates").is(":checked"):params.isDirectSubOnlyNeeded=!1,params.employeeStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrEmpStatus").val(),params.employeeStatus),params.billStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrbillstatus").val(),params.billStatus),params.approvalStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrApprovalstatus").val(),params.approvalStatus),params.clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jrClientName").val())?Layout.Page.container.find("#jrClientName").val():params.clientId,params.jobStatus=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jrjobstatus").val())?Layout.Page.container.find("#jrjobstatus").val():params.jobStatus,params.projectId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jrprojectName").val())?Layout.Page.container.find("#jrprojectName").val():params.projectId,Timetracker.generalSettings.isBudgetEnabled()&&(params.employeeType=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrEmpType").val(),"0")),isOrgStructureEnabled&&(params.legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrLegalEntityName").val()),params.legalEntityId="0"!=params.legalEntityId?params.legalEntityId.toString():params.legalEntityId,params.businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrBusinessUnitName").val()),params.businessUnitId="0"!=params.businessUnitId?params.businessUnitId.toString():params.businessUnitId,params.divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrDivisionName").val()),params.divisionId="0"!=params.divisionId?params.divisionId.toString():params.divisionId),params.deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrDepartmentName").val(),params.deptId),params.deptId="0"!=params.deptId?params.deptId.toString():params.deptId,params.locId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrLocationName").val(),params.locId),params.locId="0"!=params.locId?params.locId.toString():params.locId,params.designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jrDesignationName").val(),"0"),params.designationId="0"!=params.designationId?params.designationId.toString():params.designationId,params.employeeStatus=params.employeeStatus.toString();break;case Timetracker.constants.FILTERS.PROJECTREPORT:params.mode="getProjectReport",params.userErecNo=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#pruser").val())?Layout.Page.container.find("#pruser").val():params.userErecNo,"0"===params.userErecNo&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?params.isDirectSubOnlyNeeded=Layout.Page.container.find("#princludeOnlyDirectSubordinates").is(":checked"):params.isDirectSubOnlyNeeded=!1,params.projectId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#prprojectName").val())?Layout.Page.container.find("#prprojectName").val():params.projectId,params.billStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prbillstatus").val(),params.billStatus),params.clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#prClientName").val())?Layout.Page.container.find("#prClientName").val():params.clientId,params.projectStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prprojectStatus").val(),params.projectStatus),isOrgStructureEnabled&&(params.legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prLegalEntityName").val()),params.legalEntityId="0"!=params.legalEntityId?params.legalEntityId.toString():params.legalEntityId,params.businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prBusinessUnitName").val()),params.businessUnitId="0"!=params.businessUnitId?params.businessUnitId.toString():params.businessUnitId,params.divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prDivisionName").val()),params.divisionId="0"!=params.divisionId?params.divisionId.toString():params.divisionId),params.deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prDepartmentName").val(),params.deptId),params.deptId="0"!=params.deptId?params.deptId.toString():params.deptId,params.locId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prLocationName").val(),params.locId),params.designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prDesignationName").val()),params.designationId="0"!=params.designationId?params.designationId.toString():params.designationId,params.locId="0"!=params.locId?params.locId.toString():params.locId,params.employeeStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prempstatus").val(),params.employeeStatus),params.approvalStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#prapprovalstatus").val(),params.approvalStatus),params.employeeStatus=params.employeeStatus.toString();break;case Timetracker.constants.FILTERS.PAYROLLREPORT:params.mode="getUserReport",params.isTotalNeeded=!0,params.jobId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#urjobName").val())?Layout.Page.container.find("#urjobName").val():params.jobId,params.userErecNo=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#urUser").val())?Layout.Page.container.find("#urUser").val():params.userErecNo,params.approvalStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#urApprovalstatus").val(),params.approvalStatus),params.clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#urClientName").val())?Layout.Page.container.find("#urClientName").val():params.clientId,params.projectId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#urprojectName").val())?Layout.Page.container.find("#urprojectName").val():params.projectId,isOrgStructureEnabled&&(params.legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#urLegalEntityName").val()),params.legalEntityId="0"!=params.legalEntityId?params.legalEntityId.toString():params.legalEntityId,params.businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#urBusinessUnitName").val()),params.businessUnitId="0"!=params.businessUnitId?params.businessUnitId.toString():params.businessUnitId,params.divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#urDivisionName").val()),params.divisionId="0"!=params.divisionId?params.divisionId.toString():params.divisionId),params.deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#urDepartmentName").val()),params.deptId="0"!=params.deptId?params.deptId.toString():params.deptId,params.designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#urDesignationName").val()),params.designationId="0"!=params.designationId?params.designationId.toString():params.designationId,params.locationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#urLocation").val()),params.locationId="0"!=params.locationId?params.locationId.toString():params.locationId,params.rsId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#urperiod").val(),params.rsId),params.employeeStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#urEmpStatus").val(),params.employeeStatus),params.employeeStatus=params.employeeStatus.toString(),0!=Layout.Page.container.find("#urEmpStatus").val().length&&-1!==params.employeeStatus.indexOf("18")?params.employeeDateOfExitBased=Layout.Page.container.find("#uremployeeDateOfExitBased").is(":checked"):params.employeeDateOfExitBased=!1,"0"===params.userErecNo&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?params.isDirectSubOnlyNeeded=Layout.Page.container.find("#urincludeOnlyDirectSubordinates").is(":checked"):params.isDirectSubOnlyNeeded=!1,-1!==["0","1","2","3","4","5","6"].toString().indexOf(params.rsId)&&delete params.rsId;break;case Timetracker.constants.FILTERS.BILLINGREPORT:params.mode="getBills";break;case Timetracker.constants.FILTERS.CLIENTREPORT:params.mode="getClientReport";break;case Timetracker.constants.FILTERS.INTEGRATIONREPORT:params.mode="getIntegReportTimesheet",params.jobId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#qbrjobName").val())?Layout.Page.container.find("#qbrjobName").val():params.jobId,params.userErecNo=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrUser").val())?Layout.Page.container.find("#qbrUser").val():params.userErecNo,params.clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#qbrClientName").val())?Layout.Page.container.find("#qbrClientName").val():params.clientId,params.projectId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#qbrprojectName").val())?Layout.Page.container.find("#qbrprojectName").val():params.projectId,params.jobstatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrjobstatus").val(),params.jobstatus),params.billStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrbillstatus").val(),params.billStatus),isOrgStructureEnabled&&(params.legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrLegalEntityName").val()),params.legalEntityId="0"!=params.legalEntityId?params.legalEntityId.toString():params.legalEntityId,params.businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrBusinessUnitName").val()),params.businessUnitId="0"!=params.businessUnitId?params.businessUnitId.toString():params.businessUnitId,params.divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrDivisionName").val()),params.divisionId="0"!=params.divisionId?params.divisionId.toString():params.divisionId),params.departmentId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrdepartmentname").val()),params.departmentId="0"!=params.departmentId?params.departmentId.toString():params.departmentId,params.designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrdesignationname").val()),params.designationId="0"!=params.designationId?params.designationId.toString():params.designationId,params.locationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#qbrlocationname").val()),params.locationId="0"!=params.locationId?params.locationId.toString():params.locationId,"0"===params.userErecNo&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?params.isDirectSubOnlyNeeded=Layout.Page.container.find("#jschdrincludeOnlyDirectSubordinates").is(":checked"):params.isDirectSubOnlyNeeded=!1;break;case Timetracker.constants.FILTERS.JOBSCHEDULEREPORT:params.mode="getJobScheduleReport",params.users=Layout.Page.container.find("#jschdrUser").val()||params.users,"0"===params.users&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?params.isDirectSubOnlyNeeded=Layout.Page.container.find("#jschdrincludeOnlyDirectSubordinates").is(":checked"):params.isDirectSubOnlyNeeded=!1,params.billableStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrbillstatus").val(),params.billableStatus),params.approvalStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrApprovalstatus").val(),params.approvalStatus),Timetracker.generalSettings.isBudgetEnabled()&&(params.employeeType=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrEmpType").val())),isOrgStructureEnabled&&(params.legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrLegalEntity").val()),params.legalEntityId="0"!=params.legalEntityId?params.legalEntityId.toString():params.legalEntityId,params.businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrBusinessUnit").val()),params.businessUnitId="0"!=params.businessUnitId?params.businessUnitId.toString():params.businessUnitId,params.divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrDivision").val()),params.divisionId="0"!=params.divisionId?params.divisionId.toString():params.divisionId),params.deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrdepartment").val(),params.deptId),params.deptId="0"!=params.deptId?params.deptId.toString():params.deptId,params.designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrdesignation").val()),params.designationId="0"!=params.designationId?params.designationId.toString():params.designationId,params.locId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrlocation").val(),params.locId),params.locId="0"!=params.locId?params.locId.toString():params.locId,params.employeeStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrEmpStatus").val(),params.employeeStatus),params.jobId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jschdrjobName").val())?Layout.Page.container.find("#jschdrjobName").val():"0",Timetracker.jobSchedule.Form.isClientFilterAllowed()&&(params.clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jschdrClientName").val())?Layout.Page.container.find("#jschdrClientName").val():"0"),params.projectId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jschdrprojectName").val())?Layout.Page.container.find("#jschdrprojectName").val():"0",params.employeeStatus=params.employeeStatus.toString(),0!=Layout.Page.container.find("#jschdrEmpStatus").val().lenght&&-1!==params.employeeStatus.indexOf("18")?params.employeeDateOfExitBased=Layout.Page.container.find("#jschdremployeeDateOfExitBased").is(":checked"):params.employeeDateOfExitBased=!1}return params.conreqcsr=csrfToken,params},appendOrRemoveEmpExportDataForForm:function(form,isPdf){isPdf?($(form).find("input[name=leaglEntityNeeded]").val(!1),$(form).find("input[name=businessUnitNeeded]").val(!1),$(form).find("input[name=divisionNeeded]").val(!1),$(form).find("input[name=designationNeeded]").val(!1),$(form).find("input[name=locationNeeded]").val(!1),$(form).find("input[name=reportingToNeeded]").val(!1),$(form).find("input[name=departmentNeeded]").val(!1),$(form).find("input[name=orgTagNeeded]").val(!1)):($(form).find("input[name=leaglEntityNeeded]").val($("#leaglEntityExport").is(":checked")),$(form).find("input[name=businessUnitNeeded]").val($("#businessUnitExport").is(":checked")),$(form).find("input[name=divisionNeeded]").val($("#divisionExport").is(":checked")),$(form).find("input[name=designationNeeded]").val($("#designationExport").is(":checked")),$(form).find("input[name=locationNeeded]").val($("#locationExport").is(":checked")),$(form).find("input[name=reportingToNeeded]").val($("#reportingToExport").is(":checked")),$(form).find("input[name=departmentNeeded]").val($("#departmentExport").is(":checked")),Timetracker.generalSettings.isOrgTagEnabled()&&$(form).find("input[name=orgTagNeeded]").val($("#orgTagExport").is(":checked")))},getParamsForEmpReltFilters:function(params,filterDiv,formatAsJson,skipDefaultValues){const empFilters={departmentId:"departmentFilter",designationId:"designationFilter",locationId:"locationFilter",legalEntityId:"legalEntityFilter",businessUnitId:"businessUnitFilter",divisionId:"divisionFilter",employeeStatus:"employeeStatusFilter"};for(const key in empFilters)if(values=ZPLite.Filters.getValues(filterDiv.find('[name="'+empFilters[key]+'"]')),values&&values.length>0&&(!skipDefaultValues||1!=values.length||"0"!=values[0])){let idArray=[];$.each(values,function(index,option){idArray.push(option.id)}),params[key]=formatAsJson?JSON.stringify(idArray):idArray.join(",")}Timetracker.organizationTags.fetchParams(filterDiv,params,!0,formatAsJson,skipDefaultValues),Timetracker.roles.fetchParams(filterDiv,params,!0,formatAsJson,skipDefaultValues)},getParamsForFormReltFilters:function(params,filterDiv,formatAsJson,skipDefaultValues){const formFilters={clientId:"clientFilter",projectId:"projectFilter",jobId:"jobFilter"};for(const key in formFilters)if(values=ZPLite.Filters.getValues(filterDiv.find('[name="'+formFilters[key]+'"]')),values&&values.length>0&&(!skipDefaultValues||1!=values.length||"0"!=values[0])){let idArray=[];$.each(values,function(index,option){idArray.push(option.id)}),params[key]=formatAsJson?JSON.stringify(idArray):idArray.join(",")}},getParamsForEmpAddnFields:function(params,exportContainer){const empFields_department=0,empFields_designation=1,empFields_location=2,empFields_leagalEntity=3,empFields_businessUnit=4,empFields_division=5,empFields_reportingTo=6,empFields_orgTag=7,empFields_role=8;let empAddnExportFields=[];exportContainer.find("#departmentExport").is(":checked")&&empAddnExportFields.push(empFields_department),exportContainer.find("#designationExport").is(":checked")&&empAddnExportFields.push(empFields_designation),exportContainer.find("#locationExport").is(":checked")&&empAddnExportFields.push(empFields_location),exportContainer.find("#leaglEntityExport").is(":checked")&&empAddnExportFields.push(empFields_leagalEntity),exportContainer.find("#businessUnitExport").is(":checked")&&empAddnExportFields.push(empFields_businessUnit),exportContainer.find("#divisionExport").is(":checked")&&empAddnExportFields.push(empFields_division),exportContainer.find("#reportingToExport").is(":checked")&&empAddnExportFields.push(empFields_reportingTo),Timetracker.generalSettings.isOrgTagEnabled()&&exportContainer.find("#orgTagExport").is(":checked")&&empAddnExportFields.push(empFields_orgTag),Timetracker.generalSettings.isRoleFilterEnabled()&&exportContainer.find("#roleExport").is(":checked")&&empAddnExportFields.push(empFields_role),Object.keys(empAddnExportFields).length>0&&(params.empAddnExportFields=encodeURIComponent(JSON.stringify(empAddnExportFields)))}},Timetracker.Import={importfileUpContiner:null,importfileUpObj:null,importfile:null,importObj:null,options:null,importContainer:null,format:null,fileData:null,dtls:null,fileType:["xls","csv","xlsx","ics"],acceptFiles:".xls,.xlsx,.csv,.ics",acceptFilesText:"zp.formfomtsupportxlscsv",action:"",construct:function(){var modalObj;if(null==Timetracker.Import.importfileUpObj){dtls=Timetracker.Import.dtls?Timetracker.Import.dtls:{};let popUpParams={id:"ttImportFile"};popUpParams.cardId=popUpParams.id+"_Card",popUpParams.callback=function(){Timetracker.Util.getMainContainer().find("#"+popUpParams.cardId).html(dtls.fileSlider?dtls.fileSlider(dtls):"")},(modalObj=Timetracker.Import.importfileUpObj=new fullPageModal(ZPI18N.getString("zp.import"),popUpParams)).ftExtraCls="zpl_DNI",modalObj.save="Next",modalObj._saveToggle=!1,modalObj._fullPageModalId="ttImportFileUpload",modalObj.construct()}else Timetracker.Import.importfileUpObj.open(),modalObj=Timetracker.Import.importfileUpObj;var container=Timetracker.Import.importfileUpContiner=Timetracker.Util.getMainContainer().find("#"+modalObj._fullPageModalId);container.find("[name=ttImportFile]").addClass("zpl_crdwthful zpl_crdfull"),container.find(".zpl_imprtrecord").addClass("zpl_DNI"),container.find(".zpl_mmnulft").addClass("zpl_DNI"),container.find("#importFileDiv1").removeClass("zpl_DNI"),container.find("[elem=fileNameInfo]").removeClass("zpl_DNI"),container.find("[elem=fileExtensionInfo]").removeClass("zpl_DNI"),container.find("[elem=fileSizeInfo]").removeClass("zpl_DNI"),container.find("[elem=templateInfo]").removeClass("zpl_DNI"),container.find("[elem=ttConfigImportFile]").val(""),container.find('[elem="ttConfigImportButton"]').off("click").on("click",function(event){$(event.target).siblings("[elem=ttConfigImportFile]").trigger("click")}),container.find('[elem="ttConfigImportFile"]').off("change").on("change",function(event){Timetracker.Import.onFileSelected(event)}),container.find("#nextButton").on("click",function(){Timetracker.util.removeErrorMsg(void 0,container.find("#importFileDiv1"),!0),null==Timetracker.Import.importfile?Timetracker.Util.appenErrorMsgForElem({obj:container.find("#importFileDiv1").find(".zpl_fldrp"),msg:ZPI18N.getString("zp.uploadfilewarning")}):Timetracker.Import.dtls.fileUploading(Timetracker.Import.importfile)}),TimelyZComp.toolTip.customMsgIntz(container,[{class:"PI_cls",title:ZPI18N.getString("zp.close")}]),modalObj.setCloseCallback(function(){let modal=Timetracker.Import.importfileUpContiner;modal.find("select").each(function(){ZPeopleComponents.select(modal.find("#"+$(this).attr("id"))).destroy()}),Timetracker.Import.importfileUpObj.remove(),Timetracker.Import.importfileUpObj=null,Timetracker.Import.importfileUpContiner=null,Timetracker.Import.importfile=null})},onFileSelected:function(event){var cont=Timetracker.Import.importfileUpContiner;cont.find("[elem=ttConfigImportButton]").text(ZPI18N.getString("zp.removeandnew")),cont.find("[elem=fileExtensionInfo]").addClass("zpl_DNI"),cont.find("[elem=fileSizeInfo]").addClass("zpl_DNI"),cont.find("[elem=templateInfo]").addClass("zpl_DNI"),cont.find("[elem=notes_section]").addClass("zpl_DNI"),cont.find("[elem=template_section]").addClass("zpl_DNI");var fileName=$(event.target).val();if(fileName&&""!=fileName){Timetracker.util.removeErrorMsg(void 0,cont.find("#importFileDiv1"),!0);var extn=(fileName=fileName.replace("C:\\fakepath\\","")).split(".").pop();Timetracker.Import.fileType.includes(extn)?(cont.find("[elem=fileNameInfo]").html(fileName),Timetracker.Import.importfile=cont.find("[elem=ttConfigImportFile]")[0].files[0],-1!=Layout.Page.hash.indexOf("leavetracker/holiday")&&".ics"==$("#ttImportFileUpload").find("#importFileDiv1").find("[elem=ttConfigImportFile]").attr("accept")&&Holidays.ImportICS.getLocationList($("#ttImportFileUpload").find("#importFileDiv1"))):cont.find("#importFileDiv1").removeClass("zpl_DNI")}},constructImportDiv:function(){var tab1=new Tab;tab1.id="ttimport_mapping",tab1.cardId="ttimport_mapping_card",tab1.name=ZPI18N.getString("zp.mapdetails"),tab1.callback=Timetracker.Import.importMapping;var tab2=new Tab;tab2.id="ttimport_verify",tab2.cardId="ttimport_verify_card",tab2.name=ZPI18N.getString("zp.verify"),tab2.callback=Timetracker.Import.verify;var tab3=new Tab;tab3.id="ttimport_summary",tab3.cardId="ttimport_summary_card",tab3.name=ZPI18N.getString("zp.ImportSummary"),tab3.callback=Timetracker.Import.dtls.inputFileVerify;var importObj=Timetracker.Import.importObj=new fullPageModal("Import",tab1,tab2,tab3);importObj._fullPageModalId="ttimport_slider",Timetracker.Import.importObj.topNavigation=!0,Timetracker.Import.importfileUpObj.close(),importObj._saveToggle=!1,importObj._previousToggle=!0,importObj.construct(0),Timetracker.Import.importContainer.find("#tabLeftUl").find("#ttimport_summary").addClass("disabled"),importObj.setCloseCallback(function(){let modal=Timetracker.Import.importContainer;modal.find("select").each(function(){ZPeopleComponents.select(modal.find("#"+$(this).attr("id"))).destroy()}),Timetracker.Import.importContainer.remove(),Timetracker.Import.importObj=null,Timetracker.Import.importContainer=null})},headerHash:null,importMapping:function(){var obj=Timetracker.Import.fileData;if(1==obj.res){Timetracker.Import.importContainer||(Timetracker.Import.importContainer=Timetracker.Util.getMainContainer().find("#"+Timetracker.Import.importObj._fullPageModalId));let cont=Timetracker.Import.importContainer.find("#ttimport_mapping_card");if(0===Timetracker.Import.importContainer.find("#ttimport_mapping_card").children().length){Timetracker.Import.importContainer.find("#ttimport_mapping_card").html(Timetracker.Import.dtls.getMappingSliderHtml()),ZPeopleComponents.collapsiblepanel(cont.find("#ttimport_mapping_collapseDiv"),{toggleButtonPosition:"right"}),ZPeopleComponents.collapsiblepanel(cont.find("[elem=collapsibleSectionPanel]"),{toggleButtonPosition:"right"}),obj.resObj&&(Timetracker.Import.fileFormat=obj.resObj.fileFormat),TimelyZComp.toolTip.customMsgIntz(Timetracker.Import.importContainer,[{class:"PI_cls",title:ZPI18N.getString("zp.close")}]),cont.find("[elem=mapUnMapDiv").off("click").on("click",Timetracker.Import.showHideMapUnmapFields);let theadersList=obj.resObj.tableHeaders,result=[];for(var i in Timetracker.Import.headerHash={},result.push({label:ZPI18N.getString("zp.select"),value:"-1"}),theadersList){var optval=theadersList[i];result.push({label:optval,value:i}),optval=optval.toLowerCase().trim(),Timetracker.Import.headerHash[optval]=i}Timetracker.Import.options=result,cont.find("select:not(.defaultValues)").each(function(){ZPeopleComponents.select($(this)).setAttributes({options:result,change:Timetracker.Import.onSelValueChange,isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0},showSearchField:!0})}),cont.find("select[class*=defaultValues]").each(function(){ZPeopleComponents.select($(this)).setAttributes({change:Timetracker.Import.onSelValueChange,isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0},showSearchField:!0})})}else{let verifyDiv=Timetracker.Import.importContainer.find("#ttimport_verify_card");cont.find("select").each(function(){let id="#"+$(this).attr("id");id=id.substring(0,id.length-4);let value=TimelyZComp.select.getValue(verifyDiv.find(id));ZPeopleComponents.select($(this)).setValue(value)})}cont.find("[value=allFields]").trigger("click"),Timetracker.Import.setMappedUnMappedColumns(cont)}else void 0!=obj.errMsg?(Timetracker.Util.displayFailureMessage(obj.errMsg),Timetracker.Import.importObj.close(),Timetracker.util.removeLoading(Timetracker.Import.importfileUpContiner)):(Timetracker.Util.displayFailureMessage(ZPI18N.getString("zp.fileError")),Timetracker.Import.importObj.close(),Timetracker.util.removeLoading(Timetracker.Import.importfileUpContiner))},verify:function(){var isAlreadyConstructed=!0,verifyDiv=Timetracker.Import.importContainer.find("#ttimport_verify_card");0===verifyDiv.children().length&&(isAlreadyConstructed=!1,Timetracker.Import.importContainer.find("#ttimport_verify_card").html(Timetracker.Import.dtls.getVerifySliderHtml()));var mappingDiv=Timetracker.Import.importContainer.find("#ttimport_mapping_card");ZPeopleComponents.collapsiblepanel(verifyDiv.find("#ttimport_verify_collapseDiv"),{toggleButtonPosition:"right"}),ZPeopleComponents.collapsiblepanel(verifyDiv.find("[elem=collapsibleSectionPanel]"),{toggleButtonPosition:"right"});var isShiftImp=!1;if(verifyDiv.find("select").each(function(){let respectiveMappingCardDiv=mappingDiv.find("#"+$(this).attr("id")+"_map"),value=TimelyZComp.select.getValue(respectiveMappingCardDiv),select=ZPeopleComponents.select($(this));if(!isAlreadyConstructed){let attr={isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0}};$(this).hasClass("defaultValues")||(attr.options=Timetracker.Import.options),attr.change=Timetracker.Import.onSelValueChange,select.setAttributes(attr)}let attr={};!$(this).siblings("label").hasClass("zpl_mtry")&&!$(this).parent().siblings("label").hasClass("zpl_mtry")||-1!=value&&""!=value?attr.className=-1==value||""==value?"is-active":"":(attr.className="ztextbox__error",$(this)[0].id.includes("shift")&&(isShiftImp=!0)),select.setAttributes(attr),select.setValue(value)}),Timetracker.Import.dtls.validateFields&&Timetracker.Import.dtls.validateFields(),isShiftImp){let shiftMargin=ZPeopleComponents.select(verifyDiv.find("#shiftMargin")).getValue(),shiftMarginFrom=ZPeopleComponents.select(verifyDiv.find("#shiftMarginFrom")).getValue(),shiftMarginTo=ZPeopleComponents.select(verifyDiv.find("#shiftMarginTo")).getValue();""!==shiftMargin&&""!==shiftMarginFrom&&""!==shiftMarginTo||""===shiftMargin&&""===shiftMarginFrom&&""===shiftMarginTo||(ZPeopleComponents.select(verifyDiv.find("#shiftMargin")).setAttributes({className:"ztextbox__error"}),ZPeopleComponents.select(verifyDiv.find("#shiftMarginFrom")).setAttributes({className:"ztextbox__error"}),ZPeopleComponents.select(verifyDiv.find("#shiftMarginTo")).setAttributes({className:"ztextbox__error"}),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectmargincols")))}},importSummary:function(resultData,params){Timetracker.Import.importContainer.find("#fullModFooter").find("#previousButton").hide();var cont=Timetracker.Import.importContainer.find("#ttimport_summary_card");!resultData||1!==resultData.res&&"1"!==resultData.res&&"success"!==resultData.msg?(resultData&&void 0!==resultData.errorCode?Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(resultData.errorCode)):Timetracker.Util.displayFailureMessage(ZPI18N.getString("zp.tt.importerr")),Timetracker.Import.importObj.close()):(cont.html(Timetracker.Import.dtls.getImportSummaryHtml(resultData)),Timetracker.Import.importContainer.find("#tabLeftUl").find("#ttimport_mapping,#ttimport_verify").addClass("disabled"),Timetracker.Import.importContainer.find("#tabLeftUl").find("#ttimport_summary").removeClass("disabled"),Timetracker.Import.importContainer.find("#fullModFooter").find("#cancelButton").text(ZPI18N.getString("zp.close")),cont.find("#zp_page_loading").remove())},setMappedUnMappedColumns:function(container){var mappped=0,unMapped=0;container.find("select").each(function(){if(!$(this).closest("div").hasClass("zpl_DNI")){var value=ZPeopleComponents.select($(this)).getValue();-1==value||""===value?unMapped++:mappped++}}),container.find("#mappedNo").text(mappped),container.find("#unMappedNo").text(unMapped),Timetracker.Import.mappped=mappped,Timetracker.Import.unMapped=unMapped},resetOrAutomapFields:function(isReset){let modalDtls,func;isReset?(modalDtls={header:ZPI18N.getString("zp.resetfields"),body:ZPI18N.getString("zp.resetfieldsconfirmation")},func=(()=>{let container=Timetracker.Import.importContainer.find("#ttimport_mapping_card");container.find("select").each(function(){let value=ZPeopleComponents.select($(this)).getValue();-1!=value&&""!==value&&ZPeopleComponents.select($(this)).setValue(-1)});let mapUnMapDiv=container.find("[elem=mapUnMapDiv].zpl_act");mapUnMapDiv.removeClass("zpl_act"),mapUnMapDiv.trigger("click")})):(modalDtls={header:ZPI18N.getString("zp.automapfields"),body:ZPI18N.getString("zp.automapfieldsconfirmation")},func=(()=>{let container=Timetracker.Import.importContainer.find("#ttimport_mapping_card");Timetracker.Import.dtls.autoMappingFields(container);let mapUnMapDiv=container.find("[elem=mapUnMapDiv].zpl_act");mapUnMapDiv.removeClass("zpl_act"),mapUnMapDiv.trigger("click")}));ModuleComp.Modal.setup({id:"tamsImportResetAutoMapModal",type:2,header:modalDtls.header,body:modalDtls.body,modalClass:"zpl_mdl",iconClass:"ico info",confirmButtonClass:"zlabel--yellow",removeConfirmButtonClass:"zlabel--blue",buttonValue:ZPI18N.getString("zp.confirm"),successCallback:func,backdrop:!0,closeOnSubmit:!0,deleteOnHide:!0,closeonEsc:!0})},onSelValueChange:function(obj){let mappingFieldDiv=$(obj.target).parents('[elem="mappingFieldDiv"]');if(0!=mappingFieldDiv.find(".columnIndex").length){let selectedValue=ZPeopleComponents.select($(obj.target)).getValue();"-1"==selectedValue?mappingFieldDiv.find(".columnIndex").addClass("DNI"):(mappingFieldDiv.find(".columnIndex").text("(c:"+selectedValue+")"),mappingFieldDiv.find(".columnIndex").removeClass("DNI"))}let cont=Timetracker.Import.importContainer.find("#ttimport_mapping_card");if(cont.is(":visible")){Timetracker.Import.setMappedUnMappedColumns(cont);var elemVal=cont.find("[elem=mapUnMapDiv].zpl_act").attr("value");Timetracker.Import.showHideField(mappingFieldDiv,elemVal);var collapsibleSectionPanel=$(obj.target).parents('[elem="collapsibleSectionPanel"]');collapsibleSectionPanel.is(":visible")&&(0==collapsibleSectionPanel.find('[elem="rowContainer"]:visible').length?collapsibleSectionPanel.parents("[elem=collapseMainDiv]").hide():collapsibleSectionPanel.parents("[elem=collapseMainDiv]").show(),Timetracker.Import.showHideContainer())}},updatingMappedUnMappedColumnOnChange:function(obj){var container=Timetracker.Import.importContainer.find("#ttimport_mapping_card"),value=obj&&obj.detail&&obj.detail.selectedValue?obj.detail.selectedValue:"-1";-1==obj.detail.previousValue&&""==obj.detail.previousValue||-1!=value&&""!==value?-1!=obj.detail.previousValue&&""!=obj.detail.previousValue||-1==value||""==value||(Timetracker.Import.mappped++,Timetracker.Import.unMapped--):(Timetracker.Import.unMapped++,Timetracker.Import.mappped--),container.find("#mappedNo").text(Timetracker.Import.mappped),container.find("#unMappedNo").text(Timetracker.Import.unMapped)},viewRecords:function(){Timetracker.Import.importObj.close(),Timetracker.Import.dtls.viewRecords&&Timetracker.Import.dtls.viewRecords(!0)},partialImportedDataShow:function(response){if(response){var container=Timetracker.Import.importfileUpContiner;container.find("#partialrecordcountdiv").html("<div>"+response.recordCount+" "+ZPI18N.getString("zp.recordspending")+"</div>"),container.find("#partialRecordsMapping").off("click").on("click",function(){Timetracker.Import.fileData={},Timetracker.Import.fileData.resObj=response,Timetracker.Import.fileData.res=1,Timetracker.Import.constructImportDiv()}),container.find(".zpl_imprtrecord").removeClass("zpl_DNI")}},showHideMapUnmapFields:function(event){var obj="mapUnMapDiv"==$(event.target).attr("elem")?event.target:$(event.target).closest("[elem=mapUnMapDiv]"),cont=Timetracker.Import.importContainer.find("#ttimport_mapping_card");if(!$(obj).hasClass("zpl_act")){$(obj).siblings().removeClass("zpl_act"),$(obj).addClass("zpl_act");let elemVal=$(obj).attr("value");cont.find("#zp_empty_data").hide(),cont.find(".disabled").removeClass("disabled"),cont.find("[elem=collapseMainDiv]").show(),cont.find("[elem=collapsibleSectionPanel]").show(),cont.find("[elem=rowContainer]").show(),cont.find("[elem=mappingFieldDiv]:not(.zpl_DNI)").show(),"allFields"!==elemVal&&($.each(cont.find('[elem="collapsibleSectionPanel"]'),function(ind,collPanel){$.each(cont.find('[elem="mappingFieldDiv"]'),function(col,fieldDiv){Timetracker.Import.showHideField(fieldDiv,elemVal)}),0==$(collPanel).find('[elem="rowContainer"]:visible').length?$(collPanel).parents("[elem=collapseMainDiv]").hide():$(collPanel).parents("[elem=collapseMainDiv]").show()}),Timetracker.Import.showHideContainer())}},showHideField:function(fieldDiv,elemVal){"unMappedFields"!=elemVal&&"mappedFields"!=elemVal||$.each($(fieldDiv).find("select"),function(ind,singleFieldDiv){let selval=ZPeopleComponents.select($(singleFieldDiv)).getValue(),parentDiv=$(singleFieldDiv).parents("[elem=mappingFieldDiv]");if(void 0!==parentDiv.attr("mappingPrDiv")){let cont=Timetracker.Import.importContainer.find("#ttimport_mapping_card"),value=ZPeopleComponents.select(cont.find("#"+parentDiv.attr("mappingPrDiv"))).getValue();if(-1==value||""==value){parentDiv.addClass("zpl_DNI");let rowContainer=parentDiv.closest("[elem=rowContainer]");return void(0==rowContainer.find('[elem="mappingFieldDiv"]:visible').length?rowContainer.hide():rowContainer.show())}}(""==selval||"-1"==selval)&&"mappedFields"==elemVal||""!=selval&&"-1"!=selval&&"unMappedFields"==elemVal?parentDiv.addClass("disabled"):parentDiv.removeClass("disabled");let rowContainer=$(fieldDiv).closest("[elem=rowContainer]");0==rowContainer.find('[elem="mappingFieldDiv"]:visible').length?rowContainer.hide():rowContainer.show()})},showHideContainer:function(){var cont=Timetracker.Import.importContainer.find("#ttimport_mapping_card");0==cont.find('[elem="collapsibleSectionPanel"]:visible').length?(cont.find("[elem=collapseMainDiv]").hide(),Timetracker.Util.showHideNoData({div:cont,msg:ZPI18N.getString("zp.unmappedFieldMap")}),cont.find("#zp_empty_data").show()):(cont.find("#zp_empty_data").hide(),$.each(cont.find('[elem="collapsibleSectionPanel"]:visible'),function(col,collPanel){$(collPanel).parents("[elem=collapseMainDiv]").show()}))},getImportSlider:function(dtls){var content='<div class="zpl_crd" id="importCont"><div id="importFileDiv1" class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_imprtrecord DNI"><div id="partialrecordcountdiv"></div><button type="button" class="zlabel zlabel--blue zlabel--medium" id="partialRecordsMapping">'+ZPI18N.getString("zp.clickhere")+'</button></div></div><div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp"><div class="zpl_mdimprtimg"></div><h4 elem="fileNameInfo">'+ZPI18N.getString("zp.fileimported")+'</h4><p elem="fileExtensionInfo">'+ZPI18N.getString(Timetracker.Import.acceptFilesText)+'</p><div><input style="display:none" type="file" accept="'+Timetracker.Import.acceptFiles+'" elem="ttConfigImportFile"><button elem="ttConfigImportButton" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.importfile")+'</button></div><p elem="fileSizeInfo">'+ZPI18N.getString("zp.maxfilesize")+"</p>";return"shiftImport"!==Timetracker.Import.action&&dtls&&"customizebalance"!==dtls.action&&(content+='<p elem="templateInfo"><a onclick="Timetracker.Import.dtls.importTemplate()"><b>'+ZPI18N.getString("zp.shiftmapping.sampleFileImport")+"</b></a></p>"),content+='</div></div></div></div><div class="zpl_secn" elem="notes_section"><div><div class="zpl_info"><h6><b>'+ZPI18N.getString("zp.note")+":</b></h6>",dtls.noteArr&&dtls.noteArr.forEach((x,i)=>{content+="<p>"+(i+1)+") "+x+"</p>"}),content+="</div></div></div></div>","settings-service-shift-manage"===settingsPage.container[0].id&&(content+='<div class="zpl_secn" elem="template_section"><div><h5>'+ZPI18N.getString("zp.supportedformats")+"</h5></div>",content+='<div class="zpl_tblres"><table class="zpl_tbl wd100_per">',content+="<thead><tr><th></th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th>",content+="<th>F</th><th>G</th><th>H</th><th>I</th><th>J</th>",content+="<th>K</th><th>L</th><th>M</th><th>N</th><th>O</th></tr></thead>",content+="<tbody><tr><td><b>1</b></td>",content+="<td><span>"+ZPI18N.getString("zp.shiftname")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.from")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.to")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.weekendoptions")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.mon")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.tue")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.wed")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.thu")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.fri")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.sat")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.sun")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.allowance")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.shiftmargin")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.shiftmarginfrom")+"</span></td>",content+="<td><span>"+ZPI18N.getString("zp.shiftmarginto")+"</span></td></tr>",content+="<tr><td><b>2</b></td>",content+="<td><span>US Shift</span></td>",content+="<td><span>10:00 PM</span></td>",content+="<td><span>06:00 AM</span></td>",content+="<td><span>1</span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span>1,2</span></td>",content+="<td><span>3,4</span></td>",content+="<td><span>0</span></td>",content+="<td><span>100</span></td>",content+="<td><span>1</span></td>",content+="<td><span>02:00</span></td>",content+="<td><span>06:00</span></td></tr>",content+="<tr><td><b>3</b></td>",content+="<td><span>UK Shift</span></td>",content+="<td><span>09:00 PM</span></td>",content+="<td><span>05:00 AM</span></td>",content+="<td><span>1</span></td>",content+="<td><span>1,2</span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span>0</span></td>",content+="<td><span>3,4</span></td>",content+="<td><span>350</span></td>",content+="<td><span>1</span></td>",content+="<td><span>01:00</span></td>",content+="<td><span>03:00</span></td></tr>",content+="<tr><td><b>4</b></td>",content+="<td><span>AUS Shift</span></td>",content+="<td><span>11:00 PM</span></td>",content+="<td><span>07:00 AM</span></td>",content+="<td><span>1</span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span>250</span></td>",content+="<td><span>0</span></td>",content+="<td><span></span></td>",content+="<td><span></span></td></tr>",content+="<tr><td><b>5</b></td>",content+="<td><span>ANZ Shift</span></td>",content+="<td><span>10:00 AM</span></td>",content+="<td><span>05:00 PM</span></td>",content+="<td><span>0</span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td>",content+="<td><span></span></td></tr></tbody></table></div></div>"),content+='</div><div class="zpl_DNI" id="loadingImportDiv"></div>'}};class TimeTrackerFormsHandler extends ModuleHandler{constructor(formClassObj){if(new.target===TimeTrackerFormsHandler)throw new Error("TimeTracker Module Handler is an abstract class and it cannot be instantiated");super(formClassObj)}getEditCallback(){ZP5Form.getFormClassObj().getParams().noUrlChangeNeeded?Timetracker.jobs.Operations.formAddEditView(void 0,this.FORM_CLASS_OBJ.getFormsProperties().getRecordId(),!1):Timetracker.forms.editFormFromView(this.FORM_CLASS_OBJ.getFormsProperties().getRecordId()),this.FORM_CLASS_OBJ.layoutRevertChanges(this.FORM_CLASS_OBJ)}quickAddResponseCallback(){return void 0==ZP5Form.getFormClassObj().moduleHandler.getInitialParams().main_form||"P_Timesheet"==ZP5Form.getFormClassObj().moduleHandler.getInitialParams().main_form.tableName?Timetracker.forms.quickaddCallback:super.quickAddResponseCallback()}constructHeader(tableName,formHeaderDiv){var removeMode=!1;this.FORM_CLASS_OBJ.isAddMode()&&tableName===Timetracker.constants.TIMELOG_TABLE&&(removeMode=!0);var dispName=Timetracker.forms.getSingularDisplayNameForForms(tableName,ZP5Form.getCurrFormsOperation().getFormDisplayName(),removeMode),modeName=this.FORM_CLASS_OBJ.isAddMode()?ZPI18N.getString("zp.add"):this.FORM_CLASS_OBJ.isEditMode()?ZPI18N.getString("zp.edit"):ZPI18N.getString("zp.view");dispName=removeMode?dispName:modeName+"&nbsp;"+dispName,formHeaderDiv.html(dispName)}close(){var params=this.FORM_CLASS_OBJ.getParams();return void 0!=Timetracker.Page.getPageMode()||Timetracker.UserSpace.isMySpace()||-1!=Layout.Page.hash.indexOf("performance")||-1!=Layout.Page.hash.indexOf("home/myspace/overview-kra")?(params.tableName===Timetracker.constants.TIMELOG_TABLE&&Timetracker.BreakTimelogs.Forms.load("CLOSE"),params.disableUrlTrack||void 0!==params.callback&&"function"==typeof params.callback&&params.callback(this.FORM_CLASS_OBJ.SUCCESS_PKID,this.FORM_CLASS_OBJ.currentTimerData),null):(window.location.href="#timetracker/mydata/timelogs-mode:list",null)}isModuleAdmin(moduleParams){let isAdmin=!1;return!(moduleParams=void 0==moduleParams?{}:moduleParams).isTTCustAdminOnlyNeed&&this.isProjectHeadOrManager()?isAdmin=!0:!moduleParams.isTTCustomAdminCheckNotNeed&&this.isTTCustAdminForSpecificAction(moduleParams.type)&&(isAdmin=!0),isAdmin}isProjectHeadOrManager(){if(Timetracker.generalSettings.isProjectManagerPerm()){if(this.FORM_CLASS_OBJ.isAddMode())return Timetracker.projects.Util.isProjectHeadOrManager(void 0,!0);var recordDtl=this.FORM_CLASS_OBJ.getRecordDetails();if(recordDtl&&recordDtl.record&&7e3===recordDtl.record.code&&void 0!==recordDtl.record.message)return void 0!==recordDtl.record.message.isProjectHeadOrManager&&!0===recordDtl.record.message.isProjectHeadOrManager}return!1}isTTCustAdminForSpecificAction(type){var recordDtl=this.FORM_CLASS_OBJ.getRecordDetails(),tableName=this.FORM_CLASS_OBJ.getTableName();if(type?delete Timetracker.constants.TTCustomAdmin.PermissionNeededForMode:Timetracker.constants.TTCustomAdmin.PermissionNeededForMode&&(type=Timetracker.constants.TTCustomAdmin.PermissionNeededForMode),recordDtl&&recordDtl.record&&7e3===recordDtl.record.code&&void 0!==recordDtl.record.message){if(type&&(type===Timetracker.constants.ADD||type===Timetracker.constants.EDIT)||!type&&(this.FORM_CLASS_OBJ.isAddMode()||this.FORM_CLASS_OBJ.isEditMode()))return void 0!==recordDtl.record.message.isTTCustomAdminForEntriesEdit&&!0===recordDtl.record.message.isTTCustomAdminForEntriesEdit;if(type&&type===Timetracker.constants.VIEW||!type&&this.FORM_CLASS_OBJ.isViewMode())return void 0!==recordDtl.record.message.isTTCustomAdminForEntriesView&&!0===recordDtl.record.message.isTTCustomAdminForEntriesView}else if(!recordDtl&&void 0!==tableName&&-1!==Timetracker.constants.tableNames.indexOf(tableName))return Timetracker.forms.isTTCustomAdminbasedOnView();return!1}isPrimary(fieldDtl){return"P_TimesheetJobsList"===this.FORM_CLASS_OBJ.getTableName()&&(Timetracker.util.isProjectHeadExists()?"ProjectHead"===fieldDtl.labelName:"ProjectManager"===fieldDtl.labelName)}loadLookupDataParams(params){"P_Timesheet"===this.FORM_CLASS_OBJ.getTableName()&&(params.selUser=null===Timetracker.timelogs.tserecno||void 0===Timetracker.timelogs.tserecno?ZPeople.CURR_USER.usererec:Timetracker.timelogs.tserecno)}preprocessPostFormConstruction(){let tableName=this.FORM_CLASS_OBJ.getTableName();tableName&&-1!==Timetracker.constants.tableNames.indexOf(tableName)&&Timetracker.forms.setPermissioneededForViewType(Timetracker.constants.EDIT)}onclickFuncForFileUpload(fieldData,inputEle){var onclick=null;let tableName=this.FORM_CLASS_OBJ.getTableName(),labelName=fieldData.componentName;if(("P_Timesheet"===tableName||"P_TimesheetJob"===tableName)&&"Attachment"===labelName){if(1==Number(fieldData.componentValue_uploadSource))onclick="window.open('"+fieldData.componentValue_filePath+"');";else{var entity="P_TimesheetJob"===tableName?Timetracker.constants.JOB:Timetracker.constants.TIMELOG;onclick="Timetracker.util.downloadFile('"+fieldData.componentValue_filePath+"', '"+this.FORM_CLASS_OBJ.getFormsProperties().getRecordId()+"', '"+entity+"');"}inputEle.data("oldValue",{name:fieldData.componentValue,filePath:fieldData.componentValue_filePath}),inputEle.val(fieldData.componentValue_filePath)}return onclick}fieldValueHandler(tableName,fieldData){"P_Timesheet"===tableName&&Timetracker.forms.viewFormFieldTLCustLabel(fieldData)}loadParamsForSubmit(params){let tableName=this.FORM_CLASS_OBJ.getTableName();this.FORM_CLASS_OBJ.isQuickAdd?void 0!==tableName&&-1!==Timetracker.constants.tableNames.indexOf(tableName)&&(params.isFromNewUI=!0,Timetracker.forms.handleQuickAdd(params,!0)):(void 0!==tableName&&"P_Timesheet"==tableName?Timetracker.timelogs.forms.getTimelogDetailsForForm(params):Timetracker.forms.getParamsForForms(params,this.tableName,this.FORM_CLASS_OBJ.LAYOUT),super.loadParamsForSubmit(params))}validateAddUpdateRecordParams(params){if("P_TimesheetJob"===params.zp_tableName||"P_Timesheet"===params.zp_tableName){if(this.FORM_CLASS_OBJ.isEditMode()&&void 0!==params.Attachment&&null!==params.Attachment&&""!==params.Attachment&&(void 0!==params.uploadSource&&null!==params.uploadSource||(params.uploadSource=params.Attachment.indexOf(workDriveUrl)>-1||params.Attachment.indexOf(writerUrl)>-1||params.Attachment.indexOf(sheetUrl)>-1||params.Attachment.indexOf(showUrl)>-1?1:0),1===params.uploadSource)){var oldValue=this.FORM_CLASS_OBJ.LAYOUT.find('[folabel="Attachment"]').find("#filename").data("oldValue");oldValue&&oldValue.filePath===params.Attachment&&(params.Attachment=JSON.stringify([{name:oldValue.name,filePath:oldValue.filePath}]))}if("P_TimesheetJob"===params.zp_tableName){if(params.hasOwnProperty("hasDuplicateWorkitems"))return delete params.hasDuplicateWorkitems,ZPeople.Message.warning(ZPI18N.getString("zp.fewduplicateworkitems")),this.FORM_CLASS_OBJ.LAYOUT.find("#zp_forms_add_btn").removeClass("disabled"),!1;if(params.hasOwnProperty("hasExceedLength"))return delete params.hasExceedLength,ZPeople.Message.warning(ZPI18N.getString("zp.fewlimitexceedworkitems")),this.FORM_CLASS_OBJ.LAYOUT.find("#zp_forms_add_btn").removeClass("disabled"),!1;if(params.hasOwnProperty("hasWorkitemCountExceeded"))return delete params.hasWorkitemCountExceeded,ZPeople.Message.warning(ZPI18N.getString("zp.workitemcountexceed",[Timetracker.util.workitemDispName])),this.FORM_CLASS_OBJ.LAYOUT.find("#zp_forms_add_btn").removeClass("disabled"),!1}}return!0}isLookupoptionUpdateAllow(key){if(this.FORM_CLASS_OBJ.getTableName()===Timetracker.constants.PROJECT_TABLE){var refreshedFcDtls=ZP5Form.Field.getFieldComponent(key);return refreshedFcDtls&&refreshedFcDtls.labelName&&"ProjectManager"===refreshedFcDtls.labelName}return!1}isFieldUpdated(tableName){return tableName===Timetracker.constants.PROJECT_TABLE}updateLookupOptionParams(params){"P_Timesheet"===this.FORM_CLASS_OBJ.getTableName()&&(params.selUser=null===Timetracker.timelogs.tserecno||void 0===Timetracker.timelogs.tserecno?ZPeople.CURR_USER.usererec:Timetracker.timelogs.tserecno)}draftBtnNotNeed(){return!0}submitNewBtnNotNeed(){return!0}isQuickAddAllowed(obj){let tableName=this.FORM_CLASS_OBJ.getTableName();return"P_TimesheetJobsList"==tableName&&"ClientId"==obj.labelName&&this.isTTCustAdminForSpecificAction()||"P_Timesheet"==tableName&&("Project"==obj.labelName&&Timetracker.util.checkAddProjectPermVar||"JobId"==obj.labelName&&Timetracker.util.checkAddJobPermVar)||"P_ClientDetails"!==tableName||"Currency"!==obj.labelName}isUserAllowedToField(){return this.isTTCustAdminForSpecificAction()}loadFileUploadParams(fieldName,params){let tableName=this.FORM_CLASS_OBJ.getTableName();"Attachment"!==fieldName||"P_TimesheetJob"!==tableName&&"P_Timesheet"!==tableName||(params.moduleName="Timetracker",params.entity="P_TimesheetJob"===tableName?Timetracker.constants.JOB:Timetracker.constants.TIMELOG)}isFieldIconNeed(){let tableName=this.FORM_CLASS_OBJ.getTableName();return!ZPUtil.checkIsExistInArray(Timetracker.constants.tableNames,tableName)}validateForm(result){if("P_TimesheetJob"==this.FORM_CLASS_OBJ.getTableName()&&!Timetracker.generalSettings.validateWorkitemErrorInForm()){var errMsg={};errMsg.JobSpecificWorkitem_Error=ZPeople.Message.warning(ZPI18N.getString("zp.namecharlimit",["Work Item","500"]));var resutlObj={};resutlObj.message=errMsg,result.errorList.push(resutlObj)}}updateFieldMetaData(isMandatory,labelName,formComp){let tableName=this.FORM_CLASS_OBJ.getTableName();isMandatory||"P_Timesheet"!==tableName||(Timetracker.forms.isValidateOnlyFormField(tableName).hasOwnProperty(labelName)||(isMandatory=Timetracker.timelogCustomization.isTLFieldMandatory(labelName),"Work_Item"!==labelName&&"Description"!==labelName||(formComp.displayName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,labelName))))}fileFieldHtml(fieldData,value,filePath){let tableName=this.FORM_CLASS_OBJ.getTableName();if(1!=Number(fieldData.uploadSource)&&"Attachment"===fieldData.labelName&&("P_Timesheet"===tableName||"P_TimesheetJob"===tableName)){let entity="P_TimesheetJob"===tableName?Timetracker.constants.JOB:Timetracker.constants.TIMELOG;return"<span><a onclick=\"Timetracker.util.downloadFile('"+filePath+"', '"+this.FORM_CLASS_OBJ.getFormsProperties().getRecordId()+"', '"+entity+'\');" href="javascript:;">'+ZPeople.decodeTxt(ZP5Form.Field.getNoValueString(value))+"</span>"}return null}}class TimeTrackerTimelogFormHandler extends TimeTrackerFormsHandler{constructor(formClassObj){super(formClassObj),this.tableName="P_Timesheet"}getEditCallback(){ZP5Form.getFormClassObj().getParams().noUrlChangeNeeded?Timetracker.timelogs.Operations.formAddEditView(void 0,this.FORM_CLASS_OBJ.getFormsProperties().getRecordId(),!1):Timetracker.timelogs.forms.formViewCallback(!1,this.FORM_CLASS_OBJ.getFormsProperties().getRecordId()),this.FORM_CLASS_OBJ.layoutRevertChanges(this.FORM_CLASS_OBJ)}showSectionHeader(sectionObj,sectionsHtml){return!1}validate(){return!!Timetracker.timelogs.locRequested||(Timetracker.timelogs.forms.validateAndSubmitCallback(),!1)}fldFunctions(){if(this.FORM_CLASS_OBJ.isViewMode())return{Attachment:Timetracker.forms.constructFormField}}fileUploadCallback(params,obj){"Attachment"===obj.labelName&&(1===obj.uploadSource?(params.uploadSource=obj.uploadSource,params[obj.labelName]=JSON.stringify([{name:obj.fileName,filePath:obj.filePath}])):(params.uploadSource=0,params[obj.labelName]=obj.attachId))}validateField(fieldDtls){if("Work_Item"==fieldDtls.labelName){var wItemInp=this.FORM_CLASS_OBJ.LAYOUT.find("[name='Work_Item']");if(0!=wItemInp.length&&ZPeopleComponents.isComponent(wItemInp)){var errorMsg=Timetracker.forms.constructFormField(fieldDtls,"VALIDATE");return"VALID"!==errorMsg?{errMsg:errorMsg}:{skipDefaultValidation:!0}}}return{}}isEditOptionAllowed(){var recordDtl=this.FORM_CLASS_OBJ.getRecordDetails().record;return recordDtl&&-2==recordDtl.message.approvalStatus&&recordDtl.extraDetails&&0==recordDtl.extraDetails.billingStatus}recordErrorHandle(response){return response&&response.record&&7049==response.record.code&&ZP5Form.refreshRecord(this.FORM_CLASS_OBJ.getFormId(),this.FORM_CLASS_OBJ.getRecordId()),!1}failureCallback(resultData,params){var res=resultData?resultData[0]:{};if("1"===Timetracker.generalSettings.getTimelogOverlapType(params.User_Name)&&res.hasOwnProperty("showOverlapWarn")&&res.showOverlapWarn&&"1"===Timetracker.generalSettings.getTimelogOverlapType(params.User_Name)){Timetracker.timelogs.constructWarnPopupForOverlap(params,function(){var formObj=ZP5Form.getFormClassObj();params.skipOverlapValidation=!0,ZPeople.Request.send("/addUpdateRecord.zp",params,(resultData,params)=>{formObj.addUpdateRecordResponse(resultData,params)},void 0,()=>{formObj.addUpdateFailureCallback()})},{})}}embedFormSuccessCallback(resultData,params,isModified){if(void 0!=Timetracker&&Timetracker.isFromMsteams){$("#ZPtimetracker_Container").find(".zpl_mfoter #zp_forms_add_btn").prop("disabled",!0);var closeData={message:ZPI18N.getString("zp.added.successfully.msg",[ZPI18N.getString("zp.ctimelog")])};return microsoftTeams.getContext(context=>{microsoftTeams.tasks.submitTask(closeData)}),!1}{let msg='<div class="zpl_thmIntro text-center flex-dirC"><div class="zpl_thmImgCon"><div class="zpl_tqImg zp_img_tq zp_nd_template"></div></div><div class="thmIntro_cnt"tabindex="0"><h2 class="thmIntro_ttl">'+ZPI18N.getString("zp.added.successfully.msg",[ZPI18N.getString("zp.ctimelog")])+"</h2></div></div>";return $("body").html(msg),!1}}}class TimeTrackerJobsFormHandler extends TimeTrackerFormsHandler{constructor(formClassObj){super(formClassObj),this.tableName="P_TimesheetJob"}setInitialParams(params){var formRef=ZP5Form.getFormClassObj();formRef.isQuickAdd&&((params=params||{}).main_form=ZP5Form.FORMSCLASSOBJ[formRef.getBaseFormDOMId()]),super.setInitialParams(params),Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob")}fldFunctions(){if(ZP5Form.getFormClassObj().isQuickAdd)return{};var fldFuns={Assignees:Timetracker.forms.constructFormField,Hours:Timetracker.forms.constructFormField,BillableStatus:Timetracker.forms.constructFormField};return this.FORM_CLASS_OBJ.isViewMode()&&(fldFuns.Attachment=Timetracker.forms.constructFormField),fldFuns}onloadCallback(){if(!ZP5Form.getFormClassObj().isQuickAdd)return Timetracker.forms.formOnLoadCallback}showSuccessMessage(key,isWarning,params){if(params.result&&params.result[0].hasOwnProperty("timelog_skip_workitem_recs")){var msgkey=ZPI18N.getString("zp.recordupdatedsuccessfully")+ZPI18N.getString("zp.fewworkitemsskipped");ZPeople.Message.success(msgkey)}else super.showSuccessMessage(key,isWarning,params)}fileUploadCallback(params,obj){"Attachment"===obj.labelName&&(1===obj.uploadSource?(params.uploadSource=1,params[obj.labelName]=JSON.stringify([{name:obj.fileName,filePath:obj.filePath}])):(params.uploadSource=0,params[obj.labelName]=obj.attachId))}showFieldError(labelName,errJson,code){var formOnlyError=!0,layout=ZP5Form.getFieldLayout();if(7050==code&&labelName==Timetracker.forms.appFor.COMPONENTS.Assignees&&errJson.hasOwnProperty("rphErrErecNo")){ZP5Form.Field.markFieldAsError(labelName,errJson.message);var assigneeCompLayput=layout.find("div[componentname='Assignees']"),recdId=errJson.rphErrErecNo;assigneeCompLayput.find("tr[recordid='"+recdId+"']").find("#jobRte").find("input[name='rateInput']").addClass("ztextbox__error"),formOnlyError=!1}return formOnlyError}successCallback(resultData,params,isModified){Timetracker.generalSettings.needToResetWorkitemBoolean(params)}handlePrint(document,params){var assigneesComp=document.find("[componentname=Assignees][entity=Users],[componentname=Assignees][entity=Depts], [componentname=Assignees][entity=Divs], [componentname=Assignees][entity=Locs]");$.each(assigneesComp,function(ind,entity){"Users"===$(entity).attr("entity")?($(entity).find("#showHideBtn").find("button").removeClass("DN"),$(entity).find("#showHideBtn").addClass("opn zpl_cpd"),$(entity).find("#selectedList").css("display","flex").find(".zpl_frmctrl").addClass("zpl_mxhtmxcnt").find("#selectedListDiv").addClass("zpl_nocrsor"),$(entity).find("#selectedList").find(".zphrsrtevlu").find("table").addClass("zpl_nocrsor")):($(entity).find("#showHideBtn").find("button").removeClass("DN"),$(entity).find("#showHideBtn").addClass("opn zpl_cpd"),$(entity).find("#selectedList").css("display","block"))})}}class TimeTrackerProjectsFormHandler extends TimeTrackerFormsHandler{constructor(formClassObj){super(formClassObj),this.tableName="P_TimesheetJobsList"}setInitialParams(params){var formRef=ZP5Form.getFormClassObj();formRef.isQuickAdd&&((params=params||{}).main_form=ZP5Form.FORMSCLASSOBJ[formRef.getBaseFormDOMId()]),super.setInitialParams(params)}fldFunctions(){return ZP5Form.getFormClassObj().isQuickAdd?{}:{ClientId:Timetracker.forms.constructFormField,ProjectManager:Timetracker.forms.constructFormField,ProjectUsers:Timetracker.forms.constructFormField}}validateField(fieldDtls){let result={};if(ZP5Form.getFormClassObj().isQuickAdd)return{};if("ProjectCost"==fieldDtls.labelName){let projectCost=this.FORM_CLASS_OBJ.LAYOUT.find('[folabel="ProjectCost"]').find("input").val();void 0!=projectCost&&""!==projectCost&&(null!=projectCost.match(Timetracker.util.rateRegex)&&void 0!=projectCost.match(Timetracker.util.rateRegex)||(result.errMsg={message:{ProjectCost:ZPI18N.getString("zp.exceedrangemaxval",[0])}},result.skipDefaultValidation=!0))}return result}onloadCallback(){if(!ZP5Form.getFormClassObj().isQuickAdd)return Timetracker.forms.formOnLoadCallback}getEditCallback(){-1!=settingsUrlProps.niceUrl.indexOf("projectdashboard")?(Timetracker.projects.Operations.formAddEditView(this.FORM_CLASS_OBJ.getFormsProperties().getFormId(),this.FORM_CLASS_OBJ.getFormsProperties().getRecordId()),this.FORM_CLASS_OBJ.layoutRevertChanges(this.FORM_CLASS_OBJ)):super.getEditCallback()}showFieldError(labelName,errJson,code){var formOnlyError=!0,layout=ZP5Form.getFieldLayout();if(7050==code&&labelName==Timetracker.forms.appFor.COMPONENTS.ProjectHead&&errJson.hasOwnProperty("PrjHeadRphErr")){ZP5Form.Field.markFieldAsError(labelName,errJson.message);var phCompLayput=layout.find("div[folabel='ProjectHead']");phCompLayput.find(".ztextbox__error").removeClass("ztextbox__error");var phRPHLayout=phCompLayput.find("#projectHeadRate");phRPHLayout.addClass("ztextbox__error");var errorDiv=phCompLayput.find("#error_message");$(errorDiv).remove(),phRPHLayout.parent().parent().append(errorDiv),formOnlyError=!1}return formOnlyError}handlePrint(document,params){var projectUsersComp=document.find("[componentname=ProjectManager][entity=Users],[componentname=ProjectUsers][entity=Users],[componentname=ProjectUsers][entity=Depts], [componentname=ProjectUsers][entity=Divs], [componentname=ProjectUsers][entity=Locs]");$.each(projectUsersComp,function(ind,entity){"ProjectManager"===$(entity).attr("componentname")&&"Users"===$(entity).attr("entity")?$(entity).find("#selectedList").find(".zpl_frmctrl").addClass("zpl_mxhtmxcnt").find("#selectedListDiv").addClass("zpl_nocrsor"):"ProjectUsers"===$(entity).attr("componentname")&&"Users"===$(entity).attr("entity")?($(entity).find("#showHideBtn").find("button").removeClass("DN"),$(entity).find("#showHideBtn").addClass("opn zpl_cpd"),$(entity).find("#selectedList").css("display","flex").find(".zpl_frmctrl").addClass("zpl_mxhtmxcnt").find("#selectedListDiv").addClass("zpl_nocrsor")):($(entity).find("#showHideBtn").find("button").removeClass("DN"),$(entity).find("#showHideBtn").addClass("opn zpl_cpd"),$(entity).find("#selectedList").css("display","block"))})}}class TimeTrackerClientFormHandler extends TimeTrackerFormsHandler{constructor(formClassObj){super(formClassObj),this.tableName="P_ClientDetails"}setInitialParams(params){var formRef=ZP5Form.getFormClassObj();formRef.isQuickAdd&&((params=params||{}).main_form=ZP5Form.FORMSCLASSOBJ[formRef.getBaseFormDOMId()]),super.setInitialParams(params)}fldFunctions(){return{Billing_Method:Timetracker.forms.constructFormField}}onloadCallback(){if(!ZP5Form.getFormClassObj().isQuickAdd)return Timetracker.forms.formOnLoadCallback}}Timetracker.views={JOB_SPCLFIELDS:["IsCompleted","BillableStatus","Attachment"],PROJECT_SPCLFIELDS:["Status"],CLIENT_SPCLFIELDS:["Billing_Method"],BILLABLE_STATUS:{0:"zp.billable",1:"zp.nonbillable"},COMPLETION_STATUS:{0:"zp.inprogress",1:"zp.completed"},BILLING_METHOD:{0:"zp.hourlyjobrate",1:"zp.hourlyuserrate",2:"zp.hourlyjobuserrate",3:"zp.hourlyprouserrate"},ATTACHMENT:{29:"zp.isempty",30:"zp.isnotempty"},init:function(){Timetracker.initSetup(),Timetracker.forms.setFormDisplayName();var viewJson={},url=settingsUrlProps.niceUrl;return-1!==url.indexOf("timetracker/scheduler/jobs")||-1!==url.indexOf("/jobs/")?viewJson=Timetracker.jobs.Listing.constructSystemView():-1!==url.indexOf("timetracker/scheduler/projects")||-1!==url.indexOf("/projects/")?viewJson=Timetracker.projects.Listing.constructSystemView():-1===url.indexOf("timetracker/scheduler/clients")&&-1===url.indexOf("timetracker/clients")||(viewJson=Timetracker.clients.Listing.constructSystemView()),viewJson},setAdditionalViewParams:function(json){return json.tableName=ZPComponents.SystemView.Configuration.getTableName(),json.recEditCallback=json.recViewCallback=Timetracker.forms.showRecordInCustomView,json.employeeStatus=ZPView.VIEW_OPTIONS&&ZPView.VIEW_OPTIONS.empstatus&&0!=ZPView.VIEW_OPTIONS.empstatus.length?ZPView.VIEW_OPTIONS.empstatus[0]:"all",json},isTimetrackerSpecialFields:function(tableName,labelName,refTableName,isSearchParam){return labelName.split(".").length>1&&void 0!==refTableName&&-1!==Timetracker.constants.tableNames.indexOf(refTableName)&&(tableName=refTableName,labelName=labelName.substring(labelName.split(".")[0].length+1)),!0===isSearchParam&&-1!==labelName.indexOf("_op")&&(labelName=labelName.slice(0,labelName.length-3)),tableName===Timetracker.constants.JOB_TABLE&&-1!==Timetracker.views.JOB_SPCLFIELDS.indexOf(labelName)||(tableName===Timetracker.constants.PROJECT_TABLE&&-1!==Timetracker.views.PROJECT_SPCLFIELDS.indexOf(labelName)||tableName===Timetracker.constants.CLIENT_TABLE&&-1!==Timetracker.views.CLIENT_SPCLFIELDS.indexOf(labelName))},getOperType:function(labelName){return"Status"===labelName||"IsCompleted"===labelName?Timetracker.views.COMPLETION_STATUS:"BillableStatus"===labelName?Timetracker.views.BILLABLE_STATUS:"Billing_Method"===labelName?Timetracker.views.BILLING_METHOD:"Attachment"===labelName?Timetracker.views.ATTACHMENT:{}},getSearchOperationOptions:function(labelName,isViewCriteria){labelName=labelName.split(".").length>1?labelName.substring(labelName.split(".")[0].length+1):labelName;var searchOpHtml=isViewCriteria?"":'<option value="-1">'+ZPI18N.getString("zp.select")+"</option>",operJson=Timetracker.views.getOperType(labelName);for(var opType in operJson)searchOpHtml+='<option value="'+opType+'">'+ZPI18N.getString(operJson[opType])+"</option>";return searchOpHtml},getDefaultValueForSearch:function(labelName,viewEditCriObj){return"Attachment"===(labelName=labelName.split(".").length>1?labelName.substring(labelName.split(".")[0].length+1):labelName)?void 0!=viewEditCriObj?viewEditCriObj.Operator:"29":void 0!=viewEditCriObj?viewEditCriObj.CrtVal:"0"},setSearchParam:function(layout,labelName,obj){if(-1===labelName.indexOf("_op")){var value="Attachment"===labelName?obj[labelName+"_op"]:obj[labelName];layout.find("#zp_views_field_"+labelName).find("select").select2("val",value),layout.find("[labelname="+labelName+"]").find("input[searchenb=true]").val("").attr("disabled",!0)}},getValueForField:function(labelName,value){var valueJson={value:value,operator:"18"};return"Attachment"===labelName&&(valueJson={value:"",operator:value}),valueJson},resetViewSearch:function(labelName,obj){$(obj).find("select").val("-1").select2(Timetracker.select2.getSelect2Properties())},handleJobAttachment:function(fieldDtls){return"1"==fieldDtls.uploadSource||fieldDtls.filePath.indexOf(workDriveUrl)>-1||fieldDtls.filePath.indexOf(writerUrl)>-1||fieldDtls.filePath.indexOf(sheetUrl)>-1||fieldDtls.filePath.indexOf(showUrl)>-1?"<a onclick=\"event.stopPropagation(); window.open('"+fieldDtls.filePath+"');\">"+fieldDtls.value+"</a>":"<a onclick=\"event.stopPropagation(); Timetracker.util.downloadFile('"+fieldDtls.attachId+"','"+fieldDtls.recordId+"', 'job');\">"+fieldDtls.value+"</a>"},getTableNameForSystemView:function(){var url=Timetracker.Util.isVersionFive()?settingsUrlProps.niceUrl:Layout.Page.hash;return-1!==url.indexOf("/scheduler/jobs")||-1!==url.indexOf("/jobs/")||-1!==url.indexOf("projectdashboard/jobs")?Timetracker.constants.JOB_TABLE:-1!==url.indexOf("/scheduler/projects")||-1!==url.indexOf("/projects/")?Timetracker.constants.PROJECT_TABLE:-1!==url.indexOf("/scheduler/clients")||-1!==url.indexOf("/clients/")?Timetracker.constants.CLIENT_TABLE:""},isSystemView:function(){return ZP5Views.isSystemView()},customViewActions:function(isSystemView){var tableName=Timetracker.views.getTableNameForSystemView(),layout=settingsPage.container;if(isSystemView=void 0==isSystemView?Timetracker.views.isSystemView():isSystemView)layout.find("#viewFooter").addClass("zpl_DNI"),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").addClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").addClass("DNI"),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").addClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions.zpl_rgt").removeClass("DNI"),tableName===Timetracker.constants.CLIENT_TABLE?(layout.find(".zpl_tblres:not(#clientlist)").hide(),layout.find("#zp_empty_data").removeClass("zpl_DNI"),0!=layout.find("#client-listtbody").children().length&&layout.find("#clientlist").show()):(layout.find(".zpl_tblres:not(#zp_views_list_container)").hide(),layout.find("#zp_views_list_container.zpl_tblres").show()),$("body").hasClass("zpl_newsrcn")?layout.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.minimize")).addClass("zpl_act"):layout.find("#viewActionsContainer").find("#fullScrn").attr("title",ZPI18N.getString("zp.maximize")).removeClass("zpl_act");else{var firescrollMode=tableName===Timetracker.constants.JOB_TABLE?Timetracker.jobs.FireScroll.getMode():tableName===Timetracker.constants.PROJECT_TABLE?Timetracker.projects.FireScroll.getMode():Timetracker.constants.MODES.CLIENTSOP_LISTVIEW;ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),layout.find("#viewFooter").removeClass("zpl_DNI"),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").show(),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").removeClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").removeClass("DNI"),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").removeClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions.zpl_rgt").addClass("DNI"),tableName===Timetracker.constants.CLIENT_TABLE?(layout.find(".zpl_tblres:not(#clientlist)").show(),layout.find("#clientlist.zpl_tblres").hide(),layout.find("#zp_empty_data").addClass("zpl_DNI")):(layout.find(".zpl_tblres:not(#zp_views_list_container)").show(),layout.find("#zp_views_list_container.zpl_tblres").hide()),Timetracker.views.hideSystemViewFilters(),$("body").hasClass("zpl_newsrcn")?layout.find("#viewActionsContainer").find("#fullScreen").addClass("zpl_act"):layout.find("#viewActionsContainer").find("#fullScreen").removeClass("zpl_act")}},hideSystemViewFilters:function(){var id,filterIds,tableName=Timetracker.views.getTableNameForSystemView();if(tableName===Timetracker.constants.JOB_TABLE?(id="jobFilter",filterIds=["filterDiv","unassjob_filter_div"]):tableName===Timetracker.constants.PROJECT_TABLE&&(id="projectFilter",filterIds=["filterDiv","unassprojectlist_filter_div"]),id&&filterIds)for(var i in filterIds)TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter()},checkAllCheckBoxes:function(obj,tableId,pageLayout){var layout=void 0!=pageLayout?pageLayout:Layout.Page.container;if($(obj).is(":checked")){var prevCoutn=layout.find("#"+tableId).find("input[type='checkbox']:checked").length;layout.find("#"+tableId).find("input[type='checkbox']:not(:checked):not(:disabled)").each(function(index){if(prevCoutn>199)return!1;$(this).prop("checked",!0),prevCoutn+=1})}else{layout.find("#"+tableId).find("input[type='checkbox']:checked").each(function(){$(this).prop("checked",!1)})}Timetracker.views.multiSelectActions.showHideMultiSelectOper($(obj).is(":checked"),layout)},isPageDataChanged:function(prevHash,nextHash,li,leftTabChange){let prevHashArr=prevHash.split("/"),prevHashTab=prevHashArr[prevHashArr.length-2],prevMode=prevHashArr[0],preserve=prevHashArr[1],nextTabArr=nextHash.split("/"),nextHashTab=nextTabArr[nextTabArr.length-2],nextMode=nextTabArr[0],nextserve=nextTabArr[1];(prevHashTab==nextHashTab||"projects"==prevHashTab&&"projectdashboard"==nextHashTab||"projectdashboard"==prevHashTab&&"projects"==nextHashTab)&&prevMode==nextMode&&preserve==nextserve||(ZP5Views.restSystemFilterZC(),ZP5Views.restViewPage(),leftTabChange&&leftTabChange(li))},multiSelectActions:{getMultiSelectHtml:function(){var selectHtml="",tableName=Timetracker.views.getTableNameForSystemView();if(selectHtml='<div id="zp_view_record_selectionactions">',tableName===Timetracker.constants.CLIENT_TABLE&&(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit)))return selectHtml+='<button class="zlabel zlabel--red zlabel--medium" '+(Timetracker.views.isSystemView()?'ref="bulk_delete"':'onclick="Timetracker.views.multiSelectActions.deleteMultiRecords();"')+">"+ZPI18N.getString("zp.delete")+"</button>",selectHtml+="</div>",selectHtml+='<i class="PI_cls" title="'+ZPI18N.getString("zp.close")+'"ref="view_close"></i>';if(tableName===Timetracker.constants.PROJECT_TABLE||tableName===Timetracker.constants.JOB_TABLE){var entity=tableName===Timetracker.constants.PROJECT_TABLE?"project":"job";Timetracker.views.isSystemView()?(selectHtml+='<button class="zlabel zlabel--red zlabel--medium" onclick="Timetracker.views.multiSelectActions.deleteMultiRecords()">'+ZPI18N.getString("zp.delete")+"</button>",selectHtml+='<button class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="Timetracker.jobs.Operations.showMultiUserMapperPopup(\''+entity+"', 'multiple', null, '"+Timetracker.constants.USER+"', "+!Timetracker.views.isSystemView()+')">'+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.users")])+"</button>"):(selectHtml+='<button class="zlabel zlabel--red zlabel--medium" onclick="Timetracker.views.multiSelectActions.deleteMultiRecords();">'+ZPI18N.getString("zp.delete")+"</button>",Timetracker.isDataAdminForAllUsers()&&(selectHtml+='<button class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="Timetracker.jobs.Operations.showMultiUserMapperPopup(\''+entity+"', 'multiple', null, '"+Timetracker.constants.USER+"', "+!Timetracker.views.isSystemView()+')">'+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.users")])+"</button>")),Timetracker.isDataAdminForAllUsers()&&(selectHtml+='<button class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="Timetracker.jobs.Operations.showMultiUserMapperPopup(\''+entity+"', 'multiple', null, '"+Timetracker.constants.DEPARTMENT+"', "+!Timetracker.views.isSystemView()+')">'+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.departments")])+"</button>",isOrgStructureEnabled&&(selectHtml+='<button class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="Timetracker.jobs.Operations.showMultiUserMapperPopup(\''+entity+"', 'multiple', null, '"+Timetracker.constants.DIVISION+"', "+!Timetracker.views.isSystemView()+')">'+ZPI18N.getString("zp.assign",[ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:"Division"])+"</button>"))}return selectHtml+="</div>",selectHtml+='<i class="PI_cls" title="'+ZPI18N.getString("zp.close")+'" id="zp_view_close_selection" ref="view_close"></i>'},setOtherMutliSelectOper:function(tableName,isAppend){if(Layout.Page.container.find(".zp_map").remove(),isAppend){var selectHtml="";tableName===Timetracker.constants.JOB_TABLE?(Timetracker.views.isSystemView()?selectHtml+="<button class=\"btn btn-default btn-md MT3 ML10 zp_map\" type=\"button\" onclick=\"Timetracker.jobs.Operations.showMultiUserMapperPopup('job', 'multiple', null, '"+Timetracker.constants.USER+"');\">"+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.users")])+"</button>":Timetracker.isDataAdminForAllUsers()&&(selectHtml+="<button class=\"btn btn-default btn-md MT3 ML10 zp_map\" type=\"button\" onclick=\"Timetracker.jobs.Operations.showMultiUserMapperPopup('job', 'multiple', null, '"+Timetracker.constants.USER+"');\">"+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.users")])+"</button>"),Timetracker.isDataAdminForAllUsers()&&(selectHtml+="<button class=\"btn btn-default btn-md MT3 ML10 zp_map\" type=\"button\" onclick=\"Timetracker.jobs.Operations.showMultiUserMapperPopup('job', 'multiple', null, '"+Timetracker.constants.DEPARTMENT+"');\">"+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.departments")])+"</button>",isOrgStructureEnabled&&(selectHtml+="<button class=\"btn btn-default btn-md MT3 ML10 zp_map\" type=\"button\" onclick=\"Timetracker.jobs.Operations.showMultiUserMapperPopup('job', 'multiple', null, '"+Timetracker.constants.DIVISION+"');\">"+ZPI18N.getString("zp.assign",[ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:"Division"])+"</button>"))):tableName===Timetracker.constants.PROJECT_TABLE&&(Timetracker.views.isSystemView()?selectHtml+="<button class=\"btn btn-default btn-md MT3 ML10 zp_map\" type=\"button\" onclick=\"Timetracker.jobs.Operations.showMultiUserMapperPopup('project', 'multiple', null, '"+Timetracker.constants.USER+"');\">"+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.users")])+"</button>":Timetracker.isDataAdminForAllUsers()&&(selectHtml+="<button class=\"btn btn-default btn-md MT3 ML10 zp_map\" type=\"button\" onclick=\"Timetracker.jobs.Operations.showMultiUserMapperPopup('project', 'multiple', null, '"+Timetracker.constants.USER+"');\">"+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.users")])+"</button>"),Timetracker.isDataAdminForAllUsers()&&(selectHtml+="<button class=\"btn btn-default btn-md MT3 ML10 zp_map\" type=\"button\" onclick=\"Timetracker.jobs.Operations.showMultiUserMapperPopup('project', 'multiple', null, '"+Timetracker.constants.DEPARTMENT+"');\">"+ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.departments")])+"</button>",isOrgStructureEnabled&&(selectHtml+="<button class=\"btn btn-default btn-md MT3 ML10 zp_map\" type=\"button\" onclick=\"Timetracker.jobs.Operations.showMultiUserMapperPopup('project', 'multiple', null, '"+Timetracker.constants.DIVISION+"');\">"+ZPI18N.getString("zp.assign",[ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:"Division"])+"</button>"))),Layout.Page.container.find("#zp_view_record_selectionactions").append(selectHtml)}},deleteMultiRecords:function(){if(Timetracker.views.isSystemView()){var funCallback,tableName=Timetracker.views.getTableNameForSystemView(),header="",info="";if(tableName==Timetracker.constants.JOB_TABLE){var jobDispName=Timetracker.util.getJobDisplayName(!1,!0);header=ZPI18N.getString("zp.common.entitydelete",[jobDispName]),info=ZPI18N.getString("zp.common.delEntityInfo3",[jobDispName]),funCallback=Timetracker.jobs.Operations.multiSelectDelete}else if(tableName==Timetracker.constants.PROJECT_TABLE){var projDispName=Timetracker.util.getProjectDisplayName(!1,!0);header=ZPI18N.getString("zp.common.entitydelete",[projDispName]),info=ZPI18N.getString("zp.common.delEntityInfo3",[projDispName]),funCallback=Timetracker.projects.Operations.multiSelectDelete}else if(tableName==Timetracker.constants.CLIENT_TABLE){var clientDispName=Timetracker.util.getClientDisplayName(!1,!0);header=ZPI18N.getString("zp.common.entitydelete",[clientDispName]),info=ZPI18N.getString("zp.common.delEntityInfo3",[clientDispName]),funCallback=Timetracker.clients.multiSelectDelete}var bulkDeleteModal=new DeleteAlertMessage;bulkDeleteModal.title=header,bulkDeleteModal.despcription=info,bulkDeleteModal.yesButtonText=ZPI18N.getString("zp.confirm"),bulkDeleteModal.cancelButtonText=ZPI18N.getString("zp.cancel"),bulkDeleteModal.callback=function(){funCallback(),bulkDeleteModal.close()},bulkDeleteModal.show()}else ZP5Views.getCurrViewObj().deleteRecordsConfirmation()},deleteRecordsFromCustomView:function(recordIds){if(ZPView.CURR_VIEWPARAMS.tableName===Timetracker.constants.JOB_TABLE){var mode=1===recordIds.length?"single":"multiple";Timetracker.jobs.Operations.deleteJob(recordIds,mode,ZPView.refresh,!0)}else ZPView.CURR_VIEWPARAMS.tableName===Timetracker.constants.PROJECT_TABLE&&Timetracker.projects.Operations.deleteProject(recordIds,ZPView.refresh,!0)},deleteBulkWarning:function(curViewObj,recIds,tableName){var isMulti=curViewObj.DELETE_RECIDS.length>1,recDispName="";tableName==Timetracker.constants.JOB_TABLE?recDispName=Timetracker.util.getJobDisplayName(!isMulti,!0):tableName==Timetracker.constants.PROJECT_TABLE?recDispName=Timetracker.util.getProjectDisplayName(!isMulti,!0):tableName==Timetracker.constants.CLIENT_TABLE&&(recDispName=Timetracker.util.getClientDisplayName(!isMulti,!0));var header=ZPI18N.getString("zp.common.entitydelete",[recDispName]),info=isMulti?ZPI18N.getString("zp.common.delEntityInfo3",[recDispName]):ZPI18N.getString("zp.common.delEntityInfo2",[recDispName]),bulkDeleteModal=new DeleteAlertMessage;bulkDeleteModal.title=header,bulkDeleteModal.despcription=info,bulkDeleteModal.yesButtonText=ZPI18N.getString("zp.confirm"),bulkDeleteModal.cancelButtonText=ZPI18N.getString("zp.cancel"),bulkDeleteModal.callback=function(){if(tableName===Timetracker.constants.JOB_TABLE){var mode=recIds.split(",").length<2?"single":"multiple";Timetracker.jobs.Operations.deleteJob(recIds,mode,void 0,!0,curViewObj)}else tableName===Timetracker.constants.PROJECT_TABLE?Timetracker.projects.Operations.deleteProject(recIds,void 0,!0,curViewObj):tableName===Timetracker.constants.CLIENT_TABLE&&Timetracker.clients.deleteClient(recIds,{isCustomView:!0,curViewObj:curViewObj});bulkDeleteModal.close()},bulkDeleteModal.show()},showHideMultiSelectOper:function(isChecked,pageLayout){var layout=void 0!=pageLayout?pageLayout:Layout.Page.container;isChecked?layout.find("#zp_view_record_delete").fadeIn(200,function(){Layout.Page.container.find("#zp_views_formrecactions").fadeOut(200),layout.find("#zp_view_record_delete").addClass("opn")}):layout.find("#zp_view_record_delete").fadeOut(200,function(){Layout.Page.container.find("#zp_views_formrecactions").fadeIn(200),layout.find("#zp_view_record_delete").removeClass("opn")})}}},Timetracker.forms={tlFormSplFldsValidate:{},setFormReferance:function(isV5){return Timetracker.forms.isFromOperations=!0,Timetracker.forms.layout=settingsPage.container,void 0!=ZP5Form.getFormClassObj()&&(Timetracker.forms.layout=ZP5Form.getLayout()),Timetracker.forms.formRef=ZP5Form,Timetracker.forms.formRef},getFormReferance:function(isV5){return(void 0==Timetracker.forms.formRef||!Timetracker.forms.isFromOperations&&isV5)&&Timetracker.forms.setFormReferance(isV5),Timetracker.forms.formRef},getLayout:()=>ZP5Form.getLayout(),getTableName:function(){return ZP5Form.getCurrFormsOperation().getTableName()},getModulePrefix:function(){var url=settingsUrlProps.niceUrl;return-1!=url.indexOf("project")?{modulePrefix:"timetracker-scheduler-projects",submode:"timetracker-scheduler-projects"}:-1!=url.indexOf("jobs")?{modulePrefix:"timetracker-scheduler-jobs",submode:"timetracker-scheduler-jobs"}:void 0},isPermAllowed:function(tableName,mode){var formDetails=null;if(Timetracker.isDataAdminForAllUsers())return!0;if("ADD"===mode&&(tableName===Timetracker.constants.CLIENT_TABLE||tableName===Timetracker.constants.JOB_TABLE||tableName===Timetracker.constants.PROJECT_TABLE)&&(Timetracker.isDataAdminForSpecificUsers()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit)))return!0;if(tableName===Timetracker.constants.CLIENT_TABLE&&(formDetails=void 0!==Timetracker.clients.formDetails?Timetracker.clients.formDetails:null),tableName===Timetracker.constants.JOB_TABLE&&(formDetails=void 0!==Timetracker.jobs.formDetails?Timetracker.jobs.formDetails:null),tableName===Timetracker.constants.PROJECT_TABLE&&(formDetails=void 0!==Timetracker.projects.formDetails?Timetracker.projects.formDetails:null),null!==formDetails)if("VIEW"===mode){if(formDetails.viewPerm!==FormConstants.Permission.VAL.NO_DATA)return!0}else if("ADD"===mode&&formDetails.addPerm!==FormConstants.Permission.VAL.NO_DATA)return!0;return!1},isModuleForm:function(mode){return-1!=(mode=void 0===mode?Layout.Page.hash:mode).indexOf("home/team/projects/listview")||-1!=mode.indexOf("timetracker")&&(-1!==mode.indexOf("/jobs/")||-1!==mode.indexOf("/projects/")||-1!==mode.indexOf("/clients/"))},showForm:function(mode,recordId,otherDetails){otherDetails=void 0===otherDetails?"":otherDetails;var niceUrl=settingsUrlProps.niceUrl.split("/");if(niceUrl=niceUrl.slice(0,niceUrl.length-1).join("/"),mode===Timetracker.constants.ADD&&-1!=otherDetails.indexOf("job"))niceUrl="#"+niceUrl+otherDetails+"/add-projectId:"+recordId,Timetracker.Page.isSelectedUser()&&(niceUrl+="/userId:"+(void 0!=Layout.Page.urlparam.userId?Layout.Page.urlparam.userId:Layout.Page.childUrlParam.userId));else if(mode===Timetracker.constants.ADD){if(niceUrl="#"+niceUrl+otherDetails+"/add",Timetracker.Page.isSelectedUser())niceUrl+="-userId:"+(void 0!=Layout.Page.urlparam.userId?Layout.Page.urlparam.userId:Layout.Page.childUrlParam.userId)}else if((mode===Timetracker.constants.EDIT||mode===Timetracker.constants.VIEW)&&void 0!==recordId){if(Timetracker.util.isFromProjectDashboard())niceUrl="#timetracker/projects/"+mode+"-recordId:"+recordId;else if(niceUrl="#"+niceUrl+otherDetails+"/"+mode+"-recordId:"+recordId,Timetracker.Page.isSelectedUser())niceUrl+="/userId:"+(void 0!=Layout.Page.urlparam.userId?Layout.Page.urlparam.userId:Layout.Page.childUrlParam.userId)}window.location.href=niceUrl},showRecordInCustomView:function(formId,recordId,mode){mode="EDIT"===mode?Timetracker.constants.EDIT:"VIEW"===mode?Timetracker.constants.VIEW:"",Timetracker.forms.showForm(mode,recordId)},editFormFromView:function(recId){recId=recId||Layout.Page.urlparam.recordId;Timetracker.forms.showForm(Timetracker.constants.EDIT,recId,Timetracker.forms.getOtherDetails())},getOtherDetails:function(){return-1!==Layout.Page.hash.indexOf("scheduler/projects/jobs/view")?"/jobs":""},showListView:function(pkId){Timetracker.forms.resetFormCache(pkId,Timetracker.forms.getTableName());var url=settingsUrlProps.niceUrlArr,urllen=-1==settingsUrlProps.niceUrl.indexOf("/projects/jobs/")?url.length-1:url.length-2;url=url.slice(0,urllen).join("/")+"/listview";var paramStarted=!1;Timetracker.Page.isSelectedUser()&&(url+="-userId:"+Timetracker.Team.getSelectedUser(),paramStarted=!0),ZP5Views.currViewObj&&(url+=(paramStarted?"/":"-")+"viewId:"+ZP5Views.currViewObj.getViewId()),window.location.href="#"+url},resetFormCache:function(pkId,tableName,extraDtls){tableName===Timetracker.constants.CLIENT_TABLE?Timetracker.clients.refreshData=void 0!==pkId:tableName===Timetracker.constants.PROJECT_TABLE||-1!==Layout.Page.hash.indexOf("/projects/jobs")?(Timetracker.projects.refreshData=!1,pkId&&(Timetracker.projects.refreshData=Timetracker.projects.fetchProject=!0,Timetracker.projects.Members.setRefreshValue(!0),Timetracker.projectDashboard.refreshData(pkId,extraDtls),extraDtls&&extraDtls.keepProjectCache||!Timetracker.projects.projectUsersArray||!Timetracker.projects.projectUsersArray[pkId]||(Timetracker.projects.projectUsersArray[pkId].refresh=!0),Timetracker.Page.isProjectDashboard()&&ZP5Form.refreshRecord(Timetracker.projects.formDetails.formId,Layout.Page.urlparam.id))):tableName===Timetracker.constants.JOB_TABLE&&(Timetracker.jobs.refreshData=void 0!==pkId,Timetracker.projects.refreshData=!!Timetracker.jobs.refreshData),(-1!==Layout.Page.hash.indexOf("/projects/")||-1!==Layout.Page.hash.indexOf("/jobs")||Timetracker.util.isFromProjectDashboard())&&(Timetracker.jobs.Util.clearCache(pkId,"project",!0),Timetracker.jobs.Util.clearCache(pkId,"job",!0))},constructFormField:function(fieldDtl,mode,title,formref,fieldEle){var tableName=Timetracker.forms.getTableName(),permission=ZP5Form.getCurrFormsOperation().getEditPerm();if("ADD"===mode)return Timetracker.forms.addFormFieldConstruction(fieldDtl,permission,tableName,fieldEle);if("EDIT"===mode)Timetracker.forms.editFormFieldConstruction(fieldDtl,permission,tableName);else if("VIEW"===mode)Timetracker.forms.viewFormFieldConstruction(fieldDtl,tableName);else if("VALIDATE"===mode)return Timetracker.forms.validateFormFieldConstruction(fieldDtl)},isValidateOnlyFormField:function(tableName,mode){var formRef=ZP5Form.getFormClassObj(),additionalTlFields={},isViewMode=formRef.isViewMode();if(tableName===Timetracker.constants.TIMELOG_TABLE)if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)&&Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)&&(additionalTlFields={Client:Timetracker.forms.constructFormField}),isViewMode)additionalTlFields.Work_Item=Timetracker.forms.constructFormField,additionalTlFields.Description=Timetracker.forms.constructFormField;else{if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)&&Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)){var workItemLayout=formRef.LAYOUT.find("div[folabel=Work_Item]");if(0!==workItemLayout.length){var dropDownLayout=workItemLayout.find(".select2-container");void 0!==dropDownLayout&&0!==dropDownLayout.length&&(additionalTlFields.Work_Item=Timetracker.forms.constructFormField)}}Timetracker.forms.tlFormSplFldsValidate=additionalTlFields}return additionalTlFields},addFormFieldConstruction:function(fieldDtl,permission,tableName,fieldEle){var field="";if(null!=tableName&&void 0!=tableName)if("P_TimesheetJob"===tableName)if("Assignees"===fieldDtl.labelName){field="<input name='"+fieldDtl.labelName+"' style='display:none'></input>";var details=Timetracker.forms.appFor.constructDetailsJson(Timetracker.jobs.formDetails.formId,fieldDtl,!0);Timetracker.forms.appFor.init(fieldDtl.labelName,details),field+=Timetracker.forms.appFor.getComponentHtml(fieldDtl.labelName)}else"Hours"===fieldDtl.labelName?field='<input id="zp_field_'+fieldDtl.formComponentId+'" type="text" class="ztextbox is-disabled" fieldtype="'+fieldDtl.fieldType+'" value="00:00" name="'+fieldDtl.labelName+'" readonly="true">':"BillableStatus"===fieldDtl.labelName&&(field='<select zcomponentname="select" id="zp_field_'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" name="'+fieldDtl.labelName+'"><option value="-1">'+ZPI18N.getString("zp.select")+'</option><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select>");else if("P_TimesheetJobsList"===tableName){if("ClientId"===fieldDtl.labelName){var fieldHtml='<input zcomponentname="select" clientInput="true" multi="'+(fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE)+'" fcid="'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" id="zp_field_'+fieldDtl.formComponentId+'" type="text" name="'+fieldDtl.labelName+'" class="'+(fieldDtl.fieldType!==FormConstants.FieldType.LOOKUP?"form-control zptxt-edit":"")+'" '+(fieldDtl.disabled?"disabled=disabled":"")+"/>";field='<div id="select_client" class="d-flexC">'+fieldHtml+'<div class="zpl_DNI"><div id="chooseCRMdropdown" class="dropdown"><button type="button" class="zlabel zlabel--outline zlabel--small w150" onclick="Timetracker.CRM.constructCRMPopup_OP(true);" aria-expanded="false">'+ZPI18N.getString("zp.zcrm.choosefromcrm")+'</button></div></div></div><div class="d-flexC zpl_DNI" id="CRM_text"><input id="CRM_client" type="text" readonly="true" class="ztextbox is-disabled"><div><button class="zlabel zlabel--outline zlabel--small" type="button" onclick="Timetracker.CRM.hideCRMTextBox();">'+ZPI18N.getString("zp.cancel")+"</button></div></div>",$(fieldEle).find("[folabel='"+fieldDtl.labelName+"']").attr("style","width: 60%;")}else if("ProjectManager"===fieldDtl.labelName||"ProjectUsers"===fieldDtl.labelName){field="<input name='"+fieldDtl.labelName+"' style='display:none'></input>";details=Timetracker.forms.appFor.constructDetailsJson(Timetracker.projects.formDetails.formId,fieldDtl,!0);Timetracker.forms.appFor.init(fieldDtl.labelName,details),field+=Timetracker.forms.appFor.getComponentHtml(fieldDtl.labelName)}}else if("P_ClientDetails"===tableName)"Billing_Method"===fieldDtl.labelName&&(field='<select zcomponentname="select" id="zp_field_'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" name="'+fieldDtl.labelName+'"><option value="-1">'+ZPI18N.getString("zp.select")+"</option>",$.each(Timetracker.views.BILLING_METHOD,function(key,val){field+='<option value="'+key+'">'+ZPI18N.getString(val)+"</option>"}),field+="</select>",$(fieldEle).find("[folabel='"+fieldDtl.labelName+"']").addClass("ovh"));else if("P_Timesheet"===tableName){var user=fieldDtl&&fieldDtl.user?fieldDtl.user:Timetracker.timelogs.tserecno;if("Billable_Status"===fieldDtl.labelName){field='<select id="zp_field_'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" name="'+fieldDtl.labelName+'" zcomponentname="select"><option value="0"';var billable=!0;"1"==Timetracker.generalSettings.getDefaultBillableStatus(user)&&(billable=!1),billable&&(field+=" selected"),field+=">"+ZPI18N.getString("zp.billable")+'</option><option value="1"',billable||(field+=" selected"),field+=">"+ZPI18N.getString("zp.nonbillable")+"</option></select>",$(fieldEle).find("[folabel='"+fieldDtl.labelName+"']").addClass("ovh")}else if("TotalHours"===fieldDtl.labelName){field='<div class="d-flexclmcap"><div id="timelog_type" name="'+fieldDtl.labelName+'">';var manualLog=automaticLog=fromToTimeLog=!0;Timetracker.generalSettings.isManualLogAllowed(user)||(manualLog=!1),Timetracker.generalSettings.isFromToTimeLogAllowed(user)||(fromToTimeLog=!1),Timetracker.generalSettings.isAutomaticLogAllowed(user)&&!Timetracker.timesheet.isAddTimelogFromTSAllowed()||(automaticLog=!1),manualLog&&!Timetracker.BreakTimelogs.isBreakLog()&&(field+='<div class="zradiobutton zradiobutton--horizontal"><input id="timelog_hrs" type="radio" name="timelogTime"  class="zradiobutton__helper" value="0" onclick="Timetracker.timelogs.showHideTimeLogTimer(\'0\');"><label for="timelog_hrs" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.stotalhours")+"</span></label></div>"),fromToTimeLog&&(field+='<div class="zradiobutton zradiobutton--horizontal"><input id="timelog_start_end" type="radio" name="timelogTime"  class="zradiobutton__helper" value="1" onclick="Timetracker.timelogs.showHideTimeLogTimer(\'1\');"><label for="timelog_start_end" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.startandend")+"</span></label></div>"),automaticLog&&(field+='<div class="zradiobutton zradiobutton--horizontal"><input id="timelog_start_timer" type="radio" name="timelogTime"  class="zradiobutton__helper" value="2" onclick="Timetracker.timelogs.showHideTimeLogTimer(\'2\');"><label for="timelog_start_timer" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.timer")+"</span></label></div>"),field+="</div>",manualLog&&!Timetracker.BreakTimelogs.isBreakLog()&&(field+='<div id="timelog_hours_time" class="d-flexC d-flexclmcap5 zpl_DNI"><input id="timelog_hrstime" type="text" class="ztextbox w80" value="00:00" placeholder="00:00"><i id="hrs_format_info" class="PI_info"></i></div><div id="hrs_format_popup"><table class="zpl_itbl M0I"> <tbody><tr><td>2:50</td><td>'+ZPI18N.getString("zp.twohoursfiftymins")+"</td></tr><tr><td>10:5</td><td>"+ZPI18N.getString("zp.tenhoursfivemins")+"</td></tr><tr><td>:35</td><td>"+ZPI18N.getString("zp.thirtyfivemins")+"</td></tr><tr><td>3.5</td><td>"+ZPI18N.getString("zp.threehoursthirtymins")+"</td></tr><tr><td>4.75</td><td>"+ZPI18N.getString("zp.fourhoursfortyfivemins")+"</td></tr><tr><td>.5</td><td>"+ZPI18N.getString("zp.thirtymins")+"</td></tr><tr><td>7</td><td>"+ZPI18N.getString("zp.sevenhours")+"</td></tr></tbody></table></div>"),fromToTimeLog&&(field+='<div id="timelog_start_end_time" class="d-flexC flexclmcap zpl_DNI"><input id="timelog_fromtime" type="text" class="ztextbox w100" value="00:00"><em>-</em><input id="timelog_totime" type="text" class="ztextbox w100" value="00:00"></div>'),field+="</div>"}else"JobId"===fieldDtl.labelName?(field+='<div><input multipe="false" class="ztextbox" fcid="'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" id="timelogJob" val="-Select-" type="text" name="'+fieldDtl.labelName+'" '+(fieldDtl.disabled?"disabled=disabled":"")+"/></div>",$(fieldEle).find("[folabel='"+fieldDtl.labelName+"']").addClass("ovh")):"Project"===fieldDtl.labelName&&(field+='<div><input multipe="false" fcid="'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" id="timelogProject" val="-Select-" type="text" name="'+fieldDtl.labelName+'" '+(fieldDtl.disabled?"disabled=disabled":"")+"/></div>",$(fieldEle).find("[folabel='"+fieldDtl.labelName+"']").addClass("ovh"))}return field},editFormFieldConstruction:function(fieldDtl,permission,tableName){var fieldObj=0!=fieldDtl.fieldObj.length?fieldDtl.fieldObj:fieldDtl.fieldElem.find("[name="+fieldDtl.componentName+"]");if(null!=tableName&&void 0!=tableName)if("P_TimesheetJob"===tableName){if("Hours"===fieldDtl.componentName)fieldObj.val(Calendar.minstohrs(fieldDtl.componentValue));else if("BillableStatus"===fieldDtl.componentName){"-"==(value=ZP5Form.Field.getNoValueString(fieldDtl.componentValue))&&(value="-1"),ZPeopleComponents.select(fieldObj).setValue(ZPeople.decodeTxt(value))}}else if("P_TimesheetJobsList"===tableName){if("ClientId"===fieldDtl.componentName){var val={id:fieldDtl.componentValue_ID,text:ZPeople.decodeTxt(fieldDtl.componentValue)};ZPeopleComponents.select(fieldObj).setValue(val)}}else if("P_ClientDetails"===tableName){var value;if("Billing_Method"===fieldDtl.componentName)"-"==(value=ZP5Form.Field.getNoValueString(fieldDtl.componentValue))&&(value="-1"),ZPeopleComponents.select(fieldObj).setValue(ZPeople.decodeTxt(value))}else if("P_Timesheet"===tableName)if("Billable_Status"===fieldDtl.componentName)ZPeopleComponents.select(fieldObj).setValue(fieldDtl.componentValue);else if("TotalHours"===fieldDtl.componentName)fieldObj.closest("div[isallowed=false]").attr("isallowed",!0);else if("JobId"===fieldDtl.componentName)fieldObj.val(fieldDtl.componentValue_ID),fieldObj.text(fieldDtl.componentValue);else if("Project"===fieldDtl.componentName){val={id:fieldDtl.componentValue_ID,text:fieldDtl.componentValue};fieldObj.val(fieldDtl.componentValue_ID),fieldObj.text(fieldDtl.componentValue)}},getSingularDisplayNameForForms:function(tableName,formDispName,removeMode){return tableName===Timetracker.constants.PROJECT_TABLE?"Projects"===formDispName&&(formDispName=ZPI18N.getString("zp.project")):tableName===Timetracker.constants.JOB_TABLE?"Jobs"===formDispName&&(formDispName=ZPI18N.getString("zp.job")):tableName===Timetracker.constants.CLIENT_TABLE?"Clients"===formDispName&&(formDispName=ZPI18N.getString("zp.client")):tableName===Timetracker.constants.TIMELOG_TABLE&&("Time Logs"===formDispName?formDispName=removeMode?ZPI18N.getString("zp.logtime"):ZPI18N.getString("zp.local.TimeLog"):"Break"===formDispName&&(formDispName=ZPI18N.getString("zp.break"))),formDispName},viewFormFieldTLCustLabel:function(fieldDtl){var fieldObj=ZP5Form.getFormClassObj().LAYOUT.find("#zp_field_outer_"+fieldDtl.formComponentId);if("Work_Item"===fieldDtl.componentName)if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)){var wiLabel=fieldObj.parent().find(".zplt-label");wiLabel.find("font").addClass("form_workitemname"),Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)&&wiLabel.addClass("zpl_mtry")}else fieldObj.parent().remove();else if("Description"===fieldDtl.componentName)if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var label=fieldObj.parent().find(".zplt-label");label.find("font").addClass("form_descname"),Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC)&&label.addClass("zpl_mtry")}else fieldObj.parent().remove()},viewFormFieldConstruction:function(fieldDtl,tableName){var fieldObj=fieldDtl.fieldObj?fieldDtl.fieldObj:ZP5Form.getFieldLayout().find("#zp_field_outer_"+fieldDtl.formComponentId),value=fieldDtl.componentValue+"";if(value=ZP5Form.Field.getNoValueString(value),null!=tableName&&void 0!=tableName)if("P_TimesheetJob"===tableName)if("Assignees"===fieldDtl.componentName){var details=Timetracker.forms.appFor.constructDetailsJson(Timetracker.jobs.formDetails.formId,fieldDtl,!1);Timetracker.forms.appFor.init(fieldDtl.componentName,details),fieldObj.html(Timetracker.forms.appFor.getComponentHtml(fieldDtl.componentName))}else"Hours"===fieldDtl.componentName?("-"!==value&&(value=Calendar.minstohrs(Number(value))),fieldObj.html("<span>"+value+"</span>")):"BillableStatus"===fieldDtl.componentName?("-"!==value&&(value="-1"===value?"-":"0"===value?ZPI18N.getString("zp.billable"):ZPI18N.getString("zp.nonbillable")),fieldObj.html("<span>"+value+"</span>")):"Attachment"===fieldDtl.componentName&&(""==fieldDtl.componentValue?fieldObj.html("<span>-</span>"):1==Number(fieldDtl.componentValue_uploadSource)?fieldObj.html("<span><a onclick=\"window.open('"+fieldDtl.componentValue_filePath+'\');" href="javascript:;">'+value+"</span>"):fieldObj.html("<span><a onclick=\"Timetracker.util.downloadFile('"+fieldDtl.componentValue_filePath+"', '"+ZP5Form.getFormClassObj().getParams().recordId+"', '"+Timetracker.constants.JOB+'\');" href="javascript:;">'+value+"</span>"));else if("P_TimesheetJobsList"===tableName){if("ClientId"===fieldDtl.componentName)fieldObj.html("<span>"+value+"</span>");else if("ProjectManager"===fieldDtl.componentName||"ProjectUsers"===fieldDtl.componentName){details=Timetracker.forms.appFor.constructDetailsJson(Timetracker.projects.formDetails.formId,fieldDtl,!1);Timetracker.forms.appFor.init(fieldDtl.componentName,details),fieldObj.html(Timetracker.forms.appFor.getComponentHtml(fieldDtl.componentName))}}else if("P_ClientDetails"===tableName)"Billing_Method"===fieldDtl.componentName&&("-"!==value&&(value=Timetracker.views.BILLING_METHOD[value],value=Timetracker.Validations.isEmpty(value)?"-":ZPI18N.getString(value)),fieldObj.html("<span>"+value+"</span>"));else if("P_Timesheet"===tableName)if("Billable_Status"===fieldDtl.componentName)"-"!==value&&(fieldObj.attr("compValue",value),value="0"===value?ZPI18N.getString("zp.billable"):ZPI18N.getString("zp.nonbillable")),fieldObj.html("<span>"+value+"</span>");else if("TotalHours"===fieldDtl.componentName)"-"!==value&&(value=Calendar.minstohrs(Number(value))),fieldObj.html("<span>"+value+"</span>");else if("JobId"===fieldDtl.componentName)fieldObj.html("<span>"+value+"</span>");else if("Project"===fieldDtl.componentName){if(fieldObj.html("<span>"+value+"</span>"),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.PROJECT)){if(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT))fieldObj.parent().find(".zplt-label").addClass("zpl_mtry")}else fieldObj.parent().remove()}else"Attachment"===fieldDtl.componentName&&(""==fieldDtl.componentValue?fieldObj.html("<span>-</span>"):1==Number(fieldDtl.componentValue_uploadSource)?fieldObj.html("<span><a onclick=\"window.open('"+fieldDtl.componentValue_filePath+'\');" href="javascript:;">'+value+"</span>"):fieldObj.html("<span><a onclick=\"Timetracker.util.downloadFile('"+fieldDtl.componentValue_filePath+"', '"+ZP5Form.getFormClassObj().getParams().recordId+"', '"+Timetracker.constants.TIMELOG+'\');" href="javascript:;">'+value+"</span>"));fieldObj.parent().data(fieldDtl),fieldObj.parent().attr("isallowed",!0)},validateFormFieldConstruction:function(fieldDtl){if("Assignees"===fieldDtl.labelName){var isError=0===Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users).length;if(Timetracker.isDataAdminForAllUsers()&&(isError=isError&&0===Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts).length,Timetracker.generalSettings.isJobProLocApplicableEnabled()&&(isError=isError&&0===Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs).length),isOrgStructureEnabled&&(isError=isError&&0===Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs).length)),isError)return ZP5Form.Validation.createError(ZP5Form.Validation.IS_EMPTY,fieldDtl,!1)}else{if("Date"===fieldDtl.labelName){var resultObj={};return errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.timeralert16"),resultObj.message=errorObj,resultObj}if("TotalHours"===fieldDtl.labelName){Layout.Page.container.find("#zp_forms_add_btn").removeClass("disabled");var formRef=ZP5Form.getFormClassObj();if(0!==Layout.Page.container.find("#timelog_type").length&&(!formRef.isEditMode()||formRef.isEditMode()&&void 0!=Layout.Page.container.find("#timelog_type").find("input[name='timelogTime']:checked").val())){var selectedType=Layout.Page.container.find("#timelog_type").find("input[name='timelogTime']:checked");if(0===selectedType.length)return ZP5Form.Validation.createError(ZP5Form.Validation.IS_EMPTY,fieldDtl,!1);var timelogType=selectedType.val(),errorObj=(resultObj={},{});if("2"===timelogType){var automaticLog=!0;Timetracker.generalSettings.isAutomaticLogAllowed(Timetracker.timelogs.tserecno)||(automaticLog=!1),automaticLog?null!==Timetracker.timelogs.tserecno&&Timetracker.timelogs.tserecno!==erecno?errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.timeralert7"):Timetracker.timelogs.currentTimerJobData&&!Timetracker.BreakTimelogs.skipAnotherTimerRunningValidation()&&(errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.timerlogalert8")):errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.timeralert9")}else if("0"===timelogType){var logHrs=Layout.Page.container.find("#timelog_hrstime").val();logHrs.match(Timetracker.util.maxhrsRegex)||(errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.entervalidinput")),logHrs.match(Timetracker.util.maxhrsRegex)&&Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timelogs.tserecno)&&0==Timetracker.DateTime.convertToMins(logHrs)&&(errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.logalert9"))}else if("1"===timelogType){var layout=formRef.LAYOUT;if(Timetracker.isTTSthiftEnabled()){var dt=TimelyZComp.dateField.getValue(layout.find("input[name='Date']")),logDate=Calendar.parseDate(dt,uidateFormat),fromTime=TimelyZComp.datetimefield.getDateObj(layout.find("#timelog_fromtime")),toTime=TimelyZComp.datetimefield.getDateObj(layout.find("#timelog_totime"));if(void 0==fromTime||void 0==toTime)errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.entervalidtime");else if(fromTime.getTime()>toTime.getTime())errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.fromtimegreater");else if(logDate.diffTo(fromTime)>1||logDate.diffTo(toTime)>1)errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.timelogfromtodate");else if(fromTime.diffTo(toTime,Timetracker.constants.MINUTES)>Timetracker.constants.PER_DAY_MIN)errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.timeexceeded24");else{(ttime=toTime.diffTo(fromTime,"minutes"))>Timetracker.constants.PER_DAY_MIN?errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.timeralert16"):0==ttime&&Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timelogs.tserecno)&&(errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.logalert9"))}}else{var fromhrs=TimelyZComp.timeField.getValue(Layout.Page.container.find("#timelog_fromtime")),tohrs=TimelyZComp.timeField.getValue(Layout.Page.container.find("#timelog_totime"));""!=fromhrs&&""!=tohrs||(errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.entervalidtime"));var ttime=Timetracker.util.getTotalTimeForHours(fromhrs.split(":"))-Timetracker.util.getTotalTimeForHours(tohrs.split(":"));Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timelogs.tserecno)&&0==ttime&&(errorObj[fieldDtl.labelName]=ZPI18N.getString("zp.logalert9"))}}if(void 0!==errorObj&&0!==Object.keys(errorObj).length)return resultObj.message=errorObj,resultObj}}else if("JobId"===fieldDtl.labelName){var jobId=TimelyZComp.select.getValue(fieldDtl.fieldObj);if(Timetracker.BreakTimelogs.isBreakLog()?fieldDtl.displayName=ZPI18N.getString("zp.break"):(null==Timetracker.jobs.formDetails&&(Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob")),void 0!=Timetracker.jobs.formDetails&&""!=Timetracker.jobs.formDetails.labelDetails.JOBNAME&&(fieldDtl.displayName=Timetracker.jobs.formDetails.labelDetails.JOBNAME)),!jobId||""===jobId||"0"===jobId||"-Select"===jobId)return(err=ZP5Form.Validation.createError(ZP5Form.Validation.IS_NOT_SELECTED,fieldDtl,!1)).message.fieldInputObj=ZPeopleComponents.select($(fieldDtl.fieldObj)).getElement(),err}else if("Project"===fieldDtl.labelName){var clientDiv,hasClientErr=!1,hasPrjctErr=!1;if(Timetracker.BreakTimelogs.isBreakLog())return"VALID";if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)&&Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)){clientDiv=Layout.Page.container.find("#timelogClient");var clientId=TimelyZComp.select.getValue(clientDiv);if(null==Timetracker.clients.formDetails&&(Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,"P_ClientDetails")),void 0!=Timetracker.clients.formDetails&&""!=Timetracker.clients.formDetails.labelDetails.CLIENTNAME){var displayName=Timetracker.clients.formDetails.labelDetails.CLIENTNAME;"<div id='tlclnt_err' class='zp-err-msg'>"+ZPI18N.getString("zp.selvalforfield",[displayName])+"</ div>"}clientId&&""!==clientId&&"0"!==clientId&&"-Select"!==clientId||(hasClientErr=!0)}var projectId=0!=fieldDtl.fieldObj.length?TimelyZComp.select.getValue(fieldDtl.fieldObj):"0";if(null==Timetracker.projects.formDetails&&(Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList")),void 0!=Timetracker.projects.formDetails&&""!=Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME&&(fieldDtl.displayName=Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME),Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT)&&(projectId&&""!==projectId&&"0"!==projectId&&"-Select"!==projectId||(hasPrjctErr=!0)),hasPrjctErr)return(err=ZP5Form.Validation.createError(ZP5Form.Validation.IS_NOT_SELECTED,fieldDtl,!1)).message.fieldInputObj=ZPeopleComponents.select($(fieldDtl.fieldObj)).getElement(),err;if(hasClientErr){var err,fieldDtlClnt={labelName:"Client",fieldType:FormConstants.FieldType.LOOKUP,displayName:Timetracker.clients.formDetails.labelDetails.CLIENTNAME};return(err=ZP5Form.Validation.createError(ZP5Form.Validation.IS_NOT_SELECTED,fieldDtlClnt,!1)).message.fieldInputObj=ZPeopleComponents.select($(clientDiv)).getElement(),err}}else if("Work_Item"===fieldDtl.labelName){if(Timetracker.BreakTimelogs.isBreakLog())return"VALID";if(!Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM))return"VALID";var witemDiv=Layout.Page.container.find("input[name=Work_Item]"),workitemVal=witemDiv.val();if(ZPeopleComponents.isComponent(witemDiv)&&(workitemVal=ZPeople.decodeTxt(TimelyZComp.select.getValue(witemDiv))),fieldDtl.displayName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM),!workitemVal||""===workitemVal||"0"===workitemVal)return ZP5Form.Validation.createError(ZP5Form.Validation.IS_NOT_SELECTED,fieldDtl,!1)}}return"VALID"},formOnLoadCallback:function(formRef){var tableName=formRef.getTableName(),mode=formRef.getMode(),isAddMode=formRef.isAddMode(),isEditMode=formRef.isEditMode(),isViewMode=formRef.isViewMode(),layout=formRef.LAYOUT;if(isAddMode||isEditMode){if(layout.find("#zp_forms_addnew_btn").hide(),"P_Timesheet"===tableName){var isShiftEnabled=Timetracker.isTTSthiftEnabled();Timetracker.BreakTimelogs.Forms.load("SET"),!formRef.isEmbedForm&&layout.find("#zp_forms_add_btn").html(ZPI18N.getString("zp.save"));var shiftDate=Timetracker.generalSettings.getTSSettings(Timetracker.timelogs.tserecno).TS_shiftDate;shiftDate=void 0==shiftDate?Calendar.formatDate(new Date):shiftDate;var date=Calendar.parseDate(shiftDate,uidateFormat);if(isAddMode){if(TimelyZComp.dateField.setValue(layout.find("input[name=Date]"),date),Timetracker.timesheet.isAddTimelogFromTSAllowed()){var dateLayout=layout.find("input[name=Date]"),ZP5FormClassObj=ZP5Form.getFormClassObj().getParams();if(ZP5FormClassObj.hasOwnProperty("tsFromDate")&&ZP5FormClassObj.hasOwnProperty("tsToDate")){var minDate=Calendar.parseDate(ZP5FormClassObj.tsFromDate,"%Y-%m-%d"),maxDate=Calendar.parseDate(ZP5FormClassObj.tsToDate,"%Y-%m-%d");ZPeopleComponents.datefield(dateLayout).setAttributes({min:minDate,max:maxDate})}ZP5FormClassObj.hasOwnProperty("ts_tl_manuallog")&&!ZP5FormClassObj.ts_tl_manuallog&&(layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").parent().addClass("zpl_DNI"),layout.find("#timelog_hours_time").addClass("zpl_DNI"),layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").remove()),ZP5FormClassObj.hasOwnProperty("ts_tl_fromToLog")&&!ZP5FormClassObj.ts_tl_fromToLog&&(layout.find("input[name='timelogTime'][id='timelog_start_end']").parent().addClass("zpl_DNI"),layout.find("#timelog_start_end_time").addClass("zpl_DNI"),layout.find("input[name='timelogTime'][id='timelog_start_end']").remove())}Timetracker.BreakTimelogs.isBreakLog()?layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").length?(layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").prop("checked",!0),layout.find("#timelog_start_end_time").removeClass("zpl_DNI")):layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_timer']").length&&layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_timer']").prop("checked",!0):layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").length?(layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").prop("checked",!0),layout.find("#timelog_hours_time").removeClass("zpl_DNI")):layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").length?(layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").prop("checked",!0),layout.find("#timelog_start_end_time").removeClass("zpl_DNI")):layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_timer']").length&&layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_timer']").prop("checked",!0),Timetracker.timesheet.isfromFeeds&&layout.addClass("zpl_ntzindx")}if(isEditMode){var type=(otherDetails=ZP5Form.getSingleRecord().record.extraDetails).timelogtype;if((isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",otherDetails))&&(Timetracker.BreakTimelogs.Forms.load("SET",{isBreakLog:!0}),layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").parent().remove(),2==type&&Timetracker.BreakTimelogs.isBreakTimerRunning(formRef.getFormsProperties().getRecordId())&&layout.find("input[name=JobId]").attr("disabled",!0)),2==type)layout.find("#timelog_type").parents(".zpl_secn").remove(),ZPeopleComponents.datefield(layout.find("input[name=Date]")).setAttribute("className","disabled");else{if(layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_timer']").parent().remove(),1==type)if(layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").prop("checked",!0),layout.find("#timelog_start_end_time").removeClass("zpl_DNI"),isShiftEnabled){shiftDate=TimelyZComp.dateField.getValue(layout.find("input[name='Date']"));var logDate=Calendar.parseDate(shiftDate,uidateFormat);otherDetails.ftime=Timetracker.util.getShiftDatebyTime(otherDetails.fromTime,logDate,"minutes"),otherDetails.ttime=Timetracker.util.getShiftDatebyTime(otherDetails.toTime,logDate,"minutes")}else layout.find("#timelog_fromtime").val(Calendar.minstotime(otherDetails.fromTime,!0)),layout.find("#timelog_totime").val(Calendar.minstotime(otherDetails.toTime,!0));else 0==type&&(layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").prop("checked",!0),layout.find("#timelog_hrstime").val(Calendar.minstohrs(otherDetails.totalTime)),layout.find("#timelog_hours_time").removeClass("zpl_DNI"));""===layout.find("#timelog_type").html()&&layout.find("#timelog_type").parent().parent().remove()}Timetracker.jobSchedule.hasCustomFields()&&Timetracker.jobSchedule.timelogsView.constructJschinTLForm({formMode:"FORM_EDIT_MODE"})}if(Timetracker.forms.showHideTlFormFields(layout,formRef),Timetracker.forms.mandatoryFormFieldsHighlight(layout),layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").length)if(isShiftEnabled){var pickerOptions={},shitDt=Calendar.parseDate(shiftDate,uidateFormat);shitDt.setDate(shitDt.getDate()-1),pickerOptions.minDate=Calendar.formatDate(shitDt).toString(),shitDt.setDate(shitDt.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(shitDt).toString(),pickerOptions.minTime=null,pickerOptions.maxTime=null;var attr={pickerOptions:pickerOptions};attr.value=otherDetails&&otherDetails.ftime?otherDetails.ftime:Timetracker.DateTime.getUserTimeZoneCurrDateTime(),TimelyZComp.datetimefield.intialize(layout.find("#timelog_fromtime"),attr),attr.value=otherDetails&&otherDetails.ttime?otherDetails.ttime:Timetracker.DateTime.getUserTimeZoneCurrDateTime(),TimelyZComp.datetimefield.intialize(layout.find("#timelog_totime"),attr)}else{var options={clearButton:"none",format:timeFormat.replace("a","tt"),minuteStep:1,className:"w150"};options.value=otherDetails&&void 0!=otherDetails.fromTime?Calendar.minstotimeFormat(otherDetails.fromTime,!0):Timetracker.DateTime.getUserTimeZoneCurrDateTime(),TimelyZComp.timeField.intialize(layout.find("#timelog_fromtime"),options),options.value=otherDetails&&void 0!=otherDetails.toTime?Calendar.minstotimeFormat(otherDetails.toTime,!0):Timetracker.DateTime.getUserTimeZoneCurrDateTime(),TimelyZComp.timeField.intialize(layout.find("#timelog_totime"),options)}0!=layout.find("#hrs_format_popup").length&&(ZPeopleComponents.popover(layout.find("#hrs_format_popup"),{displayType:"callout",closeOnBodyClick:!0,forElement:layout.find("#hrs_format_info"),position:"right"}),layout.find("#hrs_format_info").on("mouseover",function(){ZPeopleComponents.popover(layout.find("#hrs_format_popup")).open()}),layout.find("#hrs_format_info").on("mouseout",function(){ZPeopleComponents.popover(layout.find("#hrs_format_popup")).close()}));let callback=Timetracker.timelogs.forms.bindEventHandlingFormFields;var extraJson={};if(Timetracker.BreakTimelogs.isBreakLog())callback=Timetracker.BreakTimelogs.Forms.bindAddEditBreaksList;else if(isAddMode&&Timetracker.timesheet.isAddTimelogFromTSAllowed()){if(ZP5FormClassObj.hasOwnProperty("projectId")&&ZP5FormClassObj.hasOwnProperty("projectName")){var fieldObj=layout.find('input[name="Project"]'),projectDiv=layout.find("div[folabel='Project']");$(fieldObj).remove(),$(projectDiv).html("<span>"+ZP5FormClassObj.projectName+"</span>"),extraJson.projectId=ZP5FormClassObj.projectId,extraJson.projectName=ZP5FormClassObj.projectName}if(ZP5FormClassObj.hasOwnProperty("clientId")&&ZP5FormClassObj.hasOwnProperty("clientName")&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients){fieldObj=layout.find('input[name="Client"]');var clientDiv=layout.find("div[folabel='Client']");$(fieldObj).remove(),$(clientDiv).html("<span>"+ZP5FormClassObj.clientName+"</span>"),extraJson.clientId=ZP5FormClassObj.clientId,extraJson.clientName=ZP5FormClassObj.clientName}extraJson.isFromTSTLAdd=!0}callback(layout,extraJson).then(function(){0!=layout.find("select[name=Billable_Status]").length&&(TimelyZComp.select.intialize(layout.find("select[name=Billable_Status]"),{dropdownList:{appendTo:layout,moveOnScroll:!0}}),null!==(TimelyZComp.isComponent(layout.find("input[name=JobId]"))?TimelyZComp.select.getValue(layout.find("input[name=JobId]")):layout.find("input[name=JobId]").val())&&!Timetracker.BreakTimelogs.isBreakLog()&&isEditMode&&void 0!=otherDetails.jobBillableStatus&&otherDetails.jobBillableStatus==TimelyZComp.select.getValue(layout.find("select[name=Billable_Status]"))&&TimelyZComp.select.setAttributes(layout.find("select[name=Billable_Status]"),{disabled:!0}));Timetracker.forms.setDisplayNamesofTLFields(layout,mode)}),Timetracker.jobSchedule.hasCustomFields()&&Layout.Page.container.find("input[name='Date']").on("zdatepickerchange",function(event,data){data.fromUI&&Timetracker.jobScheduleInTimelogsView.constructJschinTLForm()})}else if("P_TimesheetJob"===tableName){ZPeopleComponents.select(layout.find("select[name=BillableStatus]"));var projectDOM=layout.find("input[name=Project]");if((-1!==Layout.Page.hash.indexOf("/projects/jobs")||Timetracker.Page.isProjectDashboard("jobs"))&&(!0,isAddMode)){var projectId="-Select-",inisel={id:projectId=Timetracker.Page.isProjectDashboard("jobs")?Layout.Page.urlparam.id:Layout.Page.urlparam.projectId,text:ZPeople.decodeTxt(Timetracker.projects.Util.getProjectName(projectId))};ZPeopleComponents.select(projectDOM).setValue(inisel),ZPeopleComponents.select(projectDOM).setAttributes({disabled:!0});var quickAddBtn=layout.find(".PI_plus");quickAddBtn.length>0&&quickAddBtn.parent().addClass("DNI")}if(layout.find("input[name=Reminder]").parent().on("click",function(event){$(event.currentTarget).find("input").is(":checked")?layout.find("div[folabel=ReminderTime]").parent().show():layout.find("div[folabel=ReminderTime]").parent().hide()}),layout.find("input[name=Reminder]").is(":checked")||layout.find("div[folabel=ReminderTime]").parent().hide(),layout.find("[folabel=Assignees]").removeClass("ovh"),isAddMode){0!=layout.find("input[name=StartDate]").length&&ZPeopleComponents.datefield(layout.find("input[name=StartDate]")).setValue(Calendar.formatDate(Calendar.getCurrentDay().day));let userErecNo,selectedUsers=[];userErecNo=-1!=Layout.Page.hash.indexOf("#performance")||-1!=Layout.Page.hash.indexOf("#operations/performance")||-1!=Layout.Page.hash.indexOf("#selfservice/user/goals")||-1!=Layout.Page.hash.indexOf("#selfservice/user/kra")||-1!=Layout.Page.hash.indexOf("home/myspace/overview-kra")?AppraisalConfig.selectUsererecno:Timetracker.Page.isSelectedUser()?Layout.Page.urlparam.userId:erecno;let userDetails=ZPeople.getUserDetailsById(userErecNo);if(userDetails){let name=(userDetails.fname?userDetails.fname:"")+" "+(userDetails.lname?userDetails.lname:"")+" "+userDetails.empid;selectedUsers.push({recordId:userErecNo,name:name})}Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users,selectedUsers),Timetracker.isDataAdminForAllUsers()&&(Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs),isOrgStructureEnabled&&Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs))}else if(isEditMode){(otherDetails=Timetracker.forms.getExtraDetails())&&(Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users,otherDetails.assigneeDetails),Timetracker.isDataAdminForAllUsers()&&(Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts,otherDetails.deptDetails),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs,otherDetails.locDetails),isOrgStructureEnabled&&Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs,otherDetails.divDetails)))}var applicableAssignees=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users,formRef.getMode());if(Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users,applicableAssignees),Timetracker.isDataAdminForAllUsers()){var applicableDepts=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts);if(Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts,applicableDepts),Timetracker.generalSettings.isJobProLocApplicableEnabled()){var applicableLocs=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs);Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs,applicableLocs)}if(isOrgStructureEnabled){var applicableDivs=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs);Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs,applicableDivs)}}if("-Select-"!==(projectId=ZPeopleComponents.select(projectDOM).getValue())&&(projectDOM.data("projectId",projectId),Timetracker.forms.appFor.updateAssigneesAccordingToProject(projectDOM)),projectDOM.on("change",function(){Timetracker.forms.appFor.updateAssigneesAccordingToProject($(this))}),-1==Layout.Page.hash.indexOf("home/myspace/overview-kra")&&-1==Layout.Page.hash.indexOf("#performance")&&-1==Layout.Page.hash.indexOf("#selfservice/user/goals")&&-1==Layout.Page.hash.indexOf("#selfservice/user/kra")||(layout.find("#zp_shared_list_Users").find("button").addClass("DN"),layout.find("#zp_shared_list_Departments").find("button").addClass("DN"),layout.find("#zp_shared_list_Divisions").find("button").addClass("DN"),layout.find(".ZPtopSearch").addClass("DN")),Timetracker.jobSchedule.isJobScheduleEnabled()){var inpElem=layout.find("input[name=Job_Name]").parent();inpElem.parent().parent().addClass("zpl_idivingrp"),inpElem.append('<div><i type="button" id="jobColor" class="zpl_ibg jc_bg6 zpl_act" iconnum="6"></i></div>'),inpElem.find("#jobColorMenu").remove(),inpElem.find("#jobColor").parent().append('<div id="jobColorMenu" class="zpl_drpdwn zpl_drpdwnic zpl_clrpckr"><ul></ul></div>'),inpElem.find("#jobColor").on("click",function(){0!==layout.find("#jobColorMenu").length&&(ZPeopleComponents.isComponent(layout.find("#jobColorMenu"))&&ZPeopleComponents.menu("#jobColorMenu").destroy(),layout.find("#jobColorMenu").remove());var iconnum=isEditMode&&otherDetails.zp_jobcolor&&"null"!=otherDetails.zp_jobcolor?otherDetails.zp_jobcolor:Timetracker.jobs.defJobColor,mhtml='<div id="jobColorMenu" class="zpl_drpdwn zpl_drpdwnic zpl_clrpckr"><ul>';for(let cnt=1;cnt<=16;cnt++)mhtml+='<li itemValue="'+cnt+'" class="jc_bg'+cnt+" zmenu__item "+(cnt==iconnum?"zpl_sel":"")+'" data-icon-class="jc_bg'+cnt+'"><div class="zmenu__iconcontainer"><i class="zmenu__icon jc_bg'+cnt+'"></i></div></li>';mhtml+="</ul></div>",layout.append(mhtml),ZPeopleComponents.menu("#jobColorMenu",{forElement:"#jobColor",contentType:"icon-text",appendTo:layout,columns:4}),layout.find("#jobColorMenu").on("zmenuitemclick",function(eve,edata){layout.find("#jobColor").removeAttr("class"),layout.find("#jobColor").addClass("zpl_ibg zpl_drpdwn-js zpl_act "+edata.iconClass),layout.find("#jobColor").attr("iconnum",edata.attrs.itemvalue)}),ZPeopleComponents.menu("#jobColorMenu").show()}),isEditMode&&void 0!=otherDetails&&void 0!=otherDetails.zp_jobcolor&&"null"!=otherDetails.zp_jobcolor?(inpElem.find("#jobColor").removeClass("jc_bg6").addClass("jc_bg"+otherDetails.zp_jobcolor),inpElem.find("#jobColor").attr("iconnum",otherDetails.zp_jobcolor)):(inpElem.find("#jobColor").addClass("jc_bg"+Timetracker.jobs.defJobColor),inpElem.find("#jobColor").attr("iconnum",Timetracker.jobs.defJobColor))}var baseEleParent=(0!==layout.find("div[folabel=BillableStatus]").length?layout.find("div[folabel=BillableStatus]"):layout.find("div[folabel=Assignees]")).parent(),baseEleWidth=baseEleParent.css("width"),html=Timetracker.generalSettings.htmlForWorkitemField({fieldWidth:baseEleWidth});baseEleParent.after(html),layout.find("div[folabel=Assignees]").addClass("flex-dirC d-flexclmcap10");var extraDetails={isFromForm:!0};if(isEditMode){let jobId=formRef.getFormsProperties().getRecordId();Timetracker.forms.setJobWorkitemsInCache(jobId,otherDetails.workitemDetails),extraDetails.jobId=jobId,extraDetails.showCommonWorkitems=!1,Timetracker.generalSettings.deletedWorkitems=""}extraDetails.isAddMode=isAddMode,extraDetails.isEditMode=isEditMode,extraDetails.isPreviewForm=isViewMode,extraDetails.layout=layout,Timetracker.timeLogSettings.workItems.initWorkitems(!1,extraDetails)}else if("P_TimesheetJobsList"===tableName){if(isEditMode){var clientInput=layout.find("div[folabel=ClientId]").find("input[clientInput]");""==ZPeopleComponents.select(clientInput).getValue()&&ZPeopleComponents.select(clientInput).setValue("-Select-")}Timetracker.CRM.clientFromCRM=!1,(headDiv=layout.find("div[folabel='ProjectHead']")).addClass("zpl_ilnegap");let disableHeadRatePerHour=!1;var headRatePerHour="";if(isEditMode)(disableHeadRatePerHour=(otherDetails=Timetracker.forms.getExtraDetails()).projectHeadDetails&&void 0===otherDetails.projectHeadDetails.rate)||(headRatePerHour=otherDetails.projectHeadDetails&&void 0!==otherDetails.projectHeadDetails.rate?otherDetails.projectHeadDetails.rate:headRatePerHour);disableHeadRatePerHour?headDiv.append('<div><div class="ztextbox--group ztextbox--zicon zh-alignright zpl_inputRPH">-</div></div>'):headDiv.append('<div><div class="ztextbox--group ztextbox--zicon zh-alignright zpl_inputRPH"><input class="ztextbox" id="projectHeadRate" placeholder="'+ZPI18N.getString("zp.rate")+'" value="'+headRatePerHour+'" '+(disableHeadRatePerHour?"disabled=true":"")+'><i class="ztextbox__icon"> '+ZPI18N.getString("zp.rateperhourinshort")+"</i></div></div>"),headDiv.find("#projectHeadRate").off("keyup").on("keyup",function(){""===$(this).val()||Timetracker.Validations.isDecimal($(this).val())?$(this).removeClass("ztextbox__error"):$(this).addClass("ztextbox__error")});var headElement=layout.find("input[name='ProjectHead']"),currentHead=headElement.val();if(headElement.data("previousValue",currentHead),headElement.on("change",function(){let previousValue=$(this).data("previousValue"),currentValue=$(this).val();if($(this).data("previousValue",currentValue),previousValue!==currentValue){let json={};"0"!==currentValue&&"-select-"!==currentValue.toLowerCase()&&(json.recordId=currentValue),Timetracker.forms.appFor.updateRelatedFields(Timetracker.forms.appFor.COMPONENTS.ProjectHead,Timetracker.forms.appFor.ENTITIES.Users,json)}}),layout.find("[folabel=ProjectManager]").removeClass("ovh"),layout.find("[folabel=ProjectUsers]").removeClass("ovh"),isAddMode||isEditMode){let selectedManagers=[],selectedUsers=[],selectedDepts=[],selectedDivs=[],selectedLocs=[],applicableManagers=[],applicableUsers=[];if(isEditMode){let otherDetails=Timetracker.forms.getExtraDetails();otherDetails&&(selectedManagers=otherDetails.projectManagerDetails?otherDetails.projectManagerDetails:selectedManagers,selectedUsers=otherDetails.projectUserDetails?otherDetails.projectUserDetails:selectedUsers,selectedDepts=otherDetails.deptDetails?otherDetails.deptDetails:selectedDepts,selectedDivs=otherDetails.divDetails?otherDetails.divDetails:selectedDivs,selectedLocs=otherDetails.locDetails?otherDetails.locDetails:selectedLocs)}else if(isAddMode){Timetracker.forms.getLayout().find('[componentName="'+Timetracker.forms.appFor.COMPONENTS.ProjectUsers+'"][entity="'+Timetracker.forms.appFor.ENTITIES.Users+'"]').find("#showHideBtn").trigger("click")}Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectManager,Timetracker.forms.appFor.ENTITIES.Users,selectedManagers),Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Users,selectedUsers);let defaultApplicableUsers=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Users,formRef.getMode());if(defaultApplicableUsers.length>0){let selectedManagerMap={};$.each(selectedManagers,function(index,data){selectedManagerMap[data.recordId]=!0}),$.each(defaultApplicableUsers,function(index,data){data.recordId!==currentHead&&(applicableManagers.push(data),selectedManagerMap[data.recordId]||applicableUsers.push(data))})}if(Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.ProjectManager,Timetracker.forms.appFor.ENTITIES.Users,applicableManagers),Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Users,applicableUsers),Timetracker.isDataAdminForAllUsers()){Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Depts,selectedDepts);let applicableDepts=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Depts);if(Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Depts,applicableDepts),isOrgStructureEnabled){Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Divs,selectedDivs);let applicableDivs=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Divs);Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Divs,applicableDivs)}if(Timetracker.generalSettings.isJobProLocApplicableEnabled()){Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Locs,selectedLocs);let applicableLocs=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Locs);Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Locs,applicableLocs)}}}(Timetracker.isDataAdmin()||Timetracker.util.checkAddClientPermVar)&&Timetracker.CRM.getIntegDetails().then(function(){Timetracker.CRM.integDtls.isActive?(layout.find("div[folabel=ClientId]").parent().addClass("zpl_idivingrp"),layout.find("div[folabel=ClientId]").removeClass("ovh"),layout.find("#chooseCRMdropdown").parent().removeClass("zpl_DNI")):(layout.find("#chooseCRMdropdown").parent().remove(),layout.find("#CRM_text").remove())}),layout.find(".zpl_inpgrp.zpTThrsrte").removeClass("zpTThrsrte"),layout.find("div[folabel=ProjectUsers]").addClass("flex-dirC d-flexclmcap10")}else"P_ClientDetails"===tableName&&ZPeopleComponents.select(layout.find("select[name=Billing_Method]"));layout.ztooltip()}if(isViewMode)if("P_Timesheet"===tableName){var isBreakLog,otherDetails=ZP5Form.getSingleRecord().record.extraDetails;if((isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",otherDetails))&&Timetracker.BreakTimelogs.Forms.load("SET",{isBreakLog:!0}),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT,!0)){var viewClientText='<div class="zpl_secn" isallowed="true"><div><label>'+ZPI18N.getString("zp.clientname")+'</label><span elem="viewToolTip"></span></div>';Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)&&(viewClientText='<div class="zpl_secn" isallowed="true"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.clientname")+'</label><span elem="viewToolTip"></span></div>'),viewClientText+='<div folabel="Client" id="timelogClient"></div></div>';var projectdom=layout.find("div[folabel=Project]").parent();$(viewClientText).insertBefore(projectdom);var clientName="-";void 0!=otherDetails.clientName&&(clientName=ZPeople.decodeTxt(otherDetails.clientName)),layout.find("div[folabel=Client]").text(clientName)}if(isBreakLog&&Timetracker.forms.showHideTlFormFields(layout,formRef),Timetracker.forms.mandatoryFormFieldsHighlight(layout),Timetracker.forms.setDisplayNamesofTLFields(layout),Timetracker.jobSchedule.hasCustomFields()){var jschDtlObj={};jschDtlObj.jobId=otherDetails.jobId;var tlWorkDate=otherDetails.workDate.split(" ")[0];jschDtlObj.workDate=tlWorkDate,jschDtlObj.formMode="FORM_VIEW_MODE",Timetracker.jobSchedule.timelogsView.constructJschinTLForm(jschDtlObj)}}else if("P_TimesheetJob"===tableName){if(layout.find("div[folabel=Assignees]").addClass("flex-dirC d-flexclmcap10"),otherDetails=Timetracker.forms.getExtraDetails()){Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users,otherDetails.assigneeDetails),Timetracker.isDataAdminForAllUsers()&&(Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts,otherDetails.deptDetails),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs,otherDetails.locDetails),isOrgStructureEnabled&&Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs,otherDetails.divDetails));let jobId=formRef.getFormsProperties().getRecordId();if(Timetracker.forms.setJobWorkitemsInCache(jobId,otherDetails.workitemDetails),Timetracker.Page.isJobForm("view")){var wiHtml=Timetracker.generalSettings.htmlForWorkitemFieldView(otherDetails);layout.find("div[folabel=BillableStatus]").parent().parent().append(wiHtml)}}}else if("P_TimesheetJobsList"===tableName){otherDetails=Timetracker.forms.getExtraDetails();var headDiv=layout.find("div[folabel='ProjectHead']"),headName=otherDetails.projectHeadDetails&&void 0!=otherDetails.projectHeadDetails.name?otherDetails.projectHeadDetails.name:headDiv.find("span").html();headRatePerHour=otherDetails.projectHeadDetails&&void 0!==otherDetails.projectHeadDetails.rate?otherDetails.projectHeadDetails.rate:"-";headDiv.html("").append('<div class="d-flex"><span style="width: 53%;">'+headName+"</span><span>"+headRatePerHour+("-"===headRatePerHour?"":"<em> "+ZPI18N.getString("zp.rateperhourinshort")+"</em>")+"</span></div>");var selectedManagers=[],selectedUsers=[];if(otherDetails&&(selectedManagers=otherDetails.projectManagerDetails?otherDetails.projectManagerDetails:selectedManagers,selectedUsers=otherDetails.projectUserDetails?otherDetails.projectUserDetails:selectedUsers),0==selectedManagers.length){var pmDiv=layout.find('[componentName="'+Timetracker.forms.appFor.COMPONENTS.ProjectManager+'"][entity="'+Timetracker.forms.appFor.ENTITIES.Users+'"]');pmDiv.addClass("zpl_DNI"),pmDiv.after("<span>-</span>")}else Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectManager,Timetracker.forms.appFor.ENTITIES.Users,selectedManagers);Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Users,selectedUsers),Timetracker.isDataAdminForAllUsers()&&otherDetails&&(Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Depts,otherDetails.deptDetails),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Locs,otherDetails.locDetails),isOrgStructureEnabled&&Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Divs,otherDetails.divDetails)),layout.find(".zpl_inpgrp.zpTThrsrte").removeClass("zpTThrsrte"),layout.find("div[folabel=ProjectUsers]").addClass("flex-dirC d-flexclmcap10")}},setJobWorkitemsInCache:function(jobId,workitemDetails){if(workitemDetails&&0!==workitemDetails.length&&(!Timetracker.timelogs.workItem.workItemDetailsCache||!Timetracker.timelogs.workItem.workItemDetailsCache[jobId]||Timetracker.timelogs.workItem.workItemDetailsCache[jobId].isLoadMore)){Timetracker.timelogs.workItem.resetWorkitemCache(jobId);let workitemResult={};workitemResult[jobId]=workitemDetails,Timetracker.timelogs.workItem.setWorkItemData(workitemResult,{jobId:jobId,limit:workitemDetails.length+1})}},showHideTlFormFields:function(formLayout,formRef){if(Timetracker.BreakTimelogs.isBreakLog()){if(0!=formLayout.find("[name=Project]").length&&TimelyZComp.select.destroy(formLayout.find("[name=Project]")),0!=formLayout.find("[name=Work_Item]").length&&ZPeopleComponents.isComponent(formLayout.find("[name=Work_Item]"))&&TimelyZComp.select.destroy(formLayout.find("[name=Work_Item]")),formLayout.find("div[folabel=Project]").parent().remove(),formLayout.find("div[folabel=Work_Item]").parent().remove(),formLayout.find("div[folabel=Attachment]").parent().remove(),0!==Layout.Page.container.find(".PI_plus").length&&Layout.Page.container.find(".PI_plus").parent().remove(),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)){var brkDiv=formLayout.find("div[folabel=Billable_Status]"),brkTypeVal="-1";formRef.isViewMode()?brkTypeVal=brkDiv.attr("compValue"):formRef.isEditMode()&&(brkTypeVal=TimelyZComp.select.getValue(formLayout.find("[name=Billable_Status]")));var brkFCID=brkDiv.attr("id"),brkFldType=brkDiv.attr("fieldtype"),brkTypeValText="-";"0"!==brkTypeVal&&"1"!==brkTypeVal||(brkTypeValText=ZPI18N.getString(Timetracker.Break.TYPE_STATUS[brkTypeVal])),0!=formLayout.find("select[name=Billable_Status]").length&&ZPeopleComponents.isComponent(formLayout.find("select[name=Billable_Status]"))&&TimelyZComp.select.destroy(formLayout.find("select[name=Billable_Status]")),formLayout.find("div[folabel=Billable_Status]").parent().remove();var brkTypeHtml='<div class="zpl_secn" isallowed="true"><div><label class="zplt-label "><font>'+ZPI18N.getString("zp.type")+"</font></label></div>";brkTypeHtml+='<div folabel="Billable_Status" fieldtype="'+brkFldType+'" id="'+brkFCID+'" relateddata="false" isfielddependent="false"><span id="brkTypevalText">'+brkTypeValText+"</span></div></div>";var dateDom=formLayout.find("div[folabel=Date]").parent();$(brkTypeHtml).insertBefore(dateDom)}}else{if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.PROJECT)){if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)){var clientFilter='<div class="zpl_secn" isallowed="true"><div><label><font class="form_clientname">'+ZPI18N.getString("zp.clientname")+"</font></label></div>";clientFilter+='<div folabel="Client" class="ovh"><input name="Client" id="timelogClient" zcomponentname="select"/></div></div>';var projectdom=formLayout.find("div[folabel=Project]").parent();if($(clientFilter).insertBefore(projectdom),formRef.isEditMode()&&ZP5Form.getSingleRecord().record.extraDetails){var extraDtls=ZP5Form.getSingleRecord().record.extraDetails;if(void 0!=extraDtls.clientId){var clientDiv=formLayout.find('input[name="Client"]');clientDiv.val(extraDtls.clientId),clientDiv.text(extraDtls.clientName)}}}}else formLayout.find("div[folabel=Project]").parent().remove();if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)||formLayout.find("div[folabel=Work_Item]").parent().remove(),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)||formLayout.find("div[folabel=Description]").parent().remove(),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.ATTACHMENT)&&!Timetracker.timesheet.isAddTimelogFromTSAllowed()||formLayout.find("div[folabel=Attachment]").parent().remove(),ZP5Form.isEmbedForm()){var empDiv='<div class="zpl_secn" isallowed="true"><div><label><font class="form_empname">'+ZPI18N.getString("zp.employeename")+"</font></label></div>";if(empDiv+='<div folabel="empName" class="ovh"><input name="EmployeeName" id="timelogEmbedEmp" zcomponentname="select"/></div></div>',Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)){var clientDom=formLayout.find("div[folabel=Client]").parent();$(empDiv).insertBefore(clientDom)}else if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.PROJECT)){projectdom=formLayout.find("div[folabel=Project]").parent();$(empDiv).insertBefore(projectdom)}else{var jobDom=formLayout.find("div[folabel=JobId]").parent();$(empDiv).insertBefore(jobDom)}}}},mandatoryFormFieldsHighlight:function(formLayout){Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT,!0)&&(formLayout.find("div[folabel=Project]").siblings("div").find("label").addClass("zpl_mtry"),Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)&&formLayout.find("div[folabel=Client]").siblings("div").find("label").addClass("zpl_mtry")),Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM,!0)&&formLayout.find("div[folabel=Work_Item]").siblings("div").find("label").addClass("zpl_mtry"),Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC,!0)&&formLayout.find("div[folabel=Description]").siblings("div").find("label").addClass("zpl_mtry"),formLayout.find("div[folabel=Billable_Status]").siblings("div").find("label").addClass("zpl_mtry")},setDisplayNamesofTLFields:function(layout,mode){if(Timetracker.BreakTimelogs.isBreakLog()){0!=layout.find("div[folabel=JobId]").length&&layout.find("div[folabel=JobId]").siblings("div").find("label").html(ZPI18N.getString("zp.break")),0!=layout.find("div[folabel=Billable_Status]").length&&layout.find("div[folabel=Billable_Status]").siblings("div").find("label").html(ZPI18N.getString("zp.type"));var formDispName=Timetracker.forms.getSingularDisplayNameForForms(Timetracker.constants.TIMELOG_TABLE,"Break");"ADD"==mode?formDispName=ZPI18N.getString("zp.addcomponents",[formDispName]):"EDIT"==mode&&(formDispName=ZPI18N.getString("zp.module.edit",[formDispName])),layout.find("#zp_form_header_name").html(formDispName)}else{null!=Timetracker.jobs.formDetails&&Timetracker.jobs.formDetails.hasOwnProperty("labelDetails")&&Timetracker.jobs.formDetails.labelDetails.hasOwnProperty("JOBNAME")&&layout.find("div[folabel=JobId]").siblings("div").find("label").html(Timetracker.jobs.formDetails.labelDetails.JOBNAME),null!=Timetracker.projects.formDetails&&Timetracker.projects.formDetails.hasOwnProperty("labelDetails")&&Timetracker.projects.formDetails.labelDetails.hasOwnProperty("JOBSLISTNAME")&&layout.find("div[folabel=Project]").siblings("div").find("label").html(Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME),null!=Timetracker.clients.formDetails&&Timetracker.clients.formDetails.hasOwnProperty("labelDetails")&&Timetracker.clients.formDetails.labelDetails.hasOwnProperty("CLIENTNAME")&&layout.find("div[folabel=Client]").siblings("div").find("label").html(Timetracker.clients.formDetails.labelDetails.CLIENTNAME);var workitemDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM),descDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC),attachDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.ATTACHMENT);0!=layout.find("div[folabel=Work_Item]").length&&layout.find("div[folabel=Work_Item]").siblings("div").find("label").html(workitemDispName),0!=layout.find("div[folabel=Date]").length&&layout.find("div[folabel=Date]").siblings("div").find("label").html(ZPI18N.getString("zp.date")),0!=layout.find("div[folabel=Description]").length&&layout.find("div[folabel=Description]").siblings("div").find("label").html(descDispName),0!=layout.find("div[folabel=TotalHours]").length&&layout.find("div[folabel=TotalHours]").siblings("div").find("label").html(ZPI18N.getString("zp.hourslog")),0!=layout.find("div[folabel=Billable_Status]").length&&layout.find("div[folabel=Billable_Status]").siblings("div").find("label").html(ZPI18N.getString("zp.billablestatus")),0!=layout.find("div[folabel=Attachment]").length&&layout.find("div[folabel=Attachment]").siblings("div").find("label").html(attachDispName)}},getParamsForForms:function(params,tableName,layout){"P_TimesheetJob"===tableName?Timetracker.jobs.Forms.getScheduleDetailsForForm(params,layout):"P_Timesheet"===tableName?Timetracker.timelogs.forms.getTimelogDetailsForForm(params):"P_TimesheetJobsList"===tableName?Timetracker.projects.Forms.getProjectDetailsForForm(params,layout):"P_ClientDetails"===tableName&&0!==layout.find("select[name=Billing_Method]").length&&(params.Billing_Method=ZPeopleComponents.select(layout.find("select[name=Billing_Method]")).getValue())},refreshLookupOptions:function(form){var formId=null;"jobs"===form?(Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),formId=Timetracker.jobs.formDetails.formId):"projects"===form?(Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),formId=Timetracker.projects.formDetails.formId):"clients"===form&&(Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,"P_ClientDetails"),formId=Timetracker.clients.formDetails.formId),null!==formId&&(ZP5Form.LOOKUP_DATA[formId]={refresh:!0})},checkIfHasEditableParam:function(){var ZForm=Timetracker.forms.getFormReferance();return void 0!==ZForm.FORM_COMPONENT_DATA[ZForm.CURRFORM_PARAM.formId].message.hasEditableField},isTTSelectQuickAdd:function(){var isFromSelectQA=!1;return!ZPForm_MAIN_PARAM.hasOwnProperty("ttSelectAddData")||"P_TimesheetJob"!==ZPForm_MAIN_PARAM.tableName&&"P_TimesheetJobsList"!==ZPForm_MAIN_PARAM.tableName||(isFromSelectQA=!0),isFromSelectQA},isFromJobSchedule:function(){return"#timetracker/jobschedule/list"===Layout.Page.hash},quickaddCallback:function(formsObj,resultData,params){var layoutDtls=formsObj.getParams();Timetracker.forms.quickaddHandling(resultData,params,layoutDtls.mainFrom)},quickaddHandling:function(resultData,params,layoutDtls){var qaddTableName=resultData[0].lkpDetails.lkpFormLinkName;"P_Timesheet"!==(layoutDtls=layoutDtls||ZP5Form.getFormClassObj().getParams()).tableName||"P_TimesheetJob"!==qaddTableName&&"P_TimesheetJobsList"!==qaddTableName||Timetracker.timelogs.forms.updateValuesInSelect(resultData,layoutDtls.ttSelectAddData,params,!0)},handleQuickAdd:function(params){var elementProjectId,elementClientId,layoutDetails,currFormParams=ZP5Form.getFormClassObj().getParams(),mainFromObj=ZP5Form.getFormClassObj().moduleHandler.getInitialParams().main_form,mainFromParams=void 0!=mainFromObj?mainFromObj.getParams():currFormParams.mainFrom,elementObj=void 0!=mainFromObj?mainFromObj.LAYOUT:Timetracker.Util.getLayout();if(mainFromParams.hasOwnProperty("ttSelectAddData")&&(!0,layoutDetails=mainFromParams.ttSelectAddData,elementId=layoutDetails.id,layoutDetails.hasOwnProperty("containerId")&&(containerObj=Timetracker.Util.getMainContainer().find("#"+layoutDetails.containerId),elementObj=$(containerObj)),elementObj=""===elementObj||void 0===elementObj?Layout.Page.container:elementObj,elementProjectId=$(elementObj).find("#"+elementId).attr("projectId"),$(elementObj).find("#"+elementId).attr("jobId"),elementClientId=$(elementObj).find("#"+elementId).attr("clientId")),void 0!==currFormParams.tableName&&"P_TimesheetJob"===currFormParams.tableName&&void 0!==mainFromParams.tableName&&"P_Timesheet"===mainFromParams.tableName&&!mainFromParams.hasOwnProperty("ttSelectAddData")&&0!==mainFromObj.LAYOUT.length){var projectdiv=mainFromObj.LAYOUT.find("input[name=Project]");if(0!=projectdiv.length&&ZPeopleComponents.isComponent(projectdiv)){var projectVal=ZPeopleComponents.select(projectdiv).getValue();void 0!==projectVal&&""!==projectVal&&"0"!==projectVal&&"-Select-"!==projectVal&&(params.Project=projectVal)}}if("P_TimesheetJob"===currFormParams.tableName&&(params.Assignees=erecno,-1!==Layout.Page.hash.indexOf("jobschedule")?params.Assignees=null===Timetracker.jobSchedule.currPopupUser||void 0===Timetracker.jobSchedule.currPopupUser?ZPeople.CURR_USER.usererec:Timetracker.jobSchedule.currPopupUser:(mainFromParams&&mainFromParams.tableName&&"P_Timesheet"===mainFromParams.tableName||mainFromParams.hasOwnProperty("ttSelectAddData"))&&(params.Assignees=Timetracker.Page.isSelectedUser()?Timetracker.Team.getSelectedUser():null!==Timetracker.timelogs.tserecno?Timetracker.timelogs.tserecno:erecno,params.addUserToProject=!0),mainFromParams.hasOwnProperty("ttSelectAddData")&&!params.hasOwnProperty("Project")&&elementId.indexOf("job")>=0)){var prId=0;0!=$(elementObj).find("#"+elementProjectId).length?prId=ZPeopleComponents.select($(elementObj).find("#"+elementProjectId)).getValue():0!=$(elementObj).find('input[name="project"]').length&&(prId=TimelyZComp.select.getValue($(elementObj).find('input[name="project"]'))),0!==prId&&"0"!==prId&&null!==prId&&""!==prId&&(params.Project=prId)}if("P_TimesheetJobsList"===currFormParams.tableName){if(params.ProjectManager=erecno,-1!==Layout.Page.hash.indexOf("/jobschedule"))params.ProjectManager=null===Timetracker.jobSchedule.currPopupUser||void 0===Timetracker.jobSchedule.currPopupUser?ZPeople.CURR_USER.usererec:Timetracker.jobSchedule.currPopupUser;else if((mainFromParams&&mainFromParams.tableName&&"P_Timesheet"===mainFromParams.tableName||mainFromParams.hasOwnProperty("ttSelectAddData"))&&(params.ProjectManager=Timetracker.timelogs.tserecno&&null!==Timetracker.timelogs.tserecno?Timetracker.timelogs.tserecno:erecno,null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients)){var ClientId=0,clntSelDiv=mainFromObj&&0!==mainFromObj.LAYOUT.length?mainFromObj.LAYOUT.find('input[name="Client"]'):$(elementObj).find('input[name="client"]');0!=clntSelDiv.length&&ZPeopleComponents.isComponent(clntSelDiv)&&(ClientId=TimelyZComp.select.getValue(clntSelDiv)),null!==ClientId&&"0"!=ClientId&&void 0!=ClientId&&(params.ClientId=ClientId)}if(mainFromParams.hasOwnProperty("ttSelectAddData")&&void 0==params.ClientId&&elementId.indexOf("project")>=0&&null!=elementClientId&&void 0!=elementClientId){ClientId=0;0!=$(elementObj).find("#"+elementClientId).length&&(ClientId=ZPeopleComponents.select($(elementObj).find("#"+elementClientId)).getValue()),null!==ClientId&&"0"!=ClientId&&void 0!=ClientId&&(params.ClientId=ClientId)}}},setFormDisplayName:function(){Timetracker.util.jobDispName=Timetracker.jobs.formDetails.hasOwnProperty("formDispName")&&"jobs"!==Timetracker.jobs.formDetails.formDispName?Timetracker.jobs.formDetails.formDispName:ZPI18N.getString("zp.job"),Timetracker.util.projectDispName=Timetracker.projects.formDetails.hasOwnProperty("formDispName")&&"projects"!==Timetracker.projects.formDetails.formDispName?Timetracker.projects.formDetails.formDispName:ZPI18N.getString("zp.project"),Timetracker.util.clientDispName=Timetracker.clients.formDetails.hasOwnProperty("formDispName")&&"clients"!==Timetracker.clients.formDetails.formDispName?Timetracker.clients.formDetails.formDispName:ZPI18N.getString("zp.client")},getSingleRecord:function(){var recDtls=Timetracker.forms.getFormReferance().getSingleRecord();if(recDtls)return recDtls.record},getExtraDetails:function(){var extraDtls,recDtls=Timetracker.forms.getSingleRecord();return recDtls&&(extraDtls=recDtls.extraDetails),extraDtls},getTTCustomAdminApplicableUsersBasedOnMode:function(type){var formClassObj=ZP5Form.getFormClassObj();return formClassObj.isAddMode()||formClassObj.isEditMode()||type===Timetracker.constants.TTCustomAdmin.EntryEdit?Timetracker.ttCustomAdminEntryEditOpApplicableUsers:formClassObj.isViewMode()||type===Timetracker.constants.TTCustomAdmin.EntryView?Timetracker.ttCustomAdminEntryViewOpApplicableUsers:null},isTTCustomAdminbasedOnView:function(type){let formClassObj=ZP5Form.getFormClassObj();return(type=void 0!=type?type.toLowerCase():type)&&(type===Timetracker.constants.EDIT||type===Timetracker.constants.ADD)||!type&&(formClassObj.isAddMode()||formClassObj.isEditMode())?Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit):!!(type&&type===Timetracker.constants.VIEW||!type&&formClassObj.isViewMode())&&Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryView)},setPermissioneededForViewType:function(type){Timetracker.constants.TTCustomAdmin.PermissionNeededForMode=type},URLs:{isTimetrackerFormUrl:function(hash){return-1!==hash.indexOf("#timetracker/timesheetlist-formId")||-1!==hash.indexOf("#timetracker/scheduler-formId")||-1!==hash.indexOf("#timetracker/timesheet-formId")||-1!==hash.indexOf("#timetracker/scheduler/viewclient")||-1!==hash.indexOf("#timetracker/scheduler/viewproject")||-1!==hash.indexOf("#timetracker/scheduler/viewjob")},getRecordDtls:function(hash){var recordDtls={};if(-1!==hash.indexOf("#timetracker/timesheetlist-formId")||-1!==hash.indexOf("#timetracker/scheduler-formId")||-1!==hash.indexOf("#timetracker/timesheet-formId")){var recordDtl=hash.split("-")[1].split("/");recordDtl.length>1&&(recordDtls.formId=recordDtl[0].split(":")[1],recordDtls.recordId=recordDtl[1].split(":")[1])}else-1===hash.indexOf("#timetracker/scheduler/viewclient")&&-1===hash.indexOf("#timetracker/scheduler/viewproject")&&-1===hash.indexOf("#timetracker/scheduler/viewjob")||(recordDtls.recordId=hash.split("-")[1].split(":")[1]);return recordDtls},getTabNameByURL:function(hash){return-1!==hash.indexOf("#timetracker/scheduler/viewclient")?Timetracker.constants.CLIENT_TABLE:-1!==hash.indexOf("#timetracker/scheduler/viewproject")?Timetracker.constants.PROJECT_TABLE:-1!==hash.indexOf("#timetracker/scheduler/viewjob")?Timetracker.constants.JOB_TABLE:void 0},getModeByURL:function(){var hash=Layout.Page.hash;return-1!==hash.indexOf("timetracker")&&-1!==hash.indexOf("/jobs/listview")||-1!==hash.indexOf("/projectdashboard/jobs")?Timetracker.constants.JOB:-1!==hash.indexOf("timetracker")&&-1!==hash.indexOf("/projects/listview")?Timetracker.constants.PROJECT:Timetracker.Page.isProjectDashboard()?Timetracker.constants.PROJECTDASHBOARD:-1!==hash.indexOf("home/team/projects/listview")?Timetracker.constants.PROJECT:-1!==hash.indexOf("timetracker")&&-1!==hash.indexOf("/clients/listview")?Timetracker.constants.CLIENT:void 0},getModuleParamByUrl:function(){var url=settingsUrlProps.niceUrl;return-1!=url.indexOf("/jobs/")?{modulePrefix:"timetracker-scheduler-jobs",submode:"timetracker-mydata-jobs-listview"}:-1!=url.indexOf("/projects/")?{modulePrefix:"timetracker-scheduler-projects",submode:"timetracker-mydata-projects-listview"}:-1!=url.indexOf("/clients")?{modulePrefix:"timetracker-scheduler-clients",submode:"timetracker-mydata-clients-listview"}:null},isTTURL:function(){var mode=Timetracker.forms.URLs.getModeByURL(),ttmodes=[Timetracker.constants.JOB,Timetracker.constants.PROJECT,Timetracker.constants.PROJECTDASHBOARD,Timetracker.constants.CLIENT];return!(!mode||-1==ttmodes.indexOf(mode))}},appFor:{COMPONENTS:{ProjectHead:"ProjectHead",ProjectManager:"ProjectManager",ProjectUsers:"ProjectUsers",Assignees:"Assignees"},ENTITIES:{Users:"Users",Depts:"Depts",Divs:"Divs",Locs:"Locs"},REFRESHDATA:{},DETAILS:{},SELECTED_RECORDS:{},APPLICABLE_RECORDS:{},APPLICABLE_SEARCH_RECORDS:{},FIRESCROLL_LIMIT:50,EXTRA_DTLS:{},applicableRecordsFetchDelay:void 0,init:function(componentName,details){void 0!==componentName&&(Timetracker.forms.appFor.resetData(componentName),void 0!==details&&(Timetracker.forms.appFor.DETAILS[componentName]=details))},resetData:function(componentName){Timetracker.forms.appFor.DETAILS[componentName]={},Timetracker.forms.appFor.REFRESHDATA[componentName]={},Timetracker.forms.appFor.SELECTED_RECORDS[componentName]={},Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName]={},Timetracker.forms.appFor.APPLICABLE_SEARCH_RECORDS[componentName]={},Timetracker.forms.appFor.EXTRA_DTLS[componentName]={}},getDetails:function(componentName){return void 0!==componentName?Timetracker.forms.appFor.DETAILS[componentName]:void 0},getEntityDetails:function(componentName,entity){return Timetracker.forms.appFor.getDetails(componentName)[entity]},getExtraDtls:function(componentName,entity){return void 0==Timetracker.forms.appFor.EXTRA_DTLS[componentName][entity]&&(Timetracker.forms.appFor.EXTRA_DTLS[componentName][entity]={}),Timetracker.forms.appFor.EXTRA_DTLS[componentName][entity]},updateExtraDtls:function(componentName,entity,json){let extraDtls=Timetracker.forms.appFor.getExtraDtls(componentName,entity),keys=Object.keys(json);$.each(keys,function(index,key){extraDtls[key]=json[key]}),Timetracker.forms.appFor.EXTRA_DTLS[componentName][entity]=extraDtls},getRefreshDtls:function(componentName,entity){return void 0===Timetracker.forms.appFor.REFRESHDATA[componentName][entity]&&(Timetracker.forms.appFor.REFRESHDATA[componentName][entity]={}),Timetracker.forms.appFor.REFRESHDATA[componentName][entity]},refetchApplicableList:function(componentName,entity){let refreshDtls=Timetracker.forms.appFor.getRefreshDtls(componentName,entity);return void 0!==refreshDtls.refetchApplicableList&&refreshDtls.refetchApplicableList},setApplicableListRefetchKey:function(componentName,entity,isRefetch){let refreshDtls=Timetracker.forms.appFor.getRefreshDtls(componentName,entity);refreshDtls.refetchApplicableList=isRefetch,isRefetch&&(refreshDtls.reconstructApplicableList=!0),Timetracker.forms.appFor.REFRESHDATA[componentName][entity]=refreshDtls},reconstructApplicableList:function(componentName,entity){let refreshDtls=Timetracker.forms.appFor.getRefreshDtls(componentName,entity);return void 0===refreshDtls.reconstructApplicableList||refreshDtls.reconstructApplicableList},setApplicableListReconstructionKey:function(componentName,entity,isReconstruct){let refreshDtls=Timetracker.forms.appFor.getRefreshDtls(componentName,entity);refreshDtls.reconstructApplicableList=isReconstruct,Timetracker.forms.appFor.REFRESHDATA[componentName][entity]=refreshDtls},constructDetailsJson:function(formId,fieldDetails,isAddEdit){var componentName=isAddEdit?fieldDetails.labelName:fieldDetails.componentName,details={formId:formId,componentId:fieldDetails.formComponentId},userDetails={componentName:componentName,entity:Timetracker.forms.appFor.ENTITIES.Users,bottomBarNeeded:"Assignees"===componentName,bottomBarDtls:{text:ZPI18N.getString("zp.estimatedhours")},includeRate:!0,includeHours:"Assignees"===componentName,firescrollNeeded:!0};if(isAddEdit&&(userDetails.isEditAllowed=!0,userDetails.applicableListNeeded=!0,userDetails.applicableListDtls={isAllowSelectAll:"Assignees"===componentName||"ProjectUsers"===componentName,bottomBarNeeded:!1,bottomBarDtls:{text:ZPI18N.getString("zp.estimatedhours")}}),details[Timetracker.forms.appFor.ENTITIES.Users]=userDetails,!Timetracker.isDataAdminForAllUsers()||"Assignees"!==componentName&&"ProjectUsers"!==componentName)details.isUsersAlone=!0;else{var deptDetails={componentName:componentName,entity:Timetracker.forms.appFor.ENTITIES.Depts};if(isAddEdit&&(deptDetails.isEditAllowed=!0,deptDetails.applicableListNeeded=!0,deptDetails.applicableListDtls={isAllowSelectAll:"Assignees"===componentName||"ProjectUsers"===componentName}),details[Timetracker.forms.appFor.ENTITIES.Depts]=deptDetails,Timetracker.generalSettings.isJobProLocApplicableEnabled()){var locDetails={componentName:componentName,entity:Timetracker.forms.appFor.ENTITIES.Locs};isAddEdit&&(locDetails.isEditAllowed=!0,locDetails.applicableListNeeded=!0,locDetails.applicableListDtls={isAllowSelectAll:"Assignees"===componentName||"ProjectUsers"===componentName}),details[Timetracker.forms.appFor.ENTITIES.Locs]=locDetails}if(isOrgStructureEnabled){var divDetails={componentName:componentName,entity:Timetracker.forms.appFor.ENTITIES.Divs};isAddEdit&&(divDetails.isEditAllowed=!0,divDetails.applicableListNeeded=!0,divDetails.applicableListDtls={isAllowSelectAll:"Assignees"===componentName||"ProjectUsers"===componentName}),details[Timetracker.forms.appFor.ENTITIES.Divs]=divDetails}}return details},getComponentHtml:function(componentName){var html="",details=Timetracker.forms.appFor.getDetails(componentName),userDetails=details[Timetracker.forms.appFor.ENTITIES.Users];if(void 0!==userDetails){var bottomBarHtml="",applicableListPopupHtml="";userDetails.bottomBarNeeded&&(bottomBarHtml=Timetracker.forms.appFor.getBottomBarHtml(userDetails)),userDetails.isEditAllowed&&(applicableListPopupHtml=Timetracker.forms.appFor.getApplicableListPopupHtml(componentName,Timetracker.forms.appFor.ENTITIES.Users,userDetails));var showHideBtnHtml="",style="display: flex;";if(!details.isUsersAlone){style="display: none;";var clearBtn='<button class="zlabel zlabel--outline zlabel--small MLauto DN" type="button" onclick="Timetracker.forms.appFor.selectOrRemoveAllRecords(this, event, \''+componentName+"', '"+Timetracker.forms.appFor.ENTITIES.Users+"', true);\">"+ZPI18N.getString("zp.clear")+"</button>";showHideBtnHtml='<div id="showHideBtn" componentName="'+componentName+'" class="d-flexclmcap5 a-itm-cntr CP"  onclick="Timetracker.forms.appFor.showHideSelectedList(\''+componentName+"', '"+Timetracker.forms.appFor.ENTITIES.Users+'\');"><i class="PI_argt"></i>'+ZPI18N.getString("zp.users")+'<span name="recordCount" class="zpl_badge">0</span>'+(userDetails.isEditAllowed?clearBtn:"")+"</div>"}var classList="zpl_inpgrp zpTThrsrte";classList+=-1!=componentName.indexOf("Project")?" zpl_pjttdfx":"",html='<div componentName="'+componentName+'" entity="'+Timetracker.forms.appFor.ENTITIES.Users+'">'+showHideBtnHtml+'<div id="selectedList" class="'+classList+'" + style="'+style+'"><div class="zpl_frmctrl selectedListScrollableDiv"><div class="zpl_tgrp"><table id="selectedListDiv" class="zpl_itbl wd100_per"><tbody></tbody></table></div></div>'+bottomBarHtml+(userDetails.isEditAllowed?'<a class="grp_add"  aria-expanded="false" data-toggle="dropdown" id="dd_button"><i class="PI_addlist"></i></a>':"")+applicableListPopupHtml+"</div></div>"}var deptDetails=details[Timetracker.forms.appFor.ENTITIES.Depts];if(void 0!==deptDetails){applicableListPopupHtml="";deptDetails.isEditAllowed&&(applicableListPopupHtml=Timetracker.forms.appFor.getApplicableListPopupHtml(componentName,Timetracker.forms.appFor.ENTITIES.Depts,deptDetails)),html+='<div class="jobHrsRteRow slcdropVW" componentName="'+componentName+'" entity="'+Timetracker.forms.appFor.ENTITIES.Depts+'"><div id="showHideBtn" componentName="'+componentName+'" class="d-flexclmcap5 a-itm-cntr CP" onclick="Timetracker.forms.appFor.showHideSelectedList(\''+componentName+"', '"+Timetracker.forms.appFor.ENTITIES.Depts+'\');"><i class="PI_argt"></i>'+ZPI18N.getString("zp.departments")+'<span class="zpl_badge" name="recordCount">0</span>'+(deptDetails.isEditAllowed?'<button class="zlabel zlabel--outline zlabel--small DN MLauto" type="button" onclick="Timetracker.forms.appFor.selectOrRemoveAllRecords(this, event, \''+componentName+"', '"+Timetracker.forms.appFor.ENTITIES.Depts+"', true);\">"+ZPI18N.getString("zp.clear")+"</button>":"")+'</div><div id="selectedList" class="" style="display: none;"><ul id="selectedListDiv" class="slcdrop selectedListScrollableDiv" style="min-height: 30px;" aria-expanded="false" data-toggle="dropdown"></ul><div class="zpTThrsrte dropdown">'+applicableListPopupHtml+"</div></div></div>"}var locDetails=details[Timetracker.forms.appFor.ENTITIES.Locs];if(void 0!==locDetails){applicableListPopupHtml="";locDetails.isEditAllowed&&(applicableListPopupHtml=Timetracker.forms.appFor.getApplicableListPopupHtml(componentName,Timetracker.forms.appFor.ENTITIES.Locs,locDetails)),html+='<div class="jobHrsRteRow slcdropVW" componentName="'+componentName+'" entity="'+Timetracker.forms.appFor.ENTITIES.Locs+'"><div id="showHideBtn" componentName="'+componentName+'" class="d-flexclmcap5 a-itm-cntr CP" onclick="Timetracker.forms.appFor.showHideSelectedList(\''+componentName+"', '"+Timetracker.forms.appFor.ENTITIES.Locs+'\');"><i class="PI_argt"></i>'+ZPI18N.getString("zp.locations")+'<span class="zpl_badge" name="recordCount">0</span>'+(locDetails.isEditAllowed?'<button class="zlabel zlabel--outline zlabel--small DN MLauto" type="button" onclick="Timetracker.forms.appFor.selectOrRemoveAllRecords(this, event, \''+componentName+"', '"+Timetracker.forms.appFor.ENTITIES.Locs+"', true);\">"+ZPI18N.getString("zp.clear")+"</button>":"")+'</div><div id="selectedList" style="display: none;"><ul id="selectedListDiv" class="slcdrop selectedListScrollableDiv" style="min-height: 30px;" aria-expanded="false" data-toggle="dropdown"></ul><div class="zpTThrsrte dropdown">'+applicableListPopupHtml+"</div></div></div>"}var divDetails=details[Timetracker.forms.appFor.ENTITIES.Divs];if(void 0!==divDetails){var divisionDisplayName=ZPI18N.getString("zp.division");ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(divisionDisplayName=ZPeople.orgStructureDispNameMap.division);applicableListPopupHtml="";divDetails.isEditAllowed&&(applicableListPopupHtml=Timetracker.forms.appFor.getApplicableListPopupHtml(componentName,Timetracker.forms.appFor.ENTITIES.Divs,divDetails)),html+='<div class="jobHrsRteRow slcdropVW" componentName="'+componentName+'" entity="'+Timetracker.forms.appFor.ENTITIES.Divs+'"><div id="showHideBtn" componentName="'+componentName+'" class="d-flexclmcap5 a-itm-cntr CP" onclick="Timetracker.forms.appFor.showHideSelectedList(\''+componentName+"', '"+Timetracker.forms.appFor.ENTITIES.Divs+'\');"><i class="PI_argt"></i>'+divisionDisplayName+'<span class="zpl_badge" name="recordCount">0</span>'+(divDetails.isEditAllowed?'<button class="zlabel zlabel--outline zlabel--small DN MLauto" type="button" onclick="Timetracker.forms.appFor.selectOrRemoveAllRecords(this, event, \''+componentName+"', '"+Timetracker.forms.appFor.ENTITIES.Divs+"', true);\">"+ZPI18N.getString("zp.clear")+"</button>":"")+'</div><div id="selectedList" style="display: none;"><ul id="selectedListDiv" class="slcdrop selectedListScrollableDiv" style="min-height: 30px;" aria-expanded="false" data-toggle="dropdown"></ul><div class="zpTThrsrte dropdown">'+applicableListPopupHtml+"</div></div></div>"}return html},getBottomBarHtml:function(details){return'<div class="zphrsrtevlu"><table class="zpl_itbl wd100_per"><tbody><tr><td id="bottomBarTxt" '+(details.isEditAllowed?"":'style="width: 30%;"')+"><b>"+details.bottomBarDtls.text+"</b></td>"+(details.isEditAllowed?'<td id="bottomBarValue"><b></td></tr>':'<div class="hrsrtevlubx"><td id="bottomBarValue"><b></td></tr></div>')+"</tr></tbody></table></div>"},constructDataJson:function(recordArray,idRegex,nameRegex){var json=[];if(void 0!==recordArray&&0!==recordArray.length){var recordString=JSON.stringify(recordArray);recordString=(recordString=recordString.replaceAll(nameRegex,"name")).replaceAll(idRegex,"recordId"),json=JSON.parse(recordString)}return json},getFirescrollMode:function(componentName,entity,isSelectedList){return(isSelectedList?"form_selected_list_":"form_applicable_list_")+componentName+"_"+entity},getApplicableListPopupHtml:function(componentName,entity,entityDetails){var applicableListDtls=entityDetails.applicableListDtls,html="",applicableListBottomBarHtml="";return applicableListDtls.bottomBarNeeded&&(applicableListBottomBarHtml=Timetracker.forms.appFor.getBottomBarHtml(applicableListDtls)),html+='<div class="zpl_popovr AJdrp dropdown-menu" rel="estpop"><div class="rhttabscrl"><div class="zpl_tbvrt"><div class="zpl_rgtlst"><div class="zpl_tbpne zpl_act"><div class="zpl_popsrch" name="searchPanel">'+(applicableListDtls.isAllowSelectAll?'<div class="zcheckbox"><input type="checkbox" id="selectAllCheckBox'+entity+'"  name="selectAllCheckBox'+entity+'" onclick="Timetracker.forms.appFor.selectOrRemoveAllRecords(this, event, \''+componentName+"', '"+entity+'\');" class="zcheckbox__helper"><label class="zcheckbox__label"  for="selectAllCheckBox'+entity+'" title="'+ZPI18N.getString("zp.selectall")+'"></label></div>':"")+'<div class="zpl_search zpl_srchsml"><input class="ztextbox" name="searchInput" placeholder="'+ZPI18N.getString("zp.search")+'"><i class="PI_lens"></i></div>'+(applicableListDtls.isAllowSelectAll?'<div class="d-flex DNI" style="gap:5px" name="allHoursAndRateDtls">'+(entityDetails.includeHours?'<input name="allHoursInput" onkeyup="Timetracker.forms.appFor.updateAllRecords(\''+componentName+"', '"+entity+'\',this);" placeholder="'+ZPI18N.getString("zp.hours")+'" class="ztextbox tblinp" type="text">':"")+(entityDetails.includeRate?'<input name="allRateInput" onkeyup="Timetracker.forms.appFor.updateAllRecords(\''+componentName+"', '"+entity+'\',this);" placeholder="'+ZPI18N.getString("zp.rate")+'" class="ztextbox tblinp type="text">':"")+"</div>":"")+'</div><div id="applicableList" style="overflow:auto;flex:1;"><ul id="applicableListDiv" class="zpl_lstgrp"></ul></div>'+applicableListBottomBarHtml+"</div></div></div></div></div>"},initApplicableList:function(componentName,entity,dataArray){Timetracker.forms.appFor.setApplicableListReconstructionKey(componentName,entity,!0),Timetracker.forms.appFor.updateApplicableRecordsCache(componentName,entity,null,dataArray,!0);let componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]');componentDiv.find("#applicableListDiv").empty(),(componentDiv.find("#dd_button").length>0?componentDiv.find("#dd_button"):componentDiv.find("#selectedList")).off("click").on("click",function(event){Timetracker.forms.appFor.loadApplicableList(componentName,entity)}),componentDiv.find('[name="searchPanel"]').off("click").on("click",function(event){event.stopPropagation()}),componentDiv.find('[name="searchInput"]').off("input").on("input",function(event){event.stopPropagation(),clearTimeout(Timetracker.forms.appFor.applicableRecordsFetchDelay),Timetracker.forms.appFor.applicableRecordsFetchDelay=setTimeout(()=>{Timetracker.forms.appFor.loadApplicableList(componentName,entity,!0)},500)})},loadApplicableList:function(componentName,entity,isFromSearch){Timetracker.forms.appFor.refetchApplicableList(componentName,entity)&&(Timetracker.forms.appFor.updateApplicableList(componentName,entity),Timetracker.forms.appFor.setApplicableListRefetchKey(componentName,entity,!1));let componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]'),applicableListDiv=componentDiv.find("#applicableListDiv");if(!!isFromSearch||Timetracker.forms.appFor.reconstructApplicableList(componentName,entity)){Timetracker.forms.appFor.setApplicableListReconstructionKey(componentName,entity,!1);let searchText,firescrollMode=Timetracker.forms.appFor.getFirescrollMode(componentName,entity);ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),applicableListDiv.empty(),isFromSearch?searchText=componentDiv.find('[name="searchInput"]').val():componentDiv.find('[name="searchInput"]').val(""),Timetracker.forms.appFor.getApplicableRecords(componentName,entity,searchText,0).then(function(dataArray){Timetracker.forms.appFor.populateApplicableList(componentName,entity,dataArray);let firescrollDtls={mode:firescrollMode,componentName:componentName,entity:entity,scrollDiv:applicableListDiv};searchText&&(firescrollDtls.searchText=searchText),ZPeople.FireScroll.init(Timetracker.forms.appFor.loadMoreApplicableRecords,"applicableList",firescrollDtls,!0),ZPeople.FireScroll.setRecordCount(dataArray.length,firescrollMode),dataArray.length===Timetracker.forms.appFor.FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(firescrollMode)})}},populateApplicableList:function(componentName,entity,dataArray,isFromFirescroll){let entityDetails=Timetracker.forms.appFor.getEntityDetails(componentName,entity),componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]'),applicableListDiv=componentDiv.find("#applicableListDiv"),allSelectCheckBoxId="selectAllCheckBox"+entity;if(void 0!==dataArray&&dataArray.length>0){let tempDiv=$("<div></div>"),selectedRecords=Timetracker.forms.appFor.getSelectedRecords(componentName,entity);$.each(dataArray,function(index,data){let record=$(Timetracker.forms.appFor.getHtmlForApplicableRow(componentName,entityDetails,data));record.data("recordDetails",data);let selectedRecordIndex=Timetracker.Util.findJSONArrayIndex(selectedRecords,data.recordId,"recordId");if(-1!==selectedRecordIndex){let selectedRecord=selectedRecords[selectedRecordIndex];record.find('[name="recordSelectorCheckbox"]').prop("checked",!0),(entityDetails.includeHours||entityDetails.includeRate)&&(record.find('[name="hoursAndRateDtls"]').removeClass("DNI"),entityDetails.includeHours&&(selectedRecord.hours?record.find("#hours_"+data.recordId).val(Calendar.minstohrs(selectedRecord.hours)):record.find("#hours_"+data.recordId).val("00:00")),entityDetails.includeRate&&(void 0!==selectedRecord.rate?record.find("#rate_"+data.recordId).val(selectedRecord.rate):"ADD"!==ZP5Form.getFormClassObj().getMode()?record.find("#rate_"+data.recordId).val("-").attr("disabled","disbaled"):record.find("#rate_"+data.recordId).val("0")))}record.find('[name="recordSelector"]').off("click").on("click",function(event){event.stopPropagation(),"recordSelectorCheckbox"===$(event.target).attr("name")&&($(this).find('[name="recordSelectorCheckbox"]').is(":checked")?Timetracker.forms.appFor.selectRecord(componentName,entity,data.recordId):Timetracker.forms.appFor.removeRecord(componentName,entity,data.recordId))}),entityDetails.includeHours&&record.find('[name="hoursInput"]').on("click keyup",function(event){event.stopPropagation(),Timetracker.forms.appFor.updateRecord(componentName,entity,data.recordId,this,!0)}),entityDetails.includeRate&&record.find('[name="rateInput"]').on("click keyup",function(event){event.stopPropagation(),Timetracker.forms.appFor.updateRecord(componentName,entity,data.recordId,this,!0)}),tempDiv.append(record)}),applicableListDiv.append(tempDiv.contents()),applicableListDiv.removeClass("zpl_ddnorcrd"),componentDiv.find('input[name="'+allSelectCheckBoxId+'"]').parent().removeClass("DNI")}else isFromFirescroll||(applicableListDiv.append("<div>"+ZPI18N.getString("zp.norec")+"</div>"),applicableListDiv.addClass("zpl_ddnorcrd"),componentDiv.find('input[name="'+allSelectCheckBoxId+'"]').parent().addClass("DNI"));Timetracker.forms.appFor.isAllRecordSelected(componentName,entity)?(componentDiv.find('input[name="'+allSelectCheckBoxId+'"]').prop("checked",!0),(entityDetails.includeHours||entityDetails.includeRate)&&componentDiv.find('[name="allHoursAndRateDtls"]').removeClass("DNI")):(componentDiv.find('input[name="'+allSelectCheckBoxId+'"]').prop("checked",!1),(entityDetails.includeHours||entityDetails.includeRate)&&componentDiv.find('[name="allHoursAndRateDtls"]').addClass("DNI"))},getHtmlForApplicableRow:function(componentName,entityDetails,data){return'<li id="applicableRecord_'+data.recordId+'" componentName="'+componentName+'" recordId="'+data.recordId+'"><div  name="recordSelector" recordId="'+data.recordId+'"><div class="zcheckbox"><input type="checkbox" name="recordSelectorCheckbox" id ="'+componentName+"_"+data.recordId+'"  recordId="'+data.recordId+'" class="zcheckbox__helper"><label for="'+componentName+"_"+data.recordId+'" class="zcheckbox__label">'+data.name+'</label></div></div><div class="DNI" name="hoursAndRateDtls">'+(entityDetails.includeHours?'<input name="hoursInput" id="hours_'+data.recordId+'" placeholder="'+ZPI18N.getString("zp.hours")+'" class="ztextbox tblinp" type="text">':"")+(entityDetails.includeRate?'<input name="rateInput" id="rate_'+data.recordId+'" placeholder="'+ZPI18N.getString("zp.rate")+'" class="ztextbox tblinp" type="text">':"")+"</div></li>"},getApplicableRecords:async function(componentName,entity,searchText,sIndex){if(void 0==sIndex||null==sIndex)return Promise.resolve(Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity]);let details=Timetracker.forms.appFor.getDetails(componentName),cache=searchText&&""!=searchText?Timetracker.forms.appFor.APPLICABLE_SEARCH_RECORDS[componentName][entity]:Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity],extraDtls={recordNameKey:"name"},applicableRecords=Timetracker.Util.getRecordsFromCache(cache,searchText,sIndex,Timetracker.forms.appFor.FIRESCROLL_LIMIT,extraDtls);if(null==applicableRecords)if(details[entity].fetchRecordsFromServer){sIndex=0!=sIndex?sIndex+1:sIndex;let requestParams={mode:"fetchFormLookupOtions",formId:details.formId,startInd:sIndex,conreqcsr:csrfToken};requestParams.luFcIds=JSON.stringify([details.componentId]),searchText&&""!=searchText&&(requestParams.searchtxt=searchText),Layout.Page.urlparam.recordId&&(requestParams.recordId=Layout.Page.urlparam.recordId);var[response]=await ZPeople.Request.sendRequestAsPromise("/formAction.zp",requestParams);applicableRecords=response&&response.message&&response.message[details.componentId]?Timetracker.forms.appFor.constructDataJson(response.message[details.componentId],"Id","Value"):[],Timetracker.forms.appFor.updateApplicableRecordsCache(componentName,entity,searchText,applicableRecords)}else if(applicableRecords=[],searchText&&""!=searchText){let allApplicableRecords=Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity];allApplicableRecords.length>0&&$.each(allApplicableRecords,function(index,data){-1!==data.name.toLowerCase().indexOf(searchText.toLowerCase())&&applicableRecords.push(data)}),Timetracker.forms.appFor.updateApplicableRecordsCache(componentName,entity,searchText,applicableRecords),applicableRecords=Timetracker.Util.getRecordsFromCache(cache,searchText,sIndex,Timetracker.forms.appFor.FIRESCROLL_LIMIT,extraDtls)}return Promise.resolve(applicableRecords)},updateApplicableRecordsCache:function(componentName,entity,searchText,recordArray,clearCache){if(clearCache&&(Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity]=void 0,Timetracker.forms.appFor.APPLICABLE_SEARCH_RECORDS[componentName][entity]={}),searchText&&""!=searchText){let cache=Timetracker.forms.appFor.APPLICABLE_SEARCH_RECORDS[componentName][entity];void 0==cache?(cache={})[searchText]=recordArray:void 0==cache[searchText]?cache[searchText]=recordArray:cache[searchText]=cache[searchText].concat(recordArray),Timetracker.forms.appFor.APPLICABLE_SEARCH_RECORDS[componentName][entity]=cache}else void 0==Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity]?Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity]=recordArray:Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity]=Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity].concat(recordArray)},loadMoreApplicableRecords:function(firescrollDtls){let firescrollMode=Timetracker.forms.appFor.getFirescrollMode(firescrollDtls.componentName,firescrollDtls.entity),sIndex=ZPeople.FireScroll.getRecordCount(firescrollMode);Timetracker.forms.appFor.getApplicableRecords(firescrollDtls.componentName,firescrollDtls.entity,firescrollDtls.searchText,sIndex).then(function(applicableRecords){ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),applicableRecords.length>0&&(Timetracker.forms.appFor.populateApplicableList(firescrollDtls.componentName,firescrollDtls.entity,applicableRecords,!0),ZPeople.FireScroll.increaseRecordCount(applicableRecords.length,firescrollMode),applicableRecords.length===Timetracker.forms.appFor.FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(firescrollMode))})},initSelectedList:function(componentName,entity,dataArray){Timetracker.forms.appFor.updateSelectedRecordCache(componentName,entity,dataArray,null,!0),Timetracker.forms.appFor.loadSelectedRecords(componentName,entity)},loadSelectedRecords:function(componentName,entity){Timetracker.forms.appFor.updateRelatedFields(componentName,entity);let componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]'),firescrollMode=Timetracker.forms.appFor.getFirescrollMode(componentName,entity,!0);ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),componentDiv.find(".selectedListScrollableDiv").scrollTop(0),componentDiv.find("#selectedListDiv").empty();let selectedRecords=Timetracker.forms.appFor.getSelectedRecords(componentName,entity,0);if(selectedRecords.length>0){Timetracker.forms.appFor.populateSelectedRecords(componentName,entity,selectedRecords);let firescrollDtls={mode:firescrollMode,componentName:componentName,entity:entity,scrollDiv:componentDiv.find(".selectedListScrollableDiv")};ZPeople.FireScroll.init(Timetracker.forms.appFor.selectedRecordsFirescrollCallback,"selectedList",firescrollDtls,!0),ZPeople.FireScroll.setRecordCount(selectedRecords.length,firescrollMode),selectedRecords.length===Timetracker.forms.appFor.FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(firescrollMode)}},populateSelectedRecords:function(componentName,entity,dataArray,isFromFirescroll){let entityDetails=Timetracker.forms.appFor.getEntityDetails(componentName,entity),selectedListDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]').find("#selectedListDiv");void 0!==dataArray&&dataArray.length>0&&$.each(dataArray,function(index,data){let record=$(Timetracker.forms.appFor.getHtmlForSelectedRow(componentName,entity,data));record.find('[name="recordRemover"]').on("click",function(event){event.stopPropagation(),Timetracker.forms.appFor.removeRecord(componentName,entity,data.recordId)}),entityDetails.isEditAllowed&&(entityDetails.includeHours&&record.find('[name="hoursInput"]').on("click keyup",function(event){event.stopPropagation(),Timetracker.forms.appFor.updateRecord(componentName,entity,data.recordId,this,!1)}),entityDetails.includeRate&&record.find('[name="rateInput"]').on("click keyup",function(event){event.stopPropagation(),Timetracker.forms.appFor.updateRecord(componentName,entity,data.recordId,this,!1)})),selectedListDiv.append(record)})},getHtmlForSelectedRow:function(componentName,entity,data){let entityDetails=Timetracker.forms.appFor.getEntityDetails(componentName,entity),html="",rateHtml="",hoursHtml="";if(entity===Timetracker.forms.appFor.ENTITIES.Users){if(entityDetails.includeHours&&(hoursHtml=entityDetails.isEditAllowed?'<td id="jobHrs"><input type="text" name="hoursInput" class="ztextbox w80" value="'+(void 0!==data.hours?Calendar.minstohrs(data.hours):"00:00")+'"><em>'+ZPI18N.getString("zp.smallhrs")+"</em></td>":'<td id="jobHrs">'+(void 0!==data.hours?Calendar.minstohrs(data.hours):"00:00")+"<em>"+ZPI18N.getString("zp.smallhrs")+"</em></td>"),entityDetails.includeRate){let disbaleRph="ADD"!==ZP5Form.getFormClassObj().getMode()&&void 0===data.rate,rate=void 0!==data.rate?data.rate:disbaleRph?"":"0";rateHtml=disbaleRph?'<td id="jobRte"><div class="w100">-</div></td>':entityDetails.isEditAllowed?'<td id="jobRte"><div class="w100"><div class="ztextbox--group ztextbox--zicon zpl_inpticfild"><span class="ztextbox__icon">'+ZPI18N.getString("zp.rateperhourinshort")+'</span><input  type="text"  name="rateInput" class="ztextbox w100" value="'+rate+'"></div></div></td>':'<td id="jobRte"><div class="w100">'+rate+"<em>"+ZPI18N.getString("zp.rateperhourinshort")+"</em></div></td>"}html='<tr componentName="'+componentName+'" id="selectedRecord_'+data.recordId+'" recordId="'+data.recordId+'"><td><span>'+data.name+"</span></td>"+hoursHtml+rateHtml+(entityDetails.isEditAllowed?'<td><i class="PI_delete" name="recordRemover" title="'+ZPI18N.getString("zp.remove")+'" recordId="'+data.recordId+'"></i></td>':"")+"</tr>"}else html=entityDetails.isEditAllowed?'<li componentName="'+componentName+'" id="selectedRecord_'+data.recordId+'" recordId="'+data.recordId+'">'+data.name+'<a name="recordRemover" tabindex="-1"></a></li>':'<li componentName="'+componentName+'" id="selectedRecord_'+data.recordId+'" recordId="'+data.recordId+'">'+data.name+"</li>";return html},showHideSelectedList:function(componentName,entity){var componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]');ZP5Form.getFormClassObj().isViewMode()&&0==Timetracker.forms.appFor.getSelectedRecords(componentName,entity).length||0!==componentDiv.length&&(componentDiv.find("#showHideBtn").hasClass("opn")?(componentDiv.find("#showHideBtn").find("button").addClass("DN"),componentDiv.find("#selectedList").css("display","none"),componentDiv.find("#showHideBtn").removeClass("opn")):(componentDiv.find("#showHideBtn").find("button").removeClass("DN"),componentDiv.find("#showHideBtn").addClass("opn"),entity===Timetracker.forms.appFor.ENTITIES.Users?componentDiv.find("#selectedList").css("display","flex"):componentDiv.find("#selectedList").css("display","block")))},getSelectedRecords:function(componentName,entity,sIndex,limit){limit=limit||Timetracker.forms.appFor.FIRESCROLL_LIMIT;let selectedRecords=Timetracker.Util.getRecordsFromCache(Timetracker.forms.appFor.SELECTED_RECORDS[componentName][entity],null,sIndex,limit);return null==selectedRecords&&(selectedRecords=[]),selectedRecords},updateSelectedRecordCache:function(componentName,entity,recordArray,recordObj,clearCache){clearCache&&(Timetracker.forms.appFor.SELECTED_RECORDS[componentName][entity]=[],Timetracker.forms.appFor.EXTRA_DTLS[componentName][entity]={});let entityDetails=Timetracker.forms.appFor.getEntityDetails(componentName,entity),extraDtls=Timetracker.forms.appFor.getExtraDtls(componentName,entity),totalHours=extraDtls.totalHours?extraDtls.totalHours:0,selectedRecords=Timetracker.forms.appFor.getSelectedRecords(componentName,entity);if(selectedRecords=selectedRecords||[],void 0!==recordObj&&null!=recordObj){let updateHours=void 0!==recordObj.hours&&null!==recordObj.hours,recordIndex=Timetracker.Util.findJSONArrayIndex(selectedRecords,recordObj.recordId,"recordId");-1===recordIndex?(selectedRecords.push(recordObj),updateHours&&(totalHours+=recordObj.hours)):(updateHours&&selectedRecords[recordIndex].hours&&(totalHours-=selectedRecords[recordIndex].hours),recordObj.recordRemoved?selectedRecords.splice(recordIndex,1):(updateHours&&(selectedRecords[recordIndex].hours=recordObj.hours,totalHours+=recordObj.hours),void 0!==recordObj.rate&&null!==recordObj.rate&&(selectedRecords[recordIndex].rate=recordObj.rate)))}else if(selectedRecords=recordArray||[],totalHours=0,entityDetails.includeHours)for(let i in selectedRecords)selectedRecords[i].hours&&(totalHours+=selectedRecords[i].hours);Timetracker.forms.appFor.SELECTED_RECORDS[componentName][entity]=selectedRecords,entityDetails.includeHours&&Timetracker.forms.appFor.updateExtraDtls(componentName,entity,{totalHours:totalHours})},isRecordSelected:function(componentName,entity,recordId){let selectedRecords=Timetracker.forms.appFor.getSelectedRecords(componentName,entity);return-1!==Timetracker.Util.findJSONArrayIndex(selectedRecords,recordId,"recordId")},isAllRecordSelected:function(componentName,entity,ignoreSearchText){let selectedRecords=Timetracker.forms.appFor.SELECTED_RECORDS[componentName][entity];if(!selectedRecords||0==selectedRecords.length)return!1;let applicableRecords=Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity],componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]'),searchText=ignoreSearchText?"":componentDiv.find('[name="searchInput"]').val();if(searchText&&""!==searchText){let isAllSelected=!0;if((applicableRecords=(applicableRecords=Timetracker.forms.appFor.APPLICABLE_SEARCH_RECORDS[componentName][entity])[searchText])&&applicableRecords.length>0)for(var index in applicableRecords){if(-1===Timetracker.Util.findJSONArrayIndex(selectedRecords,applicableRecords[index].recordId,"recordId")){isAllSelected=!1;break}}else isAllSelected=!1;return isAllSelected}return applicableRecords&&applicableRecords.length<=selectedRecords.length},selectedRecordsFirescrollCallback:function(firescrollDtls){let firescrollMode=Timetracker.forms.appFor.getFirescrollMode(firescrollDtls.componentName,firescrollDtls.entity,!0),sIndex=ZPeople.FireScroll.getRecordCount(firescrollMode);Timetracker.forms.appFor.loadMoreSelectedRecords(firescrollDtls.componentName,firescrollDtls.entity,firescrollMode,sIndex,Timetracker.forms.appFor.FIRESCROLL_LIMIT)},loadMoreSelectedRecords:function(componentName,entity,firescrollMode,sIndex,limit){let selectedRecords=Timetracker.forms.appFor.getSelectedRecords(componentName,entity,sIndex,limit);ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),selectedRecords.length>0&&(Timetracker.forms.appFor.populateSelectedRecords(componentName,entity,selectedRecords,!0),ZPeople.FireScroll.increaseRecordCount(selectedRecords.length,firescrollMode),selectedRecords.length===limit&&ZPeople.FireScroll.reset(firescrollMode))},selectRecord:function(componentName,entity,recordId){let entityDetails=Timetracker.forms.appFor.getEntityDetails(componentName,entity),currentRecordDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]').find("#applicableRecord_"+recordId),currentRecordDetails=currentRecordDiv.data("recordDetails");if(entityDetails.includeHours||entityDetails.includeRate){if(currentRecordDiv.find('[name="hoursAndRateDtls"]').removeClass("DNI"),entityDetails.includeHours){let hours=currentRecordDiv.find("#hours_"+recordId).val();""!==hours&&Timetracker.Validations.isDecimal(hours)||(hours="0"),currentRecordDetails.hours=Timetracker.DateTime.convertToMins(hours)}if(entityDetails.includeRate){let rate=currentRecordDiv.find("#rate_"+recordId).val();""!==rate&&Timetracker.Validations.isDecimal(rate)||(rate="0"),currentRecordDiv.find("#rate_"+recordId).is(":disabled")||(currentRecordDetails.rate=rate)}}Timetracker.forms.appFor.updateSelectedRecordCache(componentName,entity,null,currentRecordDetails);let firescrollMode=Timetracker.forms.appFor.getFirescrollMode(componentName,entity,!0);ZPeople.FireScroll.getFireScrollPropertie(firescrollMode).triggered&&Timetracker.forms.appFor.populateSelectedRecords(componentName,entity,[currentRecordDetails]),Timetracker.forms.appFor.updateRelatedFields(componentName,entity,{recordId:recordId})},removeRecord:function(componentName,entity,recordId){let entityDetails=Timetracker.forms.appFor.getEntityDetails(componentName,entity),singleRecordUpdateDtls={recordId:recordId,recordRemoved:!0};Timetracker.forms.appFor.updateSelectedRecordCache(componentName,entity,null,singleRecordUpdateDtls);let componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]'),applicableListDiv=componentDiv.find("#applicableListDiv");if(applicableListDiv.length>0){let removedRecordDiv=applicableListDiv.find('[componentName="'+componentName+'"][id="applicableRecord_'+recordId+'"]');removedRecordDiv.find('[name="recordSelectorCheckbox"]').prop("checked",!1),removedRecordDiv.find('[name="hoursInput"]').val(""),removedRecordDiv.find('[name="rateInput"]').val(""),(entityDetails.includeHours||entityDetails.includeRate)&&removedRecordDiv.find('[name="hoursAndRateDtls"]').addClass("DNI")}let selectedListDiv=componentDiv.find("#selectedListDiv");if(selectedListDiv.length>0){let removedRecordDiv=selectedListDiv.find('[componentName="'+componentName+'"][id="selectedRecord_'+recordId+'"]');if(removedRecordDiv.length>0){let firescrollMode=Timetracker.forms.appFor.getFirescrollMode(componentName,entity,!0);ZPeople.FireScroll.getFireScrollPropertie(firescrollMode).triggered?removedRecordDiv.remove():(ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),removedRecordDiv.remove(),ZPeople.FireScroll.increaseRecordCount(-1,firescrollMode),Timetracker.forms.appFor.loadMoreSelectedRecords(componentName,entity,firescrollMode,ZPeople.FireScroll.getRecordCount(firescrollMode),1))}}Timetracker.forms.appFor.updateRelatedFields(componentName,entity,singleRecordUpdateDtls)},updateRecord:function(componentName,entity,recordId,currentObj,isFromApplicableList){let entityDetails=Timetracker.forms.appFor.getEntityDetails(componentName,entity),attr=$(currentObj).attr("name"),value=$(currentObj).val();entityDetails.includeHours&&"hoursInput"===attr?value=void 0!==value&&""!==value.trim()&&null!=value.match(Timetracker.util.maxWeekHrsRegex)?value:"00:00":entityDetails.includeRate&&"rateInput"===attr&&(value=void 0!==value&&""!==value.trim()&&Timetracker.Validations.isDecimal(value)?value:"0");let record,componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]');(record=isFromApplicableList?componentDiv.find("#selectedListDiv").find("#selectedRecord_"+recordId):componentDiv.find("#applicableListDiv").find("#applicableRecord_"+recordId)).length>0&&record.find('[name="'+attr+'"]').val(value);let singleRecordUpdateDtls={recordId:recordId};entityDetails.includeHours&&"hoursInput"===attr?singleRecordUpdateDtls.hours=Timetracker.DateTime.convertToMins(value):entityDetails.includeRate&&"rateInput"===attr&&(singleRecordUpdateDtls.rate=value),Timetracker.forms.appFor.updateSelectedRecordCache(componentName,entity,null,singleRecordUpdateDtls),Timetracker.forms.appFor.updateRelatedFields(componentName,entity,singleRecordUpdateDtls)},selectOrRemoveAllRecords:function(currentObj,event,componentName,entity,removeEverything){event.stopPropagation();let componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]'),searchText=componentDiv.find('[name="searchInput"]').val(),allCheckBoxId="selectAllCheckBox"+entity,allCheckBoxChecked=componentDiv.find('input[name="'+allCheckBoxId+'"]').is(":checked");if(removeEverything||allCheckBoxChecked||(removeEverything=!searchText||""===searchText),removeEverything)return Timetracker.forms.appFor.initSelectedList(componentName,entity,[]),Timetracker.forms.appFor.setApplicableListReconstructionKey(componentName,entity,!0),void Timetracker.forms.appFor.loadApplicableList(componentName,entity);let applicableListDiv=componentDiv.find("#applicableListDiv");if(applicableListDiv.length>0){if(applicableListDiv.find('[id*="applicableRecord_"]').length>0){let selectedRecords=Timetracker.forms.appFor.SELECTED_RECORDS[componentName][entity],applicableRecords=Timetracker.forms.appFor.APPLICABLE_RECORDS[componentName][entity];if(searchText&&""!==searchText&&(applicableRecords=(applicableRecords=Timetracker.forms.appFor.APPLICABLE_SEARCH_RECORDS[componentName][entity])[searchText]),applicableRecords&&applicableRecords.length>0)if(allCheckBoxChecked){let selectedRecordJson={};$.each(selectedRecords,function(index,data){selectedRecordJson[data.recordId]=!0}),$.each(applicableRecords,function(index,data){selectedRecordJson[data.recordId]||(selectedRecords.push(data),selectedRecordJson[data.recordId]=!0)})}else $.each(applicableRecords,function(index,data){let selectedRecordIndex=Timetracker.Util.findJSONArrayIndex(selectedRecords,data.recordId,"recordId");-1!==selectedRecordIndex&&selectedRecords.splice(selectedRecordIndex,1)});Timetracker.forms.appFor.initSelectedList(componentName,entity,selectedRecords),Timetracker.forms.appFor.setApplicableListReconstructionKey(componentName,entity,!0),Timetracker.forms.appFor.loadApplicableList(componentName,entity,searchText&&""!==searchText)}}},updateAllRecords:function(componentName,entity,currentObj){let componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]'),applicableListDiv=componentDiv.find("#applicableListDiv");if(applicableListDiv.length>0){if(applicableListDiv.find('[id*="applicableRecord_"]').length>0){let attr=$(currentObj).attr("name"),value=$(currentObj).val();"allHoursInput"===attr?value=void 0!==value&&""!==value.trim()&&null!=value.match(Timetracker.util.maxWeekHrsRegex)?value:"00:00":"allRateInput"===attr&&(value=void 0!==value&&""!==value.trim()&&Timetracker.Validations.isDecimal(value)?value:"0");let searchApplicableRecordsJson={},searchText=componentDiv.find('[name="searchInput"]').val();if(searchText&&""!==searchText){let searchApplicableRecords=Timetracker.forms.appFor.APPLICABLE_SEARCH_RECORDS[componentName][entity];(searchApplicableRecords=searchApplicableRecords[searchText])&&searchApplicableRecords.length>0&&$.each(searchApplicableRecords,function(index,data){searchApplicableRecordsJson[data.recordId]=!0})}let selectedRecords=Timetracker.forms.appFor.SELECTED_RECORDS[componentName][entity];selectedRecords.length>0&&$.each(selectedRecords,function(index,data){let skipUpdate=!1;searchText&&""!==searchText&&(skipUpdate=!searchApplicableRecordsJson[data.recordId]),skipUpdate||("allHoursInput"===attr?selectedRecords[index].hours=Timetracker.DateTime.convertToMins(value):selectedRecords[index].rate=value)}),Timetracker.forms.appFor.initSelectedList(componentName,entity,selectedRecords),Timetracker.forms.appFor.setApplicableListReconstructionKey(componentName,entity,!0),Timetracker.forms.appFor.loadApplicableList(componentName,entity,searchText&&""!==searchText)}}},updateRelatedFields:function(componentName,entity,json){let details=Timetracker.forms.appFor.getDetails(componentName),entityDetails=details?details[entity]:void 0,componentDiv=Timetracker.forms.getLayout().find('[componentName="'+componentName+'"][entity="'+entity+'"]');if(entityDetails){let allSelectCheckBoxId="selectAllCheckBox"+entity;Timetracker.forms.appFor.isAllRecordSelected(componentName,entity)?(componentDiv.find('input[name="'+allSelectCheckBoxId+'"]').prop("checked",!0),(entityDetails.includeHours||entityDetails.includeRate)&&componentDiv.find('[name="allHoursAndRateDtls"]').removeClass("DNI")):(componentDiv.find('input[name="'+allSelectCheckBoxId+'"]').prop("checked",!1),(entityDetails.includeHours||entityDetails.includeRate)&&(entityDetails.includeHours&&componentDiv.find('[name="allHoursAndRateDtls"]').find('[name="allHoursInput"]').val(""),entityDetails.includeRate&&componentDiv.find('[name="allHoursAndRateDtls"]').find('[name="allRateInput"]').val(""),componentDiv.find('[name="allHoursAndRateDtls"]').addClass("DNI")));let selectedRecordCount=Timetracker.forms.appFor.getSelectedRecords(componentName,entity).length;if(componentDiv.find('[name="recordCount"]').text(selectedRecordCount),ZP5Form.getFormClassObj().isViewMode()?0==selectedRecordCount&&(componentDiv.addClass("zpl_DNI"),componentDiv.parent().children().length===componentDiv.parent().find(".zpl_DNI").length&&componentDiv.parent().append('<span id="noassignees">-</span>')):(ZP5Form.getFormClassObj().isAddMode()||ZP5Form.getFormClassObj().isEditMode())&&(0==selectedRecordCount||componentDiv.parent().attr("isListExpanded")||(componentDiv.find("#showHideBtn").trigger("click"),componentDiv.parent().attr("isListExpanded",!0))),componentName===Timetracker.forms.appFor.COMPONENTS.Assignees&&entityDetails.includeHours){let extraDtls=Timetracker.forms.appFor.getExtraDtls(componentName,entity),totalHoursInDisplayFormat=extraDtls.totalHours?Calendar.minstohrs(extraDtls.totalHours):"00:00";Timetracker.forms.getLayout().find("div[folabel=Hours]").find("input").val(totalHoursInDisplayFormat),entityDetails.bottomBarNeeded&&componentDiv.find("#bottomBarValue").text(totalHoursInDisplayFormat+" "+ZPI18N.getString("zp.hrs"))}}if(json&&entity===Timetracker.forms.appFor.ENTITIES.Users&&(componentName===Timetracker.forms.appFor.COMPONENTS.ProjectHead||componentName===Timetracker.forms.appFor.COMPONENTS.ProjectManager))if(componentName===Timetracker.forms.appFor.COMPONENTS.ProjectHead){let projectHead=Timetracker.forms.getLayout().find("div[folabel="+Timetracker.forms.appFor.COMPONENTS.ProjectHead+"]").find("input").val();projectHead&&"-select-"!==projectHead.toLowerCase()&&(Timetracker.forms.appFor.isRecordSelected(Timetracker.forms.appFor.COMPONENTS.ProjectManager,entity,projectHead)&&Timetracker.forms.appFor.removeRecord(Timetracker.forms.appFor.COMPONENTS.ProjectManager,entity,projectHead),Timetracker.forms.appFor.isRecordSelected(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,entity,projectHead)&&Timetracker.forms.appFor.removeRecord(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,entity,projectHead)),Timetracker.forms.appFor.setApplicableListRefetchKey(Timetracker.forms.appFor.COMPONENTS.ProjectManager,entity,!0),Timetracker.forms.appFor.setApplicableListRefetchKey(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,entity,!0)}else componentName===Timetracker.forms.appFor.COMPONENTS.ProjectManager&&(json.recordId&&!json.recordRemoved&&Timetracker.forms.appFor.isRecordSelected(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,entity,json.recordId)&&Timetracker.forms.appFor.removeRecord(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,entity,json.recordId),Timetracker.forms.appFor.setApplicableListRefetchKey(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,entity,!0))},getDefaultApplicableOptions:function(componentName,entity,mode){let options=[];if(entity===Timetracker.forms.appFor.ENTITIES.Users){let ZForm=Timetracker.forms.getFormReferance(),elementId=Timetracker.forms.getLayout().find("div[folabel="+componentName+"]").attr("id"),fcId=elementId?elementId.split("zp_field_outer_")[1]:"",fieldDtl=ZForm.Field.getFieldComponent(fcId);if(fieldDtl){let isEdit="EDIT"==mode,userOptions="ADD"==mode&&fieldDtl.AddOptions?fieldDtl.AddOptions:isEdit&&fieldDtl.EditOptions?fieldDtl.EditOptions:options;userOptions&&$.each(userOptions,function(index,option){let newOption={};newOption.name=option.Value,newOption.recordId=option.Id,options.push(newOption)})}}else if((entity===Timetracker.forms.appFor.ENTITIES.Depts||entity===Timetracker.forms.appFor.ENTITIES.Locs||entity===Timetracker.forms.appFor.ENTITIES.Divs)&&Timetracker.isDataAdminForAllUsers()){let params={};Timetracker.Department.dept_List.load&&(params.deptfetch=!0),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&Timetracker.Location.loc_List.load&&(params.locfetch=!0),isOrgStructureEnabled&&Timetracker.Division.divisionList.refresh&&(params.fetchDivisions=!0),Object.keys(params).length>0&&(params.mode="getDeptAndLocList",params.conreqcsr=csrfToken,Timetracker.util.getCommonData(params,Timetracker.Filters.setCacheForFilterValues)),entity===Timetracker.forms.appFor.ENTITIES.Depts?options=Timetracker.forms.appFor.constructDataJson(Timetracker.Department.dept_List,"dept_ID","dept_Name"):entity===Timetracker.forms.appFor.ENTITIES.Locs&&Timetracker.generalSettings.isJobProLocApplicableEnabled()?options=Timetracker.forms.appFor.constructDataJson(Timetracker.Location.loc_List,"locationId","locationName"):entity===Timetracker.forms.appFor.ENTITIES.Divs&&isOrgStructureEnabled&&(options=Timetracker.forms.appFor.constructDataJson(Timetracker.Division.divisionList,"DivisionID","Name"))}return options},updateApplicableList:function(componentName,entity){if(componentName===Timetracker.forms.appFor.COMPONENTS.ProjectManager||componentName===Timetracker.forms.appFor.COMPONENTS.ProjectUsers){let applicableRecords=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.ProjectUsers,Timetracker.forms.appFor.ENTITIES.Users,ZP5Form.getFormClassObj().getMode()),projectHead=Timetracker.forms.getLayout().find("div[folabel="+Timetracker.forms.appFor.COMPONENTS.ProjectHead+"]").find("input").val();if(projectHead&&"-select-"!==projectHead.toLowerCase()){let headIndex=Timetracker.Util.findJSONArrayIndex(applicableRecords,projectHead,"recordId");-1!==headIndex&&applicableRecords.splice(headIndex,1)}if(componentName===Timetracker.forms.appFor.COMPONENTS.ProjectUsers){let selectedManagers=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.ProjectManager,Timetracker.forms.appFor.ENTITIES.Users);if(applicableRecords.length>0&&selectedManagers.length>0){let managerMap={};$.each(selectedManagers,function(index,data){managerMap[data.recordId]=!0}),applicableRecords=$.grep(applicableRecords,function(data,index){return!managerMap[data.recordId]})}}Timetracker.forms.appFor.updateApplicableRecordsCache(componentName,entity,null,applicableRecords,!0)}},updateAssigneesAccordingToProject:function(obj,skipUpdatingSelectedRecords){let formObj=ZP5Form.getCurrFormsOperation(),layout=Timetracker.forms.getLayout().find("#zp_form_outer_container"),updateApplicableList=!0,applicableAssignees=[],applicableDepts=[],applicableLocs=[],applicableDivs=[],currentProjectId=ZPeopleComponents.select(obj).getValue();if("-Select-"===currentProjectId)applicableAssignees=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users,ZP5Form.getFormClassObj().getMode()),Timetracker.isDataAdminForAllUsers()&&(applicableDepts=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&(applicableLocs=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs)),isOrgStructureEnabled&&(applicableDivs=Timetracker.forms.appFor.getDefaultApplicableOptions(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs)));else{let assigneeOptions,isAddMode=ZP5Form.getFormClassObj().isAddMode(),isEditMode=ZP5Form.getFormClassObj().isEditMode(),assigneesElementId=layout.find("div[folabel=Assignees]").attr("id"),assigneesFCId=assigneesElementId?assigneesElementId.split("zp_field_outer_")[1]:"",assigneesFieldDtl=ZP5Form.Field.getFieldComponent(assigneesFCId);if(assigneesFieldDtl&&(assigneeOptions=isAddMode&&assigneesFieldDtl.AddOptions?assigneesFieldDtl.AddOptions:isEditMode&&assigneesFieldDtl.EditOptions?assigneesFieldDtl.EditOptions:assigneeOptions),applicableAssignees=Timetracker.projects.Forms.projectBasedUsersList(currentProjectId,isEditMode?formObj.getEditPerm():formObj.getAddPerm(),assigneeOptions,formObj.formId),Timetracker.isDataAdminForAllUsers()&&(applicableDepts=Timetracker.projects.Forms.projectBasedDeptsList(currentProjectId),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&(applicableLocs=Timetracker.projects.Forms.projectBasedLocationsList(currentProjectId)),isOrgStructureEnabled&&(applicableDivs=Timetracker.projects.Forms.projectBasedDivisionsList(currentProjectId))),!(updateApplicableList=0!==applicableAssignees.length||0!==applicableDepts.length||0!==applicableLocs.length||0!==applicableDivs.length)){Timetracker.util.showAlert(1,ZPI18N.getString("zp.cannotaddjobtoanonuserproject",[Timetracker.util.jobDispName,Timetracker.util.projectDispName]));let existingProjectId=$(obj).data("projectId");return existingProjectId=void 0!=existingProjectId&&currentProjectId!==existingProjectId?existingProjectId:"-Select-",void ZPeopleComponents.select(obj).setValue(existingProjectId)}}if(Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users,applicableAssignees),Timetracker.isDataAdminForAllUsers()&&(Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts,applicableDepts),Timetracker.generalSettings.isJobProLocApplicableEnabled()&&Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs,applicableLocs),isOrgStructureEnabled&&Timetracker.forms.appFor.initApplicableList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs,applicableDivs)),updateApplicableList&&!skipUpdatingSelectedRecords){let selectedRecords=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users),newlySelectedRecords=[],k=0;if(0!==applicableAssignees.length)for(let i in selectedRecords)for(let j in applicableAssignees)if(selectedRecords[i].recordId===applicableAssignees[j].recordId){newlySelectedRecords[k++]=selectedRecords[i];break}if(Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Users,newlySelectedRecords),Timetracker.isDataAdminForAllUsers()){if(selectedRecords=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts),newlySelectedRecords=[],k=0,0!==applicableDepts.length)for(let i in selectedRecords)for(let j in applicableDepts)if(selectedRecords[i].recordId===applicableDepts[j].recordId){newlySelectedRecords[k++]=selectedRecords[i];break}if(Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Depts,newlySelectedRecords),Timetracker.generalSettings.isJobProLocApplicableEnabled()){if(selectedRecords=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs),newlySelectedRecords=[],k=0,0!==applicableLocs.length)for(let i in selectedRecords)for(let j in applicableLocs)if(selectedRecords[i].recordId===applicableLocs[j].recordId){newlySelectedRecords[k++]=selectedRecords[i];break}Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Locs,newlySelectedRecords)}if(isOrgStructureEnabled){if(selectedRecords=Timetracker.forms.appFor.getSelectedRecords(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs),newlySelectedRecords=[],k=0,0!==applicableDivs.length)for(let i in selectedRecords)for(let j in applicableDivs)if(selectedRecords[i].recordId===applicableDivs[j].recordId){newlySelectedRecords[k++]=selectedRecords[i];break}Timetracker.forms.appFor.initSelectedList(Timetracker.forms.appFor.COMPONENTS.Assignees,Timetracker.forms.appFor.ENTITIES.Divs,newlySelectedRecords)}}}}}},Timetracker.CRM={integDtls:null,leads:"1",accounts:"2",contacts:"3",deals:"4",allLeadsList:null,allAccountsList:null,allContactsList:null,allDealsList:null,presentLeadsSearchResults:null,presentAccountsSearchResults:null,presentContactsSearchResults:null,presentDealsSearchResults:null,selectedClients:null,clientFromCRM:!1,isBulkImport:!1,init:function(){Timetracker.CRM.clientFromCRM=!1;var layout=Layout.Page.container,formId="";Timetracker.CRM.isBulkImport?layout=settingsPage.container.find("#zp_modal_crmpopup"):(layout=settingsPage.container,formId=ZP5Form.CURR_FORM_OPERATION.formId),layout.find("#CRM_search").val(""),layout.find("#CRM_search").on("keyup",function(event){if(!event.shiftKey){var type;if(Timetracker.CRM.isBulkImport){var typeSelect=layout.find("#CRM_select");type=TimetrackerOperations.Filters.getSelectFilterValues(typeSelect)}else type=Timetracker.CRM.getCRMtype(layout.find("#CRM_dropdown").find("li.zpl_act").attr("id"));var searchStr=layout.find("#CRM_search").val();Timetracker.CRM.isBulkImport?(Timetracker.CRM.Pagination.init(),Timetracker.CRM.Pagination.setDefaultIndices()):Timetracker.CRM.FireScroll.init(type,searchStr),Timetracker.CRM.searchAndDisplayCRMClients(type,searchStr)}}),layout.find("#chooseCRMdropdown").off().on("click",function(event){layout.find("#singlecalendar").hide()}),layout.find("#zp_addedit_record_"+formId).off("click").on("click",function(event){if(0!==$(event.target).parents("#singlecalendar").length)layout.find("#chooseCRMdropdown").addClass("open"),event.stopPropagation();else if(0===$(event.target).parents("#chooseCRMdropdown").length){var addCrmPopup=layout.find("#addCRMContact");0!=addCrmPopup.length&&(0!=addCrmPopup.find("#crm_deal_cdate").length&&ZPeopleComponents.isComponent(addCrmPopup.find("#crm_deal_cdate"))&&TimelyZComp.dateField.destroy(addCrmPopup.find("#crm_deal_cdate")),0!=addCrmPopup.find("#crm_deal_stage").length&&ZPeopleComponents.isComponent(addCrmPopup.find("#crm_deal_stage"))&&TimelyZComp.select.destroy(addCrmPopup.find("#crm_deal_stage"))),layout.find("#addCRMContact").hide(),layout.find("#CRM_dropdown").hide(),layout.find("#chooseCRMdropdown").removeClass("open"),Timetracker.CRM.hideAddPopup()}})},getIntegDetails:async function(isPortalNeeded){if(isPortalNeeded=void 0!=isPortalNeeded&&isPortalNeeded,!Timetracker.CRM.integDtls||isPortalNeeded&&!Timetracker.CRM.integDtls.portalData){var[response]=await ZPeople.Request.sendRequestAsPromise(Timetracker.constants.URL,{mode:"getZCRMIntegDetails",includeProtalDetails:isPortalNeeded});response&&response.res&&"0"!==response.res&&(Timetracker.CRM.integDtls=response.resObj)}},viewIntegDetails:async function(){await Timetracker.CRM.getIntegDetails(!0),Timetracker.CRM.integDtls?Timetracker.CRM.integDtls.portalData||Timetracker.CRM.integDtls.isActive?Timetracker.CRM.constructZCRMConfigureModal(Timetracker.CRM.integDtls):Timetracker.util.showAlert(0,ZPI18N.getString("zp.zcrm.nocrmaccount")):(Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttpermdenied")),window.location.hash="#admin/integration/zohoservices")},constructZCRMConfigureModal:function(integDtls){var modalParams={},bodyHtml="";if(integDtls.isActive){var html="",portalDtlsHtml="",userDtlsHtml="";if("1"===integDtls.type){if(integDtls.portalName?portalDtlsHtml+="<tr><td>"+ZPI18N.getString("zp.companyname")+"</td><td>:</td><td>"+integDtls.portalName+"</td></tr>":portalDtlsHtml="<tr><td>"+ZPI18N.getString("zp.companyname")+'</td><td>: &nbsp;</td><td><div class="ztextbox--error__label">'+ZPI18N.getString("zp.zcrm.companynotexists")+"</div></td></tr>",integDtls.empDetails){var empDetails=integDtls.empDetails;userDtlsHtml+="<tr><td>"+ZPI18N.getString("zp.account")+'</td><td>:</td><td><div class="zpl_em"><div class="zpl_emimg"><img src="'+(empDetails.employeePhoto?empDetails.employeePhoto:ZPeople.getDefaultUserImagePath())+'"></div><div class="zpl_emdts"><div><em>'+(empDetails.employeeId?empDetails.employeeId+" - ":"-")+"</em><b>"+(empDetails.employeeDisplayName?empDetails.employeeDisplayName:"")+"</b></div><span"+(empDetails.mailId?'title="'+empDetails.mailId+'"':"")+">"+(empDetails.mailId?empDetails.mailId:"")+"</span></div></div></td></tr></tbody></table>"}else userDtlsHtml+="<tr><td>"+ZPI18N.getString("zp.account")+'</td><td>:</td><td><div class="ZPusrName red PL0I">'+ZPI18N.getString("zp.zcrm.usernotexists")+"</div></td></tr>";html+='<div class="zpl_secn"><table><tbody>'+portalDtlsHtml+userDtlsHtml+"</tbody></table></div>",html+='<div class="zpl_secn"><p>'+ZPI18N.getString("zp.zcrm.integinfo1")+"</p></div>"}bodyHtml='<div id="zcrm_config_body" class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div class="prtl_enbld"><h5 class="prtl_hd"> '+ZPI18N.getString("zp.zohocrm")+'</h5><div class="prtl_logo zpl_intelst cstm_intlst"><div class=""></div></div><div class="prtl_cont">'+html+'<div class="btn_cntr"><button id="disableBtn" onclick="Timetracker.CRM.disableZCRMInteg();" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.disable")+"</button></div></div></div></div></div></div>"}else{modalParams.validate=Timetracker.CRM.enableZCRMInteg;var portalData=integDtls.portalData,orgId=integDtls.orgId,portalHtml="";if(void 0!=portalData&&0!=portalData.length)for(var i=0;i<portalData.length;i++){portalHtml+='<div class="prtl '+(portalData[i].orgId==orgId?"active":"")+'" onclick="Timetracker.CRM.changeCRMOption(this);" orgId="'+portalData[i].orgId+'"><h5>'+(portalData[i].portalName?portalData[i].portalName:ZPI18N.getString("zp.zcrm.noaccountfound"))+"</h5></div>"}else portalHtml+='<div class="ztextbox--error__label" id="zCRMnoData">'+ZPI18N.getString("zp.zcrm.noorgsavailable")+"</div>";bodyHtml='<div id="zcrm_config_body" class="zpl_crd"><div class="zpl_crdhdr"><div class="zpl_intelst cstm_intlst"><div class=""></div><span><h4>'+ZPI18N.getString("zp.zohocrm")+"</h4><p>"+ZPI18N.getString("zp.zcrm.integdescription")+'</p></span></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><h5><em>'+ZPI18N.getString("zp.zcrm.choosecrmaccount")+'</em></h5><div id="zCRMConfigOptions" class="prtl_lst">'+portalHtml+"</div></div></div></div>"}modalParams.id="zcrmconfigSlider",modalParams.cardId="zcrmconfigSliderCard",modalParams.callback=function(){settingsPage.container.find("#"+modalParams.cardId).html(bodyHtml)};var zCrmModalObj=new sliderModal(ZPI18N.getString("zp.zohocrm")+" "+ZPI18N.getString("zp.integration"),modalParams);zCrmModalObj.cntExtraCls="intgrtion_con",zCrmModalObj.save=ZPI18N.getString("zp.enable");let sliderDiv=$(settingsPage.container).find("#zcrmconfigSlider");sliderDiv&&sliderDiv.length>0&&sliderDiv.remove(),zCrmModalObj.construct();var modal=settingsPage.container.find("#"+modalParams.id);Timetracker.Integration.Util.ZOneUIhandling(modal,modalParams.cardId),modal.off("hide.bs.modal").on("hide.bs.modal",function(){window.location.hash="#admin/integration/zohoservices"}),integDtls.isActive?(settingsPage.container.find("#"+modalParams.id).find(".zpl_mfoter").addClass("zpl_DNI"),modal.find('[data-toggle="popover"]').popover()):(settingsPage.container.find("#"+modalParams.id).find(".zpl_mfoter").removeClass("zpl_DNI"),0==modal.find("#zCRMConfigOptions").find(".active").length&&modal.find("#zCRMConfigOptions").find("div").first().addClass("active"),0!=modal.find("#zCRMConfigOptions").find("#zCRMnoData").length?modal.find("#sliderSbt").addClass("disabled"):modal.find("#sliderSbt").removeClass("disabled"))},changeCRMOption:function(obj){$(obj).closest("#zCRMConfigOptions").find(".active").removeClass("active"),$(obj).addClass("active")},enableZCRMInteg:function(obj){var layout=Timetracker.Util.isVersionFive()&&obj?$(obj.sliderDiv):Layout.Page.container;Timetracker.util.freezeSubmit(...Timetracker.Util.isVersionFive()?["zcrmconfigSlider","sliderSbt"]:["zcrm_config_modal","zp_modal_blubtn"],layout);var params={mode:"enableZCRMInteg",type:1};params.orgId=parseInt(layout.find("#zCRMConfigOptions").find(".active").attr("orgId")),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(Timetracker.util.unfreezeSubmit(...Timetracker.Util.isVersionFive()?["zcrmconfigSlider","sliderSbt"]:["zcrm_config_modal","zp_modal_blubtn"],layout),response.res&&"0"!==response.res)Timetracker.util.showAlert(2,ZPI18N.getString("zp.prjctsync.integenabled")),Timetracker.CRM.integDtls=response.resObj,Timetracker.CRM.clearCache(),Timetracker.CRM.constructZCRMConfigureModal(Timetracker.CRM.integDtls),$("[name='ZohoCRM']#config_btn").text(ZPI18N.getString("zp.viewdetails"));else{var errorMsg=Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg)}})},disableZCRMInteg:function(){Timetracker.util.freezeSubmit(...Timetracker.Util.isVersionFive()?["zcrmconfigSlider","sliderSbt"]:["zcrm_config_modal","zp_modal_blubtn"]),ZPeople.Request.send(Timetracker.constants.URL,{mode:"disableZCRMInteg"},function(response){if(Timetracker.util.unfreezeSubmit(...Timetracker.Util.isVersionFive()?["zcrmconfigSlider","sliderSbt"]:["zcrm_config_modal","zp_modal_blubtn"]),response.res&&"0"!==response.res)Timetracker.util.showAlert(2,ZPI18N.getString("zp.prjctsync.integdisabled")),Timetracker.CRM.integDtls=response.resObj,Timetracker.CRM.clearCache(),Timetracker.CRM.constructZCRMConfigureModal(Timetracker.CRM.integDtls),$("[name='ZohoCRM']#config_btn").text(ZPI18N.getString("zp.configure"));else{var errorMsg=Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg)}})},constructCRMPopup:function(isImport){if(Timetracker.CRM.integDtls.isActive){var modal;if(1==isImport){var body='<div class="ZPImslct"><select id="CRM_select"><option value="CRM Lead">'+ZPI18N.getString("zp.zcrm.lead")+'</option><option value="CRM Account">'+ZPI18N.getString("zp.zcrm.account")+'</option><option value="CRM Contact">'+ZPI18N.getString("zp.zcrm.contact")+'</option><option value="CRM Deal">'+ZPI18N.getString("zp.zcrm.deal")+"</option></select>";body+='<div id="CRM_dropdown" class="dropdown-menu ZPCusPd ZPappBox ZptxtBox"><div class="ZPTabVt"><div class="rhttabscrl"><div class="tab-content"><div class="tab-pane active" role="tabpanel"><div><div class="ZPtopSearch"><label class="checkbox DIB FL PT8 MR10"><input type="checkbox" id="selectall_CRMClient" onclick="Timetracker.CRM.selectAllCRMContacts();"><span></span></label><div class="ZPsearch" id="ZPsearch"><div class="dvsearch Dropdown PR"><span class="ZPico-search FL MT2 ML8 ZPtooltip IC-lens S16" zptitle="Search Category"></span></div><input type="search" class="ZPselect" id="CRM_search" placeholder="'+ZPI18N.getString("zp.search")+'" name="Search"></div></div><div id="CRM_tab" class="tab-pane active" role="tabpanel"><div id="CRM_clients" class="ZPapplCb" scroll="enabled"><ul id="CRM_list"></ul></div></div></div></div></div></div>'+'</div></div><div class="ZPwf FL MT20"><label class="checkbox DIB"><input type="checkbox" id="zcrm_exeute_workflow"><span>'+ZPI18N.getString("zp.executeeworkflow")+"</span></label></div>",Timetracker.CRM.isBulkImport=!0,modal=ZPeople.BSModal.get({id:"zp_modal_crmpopup",type:3,header:ZPI18N.getString("zp.zcrm.importfromcrm"),body:body,iconClass:"IC-imprt",isConfirm:!0,successCallback:Timetracker.CRM.importSelectedCRMContacts}),Layout.Page.container.find("#zp_modal_crmpopup").removeClass("DelMdl"),modal.find(".ZPImslct").addClass("dropdown open"),modal.find("#CRM_select").select2().on("change",function(){Layout.Page.container.find("#zp_modal_crmpopup").find("#selectall_CRMClient").prop("checked",!1);var type=Timetracker.CRM.getCRMtype(Layout.Page.container.find("#CRM_select").val());Timetracker.CRM.FireScroll.init(type),Timetracker.CRM.constructCRMClients(type)})}else if(Timetracker.CRM.isBulkImport=!1,0===Layout.Page.container.find("#chooseCRMdropdown").find("#CRM_dropdown").length){var txt='<div id="CRM_dropdown" class="dropdown-menu ZPcrmdd ZPCusPd ZPappBox ZPSchPoP ZPCmn-Arrow top gray" style="display:none"><div class="ZPTabVt"><div class="lfttab"><ul role="tablist" class="nav nav-pills nav-stacked"><li id="CRM Lead" class="active"><a data-toggle="tab" role="tab" href="#CRM_tab" aria-expanded="false">'+ZPI18N.getString("zp.zcrm.lead")+'</a></li><li id="CRM Account"><a data-toggle="tab" role="tab" href="#CRM_tab" aria-expanded="false">'+ZPI18N.getString("zp.zcrm.account")+'</a></li><li id="CRM Contact"><a data-toggle="tab" role="tab" href="#CRM_tab" aria-expanded="false">'+ZPI18N.getString("zp.zcrm.contact")+'</a></li><li id="CRM Deal"><a data-toggle="tab" role="tab" href="#CRM_tab" aria-expanded="true">'+ZPI18N.getString("zp.zcrm.deal")+'</a></li></ul></div><div class="rhttabscrl OHI"><div class="tab-content"><div id="addCRMContact" class="ZPaddTab form-horizontal" aria-expanded="false" style="display:none"></div><div class="ZPtopSearch"><div class="ZPsearch pull-left" id="ZPsearch"><div class="dvsearch Dropdown PR"><span class="ZPico-search FL MT2 ML8 ZPtooltip IC-lens S16" zptitle="Search Category"></span></div><input type="search" class="ZPselect" id="CRM_search" placeholder="'+ZPI18N.getString("zp.search")+'"></div>'+(Timetracker.CRM.integDtls.isAddAllowedForThisUser?'<a id="addToZCrm" class="btn btn-default btn-sm pull-right MT5" data-toggle="collapse" role="tab" onclick="Timetracker.CRM.addCRMClients();">'+ZPI18N.getString("zp.add")+"</a>":"")+'<div class="clearfix"></div></div><div id="CRM_tab" class="tab-pane active" role="tabpanel"><div id="CRM_clients" class="ZPapplCb" scroll="enabled"><ul id="CRM_list"></ul></div></div></div></div></div></div>';Layout.Page.container.find("#chooseCRMdropdown").append(txt),Layout.Page.container.find("#CRM_dropdown").find(".nav-pills>li>a").on("click",function(){Layout.Page.container.find("#addCRMContact").collapse("hide");var type=Timetracker.CRM.getCRMtype($(this).parent().attr("id"));Timetracker.CRM.FireScroll.init(type),Timetracker.CRM.constructCRMClients(type)})}Timetracker.CRM.init();var type=1==isImport?Timetracker.CRM.getCRMtype(Layout.Page.container.find("#CRM_select").val()):Timetracker.CRM.getCRMtype(Layout.Page.container.find("#CRM_dropdown").find("li.active").attr("id"));Timetracker.CRM.FireScroll.init(type),Timetracker.CRM.constructCRMClients(type)}},getLastIndex:function(type,searchTxt){let isBulkImport=Timetracker.CRM.isBulkImport,popup=isBulkImport?Layout.Page.container.find("#zp_modal_crmpopup"):Layout.Page.container.find("#CRM_dropdown");if(type&&0!=popup.length){let pageData=isBulkImport?popup.find(".zpl_list_btm").data()[type]:popup.data()[type];return searchTxt?pageData.searchLastIndex:pageData.LastIndex}},setLastIndex:function(type,sIndex,searchTxt){let pageData=Timetracker.CRM.isBulkImport?Layout.Page.container.find("#zp_modal_crmpopup .zpl_list_btm").data()[type]:Layout.Page.container.find("#CRM_dropdown").data()[type];sIndex&&type&&(searchTxt?pageData.searchLastIndex=sIndex:pageData.LastIndex=sIndex)},Pagination:{recLimit:200,init:function(){let layout=Layout.Page.container;layout.find(".ZPapplCb").scrollTop(0),layout.find("#zp_modal_crmpopup .zpl_list_btm").addClass("zpl_DNI"),layout.find("#CRM_list").off("scroll").html(""),Timetracker.util.appendLoading("CRM_list",{type:"popup",containerId:"zp_modal_crmpopup"})},setDefaultIndices:function(){let layout=Layout.Page.container,data={1:{sIndex:1,end:0},2:{sIndex:1,end:0},3:{sIndex:1,end:0},4:{sIndex:1,end:0}};if(Timetracker.CRM.isBulkImport){let popup=layout.find("#zp_modal_crmpopup");0!=popup.find("#viewPagination").length&&popup.find("#viewPagination").data(data)}},start:"start",end:"end",hasPrevEnabled:!0,hasNextEnabled:!0,prevNextBtnHandlers:function(){let pop=Layout.Page.container.find("#zp_modal_crmpopup");pop.find("#viewPagination").find("#nextPage,#previousPage").off().on("click",function(event){let type=TimetrackerOperations.Filters.getSelectFilterValues(pop.find("#CRM_select")),searchTxt=pop.find("#CRM_search").val(),isNext="nextPage"===event.target.id,sIndex=pop.find("#viewPagination").data()[type].sIndex,isAllowed=isNext&&Timetracker.CRM.Pagination.hasNextEnabled&&sIndex<pop.find("#viewPagination").data()[type].end;if(isAllowed=isAllowed||!isNext&&Timetracker.CRM.Pagination.hasPrevEnabled&&1!=sIndex){let val=Timetracker.CRM.Pagination.recLimit;Timetracker.CRM.Pagination.setIndex(type,val,Timetracker.CRM.Pagination.start,isNext),Timetracker.CRM.Pagination.init(),Timetracker.CRM.selectedClients={},Timetracker.util.removeErrorMsg("CRM_select",Layout.Page.container),searchTxt?Timetracker.CRM.searchAndDisplayCRMClients(type,searchTxt):Timetracker.CRM.constructCRMClients(type)}})},setIndex:function(type,val,indexType,forNext){let popup=Layout.Page.container.find("#zp_modal_crmpopup");if(type&&0!=popup.length){let page=popup.find("#viewPagination");indexType==Timetracker.CRM.Pagination.start?(!forNext&&(val*=-1),page.data()[type].sIndex+=val):indexType==Timetracker.CRM.Pagination.end&&(page.data()[type].end=val)}},setPaginationText:function(type,respLen,isLastRec){let pop=Layout.Page.container.find("#zp_modal_crmpopup"),sIndex=pop.find("#viewPagination").data()[type].sIndex,val=sIndex+respLen-1;Timetracker.CRM.Pagination.setIndex(type,val,Timetracker.CRM.Pagination.end);let end=pop.find("#viewPagination").data()[type].end,html="<b>"+sIndex+"&nbsp;-&nbsp; "+end+"</b>";pop.find("#viewPagination").find("#viewPageCount").html(html),pop.find("#viewPagination").find("#viewPageCount").attr("aria-label",ZPI18N.getString("zp.recountforpage",[sIndex,end])),!0===isLastRec?(pop.find("#viewPagination").find("#nextPage").removeClass("blu CP").addClass("gry"),Timetracker.CRM.Pagination.hasNextEnabled=!1):(pop.find("#viewPagination").find("#nextPage").removeClass("gry").addClass("blu CP"),Timetracker.CRM.Pagination.hasNextEnabled=!0),1!=sIndex?(pop.find("#viewPagination").find("#previousPage").removeClass("gry").addClass("blu CP"),Timetracker.CRM.Pagination.hasPrevEnabled=!0):(pop.find("#viewPagination").find("#previousPage").removeClass("blu CP").addClass("gry"),Timetracker.CRM.Pagination.hasPrevEnabled=!1),pop.find(".zpl_list_btm").removeClass("zpl_DNI")},getSearchData:function(type,searchTxt){let typeData,sIndex=Layout.Page.container.find("#zp_modal_crmpopup #viewPagination").data()[type].sIndex;switch(type){case Timetracker.CRM.leads:typeData=Timetracker.CRM.presentLeadsSearchResults;break;case Timetracker.CRM.accounts:typeData=Timetracker.CRM.presentAccountsSearchResults;break;case Timetracker.CRM.contacts:typeData=Timetracker.CRM.presentContactsSearchResults;break;case Timetracker.CRM.deals:typeData=Timetracker.CRM.presentDealsSearchResults}return searchTxt&&typeData&&Object.keys(typeData)[0]===searchTxt&&sIndex-1<typeData[searchTxt].length?(sIndex-=1,typeData[searchTxt].slice(sIndex,sIndex+Timetracker.CRM.Pagination.recLimit)):null},getPaginatedData:function(type,sIndex){let typeData;switch(sIndex-=1,type){case Timetracker.CRM.leads:typeData=Timetracker.CRM.allLeadsList;break;case Timetracker.CRM.accounts:typeData=Timetracker.CRM.allAccountsList;break;case Timetracker.CRM.contacts:typeData=Timetracker.CRM.allContactsList;break;case Timetracker.CRM.deals:typeData=Timetracker.CRM.allDealsList}if(typeData&&typeData.length>sIndex)return typeData.slice(sIndex,sIndex+Timetracker.CRM.Pagination.recLimit)},validateAndConstructCRMClients:function(sIndex,cacheData,type,searchStr){let limit=Timetracker.CRM.Pagination.recLimit,lastIndex=Timetracker.CRM.getLastIndex(type,searchStr),isLastPage=void 0!==lastIndex&&lastIndex<=sIndex+limit,searchData=Timetracker.CRM.Pagination.getSearchData(type,searchStr);isLastPage=isLastPage||searchData.length<limit,Timetracker.CRM.constructCRMResults(searchData,type,searchStr,isLastPage)}},constructCRMPopup_OP:function(isFromproject){if(Timetracker.CRM.integDtls.isActive)if(!0!==isFromproject){Timetracker.CRM.isBulkImport=!0;var modal=settingsPage.container.find("#zp_modal_crmpopup");if(Timetracker.CRM.selectedClients={},0!=modal.length){Timetracker.util.removeErrorMsg(null,modal),modal.find("#selectall_CRMClient, #zcrm_exeute_workflow").prop("checked",!1),modal.find("#CRM_search").val("");var typeSelect=modal.find("#CRM_select"),type=TimetrackerOperations.Filters.getSelectFilterValues(typeSelect);return Timetracker.CRM.Pagination.init(),Timetracker.CRM.Pagination.setDefaultIndices(),Timetracker.CRM.constructCRMClients(type),Timetracker.util.unfreezeSubmit("zp_modal_crmpopup","zp_modal_blubtn",modal),void ModuleComp.Modal.show(modal)}var body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><select class="select-js" id="CRM_select"><option value="1">'+ZPI18N.getString("zp.zcrm.lead")+'</option><option value="2">'+ZPI18N.getString("zp.zcrm.account")+'</option><option value="3">'+ZPI18N.getString("zp.zcrm.contact")+'</option><option value="4">'+ZPI18N.getString("zp.zcrm.deal")+'</option></select></div><div><div class="zpl_tbvrt zpl_tbpnepagntn"><div class="zpl_rgtlst"><div class="zpl_tbpne zpl_act"><div class="zpl_popsrch"><div class="zcheckbox"><input type="checkbox" name="check" class="zcheckbox__helper" id="selectall_CRMClient" onclick="Timetracker.CRM.selectAllCRMContacts();"><label class="zcheckbox__label" for="selectall_CRMClient"></label></div><div class="zpl_search zpl_srchsml"><input placeholder="'+ZPI18N.getString("zp.search")+'" class="ztextbox" id="CRM_search"><i class="PI_lens"></i></div></div><ul class="zpl_lstgrp" id="CRM_list"></ul><div class="zpl_list_btm"> <div class="pagecount" id="viewPagination"><a class="zpl_prev gry" id="previousPage" aria-label="'+ZPI18N.getString("zp.previouspage")+'" role="button"></a><span id="viewPageCount" tabindex="0" aria-label="'+ZPI18N.getString("zp.recountforpage",[1,Timetracker.CRM.Pagination.recLimit])+'" ><b>1&nbsp;-&nbsp; '+Timetracker.CRM.Pagination.recLimit+'</b></span> <a class="zpl_nxt blu CP" id="nextPage" aria-label="'+ZPI18N.getString("zp.nextpage")+'" role="button" tabindex="0"></a></div></div></div></div></div></div><div><div class="zcheckbox"><input type="checkbox" name="check" class="zcheckbox__helper" id="zcrm_exeute_workflow"><label class="zcheckbox__label" for="zcrm_exeute_workflow">'+ZPI18N.getString("zp.executeeworkflow")+"</label></div></div></div></div></div>";(modal=ModuleComp.Modal.setup({id:"zp_modal_crmpopup",type:3,header:ZPI18N.getString("zp.zcrm.importfromcrm"),body:body,backdrop:!0,closeOnSubmit:!1,buttonValue:ZPI18N.getString("zp.import"),hiddenCallback:Timetracker.CRM.hiddenCallback,successCallback:Timetracker.CRM.importSelectedCRMContacts,LayerId:settingsPage.container[0].id,closeonEsc:!0})).find(".zpl_list_btm").data({1:{},2:{},3:{},4:{}});typeSelect=modal.find("#CRM_select");ZPeopleComponents.select(typeSelect),typeSelect.off().on("zselectchange",function(){modal.find("#selectall_CRMClient,#zcrm_exeute_workflow").prop("checked",!1),modal.find("#CRM_search").val(""),Timetracker.CRM.selectedClients={},Timetracker.util.removeErrorMsg(void 0,modal,!0);var type=TimetrackerOperations.Filters.getSelectFilterValues(typeSelect);Timetracker.CRM.Pagination.setDefaultIndices(),Timetracker.CRM.Pagination.init(),Timetracker.CRM.Pagination.prevNextBtnHandlers(),Timetracker.CRM.constructCRMClients(type)}),type=TimetrackerOperations.Filters.getSelectFilterValues(typeSelect),Timetracker.CRM.Pagination.setDefaultIndices(),Timetracker.CRM.init(),Timetracker.CRM.Pagination.prevNextBtnHandlers(),Timetracker.CRM.Pagination.init(),Timetracker.CRM.constructCRMClients(type)}else{Timetracker.CRM.isBulkImport=!1;var crmLayout=settingsPage.container;if(0===crmLayout.find("#chooseCRMdropdown").find("#CRM_dropdown").length){var txt='<div class="zpl_popovr" rel="tbpop" style="z-index: 999; right : 0;" id="CRM_dropdown"><div class="zpl_tbvrt"><ul class="zpl_lftnav"><li class="zpl_act" id="CRM Lead">'+ZPI18N.getString("zp.zcrm.lead")+'</li><li id="CRM Account">'+ZPI18N.getString("zp.zcrm.account")+'</li><li id="CRM Contact">'+ZPI18N.getString("zp.zcrm.contact")+'</li><li id="CRM Deal">'+ZPI18N.getString("zp.zcrm.deal")+'</li></ul><div class="zpl_rgtlst w400"><div id="addCRMContact" class="zpl_tbpne zpl_act" aria-expanded="false" style="display:none"></div><div class="zpl_tbpne zpl_act" id="showCRMContact"><div class="zpl_popsrch"><div class="zpl_search zpl_srchsml" id="ZPsearch"><input placeholder="'+ZPI18N.getString("zp.search")+'" type="text" class="ztextbox" id="CRM_search"><i class="PI_lens"></i></div>'+(Timetracker.CRM.integDtls.isAddAllowedForThisUser?'<a id="addToZCrm" class="zlabel zlabel--outline zlabel--medium" role="tab" onclick="Timetracker.CRM.addCRMClients();">'+ZPI18N.getString("zp.add")+"</a>":"")+'</div><ul class="zpl_lstgrp" id="CRM_list"></ul></div></div></div></div>';crmLayout.find("#chooseCRMdropdown").append(txt),crmLayout.find("#chooseCRMdropdown #CRM_dropdown").data({1:{},2:{},3:{},4:{}}),crmLayout.find("#CRM_dropdown").find(".zpl_lftnav>li").on("click",function(){crmLayout.find("#addCRMContact").hide(),crmLayout.find("#CRM_dropdown").find(".zpl_lftnav>li").removeClass("zpl_act"),$(this).addClass("zpl_act"),crmLayout.find("#CRM_search").val(""),Timetracker.CRM.hideAddPopup();var type=Timetracker.CRM.getCRMtype($(this).attr("id"));Timetracker.CRM.FireScroll.init(type),Timetracker.CRM.constructCRMClients(type)})}type=Timetracker.CRM.getCRMtype(crmLayout.find("#CRM_dropdown").find("li.zpl_act").attr("id")),Timetracker.CRM.init(),Timetracker.CRM.FireScroll.init(type),Timetracker.CRM.constructCRMClients(type)}},constructCRMResults:function(dataJson,type,searchStr,isLastPage){var layout;-1!==Layout.Page.hash.indexOf("/clients/listview")?(layout=Timetracker.Util.getLayout().find("#zp_modal_crmpopup")).find("#zp_modal_crmpopup").modal("show"):(layout=Timetracker.Util.getLayout().find("#chooseCRMdropdown")).find("#CRM_dropdown").show(),layout.find("#CRM_list").removeClass("zpl_ddnorcrd"),layout.find("#CRM_list").find("#noClientFoundMsg").remove(),layout.find("#selectall_CRMClient").prop("checked",!1).attr("disabled",!1),layout.find("#zcrm_exeute_workflow").attr("disabled",!1);var txt="";if(Timetracker.util.removeLoading(layout),Timetracker.CRM.isBulkImport)var sIndex=layout.find("#viewPagination").data()[type].sIndex;if(0===dataJson.length){if(Timetracker.CRM.isBulkImport&&1!=sIndex){Timetracker.CRM.setLastIndex(type,sIndex,searchStr),Timetracker.CRM.Pagination.setIndex(type,Timetracker.CRM.Pagination.recLimit,Timetracker.CRM.Pagination.start,!1),Timetracker.util.showAlert(1,ZPI18N.getString("zp.noappviewrecfound",["more"]));let data=searchStr?Timetracker.CRM.Pagination.getSearchData(type,searchStr):Timetracker.CRM.Pagination.getPaginatedData(type,layout.find("#viewPagination").data()[type].sIndex);isLastPage=!0,Timetracker.CRM.constructCRMResults(data,type,searchStr,isLastPage)}var typeName="";type===Timetracker.CRM.leads?typeName=ZPI18N.getString("zp.zcrm.leads"):type===Timetracker.CRM.accounts?typeName=ZPI18N.getString("zp.zcrm.accounts"):type===Timetracker.CRM.contacts?typeName=ZPI18N.getString("zp.zcrm.contacts"):type===Timetracker.CRM.deals&&(typeName=ZPI18N.getString("zp.zcrm.deals")),txt='<div id="noClientFoundMsg" ><span>'+ZPI18N.getString("zp.zcrm.nocrmfound",[typeName])+"</span></div>",0===layout.find("#CRM_list").find("li").length&&(layout.find("#CRM_list").html(txt),layout.find("#CRM_list").addClass("zpl_ddnorcrd"),layout.find("#selectall_CRMClient,#zcrm_exeute_workflow").attr("disabled",!0),layout.find(".zpl_list_btm").addClass("zpl_DNI"))}else{Timetracker.CRM.isBulkImport&&isLastPage&&void 0===Timetracker.CRM.getLastIndex(type,searchStr)&&Timetracker.CRM.setLastIndex(type,sIndex+Timetracker.CRM.Pagination.recLimit,searchStr);for(var clientDtls,tempJson,clientEle,id="",name="",crmList=layout.find("#CRM_list"),k=0;k<dataJson.length;k++)tempJson=dataJson[k],txt="",clientDtls={},type===Timetracker.CRM.leads?(name=tempJson.leadname,Timetracker.CRM.isBulkImport?(id=tempJson.leadId,txt+='<li><div><div class="zcheckbox"><input type="checkbox" id="'+tempJson.leadId+'" class="zcheckbox__helper"><label class="zcheckbox__label" for="'+tempJson.leadId+'">'+name+"</label></div></div></li>",clientDtls={crmName:ZPeople.decodeTxt(name),crmId:id,currency:tempJson.currency}):(id="lead"+tempJson.leadId,txt+='<li class="zpl_cp" id="lead'+tempJson.leadId+"\" onclick=\"Timetracker.CRM.setCRMValueinTextBox('lead','"+tempJson.leadId+"','"+tempJson.currency+'\');"><span val="'+name+'">'+name+"</span></li>")):type===Timetracker.CRM.accounts?(name=tempJson.accountname,Timetracker.CRM.isBulkImport?(id=tempJson.accountId,txt+='<li><div><div class="zcheckbox"><input type="checkbox" id="'+tempJson.accountId+'" class="zcheckbox__helper"><label class="zcheckbox__label" for="'+id+'">'+name+"</label></div></div></li>",clientDtls={crmName:ZPeople.decodeTxt(name),crmId:id,currency:tempJson.currency}):(id="account"+tempJson.accountId,txt+='<li class="zpl_cp" id="account'+tempJson.accountId+"\" onclick=\"Timetracker.CRM.setCRMValueinTextBox('account','"+tempJson.accountId+"','"+tempJson.currency+'\');"><span val="'+name+'">'+name+"</span></li>")):type===Timetracker.CRM.contacts?(name=tempJson.contactname,Timetracker.CRM.isBulkImport?(txt+='<li><div><div class="zcheckbox"><input type="checkbox" id="'+(id=tempJson.contactId)+'" class="zcheckbox__helper"><label class="zcheckbox__label" for="'+id+'">'+name+"</label></div></div></li>",clientDtls={crmName:ZPeople.decodeTxt(name),crmId:id,currency:tempJson.currency}):(id="contact"+tempJson.contactId,txt+='<li class="zpl_cp" id="contact'+tempJson.contactId+"\" onclick=\"Timetracker.CRM.setCRMValueinTextBox('contact','"+tempJson.contactId+"','"+tempJson.currency+'\');"><span val="'+name+'">'+name+"</span></li>")):type===Timetracker.CRM.deals&&(name=tempJson.dealname,Timetracker.CRM.isBulkImport?(txt+='<li><div><div class="zcheckbox"><input type="checkbox" id="'+(id=tempJson.dealId)+'" class="zcheckbox__helper"><label class="zcheckbox__label" for="'+id+'">'+name+"</label></div></div></li>",clientDtls={crmName:ZPeople.decodeTxt(name),crmId:id,currency:tempJson.currency}):(id="deal"+tempJson.dealId,txt+='<li class="zpl_cp" id="deal'+tempJson.dealId+"\" onclick=\"Timetracker.CRM.setCRMValueinTextBox('deal','"+tempJson.dealId+"','"+tempJson.currency+'\');"><span val="'+name+'">'+name+"</span></li>")),clientEle=$(txt),Timetracker.CRM.isBulkImport&&clientEle.find("#"+id).prop("checked",Timetracker.CRM.selectedClients.hasOwnProperty(id)).data("clientDtls",clientDtls).on("click",function(){Timetracker.CRM.selectUnselectClient(this,layout)}),crmList.append(clientEle);if(Timetracker.CRM.checkIfAllClientsSelected(layout),Timetracker.CRM.isBulkImport)Timetracker.CRM.Pagination.setPaginationText(type,dataJson.length,isLastPage);else{var params=Timetracker.CRM.getDefaultParams(type,searchStr),firescrollMode=Timetracker.CRM.FireScroll.getFireScrollMode(type,searchStr);0===Timetracker.FireScroll.getFetchCount(firescrollMode)&&(Timetracker.FireScroll.initFireScroll(firescrollMode,Timetracker.constants.URL,params,Timetracker.CRM.FireScroll.constructCRMClientsOnFirescroll,"CRM_list",{scrollDiv:layout.find("#CRM_list")}),Timetracker.FireScroll.setMaxFetchCount(firescrollMode,Timetracker.CRM.FireScroll.maxLimit)),Timetracker.FireScroll.setFetchCount(firescrollMode,dataJson);let lastIndex=Timetracker.CRM.getLastIndex(type,searchStr);dataJson.length>Timetracker.CRM.FireScroll.maxLimit&&(dataJson.length%Timetracker.CRM.FireScroll.maxLimit!=0||lastIndex&&lastIndex>dataJson.length)&&(Timetracker.FireScroll.resetFirescrollDtls(firescrollMode),ZPeople.FireScroll.setParam("triggered",!0,firescrollMode))}}},hiddenCallback:function(){Timetracker.CRM.selectedClients=null,Timetracker.CRM.destroyZComp()},destroyZComp:function(){var modal=settingsPage.container.find("#zp_modal_crmpopup");ZPeopleComponents.select(modal.find("#CRM_select")).destroy()},searchAndDisplayCRMClients:function(type,searchStr){let isBulkImport=Timetracker.CRM.isBulkImport;if(isBulkImport)var sIndex=settingsPage.container.find("#zp_modal_crmpopup #viewPagination").data()[type].sIndex;if(Timetracker.CRM.selectedClients={},""===searchStr.trim())return isBulkImport&&Timetracker.CRM.Pagination.setIndex(type,sIndex-1,Timetracker.CRM.Pagination.start,!1),Timetracker.CRM.constructCRMClients(type),!1;if(type===Timetracker.CRM.leads&&null!==Timetracker.CRM.presentLeadsSearchResults&&void 0!==Timetracker.CRM.presentLeadsSearchResults[searchStr]){if(!isBulkImport)return Timetracker.CRM.constructCRMResults(Timetracker.CRM.presentLeadsSearchResults[searchStr],type,searchStr),!1;if(sIndex-1<Timetracker.CRM.presentLeadsSearchResults[searchStr].length)return void Timetracker.CRM.Pagination.validateAndConstructCRMClients(sIndex,Timetracker.CRM.presentLeadsSearchResults[searchStr],type,searchStr)}else if(type===Timetracker.CRM.accounts&&null!==Timetracker.CRM.presentAccountsSearchResults&&void 0!==Timetracker.CRM.presentAccountsSearchResults[searchStr]){if(!isBulkImport)return Timetracker.CRM.constructCRMResults(Timetracker.CRM.presentAccountsSearchResults[searchStr],type,searchStr),!1;if(sIndex-1<Timetracker.CRM.presentAccountsSearchResults[searchStr].length)return void Timetracker.CRM.Pagination.validateAndConstructCRMClients(sIndex,Timetracker.CRM.presentAccountsSearchResults[searchStr],type,searchStr)}else if(type===Timetracker.CRM.contacts&&null!==Timetracker.CRM.presentContactsSearchResults&&void 0!==Timetracker.CRM.presentContactsSearchResults[searchStr]){if(!isBulkImport)return Timetracker.CRM.constructCRMResults(Timetracker.CRM.presentContactsSearchResults[searchStr],type,searchStr),!1;if(sIndex-1<Timetracker.CRM.presentContactsSearchResults[searchStr].length)return void Timetracker.CRM.Pagination.validateAndConstructCRMClients(sIndex,Timetracker.CRM.presentContactsSearchResults[searchStr],type,searchStr)}else if(type===Timetracker.CRM.deals&&null!==Timetracker.CRM.presentDealsSearchResults&&void 0!==Timetracker.CRM.presentDealsSearchResults[searchStr]){if(!isBulkImport)return Timetracker.CRM.constructCRMResults(Timetracker.CRM.presentDealsSearchResults[searchStr],type,searchStr),!1;if(sIndex-1<Timetracker.CRM.presentDealsSearchResults[searchStr].length)return void Timetracker.CRM.Pagination.validateAndConstructCRMClients(sIndex,Timetracker.CRM.presentDealsSearchResults[searchStr],type,searchStr)}if(searchStr){let layout=Layout.Page.container;isBulkImport?delete layout.find("#zp_modal_crmpopup .zpl_list_btm").data()[type].searchLastIndex:delete layout.find("#CRM_dropdown").data()[type].searchLastIndex}Timetracker.CRM.fetchCRMClients(type,searchStr)},constructCRMClients:function(type){let isBulkImport=Timetracker.CRM.isBulkImport,SIndex=isBulkImport?settingsPage.container.find("#zp_modal_crmpopup #viewPagination").data()[type].sIndex:1,limit=isBulkImport?Timetracker.CRM.Pagination.recLimit:Timetracker.CRM.FireScroll.maxLimit,lastIndex=Timetracker.CRM.getLastIndex(type);if(type===Timetracker.CRM.leads&&null!==Timetracker.CRM.allLeadsList&&Timetracker.CRM.allLeadsList.length>SIndex-1)if(isBulkImport){let paginatedData=Timetracker.CRM.Pagination.getPaginatedData(type,SIndex),isLastPage=paginatedData.length<limit||void 0!==lastIndex&&lastIndex<=SIndex+limit;Timetracker.CRM.constructCRMResults(paginatedData,type,void 0,isLastPage)}else Timetracker.CRM.constructCRMResults(Timetracker.CRM.allLeadsList,type);else if(type===Timetracker.CRM.accounts&&null!==Timetracker.CRM.allAccountsList&&Timetracker.CRM.allAccountsList.length>SIndex-1)if(isBulkImport){let paginatedData=Timetracker.CRM.Pagination.getPaginatedData(type,SIndex),isLastPage=paginatedData.length<limit||void 0!==lastIndex&&lastIndex<=SIndex+limit;Timetracker.CRM.constructCRMResults(paginatedData,type,void 0,isLastPage)}else Timetracker.CRM.constructCRMResults(Timetracker.CRM.allAccountsList,type);else if(type===Timetracker.CRM.contacts&&null!==Timetracker.CRM.allContactsList&&Timetracker.CRM.allContactsList.length>SIndex-1)if(isBulkImport){let paginatedData=Timetracker.CRM.Pagination.getPaginatedData(type,SIndex),isLastPage=paginatedData.length<limit||void 0!==lastIndex&&lastIndex<=SIndex+limit;Timetracker.CRM.constructCRMResults(paginatedData,type,void 0,isLastPage)}else Timetracker.CRM.constructCRMResults(Timetracker.CRM.allContactsList,type);else if(type===Timetracker.CRM.deals&&null!==Timetracker.CRM.allDealsList&&Timetracker.CRM.allDealsList.length>SIndex-1)if(isBulkImport){let paginatedData=Timetracker.CRM.Pagination.getPaginatedData(type,SIndex),isLastPage=paginatedData.length<limit||void 0!==lastIndex&&lastIndex<=SIndex+limit;Timetracker.CRM.constructCRMResults(paginatedData,type,void 0,isLastPage)}else Timetracker.CRM.constructCRMResults(Timetracker.CRM.allDealsList,type);else Timetracker.CRM.fetchCRMClients(type)},getDefaultParams:function(type,searchStr){var params={type:type,conreqcsr:csrfToken,mode:"fetchCRMContacts"};return params.sIndex=Timetracker.CRM.isBulkImport?settingsPage.container.find("#zp_modal_crmpopup #viewPagination").data()[type].sIndex:1,params.limit=Timetracker.CRM.isBulkImport?Timetracker.CRM.Pagination.recLimit:Timetracker.CRM.FireScroll.maxLimit,void 0!==searchStr&&(params.searchStr=searchStr),params},updateCache:function(data,type,searchStr){type===Timetracker.CRM.leads?searchStr?(Timetracker.CRM.presentLeadsSearchResults=Timetracker.CRM.presentLeadsSearchResults?Timetracker.CRM.presentLeadsSearchResults:{},Timetracker.CRM.presentLeadsSearchResults[searchStr]=Timetracker.CRM.presentLeadsSearchResults[searchStr]?Timetracker.CRM.presentLeadsSearchResults[searchStr].concat(data):data):Timetracker.CRM.allLeadsList=Timetracker.CRM.allLeadsList?Timetracker.CRM.allLeadsList.concat(data):data:type===Timetracker.CRM.accounts?searchStr?(Timetracker.CRM.presentAccountsSearchResults=Timetracker.CRM.presentAccountsSearchResults?Timetracker.CRM.presentAccountsSearchResults:{},Timetracker.CRM.presentAccountsSearchResults[searchStr]=Timetracker.CRM.presentAccountsSearchResults[searchStr]?Timetracker.CRM.presentAccountsSearchResults[searchStr].concat(data):data):Timetracker.CRM.allAccountsList=Timetracker.CRM.allAccountsList?Timetracker.CRM.allAccountsList.concat(data):data:type===Timetracker.CRM.contacts?searchStr?(Timetracker.CRM.presentContactsSearchResults=Timetracker.CRM.presentContactsSearchResults?Timetracker.CRM.presentContactsSearchResults:{},Timetracker.CRM.presentContactsSearchResults[searchStr]=Timetracker.CRM.presentContactsSearchResults[searchStr]?Timetracker.CRM.presentContactsSearchResults[searchStr].concat(data):data):Timetracker.CRM.allContactsList=Timetracker.CRM.allContactsList?Timetracker.CRM.allContactsList.concat(data):data:type===Timetracker.CRM.deals&&(searchStr?(Timetracker.CRM.presentDealsSearchResults=Timetracker.CRM.presentDealsSearchResults?Timetracker.CRM.presentDealsSearchResults:{},Timetracker.CRM.presentDealsSearchResults[searchStr]=Timetracker.CRM.presentDealsSearchResults[searchStr]?Timetracker.CRM.presentDealsSearchResults[searchStr].concat(data):data):Timetracker.CRM.allDealsList=Timetracker.CRM.allDealsList?Timetracker.CRM.allDealsList.concat(data):data)},clearCache:function(type,isSearch){if(type)switch(type){case Timetracker.CRM.leads:isSearch?Timetracker.CRM.presentLeadsSearchResults=null:Timetracker.CRM.allLeadsList=null;break;case Timetracker.CRM.accounts:isSearch?Timetracker.CRM.presentAccountsSearchResults=null:Timetracker.CRM.allAccountsList=null;break;case Timetracker.CRM.contacts:isSearch?Timetracker.CRM.presentContactsSearchResults=null:Timetracker.CRM.allContactsList=null;break;case Timetracker.CRM.deals:isSearch?Timetracker.CRM.presentDealsSearchResults=null:Timetracker.CRM.allDealsList=null}else Timetracker.CRM.allLeadsList=null,Timetracker.CRM.allAccountsList=null,Timetracker.CRM.allContactsList=null,Timetracker.CRM.allDealsList=null,Timetracker.CRM.presentLeadsSearchResults=null,Timetracker.CRM.presentAccountsSearchResults=null,Timetracker.CRM.presentContactsSearchResults=null,Timetracker.CRM.presentDealsSearchResults=null},fetchCRMClients:function(type,searchStr){var params=Timetracker.CRM.getDefaultParams(type,searchStr);$.post(Timetracker.constants.URL,params,function(response){if(!response.res||"0"===response.res)return Timetracker.CRM.showErrorMessage(response.errorCode,type,searchStr),!1;if(!searchStr||searchStr&&Layout.Page.container.find("#CRM_search").val()&&searchStr===Layout.Page.container.find("#CRM_search").val()){let isLastPage=response.resArr.length<Timetracker.CRM.Pagination.recLimit;1===params.sIndex&&Timetracker.CRM.clearCache(type,searchStr),Timetracker.CRM.updateCache(response.resArr,type,searchStr),0==Layout.Page.container.find("#CRM_list li").length&&Timetracker.CRM.constructCRMResults(response.resArr,type,searchStr,isLastPage)}})},getCRMtype:function(type,isReferenceType){return"CRM Lead"==type||"lead"==type?1==isReferenceType?"3":Timetracker.CRM.leads:"CRM Account"==type||"account"==type?1==isReferenceType?"0":Timetracker.CRM.accounts:"CRM Contact"==type||"contact"==type?1==isReferenceType?"1":Timetracker.CRM.contacts:"CRM Deal"==type||"deal"==type?1==isReferenceType?"2":Timetracker.CRM.deals:void 0},showErrorMessage:function(errorCode,type,searchStr){if(Timetracker.util.removeLoading(),errorCode===Timetracker.constants.ERROR_CODES.INTEGRATION.ZCRM.NO_ACCOUNT)if(Timetracker.FireScroll.setFetchCount(Timetracker.CRM.FireScroll.getFireScrollMode(type,searchStr),{}),Timetracker.util.showAlert(0,ZPI18N.getString("zp.zcrm.nocrmaccount")),1==Timetracker.CRM.isBulkImport)ModuleComp.Modal.hide("zp_modal_crmpopup");else{var layout=settingsPage.container;layout.find("#addCRMContact").hide(),layout.find("#CRM_dropdown").hide(),layout.find("#chooseCRMdropdown").removeClass("open")}},FireScroll:{maxLimit:200,init:function(type,searchStr){var layout=Timetracker.Util.getLayout();layout.find(".ZPapplCb").scrollTop(0),layout.find("#CRM_list").off("scroll").html(""),Timetracker.FireScroll.resetDataOnLoad(Timetracker.CRM.FireScroll.getFireScrollMode(type,searchStr)),Timetracker.CRM.isBulkImport?Timetracker.util.appendLoading("CRM_list",{type:"popup",containerId:"zp_modal_crmpopup"}):Timetracker.util.appendLoading("CRM_list",{type:"popup",containerId:"CRM_dropdown"})},getFireScrollMode:function(type,searchStr){var mode="";return type===Timetracker.CRM.leads?mode="CRM_LEADS":type===Timetracker.CRM.accounts?mode="CRM_ACCOUNTS":type===Timetracker.CRM.contacts?mode="CRM_CONTACTS":type===Timetracker.CRM.deals&&(mode="CRM_DEALS"),searchStr&&""!==searchStr.trim()&&(mode+="_SEARCH"),Timetracker.constants.MODES[mode]},constructCRMClientsOnFirescroll:function(result,params){var dataArray=1==result.res?result.resArr:[];1==result.res&&0===result.resArr.length&&Timetracker.CRM.setLastIndex(params.type,params.sIndex,params.searchStr),Timetracker.CRM.constructCRMResults(dataArray,params.type,params.searchStr),Timetracker.CRM.updateCache(dataArray,params.type,params.searchStr,!0)}},setCRMValueinTextBox:function(typeName,id,currency){var layout=Timetracker.Util.getLayout(),clientName=layout.find("#CRM_list").find("#"+typeName+id).find("span").attr("val");-1==clientName.indexOf(">")&&-1==clientName.indexOf("<")?(layout.find("#CRM_text").find("#CRM_client").val(clientName),layout.find("#CRM_text").find("#CRM_client").attr("clientId",id),layout.find("#CRM_text").find("#CRM_client").attr("clientType",Timetracker.CRM.getCRMtype(typeName,!0)),layout.find("#CRM_text").find("#CRM_client").attr("currency",currency),layout.find("#CRM_text").removeClass("zpl_DNI"),layout.find("#select_client,#CRM_dropdown").hide(),layout.find("#select_client").prev().hide(),layout.find("#chooseCRMdropdown").find("button").dropdown("toggle"),Timetracker.CRM.clientFromCRM=!0):Timetracker.util.showAlert(0,ZPI18N.getString("zp.filesexcludesplchars",[Timetracker.clients.formDetails.labelDetails.CLIENTNAME]))},hideCRMTextBox:function(){var layout=Timetracker.Util.getLayout();layout.find("#CRM_text").find("#CRM_client").val(""),layout.find("#CRM_text").find("#CRM_client").attr("clientId",""),layout.find("#CRM_text").find("#CRM_client").attr("clientType",""),layout.find("#CRM_text").find("#CRM_client").attr("currency",""),Timetracker.CRM.clientFromCRM=!1,layout.find("#CRM_text").addClass("zpl_DNI"),layout.find("#select_client").show(),layout.find("#select_client").prev().show()},addCRMClients:function(){var layout=Timetracker.Util.getLayout(),typeText=layout.find("#CRM_dropdown").find("li.zpl_act").attr("id"),type=Timetracker.CRM.getCRMtype(typeText),txt=Timetracker.CRM.getAddClientHtml(type);if(layout.find("#addCRMContact").html(txt),type===Timetracker.CRM.deals){var config={calendarIcon:!0,format:dateFmt,picker:!0,spinButtons:"none",clearButton:"none"};ZPeopleComponents.datefield(layout.find("#crm_deal_cdate"),config),ZPeopleComponents.select(layout.find("#crm_deal_stage"))}layout.find("#addCRMContact").show()},getAddClientHtml:function(type){var txt="";return txt='<div class="zpl_lstgrp">',type===Timetracker.CRM.leads?txt+='<table class="zpl_itbl"><tbody><tr><td><span>'+ZPI18N.getString("zp.firstname")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_lead_fname"></div></td></tr><tr><td><span class="zpl_mtry">'+ZPI18N.getString("zp.lastname")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_lead_lname"></div></td></tr><tr><td><span class="zpl_mtry">'+ZPI18N.getString("zp.companyname")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_lead_cname"></div></td></tr></tbody></table>':type===Timetracker.CRM.accounts?txt+='<table class="zpl_itbl"><tbody><tr><td><span class="zpl_mtry">'+ZPI18N.getString("zp.zcrm.accountname")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_account_aname"></div></td></tr><tr><td><span>'+ZPI18N.getString("zp.phonenumber")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_account_phone"></div></td></tr><tr><td><span>'+ZPI18N.getString("zp.website")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_account_website"></div></td></tr></tbody></table>':type===Timetracker.CRM.contacts?txt+='<table class="zpl_itbl"><tbody><tr><td><span>'+ZPI18N.getString("zp.firstname")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_contact_fname"></div></td></tr><tr><td><span class="zpl_mtry">'+ZPI18N.getString("zp.lastname")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_contact_lname"></div></td></tr><tr><td><span>'+ZPI18N.getString("zp.zcrm.accountname")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_contact_aname"></div></td></tr><tr><td><span>'+ZPI18N.getString("zp.mail")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_contact_mail"></div></td></tr><tr><td><span>'+ZPI18N.getString("zp.phone")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_contact_phone"></div></td></tr></tbody></table>':type===Timetracker.CRM.deals&&(txt+='<table class="zpl_itbl"><tbody><tr><td><span class="zpl_mtry">'+ZPI18N.getString("zp.zcrm.dealname")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_deal_pname"></div></td></tr><tr><td><span class="zpl_mtry">'+ZPI18N.getString("zp.zcrm.accountname")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_deal_aname"></div></td></tr><tr><td><span class="zpl_mtry">'+ZPI18N.getString("zp.zcrm.closingdate")+'</span></td><td><div><input type="text" class="ztextbox w200" id="crm_deal_cdate"></div></td></tr><tr><td><span class="zpl_mtry">'+ZPI18N.getString("zp.zcrm.stage")+'</span></td><td><div><select id="crm_deal_stage" class="w200"><option value="-1">'+ZPI18N.getString("zp.none")+'</option><option value="Qualification">'+ZPI18N.getString("zp.qualification")+'</option><option value="Needs Analysis">'+ZPI18N.getString("zp.zcrm.needanalysis")+'</option><option value="Value Proposition">'+ZPI18N.getString("zp.zcrm.valueproposition")+'</option><option value="Id. Decision Makers">'+ZPI18N.getString("zp.zcrm.iddecisionmakers")+'</option><option value="Proposal/Price Quote">'+ZPI18N.getString("zp.zcrm.proposalpricequote")+'</option><option value="Negotiation/Review">'+ZPI18N.getString("zp.zcrm.negotiationreview")+'</option><option value="Closed Won">'+ZPI18N.getString("zp.zcrm.closedwon")+'</option><option value="Closed Lost">'+ZPI18N.getString("zp.zcrm.closedlost")+'</option><option value="Closed Lost to Competition">'+ZPI18N.getString("zp.zcrm.closedlosttocompetition")+"</option></select></div></td></tr></tbody></table>"),""!==(txt+="</div>")&&(txt+='<div class="zpl_list_btm zpl_whtbg"><div><button class="zlabel zlabel--blue zlabel--small" type="button" onclick="Timetracker.CRM.addCRMClientsBasedOnType(this, \''+type+"');\">"+ZPI18N.getString("zp.submit")+'</button><button class="zlabel zlabel--outline zlabel--small" type="button" data-target="#addCRMContact" aria-expanded="false" onclick="Timetracker.CRM.hideAddPopup();">'+ZPI18N.getString("zp.cancel")+"</button></div></div>"),txt},hideAddPopup:function(event){var layout=settingsPage.container.find("#CRM_dropdown");layout.find("#crm_deal_stage").length&&(ZPeopleComponents.datefield(layout.find("#crm_deal_cdate")).destroy(),ZPeopleComponents.select(layout.find("#crm_deal_stage")).destroy()),layout.find("#addCRMContact").hide()},addCRMClientsBasedOnType:function(currObj,type){$(currObj).attr("onclick",""),type===Timetracker.CRM.leads?Timetracker.CRM.addCRMLead(currObj):type===Timetracker.CRM.accounts?Timetracker.CRM.addCRMAccount(currObj):type===Timetracker.CRM.contacts?Timetracker.CRM.addCRMContact(currObj):type===Timetracker.CRM.deals&&Timetracker.CRM.addCRMDeal(currObj),Timetracker.clients.refreshData=!0,Timetracker.forms.refreshLookupOptions("clients")},addCRMLead:function(currObj){var layout=Layout.Page.container.find("#addCRMContact");Timetracker.util.removeErrorMsg("addCRMContact",layout);var params={type:Timetracker.CRM.leads,conreqcsr:csrfToken,mode:"addCRMContacts"},firstName=layout.find("#crm_lead_fname").val().trim(),lastName=layout.find("#crm_lead_lname").val().trim(),companyName=layout.find("#crm_lead_cname").val().trim(),errorflag=!1;if(""===lastName&&(0==layout.find("#crm_lead_lname").parent().find(".ztextbox__error").length&&(layout.find("#crm_lead_lname").addClass("ztextbox__error"),layout.find("#crm_lead_lname").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.zcrm.lastnameempty")+"</span>")),errorflag=!0),""===companyName&&(0==layout.find("#crm_lead_cname").parent().find(".ztextbox__error").length&&(layout.find("#crm_lead_cname").addClass("ztextbox__error"),layout.find("#crm_lead_cname").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.zcrm.companynameempty")+"</span>")),errorflag=!0),errorflag)return $(currObj).attr("onclick","Timetracker.CRM.addCRMClientsBasedOnType(this, '1');"),!1;""!==firstName&&(params.firstName=firstName),params.lastName=lastName,params.companyName=companyName,$.post(Timetracker.constants.URL,params,function(response){layout.find("#addCRMContact").hide(),Timetracker.CRM.hideAddPopup(),response.res&&"0"!==response.res?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.zcrm.clientadded",[ZPI18N.getString("zp.zcrm.lead")])),Timetracker.CRM.allLeadsList=response.resArr,Timetracker.CRM.presentLeadsSearchResults={},Timetracker.CRM.FireScroll.init(Timetracker.CRM.leads),Timetracker.CRM.constructCRMClients(Timetracker.CRM.leads)):Timetracker.util.showAlert(0,ZPI18N.getString("zp.zcrm.clientnotadded",[ZPI18N.getString("zp.zcrm.lead")]))})},addCRMAccount:function(currObj){var layout=settingsPage.container.find("#addCRMContact");Timetracker.util.removeErrorMsg("addCRMContact",layout);var params={type:Timetracker.CRM.accounts,conreqcsr:csrfToken,mode:"addCRMContacts"},accountName=layout.find("#crm_account_aname").val().trim(),errorflag=!1;""===accountName&&(0==layout.find("#crm_account_aname").parent().find(".ztextbox__error").length&&(layout.find("#crm_account_aname").addClass("ztextbox__error"),layout.find("#crm_account_aname").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.zcrm.accountnameempty")+"</span>")),errorflag=!0);var phone=layout.find("#crm_account_phone").val().trim(),website=layout.find("#crm_account_website").val().trim();if(""===phone||phone.match(Timetracker.util.phoneExp)||(0==layout.find("#crm_account_phone").parent().find(".ztextbox__error").length&&(layout.find("#crm_account_phone").addClass("ztextbox__error"),layout.find("#crm_account_phone").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.invalidphone")+"</span>")),errorflag=!0),errorflag)return $(currObj).attr("onclick","Timetracker.CRM.addCRMClientsBasedOnType(this, '2');"),!1;params.accountName=accountName,""!==phone&&(params.phone=phone),""!==website&&(params.website=website),$.post(Timetracker.constants.URL,params,function(response){layout.find("#addCRMContact").hide(),Timetracker.CRM.hideAddPopup(),response.res&&"0"!==response.res?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.zcrm.clientadded",[ZPI18N.getString("zp.zcrm.account")])),Timetracker.CRM.allAccountsList=response.resArr,Timetracker.CRM.presentAccountsSearchResults={},Timetracker.CRM.FireScroll.init(Timetracker.CRM.accounts),Timetracker.CRM.constructCRMClients(Timetracker.CRM.accounts)):Timetracker.util.showAlert(0,ZPI18N.getString("zp.zcrm.clientnotadded",[ZPI18N.getString("zp.zcrm.account")]))})},addCRMContact:function(currObj){var layout=settingsPage.container.find("#addCRMContact");Timetracker.util.removeErrorMsg("addCRMContact",layout);var params={type:Timetracker.CRM.contacts,conreqcsr:csrfToken,mode:"addCRMContacts"},lastName=layout.find("#crm_contact_lname").val().trim(),errorflag=!1;""===lastName&&(0==layout.find("#crm_contact_lname").parent().find(".error-msg, .ztextbox__error").length&&(layout.find("#crm_contact_lname").addClass("ztextbox__error"),layout.find("#crm_contact_lname").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.zcrm.lastnameempty")+"</span>")),errorflag=!0),params.lastName=lastName;var phone=layout.find("#crm_contact_phone").val().trim(),email=layout.find("#crm_contact_mail").val().trim(),firstname=layout.find("#crm_contact_fname").val().trim(),accountname=layout.find("#crm_contact_aname").val().trim();if(""===phone||phone.match(Timetracker.util.phoneExp)||(0==layout.find("#crm_contact_phone").parent().find(".ztextbox__error").length&&(layout.find("#crm_contact_phone").addClass("ztextbox__error"),layout.find("#crm_contact_phone").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.invalidphone")+"</span>")),errorflag=!0),""===email||email.match(Timetracker.util.emailExp)||(0==layout.find("#crm_contact_mail").parent().find(".ztextbox__error").length&&(layout.find("#crm_contact_mail").addClass("ztextbox__error"),layout.find("#crm_contact_mail").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.invalidemail")+"</span>")),errorflag=!0),errorflag)return $(currObj).attr("onclick","Timetracker.CRM.addCRMClientsBasedOnType(this, '3');"),!1;""!==phone&&(params.phone=phone),""!==email&&(params.Email=email),""!==firstname&&(params.firstName=firstname),""!==accountname&&(params.accountName=accountname),$.post(Timetracker.constants.URL,params,function(response){layout.find("#addCRMContact").hide(),Timetracker.CRM.hideAddPopup(),response.res&&"0"!==response.res?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.zcrm.clientadded",[ZPI18N.getString("zp.zcrm.contact")])),Timetracker.CRM.allContactsList=response.resArr,Timetracker.CRM.presentContactsSearchResults={},Timetracker.CRM.FireScroll.init(Timetracker.CRM.contacts),Timetracker.CRM.constructCRMClients(Timetracker.CRM.contacts)):Timetracker.util.showAlert(0,ZPI18N.getString("zp.zcrm.clientnotadded",[ZPI18N.getString("zp.zcrm.contact")]))})},addCRMDeal:function(currObj){var layout=settingsPage.container.find("#addCRMContact");Timetracker.util.removeErrorMsg("addCRMContact",layout);var params={mode:"addCRMContacts",type:Timetracker.CRM.deals,conreqcsr:csrfToken},dealName=layout.find("#crm_deal_pname").val().trim(),accountName=layout.find("#crm_deal_aname").val().trim(),closingDate=ZPeopleComponents.datefield(layout.find("#crm_deal_cdate")).getValue().dateString,stage=ZPeopleComponents.select(layout.find("#crm_deal_stage")).getValue(),errorflag=!1;if(""===dealName&&(0==layout.find("#crm_deal_pname").parent().find(".ztextbox__error").length&&(layout.find("#crm_deal_pname").addClass("ztextbox__error"),layout.find("#crm_deal_pname").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.zcrm.dealnameempty")+"</span>")),errorflag=!0),""===accountName&&(0==layout.find("#crm_deal_aname").parent().find(".ztextbox__error").length&&(layout.find("#crm_deal_aname").addClass("ztextbox__error"),layout.find("#crm_deal_aname").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.zcrm.accountnameempty")+"</span>")),errorflag=!0),void 0!=closingDate&&Calendar.isvalidDate(closingDate)||(0==layout.find("#crm_deal_cdate").parent().find(".ztextbox__error").length&&(ZPeopleComponents.datefield(layout.find("#crm_deal_cdate")).setAttributes({className:"ztextbox__error"}),layout.find("#crm_deal_cdate").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.invaliddate")+"</span>")),errorflag=!0),"-1"===stage&&(0==layout.find("#crm_deal_stage").parent().find(".ztextbox__error").length&&(TimelyZComp.select.setAttributes(layout.find("#crm_deal_stage"),{className:"ztextbox__error"}),layout.find("#crm_deal_stage").parent().append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.zcrm.stageempty")+"</span>")),errorflag=!0),errorflag)return $(currObj).attr("onclick","Timetracker.CRM.addCRMClientsBasedOnType(this, '4');"),!1;params.dealName=dealName,params.accountName=accountName,params.closingDate=closingDate,params.stage=stage,$.post(Timetracker.constants.URL,params,function(response){layout.find("#addCRMContact").hide(),Timetracker.CRM.hideAddPopup(),response.res&&"0"!==response.res?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.zcrm.clientadded",[ZPI18N.getString("zp.zcrm.deal")])),Timetracker.CRM.allDealsList=response.resArr,Timetracker.CRM.presentDealsSearchResults={},Timetracker.CRM.FireScroll.init(Timetracker.CRM.deals),Timetracker.CRM.constructCRMClients(Timetracker.CRM.deals)):Timetracker.util.showAlert(0,ZPI18N.getString("zp.zcrm.clientnotadded",[ZPI18N.getString("zp.zcrm.deal")]))})},selectUnselectClient:function(ele,modal){modal=modal||settingsPage.container.find("#zp_modal_crmpopup");$(ele).is(":checked")?Timetracker.CRM.selectedClients[$(ele).attr("id")]=$(ele).data("clientDtls"):delete Timetracker.CRM.selectedClients[$(ele).attr("id")],Timetracker.CRM.checkIfAllClientsSelected(modal)},checkIfAllClientsSelected:function(modal){var selectedCRMClients=(modal=modal||settingsPage.container.find("#zp_modal_crmpopup")).find("#CRM_list").find("input[type=checkbox]:checked"),allCRMClients=modal.find("#CRM_list").find("input[type=checkbox]");0!=selectedCRMClients.length&&selectedCRMClients.length===allCRMClients.length?modal.find("#selectall_CRMClient").prop("checked",!0):modal.find("#selectall_CRMClient").prop("checked",!1)},selectAllCRMContacts:function(){var id,modal=settingsPage.container.find("#zp_modal_crmpopup"),isChecked=modal.find("#selectall_CRMClient").prop("checked");$.each(modal.find("#CRM_list").find("input[type=checkbox]"),function(index,client){id=$(client).attr("id"),$(client).prop("checked",isChecked),isChecked?Timetracker.CRM.selectedClients.hasOwnProperty(id)||(Timetracker.CRM.selectedClients[id]=$(client).data("clientDtls")):Timetracker.CRM.selectedClients.hasOwnProperty(id)&&delete Timetracker.CRM.selectedClients[id]})},importSelectedCRMContacts:function(){var layout=settingsPage.container.find("#zp_modal_crmpopup");Timetracker.util.removeErrorMsg("zp_modal_crmpopup",layout),Timetracker.util.freezeSubmit("zp_modal_crmpopup","zp_modal_blubtn",layout);var obj,executeWF=layout.find("#zcrm_exeute_workflow").prop("checked"),importArray=new Array,isSkipped=!1;$.each(Timetracker.CRM.selectedClients,function(id,client){var name=client.crmName;if(-1!==name.indexOf("<")||-1!==name.indexOf(">"))return isSkipped=!0,!0;obj={crmName:name,crmId:client.crmId},void 0!=client.currency&&""!=client.currency&&(obj.currency=client.currency),importArray.push(obj)});var typeSelect=layout.find("#CRM_select"),type=TimetrackerOperations.Filters.getSelectFilterValues(typeSelect);if(importArray.length<1){var errorMessage="Lead";return type===Timetracker.CRM.accounts?errorMessage="Account":type===Timetracker.CRM.contacts?errorMessage="Contact":type===Timetracker.CRM.deals&&(errorMessage="Deal"),Timetracker.util.appendErrorMsg({obj:layout.find("#CRM_select").parent(),action:"append",msg:ZPI18N.getString("zp.zcrm.importerror",[errorMessage])},!0),Timetracker.util.unfreezeSubmit("zp_modal_crmpopup","zp_modal_blubtn",layout),1==isSkipped&&Timetracker.util.showAlert(0,ZPI18N.getString("zp.filesexcludesplchars",["CRM "+errorMessage])),!1}var params={mode:"bulkImportFromCRM",importArray:JSON.stringify(importArray),crmType:type,isFromNewUI:!0,conreqcsr:csrfToken};params.executeWF=executeWF,$.post(Timetracker.constants.URL,params,function(result){if(result.res&&"0"!==result.res){var msg=ZPI18N.getString("zp.zcrm.leads");type===Timetracker.CRM.accounts?msg=ZPI18N.getString("zp.zcrm.accounts"):type===Timetracker.CRM.contacts?msg=ZPI18N.getString("zp.zcrm.contacts"):type===Timetracker.CRM.deals&&(msg=ZPI18N.getString("zp.zcrm.deals")),Timetracker.util.unfreezeSubmit("zp_modal_crmpopup","zp_modal_blubtn",layout),ModuleComp.Modal.hide("zp_modal_crmpopup"),settingsPage.container.off("scroll");var dispMsg=isSkipped?ZPI18N.getString("zp.zcrm.recordskipped",[msg,msg]):ZPI18N.getString("zp.zcrm.importsuccess",[msg]);Timetracker.util.showAlert(2,dispMsg),ZP5Views.isSystemView()?(Timetracker.clients.fetchData=!0,Timetracker.clients.getClientList()):(Timetracker.clients.fetchData=!0,ZP5Views.refreshview(!0)),Timetracker.forms.refreshLookupOptions("clients")}else{var errorMsg=Timetracker.Util.getFailureMessageByCode(result.errorCode,result.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg)}})}},Timetracker.leave={leaveTypeMap:{},setLeaveTypesMap:function(leaveData){if(leaveData&&leaveData.leaveTypes&&0!==Object.keys(leaveData.leaveTypes).length)for(var leaveType in leaveData.leaveTypes)Timetracker.leave.leaveTypeMap[leaveType]=leaveData.leaveTypes[leaveType]},getlTypeBasedOnPriority:function(leaves){var leaveType,lTypePriority={};for(var i in lTypePriority[Timetracker.constants.LEAVE_TYPE.RESTRICTED_HOLIDAY]=1,lTypePriority[Timetracker.constants.LEAVE_TYPE.ONDUTY]=2,lTypePriority[Timetracker.constants.LEAVE_TYPE.PAID]=3,lTypePriority[Timetracker.constants.LEAVE_TYPE.COMP_OFF]=3,lTypePriority[Timetracker.constants.LEAVE_TYPE.UNPAID]=4,lTypePriority[Timetracker.constants.LEAVE_TYPE.ABSENT]=5,lTypePriority[Timetracker.constants.LEAVE_TYPE.WEEKEND]=6,leaves){var lType=leaves[i].leaveType;(void 0===leaveType||void 0!==lType&&lTypePriority[lType]&&lTypePriority[leaveType]&&lTypePriority[leaveType]>lTypePriority[lType])&&(leaveType=lType)}return leaveType},getFillerClassByLeaveType:function(leaveType,getBrightClr){var fillerClass="",type=getBrightClr?"fillerClass":"LfillerClass";return void 0!==leaveType&&(leaveType===Timetracker.constants.LEAVE_TYPE.RESTRICTED_HOLIDAY?fillerClass=Timetracker.leave.leaveTypeMap["zp.holiday"][type]:leaveType===Timetracker.constants.LEAVE_TYPE.ONDUTY?fillerClass=Timetracker.leave.leaveTypeMap["zp.onduty"][type]:leaveType===Timetracker.constants.LEAVE_TYPE.PAID||leaveType===Timetracker.constants.LEAVE_TYPE.COMP_OFF?fillerClass=Timetracker.leave.leaveTypeMap["zp.paidleave"][type]:leaveType===Timetracker.constants.LEAVE_TYPE.UNPAID?fillerClass=Timetracker.leave.leaveTypeMap["zp.unpaidleave"][type]:leaveType===Timetracker.constants.LEAVE_TYPE.ABSENT?fillerClass=Timetracker.leave.leaveTypeMap["zp.absent"][type]:leaveType===Timetracker.constants.LEAVE_TYPE.WEEKEND&&(fillerClass=Timetracker.leave.leaveTypeMap["zp.weekend"][type])),fillerClass},getFillerBorderByLeaveType:function(leaveType){var fillerClass="";return void 0!==leaveType&&(leaveType===Timetracker.constants.LEAVE_TYPE.RESTRICTED_HOLIDAY?fillerClass=Timetracker.leave.leaveTypeMap["zp.holiday"].borderClass:leaveType===Timetracker.constants.LEAVE_TYPE.ONDUTY?fillerClass=Timetracker.leave.leaveTypeMap["zp.onduty"].borderClass:leaveType===Timetracker.constants.LEAVE_TYPE.PAID||leaveType===Timetracker.constants.LEAVE_TYPE.COMP_OFF?fillerClass=Timetracker.leave.leaveTypeMap["zp.paidleave"].borderClass:leaveType===Timetracker.constants.LEAVE_TYPE.UNPAID?fillerClass=Timetracker.leave.leaveTypeMap["zp.unpaidleave"].borderClass:leaveType===Timetracker.constants.LEAVE_TYPE.ABSENT?fillerClass=Timetracker.leave.leaveTypeMap["zp.absent"].borderClass:leaveType===Timetracker.constants.LEAVE_TYPE.WEEKEND&&(fillerClass=Timetracker.leave.leaveTypeMap["zp.weekend"].borderClass)),fillerClass},hasLeaveOnThatDay:function(leaves){var hasLeave=!1;for(var i in leaves){var lCount=leaves[i].leaveCount;(void 0===lCount||void 0!==lCount&&lCount>0)&&(hasLeave=!0)}return hasLeave}},Timetracker.ZOHOPROJECTS={integDtls:null,presentSearchResults:{},removeLoadingHtml:function(showModalBody,layout){(layout=layout||Layout.Page.container).find("#zp_page_loading").remove(),showModalBody&&layout.find("#zProjectsModal .container-fluid").children().removeClass("zpl_DNI")},getIntegDetails:function(){ZPeople.Request.send(Timetracker.constants.URL,{mode:"getZProjectsIntegDetails"},function(response){if(response.res&&"0"!==response.res)Timetracker.ZOHOPROJECTS.setIntegDetails(response.resObj),Timetracker.ZOHOPROJECTS.constructZProjectsConfigureModal(response.resObj);else{var errorMsg=Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg)}})},setIntegDetails:async function(integDtls){if(integDtls)Timetracker.ZOHOPROJECTS.integDtls=integDtls,Timetracker.ZOHOPROJECTS.integDtls.syncPortalId?Timetracker.ZOHOPROJECTS.integDtls.type=2:Timetracker.ZOHOPROJECTS.integDtls.type=1;else{let[response]=await ZPeople.Request.sendRequestAsPromise(Timetracker.constants.URL,{mode:"getZProjectsIntegDetails"});if(!response.res||"0"===response.res){var errorMsg=Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0);return void Timetracker.util.showAlert(0,errorMsg)}Timetracker.ZOHOPROJECTS.integDtls=response.resObj,Timetracker.ZOHOPROJECTS.integDtls.syncPortalId?Timetracker.ZOHOPROJECTS.integDtls.type=2:Timetracker.ZOHOPROJECTS.integDtls.type=1}},enableZProjectsInteg:function(modal){var modalLayout=Timetracker.Util.isVersionFive()?settingsPage.container.find("#zprojectsconfigSlider"):Layout.Page.container.find("#zprojects_config_modal");Timetracker.util.freezeSubmit(...Timetracker.Util.isVersionFive()?["zprojectsconfigSlider","sliderSbt"]:["zprojects_config_modal","zp_modal_blubtn"],modalLayout);var params={mode:"enableZProjectsInteg"},selectedPortal=modalLayout.find("#portalsList").find(".active");if(!selectedPortal)return Timetracker.util.showAlert(0,ZPI18N.getString("zp.prjctsync.chooseportal")),void Timetracker.util.unfreezeSubmit(...Timetracker.Util.isVersionFive()?["zprojectsconfigSlider","sliderSbt"]:["zprojects_config_modal","zp_modal_blubtn"],modalLayout);params.zProjectsPortalId=selectedPortal.attr("portalId");var autoSyncElement=modalLayout.find("#zProjectsAutoSync");autoSyncElement&&(params.enableAutoSync=Timetracker.Util.isVersionFive()?ZPeopleComponents.toggleswitch(autoSyncElement).getState():autoSyncElement.is(":checked"),params.enableAutoSync&&(params.frequency=Timetracker.Util.isVersionFive()?ZPeopleComponents.select(modalLayout.find("#zProjectsAutoSyncFreq")).getValue():modalLayout.find("#zProjectsAutoSyncFreq").val()));var timelogsAutoPushElement=modalLayout.find("#zProjectsTimelogsAutoPush");timelogsAutoPushElement&&(params.enableTimelogsAutoPush=Timetracker.Util.isVersionFive()?ZPeopleComponents.toggleswitch(timelogsAutoPushElement).getState():timelogsAutoPushElement.is(":checked")),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.ZOHOPROJECTS.configureCallback)},updateZProjectsInteg:function(modal,params){Timetracker.util.freezeSubmit(...Timetracker.Util.isVersionFive()?["zprojectsconfigSlider","sliderSbt"]:["zprojects_config_modal","zp_modal_blubtn"],modal),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.ZOHOPROJECTS.configureCallback)},disableZProjectsInteg:function(modal){Timetracker.util.freezeSubmit(...Timetracker.Util.isVersionFive()?["zprojectsconfigSlider","sliderSbt"]:["zprojects_config_modal","zp_modal_blubtn"],modal),ZPeople.Request.send(Timetracker.constants.URL,{mode:"disableZProjectsInteg"},Timetracker.ZOHOPROJECTS.configureCallback)},configureCallback:function(response,params){var modalLayout=Timetracker.Util.isVersionFive()?settingsPage.container.find("#zprojectsconfigSlider"):Layout.Page.container.find("#zprojects_config_modal");if(response.res&&"0"!==response.res){var message;if("enableZProjectsInteg"===params.mode)message=ZPI18N.getString("zp.prjctsync.integenabled");else if("updateZProjectsInteg"===params.mode)message=ZPI18N.getString("zp.configupdatesuccess");else{if("triggerZProjectsInstantSync"===params.mode)return message=ZPI18N.getString("zp.prjctsync.synctriggered"),modalLayout.find("#zProjectsSyncNow").removeAttr("disabled"),Timetracker.util.unfreezeSubmit("zprojects_config_modal","zp_modal_blubtn",modalLayout),void Timetracker.util.showAlert(2,message);message=ZPI18N.getString("zp.prjctsync.integdisabled")}Timetracker.util.showAlert(2,message),Timetracker.ZOHOPROJECTS.setIntegDetails(response.resObj),ZPeople.BSModal.hide("zprojects_config_modal"),Timetracker.Util.isVersionFive()&&Timetracker.ZOHOPROJECTS.destroyZComp(),Timetracker.ZOHOPROJECTS.constructZProjectsConfigureModal(response.resObj)}else{var errorMsg=Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg),"enableZProjectsInteg"===params.mode?(modalLayout.find("#zProjectsAutoSync").removeAttr("checked"),modalLayout.find("#zProjectsTimelogsAutoPush").removeAttr("checked")):"updateZProjectsInteg"===params.mode?params.enableAutoSync?modalLayout.find("#zProjectsAutoSync").removeAttr("checked"):params.disableAutoSync?modalLayout.find("#zProjectsAutoSync").prop("checked",!0):params.enableTimelogsAutoPush?modalLayout.find("#zProjectsTimelogsAutoPush").removeAttr("checked"):params.disableTimelogsAutoPush&&modalLayout.find("#zProjectsTimelogsAutoPush").prop("checked",!0):"triggerZProjectsInstantSync"===params.mode&&modalLayout.find("#zProjectsSyncNow").removeAttr("disabled"),response.resObj&&(Timetracker.Util.isVersionFive()&&Timetracker.ZOHOPROJECTS.destroyZComp(),Timetracker.ZOHOPROJECTS.setIntegDetails(response.resObj),Timetracker.ZOHOPROJECTS.constructZProjectsConfigureModal(response.resObj))}Timetracker.util.unfreezeSubmit(...Timetracker.Util.isVersionFive()?["zprojectsconfigSlider","sliderSbt"]:["zprojects_config_modal","zp_modal_blubtn"],modalLayout)},constructZProjectsConfigureModal:function(integDtls){for(var modalParams={},tempHrs='<div class="zpl_Fldtl"><select id="zProjectsAutoSyncFreq" class="select-js">',i=3;i<=24;i++)tempHrs+='<option value="'+i+'">'+i+"</option>";tempHrs+="</select></div><span> "+ZPI18N.getString("zp.gracehour")+" </span>",tempHrs+=integDtls.syncIsActive?'<div class="zpl_actn zpl_actv" id="zpSyncFreq"><span><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" id="zpFreqEdit"></i><i class="PI_tick zpl_DNI" title="'+ZPI18N.getString("zp.save")+'" id="zpFreqSave"></i><i class="PI_cls red zpl_DNI"  title="'+ZPI18N.getString("zp.cancel")+'" id="zpFreqClose"></i></span></div></div>':"</div>";var bodyHtml="";bodyHtml="1"===integDtls.integFlag?'<div id="zprojects_config_body" class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div class="prtl_enbld"><h5 class="prtl_hd"> '+ZPI18N.getString("zp.tyex.projects")+'</h5><div class="prtl_logo zpl_intelst cstm_intlst"><div class="zpt"></div></div><div class="prtl_cont"><p>'+(integDtls.portalName?integDtls.portalName:"")+"</p><a onclick=\"Timetracker.ZOHOPROJECTS.linkToPortal('"+integDtls.portalUrl+"');\">"+(integDtls.portalUrl?projects_url+"/portal/"+integDtls.portalUrl:"")+'</a><div class="btn_cntr"><button type="button" id="disableBtn" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.disable")+'</button></div><div class="zpl_secn"><div><div id="zProjectsAutoSyncDiv" class="zpl_tgl"><input id="zProjectsAutoSync">'+ZPI18N.getString("zp.prjctsync.autosyncdescription")+'</div></div><div class="zpl_secn"><div>'+(integDtls.syncIsActive?'<div class="zpl_gbox"><h4></h4><div class="zpl_idiv mt0"><label>'+ZPI18N.getString("zp.prjctsync.synconcein",[""])+'</label><div class="zpl_cat zpl_hdcnt mtp0"><div>'+tempHrs+"</div></div>":"")+(integDtls.nextTriggerTime?'<div class="zpl_info"><em>'+ZPI18N.getString("zp.prjctsync.nextsynctime")+" - <b>"+ZPDateTime.getDateDisplayFormat(new Date(integDtls.nextTriggerTime))+"</b></em></div>":"")+(integDtls.syncIsActive?'<div class="zpl_secn"><div class="zpl_idiv mt0"><label>'+ZPI18N.getString("zp.prjctsync.manualsync")+'</label><button id="zProjectsSyncNow" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.prjctsync.syncnow")+"</button> </div></div></div>":"")+'</div></div></div><div class="zpl_secn" id="zProjectsTimelogsAutoPushDiv"><div><div class="zpl_tgl"><input id="zProjectsTimelogsAutoPush" class="togbutton-js" style="display: none;">'+ZPI18N.getString("zp.approvedtlautopush")+"</div></div>"+(integDtls.isIntegErrorExists?'<div class="zpl_flexaligngap5" ><span class="zpl_fh6 zpl_mt0 zpl_w-70 ztextbox--error__label" >'+ZPI18N.getString("zp.tt.errorsummarydesc")+'</span><a id="errorSummarybtn" >'+ZPI18N.getString("zp.tt.errorsummarybtntxt")+"</a></div>":"")+"</div></div></div></div>":'<div id="zprojects_config_body" class="zpl_crd"><div class="zpl_crdhdr"><div class="zpl_intelst cstm_intlst"><div class="zpt"></div><span><h4> '+ZPI18N.getString("zp.tyex.projects")+"</h4><p>"+ZPI18N.getString("zp.prjctsync.description")+'</p><span></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><h5>'+ZPI18N.getString("zp.organizationtointegrate")+'</h5><div id="portalsList" class="prtl_lst"></div></div><div class="zpl_secn"><div><div id="zProjectsAutoSyncDiv" class="zpl_tgl"><input id="zProjectsAutoSync">'+ZPI18N.getString("zp.prjctsync.autosyncdescription")+'</div><div id="syncdiv" style="display: none;" class="zpl_gbox"><h4></h4><div class="zpl_idiv mt0"><label>'+ZPI18N.getString("zp.prjctsync.synconcein",[""])+'</label> <div class="zpl_cat zpl_hdcnt mtp0"><div>'+tempHrs+'</div></div><div class="zpl_info"><em>'+ZPI18N.getString("zp.prjctsync.nextsynctime")+"<b> -  "+ZPI18N.getString("zp.prjctsync.nextsyncmsg")+'</b></em></div></div></div></div><div id="zProjectsTimelogsAutoPushDiv" class="zpl_secn"><div><div class="zpl_tgl"><input id="zProjectsTimelogsAutoPush" class="togbutton-js"> '+ZPI18N.getString("zp.approvedtlautopush")+"</div></div></div></div></div>",modalParams.id="zprojectsconfigSlider",modalParams.cardId="zprojectsconfigSliderCard",modalParams.callback=function(){settingsPage.container.find("#"+modalParams.cardId).html(bodyHtml)},modalParams.buttonValue=ZPI18N.getString("zp.enable"),modalParams.validate=Timetracker.ZOHOPROJECTS.enableZProjectsInteg;var zPrModalObj=new sliderModal("Zoho Projects "+ZPI18N.getString("zp.integration"),modalParams);zPrModalObj.cntExtraCls="intgrtion_con",zPrModalObj.save=ZPI18N.getString("zp.enable"),zPrModalObj.setCloseCallback(function(){Timetracker.ZOHOPROJECTS.destroyZComp()}),zPrModalObj.construct();var modal=settingsPage.container.find("#"+modalParams.id);modal.find("#zprojectsconfigSliderCard").removeClass("zpl_fm"),modal.off("hide.bs.modal").on("hide.bs.modal",function(){window.location.hash="#admin/integration/zohoservices"}),Timetracker.Integration.Util.ZOneUIhandling(modal,modalParams.cardId),modal.fadeIn(100),Timetracker.util.freezeSubmit("zprojectsconfigSlider","sliderSbt",modal),ZPeopleComponents.toggleswitch(modal.find("#zProjectsAutoSync"),{on:!("1"!==integDtls.integFlag||!integDtls.syncIsActive)}),ZPeopleComponents.toggleswitch(modal.find("#zProjectsTimelogsAutoPush"),{on:!(!integDtls||!integDtls.isTimelogsAutoPushActive)}),ZPeopleComponents.select(modal.find("#zProjectsAutoSyncFreq"),{selectedValue:integDtls.integFlag?integDtls.frequency:24}),Timetracker.ZOHOPROJECTS.bindConfigModalEvents(integDtls)},bindConfigModalEvents:function(integDtls){var modalLayout=Timetracker.Util.isVersionFive()?settingsPage.container.find("#zprojectsconfigSlider"):Layout.Page.container.find("#zprojects_config_modal");if(modalLayout.find("#disableBtn").off("click").on("click",function(){Timetracker.ZOHOPROJECTS.disableZProjectsInteg()}),modalLayout.find("#errorSummarybtn").off("click").on("click",function(){Timetracker.Integrations.errorSummary.constructErrorSummaryModel({service:Timetracker.Integrations.errorSummary.service.ZPROJECTS})}),"1"===integDtls.integFlag)if(modalLayout.find(".zpl_mfoter").addClass("zpl_DNI"),integDtls.syncPortalId){var autoSyncElement=modalLayout.find("#zProjectsAutoSync");if(integDtls.syncIsActive){autoSyncElement.off("ztoggleswitchchange").on("ztoggleswitchchange",function(obj){if(!obj.detail.state){$(this).attr("disabled",!0);Timetracker.ZOHOPROJECTS.updateZProjectsInteg(modalLayout,{mode:"updateZProjectsInteg",disableAutoSync:!0})}}),ZPeopleComponents.select(modalLayout.find("#zProjectsAutoSyncFreq")).setAttributes({disabled:!0});var freqEdit=modalLayout.find("#zpSyncFreq");freqEdit.find("#zpFreqEdit").off().on("click",function(){freqEdit.find("#zpFreqEdit").addClass("zpl_DNI"),freqEdit.find("#zpFreqSave").removeClass("zpl_DNI"),freqEdit.find("#zpFreqClose").removeClass("zpl_DNI"),ZPeopleComponents.select(modalLayout.find("#zProjectsAutoSyncFreq")).setAttributes({disabled:!1})}),freqEdit.find("#zpFreqClose").off().on("click",function(){ZPeopleComponents.select(modalLayout.find("#zProjectsAutoSyncFreq")).setAttributes({selectedValue:integDtls.frequency?integDtls.frequency:24,disabled:!0}),freqEdit.find("#zpFreqEdit").removeClass("zpl_DNI"),freqEdit.find("#zpFreqSave").addClass("zpl_DNI"),freqEdit.find("#zpFreqClose").addClass("zpl_DNI")}),freqEdit.find("#zpFreqSave").off().on("click",function(){if(modalLayout.find("#zProjectsAutoSyncFreq").val()!=integDtls.frequency){var params={mode:"updateZProjectsInteg",enableAutoSync:!0};params.frequency=modalLayout.find("#zProjectsAutoSyncFreq").val(),Timetracker.ZOHOPROJECTS.updateZProjectsInteg(modalLayout,params)}ZPeopleComponents.select(modalLayout.find("#zProjectsAutoSyncFreq")).setAttributes({disabled:!0}),freqEdit.find("#zpFreqEdit").removeClass("zpl_DNI"),freqEdit.find("#zpFreqSave").addClass("zpl_DNI"),freqEdit.find("#zpFreqClose").addClass("zpl_DNI")})}else autoSyncElement.off("ztoggleswitchchange").on("ztoggleswitchchange",function(obj){if(obj.detail.state){Timetracker.ZOHOPROJECTS.updateZProjectsInteg(modalLayout,{mode:"updateZProjectsInteg",enableAutoSync:!0,frequency:24})}});var timelogsAutoPushElement=modalLayout.find("#zProjectsTimelogsAutoPush");integDtls.isTimelogsAutoPushActive?timelogsAutoPushElement.off("ztoggleswitchchange").on("ztoggleswitchchange",function(obj){if(!obj.detail.state){$(this).attr("disabled","disabled");Timetracker.ZOHOPROJECTS.updateZProjectsInteg(modalLayout,{mode:"updateZProjectsInteg",disableTimelogsAutoPush:!0})}}):timelogsAutoPushElement.off("ztoggleswitchchange").on("ztoggleswitchchange",function(obj){if(obj.detail.state){$(this).attr("disabled","disabled");Timetracker.ZOHOPROJECTS.updateZProjectsInteg(modalLayout,{mode:"updateZProjectsInteg",enableTimelogsAutoPush:!0})}}),modalLayout.find("#zProjectsSyncNow").off("click").on("click",function(){modalLayout.find("#zProjectsSyncNow").attr("disabled","disabled");Timetracker.ZOHOPROJECTS.updateZProjectsInteg(modalLayout,{mode:"triggerZProjectsInstantSync"})})}else modalLayout.find("#zProjectsAutoSyncDiv").addClass("zpl_DNI"),modalLayout.find("#zProjectsTimelogsAutoPushDiv").addClass("zpl_DNI");else{if(modalLayout.find(".zpl_mfoter").removeClass("zpl_DNI"),integDtls.resArr){var html="";$.each(integDtls.resArr,function(index,portal){html+='<div class="prtl'+(0===index?" active":"")+'" portalId="'+portal.portalId+'" onclick="Timetracker.ZOHOPROJECTS.selectPortal(this);"><h5 id="portalName">'+portal.portalName+'</h5><span class="prtl_url">'+projects_url+"/portal/"+portal.portalUrl+"</span></div>"}),modalLayout.find("#portalsList").append(html),Timetracker.util.unfreezeSubmit("zprojectsconfigSlider","sliderSbt  ",modalLayout)}else if(integDtls.errorCode)if(integDtls.errorCode===Timetracker.constants.ERROR_CODES.INTEGRATION.ZPRJCTS.NO_PORTALS_AVAILABLE)modalLayout.find(".ztextbox--error__label").remove(),modalLayout.find("#portalsList").append('<div id="noPortalsAvailableError" class="ztextbox--error__label">'+ZPI18N.getString("zp.prjctsync.noportalsavailable")+"</div>");else{var errorMsg=Timetracker.Util.getFailureMessageByCode(integDtls.errorCode,integDtls.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg)}modalLayout.find("#zProjectsAutoSync").off("ztoggleswitchchange").on("ztoggleswitchchange",function(obj){obj.detail.state?modalLayout.find("#syncdiv").show():modalLayout.find("#syncdiv").hide()})}},selectPortal:function(obj){settingsPage.container.find("#portalsList").find(".active").removeClass("active"),$(obj).addClass("active")},linkToPortal:function(portalUrl){portalUrl&&window.open(projects_url+"/portal/"+portalUrl)},showSyncModal:function(modalParams){Timetracker.ZOHOPROJECTS.setIntegDetails(),(modalParams=modalParams||{}).buttontxt=modalParams.integReportParams?ZPI18N.getString("zp.create"):ZPI18N.getString("zp.importfiles"),1===Timetracker.ZOHOPROJECTS.integDtls.type?(modalParams.header=ZPI18N.getString("zp.prjctsync.chooseportalheader"),modalParams.integReportParams?modalParams.message=ZPI18N.getString("zp.prjctsync.projectnotexists1"):modalParams.message=ZPI18N.getString("zp.prjctsync.chooseportalandprojectstoimport")):(modalParams.header=Timetracker.ZOHOPROJECTS.integDtls.portalName,modalParams.integReportParams?modalParams.message=ZPI18N.getString("zp.prjctsync.projectnotexists2"):modalParams.message=ZPI18N.getString("zp.prjctsync.chooseprojectstoimport")),Timetracker.ZOHOPROJECTS.constructSyncModal(modalParams),1===Timetracker.ZOHOPROJECTS.integDtls.type?Timetracker.ZOHOPROJECTS.populatePortalsList():modalParams.integReportParams?(Timetracker.ZOHOPROJECTS.removeLoadingHtml(!0),Timetracker.util.unfreezeSubmit("zProjectsModal","zp_modal_blubtn")):Timetracker.ZOHOPROJECTS.populateProjectsList(),Timetracker.ZOHOPROJECTS.bindSyncModalEvents(modalParams)},constructSyncModal:function(modalParams){var modal=ZPeople.BSModal.setup({id:"zProjectsModal",type:3,modalClass:"fade ZPmdl",iconClass:"IC-imprt whi S24",iconParenClas:"Icn Tbc orgbgi",header:modalParams.header,body:ZPeople.LOADING_HTML,backdrop:"static"});modal.modal("show");var modalLayout=Layout.Page.container.find("#zProjectsModal");modalLayout.find(".modal-body").removeClass("PL0I"),modalLayout.find(".modal-footer").show(),modal.on("hidden.bs.modal",function(){modalLayout.find("#zp_confirm_body").html("").siblings().remove(),Timetracker.ZOHOPROJECTS.presentSearchResults={}}),Timetracker.ZOHOPROJECTS.setSyncModalText(modalParams),Timetracker.util.freezeSubmit("zProjectsModal","zp_modal_blubtn")},bindSyncModalEvents:function(modalParams){var modalLayout=Layout.Page.container.find("#zProjectsModal");modalParams.integReportParams?modalLayout.find("#zp_modal_blubtn").off("click").on("click",function(){var selectedPortal=modalLayout.find("#tsPortalNames").val();Timetracker.ZOHOPROJECTS.setPortalToProject(modalParams.integReportParams,selectedPortal,modalParams.objID)}):modalLayout.find("#zp_modal_blubtn").off("click").on("click",Timetracker.ZOHOPROJECTS.importFromZohoProjects)},setSyncModalText:function(modalParams){var modalLayout=Layout.Page.container.find("#zProjectsModal");modalParams.header&&modalLayout.find("#zp_modal_header").text(modalParams.header),modalParams.buttontxt&&modalLayout.find("#zp_modal_blubtn").text(modalParams.buttontxt),modalParams.message&&modalLayout.find("#zp_confirm_body").text(modalParams.message)},populatePortalsList:function(modalLayout,modalParams){modalLayout.find("#zProjectsList").hide(),modalLayout.find("#zp_confirm_body").append(ZPeople.LOADING_HTML),modalLayout.find("#projectsCBox").html(""),ZPeople.Request.send(Timetracker.constants.URL,{mode:"getZohoProjectsPortal",skipConfigCheck:!0},function(resultData){if(Timetracker.ZOHOPROJECTS.removeLoadingHtml(!0),!resultData.res||"0"===resultData.res)return Timetracker.util.showAlert(0,ZPI18N.getString("zp.prjctsync.noportalsavailable")),void Layout.Page.container.find("#zProjectsModal").modal("hide");var portalListHtml="<select id='tsPortalNames'><option value='0'>"+ZPI18N.getString("zp.select")+"</option>";$.each(resultData.resArr,function(index,innerdata){portalListHtml+='<option value="'+innerdata.portalId+'">'+innerdata.portalName+"</option>"}),portalListHtml+="</select>",modalLayout.find("#zp_confirm_body").after(portalListHtml),ZPeopleComponents.select(modalLayout.find("#tsPortalNames")),Timetracker.util.freezeSubmit("zProjectsModal","zp_modal_blubtn"),modalLayout.find("#tsPortalNames").off("change").on("zselectchange",function(event){Timetracker.util.removeErrorMsg(void 0,modalLayout,!0),"0"===modalLayout.find("#tsPortalNames").val()?modalLayout.find("#zProjectsList").hide():modalParams.integReportParams?Timetracker.util.unfreezeSubmit("zProjectsModal","zp_modal_blubtn"):(0!==modalLayout.find("#zProjectsList").length&&(modalLayout.find("#projectsCBox").scrollTop(0),modalLayout.find("#zProjectsList").hide()),Timetracker.ZOHOPROJECTS.operations.populateProjectsList(modalLayout),modalLayout.find("#zProjectsList #zProjects_search").val(""))}),modalLayout.find("#zp_modal_blubtn").show()})},operations:{showSyncModal:function(event,modalParams){Timetracker.ZOHOPROJECTS.setIntegDetails().then(function(){Timetracker.ZOHOPROJECTS.operations.showSyncModalPopUp(event,modalParams)})},showSyncModalPopUp:function(event,modalParams){(modalParams=modalParams||{}).buttontxt=modalParams.integReportParams?ZPI18N.getString("zp.create"):ZPI18N.getString("zp.importfiles"),1===Timetracker.ZOHOPROJECTS.integDtls.type?(modalParams.header=ZPI18N.getString("zp.prjctsync.chooseportalheader"),modalParams.integReportParams?modalParams.message=ZPI18N.getString("zp.prjctsync.projectnotexists1"):modalParams.message=ZPI18N.getString("zp.prjctsync.chooseportalandprojectstoimport")):(modalParams.header=Timetracker.ZOHOPROJECTS.integDtls.portalName,modalParams.integReportParams?modalParams.message=ZPI18N.getString("zp.prjctsync.projectnotexists2"):modalParams.message=ZPI18N.getString("zp.prjctsync.chooseprojectstoimport")),modalParams.integReportParams?modalParams.callback=Timetracker.ZOHOPROJECTS.operations.createZProject:modalParams.callback=Timetracker.ZOHOPROJECTS.operations.importFromZohoProjects;var module=Timetracker.ZOHOPROJECTS.operations.constructSyncModal(modalParams);1===Timetracker.ZOHOPROJECTS.integDtls.type?Timetracker.ZOHOPROJECTS.populatePortalsList(module,modalParams):modalParams.integReportParams?(Timetracker.ZOHOPROJECTS.removeLoadingHtml(!0),Timetracker.util.unfreezeSubmit("zProjectsModal","zp_modal_blubtn",module)):Timetracker.ZOHOPROJECTS.operations.populateProjectsList(module)},constructSyncModal:function(modalParams){var body='<div class="zpl_crd"><div class="zpl_crdcnt" id="zpojectbody"><div class="zpl_secn"><div id="zp_confirm_body"><h5>'+modalParams.message+'</h5></div><div id="zProjectsList"><div class="zpl_tbvrt"><div class="zpl_rgtlst"><div class="zpl_tbpne zpl_act"><div class="zpl_popsrch"><div class="zpl_search zpl_srchsml"><input placeholder="'+ZPI18N.getString("zp.mincharsearch",["3"])+'" class="ztextbox" id="zProjects_search"><i class="PI_lens"></i></div></div><ul class="zpl_lstgrp" id="projectsCBox"></ul></div></div></div></div></div></div>',modal=ModuleComp.Modal.setup({id:"zProjectsModal",type:3,header:modalParams.header,body:body,backdrop:!0,closeOnSubmit:!1,params:modalParams,buttonValue:modalParams.buttontxt,hiddenCallback:Timetracker.ZOHOPROJECTS.operations.destroyZComp,successCallback:modalParams.callback,LayerId:settingsPage.container[0].id,closeonEsc:!0});return modal.find(".zpl_mfoter").show(),modalParams.integReportParams&&(modal.find(".zpl_gbox").hide(),modal.find("#zProjectsList").hide()),modal.data("selectedProjects",[]),Layout.Page.container.find("#zProjects_search").off().on("keyup",function(event){if(!event.shiftKey){var searchStr=event.target.value;if(""!=searchStr&&searchStr.trim().length<3)return;$(event.target).attr("value",searchStr),Timetracker.ZOHOPROJECTS.FireScroll.resetFireScroll(searchStr),Layout.Page.container.find("#zProjectsModal #projectsCBox").html(ZPeople.LOADING_HTML),Timetracker.ZOHOPROJECTS.operations.searchAndDisplayProjects(modal,searchStr)}}),Timetracker.util.unfreezeSubmit("zProjectsModal","zp_modal_blubtn",modal),modal},createZProject:function(modalLayout,json){var modparams=json.params,reportParams=modparams.integReportParams;modalLayout.find("#zp_modal_header").text(ZPI18N.getString("zp.prjctsync.creatingproject")),modalLayout.find("#zp_confirm_body ").html(ZPeople.LOADING_HTML),Timetracker.util.freezeSubmit("zProjectsModal","zp_modal_blubtn",modalLayout);var params={mode:"createProjectInZProjects",projectId:reportParams.projectId,userErecNo:reportParams.userErecNo};1===Timetracker.ZOHOPROJECTS.integDtls.type&&(params.zProjectsPortalId=modalLayout.find("#zProjectsModal #tsPortalNames").val()),ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){if(Timetracker.util.unfreezeSubmit("zProjectsModal","zp_modal_blubtn",modalLayout),resultData.res)Timetracker.util.showAlert(2,ZPI18N.getString("zp.prjctsync.zprojectcreated")),Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE),modalLayout.find("#s2id_tsPortalNames").remove(),modalLayout.find("#zp_modal_header").text(ZPI18N.getString("zp.prjctsync.pushingtimelogs")),modalLayout.find(".zpl_mfoter").hide(),reportParams.zProjectsPortalId=resultData.resObj.portalId,reportParams.projectReferenceId=resultData.resObj.projRefId,Timetracker.ZOHOPROJECTS.pushTimelogsToZProjects(reportParams,modparams.objID,!0,settingsPage.container);else{var errorMsg=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);if(Timetracker.util.showAlert(0,errorMsg),1===Timetracker.ZOHOPROJECTS.integDtls.type){Timetracker.ZOHOPROJECTS.removeLoadingHtml(!0,modalLayout);var modalParams={header:ZPI18N.getString("zp.prjctsync.chooseportalheader"),message:ZPI18N.getString("zp.prjctsync.projectnotexists1")};Timetracker.ZOHOPROJECTS.setSyncModalText(modalParams)}else ModuleComp.Modal.hide("zProjectsModal")}})},searchAndDisplayProjects:function(modal,searchStr){null!==Timetracker.ZOHOPROJECTS.presentSearchResults&&void 0!==Timetracker.ZOHOPROJECTS.presentSearchResults[searchStr]?(modal.find("#zProjectsModal #projectsCBox").html(""),modal.find("#projectsCBox").removeClass("zpl_ddnorcrd"),Timetracker.ZOHOPROJECTS.removeLoadingHtml(!0,modal),0!=Timetracker.ZOHOPROJECTS.presentSearchResults[searchStr].length?Timetracker.ZOHOPROJECTS.operations.constructProjectRow(Timetracker.ZOHOPROJECTS.presentSearchResults[searchStr],searchStr):""==searchStr?(Timetracker.util.removeErrorMsg(void 0,modal,!0),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#zp_confirm_body"),msg:ZPI18N.getString("zp.prjctsync.noprojectsavailable")}),modal.find("#zp_modal_blubtn").addClass("disabled")):(Timetracker.util.removeErrorMsg(void 0,modal,!0),modal.find("#projectsCBox").html("<div><span>"+ZPI18N.getString("zp.prjctsync.noprojectsfound")+"</span></div>"),modal.find("#projectsCBox").addClass("zpl_ddnorcrd"))):Timetracker.ZOHOPROJECTS.operations.populateSearchProjectsList(modal,searchStr)},populateSearchProjectsList:function(modal,searchStr){var params={mode:"getZohoProjectsList"};params=Timetracker.ZOHOPROJECTS.FireScroll.setFireScrollParams(params,searchStr),1===Timetracker.ZOHOPROJECTS.integDtls.type&&(params.zProjectsPortalId=Layout.Page.container.find("#zProjectsModal #tsPortalNames").val()),params.searchStr=searchStr,ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){resultData.searchStr=params.searchStr,Timetracker.ZOHOPROJECTS.operations.populateProjectsListCallback(resultData,modal)})},populateProjectsList:function(module){Timetracker.ZOHOPROJECTS.FireScroll.resetFireScroll();var params={mode:"getZohoProjectsList"};params=Timetracker.ZOHOPROJECTS.FireScroll.setFireScrollParams(params),1===Timetracker.ZOHOPROJECTS.integDtls.type&&(params.zProjectsPortalId=Layout.Page.container.find("#zProjectsModal #tsPortalNames").val()),module.find("#zpojectbody").find(".zpl_secn").addClass("zpl_DNI"),module.find("#zpojectbody").append(ZPeople.LOADING_HTML),ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){Timetracker.ZOHOPROJECTS.operations.populateProjectsListCallback(resultData,module)})},populateProjectsListCallback:function(resultData,layout){Timetracker.ZOHOPROJECTS.removeLoadingHtml(!0,layout),layout.find("#zp_modal_blubtn").removeClass("disabled");var searchStr=resultData.searchStr?resultData.searchStr:"";if(resultData.res&&"0"!==resultData.res){layout.find("#zpojectbody").find(".zpl_secn").removeClass("zpl_DNI");var zProjectsArr=resultData.resArr;if(Timetracker.ZOHOPROJECTS.presentSearchResults[searchStr]=zProjectsArr,0===zProjectsArr.length)return""==searchStr?(layout.find("#zProjectsList").hide(),Timetracker.util.removeErrorMsg(void 0,layout,!0),Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#zp_confirm_body"),msg:ZPI18N.getString("zp.prjctsync.noprojectsavailable")}),void layout.find("#zp_modal_blubtn").addClass("disabled")):(Timetracker.util.removeErrorMsg(void 0,layout,!0),layout.find("#projectsCBox").html("<div><span>"+ZPI18N.getString("zp.prjctsync.noprojectsfound")+"</span></div>"),void layout.find("#projectsCBox").addClass("zpl_ddnorcrd"));ZPeople.FireScroll.init(Timetracker.ZOHOPROJECTS.FireScroll.triggerFireScroll,"",{mode:Timetracker.ZOHOPROJECTS.FireScroll.MODE,scrollDiv:layout.find("#projectsCBox")},!0),layout.find("#zProjectsList").show(),layout.find("#projectsCBox").html(""),layout.find("#projectsCBox").removeClass("zpl_ddnorcrd"),Timetracker.ZOHOPROJECTS.operations.constructProjectRow(zProjectsArr,searchStr,layout),Timetracker.util.unfreezeSubmit("zProjectsModal","zp_modal_blubtn"),Timetracker.ZOHOPROJECTS.fetch_count=zProjectsArr.length}else{var errorMsg=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg)}},constructProjectRow:function(zProjectsArr,searchStr,layout){layout=layout||settingsPage.container.find("#zProjectsModal");var isAllProject=""==(searchStr=searchStr||""),zProjectsListDiv="",selectedProjects=layout.data("selectedProjects"),disabled=(selectedProjects=selectedProjects||[]).length>24;$.each(zProjectsArr,function(index,zProjectObj){var projid=isAllProject?zProjectObj.id_string:zProjectObj.id,html='<li><div class="zcheckbox"><input type="checkbox" id="'+projid+'" class="zcheckbox__helper" onclick="Timetracker.ZOHOPROJECTS.operations.checkSelectedProjects(this);"';-1!=selectedProjects.indexOf(projid)?html+=' checked="true"':disabled&&(html+=' disabled="true"'),html+='><label class="zcheckbox__label" for="'+projid+'">'+ZPeople.escapeHtml(zProjectObj.name)+"</label></div></li>",(zProjectsListDiv=$(html)).find("input").data("pDtl",projid),layout.find("#projectsCBox").append(zProjectsListDiv)}),0!==zProjectsArr.length&&(Timetracker.ZOHOPROJECTS.FireScroll.FETCH_COUNT[searchStr]+=zProjectsArr.length),zProjectsArr.length===Timetracker.ZOHOPROJECTS.FireScroll.MAX_FETCH_COUNT?ZPeople.FireScroll.reset(Timetracker.ZOHOPROJECTS.FireScroll.MODE):ZPeople.FireScroll.setParam("triggered",!0,Timetracker.ZOHOPROJECTS.FireScroll.MODE)},checkSelectedProjects:function(ele){var layout=settingsPage.container.find("#zProjectsModal");layout.find("#errMsg").remove();var selectedProjects=layout.data("selectedProjects");if(selectedProjects=selectedProjects||[],$(ele).is(":checked")){(projId=$(ele).data("pDtl"))&&selectedProjects.push(projId)}else{var projId=$(ele).data("pDtl"),index=selectedProjects.indexOf(projId);-1!=index&&selectedProjects.splice(index,1)}selectedProjects.length>24?(0===layout.find("#projectCountExceedError").length&&(Timetracker.util.removeErrorMsg(void 0,layout,!0),Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#projectsCBox"),msg:ZPI18N.getString("zp.prjctsync.importcountrestriction"),errorDivId:"projectCountExceedError"}),layout.find("#projectCountExceedError").addClass("zpl_errchsproj")),layout.find("#projectsCBox").find("input:checkbox:not(:checked)").each(function(index,obj){$(obj).attr("disabled",!0)})):(Timetracker.util.removeErrorMsg(void 0,layout,!0),layout.find("#projectsCBox").find('[type="checkbox"]:disabled').each(function(index,obj){$(obj).removeAttr("disabled")})),layout.data("selectedProjects",selectedProjects)},importFromZohoProjects:function(){var modalLayout=settingsPage.container.find("#zProjectsModal"),selectedProjectRefIds="",selectedProjects=modalLayout.data("selectedProjects");if((selectedProjects=selectedProjects||[]).length>0&&(selectedProjectRefIds=selectedProjects.join(",")),""!==selectedProjectRefIds){var params={mode:"syncWithZohoProjects",projectRefIds:selectedProjectRefIds};1===Timetracker.ZOHOPROJECTS.integDtls.type&&(params.zProjectsPortalId=modalLayout.find("#zProjectsModal #tsPortalNames").val()),modalLayout.find("#zp_modal_header").text(ZPI18N.getString("zp.importing")),modalLayout.find("#zp_confirm_body").html(ZPeople.LOADING_HTML),modalLayout.find("#zProjectsList, #errMsg, #projectCountExceedError").remove(),Timetracker.util.freezeSubmit(void 0,"zp_modal_blubtn",modalLayout),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(Timetracker.ZOHOPROJECTS.removeLoadingHtml(!0,modalLayout),!response.res||"0"===response.res){var errorMsg=Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0);return Timetracker.util.showAlert(0,errorMsg),void Timetracker.Util.showHideNoData({remove:!0})}Timetracker.util.showAlert(2,ZPI18N.getString("zp.prjctsync.syncsuccess")),Timetracker.ZOHOPROJECTS.operations.displayImportStats(response.resObj),response.resObj.hasOwnProperty("noChanges")||Timetracker.ZOHOPROJECTS.reloadProjectsAndJob()})}else 0===modalLayout.find("#errMsg").length&&(Timetracker.util.removeErrorMsg(void 0,modalLayout,!0),Timetracker.Util.appenErrorMsgForElem({obj:modalLayout.find("#projectsCBox"),msg:ZPI18N.getString("zp.prjctsync.noprojectsselected"),errorDivId:"impErr"}),modalLayout.find("#impErr").addClass("zpl_errchsproj"))},displayImportStats:function(response){var modalLayout=settingsPage.container.find("#zProjectsModal");modalLayout.find(".zpl_mfoter").hide(),modalLayout.find("#zProjectsModal #s2id_tsPortalNames").remove();var modalBody=modalLayout.find("#zpojectbody");response.hasOwnProperty("portalName")?modalLayout.find("#zp_modal_header").text(response.portalName):modalLayout.find("#zp_modal_header").text(ZPI18N.getString("zp.ImportSummary"));if(modalBody.html('<div class="zpl_secn"><div><h5 id="statHeader"></h5></div><div id="statListId" class="zpl_imppjbx"></div></div>'),response.hasOwnProperty("importSummary")){modalBody.find("#statHeader").html(ZPI18N.getString("zp.prjctsync.importsummaryinfo"));var zprjctDtl=response.importSummary;0!==zprjctDtl.length&&$.each(zprjctDtl,function(index,data){var list='<div class="zpl_gbox"><table class="zpl_itbl zpl_nocrsor"><tbody><tr><td colspan="2"><b>'+data.projectName+"</b></td></tr><tr><td><em>"+ZPI18N.getString("zp.prjctsync.modified")+'</em></td><td><span class="blu">'+data.tasksModifyCount+" "+ZPI18N.getString("zp.tasks")+"</span></td></tr><tr><td><em>"+ZPI18N.getString("zp.added")+'</em></td><td><span class="blu">'+data.tasksAddCount+" "+ZPI18N.getString("zp.tasks")+"</span></td></tr></tbody></table></div>";modalBody.find("#statListId").append(list)})}else response.hasOwnProperty("noChanges")&&modalBody.find("#statHeader").html(ZPI18N.getString("zp.prjctsync.nonewprojectstoimport"))},destroyZComp:function(){var modal=settingsPage.container.find("#zProjectsModal");0!=modal.find("#tsPortalNames").length&&ZPeopleComponents.select(modal.find("#tsPortalNames")).destroy()}},importFromZohoProjects:function(){var selectedProjectRefIds="";if(Layout.Page.container.find(".ZPFnoti").find('[type="checkbox"]:checked').each(function(index,obj){var data=$(obj).parent().parent().data("pDtl");data&&(selectedProjectRefIds+=data+",")}),""!==selectedProjectRefIds){var params={mode:"syncWithZohoProjects",projectRefIds:selectedProjectRefIds};1===Timetracker.ZOHOPROJECTS.integDtls.type&&(params.zProjectsPortalId=Layout.Page.container.find("#zProjectsModal #tsPortalNames").val());var modalLayout=Layout.Page.container.find("#zProjectsModal");modalLayout.find("#zp_modal_header").text(ZPI18N.getString("zp.importing")),modalLayout.find("#zp_confirm_body ").html(ZPeople.LOADING_HTML),modalLayout.find("#projectsListBox").hide(),modalLayout.find("#errMsg, #projectCountExceedError").remove(),Timetracker.util.freezeSubmit("zProjectsModal","zp_modal_blubtn"),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(Timetracker.ZOHOPROJECTS.removeLoadingHtml(!0),!response.res||"0"===response.res){var errorMsg=Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0);return Timetracker.util.showAlert(0,errorMsg),void modalLayout.modal("hide")}Timetracker.util.showAlert(2,ZPI18N.getString("zp.prjctsync.syncsuccess")),Timetracker.ZOHOPROJECTS.displayImportStats(response.resObj),response.resObj.hasOwnProperty("noChanges")||Timetracker.ZOHOPROJECTS.reloadProjectsAndJob()})}else 0===Layout.Page.container.find("#errMsg").length&&Layout.Page.container.find("#projectsCBox").after('<div id="errMsg" class="error-msg CentSelect MT20 MB10">'+ZPI18N.getString("zp.prjctsync.noprojectsselected")+"</div>")},displayImportStats:function(response){Layout.Page.container.find(".modal-footer").hide(),Layout.Page.container.find("#zProjectsModal #s2id_tsPortalNames").remove();var modalBody=Layout.Page.container.find("#zProjectsModal #zp_confirm_body");response.hasOwnProperty("portalName")?Layout.Page.container.find("#zProjectsModal").find("#zp_modal_header").text(response.portalName):Layout.Page.container.find("#zProjectsModal").find("#zp_modal_header").text(ZPI18N.getString("zp.ImportSummary"));var importSummaryDiv='<div id="importStat" class="ZPimpList"><ul id="statListId" class="list MT20"></ul></div>';if(modalBody.html(importSummaryDiv),importSummaryDiv=modalBody.find("#importStat"),response.hasOwnProperty("importSummary")){modalBody.text(ZPI18N.getString("zp.prjctsync.importsummaryinfo")).after(importSummaryDiv);var zprjctDtl=response.importSummary;0!==zprjctDtl.length&&$.each(zprjctDtl,function(index,data){var list=$('<li><div class="list_span"><div class="MB5">'+data.projectName+'</div><div class="list-spandev pull-right"><em class="W80 FL">'+ZPI18N.getString("zp.prjctsync.modified")+"</em><span>"+data.tasksModifyCount+" "+ZPI18N.getString("zp.tasks")+'</span><div class="list-spandev"><em class="W80 FL">'+ZPI18N.getString("zp.added")+"</em><span>"+data.tasksAddCount+" "+ZPI18N.getString("zp.tasks")+"</span></div></li>");Layout.Page.container.find("#statListId").append(list)})}else response.hasOwnProperty("noChanges")&&modalBody.text(ZPI18N.getString("zp.prjctsync.nonewprojectstoimport")).after(importSummaryDiv)},reloadProjectsAndJob:function(){Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE),Timetracker.cache.clearCache(Timetracker.constants.JOB_TABLE),Timetracker.views.isSystemView()?Timetracker.projects.Listing.initProjectList():ZP5Views.refreshview(!0)},setPortalToProject:function(reportParams,objID){var modalLayout=Layout.Page.container.find("#zProjectsModal");modalLayout.find("#zp_modal_header").text(ZPI18N.getString("zp.prjctsync.creatingproject")),modalLayout.find("#zp_confirm_body ").html(ZPeople.LOADING_HTML),Timetracker.util.freezeSubmit("zProjectsModal","zp_modal_blubtn");var params={mode:"createProjectInZProjects",projectId:reportParams.projectId,userErecNo:reportParams.userErecNo};1===Timetracker.ZOHOPROJECTS.integDtls.type&&(params.zProjectsPortalId=Layout.Page.container.find("#zProjectsModal #tsPortalNames").val()),ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){if(Timetracker.util.unfreezeSubmit("zProjectsModal","zp_modal_blubtn"),resultData.res)Timetracker.util.showAlert(2,ZPI18N.getString("zp.prjctsync.zprojectcreated")),Timetracker.cache.clearCache(Timetracker.constants.PROJECT_TABLE),modalLayout.find("#s2id_tsPortalNames").remove(),modalLayout.find("#zp_modal_header").text(ZPI18N.getString("zp.prjctsync.pushingtimelogs")),modalLayout.find(".modal-footer").hide(),reportParams.zProjectsPortalId=resultData.resObj.portalId,reportParams.projectReferenceId=resultData.resObj.projRefId,Timetracker.ZOHOPROJECTS.pushTimelogsToZProjects(reportParams,objID,!0);else{var errorMsg=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);if(Timetracker.util.showAlert(0,errorMsg),1===Timetracker.ZOHOPROJECTS.integDtls.type){Timetracker.ZOHOPROJECTS.removeLoadingHtml(!0);var modalParams={header:ZPI18N.getString("zp.prjctsync.chooseportalheader"),message:ZPI18N.getString("zp.prjctsync.projectnotexists1")};Timetracker.ZOHOPROJECTS.setSyncModalText(modalParams)}else modalLayout.modal("hide")}})},pushTimelogsToZProjects:function(params,objID,reloadPage,layout){(layout=layout||Layout.Page.container).find(objID).removeClass("zlabel--blue"),$.post(Timetracker.constants.URL,params,function(resultData){resultData&&resultData.isSuccess&&Timetracker.util.showAlert(2,ZPI18N.getString("zp.prjctsync.pushtimelogsscheduled",["Zoho Projects"])),reloadPage&&(-1!==Layout.Page.hash.indexOf("reports/admin/timetracker/integration")?ZPLite.Reports.Timetracker.integrationReport.generateReport():-1!==Layout.Page.hash.indexOf("operations/timetracker/integration")?TimetrackerOperations.integrations.generateReport():Timetracker.reports.integrationReport.util.reportGeneration(!1)),Timetracker.util.removeLoading()})},isZProjectsPushAllowed:function(isZProjectsIntegEnabled,pushAllowTLCnt,pushedCnt){return Timetracker.isDataAdmin()&&isZProjectsIntegEnabled&&!(0==pushAllowTLCnt&&0==pushedCnt)},checkAndAddPushIcon:function(layout,sheetId,isZProjectsIntegEnabled,pushAllowTLCnt,pushedCnt){if(Timetracker.ZOHOPROJECTS.isZProjectsPushAllowed(isZProjectsIntegEnabled,pushAllowTLCnt,pushedCnt)){var isPushedAlready=0==pushAllowTLCnt,zpPushLayout=layout.find("#ts_zp");if(0===zpPushLayout.length){var pushHtml='<button id="ts_zp" class="zpl_drpdwn-js zlabel zlabel--outline zlabel--medium">'+(isPushedAlready?ZPI18N.getString("zp.pushedto",[""]):ZPI18N.getString("zp.pushto"))+" "+Timetracker.constants.integration.zprjct+"</button>";layout.find(".zpl_mhderrgt").prepend($(pushHtml)),zpPushLayout=layout.find("#ts_zp")}zpPushLayout.removeClass("disabled"),zpPushLayout.off("click").on("click",function(){Timetracker.ZOHOPROJECTS.pushTimelogsFromTS(layout,sheetId,isPushedAlready,!0)})}},pushTimelogsFromTS:function(layout,sheetId,isPushedAlready,isButton){if(isPushedAlready)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.zbtimelogpushedalready")),!1;var zpPushLayout=layout.find("#ts_zp");zpPushLayout.addClass("disabled");var parentLayout=layout.parent();parentLayout.find(".zpl_mcnt").children().hide(),Timetracker.util.appendLoading(null,{type:"popup",containerId:"timesheet_create",containerClass:"modal-body"});var params={mode:"pushTimelogsToOtherService",service:Timetracker.constants.integration.zprjct,timesheetId:sheetId,conreqcsr:csrfToken};$.post(Timetracker.constants.URL,params,function(result){Timetracker.util.removeLoading(),parentLayout.find(".zpl_mcnt").children().show(),result&&result.isSuccess?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.prjctsync.pushtimelogsscheduled",["Zoho Projects"])),isButton&&zpPushLayout.text(ZPI18N.getString("zp.pushingto",[Timetracker.constants.integration.zprjct]))):result&&result.message?Timetracker.util.showAlert(0,result.message):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg"))})},FireScroll:{MODE:"ZProjectsList",FETCH_COUNT:{"":1},MAX_FETCH_COUNT:25,resetFireScroll:function(searchStr){searchStr=searchStr||"",Timetracker.ZOHOPROJECTS.FireScroll.FETCH_COUNT[searchStr]=1,ZPeople.FireScroll.reset(Timetracker.ZOHOPROJECTS.FireScroll.MODE)},setFireScrollParams:function(params,searchStr){return searchStr=searchStr||"",params.index=Timetracker.ZOHOPROJECTS.FireScroll.FETCH_COUNT[searchStr],params.range=Timetracker.ZOHOPROJECTS.FireScroll.MAX_FETCH_COUNT,params},triggerFireScroll:function(){Timetracker.ZOHOPROJECTS.setIntegDetails().then(function(){var params={mode:"getZohoProjectsList"},searchStr=Layout.Page.container.find("#zProjectsModal #zProjects_search").attr("value");searchStr&&(params.searchStr=searchStr),params=Timetracker.ZOHOPROJECTS.FireScroll.setFireScrollParams(params,searchStr),1===Timetracker.ZOHOPROJECTS.integDtls.type&&(params.zProjectsPortalId=Layout.Page.container.find("#zProjectsModal #tsPortalNames").val()),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.ZOHOPROJECTS.FireScroll.constructDataOnFireScroll)})},constructDataOnFireScroll:function(resultData,params){searchStr=params.searchStr?params.searchStr:"";var zProjectsArr=resultData.res?resultData.resArr:[];Timetracker.ZOHOPROJECTS.operations.constructProjectRow(zProjectsArr,searchStr)}},destroyZComp:function(){var modal=settingsPage.container.find("#zprojectsconfigSlider");modal.find("select").each(function(){ZPeopleComponents.select(modal.find("#"+$(this).attr("id"))).destroy()}),modal.find("input").each(function(){ZPeopleComponents.toggleswitch(modal.find("#"+$(this).attr("id"))).destroy()})}},Timetracker.ZBooksInvoice=function(){"use strict";var util=function(){function isZBooks(service){return"ZBooks"===service}function isZInvoice(service){return"ZInvoice"===service}return{isZBooksOrInvoice:function(service){return isZBooks(service)||isZInvoice(service)},getNameByService:function(service){return isZBooks(service)?Timetracker.constants.integration.zb:isZInvoice(service)?Timetracker.constants.integration.zi:service},getShortNameByService:function(service){return isZBooks(service)?"books":isZInvoice(service)?"invoice":service},getImgByService:function(service){if(Timetracker.Util.isVersionFive()){if(isZBooks(service))return"zb";if(isZInvoice(service))return"zinv"}else{if(isZBooks(service))return"zbooksImg";if(isZInvoice(service))return"zinvc-img"}return null},configureButtonTxt:function(isEnable,service){var isV5=Timetracker.Util.isVersionFive(),modal=isV5?settingsPage.container.find("#zp_zfinance_integ_outer"):Layout.Page.container.find("#zp_zfinance_integ_outer"),configureBtn=isV5?modal.find("div.zpl_catlst a[id=configbtn][service="+service+"]"):modal.find("div.prodrow button[id=configbtn][service="+service+"]"),comp=isV5?"a":"button";$(configureBtn).parents("div#zp_zinfinance_integ_body_outer").find(comp+"[id=configbtn][service=ZBooks],"+comp+"[id=configbtn][service=ZInvoice]").addClass("disabled");var text=ZPI18N.getString("zp.configure");isEnable?(text=ZPI18N.getString("zp.edit")+"/"+ZPI18N.getString("zp.revoke"),$(configureBtn).removeClass("disabled")):$(configureBtn).parents("div#zp_zinfinance_integ_body_outer").find(comp+"[id=configbtn][service=ZBooks],"+comp+"[id=configbtn][service=ZInvoice]").removeClass("disabled"),$(configureBtn).text(text),$(configureBtn).attr("service",service),$(configureBtn).prop("onclick",null).off("click").on("click",function(){isEnable?Timetracker.ZBooksInvoice.viewZBooksInvoiceIntegration(this):Timetracker.ZBooksInvoice.configureZBooksInvoiceIntegration(this)});var outerconfigureBtn=isV5?settingsPage.container.find("div.zpl_crdlst div.zpl_intelst a[name=ZohoFinance][id=config_btn]"):Layout.Page.container.find("div#integ_services div[name='integ'] a[name=ZohoFinance][id=config_btn]"),serviceDtls=$(outerconfigureBtn).data("serviceDtls");serviceDtls&&serviceDtls.ZohoBooksInvoice&&(isEnable?(serviceDtls.ZohoBooksInvoice.c=1,serviceDtls.ZohoBooksInvoice.service=service):(serviceDtls.ZohoBooksInvoice.c=0,delete serviceDtls.ZohoBooksInvoice.service),$(outerconfigureBtn).data("serviceDtls",serviceDtls))},enableDisableConfigureButton:function(disableType,thisObj){var configureBtn=thisObj;disableType===Timetracker.constants.integration.DISABLE_CURRENT?$(configureBtn).addClass("disabled"):disableType===Timetracker.constants.integration.ENABLE_CURRENT&&$(configureBtn).removeClass("disabled")},showConfigurePage:function(isV5){isV5?(Timetracker.ZBooksInvoice.Modal.modalObj.close(),settingsPage.container.find("#zp_zfinance_integ_outer").addClass("zpl_mopen")):(ZPeople.BSModal.hide("zp_zfinance_integ"),ZPeople.BSModal.show(Layout.Page.container.find("#zp_zfinance_integ_outer")))}}}();function onChoosingService(thisObj,service){var result=$(thisObj).data("result");if(service=Timetracker.Validations.isDefiniteValue(service)?service:$(thisObj).attr("service"),void 0!==result)onChoosingServiceCallback(result,{service:service});else{var isV5=Timetracker.Util.isVersionFive();$("#zp_zinfinance_integ_body_outer").hide(),Timetracker.util.appendLoading(isV5?"zp_zfinance_integ_card":"zp_modal_body",{type:"popup",containerId:"zp_zfinance_integ_outer",isV5:isV5}),ZPeople.Request.send(Timetracker.constants.URL,{mode:"getZBooksOrganisations",service:service,conreqcsr:csrfToken},onChoosingServiceCallback)}}function onChoosingServiceCallback(result,params){var isV5=Timetracker.Util.isVersionFive();Timetracker.util.removeErrorMsg("zp_zfinance_integ_outer");var integOuterLayout=isV5?settingsPage.container.find("#zp_zfinance_integ_outer"):Layout.Page.container.find("#zp_zfinance_integ_outer");Timetracker.util.removeLoading(integOuterLayout),integOuterLayout.find("#zp_zinfinance_integ_body_outer").fadeIn(100);var service=params.service;integOuterLayout.find(".zpl_catlst[service="+service+"]").find("a").data("result",result),null!=result?result.message?IntegrationSettings.unifiedUi?ZDServiceCommunicationImpl.trigger("notifyFailure",{message:result.message}):Timetracker.util.showAlert(0,result.message):result.orgArray?function(service,orgArray){for(var orgHtml=$("<div/>"),addedOrgCnt=0,i=0;i<orgArray.length;i++){var orgobj=orgArray[i],org_joined_app_list=orgobj.org_joined_app_list;if(org_joined_app_list&&-1!==org_joined_app_list.indexOf(util.getShortNameByService(service))){var createdDate=orgobj.account_created_date_formatted?orgobj.account_created_date_formatted:"-",currency=orgobj.currency_code?orgobj.currency_code:"-";Timetracker.Util.isVersionFive()?orgHtml.append('<div class="prtl'+(0===i?" active":"")+'" orgId="'+orgobj.organization_id+'"><h5 id="org_name"></h5><div class="zpl_secn"><table><tbody><tr><td width="120">'+ZPI18N.getString("zp.createddate")+"</td><td>:</td><td>"+createdDate+'</td></tr><tr><td width="120">'+ZPI18N.getString("zp.currencytype")+"</td><td>:</td><td>"+currency+"</td></tr></tbody></table></div>"):orgHtml.append('<div class="zpdtinr MR30 MT10 ZFOrg '+(0===i?"active":"")+'" orgId="'+orgobj.organization_id+'"><h5 id="org_name"></h5><p><label>'+ZPI18N.getString("zp.createddate")+" :</label><span>"+createdDate+"</span></p><p><label>"+ZPI18N.getString("zp.currencytype")+" :</label><span>"+currency+"</span></p></div>"),orgHtml.find("div[orgId="+orgobj.organization_id+"] h5#org_name").text(orgobj.name),addedOrgCnt++}}if(0!==addedOrgCnt){!function(service){if(Timetracker.Util.isVersionFive()){Timetracker.ZBooksInvoice.Modal&&Timetracker.ZBooksInvoice.Modal.modalObj&&Timetracker.ZBooksInvoice.Modal.modalObj.remove();var dispName=util.getNameByService(service),bodyHtml=(ZPI18N.getString("zp.integration"),'<div id="zp_zinfinance_integ_body" class="zpl_crd"><div class="zpl_crdhdr"><div class="zpl_intelst cstm_intlst"><div class="'+util.getImgByService(service)+'"></div><span><h4>'+dispName+"</h4><p>"+ZPI18N.getString("zp.zbselectdesc",[dispName])+' </p></span></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><h5><em>'+ZPI18N.getString("zp.organizationtointegrate")+'</em></h5><div id="prtl_lstDiv" class="prtl_lst"></div></div><div class="zpl_secn"><div><div class="zpl_tgl"><input id="zp_zfinance_sync" class="togbutton-js" style="display: none;"> '+ZPI18N.getString("zp.zbautosyncdesc")+"</div></div></div></div></div>");Timetracker.ZBooksInvoice.Modal={},Timetracker.ZBooksInvoice.Modal.validate=Timetracker.ZBooksInvoice.enableZBooksInvoiceIntegration,Timetracker.ZBooksInvoice.Modal.id="zfinconfigSlider",Timetracker.ZBooksInvoice.Modal.cardId="zfinconfigSliderCard",Timetracker.ZBooksInvoice.Modal.callback=function(){settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.cardId).html(bodyHtml)},Timetracker.ZBooksInvoice.Modal.modalObj=new sliderModal(dispName+" "+ZPI18N.getString("zp.integration"),Timetracker.ZBooksInvoice.Modal),Timetracker.ZBooksInvoice.Modal.modalObj.cntExtraCls="intgrtion_con",Timetracker.ZBooksInvoice.Modal.modalObj.save=ZPI18N.getString("zp.enable"),Timetracker.ZBooksInvoice.Modal.modalObj.construct(),Timetracker.Integration.Util.ZOneUIhandling(settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.id),Timetracker.ZBooksInvoice.Modal.cardId),ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.cardId).find("#zp_zfinance_sync"),{on:!1})}else{Layout.Page.container.find("#zp_zfinance_integ").remove();var dispName=util.getNameByService(service),header='<a class="MR5" onclick="Timetracker.ZBooksInvoice.util.showConfigurePage();"><i class="IC-ar-lft S18 FL blu"></i></a>'+dispName+" "+ZPI18N.getString("zp.integration"),bodyHtml='<div id="zp_zinfinance_integ_body" class="zohoProd"><p>'+ZPI18N.getString("zp.zbselectdesc",[dispName])+'</p><div class="fin-products"><h5><div class="'+util.getImgByService(service)+' MR10 FL"></div>'+dispName+'</h5><div class="zbooksDiv ZFOrgs" id="prtl_lstDiv"><div class="ZFError clearfix"></div></div><div class="syncLbl FL W100"><div class="btnactive"><label class="FL W400">'+ZPI18N.getString("zp.zbautosyncdesc")+'</label><input id="zp_zfinance_sync" class="cmn-toggle-small cmn-toggle-round-small" type="checkbox"><label for="zp_zfinance_sync" class="M0"></label></div></div>';ZPeople.BSModal.get({modalClass:"popRgtModel ZPsecModal finIntg",id:"zp_zfinance_integ",type:2,bodyClass:"P20",header:header,body:bodyHtml,buttonValue:ZPI18N.getString("zp.enable"),successCallback:Timetracker.ZBooksInvoice.enableZBooksInvoiceIntegration,extraDtls:{service:service}})}}(service);var integLayout=Timetracker.Util.isVersionFive()?settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.cardId):Layout.Page.container.find("#zp_zfinance_integ");integLayout.find("#prtl_lstDiv").append($(orgHtml)).data("service",service),integLayout.find(Timetracker.Util.isVersionFive()?".prtl":".ZFOrg").off("click").on("click",function(){$(this).addClass("active").siblings().removeClass("active")}),Timetracker.Util.isVersionFive()||ZPeople.BSModal.show(integLayout)}else IntegrationSettings.unifiedUi?ZDServiceCommunicationImpl.trigger("notifyFailure",{message:ZPI18N.getString("zp.zbnoorgfound",[util.getNameByService(service)])}):Timetracker.util.showAlert(0,ZPI18N.getString("zp.zbnoorgfound",[util.getNameByService(service)]))}(service,result.orgArray):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg")):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg"))}function viewZBooksInvoiceIntegration(thisObj,service){util.enableDisableConfigureButton(Timetracker.constants.integration.DISABLE_CURRENT,thisObj),(service=null!==thisObj?$(thisObj).attr("service"):service)&&util.isZBooksOrInvoice(service)?ZPeople.Request.send(Timetracker.constants.URL,{mode:"getIntegrationDetails",service:service,conreqcsr:csrfToken},viewZBooksInvoiceIntegrationCallback):(Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg")),util.enableDisableConfigureButton(Timetracker.constants.integration.ENABLE_CURRENT,thisObj))}function viewZBooksInvoiceIntegrationCallback(result,params){null!=result?result.message?IntegrationSettings.unifiedUi?ZDServiceCommunicationImpl.trigger("notifyFailure",{message:result.message}):Timetracker.util.showAlert(0,result.message):result.integDtls?constructZBooksInvoiceViewModal(result.integDtls):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg")):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg")),util.enableDisableConfigureButton(Timetracker.constants.integration.ENABLE_CURRENT,Timetracker.Util.isVersionFive()?settingsPage.container.find("div#zp_zfinance_integ_outer div.zpl_catlst a[id=configbtn][service="+params.service+"]"):Layout.Page.container.find("#zp_zfinance_integ_outer").find(".prodrow[service="+params.service+"]").find("button"))}function constructZBooksInvoiceViewModal(integDetails){var service=integDetails.service,serviceName=util.getNameByService(service),icon=util.getImgByService(service),integType=integDetails.integTypeCode;if(Timetracker.Util.isVersionFive()){Timetracker.ZBooksInvoice.Modal&&Timetracker.ZBooksInvoice.Modal.modalObj.remove();var dispName=util.getNameByService(service),bodyHtml=(ZPI18N.getString("zp.integration"),'<div id="zp_zinfinance_integ_body" class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div class="prtl_enbld"><h5 class="prtl_hd">'+serviceName+'</h5><div class="prtl_logo zpl_intelst cstm_intlst"><div class="'+icon+'"></div></div><div class="prtl_cont"><div class="zpl_secn"><h5>'+(integDetails.orgName?integDetails.orgName:"")+'</h5></div><div class="zpl_secn"><table><tbody><tr><td width="120">'+ZPI18N.getString("zp.currencytype")+"</td><td>:</td><td>"+(integDetails.orgCurrencyCode?integDetails.orgCurrencyCode:"")+'</td></tr></tbody></table></div><div class="btn_cntr"><button type="button" id="zp_zfinance_revoke" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.revoke")+'</button></div><div class="zpl_secn"><div><div class="zpl_tgl"><input id="zp_zfinance_sync" integtype="'+integType+'" class="togbutton-js" style="display: none;">'+ZPI18N.getString("zp.zbautosyncdesc")+"</div></div></div></div></div></div></div></div>");Timetracker.ZBooksInvoice.Modal={},Timetracker.ZBooksInvoice.Modal.validate=Timetracker.ZBooksInvoice.enableZBooksInvoiceIntegration,Timetracker.ZBooksInvoice.Modal.id="zfinconfigSlider",Timetracker.ZBooksInvoice.Modal.cardId="zfinconfigSliderCard",Timetracker.ZBooksInvoice.Modal.callback=function(){settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.cardId).html(bodyHtml)},Timetracker.ZBooksInvoice.Modal.modalObj=new sliderModal(dispName+" "+ZPI18N.getString("zp.integration"),Timetracker.ZBooksInvoice.Modal),Timetracker.ZBooksInvoice.Modal.modalObj.cntExtraCls="intgrtion_con",Timetracker.ZBooksInvoice.Modal.modalObj.save=ZPI18N.getString("zp.enable"),Timetracker.ZBooksInvoice.Modal.modalObj.ftExtraCls="zpl_DNI",Timetracker.ZBooksInvoice.Modal.modalObj.construct(),Timetracker.Integration.Util.ZOneUIhandling(settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.id),Timetracker.ZBooksInvoice.Modal.cardId),ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.cardId).find("#zp_zfinance_sync"),{on:!1})}else{Layout.Page.container.find("#zp_zfinance_integ").remove();var header='<a class="MR5" onclick="Timetracker.ZBooksInvoice.util.showConfigurePage();"><i class="IC-ar-lft S18 FL blu"></i></a>'+Timetracker.constants.integration.zb+"/"+Timetracker.constants.integration.zi+" "+ZPI18N.getString("zp.integration");bodyHtml='<div id="zp_zinfinance_integ_body" class="prodConfirm"><div class="con-item ZFError"><h5 class="con-itemHd"> '+serviceName+'</h5><div class="prod-logo"><div class="'+icon+'"></div></div><div class="con-item-sec"><p>'+(integDetails.orgName?integDetails.orgName:"")+"</p><p><label>"+ZPI18N.getString("zp.currencytype")+":</label><span> "+(integDetails.orgCurrencyCode?integDetails.orgCurrencyCode:"")+'</span></p><button id="zp_zfinance_revoke" class="btn btn-default revoke">'+ZPI18N.getString("zp.revoke")+'</button><div class="btnactive"><label class="WP80">'+ZPI18N.getString("zp.zbautosyncdesc")+'</label><input id="zp_zfinance_sync" integtype="'+integType+'" class="cmn-toggle-small cmn-toggle-round-small" type="checkbox"><label for="zp_zfinance_sync" class="M0 FR"></label></div></div></div></div>';ZPeople.BSModal.setup({modalClass:"popRgtModel ZPsecModal finIntg",id:"zp_zfinance_integ",type:2,bodyClass:"P20",header:header,body:bodyHtml,disableFooter:!0})}var isV5=Timetracker.Util.isVersionFive(),integLayout=isV5?settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.cardId):Layout.Page.container.find("#zp_zfinance_integ");"1"===integType&&(isV5?ZPeopleComponents.toggleswitch(integLayout.find("#zp_zfinance_sync")).setAttribute("on",!0):integLayout.find("#zp_zfinance_sync").prop("checked",!0)),integLayout.find("#zp_zfinance_revoke").off("click").on("click",function(){!function(service){enableDisableZBooksInvoiceIntegration(!1,{service:service})}(service)}),integLayout.find("#zp_zfinance_sync").off(isV5?"ztoggleswitchchange":"click").on(isV5?"ztoggleswitchchange":"click",function(){!function(service,thisObj){var currIntegType=Timetracker.Util.isVersionFive()?ZPeopleComponents.toggleswitch($(thisObj)).getState()?"1":"0":$(thisObj).is(":checked")?"1":"0",integType=$(thisObj).attr("integtype");currIntegType!==integType?($("#zp_zinfinance_integ_body").hide(),Timetracker.util.appendLoading(Timetracker.Util.isVersionFive()?"zpl_mcnt":"zp_modal_body",{type:"popup",containerId:Timetracker.Util.isVersionFive()?"zfinconfigSlider":"zp_zfinance_integ",isV5:Timetracker.Util.isVersionFive()}),ZPeople.Request.send(Timetracker.constants.URL,{mode:"updateZBooksIntegrationSettings",service:service,integType:currIntegType,conreqcsr:csrfToken},updateZBooksInvoiceIntegSettingsCallback)):Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"))}(service,this)})}function enableDisableZBooksInvoiceIntegration(isEnable,params){params.mode="enableZBooksIntegration",params.conreqcsr=csrfToken,void 0!==isEnable&&!1===isEnable&&(params.mode="disableZBooksIntegration"),$("#zp_zinfinance_integ_body").hide(),Timetracker.util.appendLoading("zfinconfigSliderCard",{type:"popup",containerId:"zfinconfigSlider",isV5:!0}),ZPeople.Request.send(Timetracker.constants.URL,params,enableDisableZBooksInvoiceIntegrationCallback,{isEnable:isEnable})}function enableDisableZBooksInvoiceIntegrationCallback(result,params,extraDtls){var integLayout=settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.cardId);if(Timetracker.util.removeErrorMsg(void 0,integLayout),Timetracker.util.removeLoading(integLayout),integLayout.find("#zp_zinfinance_integ_body").fadeIn(100),null!=result&&result.message){if(!0===result.isSuccess)return util.configureButtonTxt(extraDtls.isEnable,params.service),Timetracker.util.showAlert(2,result.message),void(extraDtls.isEnable?(Timetracker.ZBooksInvoice.Modal.modalObj.close(),result.integDtls?constructZBooksInvoiceViewModal(result.integDtls):viewZBooksInvoiceIntegration(settingsPage.container.find("div#zp_zfinance_integ_outer div.zpl_catlst a[id=configbtn][service="+service+"]"),params.service)):IntegrationSettings.unifiedUi?(integLayout.hide(),onChoosingService(void 0,params.service)):util.showConfigurePage(!0));Timetracker.util.showAlert(0,result.message)}else Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg"));integLayout.find("#sliderSbt").removeClass("disabled")}function updateZBooksInvoiceIntegSettingsCallback(result,params){var integLayout=Timetracker.Util.isVersionFive()?settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.cardId):Layout.Page.container.find("#zp_zfinance_integ");Timetracker.util.removeLoading(integLayout),Timetracker.util.removeErrorMsg(void 0,integLayout),integLayout.find("#zp_zinfinance_integ_body").fadeIn(100),null!=result&&result.message?result.isSuccess?(integLayout.find("#zp_zfinance_sync").attr("integType",params.integType),Timetracker.util.showAlert(2,result.message)):Timetracker.util.showAlert(0,result.message):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg"))}function pushTimelogsFromTS(layout,sheetId,service,isPushedAlready,isButton){if(isPushedAlready)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.zbtimelogpushedalready")),!1;var zbPushLayout=layout.find("#ts_zb");zbPushLayout.addClass("disabled");var parentLayout=layout.parent();parentLayout.find(".zpl_mcnt").children().hide(),Timetracker.util.appendLoading(null,{type:"popup",containerId:"timesheet_create",containerClass:"modal-body"});var params={mode:"pushTimelogsToOtherService",service:service,timesheetId:sheetId,conreqcsr:csrfToken};$.post(Timetracker.constants.URL,params,function(result){zbPushLayout.removeClass("disabled"),Timetracker.util.removeLoading(),parentLayout.find(".zpl_mcnt").children().show(),null!=result&&result.message?result.isSuccess?(Timetracker.util.showAlert(2,result.message),isButton&&zbPushLayout.text(ZPI18N.getString("zp.pushedto",[""])+" "+service)):Timetracker.util.showAlert(0,result.message):Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg"))})}return{util:util,isZBooksPushAllowed:function(service,pushAllowTLCnt,pushedCnt){return Timetracker.isDataAdmin()&&service&&!(0==pushAllowTLCnt&&0==pushedCnt)},checkAndAddPushIcon:function(layout,sheetId,service,totalTimelogs,pushAllowTLCnt,pushedCnt,isButton){if(Timetracker.isDataAdmin()&&service&&(0!=pushAllowTLCnt||0!=pushedCnt)){var isPushedAlready=0==pushAllowTLCnt,zbPushLayout=layout.find("#ts_zb");if(isButton){if(0===zbPushLayout.length){var pushHtml='<button id="ts_zb" class="zpl_drpdwn-js zlabel zlabel--outline zlabel--medium">'+(isPushedAlready?ZPI18N.getString("zp.pushedto",[""]):ZPI18N.getString("zp.pushto"))+" "+service+"</button>";layout.find(".zpl_mhderrgt").prepend($(pushHtml)),zbPushLayout=layout.find("#ts_zb")}zbPushLayout.off("click").on("click",function(){pushTimelogsFromTS(layout,sheetId,service,isPushedAlready,isButton)})}}},pushTimelogsFromTS:pushTimelogsFromTS,configureZBooksInvoiceIntegration:function(thisObj){util.enableDisableConfigureButton(Timetracker.constants.integration.DISABLE_CURRENT,thisObj),onChoosingService(thisObj),util.enableDisableConfigureButton(Timetracker.constants.integration.ENABLE_CURRENT,thisObj)},viewZBooksInvoiceIntegration:viewZBooksInvoiceIntegration,enableZBooksInvoiceIntegration:function(){var integLayout=settingsPage.container.find("#"+Timetracker.ZBooksInvoice.Modal.cardId);integLayout.find("#sliderSbt").addClass("disabled");var service=integLayout.find("#prtl_lstDiv").data("service");if(util.isZBooksOrInvoice(service)){var orgObj=integLayout.find(".prtl.active");orgObj&&0!==orgObj.length?enableDisableZBooksInvoiceIntegration(!0,{service:service,integOrgId:orgObj.attr("orgId"),integType:ZPeopleComponents.toggleswitch(integLayout.find("#zp_zfinance_sync")).getState()?"1":"0"}):(Timetracker.util.showAlert(0,ZPI18N.getString("zp.zborgselect")),integLayout.find("#sliderSbt").removeClass("disabled"))}else Timetracker.util.showAlert(0,ZPI18N.getString("zp.zbserviceselect")),integLayout.find("#sliderSbt").removeClass("disabled")}}}(),Timetracker.Integrations={errorSummary:{FIRESCROLLMODE:"errorSummaryListFirescroll",ZProjectsTaskListIds:{},service:{ZBOOKS:0,ZINVOICE:1,ZCRM:2,ZPROJECTS:3},entityCode:{ALL:-1,PROJECTS:0,PROJECTUSERS:1,JOBS:2,JOBUSERS:3,TIMELOGS:4},errorSource:{IMPORTING_IN_ZPEOPLE:0,EXPORTING_FROM_ZPEOPLE:1},operationType:{ADD:0,UPDATE:1,DELETE:2},constructErrorSummaryModel:function(details){let modalParams={},service=details.service,selectedEntity=details.selectedEntity;Timetracker.Validations.isDefiniteValue(details.selectedEntity)||(selectedEntity=details.selectedEntity=Timetracker.Integrations.errorSummary.service.ALL);let errorSource=details.errorSource;Timetracker.Validations.isDefiniteValue(details.errorSource)||(errorSource=details.errorSource=Timetracker.Integrations.errorSummary.errorSource.IMPORTING_IN_ZPEOPLE);let modelHTML='<div id="errorSummaryListView" class="zpl_flex zpl_flex-column zpl_oh" ><div class="zpl_btnmnu"><div><em>'+ZPI18N.getString("zp.tt.totalerrors")+' : </em><b id="errorCount" >0</b></div><div class="zpl_rgt w400"><select class="select-js" id="integErrorSource" ><option value="'+Timetracker.Integrations.errorSummary.errorSource.IMPORTING_IN_ZPEOPLE+'" >'+ZPI18N.getString("zp.tt.importerrors")+'</option><option value="'+Timetracker.Integrations.errorSummary.errorSource.EXPORTING_FROM_ZPEOPLE+'" >'+ZPI18N.getString("zp.tt.exporterrors")+'</option></select><select class="select-js" id="entityList" ><option value="'+Timetracker.Integrations.errorSummary.entityCode.ALL+'" >'+ZPI18N.getString("zp.all")+'</option><option value="'+Timetracker.Integrations.errorSummary.entityCode.PROJECTS+'" >'+ZPI18N.getString("zp.projects")+'</option><option value="'+Timetracker.Integrations.errorSummary.entityCode.JOBS+'" >'+ZPI18N.getString("zp.jobs")+'</option><option value="'+Timetracker.Integrations.errorSummary.entityCode.TIMELOGS+'" >'+ZPI18N.getString("zp.timelogs")+'</option></select></div></div><div class="zpl_tblres zpl_tblfxd zpl_tbllftfxd lft3_colonly zpl_colmaxwd zpl_oxa" id="errorSummaryTable"></div><div id="zp_empty_data"></div></div>';modalParams.id="timesheetIntegErrorSummarySlider",modalParams.cardId="timesheetIntegErrorSummarySliderCard",modalParams.callback=function(){settingsPage.container.find("#"+modalParams.cardId).html(modelHTML)};var zPrModalObj=new sliderModal(ZPI18N.getString("zp.tt.errorsummary"),modalParams);zPrModalObj.cancel=ZPI18N.getString("zp.close"),zPrModalObj.largeSize=!0,zPrModalObj.setCloseCallback(function(){Timetracker.Integrations.errorSummary.destroyZComp()}),zPrModalObj.construct(),modal=settingsPage.container.find("#"+modalParams.id),modal.find("#"+modalParams.cardId).removeClass("zpl_fm"),modal.find("#sliderSbt").addClass("zpl_DNI"),TimelyZComp.select.intialize(modal.find("#entityList"),{change:function(e,data){data.fromUI&&Timetracker.Integrations.errorSummary.filterChangeCallback(modal,service)}}),TimelyZComp.select.intialize(modal.find("#integErrorSource"),{change:function(e,data){data.fromUI&&Timetracker.Integrations.errorSummary.filterChangeCallback(modal,service)}}),TimelyZComp.select.setValue(modal.find("#entityList"),selectedEntity),TimelyZComp.select.setValue(modal.find("#integErrorSource"),errorSource),Timetracker.Integrations.errorSummary.getTimesheetIntegErrorSummaryList(details)},getTimesheetIntegErrorSummaryList:function(getDetails){let sliderCard=settingsPage.container.find("#timesheetIntegErrorSummarySliderCard"),params={mode:"getTimesheetIntegErrorSummaryList",selectedEntity:Timetracker.Integrations.errorSummary.entityCode.ALL,errorSource:Timetracker.Integrations.errorSummary.errorSource.IMPORTING_IN_ZPEOPLE,isErrorCountNeeded:!0,sIndex:0,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT};getDetails&&(params.service=getDetails.service,Timetracker.Validations.isDefiniteValue(getDetails.selectedEntity)&&(params.selectedEntity=getDetails.selectedEntity),Timetracker.Validations.isDefiniteValue(getDetails.errorSource)&&(params.errorSource=getDetails.errorSource)),sliderCard.find("#errorSummaryTable").scrollTop(0),sliderCard.find("#errorSummaryListView").addClass("DNI"),Timetracker.util.appendLoading("timesheetIntegErrorSummarySliderCard",{type:"popup",containerId:"timesheetIntegErrorSummarySlider"}),Timetracker.FireScroll.resetDataOnLoad(Timetracker.Integrations.errorSummary.FIRESCROLLMODE),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response&&"1"===response.res&&response.resObj){Timetracker.Integrations.errorSummary.constructErrorSummaryTable(response.resObj.errorSummaryList,response.resObj.errorCount,params);let otherDtls={scrollDiv:sliderCard.find("#errorSummaryTable")};delete params.isErrorCountNeeded,Timetracker.FireScroll.initFireScroll(Timetracker.Integrations.errorSummary.FIRESCROLLMODE,Timetracker.constants.URL,params,Timetracker.Integrations.errorSummary.loadMoreErrorSummary,"",otherDtls),Timetracker.FireScroll.setFetchCount(Timetracker.Integrations.errorSummary.FIRESCROLLMODE,response.resObj.errorSummaryList)}else response&&response.errorCode===Timetracker.constants.PERM_DENIED&&Timetracker.util.showAlert(0,ZPI18N.getString("zp.permdenied"));Timetracker.util.removeLoading(),sliderCard.find("#errorSummaryListView").removeClass("DNI")})},constructErrorSummaryTable:function(errorSummaryArr,errorCount,details){let errorSummaryTable="",selectedEntity=(details.service,details.selectedEntity),modal=settingsPage.container.find("#timesheetIntegErrorSummarySlider");errorSummaryArr&&0!==errorSummaryArr.length?(Timetracker.Util.showHideNoData({remove:!0}),modal.find("#errorSummaryTable").show(),errorSummaryTable='<table class="zpl_tbl zpl_w100"><thead id="errorSummaryTableHead"><tr><th>'+ZPI18N.getString("zp.tt.syncaction")+"</th><th>"+ZPI18N.getString("zp.tt.synctime")+"</th><th>"+ZPI18N.getString("zp.tt.errordesc")+"</th>"+(selectedEntity===Timetracker.Integrations.errorSummary.entityCode.ALL||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.TIMELOGS?'<th class="zpl_mw200">'+ZPI18N.getString("zp.employee")+"</th>":"")+'<th class="form_projectname tt_add_title zpl_mw300" >'+ZPI18N.getString("zp.projectname")+"</th>"+(selectedEntity===Timetracker.Integrations.errorSummary.entityCode.ALL||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.JOBS||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.TIMELOGS?'<th class="form_jobname tt_add_title zpl_mw300">'+ZPI18N.getString("zp.jobname")+"</th>":"")+(selectedEntity===Timetracker.Integrations.errorSummary.entityCode.ALL||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.TIMELOGS?'<th class="zpl_mw160">'+ZPI18N.getString("zp.tldate")+"</th>":"")+(selectedEntity===Timetracker.Integrations.errorSummary.entityCode.ALL||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.TIMELOGS?'<th class="zpl_mw160">'+ZPI18N.getString("zp.loggedhours")+"</th>":"")+'<th class="zpl_mw160">'+ZPI18N.getString("zp.tt.recordlink")+'</th><th></th></tr></thead><tbody id="errorSummaryTableBody" ></tbody></table>',modal.find("#errorSummaryTable").html(errorSummaryTable),Timetracker.Integrations.errorSummary.appendErrorSummaryRowHTML(errorSummaryArr,modal.find("#errorSummaryTableBody"),details)):(modal.find("#errorSummaryTable").html(""),modal.find("#errorSummaryTable").hide(),Timetracker.Util.showHideNoData({div:modal,msg:ZPI18N.getString("zp.lookup.norecfound")})),modal.find("#errorCount").text(errorCount),Timetracker.util.init()},appendErrorSummaryRowHTML:function(errorSummaryArr,tBodyContainer,details){let row,service=details.service,selectedEntity=details.selectedEntity,errorSource=details.errorSource;errorSummaryArr&&(errorSummaryArr.forEach(function(errorSummaryObj,index){let operationType=errorSummaryObj.operationType,entityCode=errorSummaryObj.entityCode,errorOccuredTime=errorSummaryObj.errorOccuredTime,errorCode=errorSummaryObj.errorCode,recordInfo=errorSummaryObj.recordInfo,empDisplayName="NA",projectName="-",jobName="NA",timelogDate="NA",totalhours="NA";recordInfo&&(projectName=recordInfo.projectName?recordInfo.projectName:"-",entityCode!==Timetracker.Integrations.errorSummary.entityCode.ALL&&entityCode!==Timetracker.Integrations.errorSummary.entityCode.JOBS&&entityCode!==Timetracker.Integrations.errorSummary.entityCode.TIMELOGS||(jobName=recordInfo.jobName?recordInfo.jobName:"-"),entityCode!==Timetracker.Integrations.errorSummary.entityCode.ALL&&entityCode!==Timetracker.Integrations.errorSummary.entityCode.TIMELOGS||(timelogDate=recordInfo.timelogDate?recordInfo.timelogDate:"-",totalhours=recordInfo.logHours?recordInfo.logHours:"-",empDisplayName=recordInfo.empDisplayName?recordInfo.empDisplayName:"-")),row="<tr errorId="+errorSummaryObj.errorId+" ><td><span>"+Timetracker.Integrations.errorSummary.getEntityName(entityCode)+"<em> - "+(operationType===Timetracker.Integrations.errorSummary.operationType.ADD?ZPI18N.getString("zp.add"):ZPI18N.getString("zp.edit"))+"</em></span></td><td><span>"+errorOccuredTime+'</span></td><td><span class="tooltip-js txttrim zpl_mmax300" data-title-display-type="callout" data-title-position="auto" title="'+Timetracker.Integrations.errorSummary.getErrormessage(errorCode,Timetracker.Integrations.errorSummary.getServiceName(service))+'">'+Timetracker.Integrations.errorSummary.getErrormessage(errorCode,Timetracker.Integrations.errorSummary.getServiceName(service))+"</span></td>"+(selectedEntity===Timetracker.Integrations.errorSummary.entityCode.ALL||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.TIMELOGS?'<td><span class="tooltip-js txttrim zpl_mmax200" data-title-display-type="callout" data-title-position="auto" title="'+empDisplayName+'">'+empDisplayName+"</span></td>":"")+'<td><span class="tooltip-js txttrim zpl_mmax300" data-title-display-type="callout" data-title-position="auto" title="'+projectName+'">'+projectName+"</span></td>"+(selectedEntity===Timetracker.Integrations.errorSummary.entityCode.ALL||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.JOBS||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.TIMELOGS?'<td><span class="tooltip-js txttrim zpl_mmax300" data-title-display-type="callout" data-title-position="auto" title="'+jobName+'">'+jobName+"</span></td>":"")+(selectedEntity===Timetracker.Integrations.errorSummary.entityCode.ALL||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.TIMELOGS?"<td><span>"+timelogDate+"</span></td>":"")+(selectedEntity===Timetracker.Integrations.errorSummary.entityCode.ALL||selectedEntity===Timetracker.Integrations.errorSummary.entityCode.TIMELOGS?"<td><span>"+totalhours+"</span></td>":"")+'<td><a class="'+Timetracker.Integrations.errorSummary.getServiceIcon(errorSource===Timetracker.Integrations.errorSummary.errorSource.IMPORTING_IN_ZPEOPLE?service:"")+'" name="serviceIcon" ></a></td><td><i name="ignoreIcon" class="PI_delete" title="Ignore"></i></td></tr>',(row=$(row)).data("errorSummaryObj",errorSummaryObj),tBodyContainer.append(row)}),tBodyContainer.find("tr [name=ignoreIcon]").off("click").on("click",function(){Timetracker.Integrations.errorSummary.ignoreIntegErrorRecords(this)}),tBodyContainer.find("tr [name=serviceIcon]").off("click").on("click",function(){Timetracker.Integrations.errorSummary.redirectToErrorRecordPage(this,service)}))},getEntityName:function(entityCode){let name="";switch(entityCode){case Timetracker.Integrations.errorSummary.entityCode.PROJECTS:name="zp.projects";break;case Timetracker.Integrations.errorSummary.entityCode.JOBS:name="zp.jobs";break;case Timetracker.Integrations.errorSummary.entityCode.TIMELOGS:name="zp.timelogs"}return ZPI18N.getString(name)},getServiceName:function(service){let name="";switch(service){case Timetracker.Integrations.errorSummary.service.ZBOOKS:name=Timetracker.constants.integration.zb;break;case Timetracker.Integrations.errorSummary.service.ZINVOICE:name=Timetracker.constants.integration.zi;break;case Timetracker.Integrations.errorSummary.service.ZCRM:name=Timetracker.constants.integration.zcrm;break;case Timetracker.Integrations.errorSummary.service.ZPROJECTS:name=Timetracker.constants.integration.zprjct}return name},getServiceIcon:function(service){switch(service){case Timetracker.Integrations.errorSummary.service.ZPROJECTS:return"zpl_projecticn";default:return"zpl_pplicn"}},filterChangeCallback:function(container,service){let selectedEntity=parseInt(TimelyZComp.select.getValue(container.find("#entityList"))),errorSource=parseInt(TimelyZComp.select.getValue(container.find("#integErrorSource")));Timetracker.Integrations.errorSummary.getTimesheetIntegErrorSummaryList({service:service,selectedEntity:selectedEntity,errorSource:errorSource})},ignoreIntegErrorRecords:function(element){let modal=Timetracker.Util.getLayout().find("#timesheetIntegErrorSummarySlider"),params={mode:"ignoreIntegErrorRecords",errorIds:$(element).closest("tr").attr("errorId")};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response&&"1"==response.res){$(element).closest("tr").remove(),Timetracker.util.showAlert(2,ZPI18N.getString("zp.tt.ignoresuccessmsg"));let errorCountElem=modal.find("#errorCount"),errorCount=parseInt(errorCountElem.text(),10);!isNaN(errorCount)&&errorCount>0&&errorCountElem.text(errorCount-1),0===modal.find("tbody[id=errorSummaryTableBody]").find("tr").length?(modal.find("#errorSummaryTable").html(""),modal.find("#errorSummaryTable").hide(),Timetracker.Util.showHideNoData({div:modal,msg:ZPI18N.getString("zp.lookup.norecfound")})):Timetracker.FireScroll.checkAndLoadMoreData(Timetracker.Integrations.errorSummary.FIRESCROLLMODE,1)}else response&&response.errorCode===Timetracker.constants.PERM_DENIED?Timetracker.util.showAlert(0,ZPI18N.getString("zp.permdenied")):Timetracker.util.showAlert(0,ZPI18N.getString("zp.tt.ignorefailuremsg"))})},redirectToErrorRecordPage:function(element,service){let errorSummaryObj=$(element).closest("tr").data("errorSummaryObj"),entityCode=errorSummaryObj.entityCode,url="";if(errorSummaryObj.errorSource===Timetracker.Integrations.errorSummary.errorSource.IMPORTING_IN_ZPEOPLE)switch(service){case Timetracker.Integrations.errorSummary.service.ZPROJECTS:url=Timetracker.Integrations.errorSummary.zohoProjectsURLs(entityCode,errorSummaryObj)}else url=Timetracker.Integrations.errorSummary.zohoPeopleURLs(entityCode,errorSummaryObj);url&&""!==url&&window.open(url,"_blank")},zohoPeopleURLs:function(entityCode,errorSummaryObj){let projectId,jobId,timelogId,peopleUrl=domainUrl+"/zp#operations/timetracker/",recordInfo=errorSummaryObj.recordInfo;switch(entityCode){case Timetracker.Integrations.errorSummary.entityCode.PROJECTS:return peopleUrl+"projects/view-recordId:"+(projectId=errorSummaryObj.recordId);case Timetracker.Integrations.errorSummary.entityCode.JOBS:return projectId=recordInfo.projectId,peopleUrl+"jobs/view-recordId:"+(jobId=errorSummaryObj.recordId);case Timetracker.Integrations.errorSummary.entityCode.TIMELOGS:return projectId=recordInfo.projectId,jobId=recordInfo.jobId,peopleUrl+"searchuser/timelogs/viewtimelog-recordId:"+(timelogId=errorSummaryObj.recordId)+"/userId:"+recordInfo.userErecno}},zohoProjectsURLs:function(entityCode,errorSummaryObj){let projectRefId,jobRefId,timelogRefId,projectUrl=projects_url+"/portal/"+Timetracker.ZOHOPROJECTS.integDtls.portalUrl,recordInfo=errorSummaryObj.recordInfo;switch(entityCode){case Timetracker.Integrations.errorSummary.entityCode.PROJECTS:return projectUrl+"#dashboard/"+(projectRefId=errorSummaryObj.referenceId);case Timetracker.Integrations.errorSummary.entityCode.JOBS:projectRefId=recordInfo.projectRefId,jobRefId=errorSummaryObj.referenceId;let tasklistId=Timetracker.Integrations.errorSummary.getZProjectsTaskListId(projectRefId,jobRefId);if(Timetracker.Validations.isDefiniteValue(tasklistId))return projectUrl+"#taskdetail/"+projectRefId+"/"+tasklistId+"/"+jobRefId;case Timetracker.Integrations.errorSummary.entityCode.TIMELOGS:return projectRefId=recordInfo.projectRefId,jobRefId=recordInfo.jobRefId,projectUrl+"#timesheetdetail/"+projectRefId+"/task/"+(timelogRefId=errorSummaryObj.referenceId)}},getZProjectsTaskListId:function(projectRefId,taskRefId){if(!Timetracker.Validations.isDefiniteValue(Timetracker.Integrations.errorSummary.ZProjectsTaskListIds[taskRefId])){let params={mode:"getZohoProjectDetails",zProjectsPortalId:Timetracker.ZOHOPROJECTS.integDtls.syncPortalId,zProjectsProjectRefId:projectRefId,zProjectsJobRefId:taskRefId,skipPortal:!0};ZPeople.Request.sendAsyncPost(Timetracker.constants.URL,params,function(resultData){if(resultData.res){var response=resultData.resObj;response&&response.tasklistId?Timetracker.Integrations.errorSummary.ZProjectsTaskListIds[taskRefId]=response.tasklistId:Timetracker.util.showAlert(0,ZPI18N.getString("zp.prjctsync.jobnotfound"))}else{var errorMsg=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);Timetracker.util.showAlert(0,errorMsg)}})}return Timetracker.Integrations.errorSummary.ZProjectsTaskListIds[taskRefId]},loadMoreErrorSummary:function(response,params,otherDtls){let errorSummaryList=[];response&&"1"===response.res&&response.resObj&&response.resObj.errorSummaryList&&(errorSummaryList=response.resObj.errorSummaryList,Timetracker.Integrations.errorSummary.appendErrorSummaryRowHTML(errorSummaryList,otherDtls.scrollDiv.find("#errorSummaryTableBody"),params)),Timetracker.FireScroll.setFetchCount(Timetracker.Integrations.errorSummary.FIRESCROLLMODE,errorSummaryList)},getErrormessage:function(errorCode,serviceName){let errorMsg="";switch(errorCode){case"TIE_PROJ_001":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.noprojectname");break;case"TIE_PROJ_002":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.projectnamelengthexceeded");break;case"TIE_PROJ_003":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.projectdesclengthexceeded");break;case"TIE_PROJ_004":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.prjnotinpeople");break;case"TIE_PROJ_005":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.cantchangeprojectstatus");break;case"TIE_PROJ_006":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.prjnotinotherservice",[serviceName]);break;case"ZPROJECTS_INTEG_002":errorMsg=ZPI18N.getString("zp.prjctsync.projectnotcreated");break;case"ZPROJECTS_INTEG_004":errorMsg=ZPI18N.getString("zp.prjctsync.permdeniedtocreateproject");break;case"ZPROJECTS_INTEG_006":errorMsg=ZPI18N.getString("zp.prjctsync.permdeniedtoproject");break;case"TIE_JOB_001":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.nojobname");break;case"TIE_JOB_002":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.jobnamelengthexceeded");break;case"TIE_JOB_003":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.jobdesclengthexceeded");break;case"TIE_JOB_004":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.jobnotlinkedorprjnotexist");break;case"TIE_JOB_005":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.jobnotinpeople");break;case"TIE_JOB_006":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.nousersinjob");break;case"TIE_JOB_007":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.cantchangejobstatus");break;case"TIE_JOB_008":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.jobnotinotherservice",[serviceName]);break;case"ZPROJECTS_INTEG_007":errorMsg=ZPI18N.getString("zp.prjctsync.tasknotcreated1");break;case"ZPROJECTS_INTEG_008":errorMsg=ZPI18N.getString("zp.prjctsync.tasknotcreated2",["120"]);break;case"TIE_JOBUSR_001":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.jobusrsnotinproject");break;case"TIE_TLOGS_001":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.tldesclengthexceeded");break;case"TIE_TLOGS_002":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.hourstldisabled");break;case"TIE_TLOGS_003":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.fromtotldisabled");break;case"TIE_TLOGS_004":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.timernotallowedinbulk");break;case"TIE_TLOGS_005":errorMsg=ZPI18N.getString("zp.ttintegerrormsg.usrnotinjob");break;case"ZPROJECTS_INTEG_009":errorMsg=ZPI18N.getString("zp.prjctsync.permdeniedtocreatetimelog");break;case"ZPROJECTS_INTEG_012":errorMsg=ZPI18N.getString("zp.prjctsync.usernotexistsinproject");break;case"ZPROJECTS_INTEG_013":errorMsg=ZPI18N.getString("zp.prjctsync.usernotexistsintask");break;case"ZPROJECTS_INTEG_011":errorMsg=ZPI18N.getString("zp.prjctsync.loghoursrestriction");break;case"ZPROJECTS_INTEG_010":errorMsg=ZPI18N.getString("zp.prjctsync.daterestriction");break;case"ZPROJECTS_INTEG_014":errorMsg=ZPI18N.getString("zp.prjctsync.closedtaskrestriction");break;case"ZPROJECTS_INTEG_017":errorMsg=ZPI18N.getString("zp.prjctsync.zerohoursrestriction");break;case"ZPROJECTS_INTEG_018":errorMsg=ZPI18N.getString("zp.prjctsync.taskmovedordeleted");break;case"TIE_GENERAL_001":errorMsg="General Error";break;case"TIE_GENERAL_002":errorMsg="Required parameter(s) missing"}return errorMsg},destroyZComp:function(){var modal=settingsPage.container.find("#timesheetIntegErrorSummarySlider");modal.find("select").each(function(){ZPeopleComponents.select(modal.find("#"+$(this).attr("id"))).destroy()}),modal.find("input").each(function(){ZPeopleComponents.toggleswitch(modal.find("#"+$(this).attr("id"))).destroy()})}}},Timetracker.Integration={Util:{ZOneUIhandling:function(modal,cardId){IntegrationSettings.unifiedUi&&(modal.addClass("zpl_mfull"),modal.find("#"+cardId).addClass("zpl_justify-around"),modal.find("#sliHdrDiv").remove(),modal.find("#sliderCancel").remove())}}},Timetracker.timejobscheduler=function(){"use strict";var calview="1",isEmpFetchAvail=!0,firescroll_Triggered=!1,isJBSCalled=!1,usersShiftData={};function isJobScheduleEnabled(){return ZPeople.isZPNewUI()||void 0!==ZPeople.Module.MODULE_DATA.timetracker.isJobScheduleEnabled&&!0===ZPeople.Module.MODULE_DATA.timetracker.isJobScheduleEnabled}function hasCustomFields(){return ZPeople.Module.MODULE_DATA.timetracker.isJobScheduleCustomized&&void 0!==ZPeople.Module.MODULE_DATA.timetracker.jobScheduleCustomFields}function isJobSchTLExtendEnabled(){return ZPeople.Module.MODULE_DATA.timetracker.settingDetails&&1==ZPeople.Module.MODULE_DATA.timetracker.settingDetails.TS_jobschTimeIntervalTLRestrict_Extend}function getCustomFields(){return hasCustomFields()?ZPeople.Module.MODULE_DATA.timetracker.jobScheduleCustomFields:void 0}function hasFieldPermissions(){return ZPeople.Module.MODULE_DATA.timetracker.isJobScheduleCustomized&&void 0!==ZPeople.Module.MODULE_DATA.timetracker.jobSchFieldPermissions}var emp_cache={index:1,fetchCount:25},isAddEditAllowed=function(empid){if(Timetracker.isDataAdminForUser(empid)||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit)&&Timetracker.isTTCustomAdminForUser(Timetracker.constants.TTCustomAdmin.EntryEdit,empid))return!0;if(Timetracker.generalSettings&&Timetracker.generalSettings.settingDetails){var editPerm=Timetracker.generalSettings.getJobSchdEditPerm();if("1"===editPerm&&empid&&empid===erecno)return!1;if("1"===editPerm||"2"===editPerm)return!0}return!1},pub_cache={count:0};function setNavigationDateObject(prenxt){Timetracker.timejobscheduler.navigateDate=-1===prenxt?"2"===calview?$.extend(Timetracker.timejobscheduler.navigateDate,Calendar.getPreviousMonth(Timetracker.timejobscheduler.navigateDate)):"0"===calview?$.extend(Timetracker.timejobscheduler.navigateDate,Calendar.getPreviousDay(Timetracker.timejobscheduler.navigateDate)):$.extend(Timetracker.timejobscheduler.navigateDate,Calendar.getPreviousWeek(Timetracker.timejobscheduler.navigateDate)):1===prenxt?"2"===calview?$.extend(Timetracker.timejobscheduler.navigateDate,Calendar.getNextMonth(Timetracker.timejobscheduler.navigateDate)):"0"===calview?$.extend(Timetracker.timejobscheduler.navigateDate,Calendar.getNextDay(Timetracker.timejobscheduler.navigateDate)):$.extend(Timetracker.timejobscheduler.navigateDate,Calendar.getNextWeek(Timetracker.timejobscheduler.navigateDate)):"2"===calview?$.extend(Timetracker.timejobscheduler.navigateDate,Calendar.getCurrentMonth()):"0"===calview?$.extend(Timetracker.timejobscheduler.navigateDate,Calendar.getCurrentDay()):$.extend(Timetracker.timejobscheduler.navigateDate,Calendar.getCurrentWeek())}function updateResizeValforTotime($ui,ev){var rowwidth,dateid,assignee_id,elemSch=$ui.element;rowwidth=elemSch?elemSch.parent().parent().width():(elemSch=$(ev.target)).parent().width();var date=Timetracker.timejobscheduler.navigateDate.day;dateid=date.getFullYear().toString()+"-"+("0"+(date.getMonth()+1).toString()).substr(-2)+"-"+("0"+date.getDate().toString()).substr(-2),assignee_id=elemSch.data("empId");var curWidth,jobSchObj={},jobDetails=elemSch.data(),pixPerMinute=1440/rowwidth,curPos=($ui.originalPosition.left,$ui.position.left);$ui.originalSize||$ui.size?($ui.originalSize.width,curWidth=$ui.size.width):curWidth=function($elm){var width,rect=$elm[0].getBoundingClientRect();width=rect.width?rect.width:rect.right-rect.left;return width}(elemSch);var ftime=Math.round(curPos*pixPerMinute),ttime=Math.round((curPos+curWidth)*pixPerMinute);if(ftime<0&&(ftime=0),ftime>1440&&(ftime=1440),ttime<0&&(ttime=0),ttime>1440&&(ttime=1440),jobSchObj.jobId=jobDetails.jobId,jobSchObj.desc=jobDetails.desc,jobSchObj.isPubed=jobDetails.isPubed,jobSchObj.fromtime=ftime,jobSchObj.totime=ttime,jobSchObj.date=dateid,jobSchObj.tschId=jobDetails.tschId,jobSchObj.assignedTo=assignee_id,jobSchObj.billableStatus=jobDetails.billableStatus,jobSchObj.workitem=jobDetails.workitem,isJobSchTLExtendEnabled()&&(jobSchObj.extendAllowed=jobDetails.extendAllowed),hasCustomFields()&&(jobSchObj.customFieldDetails=JSON.stringify(jobDetails.customFieldDetails)),jobDetails.repeatId){jobSchObj.editRepeat=!1,jobSchObj.repeatId=jobDetails.repeatId,jobSchObj.repeatType=jobDetails.repeatType,jobSchObj.repeatInt=jobDetails.repeatInt;var repuntil=jobDetails.repeatUntil;repuntil&&(repuntil=repuntil.split(" ")[0],jobSchObj.repeatUntil=repuntil),jobSchObj.repeatRule=jobDetails.repeatRule}var jsonParam={};jsonParam.p=jobSchObj,jsonParam.ep=jQuery.extend({},jobSchObj),jsonParam.ep.moveUI=$ui,jsonParam.fn=Timetracker.timejobscheduler.updateJobScheduleResponse,reqObj.updateJobSchedule(jsonParam)}function positionScheduleInDayview(datacol_div_id,jobDetails,empId,isFromAdd){var jobschId=jobDetails.tschId;void 0!==jobDetails.date&&(jobDetails.date=jobDetails.date.split(" ")[0]);var domhasdrag=datacol_div_id.find("#has_drag_id_"+empId),dup=domhasdrag.find("#"+jobschId);if(dup.length){var oldDate=dup.data("date");if(jobDetails.date!==oldDate)return void dup.remove()}var startPixelPercent,widthSchPercent,jsonSch={},ftime=jobDetails.fromTime,ttime=jobDetails.toTime,rowwidth=datacol_div_id.width(),indminswidth=rowwidth/24/60,fTimetype=Timetracker.timelogs.minstoTimeMeridianAP(ftime),tTimetype=Timetracker.timelogs.minstoTimeMeridianAP(ttime),startPixel=indminswidth*ftime,timeDiff=(ttime<ftime?ttime+Timetracker.constants.PER_DAY_MIN:ttime)-ftime;startPixelPercent=startPixel/rowwidth*100,widthSchPercent=(indminswidth*(parseInt(ttime)<parseInt(ftime)?Timetracker.constants.PER_DAY_MIN:ttime)-startPixel)/rowwidth*100;datacol_div_id.parent();var ft=fTimetype,tt=tTimetype,schname=ZPeople.escapeHtml(jobDetails.jobName),projectname=jobDetails.projectName;if(!schname){var userJobArr=Timetracker.jobs.userJobs[empId];if(userJobArr&&jobDetails.jobId&&"0"!==jobDetails.jobId){var tempIndex=Timetracker.projects.Operations.findJSONArrayIndex(userJobArr,jobDetails.jobId,"jobId");tempIndex&&"-1"!==tempIndex&&(schname=userJobArr[tempIndex].jobName?ZPeople.escapeHtml(userJobArr[tempIndex].jobName):"")}}var insidecheck=!1,top=0,liDom=datacol_div_id.parent(),tempSchArrForDayView=liDom.data("tempArr")||[];dup.length||$.each(tempSchArrForDayView,function(index,odata){insidecheck=!0;var rowno=odata.rowno+1;jsonSch.rowno=rowno,top=40*rowno;var ht=40*(rowno+1);liDom.find(".zphour-col").css({height:ht+"px"}),liDom.find(".zpuser-col").css({height:ht+"px"})});var jobSpan="";schname&&(jobSpan=' / <span class="zp-sname">'+schname+"</span>");var unpubcls=jobDetails&&!jobDetails.isPubed?"zjs-clr":"",repdom="";jobDetails.repeatId&&(repdom='<i title="'+ZPI18N.getString("zp.repeatingschedule")+'" class="IC-repeat S8"></i>');var placement=ftime<420?"right":"left",jcolor="0"===jobDetails.color?1:jobDetails.color,domschedule=$('<div id="'+jobschId+'" style="width:'+widthSchPercent+"%;left:"+startPixelPercent+"%;top:"+top+'px;" class="shif-itemdiv" data-toggle="tooltip" data-placement="'+placement+'" data-original-title="'+ft+"-"+tt+" / "+schname+'"><div class="shift-items LC'+jcolor+" "+unpubcls+'"><p class="CP" ptschid="'+jobDetails.tschId+'">'+repdom+"<b>"+ft+"-"+tt+"</b>"+jobSpan+"</p></div></div>");void 0!==projectname&&""!==projectname.trim()&&(domschedule=$('<div id="'+jobschId+'" style="width:'+widthSchPercent+"%;left:"+startPixelPercent+"%;top:"+top+'px;" class="shif-itemdiv" data-toggle="tooltip" data-placement="'+placement+'" data-html="true" data-original-title="'+ft+"-"+tt+" / "+schname+"<span>.</span>"+ZPeople.escapeHtml(projectname)+'"><div class="shift-items LC'+jcolor+" "+unpubcls+'"><p class="CP" ptschid="'+jobDetails.tschId+'">'+repdom+"<b>"+ft+"-"+tt+"</b>"+jobSpan+"</p></div></div>")),domschedule.data(jobDetails),domschedule.data("empId",empId);var oldTimeDiff=0;if(dup.length){var dupTop=dup.css("top");domschedule.css({top:dupTop});var oldpub=dup.data("isPubed");jobDetails.isPubed&&!oldpub&&(pub_cache.count-=1),!jobDetails.isPubed&&oldpub&&(pub_cache.count+=1),oldTimeDiff=(dup.data("toTime")||0)-(dup.data("fromTime")||0),dup.replaceWith(domschedule)}else domhasdrag.append(domschedule);datacol_div_id.prepend(domhasdrag),function(ftime,ttime,jobDetails){var resizetxt;resizetxt='<div class="ui-resizable-handle"></div><div class="ui-resizable-handle ui-resizable-e"><i class="IC-drag FL gry dragic"></i></div>',Layout.Page.container.find('p[ptschid="'+jobDetails.tschId+'"]').parent().append(resizetxt)}(0,0,jobDetails);var width=Layout.Page.container.find('div[tschid="'+jobDetails.tschId+'"]').css("width"),left=Layout.Page.container.find('div[tschid="'+jobDetails.tschId+'"]').css("left");jsonSch.width=width,jsonSch.left=left,domschedule.on("hover",function(){$(".tooltip").remove()}),domschedule.resizable({containment:domschedule.parent().parent(),handles:{e:".ui-resizable-e"},start:function(event,ui){$(this).addClass("noclick")},stop:function(ev,$ui){$(".tooltip").remove(),updateResizeValforTotime($ui,ev)}}),domschedule.draggable({containment:domschedule.parent().parent(),axis:"x",start:function(event,ui){$(".tooltip").remove(),$(this).addClass("noclick")},drag:function(event,ui){$(".tooltip").remove()},stop:function(ev,$ui){$(".tooltip").remove(),updateResizeValforTotime($ui,ev)}}),domschedule.off("click").on("click",function(e){$(this).hasClass("noclick")?$(this).removeClass("noclick"):Timetracker.timejobscheduler.chooseEditSchedule(jobDetails,e,this)}),jsonSch.empId=empId,jsonSch.ftime=jobDetails.fromTime,jsonSch.ttime=jobDetails.toTime,jsonSch.tschId=jobDetails.tschId,!1===insidecheck&&(jsonSch.rowno=0),isFromAdd&&!jobDetails.isPubed&&(pub_cache.count+=1),tempSchArrForDayView.push(jsonSch);var tmisDom=liDom.find(".DC_JSUhr"),tmins=parseInt(tmisDom.attr("tmins"))||0;tmisDom.attr("tmins",tmins-oldTimeDiff+timeDiff),tmisDom.text(Calendar.minstohrs(tmins-oldTimeDiff+timeDiff)),liDom.data({tempArr:tempSchArrForDayView}),updateUnpublishedCount()}function constructDaybasedView(userArr,jobschArr){var currUserList=userArr;firescroll_Triggered=!1;var time_head="",day_body=Layout.Page.container.find("#dayview_body");if(1===Timetracker.timejobscheduler.emp_cache.index){for(var i=0;i<=23;i++)if("HH:mm"===timeFormat)time_head+='<div id="time_head_cell" class="zphour-col zpsmall-col">'+i+"</div>";else{var time_show,time_val;i>=12?(0===(time_val=i-12)&&(time_val=12),time_show=time_val+"P"):time_show=(time_val=i)+"A",0===i&&(time_show="12A"),time_head+='<div id="time_head_cell" class="zphour-col zpsmall-col">'+time_show+"</div>"}Layout.Page.container.find("#time_head_row").html(time_head),day_body.html(""),Timetracker.timejobscheduler.usersList=userArr}else Timetracker.timejobscheduler.usersList=Timetracker.timejobscheduler.usersList.concat(userArr);if(currUserList&&currUserList.length){Layout.Page.container.find("#zp_empty_data").hide();var dbDate=Timetracker.DateTime.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.day,!0);$.each(currUserList,function(index,userDetail){var leaveDtl=(userDetail.leaveObj?userDetail.leaveObj:{})[dbDate],leaveCls="",leaveTitle="";if(leaveDtl){var hideWeekEnd=Timetracker.generalSettings.hideWeekEnd(),hideHoliday=Timetracker.generalSettings.hideHoliday(),hideLeave=Timetracker.generalSettings.hideLeave();!hideWeekEnd&&leaveDtl.isweekend&&!0===leaveDtl.isweekend&&(leaveCls="wkend-rgb",leaveTitle=ZPI18N.getString("zp.weekend")),!hideHoliday&&leaveDtl.isHoliday&&!0===leaveDtl.isHoliday&&(leaveCls="holiday-rgb",leaveTitle=holiday_disName===ZPI18N.getString("zp.holidays")?ZPI18N.getString("zp.holiday"):holiday_disName),!hideLeave&&leaveDtl.leaves&&0!==leaveDtl.leaves.length&&(leaveCls="leave-bg-r",leaveTitle=ZPI18N.getString("zp.leave"))}var liRow=$('<li id="dayrow_'+userDetail.empId+'" class="zpuser-row"></li>');liRow.data(userDetail);var divuser=$('<div class="zpuser-col zpfirst-col"><div class="zpUsrIn"><div class="zpUsrPht"><div class="zpUsrPhtIn"><img src="'+userDetail.empPhoto+'"></div></div><div class="zpUsrDets"><label title="'+userDetail.empName+'"><strong><span>'+userDetail.employeeId+"</span>"+userDetail.empName+'</strong></label><p><i class="IC-clock gry"></i><em class="DC_JSUhr">00:00</em></p></div></div></div>');liRow.append(divuser);for(var schArr,liElem,empid,has_drag_div=$('<div id="has_drag_id_'+userDetail.empId+'" class="zpshift-spans zpj-splt has-drag"></div>'),cell_outer=$('<div class="zpdata-col"></div>'),empty_cells_row=$('<div class="zphours-row" id="'+userDetail.empId+'"></div>'),time=0;time<=23;time++){var ind_cell=$('<div class="zphour-col zpsmall-col '+leaveCls+'" title="'+leaveTitle+'" id="'+userDetail.empId+"_"+time+'" ></div>');empty_cells_row.append(ind_cell)}cell_outer.append(has_drag_div),cell_outer.append(empty_cells_row),liRow.append(cell_outer),day_body.append(liRow),schArr=userDetail.jobschArr,empid=(liElem=liRow).data("empId"),$.each(schArr,function(job_index,jobDetail){positionScheduleInDayview(liElem.find("div[id='has_drag_id_"+empid+"']").parent(),jobDetail,empid)})})}else 1===Timetracker.timejobscheduler.emp_cache.index&&(Layout.Page.container.find("#day_view_jobsch").hide(),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.nojbschedulefound"),{classname:"CR-nodata",path:"path5"}));currUserList&&currUserList.length===emp_cache.fetchCount?Timetracker.timejobscheduler.emp_cache.index+=emp_cache.fetchCount:isEmpFetchAvail=!1,updateUnpublishedCount(),day_body.off("click",".zphour-col").on("click",".zphour-col",function(e){Timetracker.timejobscheduler.addJobScheduleConstruct(e,this)})}function setDayLogHeader(isPreNxt){var today=Calendar.getCurrentDay().day;Calendar.daydate=Timetracker.timejobscheduler.navigateDate.day,Calendar.equalsTo(Timetracker.timejobscheduler.navigateDate.day,today)?Layout.Page.container.find("#calInfo").html(ZPI18N.getString("zp.today")):Layout.Page.container.find("#calInfo").html(Timetracker.timelogs.getDateinTSformat(Timetracker.timejobscheduler.navigateDate.day))}var templates={addEditJobSchPop:function(mode){var cons='<div id="jobsch_modelmask" class="modal popRgtModel in">';return cons+='<div id="jobsch_mdialog" class="modal-dialog" role="document">',cons+='<div class="modal-content">',cons+='<div id="jobsch_mdhead" class="modal-header">',cons+="edit"===mode?'<h6 id="jobsch_titleid" class="addPopTitle pull-left M0">'+ZPI18N.getString("zp.editschedule")+"</h6>":'<h6 id="jobsch_titleid" class="addPopTitle pull-left M0">'+ZPI18N.getString("zp.addschedule")+"</h6>",cons+='<button aria-label="Close" id="jobsch_close" data-dismiss="modal" class="close" type="button">',cons+='<span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span>',cons+="</button>","edit"===mode&&(cons+='<button aria-label="Delete" id="jobsch_delete" data-dismiss="modal" class="close dlte DN" type="button">',cons+='<span aria-hidden="true"><div class="IC-delete gry CP"></div></span>',cons+="</button>"),cons+='<div class="clearfix"></div>',cons+="</div>",cons+='<div class="modal-body">',cons+='<form id="chooseEdit_form" role="form" class="pad" style="height:250px;display:none">',cons+="</form>",cons+='<form id="jobsch_form" role="form" class="form-horizontal pad" style="height:340px;">',cons+="</form>",cons+='<form id="repeat_form" role="form" class="form-horizontal pad" style="height:250px;display:none">',cons+="</form>",cons+="</div>",cons+='<div class="modal-footer" id="jobsch_footer"></div>',cons+="</div>",cons+="</div>",cons+="</div>"}};function repeatIntervalToggle(){var interval=Layout.Page.container.find("#repeatid").val(),daily=Layout.Page.container.find("#repeat_daily_name"),weekly=Layout.Page.container.find("#repeat_week_name"),monthly=Layout.Page.container.find("#repeat_month_name");if(daily.hide(),weekly.hide(),monthly.hide(),interval&&"1"===interval){if("add"===Timetracker.timejobscheduler.currPopupMode){var chkVal=new Date(Timetracker.timejobscheduler.currPopupDate).getDay();0===chkVal?Layout.Page.container.find("#daysel_sun").prop("checked",!0):1===chkVal?Layout.Page.container.find("#daysel_mon").prop("checked",!0):2===chkVal?Layout.Page.container.find("#daysel_tue").prop("checked",!0):3===chkVal?Layout.Page.container.find("#daysel_wed").prop("checked",!0):4===chkVal?Layout.Page.container.find("#daysel_thu").prop("checked",!0):5===chkVal?Layout.Page.container.find("#daysel_fri").prop("checked",!0):6===chkVal&&Layout.Page.container.find("#daysel_sat").prop("checked",!0)}weekly.show()}else interval&&"2"===interval?monthly.show():daily.show()}function scheduleRepeatPopup(){var cons="";return cons+="<div>",cons+='<i onclick="Timetracker.timejobscheduler.backToMainPopup(this)" class="IC-ar-lft S16"></i>',cons+='<div class="form-group"><label class="control-label col-sm-4">'+ZPI18N.getString("zp.repeats")+"</label>",cons+='<div folabel="repeat_name" class="col-sm-6"><select onchange="Timetracker.timejobscheduler.repeatIntervalToggle()" id="repeatid" name="Project"><option value="0">'+ZPI18N.getString("zp.daily")+'</option><option value="1">'+ZPI18N.getString("zp.weekly")+'</option><option value="2">'+ZPI18N.getString("zp.monthly")+"</option></select></div>",cons+="</div>",cons+='<div class="form-group"><label class="control-label col-sm-4">'+ZPI18N.getString("zp.interval")+"</label>",cons+='<div id="repeat_daily_name" class="col-sm-6"><select id="daily_int" name="daily_int"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select></div>',cons+='<div id="repeat_week_name" class="col-sm-6"><select id="week_int" name="weekly_int"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select></div>',cons+='<div id="repeat_month_name" class="col-sm-6"><select id="month_int" name="monthly_int"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select></div>',cons+="</div>",cons+='<div class="form-group" id="rep_daysel" style="display:none">',cons+='<label class="control-label col-sm-4">'+ZPI18N.getString("zp.onthesedays")+"</label>",cons+='<div class="col-sm-6">',cons+='<div class="MB10">',cons+='<label class="checkbox DIB MR10" style="width: 55px;"><input type="checkbox" id="daysel_sun" value="0"/><span>'+ZPI18N.getString("zp.sun")+"</span></label>",cons+='<label class="checkbox DIB MR10" style="width: 55px;"><input type="checkbox" id="daysel_mon" value="1"/><span>'+ZPI18N.getString("zp.mon")+"</span></label>",cons+='<label class="checkbox DIB MR10"><input type="checkbox" id="daysel_tue"value="2"/><span>'+ZPI18N.getString("zp.tue")+"</span></label>",cons+='<label class="checkbox DIB MR10" style="width: 55px;"><input type="checkbox" id="daysel_wed" value="3"/><span>'+ZPI18N.getString("zp.wed")+"</span></label>",cons+='<label class="checkbox DIB MR10" style="width: 55px;"><input type="checkbox" id="daysel_thu" value="4"/><span>'+ZPI18N.getString("zp.thu")+"</span></label>",cons+='<label class="checkbox DIB MR10"><input type="checkbox" id="daysel_fri" value="5"/><span>'+ZPI18N.getString("zp.fri")+"</span></label>",cons+='<label class="checkbox DIB MR10" style="width: 55px;"><input type="checkbox" id="daysel_sat" value="6"/><span>'+ZPI18N.getString("zp.sat")+"</span></label>",cons+="</div>",cons+="</div>",cons+="</div>",cons+='<div class="form-group"><label class="control-label col-sm-4">'+ZPI18N.getString("zp.until")+"</label>",cons+='<div folabel="Date" fieldtype="10" id="" class="col-sm-6" relateddata="false" isfielddependent="false"><div class="btnCal"><input onclick="Calendar.setUpCalendar(event, this,undefined,undefined,Timetracker.timejobscheduler.repDateValidation);" style="width:190px;" fieldtype="10" id="popRepDate" type="text" caltype="filter" name="Date" class="form-control" value=""/><div class="error-msg" id="err_repeat"></div></div></div>',cons+="</div>",cons+="</div>"}function repDateValidation(selDataObj){if(selDataObj){selDataObj.setHours(0,0,0,0);var popDate=Timetracker.timejobscheduler.currPopupDate,popDateObj=Calendar.parseDate(popDate,Calendar.DB_DATEFORMAT),afterAYearDate=Calendar.parseDate(popDate,Calendar.DB_DATEFORMAT);if(afterAYearDate.setFullYear(afterAYearDate.getFullYear()+1),selDataObj>afterAYearDate){var repdae=Calendar.formatDate(afterAYearDate);Layout.Page.container.find("#popRepDate").val(repdae)}else if(selDataObj<popDateObj){repdae=Calendar.formatDate(popDateObj);Layout.Page.container.find("#popRepDate").val(repdae)}Layout.Page.container.find("#popRepDate").trigger("change")}}function schedulePopupComponents(dataObj){var cons="";if(dataObj&&dataObj.isClientFieldAllowed&&(cons+='<div class="form-group"><label class="control-label zp-sm-3 Matry form_clientname singluar_name">'+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'</label><div folabel="Client_name" class="zp-sm-6" title="'+ZPI18N.getString("zp.select")+Timetracker.util.clientDispName+'"><input id="jbsch_clientid" jobId="jbsch_jobid" projectId="jbsch_projectid" name="Client" onchange="Timetracker.jobs.Filters.gettitle(id);"/></div></div>'),cons+='<div class="form-group"><label class="control-label zp-sm-3 Matry form_projectname singluar_name">'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</label><div folabel="Project_name" class="zp-sm-6" title="'+ZPI18N.getString("zp.select")+Timetracker.util.projectDispName+'"><input id="jbsch_projectid" jobId="jbsch_jobid" clientId="jbsch_clientid" name="Project" onchange="Timetracker.jobs.Filters.gettitle(id);"/></div></div><div class="form-group"><label class="control-label zp-sm-3 Matry form_jobname singluar_name">'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'</label><div folabel="Job_name" class="zp-sm-6" title="'+ZPI18N.getString("zp.select")+Timetracker.util.jobDispName+'"><input name="JobId" clientId="jbsch_clientid" projectId="jbsch_projectid" id="jbsch_jobid" onchange="Timetracker.jobs.Filters.gettitle(id);"/><div id="job_error_message" class="error-msg" style="display:none;">'+ZPI18N.getString("zp.selvalforfield",[ZPI18N.getString("zp.jobname")])+'</div></div><div class="col-sm-1 PL0 open" style="top: -5px;"><div id="schColorBox" class="ZPLtyp MT12 LC1 ZPschbx"></div></div></div><div class="form-group"><label class="control-label zp-sm-3">'+ZPI18N.getString("zp.date")+'</label><div folabel="Date" class="zp-sm-3"><div class="btnCal"><input onclick="Calendar.setUpCalendar(event, this, undefined, undefined, Timetracker.timejobscheduler.scheduleDateOnSelectCallback);" onchange="Timetracker.timejobscheduler.scheduleDateOnChangeCallback(this);" id="schdDate" type="text" caltype="filter" name="Date" class="form-control"></div></div></div><div class="form-group"><label class="control-label zp-sm-3 Matry form_time">'+ZPI18N.getString("zp.time")+'</label><div class="zp-sm-8"><div class="hrsDts"><div class="input-group bootstrap-timepicker timepicker"><input type="text" id="timesch_fromtime" class="form-control"><span class="input-group-addon"><div class="IC-clock gry CP"></div></span></div><span class="hyphen">-</span><div class="input-group bootstrap-timepicker timepicker"><input type="text" id="timesch_totime" class="form-control"><span class="input-group-addon"><div class="IC-clock gry CP"></div></span></div></div><div id="time_error_message" class="error-msg" style="display:none;">'+ZPI18N.getString("zp.scheduletimesoverlap")+'</div></div></div><div class="form-group"><label class="control-label zp-sm-3 form_desc">'+ZPI18N.getString("zp.description")+'</label><div folabel="Description" fieldtype="3" id="sch_desc_div" class="zp-sm-6"><textarea fieldtype="3" id="sch_desc" class="form-control" name="Description" rows="5" style="max-width:100%;"></textarea><div id="desc_error_message" class="error-msg" style="display:none;">'+ZPI18N.getString("zp.namecharlimit",[ZPI18N.getString("zp.description"),"500"])+'</div></div></div><div class="form-group"><label class="control-label zp-sm-3 form_desc">'+ZPI18N.getString("zp.repeat")+'</label><div class="zp-sm-8"><label class="checkbox DIBI"><input type="checkbox" id="jbschrepeat" onclick="Timetracker.timejobscheduler.showRepeat(this);"><span class="ML2"></span></label><span class="ML2 S13" style="display:none;" id="repeatinfo"></span><a class="ML2 S13" id="repeatedit" style="display:none;" onclick="Timetracker.timejobscheduler.editRepeat(this)">'+ZPI18N.getString("zp.edit")+'</a></div></div><div class="form-group"><label class="control-label zp-sm-3">'+ZPI18N.getString("zp.billablestatus")+'</label><div folabel="BillableStatus" id="sch_billableStatus_div" class="zp-sm-6"><select id="sch_billableStatus"><option value="-1">'+ZPI18N.getString("zp.select")+'</option><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+'</option></select></div></div><div class="form-group"><label class="control-label zp-sm-3 form_desc">'+ZPI18N.getString("zp.workitem")+'</label><div folabel="Workitem" fieldtype="3" id="sch_workitem_div" class="zp-sm-6"><input id="sch_workitem" class="form-control" name="Workitem" type="text"><div id="sch_workitem_error" class="error-msg" style="display:none;">'+ZPI18N.getString("zp.namecharlimit",[ZPI18N.getString("zp.workitem"),"500"])+"</div></div></div>",hasCustomFields()){var customFields=getCustomFields(),allowedFileds=Timetracker.jobScheduleForm.fetchAllAllowedFields(Timetracker.timejobscheduler.currPopupUser,Timetracker.constants.EDIT,customFields);if(!allowedFileds||0==allowedFileds.length)return;for(var iterator in customFields){var field=customFields[iterator];if(allowedFileds.includes(field.labelName))if(25===field.componentType){var optionsHtml='<option value="0">'+ZPI18N.getString("zp.select")+"</option>";for(var i in field.options)optionsHtml+='<option value="'+field.options[i].optionId+'">'+field.options[i].optionValue+"</option>";cons+='<div class="form-group"><label class="control-label col-sm-3">'+field.displayName+'</label><div folabel="'+field.labelName+'" class="col-sm-6 customField"><select fieldName="'+field.labelName+'" id="'+field.labelName+'_select" class="customFieldSelect">'+optionsHtml+'</select><div class="error-msg customFieldError" id="'+field.labelName+'_error" style="display:none;">'+ZPI18N.getString("zp.selvalforfield",[field.displayName])+"</div></div></div>"}else 19===field.componentType&&(cons+='<div class="form-group"><label class="control-label col-sm-3">'+field.displayName+'</label><div folabel="'+field.labelName+'" fieldtype="'+field.componentType+'" id="'+field.labelName+'" class="col-sm-6 customField"><input fieldName="'+field.labelName+'" id="'+field.labelName+'_input" class="form-control customFieldInput" type="text"><div class="error-msg customFieldError" id="'+field.labelName+'_error" style="display:none;">'+ZPI18N.getString("zp.entervaliddecimal",[field.displayName])+"</div></div></div>")}}return Timetracker.generalSettings.isJobSchTLRestrictExtendEnabled()&&(cons+='<div class="form-group"><label class="control-label zp-sm-3 form_desc">'+ZPI18N.getString("zp.jobschextend")+'</label><div class="zp-sm-8"><label class="checkbox DIBI"><input type="checkbox" id="jbschExtend" checked><span class="ML2"></span></label></div></div>'),cons}function schedulePopupFooter(){var cons="";return cons+='<div class="col-sm-9">',cons+='<button id="publishSchedule" type="button" class="btn btn-primary MR5">'+ZPI18N.getString("zp.publish")+"</button>",cons+='<button id="submitSchedule" type="button" class="btn btn-primary MR5">'+ZPI18N.getString("zp.savedraftbtn")+"</button>",cons+='<button type="button" data-dismiss="modal" id="close_me" class="btn btn-default">'+ZPI18N.getString("zp.cancel")+"</button>",cons+="</div>"}function chooseRepeatType(extraDetails){var txt,header="",body="",action=extraDetails.action;"edit"===action?(header=ZPI18N.getString("zp.editschdorseries"),body='<div class="MB30">'+ZPI18N.getString("zp.applychangesto",[""])+"</div>"):"publish"===action?(header=ZPI18N.getString("zp.pubschdorseries"),body='<div class="MB30">'+ZPI18N.getString("zp.applychangesto",[""])+"</div>"):"delete"===action&&(header=ZPI18N.getString("zp.delschdorseries"),body='<div class="MB10"></div>'),body+=(txt='<div class="MB20"><label class="radio DIB MR10"><input type="radio" name="tt_edit_schd" value="0" checked/><span>'+ZPI18N.getString("zp.editonlythisschd")+'</span></label></div><div class="MB20"><label class="radio DIB MR10"><input type="radio" name="tt_edit_schd" value="1"/><span>'+ZPI18N.getString("zp.editthisschdandnext")+"</span></label></div>",Timetracker.isDataAdmin()&&(txt+='<div class="MB20"><label class="radio DIB MR10"><input type="radio" name="tt_edit_schd" value="2"/><span>'+ZPI18N.getString("zp.editentireseries")+"</span></label></div>"),txt),ZPeople.BSModal.setup({id:"zp_ttschd_edit_confirmpop",type:2,header:header,body:body,modalClass:"ZPsecModal DelMdl fade",closeOnSubmit:!0,isConfirm:!1,buttonValue:ZPI18N.getString("zp.confirm"),successCallback:Timetracker.timejobscheduler.chooseRepeatTypeCallback,extraDetails:extraDetails||{}})}function convertRepeattoSelect2(){Layout.Page.container.find("#repeatid").select2({minimumResultsForSearch:"-1"}),Layout.Page.container.find("#daily_int").select2({minimumResultsForSearch:"-1"}),Layout.Page.container.find("#week_int").select2({minimumResultsForSearch:"-1"}),Layout.Page.container.find("#month_int").select2({minimumResultsForSearch:"-1"})}function checkTimeOverLaps(newFrm,newTo,oldFrm,OldTo){return newFrm>=oldFrm&&newTo<=OldTo||(newFrm<=oldFrm&&newFrm<=OldTo&&newTo>=oldFrm&&newTo<=OldTo||(newFrm>=oldFrm&&newFrm<=OldTo&&newTo>=oldFrm&&newTo>=OldTo||newFrm<=oldFrm&&newFrm<=OldTo&&newTo>=oldFrm&&newTo>=OldTo))}function updateUnpublishedCount(){var par=Layout.Page.container.find("#pubtext").parent(),pubtxt=Layout.Page.container.find("#pubtext"),pubcount=Layout.Page.container.find("#jsch_pub_count"),len=pub_cache.count,cls="btn-default",ptext=ZPI18N.getString("zp.published");if(par.removeClass("btn-default").removeClass("btn-primary"),pubtxt.text(""),pubcount.hide(),pubcount.text(""),par.attr("disabled",!0),len>=1){par.attr("disabled",!1),ptext=ZPI18N.getString("zp.publish"),cls="btn-primary";var counttxt=ZPI18N.getString("zp.jobscheduer.pendingpub",[len]);pubcount.text(counttxt),pubcount.css("display","block")}par.addClass(cls),pubtxt.text(ptext)}function constructSingleWeekSchedule(jobData,isFromAdd,isMoved){var onlydate=jobData.date.split(" ")[0].split("-");jobData&&!jobData.isPubed&&isFromAdd&&(pub_cache.count+=1);var assignee_val=jobData.assignedTo,tr_id="tr_"+assignee_val,td_id=assignee_val+"_"+onlydate[2],dom=scheduleWeekDom(jobData,assignee_val),ftime=parseInt(jobData.fromTime),ttime=parseInt(jobData.toTime),thoursDom=Layout.Page.container.find("#"+tr_id).find(".DC_JSUhr"),total=thoursDom.attr("tmins")||0;total=parseInt(total);var oldtime=0,newtime=(ttime<ftime?ttime+Timetracker.constants.PER_DAY_MIN:ttime)-ftime,oldAssigneeVal=assignee_val,oldDate=onlydate;if(isFromAdd||isMoved){if(Layout.Page.container.find("#"+tr_id).find("#"+td_id).find(".js-schedule").append(dom),!isMoved){total+=newtime;var thours=Calendar.minstohrs(total);thoursDom.attr("tmins",total),thoursDom.text(thours)}}else{var isDateChanged=!1,oldDom=Layout.Page.container.find("#"+tr_id).find("#"+td_id).find(".js-schedule").find("#"+jobData.tschId);0===oldDom.length&&(isDateChanged=(oldDom=Layout.Page.container.find("#"+tr_id).find(".js-schedule").find("#"+jobData.tschId)).length>0);var oldData=oldDom.data();oldAssigneeVal=oldData.assignedTo,oldDate=oldData.date.split(" ")[0].split("-");var oldfrom=parseInt(oldData.fromTime),oldto=parseInt(oldData.toTime),newt=total+(newtime-(oldtime=(oldto<oldfrom?oldto+Timetracker.constants.PER_DAY_MIN:oldto)-oldfrom));newt<0&&(newt=newtime);thours=Calendar.minstohrs(newt);thoursDom.attr("tmins",newt),thoursDom.text(thours);var oldpub=oldDom.data("isPubed");jobData.isPubed&&!oldpub&&(pub_cache.count-=1),!jobData.isPubed&&oldpub&&(pub_cache.count+=1),isDateChanged?(oldDom.remove(),Layout.Page.container.find("#"+tr_id).find("#"+td_id).find(".js-schedule").append(dom)):oldDom.replaceWith(dom)}updateUnpublishedCount(),function(old_assignedto,assignedto,old_date,date,oldtimemins,newtimemins){var budgetBandDOM=Layout.Page.container.find(".ZP_JOBSCHD_BAND");if(0!==budgetBandDOM.length&&!budgetBandDOM.hasClass("DN")){var budget_info=budgetBandDOM.data("budget_info");null===Timetracker.timesheet.userRates&&Timetracker.timesheet.getUserRates();var old_user_rate=null!==Timetracker.timesheet.userRates&&Timetracker.timesheet.userRates[old_assignedto]&&Timetracker.timesheet.userRates[old_assignedto].ratePerHour?Timetracker.timesheet.userRates[old_assignedto].ratePerHour:0,user_rate=null!==Timetracker.timesheet.userRates&&Timetracker.timesheet.userRates[assignedto]&&Timetracker.timesheet.userRates[assignedto].ratePerHour?Timetracker.timesheet.userRates[assignedto].ratePerHour:0;if(0!==old_user_rate||0!==user_rate){var oldDateUpdated=!1,newDateUpdated=!1;$.each(budget_info,function(index,budgetObj){var fromDate=budgetObj.fromDate_db,toDate=budgetObj.toDate_db,budget_spent=budgetObj.budget_spent?parseFloat(budgetObj.budget_spent):0,isOldDateInRange=Timetracker.DateTime.isDateInRange(old_date,fromDate,toDate);isOldDateInRange&&budget_spent>0&&(budget_spent=(budget_spent=parseFloat(budget_spent)-parseFloat(oldtimemins)/60*old_user_rate).toFixed(2),budgetObj.budget_spent=budget_spent,budgetBandDOM.find("#"+budgetObj.budgetId).html(budget_spent+" / "+budgetObj.amount),budgetBandDOM.find("#"+budgetObj.budgetId).attr("data-original-title",budget_spent+" / "+budgetObj.amount),oldDateUpdated=!0);var isDateInRange=Timetracker.DateTime.isDateInRange(date,fromDate,toDate);if(isDateInRange&&(budget_spent=(budget_spent=parseFloat(budget_spent)+parseFloat(newtimemins)/60*user_rate).toFixed(2),budgetObj.budget_spent=budget_spent,budgetBandDOM.find("#"+budgetObj.budgetId).html(budget_spent+" / "+budgetObj.amount),budgetBandDOM.find("#"+budgetObj.budgetId).attr("data-original-title",budget_spent+" / "+budgetObj.amount),newDateUpdated=!0),oldDateUpdated&&newDateUpdated)return!1})}}}(oldAssigneeVal,assignee_val,oldDate,onlydate,oldtime,newtime)}var resObj={constJobScheduleForWeekview:function(res,ep){if(Timetracker.util.removeLoading(),isJBSCalled=!1,res.errorCode){var showEMsg=!0,ecode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");"9000"==ecode&&(res.isPageView?(Timetracker.util.appendPermissionDenied(!0),showEMsg=!1):emsg=ZPI18N.getString("zp.permdenied")),showEMsg&&ZPeople.Message.showWarningMsg(emsg)}else Layout.Page.container.find("#week_view_jobsch").show(),pub_cache.count=res.unpubcount,function(budgetArr,defaultCurrency){if(budgetArr&&budgetArr.length){if(0===(budgetBandDOM=Layout.Page.container.find(".ZP_JOBSCHD_BAND")).length){budgetBandDOM=$('<div class="well ZPDat DN ZP_JOBSCHD_BAND"><div class="zp-Bcalc"></div></div>');var budgetLeftDOM=$('<div class="zpcalc_lft"><label for="">'+ZPI18N.getString("zp.tsbudgetperiod")+' <em>:</em></label><label for="">'+ZPI18N.getString("zp.tsspent/allocated")+(defaultCurrency?" ("+defaultCurrency+")":"")+" <em>:</em></label></div>"),budgetRightDOM=$('<div class="zpcalc_rgt">');budgetBandDOM.find(".zp-Bcalc").append(budgetLeftDOM),budgetBandDOM.find(".zp-Bcalc").append(budgetRightDOM),Layout.Page.container.find(".Scrcont").after(budgetBandDOM)}budgetRightDOM=budgetBandDOM.find(".zpcalc_rgt");var budgetRightHtml="";$.each(budgetArr,function(index,budgetObj){budgetRightHtml+='<div class="bdgt_dt"><span data-toggle="tooltip" data-original-title="'+budgetObj.fromDate+" - "+budgetObj.toDate+"("+budgetObj.budgetName+')">'+budgetObj.fromDate+" - "+budgetObj.toDate+'</span><span id="'+budgetObj.budgetId+'" data-toggle="tooltip" data-original-title="'+budgetObj.budget_spent+" / "+budgetObj.amount+'">'+budgetObj.budget_spent+" / "+budgetObj.amount+"</span></div>"}),budgetRightDOM.html(budgetRightHtml),budgetBandDOM.removeClass("DN"),budgetBandDOM.data("budget_info",budgetArr),$("#page-wrapper").addClass("Dbar1")}else{var budgetBandDOM;0!==(budgetBandDOM=Layout.Page.container.find(".ZP_JOBSCHD_BAND")).length&&(budgetBandDOM.addClass("DN"),budgetBandDOM.data("budget_info",[]),budgetBandDOM.find(".zpcalc_rgt").html("")),$("#page-wrapper").removeClass("Dbar1")}}(res.budget_info,res.defaultCurrency),function(userArr,jobschArr){var currUserList=userArr,sch_body=Layout.Page.container.find("#tt_jobschedule_tbody");if(firescroll_Triggered=!1,1===Timetracker.timejobscheduler.emp_cache.index){Timetracker.timejobscheduler.usersList=userArr;var head=$('<div class="innerCont"><div class="ttl"><span>'+ZPI18N.getString("zp.employee")+'</span></div><ul class="zp_hdr"></ul></div>'),wstime=Calendar.weekfromdate.getTime(),weekStarts=new Date;weekStarts.setTime(wstime);for(var i=0;i<7;i++){i>0&&weekStarts.setDate(weekStarts.getDate()+1);var date=Timetracker.util.convertDateTo2digit(weekStarts.getDate()),currDate=Calendar.getCurrentDate();currDate.setHours(0,0,0,0);var currDayCls="";currDate&&weekStarts&&weekStarts.getTime()==currDate.getTime()&&(currDayCls="zp_active");var daysHeader=head.find(".zp_hdr");daysHeader.append($('<li class="'+currDayCls+'"><span><small>'+days[weekStarts.getDay()]+"</small>"+date+"</span></li>"))}Layout.Page.container.find("#tt_jobschedule_thead").html(head),sch_body.html("")}else Timetracker.timejobscheduler.usersList=Timetracker.timejobscheduler.usersList.concat(userArr);var docFrag=document.createDocumentFragment();currUserList&&currUserList.length?(Layout.Page.container.find("#zp_empty_data").hide(),$.each(currUserList,function(index,userDetail){var userTR=function(userDetail){var trTxt=$('<div class="innerCont" id="tr_'+userDetail.empId+'"></div>');trTxt.data(userDetail),trTxt.append('<div class="ttl"><div class="zpUsrIn"><div class="zpUsrPht"><div class="zpUsrPhtIn"><img src="'+userDetail.empPhoto+'"></div></div><div class="zpUsrDets"><label title="'+userDetail.empName+'"><strong><span>'+userDetail.employeeId+"</span>"+userDetail.empName+'</strong></label><p><i class="IC-clock gry"></i><em class="DC_JSUhr">00:00</em></p></div></div></div>');var wstime=Calendar.weekfromdate.getTime(),weekStarts=new Date;weekStarts.setTime(wstime);for(var leaveObj=userDetail.leaveObj?userDetail.leaveObj:{},ul=$("<ul style='height:80px;'></ul>"),i=0;i<7;i++){i>0&&weekStarts.setDate(weekStarts.getDate()+1);var date=Timetracker.util.convertDateTo2digit(weekStarts.getDate()),currDate=Calendar.getCurrentDate();currDate.setHours(0,0,0,0);var currDayCls="";currDate&&weekStarts&&weekStarts.getTime()==currDate.getTime()&&(currDayCls="zp_active");var leaveCls="",leaveTitle="",dbDate=Timetracker.DateTime.getDateinDBformat(weekStarts,!0),leaveDtl=leaveObj[dbDate];if(leaveDtl){var hideWeekEnd=Timetracker.generalSettings.hideWeekEnd(),hideHoliday=Timetracker.generalSettings.hideHoliday(),hideLeave=Timetracker.generalSettings.hideLeave();!hideWeekEnd&&leaveDtl.isweekend&&!0===leaveDtl.isweekend&&(leaveCls="W_End",leaveTitle=ZPI18N.getString("zp.weekend")),!hideHoliday&&leaveDtl.isHoliday&&!0===leaveDtl.isHoliday&&(leaveCls="H_Day",leaveTitle=holiday_disName===ZPI18N.getString("zp.holidays")?ZPI18N.getString("zp.holiday"):holiday_disName),!hideLeave&&leaveDtl.leaves&&0!==leaveDtl.leaves.length&&(0!==leaveDtl.leaves[0].leaveCount?(leaveCls="C_Lev",leaveTitle=leaveDtl.leaves[0].leavetypeName):(!hideWeekEnd&&leaveDtl.isweekend&&!0===leaveDtl.isweekend&&(leaveCls="W_End",leaveTitle=ZPI18N.getString("zp.weekend")),!hideHoliday&&leaveDtl.isHoliday&&!0===leaveDtl.isHoliday&&(leaveCls="H_Day",leaveTitle=holiday_disName===ZPI18N.getString("zp.holidays")?ZPI18N.getString("zp.holiday"):holiday_disName)))}var trTxtDomPlus=$('<li class="DC_jbPop '+currDayCls+" "+leaveCls+'" dateid="'+weekStarts.getFullYear()+"-"+("0"+(weekStarts.getMonth()+1).toString()).substr(-2)+"-"+date+'" id="'+userDetail.empId+"_"+date+'"><div class="js-schedule"></div><div class="weeksch-drop zpshiftTms zp_ItemPH DN"></div><span class="jobTitle" title="'+leaveTitle+'">'+leaveTitle+"</span></li>");ul.append(trTxtDomPlus),trTxt.append(ul)}trTxt.append(ul),trTxt.find(".DC_jbPop").droppable({accept:".zjs-info",over:function(event,ui){var cellDiv=$(event.target),dropDate=cellDiv.attr("dateid").split(" ")[0]?cellDiv.attr("dateid").split(" ")[0]:cellDiv.attr("dateid"),dropUser=cellDiv.attr("id").split("_")[0],origCell=$(ui.draggable).parent().parent(),origDate=origCell.attr("dateid").split(" ")[0]?origCell.attr("dateid").split(" ")[0]:origCell.attr("dateid"),origUser=origCell.attr("id").split("_")[0];dropDate!==origDate&&dropUser===origUser?$(this).find(".weeksch-drop").css("display","block"):$(this).find(".weeksch-drop").hide()},out:function(event,ui){$(this).find(".weeksch-drop").hide()},drop:function(event,ui){var cellDiv=$(event.target),movedDiv=ui.draggable,dropDate=cellDiv.attr("dateid").split(" ")[0]?cellDiv.attr("dateid").split(" ")[0]:cellDiv.attr("dateid"),dropUser=cellDiv.attr("id").split("_")[0],origCell=$(ui.draggable).parent().parent(),origDate=origCell.attr("dateid").split(" ")[0]?origCell.attr("dateid").split(" ")[0]:origCell.attr("dateid"),origUser=origCell.attr("id").split("_")[0];if(dropDate!==origDate&&dropUser===origUser){var isEditAllowed=isAddEditAllowed(dropUser);if($(this).find(".weeksch-drop").hide(),!isEditAllowed)return;if(isEditAllowed&&!(Timetracker.isDataAdminForUser(dropUser)||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit)&&Timetracker.isTTCustomAdminForUser(Timetracker.constants.TTCustomAdmin.EntryEdit,dropUser))){var dateObj=Calendar.parseDate(dropDate,Calendar.DB_DATEFORMAT),currDate=Calendar.getCurrentDate();dateObj.setHours(0,0,0,0),currDate.setHours(0,0,0,0),isEditAllowed=currDate.getTime()<=dateObj.getTime()}if(isEditAllowed){var jsonParam={},cellData=movedDiv.data(),jobSchObj={};if(jobSchObj.jobId=cellData.jobId,jobSchObj.desc=cellData.desc,jobSchObj.isPubed=cellData.isPubed,jobSchObj.fromtime=cellData.fromTime,jobSchObj.totime=cellData.toTime,jobSchObj.tschId=cellData.tschId,jobSchObj.assignedTo=cellData.assignedTo,jobSchObj.billableStatus=cellData.billableStatus,jobSchObj.workitem=cellData.workitem,isJobSchTLExtendEnabled()&&(jobSchObj.extendAllowed=cellData.extendAllowed),hasCustomFields()&&(jobSchObj.customFieldDetails=JSON.stringify(cellData.customFieldDetails)),jobSchObj.date=dropDate,cellData.repeatId){jobSchObj.editRepeat=!1,jobSchObj.repeatId=cellData.repeatId,jobSchObj.repeatType=cellData.repeatType,jobSchObj.repeatInt=cellData.repeatInt;var repuntil=cellData.repeatUntil;repuntil&&(repuntil=repuntil.split(" ")[0],jobSchObj.repeatUntil=repuntil),jobSchObj.repeatRule=cellData.repeatRule}jsonParam.p=jobSchObj,jsonParam.ep=jQuery.extend({},jobSchObj),jsonParam.ep.isMoved=!0,jsonParam.ep.moveDiv=movedDiv,jsonParam.fn=Timetracker.timejobscheduler.updateJobScheduleResponse,reqObj.updateJobSchedule(jsonParam),movedDiv.draggable({revert:!1})}else ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.schedulepastdatemove")),movedDiv.draggable({revert:!0});return!1}$(this).find(".weeksch-drop").hide(),movedDiv.draggable({revert:!0})}}),userDetail.jobschArr&&userDetail.jobschArr.length>0&&function(schArr,trElem){var empId=trElem.data("empId"),totalmins=0;if($.each(schArr,function(job_index,jobData){var onlydate=jobData.date.split(" ")[0].split("-")[2],tmins=(jobData.toTime<jobData.fromTime?jobData.toTime+Timetracker.constants.PER_DAY_MIN:jobData.toTime)-jobData.fromTime;totalmins+=tmins;var dom=scheduleWeekDom(jobData,empId);trElem.find("#"+empId+"_"+onlydate).find(".js-schedule").append(dom)}),totalmins){var thours=Calendar.minstohrs(totalmins),empWeekHrs=trElem.find(".DC_JSUhr");empWeekHrs.attr("tmins",totalmins),empWeekHrs.text(thours)}}(userDetail.jobschArr,trTxt);return updateUnpublishedCount(),trTxt}(userDetail);docFrag.appendChild(userTR[0])})):1===Timetracker.timejobscheduler.emp_cache.index&&(Layout.Page.container.find("#week_view_jobsch").hide(),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.nojbschedulefound"),{classname:"CR-nodata",path:"path5"}));0!=pub_cache.count||currUserList&&currUserList.length||updateUnpublishedCount();currUserList&&currUserList.length===emp_cache.fetchCount?Timetracker.timejobscheduler.emp_cache.index+=emp_cache.fetchCount:isEmpFetchAvail=!1;sch_body.append(docFrag),Layout.Page.container.find("#tt_jobschedule_tbody").off("click","li.DC_jbPop").on("click","li.DC_jbPop",function(e){e.preventDefault(),e.stopPropagation(),Timetracker.timejobscheduler.addJobScheduleConstruct(e,this)})}(res.usersList,res.jobschArr)},constJobScheduleForDayview:function(res,ep){if(Timetracker.util.removeLoading(),isJBSCalled=!1,res.errorCode){var showEMsg=!0,ecode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");"9000"==ecode&&(res.isPageView?(Timetracker.util.appendPermissionDenied(!0),showEMsg=!1):emsg=ZPI18N.getString("zp.permdenied")),showEMsg&&ZPeople.Message.showWarningMsg(emsg)}else Layout.Page.container.find("#day_view_jobsch").show(),pub_cache.count=res.unpubcount,constructDaybasedView(res.usersList,res.jobschArr)},addJobScheduleResponse:function(res,ep,obj){var jobData=res.job_sch;if(Layout.Page.container.find("#jobsch_modelmask").modal("hide"),res.errorCode){var showError=!0,ecode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");if("1019"==ecode)emsg=ZPI18N.getString("zp.jbshaddeditoverlap");else if("1020"==ecode||"1021"==ecode)emsg=ZPI18N.getString("zp.jbshnopermadd");else if("1025"===ecode)emsg=ZPI18N.getString("zp.usernotinjob");else if("1035"==ecode)emsg=ZPI18N.getString("zp.jobscheduledatevalid");else if("1038"==errorCode)emsg=ZPI18N.getString("zp.jobschedulefromtotimesameerror");else if("1024"==ecode||"1026"==ecode||"1029"==ecode||"1036"==ecode){emsg=ZPI18N.getString("zp.jobschdmaxloghrsexceed"),"1026"==ecode?emsg=ZPI18N.getString("zp.jobschdbudgetexceed"):"1029"==ecode?emsg=ZPI18N.getString("zp.jobschdbudgetmaxloghrsexceed"):"1036"==ecode&&(emsg=ZPI18N.getString("zp.jobschedulerepdatevalidconfirm")),showError=!1;var modal_id="zp_maxhrs_modal_confirmpop";"1026"==ecode?modal_id="zp_budget_modal_confirmpop":"1029"==ecode?modal_id="zp_budget_maxhrs_modal_confirmpop":"1036"==ecode&&(modal_id="zp_jobscheduledate_modal_confirmpop"),ZPeople.BSModal.setup({id:modal_id,type:3,header:"",body:emsg,modalClass:"modal DelMdl ZPsecModal",closeOnSubmit:!0,isConfirm:!1,iconParenClass:"orgbgi",buttonValue:ZPI18N.getString("zp.confirm"),iconClass:"IC-alert",successCallback:Timetracker.timejobscheduler.scheduleexceptioncallback,hiddenCallback:res.isAdded?Timetracker.timejobscheduler.refreshCallback:void 0,extraDetails:{id:modal_id,reqestObj:$.extend(!0,{},obj),callback:Timetracker.timejobscheduler.addJobSchedule}})}showError&&ZPeople.Message.showWarningMsg(emsg)}else if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.jobschaddmsg")),Timetracker.jobScheduleInTimelogsView.populateJobSchDetailsCache(null,!0),ep.isRepeat)resetEmployeeFetch(),"1"===calview?getJobScheduleForWeekview():"0"===calview&&getJobScheduleForDayview();else if("1"===calview)constructSingleWeekSchedule(jobData,!0);else if("0"===calview){var empId=jobData.assignedTo,liElem=Layout.Page.container.find("#dayrow_"+empId);if(liElem.length)positionScheduleInDayview(liElem.find("div[id='has_drag_id_"+empId+"']").parent(),jobData,empId,!0)}},updateJobScheduleResponse:function(res,ep,obj){Layout.Page.container.find("#jobsch_modelmask").modal("hide");var jobData=res.job_sch;if(res.errorCode){var showError=!0,ecode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");if("1019"==ecode)emsg=ZPI18N.getString("zp.jbshaddeditoverlap");else if("1020"==ecode)emsg=ZPI18N.getString("zp.pastdateschedule");else if("1021"==ecode)emsg=ZPI18N.getString("zp.jbshnopermedit");else if("1025"==ecode)emsg=ZPI18N.getString("zp.userNotInJob");else if("1035"==ecode)emsg=ZPI18N.getString("zp.jobscheduledatevalid");else if("1038"==errorCode)emsg=ZPI18N.getString("zp.jobschedulefromtotimesameerror");else if("1024"==ecode||"1026"==ecode||"1029"==ecode||"1036"==ecode){emsg=ZPI18N.getString("zp.jobschdmaxloghrsexceed"),"1026"==ecode?emsg=ZPI18N.getString("zp.jobschdbudgetexceed"):"1029"==ecode?emsg=ZPI18N.getString("zp.jobschdbudgetmaxloghrsexceed"):"1036"==ecode&&(emsg=ZPI18N.getString("zp.jobschedulerepdatevalidconfirm")),showError=!1;var modal_id="zp_maxhrs_modal_confirmpop";"1026"==ecode?modal_id="zp_budget_modal_confirmpop":"1029"==ecode?modal_id="zp_budget_maxhrs_modal_confirmpop":"1036"==ecode&&(modal_id="zp_jobscheduledate_modal_confirmpop"),ZPeople.BSModal.setup({id:modal_id,type:3,header:"",body:emsg,modalClass:"modal DelMdl ZPsecModal",closeOnSubmit:!0,isConfirm:!1,iconParenClass:"orgbgi",buttonValue:ZPI18N.getString("zp.confirm"),iconClass:"IC-alert",successCallback:Timetracker.timejobscheduler.scheduleexceptioncallback,hiddenCallback:res.isUpdated?Timetracker.timejobscheduler.refreshCallback:void 0,extraDetails:{id:modal_id,reqestObj:$.extend(!0,{},obj),callback:Timetracker.timejobscheduler.updateJobSchedule}})}if(showError&&ZPeople.Message.showWarningMsg(emsg),ep&&ep.moveDiv&&ep.isMoved)return ep.moveDiv.animate({left:0,top:0},500);if(ep&&ep.moveUI){var ui=ep.moveUI;ui.element?(ui.element.css(ui.originalPosition),ui.element.css(ui.originalSize)):ui.helper&&ui.helper.css(ui.originalPosition)}}else{ep&&ep.isMoved&&ep.moveDiv&&ep.moveDiv.remove(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.jobscheditmsg"));if(ep&&ep.isMoved&&!0,ep.isRepeat)resetEmployeeFetch(),"1"===calview?getJobScheduleForWeekview():"0"===calview&&getJobScheduleForDayview();else if("1"===calview)constructSingleWeekSchedule(jobData,!1,!(!ep||!ep.isMoved));else if("0"===calview){var empId=jobData.assignedTo,liElem=Layout.Page.container.find("#dayrow_"+empId);if(liElem.length)positionScheduleInDayview(liElem.find("div[id='has_drag_id_"+empId+"']").parent(),jobData,empId,!1)}}},bulkPublishJobScheduleResponse:function(res,ep){if(Timetracker.util.removeLoading(),resetEmployeeFetch(),"errorpublishing"===res)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.ttfailuremsg"));else if(res.errorCode){var errorCode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");"1021"===errorCode?emsg=ZPI18N.getString("zp.jbshnopermeditpub"):"1020"===errorCode&&(emsg=ZPI18N.getString("zp.pastdateschedule")),ZPeople.Message.showFailureMsg(emsg)}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.jobschpublishmsg")),"1"===calview?getJobScheduleForWeekview():"0"===calview&&getJobScheduleForDayview()},cloneJobScheduleResponse:function(res,ep){if(Timetracker.util.removeLoading(),Layout.Page.container.find("#jobschd_clone").removeClass("disabled"),resetEmployeeFetch(),void 0===res||null===res)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.ttfailuremsg"));else if(res.errorCode){var errorCode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");"1021"===errorCode?emsg=ZPI18N.getString("zp.jbshnopermclone"):"1022"===errorCode?emsg=ZPI18N.getString("zp.jbschclonedaterange"):"1023"===errorCode?emsg=ZPI18N.getString("zp.jbschclonenoschd"):"1031"==errorCode?emsg=ZPI18N.getString("zp.jbschclonefewschdskipped"):"1032"==errorCode?emsg=ZPI18N.getString("zp.jbschcloneallschdskipped"):"1035"==errorCode?emsg=ZPI18N.getString("zp.jobschedulestartandendateskip"):"1037"==errorCode?emsg=ZPI18N.getString("zp.jobschedulestartandendateoverlapskip"):"1038"==errorCode&&(emsg=ZPI18N.getString("zp.jobschedulefromtotimesameerror")),ZPeople.Message.showFailureMsg(emsg)}else res.success?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.jobschclonemsg")),"1"===calview?getJobScheduleForWeekview():"0"===calview&&getJobScheduleForDayview()):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.ttfailuremsg"))},scheduleexceptioncallback:function(modal){var extraDtls=modal.data("extraDetails");if(Timetracker.generalSettings.isBudgetEnabled()){ZPeople.BSModal.setup({id:"zp_comment_modal",type:3,header:ZPI18N.getString("zp.comment"),body:'<div><textarea class="form-control" id="zp_js_comment" rows="5"></textarea></div>',modalClass:"modal DelMdl ZPsecModal",iconParenClass:"orgbgi",iconClass:"IC-alert",successCallback:Timetracker.timejobscheduler.exceptionCommentsCallback,extraDetails:{extraDtls:$.extend(!0,{},extraDtls),id:modal.attr("id")}})}else{var callback=extraDtls&&extraDtls.callback?extraDtls.callback:null,reqestObj=extraDtls&&extraDtls.reqestObj?extraDtls.reqestObj:null,id=modal.attr("id");reqestObj.p.skipMaxLogHrsValidation=!0,"zp_budget_modal_confirmpop"===id?reqestObj.p.skipBudgetExceedValidation=!0:"zp_maxhrs_modal_confirmpop"===id?reqestObj.p.skipMaxLogHrsValidation=!0:"zp_budget_maxhrs_modal_confirmpop"===id?(reqestObj.p.skipBudgetExceedValidation=!0,reqestObj.p.skipMaxLogHrsValidation=!0):"zp_jobscheduledate_modal_confirmpop"===id&&(reqestObj.p.skipJobSchJobRepeatDateValidation=!0,reqestObj.p.skipMaxLogHrsValidation=!1),null!==reqObj&&null!==callback&&ZPUtil.Validation.isFunction(callback)&&(ZPeople.BSModal.hide(id),Timetracker.util.appendLoading(),callback(reqestObj),Timetracker.util.removeLoading())}},exceptionCommentsCallback:function(modal){var commentObj=modal.find("#zp_js_comment"),comment=$(commentObj).val();if(void 0===comment||""===comment.trim())commentObj.addClass("error-clr");else if(comment.length>1e3)Timetracker.util.appendErrorMsg({obj:commentObj,msg:ZPI18N.getString("zp.namecharlimit",[ZPI18N.getString("zp.comment"),"1000"])});else{var extraDtls,id,extraDetails=modal.data("extraDetails");extraDetails&&(extraDtls=extraDetails.extraDtls,id=extraDetails.id);var callback=extraDtls&&extraDtls.callback?extraDtls.callback:null,reqestObj=extraDtls&&extraDtls.reqestObj?extraDtls.reqestObj:null;"zp_budget_modal_confirmpop"===id?reqestObj.p.skipBudgetExceedValidation=!0:"zp_maxhrs_modal_confirmpop"===id?reqestObj.p.skipMaxLogHrsValidation=!0:"zp_budget_maxhrs_modal_confirmpop"===id&&(reqestObj.p.skipBudgetExceedValidation=!0,reqestObj.p.skipMaxLogHrsValidation=!0),reqestObj.p.comment=comment,null!==reqObj&&null!==callback&&ZPUtil.Validation.isFunction(callback)&&(ZPeople.BSModal.hide("zp_comment_modal"),Timetracker.util.appendLoading(),callback(reqestObj),Timetracker.util.removeLoading())}},refreshCallback:function(){resetEmployeeFetch(),"1"===calview?getJobScheduleForWeekview():"0"===calview&&getJobScheduleForDayview()}},reqObj={getJobSchedule:function(jsonObj){if(Timetracker.util.removePermissionDenied(),!isJBSCalled){isJBSCalled=!0;var reqObj={u:"/timesheetDispAction.zp?mode=getJobSchedule",t:"post"};reqObj.p=jsonObj.p,reqObj.ep=jsonObj.ep,reqObj.fn=jsonObj.fn,zpTimeTrackerAjq.XHR(reqObj)}},addJobSchedule:function(jsonObj){var reqObj={u:"/timesheetDispAction.zp?mode=addJobSchedule",t:"post"};reqObj.p=jsonObj.p,reqObj.ep=jsonObj.ep,reqObj.fn=jsonObj.fn,zpTimeTrackerAjq.XHR(reqObj)},updateJobSchedule:function(jsonObj){var reqObj={u:"/timesheetDispAction.zp?mode=updateJobSchedule",t:"post"};reqObj.p=jsonObj.p,reqObj.ep=jsonObj.ep,reqObj.fn=jsonObj.fn,zpTimeTrackerAjq.XHR(reqObj)},deleteJobSchedule:function(jsonObj){var reqObj={u:"/timesheetDispAction.zp?mode=deleteJobSchedule",t:"post"};reqObj.p=jsonObj.p,reqObj.ep=jsonObj.ep,reqObj.fn=jsonObj.fn,zpTimeTrackerAjq.XHR(reqObj)},bulkPublishJobSchedule:function(jsonObj){var reqObj={u:"/timesheetDispAction.zp?mode=bulkPublishJobSchedule",t:"post"};reqObj.p=jsonObj.p,reqObj.ep=jsonObj.ep,reqObj.fn=jsonObj.fn,zpTimeTrackerAjq.XHR(reqObj)},cloneJobSchedule:function(jsonObj){var reqObj={};reqObj.u=Timetracker.constants.URL,reqObj.t="post",reqObj.p=jsonObj.p,reqObj.ep=jsonObj.ep,reqObj.fn=jsonObj.fn,zpTimeTrackerAjq.XHR(reqObj)}};function setWeekLogHeader(){var calinfo,calInfoDiv=Layout.Page.container.find("#calInfo");calInfoDiv.removeClass("mon").removeClass("day").removeClass("week"),calinfo=Timetracker.timelogs.getDateinTSformat(Timetracker.timejobscheduler.navigateDate.from)+" - "+Timetracker.timelogs.getDateinTSformat(Timetracker.timejobscheduler.navigateDate.to),calInfoDiv.addClass("week"),calInfoDiv.html(calinfo)}function editJobScheduleConstruct(editJson,ev,th,showChooseEdit,disableEdit){var empno,dateid;if("1"===calview?(empno=$(th).parent().parent().attr("id").split("_")[0],dateid=$(th).parent().parent().attr("dateid")):"0"===calview&&(empno=$(th).data("empId"),dateid=editJson.date.split(" ")[0]),Timetracker.timejobscheduler.currPopupDate=dateid,Timetracker.timejobscheduler.currPopupUser=empno,isAddEditAllowed(Timetracker.timejobscheduler.currPopupUser)&&!disableEdit){Timetracker.timejobscheduler.currPopupMode="edit";var tempObj=$(templates.addEditJobSchPop("edit")),modalElm=tempObj.find("#jobsch_mdialog");Layout.Page.container.find("#jobsch_modelmask").remove(),Layout.Page.container.append(tempObj);var cons,isClientFieldAllowed=Timetracker.jobScheduleForm.isClientFieldAllowed(Timetracker.timejobscheduler.currPopupUser,Timetracker.constants.EDIT);modalElm.find("#jobsch_form").append(schedulePopupComponents({isClientFieldAllowed:isClientFieldAllowed})),$("#jobsch_form").data("disEditab",disableEdit),$("#jobsch_form").data("IsPublish",editJson.isPubed),Timetracker.generalSettings.isBudgetEnabled()&&editJson.isException&&editJson.comment&&(modalElm.find("#sch_desc_div").parent().after((cons="",cons+='<div class="form-group"><label class="control-label col-sm-4 form_desc">'+ZPI18N.getString("zp.comments")+'</label><div folabel="Comment" fieldtype="3" id="sch_comment_div" class="col-sm-8"><textarea fieldtype="3" id="sch_comment" class="form-control" name="Comment" readonly="true" rows="5" style="max-width:100%;"></textarea></div></div>')),modalElm.find("#jobsch_form").css("height","440px")),modalElm.find("#jobsch_footer").append(schedulePopupFooter()),modalElm.find("#repeat_form").append(scheduleRepeatPopup());showChooseEdit?(modalElm.find("#jobsch_form").show(),modalElm.find("#jobsch_delete").show(),modalElm.find("#repeat_form").hide(),modalElm.find("#repeatedit").show(),modalElm.find("#jobsch_delete").off("click").on("click",function(){chooseRepeatType({id:editJson.tschId,action:"delete"})})):(Layout.Page.container.find("#jobsch_delete").show(),!0,Layout.Page.container.find("#jobsch_delete").off("click").on("click",function(){$(this).data({id:editJson.tschId}),ZPeople.BSModal.confirm(Timetracker.timejobscheduler.deleteSchedule,"",void 0,void 0,{id:editJson.tschId})})),convertRepeattoSelect2(),repeatIntervalToggle(),Layout.Page.container.find("#publishSchedule").off("click").on("click",function(){showChooseEdit?Timetracker.timejobscheduler.validateAddUpdateJobScheduleDetails(empno,editJson)&&chooseRepeatType({dateid:dateid,empno:empno,tschObj:editJson,isPubed:!0,action:"publish"}):Timetracker.timejobscheduler.addUpdateJobScheduleDetails(empno,editJson,!0,!0)}),disableEdit?(Layout.Page.container.find("#submitSchedule").prop("disabled",!0),Layout.Page.container.find("#jobsch_delete").hide(),Layout.Page.container.find("#jbschrepeat").attr("disabled",!0)):Layout.Page.container.find("#submitSchedule").off("click").on("click",function(){showChooseEdit?Timetracker.timejobscheduler.validateAddUpdateJobScheduleDetails(empno,editJson)&&chooseRepeatType({dateid:dateid,empno:empno,tschObj:editJson,isPubed:!1,action:"edit"}):Timetracker.timejobscheduler.addUpdateJobScheduleDetails(empno,editJson,!0,!1)}),isClientFieldAllowed&&Timetracker.clients.getClients("jbsch_clientid",null,null,!1,empno),Timetracker.projects.Filters.updateProjectListForFilters(!0,empno,null,"jobsch",null,null);if(Timetracker.timelogs.setValuesInSelectInput(editJson,"jobsch",null,null,{allowAll:!0,isNewKey:!0}),void 0!==editJson.color){var finalcls="ZPLtyp MT12 ZPschbx LC"+editJson.color;Layout.Page.container.find("#schColorBox").attr("class",finalcls)}isClientFieldAllowed&&Layout.Page.container.find("#jbsch_clientid").off("change").on("change",function(){var erecno=Layout.Page.container.find("#jobsch_form").attr("erecno");Timetracker.projects.Filters.updateProjectListForFilters(!0,erecno,this.value,"jobsch",null,"0")}),Layout.Page.container.find("#jbsch_projectid").off("change").on("change",function(){var erecno=Layout.Page.container.find("#jobsch_form").attr("erecno"),cltid=isClientFieldAllowed?Layout.Page.container.find("#jbsch_clientid").val():"";Timetracker.jobs.Filters.getJobs(erecno,"-1","jobsch",this.value,cltid)}),Layout.Page.container.find("#jbsch_jobid").off("change").on("change",function(){Timetracker.timelogs.jobChange("jobsch"),setJobColor($(this).val())}),Layout.Page.container.find("#jobsch_form").attr("erecno",empno);var schdDate=editJson.date;schdDate=schdDate.split(" ")[0];var schdDateObj=Calendar.parseDate(schdDate,Calendar.DB_DATEFORMAT),schDay=Calendar.formatDate(schdDateObj);Layout.Page.container.find("#schdDate").val(schDay),Layout.Page.container.find("#timesch_fromtime").val(Timetracker.timelogs.minstoTimeMeridianAP(editJson.fromTime)),Layout.Page.container.find("#timesch_totime").val(Timetracker.timelogs.minstoTimeMeridianAP(editJson.toTime));var isAmPm="HH:mm"!==timeFormat;Layout.Page.container.find("#timesch_fromtime").timepicker({defaultTime:Layout.Page.container.find("#timesch_fromtime").val(),showMeridian:isAmPm,minuteStep:1}),Layout.Page.container.find("#timesch_totime").timepicker({defaultTime:Layout.Page.container.find("#timesch_totime").val(),showMeridian:isAmPm,minuteStep:1}),!0===editJson.isPubed||"true"===editJson.isPubed?Layout.Page.container.find("#publishSchedule").prop("disabled",!0):!0===editJson.isPubed&&"true"===editJson.isPubed||Layout.Page.container.find("#submitSchedule").prop("disabled",!0),Layout.Page.container.find("#sch_desc").val(editJson.desc),Timetracker.generalSettings.isBudgetEnabled()&&editJson.isException&&editJson.comment&&Layout.Page.container.find("#sch_comment").val(editJson.comment),Layout.Page.container.find("#sch_billableStatus").val(editJson.billableStatus).select2(),"-1"!=editJson.jobBillableStatus&&editJson.billableStatus===Number(editJson.jobBillableStatus)&&Layout.Page.container.find("#sch_billableStatus").prop("disabled",!0),void 0!==editJson.workitem&&(Layout.Page.container.find("#sch_workitem").val(editJson.workitem),Layout.Page.container.find("#sch_workitem").attr("orgTaskName",ZPeople.decodeTxt(editJson.workitem)));var workItemJson=Timetracker.timelogs.checkIfDropDownNeededForWorkitem({jobId:editJson.jobId});if("false"===workItemJson.input){var extraJson={elementId:"sch_workitem"};extraJson.layout=Layout.Page.container.find("#sch_workitem"),void 0!==editJson.workitem&&(extraJson.toAppendOption=ZPeople.decodeTxt(editJson.workitem)),extraJson.handleUiClasses=!0,Timetracker.timelogs.convertResultAndApplyDropdownOfWorkitem(workItemJson.data,extraJson)}if(editJson.repeatId){Layout.Page.container.find("#jbschrepeat").attr("checked",!0),Layout.Page.container.find("#jbschrepeat").attr("disabled",!0);editJson.repeatId;var repeatType=editJson.repeatType,repeatInt=editJson.repeatInt,repeatUntil=editJson.repeatUntil,repeatRule=editJson.repeatRule;repeatUntil=repeatUntil.split(" ")[0];var repeatDateObj=Calendar.parseDate(repeatUntil,Calendar.DB_DATEFORMAT),repdae=Calendar.formatDate(repeatDateObj);Layout.Page.container.find("#repeatid").val(repeatType).trigger("change");var reptxt=ZPI18N.getString("zp.days");if("0"===repeatType)Layout.Page.container.find("#daily_int").val(repeatInt).trigger("change");else if("1"===repeatType){if(repeatRule){var splitRR=repeatRule.split(",");if(splitRR&&splitRR.length)for(var i=0;i<splitRR.length;i++){var day=splitRR[i];"0"===day?Layout.Page.container.find("#daysel_sun").prop("checked",!0):"1"===day?Layout.Page.container.find("#daysel_mon").prop("checked",!0):"2"===day?Layout.Page.container.find("#daysel_tue").prop("checked",!0):"3"===day?Layout.Page.container.find("#daysel_wed").prop("checked",!0):"4"===day?Layout.Page.container.find("#daysel_thu").prop("checked",!0):"5"===day?Layout.Page.container.find("#daysel_fri").prop("checked",!0):"6"===day&&Layout.Page.container.find("#daysel_sat").prop("checked",!0)}}Layout.Page.container.find("#week_int").val(repeatInt).trigger("change"),reptxt=ZPI18N.getString("zp.wftbaweeks")}else"2"===repeatType&&(Layout.Page.container.find("#month_int").val(repeatInt).trigger("change"),reptxt=ZPI18N.getString("zp.months"));var infoArr=[];infoArr.push(repeatInt),infoArr.push(reptxt),infoArr.push(repdae);ZPI18N.getString("zp.repeatinfo",infoArr);var info="Every "+repeatInt+"  "+reptxt+" until "+repdae;Layout.Page.container.find("#repeatinfo").html(info).show(),Layout.Page.container.find("#popRepDate").val(repdae)}else{var currDate=Calendar.parseDate(Timetracker.timejobscheduler.currPopupDate,"%y-%m-%d");repdae=Calendar.formatDate(currDate);Layout.Page.container.find("#popRepDate").val(repdae)}editJson.extendAllowed?Layout.Page.container.find("#jbschExtend").prop("checked",!0):Layout.Page.container.find("#jbschExtend").prop("checked",!1);var validTime={fromt:Layout.Page.container.find("#timesch_fromtime").val(),tot:Layout.Page.container.find("#timesch_totime").val()};if(hasCustomFields()){var customFields=getCustomFields(),allowedFileds=Timetracker.jobScheduleForm.fetchAllAllowedFields(Timetracker.timejobscheduler.currPopupUser,Timetracker.constants.EDIT,customFields);if(!allowedFileds||0==allowedFileds.length)return;var customFieldDetails=editJson.customFieldDetails;for(var iterator in customFields){var field=customFields[iterator];if(allowedFileds.includes(field.labelName)){var elementDiv=Layout.Page.container.find('.customField[folabel="'+field.labelName+'"]');25===field.componentType?(void 0!==customFieldDetails&&void 0!==customFieldDetails[field.labelName]&&""!==customFieldDetails[field.labelName]?elementDiv.find("select").val(customFieldDetails[field.labelName]).select2():elementDiv.find("select").select2(),elementDiv.find("select").on("change",function(){disableEdit||validationForButtons(editJson,validTime,schDay,repdae)})):19===field.componentType&&(void 0!==customFieldDetails&&void 0!==customFieldDetails[field.labelName]&&elementDiv.find("input").val(customFieldDetails[field.labelName]),elementDiv.find("input").on("input",function(){disableEdit||validationForButtons(editJson,validTime,schDay,repdae)}))}}}ZPeople.BSModal.show(tempObj),Layout.Page.container.find("#popRepDate,#schdDate,#jbsch_projectid,#jbsch_clientid,#jbsch_jobid,#repeatid,#daily_int,#week_int,#month_int,#jbschrepeat,#sch_billableStatus").on("change",function(){disableEdit||validationForButtons(editJson,validTime,schDay,repdae)}),Layout.Page.container.find("#timesch_fromtime,#timesch_totime,#sch_workitem").on("input change",function(){disableEdit||validationForButtons(editJson,validTime,schDay,repdae)}),Layout.Page.container.find("#sch_desc,#jbschExtend").on("input",function(){disableEdit||validationForButtons(editJson,validTime,schDay,repdae)})}}function validationForButtons(editJson,validTime,schDay,repdae){var opbuttonid=!0===editJson.isPubed||"true"===editJson.isPubed?"#publishSchedule":"#submitSchedule",projectName=ZPeople.decodeTxt(editJson.projectName?editJson.projectName:"Select"),clientName=ZPeople.decodeTxt(editJson.clientName?editJson.clientName:"Select"),isAnythingChanged=ZPeople.decodeTxt(encodeURIComponent(editJson.desc))!=encodeURIComponent($("#sch_desc").val())||Layout.Page.container.find("#schdDate").val()!=schDay||validTime.fromt!=$("#timesch_fromtime").val()||validTime.tot!=$("#timesch_totime").val()||Layout.Page.container.find("#s2id_jbsch_projectid").select2("data").text!=projectName||Layout.Page.container.find("#s2id_jbsch_jobid").select2("data").text!=ZPeople.decodeTxt(editJson.jobName)||Layout.Page.container.find("#s2id_jbsch_clientid").select2("data").text!=clientName||editJson.desc!=$("#sch_desc").val()||editJson.billableStatus!=$("#sch_billableStatus").val()||editJson.workitem!=$("#sch_workitem").val()||1==Layout.Page.container.find("#jbschrepeat").is(":checked")&&void 0==editJson.repeatType||(Layout.Page.container.find("#s2id_repeatid").select2("data").id!=editJson.repeatType||Layout.Page.container.find("#popRepDate").val()!=repdae||"0"==Layout.Page.container.find("#s2id_repeatid").select2("data").id&&Layout.Page.container.find("#s2id_daily_int").select2("data").id!=editJson.repeatInt||"1"==Layout.Page.container.find("#s2id_repeatid").select2("data").id&&Layout.Page.container.find("#s2id_week_int").select2("data").id!=editJson.repeatInt||"2"==Layout.Page.container.find("#s2id_repeatid").select2("data").id&&Layout.Page.container.find("#s2id_month_int").select2("data").id!=editJson.repeatInt)&&void 0!=editJson.repeatType;if(!(isAnythingChanged=isAnythingChanged||0!=Layout.Page.container.find("#jbschExtend").length&&editJson.extendAllowed!=Layout.Page.container.find("#jbschExtend").is(":checked"))&&hasCustomFields()){var customFields=getCustomFields(),allowedFileds=Timetracker.jobScheduleForm.fetchAllAllowedFields(Timetracker.timejobscheduler.currPopupUser,Timetracker.constants.EDIT,customFields);if(!allowedFileds||0==allowedFileds.length)return;for(var iterator in customFields){var field=customFields[iterator];if(allowedFileds.includes(field.labelName)){var elementDiv=Layout.Page.container.find('.customField[folabel="'+field.labelName+'"]');if(25===field.componentType){if((void 0!==editJson.customFieldDetails&&void 0!==editJson.customFieldDetails[field.labelName]?editJson.customFieldDetails[field.labelName]:"0")!=elementDiv.find("select").val()){isAnythingChanged=!0;break}}else if(19===field.componentType){if((void 0!==editJson.customFieldDetails&&void 0!==editJson.customFieldDetails[field.labelName]?ZPeople.decodeTxt(encodeURIComponent(editJson.customFieldDetails[field.labelName])):"")!=elementDiv.find("input").val()){isAnythingChanged=!0;break}}}}}isAnythingChanged?Layout.Page.container.find(opbuttonid).prop("disabled",!1):Layout.Page.container.find(opbuttonid).prop("disabled",!0)}function setJobColor(jobId){var jobColor="1",jobArray=Timetracker.jobs.jobData;if(jobArray&&jobId&&"0"!==jobId){var jobIndex=Timetracker.projects.Operations.findJSONArrayIndex(jobArray,jobId,"jobId");jobIndex&&"-1"!==jobIndex&&(jobColor=jobArray[jobIndex].jobColor?jobArray[jobIndex].jobColor:jobColor)}var classList="ZPLtyp MT12 ZPschbx LC"+(jobColor="0"===jobColor?"1":jobColor);Layout.Page.container.find("#schColorBox").attr("class",classList)}function scheduleWeekDom(data,empId){var fromTime=Timetracker.timelogs.minstoTimeMeridianAP(data.fromTime),toTime=Timetracker.timelogs.minstoTimeMeridianAP(data.toTime),jobname=data.jobName,projectname=data.projectName;if(!jobname){var userJobArr=Timetracker.jobs.userJobs[empId];if(userJobArr&&data.jobId&&"0"!==data.jobId){var tempIndex=Timetracker.projects.Operations.findJSONArrayIndex(userJobArr,data.jobId,"jobId");tempIndex&&"-1"!==tempIndex&&(jobname=userJobArr[tempIndex].jobName?userJobArr[tempIndex].jobName:"")}}var tjob=fromTime+"-"+toTime,unpubcls=data&&!data.isPubed?"zp_inprog":"",repdom="";data.repeatId&&(repdom='<i title="Repeat Schedule" class="IC-repeat S12"></i>');var jcolor="0"===data.color?"1":data.color,dom=$('<div id="'+data.tschId+'" class="zjs-info zpshiftTms LC'+jcolor+" "+unpubcls+'" ><span data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPeople.escapeHtml(jobname)+'">'+jobname+'</span><p style="margin-top:5px;margin-bottom:5px" data-placement="bottom" data-toggle="tooltip" data-original-title="'+tjob+'">'+tjob+"</p>"+repdom+(Timetracker.generalSettings.isBudgetEnabled()&&data.isException?'<i class="CR-f-red"><i class="path1"></i><i class="path2"></i></i>':"")+"</div>");return void 0!==projectname&&""!==projectname.trim()&&(dom=$('<div id="'+data.tschId+'" class="zjs-info zpj-splt zpshiftTms LC'+jcolor+" "+unpubcls+'" ><span data-placement="bottom" data-toggle="tooltip" data-html="true" data-original-title="'+ZPeople.escapeHtml(jobname)+"<span>.</span>"+ZPeople.escapeHtml(projectname)+'">'+jobname+'</span><p style="margin-top:5px;margin-bottom:5px" data-placement="bottom" data-toggle="tooltip" data-original-title="'+tjob+'">'+tjob+"</p>"+repdom+(Timetracker.generalSettings.isBudgetEnabled()&&data.isException?'<i class="CR-f-red"><i class="path1"></i><i class="path2"></i></i>':"")+"</div>")),dom.data(data),dom.draggable({snap:".js-schedule",start:function(event,ui){$(".tooltip").remove(),$(this).addClass("noclick")},drag:function(event,ui){$(".tooltip").remove()},stop:function(event,ui){$(".tooltip").remove()},snapMode:"inner",zIndex:1e6,appendTo:".js-schedule",revert:!0}),dom.off("click").on("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).hasClass("noclick")?$(this).removeClass("noclick"):Timetracker.timejobscheduler.chooseEditSchedule(data,e,this)}),dom}function resetEmployeeFetch(){Timetracker.timejobscheduler.emp_cache.index=1,isEmpFetchAvail=!0,firescroll_Triggered=!1}function constructJobSchedule(prenxt){resetEmployeeFetch(),setNavigationDateObject(prenxt),"1"===calview?(setWeekLogHeader(),getJobScheduleForWeekview()):"0"===calview&&(setDayLogHeader(),getJobScheduleForDayview())}function getJobScheduleForDayview(){var jsonObj={},startDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.day,!0),endDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.day,!0),users=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_assignedto").val())?Layout.Page.container.find("#jobsch_assignedto").val():"0",pubStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_pub").val(),0),deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_department").val());deptId="0"!=deptId?deptId.toString():deptId;var locationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_location").val());locationId="0"!=location?locationId.toString():locationId;var designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_designation").val());if(designationId="0"!=designationId?designationId.toString():designationId,isOrgStructureEnabled){var legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_LegalEntityName").val());legalEntityId="0"!=legalEntityId?legalEntityId.toString():legalEntityId;var businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_BusinessUnitName").val());businessUnitId="0"!=businessUnitId?businessUnitId.toString():businessUnitId;var divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_DivisionName").val());divisionId="0"!=divisionId?divisionId.toString():divisionId}var jobId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_jobName").val())?Layout.Page.container.find("#jobsch_jobName").val():"0",clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_ClientName").val())?Layout.Page.container.find("#jobsch_ClientName").val():"0",projectId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_projectName").val())?Layout.Page.container.find("#jobsch_projectName").val():"0";1===Timetracker.timejobscheduler.emp_cache.index&&(pub_cache.count=0,Layout.Page.container.find(".Scrcont").scrollTop(0).trigger("scroll"),Layout.Page.container.find("#day_view_jobsch").hide(),Timetracker.util.appendLoading()),jsonObj.p={fromDate:startDate,toDate:endDate,users:users,sIndex:Timetracker.timejobscheduler.emp_cache.index,limit:25,pubStatus:pubStatus,deptId:deptId,designationId:designationId,locationId:locationId,jobId:jobId,projectId:projectId},Timetracker.jobScheduleForm.isClientFilterAllowed()&&(jsonObj.p.clientId=clientId),isOrgStructureEnabled&&(jsonObj.p.divisionId=divisionId,jsonObj.p.businessUnitId=businessUnitId,jsonObj.p.legalEntityId=legalEntityId),"0"===users&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?jsonObj.p.isDirectSubOnlyNeeded=Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").is(":checked"):jsonObj.p.isDirectSubOnlyNeeded=!1,jsonObj.ep=jsonObj.p,Layout.Page.container.find(".Scrcont").removeClass("section Drow"),jsonObj.fn=Timetracker.timejobscheduler.constJobScheduleForDayview,reqObj.getJobSchedule(jsonObj)}function getJobScheduleForWeekview(){var jsonObj={},startDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.from,!0),endDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.to,!0),users=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_assignedto").val()),pubStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_pub").val());if(isOrgStructureEnabled){var legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_LegalEntityName").val());legalEntityId="0"!=legalEntityId?legalEntityId.toString():legalEntityId;var businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_BusinessUnitName").val());businessUnitId="0"!=businessUnitId?businessUnitId.toString():businessUnitId;var divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_DivisionName").val());divisionId="0"!=divisionId?divisionId.toString():divisionId}var deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_department").val());deptId="0"!=deptId?deptId.toString():deptId;var locationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_location").val());locationId="0"!=locationId?locationId.toString():locationId;var designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_designation").val());designationId="0"!=designationId?designationId.toString():designationId;var jobId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_jobName").val())?Layout.Page.container.find("#jobsch_jobName").val():"0",clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_ClientName").val())?Layout.Page.container.find("#jobsch_ClientName").val():"0",projectId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_projectName").val())?Layout.Page.container.find("#jobsch_projectName").val():"0";if(1===Timetracker.timejobscheduler.emp_cache.index&&(pub_cache.count=0,Layout.Page.container.find("#week_view_jobsch").scrollTop(0).trigger("scroll"),Timetracker.util.appendLoading(),Layout.Page.container.find("#week_view_jobsch").hide()),jsonObj.p={fromDate:startDate,toDate:endDate,users:users,sIndex:Timetracker.timejobscheduler.emp_cache.index,limit:25,pubStatus:pubStatus,deptId:deptId,designationId:designationId,locationId:locationId,jobId:jobId,projectId:projectId},Timetracker.jobScheduleForm.isClientFilterAllowed()&&(jsonObj.p.clientId=clientId),isOrgStructureEnabled&&(jsonObj.p.divisionId=divisionId,jsonObj.p.businessUnitId=businessUnitId,jsonObj.p.legalEntityId=legalEntityId),"0"===users&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?jsonObj.p.isDirectSubOnlyNeeded=Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").is(":checked"):jsonObj.p.isDirectSubOnlyNeeded=!1,hasCustomFields()){var customFieldFilters=Layout.Page.container.find(".customFieldFilter");if(customFieldFilters&&0!=customFieldFilters.length){var customFieldDetails={};customFieldFilters.find("select").each(function(){var values=$(this).val();if(values&&values.length>0){var fieldName=$(this).attr("id"),valueList="";for(var itr in values)valueList+=values[itr],itr<values.length-1&&(valueList+=",");customFieldDetails[fieldName]=valueList}}),0!==Object.keys(customFieldDetails).length&&(jsonObj.p.customFieldDetails=JSON.stringify(customFieldDetails))}}jsonObj.ep=jsonObj.p,Layout.Page.container.find(".Scrcont").removeClass("section Drow"),jsonObj.fn=Timetracker.timejobscheduler.constJobScheduleForWeekview,reqObj.getJobSchedule(jsonObj)}var PROGRESS_BAR_WIDTH=0;function resetFilterElements(){Timetracker.util.resetSelectInFilters("jobSchdReportfilter",Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#jschdrperiod,#jschdrEmpType").select2({minimumResultsForSearch:1/0}),Timetracker.util.isFilterOpen()&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_jobschd_report_filter"),"jobSchdReportfilter"),Calendar.getCurrentDay(),Calendar.getCurrentWeek(),Calendar.getCurrentMonth()}function getActiveView(){return Layout.Page.container.find(".ZP-SwitchViewDiv").find(".ZP-SwitchView.active").attr("value")}function renderViewBasedReport(isLoad){resetFireScrollBasedOnView();var params=getParamsBasedOnView(isLoad),callback=getCallbackBasedOnView();params&&ZPeople.isZPNewUI()&&Timetracker.util.isFilterOpen()&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_jobschd_report_filter"),"jobSchdReportfilter"),generateJobScheduleReport(params,callback)}function resetFireScrollBasedOnView(){var val=getActiveView();Timetracker.FireScroll.resetDataOnLoad(val)}function getParamsBasedOnView(isLoad){var params,val=getActiveView();return val===Timetracker.constants.JOB_SCHD_REPORT.SUMMARY?params=getParamsForSummaryReport(isLoad):val===Timetracker.constants.JOB_SCHD_REPORT.DETAILED&&(params=getParamsForDetailedReport(isLoad)),params}function getCallbackBasedOnView(){var callback,val=getActiveView();return val===Timetracker.constants.JOB_SCHD_REPORT.SUMMARY?callback=Timetracker.timejobscheduler.constructJobScheduleReport:val===Timetracker.constants.JOB_SCHD_REPORT.DETAILED&&(callback=Timetracker.timejobscheduler.constructJobSchedDetailedReport),callback}function getParamsForSummaryReport(isLoad){var params=getParamsForJobSchdReport(isLoad,1);if(params)return params.reportType=1,"0"===params.users&&(params.sIndex=Timetracker.FireScroll.getFetchCount(Timetracker.constants.JOB_SCHD_REPORT.SUMMARY),params.limit=Timetracker.FireScroll.getMaxFetchCount(Timetracker.constants.JOB_SCHD_REPORT.SUMMARY)),params}function getParamsForDetailedReport(isLoad){var params=getParamsForJobSchdReport(isLoad,2);if(params)return params.reportType=2,"0"===params.users&&(params.sIndex=Timetracker.FireScroll.getFetchCount(Timetracker.constants.JOB_SCHD_REPORT.DETAILED),params.limit=Timetracker.FireScroll.getMaxFetchCount(Timetracker.constants.JOB_SCHD_REPORT.DETAILED)),params}function getParamsForJobSchdReport(isLoad,type){var fromDate,toDate,params=Timetracker.Filters.getAndValidateParams("JOBSCHEDULEREPORT"),periodType=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jschdrperiod").val(),Timetracker.generalSettings.getDefaultViewType(Timetracker.timelogs.tserecno));if(Layout.Page.container.find("#jschdWeekReportChanger,#jschdMonthReportChanger,#jschdDayReportChanger").hide(),"6"===periodType){var dateLayout=ZPeople.isZPNewUI()?Layout.Page.container.find("#jschdrnew_customreportfromtodate"):Layout.Page.container.find("#jschdrcustomreportfromtodate");fromDate=dateLayout.find("#jschdrfromdate").val(),toDate=dateLayout.find("#jschdrtodate").val();var compcheck=!0;if(compcheck=Timetracker.util.validateFunction("jschdrfromdate","",ZPI18N.getString("zp.emptyfromdate"),"div",compcheck,dateLayout),compcheck=Timetracker.util.validateFunction("jschdrtodate","",ZPI18N.getString("zp.emptytodate"),"div",compcheck,dateLayout),Calendar.isvalidDate(fromDate)||(compcheck=Timetracker.util.validateFunction("jschdrfromdate",null,ZPI18N.getString("zp.invaliddate"),"div",compcheck,dateLayout)),Calendar.isvalidDate(toDate)||(compcheck=Timetracker.util.validateFunction("jschdrtodate",null,ZPI18N.getString("zp.invaliddate"),"div",compcheck,dateLayout)),compcheck){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);if(fdate>tdate)compcheck=Timetracker.util.validateFunction("jschdrfromdate",null,ZPI18N.getString("zp.greaterfromdate"),"div",compcheck,dateLayout);else{var dateDiff=Timetracker.DateTime.getDateDiff(fdate,tdate),diff=1==type?"31":"7";dateDiff>diff&&(compcheck=Timetracker.util.validateFunction("jschdrfromdate",null,ZPI18N.getString("zp.datewithindays",[diff]),"div",compcheck,dateLayout))}}if(!compcheck){if(!1===isLoad)return;"2"==(periodType=Timetracker.generalSettings.getDefaultViewType())&&"detailed"==Layout.Page.container.find(".ZP-SwitchViewDiv").find(".active").attr("value")&&(periodType="1"),Layout.Page.container.find("#jschdrperiod").val(periodType).select2(),Layout.Page.container.find("#jschdrnew_customreportfromtodate").hide(),Layout.Page.container.find(".ERR").remove()}}return isLoad||Timetracker.util.setViewType(periodType,"jschdr"),"0"===periodType||"3"===periodType?(fromDate=Calendar.formatDate(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.day),toDate=Calendar.formatDate(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.day),Layout.Page.container.find("#jschdDayReportChanger").find("#calmonth1").html(Timetracker.timelogs.getDateinTSformat(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.day)),Layout.Page.container.find("#jschdDayReportChanger").show()):"1"===periodType||"4"===periodType?(fromDate=Calendar.formatDate(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.from),toDate=Calendar.formatDate(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.to),Layout.Page.container.find("#jschdWeekReportChanger").find("#calmonth3").html(Timetracker.timelogs.getDateinTSformat(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.from)+" - "+Timetracker.timelogs.getDateinTSformat(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.to)),Layout.Page.container.find("#jschdWeekReportChanger").show()):"2"!==periodType&&"5"!==periodType||(fromDate=Calendar.formatDate(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.from),toDate=Calendar.formatDate(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.to),Layout.Page.container.find("#jschdMonthReportChanger").find("#calmonth5").html(Timetracker.timelogs.getDateinTSformat(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.from)+" - "+Timetracker.timelogs.getDateinTSformat(Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate.to)),Layout.Page.container.find("#jschdMonthReportChanger").show()),fromDate&&toDate&&(params.fromDate=Timetracker.timelogs.getDateinDBformat(Calendar.parseDate(fromDate,uidateFormat),!0),params.toDate=Timetracker.timelogs.getDateinDBformat(Calendar.parseDate(toDate,uidateFormat),!0)),params}function generateJobScheduleReport(params,callback){if(void 0===params&&void 0===callback){var val=getActiveView();val===Timetracker.constants.JOB_SCHD_REPORT.SUMMARY?(params=getParamsForSummaryReport(),callback=Timetracker.timejobscheduler.constructJobScheduleReport):val===Timetracker.constants.JOB_SCHD_REPORT.DETAILED&&(params=getParamsForDetailedReport(),callback=Timetracker.timejobscheduler.constructJobSchedDetailedReport)}params&&(Layout.Page.container.find("#zp_empty_data,#jobschdreporttable,#jobschdreporttable_div").hide(),Timetracker.util.appendLoading(),ZPeople.Request.send(Timetracker.constants.URL,params,callback),Timetracker.timejobscheduler.isschvsworkedhoursdatafetched=!0)}function constructJobScheduleReportHtml(empDtls,jobDtls){var jobSchdHtml="";return $.each(empDtls,function(erecno,empDtl){var empName=empDtl.empName,empId=empDtl.empId;if(empId){empName=empName||"";var jobDtl=jobDtls[erecno],rowspan=0;0!==Object.keys(jobDtl).length&&(jobSchdHtml+='<tr class="ZPLRow"><td rowspan="$ROWSPAN$"><img class="FL" src="'+empDtl.empPhoto+'"><div class="ZPusrName"><span class="ellipsis W150" data-toggle="tooltip" data-placement="bottom" data-container="body" title="" data-original-title="'+empName+'"><b>'+empId+"</b> "+empName+"</span></div></td>"),$.each(jobDtl,function(jobId,schdtls){0!==rowspan&&(jobSchdHtml+='<tr class="ZPLRow">');var jobName=schdtls.jobName||"",schdHrs=void 0!==schdtls.schdHrs?schdtls.schdHrs:"-",workedHrs=void 0!==schdtls.workedHrs?schdtls.workedHrs:"-",actualHrs=void 0!==schdtls.actualHrs?schdtls.actualHrs:"-",overtime=void 0!==schdtls.overtime?schdtls.overtime:"-",deviation=void 0!==schdtls.deviation?schdtls.deviation:"-";jobSchdHtml+="<td "+(0!==rowspan?'class="PL8I"':'""')+'><label data-toggle="tooltip" data-placement="bottom" data-container="body" title="" data-original-title="'+jobName+'">'+jobName+"</label></td><td>"+(ZPUtil.Validation.isNumber(schdHrs)?Calendar.minstohrs(schdHrs):"-")+"</td><td>"+(ZPUtil.Validation.isNumber(actualHrs)?Calendar.minstohrs(actualHrs):"-")+'</td><td class="'+(deviation>=0?"grn":"red")+'">'+(ZPUtil.Validation.isNumber(deviation)?deviation>=0?Calendar.minstohrs(deviation):"-"+Calendar.minstohrs(Math.abs(deviation)):"-")+"</td><td>"+(ZPUtil.Validation.isNumber(workedHrs)?Calendar.minstohrs(workedHrs):"-")+'</td><td class="'+(overtime>=0?"grn":"red")+'">'+(ZPUtil.Validation.isNumber(overtime)?overtime>=0?Calendar.minstohrs(overtime):"-"+Calendar.minstohrs(Math.abs(overtime)):"-")+"</td></tr>",rowspan++}),jobSchdHtml=jobSchdHtml.replace("$ROWSPAN$",rowspan)}}),jobSchdHtml}function getViewBasedOnReportType(reportype){return 2===reportype?Timetracker.constants.JOB_SCHD_REPORT.DETAILED:Timetracker.constants.JOB_SCHD_REPORT.SUMMARY}function constructJobSchedDetailedReportHtml(empDtls,workDateDtls,dateArr){var jobSchdHtml="";return $.each(empDtls,function(erecno,empDtl){var empName=empDtl.empName,empId=empDtl.empId;if(empId){empName=empName||"";var workDateObj=workDateDtls[erecno];0!==Object.keys(workDateObj).length&&(jobSchdHtml+='<tr class="ZPLNRow"><td class="fxdtd" style="max-width:300px;width:300px;$BORDER_BOTTOM$"><img class="FL" src="'+empDtl.empPhoto+'"><div class="ZPusrName"><span class="ellipsis W120" data-toggle="tooltip" data-placement="bottom" data-container="body" title="" data-original-title="'+empName+'"><b>'+empId+"</b> "+empName+"</span></div></td>");for(var rowspan=0,isRepeat=!0;isRepeat;){isRepeat=!1,0!==rowspan&&(jobSchdHtml+='<tr class="ZPLNRow"><td class="fxdtd" style="max-width:300px;width:300px;$BORDER_BOTTOM$"></td>');for(var i=0;i<dateArr.length;i++){var jobArr=workDateObj[dateArr[i]],splicedArr=null;if(jobArr&&0!==jobArr.length&&(splicedArr=jobArr.splice(0,1)),isRepeat=isRepeat||jobArr&&0!==jobArr.length,null!=splicedArr&&0!==splicedArr.length){var schdtls=splicedArr[0],jobName=schdtls.jobName||"",schdHrs=void 0!==schdtls.schdHrs?schdtls.schdHrs:"-",actualHrs=void 0!==schdtls.actualHrs?schdtls.actualHrs:"-",deviation=void 0!==schdtls.deviation?schdtls.deviation:"-",fromToTime="",fromTime=schdtls.fromTime,toTime=schdtls.toTime;fromTime&&toTime&&(fromToTime="("+Calendar.minstotime(fromTime)+" - "+Calendar.minstotime(toTime)+")"),jobSchdHtml+='<td class="P0I TBrdr"><table class="table i_table"><tbody><td width=25%><div class="W150"><span class="ellipsis W150" data-toggle="tooltip" data-placement="bottom" data-container="body" title="" data-original-title="'+jobName+'">'+jobName+'</span><label class="dgry S13">'+fromToTime+'</label></div></td><td class="text-center" width=25%><div class="W120">'+(ZPUtil.Validation.isNumber(schdHrs)?Calendar.minstohrs(schdHrs):"-")+'</div></td><td class="text-center" width=25%><div class="W120">'+(ZPUtil.Validation.isNumber(actualHrs)?Calendar.minstohrs(actualHrs):"-")+'</div></td><td class="text-center" width=25%><div class="W120 '+(deviation>=0?"grn":"red")+'">'+(ZPUtil.Validation.isNumber(deviation)?deviation>=0?Calendar.minstohrs(deviation):"-"+Calendar.minstohrs(Math.abs(deviation)):"-")+"</div></td></tbody></table></td>"}else jobSchdHtml+='<td class="P0I TBrdr"><table class="table i_table"><tbody><td class="text-center" width=100%><div class="W60 Mauto" style="min-width:561px;">-</div></td></tbody></table></td>'}jobSchdHtml=(jobSchdHtml+="</tr>").replace(/\$BORDER_BOTTOM\$/g,isRepeat?"border-bottom:0px":""),rowspan++}}}),jobSchdHtml}return{isJobScheduleEnabled:isJobScheduleEnabled,hasCustomFields:hasCustomFields,getCustomFields:getCustomFields,hasFieldPermissions:hasFieldPermissions,getFieldPermissions:function(){return hasFieldPermissions()?ZPeople.Module.MODULE_DATA.timetracker.jobSchFieldPermissions:void 0},setPositionForHeader:function(){var layout=Layout.Page.container.find("#day_view_jobsch:visible");if(layout.length){var bodyleft=layout.find("ul#dayview_body>li.zpuser-row:first").offset().left,ulDom=layout.find("ul.zpheader-list");ulDom.find("li.zpuser-row>div.FXD_HDR").css("left",-($(ulDom).offset().left-bodyleft)+"px")}},constructJobSchedule:constructJobSchedule,addJobScheduleConstruct:async function(ev,th){var dateid,erecno=$(th).attr("id").split("_")[0];if("1"===calview)dateid=$(th).attr("dateid");else if("0"===calview){var date=Timetracker.timejobscheduler.navigateDate.day;dateid=date.getFullYear().toString()+"-"+("0"+(date.getMonth()+1).toString()).substr(-2)+"-"+("0"+date.getDate().toString()).substr(-2)}if(Timetracker.timejobscheduler.currPopupDate=dateid,Timetracker.timejobscheduler.currPopupUser=erecno,Timetracker.isDataAdminForUser(erecno)||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit)&&Timetracker.isTTCustomAdminForUser(Timetracker.constants.TTCustomAdmin.EntryEdit,erecno));else{(currDate=Calendar.getCurrentDate()).setHours(0,0,0,0);var addDate=Calendar.parseDate(dateid,Calendar.DB_DATEFORMAT);if(addDate.setHours(0,0,0,0),!(currDate<=addDate))return}if(isAddEditAllowed(erecno)){Timetracker.timejobscheduler.currPopupMode="add";var tempObj=$(templates.addEditJobSchPop()),modalElm=tempObj.find("#jobsch_mdialog");Layout.Page.container.find("#jobsch_modelmask").remove(),Layout.Page.container.append(tempObj);var isClientFieldAllowed=Timetracker.jobScheduleForm.isClientFieldAllowed(Timetracker.timejobscheduler.currPopupUser,Timetracker.constants.EDIT);modalElm.find("#jobsch_form").append(schedulePopupComponents({isClientFieldAllowed:isClientFieldAllowed})),modalElm.find("#jobsch_footer").append(schedulePopupFooter());var isAmPm=!1;if("hh:mm a"==timeFormat&&(isAmPm=!0),"0"===calview){var clickedHour=$(th).attr("id").split("_")[1],startMins=60*Number(clickedHour),endMins=60*(Number(clickedHour)+1),fromTime=Timetracker.timelogs.minstoTimeMeridianAP(startMins),toTime=Timetracker.timelogs.minstoTimeMeridianAP(endMins);Layout.Page.container.find("#timesch_fromtime").val(fromTime),Layout.Page.container.find("#timesch_totime").val(toTime)}else if(hasCustomFields()){Layout.Page.container.find("#jobsch_form").hide(),Timetracker.util.appendLoading(void 0,{containerId:"jobsch_mdialog",containerClass:"modal-body",type:"popup"});let user=Timetracker.timejobscheduler.currPopupUser,date=Timetracker.timejobscheduler.currPopupDate;var params={mode:"getJobSchUserShiftData",conreqcsr:csrfToken};params.user=user,params.date=date;let userShiftData=usersShiftData[user]||{};if(!userShiftData.hasOwnProperty(date)){let userShiftDataRes=await Timetracker.Request.sendAsPromiseWithTimeOut(Timetracker.constants.URL,params,{errorMsg:"TimeOut"},3e3,Timetracker.timejobscheduler.setJobSchUserShiftCache);userShiftDataRes.hasOwnProperty("errorCode")||userShiftDataRes.hasOwnProperty("errorMsg")||(userShiftData=usersShiftData[user])}let shiftTime=userShiftData?userShiftData[date]:[];if(shiftTime&&shiftTime.fromTime&&shiftTime.toTime){let fromTime=Timetracker.timelogs.minstoTimeMeridianAP(shiftTime.fromTime),toTime=Timetracker.timelogs.minstoTimeMeridianAP(shiftTime.toTime);Layout.Page.container.find("#timesch_fromtime").val(fromTime),Layout.Page.container.find("#timesch_totime").val(toTime)}Layout.Page.container.find("#jobsch_form").show(),Timetracker.util.removeLoading()}var fT=new Date,tT=new Date;tT.setHours(tT.getHours()+1);var bootfromtime=Layout.Page.container.find("#timesch_fromtime").val()||fT,boottotime=Layout.Page.container.find("#timesch_totime").val()||tT;Layout.Page.container.find("#timesch_fromtime").timepicker({defaultTime:bootfromtime,showMeridian:isAmPm,minuteStep:1}),Layout.Page.container.find("#timesch_totime").timepicker({defaultTime:boottotime,showMeridian:isAmPm,minuteStep:1}),Timetracker.clients.getClients("jbsch_clientid",null,null,!1,erecno),Timetracker.projects.Filters.updateProjectListForFilters(!0,erecno,null,"jobsch","0",null,"0"),Layout.Page.container.find("#jbsch_projectid").off("change").on("change",function(){var erecno=Layout.Page.container.find("#jobsch_form").attr("erecno"),cltid=Layout.Page.container.find("#jbsch_clientid").val();Timetracker.jobs.Filters.getJobs(erecno,"0","jobsch",this.value,cltid)}),Layout.Page.container.find("#jbsch_clientid").off("change").on("change",function(){var erecno=Layout.Page.container.find("#jobsch_form").attr("erecno");Timetracker.projects.Filters.updateProjectListForFilters(!0,erecno,this.value,"jobsch",null,"0")}),Layout.Page.container.find("#jbsch_jobid").off("change").on("change",function(){Timetracker.timelogs.jobChange("jobsch"),setJobColor($(this).val())}),modalElm.find("#repeat_form").append(scheduleRepeatPopup()),convertRepeattoSelect2(),repeatIntervalToggle();var currDate=Calendar.parseDate(Timetracker.timejobscheduler.currPopupDate,"%y-%m-%d"),repdae=Calendar.formatDate(currDate);Layout.Page.container.find("#popRepDate").val(repdae),Layout.Page.container.find("#schdDate").val(repdae),Layout.Page.container.find("#jobsch_form").attr("erecno",erecno),Layout.Page.container.find("#sch_billableStatus").select2();var workItemJson=Timetracker.timelogs.checkIfDropDownNeededForWorkitem({jobId:""});if("false"===workItemJson.input){var extraJson={elementId:"sch_workitem"};extraJson.layout=Layout.Page.container.find("#sch_workitem"),extraJson.handleUiClasses=!0,Timetracker.timelogs.convertResultAndApplyDropdownOfWorkitem(workItemJson.data,extraJson)}Layout.Page.container.find("#submitSchedule").off("click").on("click",function(){Timetracker.timejobscheduler.addUpdateJobScheduleDetails(erecno)}),Layout.Page.container.find("#publishSchedule").off("click").on("click",function(){Timetracker.timejobscheduler.addUpdateJobScheduleDetails(erecno,void 0,void 0,!0)}),hasCustomFields()&&Layout.Page.container.find(".customFieldSelect").each(function(){$(this).select2()}),ZPeople.BSModal.show(tempObj)}},editJobScheduleConstruct:editJobScheduleConstruct,setJobSchUserShiftCache:function(details){if(details){var userShiftDataRes=details[0],params=details[1],user=params.user,date=params.date;if(!userShiftDataRes.hasOwnProperty("errorCode")&&!userShiftDataRes.hasOwnProperty("errorMsg")){let userShiftData=userShiftDataRes[user];usersShiftData[user]=usersShiftData[user]||{},usersShiftData[user][date]=userShiftData[date]}}},constJobScheduleForWeekview:resObj.constJobScheduleForWeekview,constJobScheduleForDayview:resObj.constJobScheduleForDayview,setJobColor:setJobColor,initLoad:function(){if(isJobScheduleEnabled()){if(Timetracker.initSetup(),Timetracker.setWorkitemCache(),Timetracker.util.isFilterOpen()&&Timetracker.util.showHideFilters(Layout.Page.container.find("#jobschedule_filter"),"jbschfilter"),Timetracker.timejobscheduler.isjobscheduledatafetched)ZPComponents.Search.Configuration.JSON.defaultOption=void 0;else{var filterparam=Timetracker.Filters.getParamsForFilter("JobSchedule");filterparam=Timetracker.Filters.getParamsForFilter("TimelogReport"),isOrgStructureEnabled&&(Timetracker.Division.constructDivisionFilter("jobsch_DivisionName",filterparam,Timetracker.constants.TTCustomAdmin.EntryView),Timetracker.BusinessUnit.constructBusinessUnitFilter("jobsch_BusinessUnitName",filterparam,Timetracker.constants.TTCustomAdmin.EntryView),Timetracker.LegalEntity.constructLegalEntityFilter("jobsch_LegalEntityName",filterparam,Timetracker.constants.TTCustomAdmin.EntryView)),Timetracker.jobScheduleForm.isClientFilterAllowed()?Layout.Page.container.find("#jobsch_ClientName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.clientDispName)):Layout.Page.container.find("#jobsch_ClientName").closest(".col-md-2").addClass("DNI"),Layout.Page.container.find("#jobsch_projectName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)),Layout.Page.container.find("#jobsch_jobName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.jobDispName)),Timetracker.Department.constructDepartmentFilter("jobsch_department",filterparam,Timetracker.constants.TTCustomAdmin.EntryView),Timetracker.Designation.constructDesignationFilter("jobsch_designation",filterparam,Timetracker.constants.TTCustomAdmin.EntryView),Timetracker.Location.constructLocationFilter("jobsch_location",filterparam,Timetracker.constants.TTCustomAdmin.EntryView),Layout.Page.container.find("#jobsch_assignedto").on("change",function(){"0"===(Layout.Page.container.find("#jobsch_assignedto").val()||"0")&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?(Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show(),Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").prop("checked",!1)):(Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").prop("checked",!1),Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide())}),ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show():Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide(),Timetracker.Search.populateUsers("jobsch_assignedto",void 0,{projectManagerPerm:!0},!0,Timetracker.constants.TTCustomAdmin.EntryView);var isClientFilterAllowed=Timetracker.jobScheduleForm.isClientFilterAllowed();if(isClientFilterAllowed&&(Timetracker.clients.getClients("jobsch_ClientName",null,null,!0,Layout.Page.container.find("#jschdrUser").val(),Timetracker.constants.TTCustomAdmin.EntryView),Layout.Page.container.find("#jobsch_assignedto").on("change",function(){Timetracker.clients.getClients("jobsch_ClientName",null,null,!0,Layout.Page.container.find("#jobsch_assignedto").val(),Timetracker.constants.TTCustomAdmin.EntryView)})),Timetracker.projects.Filters.updateProjectListForFilters(!0,Timetracker.timelogs.tserecno,isClientFilterAllowed?$("#jobsch_ClientName").val():"0","jbschfilter",void 0,void 0,void 0,Timetracker.constants.TTCustomAdmin.EntryView),hasCustomFields()){var customFields=getCustomFields();for(var iterator in customFields){var field=customFields[iterator];if(25===field.componentType){var customFieldFilterHtml='<div class="col-md-2 customFieldFilter"><div class="form-group"><label>'+field.displayName+'</label><select multiple ="multiple" inputSelectType="'+field.labelName+'" placeholder="'+ZPI18N.getString("zp.all")+'" id="'+field.labelName+'"></select></div></div>';$(customFieldFilterHtml).insertAfter(Layout.Page.container.find("#jbschfilter").find("#jobFilterDiv"));var desgText=$("<div></div>");for(var index in field.options)desgText.append($('<option value="'+field.options[index].optionId+'">'+field.options[index].optionValue+"</option>"));Layout.Page.container.find("#"+field.labelName).html($(desgText).html()).select2(Timetracker.select2.getSelect2Properties(!1,{multipleSelections:!0}))}}}}Layout.Page.container.find("#jobsch_pub").select2({minimumResultsForSearch:1/0}),Layout.Page.container.find("#jobschd_clone").attr("data-original-title",ZPI18N.getString("zp.clonejobschd",[ZPI18N.getString("zp.week")])),Layout.Page.container.find("#week_view_jobsch").on("scroll",function(){if(firescroll_Triggered)return!1;this.scrollHeight<$(this).scrollTop()+$(window).height()&&isEmpFetchAvail&&(firescroll_Triggered=!0,"1"===calview?getJobScheduleForWeekview():"0"===calview&&getJobScheduleForDayview()),isEmpFetchAvail||(firescroll_Triggered=!1)}),Layout.Page.container.find(".Scrcont").on("scroll",function(){if(firescroll_Triggered)return!1;this.scrollHeight<$(this).scrollTop()+$(window).height()&&isEmpFetchAvail&&(firescroll_Triggered=!0,"1"===calview?getJobScheduleForWeekview():"0"===calview&&getJobScheduleForDayview()),isEmpFetchAvail||(firescroll_Triggered=!1)}),Timetracker.timejobscheduler.isjobscheduledatafetched||constructJobSchedule(),$(document).on("show.bs.modal",function(){setTimeout(function(){-1!==Layout.Page.currentmode.indexOf("timetracker/jobschedule/list")&&$(".modal-backdrop").addClass("ZPCin")})});var isNewUI="function"==typeof ZPeople.isZPNewUI&&ZPeople.isZPNewUI();Layout.Page.container.find("#week_view_jobsch").on("scroll",function(){var minimizedBarLength=40,secondLevelTabLength=160;isNewUI&&(minimizedBarLength=70,secondLevelTabLength=200),$("body").hasClass("ZPsbarMini")&&(secondLevelTabLength=0);var adjustedLeft=minimizedBarLength+secondLevelTabLength-$(this).scrollLeft();Layout.Page.container.find("#tt_jobschedule_thead").css("left",adjustedLeft)})}else Timetracker.util.appendPermissionDenied()},templates:templates,showRepeat:function(th){Layout.Page.container.find("#jbschrepeat").is(":checked")?(Layout.Page.container.find("#jobsch_form").toggle(),Layout.Page.container.find("#repeat_form").toggle()):(Layout.Page.container.find("#repeatinfo").html("").hide(),Layout.Page.container.find("#repeatedit").hide())},editRepeat:function(th){Layout.Page.container.find("#jobsch_form").toggle(),Layout.Page.container.find("#repeat_form").toggle()},backToMainPopup:function(){var repuntil=Layout.Page.container.find("#popRepDate").val();if(Layout.Page.container.find("#err_repeat").hide(),Calendar.isvalidDate(repuntil)){repDateValidation(Calendar.parseDate(repuntil,uidateFormat)),repuntil=Layout.Page.container.find("#popRepDate").val(),Layout.Page.container.find("#jobsch_form").toggle(),Layout.Page.container.find("#repeat_form").toggle();var reptype=Layout.Page.container.find("#repeatid").val(),intval="1",reptxt=ZPI18N.getString("zp.days");"0"===reptype?intval=Layout.Page.container.find("#daily_int").val():"1"===reptype?(intval=Layout.Page.container.find("#week_int").val(),reptxt=ZPI18N.getString("zp.wftbaweeks")):"2"===reptype&&(intval=Layout.Page.container.find("#month_int").val(),reptxt=ZPI18N.getString("zp.months"));var infoArr=[];infoArr.push(intval),infoArr.push(reptxt),infoArr.push(repuntil);var repinfo=ZPI18N.getString("zp.repeatinfo",infoArr);Layout.Page.container.find("#repeatinfo").html(repinfo).show(),Layout.Page.container.find("#repeatedit").show()}else Layout.Page.container.find("#err_repeat").text(ZPI18N.getString("zp.validdateerr")).show()},repDateValidation:repDateValidation,scheduleDateOnSelectCallback:function(selDataObj){var schDateDOM=Layout.Page.container.find("#schdDate");schDateDOM.parents(".btnCal").removeClass("error"),selDataObj?Timetracker.timejobscheduler.currPopupDate=Timetracker.DateTime.getDateinDBformat(selDataObj,!0):schDateDOM.val(Timetracker.timejobscheduler.currPopupDate),Layout.Page.container.find("#schdDate").trigger("change")},scheduleDateOnChangeCallback:function(thisObj){var value=$(thisObj).val();Layout.Page.container.find("#schdDate").parents(".btnCal").removeClass("error"),!ZPUtil.Validation.isEmpty(value)&&ZPUtil.Validation.isDate(value)||Layout.Page.container.find("#schdDate").parents(".btnCal").addClass("error")},chooseRepeatTypeCallback:function(modal){var extraDetails=modal.data("extraDetails"),action=extraDetails.action,eventType=modal.find("input[name=tt_edit_schd]:checked").val();if("edit"===action||"publish"===action){extraDetails.dateid;var assigneeid=extraDetails.empno,tschObj=extraDetails.tschObj,isPubed=extraDetails.isPubed;Timetracker.timejobscheduler.addUpdateJobScheduleDetails(assigneeid,tschObj,!0,isPubed,eventType)}else"delete"===action&&ZPeople.BSModal.confirm(Timetracker.timejobscheduler.deleteSchedule,"",void 0,void 0,{id:extraDetails.id,eventType:eventType})},addUpdateJobScheduleDetails:function(assigneeid,tschObj,isFromEdit,isPubed,eventType){var jobSchObj=Timetracker.timejobscheduler.validateAddUpdateJobScheduleDetails(assigneeid,tschObj);if(!jobSchObj)return!1;jobSchObj.isPubed=isPubed||!1,jobSchObj.assignedTo=assigneeid;var jsonParam,isRepeat=Layout.Page.container.find("#jbschrepeat").is(":checked")||!1;if(isRepeat){isFromEdit&&(eventType=eventType||"1",jobSchObj.editRepeat="1"===eventType||"2"===eventType,jobSchObj.editRepeat&&(jobSchObj.editRepeatType=eventType)),jobSchObj.isRepeat=isRepeat;var reptype=Layout.Page.container.find("#repeatid").val(),intval="1";if(ZPI18N.getString("zp.days"),"0"===reptype)intval=Layout.Page.container.find("#daily_int").val();else if("1"===reptype){var repRule="";Layout.Page.container.find("#daysel_sun").prop("checked")&&(repRule+="0,"),Layout.Page.container.find("#daysel_mon").prop("checked")&&(repRule+="1,"),Layout.Page.container.find("#daysel_tue").prop("checked")&&(repRule+="2,"),Layout.Page.container.find("#daysel_wed").prop("checked")&&(repRule+="3,"),Layout.Page.container.find("#daysel_thu").prop("checked")&&(repRule+="4,"),Layout.Page.container.find("#daysel_fri").prop("checked")&&(repRule+="5,"),Layout.Page.container.find("#daysel_sat").prop("checked")&&(repRule+="6"),jobSchObj.repeatRule=repRule,intval=Layout.Page.container.find("#week_int").val(),ZPI18N.getString("zp.wftbaweeks")}else"2"===reptype&&(intval=Layout.Page.container.find("#month_int").val(),ZPI18N.getString("zp.months"));var repuntil=Layout.Page.container.find("#popRepDate").val();jobSchObj.repeatInt=intval,jobSchObj.repeatType=reptype;var selDate=Calendar.parseDate(repuntil,uidateFormat),day=Timetracker.util.convertDateTo2digit(selDate.getDate()),month=selDate.getMonth()+1,year=selDate.getFullYear();jobSchObj.repeatUntil=year+"-"+month+"-"+day,tschObj&&tschObj.repeatId&&(jobSchObj.repeatId=tschObj.repeatId)}isFromEdit?(jobSchObj.tschId=tschObj.tschId,(jsonParam={}).p=jobSchObj,jsonParam.ep=jobSchObj,jsonParam.fn=Timetracker.timejobscheduler.updateJobScheduleResponse,reqObj.updateJobSchedule(jsonParam)):((jsonParam={}).p=jobSchObj,jsonParam.ep=jobSchObj,jsonParam.fn=Timetracker.timejobscheduler.addJobScheduleResponse,reqObj.addJobSchedule(jsonParam)),Layout.Page.container.find("#jobsch_modelmask").modal("hide")},validateAddUpdateJobScheduleDetails:function(assigneeid,tschObj){var jobSchObj={},str_jobId=Layout.Page.container.find("input[name=JobId]").val();if(!str_jobId||"0"===str_jobId)return Layout.Page.container.find("#job_error_message").show(),!1===Layout.Page.container.find("#jobsch_form").is(":visible")&&Timetracker.timejobscheduler.backToMainPopup(),!1;if(jobSchObj.jobId=str_jobId,jobSchObj.desc=Layout.Page.container.find("#sch_desc").val(),jobSchObj.billableStatus=Layout.Page.container.find("#sch_billableStatus").val(),Layout.Page.container.find("#sch_workitem").hasClass("select2-offscreen")?(jobSchObj.workitem=Layout.Page.container.find("#sch_workitem").val(),"0"===jobSchObj.workitem&&(jobSchObj.workitem="")):jobSchObj.workitem=Layout.Page.container.find("#sch_workitem").val(),jobSchObj.workitem.length>500)return Layout.Page.container.find("#sch_workitem_error").show(),!1===Layout.Page.container.find("#jobsch_form").is(":visible")&&Timetracker.timejobscheduler.backToMainPopup(),!1;if(Layout.Page.container.find("#sch_workitem_error").hide(),jobSchObj.desc&&jobSchObj.desc.length>500)return Layout.Page.container.find("#desc_error_message").show(),!1===Layout.Page.container.find("#jobsch_form").is(":visible")&&Timetracker.timejobscheduler.backToMainPopup(),!1;var dateDOM=Layout.Page.container.find("#schdDate"),schdDate=dateDOM.val();if(!ZPUtil.Validation.isDate(schdDate))return dateDOM.parents(".btnCal").addClass("error"),!1===Layout.Page.container.find("#jobsch_form").is(":visible")&&Timetracker.timejobscheduler.backToMainPopup(),!1;var selDate=Calendar.parseDate(schdDate,uidateFormat),dateid=Timetracker.DateTime.getDateinDBformat(selDate,!0);jobSchObj.date=dateid;var fromtime=Layout.Page.container.find("#timesch_fromtime").val().trim(),totime=Layout.Page.container.find("#timesch_totime").val().trim(),fromtimesplit=fromtime.split(":"),totimesplit=totime.split(":");if(jobSchObj.fromtime=Timetracker.util.getTotalTimeForHours(fromtimesplit),jobSchObj.totime=Timetracker.util.getTotalTimeForHours(totimesplit),jobSchObj.fromtime&&jobSchObj.fromtime>1440&&(jobSchObj.fromtime=1440),jobSchObj.totime&&jobSchObj.totime>1440&&(jobSchObj.totime=1440),function(dateid,assigneeid,addEditObj,preveditObj){var edth,isOverlap=!1;if("1"===calview){var day=dateid.split("-")[2];edth=$("#"+assigneeid+"_"+day).find(".js-schedule")}else"0"===calview&&(edth=$("#has_drag_id_"+assigneeid));if(edth){var schid,childElem=edth.children();preveditObj&&preveditObj.tschId&&(schid=preveditObj.tschId);for(var i=0;i<childElem.length;i++){var dataElem=$(childElem[i]).data();if(dataElem){if(schid&&schid===dataElem.tschId)continue;var newFrm=parseInt(addEditObj.fromtime),newTo=parseInt(addEditObj.totime),oldFrm=parseInt(dataElem.fromTime),oldTo=parseInt(dataElem.toTime);if(newFrm>newTo&&(newTo+=Timetracker.constants.PER_DAY_MIN),oldFrm>oldTo&&(oldTo+=Timetracker.constants.PER_DAY_MIN),isOverlap=checkTimeOverLaps(newFrm,newTo,oldFrm,oldTo))break}}}return isOverlap}(dateid,assigneeid,jobSchObj,tschObj))return Layout.Page.container.find("#time_error_message").text(ZPI18N.getString("zp.scheduletimesoverlap")).show(),!1===Layout.Page.container.find("#jobsch_form").is(":visible")&&Timetracker.timejobscheduler.backToMainPopup(),!1;if(0!=Layout.Page.container.find("#jbschExtend").length&&(jobSchObj.extendAllowed=Layout.Page.container.find("#jbschExtend").prop("checked")),hasCustomFields()){Layout.Page.container.find(".customFieldError").each(function(){$(this).hide()});var customFieldDetails={},customFields=getCustomFields(),allowedFileds=Timetracker.jobScheduleForm.fetchAllAllowedFields(Timetracker.timejobscheduler.currPopupUser,Timetracker.constants.EDIT,customFields);if(!allowedFileds||0==allowedFileds.length)return;for(var iterator in customFields){var field=customFields[iterator];if(allowedFileds.includes(field.labelName)){var value,fieldObj=Layout.Page.container.find('.customField[folabel="'+field.labelName+'"]');if(19==field.componentType){if(""!==(value=fieldObj.find("#"+field.labelName+"_input").val().trim())){if(!Timetracker.Validations.isDecimal(value))return fieldObj.find("#"+field.labelName+"_error").text(ZPI18N.getString("zp.entervaliddecimal",[field.displayName])),fieldObj.find("#"+field.labelName+"_error").show(),!1;if(void 0!==field.min&&void 0!==field.max){var isValidMinRange=field.minExclusion?Number(field.min)<Number(value):Number(field.min)<=Number(value),isValidMaxRange=field.maxExclusion?Number(field.max)>Number(value):Number(field.max)>=Number(value);if(!isValidMinRange||!isValidMaxRange){var errorMessage=ZPI18N.getString("zp.maximumrangeforfield",[field.displayName,field.min,field.max]);if(field.minExclusion&&field.maxExclusion){var greaterthan=ZPI18N.getString("zp.sgreaterthan",[field.min]),lesserthan=ZPI18N.getString("zp.slesserthan",[field.max]);errorMessage=ZPI18N.getString("zp.valuerangebracket",[field.displayName,greaterthan,lesserthan])}else field.minExclusion?(greaterthan=ZPI18N.getString("zp.sgreaterthan",[field.min]),lesserthan=ZPI18N.getString("zp.slessthanorequalto",[field.max]),errorMessage=ZPI18N.getString("zp.valuerangebracket",[field.displayName,greaterthan,lesserthan])):field.maxExclusion&&(greaterthan=ZPI18N.getString("zp.survey.score.greater_equal",[field.min]),lesserthan=ZPI18N.getString("zp.slesserthan",[field.max]),errorMessage=ZPI18N.getString("zp.valuerangebracket",[field.displayName,greaterthan,lesserthan]));return fieldObj.find("#"+field.labelName+"_error").text(errorMessage),fieldObj.find("#"+field.labelName+"_error").show(),!1}}else if(void 0!==field.min){if(!(isValidMinRange=field.minExclusion?Number(field.min)<Number(value):Number(field.min)<=Number(value)))return errorMessage=field.minExclusion?ZPI18N.getString("zp.sgreaterthan",[field.min]):ZPI18N.getString("zp.survey.score.greater_equal",[field.min]),fieldObj.find("#"+field.labelName+"_error").text(ZPI18N.getString("zp.valuerangecondition",[field.displayName,errorMessage])),fieldObj.find("#"+field.labelName+"_error").show(),!1}else if(void 0!==field.max&&!(isValidMaxRange=field.maxExclusion?Number(field.max)>Number(value):Number(field.max)>=Number(value)))return errorMessage=field.maxExclusion?ZPI18N.getString("zp.slesserthan",[field.max]):ZPI18N.getString("zp.slessthanorequalto",[field.max]),fieldObj.find("#"+field.labelName+"_error").text(ZPI18N.getString("zp.valuerangecondition",[field.displayName,errorMessage])),fieldObj.find("#"+field.labelName+"_error").show(),!1}}else 25==field.componentType&&(value="0"===(value=fieldObj.find("#"+field.labelName+"_select").val())?"":value);(""!==value||tschObj&&tschObj.customFieldDetails&&void 0!==tschObj.customFieldDetails[field.labelName])&&(customFieldDetails[field.labelName]=value)}}jobSchObj.customFieldDetails=JSON.stringify(customFieldDetails)}return jobSchObj||{}},deleteSchedule:function(modal){var extraDetails=modal.data("extraDetails"),tschId=extraDetails.id,delRepeatType=extraDetails.eventType,jsonParam={},jobSchObj={};jobSchObj.tschId=tschId,jobSchObj.delRepeat="1"===delRepeatType||"2"===delRepeatType,jobSchObj.delRepeat&&(jobSchObj.delRepeatType=delRepeatType),jsonParam.p=jobSchObj,jsonParam.ep=jobSchObj,jsonParam.fn=Timetracker.timejobscheduler.deleteScheduleResponse,reqObj.deleteJobSchedule(jsonParam)},currPopupDate:void 0,currPopupUser:void 0,currPopupMode:void 0,generatePrintReport:function(){Timetracker.util.printReport(null,!1,Layout.Page.container.find("#jobsch_assignedto").val(),Layout.Page.container.find(".well.ZPPhed").find("[id^='calInfo']").text())},resetSelectInFilters:function(){Layout.Page.container.find("#jobsch_assignedto").val("0").trigger("change"),Layout.Page.container.find("#jobsch_pub").val("0").trigger("change")},showimportfld:function(){var cont=Layout.Page.container.find("#zp_jobSchedule_import_container");cont.find("#imphelp").html(function(){var customFields,hasCustomFileds=hasCustomFields();hasCustomFileds&&(customFields=getCustomFields());var isExtendable=Timetracker.generalSettings.isJobSchTLRestrictExtendEnabled(),helpDivHtml=`<p><b class="DB dgry">${ZPI18N.getString("zp.supportedformats")}:</b></p>\n\t                             <div class="OVA">   \n\t                                <table class="table table-hover S13">\n\t                                    <tbody>\n\t                                        <tr class="TblGryBg ">\n\t                                            <th>&nbsp;</th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th><th>I</th><th>J</th><th>K</th><th>L</th><th>M</th>`;if(hasCustomFileds){let preRequisteCharAscii=65,dispCharAscii=78;for(var i=0;i<customFields.length+(isExtendable?3:2);i++){let preQuiste="";91==dispCharAscii&&(dispCharAscii=65,preQuiste=String.fromCharCode(preRequisteCharAscii),preRequisteCharAscii++),helpDivHtml+=`<th>${preQuiste+String.fromCharCode(dispCharAscii)}</th>`,dispCharAscii++}}if(helpDivHtml+=`</tr>\n\t                                        <tr class="ZPLRow">\n\t                                            <th>1</th>\n\t                                            <th><span class="form_jobname ellipsis W80">${ZPeople.decodeTxt(Timetracker.util.projectDispName)}</span></th>\n\t                                            <th><span class="form_projectname ellipsis W80">${ZPeople.decodeTxt(Timetracker.util.jobDispName)}</span></th>\n\t                                            <th>${ZPI18N.getString("zp.mailId")}</th>\n\t                                            <th>${ZPI18N.getString("zp.empid")}</th>\n\t                                            <th>${ZPI18N.getString("zp.scheduledate")}</th>\n\t                                            <th>${ZPI18N.getString("zp.fromtime")}</th>\n\t                                            <th>${ZPI18N.getString("zp.totime")}</th>\n\t                                            <th>${ZPI18N.getString("zp.scheduledescription")}</span></th>\n\t                                            <th>${ZPI18N.getString("zp.jbshispublished")}</th>\n\t                                            <th>${ZPI18N.getString("zp.jbshisrepititive")}</th>\n\t                                            <th>${ZPI18N.getString("zp.repatFrequency")}</th>\n\t                                            <th>${ZPI18N.getString("zp.jbshrepeatinterval")}</th>\n\t                                            <th>${ZPI18N.getString("zp.jbshrepeatuntilldate")}</th>\n\t                                            <th>${ZPI18N.getString("zp.billablestatus")}</th>\n\t\t\t\t \t\t\t\t  \t\t\t\t<th>${ZPI18N.getString("zp.workitem")}</th>`,hasCustomFileds)for(var iterator in isExtendable&&(helpDivHtml+=`<th>${ZPI18N.getString("zp.jobschextend")}</th>`),customFields){var field=customFields[iterator];helpDivHtml+=`<th>${field.displayName}</th>`}if(helpDivHtml+=`</tr>\n\t                                        <tr class="ZPLRow">\n\t                                            <th>2</th>\n\t                                            <td>Development</td>\n\t                                            <td>Mobile App</td> \n\t                                            <td>tony@zillum.com</td> \n\t                                            <td>ZCON001</td> \n\t                                            <td>${dateFmt}</td> \n\t                                            <td>3:00pm</td>\n\t                                            <td>4:00pm</td>\n\t                                            <td></td>\t\t                                                                                    \n\t                                            <td>yes</td> \n\t                                            <td>yes</td></td>\n\t                                            <td>Daily</td></td> \n\t                                            <td>1</td>\n\t                                            <td>${dateFmt}</td> \n\t                                            <td>billable</td>\n\t\t\t        \t\t\t\t\t\t\t<td>Work Item1</td>`,hasCustomFileds){isExtendable&&(helpDivHtml+="<td>Yes</td>");var customFieldDummyVal={Efficiency_Target:"34.0",Productivity_Target:"90.0",Agent_Status:"Training",Percentage_Fixed_Target:"83.0",TPS_Target:"1",Target_Production_Hours:"9.0",Quality_Target:"21.0",Target_Training_Hours:"7.0",Client_Billable_Task_Target:"34.0",Agent_Assignment:"Agent",Target_Billable_Hours:"5.0",Target_Type:"Tasks"};for(var iterator in customFields){var field=customFields[iterator];helpDivHtml+=`<td>${customFieldDummyVal[field.labelName]}</td>`}}if(helpDivHtml+=`</tr>\n\t                                        <tr class="ZPLRow">\n\t                                            <th>3</th>\n\t                                            <td>Assignment</td> \n\t                                            <td>Tax Returns</td> \n\t                                            <td>sarah@zillum.com</td> \n\t                                            <td>ZCON002</td>\n\t                                            <td>${dateFmt}</td>\n\t                                            <td>1:00am</td>                                  \n\t                                            <td>2:20am</td> \n\t                                            <td>Finance</td> \n\t                                            <td>no</td>  \n\t                                            <td></td>                             \n\t                                            <td></td>\n\t                                            <td></td>\n\t                                            <td></td>\n\t                                            <td></td>\n\t                                            <td></td>`,isExtendable&&(helpDivHtml+="<td></td>"),hasCustomFileds)for(var iterator in customFields){var field=customFields[iterator];helpDivHtml+="<td></td>"}return helpDivHtml+=`</tr>\n\t                                    </tbody>\n\t                                </table>\n\t                          </div>   \n\t\t\t\t\t\t\t  <p><b class="DB dgry">${ZPI18N.getString("zp.note")}:</b></p>\n\t                          <ul class="list-number">\n\t                              <li class="S12 LH20">${ZPI18N.getString("zp.firstrowmsg")}</li>\n                              \t  <li class="S12 LH20">${ZPI18N.getString("zp.unexpectederrormsg")}</li>\n                                  <li class="S12 LH20">${ZPI18N.getString("zp.recommendeddatemsg")}</li>    \n                                  <li class="S12 LH20">${ZPI18N.getString("zp.jbschimportcountexceederror",[1e3])}</li>  \n                                  <li class="S12 LH20">${ZPI18N.getString("zp.publishdraftschedule")}</li>                                   \n                                  <li class="S12 LH20">${ZPI18N.getString("zp.isrepeattrue")}</li>        \t\t                                  \n\t\t\t\t\t\t\t\t  <li class="S12 LH20">${ZPI18N.getString("zp.repeatintervalrange")}</li>                                   \n                                  <li class="S12 LH20">${ZPI18N.getString("zp.repeatfrequencyvalues")}</li>                                   \n                                  <li class="S12 LH20">${ZPI18N.getString("zp.scheduledescriptioncounterror",[500])}</li>                           \n\t\t\t\t\t\t\t\t  <li class="S12 LH20">${ZPI18N.getString("zp.repeatdateduration",[2])}</li>           \n                              </ul>`}()),cont.find("#imphelp,#importStep1 .modal-footer").show(),cont.find(".ZPNxtStep").addClass("DN").hide(),cont.find("#importStep1").removeClass("DN").fadeIn(300),cont.find("#importFileName,#importdUploadedFName").html(""),cont.find("#importFileName").val(""),cont.find("#step1Div1").fadeIn(300);var txt='<button id="step2Next" class="btn btn-default btn-md MR10 FR" onclick="Timetracker.timejobscheduler.jobScheduleConfirm();" type="button"> '+ZPI18N.getString("zp.next")+' </button><button id="step2Prev" onclick="Timetracker.timejobscheduler.showStep1Div2();" class="btn btn-default  btn-md MR10 FR" type="button"> '+ZPI18N.getString("zp.previous")+' </button><button class="btn btn-default btn-md FL" data-dismiss="modal" type="button"> '+ZPI18N.getString("zp.close")+" </button>";cont.find("#importStep2").find(".modal-footer").html(txt),cont.find("#step1Next,#step1Prev,#step1Div2,#step1Div3").hide(),cont.modal("show"),cont.find("#importStep2MsgDiv").addClass("blu").removeClass("red"),cont.find("#importStep2ConfirmMapping").removeAttr("style")},showimportoption:function(){var isAllowed=!1;if((Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit))&&(isAllowed=!0),!isAllowed&&Timetracker.generalSettings&&Timetracker.generalSettings.settingDetails){var editPerm=Timetracker.generalSettings.getJobSchdEditPerm();("2"===editPerm||"1"===editPerm&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1)&&(isAllowed=!0)}isAllowed?Layout.Page.container.find("#jobScheduleImportOption").removeClass("DN"):Layout.Page.container.find("#jobScheduleImportOption").addClass("DN")},showStep1Div2:function(){var cont=Layout.Page.container.find("#zp_jobSchedule_import_container");cont.find("#importStep2,#step1Div3").hide(),cont.find("#imp_prog div").width("0%"),cont.find("#importStep1,#step1Div2,#importStep1 .modal-footer").show();var fn=cont.find("#importFileName").val();fn=fn.replace("C:\\fakepath\\",""),cont.find("#importdUploadedFName").text(fn);var extn=fn.split(".").pop();"xls"===extn||"csv"===extn||"xlsx"===extn?(cont.find("#importdUploadedFName").next().attr("class","IC-rou-tik ML5 filetck"),cont.find("#step1Next,#step1Prev").fadeIn(300),cont.find("#importFileName").text(fn)):(cont.find("#importdUploadedFName").next().attr("class","IC-r-close ML5 PR S18 red"),cont.find("#step1Next").hide()),cont.find("#step1Div1, #imphelp").hide(),cont.find("#step1Div2").fadeIn(300)},jobScheduleImports:function(form){var cont=Layout.Page.container.find("#zp_jobSchedule_import_container");cont.find("#step1Div3").show(),cont.find("#importStep1 .modal-footer, #step1Div2").hide();var cfn=cont.find("#step1Div2").find("#importdUploadedFName").text();cont.find("#step1Div3").find("#progressName").text(cfn),cont.find("#imp_prog div").width(PROGRESS_BAR_WIDTH+"%").parent().show();var formData=new FormData,importFile=cont.find("#importFileName")[0].files;for(importFile.length>0&&formData.append("importFile",importFile[0]),formData.append("module","importTTJobSchedule"),formData.append("conreqcsr",csrfToken),$.ajax({url:"/timeSheetImport.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){Timetracker.timejobscheduler.jobScheduleShowMapping(response)}});PROGRESS_BAR_WIDTH<=90;)Layout.Page.container.find("#imp_prog div").width(PROGRESS_BAR_WIDTH+"%"),PROGRESS_BAR_WIDTH+=2},jobScheduleShowMapping:function(obj){if(1==obj.res){for(this.PROGRESS_BAR_WIDTH=90,Layout.Page.container.find("#imp_prog div").width(PROGRESS_BAR_WIDTH+"%");PROGRESS_BAR_WIDTH<=100;)Layout.Page.container.find("#imp_prog div").width(PROGRESS_BAR_WIDTH+"%"),PROGRESS_BAR_WIDTH+=1;var cont=Layout.Page.container.find("#zp_jobSchedule_import_container");this.fileFormat=obj.resObj.fileFormat;var theadersList=obj.resObj.tableHeaders;this.headerHash={};var result="<option value='None' selected='selected'>"+ZPI18N.getString("zp.select")+"</option>";for(var i in theadersList){var optval=theadersList[i];result+="<option value='"+i+"'>"+optval+"</option>",optval=optval.toLowerCase().trim(),this.headerHash[ZPeople.decodeTxt(optval)]=i}if(Timetracker.timelogs.imp_records=obj.resObj.recordCount,void 0!==obj.resObj.recordCount?cont.find("#importStep2MsgDiv").text(Timetracker.timelogs.imp_records+" "+ZPI18N.getString("zp.recordsfound")):cont.find("#importStep2MsgDiv").text("0 "+ZPI18N.getString("zp.recordsfound")),Layout.Page.container.find("#imp_isrepititive").on("change",function(){var value=cont.find("#imp_isrepititive").find("select").val();value&&"None"!=value?Layout.Page.container.find("#imp_repfrequency,#imp_repinterval,#imp_repuntilldate").removeClass("DN"):Layout.Page.container.find("#imp_repfrequency,#imp_repinterval,#imp_repuntilldate").addClass("DN")}),isJobSchTLExtendEnabled()&&0==cont.find("#mappingSectionOne").find("#imp_extendable").length){var extendOpt='<div id="imp_extendable" class="form-group"><label>'+ZPI18N.getString("zp.jobschextend")+'</label><select displayName="test"></select></div>';(extendOpt=$(extendOpt)).find("select").select2(Timetracker.select2.getSelect2Properties()),cont.find("#mappingSectionOne").append(extendOpt)}if(hasCustomFields()){var customFields=cont.find("#mappingSectionOne").find(".customFieldImport");if(!customFields||0==customFields.length){var customFieldHtml="";for(var iterator in customFields=getCustomFields()){var field=customFields[iterator];customFieldHtml+='<div id="imp_'+field.labelName+'" class="form-group customFieldImport"><label>'+field.displayName+'</label><select class="customFieldSelect" displayName="'+field.displayName+'"></select></div>'}cont.find("#mappingSectionOne").append(customFieldHtml)}}if(cont.find("#importStep2MsgDiv").parent().show(),cont.find("#imp_mapfield").val("0"),Timetracker.timejobscheduler.mapfieldChange(),cont.find("#imp_date select").html(result),cont.find("#imp_date select").val(this.headerHash["schedule date"]),cont.find("#imp_job select").html(result),cont.find("#imp_job select").val(this.headerHash["job name"]),cont.find("#imp_jobslist select").html(result),cont.find("#imp_jobslist select").val(this.headerHash["project name"]),cont.find("#imp_mapvalue select").html(result),cont.find("#imp_fromtime select").html(result),cont.find("#imp_fromtime select").val(this.headerHash["from time"]),cont.find("#imp_totime select").html(result),cont.find("#imp_totime select").val(this.headerHash["to time"]),cont.find("#imp_Status select").html(result),cont.find("#imp_Status select").val(this.headerHash["schedule published"]),cont.find("#imp_Description select").html(result),cont.find("#imp_Description select").val(this.headerHash["schedule description"]),cont.find("#imp_isrepititive select").html(result),cont.find("#imp_isrepititive select").val(this.headerHash["repeated schedule"]).trigger("change"),cont.find("#imp_repfrequency select").html(result),cont.find("#imp_repfrequency select").val(this.headerHash["repeat frequency"]),cont.find("#imp_repinterval select").html(result),cont.find("#imp_repinterval select").val(this.headerHash["repeat interval"]),cont.find("#imp_repuntilldate select").html(result),cont.find("#imp_repuntilldate select").val(this.headerHash["repeat until (date)"]),cont.find("#imp_BillableStatus select").html(result),cont.find("#imp_BillableStatus select").val(this.headerHash["billable status"]),cont.find("#imp_Workitem select").html(result),cont.find("#imp_Workitem select").val(this.headerHash["work item"]),cont.find("#importStep2 select").select2(Timetracker.select2.getSelect2Properties()),cont.find("#importStep2MsgDiv").removeClass("red").addClass("blu"),isJobSchTLExtendEnabled()&&(cont.find("#imp_extendable select").html(result),cont.find("#imp_extendable select").val(this.headerHash["Allow timelogs beyond schedule"]),cont.find("#imp_extendable select").select2(Timetracker.select2.getSelect2Properties())),hasCustomFields()){var tempHeaderHash=this.headerHash;Layout.Page.container.find(".customFieldImport").find("select").each(function(){var displayName=$(this).attr("displayName").toLowerCase();void 0!==tempHeaderHash[displayName]?$(this).html(result).val(tempHeaderHash[displayName]):$(this).html(result).val("None"),$(this).select2(Timetracker.select2.getSelect2Properties())})}cont.find("#importStep2 select").each(function(){var value=$(this).val();""!=value&&null!=value||$(this).select2("val","None")}),cont.find("#importStep1").addClass("DN").fadeOut(1500),cont.find("#step2Prev").show(),cont.find("#importStep2").removeClass("DN").fadeIn(1500)}else void 0!=obj.errMsg?(Timetracker.Util.displayFailureMessage(obj.errMsg),ZPeople.BSModal.hide("zp_jobSchedule_import_container"),Timetracker.util.removeLoading()):(Timetracker.Util.displayFailureMessage(ZPI18N.getString("zp.fileError")),ZPeople.BSModal.hide("zp_jobSchedule_import_container"),Timetracker.util.removeLoading())},mapfieldChange:function(){var cont=Layout.Page.container.find("#zp_jobSchedule_import_container");cont.find("#imp_mapvalue").val(this.headerHash[cont.find("#imp_mapfield select option:selected").text().toLowerCase()])},dupJobScheduleConfirm:function(){var cont=Layout.Page.container.find("#zp_jobSchedule_import_container");cont.find("#importStep2").addClass("DN").hide(),cont.find("#importStep2MsgDiv").removeClass("red").addClass("blu"),cont.find("#importStep2").find("#importStep2ConfMap").removeClass("active"),cont.find("#importStep2").removeClass("DN").fadeIn(300),cont.find("#importStep2MsgDiv").text(Timetracker.timelogs.imp_records+" "+ZPI18N.getString("zp.recordsfound")),cont.find("#importStep2 div").find(".select2-container").hasClass("blubr")&&cont.find("#importStep2 div").removeClass("blubr"),cont.find("#importStep2 div").find(".select2-container").hasClass("error-clr")&&cont.find("#importStep2 div").removeClass("error-clr");var txt='<button id="step2Next" class="btn btn-default btn-md MR10 FR" onclick="Timetracker.timejobscheduler.jobScheduleConfirm();" type="button"> '+ZPI18N.getString("zp.next")+' </button><button id="step2Prev" onclick="Timetracker.timejobscheduler.showStep1Div2();" class="btn btn-default  btn-md MR10 FR" type="button"> '+ZPI18N.getString("zp.previous")+'</button><button class="btn btn-default btn-md FL" data-dismiss="modal" type="button">'+ZPI18N.getString("zp.close")+" </button>";cont.find("#importStep2").find(".modal-footer").html(txt)},jobScheduleConfirm:function(){Layout.Page.container.find("#zp_page_loading").remove();var cont=Layout.Page.container.find("#zp_jobSchedule_import_container"),flag=0;cont.find("#importStep2").addClass("DN").hide(),cont.find("#importStep2").find("#importStep2ConfMap").addClass("active"),cont.find("#importStep2").removeClass("DN").fadeIn(300),cont.find("#importStep2MsgDiv").text();var mapfield=cont.find("#imp_mapfield").find("select").val(),mapvalue=cont.find("#imp_mapvalue").find("select").val();cont.find("#importStep2 div").find(".select2-container").hasClass("blubr")&&cont.find("#importStep2 div").removeClass("blubr"),cont.find("#importStep2 div").find(".select2-container").hasClass("error-clr")&&cont.find("#importStep2 div").removeClass("error-clr"),cont.find("#importStep2 select:visible").each(function(){"None"==$(this).val()&&($(this).parent().children().hasClass("Matry")?($(this).parent().find(".select2-container").addClass("error-clr"),flag++):$(this).parent().find(".select2-container").addClass("blubr"))}),"0"!==mapfield&&"None"!==mapvalue||("0"===mapfield&&cont.find("#imp_mapfield .select2-container").removeClass("blubr").addClass("error-clr"),"None"===mapvalue&&cont.find("#imp_mapvalue .select2-container").removeClass("blubr").addClass("error-clr")),flag>0?(cont.find("#importStep2MsgDiv").text(ZPI18N.getString("zp.MandatoryFieldMap")),cont.find("#importStep2MsgDiv").removeClass("blu").addClass("red")):(cont.find("#importStep2MsgDiv").html(ZPI18N.getString("zp.unmappedFieldMap")),cont.find("#importStep2MsgDiv").removeClass("red").addClass("blu"));var txt='<button id="step2Next" class="btn btn-default btn-md MR10 FR" onclick="Timetracker.timejobscheduler.submitMapping();" type="button"> '+ZPI18N.getString("zp.next")+' </button><button id="step2Prev" onclick="Timetracker.timejobscheduler.dupJobScheduleConfirm();" class="btn btn-default  btn-md MR10 FR" type="button"> '+ZPI18N.getString("zp.previous")+' </button><button class="btn btn-default btn-md FL" data-dismiss="modal" type="button"> '+ZPI18N.getString("zp.close")+" </button>";cont.find("#importStep2").find(".modal-footer").html(txt)},submitMapping:function(){Layout.Page.container.find("#zp_page_loading").remove();var cont=Layout.Page.container.find("#zp_jobSchedule_import_container"),map_Date=cont.find("#imp_date").find("select").val(),map_job=cont.find("#imp_job").find("select").val(),map_Jobslist=cont.find("#imp_jobslist").find("select").val(),status=cont.find("#imp_Status").find("select").val();void 0===map_Jobslist&&(map_Jobslist="None");var map_Description=cont.find("#imp_Description").find("select").val();void 0!==map_Description&&"None"!==map_Description||(map_Description=-1);var map_BillableStatus=cont.find("#imp_BillableStatus").find("select").val();void 0!==map_BillableStatus&&"None"!==map_BillableStatus||(map_BillableStatus=-1);var map_Workitem=cont.find("#imp_Workitem").find("select").val();void 0!==map_Workitem&&"None"!==map_Workitem||(map_Workitem=-1);var map_Ftime=cont.find("#imp_fromtime").find("select").val(),map_Ttime=cont.find("#imp_totime").find("select").val(),mapfield=cont.find("#imp_mapfield").find("select").val(),mapvalue=cont.find("#imp_mapvalue").find("select")[0].selectedIndex,showFldError=!1,map_repetitive=cont.find("#imp_isrepititive").find("select").val();if(void 0!==map_repetitive&&"None"!==map_repetitive){var map_frequency=cont.find("#imp_repfrequency").find("select").val(),map_interval=cont.find("#imp_repinterval").find("select").val(),map_untilldate=cont.find("#imp_repuntilldate").find("select").val();"None"!==map_frequency&&"None"!==map_interval&&"None"!==map_untilldate||(showFldError=!0)}else map_repetitive=map_frequency=map_interval=map_untilldate="-1";if("None"==map_Jobslist&&(map_Jobslist=-1),"None"==status&&(status=-1),"None"!==map_Date&&"None"!==map_job&&"None"!==map_Ftime&&"None"!==map_Ttime||(showFldError=!0),"0"!==mapfield&&"0"!=mapvalue||(showFldError=!0),showFldError)Timetracker.timejobscheduler.jobScheduleConfirm();else{cont.find("#importStep2ConfirmMapping").addClass("DN").hide(),Layout.Page.container.find("#importStep2").find(".modal-footer").find("#step2Next").hide(),Layout.Page.container.find("#importStep2").find(".modal-footer").find("#step2Prev").hide(),Layout.Page.container.find("#importStep3").find(".modal-body").children().hide(),cont.find(".modal-content").append(ZPeople.LOADING_HTML);var param={mode:"importTTJobSchedule",jobname:map_job,projectname:map_Jobslist,date:map_Date,ftime:map_Ftime,ttime:map_Ttime,status:status,description:map_Description,billableStatus:map_BillableStatus,workitem:map_Workitem,isRepetitive:map_repetitive,frequency:map_frequency,interval:map_interval,repeatDate:map_untilldate,mapfield:mapfield,mapvalue:mapvalue-1,fileFormat:this.fileFormat,conreqcsr:csrfToken};if(isJobSchTLExtendEnabled()){var extendMappingValue=cont.find("#imp_extendable").find("select").val();param.extendAllowed=void 0!==extendMappingValue&&"None"!==extendMappingValue?extendMappingValue:-1}if(hasCustomFields()){var customFieldDetails={},customFields=getCustomFields();for(var iterator in customFields){var customField=customFields[iterator],customMappingValue=cont.find("#imp_"+customField.labelName).find("select").val();customFieldDetails[customField.labelName]=void 0!==customMappingValue&&"None"!==customMappingValue?customMappingValue:-1}param.customFieldDetails=JSON.stringify(customFieldDetails)}$.post("/timeSheetImport.zp",param,function(resultData){if(cont.find("#importErrDiv").hide(),resultData){var errorcode=resultData.errorCode;if(Layout.Page.container.find("#zp_page_loading").remove(),errorcode){if("TL_9065"===errorcode)return cont.find("#importStep2ConfirmMapping").removeClass("DN").show(),Timetracker.timejobscheduler.jobScheduleConfirm(),cont.find("#imp_mapfield .select2-container").hasClass("blubr")&&cont.find("#imp_mapfield .select2-container").removeClass("blubr").addClass("error-clr"),void(cont.find("#imp_mapvalue .select2-container").hasClass("blubr")&&cont.find("#imp_mapvalue .select2-container").removeClass("blubr").addClass("error-clr"));if("TS_JOBSCHEDULE_001"===errorcode){var error_msg=ZPI18N.getString("zp.jbschimportcountexceederror",["1000"]);return Timetracker.util.showAlert(0,error_msg),$("div#zp_import_container.modal.popRgtModel.in").modal("hide"),void Timetracker.timejobscheduler.showimportfld()}error_msg=Timetracker.Util.getFailureMessageByCode(errorcode),Timetracker.util.showAlert(0,error_msg),$("div#zp_import_container.modal.popRgtModel.in").modal("hide")}else if(0===Object.keys(resultData).length)error_msg=ZPI18N.getString("zp.internalservererror"),Timetracker.util.showAlert(0,error_msg),ZPeople.BSModal.hide("zp_jobSchedule_import_container");else{if(cont.find("#noOfSkip").html(resultData.errorcount),cont.find("#noOfTot").html(resultData.totalcount),resultData.errorcount?cont.find("#noOfAdd").html(resultData.totalcount-resultData.errorcount):(cont.find("#noOfAdd").html(resultData.totalcount),cont.find("#noOfSkip").html("0"),cont.find("#noOfErr").html("0")),resultData.errorcount){var errors,erc=0,keys=new Array;for(var k in resultData.errors)keys.push(k);keys.sort();var len=keys.length;errors+="<tr><th>Key</th><th>"+ZPI18N.getString("zp.error")+"</th></tr>";for(var tempI=0;tempI<len;tempI++){var key=keys[tempI],split=resultData.errors[key].split(":");erc++,errors+="<tr><td>"+split[0]+"</td><td>"+split[1]+"</td></tr>"}cont.find("#importErrDiv").find("tbody").html(errors),Layout.Page.container.find("#zp_page_loading").remove(),cont.find("#importErrDiv").fadeIn(300),cont.find("#noOfErr").html(erc)}Layout.Page.container.find("#zp_page_loading").remove()}}else Layout.Page.container.find("#zp_page_loading").remove(),ZPeople.Message.showFailureMsg(resultData.fail);cont.find("#importStep3").removeClass("DN").fadeIn(300),cont.find("#importStep3").find(".ZPImfrm.ZPRecList").show()}),Layout.Page.container.find("#importStep2ConfirmMapping").removeClass("DN")}},importTemplate:function(){var formObj=$("<form id='jobSchedule_imp_form' action='timeSheetImport.zp?mode=timesheetImportTemplate' method='post' target='exportresp1' style='display:none'/>").html("");formObj.append('<input type="hidden" value="'+csrfToken+'" name="conreqcsr"/>'),formObj.append('<input type="hidden" value="importTTJobSchedule" name="module"/>'),$("body").append(formObj),formObj.trigger("submit")},addJobSchedule:reqObj.addJobSchedule,updateJobSchedule:reqObj.updateJobSchedule,addJobScheduleResponse:resObj.addJobScheduleResponse,updateJobScheduleResponse:resObj.updateJobScheduleResponse,deleteScheduleResponse:function(res,ep){if(Timetracker.util.removeLoading(),resetEmployeeFetch(),res.errorCode){var ecode=res.errorCode,emsg=ZPI18N.getString("zp.jobscherreditmsg");"1021"!=ecode&&"1020"!==ecode||(emsg=ZPI18N.getString("zp.jbshnopermdelete")),ZPeople.Message.showWarningMsg(emsg)}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.jobschdeletemsg")),"1"===calview?getJobScheduleForWeekview():"0"===calview&&getJobScheduleForDayview()},repeatIntervalToggle:repeatIntervalToggle,chooseEditSchedule:function(editJson,ev,th){var empno;"1"===calview?empno=$(th).parent().parent().attr("id").split("_")[0]:"0"===calview&&(empno=$(th).data("empId"));var isEditAllowed=!1;if(Timetracker.isDataAdminForUser(empno)||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit)&&Timetracker.isTTCustomAdminForUser(Timetracker.constants.TTCustomAdmin.EntryEdit,empno))isEditAllowed=!0;else{var currDate=Calendar.getCurrentDate();currDate.setHours(0,0,0,0);var dateid=editJson.date.split(" ")[0],editDate=Calendar.parseDate(dateid,Calendar.DB_DATEFORMAT);editDate.setHours(0,0,0,0),currDate<=editDate&&(isEditAllowed=!0)}editJobScheduleConstruct(editJson,0,th,!(!editJson.repeatId||!isEditAllowed),!isEditAllowed)},scheduleexceptioncallback:resObj.scheduleexceptioncallback,exceptionCommentsCallback:resObj.exceptionCommentsCallback,refreshCallback:resObj.refreshCallback,bulkPublishJobScheduleResponse:resObj.bulkPublishJobScheduleResponse,cloneJobSchedules:function(){ZPeople.BSModal.confirm(Timetracker.timejobscheduler.cloneJobSchedulesCallback,"",ZPI18N.getString("zp.cloneschdconfirmmsg",[ZPI18N.getString("1"===calview?"zp.sweek":"zp.day")]))},cloneJobSchedulesCallback:function(){var startDate,endDate,jobSchObjReq={};if(Layout.Page.container.find("#jobschd_clone").addClass("disabled"),"1"===calview){var previousWeek=Calendar.getPreviousWeek(Timetracker.timejobscheduler.navigateDate);startDate=Timetracker.DateTime.getDateinDBformat(previousWeek.from,!0),endDate=Timetracker.DateTime.getDateinDBformat(previousWeek.to,!0),Calendar.getNextWeek(previousWeek)}else{var previousDay=Calendar.getPreviousDay(Timetracker.timejobscheduler.navigateDate);startDate=Timetracker.DateTime.getDateinDBformat(previousDay.day,!0),endDate=Timetracker.DateTime.getDateinDBformat(previousDay.day,!0),Calendar.getNextDay(previousDay)}var users=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_assignedto").val()),pubStatus=Layout.Page.container.find("#jobsch_pub").val();if(isOrgStructureEnabled){var legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_LegalEntityName").val());legalEntityId="0"!=legalEntityId?legalEntityId.toString():legalEntityId;var businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_BusinessUnitName").val());businessUnitId="0"!=businessUnitId?businessUnitId.toString():businessUnitId;var divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_DivisionName").val());divisionId="0"!=divisionId?divisionId.toString():divisionId}var deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_department").val());deptId="0"!=deptId?deptId.toString():deptId;var designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_designation").val());designationId="0"!=designationId?designationId.toString():designationId;var locationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_location").val());locationId="0"!=location?locationId.toString():locationId;var jobId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_jobName").val())?Layout.Page.container.find("#jobsch_jobName").val():"0",clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_ClientName").val())?Layout.Page.container.find("#jobsch_ClientName").val():"0";jobSchObjReq={mode:"cloneJobSchedule",cloneFromDate:startDate,cloneToDate:endDate,users:users,pubStatus:pubStatus,deptId:deptId,designationId:designationId,jobId:jobId,projectId:Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_projectName").val())?Layout.Page.container.find("#jobsch_projectName").val():"0",locationId:locationId},Timetracker.jobScheduleForm.isClientFilterAllowed()&&(jobSchObjReq.clientId=clientId);var jsonParam={};jsonParam.p=jobSchObjReq,"0"===users&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?jsonParam.p.isDirectSubOnlyNeeded=Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").is(":checked"):jsonParam.p.isDirectSubOnlyNeeded=!1,isOrgStructureEnabled&&(jsonParam.p.divisionId=divisionId,jsonParam.p.businessUnitId=businessUnitId,jsonParam.p.legalEntityId=legalEntityId),jsonParam.ep=jobSchObjReq,jsonParam.fn=Timetracker.timejobscheduler.cloneJobScheduleResponse,Timetracker.util.appendLoading(),reqObj.cloneJobSchedule(jsonParam)},cloneJobScheduleResponse:resObj.cloneJobScheduleResponse,publishSchedules:function(){ZPeople.BSModal.confirm(Timetracker.timejobscheduler.publishSchedulesCallback,"",ZPI18N.getString("zp.pubschdconfirmmsg"))},publishSchedulesCallback:function(){var jobSchObjReq={};if(pub_cache.count>0){var startDate,endDate;"1"===calview?(startDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.from,!0),endDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.to,!0)):(startDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.day,!0),endDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.day,!0));var users=Layout.Page.container.find("#jobsch_assignedto").val()||"0";jobSchObjReq.fromDate=startDate,jobSchObjReq.toDate=endDate,jobSchObjReq.users=users;var deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_department").val());jobSchObjReq.deptId="0"!=deptId?deptId.toString():deptId;var locationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_location").val());jobSchObjReq.locationId="0"!=location?locationId.toString():locationId;var designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_designation").val());if(jobSchObjReq.designationId="0"!=designationId?designationId.toString():designationId,isOrgStructureEnabled){var legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_LegalEntityName").val());jobSchObjReq.legalEntityId="0"!=legalEntityId?legalEntityId.toString():legalEntityId;var businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_BusinessUnitName").val());jobSchObjReq.businessUnitId="0"!=businessUnitId?businessUnitId.toString():businessUnitId;var divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_DivisionName").val());jobSchObjReq.divisionId="0"!=divisionId?divisionId.toString():divisionId}jobSchObjReq.jobId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_jobName").val())?Layout.Page.container.find("#jobsch_jobName").val():"0",Timetracker.jobScheduleForm.isClientFilterAllowed()&&(jobSchObjReq.clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_ClientName").val())?Layout.Page.container.find("#jobsch_ClientName").val():"0"),jobSchObjReq.projectId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_projectName").val())?Layout.Page.container.find("#jobsch_projectName").val():"0","0"===users&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?jobSchObjReq.isDirectSubOnlyNeeded=Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").is(":checked"):jobSchObjReq.isDirectSubOnlyNeeded=!1;var jsonParam={};jsonParam.p=jobSchObjReq,jsonParam.ep=jobSchObjReq,jsonParam.fn=Timetracker.timejobscheduler.bulkPublishJobScheduleResponse,reqObj.bulkPublishJobSchedule(jsonParam)}},changeJobScheduleView:function(selected_view){"day"===selected_view?(calview="0",Layout.Page.container.find("#week_view_jobsch").hide(),Layout.Page.container.find("#day_view_jobsch").show(),Layout.Page.container.find("#view_day").attr("class","active"),Layout.Page.container.find("#view_week").removeClass("active"),Layout.Page.container.find("#jobschd_clone").attr("data-original-title",ZPI18N.getString("zp.clonejobschd",[ZPI18N.getString("zp.cday")])),Layout.Page.container.find(".ZP_JOBSCHD_BAND").remove(),$("#page-wrapper").removeClass("Dbar1")):"week"===selected_view&&(calview="1",Layout.Page.container.find("#week_view_jobsch").show(),Layout.Page.container.find("#day_view_jobsch").hide(),Layout.Page.container.find("#view_week").attr("class","active"),Layout.Page.container.find("#view_day").removeClass("active"),Layout.Page.container.find("#jobschd_clone").attr("data-original-title",ZPI18N.getString("zp.clonejobschd",[ZPI18N.getString("zp.week")]))),constructJobSchedule()},getJobSchedule:function(){ZPeople.isZPNewUI()&&Timetracker.util.isFilterOpen("jbschfilter")&&Timetracker.util.showHideFilters(Layout.Page.container.find("#jobschedule_filter"),"jbschfilter"),resetEmployeeFetch(),"1"===calview?(setWeekLogHeader(),getJobScheduleForWeekview()):"0"===calview&&(setDayLogHeader(),getJobScheduleForDayview())},emp_cache:emp_cache,pub_cache:pub_cache,usersList:[],isAddEditAllowed:isAddEditAllowed,initSchVsWorkedReport:function(){if(isJobScheduleEnabled()){if(Timetracker.initSetup(),Timetracker.timejobscheduler.isschvsworkedhoursdatafetched)ZPComponents.Search.Configuration.JSON.defaultOption=void 0;else{Timetracker.util.setUserErecno(),resetFilterElements();var isClientFilterAllowed=Timetracker.jobScheduleForm.isClientFilterAllowed();isClientFilterAllowed?Layout.Page.container.find("#jschdrClientName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.clientDispName)):Layout.Page.container.find("#jschdrClientName").closest(".col-md-2").addClass("DNI"),Layout.Page.container.find("#jschdrprojectName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.projectDispName)),Layout.Page.container.find("#jschdrjobName").attr("placeholder",ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Timetracker.util.jobDispName));var filterparam=Timetracker.Filters.getParamsForFilter("SchVsWorkedReport");Timetracker.Department.constructDepartmentFilter("jschdrdepartment",filterparam,void 0,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Designation.constructDesignationFilter("jschdrdesignation",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.Location.constructLocationFilter("jschdrlocation",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),isOrgStructureEnabled&&(Timetracker.Division.constructDivisionFilter("jschdrDivision",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.BusinessUnit.constructBusinessUnitFilter("jschdrBusinessUnit",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Timetracker.LegalEntity.constructLegalEntityFilter("jschdrLegalEntity",filterparam,Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#s2id_jschdrLegalEntity,#s2id_jschdrBusinessUnit,#s2id_jschdrDivision").find("input").attr("style","width:150px")),isClientFilterAllowed&&(Timetracker.clients.getClients("jschdrClientName",null,null,!0,Layout.Page.container.find("#jschdrUser").val(),Timetracker.constants.TTCustomAdmin.ReportView),Layout.Page.container.find("#jschdrUser").on("change",function(){Timetracker.clients.getClients("jschdrClientName",null,null,!0,Layout.Page.container.find("#jschdrUser").val(),Timetracker.constants.TTCustomAdmin.ReportView)})),Layout.Page.container.find("#jschdrUser").on("change",function(){"0"===(Layout.Page.container.find("#jschdrUser").val()||"0")&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?(Layout.Page.container.find("#jschdrincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show(),Layout.Page.container.find("#jschdrincludeOnlyDirectSubordinates").prop("checked",!1)):(Layout.Page.container.find("#jschdrincludeOnlyDirectSubordinates").prop("checked",!1),Layout.Page.container.find("#jschdrincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide())}),ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?Layout.Page.container.find("#jschdrincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").show():Layout.Page.container.find("#jschdrincludeOnlyDirectSubordinates").parents(".subOrdinatesCheck").hide(),Layout.Page.container.find("#jschdrEmpStatus").on("change",function(){var empStatus=Layout.Page.container.find("#jschdrEmpStatus").val();0!=empStatus.length&&-1!==empStatus.toString().indexOf("18")?Layout.Page.container.find("#jschdremployeeDateOfExitBased").parents(".dateOfExit").is(":visible")||(Layout.Page.container.find("#jschdremployeeDateOfExitBased").parents(".dateOfExit").show(),Layout.Page.container.find("#jschdremployeeDateOfExitBased").prop("checked",!0)):(Layout.Page.container.find("#jschdremployeeDateOfExitBased").prop("checked",!1),Layout.Page.container.find("#jschdremployeeDateOfExitBased").parents(".dateOfExit").hide())}),Layout.Page.container.find("#jschdrEmpStatus").select2("val",["19","-2","18"]).trigger("change"),Timetracker.projects.Filters.updateProjectListForFilters(!0,Timetracker.timelogs.tserecno,isClientFilterAllowed?$("#jschdrClientName").val():"0","jobSchdReportfilter",void 0,void 0,void 0,Timetracker.constants.TTCustomAdmin.ReportView);var userDtls=ZPeople.getUserDetailsById(Timetracker.timelogs.tserecno);Layout.Page.container.find("#jschdrUserphoto").attr("src",userDtls.avatar),Timetracker.Filters.loadEmployeeType("jschdrEmpType"),Layout.Page.container.find("#s2id_jschdrdepartment,#s2id_jschdrlocation,#s2id_jschdrUser,#s2id_jschdrdesignation,#s2id_jschdrClientName,#s2id_jschdrprojectName,#s2id_jschdrjobName").find("input").attr("style","width:150px")}Timetracker.events.registerEvents(Layout.Page.container.find(".ZP-SwitchViewDiv"),Timetracker.timejobscheduler.switchReportView),Timetracker.util.isFilterOpen()&&Timetracker.util.showHideFilters(Layout.Page.container.find("#show_hide_jobschd_report_filter"),"jobSchdReportfilter"),renderViewBasedReport()}else Timetracker.util.appendPermissionDenied()},getActiveView:getActiveView,getParamsForSummaryReport:getParamsForSummaryReport,getParamsBasedOnView:getParamsBasedOnView,getCallbackBasedOnView:getCallbackBasedOnView,getParamsForDetailedReport:getParamsForDetailedReport,getParamsForJobSchdReport:getParamsForJobSchdReport,generateJobScheduleReport:generateJobScheduleReport,generateJobScheduleDayReportPrevious:function(){Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate=Calendar.getPreviousDay(),renderViewBasedReport(!0)},generateJobScheduleDayReportNext:function(){Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate=Calendar.getNextDay(),renderViewBasedReport(!0)},generateJobScheduleWeekReportPrevious:function(){Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate=Calendar.getPreviousWeek(),renderViewBasedReport(!0)},generateJobScheduleWeekReportNext:function(){Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate=Calendar.getNextWeek(),renderViewBasedReport(!0)},generateJobScheduleMonthReportPrevious:function(){Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate=Calendar.getPreviousMonth(),renderViewBasedReport(!0)},generateJobScheduleMonthReportNext:function(){Timetracker.timejobscheduler.getParamsForJobSchdReport.tmpDate=Calendar.getNextMonth(),renderViewBasedReport(!0)},reportTypechange:function(thisObj){"6"===$(thisObj).val()?(Layout.Page.container.find(".ERR").remove(),ZPeople.isZPNewUI()?Layout.Page.container.find("#jschdrnew_customreportfromtodate").toggle():Layout.Page.container.find("#jschdrcustomreportfromtodate,#periodfilter").toggle(),Timetracker.util.showAdvanced("jobSchdReportfilter","jschdradvanced")):(ZPeople.isZPNewUI()?Layout.Page.container.find("#jschdrnew_customreportfromtodate").hide():Layout.Page.container.find("#jschdrcustomreportfromtodate").hide(),Layout.Page.container.find("#periodfilter").show())},constructJobScheduleReport:function(result,params){if(result.failure)Timetracker.Util.displayFailureMessage(result.message),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6"});else{var jobSchdDiv=Layout.Page.container.find("#jobschdreportdiv_list"),jobDtls=result&&result.jobDtls||{},empDtls=result&&result.empDtls||{};if($(jobSchdDiv).find("#zp_empty_data,#jobschdreporttable,#jobschdreporttable_div").hide(),0===Object.keys(empDtls).length)Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6"});else{var jobSchdHtml="",jobSchdTable=$(jobSchdDiv).find("#jobschdreporttable");jobSchdHtml="",0===jobSchdTable.length&&(jobSchdHtml+='<div class="table-responsive" id="jobschdreporttable_div"><table class="table table-hover table-border Tlis" id="jobschdreporttable" style="display:none"><thead id="jobschd_thead"><tr class="ZPLHRow"><th rowspan="2">'+ZPI18N.getString("zp.employee")+'</th><th rowspan="2"><span class="form_jobname">'+ZPI18N.getString("zp.jobname")+'</th><th rowspan="2">'+ZPI18N.getString("zp.scheduledhours")+'</th><th colspan="2">'+ZPI18N.getString("zp.withintheschd")+'</th><th colspan="2">'+ZPI18N.getString("zp.total")+"</th></tr><tr><th>"+ZPI18N.getString("zp.loggedhrs")+'</th><th data-toggle="tooltip" data-placement="top" data-container="body" title="" data-original-title="'+ZPI18N.getString("zp.actualworkedhours")+" - "+ZPI18N.getString("zp.scheduledhours")+'">'+ZPI18N.getString("zp.deviation")+"</th><th>"+ZPI18N.getString("zp.loggedhrs")+'</th><th data-toggle="tooltip" data-placement="top" data-container="body" title="" data-original-title="'+ZPI18N.getString("zp.loggedhrs")+" - "+ZPI18N.getString("zp.scheduledhours")+'">'+ZPI18N.getString("zp.overtimedeviation")+'</th></tr></thead><tbody id="jobschdreport_tbody"></tbody></table></div>',jobSchdDiv.html($(jobSchdHtml))),jobSchdTable=$(jobSchdDiv).find("#jobschdreport_tbody"),jobSchdHtml=constructJobScheduleReportHtml(empDtls,jobDtls),jobSchdTable.html(jobSchdHtml),$(jobSchdDiv).find("#jobschdreporttable_div,#jobschdreporttable").fadeIn(100)}Timetracker.util.init(),Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.JOB_SCHD_REPORT.SUMMARY),Timetracker.FireScroll.initFireScroll(Timetracker.constants.JOB_SCHD_REPORT.SUMMARY,Timetracker.constants.URL,params,Timetracker.timejobscheduler.loadMoreDataInJobSchdReport),Timetracker.FireScroll.setFetchCount(Timetracker.constants.JOB_SCHD_REPORT.SUMMARY,empDtls)}Timetracker.util.removeLoading()},constructJobSchedDetailedReport:function(result,params){if(result.failure)Timetracker.Util.displayFailureMessage(result.message),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6"});else if(result){var jobSchdDiv=Layout.Page.container.find("#jobschdreportdiv_list"),workDateDtls=result&&result.workDateDtls||{},empDtls=result&&result.empDtls||{};if($(jobSchdDiv).find("#zp_empty_data,#jobschdreporttable,#jobschdreporttable_div").hide(),$(jobSchdDiv).removeClass("section"),0===Object.keys(empDtls).length)Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreportsyet"),{classname:"CR-nodata-rpt",path:"path6"});else{var jobSchdHtml='<div class="RHLtbl RHFixed" style="padding-top: 105px;padding-left: 299px"><div class="table-responsive" id="jobschdreporttable_div" ><table class="table table-hover Tlis" id="jobschdreporttable" style="display:none"><thead staticheader="true" id="jobschd_thead" class="TB_fxd" style="transition: top 0.3s ease 0s !important; left: 499px;"><tr class="ZPLHRow"><th class="FXD_HDR" style="max-width: 300px; width: 300px; height: 106px">'+ZPI18N.getString("zp.employee")+"</th>",fromDate=Calendar.parseDate(params.fromDate,Calendar.DB_DATEFORMAT),toDate=Calendar.parseDate(params.toDate,Calendar.DB_DATEFORMAT),wstime=fromDate.getTime(),weekStarts=new Date;weekStarts.setTime(wstime);for(var dateCnt=0,dateArr=new Array;weekStarts<=toDate;){var date=Timetracker.util.convertDateTo2digit(weekStarts.getDate());dateArr.push(weekStarts.getFullYear()+"-"+Timetracker.util.convertDateTo2digit(weekStarts.getMonth()+1)+"-"+date),jobSchdHtml+='<th class="text-center TBrdr P0I" style="min-width: 291px; max-width: initial;"><table class="table i_table" $TB_FXD_STYLE$><tbody><tr><th colspan="4" class="text-center B1"><span class="DB MB3">'+months[weekStarts.getMonth()]+" "+date+'</span><span class="DB gry S13 ZPregI">'+days[weekStarts.getDay()]+'</span></th></tr><tr><th width=25%><div class="W150"><span class="form_jobname ellipsis">'+ZPI18N.getString("zp.jobname")+'</span></div></th><th class="text-center" width=25%><div class="W120">'+ZPI18N.getString("zp.scheduledhours")+'</div></th><th class="text-center" width=25%><div class="W120">'+ZPI18N.getString("zp.actualworkedhours")+'</div></th><th class="text-center" width=25%  data-toggle="tooltip" data-placement="top" data-container="body" title="" data-original-title="'+ZPI18N.getString("zp.actualworkedhours")+" - "+ZPI18N.getString("zp.scheduledhours")+'"><div class="W120">'+ZPI18N.getString("zp.overtimedeviation")+"</div></th></tr></tbody></table></th>",weekStarts.setDate(weekStarts.getDate()+1),dateCnt++}jobSchdHtml=jobSchdHtml.replace("$TB_FXD_STYLE$",1===dateCnt?'style="table-layout: fixed;"':""),jobSchdHtml+='</thead><tbody id="jobschdreport_tbody">'+constructJobSchedDetailedReportHtml(empDtls,workDateDtls,dateArr)+"</tbody></table></div></div>",jobSchdDiv.html($(jobSchdHtml)),$(jobSchdDiv).find("#jobschdreport_tbody").data("dateArr",dateArr),$(jobSchdDiv).find("#jobschdreporttable_div,#jobschdreporttable").fadeIn(100)}Timetracker.Util.handleTableHeader(),Timetracker.util.init(),Timetracker.FireScroll.resetDataOnLoad(Timetracker.constants.JOB_SCHD_REPORT.DETAILED),Timetracker.FireScroll.initFireScroll(Timetracker.constants.JOB_SCHD_REPORT.DETAILED,Timetracker.constants.URL,params,Timetracker.timejobscheduler.loadMoreDataInJobSchdDtldReport),Timetracker.FireScroll.setFetchCount(Timetracker.constants.JOB_SCHD_REPORT.DETAILED,empDtls)}Timetracker.util.removeLoading()},constructJobScheduleReportHtml:constructJobScheduleReportHtml,constructJobSchedDetailedReportHtml:constructJobSchedDetailedReportHtml,loadMoreDataInJobSchdReport:function(result,params){if(getActiveView()===getViewBasedOnReportType(params.reportType)){var jobDtls=result&&result.jobDtls||{},empDtls=result&&result.empDtls||{};Timetracker.FireScroll.setFetchCount(Timetracker.constants.JOB_SCHD_REPORT.SUMMARY,empDtls);var jobSchdTable=Layout.Page.container.find("#jobschdreport_tbody"),jobSchdHtml=constructJobScheduleReportHtml(empDtls,jobDtls);$(jobSchdTable).append($(jobSchdHtml))}},loadMoreDataInJobSchdDtldReport:function(result,params){if(getActiveView()===getViewBasedOnReportType(params.reportType)){var workDateDtls=result&&result.workDateDtls||{},empDtls=result&&result.empDtls||{};Timetracker.FireScroll.setFetchCount(Timetracker.constants.JOB_SCHD_REPORT.DETAILED,empDtls);var jobSchdTable=Layout.Page.container.find("#jobschdreport_tbody"),jobSchdHtml=constructJobSchedDetailedReportHtml(empDtls,workDateDtls,$(jobSchdTable).data("dateArr"));$(jobSchdTable).append($(jobSchdHtml))}},switchReportView:function(){$(this).addClass("active").siblings().removeClass("active");var activeReport=$(this).attr("value"),reportListDOM=Layout.Page.container.find("#jobschdreportdiv_list");reportListDOM.html(""),activeReport===Timetracker.constants.JOB_SCHD_REPORT.SUMMARY?(Layout.Page.container.find("#jschdrperiod option[value=2]").attr("disabled",!1),Layout.Page.container.find("#jschdrperiod option[value=5]").attr("disabled",!1),Layout.Page.container.find("#jschdrperiod").select2("val","0"),reportListDOM.removeClass("fixTable rpt-tbl")):activeReport===Timetracker.constants.JOB_SCHD_REPORT.DETAILED&&(Layout.Page.container.find("#jschdrperiod option[value=2]").attr("disabled",!0),Layout.Page.container.find("#jschdrperiod option[value=5]").attr("disabled",!0),Layout.Page.container.find("#jschdrperiod").select2("val","0"),reportListDOM.addClass("fixTable tTrckr rpt-tbl")),Timetracker.Search.populateUsers("jschdrUser"),resetFilterElements(),renderViewBasedReport()},renderViewBasedReport:renderViewBasedReport,constructTableForFeeds:function(jobSchdDetails){var html='<div class="zp-feed-table zp_WBN zp_BHC"><table class="table"><tbody>';return $.each(jobSchdDetails,function(index,dtlObj){var jobName=dtlObj.jobName,jobcolor=dtlObj.jobColor,workDate=dtlObj.workDate,fromTime=dtlObj.fromTime,toTime=dtlObj.toTime,desc=dtlObj.desc;if(fromTime&&toTime){var timings="("+fromTime+"-"+toTime+") ";html+="<tr><th>"+ZPI18N.getString("zp.jobname")+'</th><td><div class="ZPLtyp  shift-circle LC'+jobcolor+'"></div>'+jobName+"</td></tr>"}desc?(html+="<tr><th>"+ZPI18N.getString("zp.scheduleddatetime")+"</th><td>"+workDate+" "+timings+"</td></tr>",html+='<tr class="zp_BHCC" style="vertical-align: top;"><th>'+ZPI18N.getString("zp.description")+"</th><td>"+desc+"</td></tr>"):html+='<tr class="zp_BHCC"><th>'+ZPI18N.getString("zp.scheduleddatetime")+"</th><td>"+workDate+" "+timings+"</td></tr>"}),html+="</tbody></table></div>"},downloadJobScheduleReport:function(mode,params,downloadType){params=getParamsBasedOnView(!0);var form=Layout.Page.container.find("form[id=downloadpdf]");$(form).attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+Timetracker.constants.URL+"?mode=exportJobScheduleReport"),$(form).find("input[name=users]").val(params.users),$(form).find("input[name=fromDate]").val(params.fromDate),$(form).find("input[name=toDate]").val(params.toDate),$(form).find("input[name=legalEntityId]").val(params.legalEntityId),$(form).find("input[name=businessUnitId]").val(params.businessUnitId),$(form).find("input[name=divisionId]").val(params.divisionId),$(form).find("input[name=locId]").val(params.locId),$(form).find("input[name=deptId]").val(params.deptId),$(form).find("input[name=projectId]").val(params.projectId),$(form).find("input[name=jobId]").val(params.jobId),$(form).find("input[name=clientId]").val(params.clientId),$(form).find("input[name=designationId]").val(params.designationId),$(form).find("input[name=isDirectSubOnlyNeeded]").val(params.isDirectSubOnlyNeeded),$(form).find("input[name=approvalStatus]").val(params.approvalStatus),$(form).find("input[name=billableStatus]").val(params.billableStatus),$(form).find("input[name=employeeDateOfExitBased]").val(params.employeeDateOfExitBased),$(form).find("input[name=employeeType]").val(params.employeeType?params.employeeType:"0"),$(form).find("input[name=employeeStatus]").val(params.employeeStatus),$(form).find("input[name=reportType]").val(params.reportType),$(form).find("input[name=employeeStatus]").val(params.employeeStatus),$(form).find("input[name=fileType]").val(downloadType),$(form).find("input[name=conreqcsr]").val(csrfToken),"pdf"!=downloadType?Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!1):Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!0),form.trigger("submit")},getViewBasedOnReportType:getViewBasedOnReportType,resetFireScrollBasedOnView:resetFireScrollBasedOnView,downloadJobSchedule:function(mode,params,downloadType){params=function(){var fromDate,toDate,params={},user=Layout.Page.container.find("#jobsch_assignedto").val()||"0";if(Layout.Page.container.find("#jschdWeekReportChanger,#jschdMonthReportChanger").hide(),"1"===calview?(fromDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.from,!0),toDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.to,!0)):(fromDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.day,!0),toDate=Timetracker.timelogs.getDateinDBformat(Timetracker.timejobscheduler.navigateDate.day,!0)),fromDate&&toDate&&(params.fromDate=fromDate,params.toDate=toDate,params.users=user,params.deptId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_department").val()),params.deptId="0"!=params.deptId?params.deptId.toString():params.deptId,params.designationId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_designation").val()),params.designationId="0"!=params.designationId?params.designationId.toString():"0",params.locId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_location").val()),params.locId="0"!=params.locId?params.locId.toString():params.locId,params.jobId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_jobName").val())?Layout.Page.container.find("#jobsch_jobName").val():"0",Timetracker.jobScheduleForm.isClientFilterAllowed()&&(params.clientId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_ClientName").val())?Layout.Page.container.find("#jobsch_ClientName").val():"0"),params.projectId=Timetracker.util.checkIsParamNotEmpty(Layout.Page.container.find("#jobsch_projectName").val())?Layout.Page.container.find("#jobsch_projectName").val():"0",isOrgStructureEnabled&&(params.legalEntityId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_LegalEntityName").val()),params.legalEntityId="0"!=params.legalEntityId?params.legalEntityId.toString():params.legalEntityId,params.businessUnitId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_BusinessUnitName").val()),params.businessUnitId="0"!=params.businessUnitId?params.businessUnitId.toString():params.businessUnitId,params.divisionId=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_DivisionName").val()),params.divisionId="0"!=params.divisionId?params.divisionId.toString():params.divisionId),"0"===user&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?params.isDirectSubOnlyNeeded=Layout.Page.container.find("#jobsch_includeOnlyDirectSubordinates").is(":checked"):params.isDirectSubOnlyNeeded=!1,params.reportType="3"),params.pubStatus=Timetracker.util.getParamValForMultiSelect(Layout.Page.container.find("#jobsch_pub").val()),hasCustomFields()){var customFieldFilters=Layout.Page.container.find(".customFieldFilter");if(customFieldFilters&&0!=customFieldFilters.length){var customFieldDetails={};customFieldFilters.find("select").each(function(){var values=$(this).val();if(values&&values.length>0){var fieldName=$(this).attr("id"),valueList="";for(var itr in values)valueList+=values[itr],itr<values.length-1&&(valueList+=",");customFieldDetails[fieldName]=valueList}}),0!==Object.keys(customFieldDetails).length&&(params.customFieldDetails=JSON.stringify(customFieldDetails))}}return params}();var form=Layout.Page.container.find("form[id=downloadpdf]");$(form).attr("action",(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+Timetracker.constants.URL+"?mode=exportJobScheduleReport"),$(form).find("input[name=users]").val(params.users),$(form).find("input[name=fromDate]").val(params.fromDate),$(form).find("input[name=toDate]").val(params.toDate),$(form).find("input[name=pubStatus]").val(params.pubStatus),$(form).find("input[name=locId]").val(params.locId),$(form).find("input[name=deptId]").val(params.deptId),$(form).find("input[name=projectId]").val(params.projectId),$(form).find("input[name=jobId]").val(params.jobId),$(form).find("input[name=clientId]").val(params.clientId),$(form).find("input[name=designationId]").val(params.designationId),$(form).find("input[name=isDirectSubOnlyNeeded]").val(params.isDirectSubOnlyNeeded),$(form).find("input[name=businessUnitId]").val(params.businessUnitId),$(form).find("input[name=divisionId]").val(params.divisionId),$(form).find("input[name=legalEntityId]").val(params.legalEntityId),$(form).find("input[name=reportType]").val(params.reportType),$(form).find("input[name=recordsExportType]").val($("#recordsExportType").is(":checked")?1:0),$(form).find("input[name=fileType]").val(downloadType),$(form).find("input[name=conreqcsr]").val(csrfToken),$(form).find("#pdfcustomFieldDetails").remove(),void 0!==params.customFieldDetails&&($(form).append('<input type="hidden" name="customFieldDetails" id="pdfcustomFieldDetails"/>'),$(form).find("#pdfcustomFieldDetails").val(params.customFieldDetails)),"pdf"!=downloadType?Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!1):Timetracker.Filters.appendOrRemoveEmpExportDataForForm(form,!0),form.trigger("submit")}}}();var zpTimeTrackerAjq=function(){"use strict";var ajObj=function(){};return ajObj.XHR=function(obj){var sReq=(new Date).getTime(),url=obj.u,params=obj.p||{},rType=obj.t,header={};"get"==rType.toLowerCase()?url=url+(url.indexOf("?")+1?"&":"?")+"xhr="+sReq:obj.h?header={"X-ZCSRF-TOKEN":"conreqcsr="+csrfToken}:params.conreqcsr=csrfToken;var handleResponse=function(rsp,xhr){obj.removeLoader&&obj.removeLoader(),rsp&&obj.fn&&obj.fn(rsp,obj.ep,obj)},mode=url.split("=").pop(),xhrObj={url:url,type:rType,data:$.param(params,!0),dataType:"json",headers:header,success:function(resp,rstatus,xhr){"getJobSchedule"===mode&&(Timetracker.timejobscheduler.isjobscheduledatafetched=!0),handleResponse(resp)},error:function(xhr,rstatus,err){handleResponse(xhr.responseText)}};return $.ajax(xhrObj)},ajObj}();Timetracker.locationjobscheduler={isRefresh:!0,isLocationJobScheduleAllowed:function(){return Timetracker.timejobscheduler.isJobScheduleEnabled()&&Timetracker.generalSettings.isJobProLocApplicableEnabled()},initLoad:function(){Timetracker.locationjobscheduler.isLocationJobScheduleAllowed()?Timetracker.locationjobscheduler.isRefresh&&Timetracker.locationjobscheduler.getJobSchedules():Timetracker.util.appendPermissionDenied()},getJobSchedules:function(){Timetracker.util.appendLoading(),ZPeople.Request.send(Timetracker.constants.URL,{mode:"getLocationJobSchedules",conreqcsr:csrfToken},Timetracker.locationjobscheduler.getJobSchedulesCallback)},getJobSchedulesCallback:function(resultData,params){Timetracker.locationjobscheduler.isRefresh=!1,resultData&&resultData.errorCode&&resultData.errorCode==Timetracker.constants.ERROR_CODES.NO_PERM_CODE?Timetracker.util.appendPermissionDenied():resultData&&resultData.schedules?Timetracker.locationjobscheduler.constructJobSchedulesList(resultData.schedules):Timetracker.util.appendEmptyData(ZPI18N.getString("zp.locjobschdnodata"),{classname:"CR-tt-set-scheduler",path:"path6"}),Timetracker.util.removeLoading()},constructJobSchedulesList:function(resulData){if(0!==(resulData=resulData||[]).length){var locjobschdbody=Layout.Page.container.find("#locjobschd_body"),docFrag=document.createDocumentFragment();$.each(resulData,function(index,data){docFrag.append($(Timetracker.locationjobscheduler.constructJobScheduleListRow(data))[0])}),locjobschdbody.html(""),locjobschdbody.append(docFrag)}else Timetracker.util.appendEmptyData(ZPI18N.getString("zp.locjobschdnodata"),{classname:"CR-tt-set-scheduler",path:"path6"})},constructJobScheduleListRow:function(data){var dom=$('<div class="cntsklst MB10" id="locjobschd'+data.locationId+'"><ul class="cntsklst_lst"><li class="sklst_hd"><div><span class="W80 FL dgry">'+ZPI18N.getString("zp.location")+"</span><b>"+data.locationName+' </b></div></li><li class="actbtn PR W200 FR"><div id="action_button" class="actbtn_ovrly text-center"><i data-toggle="tooltip" data-placement="bottom" title="" class="IC-pen MR10 MT6 dgry CP" data-original-title="'+ZPI18N.getString("zp.edit")+'"></i><i data-toggle="tooltip" data-placement="bottom" title="" class="IC-delete-1px MT6 dgry CP" data-original-title="'+ZPI18N.getString("zp.delete")+'"></i></div><div id="action_confirm_button" class="DN W150 text-right" style="display:none"><input type="button" value="'+ZPI18N.getString("zp.confirm")+'" class="btn btn-danger btn-sm MR10"><input type="button" value="'+ZPI18N.getString("zp.cancel")+'" class="btn btn-default btn-sm"></div><div class="IC-ar-js CP FR"><i id="locjobschdexpnd" class="IC-expnd"></i></div></li></ul></div>');return $(dom).data("schedule",data),$(dom).find("#locjobschdexpnd").on("click",function(){Timetracker.locationjobscheduler.showHideJobScheduleDetails(dom,data)}),$(dom).find(".sklst_hd,.IC-pen").on("click",function(){Timetracker.locationjobscheduler.updateJobSchedule(data)}),$(dom).find("#action_button .IC-delete-1px").on("click",function(){Timetracker.util.showHideConfirmDeleteButtons(this,"action_confirm_button","cntsklst")}),$(dom).find("#action_confirm_button .btn-default").on("click",function(){Timetracker.util.showHideConfirmDeleteButtons(this,"action_button","cntsklst")}),$(dom).find("#action_confirm_button .btn-danger").on("click",function(){$(this).prop("disabled",!0),Timetracker.locationjobscheduler.deleteJobSchedule(data.locationId)}),dom},showHideJobScheduleDetails:function(obj,scheduleData){var locJocSchdObj=$(obj).find("#locjobschds");if(0===locJocSchdObj.length){var docFrag=$('<div class="cntsklst_drp lctnsetng DN" id="locjobschds"><ul><li class="sklst_Score text-center"></li><li class="sklst_hd W300"><span class="dgry form_jobname">'+ZPI18N.getString("zp.jobname")+'</span></li><li class="sklst_weight"><span class="dgry">'+ZPI18N.getString("zp.scheduletimerange")+"</span></li></ul></div>");$.each(scheduleData.schedules,function(index,data){docFrag.append($(Timetracker.locationjobscheduler.constructJobScheduleDetailRow(data))[0])}),obj.append(docFrag),Timetracker.util.init(),locJocSchdObj=$(obj).find("#locjobschds")}locJocSchdObj.slideToggle()},constructJobScheduleDetailRow:function(data){var time,type=data.type;return time=void 0!=type&&0==type?data.hoursInTimeFormat:Calendar.minstotimeFormat(data.fromTimeInMins)+" - "+Calendar.minstotimeFormat(data.toTimeInMins),$('<ul><li class="sklst_Score text-center">'+(data.isBreakJob?'<span class="ICicn I2"><i class="CR-break"></i></span>':'<span class="ICicn I1"><i class="CR-TT"></i></span>')+'</li><li class="sklst_hd W300"><b class="MR5">'+data.jobName+'</b></li><li class="sklst_weight"><span class="S12">'+time+"</span></li></ul>")},constructAddUpdateSchedulePopUp:function(data){var isUpdate=Timetracker.Validations.isDefiniteValue(data),header=ZPI18N.getString("zp.addschedule"),bodyTable='<div class="table-responsive MT35 MB35"><table class="table table-hover table-border borderMe"><thead><tr class="ZPLHRow singluar_name"><th id="thead_locjobschdclientselect"><span class="form_clientname ellipsis text-left">'+ZPI18N.getString("zp.clientname")+'</span></th><th id="thead_locjobschdprojectselect"><span class="form_projectname ellipsis text-left">'+ZPI18N.getString("zp.projectname")+'</span></th><th id="thead_locjobschdjobselect"><span class="form_jobname ellipsis text-left">'+ZPI18N.getString("zp.jobname")+"</span></th><th>"+ZPI18N.getString("zp.scheduletimerange")+'</th><th width="100px"></th></tr></thead><tbody id="locjobschddtl_tbody"></tbody><tbody><tr class="ZPLRow"><th colspan="6" id="add_foot"><div id="locjobschd_addrow_dropdown" class="dropdown PR ZPCusDrs impexp ZPPdrop cust-dm DIB"><a class="blu dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="IC-add blu MR5 S12"></i>'+ZPI18N.getString("zp.addrow")+'</a><ul class="dropdown-menu ZPCmn-Arrow left gray TBDD rt"><li><a class="bluI" id="add_jobschd_row">'+ZPI18N.getString("zp.local.TimeLog")+'</a></li><li><a class="bluI" id="add_breakschd_row">'+ZPI18N.getString("zp.break")+'</a></li></ul></div><a id="locjobschd_addrow" class="blu"><i class="IC-add blu MR5 S12"></i>'+ZPI18N.getString("zp.addrow")+"</a></th></tr></tbody></table></div>",effectiveDate='<div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.local.Effectivedate")+'</label><div class="col-sm-6 PL0"><div class="row form-group MB0I PR"><div class="col-sm-6 btnCal"><input id="locjobschd_from" class="form-control W100I" placeholder="'+ZPI18N.getString("zp.from")+'" type="text"></div><div class="col-sm-6 btnCal"><label class="control-label to-label">-</label><input id="locjobschd_to" class="form-control W100I" placeholder="'+ZPI18N.getString("zp.to")+'" type="text"></div></div></div></div>',body='<div class="form-horizontal pad P20"><div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.location")+'</label><div class="col-sm-4"><select id="locjobsch_location" placeholder ="'+ZPI18N.getString("zp.selectlocation")+'"></select></div></div>'+bodyTable+effectiveDate,modal=ZPeople.BSModal.get({id:"locationJobSchedulePopUp",type:2,header:header,body:body,modalClass:"zp_mdl mdl_Rgt mdl_Rgt-Md",removeModalClass:"modal",headerClass:"zp_mdl-hdr",removeHeaderClass:"modal-header",dialogClass:"zp_mdl-dlg",removeDialogClass:"modal-dialog",contentClass:"zp_mdl-cnt",removeContentClass:"modal-content",bodyClass:"zp_mdl-bdy",removeBodyClass:"modal-body",footerClass:"zp_mdl-ftr",removeFooterClass:"modal-footer",confirmButtonClass:"btn_filled",removeConfirmButtonClass:"btn btn-primary",cancelButtonClass:"btn_lined",removeCancelButtonClass:"btn btn-default",deleteOnHide:!0,closeOnSubmit:!1,buttonValue:isUpdate?ZPI18N.getString("zp.save"):ZPI18N.getString("zp.add"),successCallback:Timetracker.locationjobscheduler.validateAndAddUpdateJobSchedule,hiddenCallback:Timetracker.locationjobscheduler.onAddUpdateJobSchedulePopUpClose,extraDetails:{isUpdate:isUpdate}});Timetracker.Location.constructLocationFilter("locjobsch_location",Timetracker.Filters.getParamsForFilter("LocationJobSchedule"),Timetracker.constants.TTCustomAdmin.EntryView,{defaultOption:{id:"",value:""}}),Timetracker.locationjobscheduler.addUpdateJobScheduleDetailRowActions(modal,isUpdate,data),ZPeople.BSModal.show(modal)},onAddUpdateJobSchedulePopUpClose:function(){Layout.Page.container.find("#locjobschd_add").removeClass("disabled")},addUpdateJobScheduleDetailRowActions:function(modal,isUpdate,data,isFromLocationChange){var locjobschddtl_tbody=modal.find("#locjobschddtl_tbody");if(isUpdate)isFromLocationChange||(modal.find("#locjobsch_location").val(data.locationId).select2(),modal.find("#locjobsch_location").prop("disabled",!0)),Timetracker.locationjobscheduler.setJobScheduleDetailRow(locjobschddtl_tbody,data.locationId,data.schedules),modal.find("#locjobschd_from").val(data.repeatFrom),modal.find("#locjobschd_to").val(data.repeatUntil?data.repeatUntil:""),modal.data("locationschedule",data);else{isFromLocationChange||modal.find("#locjobsch_location").val("").select2();var locationId=modal.find("#locjobsch_location").val();Timetracker.locationjobscheduler.addJobScheduleDetailRow(locjobschddtl_tbody,!1,""!==locationId?locationId:void 0),modal.find("#locjobschd_from").val(""),modal.find("#locjobschd_to").val("")}if(Timetracker.timelogs.showEnabledDayWeekColumns("locjobschd"),!isFromLocationChange){if(Timetracker.generalSettings.isBreakEnabled()){modal.find("#locjobschd_addrow").hide();var dropdwonObj=modal.find("#locjobschd_addrow_dropdown");dropdwonObj.show(),dropdwonObj.find(".dropdown-menu").attr("style","top:-35.75px;left:"+(dropdwonObj.width()+20)+"px")}else modal.find("#locjobschd_addrow").show(),modal.find("#locjobschd_addrow_dropdown").hide();modal.find("#locjobsch_location").on("change",function(){Timetracker.locationjobscheduler.onLocationChange(this,modal)}),modal.find("#add_jobschd_row, #locjobschd_addrow").on("click",function(){var locId=modal.find("#locjobsch_location").val();Timetracker.locationjobscheduler.addJobScheduleDetailRow(locjobschddtl_tbody,!1,""!==locId?locId:"0")}),modal.find("#add_breakschd_row").on("click",function(){var locId=modal.find("#locjobsch_location").val();Timetracker.locationjobscheduler.addJobScheduleDetailRow(locjobschddtl_tbody,!0,""!==locId?locId:"0")}),modal.find("#locjobschd_from, #locjobschd_to").on("click",function(){Calendar.setUpCalendar(event,this)}),Timetracker.util.init()}},addJobScheduleDetailRow:function(locjobschddtl_tbody,isBreakLog,locationId){var lastRowIndex=locjobschddtl_tbody.data("lastRowIndex");void 0===lastRowIndex&&(lastRowIndex=0);var locJobSchdRow='<tr id="locjobschddtlrow'+ ++lastRowIndex+'" class="ZPLRow"><td id="td_locjobschdclientselect" class="DN"><input id="locjobschdclientselect" type="client" class="FL table-select selct-wdth"/></td><td id="td_locjobschdprojectselect" class="DN"><input id="locjobschdprojectselect" type="project" class="FL table-select selct-wdth"/></td><td id="td_locjobschdjobselect"><input id="locjobschdjobselect" type="job" class="FL table-select selct-wdth"/></td><td><div class="W60"><input id="schd_time_'+lastRowIndex+'" class="form-control table-inpt input-bb1" type="text"></div></td><td><div class="over-display"><i id="locjobschddtl_deleterow" class="IC-delete S14 gry FR MR15 CP"></i></div></td></tr>';locjobschddtl_tbody.append($(locJobSchdRow)),locjobschddtl_tbody.find(),locjobschddtl_tbody.find("#schd_time_"+lastRowIndex).on("click",function(){Timetracker.locationjobscheduler.constructBulklogAddEditPopUp(this,isBreakLog)}),1===locjobschddtl_tbody.find("tr.ZPLRow").length?locjobschddtl_tbody.find("tr.ZPLRow").find("#locjobschddtl_deleterow").parent().addClass("DN"):locjobschddtl_tbody.find("#locjobschddtl_deleterow:hidden").parent().removeClass("DN");var currlocJobSchdRow=locjobschddtl_tbody.find("#locjobschddtlrow"+lastRowIndex);currlocJobSchdRow.find("#locjobschddtl_deleterow").on("click",function(){Timetracker.locationjobscheduler.removeJobScheduleDetailRow(currlocJobSchdRow,locjobschddtl_tbody)});var operation="locationjobschedule",id="locjobschd";!0===isBreakLog?(Timetracker.jobs.Filters.getJobs(null,null,operation,currlocJobSchdRow.find("#"+id+"projectselect"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{isBreakLog:!0,locationId:locationId||"0"}),currlocJobSchdRow.find("#td_"+id+"clientselect,#td_"+id+"projectselect").html(""),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&currlocJobSchdRow.find("#td_"+id+"clientselect").show(),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects&&currlocJobSchdRow.find("#td_"+id+"projectselect").show()):("1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&(currlocJobSchdRow.find("#td_"+id+"clientselect").show(),Timetracker.clients.getClients(id+"clientselect","0",currlocJobSchdRow.find("#"+id+"clientselect"),!1,null,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"})),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects?(currlocJobSchdRow.find("#td_"+id+"projectselect").show(),Timetracker.projects.Filters.updateProjectListForFilters(!0,null,currlocJobSchdRow.find("#"+id+"clientselect").val(),operation,null,currlocJobSchdRow.find("#"+id+"projectselect"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"})):Timetracker.jobs.Filters.getJobs(null,null,operation,currlocJobSchdRow.find("#"+id+"projectselect"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"})),currlocJobSchdRow.find("#"+id+"clientselect").on("change",function(){Timetracker.projects.Filters.updateProjectListForFilters(!0,null,this.value,operation,null,currlocJobSchdRow.find("#"+id+"projectselect"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"})}),currlocJobSchdRow.find("#"+id+"projectselect").on("change",function(){Timetracker.jobs.Filters.getJobs(null,null,operation,currlocJobSchdRow.find("#"+id+"projectselect"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"})}),currlocJobSchdRow.find("#"+id+"jobselect").on("change",function(){var jobDataAtIndex,otherdetails={allowAll:!0,isNewKey:!0,skipJobReset:!0,locationId:locationId||"0"};isBreakLog&&(otherdetails.isBreakLog=isBreakLog);var jobIndex=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.jobs.jobData,$(this).val(),"jobId");if(-1!==jobIndex&&void 0!==Timetracker.jobs.jobData[jobIndex]){var jobDataIndex=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.jobs.jobData,$(this).val(),"jobId");jobDataAtIndex=Timetracker.jobs.jobData[jobDataIndex]}else otherdetails.isNewKey=!1;Timetracker.timelogs.setValuesInSelectInput(jobDataAtIndex,null,currlocJobSchdRow.attr("id"),null,otherdetails)}),locjobschddtl_tbody.data("lastRowIndex",lastRowIndex)},setJobScheduleDetailRow:function(locjobschddtl_tbody,locationId,schdArr){$.each(schdArr,function(index,data){var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",data);Timetracker.locationjobscheduler.addJobScheduleDetailRow(locjobschddtl_tbody,isBreakLog,locationId);var lastRowIndex=locjobschddtl_tbody.data("lastRowIndex"),currRow=locjobschddtl_tbody.find("#locjobschddtlrow"+lastRowIndex),otherdetails={isNewKey:!0,allowAll:!0,locationId:locationId};isBreakLog&&(otherdetails.isBreakLog=!0),Timetracker.timelogs.setValuesInSelectInput(data,null,$(currRow).attr("id"),null,otherdetails);var hrsInput=$(currRow).find("[id^=schd_time_]");$(hrsInput).val(data.hoursInTimeFormat),$(hrsInput).attr("logtype",0),1!==data.type&&"1"!==data.type||($(hrsInput).attr("data-placement","top"),$(hrsInput).attr("data-toggle","tooltip"),$(hrsInput).attr("data-original-title",data.fromTimeInTimeFormat+" - "+data.toTimeInTimeFormat),$(hrsInput).attr("fromtime",data.fromTimeInMins),$(hrsInput).attr("totime",data.toTimeInMins),$(hrsInput).attr("logtype",1))})},removeJobScheduleDetailRow:function(obj,locjobschddtl_tbody){$(obj).remove(),1===locjobschddtl_tbody.find("tr.ZPLRow").length&&locjobschddtl_tbody.find("tr.ZPLRow").find("#locjobschddtl_deleterow").parent().addClass("DN")},constructBulklogAddEditPopUp:function(obj,isBreakRow){var bulklog_modal=Layout.Page.container.find("#bulklog_add_edit");if(0===bulklog_modal.length&&(Layout.Page.container.append(Timetracker.timelogs.constructBulklogAddEditPopUpModal()),(bulklog_modal=Layout.Page.container.find("#bulklog_add_edit")).on("shown.bs.modal",function(){bulklog_modal.find("#bulk_timelog_hrstime").focus()})),bulklog_modal.find("#bulk_timelog_fromtime,#bulk_timelog_totime").timepicker({showMeridian:"hh:mm a"==timeFormat,minuteStep:1}),bulklog_modal.find("#bulk_timelog_hrstime").off("keyup").on("keyup",function(){$(this).removeClass("error-clr"),""===$(this).val()||$(this).val().match(Timetracker.util.maxhrsRegex)||$(this).addClass("error-clr")}),bulklog_modal.find("#bulklog_submit").off("click").on("click",function(){Timetracker.locationjobscheduler.submitBulkLogAddEditCallback(bulklog_modal,obj)}),bulklog_modal.find("#bulk_timelog_hrs").parent().show(),bulklog_modal.find("#bulk_timelog_hrs").prop("checked",!0),bulklog_modal.find("#bulk_timelog_hrstime").val(""),bulklog_modal.find("#bulk_timelog_hrs").click(),bulklog_modal.find("#bulk_timelog_fromtime").timepicker("setTime",""),bulklog_modal.find("#bulk_timelog_totime").timepicker("setTime",""),""!==$(obj).val())if($(obj).attr("data-original-title")&&""!==$(obj).attr("data-original-title")){var timeVal=$(obj).attr("data-original-title").split("-");bulklog_modal.find("#bulk_timelog_hrs").prop("checked",!0),bulklog_modal.find("#bulk_timelog_start_end").prop("checked",!1),bulklog_modal.find("#bulk_timelog_start_end").click(),bulklog_modal.find("#bulk_timelog_fromtime").timepicker("setTime",timeVal[0]),bulklog_modal.find("#bulk_timelog_totime").timepicker("setTime",timeVal[1])}else bulklog_modal.find("#bulk_timelog_hrstime").val($(obj).val());isBreakRow&&(bulklog_modal.find("#bulk_timelog_hrs").parent().hide(),bulklog_modal.find("#bulk_timelog_hrs").prop("checked",!1),bulklog_modal.find("#bulk_timelog_start_end").prop("checked",!0),bulklog_modal.find("#bulk_timelog_start_end").click()),Timetracker.locationjobscheduler.setBulklogAddEditPopUpModalPosition(obj,bulklog_modal),bulklog_modal.find("#log_hrs_span").text(""!==$(obj).val()?$(obj).val():"00:00"),bulklog_modal.modal("show")},setBulklogAddEditPopUpModalPosition:function(obj,bulklog_modal){var left=$(obj).offset().left-410,top=33+$(obj).offset().top;$(bulklog_modal).find(".tt_cstpop").attr("style","left: "+left+"px; top: "+top+"px !important")},submitBulkLogAddEditCallback:function(modal,obj){var timelogtype=modal.find("#bulk_timelog_type").find("input[name='timelogTime']:checked").val(),loggedHrs=0;if("0"===timelogtype)modal.find("#bulk_timelog_hrstime").removeClass("error-clr"),loggedHrs=modal.find("#bulk_timelog_hrstime").val(),$(obj).attr("data-placement",""),$(obj).attr("data-toggle",""),$(obj).attr("data-original-title",""),$(obj).attr("fromtime",""),$(obj).attr("totime",""),$(obj).attr("logtype",0);else if("1"===timelogtype){var fromhrstot=Layout.Page.container.find("#bulk_timelog_fromtime").val().trim().split(":"),tohrstot=Layout.Page.container.find("#bulk_timelog_totime").val().trim().split(":");if(fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot),toTime=Timetracker.util.getTotalTimeForHours(tohrstot),isNaN(fromTime)||isNaN(toTime))return;loggedHrs=toTime>=fromTime?toTime-fromTime:toTime+Timetracker.constants.PER_DAY_MIN-fromTime,loggedHrs=Calendar.minstohrs(loggedHrs),$(obj).attr("data-placement","top"),$(obj).attr("data-toggle","tooltip"),$(obj).attr("data-original-title",Layout.Page.container.find("#bulk_timelog_fromtime").val().trim()+" - "+Layout.Page.container.find("#bulk_timelog_totime").val().trim()),$(obj).attr("logtype",1),$(obj).attr("fromtime",Timetracker.util.getTotalTimeForHours(Layout.Page.container.find("#bulk_timelog_fromtime").val().trim().split(":"))),$(obj).attr("totime",Timetracker.util.getTotalTimeForHours(Layout.Page.container.find("#bulk_timelog_totime").val().trim().split(":")))}$(obj).val(loggedHrs),$(obj).removeClass("error-clr")},onLocationChange:function(obj,modal){var locjobschddtl_tbody=modal.find("#locjobschddtl_tbody");locjobschddtl_tbody.html(""),locjobschddtl_tbody.data("");var data=modal.data("locationschedule"),isUpdate=data&&data.locationId==$(obj).val();Timetracker.locationjobscheduler.addUpdateJobScheduleDetailRowActions(modal,isUpdate,isUpdate?data:void 0,!0)},addJobSchedule:function(){Layout.Page.container.find("#locjobschd_add").addClass("disabled"),Timetracker.locationjobscheduler.constructAddUpdateSchedulePopUp()},addJobScheduleCallback:function(result,params){if(Timetracker.util.removeLoading(),result&&result.success){if(ZPeople.Message.showSuccessMsg(result.successMsg),result.schedule){var locjobschdbody=Layout.Page.container.find("#locjobschd_body");0==locjobschdbody.find("div.cntsklst").length&&Timetracker.util.removeEmptyData(),locjobschdbody.append(Timetracker.locationjobscheduler.constructJobScheduleListRow(result.schedule))}}else{if(result&&result.errorCode===Timetracker.constants.ERROR_CODES.JOBSCHEDULE.ER_TS_JOBSCH_LOC_EXISTS&&result.errorMsg){var modal=Layout.Page.container.find("#locationJobSchedulePopUp");return modal.find("#locjobsch_location").parent().append("<div class='error-msg'>"+result.errorMsg+"</div>"),void modal.find("#zp_modal_blubtn").prop("disabled",!1)}Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(void 0,result?{errorMsg:result.errorMsg}:result))}ZPeople.BSModal.hide("locationJobSchedulePopUp")},updateJobSchedule:function(data){Timetracker.locationjobscheduler.constructAddUpdateSchedulePopUp(data)},updateJobScheduleCallback:function(result,params){result&&result.success?(ZPeople.Message.showSuccessMsg(result.successMsg),result.schedule&&Layout.Page.container.find("#locjobschd_body").find("#locjobschd"+result.schedule.locationId).replaceWith(Timetracker.locationjobscheduler.constructJobScheduleListRow(result.schedule))):Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(void 0,result?{errorMsg:result.errorMsg}:result));ZPeople.BSModal.hide("locationJobSchedulePopUp"),Timetracker.util.removeLoading()},validateAndAddUpdateJobSchedule:function(modal){var submitButton=modal.find("#zp_modal_blubtn");submitButton.prop("disabled",!0),Timetracker.util.removeErrorMsg("locationJobSchedulePopUp");var extraDetails=modal.data("extraDetails"),isUpdate=extraDetails&&extraDetails.isUpdate,params={mode:isUpdate?"updateLocationJobSchedule":"addLocationJobSchedule",conreqcsr:csrfToken},locationIdObj=modal.find("#locjobsch_location"),locationId=Timetracker.Validations.isEmpty(locationIdObj.val())?"0":locationIdObj.val();if("0"===locationId)return locationIdObj.parent().find(":first").addClass("error-clr"),void submitButton.prop("disabled",!1);if(!isUpdate&&0!==Layout.Page.container.find("#locjobschd"+locationId).length)return locationIdObj.parent().append("<div class='error-msg'>"+ZPI18N.getString("zp.locschdexistserr")+"</div>"),void submitButton.prop("disabled",!1);params.assignedTo=locationId;var repeatFromObj=modal.find("#locjobschd_from");if(Timetracker.Validations.isEmpty(repeatFromObj.val()))return Timetracker.util.appendErrorMsg({obj:repeatFromObj,msg:ZPI18N.getString("zp.fromdateerr")}),void submitButton.prop("disabled",!1);if(!Timetracker.DateTime.isDate(repeatFromObj.val()))return Timetracker.util.appendErrorMsg({obj:repeatFromObj,msg:ZPI18N.getString("zp.validdateerr")}),void submitButton.prop("disabled",!1);params.repeatFrom=Timetracker.timelogs.getDateinDBformat(Calendar.parseDate(repeatFromObj.val(),uidateFormat),!0);var repeatUntilObj=modal.find("#locjobschd_to");if(!Timetracker.Validations.isEmpty(repeatUntilObj.val())){if(!Timetracker.DateTime.isDate(repeatUntilObj.val()))return Timetracker.util.appendErrorMsg({obj:repeatUntilObj,msg:ZPI18N.getString("zp.validdateerr")}),void submitButton.prop("disabled",!1);if(!Timetracker.DateTime.isValidDateRange(repeatFromObj.val(),repeatUntilObj.val()))return Timetracker.util.appendErrorMsg({obj:repeatUntilObj,msg:ZPI18N.getString("zp.fromtodateerr")}),void submitButton.prop("disabled",!1);params.repeatUntil=Timetracker.timelogs.getDateinDBformat(Calendar.parseDate(repeatUntilObj.val(),uidateFormat),!0)}for(var isError,scheduleArr=new Array,schdRows=modal.find("#locjobschddtl_tbody").find("[id^=locjobschddtlrow]"),i=0;i<schdRows.length;i++){var schdRow=$(schdRows[i]),jobIdObj=schdRow.find("#locjobschdjobselect"),jobId=jobIdObj.val(),timeObj=schdRow.find("[id^=schd_time_]"),type=parseInt($(timeObj).attr("logtype")),hours=$(timeObj).val(),fromTimeVal=$(timeObj).attr("fromtime"),toTimeVal=$(timeObj).attr("totime");if(fromTimeVal=fromTimeVal?parseInt(fromTimeVal):fromTimeVal,toTimeVal=toTimeVal?parseInt(toTimeVal):toTimeVal,!Timetracker.Validations.isEmpty(jobId)&&"0"!==jobId||!Timetracker.Validations.isEmpty(fromTimeVal)||!Timetracker.Validations.isEmpty(toTimeVal)){if(isError=!1,(Timetracker.Validations.isEmpty(jobId)||"0"===jobId)&&(jobIdObj.parent().find(":first").addClass("error-clr"),isError=!0),1==type?""===fromTimeVal||""===toTimeVal?(timeObj.addClass("error-clr"),Timetracker.util.showAlert(1,ZPI18N.getString("zp.entervalidperiod")),isError=!0):hours=toTimeVal>fromTimeVal?toTimeVal-fromTimeVal:toTimeVal-fromTimeVal+1440:hours.match(Timetracker.util.maxWeekHrsRegex)?hours=parseInt(Timetracker.timelogs.convertToMins(hours)):(timeObj.addClass("error-clr"),Timetracker.util.showAlert(1,ZPI18N.getString("zp.entervalidperiod")),isError=!0),isError)return void submitButton.prop("disabled",!1);scheduleArr.push({jobId:jobId,fromTime:fromTimeVal,toTime:toTimeVal,hours:hours,type:type})}}if(0===scheduleArr.length)return modal.find("#locjobschddtl_tbody").find("#td_locjobschdjobselect").find(":first").addClass("error-clr"),void submitButton.prop("disabled",!1);params.schedules=JSON.stringify(scheduleArr),Timetracker.util.appendLoading(null,{type:"popup",containerId:"locationJobSchedulePopUp",containerClass:"zp_mdl-bdy"}),ZPeople.Request.send(Timetracker.constants.URL,params,isUpdate?Timetracker.locationjobscheduler.updateJobScheduleCallback:Timetracker.locationjobscheduler.addJobScheduleCallback)},deleteJobSchedule:function(locationId){Timetracker.util.appendLoading(),ZPeople.Request.send(Timetracker.constants.URL,{mode:"deleteLocationJobSchedule",assignedTo:locationId,conreqcsr:csrfToken},Timetracker.locationjobscheduler.deleteJobScheduleCallback)},deleteJobScheduleCallback:function(resultData,params){resultData&&resultData.success?(ZPeople.Message.showSuccessMsg(resultData.successMsg),Layout.Page.container.find("#locjobschd"+params.assignedTo).remove(),0==Layout.Page.container.find("#locjobschd_body").find("div.cntsklst").length&&Timetracker.util.appendEmptyData(ZPI18N.getString("zp.locjobschdnodata"),{classname:"CR-tt-set-scheduler",path:"path6"})):Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(void 0,resultData?{errorMsg:resultData.errorMsg}:resultData)),Timetracker.util.removeLoading()}},Timetracker.jobScheduleInTimelogsView={JOBSCHEDULE_DETAILS_PRESENTDATE:{},populateJobSchDetailsCache:function(timelogsRes,isReset){Timetracker.timejobscheduler.hasCustomFields()&&(void 0!==isReset&&isReset?0!=Object.keys(Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE).length&&(Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE={}):timelogsRes.hasOwnProperty("idSpecificDtlObj")&&(Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE=timelogsRes.idSpecificDtlObj))},displayCriBriefJobSch:function(){var allowDisp=!1;return Timetracker.timejobscheduler.hasCustomFields()&&Timetracker.timelogs.timeLogAllowedTypes.automaticLog&&erecno===Timetracker.timelogs.tserecno&&(allowDisp=!0),allowDisp},fetchJobschIdCorresJob:function(currSelectObj){var jobId=null!=currSelectObj&&currSelectObj.hasOwnProperty("jobId")?currSelectObj.jobId:null,jschId=null;if(null!=jobId&&0!=Object.keys(Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE).length){var jobSchData=Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE;return $.each(jobSchData,function(indexJschId,jschDtl){jschDtl.jobId==jobId&&(jschId=jschDtl.tschId)}),jschId}},constructBriefJobSch:function(){if(Timetracker.jobScheduleInTimelogsView.displayCriBriefJobSch())if(0!=Object.keys(Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE).length){Timetracker.jobScheduleInTimelogsView.eventHandlingsJobSchDtls("JSCH_BRIEF_LIST","timelogs_list_view"),Timetracker.jobScheduleInTimelogsView.setValuesInTimerBand(jobSchData,!0,{mode:"TIMER_MODE"});var jobSchData=Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE,jobSchDom=Layout.Page.container.find("#tt_jobsch_brief_div");if($.each(jobSchData,function(indexJschId,jschDtl){var fTime=Timetracker.timelogs.minstoTimeMeridian(jschDtl.fromTime),tTime=Timetracker.timelogs.minstoTimeMeridian(jschDtl.toTime),jTxt='<div id="jsch_brief_divs" jschid='+jschDtl.tschId+" jobid="+jschDtl.jobId+' class="tt_rstcnjbs" onclick="Timetracker.jobScheduleInTimelogsView.constructDtlViewJobSch(this);">';jTxt+='<span class="LC'+jschDtl.jobColor+'"></span>',jTxt+="<div><p>"+jschDtl.jobName+"</p><em>"+fTime+"-"+tTime+"</em></div>",jTxt+="</div>",0==jobSchDom.find("[jschid="+jschDtl.tschId+"]").length&&jobSchDom.append(jTxt)}),null!==Timetracker.timelogs.currentTimerJobData){var otherDtls={};otherDtls.runningJobId=Timetracker.timelogs.currentTimerJobData.jobId,Timetracker.jobScheduleInTimelogsView.eventHandlingsJobSchDtls("FREEZE_OTHER_JSCH",null,otherDtls)}}else Timetracker.jobScheduleInTimelogsView.eventHandlingsJobSchDtls("CLR_ALL")},constructDtlViewJobSch:function(currObj){if(0!=Object.keys(Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE).length){var isFromTimerSelect=!(null==currObj||!currObj.hasOwnProperty("isFromTimerSelect"))&&currObj.isFromTimerSelect,jobScheduleId=null,activJschDom=currObj;Layout.Page.container.find(".tt_rstcnjbs").removeClass("activ"),isFromTimerSelect?(jobScheduleId=currObj.jschid,activJschDom=Layout.Page.container.find("div[jschid='"+jobScheduleId+"']")):jobScheduleId=$(currObj).attr("jschid");var jobSchData=Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE.hasOwnProperty(jobScheduleId)?Timetracker.jobScheduleInTimelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE[jobScheduleId]:null;if(null!=jobSchData){var containerId=Layout.Page.container,data={jobId:jobSchData.jobId,jobName:jobSchData.jobName};null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects&&jobSchData.hasOwnProperty("projectId")&&jobSchData.hasOwnProperty("projectName")&&(data.projectId=jobSchData.projectId,data.projectName=jobSchData.projectName),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&jobSchData.hasOwnProperty("clientId")&&jobSchData.hasOwnProperty("clientName")&&(data.clientId=jobSchData.clientId,data.clientName=jobSchData.clientName),Timetracker.timelogs.setValuesInSelectInput(data,"timerLogTime",containerId,null,{allowAll:!0,isNewKey:!0});Timetracker.jobScheduleInTimelogsView.setValuesInTimerBand(jobSchData,!1,{workitem_id:"timertask",desc_id:"timerDesc",billStId:"timerbill",mode:"TIMER_MODE"});var data_customFldDtls=jobSchData.hasOwnProperty("customFieldDetails")?jobSchData.customFieldDetails:null,def_cstmFields=Timetracker.timejobscheduler.getCustomFields();if(void 0!==def_cstmFields){var allowedFileds=Timetracker.jobScheduleForm.fetchAllAllowedFields(jobSchData.assignedTo,Timetracker.constants.VIEW,def_cstmFields);if(!allowedFileds||0==allowedFileds.length)return;Timetracker.jobScheduleInTimelogsView.eventHandlingsJobSchDtls("JSCH_DTL_VIEW","timelogs_list_view");for(var jTxt="",itr=0;itr<def_cstmFields.length;itr++){var cstmFldObj=def_cstmFields[itr],key=cstmFldObj.labelName;if(allowedFileds.includes(key)){var value="-";null!=data_customFldDtls&&0!=Object.keys(data_customFldDtls).length&&(value=data_customFldDtls.hasOwnProperty(key)?data_customFldDtls[key]:"-"),jTxt+='<div class="tt_rstcnrw"><em>'+cstmFldObj.displayName+'</em><b data-placement="top" data-toggle="tooltip" data-original-title="'+value+'">'+value+"</b></div>"}}var schDtlDiv=Layout.Page.container.find("#jsch_dtl_div");0!==schDtlDiv.length&&schDtlDiv.find(".tt_rstcnrw").remove(),schDtlDiv.html(jTxt),$(activJschDom).addClass("activ"),Timetracker.jobScheduleInTimelogsView.eventHandlingsJobSchDtls("EXP_CLS","timelogs_list_view")}}}},setValuesInTimerBand:function(jschData,clrDisabled,idsJson){var workitem=null,desc=null,billableStatus=null,mode=idsJson.mode,billStLayout=null,descLayout=null,populateValues=null==mode||"FORM_EDIT_MODE"!==mode;if(clrDisabled){if(Layout.Page.container.find("#timertask").prop("disabled",!1),Layout.Page.container.find("#timerDesc").prop("disabled",!1),Layout.Page.container.find("#timerDescIcon").hasClass("Tclr"))Layout.Page.container.find("#timerDescIcon").removeClass("Tclr").addClass("gry"),""!==(descTxt=Layout.Page.container.find("#timerDescIcon").data("timerDesc"))&&(Layout.Page.container.find("#descTextArea").val(""),Layout.Page.container.find("#timerDescIcon").data("timerDesc",""));Timetracker.timelogs.registerDescInputDropdown(!0),Layout.Page.container.find("#timerbill").prop("disabled",!1).select2("enable"),void 0!==Layout.Page.container.find("#s2id_timertask").length&&0!==Layout.Page.container.find("#s2id_timertask").length&&Layout.Page.container.find("#timertask").prop("disabled",!1).select2("enable")}if(!clrDisabled&&populateValues){if(jschData.hasOwnProperty("workitem")&&(workitem=jschData.workitem),jschData.hasOwnProperty("desc")&&(desc=jschData.desc),jschData.hasOwnProperty("billableStatus")&&(billableStatus=jschData.billableStatus),null!==workitem&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)){var workItemDomId="TIMER_MODE"===mode?"timertask":Layout.Page.container.find('input[name="Work_Item"]').attr("id"),applyJson=Timetracker.timelogs.checkIfDropDownNeededForWorkitem({jobId:jschData.jobId});if("false"===applyJson.input){var extraJson={};extraJson.layout=Layout.Page.container.find("#"+workItemDomId),extraJson.toAppendOption=ZPeople.decodeTxt(workitem),Timetracker.timelogs.convertResultAndApplyDropdownOfWorkitem(applyJson.data,extraJson),"TIMER_MODE"===mode&&(Layout.Page.container.find("#timertask").hasClass("form-control")&&Layout.Page.container.find("#timertask").removeClass("form-control"),Timetracker.jobs.Filters.gettitle("timertask"))}else Timetracker.timelogs.destroySelect2ApplyInput({eleId:workItemDomId}),workitem=0==workitem.length&&"TIMER_MODE"!==mode?"-":workitem,Layout.Page.container.find("#"+workItemDomId).val(ZPeople.decodeTxt(workitem))}if(null!==desc&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var descTxt=jschData.desc;"TIMER_MODE"===mode?(descLayout=Layout.Page.container.find("#timerDesc"),Layout.Page.container.find("#timerDescInpDiv").hasClass("DN"),Timetracker.timelogs.registerDescViewDropdown(ZPeople.decodeTxt(descTxt)),descLayout.val(ZPeople.decodeTxt(descTxt)),descLayout.prop("disabled",!0)):(descTxt=0==descTxt.length?"-":descTxt,Layout.Page.container.find("textarea[name='Description']").val(ZPeople.decodeTxt(descTxt)),Layout.Page.container.find("textarea[name=Description]").closest(".zp-label").addClass("zp-rdonly"))}if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)){var stVal="-1";stVal=1===billableStatus||"1"===billableStatus?"1":"0","TIMER_MODE"===mode?((billStLayout=Layout.Page.container.find("#timerbill")).val(stVal),billStLayout.select2({minimumResultsForSearch:1/0}),billStLayout.prop("disabled",!0).select2("disable")):(Layout.Page.container.find("select[name=Billable_Status]").prop("disabled",!0).val(stVal).select2(Timetracker.select2.getSelect2Properties()),Layout.Page.container.find("select[name=Billable_Status]").closest(".zp-label").addClass("zp-rdonly"))}}else"FORM_EDIT_MODE"===mode&&(Layout.Page.container.find("select[name=Billable_Status]").prop("disabled",!0),Layout.Page.container.find("textarea[name=Description]").prop("disabled",!0),Layout.Page.container.find("select[name=Billable_Status]").closest(".zp-label").addClass("zp-rdonly"),Layout.Page.container.find("textarea[name=Description]").closest(".zp-label").addClass("zp-rdonly"))},constructJschinTLForm:function(inpFldValuesObj){var tlWorkDate=null,jobId=null,formMode=null!=inpFldValuesObj&&void 0!==inpFldValuesObj&&inpFldValuesObj.hasOwnProperty("formMode")?inpFldValuesObj.formMode:null;if("FORM_VIEW_MODE"===formMode)tlWorkDate=inpFldValuesObj.workDate,jobId=inpFldValuesObj.jobId;else{var inpDate=Layout.Page.container.find("#zp_form_outer_container").find("input[name=Date]").val(),workDate=Calendar.parseDate(inpDate,uidateFormat);tlWorkDate=Timetracker.DateTime.getDateinDBformat(workDate),jobId=Layout.Page.container.find("input[name=JobId]").val()}var erecNo=Timetracker.timelogs.tserecno;if("0"===jobId||void 0==jobId||null==jobId){var schDtlDiv=Layout.Page.container.find("#tlJschViewLst");0!==schDtlDiv.length&&schDtlDiv.remove()}else{var params={mode:"getJobSchedule",fetchTLJobschDtls:!0,conreqcsr:csrfToken,fromDate:tlWorkDate,toDate:tlWorkDate,users:erecNo,jobId:jobId};ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){var layout=Layout.Page.container.find("#zp_addedit_record_"+ZP5Form.getCurrFormsOperation().formId).find("#zp_form_outer_container"),schDtlDiv=Layout.Page.container.find("#tlJschViewLst");if(0!==schDtlDiv.length&&(schDtlDiv.remove(),layout.parents(".PopSgModel").removeClass("lveblePop")),null!=resultData&&0!=Object.keys(resultData).length){var userJschArr=resultData.hasOwnProperty("usersList")?resultData.usersList:null;if(null!=userJschArr&&0!=userJschArr.length&&userJschArr[0].hasOwnProperty("jobschArr")){var jschArr=userJschArr[0].jobschArr;if(0!=jschArr.length){var jschObj=jschArr[0],cstmFldValObj=jschObj.hasOwnProperty("customFieldDetails")?jschObj.customFieldDetails:null,def_cstmFields=Timetracker.timejobscheduler.getCustomFields();if(void 0!==def_cstmFields){var allowedFileds=Timetracker.jobScheduleForm.fetchAllAllowedFields(erecNo,Timetracker.constants.VIEW,def_cstmFields);if(!allowedFileds||0==allowedFileds.length)return;var jTxt='<div  class="lveble tt_restndtls">';jTxt+='<div id="tlJschViewLst" class="lveblelst">',jTxt+='<div class="lveble_txtlst MB10"><span class="lveble_txt"><b>Schedule</b></span></div>';for(var itr=0;itr<def_cstmFields.length;itr++){var cstmFldObj=def_cstmFields[itr],key=cstmFldObj.labelName;if(allowedFileds.includes(key)){var value="-";null!=cstmFldValObj&cstmFldValObj.hasOwnProperty(key)&&(value=cstmFldValObj[key]),jTxt+='<div class="lveble_txtlst"><span class="lveble_txt">'+cstmFldObj.displayName+'</span><span class="lveble_day"><b>'+value+"</b></span></div>"}}jTxt+="</div></div>",$(layout.find(".row").children(".col-sm-6")[0]).after($(jTxt)),layout.parents(".PopSgModel").addClass("lveblePop"),Timetracker.jobScheduleInTimelogsView.setValuesInTimerBand(jschObj,!1,{mode:formMode})}}}}})}},eventHandlingsJobSchDtls:function(mode,viewId,otherDtls){var viewObj=null;if("JSCH_DTL_VIEW"!==mode&&"JSCH_BRIEF_LIST"!==mode&&"EXP_CLS"!==mode||(Timetracker.timelogs.isFromSelfServiceListView()||(viewObj=Layout.Page.container.find("#"+viewId)),Layout.Page.container.find("#tt_jobsch_brief_div").children(".tt_rstcnjbs").hasClass("activ")&&Layout.Page.container.find("#tt_jobsch_outer_div").removeClass("DNI")),"JSCH_DTL_VIEW"===mode)Layout.Page.container.find("#main_jsch_dtl_id").removeClass("DNI"),Timetracker.timelogs.isFromSelfServiceListView()?(Layout.Page.container.find("#timerarea").removeClass("tt_rsbnd"),Layout.Page.container.find("#timerarea").removeClass("tt_rsbndcl"),Layout.Page.container.find("#timerarea").addClass("tt_rsbndex")):viewObj.parents("#page-wrapper").addClass("expnd").removeClass("clps"),Layout.Page.container.find("#jsch_dtl_div").removeClass("DNI"),Layout.Page.container.find("#exp_id").addClass("opn");else if("JSCH_BRIEF_LIST"===mode)if(Layout.Page.container.find("#tt_jobsch_brief_div").removeClass("DNI"),Layout.Page.container.find("#main_jsch_dtl_id").addClass("DNI"),Timetracker.timelogs.isFromSelfServiceListView()){var timerBandDom=Layout.Page.container.find("#timerarea");timerBandDom.removeClass("tt_rsbndex"),timerBandDom.removeClass("tt_rsbndcl"),timerBandDom.addClass("tt_rsbnd")}else viewObj.parents("#page-wrapper").removeClass("expnd").addClass("Rsbar"),viewObj.parents("#page-wrapper").removeClass("clps");else if("EXP_CLS"===mode)Layout.Page.container.find("#exp_id").off("click").on("click",function(e){Timetracker.timelogs.isFromSelfServiceListView()?($(this).toggleClass("opn"),Layout.Page.container.find("#timerarea").toggleClass("tt_rsbndcl"),Layout.Page.container.find("#jsch_dtl_div").toggleClass("DNI")):($(this).toggleClass("opn"),$(this).parents("#page-wrapper").toggleClass("clps"),Layout.Page.container.find("#jsch_dtl_div").toggleClass("DNI"))});else if("BACK_JSCH_BREIF_LIST"===mode){var data=Layout.Page.container.find("#s2id_timerjobs").select2("data");null!==data&&void 0!==data&&"0"===data.id&&Timetracker.jobScheduleInTimelogsView.constructBriefJobSch()}else if("CLR_ALL"===mode)Layout.Page.container.find("#tt_jobsch_brief_div").addClass("DNI"),Layout.Page.container.find("#main_jsch_dtl_id").addClass("DNI"),Layout.Page.container.find("#tt_jobsch_outer_div").addClass("DNI");else if("FREEZE_OTHER_JSCH"===mode){if(otherDtls.hasOwnProperty("runningJobId")){var runningJobId=otherDtls.runningJobId;Layout.Page.container.find("#jsch_brief_divs").addClass("disbl"),Layout.Page.container.find("div[jobid='"+runningJobId+"']").addClass("activ")}}else"CLR_SEL_CLS"===mode&&(Layout.Page.container.find("#tt_jobsch_brief_div").children(".tt_rstcnjbs").removeClass("disbl"),Layout.Page.container.find("#tt_jobsch_brief_div").children(".tt_rstcnjbs").removeClass("activ"),Layout.Page.container.find("#main_jsch_dtl_id").addClass("DNI"),Layout.Page.container.parents("#page-wrapper").removeClass("expnd").addClass("Rsbar"))}},Timetracker.jobScheduleForm={fetchDisplayName:function(labelName){var cstmFields=Timetracker.timejobscheduler.getCustomFields();if(void 0!==cstmFields)for(var itr=0;itr<cstmFields.length;itr++){var cstmFldObj=cstmFields[itr],cstmFldLabelName=cstmFldObj.labelName,cstmFldDispName=cstmFldObj.displayName;if(cstmFldLabelName===labelName)return cstmFldDispName}return""},validateField:function(user,fieldPermissions,action){var permission=fieldPermissions[action],type=action===Timetracker.constants.VIEW?Timetracker.constants.TTCustomAdmin.EntryView:Timetracker.constants.TTCustomAdmin.EntryEdit;return!!(Timetracker.isDataAdminForSpecificUsers&&Timetracker.isDataAdminForUser(user)||Timetracker.isTTCustomAdmin(type)&&Timetracker.isTTCustomAdminForUser(type,user)||"2"==permission&&user===erecno||("1"==permission||"2"==permission)&&user!==erecno&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.includes(user))},fetchAllowedJobSchFields:function(user,action){if(!Timetracker.timejobscheduler.hasFieldPermissions())return null;var fieldPerms=Timetracker.timejobscheduler.getFieldPermissions();if(Timetracker.isDataAdminForAllUsers())return Object.keys(fieldPerms);var jobSchAllowedFields=[];for(var field in fieldPerms)Timetracker.jobScheduleForm.validateField(user,fieldPerms[field],action)&&jobSchAllowedFields.push(field);return jobSchAllowedFields},getFieldPermissionColumns:function(){if(Timetracker.timejobscheduler.hasFieldPermissions()){var fieldPerms=Timetracker.timejobscheduler.getFieldPermissions();return Object.keys(fieldPerms)}return null},fetchAllAllowedFields:function(user,action,customFields){if(!customFields){if(!Timetracker.timejobscheduler.hasCustomFields())return null;customFields=Timetracker.timejobscheduler.getCustomFields()}var allowedFileds=Timetracker.jobScheduleForm.fetchAllowedJobSchFields(user,action)||[],filedsWithPerm=Timetracker.jobScheduleForm.getFieldPermissionColumns()||[];customFields.forEach(customField=>{filedsWithPerm.includes(customField.labelName)||allowedFileds.push(customField.labelName)});return allowedFileds},isClientFieldAllowed:function(user,action){if(!Timetracker.isDataAdminForAllUsers()&&Timetracker.timejobscheduler.hasFieldPermissions()){var fieldPerms=Timetracker.timejobscheduler.getFieldPermissions();return!("Client"in fieldPerms&&!Timetracker.jobScheduleForm.validateField(user,fieldPerms.Client,action))}return!0},isClientFilterAllowed:function(){if(!Timetracker.timejobscheduler.hasFieldPermissions())return!0;var fieldPerms=Timetracker.timejobscheduler.getFieldPermissions();return!(!Timetracker.isDataAdminForAllUsers()&&"Client"in fieldPerms&&"2"!=fieldPerms.Client.view)}},Timetracker.projectDashboard=function(){"use strict";let intiProject=function(project){let container=Layout.Page.container;container.off("scroll").scrollTop(0);let projectId=Layout.Page.urlparam.id;if(!project||!project.isViewAllowed)return Timetracker.util.showAlert(0,ZPI18N.getString("zp.permdenied")),void Timetracker.projectDashboard.URLActions.redirectToBasePage();if(0==container.find("#timetracker-projectdashboard").length){let coverImageClass="zpl_mypro_cvr"+(ZPeople.CURR_USER.userCoverImgId?ZPeople.CURR_USER.userCoverImgId:0),html='<div id="timetracker-projectdashboard" scroll="enabled" class="zpl_container ovh zpl_pgspace"><div class="zpl_iwrpr"><div class="zpl_iwrprrgt"><div class="zpl_act"><div id="baseContainer" class="zpl_mspace_out zpl_mspace-fulwid"><a name="backButton" class="zpl_ibg zpl_myprof-back" title="'+ZPI18N.getString("zp.assessment.goback")+'" data-title-position="right"><i class="PI_back"></i></a><div class="zpl_myprofhd '+coverImageClass+'"><div name="teamProjectsListDiv" class="zpl_myprofhd-acts zpl_DNI"><input id="teamProjectsList" data-width="300"></div></div><div name="dashboardMainContainer" class="zpl_mspace_wrap zpl_projrow"><div class="zpl_myprof-bsinfo"><div><figure><div><div class="zpl_pichr"><span name="projectNameAcronym"></span></div></div><figcaption class="zpl_actovrly"><div class="zpl_em"><div class="zpl_emdts"><div><b name="projectName"></b></div><div><span name="projectStatus"></span></div></div></div><div class="zpl_hvr"><i name="formViewButton" class="PI_eye" title="'+ZPI18N.getString("zp.formview")+'"></i></div></figcaption></figure><div name="projectHeadDiv" class="zpl_mspteams zpl_actovrly"><div name="projectHeadDtls"><div class="zpl_em"><div name="projectHeadImage" class="zpl_emimg"></div><div class="zpl_emdts"><div name="projectHeadName"></div><div><em>'+ZPI18N.getString("zp.projecthead")+'</em></div></div></div><div name="editProjectHead" class="zpl_hvr DNI"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" onclick="Timetracker.projectDashboard.DashboardUsers.changeProjectHead();"></i></div></div><div name="assignProjectHead" class="zpl_flex-center DNI"><div><button class="zlabel zlabel--blue zlabel--outline zlabel--small" data-popup-open="assgnhead" onclick="Timetracker.projectDashboard.DashboardUsers.changeProjectHead();">'+ZPI18N.getString("zp.assignprojecthead")+'</button></div></div></div><div name="clientDtls" class="zpl_mspteams DNI"><div><div class="zpl_ellipsis zpl_em"><div class="zpl_emdts"><div><b name="clientName"></b></div><div><em>'+Timetracker.util.getClientDisplayName(!0)+'</em></div></div></div></div></div><div class="zpl_mspteams"><div class="j-cnt-lft zpl_gap-6"><div name="projectCostDtls" class="zpl_flexcolumngap2 zpl_spltbrdR DNI"><em>'+ZPI18N.getString("zp.local.ProjectCost")+'</em><b name="projectCost"></b></div><div class=" zpl_flexcolumngap2"><em>'+ZPI18N.getString("zp.projectusers")+'</em><b name="projectUserCount"></b></div></div></div></div><div name="descriptionDtls" class="zpl_msplst"><div class="zpl_msp-crdlst zpl_actovrly"><div class="zpl_msp-crdcnt"><div name="editDescription" class="zpl_hvr DNI" onclick="Timetracker.projectDashboard.showDescriptionModal();"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'"></i></div><div class="zpl_msp-lstview"><h5 class="zpl_msp-subhhdr">'+ZPI18N.getString("zp.description")+'</h5><p name="description" style="max-height:60px;overflow:auto;"></p></div></div></div></div></div><section class="mspace_cntwrap"><div class="zpl_myprofcnt"><div class="mspace_actband"><div><ul name="dashboardSubTabs" class="zpl_tabpane"><li name="feeds"><a>'+ZPI18N.getString("zp.feeds")+'</a></li><li name="performance"><a>'+Timetracker.util.getProjectDisplayName(!0)+" "+ZPI18N.getString("zp.performance")+'</a></li><li name="jobs"><a>'+Timetracker.util.getJobDisplayName()+'</a></li><li name="users"><a>'+ZPI18N.getString("zp.users")+'</a></li><li name="attachments"><a>'+ZPI18N.getString("zp.attachments")+'</a></li></ul></div></div><div name="projectDashboardFeedsContainer" class="dataContainer zpl_tabcnt zpl_DNI"></div><div name="projectDashboardPerformanceContainer_1" class="dataContainer zpl_tabcnt zpl_DNI"></div><div name="projectDashboardJobsContainer" class="dataContainer zpl_tabcnt zpl_projspjobs zpl_DNI"></div><div name="projectDashboardUsersContainer" class="dataContainer zpl_tabcnt zpl_projobnav zpl_DNI"><div class="zpl_btnmnu"><div class="zpl_rgt"><ul id="users_header" class="zpl_grpmnu"><li id="userSwitch" class="zpl_act" onclick="Timetracker.projectDashboard.DashboardUsers.switchView(\'user\');" viewType="user">'+ZPI18N.getString("zp.user")+'</li><li id="deptSwitch" onclick="Timetracker.projectDashboard.DashboardUsers.switchView(\'department\');" viewType="department">'+ZPI18N.getString("zp.department")+'</li></ul><button id="addAssignees" class="zlabel zlabel--blue zlabel--medium" onclick="Timetracker.projectDashboard.DashboardUsers.getApplicablelist(true);">'+ZPI18N.getString("zp.mapassignees")+'</button></div></div><div class="zpl_rgtcnt zpl_mdltmvw" id="projectDashboardUsers"><div name="userContainer" class="zpl_emcrdlst"><div id="projectUsersDiv"></div></div><div name="deptContainer" class="zpl_projdptlst zpl_DNI"><div id="projectDeptsDiv" class="zpl_projdpttb"></div></div></div></div><div name="projectDashboardAttachmentsContainer" class="dataContainer zpl_tabcnt zpl_DNI"><div class="zpl_btnmnu zpl_DNI" id="attachments_header"><div class="zpl_rgt"><button class="zlabel zlabel--blue zlabel--medium" id="uploadBtn">'+ZPI18N.getString("zp.upload")+'</button></div></div><div class="zpl_rgtcnt"><div class="zpl_atchd" id="projectAttachmentsDiv"></div></div><div class="content-box zpl_DNI" id="viewDocDiv" style="height:587px; overflow:hidden;"><div class="content-header"><h6 class="addPopTitle" id="viewDocHeader"></h6><button aria-label="Close" data-dismiss="modal" class="close" type="button" onclick="Layout.Page.container.find(\'#freeze\').hide();Layout.Page.container.find(\'#viewDocDiv\').addClass(\'zpl_DNI\');Layout.Page.container.find(\'#iframeContentDiv\').html(\'\');"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div><div class="content-body" id="iframeContentDiv"></div></div><div class="custom-backdrop in" id="freeze" style="display:none"></div><form method="post" id="viewProjectDoc" enctype="multipart/form-data" action="/timesheetDispAction.zp" target="projectDocFrame" novalidate></form></div></div><aside name="projectDashboardPerformanceContainer_2" class="dataContainer zpl_DNI zpl_sidewrap"></aside></section></div></div></div></div></div></div>';Layout.Page.container.append(html)}if(-1!==Layout.Page.hash.indexOf("home/team/projectdashboard"))if(container.find("[name=teamProjectsListDiv]").removeClass("zpl_DNI"),container.find("[name=backButton]").addClass("zpl_DNI"),Timetracker.projects.Team.refreshNeeded()){Timetracker.projects.Team.setRefreshValue(!1),ZPeopleComponents.select(container.find("#teamProjectsList")).destroy();let selectJson={elementId:"teamProjectsList",containerId:Layout.Page.pageId,callbackToFetchOptions:Timetracker.projects.Team.getProjectsList,cacheData:!0},zselectObj=Timetracker.zselect.create(!0,selectJson);void 0!=zselectObj&&Timetracker.projects.Team.getDefaultProjectsList().then(function(projects){if(projects.length>0){Timetracker.Util.showHideNoData({divId:"baseContainer",remove:!0});let currentProjectOption={id:project.projectId,html:project.projectName,text:project.projectName};-1==Timetracker.Util.findJSONArrayIndex(projects,project.projectId,"id")&&projects.push(currentProjectOption),zselectObj.addOption(projects),zselectObj.setValue(currentProjectOption),Timetracker.jobs.Filters.gettitle("teamProjectsList"),container.find("#teamProjectsList").off("zselectchange").on("zselectchange",function(event){let projectId=ZPeopleComponents.select($(this)).getValue(),index=Layout.Page.hash.indexOf(":"),hash=Layout.Page.hash.substring(0,index);window.location.href=hash+":"+projectId})}else Timetracker.Util.showHideNoData({divId:"baseContainer",cls:"zp_nd_permission",msg:ZPI18N.getString("zp.permissiondeniedtoaccessthispage")})})}else ZPeopleComponents.select(container.find("#teamProjectsList")).setValue(project.projectId),Timetracker.jobs.Filters.gettitle("teamProjectsList");else container.find("[name=teamProjectsListDiv]").addClass("zpl_DNI"),container.find("[name=backButton]").removeClass("zpl_DNI"),container.find("[name=backButton]").off().on("click",function(){let url=settingsUrlProps.niceUrl;url=url.startsWith("operations/timetracker/projects/")?"#"+url.slice(0,url.indexOf("projectdashboard"))+"listview":"#"+url.slice(0,url.indexOf("projectdashboard"))+"projects/listview",Timetracker.Page.isSelectedUser()&&(url+="-userId:"+Timetracker.Team.getSelectedUser()),window.location.href=url});if(isProjectChanged(container,projectId)&&loadUnloadTab({isLoaded:!1,projectId:projectId,currentContainerOnly:!0}),container.attr("projectId",projectId),project){Timetracker.projectDashboard.projectDtls=project,DashboardUsers.updateApplicableUsersCache(null,null,!0),setProjectDetails(projectId,project);let baseUrl=Layout.Page.hash.substring(0,Layout.Page.hash.indexOf("-id"));baseUrl=baseUrl.substring(0,baseUrl.lastIndexOf("/"));let restOfTheUrl=Layout.Page.hash.substring(Layout.Page.hash.indexOf("-id"),Layout.Page.hash.length),subTabsContainer=container.find('[name="dashboardSubTabs"]');subTabsContainer.find("li").each(function(element){let subTabUrl=baseUrl+"/"+$(this).attr("name")+restOfTheUrl;$(this).find("a").attr("href",subTabUrl)}),container.find(".dataContainer").not(".zpl_DNI").each(function(index,element){$(element).addClass("zpl_DNI")}),subTabsContainer.find("li.zpl_act").removeClass("zpl_act"),container.find("[name=dashboardMainContainer]").removeClass("zpl_projrgt"),getProjectDtls(Layout.Page.urlparam.id).then(function(data){Timetracker.projectDashboard.projectDtls=data,Timetracker.Page.ProjectDashboard.isFeedsView()?(subTabsContainer.find('[name="feeds"]').addClass("zpl_act"),DashboardFeeds.initDashboardFeeds()):Timetracker.Page.ProjectDashboard.isJobsView()?(subTabsContainer.find('[name="jobs"]').addClass("zpl_act"),DashboardJobs.initDashboardJobs(!0)):Timetracker.Page.ProjectDashboard.isUsersView()?(subTabsContainer.find('[name="users"]').addClass("zpl_act"),DashboardUsers.initDashboardUsers()):Timetracker.Page.ProjectDashboard.isAttachmentsView()?(subTabsContainer.find('[name="attachments"]').addClass("zpl_act"),DashboardAttachments.initDashboardAttachments()):Timetracker.Page.ProjectDashboard.isPerformanceView()&&(subTabsContainer.find('[name="performance"]').addClass("zpl_act"),container.find("[name=dashboardMainContainer]").addClass("zpl_projrgt"),Dashboard.initDashboard())})}};var getProjectDtls=async function(projectId){if(!Timetracker.projectDashboard.projectDtls||projectId!=Timetracker.projectDashboard.projectDtls.projectId){let params={mode:"getProjectDetailsForDashboard",projectId:projectId,conreqcsr:csrfToken};var[result]=await ZPeople.Request.sendRequestAsPromise(Timetracker.constants.URL,params);result.res&&"0"!==result.res?Timetracker.projectDashboard.projectDtls=result.resObj:Timetracker.Request.failureCallback(result.errorCode,result.extraDtls)}return Timetracker.projectDashboard.projectDtls};let isProjectChanged=function(container,currentProjectId){return container.attr("projectId")!=currentProjectId};var setProjectDetails=function(projectId,project){if(project){let container=Layout.Page.container.find("#timetracker-projectdashboard"),projectNameArr=ZPeople.decodeTxt(project.projectName).split(" "),projectNameAcronym=projectNameArr[0].charAt(0);if(projectNameArr.length>1&&/^[a-zA-Z]$/.test(projectNameArr[1].charAt(0))&&(projectNameAcronym+=projectNameArr[1].charAt(0)),container.find('[name="projectNameAcronym"]').html(ZPeople.escapeHtml(projectNameAcronym.toUpperCase())),container.find('[name="projectName"]').html(project.projectName),container.find('[name="projectName"]').parent().attr("title",ZPeople.decodeTxt(project.projectName)),Number(project.projectStatus)?container.find('[name="projectStatus"]').removeClass().addClass("grn").html(ZPI18N.getString("zp.completed")):container.find('[name="projectStatus"]').removeClass().addClass("org").html(ZPI18N.getString("zp.inprogress")),project.projectHeadDtls||Timetracker.projectDashboard.projectDtls.isEditAllowed){container.find('[name="projectHeadDiv"]').removeClass("zpl_DNI"),container.find('[name="projectHeadDtls"]').addClass("DNI"),container.find('[name="assignProjectHead"]').addClass("DNI");let projectHeadDtlsDiv=container.find('[name="projectHeadDtls"]');if(project.projectHeadDtls){let projectHead=project.projectHeadDtls;projectHeadDtlsDiv.find('[name="projectHeadName"]').html("<em>"+projectHead.employeeId+' - <b title="'+projectHead.name+'">'+projectHead.name+"</b>"),projectHeadDtlsDiv.find('[name="projectHeadImage"]').html('<img src="'+projectHead.photo+'">'),Timetracker.projectDashboard.projectDtls.isEditAllowed?projectHeadDtlsDiv.find('[name="editProjectHead"]').removeClass("DNI"):projectHeadDtlsDiv.find('[name="editProjectHead"]').addClass("DNI"),projectHeadDtlsDiv.removeClass("DNI")}else Timetracker.projectDashboard.projectDtls.isEditAllowed&&container.find('[name="assignProjectHead"]').removeClass("DNI")}else container.find('[name="projectHeadDiv"]').addClass("zpl_DNI");Timetracker.projects.formDetails.projectCostFCId&&project.isProjectCostViewAllowed?(container.find('[name="projectCost"]').html(Number(project.projectCost)),container.find('[name="projectCostDtls"]').removeClass("DNI")):container.find('[name="projectCostDtls"]').addClass("DNI"),project.clientName?(container.find('[name="clientName"]').html(project.clientName),container.find('[name="clientName"]').parent().attr("title",ZPeople.decodeTxt(project.clientName)),container.find('[name="clientDtls"]').removeClass("DNI")):container.find('[name="clientDtls"]').addClass("DNI"),setProjectUsersCount(project.projectUsersCount),setProjectDescription(project.projectDescription),container.find('[name="formViewButton"]').off("click").on("click",function(){Timetracker.projects.Operations.formAddEditView(Timetracker.projects.formDetails.formId,projectId,!0)})}};let loadUnloadTab=function(json){let tabName=json.tabName,markTabLoaded=!!json.isLoaded,projectId=json.projectId,updateCurrentContainerOnly=!(!markTabLoaded&&!json.currentContainerOnly),otherContainersOnly=!!json.otherContainersOnly;(updateCurrentContainerOnly?Layout.Page.container.find("[id=timetracker-projectdashboard]"):$("[id=timetracker-projectdashboard]")).each(function(){let container=$(this);if(!updateCurrentContainerOnly){if(container.parent().attr("projectId")!=projectId)return;if(otherContainersOnly){if(container.parent().attr("id")==Layout.Page.pageId)return}}void 0===tabName?container.find(".dataContainer").each(function(){"projectDashboardUsersContainer"===$(this).attr("name")?$(this).find("#projectUsersDiv").attr("loaded",markTabLoaded):$(this).attr("loaded",markTabLoaded)}):"performance"==tabName?container.find("[name=projectDashboardPerformanceContainer_1]").attr("loaded",markTabLoaded):"users"==tabName?container.find("[name=projectDashboardUsersContainer]").find("#projectUsersDiv").attr("loaded",markTabLoaded):"attachments"==tabName&&container.find("[name=projectDashboardAttachmentsContainer]").attr("loaded",markTabLoaded)})},isTabLoaded=function(tabName){let container=Layout.Page.container.find("#timetracker-projectdashboard");return"performance"==tabName?"true"==container.find("[name=projectDashboardPerformanceContainer_1]").attr("loaded"):"users"==tabName?"true"==container.find("[name=projectDashboardUsersContainer]").find("#projectUsersDiv").attr("loaded"):"attachments"==tabName?"true"==container.find("[name=projectDashboardAttachmentsContainer]").attr("loaded"):void 0};var updateProjectUserCache=function(projectId,key){Timetracker.projects.projectUsersArray&&Timetracker.projects.projectUsersArray[projectId]&&(Timetracker.projectDashboard.projectDtls.hasOwnProperty(key)?Timetracker.projects.projectUsersArray[projectId][key]=Timetracker.projectDashboard.projectDtls[key]:delete Timetracker.projects.projectUsersArray[projectId][key])};var resetAndUpdateProjectDtlsCache=async function(projectId,dtlsToBeUpdate,refreshDtls){dtlsToBeUpdate?((refreshDtls=refreshDtls||{}).keepProjectCache=!dtlsToBeUpdate.isUserUpdate,refreshDtls.skipRefreshProjectDashboardDtls=!0,Timetracker.forms.resetFormCache(projectId,Timetracker.constants.PROJECT_TABLE,refreshDtls),$.each(dtlsToBeUpdate,function(key){if("toBeRemoved"==key)$.each(dtlsToBeUpdate.toBeRemoved,function(removeKey,removeVal){removeVal&&""!=removeVal&&Timetracker.projectDashboard.projectDtls.hasOwnProperty(removeKey)?(delete Timetracker.projectDashboard.projectDtls[removeKey][removeVal],Timetracker.Validations.isEmpty(Timetracker.projectDashboard.projectDtls[removeKey])&&delete Timetracker.projectDashboard.projectDtls[removeKey]):delete Timetracker.projectDashboard.projectDtls[removeKey],updateProjectUserCache(projectId,removeKey)});else{if("isUserUpdate"==key)return;Timetracker.projectDashboard.projectDtls[key]=dtlsToBeUpdate[key],dtlsToBeUpdate.isUserUpdate||updateProjectUserCache(projectId,key)}})):(refreshDtls={forceRefreshProjectDashboardDtls:!0},Timetracker.forms.resetFormCache(projectId,Timetracker.constants.PROJECT_TABLE,refreshDtls),await getProjectDtls(projectId))};let setProjectUsersCount=function(projectUsersCount){projectUsersCount=projectUsersCount||(Timetracker.projectDashboard.projectDtls.projectUsersCount?Timetracker.projectDashboard.projectDtls.projectUsersCount:0),Layout.PageUtil.getCurrentContWrap().find('[name="projectUserCount"]').html(projectUsersCount)},setProjectDescription=function(projectDescription){let container=Layout.PageUtil.getCurrentContWrap().find('[name="descriptionDtls"]');if(Timetracker.projects.formDetails.isDescHidden||!projectDescription&&!Timetracker.projectDashboard.projectDtls.isEditAllowed)container.addClass("DNI");else{if(container.removeClass("DNI"),container.find('[name="editDescription"]').addClass("DNI"),projectDescription){let descriptionDiv=container.find('[name="description"]');if(descriptionDiv.html(projectDescription),descriptionDiv[0].scrollHeight>descriptionDiv[0].clientHeight){let tempDescription=projectDescription;for(projectDescription.length>120&&(tempDescription=projectDescription.slice(0,120)),descriptionDiv.html(tempDescription);descriptionDiv[0].scrollHeight>descriptionDiv[0].clientHeight;)tempDescription=tempDescription.slice(0,-1),descriptionDiv.html(tempDescription);tempDescription=tempDescription.slice(0,tempDescription.length-20),tempDescription+=' <a onclick="Timetracker.projectDashboard.showDescriptionModal('+!Timetracker.projectDashboard.projectDtls.isEditAllowed+');">'+ZPI18N.getString("zp.readmore")+"</a>",descriptionDiv.html(tempDescription)}}if(Timetracker.projectDashboard.projectDtls.isEditAllowed&&(container.find('[name="editDescription"]').removeClass("DNI"),!projectDescription||""==projectDescription)){let msg=ZPI18N.getString("zp.prjectdesnodtamsg",['<a onclick="Timetracker.projectDashboard.showDescriptionModal();">'+ZPI18N.getString("zp.here")+"</a>"]);container.find('[name="description"]').html(msg)}}},getFirescrollMode=mode=>Layout.Page.pageId+"_"+mode;var Dashboard={initDashboard:function(){let container1=Layout.Page.container.find("[name=projectDashboardPerformanceContainer_1]"),container2=Layout.Page.container.find("[name=projectDashboardPerformanceContainer_2]");container1.removeClass("zpl_DNI"),container2.removeClass("zpl_DNI"),this.constructHtml(container1,container2),void 0==Timetracker.projectDashboard.projectDtls.clientName||!Timetracker.isDataAdminForAllUsers()&&!Timetracker.projects.Util.isProjectHeadOrManager(Timetracker.projectDashboard.projectDtls.projectId)?(container1.find("#w_billedvsunbilled").addClass("zpl_DNI"),container1.find("#w_jobsvshours").removeClass("zpl_dashcoltwo").addClass("zpl_dashcolthree")):(container1.find("#w_billedvsunbilled").removeClass("zpl_DNI"),container1.find("#w_jobsvshours").removeClass("zpl_dashcolthree").addClass("zpl_dashcoltwo")),container1.off("scroll"),container2.off("scroll");let dashboardTabElement=container1.find("#projectDashboard"),refreshPage=!isTabLoaded("performance");if(!refreshPage&&void 0!==dashboardTabElement.data("cacheDate")){let cacheDate=dashboardTabElement.data("cacheDate");refreshPage=(new Date-cacheDate)/6e4>10}refreshPage&&(container1.scrollTop(0),container2.scrollTop(0),dashboardTabElement.data("cacheDate",new Date),Dashboard.unloadWidgets(),loadUnloadTab({tabName:"performance",isLoaded:!0})),container1.on("scroll",function(){Dashboard.proceedWidgetLoad($(this))}),container2.on("scroll",function(){Dashboard.proceedWidgetLoad($(this))}),refreshPage&&(container1.trigger("scroll"),container2.trigger("scroll"))},constructHtml:function(container1,container2){if(0!=container1.find("#projectDashboard").length)return;var html='<div class="zpl_rgtcnt"><div class="zpl_dashrow" id="projectDashboard" style="overflow:auto;"></div></div>';container1.html(html);let json={className:"zpl_dashcolone",widgetName:"scheduledvsloggedhrs",isMainContainerWidget:!0,headerText:ZPI18N.getString("zp.estimatedhoursvsloggedhours")};html=this.getWidgetHtml(json),json={className:"zpl_dashcolone",widgetName:"billablevsnonbillable",isMainContainerWidget:!0,headerText:ZPI18N.getString("zp.billablevsnonbillable")},html+=this.getWidgetHtml(json),json={className:"zpl_dashcolone",widgetName:"billedvsunbilled",isMainContainerWidget:!0,headerText:ZPI18N.getString("zp.billedvsunbilled")},html+=this.getWidgetHtml(json),json={className:"zpl_dashcolone",widgetName:"pendingvscompleted",isMainContainerWidget:!0,headerText:ZPI18N.getString("zp.inprogressvscompleted",[Timetracker.util.getJobDisplayName()])},html+=this.getWidgetHtml(json),json={className:"zpl_dashcoltwo",widgetName:"jobsvshours",isMainContainerWidget:!0,headerText:ZPI18N.getString("zp.jobsvshours",[Timetracker.util.getJobDisplayName()])},html+=this.getWidgetHtml(json);let bodyHtml='<div class="zpl_tblres zpl_tblfxd"><table class="zpl_tbl zpl_nocrsor" id="table_userjobs"><thead><tr><th>'+ZPI18N.getString("zp.user")+"</th><th>"+ZPI18N.getString("zp.overdue")+"</th><th>"+ZPI18N.getString("zp.inprogress")+"</th><th>"+ZPI18N.getString("zp.completed")+'</th></tr></thead><tbody id="userjobs"></tbody></table></div>';json={className:"zpl_dashcolthree",widgetName:"usersvsjobs",isMainContainerWidget:!0,headerText:ZPI18N.getString("zp.usersvsjobs",[Timetracker.util.getJobDisplayName()]),bodyClass:"zpl_dashfxdtbl",bodyHtml:bodyHtml},html+=this.getWidgetHtml(json),bodyHtml='<div class="zpl_tblres zpl_tblfxd"><table class="zpl_tbl zpl_nocrsor" id="table_userhours"><thead><tr><th>'+ZPI18N.getString("zp.user")+"</th><th>"+ZPI18N.getString("zp.estimatedhours")+"</th><th>"+ZPI18N.getString("zp.loggedhours")+'</th></tr></thead><tbody id="userloggedhours"></tbody></table></div>',json={className:"zpl_dashcolthree",widgetName:"usersvshours",isMainContainerWidget:!0,headerText:ZPI18N.getString("zp.usersvshours"),bodyClass:"zpl_dashfxdtbl",bodyHtml:bodyHtml},html+=this.getWidgetHtml(json),json={className:"zpl_dashcolthree",widgetName:"weeklyLogHours",isMainContainerWidget:!0,headerText:ZPI18N.getString("zp.projectweeklyreport")},html+=this.getWidgetHtml(json),container1.find("#projectDashboard").append(html),json={className:"zpl_msplst",widgetName:"jobsMaxLogHours",headerText:ZPI18N.getString("zp.top5activejobs",[Timetracker.util.getJobDisplayName()]),info:ZPI18N.getString("zp.top5activejobsdescription",[ZPeople.decodeTxt(Timetracker.util.jobDispName)])},html=this.getWidgetHtml(json),json={className:"zpl_msplst",widgetName:"overduejobs",headerText:ZPI18N.getString("zp.tt.overduejobs",[Timetracker.util.getJobDisplayName()]),isScrollableWidget:!0},html+=this.getWidgetHtml(json),json={className:"zpl_msplst",widgetName:"userMaxLogHours",headerText:ZPI18N.getString("zp.top5contributors"),info:ZPI18N.getString("zp.top5contributorsdescription")},html+=this.getWidgetHtml(json),json={className:"zpl_msplst",widgetName:"userMinLogHours",headerText:ZPI18N.getString("zp.least5contributors"),info:ZPI18N.getString("zp.least5contributorsdescription")},html+=this.getWidgetHtml(json),json={className:"zpl_msplst",widgetName:"userMaxJobs",headerText:ZPI18N.getString("zp.top5busybees"),info:ZPI18N.getString("zp.top5busybeesdescription",[ZPeople.decodeTxt(Timetracker.util.getJobDisplayName())])},html+=this.getWidgetHtml(json),container2.append(html)},getWidgetHtml:function(json){let widgetName=json.widgetName,widgetId="w_"+widgetName,info=json.info?json.info:"",headerId="dashhead_"+widgetName,headerText=json.headerText?json.headerText:"",bodyId="dashbody_"+widgetName,bodyClass=json.bodyClass?json.bodyClass:"",bodyHtml=json.bodyHtml?json.bodyHtml:"";if(!!json.isMainContainerWidget&&json.isMainContainerWidget)return'<div class="'+json.className+'" name="widget" id="'+widgetId+'" loaded="false"><div class="zpl_dashcard"><div class="zpl_dashhead"><div><b id="'+headerId+'" title="'+info+'">'+headerText+'</b></div></div><div class="zpl_dashbody '+bodyClass+'" id="'+bodyId+'">'+bodyHtml+"</div></div></div>";{let classList="zpl_msp-crdlst",headerHtml='<b id="'+headerId+'" title="'+info+'">'+headerText+"</b>";return json.isScrollableWidget&&(classList="zpl_msp-crdlst zpl_msp-stkycrd",headerHtml='<div id="'+headerId+'" class="zpl_msp-stkyhdr"><b id="'+headerId+'" title="'+info+'">'+headerText+"</b></div>"),'<div class="'+json.className+'" name="widget" id="'+widgetId+'" loaded="false"><div name="scrollableContent" class="'+classList+'">'+headerHtml+'<div class="zpl_msp-crdcnt"><div id="'+bodyId+'" class="zpl_msp-lstview zpl_msp-cntviwgp"></div></div></div></div>'}},proceedWidgetLoad:function(container){let containerHeight=container.height(),scrolledTopPixels=container.scrollTop(),widgets=container.find('[name="widget"][loaded="false"]');void 0!==widgets&&widgets.each(function(){$(this).offset().top-scrolledTopPixels<=containerHeight+100&&Dashboard.loadWidget(this)})},loadWidget:function(obj){if(!$(obj).is(":hidden")){$(obj).attr("loaded",!0);var widgetId=obj.id;"projectdescription"===widgetId?Dashboard.projectdescription.getDescription():"w_jobsvshours"===widgetId?Dashboard.jobsVsHours.initChart():"w_billedvsunbilled"===widgetId?Dashboard.billedVsUnbilled.initChart():"w_usersvsjobs"===widgetId?Dashboard.userJobs.getUserJobs():"w_pendingvscompleted"===widgetId?Dashboard.pendingVsCompleted.initChart():"w_usersvshours"===widgetId?Dashboard.userLoggedHours.getUserLoggedHours():"w_billablevsnonbillable"===widgetId?Dashboard.billableVsNonBillable.initChart():"w_overduejobs"===widgetId?Dashboard.overDueJobs.getOverDueJobs():"w_scheduledvsloggedhrs"===widgetId?Dashboard.scheduledVsLoggedHrs.initChart():"w_userMaxLogHours"===widgetId?Dashboard.userMaxLogHours.init():"w_userMinLogHours"===widgetId?Dashboard.userMinLogHours.init():"w_jobsMaxLogHours"===widgetId?Dashboard.jobsMaxLogHours.init():"w_userMaxJobs"===widgetId?Dashboard.userMaxJobs.init():"w_weeklyLogHours"===widgetId&&Dashboard.weeklyLogHours.initChart()}},unloadWidgets:function(){let widgets=Layout.Page.container.find("#timetracker-projectdashboard").find('[name="widget"][loaded="true"]');void 0!==widgets&&widgets.each(function(){$(this).attr("loaded",!1)})},jobsVsHours:{initChart:function(){let container=Layout.Page.container.find("#dashbody_jobsvshours");container.find(".zpl_Emptydata").remove(),container.html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getJobs:!0,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){container.find("#zp_page_loading").remove();let dataObj=response.res&&"0"!==response.res?response.resObj:{};if(0==Object.keys(dataObj).length)container.append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nojobsadded",[Timetracker.util.jobDispName])+"</p></div></div>");else{let itr=0,jobNames=[],estimatedHrs=[],loggedHrs=[];$.each(dataObj,function(key,data){jobNames[itr]=ZPeople.decodeTxt(data.jobName),estimatedHrs[itr]=data.estimatedHours/60,loggedHrs[itr]=data.loggedHours/60,itr++});let dataArray=[{name:ZPI18N.getString("zp.estimatedhours"),data:estimatedHrs,color:"#579DE6",states:{hover:{color:"#76C3FC"}}},{name:ZPI18N.getString("zp.loggedhours"),data:loggedHrs,color:"#E4E6E8",states:{hover:{color:"#e7e7e7"}}}],renderTo=Layout.Page.pageId+"_jobsvshours_chart",xAxisMaxPointsOnFocus=3,isScrollNeeded=!0;Object.keys(dataObj).length<=4&&(xAxisMaxPointsOnFocus=Object.keys(dataObj).length-1,isScrollNeeded=!1);let html='<div class="zpl_dashcht"><div class="pie-data" id="'+renderTo+'" style="width: 400px; height: 200px; margin: 10px auto 5px; overflow: hidden;"></div></div>';container.append(html);let chartDetails={renderTo:renderTo,height:250,innerSize:90,barSize:7,dataArray:dataArray,enableLegend:!0,isScrollNeeded:isScrollNeeded,xAxisLabel:jobNames,xAxisMaxPointsOnFocus:xAxisMaxPointsOnFocus,yAxisTitle:ZPI18N.getString("zp.hourslog"),yAxisTickInterval:2};chartDetails.width=container.find(".pie-data").width(),Timetracker.util.constructHighChart(chartDetails)}})}},billedVsUnbilled:{initChart:function(){let container=Layout.Page.container.find("#dashbody_billedvsunbilled");container.find(".zpl_Emptydata").remove(),container.html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getBilledVsUnbilledHrs:!0,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){container.find("#zp_page_loading").remove();let data=1===response.res&&response.resObj.isDataAvailable?response.resObj.dataObj:null;if(null===data)container.append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.notimelogsadded")+"</p></div></div>");else{let renderTo=Layout.Page.pageId+"_billedvsunbilled_chart",centerText=ZPI18N.getString("zp.totalhours")+"<br>"+Calendar.minstohrs(data.billedHours+data.unbilledHours),html='<div class="zpl_dashcht"><div class="pie-data" id="'+renderTo+'" style="width: 170px; height: 250px; margin: 0px auto 5px;"></div></div>';container.append(html);let chartDetails={renderTo:renderTo,width:170,height:250,innerSize:90,centerText:centerText,dataArray:[{name:ZPI18N.getString("zp.billed"),y:data.billedHours,color:"#579DE6",states:{hover:{color:"#76C3FC"}}},{name:ZPI18N.getString("zp.unbilled"),y:data.unbilledHours,color:"#E4E6E8",states:{hover:{color:"#e7e7e7"}}}],enableLegend:!0,dataInMins:!0};Timetracker.util.constructPieChart(chartDetails)}})}},userJobs:{getUserJobs:function(){let container=Layout.Page.container.find("#w_usersvsjobs"),firescrollMode=getFirescrollMode(Timetracker.constants.MODES.PROJECT_DB_USERJOBS);ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),container.find("#dashbody_usersvsjobs").scrollTop(0),container.find(".zpl_Emptydata").remove(),container.find("#dashbody_usersvsjobs").prepend(ZPeople.LOADING_HTML),container.find("#table_userjobs").addClass("zpl_DNI");let params=Dashboard.userJobs.getParamsToFetchGetUserJobs();ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){if(container.find("#zp_page_loading").remove(),resultData.res&&"0"!==resultData.res){container.find("tbody#userjobs").html("");let dataObj=resultData.resObj.dataObj;if(0===Object.keys(dataObj).length)container.find("#dashbody_usersvsjobs").append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nouserassigned")+"</p></div></div>");else{Dashboard.userJobs.constructUserJobsHtml(dataObj),container.find("#table_userjobs").removeClass("zpl_DNI");let firescrollDtls={mode:firescrollMode,scrollDiv:container.find("#dashbody_usersvsjobs")};ZPeople.FireScroll.init(Dashboard.userJobs.loadMoreUserJobs,"",firescrollDtls,!0),ZPeople.FireScroll.setRecordCount(Object.keys(dataObj).length,firescrollMode),Object.keys(dataObj).length===Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(firescrollMode)}}else Timetracker.Util.showAlert(0,Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0))})},loadMoreUserJobs:function(firescrollDtls){let params=Dashboard.userJobs.getParamsToFetchGetUserJobs();params.sIndex=ZPeople.FireScroll.getRecordCount(firescrollDtls.mode)+1,ZPeople.Request.send(Timetracker.constants.URL,params,function(response){let dataObj=1===response.res&&response.resObj.dataObj?response.resObj.dataObj:{};ZPeople.FireScroll.setParam("triggered",!0,firescrollDtls.mode),Object.keys(dataObj).length>0&&(Dashboard.userJobs.constructUserJobsHtml(dataObj),ZPeople.FireScroll.increaseRecordCount(Object.keys(dataObj).length,firescrollDtls.mode),Object.keys(dataObj).length===Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(firescrollDtls.mode))})},constructUserJobsHtml:function(dataObj){if(Object.keys(dataObj).length>0){let bodyLayout=Layout.Page.container.find("#w_usersvsjobs"),htmlTemplate="";for(let key in dataObj)htmlTemplate+='<tr><td><div class="zpl_em"><div class="zpl_emimg"><img src="'+dataObj[key].employeePhoto+'"></div><div class="zpl_emdts zpl_ellipsis"><div><em>'+dataObj[key].employeeId+' - <b title="'+dataObj[key].empName+'">'+dataObj[key].empName+'</b></em></div></div></div></td><td><span class="zpl_lvdrblu">'+dataObj[key].overDueJobs+"</span></td><td><span>"+dataObj[key].inProgressJobs+'</span></td><td><span class="">'+dataObj[key].completedJobs+"</span></td></tr>";bodyLayout.find("tbody#userjobs").append(htmlTemplate)}},getParamsToFetchGetUserJobs:function(){return{mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getUserJobs:!0,sIndex:0,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,conreqcsr:csrfToken}}},pendingVsCompleted:{TOTAL_JOBS:null,initChart:function(){let container=Layout.Page.container.find("#dashbody_pendingvscompleted");container.find(".zpl_Emptydata").remove(),container.html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getSchedule",userErecNo:"0",projectId:Layout.Page.urlparam.id,assignedTo:"0",conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){container.find("#zp_page_loading").remove();let jobsArr=response&&response.schArr?response.schArr:[];if(0===jobsArr.length)Dashboard.pendingVsCompleted.TOTAL_JOBS=null,container.append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nojobsadded",[Timetracker.util.jobDispName])+"</p></div></div>");else{let pendingJobs=0,completedJobs=0;$.each(jobsArr,function(index,data){0===data.jobStatus?pendingJobs++:completedJobs++}),Dashboard.pendingVsCompleted.TOTAL_JOBS=pendingJobs+completedJobs;let renderTo=Layout.Page.pageId+"_pendingvscompleted_chart",centerText=ZPI18N.getString("zp.total")+"<br>"+Dashboard.pendingVsCompleted.TOTAL_JOBS,html='<div class="Cht"><div class="pie-data" id="'+renderTo+'" style="width: 170px; height: 250px; margin:0px auto 5px;"></div></div>';container.append(html);let chartDetails={renderTo:renderTo,width:170,height:250,innerSize:90,centerText:centerText,dataArray:[{name:ZPI18N.getString("zp.inprogress"),y:pendingJobs,color:"#579DE6",states:{hover:{color:"#76C3FC"}}},{name:ZPI18N.getString("zp.completed"),y:completedJobs,color:"#E4E6E8",states:{hover:{color:"#e7e7e7"}}}],enableLegend:!0,legendOnClickCallback:Timetracker.projectDashboard.Dashboard.pendingVsCompleted.legendOnClickCallback};Timetracker.util.constructPieChart(chartDetails)}})},legendOnClickCallback:function(legendObj){legendObj.visible?Dashboard.pendingVsCompleted.TOTAL_JOBS-=legendObj.y:Dashboard.pendingVsCompleted.TOTAL_JOBS+=legendObj.y;let renderedId=Layout.Page.pageId+"_pendingvscompleted_chart";Layout.Page.container.find("#"+renderedId).highcharts().setTitle({text:ZPI18N.getString("zp.total")+"<br>"+Dashboard.pendingVsCompleted.TOTAL_JOBS})}},userLoggedHours:{getUserLoggedHours:function(){let container=Layout.Page.container.find("#w_usersvshours"),firescrollMode=getFirescrollMode(Timetracker.constants.MODES.PROJECT_DB_LOGHRS);ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),container.find("#dashbody_usersvshours").scrollTop(0),container.find(".zpl_Emptydata").remove(),container.find("#dashbody_usersvshours").prepend(ZPeople.LOADING_HTML),container.find("#table_userhours").addClass("zpl_DNI");let params=Dashboard.userLoggedHours.getParamsToFetchGetUserLoggedHours();$.post(Timetracker.constants.URL,params,function(resultData){if(container.find("#zp_page_loading").remove(),resultData.res){container.find("tbody#userloggedhours").html("");let dataObj=1===resultData.res&&resultData.resObj.dataObj?resultData.resObj.dataObj:{};if(0===Object.keys(dataObj).length)container.find("#dashbody_usersvshours").append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nouserassigned")+"</p></div></div>");else{Dashboard.userLoggedHours.constructUserLoggedHoursHtml(dataObj),container.find("#table_userhours").removeClass("zpl_DNI");let firescrollDtls={mode:firescrollMode,scrollDiv:container.find("#dashbody_usersvshours")};ZPeople.FireScroll.init(Dashboard.userLoggedHours.loadMoreUserLoggedHours,"",firescrollDtls,!0),ZPeople.FireScroll.setRecordCount(Object.keys(dataObj).length,firescrollMode),Object.keys(dataObj).length===Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(firescrollMode)}}else Timetracker.Util.showAlert(0,Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0))})},loadMoreUserLoggedHours:function(firescrollDtls){let params=Dashboard.userLoggedHours.getParamsToFetchGetUserLoggedHours();params.sIndex=ZPeople.FireScroll.getRecordCount(firescrollDtls.mode)+1,ZPeople.Request.send(Timetracker.constants.URL,params,function(response){let dataObj=1===response.res&&response.resObj.dataObj?response.resObj.dataObj:{};ZPeople.FireScroll.setParam("triggered",!0,firescrollDtls.mode),Object.keys(dataObj).length>0&&(Dashboard.userLoggedHours.constructUserLoggedHoursHtml(dataObj),ZPeople.FireScroll.increaseRecordCount(Object.keys(dataObj).length,firescrollDtls.mode),Object.keys(dataObj).length===Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(firescrollDtls.mode))})},constructUserLoggedHoursHtml:function(dataObj){if(Object.keys(dataObj).length>0){let bodyLayout=Layout.Page.container.find("#w_usersvshours"),htmlTemplate="";for(let key in dataObj)htmlTemplate+='<tr><td><div class="zpl_em"><div class="zpl_emimg"><img src="'+dataObj[key].employeePhoto+'"></div><div class="zpl_emdts zpl_ellipsis"><div><em>'+dataObj[key].employeeId+' - <b title="'+dataObj[key].empName+'">'+dataObj[key].empName+"</b></em></div></div></div></td><td><span>"+Calendar.minstohrs(dataObj[key].estimatedHours)+" "+ZPI18N.getString("zp.hrs")+"</span></td><td><span>"+Calendar.minstohrs(dataObj[key].loggedHours)+" "+ZPI18N.getString("zp.hrs")+"</span></td></tr>";bodyLayout.find("tbody#userloggedhours").append(htmlTemplate)}},getParamsToFetchGetUserLoggedHours:function(){return{mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getUserLoggedHrs:!0,sIndex:0,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,conreqcsr:csrfToken}}},billableVsNonBillable:{TOTAL_HOURS:null,initChart:function(){let container=Layout.Page.container.find("#dashbody_billablevsnonbillable");container.find(".zpl_Emptydata").remove(),container.html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getBillableVsNonBillableHrs:!0,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){let data=1===response.res&&response.resObj.isDataAvailable?response.resObj.dataObj:null;if(container.find("#zp_page_loading").remove(),null===data)Dashboard.billableVsNonBillable.TOTAL_HOURS=null,container.append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.notimelogsadded")+"</p></div></div>");else{Dashboard.billableVsNonBillable.TOTAL_HOURS=data.billableHours+data.nonBillableHours;let renderTo=Layout.Page.pageId+"_billablevsnonbillable_chart",centerText=ZPI18N.getString("zp.totalhours")+"<br>"+Calendar.minstohrs(Dashboard.billableVsNonBillable.TOTAL_HOURS),html='<div class="zpl_dashcht"><div class="pie-data" id="'+renderTo+'" style="width: 170px; height: 250px; margin: 0px auto 5px;"></div></div>';container.append(html);let chartDetails={renderTo:renderTo,width:170,height:250,innerSize:90,centerText:centerText,dataArray:[{name:ZPI18N.getString("zp.billable"),y:data.billableHours,color:"#579DE6",states:{hover:{color:"#76C3FC"}}},{name:ZPI18N.getString("zp.nonbillable"),y:data.nonBillableHours,color:"#E4E6E8",states:{hover:{color:"#e7e7e7"}}}],enableLegend:!0,legendOnClickCallback:Timetracker.projectDashboard.Dashboard.billableVsNonBillable.legendOnClickCallback,dataInMins:!0};Timetracker.util.constructPieChart(chartDetails)}})},legendOnClickCallback:function(legendObj){legendObj.visible?Dashboard.billableVsNonBillable.TOTAL_HOURS-=legendObj.y:Dashboard.billableVsNonBillable.TOTAL_HOURS+=legendObj.y;let renderedId=Layout.Page.pageId+"_billablevsnonbillable_chart";Layout.Page.container.find("#"+renderedId).highcharts().setTitle({text:ZPI18N.getString("zp.totalhours")+"<br>"+Calendar.minstohrs(Dashboard.billableVsNonBillable.TOTAL_HOURS)})}},overDueJobs:{getOverDueJobs:function(){let container=Layout.Page.container.find("#w_overduejobs"),firescrollMode=getFirescrollMode(Timetracker.constants.MODES.PROJECT_DB_OVERDUEDAYS);ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),container.find("[name=scrollableContent]").scrollTop(0),container.find(".zpl_Emptydata").remove(),container.find("#dashbody_overduejobs").html("").prepend(ZPeople.LOADING_HTML);let params=Dashboard.overDueJobs.getParamsToFetchOverDueJobs();$.post(Timetracker.constants.URL,params,function(resultData){container.find("#zp_page_loading").remove();let resArr=resultData&&resultData.schArr?resultData.schArr:[];if(0==resArr.length)container.find("#dashbody_overduejobs").append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nooverduejobs",[Timetracker.util.jobDispName])+"</p></div></div>");else{Dashboard.overDueJobs.constructOverDueJobsHtml(resArr);let firescrollDtls={mode:firescrollMode,scrollDiv:container.find("[name=scrollableContent]")};ZPeople.FireScroll.init(Dashboard.overDueJobs.loadMoreOverDueJobs,"",firescrollDtls,!0),ZPeople.FireScroll.setRecordCount(resArr.length,firescrollMode),resArr.length===Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(firescrollMode)}})},loadMoreOverDueJobs:function(firescrollDtls){let params=Dashboard.overDueJobs.getParamsToFetchOverDueJobs();params.sIndex=ZPeople.FireScroll.getRecordCount(firescrollDtls.mode)+1,ZPeople.Request.send(Timetracker.constants.URL,params,function(response){let resArr=response&&response.schArr?response.schArr:[];ZPeople.FireScroll.setParam("triggered",!0,firescrollDtls.mode),resArr.length>0&&(Dashboard.overDueJobs.constructOverDueJobsHtml(resArr),ZPeople.FireScroll.increaseRecordCount(resArr.length,firescrollDtls.mode),resArr.length==Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(firescrollDtls.mode))})},constructOverDueJobsHtml:function(resArr){if(resArr.length>0){let container=Layout.Page.container.find("#w_overduejobs"),htmlTemplate="";for(let i=0;i<resArr.length;i++)htmlTemplate+="<div><span>"+resArr[i].jobName+"</span><div><em>"+ZPI18N.getString("zp.lms.overdueby")+' : </em><span class="red">'+resArr[i].overDueDays+" "+ZPI18N.getString("zp.leavetype.smalldays")+"</span></div></div>";container.find("#dashbody_overduejobs").append(htmlTemplate)}},getParamsToFetchOverDueJobs:function(){return{mode:"getSchedule",jobStatus:"0",projectId:Layout.Page.urlparam.id,assignedTo:"0",fetchLoggedHrs:!0,overDueJobParams:JSON.stringify({fetchOverdueJobs:!0}),sIndex:0,limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,conreqcsr:csrfToken}}},userMaxLogHours:{init:function(){let container=Layout.Page.container.find("#w_userMaxLogHours");container.find(".zpl_Emptydata").remove(),container.find("#dashbody_userMaxLogHours").html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getContributors:!0,sortAscending:!1,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response.res&&"0"!==response.res)if(container.find("#zp_page_loading").remove(),0===response.resArr.length)container.find("#dashbody_userMaxLogHours").append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nouserswithtimelogs")+"</p></div></div>");else{let htmlTemplate="",resArr=response.resArr;for(let key=0;key<resArr.length;key++)htmlTemplate+='<div class="zpl_em"><div class="zpl_emimg"><img src="'+resArr[key].employeePhoto+'"></div><div class="zpl_emdts"><div><em>'+resArr[key].employeeId+' - </em><b title="'+resArr[key].empName+'">'+resArr[key].empName+"</b></div><div><em>"+ZPI18N.getString("zp.loggedhours")+" : </em><span>"+Calendar.minstohrs(resArr[key].totalHours)+" "+ZPI18N.getString("zp.hrs")+"</span></div></div></div>";container.find("#dashbody_userMaxLogHours").append(htmlTemplate)}else Timetracker.util.showAlert(0,Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0))})}},userMinLogHours:{init:function(){let container=Layout.Page.container.find("#w_userMinLogHours");container.find(".zpl_Emptydata").remove(),container.find("#dashbody_userMinLogHours").html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getContributors:!0,sortAscending:!0,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response.res&&"0"!==response.res)if(container.find("#zp_page_loading").remove(),0===response.resArr.length)container.find("#dashbody_userMinLogHours").append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nouserassigned")+"</p></div></div>");else{let htmlTemplate="",resArr=response.resArr;for(let key=0;key<resArr.length;key++)htmlTemplate+='<div class="zpl_em"><div class="zpl_emimg"><img src="'+resArr[key].employeePhoto+'"></div><div class="zpl_emdts"><div><em>'+resArr[key].employeeId+' - </em><b title="'+resArr[key].empName+'">'+resArr[key].empName+"</b></div><div><em>"+ZPI18N.getString("zp.loggedhours")+" : </em><span>"+Calendar.minstohrs(resArr[key].totalHours)+" "+ZPI18N.getString("zp.hrs")+"</span></div></div></div>";container.find("#dashbody_userMinLogHours").append(htmlTemplate)}else Timetracker.util.showAlert(0,Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0))})}},jobsMaxLogHours:{init:function(){let container=Layout.Page.container.find("#w_jobsMaxLogHours");container.find(".zpl_Emptydata").remove(),container.find("#dashbody_jobsMaxLogHours").html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getJobsWithMaxLoggedHours:!0,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response.res&&"0"!==response.res)if(container.find("#zp_page_loading").remove(),0===response.resArr.length)container.find("#dashbody_jobsMaxLogHours").append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nojobswithtimelogs",[Timetracker.util.getJobDisplayName()])+"</p></div></div>");else{let htmlTemplate="",resArr=response.resArr;for(let i=0;i<resArr.length;i++)htmlTemplate+='<div class=""><span>'+resArr[i].jobName+"</span><div><em>"+ZPI18N.getString("zp.loggedhrs")+" : </em><span>"+Calendar.minstohrs(resArr[i].totalHours)+"</span></div></div>";container.find("#dashbody_jobsMaxLogHours").append(htmlTemplate)}else Timetracker.util.showAlert(0,Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0))})}},userMaxJobs:{init:function(){let container=Layout.Page.container.find("#w_userMaxJobs");container.find(".zpl_Emptydata").remove(),container.find("#dashbody_userMaxJobs").html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getUsersWithMaxCompletedJobs:!0,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response.res&&"0"!==response.res)if(container.find("#zp_page_loading").remove(),0===response.resArr.length)container.find("#dashbody_userMaxJobs").append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nouserswithcompletedjobs",[Timetracker.util.getJobDisplayName()])+"</p></div></div>");else{let htmlTemplate="",resArr=response.resArr;for(let key=0;key<resArr.length;key++)htmlTemplate+='<div class="zpl_em"><div class="zpl_emimg"><img src="'+resArr[key].employeePhoto+'"></div><div class="zpl_emdts"><div><em>'+resArr[key].employeeId+' - </em><b title="'+resArr[key].empName+'">'+resArr[key].empName+"</b></div><div><em>"+ZPI18N.getString("zp.tt.jobscompleted",[Timetracker.util.getJobDisplayName()])+" : </em><span>"+resArr[key].totalJobsCompleted+" "+ZPI18N.getString("zp.hrs")+"</span></div></div></div>";container.find("#dashbody_userMaxJobs").append(htmlTemplate)}else Timetracker.util.showAlert(0,Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0))})}},weeklyLogHours:{initChart:function(){let container=Layout.Page.container.find("#w_weeklyLogHours");container.find(".zpl_Emptydata").remove(),container.find("#dashbody_weeklyLogHours").html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getWeeklyTimesheetReport:!0,conreqcsr:csrfToken},currentWeek=Calendar.getCurrentWeek();params.fromDate=Calendar.formatDate(currentWeek.from),params.toDate=Calendar.formatDate(currentWeek.to),ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response.res&&"0"!==response.res){let resObj=response.resObj;if(container.find("#zp_page_loading").remove(),0===Object.keys(resObj).length)container.find("#dashbody_weeklyLogHours").append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.notimelogsaddedfortheweek")+"</p></div></div>");else{let daysArr=[],xAxisLabel=[],currentWeekDays=Calendar.getCurrentWeekdays();$.each(currentWeekDays,function(index,day){let currentDay=day.getDate();currentDay=currentDay<=9?"0"+currentDay:""+currentDay;let currentMonth=day.getMonth();currentMonth=(currentMonth+=1)<=9?"0"+currentMonth:""+currentMonth;let dateInGeneralFormat=day.getFullYear()+"-"+currentMonth+"-"+currentDay;daysArr.push(dateInGeneralFormat),xAxisLabel.push(days[day.getDay()]+"<br>"+months[day.getMonth()]+" "+day.getFullYear())});let loggedHrs=[];for(let i=0;i<daysArr.length;i++)daysArr[i]in resObj?loggedHrs[i]=resObj[daysArr[i]]/60:loggedHrs[i]=0;let dataArray=[{name:ZPI18N.getString("zp.loggedhours"),data:loggedHrs,color:"#579DE6",states:{hover:{color:"#76C3FC"}}}],renderTo=Layout.Page.pageId+"_weeklyLogHours_chart",html='<div class="Cht"><div class="pie-data" id="'+renderTo+'" style="width: 100%; height: 250px; padding-left: 20px; padding-right: 20px;"></div></div>';container.find("#dashbody_weeklyLogHours").append(html);let chartDetails={renderTo:renderTo,height:250,innerSize:90,barSize:7,dataArray:dataArray,enableLegend:!1,xAxisLabel:xAxisLabel,xAxisTitle:ZPI18N.getString("zp.wfdays"),xAxisMaxPointsOnFocus:6,yAxisTitle:ZPI18N.getString("zp.loggedhours"),yAxisTickInterval:2};chartDetails.width=container.find(".pie-data").width(),Timetracker.util.constructHighChart(chartDetails)}}else Timetracker.util.showAlert(0,Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0))})}},scheduledVsLoggedHrs:{initChart:function(){let container=Layout.Page.container.find("#dashbody_scheduledvsloggedhrs");container.find(".zpl_Emptydata").remove(),container.html("").prepend(ZPeople.LOADING_HTML);let params={mode:"getDataForProjectDashboard",projectId:Layout.Page.urlparam.id,getEstimatedVsLoggedHrs:!0,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){let data=1===response.res&&response.resObj.isDataAvailable?response.resObj.dataObj:null;if(container.find("#zp_page_loading").remove(),null==data)container.append('<div class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.noestimatedandloggedhours",[Timetracker.util.jobDispName])+"</p></div></div>");else{let renderTo=Layout.Page.pageId+"_scheduledvsloggedhrs_chart",html='<div class="Cht"><div class="pie-data" id="'+renderTo+'" style="width: 170px; height: 250px; margin:0px auto 5px;"></div></div>';container.append(html);let chartDetails={renderTo:renderTo,width:170,height:250,innerSize:0,dataArray:[{name:ZPI18N.getString("zp.estimated"),y:data.estimatedHours,color:"#579DE6",states:{hover:{color:"#76C3FC"}}},{name:ZPI18N.getString("zp.logged"),y:data.loggedHours,color:"#E4E6E8",states:{hover:{color:"#e7e7e7"}}}],enableLegend:!0,dataInMins:!0};Timetracker.util.constructPieChart(chartDetails)}})}}},DashboardUsers={applicableUserFetchDelay:void 0,APPLICABLE_USERS_LIST:null,APPLICABLE_USERS_SEARCH_LIST:{},APPLICABLE_USERS_FIRESCROLL_LIMIT:200,initDashboardUsers:function(){let container=Layout.Page.container.find('[name="projectDashboardUsersContainer"]');container.find("#users_header").addClass("zpl_DNI"),container.find("#addAssignees").addClass("zpl_DNI"),Timetracker.isDataAdminForAllUsers()&&container.find("#users_header").removeClass("zpl_DNI"),Timetracker.projectDashboard.projectDtls.isEditAllowed&&container.find("#addAssignees").removeClass("zpl_DNI"),container.removeClass("zpl_DNI"),Timetracker.projectDashboard.DashboardUsers.switchView(Timetracker.constants.USER)},getCurrentView:function(){return Timetracker.Util.getLayout().find("[name=userContainer]").hasClass("zpl_DNI")?Timetracker.constants.DEPARTMENT:Timetracker.constants.USER},switchView:function(entity,makeRequest){let layout=Layout.Page.container.find("[name=projectDashboardUsersContainer]"),currView=layout.find("#users_header").find(".zpl_act").attr("viewType");if(makeRequest=makeRequest||!isTabLoaded("users"),entity!=currView||makeRequest)if(layout.find("#projectDashboardUsers").find("#zp_empty_data").remove(),entity===Timetracker.constants.USER){layout.find("#deptSwitch").removeClass("zpl_act"),layout.find("#userSwitch").addClass("zpl_act"),layout.find("#addAssignees").html(ZPI18N.getString("zp.mapassignees")),layout.find("[name=userContainer]").removeClass("zpl_DNI"),layout.find("[name=deptContainer]").addClass("zpl_DNI");let firescrollMode=getFirescrollMode(Timetracker.constants.MODES.PROJECT_DB_USERS);if(!ZPeople.FireScroll.getFireScrollPropertie(firescrollMode).triggered?(ZPeople.FireScroll.setParam("triggered",!0,firescrollMode),layout.find("[name=userContainer]").scrollTop(0),ZPeople.FireScroll.setParam("triggered",!1,firescrollMode)):layout.find("[name=userContainer]").scrollTop(0),makeRequest){loadUnloadTab({tabName:"users",isLoaded:!0}),Timetracker.util.appendLoading({layout:layout.find("#projectDashboardUsers")}),layout.find("#projectUsersDiv").html(""),ZPeople.FireScroll.setParam("triggered",!0,firescrollMode);let params={mode:"getProjectUsers",projectId:Layout.Page.urlparam.id,getEmpDetails:!0,getAttendanceStatus:!0,sIndex:0,limit:200},requestParams={};requestParams.url=Timetracker.constants.URL,requestParams.params=params,requestParams.callback=Timetracker.projectDashboard.DashboardUsers.constructDashboardUsers,Timetracker.Request.send(requestParams)}else if(0==layout.find("#projectUsersDiv").children().length){let msg=ZPI18N.getString("zp.noassignedentitycurrently",[ZPI18N.getString("zp.small.users")]);msg+=Timetracker.projectDashboard.projectDtls.isEditAllowed?ZPI18N.getString("zp.clickassignentityadd",[ZPI18N.getString("zp.users"),ZPI18N.getString("zp.small.users"),Timetracker.util.getProjectDisplayName(!0)]):"",Timetracker.Util.showHideNoData({msg:msg,appendToDiv:!0,layout:layout.find("#projectDashboardUsers")})}}else if(entity===Timetracker.constants.DEPARTMENT){layout.find("#userSwitch").removeClass("zpl_act"),layout.find("#deptSwitch").addClass("zpl_act"),layout.find("#addAssignees").html(ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.departments")])),layout.find("[name=deptContainer]").removeClass("zpl_DNI"),layout.find("[name=userContainer]").addClass("zpl_DNI"),layout.find("[name=deptContainer]").off("scroll").scrollTop(0),Timetracker.util.appendLoading({layout:layout.find("#projectDashboardUsers")}),layout.find("#projectDeptsDiv").html("");let depts=Timetracker.projectDashboard.projectDtls.projectDepts?Timetracker.projectDashboard.projectDtls.projectDepts:{};Timetracker.projectDashboard.DashboardUsers.constructDashboardDepts(depts)}},constructDashboardDepts:function(depts){let container=Layout.Page.container.find("#projectDashboardUsers"),projectDeptsDiv=container.find("#projectDeptsDiv");projectDeptsDiv.html("");let showNoData=!0;if(Object.keys(depts).length>0&&(showNoData=!1,$.each(depts,function(key,data){projectDeptsDiv.append(DashboardUsers.getDashboardUsersHtml(void 0,data))})),showNoData){let msg=ZPI18N.getString("zp.noassignedentitycurrently",[ZPI18N.getString("zp.departmentssmall")]);msg+=ZPI18N.getString("zp.clickassignentityadd",[ZPI18N.getString("zp.departments"),ZPI18N.getString("zp.departmentssmall"),Timetracker.util.getProjectDisplayName(!0)]),Timetracker.Util.showHideNoData({msg:msg,appendToDiv:!0,layout:container})}Timetracker.util.removeLoading(container)},constructDashboardUsers:function(response,params){let container=Layout.Page.container.find("[name=userContainer]"),projectUsersDiv=container.find("#projectUsersDiv");if(response.res&&"0"!==response.res){let showNoData=!0;if(response.resArr.length>0){showNoData=!1;for(let itr in response.resArr){let userDiv=DashboardUsers.getDashboardUsersHtml(response.resArr[itr]);projectUsersDiv.append(userDiv)}let firescrollMode=getFirescrollMode(Timetracker.constants.MODES.PROJECT_DB_USERS),firescrollDtls={mode:firescrollMode,scrollDiv:container,params:params};ZPeople.FireScroll.init(Timetracker.projectDashboard.DashboardUsers.loadMoreUsers,"",firescrollDtls,!0),ZPeople.FireScroll.setRecordCount(response.resArr.length,firescrollMode),200==response.resArr.length&&ZPeople.FireScroll.reset(firescrollMode)}if(showNoData){let msg=ZPI18N.getString("zp.noassignedentitycurrently",[ZPI18N.getString("zp.small.users")]);msg+=Timetracker.projectDashboard.projectDtls.isEditAllowed?ZPI18N.getString("zp.clickassignentityadd",[ZPI18N.getString("zp.users"),ZPI18N.getString("zp.small.users"),Timetracker.util.getProjectDisplayName(!0)]):"",Timetracker.Util.showHideNoData({msg:msg,appendToDiv:!0,layout:container.parent()})}}else Timetracker.Request.failureCallback(response.errorCode,response.extraDtls);Timetracker.util.removeLoading(container.parent())},getDashboardUsersHtml:function(userDtls,deptDtls){if(userDtls){let isProjectHead=userDtls.role===Timetracker.constants.PROJECT_ROLES.HEAD,isShowEditOption=Timetracker.projectDashboard.projectDtls.isEditAllowed,isShowEditOptionOtherthanPH=!isProjectHead&&isShowEditOption,userROle=userDtls.role===Timetracker.constants.PROJECT_ROLES.MANAGER?ZPI18N.getString("zp.local.Manager"):userDtls.role==Timetracker.constants.PROJECT_ROLES.HEAD?ZPI18N.getString("zp.projecthead"):ZPI18N.getString("zp.user");var element='<div class="zpl_dfcrd zpl_tmusrcrd zpl_cpd" id="'+userDtls.erecno+'" userErecNo="'+userDtls.erecno+'"><div class="zpl_emcrdcnt"><div class="zpl_em"><div class="zpl_emimg zpl_smvw"><img src="'+userDtls.photo+'"></div><div class="zpl_emdts zpl_ellipsis"><div class="">'+userDtls.employeeId+' - <b title="'+userDtls.name+'">'+userDtls.name+"</b></div><div><em>"+(userDtls.email?userDtls.email:"")+"</em></div>";userDtls.leaveAttStat&&(element+='<div><span class="'+Attendance.setClassToShowStatus(userDtls.colourCode)+'">'+userDtls.leaveAttStat+"</span></div>");let disbaledRPH=void 0===userDtls.ratePerHour,userRate=disbaledRPH?"":userDtls.ratePerHour||"0";if(element+="</div>"+("true"==ZPeople.ISCHAT&&userDtls.isCommunicationApplicable&&userDtls.zuid!=_LOGGEDIN_ZUID?'<div class="MLauto d-flexclm4 zpl_hvr zpl_hvrsw"><i class="PI_pharw" chat_comm="true" tabindex="0" uid="'+userDtls.zuid+'"></i></div>':"")+(isShowEditOptionOtherthanPH?'<div class="zpl_hvr zpl_projusrsrmv"><i class="PI_delete" title="'+ZPI18N.getString("zp.remove")+'" onclick="Timetracker.projectDashboard.DashboardUsers.removeApplicableConfirmPopup(this,\'user\');" userErecNo="'+userDtls.erecno+'"></i></div>':"")+'</div><div class="zpl_empTmInfo"><div class="zpl_flex-a-c zpl_flexgap1"><em>'+ZPI18N.getString("zp.role")+"</em>"+(isShowEditOptionOtherthanPH?'<select name="userRoleSelect" userErecNo="'+userDtls.erecno+'" role="'+userDtls.role+'" class="w100"><option value="0">'+ZPI18N.getString("zp.user")+'</option><option value="1">'+ZPI18N.getString("zp.local.Manager")+"</option></select>":"<span>"+userROle+"</span>")+'</div><div class="zpl_flex-a-c zpl_flexgap1">',disbaledRPH||(element+="<em>"+ZPI18N.getString("zp.rateperhour")+"</em>",element+=isShowEditOption?'<input type="text" id="userRatePerHour" userErecNo="'+userDtls.erecno+'" role="'+userDtls.role+'" ratePerHour="'+userRate+'" value="'+userRate+'" title="'+(userDtls.ratePerHour||"")+'"'+(disbaledRPH?"disabled=disabled":"")+' class="ztextbox w60">':'<span class="w60">'+userRate+"</span>"),element+="</div></div></div></div>",element=$(element),isShowEditOption){var userRatePerHour=element.find('input[id="userRatePerHour"]');userRatePerHour.off("keyup").on("keyup",function(){var userRate=$(this).val();""===userRate||Timetracker.Validations.isDecimal(userRate)?$(this).removeClass("ztextbox__error"):$(this).addClass("ztextbox__error"),$(this).attr("title",userRate)}),userRatePerHour.off("focusout").on("focusout",function(){var currentRatePerHour=$(this).attr("ratePerHour"),newRatePerHour=$(this).val();if(""===newRatePerHour&&(newRatePerHour="0",$(this).val("0")),newRatePerHour=""===newRatePerHour?"0":newRatePerHour,Timetracker.Validations.isDecimal(newRatePerHour)){if(Number(newRatePerHour)===Number(currentRatePerHour))return;$(this).addClass("disabled"),Timetracker.projectDashboard.DashboardUsers.updateUsers(userDtls.erecno,void 0,newRatePerHour)}})}if(isShowEditOptionOtherthanPH){var userRoleSelect=element.find('select[name="userRoleSelect"]');TimelyZComp.select.intialize(userRoleSelect),TimelyZComp.select.setValue(userRoleSelect,userDtls.role),userRoleSelect.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var currentRole=$(this).attr("role"),newRole=TimelyZComp.select.getValue($(this));currentRole!==newRole&&(TimelyZComp.select.setAttributes($(this),{disabled:!0}),Timetracker.projectDashboard.DashboardUsers.updateUsers(userDtls.erecno,newRole))}})}}else element='<div id="'+deptDtls.recID+'"><div class="zpl_Fldtl" title="'+deptDtls.recName+'"><h5>'+deptDtls.recName+'</h5></div><div class="zpl_actn"><span><i class="PI_delete" title="'+ZPI18N.getString("zp.remove")+'" deptId="'+deptDtls.recID+'" onclick="Timetracker.projectDashboard.DashboardUsers.removeApplicableConfirmPopup(this,\'dept\');"></i></span></div></div>',element=$(element);return element},loadMoreUsers:function(firescrollDtls){let params=firescrollDtls.params;params.sIndex=ZPeople.FireScroll.getRecordCount(firescrollDtls.mode)+1,ZPeople.Request.send(Timetracker.constants.URL,params,function(response){ZPeople.FireScroll.setParam("triggered",!0,firescrollDtls.mode);let container=Layout.Page.container.find("#projectUsersDiv"),resArr=1===response.res?response.resArr:[];if(resArr.length>0){for(let itr in resArr){let userDiv=DashboardUsers.getDashboardUsersHtml(resArr[itr]);container.append(userDiv)}ZPeople.FireScroll.increaseRecordCount(resArr.length,firescrollDtls.mode),200===resArr.length&&ZPeople.FireScroll.reset(firescrollDtls.mode)}})},removeApplicableConfirmPopup:function(ele,type){var projDispName=Timetracker.util.getProjectDisplayName(!0,!0);if("dept"==type){var deptId=$(ele).attr("deptId"),extraDtls={header:ZPI18N.getString("zp.common.entityremove",[ZPI18N.getString("zp.departmentsmall")]),body:ZPI18N.getString("zp.projectapplicableremove",[ZPI18N.getString("zp.departmentsmall"),projDispName]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(deptId,Timetracker.projectDashboard.DashboardUsers.removeUsers,deptId,0,extraDtls)}else if("user"==type){var eno=$(ele).attr("userErecNo");extraDtls={header:ZPI18N.getString("zp.common.entityremove",[ZPI18N.getString("zp.suser")]),body:ZPI18N.getString("zp.projectapplicableremove",[ZPI18N.getString("zp.suser"),projDispName]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(eno,Timetracker.projectDashboard.DashboardUsers.removeUsers,eno,0,extraDtls)}},getApplicablelist:function(event){var ele=event.target;$(ele).addClass("disabled"),DashboardUsers.getCurrentView()===Timetracker.constants.USER?DashboardUsers.loadApplicableUsers():DashboardUsers.loadApplicableDepts()},constructApplicableUsersModal:function(entity){var header=entity===Timetracker.constants.USER?ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.users")]):ZPI18N.getString("zp.assign",[ZPI18N.getString("zp.departments")]),body="";return body=entity===Timetracker.constants.USER?'<div class="zpl_btnmnu"><div class="search-cmn"><i class="PI_lens"></i><input type="text" class="ztextbox" id="searchUser" placeholder="'+ZPI18N.getString("zp.search")+'" ><i class="PI_cls"></i></div><div class="zpl_rgt"><i class="zpl_ibg PI_lens" onclick="$(this).parent().siblings().addClass(\'opn\')"></i></div></div><form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_tblres" id="assigneeDiv"><table class="zpl_tbl zpl_nocrsor wd100_per"><thead><tr><th></th><th>'+ZPI18N.getString("zp.user")+'</th><th class="w150">'+ZPI18N.getString("zp.role")+'</th><th class="w200">'+ZPI18N.getString("zp.rateperhour")+'</th></tr></thead><tbody id="applicableUsers"></tbody></table></div></div></div></div></form>':'<div class="zpl_btnmnu"><div class="search-cmn"><i class="PI_lens"></i><input type="text" class="ztextbox" id="searchDept" placeholder="'+ZPI18N.getString("zp.search")+'" ><i class="PI_cls"></i></div><div class="zpl_rgt"><i class="zpl_ibg PI_lens" onclick="$(this).parent().siblings().addClass(\'opn\')"></i></div></div><form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_tblres" id="assigneeDiv"><table class="zpl_tbl zpl_nocrsor wd100_per"><thead><tr><th class="w50"></th><th>'+ZPI18N.getString("zp.department")+'</th></tr></thead><tbody id="applicableDepts"></tbody></table></div></div></div></div></form>',ModuleComp.Modal.setup({id:"projectUsersAddModal",type:1,header:header,body:body,backdrop:!0,closeOnSubmit:!0,successCallback:Timetracker.projectDashboard.DashboardUsers.addUpdateUsers,hiddenCallback:function(){Layout.Page.container.find("#addAssignees").removeClass("disabled")},extraDetails:{projectId:Layout.Page.urlparam.id,entity:entity},deleteOnHide:!0,closeonEsc:!0})},loadApplicableDepts:function(){var deptDivList=DashboardUsers.getApplicableDeptHtml();if(void 0==deptDivList)Timetracker.util.showAlert(1,ZPI18N.getString("zp.alldepartmentsmapped")),Layout.Page.container.find("#addAssignees").removeClass("disabled");else{var modal=DashboardUsers.constructApplicableUsersModal(DashboardUsers.getCurrentView());DashboardUsers.constructApplicableDepts(deptDivList),modal.find("#searchDept").off("input").on("input",function(event){var modal=Layout.Page.container.find("#projectUsersAddModal");modal.find("#applicableDepts").off("scroll").scrollTop(0),modal.find("#applicableDepts").html("").append(ZPeople.LOADING_HTML);var deptDivList=DashboardUsers.getApplicableDeptHtml($(this).val());DashboardUsers.constructApplicableDepts(deptDivList)}),modal.find(".zpl_btnmnu").find(".PI_cls").off().on("click",function(){$(this).parent().removeClass("opn");var container=Layout.Page.container.find("#projectUsersAddModal").find("#searchDept");0!=container.length&&""!=container.val()&&(container.val(""),container.trigger("input"))})}},getApplicableDeptHtml:function(searchTxt){Timetracker.Department.dept_List.load&&Timetracker.util.getCommonData({mode:"getDeptAndLocList",deptfetch:!0},Timetracker.Filters.setCacheForFilterValues);var allDepts=Timetracker.Department.dept_List,alreadyAssignedDepts=Timetracker.projectDashboard.projectDtls.projectDepts,alreadySelectedDepts=[];void 0!==searchTxt&&(alreadySelectedDepts=(alreadySelectedDepts=Layout.Page.container.find("#projectUsersAddModal").data("deptsToBeUpdated"))||[]);var deptDivList=$("<div></div>");return allDepts&&Object.keys(allDepts).length>0&&$.each(allDepts,function(index,data){if(!(alreadyAssignedDepts&&alreadyAssignedDepts[data.dept_ID]||void 0!==searchTxt&&""!==searchTxt&&-1===data.dept_Name.toUpperCase().indexOf(searchTxt.toUpperCase()))){var deptDiv=$('<tr id="'+data.dept_ID+'"><td><div class="zcheckbox"><input type="checkbox" class="zcheckbox__helper" deptId="'+data.dept_ID+'" id="checkBox_'+data.dept_ID+'"><label class="zcheckbox__label" for="checkBox_'+data.dept_ID+'"></label></div></td><td class="zpl_cp" onclick="Timetracker.projectDashboard.DashboardUsers.selectUserOrDept(\''+Timetracker.constants.DEPARTMENT+"','"+data.dept_ID+"');\">"+data.dept_Name+"</td></tr>");-1!==alreadySelectedDepts.indexOf(data.dept_ID)&&deptDiv.find("input").prop("checked",!0),deptDiv.find("input").on("change",function(){var deptId=$(this).attr("deptId"),deptsToBeUpdated=Layout.Page.container.find("#projectUsersAddModal").data("deptsToBeUpdated"),index=(deptsToBeUpdated=deptsToBeUpdated||[]).indexOf(deptId);$(this).is(":checked")?-1===index&&deptsToBeUpdated.push(deptId):-1!==index&&deptsToBeUpdated.splice(index,1),Layout.Page.container.find("#projectUsersAddModal").data("deptsToBeUpdated",deptsToBeUpdated)}),deptDivList.append(deptDiv)}}),deptDivList.children().length>0?deptDivList:void 0},constructApplicableDepts:function(deptDivList){void 0==deptDivList?(Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.notfound",[ZPI18N.getString("zp.departments")]),divId:"assigneeDiv"}),Layout.Page.container.find("table").addClass("zpl_DNI"),Timetracker.util.freezeSubmit("projectUsersAddModal","zp_modal_blubtn")):(Timetracker.Util.showHideNoData({remove:!0,divId:"assigneeDiv"}),Layout.Page.container.find("table").removeClass("zpl_DNI"),Layout.Page.container.find("#projectUsersAddModal").find("#applicableDepts").html("").append(deptDivList.children()),Timetracker.util.unfreezeSubmit("projectUsersAddModal","zp_modal_blubtn"))},loadApplicableUsers:function(){DashboardUsers.getApplicableUserList(0).then(function(applicableUsers){if(applicableUsers&&0!=applicableUsers.length){let modal=DashboardUsers.constructApplicableUsersModal(DashboardUsers.getCurrentView());modal.find("#searchUser").off("input").on("input",function(event){clearTimeout(Timetracker.projectDashboard.DashboardUsers.applicableUserFetchDelay),Timetracker.projectDashboard.DashboardUsers.applicableUserFetchDelay=setTimeout(()=>{Timetracker.projectDashboard.DashboardUsers.populateApplicableUsers(Layout.Page.container.find("#projectUsersAddModal").find("#searchUser").val())},500)}),modal.find(".zpl_btnmnu").find(".PI_cls").off().on("click",function(){$(this).parent().removeClass("opn");var container=Layout.Page.container.find("#projectUsersAddModal").find("#searchUser");0!=container.length&&""!=container.val()&&(container.val(""),container.trigger("input"))}),DashboardUsers.populateApplicableUsers()}else Timetracker.isDataAdminForAllUsers()?Timetracker.util.showAlert(1,ZPI18N.getString("zp.allusersmapped")):Timetracker.util.showAlert(1,ZPI18N.getString("zp.allapplicableusersmapped")),Timetracker.util.unfreezeSubmit(null,"addAssignees",Layout.Page.container)})},getApplicableUserList:function(sIndex,searchTxt){return new Promise(function(resolve,reject){var userArr=DashboardUsers.getApplicableUsersFromCache(sIndex,searchTxt);if(null==userArr){var requestParams={mode:"fetchFormLookupOtions",formId:Timetracker.projects.formDetails.formId,recordId:Layout.Page.urlparam.id,startInd:sIndex,conreqcsr:csrfToken};requestParams.luFcIds=JSON.stringify([Timetracker.projects.formDetails.projectManagerFCId]),requestParams.keys=JSON.stringify({excludeProjectUsers:!0,projectId:Timetracker.projectDashboard.projectDtls.projectId}),searchTxt&&""!=searchTxt&&(requestParams.searchtxt=searchTxt),ZPeople.Request.send("/formAction.zp",requestParams,function(response,params){userArr=response&&response.message&&response.message[Timetracker.projects.formDetails.projectManagerFCId]?response.message[Timetracker.projects.formDetails.projectManagerFCId]:[],DashboardUsers.updateApplicableUsersCache(searchTxt,userArr),resolve(userArr)})}else resolve(userArr)})},updateApplicableUsersCache:function(searchTxt,dataArray,clearCache){if(clearCache)return DashboardUsers.APPLICABLE_USERS_LIST=null,void(DashboardUsers.APPLICABLE_USERS_SEARCH_LIST={});searchTxt&&""!=searchTxt?void 0==DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[searchTxt]?DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[searchTxt]=dataArray:DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[searchTxt]=DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[searchTxt].concat(dataArray):null==DashboardUsers.APPLICABLE_USERS_LIST?DashboardUsers.APPLICABLE_USERS_LIST=dataArray:DashboardUsers.APPLICABLE_USERS_LIST=DashboardUsers.APPLICABLE_USERS_LIST.concat(dataArray)},getApplicableUsersFromCache:function(sIndex,searchTxt){if(sIndex=0==sIndex?0:sIndex-1,searchTxt&&""!=searchTxt){if(DashboardUsers.APPLICABLE_USERS_SEARCH_LIST){if(!DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[searchTxt])return DashboardUsers.getApplicableUsersSearchResultsFromSubString(sIndex,searchTxt);if(0==DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[searchTxt].length)return[];if(DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[searchTxt].length>sIndex)return DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[searchTxt].slice(sIndex,sIndex+DashboardUsers.APPLICABLE_USERS_FIRESCROLL_LIMIT)}}else if(DashboardUsers.APPLICABLE_USERS_LIST)return 0==DashboardUsers.APPLICABLE_USERS_LIST.length?[]:DashboardUsers.APPLICABLE_USERS_LIST.length>sIndex?DashboardUsers.APPLICABLE_USERS_LIST.slice(sIndex,sIndex+DashboardUsers.APPLICABLE_USERS_FIRESCROLL_LIMIT):null;return null},getApplicableUsersSearchResultsFromSubString:function(sIndex,searchTxt){if(0==sIndex&&searchTxt.length>1){for(var tempSearchResults=null,tempSearchTxt=searchTxt.substring(0,searchTxt.length-1);tempSearchTxt.length>0;){if(DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[tempSearchTxt]){DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[tempSearchTxt].length<DashboardUsers.APPLICABLE_USERS_FIRESCROLL_LIMIT&&(tempSearchResults=DashboardUsers.APPLICABLE_USERS_SEARCH_LIST[tempSearchTxt]);break}tempSearchTxt=tempSearchTxt.substring(0,tempSearchTxt.length-1)}if(null!=tempSearchResults){let searchResults=[];return $.each(tempSearchResults,function(index,data){-1!==data.Value.toLowerCase().indexOf(searchTxt.toLowerCase())&&searchResults.push(data)}),DashboardUsers.updateApplicableUsersCache(searchTxt,searchResults),searchResults}}return null},populateApplicableUsers:function(searchTxt){ZPeople.FireScroll.setParam("triggered",!0,Timetracker.constants.MODES.PROJECT_DB_USERS_SEARCH);let modal=Layout.Page.container.find("#projectUsersAddModal");modal.find(".zpl_mcnt").off("scroll").scrollTop(0),modal.find("form").prepend(ZPeople.LOADING_HTML),modal.find("#assigneeDiv").hide(),DashboardUsers.getApplicableUserList(0,searchTxt).then(function(applicableUsers){if(Timetracker.util.removeLoading(modal.find("form")),modal.find("#assigneeDiv").show(),modal.find("#applicableUsers").html(""),applicableUsers&&0!=applicableUsers.length){DashboardUsers.constructApplicableUsers(applicableUsers),Timetracker.Util.showHideNoData({remove:!0,divId:"assigneeDiv"}),modal.find("table").removeClass("zpl_DNI");let firescrollDtls={mode:Timetracker.constants.MODES.PROJECT_DB_USERS_SEARCH,searchTxt:searchTxt,scrollDiv:modal.find(".zpl_mcnt")};ZPeople.FireScroll.init(Timetracker.projectDashboard.DashboardUsers.loadMoreApplicableUsers,"assigneesDiv",firescrollDtls,!0),ZPeople.FireScroll.setRecordCount(applicableUsers.length,Timetracker.constants.MODES.PROJECT_DB_USERS_SEARCH),applicableUsers.length===DashboardUsers.APPLICABLE_USERS_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(Timetracker.constants.MODES.PROJECT_DB_USERS_SEARCH)}else Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.nousersfound"),divId:"assigneeDiv"}),modal.find("table").addClass("zpl_DNI")})},constructApplicableUsers:function(usersArr){let modal=Layout.Page.container.find("#projectUsersAddModal"),alreadySelectedUsersDtls=modal.data("usersToBeUpdated");alreadySelectedUsersDtls=alreadySelectedUsersDtls||{};var applicableUsersDiv=modal.find("#applicableUsers");for(var itr in usersArr){var uerno=usersArr[itr].Id,userDiv='<tr id="'+uerno+'"><td><div class="zcheckbox"><input type="checkbox" value="" class="zcheckbox__helper" userErecNo="'+uerno+'" id="checkBox_'+uerno+'"><label class="zcheckbox__label" for="checkBox_'+uerno+'"></label></div></td><td><div class="zpl_em zpl_cp" onclick="Timetracker.projectDashboard.DashboardUsers.selectUserOrDept(\''+Timetracker.constants.USER+"','"+uerno+'\');"><div class="zpl_emimg"><img src="'+(usersArr[itr].path?usersArr[itr].path:ZPeople.getDefaultUserImagePath())+'"></div><div class="zpl_emdts"><div>'+usersArr[itr].Value+'</div></div></div></td><td><div id="addUserRoleDiv" class="zpl_DNI"><select name="addUserRoleSelect" userErecNo="'+usersArr[itr].Id+'"><option value="0">'+ZPI18N.getString("zp.user")+'</option><option value="1">'+ZPI18N.getString("zp.local.Manager")+'</option></select></div></td><td><div id="addUserRatePerHourDiv" class="zpl_DNI"><input id="addUserRatePerHour" userErecNo="'+uerno+'" type="text" class="ztextbox w150" placeholder="'+ZPI18N.getString("zp.rateperhour")+'"></div></td></tr>';userDiv=$(userDiv),void 0!==alreadySelectedUsersDtls[uerno]&&(userDiv.find("#addUserRoleDiv").removeClass("zpl_DNI"),userDiv.find("#addUserRatePerHourDiv").removeClass("zpl_DNI"),userDiv.find("#checkBox_"+uerno).prop("checked",!0),userDiv.find("#addUserRatePerHour").val(alreadySelectedUsersDtls[uerno].ratePerHour),TimelyZComp.select.intialize(userDiv.find('[name="addUserRoleSelect"]')),TimelyZComp.select.setValue(userDiv.find('[name="addUserRoleSelect"]'),alreadySelectedUsersDtls[uerno].role)),userDiv.find("#checkBox_"+uerno).on("change",function(){var currentUserId=$(this).attr("userErecNo");Timetracker.projectDashboard.DashboardUsers.updateUserRowInAddModal(this,1,currentUserId)}),userDiv.find("#addUserRatePerHour").on("keyup",function(){var currentUserId=$(this).attr("userErecNo");Timetracker.projectDashboard.DashboardUsers.updateUserRowInAddModal(this,2,currentUserId)}),userDiv.find('[name="addUserRoleSelect"]').on("zselectchange",function(){var currentUserId=$(this).attr("userErecNo");Timetracker.projectDashboard.DashboardUsers.updateUserRowInAddModal(this,3,currentUserId)}),applicableUsersDiv.append(userDiv)}},loadMoreApplicableUsers:function(firescrollDtls){let sIndex=ZPeople.FireScroll.getRecordCount(Timetracker.constants.MODES.PROJECT_DB_USERS_SEARCH)+1;DashboardUsers.getApplicableUserList(sIndex,firescrollDtls.searchTxt).then(function(applicableUsers){ZPeople.FireScroll.setParam("triggered",!0,Timetracker.constants.MODES.PROJECT_DB_USERS_SEARCH),applicableUsers.length>0&&(DashboardUsers.constructApplicableUsers(applicableUsers),ZPeople.FireScroll.increaseRecordCount(applicableUsers.length,Timetracker.constants.MODES.PROJECT_DB_USERS_SEARCH),applicableUsers.length===DashboardUsers.APPLICABLE_USERS_FIRESCROLL_LIMIT&&ZPeople.FireScroll.reset(Timetracker.constants.MODES.PROJECT_DB_USERS_SEARCH))})},selectUserOrDept:function(entity,entityId){entity===Timetracker.constants.USER?Layout.Page.container.find("#projectUsersAddModal").find("#applicableUsers").find('[userErecNo="'+entityId+'"]').trigger("click"):entity===Timetracker.constants.DEPARTMENT&&Layout.Page.container.find("#projectUsersAddModal").find("#applicableDepts").find('[deptId="'+entityId+'"]').trigger("click")},updateUserRowInAddModal:function(currentObj,action,userErecNo){var modal=Layout.Page.container.find("#projectUsersAddModal"),currentUserDiv=modal.find("#"+userErecNo),usersToBeUpdated=modal.data("usersToBeUpdated");if(usersToBeUpdated=usersToBeUpdated||{},1===action)$(currentObj).is(":checked")?(TimelyZComp.select.intialize(currentUserDiv.find('[name="addUserRoleSelect"]')),currentUserDiv.find("#addUserRoleDiv").removeClass("zpl_DNI"),currentUserDiv.find("#addUserRatePerHourDiv").removeClass("zpl_DNI")):(currentUserDiv.find("#addUserRoleDiv").addClass("zpl_DNI"),currentUserDiv.find("#addUserRatePerHourDiv").addClass("zpl_DNI"));else if(2===action){var userRate=$(currentObj).val();Timetracker.Validations.isDecimal(userRate)?$(currentObj).removeClass("ztextbox__error"):$(currentObj).addClass("ztextbox__error")}if(currentUserDiv.find("[type='checkbox']").is(":checked")){var currentUserData=usersToBeUpdated[userErecNo]?usersToBeUpdated[userErecNo]:{};currentUserData.erecNo=userErecNo,currentUserData.role=TimelyZComp.select.getValue(currentUserDiv.find("select")),currentUserData.ratePerHour=currentUserDiv.find("#addUserRatePerHour").val(),usersToBeUpdated[userErecNo]=currentUserData}else delete usersToBeUpdated[userErecNo];modal.data("usersToBeUpdated",usersToBeUpdated)},addUpdateUsers:function(projectUsersAddModal){Timetracker.util.freezeSubmit("projectUsersAddModal","zp_modal_blubtn");var params,modalDetails=projectUsersAddModal.data("extraDetails"),json={url:Timetracker.constants.URL,otherdetails:{entity:modalDetails.entity}};if(modalDetails.entity===Timetracker.constants.USER){params={mode:"modifyProject",projectId:Layout.Page.urlparam.id};var updatedUsers=projectUsersAddModal.data("usersToBeUpdated");updatedUsers=updatedUsers||{};var errorDiv,usersToBeUpdated=[];if($.each(updatedUsers,function(key,element){element.ratePerHour=""===element.ratePerHour?"0":element.ratePerHour,Timetracker.Validations.isDecimal(element.ratePerHour)?usersToBeUpdated.push({erecNo:element.erecNo,role:element.role,ratePerHour:element.ratePerHour}):errorDiv=projectUsersAddModal.find("#"+element.erecNo)}),void 0!==errorDiv&&1===errorDiv.length)return errorDiv[0].scrollIntoView(),void Timetracker.util.unfreezeSubmit("projectUsersAddModal","zp_modal_blubtn");usersToBeUpdated.length>0?(params.usersToBeAdded=JSON.stringify(usersToBeUpdated),json.params=params,json.callback=DashboardUsers.addUpdateUsersCallback,Timetracker.Request.send(json)):Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"))}else{var selectedDepts=projectUsersAddModal.data("deptsToBeUpdated");if(selectedDepts&&selectedDepts.length>0){params={mode:"mapToJobProject",type:"project",entity:Timetracker.constants.DEPARTMENT,recordsToBeMapped:Layout.Page.urlparam.id};var deptsToBeAdded="";$.each(selectedDepts,function(index,deptId){deptsToBeAdded+=deptId+","}),params.assigneesToBeMapped=deptsToBeAdded,json.params=params,json.callback=DashboardUsers.addUpdateUsersCallback,Timetracker.Request.send(json)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"))}},addUpdateUsersCallback:function(response,params,otherdetails){if(ModuleComp.Modal.hide("projectUsersAddModal"),response.res&&"0"!==response.res){var updateCache=otherdetails.entity===Timetracker.constants.DEPARTMENT;otherdetails.entity===Timetracker.constants.USER?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.userassignedsuccessfully")),DashboardUsers.updateApplicableUsersCache(null,null,!0),updateCache=response.resObj.addedUsers&&response.resObj.addedUsers.length>0):Timetracker.util.showAlert(2,ZPI18N.getString("zp.departmentassignedsuccessfully")),updateCache&&(otherdetails.entity===Timetracker.constants.USER&&Timetracker.projectDashboard.projectDtls&&Timetracker.projectDashboard.projectDtls.hasOwnProperty("projectUsersCount")?resetAndUpdateProjectDtlsCache(Layout.Page.urlparam.id,{projectUsersCount:Timetracker.projectDashboard.projectDtls.projectUsersCount+response.resObj.addedUsers.length,isUserUpdate:!0}).then(function(){setProjectUsersCount(),Timetracker.projectDashboard.DashboardUsers.switchView(otherdetails.entity,!0)}):resetAndUpdateProjectDtlsCache(Layout.Page.urlparam.id).then(function(){Timetracker.projectDashboard.DashboardUsers.switchView(otherdetails.entity,!0)}))}else Timetracker.Request.failureCallback(response.errorCode,response.extraDtls)},updateUsers:function(erecNo,role,ratePerHour){var json={url:Timetracker.constants.URL};json.params={mode:"updateProjectUserDetails",projectId:Layout.Page.urlparam.id,erecNo:erecNo},void 0!==role&&(json.params.role=role),void 0!==ratePerHour&&(json.params.ratePerHour=ratePerHour),json.callback=DashboardUsers.updateUsersCallback,Timetracker.Request.send(json)},updateUsersCallback:function(response,params){var userElement=Layout.Page.container.find("#projectDashboardUsers").find("#"+params.erecNo),userRoleElement=userElement.find('[name="userRoleSelect"]'),newRole=userRoleElement.attr("role"),userRPHElement=userElement.find("#userRatePerHour"),newRatePerHour=userRPHElement.attr("ratePerHour");if(response.res?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.updatedsuccessfully")),void 0!==response.resObj.role&&(newRole=response.resObj.role),void 0!==response.resObj.ratePerHour&&(newRatePerHour=response.resObj.ratePerHour)):Timetracker.Request.failureCallback(response.errorCode,response.extraDtls),0!==userRoleElement.length&&(userRoleElement.attr("role",newRole),TimelyZComp.select.setValue(userRoleElement,newRole),TimelyZComp.select.setAttributes(userRoleElement,{disabled:!1})),0!==userRPHElement.length&&(userRPHElement.removeClass("disabled"),userRPHElement.attr("ratePerHour",newRatePerHour),userRPHElement.val(newRatePerHour)),response.res){let dtlsToBeUpdate={isUserUpdate:!0};Timetracker.projectDashboard.projectDtls&&Timetracker.projectDashboard.projectDtls.projectHeadDtls&&params.erecNo===Timetracker.projectDashboard.projectDtls.projectHeadDtls.erecno&&((dtlsToBeUpdate={projectHeadDtls:Timetracker.projectDashboard.projectDtls.projectHeadDtls}).projectHeadDtls.ratePerHour=Timetracker.Validations.isDecimal(newRatePerHour)?Number(newRatePerHour):0),resetAndUpdateProjectDtlsCache(Layout.Page.urlparam.id,dtlsToBeUpdate,{otherContainersOnly:!0})}},showHideRemoveOption:function(obj,entity){var id;id=entity===Timetracker.constants.USER?$(obj).attr("userErecNo"):$(obj).attr("deptId");var element=Layout.Page.container.find("#"+id);element.hasClass("zp_popdeteact")?element.removeClass("zp_popdeteact"):element.addClass("zp_popdeteact")},removeUsers:function(id){if(id){var params,entity=DashboardUsers.getCurrentView();params=entity===Timetracker.constants.USER?{mode:"modifyProject",projectId:Layout.Page.urlparam.id,usersToBeRemoved:id}:{mode:"removeProjectDepts",projectId:Layout.Page.urlparam.id,ids:id};var json={url:Timetracker.constants.URL};json.params=params,json.callback=DashboardUsers.removeUsersCallback,json.otherdetails={entity:entity},Timetracker.Request.send(json)}},removeUsersCallback:function(response,params,otherdetails){if(response.res&&"0"!==response.res){let refreshCache=!1,layout=Layout.Page.container.find("#projectDashboardUsers");if(otherdetails.entity===Timetracker.constants.USER){let removedUsers=response.resObj.removedUsers;if(removedUsers&&removedUsers.length>0)Timetracker.util.showAlert(2,ZPI18N.getString("zp.common.removesuccess",[ZPI18N.getString("zp.user")])),$.each(removedUsers,function(index,userErecNo){layout.find("#"+userErecNo).remove()}),refreshCache=!0;else{Timetracker.util.showAlert(1,ZPI18N.getString("zp.ttpermdenied"));let elements=layout.find("#projectUsersDiv").find(".zp_popdeteact");elements&&elements.length>0&&$.each(elements,function(index,element){$(this).find(".zp_popdetecf").one("click",function(){let userErecNo=$(this).attr("userErecNo");Timetracker.projectDashboard.DashboardUsers.removeUsers(Timetracker.constants.USER,userErecNo)}),$(this).removeClass("zp_popdeteact")})}}else Timetracker.util.showAlert(2,ZPI18N.getString("zp.common.removesuccess",[ZPI18N.getString("zp.department")])),layout.find("#"+params.ids).remove(),refreshCache=!0;if(refreshCache){let updateDtl,extraParams;Timetracker.projectDashboard.projectDtls&&(Timetracker.isDataAdminForAllUsers()||Timetracker.projectDashboard.projectDtls.projectHeadDtls&&Timetracker.projectDashboard.projectDtls.projectHeadDtls.erecno==erecno)&&(otherdetails.entity===Timetracker.constants.USER&&Timetracker.projectDashboard.projectDtls.hasOwnProperty("projectUsersCount")?updateDtl={projectUsersCount:Timetracker.projectDashboard.projectDtls.projectUsersCount-response.resObj.removedUsers.length,isUserUpdate:!0}:otherdetails.entity===Timetracker.constants.DEPARTMENT&&(updateDtl={toBeRemoved:{projectDepts:params.ids}}),extraParams={otherContainersOnly:!0}),resetAndUpdateProjectDtlsCache(Layout.Page.urlparam.id,updateDtl,extraParams).then(function(){if(Timetracker.projectDashboard.projectDtls&&Timetracker.projectDashboard.projectDtls.isViewAllowed){if(otherdetails.entity===Timetracker.constants.USER){if(DashboardUsers.updateApplicableUsersCache(null,null,!0),setProjectUsersCount(),!Timetracker.projectDashboard.projectDtls.projectUsersCount){let msg=ZPI18N.getString("zp.noassignedentitycurrently",[ZPI18N.getString("zp.small.users")]);msg+=Timetracker.projectDashboard.projectDtls.isEditAllowed?ZPI18N.getString("zp.clickassignentityadd",[ZPI18N.getString("zp.users"),ZPI18N.getString("zp.small.users"),Timetracker.util.getProjectDisplayName(!0)]):"",Timetracker.Util.showHideNoData({msg:msg,appendToDiv:!0,layout:layout})}}else if(Timetracker.projectDashboard.projectDtls.projectDepts&&Timetracker.projectDashboard.projectDtls.projectDepts.hasOwnProperty(params.ids)&&delete Timetracker.projectDashboard.projectDtls.projectDepts[params.ids],0==layout.find("#projectDeptsDiv").children().length){let msg=ZPI18N.getString("zp.noassignedentitycurrently",[ZPI18N.getString("zp.departmentssmall")]);msg+=ZPI18N.getString("zp.clickassignentityadd",[ZPI18N.getString("zp.departments"),ZPI18N.getString("zp.departmentssmall"),Timetracker.util.getProjectDisplayName(!0)]),Timetracker.Util.showHideNoData({msg:msg,appendToDiv:!0,layout:layout})}}else Timetracker.projectDashboard.URLActions.redirectToBasePage()})}}else Timetracker.Request.failureCallback(response.errorCode,response.extraDtls)},changeProjectHead:function(){var currentProjectHead,currentRatePerHour="0";Timetracker.projectDashboard.projectDtls.projectHeadDtls&&(currentProjectHead=Timetracker.projectDashboard.projectDtls.projectHeadDtls.erecno,currentRatePerHour=Timetracker.projectDashboard.projectDtls.projectHeadDtls.ratePerHour);var modal=Layout.Page.container.find("#projectHeadModal");if(0==modal.length){var body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><label>'+ZPI18N.getString("zp.projecthead")+'</label><div><input id="projectHeadSelect"></div></div><div class="zpl_secn"><label>'+ZPI18N.getString("zp.rateperhour")+'</label><div><input id="projectHeadRatePerHour" type="text" class="ztextbox" '+(void 0===currentRatePerHour?"disabled=disbaled":"")+' value="'+(void 0!==currentRatePerHour?currentRatePerHour:"")+'"></div>';body+='</div><div class="zpl_secn zpl_DNI" id="userChangeNote_div"><p class="zpl_info"><em>'+ZPI18N.getString("zp.note")+" : "+ZPI18N.getString("zp.projectheadchangenote")+"</em></p></div></div></div>";(modal=ModuleComp.Modal.get({id:"projectHeadModal",type:3,header:ZPI18N.getString("zp.assignprojecthead"),body:body,backdrop:!0,closeOnSubmit:!1,successCallback:Timetracker.projectDashboard.DashboardUsers.updateProjectHead,closeonEsc:!0})).find("#projectHeadSelect").off("zselectchange").on("zselectchange",function(event,data){Timetracker.projectDashboard.projectDtls.projectHeadDtls&&(currentProjectHead=Timetracker.projectDashboard.projectDtls.projectHeadDtls.erecno,currentRatePerHour=Timetracker.projectDashboard.projectDtls.projectHeadDtls.ratePerHour);var newHead=data.selectedValue;void 0==currentProjectHead||-1==newHead||newHead==currentProjectHead||""==newHead?modal.find("#userChangeNote_div").addClass("zpl_DNI"):modal.find("#userChangeNote_div").removeClass("zpl_DNI"),currentProjectHead==newHead&&void 0===currentRatePerHour?(modal.find("#projectHeadRatePerHour").val(""),modal.find("#projectHeadRatePerHour").attr("disabled","disabled")):modal.find("#projectHeadRatePerHour").removeAttr("disabled")})}else Timetracker.util.removeErrorMsg("projectHeadSelect",modal),modal.find("#userChangeNote_div").addClass("zpl_DNI"),void 0!==currentRatePerHour?(modal.find("#projectHeadRatePerHour").val(currentRatePerHour),modal.find("#projectHeadRatePerHour").removeAttr("disabled")):(modal.find("#projectHeadRatePerHour").val(""),modal.find("#projectHeadRatePerHour").attr("disabled","disabled")),TimelyZComp.select.deselectAllOptions(modal.find("#projectHeadSelect"),modal);var extraDtls={submode:"TIMETRACKER_FORMS",skipPageMode:!0,searchConf:{isMultiple:!1,noMatchMessage:ZPI18N.getString("zp.search"),maximumSelectionSize:25},placeHolder:ZPI18N.getString("zp.selectuser"),extraParams:{tableName:Timetracker.constants.PROJECT_TABLE}},initUserObj={};if(currentProjectHead){var userDtls=ZPeople.getUserDetailsById(currentProjectHead);initUserObj.id=currentProjectHead,initUserObj.text=ZPeople.decodeTxt(userDtls.empid+" "+userDtls.name),initUserObj.html=userDtls.empid+" "+userDtls.name,initUserObj.photo=userDtls.thumb}ZPeopleComponents.isComponent(modal.find("#projectHeadSelect"))?currentProjectHead&&TimelyZComp.select.setValue(modal.find("#projectHeadSelect"),initUserObj):(Timetracker.Search.populateZCompUsers("projectHeadSelect",initUserObj,extraDtls,!1,modal,Timetracker.constants.TTCustomAdmin.EntryEdit),TimelyZComp.select.setAttributes(Layout.Page.container.find("#projectHeadSelect"),{clearButton:!0})),modal.find("#projectHeadRatePerHour").off("keyup").on("keyup",function(){var ratePerHour=$(this).val();""===ratePerHour||Timetracker.Validations.isDecimal(ratePerHour)?$(this).removeClass("ztextbox__error"):$(this).addClass("ztextbox__error")}),ModuleComp.Modal.show(modal)},updateProjectHead:function(){Timetracker.util.freezeSubmit("projectHeadModal","zp_modal_blubtn");var modal=Timetracker.Util.getLayout().find("#projectHeadModal"),projectHead=TimelyZComp.select.getValue(modal.find("#projectHeadSelect")),currentProjectHead=null;Timetracker.projectDashboard.projectDtls.projectHeadDtls&&(currentProjectHead=Timetracker.projectDashboard.projectDtls.projectHeadDtls);var otherDtls={},params={projectId:Layout.Page.urlparam.id};if(Timetracker.util.checkIsParamNotEmpty(projectHead)){var ratePerHour=modal.find("#projectHeadRatePerHour").val();if(ratePerHour=""===ratePerHour||void 0===ratePerHour?"0":ratePerHour,!Timetracker.Validations.isDecimal(ratePerHour))return $(this).addClass("ztextbox__error"),void Timetracker.util.unfreezeSubmit("projectHeadModal","zp_modal_blubtn");if($(this).removeClass("ztextbox__error"),params.mode="updateProjectUserDetails",currentProjectHead&&currentProjectHead.erecno===projectHead&&currentProjectHead.ratePerHour+""===ratePerHour)return Timetracker.util.unfreezeSubmit("projectHeadModal","zp_modal_blubtn"),void Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"));params.erecNo=projectHead,params.role=Timetracker.constants.PROJECT_ROLES.HEAD,params.ratePerHour=ratePerHour,otherDtls.isUpdate=null!=currentProjectHead}else{if(params.mode="modifyProject",!currentProjectHead)return Timetracker.util.unfreezeSubmit("projectHeadModal","zp_modal_blubtn"),void Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"));params.usersToBeRemoved=currentProjectHead.erecno,otherDtls.isRemove=!0}var json={url:Timetracker.constants.URL};json.params=params,json.callback=DashboardUsers.updateProjectHeadCallback,json.otherdetails=otherDtls,Timetracker.Request.send(json)},updateProjectHeadCallback:function(response,params,otherDtls){if(Timetracker.util.unfreezeSubmit("projectHeadModal","zp_modal_blubtn"),ModuleComp.Modal.hide("projectHeadModal"),response.res&&"0"!==response.res){let layout=Layout.Page.container.find("#projectDashboardUsers"),container=layout.find("#projectUsersDiv");if(response.resObj){if(otherDtls.isUpdate)Timetracker.util.showAlert(2,ZPI18N.getString("zp.updatedsuccessfully"));else if(otherDtls.isRemove){if(!(response.resObj.removedUsers&&response.resObj.removedUsers.length>0))return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.permdenied"));Timetracker.util.showAlert(2,ZPI18N.getString("zp.removesuccessful"))}else Timetracker.util.showAlert(2,ZPI18N.getString("zp.assignsuccessful"));var updatDtls,projectHeadDiv;otherDtls.isRemove&&Timetracker.isDataAdminForAllUsers()&&Timetracker.projectDashboard.projectDtls.hasOwnProperty("projectUsersCount")?(updatDtls={toBeRemoved:{projectHeadDtls:""},projectUsersCount:Timetracker.projectDashboard.projectDtls.projectUsersCount-1},0!=container.length&&(projectHeadDiv=container.find("#"+Timetracker.projectDashboard.projectDtls.projectHeadDtls.erecno))):otherDtls.isUpdate&&Timetracker.projectDashboard.projectDtls.projectHeadDtls.erecno==response.resObj.erecNo&&((updatDtls={projectHeadDtls:Timetracker.projectDashboard.projectDtls.projectHeadDtls}).projectHeadDtls.ratePerHour=Timetracker.Validations.isDecimal(response.resObj.ratePerHour+"")?Number(response.resObj.ratePerHour):0,0!=container.length&&(projectHeadDiv=container.find("#"+Timetracker.projectDashboard.projectDtls.projectHeadDtls.erecno))),resetAndUpdateProjectDtlsCache(Layout.Page.urlparam.id,updatDtls).then(function(){if(Timetracker.projectDashboard.projectDtls&&Timetracker.projectDashboard.projectDtls.isViewAllowed){if(setProjectDetails(Layout.Page.urlparam.id,Timetracker.projectDashboard.projectDtls),Timetracker.Page.isProjectDashboard("users")&&DashboardUsers.getCurrentView()===Timetracker.constants.USER)if(updatDtls&&projectHeadDiv&&0!=projectHeadDiv.length)if(updatDtls.hasOwnProperty("toBeRemoved")){if(projectHeadDiv.remove(),0==Timetracker.projectDashboard.projectDtls.projectUsersCount){let msg=ZPI18N.getString("zp.noassignedentitycurrently",[ZPI18N.getString("zp.small.users")]);msg+=Timetracker.projectDashboard.projectDtls.isEditAllowed?ZPI18N.getString("zp.clickassignentityadd",[ZPI18N.getString("zp.users"),ZPI18N.getString("zp.small.users"),Timetracker.util.getProjectDisplayName(!0)]):"",Timetracker.Util.showHideNoData({msg:msg,appendToDiv:!0,layout:layout})}}else updatDtls.hasOwnProperty("projectHeadDtls")&&projectHeadDiv.find("#userRatePerHour").val(Timetracker.projectDashboard.projectDtls.projectHeadDtls.ratePerHour);else DashboardUsers.switchView(Timetracker.constants.USER,!0)}else Timetracker.projectDashboard.URLActions.redirectToBasePage()})}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.permdenied"))}else Timetracker.Request.failureCallback(response.errorCode,response.extraDtls)}},DashboardFeeds={initDashboardFeeds:function(){this.constructHtml(),Layout.Page.container.find('[name="projectDashboardFeedsContainer"]').removeClass("zpl_DNI"),Timetracker.projectDashboard.projectDtls.projectFeedsKey&&ZPFeeds.get(Timetracker.projectDashboard.projectDtls.projectFeedsKey);let feedsBoxLayout=Layout.Page.container.find("#zp_dash_feedspost_container");feedsBoxLayout.find("#zp_postTextarea").removeClass("zpl_DNI"),Layout.Page.container.find("#editor_container").remove(),feedsBoxLayout.find("img").attr("src",ZPeople.CURR_USER.thumb),DashboardFeeds.registerTextareaToEditor(feedsBoxLayout.find("#zp_postTextarea"))},constructHtml:function(){let layout=Layout.Page.container.find('[name="projectDashboardFeedsContainer"]'),html='<div class="zp-fd-wrpr"><div class="zp-fd-scroll P0I"><div id="zp_dash_feedspost_container"><div class="zp-fd-compose"><a class="zp-fd-avatar" href=""><img class="zp-uimg" src=""></a><textarea class="form-control comps_bfr" id="zp_postTextarea" ondragover="ZPFeeds.Attachment.dragOverAttachments(event, true);" placeholder="'+ZPI18N.getString("zp.typeattomention",[""])+'"></textarea></div></div><div id="zp_feeds_views"></div></div></div>';layout.html(html)},registerTextareaToEditor:function(textareaObj){textareaObj.off("click").on("click",function(){textareaObj.addClass("zpl_DNI");var clickObj=Layout.Page.container.find("#zp_postEditor").children("#zpEditor");if(0===clickObj.length){var actJson={};void 0===actJson.subBtnName&&(actJson.subBtnName="zp.post"),actJson.divId="zp_postEditor",actJson.subBtnId="submitbtn",actJson.parentCon="editor_container",Layout.Page.container.find("#zp_dash_feedspost_container").append(ZPFeeds.Editor.getEditorContainer(actJson)),Layout.Page.container.find("#zp_dash_feedspost_container").find("#editor_container").find("#submitbtn").on("click",function(){DashboardFeeds.postStatus()}),Layout.Page.container.find("#zp_dash_feedspost_container").find("#editor_container").find("#zp_editor_cancelbtn").on("click",function(){Layout.Page.container.find("#zp_dash_feedspost_container").find("#editor_container").remove(),Layout.Page.container.find("#zp_postTextarea").removeClass("zpl_DNI")}),ZPFeeds.POSTEDITOR=ZPFeeds.Editor.getEditor("zp_postEditor","Status")}else null!==ZPFeeds.POSTEDITOR&&(clickObj.removeClass("zpl_DNI"),ZPFeeds.POSTEDITOR=ZPFeeds.Editor.editorList.zp_postEditor);setTimeout(function(){ZPFeeds.POSTEDITOR.focus()},500)})},postStatus:function(){var feedsBoxLayout=Layout.Page.container.find("#zp_dash_feedspost_container"),curConObj=Layout.Page.container.find("#zp_dash_feedspost_container"),loaderObj=feedsBoxLayout.find("#editor_container").find("#submitbtn");0===loaderObj.find("#loader").length&&loaderObj.append(ZPFeeds.MINILOADER),loaderObj.attr("disabled",!0);var content=ZPFeeds.getSmileysAndMentions(ZPFeeds.POSTEDITOR.getContent(),ZPeople.isSearchAllowed);content=ZPFeeds.removeTrailingEmptyDivs(content);var messageText=ZPFeeds.getTextContent(content);if(0===messageText.length&&0===$("<div>").append(content).find("img").length||messageText.length>15e3)return messageText.length>15e3&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.statuslengthwarning")),ZPFeeds.POSTEDITOR.focus(),void loaderObj.attr("disabled",!1).find("#loader").remove();var param={postedWall:Layout.Page.urlparam.id,isForProject:!0,callBack:ZPFeeds.Activity.handleStatusResponse,content:content,messageText:messageText,curConObj:curConObj};ZPFeeds.postAction(param,!0)}},DashboardJobs={initDashboardJobs:function(initialLoad,sorterObj,latestCompletedJobId){let container=Layout.Page.container.find("[name=projectDashboardJobsContainer]");container.removeClass("zpl_DNI"),Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),this.constructHtml(),Timetracker.util.checkAddJobPermVar||Timetracker.projects.Util.isProjectHeadOrManager(Timetracker.projectDashboard.projectDtls.projectId)?container.find("#addjobbutton").removeClass("DN").text(ZPI18N.getString("zp.add")+" "+ZPeople.decodeTxt(Timetracker.util.getJobDisplayName(!0))):container.find("#addjobbutton").addClass("DN"),this.getJobsList(sorterObj,latestCompletedJobId)},getJobsList:function(sorterObj,latestCompletedJobId){var container=Layout.Page.container.find("[name=projectDashboardJobsContainer]");Timetracker.views.checkAllCheckBoxes(void 0,"joblist",settingsPage.container);let firescrollMode=getFirescrollMode(Timetracker.constants.MODES.PROJECT_DB_JOBS);Timetracker.FireScroll.resetDataOnLoad(firescrollMode),container.off("scroll.firescroll"),container.scrollTop(0);var params=DashboardJobs.getParamsToFetchJobs(sorterObj,latestCompletedJobId);container.find("[id^='jobSort']").removeClass("desc asc"),params.isAscending?(container.find("#jobSort"+params.sortType).addClass("desc"),container.find("#jobSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbyasc"))):(container.find("#jobSort"+params.sortType).addClass("asc"),container.find("#jobSort"+params.sortType).attr("title",ZPI18N.getString("zp.sortbydesc"))),TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),container.find("#joblist").addClass("zpl_DNI"),container.find("#job-listtbody").children().remove();let loadingContainer=container.find("#joblist").closest(".zpl_rgtcnt");Timetracker.Util.showHideNoData({remove:!0,layout:loadingContainer}),Timetracker.util.appendLoading({layout:loadingContainer}),$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.util.removeLoading(loadingContainer),DashboardJobs.constructDashboardJobs(resultData,params),null!==resultData&&(Timetracker.FireScroll.initFireScroll(firescrollMode,Timetracker.constants.URL,params,DashboardJobs.loadMorePdbodJobs,"",{scrollDiv:container}),Timetracker.FireScroll.setFetchCount(firescrollMode,resultData.schArr))})},constructHtml:function(){let layout=Layout.Page.container.find("[name=projectDashboardJobsContainer]"),pageCode=Timetracker.Page.getPageModeCode();if(0==layout.find("#projectDashboardJobs").length){let moreBtnId=pageCode+"jobsMore_",jobDisplayName=ZPI18N.getString("zp.tt.addentity",[Timetracker.util.getJobDisplayName(!0)]),html='<div class="zpl_btnmnu" id="projectDashboardJobs"><div class="actn_ovrly" id="zp_view_record_delete">'+Timetracker.views.multiSelectActions.getMultiSelectHtml()+'</div><div class="zpl_rgt" id="zp_views_formrecactions"><button class="zlabel zlabel--blue zlabel--medium DB" id="addjobbutton" ref="addJob" onclick="Timetracker.projectDashboard.DashboardJobs.addJob();">'+jobDisplayName+'</button><i class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" onclick="Timetracker.projectDashboard.DashboardJobs.constructFilter();"></i><i class="zpl_ibg PI_more" title="'+ZPI18N.getString("zp.more")+'" ref="more" id="'+moreBtnId+'Btn"></i></div></div><div class="zpl_rgtcnt"><div class="zpl_tblres ova"><div class="zpl_dtbl" id="joblist"><ul><li class="mw50"><div class="zcheckbox"><input type="checkbox" class="zcheckbox__helper" id="'+pageCode+'jcheckallbox" bid="job_checkallbox" ref="checkall"><label class="zcheckbox__label" for="'+pageCode+'jcheckallbox"></label></div></li><li class="w400"><b class="form_jobname">'+ZPI18N.getString("zp.jobname")+'</b><div class="zpl_icncnt"><i class="PI_sort" title="'+ZPI18N.getString("zp.sortbydesc")+'" id="jobSort0" type="0" ref="sort"></i></div></li><li class="mw50"></li><li class="mw150"><b>'+ZPI18N.getString("zp.sdate")+'</b><div class="zpl_icncnt"><i class="PI_sort" id="jobSort1" type="1" title="'+ZPI18N.getString("zp.sortbydesc")+'" ref="sort"></i></div></li><li class="mw150"><b>'+ZPI18N.getString("zp.edate")+'</b><div class="zpl_icncnt"><i class="PI_sort" id="jobSort2" type="2" title="'+ZPI18N.getString("zp.sortbydesc")+'" ref="sort"></i></div></li><li class="mw150"><b>'+ZPI18N.getString("zp.estimatedhours")+'</b></li><li class="mw150"><b>'+ZPI18N.getString("zp.loggedhours")+'</b></li><li class="mw50"></li><li class="mw150"><b>'+ZPI18N.getString("zp.status")+'</b></li><li class="mw150">'+ZPI18N.getString("zp.user(s)")+'</li><li class="mw100"></li></ul><div id="job-listtbody" style="min-width: 1300px;"></div></div></div></div>';layout.append(html),layout.find("#zp_view_record_delete").find("#zp_view_close_selection").off().on("click",function(){settingsPage.container.find("#joblist").find("input[type='checkbox']:checked").prop("checked",!1),settingsPage.container.find("#zp_view_record_delete").removeClass("opn").fadeOut(200,function(){$(this).siblings("#zp_views_formrecactions").fadeIn(200)})});let moreOpt=Timetracker.ImportExport.getImportExportArray(Timetracker.constants.JOB);moreOpt.length?Timetracker.Util.constructMoreOption(moreOpt,moreBtnId):layout.find("#"+moreBtnId+"Btn").hide(),Timetracker.Util.addEventListner("joblist","click",DashboardJobs.clickHandler,!0)}},constructFilter:function(){var layout=Timetracker.Util.getLayout();if(0==layout.find("#filterDiv").length){var filterOpt={status:{single:!0,label:ZPI18N.getString("zp.status"),paramId:"jobStatus"},assignedby:{single:!1,searchmode:"SETTINGS",label:ZPI18N.getString("zp.assignedby"),paramId:"assignedBy",tokenField:!0},assignedto:{single:!1,searchmode:"SETTINGS",label:ZPI18N.getString("zp.assignedto"),id:"assignedto",paramId:"assignedTo",tokenField:!0}};TimetrackerOperations.Filters.constructFilterDiv(filterOpt,{filterDivId:"baseContainer",filterClassDivId:"baseContainer"});var options=[];for(var i in Timetracker.jobs.assignedbyoptions)i&&null!=i&&options.push({value:i,label:Timetracker.jobs.assignedbyoptions[i]});var filterDiv=layout.find("#filterDiv");TimelyZComp.tokenField.addOptions(filterDiv.find("[compname=assignedby]"),options),filterDiv.find('[ref="applyFilter"]').off().on("click",function(){DashboardJobs.getJobsList()}),filterDiv.find('[ref="resetFilter"]').off().on("click",function(){TimetrackerOperations.Filters.clearFilters(),TimelyZComp.select.setValue(filterDiv.find('[compname="status"]'),0)})}TimetrackerOperations.Filters.toggleFilter(void 0,"baseContainer")},getParamsToFetchJobs:function(sorterObj,latestCompletedJobId){var params={mode:"getSchedule",projectId:Layout.Page.urlparam.id,jobStatus:"0",assignedBy:"0",assignedTo:"0",isAssigneeCount:!0,fetchLoggedHrs:!0,conreqcsr:csrfToken};0!=Timetracker.Util.getLayout().find("#filterDiv").length&&TimetrackerOperations.Filters.getFilterValues(params);let firescrollMode=getFirescrollMode(Timetracker.constants.MODES.PROJECT_DB_JOBS);return params.sIndex=Timetracker.FireScroll.getFetchCount(firescrollMode),params.limit=Timetracker.FireScroll.getMaxFetchCount(firescrollMode),latestCompletedJobId&&(params.latestCompletedJobId=latestCompletedJobId),void 0!==sorterObj&&null!==sorterObj?(Timetracker.jobs.sorterObj={},params.sortType=Timetracker.jobs.sorterObj.sortType=$(sorterObj).attr("type"),$(sorterObj).hasClass("desc")?params.isAscending=Timetracker.jobs.sorterObj.isAscending=!1:params.isAscending=Timetracker.jobs.sorterObj.isAscending=!0):null!==Timetracker.jobs.sorterObj?(params.sortType=Timetracker.jobs.sorterObj.sortType,params.isAscending=Timetracker.jobs.sorterObj.isAscending):Timetracker.Util.getSortAscendingValues(Timetracker.constants.JOB,params),params},clickHandler:function(eve){var ele=eve.target,ref=$(ele).attr("ref");if("skip"!=ref&&0!=$(ele).closest("ul").length){var data=$(ele).closest("ul").data("schval");if(void 0===data)return void("sort"==ref?Timetracker.projectDashboard.DashboardJobs.getJobsList(ele):"checkall"==ref&&Timetracker.views.checkAllCheckBoxes(ele,"job-listtbody",settingsPage.container));if("delete"==ref){var jobDispName=Timetracker.util.getJobDisplayName(),extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[jobDispName]),body:ZPI18N.getString("zp.common.delEntityInfo2",[jobDispName]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(data.jobId,Timetracker.jobs.Operations.showOpDelete,data.jobId,0,extraDtls)}else if("ZProject_job"==ref)Timetracker.jobs.Listing.showZProjects_jobs(data.zProjectsPortalId,data.zProjectsProjectRefId,data.zProjectsJobRefId);else if("checkbox"==ref)Timetracker.jobs.Operations.checkParticularJob(ele);else if("attachment"==ref)data.attachId?Timetracker.util.downloadFile(data.attachId,data.jobId,"job"):data.attachmentPath&&window.open(ZPeople.decodeTxt(data.attachmentPath));else if("showAssignees"==ref)Timetracker.jobs.Listing.showHideAssignees(ele,!0);else if("closeAssignees"==ref)Timetracker.jobs.Listing.showHideAssignees(ele,!0);else if("changeStatus"==ref){if($(ele).data().isprocessing)return;$(ele).data().isprocessing=!0,Timetracker.jobs.Operations.changeisCompleted(data.jobId,data.jobStatus,ele)}else"addAssignees"==ref?Timetracker.jobs.Operations.showMultiUserMapperPopup("job","single",data.jobId,"user"):"view"==ref?Timetracker.jobs.Operations.formAddEditView("",data.jobId,!0):"edit"==ref&&Timetracker.jobs.Operations.formAddEditView("",data.jobId,!1)}},addJob:function(){Timetracker.projects.Validations.hasProjectUser(Timetracker.projectDashboard.projectDtls.projectId)?1===Number(Timetracker.projectDashboard.projectDtls.projectStatus)?Timetracker.util.showAlert(1,ZPI18N.getString("zp.completedProjectCheckForAddingJob",[Timetracker.util.jobDispName,Timetracker.util.projectDispName])):Timetracker.jobs.Operations.formAddEditView():Timetracker.util.showAlert(1,ZPI18N.getString("zp.cannotaddjobtoanonuserproject",[Timetracker.util.jobDispName,Timetracker.util.projectDispName]))},loadMorePdbodJobs:function(result,params){if(void 0!==result.schArr){DashboardJobs.constructDashboardJobs(result,params);let firescrollMode=getFirescrollMode(Timetracker.constants.MODES.PROJECT_DB_JOBS);Timetracker.FireScroll.setFetchCount(firescrollMode,result.schArr)}},constructDashboardJobs:function(response,params){let layout=Layout.Page.container.find("[name=projectDashboardJobsContainer]");if(Timetracker.util.init(),TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),null!==response){Timetracker.jobs.pageLayout=null;let result=response.schArr&&0!==response.schArr.length?response.schArr:[];Timetracker.jobs.Listing.constructJobsHtml(result,"0"===params.assignedBy,!0),layout.find("#joblist").removeClass("zpl_DNI")}else{let noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[Timetracker.util.jobDispName]);(Timetracker.util.checkAddJobPermVar||Timetracker.projects.Util.isProjectHeadOrManager(Timetracker.projectDashboard.projectDtls.projectId))&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[Timetracker.util.jobDispName,ZPI18N.getString("zp.addcomponents",[Timetracker.util.getJobDisplayName(!0)])])),layout.find("#joblist").addClass("zpl_DNI"),Timetracker.Util.showHideNoData({msg:noDataMsg,appendToDiv:!0,layout:layout.find("#joblist").closest(".zpl_rgtcnt")})}}},DashboardAttachments={attachedFileNames:[],zfsIdsToBeRemoved:[],initDashboardAttachments:function(){let projectId=Layout.Page.urlparam.id,layout=Layout.Page.container.find("[name=projectDashboardAttachmentsContainer]");if(layout.removeClass("zpl_DNI"),isTabLoaded("attachments"))return;(Timetracker.projectDashboard.projectDtls.isEditAllowed||Timetracker.projectDashboard.projectDtls.projectOwner===erecno||Timetracker.projects.Util.isProjectHeadOrManager(projectId))&&layout.find("#attachments_header").removeClass("zpl_DNI"),layout.find("#uploadBtn").off("click").on("click",function(){DashboardAttachments.showUploadModal()}),layout.find("#projectAttachmentsDiv").addClass("zpl_DNI"),loadUnloadTab({tabName:"attachments",isLoaded:!0}),Timetracker.Util.showHideNoData({remove:!0,layout:layout.find("#projectAttachmentsDiv").parent()}),Timetracker.util.appendLoading({layout:layout.find("#projectAttachmentsDiv").parent()});let requestParams={url:Timetracker.constants.URL};requestParams.params={mode:"getProjectAttachments",projectId:projectId},requestParams.callback=Timetracker.projectDashboard.DashboardAttachments.constructAttachments,Timetracker.Request.send(requestParams)},constructAttachments:function(response){if(response.res&&"0"!==response.res){var attachments=response.resObj,projectAttachmentDiv=Layout.Page.container.find("#projectAttachmentsDiv");if(projectAttachmentDiv.html("").removeClass("zpl_DNI"),0===Object.keys(attachments).length){var noDataMsg=Timetracker.projects.formDetails.addPerm||Timetracker.projectDashboard.projectDtls.isEditAllowed?ZPI18N.getString("zp.noattachmentsfoundclicktoupload",['<a onclick="Timetracker.projectDashboard.DashboardAttachments.showUploadModal();">'+ZPI18N.getString("zp.here")+"</a>"]):ZPI18N.getString("zp.noattachmentsfound");Timetracker.Util.showHideNoData({msg:noDataMsg,appendToDiv:!0,layout:projectAttachmentDiv.parent()})}else projectAttachmentDiv.append(DashboardAttachments.getAttachmentsHtml(attachments).children()),Timetracker.projectDashboard.DashboardAttachments.constructMoreMenu(projectAttachmentDiv),Timetracker.projectDashboard.DashboardAttachments.constructInfoPopover(projectAttachmentDiv),Timetracker.projectDashboard.DashboardAttachments.addAttachmentEvent(projectAttachmentDiv);Timetracker.util.removeLoading(projectAttachmentDiv.parent())}else Timetracker.Request.failureCallback(response.errorCode,response.extraDtls)},getAttachmentsHtml:function(attachments){var contentDiv=$("<div></div>");if(attachments){var editAllowed=Timetracker.projectDashboard.projectDtls.isEditAllowed;$.each(attachments,function(attachmentId,attachment){var html,ownerObj=ZPeople.getUserDetailsById(attachment.owner),ownerInfo=ownerObj.empid+" - "+ownerObj.name,imgCls=DashboardAttachments.getAttachmentImageBasedOnFormat(ZSEC.Encoder.encodeForJavaScript(attachment.attachmentName),"-1"==attachment.attachmentId);"-1"==attachment.attachmentId?html='<div id="attachment_'+attachmentId+'" name="attachment"><div class="zpl_atchimg"><i class="'+imgCls+'"></i></div><div class="zpl_atchdtl" onclick="window.open(\''+ZPeople.decodeTxt(attachment.attachmentPath)+'\')" title="'+attachment.attachmentName+'"><h4>'+ZSEC.Encoder.encodeForHTML(DashboardAttachments.getTrimmedName(attachment.attachmentName))+'</h4></div><div class="zpl_atchicn">'+(editAllowed?'<i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'"  onclick="Timetracker.projectDashboard.DashboardAttachments.showDeleteAttachmentPopup(\''+attachmentId+"');\"></i>":"")+'<i class="PI_info" name="attachment_info" addedby="'+ownerInfo+'" addedon="'+attachment.createdDate+'"></i></div></div>':html='<div id="attachment_'+attachmentId+'" name="attachment"><div class="zpl_atchimg"><i class="'+imgCls+'"></i></div><div class="zpl_atchdtl" onclick="Timetracker.projectDashboard.DashboardAttachments.viewAttachment(\''+attachmentId+"','"+attachment.attachmentId+'\', event);" title="'+ZSEC.Encoder.encodeForHTMLAttribute(attachment.attachmentName)+'"><h4> '+ZSEC.Encoder.encodeForHTML(DashboardAttachments.getTrimmedName(attachment.attachmentName))+"</h4><p><span>"+attachment.size+'</span></p></div><div class="zpl_atchicn">'+(editAllowed?"":'<i class="PI_imprt" onclick="Timetracker.util.downloadFile(\''+attachment.attachmentId+"','"+Layout.Page.urlparam.id+"','project');\"></i>")+'<i class="PI_info" name="attachment_info" addedby="'+ownerInfo+'" addedon="'+attachment.createdDate+'"></i>'+(editAllowed?'<i id="attachment_more_'+attachmentId+'" ts_attachmentid="'+attachmentId+'" attachmentId="'+attachment.attachmentId+'" class="PI_more" title="'+ZPI18N.getString("zp.more")+'" onclick="Timetracker.projectDashboard.DashboardAttachments.showMore(this)"></i>':"")+"</div></div>";(html=$(html)).data("attachmentDtls",attachment),contentDiv.append(html)})}return contentDiv},addAttachmentEvent:function(projectAttachmentDiv){0==projectAttachmentDiv.find("#attachment_infopopup").length&&Timetracker.projectDashboard.DashboardAttachments.constructInfoPopover(projectAttachmentDiv);var pageMode=Timetracker.Page.getPageMode();0==projectAttachmentDiv.find(pageMode+"_attachment_morelist").length&&Timetracker.projectDashboard.DashboardAttachments.constructMoreMenu(projectAttachmentDiv),projectAttachmentDiv.find("[name=attachment_info]").on("mouseover",function(event){var ele=event.currentTarget,usrName=$(ele).attr("addedby"),addedDate=$(ele).attr("addedon"),infoPopup=Layout.Page.container.find("#attachment_infopopup");infoPopup.find("#info_usrname").text(usrName),infoPopup.find("#info_addeddate").text(addedDate),ZPeopleComponents.popover(infoPopup).setAttribute("forElement",ele),ZPeopleComponents.popover(infoPopup).open()}),projectAttachmentDiv.find("[name=attachment_info]").on("mouseout",function(){ZPeopleComponents.popover(Layout.Page.container.find("#attachment_infopopup")).close()})},constructMoreMenu:function(projectAttachmentDiv){if(0!=projectAttachmentDiv.find("[id^=attachment_more_").length){var option=[{id:"download",name:ZPI18N.getString("zp.Download"),iClass:"PI_imprt",callback:"Timetracker.projectDashboard.DashboardAttachments.downloadAttachment"},{separator:!0},{id:"delete",name:ZPI18N.getString("zp.delete"),iClass:"PI_delete",listClass:"red",callback:"Timetracker.projectDashboard.DashboardAttachments.deleteAttachmentFromMore"}],pageMode=Timetracker.Page.getPageMode(),forElementId=projectAttachmentDiv.attr("id"),elementId=pageMode+"_attachment_morelist";ZPeopleComponents.menu("#"+elementId)&&(ZPeopleComponents.menu("#"+elementId).destroy(),ZPeopleComponents.menu("#"+elementId).getElement().remove()),Timetracker.Util.constructMoreOption(option,elementId,forElementId,!0,{title:""}),projectAttachmentDiv.off("click")}},constructInfoPopover:function(projectAttachmentDiv){if(0!=projectAttachmentDiv.find(".PI_info").length&&0==projectAttachmentDiv.parent().find("#attachment_infopopup").length){var infoPopup='<div id="attachment_infopopup" class="zpl_popovr" style="display:none"><div class="zpl_popoverinr"><div><em>'+(ZPI18N.getString("zp.addedby")+": <b id='info_usrname'></b>")+"</em></div><div><em>"+(ZPI18N.getString("zp.addedon")+": <b id='info_addeddate'></b>")+"</em></div></div></div>";projectAttachmentDiv.after(infoPopup),ZPeopleComponents.popover(projectAttachmentDiv.parent().find("#attachment_infopopup"),{displayType:"callout",closeOnBodyClick:!0,position:"top"})}},showMore:function(obj){var pageMode=Timetracker.Page.getPageMode();ZPeopleComponents.menu("#"+pageMode+"_attachment_morelist").setAttribute("forElement",obj),ZPeopleComponents.menu("#"+pageMode+"_attachment_morelist").show()},downloadAttachment:function(event){var forElement=ZPeopleComponents.menu(event.currentTarget).getAttribute("forElement"),attachmentId=Layout.Page.container.find(forElement).attr("attachmentId");Timetracker.util.downloadFile(attachmentId,Layout.Page.urlparam.id,Timetracker.constants.PROJECT)},downloadAttachmentFromPreview:function(previewInstance){Timetracker.util.downloadFile(previewInstance.extraProps.attachmentId,Layout.Page.urlparam.id,Timetracker.constants.PROJECT)},deleteAttachmentFromMore:function(event){var forElement=ZPeopleComponents.menu(event.currentTarget).getAttribute("forElement"),tsAttachmentId=Layout.Page.container.find(forElement).attr("ts_attachmentid");Timetracker.projectDashboard.DashboardAttachments.showDeleteAttachmentPopup(tsAttachmentId)},showDeleteAttachmentPopup:function(tsAttachmentId){var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.sattachment")]),body:ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.sattachment")]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(tsAttachmentId,Timetracker.projectDashboard.DashboardAttachments.deleteAttachment,tsAttachmentId,0,extraDtls)},getTrimmedName:function(attachmentName){var trimmedName=ZSEC.Encoder.encodeForJavaScript(attachmentName),tempAttachmentDiv=$('<div style="width: 158px; line-height: 18px; font-size: 14px; word-wrap: break-word;"><span>'+ZSEC.Encoder.encodeForHTML(attachmentName)+"</span></div>");if($("body").append(tempAttachmentDiv),tempAttachmentDiv.innerHeight()>18){var extnIndex=attachmentName.lastIndexOf(".");if(""!==(extn=-1!==extnIndex?attachmentName.substring(extnIndex,attachmentName.length):"")&&extn.length<=5){var extn=attachmentName.substring(extnIndex,attachmentName.length);trimmedName=attachmentName.substring(0,10)+"..."+attachmentName.substring(extnIndex-3,extnIndex)+extn,tempAttachmentDiv.find("span").text(trimmedName),tempAttachmentDiv.innerHeight()>18&&(trimmedName=attachmentName.substring(0,8)+"..."+attachmentName.substring(extnIndex-3,extnIndex)+extn)}else trimmedName=attachmentName.substring(0,14)+"..."+attachmentName.substring(attachmentName.length-3,attachmentName.length),tempAttachmentDiv.find("span").text(trimmedName),tempAttachmentDiv.innerHeight()>18&&(trimmedName=attachmentName.substring(0,12)+"..."+attachmentName.substring(attachmentName.length-3,attachmentName.length))}return tempAttachmentDiv.remove(),trimmedName},getAttachmentImageBasedOnFormat:function(attachmentName,isFromWorkDrive){var imageClass="PI_ft_mtfile";if(isFromWorkDrive)imageClass="PI_workdrive";else if(attachmentName){var formatName=attachmentName.slice(attachmentName.lastIndexOf("."));".pdf"==formatName?imageClass="PI_ft_pdf":".zip"==formatName?imageClass="PI_ft_zip":".ppt"==formatName?imageClass="PI_ft_ppt":".gif"==formatName?imageClass="IC-gif":".txt"==formatName?imageClass="PI_ft_txt":".html"==formatName?imageClass="PI_ft_html":".doc"==formatName||".docx"==formatName?imageClass="PI_ft_doc":".jpg"==formatName||".jpeg"==formatName||".png"==formatName||".svg"==formatName?imageClass="PI_ft_img":".xls"!=formatName&&".xlsx"!=formatName&&".csv"!=formatName&&".tsv"!=formatName||(imageClass="PI_ft_xls")}return imageClass},showUploadModal:function(){var modalBody='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp"><h5><div class="zpl_flupld_img"></div>'+ZPI18N.getString("zp.upload")+" "+ZPI18N.getString("zp.files.from")+'<a class="zpl_lnk" id="sysFiles"><i class="PI_desktop"></i>'+ZPI18N.getString("zp.files.desktop")+'</a> <input type="file" id="attachmentInput" multiple onchange="Timetracker.projectDashboard.DashboardAttachments.setSelectedAttachments()" class="zpl_DNI">/';isWorkdriveAllowed&&(modalBody+='<a class="zpl_lnk" onclick="Timetracker.projectDashboard.DashboardAttachments.showWorkDriveModal(\'TTProjectDashBoard\')"><i class="PI_workdrive zpl_icnobg"></i>'+ZPI18N.getString("zp.workdrive")+"</a> /"),modalBody+='<a class="zpl_lnk" onclick="Timetracker.projectDashboard.DashboardAttachments.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl)"><i class="PI_cloud"></i>'+ZPI18N.getString("zp.files.cloud")+"</a>",modalBody+='</h5></div><p><span>Maximum size: 5MB</span></p></div></div></div><div class="zpl_secn zpl_DNI" id="attachList"><div><h5>'+ZPI18N.getString("zp.attachmentfiles")+'</h5></div><div><div class="zpl_atchd" id="attachmentsDiv"></div></div></div></div></div>';var modal=ModuleComp.Modal.setup({id:"projectAttachmentModal",type:3,header:ZPI18N.getString("zp.uploadfile"),body:modalBody,modalClass:"zpl_mmd",backdrop:!0,closeOnSubmit:!0,buttonValue:ZPI18N.getString("zp.upload"),successCallback:Timetracker.projectDashboard.DashboardAttachments.uploadAttachments,hiddenCallback:Timetracker.projectDashboard.DashboardAttachments.uploadModalHideCallback,closeonEsc:!0});modal.find("#sysFiles").on("click",function(){modal.find("#attachmentInput").trigger("click")})},showWorkDriveModal:function(ele){WorkDriveInt.showWorkDriveModal("TTProjectDashBoard",Layout.Page.urlparam.id,ele,!1)},workDriveCallBack:function(workDrive){if(DashboardAttachments.attachedFileNames.length+workDrive.length>5)Timetracker.util.showAlert(1,ZPI18N.getString("zp.attachmentslimiterror",[5]));else for(i in Layout.Page.container.find("#attachList").removeClass("zpl_DNI"),workDrive){if(-1===$.inArray(workDrive[i].name,DashboardAttachments.attachedFileNames)){var html='<div class="wdDoc zpl_cpd"><div class="zpl_atchimg"><i class="'+Timetracker.projectDashboard.DashboardAttachments.getAttachmentImageBasedOnFormat(workDrive[i].name,!0)+'"></i></div><div class="zpl_atchdtl"><h4>'+ZPeople.escapeHtml(workDrive[i].name)+'</h4></div><div class="zpl_atchicn"><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" onclick="Timetracker.projectDashboard.DashboardAttachments.removeSelectedAttachments(this);"></i></div></div>';html=$(html).data("data",workDrive[i]),Layout.Page.container.find("#attachmentsDiv").append(html),DashboardAttachments.attachedFileNames.push(workDrive[i].name)}}},showCloudPickerModal:function(url){CloudPicker.init("",DashboardAttachments.cloudPickerCallBack,"TT_Projects"),CloudPicker.construct(url)},cloudPickerCallBack:function(){var selectedAttachmentsCount=DashboardAttachments.attachedFileNames.length;if(++selectedAttachmentsCount>5)return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.attachmentslimiterror",[5]));let docObj=CloudPicker.getFileObj();try{docObj=JSON.parse(docObj)}catch(error){return void ZPeople.Message.failure(ZPI18N.getString("zp.photovalidationservererror"))}var fileName=decodeURIComponent(docObj.docName);if(-1===fileName.indexOf("<")&&-1===fileName.indexOf(">")){var attachmentsDiv=Layout.Page.container.find("#attachmentsDiv");Layout.Page.container.find("#attachList").removeClass("zpl_DNI");var html='<div class="cloudDoc zpl_cpd"><div class="zpl_atchimg"><i class="'+Timetracker.projectDashboard.DashboardAttachments.getAttachmentImageBasedOnFormat(docObj.docName)+'"></i></div><div class="zpl_atchdtl"><h4>'+ZPeople.escapeHtml(fileName)+'</h4></div><div class="zpl_atchicn"><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" onclick="Timetracker.projectDashboard.DashboardAttachments.removeSelectedAttachments(this);"></i></div></div>';(html=$(html)).data("data",docObj),attachmentsDiv.append(html),DashboardAttachments.attachedFileNames.push(docObj.docName)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.projectattachmentnameerror"))},uploadModalHideCallback:function(){if(DashboardAttachments.zfsIdsToBeRemoved.length>0){var fileIds="";$.each(DashboardAttachments.zfsIdsToBeRemoved,function(index,id){0!==index&&(fileIds+=","),fileIds+=id}),ZPeople.Request.send(Timetracker.constants.URL,{mode:"deleteFilesFromZFS",fileIds:fileIds,conreqcsr:csrfToken})}DashboardAttachments.attachedFileNames=[],DashboardAttachments.zfsIdsToBeRemoved=[]},setSelectedAttachments:function(){Layout.Page.container.find("#attachmentsDiv");var selectedAttachmentsCount=DashboardAttachments.attachedFileNames.length,showFileSizeError=!1,localAttachments=Layout.Page.container.find("#attachmentInput")[0].files;if(localAttachments){if((selectedAttachmentsCount+=localAttachments.length)>5)return Layout.Page.container.find("#attachmentInput").val(""),void Timetracker.util.showAlert(1,ZPI18N.getString("zp.attachmentslimiterror",[5]));for(var showNameError=!1,index=0;index<localAttachments.length;index++){var localAttachment=localAttachments[index];if(-1===localAttachment.name.indexOf("<")&&-1===localAttachment.name.indexOf(">"))-1===$.inArray(localAttachment.name,DashboardAttachments.attachedFileNames)&&(localAttachment.size<=5242880?Timetracker.util.uploadFile(localAttachment,Timetracker.constants.PROJECT,Timetracker.projectDashboard.DashboardAttachments.uploadDeskTopAttachmentCallback):showFileSizeError=!0);else showNameError=!0}showNameError&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.projectattachmentnameerror")),Layout.Page.container.find("#attachmentInput").val("")}showFileSizeError&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.attachmentssizeerror")),DashboardAttachments.attachedFileNames.length>0&&(Layout.Page.container.find("#attachList").removeClass("zpl_DNI"),Layout.Page.container.find("#uploadinfofooter").find("#upselinfo").text(ZPI18N.getString("zp.noofattachmentsselected",[DashboardAttachments.attachedFileNames.length])))},uploadDeskTopAttachmentCallback:function(uploadResponse){var attachmentsDiv=Layout.Page.container.find("#attachmentsDiv");if(uploadResponse&&uploadResponse.fileInfo){var localsize=Timetracker.projectDashboard.DashboardAttachments.convertBytesToMBorKB(uploadResponse.fileInfo.fileSize),html='<div class="localDoc zpl_cpd"><div class="zpl_atchimg"><i class="'+Timetracker.projectDashboard.DashboardAttachments.getAttachmentImageBasedOnFormat(uploadResponse.fileInfo.fileName)+'"></i></div><div class="zpl_atchdtl"><h4>'+ZPeople.escapeHtml(uploadResponse.fileInfo.fileName)+"</h4><p><span>"+localsize+'</span></p></div><div class="zpl_atchicn"><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" onclick="Timetracker.projectDashboard.DashboardAttachments.removeSelectedAttachments(this);"></i></div></div>';(html=$(html)).data("data",uploadResponse.fileInfo),attachmentsDiv.append(html),Layout.Page.container.find("#attachList").removeClass("zpl_DNI"),DashboardAttachments.attachedFileNames.push(uploadResponse.fileInfo.fileName)}else Timetracker.util.showAlert(0,ZPI18N.getString("zp.filenotuploaded"));DashboardAttachments.attachedFileNames.length>0&&Layout.Page.container.find("#uploadinfofooter").find("#upselinfo").text(ZPI18N.getString("zp.noofattachmentsselected",[DashboardAttachments.attachedFileNames.length]))},convertBytesToMBorKB:function(value){if(value&&!isNaN(value)){var data=parseInt(value)/1024;return data=data>1024?(data/1024).toFixed(2)+"MB":data.toFixed(2)+"KB"}return value},removeSelectedAttachments:function(attachmentObj){var attachmentName,data=$(attachmentObj).parent().parent().data("data");attachmentName=$(attachmentObj).parent().parent().hasClass("localDoc")?data.fileName:$(attachmentObj).parent().parent().hasClass("cloudDoc")?data.docName:data.name;Layout.Page.container.find("#attachmentsDiv");var existingIndex=$.inArray(attachmentName,DashboardAttachments.attachedFileNames);-1!==existingIndex&&(DashboardAttachments.attachedFileNames.splice(existingIndex,1),$(attachmentObj).parent().parent().hasClass("localDoc")&&DashboardAttachments.zfsIdsToBeRemoved.push(data.fileId),$(attachmentObj).parent().parent().remove(),Layout.Page.container.find("#uploadinfofooter").find("#upselinfo").text(ZPI18N.getString("zp.noofattachmentsselected",[DashboardAttachments.attachedFileNames.length]))),0===DashboardAttachments.attachedFileNames.length&&(Layout.Page.container.find("#attachList").addClass("zpl_DNI"),Layout.Page.container.find("#uploadinfofooter").find("#upselinfo").text(""))},uploadAttachments:function(){Timetracker.util.freezeSubmit("projectAttachmentModal","zp_modal_blubtn");var localAttachments=Layout.Page.container.find("#projectAttachmentModal").find(".localDoc"),cloudAttachments=Layout.Page.container.find("#projectAttachmentModal").find(".cloudDoc"),wdAttachments=Layout.Page.container.find("#projectAttachmentModal").find(".wdDoc"),attachmentsCount=localAttachments.length+cloudAttachments.length+wdAttachments.length;if(attachmentsCount>5)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.attachmentslimiterror",[5])),void Timetracker.util.unfreezeSubmit("projectAttachmentModal","zp_modal_blubtn");if(0===attachmentsCount)Timetracker.util.showAlert(1,ZPI18N.getString("zp.noattachmentsselected")),Timetracker.util.unfreezeSubmit("projectAttachmentModal","zp_modal_blubtn");else{let projectId=Layout.Page.urlparam.id;var formData=new FormData;if(formData.append("mode","uploadProjectAttachments"),formData.append("projectId",projectId),formData.append("conreqcsr",csrfToken),localAttachments.length>0){var fileIds="";localAttachments.each(function(index){var attachmentData=$(this).data("data");attachmentData&&(0!==index&&(fileIds+=","),fileIds+=attachmentData.fileId)}),formData.append("desktopAttachmentIds",fileIds)}if(cloudAttachments.length>0){var cloudAttachmentsList=[];cloudAttachments.each(function(){var attachmentData=$(this).data("data");attachmentData&&cloudAttachmentsList.push(attachmentData)}),formData.append("cloudAttachment",JSON.stringify(cloudAttachmentsList))}if(wdAttachments.length>0){var wdAttachmentsList=[];wdAttachments.each(function(){var attachmentData=$(this).data("data");attachmentData&&wdAttachmentsList.push(attachmentData)}),formData.append("workDriveAttachment",JSON.stringify(wdAttachmentsList))}$.ajax({url:Timetracker.constants.URL,type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){if(response.res&&"0"!==response.res){var responseObj=response.resObj;if(responseObj.allUploaded)Timetracker.util.showAlert(2,ZPI18N.getString("zp.attachmentsuploaded"));else{message="";responseObj.skippedDueToMaxCount?message=responseObj.allSkipped?ZPI18N.getString("zp.projectattachmentuploaderror3",[50]):ZPI18N.getString("zp.projectattachmentuploaderror1",[50]):responseObj.skippedDueToMaxSize&&(message=responseObj.allSkipped?ZPI18N.getString("zp.projectattachmentuploaderror4",["5MB"]):ZPI18N.getString("zp.projectattachmentuploaderror2",["5MB"])),Timetracker.util.showAlert(1,message)}if(responseObj.uploaded){var contentDiv=DashboardAttachments.getAttachmentsHtml(responseObj.uploaded),attachmentsDiv=Layout.Page.container.find("#projectAttachmentsDiv");0===attachmentsDiv.find("#projectAttachmentsList").children().length&&Timetracker.Util.showHideNoData({remove:!0,layout:attachmentsDiv.parent()}),attachmentsDiv.append(contentDiv.children()),Timetracker.projectDashboard.DashboardAttachments.addAttachmentEvent(attachmentsDiv),loadUnloadTab({tabName:"attachments",isLoaded:!1,projectId:projectId,otherContainersOnly:!0})}}else{var message=Timetracker.Util.getFailureMessageByCode(response.errorCode,response.extraDtls,!0);Timetracker.util.showAlert(0,message)}ModuleComp.Modal.hide("projectAttachmentModal")}}),Timetracker.util.unfreezeSubmit("projectAttachmentModal","zp_modal_blubtn")}},deleteAttachment:function(attachmentId){let requestParams={};requestParams.url=Timetracker.constants.URL,requestParams.params={mode:"deleteProjectAttachment",projectId:Layout.Page.urlparam.id,attachmentId:attachmentId},requestParams.callback=Timetracker.projectDashboard.DashboardAttachments.deleteAttachmentCallback,Timetracker.Request.send(requestParams)},deleteAttachmentCallback:function(response,params){if(response.res&&"0"!==response.res){Timetracker.util.showAlert(2,ZPI18N.getString("zp.deleted.successfully.msg",[ZPI18N.getString("zp.local.Attachment")]));let attachmentsDiv=Layout.Page.container.find("#projectAttachmentsDiv");if(attachmentsDiv.find("#attachment_"+params.attachmentId).remove(),0===attachmentsDiv.find("[name='attachment']").length){let noDataMsg=Timetracker.projects.formDetails.addPerm||Timetracker.projectDashboard.projectDtls.isEditAllowed?ZPI18N.getString("zp.noattachmentsfoundclicktoupload",['<a onclick="Timetracker.projectDashboard.DashboardAttachments.showUploadModal();">'+ZPI18N.getString("zp.here")+"</a>"]):ZPI18N.getString("zp.noattachmentsfound");Timetracker.Util.showHideNoData({msg:noDataMsg,appendToDiv:!0,layout:attachmentsDiv.parent()})}loadUnloadTab({tabName:"attachments",isLoaded:!1,projectId:params.projectId,otherContainersOnly:!0})}else Timetracker.Request.failureCallback(response.errorCode,response.extraDtls)},viewAttachment:async function(attachmentId,zfsFileId,event){event.preventDefault();var fileDtls=Layout.Page.container.find("#projectAttachmentsDiv").find("#attachment_"+attachmentId).data("attachmentDtls"),fileName=ZSEC.Encoder.encodeForHTML(fileDtls.attachmentName),fileExtension="",zohoDocsFileExtn=["xls","xlsx","sxc","ods","csv","tsv","doc","docx","sxw","odt","rtf","ppt","pptx","pps","odp","sxi"];if(-1!=fileName.lastIndexOf(".")&&(fileExtension=(fileExtension=fileName.substr(fileName.lastIndexOf(".")+1,fileName.length)).toLowerCase()),""===fileExtension||-1===$.inArray(fileExtension,["pdf","jpg","jpeg","png","gif","html","htm","txt"])&&-1===$.inArray(fileExtension,zohoDocsFileExtn))return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.fileviewerror"));let previewInstance=new LightBox(fileName);if(previewInstance.isImage="jpg"===fileExtension||"jpeg"===fileExtension||"png"===fileExtension||"gif"===fileExtension,previewInstance.needDownload=!0,previewInstance.setDownloadCallback(Timetracker.projectDashboard.DashboardAttachments.downloadAttachmentFromPreview),previewInstance.extraProps={attachmentId:zfsFileId},-1!==$.inArray(fileExtension,zohoDocsFileExtn)){var formData=new FormData;formData.append("mode","getInfoForZohoBasedFilePreview"),formData.append("projectId",Layout.Page.urlparam.id),formData.append("fileId",zfsFileId),formData.append("conreqcsr",csrfToken);var res=await $.ajax({url:Timetracker.constants.URL,type:"POST",data:formData,contentType:!1,processData:!1});if(!res||!res.url)return void Timetracker.util.showAlert(0,ZPI18N.getString("zp.ttfailuremsg"));let previewUrl=res.url;0!=previewUrl.indexOf("https:")&&"undefined"!=contextPath&&"null"!=contextPath&&(previewUrl="/"+contextPath+previewUrl),previewInstance.viewUrl=previewUrl,previewInstance.show()}else previewInstance.viewUrl=(contextPath&&"undefined"!==contextPath&&"null"!==contextPath?"/"+contextPath:"")+"/viewFile?action=previewTimetrackerFiles&mode="+Timetracker.constants.PROJECT+"&fileId="+zfsFileId+"&recordId="+Layout.Page.urlparam.id,previewInstance.show()}};return{init:function(){Timetracker.initSetup(),Timetracker.setWorkitemCache();let projectId=Layout.Page.urlparam.id;getProjectDtls(projectId).then(function(data){intiProject(data)})},URLActions:{setThirdLevelUrlParams:params=>{params.submode="home-team"},getThirdLevelUrl:hash=>-1!==hash.indexOf("home/team/projectdashboard")?"home/team/projects":hash,redirectToBasePage:function(){if(-1!=Layout.Page.hash.indexOf("home/team/projectdashboard"))Timetracker.projects.Team.setRefreshValue(!0),window.location.href="#home/team/projects";else{let url=settingsUrlProps.niceUrl;url=url.startsWith("operations/timetracker/projects/")?"#"+url.slice(0,url.indexOf("projectdashboard"))+"listview":"#"+url.slice(0,url.indexOf("projectdashboard"))+"projects/listview",Timetracker.Page.isSelectedUser()&&(url+="-userId:"+Timetracker.Team.getSelectedUser()),window.location.href=url}}},projectDtls:null,refreshData:function(projectId,extraDtls){let skipRefreshProjectDashboardDtls=extraDtls&&extraDtls.skipRefreshProjectDashboardDtls,forceRefreshProjectDashboardDtls=extraDtls&&extraDtls.forceRefreshProjectDashboardDtls;skipRefreshProjectDashboardDtls||(forceRefreshProjectDashboardDtls||Timetracker.projectDashboard.projectDtls&&Timetracker.projectDashboard.projectDtls.projectId==projectId)&&(Timetracker.projectDashboard.projectDtls=null),Timetracker.projects.Team.setRefreshValue(!0);let json={isLoaded:!1,projectId:projectId};extraDtls&&extraDtls.otherContainersOnly&&(json.otherContainersOnly=!0),loadUnloadTab(json)},showDescriptionModal:function(viewOnly){let description=Timetracker.projectDashboard.projectDtls.projectDescription?Timetracker.projectDashboard.projectDtls.projectDescription:"",bodyHtml='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn">'+(viewOnly?"":"<div><label>"+ZPI18N.getString("zp.componentErrMsg.Invalid_empty3",[ZPI18N.getString("zp.description")])+"</label></div>")+"<div>"+(viewOnly?'<span name="content">'+description+"</span>":'<textarea name="content" type="text" rows="5" class="ztextbox">'+description+"</textarea>")+"</div></div></div></div>",json={id:"projectdashboard_description_modal",type:3,header:ZPI18N.getString("zp.description"),body:bodyHtml,backdrop:!0,deleteOnHide:!0,closeOnSubmit:!0,successCallback:Timetracker.projectDashboard.editDescription,closeonEsc:!0,extraDetails:{projectId:Layout.Page.urlparam.id}};viewOnly?(json.disableSubmitButton=!0,json.whitebtnvalue=ZPI18N.getString("zp.close")):(json.buttonValue=ZPI18N.getString("zp.submit"),json.successCallback=Timetracker.projectDashboard.editDescription),ModuleComp.Modal.setup(json)},editDescription:function(){Timetracker.util.freezeSubmit("projectdashboard_description_modal","zp_modal_blubtn");let description=Layout.Page.container.find("#projectdashboard_description_modal").find("[name=content]").val();if(""===description.trim()&&(description=""),description==Timetracker.projectDashboard.projectDtls.projectDescription)return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade"));let params={mode:"modifyProject",projectId:Layout.Page.urlparam.id,description:description,conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,params,function(response){if(response.res&&"0"!==response.res){Timetracker.util.showAlert(2,ZPI18N.getString("zp.updatedsuccessfully"));var desc=response.resObj&&response.resObj.hasOwnProperty("projectDescription")?response.resObj.projectDescription:"";setProjectDescription(desc),resetAndUpdateProjectDtlsCache(Layout.Page.urlparam.id,response.resObj&&response.resObj.hasOwnProperty("projectDescription")?{projectDescription:desc}:null)}else Timetracker.Request.failureCallback(response.errorCode,response.extraDtls)})},getProjectDtls:getProjectDtls,Dashboard:Dashboard,DashboardUsers:DashboardUsers,DashboardJobs:DashboardJobs,DashboardFeeds:DashboardFeeds,DashboardAttachments:DashboardAttachments}}(),Timetracker.jobSchedule={calview:1,JobSchedule:"JobSchedule",isEmpFetchAvail:!0,usersList:[],currPopupDate:"",currPopupUser:"",currPopupMode:"",usersShiftData:{},dataFetchedCache:{},init:function(){TimetrackerOperations.init(),Timetracker.setWorkitemCache(),Timetracker.permissionCheckForOperPages()&&(Timetracker.Page.isSelectedUser()&&Timetracker.Team.initPage(),Timetracker.jobSchedule.getJobSchedulePage())},pub_cache:{count:0},hasCustomFields:function(){return ZPeople.Module.MODULE_DATA.timetracker.isJobScheduleCustomized&&void 0!==ZPeople.Module.MODULE_DATA.timetracker.jobScheduleCustomFields},getCustomFields:function(){return Timetracker.jobSchedule.hasCustomFields()?ZPeople.Module.MODULE_DATA.timetracker.jobScheduleCustomFields:void 0},hasFieldPermissions:function(){return ZPeople.Module.MODULE_DATA.timetracker.isJobScheduleCustomized&&void 0!==ZPeople.Module.MODULE_DATA.timetracker.jobSchFieldPermissions},getFieldPermissions:function(){return Timetracker.jobSchedule.hasFieldPermissions()?ZPeople.Module.MODULE_DATA.timetracker.jobSchFieldPermissions:void 0},isJobSchTLExtendEnabled:function(){return ZPeople.Module.MODULE_DATA.timetracker.settingDetails&&1==ZPeople.Module.MODULE_DATA.timetracker.settingDetails.TS_jobschTimeIntervalTLRestrict_Extend},resetCache:function(){Timetracker.jobSchedule.dataFetchedCache.hasOwnProperty("ts_operations")&&Timetracker.FireScroll.resetDataOnLoad(Timetracker.jobSchedule.fireScroll.getMode("ts_operations")),Timetracker.jobSchedule.dataFetchedCache.hasOwnProperty("ts_team")&&Timetracker.FireScroll.resetDataOnLoad(Timetracker.jobSchedule.fireScroll.getMode("ts_team")),Timetracker.jobSchedule.dataFetchedCache={}},isDataFetched:function(){let pageMode=Timetracker.Page.getPageMode();return["ts_operations","ts_team","ts_mydata"].includes(pageMode)?!0===Timetracker.jobSchedule.dataFetchedCache[pageMode]:!!["ts_operuser","ts_teamuser"].includes(pageMode)&&Timetracker.jobSchedule.dataFetchedCache[pageMode]===Timetracker.Team.getSelectedUser()},setDataFetched:function(pageMode,selectedUser){if(["ts_operations","ts_team","ts_mydata"].includes(pageMode))return Timetracker.jobSchedule.dataFetchedCache[pageMode]=!0;["ts_operuser","ts_teamuser"].includes(pageMode)&&selectedUser&&(Timetracker.jobSchedule.dataFetchedCache[pageMode]=selectedUser)},getPageModeValue:function(){let pageMode=Timetracker.Page.getPageMode(),pageModeValue={};return"ts_operuser"!=pageMode&&"ts_teamuser"!=pageMode||(pageModeValue.selectedUser=Timetracker.Team.getSelectedUser()),pageModeValue.pageMode=pageMode,pageModeValue},setJobColor:function(jobId){var jobColor=Timetracker.jobs.defJobColor,jobArray=Timetracker.jobs.jobData;if(jobArray&&jobId&&"0"!==jobId){var jobIndex=Timetracker.projects.Operations.findJSONArrayIndex(jobArray,jobId,"jobId");jobIndex&&"-1"!==jobIndex&&(jobColor=jobArray[jobIndex].jobColor?jobArray[jobIndex].jobColor:jobColor)}var classList="zpl_ibg zpl_cpd zpl_drpdwn-js jc_bg"+(jobColor="0"===jobColor?Timetracker.jobs.defJobColor:jobColor);Layout.Page.container.find("#schColorBox").attr("class",classList)},setPositionForHeader:function(){var layout=Layout.Page.container.find("#day_view_jobsch:visible");if(layout.length){var bodyleft=layout.find("ul#dayview_body>li.zpuser-row:first").offset().left,ulDom=layout.find("ul.zpheader-list");ulDom.find("li.zpuser-row>div.FXD_HDR").css("left",-($(ulDom).offset().left-bodyleft)+"px")}},getJobSchedulePage:async function(){var jobSch=settingsPage.container.find("#timetrackerJobScheduler");0==jobSch.length?(await Timetracker.jobSchedule.constructJobSchPage(),jobSch.find("#jobschd_clone").attr("title",ZPI18N.getString("zp.clonejobschd",[ZPI18N.getString("zp.week")])),Timetracker.jobSchedule.calview=1,settingsPage.container.ztooltip(),Timetracker.jobSchedule.initLoad()):Timetracker.jobSchedule.isDataFetched()||(Timetracker.jobSchedule.setDefaultFilterParams(),Timetracker.jobSchedule.getActiveView(),Timetracker.jobSchedule.initLoad(),settingsPage.container.ztooltip()),Timetracker.jobSchedule.getActiveView()},isJobScheduleEnabled:function(){return ZPeople.isZPNewUI()||void 0!==ZPeople.Module.MODULE_DATA.timetracker.isJobScheduleEnabled&&!0===ZPeople.Module.MODULE_DATA.timetracker.isJobScheduleEnabled},getActiveView:function(){var selectedId=Timetracker.Util.getLayout().find("#periodType").find(".zpl_act").attr("id");return"view_week"===selectedId?Timetracker.jobSchedule.calview=1:"view_day"===selectedId&&(Timetracker.jobSchedule.calview=0),Timetracker.jobSchedule.calview},isUserView:function(){var pageMode=Timetracker.Page.getPageMode();return"ts_mydata"==pageMode||"ts_teamuser"==pageMode||"ts_operuser"==pageMode},constructJobSchPage:async function(){var pageMode=Timetracker.Page.getPageMode(),layout=settingsPage.container,moreBtnId="jobSchMore_"+pageMode.split("_")[1]+"_",html='<div class="zpl_btnmnu" id="header"><div></div><div class="j-cnt-cntr"><div class="zpl_inav"><i class="PI_alft" aria-label="'+ZPI18N.getString("zp.common.previous")+'" tabindex="0" title="'+ZPI18N.getString("zp.previous")+'" id="goToPreviousBtn"></i><i class="PI_monthly" id="tl_datePicker"></i><i class="PI_argt"  aria-label="'+ZPI18N.getString("zp.common.next")+'" tabindex="0" title="'+ZPI18N.getString("zp.next")+'" id="goToNextBtn"></i></div><b id="dateNavigatorText"></b></div><div class="zpl_rgt" id="timetrackerJobScheduler"><ul class="zpl_grpmnu" id="periodType"><li ref="day" id="view_day">'+ZPI18N.getString("zp.cday")+'</li><li class="zpl_act" id="view_week" ref="week">'+ZPI18N.getString("zp.week")+'</li></ul><button id="jobschd_clone" ref="clone" class="zlabel zlabel--blue zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.clone")+'</button><div class="d-flex"><span class="pndng_sts"><b class="red" id="jsch_pub_count"></b>'+ZPI18N.getString("zp.jobscheduer.pendingpub",[""])+'</span><button id="jsch_pub_button" class="zlabel zlabel--blue zlabel--medium" aria-label="'+ZPI18N.getString("zp.published")+'" tabindex="0" ref="publish">'+ZPI18N.getString("zp.publish")+'</button></div><i class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" aria-label="'+ZPI18N.getString("zp.filter")+'" tabindex="0" ref="toggleFilter"></i><i class="zpl_ibg PI_more" aria-label="'+ZPI18N.getString("zp.more")+'" tabindex="0" title="'+ZPI18N.getString("zp.more")+'" ref="more" id="'+moreBtnId+'Btn"></i></div></div>'+TimetrackerOperations.Filters.filterHeaderHtml+'<div class="zpl_tbllftfxd"><div class="zpl_rgtcnt"><div class="zpl_tblres "><div id="week_view_jobsch" style="display: none;"><table class="zpl_tbl zpl_shftmap zpl_shftwkvw" role="grid" id="tt_jobschedule_weekly"><thead id="weekly_thead"></thead><tbody id="weekly_tbody"></tbody></table></div><div id="day_view_jobsch" class="_dayvw" style="display: none;"><table class="zpl_tbl zpl_shftmap" data-tab="jbschday" id="tt_jobschedule_daily"><thead id="daily_thead"></thead><tbody id="daily_tbody"></tbody></table></div><div id="user_week_view_jobsch" class="_dayvw" style="display: none;"><table class="zpl_tbl zpl_shftmap" data-tab="jbschweek_mydata" id="tt_jobschedule_mydata_weekly"><thead id="weekly_thead"></thead><tbody id="weekly_tbody"></tbody></table></div><div id="user_day_view_jobsch" class="_dayvw" style="display: none;"><table class="zpl_tbl zpl_shftmap" data-tab="jbschday_mydata" id="tt_jobschedule_mydata_daily"><thead id="daily_thead"></thead><tbody id="daily_tbody"></tbody></table></div></div></div></div>';layout.append(html),layout.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.jobschedule")]),tabindex:"0"}),Timetracker.isDataAdminForAllUsers()||settingsPage.container.find("#jobschd_clone").remove();var dateNavigationDtls={};dateNavigationDtls.mode=pageMode+"_"+Timetracker.jobSchedule.JobSchedule,dateNavigationDtls.containerId=settingsPage.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.displayDateAsText=!0,dateNavigationDtls.navigationCallback=Timetracker.jobSchedule.constructJobSchedule,ZPCommonUtil.DateNavigator.init(dateNavigationDtls),ZPCommonUtil.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPCommonUtil.DateNavigator.TYPE.WEEKLY,ZPCommonUtil.DateNavigator.TENSE.CURRENT);var date=layout.find("#dateNavigatorText").text();layout.find(".zpl_inav").attr({"aria-label":ZPI18N.getString("zp.common.period")+date,tabindex:"0"}),Timetracker.jobSchedule.calview=1;var callback=function(dateVal,obj,data){settingsPage.container.find("#tl_datePicker").html("");var selPeriod=1===Timetracker.jobSchedule.calview?{from:data.fromDate,to:data.toDate,type:ZPCommonUtil.DateNavigator.TYPE.WEEKLY}:{day:dateVal,type:ZPCommonUtil.DateNavigator.TYPE.DAILY};ZPCommonUtil.DateNavigator.setPeriod(dateNavigationDtls.mode,selPeriod.type,void 0,!1,selPeriod),Timetracker.jobSchedule.constructJobSchedule()};if(settingsPage.container.find("#tl_datePicker").off().on("click",function(event){1===Timetracker.jobSchedule.calview?Calendar.setUpCalendar(event,this,void 0,void 0,callback,void 0,{weekselection:!0,constructOnWeekstarts:!0}):0===Timetracker.jobSchedule.calview&&Calendar.setUpCalendar(event,this,0,void 0,callback,void 0,{constructOnWeekstarts:!0})}),filterOpt={employee:{label:ZPI18N.getString("zp.employee"),id:"jobsch_assignedto",paramId:"users",filterCallback:!0,tokenField:!0,extraParams:{projectManagerPerm:!0}},directReportees:{type:"checkbox",checkLabel:ZPI18N.getString("zp.showdirectreportees"),id:"jobsch_includeOnlyDirectSubordinates",paramId:"isDirectSubOnlyNeeded",defValue:!1},client:{label:Timetracker.util.getClientDisplayName(),paramId:"clientId",tokenField:!0},project:{label:Timetracker.util.getProjectDisplayName(),paramId:"projectId",tokenField:!0},job:{label:Timetracker.util.getJobDisplayName(),paramId:"jobId",tokenField:!0},pubStatus:{single:!0,label:ZPI18N.getString("zp.publishstatus"),paramId:"pubStatus",defValue:0}},Timetracker.jobScheduleForm.isClientFilterAllowed()||delete filterOpt.client,Timetracker.jobSchedule.hasCustomFields()){var customFields=Timetracker.jobSchedule.getCustomFields();for(var iterator in customFields){var field=customFields[iterator];if(25===field.componentType){var details={tokenField:!0,placeholder:ZPI18N.getString("zp.all")};details.data=field.options,details.dataMapping={label:"optionValue",value:"optionId"},filterOpt[field.labelName]={label:field.labelName,tokenField:!0,details:details,attr:'filtertype="customFilter"',showHeader:!0}}}}"ts_operations"==pageMode||"ts_team"==pageMode?(filterOpt.department={label:ZPI18N.getString("zp.department"),paramId:"deptId",tokenField:!0},filterOpt.location={label:ZPI18N.getString("zp.location"),paramId:"locationId",tokenField:!0},Timetracker.generalSettings.isOrgTagEnabled()&&(filterOpt.orgTag={label:ZPeople.orgTagDisplayName,paramId:"orgTagId",tokenField:!0}),filterOpt.designation={label:ZPI18N.getString("zp.designation"),paramId:"designationId",tokenField:!0},isOrgStructureEnabled&&(filterOpt.division={label:ZPeople.orgStructureDispNameMap.division,paramId:"divisionId",tokenField:!0},filterOpt.businessUnit={label:ZPeople.orgStructureDispNameMap.unit,paramId:"businessUnitId",tokenField:!0},filterOpt.legalEntity={label:ZPeople.orgStructureDispNameMap.entity,paramId:"legalEntityId",tokenField:!0})):(delete filterOpt.employee,delete filterOpt.directReportees),await TimetrackerOperations.Filters.constructFilterDiv(filterOpt);var empFilter=settingsPage.container.find('[compname="employee"]');0!=empFilter.length&&(empFilter.off().on("ztokenfieldtokenadd ztokenfieldtokenremove",TimetrackerOperations.Filters.filterOnChangeCallback),ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?settingsPage.container.find('[compname="directReportees"]').closest(".zpl_secn").removeClass("zpl_DNI"):settingsPage.container.find('[compname="directReportees"]').closest(".zpl_secn").addClass("zpl_DNI")),Timetracker.jobSchedule.setDefaultFilterParams();var moreOpt=[{id:"jobScheduleImportIcon",name:ZPI18N.getString("zp.import"),callback:"Timetracker.jobSchedule.Import.construct",iClass:"PI_imprt"},{id:"jobScheduleExportIcon",name:ZPI18N.getString("zp.export"),callback:"Timetracker.jobSchedule.dataOperations.jsExportcallback",iClass:"PI_exprt"},{id:"jobScheduleDownloadIcon",name:ZPI18N.getString("zp.downloadpdf"),callback:"Timetracker.jobSchedule.dataOperations.downloadJobSchedule",iClass:"PI_ft_pdf zpl_icnobg"},{id:"jobSchedulePrintIcon",name:ZPI18N.getString("zp.print"),callback:"Timetracker.jobSchedule.generatePrintReport",iClass:"PI_print"}];Timetracker.jobSchedule.showimportoption()||moreOpt.splice(0,1),Timetracker.Util.constructMoreOption(moreOpt,moreBtnId),settingsPage.container.addClass("zpl_tblfxd zpl_sstbl zpl_crdwthful zpl_act"),Timetracker.Util.addEventListner("header","click",Timetracker.jobSchedule.headerClickHandler,!0),Timetracker.Util.addEventListner("filterDiv","click",Timetracker.jobSchedule.headerClickHandler,!0)},initLoad:function(){var layout=Timetracker.Util.getLayout();Timetracker.jobSchedule.isJobScheduleEnabled()?(TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),Timetracker.jobSchedule.constructJobSchedule()):(layout.html("<div class='zpl_rgtcnt'></div>"),Timetracker.Util.showHideNoData({div:layout,msg:ZPI18N.getString("zp.notallowedforpage"),cls:"zp_nd_permission"}))},constructJobSchedule:function(){TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),Timetracker.Util.showHideNoData({remove:!0}),1===Timetracker.jobSchedule.calview?Timetracker.jobSchedule.Listing.getJobScheduleForWeekview():0===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.Listing.getJobScheduleForDayview(),settingsPage.container.ztooltip()},headerClickHandler:function(event){var ele=event.target,ref=$(ele).attr("ref");"clone"==ref?onclick=Timetracker.jobSchedule.dataOperations.cloneJobSchedules():"publish"==ref?onclick=Timetracker.jobSchedule.dataOperations.publishSchedules():"week"==ref||"day"==ref?Timetracker.jobSchedule.changeJobScheduleView(ref):"toggleFilter"==ref?TimetrackerOperations.Filters.toggleFilter():"applyFilter"==ref?Timetracker.jobSchedule.applyFilter():"resetFilter"==ref&&Timetracker.jobSchedule.resetFilter()},generatePrintReport:function(){Timetracker.jobSchedule.dataOperations.print(null,!1,"0",settingsPage.container.find("#dateNavigatorText").text(),void 0,void 0,!0)},applyFilter:function(){Timetracker.Util.getLayout().find("#tt_filterResultsHeader.timetracker").addClass("zpl_DNI"),Timetracker.jobSchedule.constructJobSchedule(),TimetrackerOperations.Filters.setFilterHeader(Timetracker.jobSchedule.removeTopFilter)},resetFilter:function(){Timetracker.jobSchedule.setDefaultFilterParams()},removeTopFilter:function(event,clearAll){if(clearAll)Timetracker.jobSchedule.resetFilter();else{var ele=event.target,entity=$(ele).closest("li").attr("filterno");filterDiv=settingsPage.container.find("#filterDiv"),"pubStatus"==entity?TimelyZComp.select.setValue(filterDiv.find('[compname="pubStatus"]'),0):"directReportees"==entity?filterDiv.find('[compname="'+entity+'"]').prop("checked",!1):TimelyZComp.tokenField.removeAllTokens(filterDiv.find('[compname="'+entity+'"]'))}Timetracker.jobSchedule.applyFilter()},setDefaultFilterParams:function(){TimetrackerOperations.Filters.clearFilters(),TimelyZComp.select.setValue(Timetracker.Util.getLayout().find('[compname="pubStatus"]'),0)},changeJobScheduleView:function(selected_view){var layout=settingsPage.container,dateNavId=Timetracker.Page.getPageMode()+"_"+Timetracker.jobSchedule.JobSchedule;"day"===selected_view&&"view_week"===layout.find("#periodType").find(".zpl_act").attr("id")?(Timetracker.jobSchedule.calview=0,layout.find("#week_view_jobsch").hide(),layout.find("#user_week_view_jobsch").hide(),Timetracker.jobSchedule.isUserView()?layout.find("#user_day_view_jobsch").show():layout.find("#day_view_jobsch").show(),layout.find("#view_day").addClass("zpl_act"),layout.find("#view_week").removeClass("zpl_act"),layout.find("#jobschd_clone").attr("title",ZPI18N.getString("zp.clonejobschd",[ZPI18N.getString("zp.cday")])),ZPCommonUtil.DateNavigator.setPeriod(dateNavId,ZPCommonUtil.DateNavigator.TYPE.DAILY,ZPCommonUtil.DateNavigator.TENSE.CURRENT),Timetracker.jobSchedule.constructJobSchedule()):"week"===selected_view&&"view_day"===layout.find("#periodType").find(".zpl_act").attr("id")&&(Timetracker.jobSchedule.calview=1,Timetracker.jobSchedule.isUserView()?layout.find("#user_week_view_jobsch").show():layout.find("#week_view_jobsch").show(),layout.find("#day_view_jobsch,#user_day_view_jobsch").hide(),layout.find("#view_week").addClass("zpl_act"),layout.find("#view_day").removeClass("zpl_act"),layout.find("#jobschd_clone").attr("title",ZPI18N.getString("zp.clonejobschd",[ZPI18N.getString("zp.week")])),ZPCommonUtil.DateNavigator.setPeriod(dateNavId,ZPCommonUtil.DateNavigator.TYPE.WEEKLY,ZPCommonUtil.DateNavigator.TENSE.CURRENT),Timetracker.jobSchedule.constructJobSchedule())},showimportoption:function(){var isAllowed=!1;if((Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit))&&(isAllowed=!0),!isAllowed&&Timetracker.generalSettings&&Timetracker.generalSettings.settingDetails){var editPerm=Timetracker.generalSettings.getJobSchdEditPerm();("2"===editPerm||"1"===editPerm&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1)&&(isAllowed=!0)}return isAllowed}},Timetracker.jobSchedule.Listing={getJobScheduleForWeekview:function(){var layout=settingsPage.container;0===Timetracker.FireScroll.getFetchCount(Timetracker.jobSchedule.fireScroll.getMode())&&(Timetracker.jobSchedule.pub_cache.count=0,layout.find("#week_view_jobsch").scrollTop(0),Timetracker.util.appendLoading(void 0,{operPageModal:!0,isV5:!0}),layout.find("#week_view_jobsch,#user_week_view_jobsch").hide());var params=Timetracker.jobSchedule.Listing.getParamsToFetchJobSchedule();Timetracker.jobSchedule.Listing.getJobSchedule(params,Timetracker.jobSchedule.Listing.constJobScheduleForWeekview)},getJobScheduleForDayview:function(){var layout=settingsPage.container;0===Timetracker.FireScroll.getFetchCount(Timetracker.jobSchedule.fireScroll.getMode())&&(Timetracker.jobSchedule.pub_cache.count=0,layout.find("#day_view_jobsch").scrollTop(0),Timetracker.util.appendLoading(void 0,{operPageModal:!0,isV5:!0}),layout.find("#day_view_jobsch,#user_day_view_jobsch").hide());var params=Timetracker.jobSchedule.Listing.getParamsToFetchJobSchedule();Timetracker.jobSchedule.Listing.getJobSchedule(params,Timetracker.jobSchedule.Listing.constJobScheduleForDayview)},getParamsToFetchJobSchedule:function(extraDtls){var params=Timetracker.jobSchedule.Listing.getDefaultParams();TimetrackerOperations.Filters.getFilterValues(params),Timetracker.jobScheduleForm.isClientFilterAllowed()||delete params.clientId;var pageMode=Timetracker.Page.getPageMode(),dateNavId=pageMode+"_"+Timetracker.jobSchedule.JobSchedule,datePeriod=ZPCommonUtil.DateNavigator.getPeriod(dateNavId);if(extraDtls&&extraDtls.isFromClone)if(1===Timetracker.jobSchedule.calview){var previousWeek=Calendar.getPreviousWeek(datePeriod);params.fromDate=Timetracker.DateTime.getDateinDBformat(previousWeek.from,!0),params.toDate=Timetracker.DateTime.getDateinDBformat(previousWeek.to,!0),Calendar.getNextWeek(previousWeek)}else{var previousDay=Calendar.getPreviousDay(datePeriod);params.fromDate=Timetracker.DateTime.getDateinDBformat(previousDay.day,!0),params.toDate=Timetracker.DateTime.getDateinDBformat(previousDay.day,!0),Calendar.getNextDay(previousDay)}else void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(params.fromDate=Timetracker.DateTime.getDateinDBformat(datePeriod.from,!0),params.toDate=Timetracker.DateTime.getDateinDBformat(datePeriod.to,!0)):(params.fromDate=Timetracker.DateTime.getDateinDBformat(datePeriod.day,!0),params.toDate=Timetracker.DateTime.getDateinDBformat(datePeriod.day,!0)));if(params.sIndex=0,params.limit=Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,"ts_operations"==pageMode?params.pageMode=0:"ts_team"==pageMode?params.pageMode=1:"ts_mydata"==pageMode?(params.users=erecno,params.pageMode=2):Timetracker.Page.isSelectedUser(pageMode)&&(params.pageMode=2,params.users=Timetracker.Team.getSelectedUser()),"0"===params.users&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?params.isDirectSubOnlyNeeded=settingsPage.container.find("#jobsch_includeOnlyDirectSubordinates").is(":checked"):params.isDirectSubOnlyNeeded=!1,Timetracker.jobSchedule.hasCustomFields()){var cparams={};settingsPage.container.find("#filterDiv").find('[filtertype="customFilter"]').each(function(){var val=TimelyZComp.isComponent(this)?TimetrackerOperations.Filters.gettokenFieldValues(this):0;if(0!=val){var paramName=$(this).attr("compname");cparams[paramName]=val}}),0!=Object.keys(cparams).length&&(params.customFieldDetails=JSON.stringify(cparams))}return params},getDefaultParams:function(){return{mode:"getJobSchedule",users:"0",clientId:"0",projectId:"0",jobId:"0",pubStatus:"0",deptId:"0",locationId:"0",designationId:"0",conreqcsr:csrfToken}},getJobSchedule:function(params,callback){Timetracker.Util.showHideNoData({remove:!0});let pageModeDetails=Timetracker.jobSchedule.getPageModeValue();Timetracker.jobSchedule.fireScroll.fireScrollAvbl(pageModeDetails.pageMode)&&Timetracker.FireScroll.resetDataOnLoad(Timetracker.jobSchedule.fireScroll.getMode()),ZPeople.Request.send(Timetracker.constants.URL,params,callback,pageModeDetails)},constJobScheduleForWeekview:function(res,params,otherDetails){if(Timetracker.util.removeLoading(),res.errorCode){var showEMsg=!0,ecode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");"9000"==ecode&&(res.isPageView?(settingsPage.container.html("<div class='zpl_rgtcnt'></div>"),Timetracker.Util.showHideNoData({div:Timetracker.Util.getLayout(),msg:ZPI18N.getString("zp.notallowedforpage"),cls:"zp_nd_permission"}),showEMsg=!1):emsg=ZPI18N.getString("zp.permdenied")),showEMsg&&Timetracker.util.showAlert(1,emsg)}else Timetracker.jobSchedule.setDataFetched(otherDetails.pageMode,otherDetails.selectedUser),Timetracker.jobSchedule.pub_cache.count=res.unpubcount,Timetracker.jobSchedule.isUserView()?0==res.usersList.length?Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.nojbschedulefound")}):(settingsPage.container.find("#user_week_view_jobsch").show(),settingsPage.container.find("#user_day_view_jobsch").hide(),Timetracker.jobSchedule.Listing.constructEmpWeekbasedView(res.usersList[0],params)):(settingsPage.container.find("#week_view_jobsch").show(),settingsPage.container.find("#day_view_jobsch").hide(),Timetracker.jobSchedule.Listing.constructWeekbasedView(res.usersList,res.jobschArr,params)),otherDetails&&Timetracker.jobSchedule.fireScroll.fireScrollAvbl(otherDetails.pageMode)&&!otherDetails.isFromFireScroll&&(otherDetails.isFromFireScroll=!0,Timetracker.FireScroll.initFireScroll(Timetracker.jobSchedule.fireScroll.getMode(),Timetracker.constants.URL,params,Timetracker.jobSchedule.fireScroll.loadMoreJobShedules,"",otherDetails),Timetracker.FireScroll.setFetchCount(Timetracker.jobSchedule.fireScroll.getMode(),res.usersList))},constJobScheduleForDayview:function(res,params,otherDetails){if(Timetracker.util.removeLoading(),res.errorCode){var showEMsg=!0,ecode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");"9000"==ecode&&(res.isPageView?(settingsPage.container.html("<div class='zpl_rgtcnt'></div>"),Timetracker.Util.showHideNoData({div:settingsPage.container,msg:ZPI18N.getString("zp.notallowedforpage"),cls:"zp_nd_permission"}),showEMsg=!1):emsg=ZPI18N.getString("zp.permdenied")),showEMsg&&Timetracker.util.showAlert(1,emsg)}else Timetracker.jobSchedule.setDataFetched(otherDetails.pageMode,otherDetails.selectedUser),Timetracker.jobSchedule.isUserView()?(settingsPage.container.find("#user_day_view_jobsch").show(),settingsPage.container.find("#user_week_view_jobsch").hide(),Timetracker.jobSchedule.pub_cache.count=res.unpubcount,Timetracker.jobSchedule.Listing.constructDaybasedView(res.usersList,res.jobschArr,!0,params)):(settingsPage.container.find("#day_view_jobsch").show(),settingsPage.container.find("#week_view_jobsch").hide(),Timetracker.jobSchedule.pub_cache.count=res.unpubcount,Timetracker.jobSchedule.Listing.constructDaybasedView(res.usersList,res.jobschArr,!1,params)),otherDetails&&Timetracker.jobSchedule.fireScroll.fireScrollAvbl(otherDetails.pageMode)&&!otherDetails.isFromFireScroll&&(otherDetails.isFromFireScroll=!0,Timetracker.FireScroll.initFireScroll(Timetracker.jobSchedule.fireScroll.getMode(otherDetails.pageMode),Timetracker.constants.URL,params,Timetracker.jobSchedule.fireScroll.loadMoreJobShedules,"",otherDetails),Timetracker.FireScroll.setFetchCount(Timetracker.jobSchedule.fireScroll.getMode(otherDetails.pageMode),res.usersList))},constructWeekbasedView:function(userArr,jobschArr,params){var layout=Timetracker.Util.getLayout().find("#tt_jobschedule_weekly"),currUserList=userArr,sch_body=layout.find("#weekly_tbody");if(0==params.sIndex){Timetracker.jobSchedule.usersList=userArr;var sch_head=layout.find("#weekly_thead");sch_head.html("");var thead_html='<tr><th scope="col">'+ZPI18N.getString("zp.employee")+"</th>",dateNavId=Timetracker.Page.getPageMode()+"_"+Timetracker.jobSchedule.JobSchedule,wstime=ZPCommonUtil.DateNavigator.getPeriod(dateNavId).from.getTime(),weekStarts=new Date;weekStarts.setTime(wstime);for(var i=0;i<7;i++){i>0&&weekStarts.setDate(weekStarts.getDate()+1);var date=Timetracker.util.convertDateTo2digit(weekStarts.getDate()),currDate=Calendar.getCurrentDate();currDate.setHours(0,0,0,0);var currDayCls="";currDate&&weekStarts&&weekStarts.getTime()==currDate.getTime()&&(currDayCls="crnt"),thead_html+='<th scope="col" class="'+currDayCls+'"><div><small>'+days[weekStarts.getDay()]+"</small><font>"+date+"</font></div></th>"}thead_html+="</tr>",sch_head.append(thead_html),sch_body.html("")}else Timetracker.jobSchedule.usersList=Timetracker.jobSchedule.usersList.concat(userArr);currUserList&&currUserList.length?(Timetracker.Util.showHideNoData({remove:!0}),$.each(currUserList,function(index,userDetail){var userTR=Timetracker.jobSchedule.Listing.constWeekviewGridForUser(userDetail);sch_body.append(userTR[0])})):0===Timetracker.FireScroll.getFetchCount(Timetracker.jobSchedule.fireScroll.getMode())&&0==params.sIndex&&(settingsPage.container.find("#week_view_jobsch").hide(),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.nojbschedulefound")})),0!=Timetracker.jobSchedule.pub_cache.count||currUserList&&currUserList.length||Timetracker.jobSchedule.Listing.updateUnpublishedCount(),sch_body.off("click","td.day_div").on("click","td.day_div",function(e){e.preventDefault(),e.stopPropagation(),Timetracker.jobSchedule.dataOperations.addJobScheduleConstruct(e,this)})},constructEmpWeekbasedView:function(userDetail,params){var layout=settingsPage.container.find("#user_week_view_jobsch"),sch_head=layout.find("#weekly_thead"),sch_body=layout.find("#weekly_tbody"),permCrsr=Timetracker.jobSchedule.dataOperations.isAddEditAllowed(userDetail.empId)?"":"zpl_nocrsor",time_head="",time_body="";if(0===Timetracker.FireScroll.getFetchCount(Timetracker.jobSchedule.fireScroll.getMode())){time_head+='<tr><th class="mw100"></th><th class="mw80"><table><thead><tr>',time_body+='<tr><td name="weekRow" class="zpl_cpd"></td><td class="hour_body"><table id="tableRow_'+userDetail.empId+'" class="'+permCrsr+'"><tbody><tr>';for(var i=0;i<=23;i++)if("HH:mm"===timeFormat)time_head+="<th>"+i+"</th>",time_body+='<td class="hour_div"  id="'+userDetail.empId+"_"+i+'"></td>';else{var time_show,time_val;i>=12?(0===(time_val=i-12)&&(time_val=12),time_show=time_val+" PM"):time_show=(time_val=i)+" AM",0===i&&(time_show="12 AM"),time_head+="<th>"+time_show+"</th>",time_body+='<td class="hour_div"  id="'+userDetail.empId+"_"+i+'"></td>'}time_head+="</tr></thead></table></tr>",time_body+="</tr></tbody></table></tr>",sch_head.html(time_head),sch_body.html("");var pageMode=Timetracker.Page.getPageMode(),wstime=ZPCommonUtil.DateNavigator.getPeriod(pageMode+"_"+Timetracker.jobSchedule.JobSchedule).from.getTime(),weekStarts=new Date;weekStarts.setTime(wstime);var currDate=Calendar.getCurrentDate();currDate.setHours(0,0,0,0);var leaveObj=userDetail.leaveObj?userDetail.leaveObj:{};for(i=0;i<7;i++){i>0&&weekStarts.setDate(weekStarts.getDate()+1),wdata=Timetracker.DateTime.getDateinDBformat(weekStarts,!0);var date=Timetracker.util.convertDateTo2digit(weekStarts.getDate()),dateDiv='<div class="d-flexclmcap d-flexclmcap5"><em>'+days[weekStarts.getDay()]+"</em><b>"+date+'</b></div><div class="d-flexC d-flexclmcap5 zpl_f12"><i class="PI_clock zpl_f12 " title="'+ZPI18N.getString("zp.scheduledhours")+'"></i><em id="user_ttime">00:00 '+ZPI18N.getString("zp.smallhrs")+"</em></div>",tRow_html=$(time_body);$(tRow_html).attr("date",wdata),$(tRow_html).find("table").attr("workdate",wdata),$(tRow_html).find("table").attr("erecno",userDetail.empId),$(tRow_html).find('[name="weekRow"]').append(dateDiv),currDate&&weekStarts&&weekStarts.getTime()==currDate.getTime()&&$(tRow_html).addClass("Cl-today");var leaveCls="",leaveDtl=leaveObj[wdata],leaveTitle="";if(leaveDtl){var hideWeekEnd=Timetracker.generalSettings.hideWeekEnd(),hideHoliday=Timetracker.generalSettings.hideHoliday(),hideLeave=Timetracker.generalSettings.hideLeave();!hideWeekEnd&&leaveDtl.isweekend&&!0===leaveDtl.isweekend&&(leaveCls="lv_litbg9",leaveTitle=ZPI18N.getString("zp.weekend")),!hideHoliday&&leaveDtl.isHoliday&&!0===leaveDtl.isHoliday&&(leaveCls="lv_litbg1",leaveTitle=holiday_disName===ZPI18N.getString("zp.holidays")?ZPI18N.getString("zp.holiday"):holiday_disName),!hideLeave&&leaveDtl.leaves&&0!==leaveDtl.leaves.length&&(leaveCount=leaveDtl.leaves[0].leaveCount,0!==leaveCount?(leaveCls="lv_litbg7",leaveTitle=ZPeople.decodeTxt(leaveDtl.leaves[0].leavetypeName)):(!hideWeekEnd&&leaveDtl.isweekend&&!0===leaveDtl.isweekend&&(leaveCls="lv_litbg9",leaveTitle=ZPI18N.getString("zp.weekend")),!hideHoliday&&leaveDtl.isHoliday&&!0===leaveDtl.isHoliday&&(leaveCls="lv_litbg1",leaveTitle=holiday_disName===ZPI18N.getString("zp.holidays")?ZPI18N.getString("zp.holiday"):holiday_disName)))}$(tRow_html).find("table").data("leaveCls",leaveCls),tRow_html.find("td").addClass(leaveCls).attr("title",leaveTitle),tRow_html.find("table").parent().removeClass(leaveCls),$(sch_body).append(tRow_html)}}Timetracker.jobSchedule.Listing.schuduleListConstForUserForEmpWeek(userDetail,userDetail.jobschArr),Timetracker.jobSchedule.Listing.updateUnpublishedCount(),sch_body.off("click",".hour_div:not(.hasId)").on("click",".hour_div:not(.hasId)",function(e){Timetracker.jobSchedule.dataOperations.addJobScheduleConstruct(e,this)})},schuduleListConstForUserForEmpWeek(userDetail,schArr){var layout=settingsPage.container.find("#user_week_view_jobsch"),empid=userDetail.empId;Timetracker.jobSchedule.dataOperations.isAddEditAllowed(userDetail.empId);$.each(schArr,function(job_index,jobDetail){var jobDate=jobDetail.date.split(" ")[0],datacol_div=layout.find('[date="'+jobDate+'"]').find("tbody");Timetracker.jobSchedule.Listing.positionScheduleInDayview(datacol_div,jobDetail,empid)})},constWeekviewGridForUser:function(userDetail){var permCrsr=Timetracker.jobSchedule.dataOperations.isAddEditAllowed(userDetail.empId)?"":"zpl_cpd",trTxt=$('<tr id="tr_'+userDetail.empId+'" class="'+permCrsr+'"></tr>');trTxt.data(userDetail),trTxt.append('<td scope="row" tabindex="0" class="zpl_cpd"><div class="zpl_em"><div class="zpl_emimg"><img src="'+userDetail.empPhoto+'"></div><div class="zpl_emdts"><div data-title-position="bottom" title="'+userDetail.empName+'"><em>'+userDetail.employeeId+" - </em><b>"+userDetail.empName+'</b></div><div class="d-flexC d-flexclmcap5 zpl_f12"><i class="PI_clock zpl_f12" title="'+ZPI18N.getString("zp.scheduledhours")+'"></i><em id="user_ttime">00:00 '+ZPI18N.getString("zp.smallhrs")+"</em></div></div></div></div></td>");var dateNavId=Timetracker.Page.getPageMode()+"_"+Timetracker.jobSchedule.JobSchedule,wstime=ZPCommonUtil.DateNavigator.getPeriod(dateNavId).from.getTime(),weekStarts=new Date;weekStarts.setTime(wstime);for(var leaveObj=userDetail.leaveObj?userDetail.leaveObj:{},i=0;i<7;i++){i>0&&weekStarts.setDate(weekStarts.getDate()+1);var date=Timetracker.util.convertDateTo2digit(weekStarts.getDate()),currDate=Calendar.getCurrentDate();currDate.setHours(0,0,0,0);var currDayCls="";currDate&&weekStarts&&weekStarts.getTime()==currDate.getTime()&&(currDayCls="crnt");var leaveCls="",leaveTitle="",leaveDtl=leaveObj[Timetracker.DateTime.getDateinDBformat(weekStarts,!0)];if(leaveDtl){var hideWeekEnd=Timetracker.generalSettings.hideWeekEnd(),hideHoliday=Timetracker.generalSettings.hideHoliday(),hideLeave=Timetracker.generalSettings.hideLeave();!hideWeekEnd&&leaveDtl.isweekend&&!0===leaveDtl.isweekend&&(leaveCls="lv_litbg9",leaveTitle=ZPI18N.getString("zp.weekend")),!hideHoliday&&leaveDtl.isHoliday&&!0===leaveDtl.isHoliday&&(leaveCls="lv_litbg1",leaveTitle=holiday_disName===ZPI18N.getString("zp.holidays")?ZPI18N.getString("zp.holiday"):ZPeople.escapeHtml(holiday_disName)),!hideLeave&&leaveDtl.leaves&&0!==leaveDtl.leaves.length&&(0!==leaveDtl.leaves[0].leaveCount?(leaveCls="lv_litbg7",leaveTitle=leaveDtl.leaves[0].leavetypeName):(!hideWeekEnd&&leaveDtl.isweekend&&!0===leaveDtl.isweekend&&(leaveCls="lv_litbg9",leaveTitle=ZPI18N.getString("zp.weekend")),!hideHoliday&&leaveDtl.isHoliday&&!0===leaveDtl.isHoliday&&(leaveCls="lv_litbg1",leaveTitle=holiday_disName===ZPI18N.getString("zp.holidays")?ZPI18N.getString("zp.holiday"):ZPeople.escapeHtml(holiday_disName))))}var trTxtDomPlus=$('<td class="day_div '+currDayCls+" "+leaveCls+'" dateid="'+weekStarts.getFullYear()+"-"+("0"+(weekStarts.getMonth()+1).toString()).substr(-2)+"-"+date+'" id="'+userDetail.empId+"_"+date+'"><div class="js-schedule"></div><span class="dy_cptn" data-title-position="bottom" title="'+leaveTitle+'">'+leaveTitle+"</span></td>");trTxt.append(trTxtDomPlus)}return trTxt.find(".day_div").droppable({accept:".jbs_wrkitm",over:function(event,ui){var cellDiv=$(event.target),dropDate=cellDiv.attr("dateid").split(" ")[0]?cellDiv.attr("dateid").split(" ")[0]:cellDiv.attr("dateid"),dropUser=cellDiv.attr("id").split("_")[0],origCell=$(ui.draggable).parent().parent(),origDate=origCell.attr("dateid").split(" ")[0]?origCell.attr("dateid").split(" ")[0]:origCell.attr("dateid"),origUser=origCell.attr("id").split("_")[0];dropDate!==origDate&&dropUser===origUser?$(this).find(".weeksch-drop").css("display","block"):$(this).find(".weeksch-drop").hide()},out:function(event,ui){$(this).find(".weeksch-drop").hide()},drop:function(event,ui){var cellDiv=$(event.target),movedDiv=ui.draggable,dropDate=cellDiv.attr("dateid").split(" ")[0]?cellDiv.attr("dateid").split(" ")[0]:cellDiv.attr("dateid"),dropUser=cellDiv.attr("id").split("_")[0],origCell=$(ui.draggable).parent().parent(),origDate=origCell.attr("dateid").split(" ")[0]?origCell.attr("dateid").split(" ")[0]:origCell.attr("dateid"),origUser=origCell.attr("id").split("_")[0];if(dropDate!==origDate&&dropUser===origUser){var isEditAllowed=Timetracker.jobSchedule.dataOperations.isAddEditAllowedForDate(dropUser,dropDate,!0);if($(this).find(".weeksch-drop").hide(),!isEditAllowed)return;if(isEditAllowed){var cellData=movedDiv.data(),jobSchObj={};if(jobSchObj.jobId=cellData.jobId,jobSchObj.desc=ZPeople.decodeTxt(cellData.desc),jobSchObj.isPubed=cellData.isPubed,jobSchObj.fromtime=cellData.fromTime,jobSchObj.totime=cellData.toTime,jobSchObj.fromtime===jobSchObj.totime)return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.jobschedulefromtotimesameerror"));if(jobSchObj.tschId=cellData.tschId,jobSchObj.assignedTo=cellData.assignedTo,jobSchObj.date=dropDate,jobSchObj.billableStatus=cellData.billableStatus,jobSchObj.workitem=ZPeople.decodeTxt(cellData.workitem),Timetracker.jobSchedule.isJobSchTLExtendEnabled()&&(jobSchObj.extendAllowed=cellData.extendAllowed),Timetracker.jobSchedule.hasCustomFields()&&(jobSchObj.customFieldDetails=JSON.stringify(cellData.customFieldDetails)),cellData.repeatId){jobSchObj.editRepeat=!1,jobSchObj.repeatId=cellData.repeatId,jobSchObj.repeatType=cellData.repeatType,jobSchObj.repeatInt=cellData.repeatInt;var repuntil=cellData.repeatUntil;repuntil&&(repuntil=repuntil.split(" ")[0],jobSchObj.repeatUntil=repuntil),jobSchObj.repeatRule=cellData.repeatRule}jobSchObj.mode="updateJobSchedule";var ep={isMoved:!0};ep.moveDiv=movedDiv,Timetracker.jobSchedule.dataOperations.addUpdateJobSchedule({params:jobSchObj,callBack:Timetracker.jobSchedule.dataOperations.updateJobScheduleResponse,ep:ep}),movedDiv.draggable({revert:!1})}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.schedulepastdatemove")),movedDiv.draggable({revert:!0});return!1}$(this).find(".weeksch-drop").hide(),movedDiv.draggable({revert:!0})}}),userDetail.jobschArr&&userDetail.jobschArr.length>0&&Timetracker.jobSchedule.Listing.schuduleListConstForUserForWeek(userDetail.jobschArr,trTxt),Timetracker.jobSchedule.Listing.updateUnpublishedCount(),trTxt},schuduleListConstForUserForWeek:function(schArr,trElem){var empId=trElem.data("empId"),totalmins=0;if($.each(schArr,function(job_index,jobData){var onlydate=jobData.date.split(" ")[0].split("-")[2],tmins=(jobData.toTime<jobData.fromTime?jobData.toTime+Timetracker.constants.PER_DAY_MIN:jobData.toTime)-jobData.fromTime;totalmins+=tmins;var dom=Timetracker.jobSchedule.Listing.scheduleWeekDom(jobData,empId);trElem.find("#"+empId+"_"+onlydate).find(".js-schedule").append(dom)}),totalmins){var thours=Calendar.minstohrs(totalmins),empWeekHrs=trElem.find("#user_ttime");empWeekHrs.attr("tmins",totalmins),empWeekHrs.text(thours+" "+ZPI18N.getString("zp.smallhrs"))}},scheduleWeekDom:function(data,empId){var fromTime=Calendar.minstotimeFormat(data.fromTime),toTime=Calendar.minstotimeFormat(data.toTime),jobname=data.jobName,projectname=data.projectName;if(!jobname&&null!=Timetracker.jobs.userJobs){var userJobArr=Timetracker.jobs.userJobs[empId];if(userJobArr&&data.jobId&&"0"!==data.jobId){var tempIndex=Timetracker.projects.Operations.findJSONArrayIndex(userJobArr,data.jobId,"jobId");tempIndex&&"-1"!==tempIndex&&(jobname=userJobArr[tempIndex].jobName?userJobArr[tempIndex].jobName:"")}}jobname=ZPeople.escapeHtml(jobname);var tjob=fromTime+" - "+toTime,unpubcls=data&&!data.isPubed?"drft":"",repdom="";data.repeatId&&(repdom='<i data-title-position="bottom" title="'+ZPI18N.getString("zp.repeatingschedule")+'" class="PI_repeat S12"></i>');var jcolor="0"===data.color?Timetracker.jobs.defJobColor:data.color,dom=$('<div id="'+data.tschId+'" class="jbs_wrkitm jc'+jcolor+" "+unpubcls+'" data-title-position="bottom" title="'+tjob+" / "+ZPeople.decodeTxt(jobname)+'"><div class="zpl_wrkitmnme"><span>'+ZPeople.decodeTxt(jobname)+"</span><em>"+tjob+"</em></div>"+repdom+"</div>");return void 0!==projectname&&""!==projectname.trim()&&(dom=$('<div id="'+data.tschId+'" class="jbs_wrkitm jc'+jcolor+" "+unpubcls+'" data-title-position="bottom" title="'+tjob+"  / "+ZPeople.decodeTxt(jobname)+" . "+projectname+'"><div class="zpl_wrkitmnme"><span>'+ZPeople.decodeTxt(jobname)+"</span><em>"+tjob+"</em></div>"+repdom+"</div>")),dom.data(data),dom.draggable({snap:".js-schedule",start:function(event,ui){$(".tooltip").remove(),$(this).addClass("noclick")},drag:function(event,ui){$(".tooltip").remove()},stop:function(event,ui){$(".tooltip").remove()},snapMode:"inner",zIndex:1e6,appendTo:".js-schedule",revert:!0}),dom.off("click").on("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).hasClass("noclick")?$(this).removeClass("noclick"):Timetracker.jobSchedule.dataOperations.chooseEditSchedule(data,e,this)}),dom},updateUnpublishedCount:function(){var layout=settingsPage.container,pubcount=layout.find("#jsch_pub_count"),pubBut=layout.find("#jsch_pub_button"),len=Timetracker.jobSchedule.pub_cache.count;pubcount.hide(),pubcount.text(""),pubBut.attr("disabled",!0),len>=1?(pubBut.attr("disabled",!1),pubcount.text(len),pubcount.show(),pubBut.text(ZPI18N.getString("zp.publish")),pubcount.attr({"aria-label":ZPI18N.getString("zp.jobscheduer.pendingpub",[""])+":"+len,tabindex:"0"})):(pubcount.text("0"),pubcount.show(),pubBut.text(ZPI18N.getString("zp.published")),pubcount.attr({"aria-label":ZPI18N.getString("zp.jobscheduer.pendingpub",[""])+":"+len,tabindex:"0"}))},constructDaybasedView:function(userArr,jobschArr,isUserData,params){var layout=settingsPage.container,currUserList=userArr,time_head="",day_body=(layout=isUserData?layout.find("#user_day_view_jobsch"):layout.find("#day_view_jobsch")).find("#daily_tbody");if(0==params.sIndex){time_head+="<tr><th "+(isUserData?'class="mw100"':"")+">"+(isUserData?"":"Employee")+"</th><th><table><thead><tr>";for(var i=0;i<=23;i++)if("HH:mm"===timeFormat)time_head+="<th>"+i+"</th>";else{var time_show,time_val;i>=12?(0===(time_val=i-12)&&(time_val=12),time_show=time_val+" PM"):time_show=(time_val=i)+" AM",0===i&&(time_show="12 AM"),time_head+="<th>"+time_show+"</th>"}time_head+="</tr></thead></table></tr>",layout.find("#daily_thead").html(time_head),day_body.html(""),Timetracker.jobSchedule.usersList=userArr}else Timetracker.jobSchedule.usersList=Timetracker.jobSchedule.usersList.concat(userArr);if(currUserList&&currUserList.length){Timetracker.Util.showHideNoData({remove:!0});var dateNavId=Timetracker.Page.getPageMode()+"_"+Timetracker.jobSchedule.JobSchedule,datePeriod=ZPCommonUtil.DateNavigator.getPeriod(dateNavId),dbDate=Timetracker.DateTime.getDateinDBformat(datePeriod.day,!0);$.each(currUserList,function(index,userDetail){var leaveDtl=(userDetail.leaveObj?userDetail.leaveObj:{})[dbDate],leaveCls="",leaveTitle="";if(leaveDtl){var hideWeekEnd=Timetracker.generalSettings.hideWeekEnd(),hideHoliday=Timetracker.generalSettings.hideHoliday(),hideLeave=Timetracker.generalSettings.hideLeave();!hideWeekEnd&&leaveDtl.isweekend&&!0===leaveDtl.isweekend&&(leaveCls="lv_litbg9",leaveTitle=ZPI18N.getString("zp.weekend")),!hideHoliday&&leaveDtl.isHoliday&&!0===leaveDtl.isHoliday&&(leaveCls="lv_litbg1",leaveTitle=holiday_disName===ZPI18N.getString("zp.holidays")?ZPI18N.getString("zp.holiday"):ZPeople.escapeHtml(holiday_disName)),!hideLeave&&leaveDtl.leaves&&0!==leaveDtl.leaves.length&&(leaveCount=leaveDtl.leaves[0].leaveCount,0!==leaveCount&&(leaveCls="lv_litbg7",leaveTitle=leaveDtl.leaves[0].leavetypeName))}var tduser,liRow=$('<tr id="dayrow_'+userDetail.empId+'"></tr>');if(liRow.data(userDetail),isUserData){var pageMode=Timetracker.Page.getPageMode(),currDay=ZPCommonUtil.DateNavigator.getPeriod(pageMode+"_"+Timetracker.jobSchedule.JobSchedule).day,date=Timetracker.util.convertDateTo2digit(currDay.getDate()),currDate=Calendar.getCurrentDate();currDate&&currDay&&currDay.getTime()==currDate.getTime()&&$(liRow).addClass("Cl-today"),tduser=$('<td class="zpl_cpd"><div class="d-flexclmcap d-flexclmcap5"><em>'+days[currDay.getDay()]+"</em><b>"+date+'</b></div><div class="d-flexC d-flexclmcap5 zpl_f12"><i class="PI_clock zpl_f12" title="'+ZPI18N.getString("zp.scheduledhours")+'"></i><em id="user_ttime">00:00 '+ZPI18N.getString("zp.smallhrs")+"</em></div></td>")}else tduser=$('<td class="zpl_cpd"><div class="zpl_em"><div class="zpl_emimg"><img src="'+userDetail.empPhoto+'"></div><div class="zpl_emdts"><div data-title-position="bottom" title="'+userDetail.empName+'"><em>'+userDetail.employeeId+" - </em><b>"+userDetail.empName+'</b></div><div class="d-flexC d-flexclmcap5 zpl_f12"><i class="PI_clock zpl_f12" title="'+ZPI18N.getString("zp.scheduledhours")+'"></i><em id="user_ttime">00:00 '+ZPI18N.getString("zp.smallhrs")+"</em></div></div></div></td>");liRow.append(tduser);for(var permCrsr=Timetracker.jobSchedule.dataOperations.isAddEditAllowed(userDetail.empId)?"":"zpl_nocrsor",empty_cells_row="<td id='"+userDetail.empId+"' class='hour_body'><table id='tableRow_"+userDetail.empId+"' class='"+leaveCls+" "+permCrsr+"' workdate='"+dbDate+"'><tbody><tr>",time=0;time<=23;time++)empty_cells_row+='<td title="'+leaveTitle+'"  class="hour_div '+leaveCls+'" id="'+userDetail.empId+"_"+time+'"></td>';empty_cells_row+="</tr></tbody></table></td>",liRow.append(empty_cells_row),day_body.append(liRow),Timetracker.jobSchedule.Listing.schuduleListConstForUserForDay(userDetail.jobschArr,liRow,leaveCls,leaveTitle)})}else 0===Timetracker.FireScroll.getFetchCount(Timetracker.jobSchedule.fireScroll.getMode())&&0==params.sIndex&&(settingsPage.container.find("#day_view_jobsch,#user_day_view_jobsch").hide(),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.nojbschedulefound")}));Timetracker.jobSchedule.Listing.updateUnpublishedCount(),day_body.off("click",".hour_div:not(.hasId)").on("click",".hour_div:not(.hasId)",function(e){Timetracker.jobSchedule.dataOperations.addJobScheduleConstruct(e,this)})},schuduleListConstForUserForDay:function(schArr,liElem,leaveCls,leaveTitle){var empid=liElem.data("empId"),datacol_div_id=liElem.find("#tableRow_"+empid).find("tbody");$.each(schArr,function(job_index,jobDetail){Timetracker.jobSchedule.Listing.positionScheduleInDayview(datacol_div_id,jobDetail,empid)})},positionScheduleInDayview:function(datacol_div_id,jobDetails,empId,isFromAdd){var jobschId=jobDetails.tschId;void 0!==jobDetails.date&&(jobDetails.date=jobDetails.date.split(" ")[0]);var domhasdrag=datacol_div_id.find("td:first"),dup=domhasdrag.find("#"+jobschId);if(dup.length){var oldDate=dup.data("date");if(jobDetails.date!==oldDate)return void dup.remove()}var startPixelPercent,widthSchPercent,jsonSch={},ftime=parseInt(jobDetails.fromTime),ttime=parseInt(jobDetails.toTime),rowwidth=datacol_div_id.width(),indminswidth=rowwidth/24/60,fTimetype=Calendar.minstotimeFormat(ftime),tTimetype=Calendar.minstotimeFormat(ttime),startPixel=indminswidth*ftime,timeDiff=(ttime<ftime?ttime+Timetracker.constants.PER_DAY_MIN:ttime)-ftime;startPixelPercent=startPixel/rowwidth*100,widthSchPercent=(indminswidth*(parseInt(ttime)<parseInt(ftime)?Timetracker.constants.PER_DAY_MIN:ttime)-startPixel)/rowwidth*100;datacol_div_id.parent();var ft=fTimetype,tt=tTimetype,schname=ZPeople.escapeHtml(jobDetails.jobName),projectname=jobDetails.projectName;if(!schname&&null!=Timetracker.jobs.userJobs){var userJobArr=Timetracker.jobs.userJobs[empId];if(userJobArr&&jobDetails.jobId&&"0"!==jobDetails.jobId){var tempIndex=Timetracker.projects.Operations.findJSONArrayIndex(userJobArr,jobDetails.jobId,"jobId");tempIndex&&"-1"!==tempIndex&&(schname=userJobArr[tempIndex].jobName?ZPeople.escapeHtml(userJobArr[tempIndex].jobName):"")}}var liDom=datacol_div_id.parent(),tempSchArrForDayView=liDom.data("tempArr")||[],jobEm="";schname&&(jobEm="<span>"+ZPeople.decodeTxt(schname)+"</span>");var unpubcls=jobDetails&&!jobDetails.isPubed?"drft":"",repdom="";jobDetails.repeatId&&(repdom='<i data-title-position="bottom" title="'+ZPI18N.getString("zp.repeatingschedule")+'" class="PI_repeat S8"></i>');var jcolor="0"===jobDetails.color?6:jobDetails.color,domschedule=$('<div id="'+jobschId+'" style="width:'+widthSchPercent+"%;left:"+startPixelPercent+'%;" class="jbs_wrkitm jc'+jcolor+" "+unpubcls+'"  data-title-position="bottom" title="'+ft+" - "+tt+" / "+ZPeople.decodeTxt(schname)+'"><div class="zpl_wrkitmnme" tschid="'+jobDetails.tschId+'">'+jobEm+'<em class="zpl_ellipsis">'+ft+" - "+tt+'</em></div><div class="ui-resizable-handle"></div><div class="ui-resizable-handle ui-resizable-e"><i class="PI_drag zpl_dragicn"></i></div>'+repdom+"</div>");void 0!==projectname&&""!==projectname.trim()&&(domschedule=$('<div id="'+jobschId+'" style="width:'+widthSchPercent+"%;left:"+startPixelPercent+'%;" class="jbs_wrkitm jc'+jcolor+" "+unpubcls+'"  data-title-position="bottom" title="'+ft+" - "+tt+" / "+ZPeople.decodeTxt(schname)+" . "+projectname+'"><div class="zpl_wrkitmnme" tschid="'+jobDetails.tschId+'">'+jobEm+'<em class="zpl_ellipsis">'+ft+" - "+tt+'</em></div><div class="ui-resizable-handle"></div><div class="ui-resizable-handle ui-resizable-e"><i class="PI_drag zpl_dragicn"></i></div>'+repdom+"</div>")),domschedule.data(jobDetails),domschedule.data("empId",empId);var oldTimeDiff=0;if(dup.length){var oldpub=dup.data("isPubed");jobDetails.isPubed&&!oldpub&&(Timetracker.jobSchedule.pub_cache.count-=1),!jobDetails.isPubed&&oldpub&&(Timetracker.jobSchedule.pub_cache.count+=1),oldTimeDiff=(dup.data("toTime")||0)-(dup.data("fromTime")||0),dup.replaceWith(domschedule)}else domhasdrag.append(domschedule).addClass("hasId");var width=datacol_div_id.find('div[tschid="'+jobDetails.tschId+'"]').css("width"),left=datacol_div_id.find('div[tschid="'+jobDetails.tschId+'"]').css("left");jsonSch.width=width,jsonSch.left=left,domschedule.on("hover",function(){$(".tooltip").remove()}),domschedule.resizable({containment:domschedule.parents(".hour_body"),handles:{e:".ui-resizable-e"},start:function(event,ui){$(this).addClass("noclick")},stop:function(ev,$ui){$(".tooltip").remove(),Timetracker.jobSchedule.Listing.updateResizeValforTotime($ui,ev)}}),domschedule.draggable({containment:domschedule.parents(".hour_body"),axis:"x",start:function(event,ui){$(".tooltip").remove(),$(this).addClass("noclick")},drag:function(event,ui){$(".tooltip").remove()},stop:function(ev,$ui){$(".tooltip").remove(),Timetracker.jobSchedule.Listing.updateResizeValforTotime($ui,ev)}}),domschedule.off("click").on("click",function(e){$(this).hasClass("noclick")?$(this).removeClass("noclick"):Timetracker.jobSchedule.dataOperations.chooseEditSchedule(jobDetails,e,this)}),jsonSch.empId=empId,jsonSch.ftime=jobDetails.fromTime,jsonSch.ttime=jobDetails.toTime,jsonSch.tschId=jobDetails.tschId,jsonSch.rowno=0,isFromAdd&&!jobDetails.isPubed&&(Timetracker.jobSchedule.pub_cache.count+=1),tempSchArrForDayView.push(jsonSch);var tmisDom=liDom.parents("tr").find("#user_ttime"),tmins=parseInt(tmisDom.attr("tmins"))||0;tmisDom.attr("tmins",tmins-oldTimeDiff+timeDiff),tmisDom.text(Calendar.minstohrs(tmins-oldTimeDiff+timeDiff)+" "+ZPI18N.getString("zp.smallhrs")),liDom.data({tempArr:tempSchArrForDayView}),Timetracker.jobSchedule.Listing.updateUnpublishedCount()},constructSingleWeekSchedule:function(jobData,isFromAdd,isMoved){var modalDiv=settingsPage.container,onlydate=jobData.date.split(" ")[0].split("-");jobData&&!jobData.isPubed&&isFromAdd&&(Timetracker.jobSchedule.pub_cache.count+=1);var assignee_val=jobData.assignedTo,tr_id="tr_"+assignee_val,td_id=assignee_val+"_"+onlydate[2],dom=Timetracker.jobSchedule.Listing.scheduleWeekDom(jobData,assignee_val),ftime=parseInt(jobData.fromTime),ttime=parseInt(jobData.toTime),thoursDom=modalDiv.find("#"+tr_id).find("#user_ttime"),total=thoursDom.attr("tmins")||0;total=parseInt(total);var newtime=(ttime<ftime?ttime+Timetracker.constants.PER_DAY_MIN:ttime)-ftime;if(isFromAdd||isMoved){if(settingsPage.container.find("#"+tr_id).find("#"+td_id).find(".js-schedule").append(dom),!isMoved){total+=newtime;var thours=Calendar.minstohrs(total);thoursDom.attr("tmins",total),thoursDom.text(thours+" "+ZPI18N.getString("zp.smallhrs"))}}else{var isDateChanged=!1,oldDom=settingsPage.container.find("#"+tr_id).find("#"+td_id).find(".js-schedule").find("#"+jobData.tschId);0===oldDom.length&&(isDateChanged=(oldDom=settingsPage.container.find("#"+tr_id).find(".js-schedule").find("#"+jobData.tschId)).length>0);var oldData=oldDom.data();oldData.assignedTo,oldData.date.split(" ")[0].split("-");var oldfrom=parseInt(oldData.fromTime),oldto=parseInt(oldData.toTime),newt=total+(newtime-((oldto<oldfrom?oldto+Timetracker.constants.PER_DAY_MIN:oldto)-oldfrom));newt<0&&(newt=newtime);thours=Calendar.minstohrs(newt);thoursDom.attr("tmins",newt),thoursDom.text(thours);var oldpub=oldDom.data("isPubed");jobData.isPubed&&!oldpub&&(Timetracker.jobSchedule.pub_cache.count-=1),!jobData.isPubed&&oldpub&&(Timetracker.jobSchedule.pub_cache.count+=1),isDateChanged?(oldDom.remove(),settingsPage.container.find("#"+tr_id).find("#"+td_id).find(".js-schedule").append(dom)):oldDom.replaceWith(dom),dom.ztooltip()}Timetracker.jobSchedule.Listing.updateUnpublishedCount()},filterOnChangeCallback:function(event){var entity=$(event.target).attr("name"),container=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup");switch(entity){case"client":TimetrackerOperations.Filters.clearCache(!1,"project"),filterDiv=container.find('[name="Project"]'),TimelyZComp.select.removeAllOptions(filterDiv),TimelyZComp.select.deselectAllOptions(filterDiv);case"project":TimetrackerOperations.Filters.clearCache(!1,"job"),filterDiv=container.find('[name="JobId"]'),TimelyZComp.select.removeAllOptions(filterDiv),TimelyZComp.select.deselectAllOptions(filterDiv)}},getDecimalWidth:function($elm){var rect=$elm[0].getBoundingClientRect();return rect.width?rect.width:rect.right-rect.left},updateResizeValforTotime:function($ui,ev){var rowwidth,dateid,assignee_id,elemSch=$ui.element;rowwidth=elemSch?elemSch.parents(".hour_body").width():(elemSch=$(ev.target)).parents(".hour_body").width();var dateNavId=Timetracker.Page.getPageMode()+"_"+Timetracker.jobSchedule.JobSchedule,date=ZPCommonUtil.DateNavigator.getPeriod(dateNavId).day;dateid=Timetracker.jobSchedule.isUserView()?elemSch.closest("table").attr("workdate"):date.getFullYear().toString()+"-"+("0"+(date.getMonth()+1).toString()).substr(-2)+"-"+("0"+date.getDate().toString()).substr(-2),assignee_id=elemSch.data("empId");var curWidth,jobSchObj={},jobDetails=elemSch.data(),pixPerMinute=1440/rowwidth,curPos=($ui.originalPosition.left,$ui.position.left);$ui.originalSize||$ui.size?($ui.originalSize.width,curWidth=$ui.size.width):curWidth=Timetracker.jobSchedule.Listing.getDecimalWidth(elemSch);var ftime=Math.round(curPos*pixPerMinute),ttime=Math.round((curPos+curWidth)*pixPerMinute);if(ftime<0&&(ftime=0),ftime>1440&&(ftime=1440),ttime<0&&(ttime=0),ttime>1440&&(ttime=1440),jobSchObj.jobId=jobDetails.jobId,jobSchObj.desc=ZPeople.decodeTxt(jobDetails.desc),jobSchObj.isPubed=jobDetails.isPubed,jobSchObj.fromtime=ftime,jobSchObj.totime=ttime,jobSchObj.fromtime!==jobSchObj.totime){if(jobSchObj.date=dateid,jobSchObj.tschId=jobDetails.tschId,jobSchObj.assignedTo=assignee_id,jobSchObj.billableStatus=jobDetails.billableStatus,jobSchObj.workitem=ZPeople.decodeTxt(jobDetails.workitem),Timetracker.jobSchedule.isJobSchTLExtendEnabled()&&(jobSchObj.extendAllowed=jobDetails.extendAllowed),Timetracker.jobSchedule.hasCustomFields()&&(jobSchObj.customFieldDetails=JSON.stringify(jobDetails.customFieldDetails)),jobDetails.repeatId){jobSchObj.editRepeat=!1,jobSchObj.repeatId=jobDetails.repeatId,jobSchObj.repeatType=jobDetails.repeatType,jobSchObj.repeatInt=jobDetails.repeatInt;var repuntil=jobDetails.repeatUntil;repuntil&&(repuntil=repuntil.split(" ")[0],jobSchObj.repeatUntil=repuntil),jobSchObj.repeatRule=jobDetails.repeatRule}jobSchObj.mode="updateJobSchedule";var ep={};(ep=jQuery.extend({},jobSchObj)).moveUI=$ui,Timetracker.jobSchedule.dataOperations.addUpdateJobSchedule({params:jobSchObj,callBack:Timetracker.jobSchedule.dataOperations.updateJobScheduleResponse,ep:ep})}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.jobschedulefromtotimesameerror"))},appendResizeIconToJobschInDayview:function(ele,jobDetails){var resizetxt;resizetxt='<div class="ui-resizable-handle"></div><div class="ui-resizable-handle ui-resizable-e"><i class="IC-drag FL gry dragic"></i></div>',ele.find('[tschid="'+jobDetails.tschId+'"]').parent().append(resizetxt)},loadMoreJobs:function(limit){var viewType=Timetracker.jobSchedule.calview;1===viewType?Timetracker.jobSchedule.Listing.getJobScheduleForWeekview():0===viewType&&Timetracker.jobSchedule.Listing.getJobScheduleForDayview()}},Timetracker.jobSchedule.dataOperations={getPopUpHtml:function(mode){var txt='<div class="zpl_crd"><div class="zpl_crdcnt sel_postion" id="jobschdform" style="position: relative;"><div class="zpl_secn"><table class="zpl_itbl zpl_ttllblfxd zpl_nocrsor"><tbody>'+(Timetracker.jobScheduleForm.isClientFieldAllowed(Timetracker.jobSchedule.currPopupUser,Timetracker.constants.EDIT)?"<tr><td><label>"+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'</label></td><td><div class="w400"><input id="jbsch_clientid"  name="Client" jobid="jbsch_jobid" projectid="jbsch_projectid"></div></td></tr>':"")+"<tr><td><label>"+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</label></td><td><div class="w400"><input id="jbsch_projectid" name="Project" jobid="jbsch_jobid" clientid="jbsch_clientid"></div></td></tr><tr><td><label class="zpl_mtry"><font>'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'</font></label></td><td><div class="zpl_idivingrp w400"><div><div><input id="jbsch_jobid" name="JobId" clientid="jbsch_clientid" projectid="jbsch_projectid"><span id="schColorBox" class="zpl_ibg zpl_cpd jc_bg1 zpl_drpdwn-js"></span></div></div></div></td></tr><tr><td><label>'+ZPI18N.getString("zp.date")+'</label></td><td><div><input id="schdDate" class="datepicker-js" data-placeholder-type="date-format-in-lower" data-width="200" data-format="dd/MM/yyyy" data-picker="true" data-calendar-icon="true" data-clear-button="none" data-spin-buttons="none" style="display: none;"></div></td></tr><tr><td><label>'+ZPI18N.getString("zp.time")+'</label></td><td><div class="zpl_idivingrp w400"><div><div><div><input id="timesch_fromtime" type="text" class="ztextbox "></div><div><input id="timesch_totime" type="text" class="ztextbox "></div></div></div></div></td></tr><tr><td><label>'+ZPI18N.getString("zp.description")+'</label></td><td><textarea id="sch_desc" type="text" class="ztextbox wd100_per"></textarea></td></tr><tr><td><label>'+ZPI18N.getString("zp.repeat")+'</label></td><td><div class="d-flex"><div class="zcheckbox"><input type="checkbox"  id="jbschrepeat" onclick="Timetracker.jobSchedule.dataOperations.showRepeat(this);" class="zcheckbox__helper"><label for="jbschrepeat" class="zcheckbox__label"></label></div><div><div><span class="zpl_DNI" id="repeatinfo"></span><a id="repeatedit" class="zpl_DNI" onclick="Timetracker.jobSchedule.dataOperations.editRepeat(this)"> '+ZPI18N.getString("zp.edit")+"</a></div></div></td></tr><tr><td><label>"+ZPI18N.getString("zp.billablestatus")+'</label></td><td><div folabel="BillableStatus" id="sch_billableStatus_div"><select id="sch_billableStatus"><option value="-1">'+ZPI18N.getString("zp.select")+'</option><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select></div></td></tr><tr><td><label>"+Timetracker.util.workitemDispName+'</label></td><td><div folabel="Workitem" fieldtype="3" id="sch_workitem_div"><input id="sch_workitem" name="Workitem" class="ztextbox w400" type="text"></div></td></tr>';if(Timetracker.jobSchedule.hasCustomFields()){var customFields=Timetracker.jobSchedule.getCustomFields(),allowedFileds=Timetracker.jobSchedule.Form.fetchAllAllowedFields(Timetracker.jobSchedule.currPopupUser,Timetracker.constants.EDIT,customFields);if(!allowedFileds||0!=allowedFileds.length)for(var iterator in customFields){var field=customFields[iterator];if(allowedFileds.includes(field.labelName))if(25===field.componentType){var optionsHtml='<option value="0">'+ZPI18N.getString("zp.select")+"</option>";for(var i in field.options)optionsHtml+='<option value="'+field.options[i].optionId+'">'+field.options[i].optionValue+"</option>";txt+='<tr><td><label class="'+(field.isMandatory?"zpl_mtry":"")+'">'+field.displayName+'</label></td><td><div folabel="'+field.labelName+'" class="customField"><select fieldName="'+field.labelName+'" id="'+field.labelName+'_select" class="customFieldSelect">'+optionsHtml+'</select><div class="error-msg red customFieldError" id="'+field.labelName+'_error" style="display:none;">'+ZPI18N.getString("zp.selvalforfield",[field.displayName])+"</div></div></td></tr>"}else 1!==field.componentType&&19!==field.componentType||(txt+='<tr><td><label class="'+(field.isMandatory?"zpl_mtry":"")+'">'+field.displayName+'</label></td><td><div folabel="'+field.labelName+'" fieldtype="'+field.componentType+'" id="'+field.labelName+'" class="customField"><input fieldName="'+field.labelName+'" id="'+field.labelName+'_input" class="ztextbox w400 customFieldInput" type="text"><div class="error-msg red customFieldError" id="'+field.labelName+'_error" style="display:none;"></div></div></td></tr>')}}Timetracker.jobSchedule.isJobSchTLExtendEnabled()&&(txt+="<tr><td><label>"+ZPI18N.getString("zp.jobschextend")+'</label></td><td><div class="zpl_idiv"><div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" id="jbschextension" class="zcheckbox__helper"><label for="jbschextension" class="zcheckbox__label"></label></div></td></tr>'),txt+='</tbody></table></div></div><div class="zpl_crdcnt zpl_DNI" id="jobschdrepeatform"><div class="zpl_secn"><table class="zpl_itbl"><tbody><tr><td><label>'+ZPI18N.getString("zp.repeats")+'</label></td><td class="w400"><select id="repeatid" class="select-js" style="display: none;"><option value="0">'+ZPI18N.getString("zp.daily")+'</option><option value="1">'+ZPI18N.getString("zp.weekly")+'</option><option value="2">'+ZPI18N.getString("zp.monthly")+"</option></select></td></tr><tr><td><label>"+ZPI18N.getString("zp.interval")+'</label></td><td class="w400" id="repeat_daily_name"><select id="daily_int" class="select-js" name="daily_int"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select></td><td width="150px" id="repeat_week_name" class="zpl_DNI"><select id="weekly_int" class="select-js" style="display: none;" name="weekly_int"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select></td><td id="repeat_month_name" width="150px" class="zpl_DNI"><select id="month_int" name="monthly_int" class="select-js"style="display: none;"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select></td></tr><tr><td><label>'+ZPI18N.getString("zp.until")+'</label></td><td class="w400"><input id="popRepDate" class="datepicker-js" data-placeholder-type="date-format-in-lower" data-format="dd/MM/yyyy" data-picker="true" data-calendar-icon="true" data-clear-button="none" data-spin-buttons="none" style="display: none;"></td></tr></tbody></table></div></div></div>';var buttonHtml='<button type="button" class="zlabel zlabel--blue zlabel--medium" id="publishSchedule">'+ZPI18N.getString("zp.publish")+'</button> <button type="button" class="zlabel zlabel--blue zlabel--outline zlabel--medium" id="submitSchedule">'+ZPI18N.getString("zp.savedraftbtn")+'</button> <button type="button" class="zlabel zlabel--outline zlabel--medium" id="zp_modal_whitebtn">'+ZPI18N.getString("zp.cancel")+"</button>";ModuleComp.Modal.setup({id:"jobScheduleAddEditPopup",type:1,header:"edit"==mode?ZPI18N.getString("zp.editschedule"):ZPI18N.getString("zp.addschedule"),body:txt,deleteOnHide:!1,closeOnSubmit:!0,isConfirm:!1,backdrop:!1,hiddenCallback:Timetracker.jobSchedule.dataOperations.destroyZComp,buttonHtml:buttonHtml})},getViewPopUpHtml:function(){var txt='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><table class="zpl_itbl zpl_ttllblfxd zpl_nocrsor"><tbody>'+(Timetracker.jobScheduleForm.isClientFieldAllowed(Timetracker.jobSchedule.currPopupUser,Timetracker.constants.VIEW)?"<tr><td><em>"+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'</em></td><td><span id="jbsch_client"></span></td></tr>':"")+"<tr><td><em>"+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</em></td><td><span id="jbsch_project"></span></td></tr><tr><td><em>'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'</em></td><td><span id="jbsch_job"></span></td></tr><tr><td><em>'+ZPI18N.getString("zp.date")+'</em></td><td><span id="jbsch_date"></span></td></tr><tr><td><em>'+ZPI18N.getString("zp.time")+'</em></td><td><span id="jbsch_time"></span></td></tr><tr><td><em>'+ZPI18N.getString("zp.description")+'</em></td><td><span id="jbsch_desc"></span></td></tr><tr><td><em>'+ZPI18N.getString("zp.repeat")+'</em></td><td><span id="jbsch_repeat"></span><td></td></tr><tr><td><em>'+ZPI18N.getString("zp.billablestatus")+'</em></td><td><span id="jbsch_billableStatus"></span><td></td></tr><tr><td><em>'+Timetracker.util.workitemDispName+'</em></td><td><span id="jbsch_workitem"></span></td></tr>';if(Timetracker.jobSchedule.hasCustomFields()){var customFields=Timetracker.jobSchedule.getCustomFields(),allowedFileds=Timetracker.jobSchedule.Form.fetchAllAllowedFields(Timetracker.jobSchedule.currPopupUser,Timetracker.constants.VIEW,customFields);if(allowedFileds&&0!=allowedFileds.length)for(var iterator in customFields){var field=customFields[iterator];allowedFileds.includes(field.labelName)&&(txt+="<tr><td><em>"+field.displayName+'</em></td><td><span id="jbsch_'+field.labelName+'"></span></td></tr>')}}Timetracker.jobSchedule.isJobSchTLExtendEnabled()&&(txt+="<tr><td><em>"+ZPI18N.getString("zp.jobschextend")+'</em></td><td><span id="jbsch_extend"></span></td></td></tr>'),txt+="</tbody></table></div></div></div>";var buttonHtml='<button type="button" class="zlabel zlabel--outline zlabel--medium" id="zp_modal_whitebtn">'+ZPI18N.getString("zp.close")+"</button>",modal=ModuleComp.Modal.setup({id:"jobScheduleViewPopup",type:1,header:ZPI18N.getString("zp.viewComp",[ZPI18N.getString("zp.schedule")]),body:txt,deleteOnHide:!1,isConfirm:!1,backdrop:!1,buttonHtml:buttonHtml});return ModuleComp.Modal.hide("jobScheduleViewPopup"),modal},addJobScheduleConstruct:async function(ev,th){var dateid,erecno=$(th).attr("id").split("_")[0];Timetracker.Page.getPageMode();if(1===Timetracker.jobSchedule.calview)Timetracker.jobSchedule.isUserView()?(erecno=$(th).closest("table").attr("erecno"),dateid=$(th).closest("table").attr("workdate")):dateid=$(th).attr("dateid");else if(0===Timetracker.jobSchedule.calview){erecno=$(th).parents(".hour_body").attr("id").split("_")[0];var dateNavId=Timetracker.Page.getPageMode()+"_"+Timetracker.jobSchedule.JobSchedule,date=ZPCommonUtil.DateNavigator.getPeriod(dateNavId).day;dateid=date.getFullYear().toString()+"-"+("0"+(date.getMonth()+1).toString()).substr(-2)+"-"+("0"+date.getDate().toString()).substr(-2)}if(Timetracker.jobSchedule.currPopupDate=dateid,Timetracker.jobSchedule.currPopupUser=erecno,Timetracker.jobSchedule.dataOperations.isAddEditAllowedForDate(erecno,dateid,!0)){Timetracker.jobSchedule.currPopupMode="add",Timetracker.jobSchedule.dataOperations.getPopUpHtml(),ModuleComp.Modal.hide("jobScheduleAddEditPopup");var modalElm=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup");modalElm.ztooltip(),modalElm.find("#zp_modal_header").parent().addClass("d-flexC j-cnt-btwen"),modalElm.find("#zp_modal_header").replaceWith('<div id="zp_modal_header" class="zpl_mhicn"><a class="clsArw zpl_DNI" onclick="Timetracker.jobSchedule.dataOperations.backToMainPopup(this)"><i class="PI_back" title="'+ZPI18N.getString("zp.back")+'"></i></a><h4>'+ZPI18N.getString("zp.addschedule")+"</h4></div>"),modalElm.find("#submitSchedule,#publishSchedule").prop("disabled",!1),modalElm.find("#jobsch_delete").length>0&&modalElm.find("#jobsch_delete").remove();if("hh:mm a"==timeFormat&&!0,0===Timetracker.jobSchedule.calview||Timetracker.jobSchedule.isUserView())var clickedHour=$(th).attr("id").split("_")[1],startMins=60*Number(clickedHour),endMins=60*(Number(clickedHour)+1),fromTime=Timetracker.DateTime.minstoTimeMeridian(startMins),toTime=Timetracker.DateTime.minstoTimeMeridian(endMins);else if(Timetracker.jobSchedule.hasCustomFields()){Timetracker.jobSchedule.isUserView()?modalElm.find("#user_week_view_jobsch").hide():modalElm.find("#week_view_jobsch").hide();let user=Timetracker.jobSchedule.currPopupUser,date=Timetracker.jobSchedule.currPopupDate;var params={mode:"getJobSchUserShiftData",conreqcsr:csrfToken};params.user=user,params.date=date;let userShiftData=Timetracker.jobSchedule.usersShiftData[user]||{};if(!userShiftData.hasOwnProperty(date)){let userShiftDataRes=await Timetracker.Request.sendAsPromiseWithTimeOut(Timetracker.constants.URL,params,{errorMsg:"TimeOut"},1e4,Timetracker.jobSchedule.dataOperations.setJobSchUserShiftCache);userShiftDataRes.hasOwnProperty("errorCode")||userShiftDataRes.hasOwnProperty("errorMsg")||(userShiftData=Timetracker.jobSchedule.usersShiftData[user])}let shiftTime=userShiftData?userShiftData[date]:[];shiftTime&&shiftTime.fromTime&&shiftTime.toTime&&(fromTime=Timetracker.DateTime.minstoTimeMeridian(shiftTime.fromTime),toTime=Timetracker.DateTime.minstoTimeMeridian(shiftTime.toTime),Layout.Page.container.find("#timesch_fromtime").val(fromTime),Layout.Page.container.find("#timesch_totime").val(toTime)),Timetracker.jobSchedule.isUserView()?modalElm.find("#user_week_view_jobsch").show():modalElm.find("#week_view_jobsch").show()}var fT=new Date,tT=new Date;tT.setHours(tT.getHours()+1);var bootfromtime=fromTime||fT,boottotime=toTime||tT,options={clearButton:"none",format:timeFormat.replace("a","tt"),value:bootfromtime,minuteStep:1};TimelyZComp.timeField.intialize(modalElm.find("#timesch_fromtime"),options);options.value=boottotime;TimelyZComp.timeField.intialize(modalElm.find("#timesch_totime"),options);Timetracker.clients.getClients("jbsch_clientid",null,null,!1,erecno,null,{isV5:!0,erecNo:erecno}),await Timetracker.projects.Filters.createProjectSelect(!0,erecno,null,"jobsch",null,null,null,null,{erecNo:erecno});var clientSel=modalElm.find("#jbsch_clientid"),projSel=modalElm.find("#jbsch_projectid"),jobSel=modalElm.find("#jbsch_jobid");if(ZPeopleComponents.isComponent(clientSel)&&clientSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var erecno=modalElm.attr("erecno"),clientId=data.selectedValue;Timetracker.projects.Filters.createProjectSelect(!0,erecno,clientId,"jobsch",null,"0",null,null,{erecNo:erecno})}}),projSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var erecno=modalElm.attr("erecno"),cltid=ZPeopleComponents.isComponent(clientSel)?TimetrackerOperations.Filters.getSelectFilterValues(clientSel):void 0,projId=data.selectedValue;Timetracker.jobs.Filters.createJobSelect(erecno,"0","jobsch",projId,cltid,null,{erecNo:erecno})}}),jobSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){Timetracker.timelogs.jobChange("jobsch",void 0,{isV5:!0});var userJobArr=Timetracker.jobs.jobData,jId=data.selectedValue,jColor=Timetracker.jobs.defJobColor;if(userJobArr){if(jId&&"0"!==jId)var tempIndex=Timetracker.projects.Operations.findJSONArrayIndex(userJobArr,jId,"jobId");tempIndex&&"-1"!==tempIndex&&(jColor=userJobArr[tempIndex].jobColor?userJobArr[tempIndex].jobColor:"0")}var finalcls="zpl_ibg zpl_cpd zpl_drpdwn-js jc_bg"+(jColor="0"===jColor?Timetracker.jobs.defJobColor:jColor);modalElm.find("#schColorBox").attr("class",finalcls)}}),TimelyZComp.select.intialize(modalElm.find("#repeatid"),{change:Timetracker.jobSchedule.dataOperations.repeatIntervalToggle}),TimelyZComp.select.intialize(modalElm.find("#daily_int")),TimelyZComp.select.intialize(modalElm.find("#weekly_int")),TimelyZComp.select.intialize(modalElm.find("#month_int")),TimelyZComp.select.intialize(modalElm.find("#sch_billableStatus"),{dropdownList:{appendTo:modalElm,moveOnScroll:!0}}),Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem()){let extraJson={};extraJson.erecno=erecno,extraJson.elementId="sch_workitem",extraJson.layout=modalElm.find("#sch_workitem"),Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson)}var currDate=Calendar.parseDate(Timetracker.jobSchedule.currPopupDate,"%y-%m-%d"),repdae=Calendar.formatDate(currDate),schdate=TimelyZComp.dateField.intialize(modalElm.find("#schdDate"));schdate.setValue(repdae),(schdate=TimelyZComp.dateField.intialize(modalElm.find("#popRepDate"))).setValue(repdae),modalElm.attr("erecno",erecno),modalElm.find("#submitSchedule").off("click").on("click",function(){Timetracker.jobSchedule.dataOperations.addUpdateJobScheduleDetails(erecno)}),modalElm.find("#publishSchedule").off("click").on("click",function(){Timetracker.jobSchedule.dataOperations.addUpdateJobScheduleDetails(erecno,void 0,void 0,!0)}),modalElm.find("#popRepDate").on("zdatefieldpickerdateselect",function(event,data){var repdae=Calendar.parseDate(event.detail.valueString,uidateFormat);Timetracker.jobSchedule.dataOperations.repDateValidation(repdae)}),Timetracker.jobSchedule.hasCustomFields()&&modalElm.find(".customFieldSelect").each(function(){TimelyZComp.select.intialize($(this))}),ModuleComp.Modal.show(modalElm)}},addEditPopClass:function(remove){remove?$("body").removeClass("custpop_bdy"):$("body").addClass("custpop_bdy")},viewJobScheduleConstruct:function(jobschDtl){var modal=Timetracker.jobSchedule.dataOperations.getViewPopUpHtml();0!=modal.find("#jbsch_client").length&&(jobschDtl.clientName&&""!=jobschDtl.clientName?modal.find("#jbsch_client").text(ZPeople.decodeTxt(jobschDtl.clientName)):modal.find("#jbsch_client").text("-")),jobschDtl.projectName&&""!=jobschDtl.projectName?modal.find("#jbsch_project").text(ZPeople.decodeTxt(jobschDtl.projectName)):modal.find("#jbsch_project").text("-"),jobschDtl.jobName&&""!=jobschDtl.jobName?modal.find("#jbsch_job").text(ZPeople.decodeTxt(jobschDtl.jobName)):modal.find("#jbsch_job").text("-");var schdDate=jobschDtl.date;schdDate=schdDate.split(" ")[0];var schdDateObj=new Date(schdDate),dateString=Calendar.formatDate(schdDateObj);modal.find("#jbsch_date").text(dateString);var fromTime=Calendar.minstotime(jobschDtl.fromTime),toTime=Calendar.minstotime(jobschDtl.toTime);if(modal.find("#jbsch_time").text(fromTime+" - "+toTime),jobschDtl.desc&&""!=jobschDtl.desc?modal.find("#jbsch_desc").text(ZPeople.decodeTxt(jobschDtl.desc)):modal.find("#jbsch_desc").text("-"),jobschDtl.workitem&&""!=jobschDtl.workitem?modal.find("#jbsch_workitem").text(ZPeople.decodeTxt(jobschDtl.workitem)):modal.find("#jbsch_workitem").text("-"),jobschDtl.billableStatus&&""!=jobschDtl.billableStatus){var sts="-";0==jobschDtl.billableStatus?sts=ZPI18N.getString("zp.billable"):1==jobschDtl.billableStatus&&(sts=ZPI18N.getString("zp.nonbillable")),modal.find("#jbsch_billableStatus").text(sts)}else modal.find("#jbsch_billableStatus").text("-");if(jobschDtl.repeatType&&""!=jobschDtl.repeatType){var repType=jobschDtl.repeatType,repInt=jobschDtl.repeatInt,repUntil=jobschDtl.repeatUntil,repDateObj=new Date(repUntil.split(" ")[0]),repDate=Calendar.formatDate(repDateObj),repTxt=ZPI18N.getString("zp.days");"1"===repType?repTxt=ZPI18N.getString("zp.wftbaweeks"):"2"===repType&&(repTxt=ZPI18N.getString("zp.months"));var infoArr=[];infoArr.push(repInt),infoArr.push(repTxt),infoArr.push(repDate);var repinfo=ZPI18N.getString("zp.repeatinfo",infoArr);modal.find("#jbsch_repeat").text(repinfo)}else modal.find("#jbsch_repeat").text("-");if(Timetracker.jobSchedule.hasCustomFields()){var customFields=Timetracker.jobSchedule.getCustomFields(),allowedFileds=Timetracker.jobSchedule.Form.fetchAllAllowedFields(Timetracker.jobSchedule.currPopupUser,Timetracker.constants.VIEW,customFields);if(allowedFileds&&0!=allowedFileds.length){var customFieldDetails=jobschDtl.customFieldDetails;for(var iterator in customFields){var field=customFields[iterator];if(allowedFileds.includes(field.labelName))if(customFieldDetails&&customFieldDetails.hasOwnProperty(field.labelName)&&""!=customFieldDetails[field.labelName]){var dispVal=customFieldDetails[field.labelName];if(25===field.componentType){var optVal=field.options.find(option=>option.optionId==dispVal);dispVal=optVal.optionValue}modal.find("#jbsch_"+field.labelName).text(dispVal)}else modal.find("#jbsch_"+field.labelName).text("-")}}}Timetracker.jobSchedule.isJobSchTLExtendEnabled()&&(jobschDtl.extendAllowed?modal.find("#jbsch_extend").text(ZPI18N.getString("zp.yes")):modal.find("#jbsch_extend").text(ZPI18N.getString("zp.no"))),ModuleComp.Modal.show(modal)},editJobScheduleConstruct:async function(editJson,ev,th,showChooseEdit,disableEdit){var empno,dateid;1===Timetracker.jobSchedule.calview?Timetracker.jobSchedule.isUserView()?(empno=$(th).closest("table").attr("erecno"),dateid=$(th).closest("table").attr("workdate")):(empno=$(th).parent().parent().attr("id").split("_")[0],dateid=$(th).parent().parent().attr("dateid")):0===Timetracker.jobSchedule.calview&&(empno=$(th).data("empId"),dateid=editJson.date.split(" ")[0]);Timetracker.Page.getPageMode();if(1===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.isUserView()&&(empno=editJson.assignedTo,dateid=editJson.date.split(" ")[0]),Timetracker.jobSchedule.currPopupDate=dateid,Timetracker.jobSchedule.currPopupUser=empno,!Timetracker.jobSchedule.dataOperations.isAddEditAllowedForDate(Timetracker.jobSchedule.currPopupUser,Timetracker.jobSchedule.currPopupDate,!1)||disableEdit)return void Timetracker.jobSchedule.dataOperations.viewJobScheduleConstruct(editJson);Timetracker.jobSchedule.currPopupMode="edit",Timetracker.jobSchedule.dataOperations.getPopUpHtml(Timetracker.jobSchedule.currPopupMode),ModuleComp.Modal.hide("jobScheduleAddEditPopup");var modalDiv=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup");modalDiv.ztooltip(),modalDiv.find("#zp_modal_header").parent().addClass("d-flexC j-cnt-btwen"),modalDiv.find("#zp_modal_header").replaceWith('<div id="zp_modal_header" class="zpl_mhicn"><a class="clsArw zpl_DNI" onclick="Timetracker.jobSchedule.dataOperations.backToMainPopup(this)"><i class="PI_back" title="'+ZPI18N.getString("zp.back")+'"></i></a><h4>'+("edit"==Timetracker.jobSchedule.currPopupMode?ZPI18N.getString("zp.editschedule"):ZPI18N.getString("zp.addschedule"))+"</h4></div>"),modalDiv.find(".zpl_mhder").find("#jobsch_delete").remove(),modalDiv.find("#submitSchedule,#publishSchedule").prop("disabled",!1),$("#jobschdform").data("disEditab",disableEdit),$("#jobschdform").data("IsPublish",editJson.isPubed);showChooseEdit?(modalDiv.find("#zp_modal_header").append("<a id='jobsch_delete' class='PI_delete' title='"+ZPI18N.getString("zp.delete")+"'></a>"),modalDiv.find("#repeatedit").removeClass("zpl_DNI"),modalDiv.find("#jobsch_delete").off("click").on("click",function(){Timetracker.jobSchedule.dataOperations.destroyZComp(),ModuleComp.Modal.hide("jobScheduleAddEditPopup"),Timetracker.jobSchedule.dataOperations.chooseRepeatType({id:editJson.tschId,action:"delete"})})):(modalDiv.find("#zp_modal_header").append("<a id='jobsch_delete' class='PI_delete' title='"+ZPI18N.getString("zp.delete")+"'></a>"),!0,modalDiv.find("#jobsch_delete").off("click").on("click",function(){$(this).data({id:editJson.tschId}),Timetracker.jobSchedule.dataOperations.destroyZComp(),ModuleComp.Modal.hide("jobScheduleAddEditPopup");var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.sjobschedule")]),body:ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.sjobschedule")])};Timetracker.Util.confirmpopUp(editJson.tschId,Timetracker.jobSchedule.dataOperations.deleteSchedule,{id:editJson.tschId},0,extraDtls)})),modalDiv.find("#publishSchedule").off("click").on("click",function(){showChooseEdit?Timetracker.jobSchedule.dataOperations.validateAddUpdateJobScheduleDetails(empno,editJson)&&Timetracker.jobSchedule.dataOperations.chooseRepeatType({dateid:dateid,empno:empno,tschObj:editJson,isPubed:!0,action:"publish"}):Timetracker.jobSchedule.dataOperations.addUpdateJobScheduleDetails(empno,editJson,!0,!0)}),disableEdit?(modalDiv("#submitSchedule").prop("disabled",!0),modalDiv("#jobsch_delete").remove(),modalDiv("#jbschrepeat").attr("disabled",!0)):modalDiv.find("#submitSchedule").off("click").on("click",function(){showChooseEdit?Timetracker.jobSchedule.dataOperations.validateAddUpdateJobScheduleDetails(empno,editJson)&&Timetracker.jobSchedule.dataOperations.chooseRepeatType({dateid:dateid,empno:empno,tschObj:editJson,isPubed:!1,action:"edit"}):Timetracker.jobSchedule.dataOperations.addUpdateJobScheduleDetails(empno,editJson,!0,!1)}),Timetracker.clients.getClients("jbsch_clientid",null,null,!1,empno,null,{isV5:!0}),await Timetracker.projects.Filters.createProjectSelect(!0,empno,null,"jobsch",null,null,null,null);var selectdetails={allowAll:!0,isNewKey:!0,isV5:!0,erecNo:empno};Timetracker.timelogs.setValuesInSelectInput(editJson,"jobsch",null,null,selectdetails);var clientSel=modalDiv.find("#jbsch_clientid"),projSel=modalDiv.find("#jbsch_projectid"),jobSel=modalDiv.find("#jbsch_jobid");if(ZPeopleComponents.isComponent(clientSel)&&clientSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var empno=modalDiv.attr("erecno"),clientId=data.selectedValue;Timetracker.projects.Filters.createProjectSelect(!0,empno,clientId,"jobsch",null,"0",null,null)}}),projSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var empno=modalDiv.attr("erecno"),cltid=ZPeopleComponents.isComponent(clientSel)?TimetrackerOperations.Filters.getSelectFilterValues(clientSel):void 0,projId=data.selectedValue;Timetracker.jobs.Filters.createJobSelect(empno,"0","jobsch",projId,cltid,null,{isV5:!0})}}),jobSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){Timetracker.timelogs.jobChange("jobsch",void 0,{isV5:!0});var userJobArr=Timetracker.jobs.jobData,jId=data.selectedValue,jColor=Timetracker.jobs.defJobColor;if(userJobArr){if(jId&&"0"!==jId)var tempIndex=Timetracker.projects.Operations.findJSONArrayIndex(userJobArr,jId,"jobId");tempIndex&&"-1"!=tempIndex&&(jColor=userJobArr[tempIndex].jobColor?userJobArr[tempIndex].jobColor:"0")}var finalcls="zpl_ibg zpl_cpd zpl_drpdwn-js jc_bg"+(jColor="0"===jColor?Timetracker.jobs.defJobColor:jColor);modalDiv.find("#schColorBox").attr("class",finalcls)}}),void 0!==editJson.color){var finalcls="zpl_ibg zpl_cpd zpl_drpdwn-js jc_bg"+editJson.color;modalDiv.find("#schColorBox").attr("class",finalcls)}modalDiv.attr("erecno",empno);var schdDate=editJson.date;schdDate=schdDate.split(" ")[0];var schdDateObj=new Date(schdDate),schDay=Calendar.formatDate(schdDateObj);TimelyZComp.dateField.intialize(modalDiv.find("#schdDate")).setValue(schDay);timeFormat;var options={clearButton:"none",format:timeFormat.replace("a","tt"),value:Timetracker.DateTime.minstoTimeMeridian(editJson.fromTime),minuteStep:1};TimelyZComp.timeField.intialize(modalDiv.find("#timesch_fromtime"),options);options.value=Timetracker.DateTime.minstoTimeMeridian(editJson.toTime);TimelyZComp.timeField.intialize(modalDiv.find("#timesch_totime"),options);!0===editJson.isPubed||"true"===editJson.isPubed?modalDiv.find("#publishSchedule").prop("disabled",!0):!0===editJson.isPubed&&"true"===editJson.isPubed||modalDiv.find("#submitSchedule").prop("disabled",!0),modalDiv.find("#sch_desc").val(ZPeople.decodeTxt(editJson.desc)),ZPeopleComponents.select(modalDiv.find("#repeatid"),{change:function(e,data){Timetracker.jobSchedule.dataOperations.repeatIntervalToggle(e),data.fromUI&&callback(e)}}),TimelyZComp.select.intialize(modalDiv.find("#daily_int")),TimelyZComp.select.intialize(modalDiv.find("#weekly_int")),TimelyZComp.select.intialize(modalDiv.find("#month_int")),TimelyZComp.select.intialize(modalDiv.find("#sch_billableStatus"),{dropdownList:{appendTo:modalDiv,moveOnScroll:!0}}).setValue(editJson.billableStatus),"-1"!=editJson.jobBillableStatus&&editJson.billableStatus===Number(editJson.jobBillableStatus)&&TimelyZComp.select.setAttributes(modalDiv.find("#sch_billableStatus"),{disabled:!0}),void 0!==editJson.workitem&&(modalDiv.find("#sch_workitem").val(ZPeople.decodeTxt(editJson.workitem)),modalDiv.find("#sch_workitem").attr("orgTaskName",editJson.workitem));let extraJson={};if(extraJson.jobId=editJson.jobId,extraJson.erecno=empno,Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem(extraJson)?(extraJson.elementId="sch_workitem",extraJson.layout=modalDiv.find("#sch_workitem"),void 0!==editJson.workitem&&(extraJson.toAppendOption=editJson.workitem),Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson),modalDiv.find("#sch_workitem").off().on("zselectchange",function(e){callback(e)})):modalDiv.find("#sch_workitem").off().on("change",function(e){callback(e)}),editJson.repeatId){modalDiv.find("#jbschrepeat").attr("checked",!0),modalDiv.find("#jbschrepeat").attr("disabled",!0);editJson.repeatId;var repeatType=editJson.repeatType,repeatInt=editJson.repeatInt,repeatUntil=editJson.repeatUntil;editJson.repeatRule;repeatUntil=repeatUntil.split(" ")[0];var repeatDateObj=new Date(repeatUntil),repdae=Calendar.formatDate(repeatDateObj);TimelyZComp.select.setValue(modalDiv.find("#repeatid"),repeatType);var reptxt=ZPI18N.getString("zp.days");"0"===repeatType?TimelyZComp.select.setValue(modalDiv.find("#daily_int"),repeatInt):"1"===repeatType?(TimelyZComp.select.setValue(modalDiv.find("#weekly_int"),repeatInt),reptxt=ZPI18N.getString("zp.wftbaweeks")):"2"===repeatType&&(TimelyZComp.select.setValue(modalDiv.find("#month_int"),repeatInt),reptxt=ZPI18N.getString("zp.months"));var infoArr=[];infoArr.push(repeatInt),infoArr.push(reptxt),infoArr.push(repdae);ZPI18N.getString("zp.repeatinfo",infoArr);var info="Every "+repeatInt+"  "+reptxt+" until "+repdae;modalDiv.find("#repeatinfo").html(info).removeClass("zpl_DNI"),TimelyZComp.dateField.intialize(modalDiv.find("#popRepDate")).setValue(repdae)}else{var currDate=Calendar.parseDate(Timetracker.jobSchedule.currPopupDate,"%y-%m-%d");repdae=Calendar.formatDate(currDate),dateFmt;TimelyZComp.dateField.intialize(modalDiv.find("#popRepDate")).setValue(repdae)}Timetracker.jobSchedule.isJobSchTLExtendEnabled()&&editJson.extendAllowed&&modalDiv.find("#jbschextension").prop("checked",!0);var validTime={fromt:TimelyZComp.timeField.getValue(modalDiv.find("#timesch_fromtime")),tot:TimelyZComp.timeField.getValue(modalDiv.find("#timesch_totime"))},callback=function(e){disableEdit||Timetracker.jobSchedule.dataOperations.validationForButtons(editJson,validTime,schDay,repdae)};if(Timetracker.jobSchedule.hasCustomFields()){var customFields=Timetracker.jobSchedule.getCustomFields(),allowedFileds=Timetracker.jobSchedule.Form.fetchAllAllowedFields(Timetracker.jobSchedule.currPopupUser,Timetracker.constants.EDIT,customFields);if(!allowedFileds||0==allowedFileds.length)return;var customFieldDetails=editJson.customFieldDetails;for(var iterator in customFields){var field=customFields[iterator];if(allowedFileds.includes(field.labelName)){var elementDiv=Layout.Page.container.find('.customField[folabel="'+field.labelName+'"]');if(25===field.componentType){var selectElement=TimelyZComp.select.intialize(elementDiv.find("select"));void 0!==customFieldDetails&&void 0!==customFieldDetails[field.labelName]&&""!==customFieldDetails[field.labelName]&&selectElement.setValue(customFieldDetails[field.labelName]),elementDiv.find("select").on("zselectchange",function(e){callback(e)})}else 1!==field.componentType&&19!==field.componentType||(void 0!==customFieldDetails&&void 0!==customFieldDetails[field.labelName]&&elementDiv.find("input").val(customFieldDetails[field.labelName]),elementDiv.find("input").on("input",function(e){callback(e)}))}}}modalDiv.find("#jbsch_clientid,#jbsch_jobid,#jbsch_projectid,#daily_int,#weekly_int,#month_int,#sch_billableStatus,#sch_workitem").on("zselectchange",function(e){callback(e)}),modalDiv.find("#jbschrepeat,#jbschextension").on("change",function(e){callback(e)}),modalDiv.find("#sch_desc,#sch_workitem").on("input",function(e){callback(e)}),modalDiv.find("#timesch_fromtime,#timesch_totime").on("ztimefieldspinend",function(e){callback(e)}),modalDiv.find("#schdDate,#popRepDate").on("zdatefieldspinend",function(e){var repdae=Calendar.parseDate(e.detail.value,uidateFormat);"popRepDate"==e.detail.element.attr("id")?Timetracker.jobSchedule.dataOperations.repDateValidation(repdae):Timetracker.jobSchedule.dataOperations.scheduleDateOnSelectCallback(repdae),callback(e)}),modalDiv.find("#schdDate,#popRepDate").on("zdatefieldpickerdateselect",function(e){var repdae=Calendar.parseDate(e.detail.valueString,uidateFormat);"popRepDate"==e.detail.element.attr("id")?Timetracker.jobSchedule.dataOperations.repDateValidation(repdae):Timetracker.jobSchedule.dataOperations.scheduleDateOnSelectCallback(repdae),callback(e)}),ModuleComp.Modal.show(modalDiv)},validateAddUpdateJobScheduleDetails:function(assigneeid,tschObj){var jobSchObj={},modalDiv=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup"),str_jobId=TimelyZComp.select.getValue(modalDiv.find("#jbsch_jobid"));if(Timetracker.util.removeErrorMsg(void 0,modalDiv,!0),!str_jobId||"0"===str_jobId)return!1===modalDiv.find("#jobschdform").is(":visible")&&Timetracker.jobSchedule.dataOperations.backToMainPopup(),Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#jbsch_jobid"),msg:ZPI18N.getString("zp.selvalforfield",[ZPI18N.getString("zp.jobname")]),appendTo:modalDiv.find("#jbsch_jobid").parent().parent()}),!1;if(jobSchObj.jobId=str_jobId,jobSchObj.desc=modalDiv.find("#sch_desc").val(),jobSchObj.desc&&jobSchObj.desc.length>500)return!1===modalDiv.find("#jobschdform").is(":visible")&&Timetracker.jobSchedule.dataOperations.backToMainPopup(),Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#sch_desc"),msg:ZPI18N.getString("zp.namecharlimit",[ZPI18N.getString("zp.description"),"500"])}),!1;if(jobSchObj.billableStatus=modalDiv.find("#sch_billableStatus").val(),ZPeopleComponents.isComponent(modalDiv.find("#sch_workitem"))?(jobSchObj.workitem=ZPeople.decodeTxt(TimelyZComp.select.getValue(modalDiv.find("#sch_workitem"))),"0"===jobSchObj.workitem&&(jobSchObj.workitem="")):jobSchObj.workitem=modalDiv.find("#sch_workitem").val(),jobSchObj.workitem.length>500)return!1===modalDiv.find("#jobschdform").is(":visible")&&Timetracker.jobSchedule.dataOperations.backToMainPopup(),ZPeopleComponents.isComponent(modalDiv.find("#sch_workitem"))?Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#sch_workitem"),msg:ZPI18N.getString("zp.namecharlimit",[ZPI18N.getString("zp.workitem"),"500"]),appendTo:modalDiv.find("#sch_workitem").parent().parent()}):Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#sch_workitem"),msg:ZPI18N.getString("zp.namecharlimit",[ZPI18N.getString("zp.workitem"),"500"])}),!1;var dateDOM=modalDiv.find("#schdDate"),schdDate=TimelyZComp.dateField.getValue(dateDOM);if(!schdDate||!ZPUtil.Validation.isDate(schdDate))return!1===modalDiv.find("#jobschdform").is(":visible")&&Timetracker.jobSchedule.dataOperations.backToMainPopup(),Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#schdDate"),msg:ZPI18N.getString("zp.validdateerr")}),!1;var selDate=Calendar.parseDate(schdDate,uidateFormat),dateid=Timetracker.DateTime.getDateinDBformat(selDate,!0);jobSchObj.date=dateid;var fromtime=TimelyZComp.timeField.getValue(modalDiv.find("#timesch_fromtime"));if(fromtime){fromtime=fromtime.trim();var totime=TimelyZComp.timeField.getValue(modalDiv.find("#timesch_totime"));if(totime){if(fromtime===(totime=totime.trim()))return Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#timesch_fromtime"),msg:ZPI18N.getString("zp.jobschedulefromtotimesameerror")}),void Timetracker.Util.addError(modalDiv.find("#timesch_totime"));var fromtimesplit=fromtime.split(":"),totimesplit=totime.split(":");if(jobSchObj.fromtime=Timetracker.util.getTotalTimeForHours(fromtimesplit),jobSchObj.totime=Timetracker.util.getTotalTimeForHours(totimesplit),jobSchObj.fromtime&&jobSchObj.fromtime>1440&&(jobSchObj.fromtime=1440),jobSchObj.totime&&jobSchObj.totime>1440&&(jobSchObj.totime=1440),Timetracker.jobSchedule.dataOperations.isScheduleOverLapping(dateid,assigneeid,jobSchObj,tschObj))return!1===modalDiv.find("#jobschdform").is(":visible")&&Timetracker.jobSchedule.dataOperations.backToMainPopup(),Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#timesch_fromtime"),msg:ZPI18N.getString("zp.scheduletimesoverlap")}),!1;if(Timetracker.jobSchedule.hasCustomFields()){modalDiv.find(".customFieldError").each(function(){$(this).hide()});var customFieldDetails={},customFields=Timetracker.jobSchedule.getCustomFields(),allowedFileds=Timetracker.jobScheduleForm.fetchAllAllowedFields(Timetracker.jobSchedule.currPopupUser,Timetracker.constants.EDIT,customFields);if(!allowedFileds||0==allowedFileds.length)return;for(var iterator in customFields){var field=customFields[iterator];if(allowedFileds.includes(field.labelName)){var value,errorMessage,fieldObj=modalDiv.find('.customField[folabel="'+field.labelName+'"]');if(19==field.componentType)if(""===(value=fieldObj.find("#"+field.labelName+"_input").val().trim()))field.isMandatory&&(errorMessage=ZPI18N.getString("zp.tsimpmandatoryerror",[field.displayName]));else if(Timetracker.Validations.isDecimal(value)){if(void 0!==field.min&&void 0!==field.max){var isValidMinRange=field.minExclusion?Number(field.min)<Number(value):Number(field.min)<=Number(value),isValidMaxRange=field.maxExclusion?Number(field.max)>Number(value):Number(field.max)>=Number(value);if(!isValidMinRange||!isValidMaxRange)if(errorMessage=ZPI18N.getString("zp.maximumrangeforfield",[field.displayName,field.min,field.max]),field.minExclusion&&field.maxExclusion){var greaterthan=ZPI18N.getString("zp.sgreaterthan",[field.min]),lesserthan=ZPI18N.getString("zp.slesserthan",[field.max]);errorMessage=ZPI18N.getString("zp.valuerangebracket",[field.displayName,greaterthan,lesserthan])}else if(field.minExclusion){greaterthan=ZPI18N.getString("zp.sgreaterthan",[field.min]),lesserthan=ZPI18N.getString("zp.slessthanorequalto",[field.max]);errorMessage=ZPI18N.getString("zp.valuerangebracket",[field.displayName,greaterthan,lesserthan])}else if(field.maxExclusion){greaterthan=ZPI18N.getString("zp.survey.score.greater_equal",[field.min]),lesserthan=ZPI18N.getString("zp.slesserthan",[field.max]);errorMessage=ZPI18N.getString("zp.valuerangebracket",[field.displayName,greaterthan,lesserthan])}}else if(void 0!==field.min){(isValidMinRange=field.minExclusion?Number(field.min)<Number(value):Number(field.min)<=Number(value))||(errorMessage=field.minExclusion?ZPI18N.getString("zp.sgreaterthan",[field.min]):ZPI18N.getString("zp.survey.score.greater_equal",[field.min]),errorMessage=ZPI18N.getString("zp.valuerangecondition",[field.displayName,errorMessage]))}else if(void 0!==field.max){(isValidMaxRange=field.maxExclusion?Number(field.max)>Number(value):Number(field.max)>=Number(value))||(errorMessage=field.maxExclusion?ZPI18N.getString("zp.slesserthan",[field.max]):ZPI18N.getString("zp.slessthanorequalto",[field.max]),errorMessage=ZPI18N.getString("zp.valuerangecondition",[field.displayName,errorMessage]))}}else errorMessage=ZPI18N.getString("zp.entervaliddecimal",[field.displayName]);else 25==field.componentType?"0"===(value=fieldObj.find("#"+field.labelName+"_select").val())&&(field.isMandatory&&(errorMessage=ZPI18N.getString("zp.tsimpmandatoryerror",[field.displayName])),value=""):1==field.componentType&&(""===(value=fieldObj.find("#"+field.labelName+"_input").val())&&field.isMandatory?errorMessage=ZPI18N.getString("zp.tsimpmandatoryerror",[field.displayName]):value.length>255&&(errorMessage=ZPI18N.getString("zp.namecharlimit",[field.displayName,"255"])));if(errorMessage){fieldObj.find("#"+field.labelName+"_error").html(errorMessage),fieldObj.find("#"+field.labelName+"_error").show();let modalScrollableContent=modalDiv.find(".zpl_mcnt");var scrollTop=fieldObj.closest("tr").position().top;return scrollTop<0?(scrollTop=-1*scrollTop%modalScrollableContent.height(),modalScrollableContent.animate({scrollTop:scrollTop},500)):scrollTop>modalScrollableContent.height()&&modalScrollableContent.animate({scrollTop:scrollTop},500),!1}(""!==value||tschObj&&tschObj.customFieldDetails&&void 0!==tschObj.customFieldDetails[field.labelName])&&(customFieldDetails[field.labelName]=value)}}jobSchObj.customFieldDetails=JSON.stringify(customFieldDetails)}return Timetracker.jobSchedule.isJobSchTLExtendEnabled()&&(jobSchObj.extendAllowed=modalDiv.find("#jbschextension").prop("checked")),jobSchObj||{}}Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#timesch_totime"),msg:ZPI18N.getString("zp.entervalidtime")})}else Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#timesch_fromtime"),msg:ZPI18N.getString("zp.entervalidtime")})},addUpdateJobScheduleDetails:function(assigneeid,tschObj,isFromEdit,isPubed,eventType){var modalDiv=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup"),jobSchObj=Timetracker.jobSchedule.dataOperations.validateAddUpdateJobScheduleDetails(assigneeid,tschObj);if(!jobSchObj)return!1;jobSchObj.isPubed=isPubed||!1,jobSchObj.assignedTo=assigneeid;var isRepeat=modalDiv.find("#jbschrepeat").is(":checked")||!1;if(isRepeat){isFromEdit&&(eventType=eventType||"1",jobSchObj.editRepeat="1"===eventType||"2"===eventType,jobSchObj.editRepeat&&(jobSchObj.editRepeatType=eventType)),jobSchObj.isRepeat=isRepeat;var reptype=TimelyZComp.select.getValue(modalDiv.find("#repeatid")),intval="1";ZPI18N.getString("zp.days");"0"===reptype?intval=TimelyZComp.select.getValue(modalDiv.find("#daily_int")):"1"===reptype?(intval=TimelyZComp.select.getValue(modalDiv.find("#weekly_int")),ZPI18N.getString("zp.wftbaweeks")):"2"===reptype&&(intval=TimelyZComp.select.getValue(modalDiv.find("#month_int")),ZPI18N.getString("zp.months"));var repuntil=TimelyZComp.dateField.getValue(modalDiv.find("#popRepDate"));if(!repuntil)return Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#popRepDate"),msg:ZPI18N.getString("zp.validdateerr")}),!1;jobSchObj.repeatInt=intval,jobSchObj.repeatType=reptype;var selDate=Calendar.parseDate(repuntil,uidateFormat),day=Timetracker.util.convertDateTo2digit(selDate.getDate()),month=selDate.getMonth()+1,year=selDate.getFullYear();jobSchObj.repeatUntil=year+"-"+month+"-"+day,tschObj&&tschObj.repeatId&&(jobSchObj.repeatId=tschObj.repeatId)}jobSchObj.mode="addJobSchedule";var callBack=Timetracker.jobSchedule.dataOperations.addJobScheduleResponse;isFromEdit&&(jobSchObj.tschId=tschObj.tschId,callBack=Timetracker.jobSchedule.dataOperations.updateJobScheduleResponse,jobSchObj.mode="updateJobSchedule"),Timetracker.jobSchedule.dataOperations.addUpdateJobSchedule({params:jobSchObj,callBack:callBack,ep:jobSchObj}),Timetracker.jobSchedule.dataOperations.destroyZComp(),ModuleComp.Modal.hide("jobScheduleAddEditPopup")},addJobScheduleResponse:function(res,ep,obj){var jobData=res.job_sch;if(res.errorCode){var showError=!0,ecode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");if("1019"==ecode)emsg=ZPI18N.getString("zp.jbshaddeditoverlap");else if("1020"==ecode||"1021"==ecode)emsg=ZPI18N.getString("zp.jbshnopermadd");else if("1025"===ecode)emsg=ZPI18N.getString("zp.usernotinjob");else if("1035"==ecode)emsg=ZPI18N.getString("zp.jobscheduledatevalid");else if("1038"==ecode)emsg=ZPI18N.getString("zp.jobschedulefromtotimesameerror"),fetchData=!0;else if("1024"==ecode||"1026"==ecode||"1029"==ecode||"1036"==ecode){emsg=ZPI18N.getString("zp.jobschdmaxloghrsexceed"),"1026"==ecode?emsg=ZPI18N.getString("zp.jobschdbudgetexceed"):"1029"==ecode?emsg=ZPI18N.getString("zp.jobschdbudgetmaxloghrsexceed"):"1036"==ecode&&(emsg=ZPI18N.getString("zp.jobschedulerepdatevalidconfirm")),showError=!1;var modal_id="zp_maxhrs_modal_confirmpop";"1026"==ecode?modal_id="zp_budget_modal_confirmpop":"1029"==ecode?modal_id="zp_budget_maxhrs_modal_confirmpop":"1036"==ecode&&(modal_id="zp_jobscheduledate_modal_confirmpop"),ModuleComp.Modal.setup({id:modal_id,type:2,header:"",iconClass:"ico info",removeConfirmButtonClass:"zlabel--blue",confirmButtonClass:"zlabel--yellow",body:emsg,closeOnSubmit:!0,isConfirm:!1,deleteOnHide:!0,buttonValue:ZPI18N.getString("zp.confirm"),successCallback:Timetracker.jobSchedule.dataOperations.scheduleexceptioncallback,hiddenCallback:res.isAdded?Timetracker.jobSchedule.dataOperations.refreshCallback:void 0,extraDetails:{id:modal_id,reqestObj:$.extend(!0,{},obj),callback:Timetracker.jobSchedule.dataOperations.addUpdateJobSchedule}})}showError&&Timetracker.util.showAlert(1,emsg)}else if(Timetracker.jobSchedule.resetCache(),Timetracker.util.showAlert(2,ZPI18N.getString("zp.jobschaddmsg")),ep.isRepeat)Timetracker.FireScroll.resetDataOnLoad(Timetracker.jobSchedule.fireScroll.getMode(obj.pageMode)),1===Timetracker.jobSchedule.calview?Timetracker.jobSchedule.Listing.getJobScheduleForWeekview():0===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.Listing.getJobScheduleForWeekview();else if(Timetracker.jobSchedule.setDataFetched(obj.pageMode,obj.selectedUser),0===Timetracker.jobSchedule.calview||Timetracker.jobSchedule.isUserView()){var empId=jobData.assignedTo,liElem=settingsPage.container.find("#dayrow_"+empId);if(1===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.isUserView()&&(liElem=settingsPage.container.find("#user_week_view_jobsch").find('[date="'+jobData.date+'"]')),liElem.length){var datacol_div_id=liElem.find("#tableRow_"+empId).find("tbody");Timetracker.jobSchedule.Listing.positionScheduleInDayview(datacol_div_id,jobData,empId,!0)}}else 1===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.Listing.constructSingleWeekSchedule(jobData,!0)},addUpdateJobSchedule:function(reqestObj){let pageModeDetails=Timetracker.jobSchedule.getPageModeValue();pageModeDetails.selectedUser&&(reqestObj.selectedUser=pageModeDetails.selectedUser),reqestObj.pageMode=pageModeDetails.pageMode,ZPeople.Request.send(Timetracker.constants.URL,reqestObj.params,reqestObj.callBack,reqestObj,Timetracker.Util.generalFailureCallback)},updateJobScheduleResponse:function(res,params,obj){var ep=obj.ep?obj.ep:{},jobData=res.job_sch;if(res.errorCode){var showError=!0,ecode=res.errorCode,emsg=ZPI18N.getString("zp.jobscherreditmsg");if("1019"==ecode)emsg=ZPI18N.getString("zp.jbshaddeditoverlap");else if("1020"==ecode)emsg=ZPI18N.getString("zp.pastdateschedule");else if("1021"==ecode)emsg=ZPI18N.getString("zp.jbshnopermedit");else if("1025"==ecode)emsg=ZPI18N.getString("zp.userNotInJob");else if("1035"==ecode)emsg=ZPI18N.getString("zp.jobscheduledatevalid");else if("1038"==ecode)emsg=ZPI18N.getString("zp.jobschedulefromtotimesameerror"),fetchData=!0;else if("1039"==ecode)emsg=ZPI18N.getString("zp.jobschwrngbill",[Timetracker.util.getJobDisplayName(!0,!0)]);else if("1040"==ecode)emsg=ZPI18N.getString("zp.jobschwrngwitem",[Timetracker.util.getWorkItemDispName(!1,!0),Timetracker.util.getJobDisplayName(!0,!0)]);else if("1024"==ecode||"1026"==ecode||"1029"==ecode||"1036"==ecode){emsg=ZPI18N.getString("zp.jobschdmaxloghrsexceed"),"1026"==ecode?emsg=ZPI18N.getString("zp.jobschdbudgetexceed"):"1029"==ecode?emsg=ZPI18N.getString("zp.jobschdbudgetmaxloghrsexceed"):"1036"==ecode&&(emsg=ZPI18N.getString("zp.jobschedulerepdatevalidconfirm")),showError=!1;var modal_id="zp_maxhrs_modal_confirmpop";"1026"==ecode?modal_id="zp_budget_modal_confirmpop":"1029"==ecode?modal_id="zp_budget_maxhrs_modal_confirmpop":"1036"==ecode&&(modal_id="zp_jobscheduledate_modal_confirmpop"),ModuleComp.Modal.setup({id:modal_id,type:2,header:"",iconClass:"ico info",removeConfirmButtonClass:"zlabel--blue",confirmButtonClass:"zlabel--yellow",body:emsg,closeOnSubmit:!0,isConfirm:!1,buttonValue:ZPI18N.getString("zp.confirm"),successCallback:Timetracker.jobSchedule.dataOperations.scheduleexceptioncallback,hiddenCallback:res.isUpdated?Timetracker.jobSchedule.dataOperations.refreshCallback:void 0,extraDetails:{id:modal_id,reqestObj:$.extend(!0,{},obj),callback:Timetracker.jobSchedule.dataOperations.addUpdateJobSchedule}})}if(showError&&Timetracker.util.showAlert(1,emsg),ep&&ep.moveDiv&&ep.isMoved)return ep.moveDiv.animate({left:0,top:0},500);if(ep&&ep.moveUI){var ui=ep.moveUI;ui.element?(ui.element.css({left:ui.originalPosition.left}),ui.element.css({width:ui.originalSize.width+16})):ui.helper&&ui.helper.css({left:ui.originalPosition.left})}}else{Timetracker.jobSchedule.resetCache(),ep&&ep.isMoved&&ep.moveDiv&&ep.moveDiv.remove(),Timetracker.util.showAlert(2,ZPI18N.getString("zp.jobscheditmsg"));if(ep&&ep.isMoved&&!0,ep.isRepeat)Timetracker.FireScroll.resetDataOnLoad(Timetracker.jobSchedule.fireScroll.getMode(obj.pageMode)),"1"==Timetracker.jobSchedule.calview?Timetracker.jobSchedule.Listing.getJobScheduleForWeekview():"0"==Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.Listing.getJobScheduleForDayview();else if(Timetracker.jobSchedule.setDataFetched(obj.pageMode,obj.selectedUser),"0"==Timetracker.jobSchedule.calview){var empId=jobData.assignedTo;if((liElem=settingsPage.container.find("#dayrow_"+empId)).length){var datacol_div_id=liElem.find("#tableRow_"+empId).find("tbody");Timetracker.jobSchedule.Listing.positionScheduleInDayview(datacol_div_id,jobData,empId,!1)}}else if(1===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.isUserView()){empId=jobData.assignedTo;var liElem,dateChanged=!1;if(0!=(liElem=settingsPage.container.find("#user_week_view_jobsch").find("#"+jobData.tschId)).length){var oldDate=liElem.data("date");jobData.date!==oldDate&&(liElem.remove(),dateChanged=!0)}if(dateChanged){if((liElem=settingsPage.container.find("#user_week_view_jobsch").find('[date="'+jobData.date+'"]')).length){datacol_div_id=liElem.find("#tableRow_"+empId).find("tbody");Timetracker.jobSchedule.Listing.positionScheduleInDayview(datacol_div_id,jobData,empId,!1)}}else Timetracker.jobSchedule.Listing.positionScheduleInDayview(liElem.closest("tr"),jobData,empId,!1)}else if("1"==Timetracker.jobSchedule.calview){var ismoved=!(!ep||!ep.isMoved);Timetracker.jobSchedule.Listing.constructSingleWeekSchedule(jobData,!1,ismoved)}}},deleteSchedule:function(extraDetails){var tschId=extraDetails.id,delRepeatType=extraDetails.eventType,jobSchObj={};jobSchObj.tschId=tschId,jobSchObj.delRepeat="1"===delRepeatType||"2"===delRepeatType,jobSchObj.delRepeat&&(jobSchObj.delRepeatType=delRepeatType),jobSchObj.mode="deleteJobSchedule",ZPeople.Request.send(Timetracker.constants.URL,jobSchObj,Timetracker.jobSchedule.dataOperations.deleteScheduleResponse,Timetracker.jobSchedule.getPageModeValue(),Timetracker.Util.generalFailureCallback)},deleteScheduleResponse:function(res,ep,otherDetails){if(Timetracker.util.removeLoading(),Timetracker.FireScroll.resetDataOnLoad(Timetracker.jobSchedule.fireScroll.getMode(otherDetails.pageMode)),Timetracker.jobSchedule.resetCache(),res.errorCode){var ecode=res.errorCode,emsg=ZPI18N.getString("zp.jobscherreditmsg");"1021"!=ecode&&"1020"!==ecode||(emsg=ZPI18N.getString("zp.jbshnopermdelete")),Timetracker.util.showAlert(1,emsg)}else{var msg=ep.delRepeat?ZPI18N.getString("zp.jobschdeletemsg"):ZPI18N.getString("zp.deleted.successfully.msg",[ZPI18N.getString("zp.jobschedule")]);Timetracker.util.showAlert(2,msg),ep&&!ep.delRepeat?(settingsPage.container.find("#"+ep.tschId).remove(),Timetracker.jobSchedule.setDataFetched(otherDetails.pageMode,otherDetails.selectedUser)):1===Timetracker.jobSchedule.calview?Timetracker.jobSchedule.Listing.getJobScheduleForWeekview():0===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.Listing.getJobScheduleForDayview()}},publishSchedules:function(){Timetracker.Util.confirmpopUp("id",Timetracker.jobSchedule.dataOperations.publishSchedulesCallback,void 0,1,{body:ZPI18N.getString("zp.pubschdconfirmmsg")})},publishSchedulesCallback:function(){var params={};Timetracker.jobSchedule.pub_cache.count>0&&((params=Timetracker.jobSchedule.Listing.getParamsToFetchJobSchedule()).mode="bulkPublishJobSchedule",ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.jobSchedule.dataOperations.bulkPublishJobScheduleResponse,Timetracker.jobSchedule.getPageModeValue(),Timetracker.Util.generalFailureCallback))},bulkPublishJobScheduleResponse:function(res,ep,otherDetails){if(Timetracker.util.removeLoading(),Timetracker.FireScroll.resetDataOnLoad(Timetracker.jobSchedule.fireScroll.getMode(otherDetails.pageMode)),Timetracker.jobSchedule.resetCache(),"errorpublishing"===res)Timetracker.util.showAlert(1,ZPI18N.getString("zp.ttfailuremsg"));else if(res.errorCode){var errorCode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg");"1021"===errorCode?emsg=ZPI18N.getString("zp.jbshnopermeditpub"):"1020"===errorCode&&(emsg=ZPI18N.getString("zp.pastdateschedule")),Timetracker.util.showAlert(0,emsg)}else Timetracker.util.showAlert(2,ZPI18N.getString("zp.jobschpublishmsg")),Timetracker.jobSchedule.setDataFetched(otherDetails.pageMode,otherDetails.selectedUser),1===Timetracker.jobSchedule.calview?Timetracker.jobSchedule.Listing.getJobScheduleForWeekview():0===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.Listing.getJobScheduleForDayview()},cloneJobSchedules:function(){Timetracker.Util.confirmpopUp("id",Timetracker.jobSchedule.dataOperations.cloneJobSchedulesCallback,void 0,1,{body:ZPI18N.getString("zp.cloneschdconfirmmsg",[ZPI18N.getString(1===Timetracker.jobSchedule.calview?"zp.sweek":"zp.day")])})},cloneJobSchedulesCallback:function(){$("#jobschd_clone").addClass("disabled");var params=Timetracker.jobSchedule.Listing.getParamsToFetchJobSchedule({isFromClone:!0});params.cloneFromDate=params.fromDate,params.cloneToDate=params.toDate,delete params.fromDate,delete params.toDate,params.mode="cloneJobSchedule",ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.jobSchedule.dataOperations.cloneJobScheduleResponse,Timetracker.jobSchedule.getPageModeValue(),Timetracker.Util.generalFailureCallback),Timetracker.util.appendLoading()},cloneJobScheduleResponse:function(res,ep,otherDetails){if(Timetracker.util.removeLoading(),$("#jobschd_clone").removeClass("disabled"),Timetracker.jobSchedule.resetCache(),Timetracker.FireScroll.resetDataOnLoad(Timetracker.jobSchedule.fireScroll.getMode(otherDetails.pageMode)),void 0===res||null===res)Timetracker.util.showAlert(1,ZPI18N.getString("zp.ttfailuremsg"));else if(res.errorCode){var errorCode=res.errorCode,emsg=ZPI18N.getString("zp.ttfailuremsg"),fetchData=!1;"1021"===errorCode?emsg=ZPI18N.getString("zp.jbshnopermclone"):"1022"===errorCode?emsg=ZPI18N.getString("zp.jbschclonedaterange"):"1023"===errorCode?emsg=ZPI18N.getString("zp.jbschclonenoschd"):"1031"==errorCode?(emsg=ZPI18N.getString("zp.jbschclonefewschdskipped"),fetchData=!0):"1032"==errorCode?(emsg=ZPI18N.getString("zp.jbschcloneallschdskipped"),fetchData=!0):"1035"==errorCode?(emsg=ZPI18N.getString("zp.jobschedulestartandendateskip"),fetchData=!0):"1037"==errorCode?(emsg=ZPI18N.getString("zp.jobschedulestartandendateoverlapskip"),fetchData=!0):"1038"==errorCode&&(emsg=ZPI18N.getString("zp.jobschedulestartandendtimeskip"),fetchData=!0),Timetracker.util.showAlert(0,emsg),fetchData&&(1===Timetracker.jobSchedule.calview?Timetracker.jobSchedule.Listing.getJobScheduleForWeekview():0===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.Listing.getJobScheduleForDayview())}else res.success?(Timetracker.util.showAlert(2,ZPI18N.getString("zp.jobschclonemsg")),1===Timetracker.jobSchedule.calview?Timetracker.jobSchedule.Listing.getJobScheduleForWeekview():0===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.Listing.getJobScheduleForDayview()):Timetracker.util.showAlert(1,ZPI18N.getString("zp.ttfailuremsg"))},repDateValidation:function(selDataObj){if(selDataObj){var pageContainer=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup");selDataObj.setHours(0,0,0,0);var popDate=Timetracker.jobSchedule.currPopupDate,popDateObj=new Date(popDate),afterAYearDate=new Date(popDate);if(afterAYearDate.setFullYear(afterAYearDate.getFullYear()+1),selDataObj>afterAYearDate){var repdae=Calendar.formatDate(afterAYearDate);TimelyZComp.dateField.setValue(pageContainer.find("#popRepDate"),repdae)}else if(selDataObj<popDateObj){repdae=Calendar.formatDate(popDateObj);TimelyZComp.dateField.setValue(pageContainer.find("#popRepDate"),repdae)}pageContainer.find("#popRepDate").trigger("change")}},backToMainPopup:function(){var modalDiv=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup"),repuntil=TimelyZComp.dateField.getValue(modalDiv.find("#popRepDate"));if(Timetracker.util.removeErrorMsg(void 0,modalDiv,!0),repuntil&&Calendar.isvalidDate(repuntil)){var repdae=Calendar.parseDate(repuntil,uidateFormat);Timetracker.jobSchedule.dataOperations.repDateValidation(repdae),repuntil=TimelyZComp.dateField.getValue(modalDiv.find("#popRepDate")),modalDiv.find("#jobschdform").hasClass("zpl_DNI")?(modalDiv.find("#jobschdform").removeClass("zpl_DNI"),modalDiv.find("#jobschdrepeatform").addClass("zpl_DNI"),modalDiv.find(".clsArw").addClass("zpl_DNI")):(modalDiv.find("#jobschdform").addClass("zpl_DNI"),modalDiv.find("#jobschdrepeatform").removeClass("zpl_DNI"),modalDiv.find(".clsArw").removeClass("zpl_DNI"));var reptype=TimelyZComp.select.getValue(modalDiv.find("#repeatid")),intval="1",reptxt=ZPI18N.getString("zp.days");"0"===reptype?intval=TimelyZComp.select.getValue(modalDiv.find("#daily_int")):"1"===reptype?(intval=TimelyZComp.select.getValue(modalDiv.find("#weekly_int")),reptxt=ZPI18N.getString("zp.wftbaweeks")):"2"===reptype&&(intval=TimelyZComp.select.getValue(modalDiv.find("#month_int")),reptxt=ZPI18N.getString("zp.months"));var infoArr=[];infoArr.push(intval),infoArr.push(reptxt),infoArr.push(repuntil);var repinfo=ZPI18N.getString("zp.repeatinfo",infoArr);modalDiv.find("#repeatinfo").html(repinfo).removeClass("zpl_DNI"),modalDiv.find("#repeatedit").removeClass("zpl_DNI")}else Timetracker.Util.appenErrorMsgForElem({obj:modalDiv.find("#popRepDate"),msg:ZPI18N.getString("zp.validdateerr")})},showRepeat:function(th){var modalDiv=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup");modalDiv.find("#jbschrepeat").is(":checked")?(modalDiv.find("#jobschdform").addClass("zpl_DNI"),modalDiv.find(".clsArw").removeClass("zpl_DNI"),modalDiv.find("#repeatinfo,#repeatedit,#jobschdrepeatform").removeClass("zpl_DNI")):(modalDiv.find("#jobschdform").removeClass("zpl_DNI"),modalDiv.find("#repeatinfo,#repeatedit,#jobschdrepeatform").addClass("zpl_DNI"),modalDiv.find(".clsArw").addClass("zpl_DNI"))},editRepeat:function(th){var modalDiv=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup");modalDiv.find("#jobschdform").addClass("zpl_DNI"),modalDiv.find("#jobschdrepeatform").removeClass("zpl_DNI"),modalDiv.find(".clsArw").removeClass("zpl_DNI")},repeatIntervalToggle:function(div){var modalDiv=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup"),interval=div&&div.detail?div.detail.selectedValue:modalDiv.find("#repeatid"),daily=modalDiv.find("#repeat_daily_name"),weekly=modalDiv.find("#repeat_week_name"),monthly=modalDiv.find("#repeat_month_name");daily.addClass("zpl_DNI"),weekly.addClass("zpl_DNI"),monthly.addClass("zpl_DNI"),interval&&"0"===interval?daily.removeClass("zpl_DNI"):interval&&"1"===interval?weekly.removeClass("zpl_DNI"):monthly.removeClass("zpl_DNI")},chooseEditSchedule:function(editJson,ev,th){var empno;1===Timetracker.jobSchedule.calview?empno=Timetracker.jobSchedule.isUserView()?$(th).closest("table").attr("erecno"):$(th).closest("tr").attr("id").split("_")[0]:0===Timetracker.jobSchedule.calview&&(empno=$(th).data("empId"));var isEditAllowed=!0;if(Timetracker.isDataAdminForUser(empno)||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit)&&Timetracker.isTTCustomAdminForUser(Timetracker.constants.TTCustomAdmin.EntryEdit,empno))isEditAllowed=!0;else{var currDate=Calendar.getCurrentDate();currDate.setHours(0,0,0,0);var dateid=editJson.date.split(" ")[0],editDate=new Date(dateid);editDate.setHours(0,0,0,0),currDate<=editDate&&(isEditAllowed=!0)}editJson.repeatId&&isEditAllowed?Timetracker.jobSchedule.dataOperations.editJobScheduleConstruct(editJson,ev,th,!0,!isEditAllowed):Timetracker.jobSchedule.dataOperations.editJobScheduleConstruct(editJson,ev,th,!1,!isEditAllowed)},setJobSchUserShiftCache:function(details){if(details){var userShiftDataRes=details[0],params=details[1],user=params.user,date=params.date;if(!userShiftDataRes.hasOwnProperty("errorCode")&&!userShiftDataRes.hasOwnProperty("errorMsg")){let userShiftData=userShiftDataRes[user];Timetracker.jobSchedule.usersShiftData[user]=Timetracker.jobSchedule.usersShiftData[user]||{},Timetracker.jobSchedule.usersShiftData[user][date]=userShiftData[date]}}},isScheduleOverLapping:function(dateid,assigneeid,addEditObj,preveditObj){var edth,isOverlap=!1;if(1===Timetracker.jobSchedule.calview){var day=dateid.split("-")[2];edth=$("#"+assigneeid+"_"+day).find(".js-schedule")}else"0"===Timetracker.jobSchedule.calview&&(edth=$("#has_drag_id_"+assigneeid));if(edth){var schid,childElem=edth.children();preveditObj&&preveditObj.tschId&&(schid=preveditObj.tschId);for(var i=0;i<childElem.length;i++){var dataElem=$(childElem[i]).data();if(dataElem){if(schid&&schid===dataElem.tschId)continue;var newFrm=parseInt(addEditObj.fromtime),newTo=parseInt(addEditObj.totime),oldFrm=parseInt(dataElem.fromTime),oldTo=parseInt(dataElem.toTime);if(newFrm>newTo&&(newTo+=Timetracker.constants.PER_DAY_MIN),oldFrm>oldTo&&(oldTo+=Timetracker.constants.PER_DAY_MIN),isOverlap=Timetracker.jobSchedule.dataOperations.checkTimeOverLaps(newFrm,newTo,oldFrm,oldTo))break}}}return isOverlap},checkTimeOverLaps:function(newFrm,newTo,oldFrm,OldTo){return newTo>oldFrm&&newFrm<OldTo},isAddEditAllowed:function(empid){if(Timetracker.isDataAdminForUser(empid)||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryEdit)&&Timetracker.isTTCustomAdminForUser(Timetracker.constants.TTCustomAdmin.EntryEdit,empid))return!0;if(Timetracker.generalSettings&&Timetracker.generalSettings.settingDetails){var editPerm=Timetracker.generalSettings.getJobSchdEditPerm();if("1"===editPerm&&empid&&empid===erecno)return!1;if("1"===editPerm||"2"===editPerm)return!0}return!1},isAddEditAllowedForDate:function(assignee,date,showAlert){if(!Timetracker.jobSchedule.dataOperations.isAddEditAllowed(assignee))return showAlert&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.jbshnopermadd")),!1;var jobSchDate=Calendar.parseDate(date,Calendar.DB_DATEFORMAT);jobSchDate.setHours(0,0,0,0);var currDate=Calendar.getCurrentDate();if(currDate.setHours(0,0,0,0),currDate<=jobSchDate||Timetracker.isDataAdminForAllUsers()||Timetracker.isDataAdminForUser(assignee)||Timetracker.isTTCustomAdminForUser(Timetracker.constants.TTCustomAdmin.EntryEdit,assignee))return!0;var addEditPastDatePerm=Timetracker.generalSettings.getJobSchdEditPastDatePerm();Timetracker.generalSettings.getJobSchdEditPerm();return"0"!==addEditPastDatePerm&&("1"!==addEditPastDatePerm||assignee!==erecno)||(currDate<=jobSchDate?showAlert&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.jbshnopermadd")):showAlert&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.schedulepastdateadd")),!1)},setScheduleModalPosition:function(modalElm,ev,th){var cls,left,top,widthpop=modalElm.width(),relX=ev.pageX,relY=ev.pageY,wind_ht=$(window).height(),wind_wdth=$(window).width();if(NewCalendar.removeArrowClasses("#jobsch_mdialog"),wind_ht-(relY+444)<0&&wind_wdth-(relX+widthpop)<0)left=relX-(widthpop+9),top=relY-444+29+9,cls="zpl_poparw right bm",(top2=relY-444-44+29+9)>0&&top2<wind_ht||(top=relY-29,cls="zpl_poparw right tp");else if(wind_wdth-(relX+widthpop)<0)left=relX-(widthpop+9),top=relY-29,cls="zpl_poparw right tp";else if(wind_ht-(relY+444)<0){var top2;left=relX-29,top=relY-444-9,cls="zpl_poparw bottom lt",(top2=relY-444-44-9)>0&&top2<wind_ht||(top=relY+9,cls="zpl_poparw top lt")}else left=relX-29,top=relY+9,cls="zpl_poparw top lt";modalElm.css({left:left,top:top}),modalElm.addClass(cls)},validationForButtons:function(editJson,validTime,schDay,repdae){var modalDiv=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup"),opbuttonid=!0===editJson.isPubed||"true"===editJson.isPubed?"#publishSchedule":"#submitSchedule",projectId=editJson.projectId?editJson.projectId:"0",clientId=editJson.clientId?editJson.clientId:"0";let clientDiv=modalDiv.find("#jbsch_clientid");var isAnythingChanged=TimelyZComp.dateField.getValue(modalDiv.find("#schdDate"))!=schDay||validTime.fromt!=TimelyZComp.timeField.getValue(modalDiv.find("#timesch_fromtime"))||validTime.tot!=TimelyZComp.timeField.getValue(modalDiv.find("#timesch_totime"))||TimelyZComp.select.getValue(modalDiv.find("#jbsch_projectid"))!=projectId||0!=TimelyZComp.select.getValue(modalDiv.find("#jbsch_jobid"))&&TimelyZComp.select.getValue(modalDiv.find("#jbsch_jobid"))!=editJson.jobId||ZPeopleComponents.isComponent(clientDiv)&&TimelyZComp.select.getValue(clientDiv)!=clientId||ZPeople.decodeTxt(editJson.desc)!=modalDiv.find("#sch_desc").val()||TimelyZComp.select.getValue(modalDiv.find("#sch_billableStatus"))!=editJson.billableStatus||1==modalDiv.find("#jbschrepeat").is(":checked")&&void 0==editJson.repeatType||(TimelyZComp.select.getValue(modalDiv.find("#repeatid"))!=editJson.repeatType||TimelyZComp.dateField.getValue(modalDiv.find("#popRepDate"))!=repdae||"0"==TimelyZComp.select.getValue(modalDiv.find("#repeatid"))&&TimelyZComp.select.getValue(modalDiv.find("#daily_int"))!=editJson.repeatInt||"1"==TimelyZComp.select.getValue(modalDiv.find("#repeatid"))&&TimelyZComp.select.getValue(modalDiv.find("#weekly_int"))!=editJson.repeatInt||"2"==TimelyZComp.select.getValue(modalDiv.find("#repeatid"))&&TimelyZComp.select.getValue(modalDiv.find("#month_int"))!=editJson.repeatInt)&&void 0!=editJson.repeatType||0!=modalDiv.find("#jbschextension").length&&editJson.extendAllowed!=modalDiv.find("#jbschextension").is(":checked");if(!isAnythingChanged)if(ZPeopleComponents.isComponent(modalDiv.find("#sch_workitem"))){var givenWorkitem=ZPeople.decodeTxt(TimelyZComp.select.getValue(modalDiv.find("#sch_workitem")));givenWorkitem="0"===givenWorkitem?"":givenWorkitem,isAnythingChanged=ZPeople.decodeTxt(editJson.workitem)!==givenWorkitem}else isAnythingChanged=ZPeople.decodeTxt(editJson.workitem)!==modalDiv.find("#sch_workitem").val();if(!isAnythingChanged&&Timetracker.jobSchedule.hasCustomFields()){var customFields=Timetracker.jobSchedule.getCustomFields(),allowedFileds=Timetracker.jobSchedule.Form.fetchAllAllowedFields(Timetracker.jobSchedule.currPopupUser,Timetracker.constants.EDIT,customFields);if(!allowedFileds||0==allowedFileds.length)return;for(var iterator in customFields){var field=customFields[iterator];if(allowedFileds.includes(field.labelName)){var elementDiv=modalDiv.find('.customField[folabel="'+field.labelName+'"]');if(25===field.componentType){if((void 0!==editJson.customFieldDetails&&void 0!==editJson.customFieldDetails[field.labelName]?editJson.customFieldDetails[field.labelName]:"0")!=TimelyZComp.select.getValue(elementDiv.find("select"))){isAnythingChanged=!0;break}}else if(1===field.componentType||19===field.componentType){if((void 0!==editJson.customFieldDetails&&void 0!==editJson.customFieldDetails[field.labelName]?ZPeople.decodeTxt(encodeURIComponent(editJson.customFieldDetails[field.labelName])):"")!=elementDiv.find("input").val()){isAnythingChanged=!0;break}}}}}isAnythingChanged?modalDiv.find(opbuttonid).prop("disabled",!1):modalDiv.find(opbuttonid).prop("disabled",!0)},scheduleexceptioncallback:function(modal){var extraDtls=modal.data("extraDetails"),callback=extraDtls&&extraDtls.callback?extraDtls.callback:null,reqestObj=extraDtls&&extraDtls.reqestObj?extraDtls.reqestObj:null,id=modal.attr("id");null!==reqestObj&&null!==callback&&ZPUtil.Validation.isFunction(callback)&&(reqestObj.params.skipMaxLogHrsValidation=!0,"zp_budget_modal_confirmpop"===id?reqestObj.params.skipBudgetExceedValidation=!0:"zp_maxhrs_modal_confirmpop"===id?reqestObj.params.skipMaxLogHrsValidation=!0:"zp_budget_maxhrs_modal_confirmpop"===id?(reqestObj.params.skipBudgetExceedValidation=!0,reqestObj.params.skipMaxLogHrsValidation=!0):"zp_jobscheduledate_modal_confirmpop"===id&&(reqestObj.params.skipJobSchJobRepeatDateValidation=!0,reqestObj.params.skipMaxLogHrsValidation=!1),ModuleComp.Modal.hide(id),Timetracker.util.appendLoading(),callback(reqestObj),Timetracker.util.removeLoading())},refreshCallback:function(){Timetracker.FireScroll.resetDataOnLoad(Timetracker.jobSchedule.fireScroll.getMode()),"1"===Timetracker.jobSchedule.calview?Timetracker.jobSchedule.Listing.getJobScheduleForWeekview():"0"===Timetracker.jobSchedule.calview&&Timetracker.jobSchedule.Listing.getJobScheduleForDayview()},chooseRepeatType:function(extraDetails){var header="",body='<div class="zpl_crd"><div class="zpl_crdcnt">',action=extraDetails.action;"edit"===action?(header=ZPI18N.getString("zp.editschdorseries"),body+='<div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.applychangesto",[""])+'</h5></div><div class="zpl_secn">'):"publish"===action?(header=ZPI18N.getString("zp.pubschdorseries"),body+='<div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.applychangesto",[""])+'</h5></div><div class="zpl_secn">'):"delete"===action&&(header=ZPI18N.getString("zp.delschdorseries"),body+='<div></div><div class="zpl_secn">'),body+=Timetracker.jobSchedule.dataOperations.getEditSeriesOptions(),body+="</div></div></div></div>",ModuleComp.Modal.setup({id:"zp_ttschd_edit_confirmpop",type:3,header:header,body:body,closeOnSubmit:!0,isConfirm:!1,buttonValue:ZPI18N.getString("zp.confirm"),successCallback:Timetracker.jobSchedule.dataOperations.chooseRepeatTypeCallback,extraDetails:extraDetails||{}})},scheduleDateOnSelectCallback:function(selDataObj){var schDateDOM=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup").find("#schdDate");selDataObj?Timetracker.jobSchedule.currPopupDate=Timetracker.DateTime.getDateinDBformat(selDataObj,!0):TimelyZComp.dateField.setValue(schDateDOM,Timetracker.jobSchedule.currPopupDate)},getEditSeriesOptions:function(){var txt='<div><div class="zradiobutton"><input type="radio" id="tt_edit_schd_0" checked value="0" name="tt_edit_schd" class="zradiobutton__helper"><label for="tt_edit_schd_0" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.editonlythisschd")+'</span></label></div><div class="zradiobutton"><input type="radio" id="tt_edit_schd_1" value="1" name="tt_edit_schd" class="zradiobutton__helper"><label for="tt_edit_schd_1" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.editthisschdandnext")+"</span></label></div>";return Timetracker.isDataAdmin()&&(txt+='<div class="zradiobutton"><input type="radio" id="tt_edit_schd_2" value="2" name="tt_edit_schd" class="zradiobutton__helper"><label for="tt_edit_schd_2" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.editentireseries")+"</span></label></div>"),txt+="</div>"},chooseRepeatTypeCallback:function(modal){var extraDetails=modal.data("extraDetails"),action=extraDetails.action,eventType=modal.find("input[name=tt_edit_schd]:checked").val();if("edit"===action||"publish"===action){extraDetails.dateid;var assigneeid=extraDetails.empno,tschObj=extraDetails.tschObj,isPubed=extraDetails.isPubed;Timetracker.jobSchedule.dataOperations.addUpdateJobScheduleDetails(assigneeid,tschObj,!0,isPubed,eventType)}else if("delete"===action){var info=ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.sjobschedule")]);1==eventType?info=ZPI18N.getString("zp.jobschrepetdelinfo"):2==eventType&&(info=ZPI18N.getString("zp.jobschfulldelinfo"));var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.sjobschedule")]),body:info};Timetracker.Util.confirmpopUp(extraDetails.id,Timetracker.jobSchedule.dataOperations.deleteSchedule,{id:extraDetails.id,eventType:eventType},0,extraDtls)}},jsExportcallback:function(){Timetracker.ImportExport.showExportOptions(Timetracker.jobSchedule.dataOperations.downloadJobSchedule,"jsExport",!0,Timetracker.constants.TTCustomAdmin.EntryView,!0)},downloadJobSchedule:function(container,params,downloadType){(params=Timetracker.jobSchedule.Listing.getParamsToFetchJobSchedule()).reportType="3",downloadType||(downloadType=Timetracker.constants.DOWNLOAD_TYPES.PDF);var requestUrl="timesheetDispAction.zp?";(params=Timetracker.jobSchedule.Listing.getParamsToFetchJobSchedule()).reportType="3",params.repType="myReports",params.mode="exportJobScheduleReport",downloadType||(downloadType=Timetracker.constants.DOWNLOAD_TYPES.PDF),"ts_team"==Timetracker.Page.getPageMode()&&(params.pageMode=1);var isPdf="pdf"==downloadType;if(delete params.conreqcsr,params.userErecNo=params.users,delete params.users,params.departmentId=params.deptId,delete params.deptId,params.recordsExportType=isPdf?0:container.find("#recordsExportType").is(":checked")?1:0,params.fileType=downloadType,"pdf"!==downloadType){var exportContainer=Layout.Page.container.find("#tabZP5Export");exportContainer.length>0&&Timetracker.Filters.getParamsForEmpAddnFields(params,exportContainer)}params.hasOwnProperty("customFieldDetails")&&(params.customFieldDetails=encodeURIComponent(params.customFieldDetails)),$.each(params,function(key,value){requestUrl+=key+"="+value+"&"}),requestUrl=requestUrl.substring(0,requestUrl.length-1),Timetracker.ImportExport.submiteFormForExport(requestUrl)},destroyZComp:function(){var modal=Timetracker.Util.getMainContainer().find("#jobScheduleAddEditPopup");0!=modal.length&&(modal.find("select").each(function(){ZPeopleComponents.isComponent(this)&&TimelyZComp.select.destroy(this)}),ZPeopleComponents.isComponent(modal.find("#jbsch_clientid"))&&TimelyZComp.select.destroy(modal.find("#jbsch_clientid")),TimelyZComp.select.destroy(modal.find("#jbsch_projectid")),TimelyZComp.select.destroy(modal.find("#jbsch_jobid")),TimelyZComp.select.destroy(modal.find("#sch_workitem")))},print:function(){var newWindow=window.open();newWindow.focus();var newContent='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html>',copyhead=$("head").clone();copyhead.find("script").each(function(){$(this).remove()});var wholeCont=settingsPage.container.clone(),date=$(wholeCont).find("#dateNavigatorText").text();$(wholeCont).find("[id]").each(function(){$(this).removeAttr("id")}),$(wholeCont).find(".zpl_crdwthful").addClass("fxdtbl_inhrt"),$(wholeCont).find(".zpl_btnmnu").html("<div class='j-cnt-cntr'><div class='PI_monthly'></div><b>"+date+"</b></div>"),$(wholeCont).find("#topSettMenu").remove(),$(wholeCont).find("thead").find("th").attr("style","background:#e5e5f0!important"),$(wholeCont).find("._dayvw table tbody tr td:last-child").attr("style","position:relative");var logoCont=$(".ZPHeadLft").clone();$(logoCont).find("i").remove(),newContent+=copyhead.html(),newContent+='<body onload="self.print()" style="overflow:scroll;zoom:80%;">',newContent+=wholeCont[0].outerHTML,newWindow.document.write(newContent),newWindow.document.close()}},Timetracker.jobSchedule.Import={construct:function(){Timetracker.Import.dtls={},Timetracker.Import.fileType=["xls","xlsx","csv"],Timetracker.Import.acceptFiles=".xls,xlsx,.csv",Timetracker.Import.dtls.noteArr=[ZPI18N.getString("zp.firstrowmsg"),ZPI18N.getString("zp.unexpectederrormsg"),ZPI18N.getString("zp.dateimportnote"),ZPI18N.getString("zp.jbschimportcountexceederror",["1000"]),ZPI18N.getString("zp.publishdraftschedule"),ZPI18N.getString("zp.isrepeattrue"),ZPI18N.getString("zp.repeatintervalrange"),ZPI18N.getString("zp.repeatfrequencyvalues"),ZPI18N.getString("zp.scheduledescriptioncounterror",["500"]),ZPI18N.getString("zp.repeatdateduration",["2"])],Timetracker.Import.dtls.fileSlider=Timetracker.jobSchedule.Import.getImportSlider,Timetracker.Import.dtls.fileUploading=Timetracker.jobSchedule.Import.fileUploading,Timetracker.Import.dtls.getMappingSliderHtml=Timetracker.jobSchedule.Import.getMappingSliderHtml,Timetracker.Import.dtls.getVerifySliderHtml=Timetracker.jobSchedule.Import.getVerifySliderHtml,Timetracker.Import.dtls.validateFields=Timetracker.jobSchedule.Import.validateFields,Timetracker.Import.dtls.getImportSummaryHtml=Timetracker.jobSchedule.Import.getImportSummaryHtml,Timetracker.Import.dtls.inputFileVerify=Timetracker.jobSchedule.Import.inputFileVerify,Timetracker.Import.dtls.autoMappingFields=Timetracker.jobSchedule.Import.autoMappingFields,Timetracker.Import.dtls.viewRecords=Timetracker.jobSchedule.constructJobSchedule,Timetracker.Import.dtls.importTemplate=Timetracker.jobSchedule.Import.importTemplate,Timetracker.Import.construct()},getImportSlider:function(dtls){var content='<div class="zpl_crd" id="importCont"><div id="importFileDiv1" class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_imprtrecord zpl_DNI"><div id="partialrecordcountdiv"></div><button type="button" class="zlabel zlabel--blue zlabel--medium" id="partialRecordsMapping">'+ZPI18N.getString("zp.clickhere")+'</button></div></div><div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp"><div class="zpl_mdimprtimg"></div><h4 elem="fileNameInfo">'+ZPI18N.getString("zp.fileimported")+'</h4><p elem="fileExtensionInfo">'+ZPI18N.getString("zp.formfomtsupportxlscsv")+'</p><div><input style="display:none" type="file" accept=".xls,.xlsx,.csv" elem="ttConfigImportFile"><button elem="ttConfigImportButton" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.importfile")+'</button></div><p elem="fileSizeInfo">'+ZPI18N.getString("zp.maxfilesize")+'</p><p elem="templateInfo"><a onclick="Timetracker.Import.dtls.importTemplate()"><b>'+ZPI18N.getString("zp.shiftmapping.sampleFileImport")+'</b></a></p></div></div></div></div><div class="zpl_secn" elem="notes_section"><div><div class="zpl_info"><h6><b>'+ZPI18N.getString("zp.note")+":</b></h6>";return dtls.noteArr&&dtls.noteArr.forEach((x,i)=>{content+="<p>"+(i+1)+") "+x+"</p>"}),content+="</div></div></div></div>",content+='</div><div class="zpl_DNI" id="loadingImportDiv"></div>'},fileUploading:function(fileObj){var cont=Timetracker.Import.importfileUpContiner;cont.find("#importFileDiv1").addClass("zpl_DNI"),cont.find("#loadingImportDiv").show(),cont.find("#loadingImportDiv").html(ZPeople.LOADING_HTML);var formData=new FormData;fileObj&&formData.append("importFile",fileObj),formData.append("module","importTTJobSchedule"),formData.append("conreqcsr",csrfToken),$.ajax({url:"/timeSheetImport.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){1===response.res?(Timetracker.Import.fileData=response,Timetracker.Import.constructImportDiv(),Timetracker.jobSchedule.Import.importConstructionExtra()):(void 0!=response.errorCode?Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(response.errorCode)):void 0!=response.errMsg?Timetracker.Util.displayFailureMessage(response.errMsg):Timetracker.Util.displayFailureMessage(ZPI18N.getString("zp.ttfailuremsg")),Timetracker.Import.importfileUpObj.close())}})},getCustomFieldHtmlForImport:function(isVerifierSlide){var html="";if(Timetracker.jobSchedule.isJobSchTLExtendEnabled()){var id="imp_Extension"+(isVerifierSlide?"":"_map");html+='<div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+ZPI18N.getString("zp.jobschextend")+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="'+id+'" style="display: none;"></select></div></div></div>'}if(Timetracker.jobSchedule.hasCustomFields()){var customFields=Timetracker.jobSchedule.getCustomFields();for(var iterator in customFields){var field=customFields[iterator];id="imp_"+field.labelName+(isVerifierSlide?"":"_map");html+='<div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+field.displayName+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="'+id+'" style="display: none;"></select></div></div></div>'}}return html},getMappingSliderHtml:function(){return'<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li elem="mapUnMapDiv" value="allFields" class="zpl_act">'+ZPI18N.getString("zp.all")+'</li><li elem="mapUnMapDiv" value="mappedFields">'+ZPI18N.getString("zp.mapping")+' <div id="mappedNo"><b></b></div></li><li elem="mapUnMapDiv" value="unMappedFields">'+ZPI18N.getString("zp.unmapped")+'<div id="unMappedNo"><b></b></div></li></ul></div><div class="zpl_rgt"><button class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields(true);">'+ZPI18N.getString("zp.resetfields")+'</button><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields();">'+ZPI18N.getString("zp.automapfields")+'</button></div></div><div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd" elem="collapseMainDiv"><div class="zpl_crdcnt zpl_colpanls"  data-title-position="bottom"  aria-multiselectable="true"><div id="ttimport_empmapping_collapseDiv" elem="collapsibleSectionPanel"><div><div <h4="">'+ZPI18N.getString("zp.mapdetails")+'</div> </div><div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.mappingfield")+'</font><b class="zbadges DNI"></b></label><select class="select-js defaultValues" id="imp_mapfield_map" style="display: none;"><option value="-1">'+ZPI18N.getString("zp.select")+'</option><option value="1">'+ZPI18N.getString("zp.mailId")+'</option><option value="2">'+ZPI18N.getString("zp.empid")+'</option></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.mappingvalue")+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_mapvalue_map" class="select-js" style="display: none;"></select></div></div></div></div></div></div></div></div><div class="zpl_crd" elem="collapseMainDiv"><div class="zpl_crdcnt zpl_colpanls" data-title-position="bottom" aria-multiselectable="true"><div id="ttimport_mapping_collapseDiv" elem="collapsibleSectionPanel"><div><div <h4="">'+ZPI18N.getString("zp.jobschedule")+'</div> </div><div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.scheduledate")+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_date_map" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.fromtime")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_fromtime_map" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_job_map" class="select-js" style="display: none;"></select></div></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.totime")+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_totime_map" class="select-js" style="display: none;"></select></div></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_jobslist_map" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"><label><font>'+ZPI18N.getString("zp.jbshisrepititive")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_isrepititive_map" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label>'+ZPI18N.getString("zp.jbshispublished")+'<b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_Status_map" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"  mappingPrDiv="imp_isrepititive_map" class="zpl_DNI"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.repatFrequency")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_repfrequency_map" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+ZPI18N.getString("zp.scheduledescription")+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_Description_map" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"  mappingPrDiv="imp_isrepititive_map" class="zpl_DNI"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.jbshrepeatinterval")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_repinterval_map" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+ZPI18N.getString("zp.billablestatus")+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_BillableStatus_map" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"  mappingPrDiv="imp_isrepititive_map" class="zpl_DNI"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.jbshrepeatuntilldate")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_repuntilldate_map" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+ZPI18N.getString("zp.workitem")+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_Workitem_map" style="display: none;"></select></div></div></div>'+Timetracker.jobSchedule.Import.getCustomFieldHtmlForImport()+'</div></div></div></div><div id="zp_empty_data"/></div></div>'},getVerifySliderHtml:function(){return'<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd"><div class="zpl_crdcnt zpl_colpanls" data-title-position="bottom" aria-multiselectable="true"><div id="ttimport_empmapping_collapseDiv" elem=collapsibleSectionPanel><div><div <h4="">'+ZPI18N.getString("zp.mapdetails")+'</div> </div><div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry" elem="rowContainer"><font>'+ZPI18N.getString("zp.mappingfield")+'</font><b class="zbadges DNI"></b></label><select class="select-js defaultValues" id="imp_mapfield" style="display: none;"><option value="-1">'+ZPI18N.getString("zp.select")+'</option><option value="1">'+ZPI18N.getString("zp.mailId")+'</option><option value="2">'+ZPI18N.getString("zp.empid")+'</option></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry" elem="rowContainer"><font>'+ZPI18N.getString("zp.mappingvalue")+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_mapvalue" class="select-js" style="display: none;"></select></div></div></div></div></div></div></div></div><div class="zpl_crd"><div class="zpl_crdcnt zpl_colpanls" data-title-position="bottom" aria-multiselectable="true"><div id="ttimport_mapping_collapseDiv" elem=collapsibleSectionPanel><div><div <h4="">'+ZPI18N.getString("zp.jobschedule")+'</div> </div><div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.scheduledate")+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_date" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.fromtime")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_fromtime" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_job" class="select-js" style="display: none;"></select></div></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.totime")+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_totime" class="select-js" style="display: none;"></select></div></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_jobslist" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv"><label><font>'+ZPI18N.getString("zp.jbshisrepititive")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_isrepititive" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label>'+ZPI18N.getString("zp.jbshispublished")+'<b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_Status" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv" mappingPrDiv="imp_isrepititive_map" class="zpl_DNI"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.repatFrequency")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_repfrequency" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+ZPI18N.getString("zp.scheduledescription")+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_Description" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv" mappingPrDiv="imp_isrepititive_map" class="zpl_DNI"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.jbshrepeatinterval")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_repinterval" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+ZPI18N.getString("zp.billablestatus")+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_BillableStatus" style="display: none;"></select></div></div><div><div elem="mappingFieldDiv" mappingPrDiv="imp_isrepititive_map" class="zpl_DNI"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.jbshrepeatuntilldate")+'</font><b class="zbadges columnIndex DNI"></b></label><select id="imp_repuntilldate" class="select-js" style="display: none;"></select></div></div></div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label><font>'+ZPI18N.getString("zp.workitem")+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_Workitem" style="display: none;"></select></div></div></div>'+Timetracker.jobSchedule.Import.getCustomFieldHtmlForImport(!0)+"</div></div></div></div></div>"},getImportSummaryHtml:function(resultData){var html='<div class="zpl_imprtrecordvw"><div class="zpl_secn"><div><div class="zpl_imprtrecord"><div><i class="PI_tick2_fil grn"></i>'+ZPI18N.getString("zp.importSuccess",[""])+'</div><button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="Timetracker.Import.viewRecords()">'+ZPI18N.getString("zp.viewRecords")+'</button></div></div></div></div><div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li style="cursor: default;">'+ZPI18N.getString("zp.noOfTot")+"<b>"+(resultData.totalcount?resultData.totalcount:"0")+'</b></li><li style="cursor: default;">'+ZPI18N.getString("zp.noOfAdd")+"<b>"+(resultData.errorcount?resultData.totalcount-resultData.errorcount:resultData.totalcount)+'</b></li><li style="cursor: default;">'+ZPI18N.getString("zp.noOfSkip")+"<b>"+(resultData.errorcount?resultData.errorcount:"0")+'</b></li><li style="cursor: default;">'+ZPI18N.getString("zp.noOfErr")+"<b>"+(resultData.errorcount?resultData.errorcount:"0")+"</b></li></ul></div></div>";if(resultData.errorcount){var keys=new Array;for(var k in resultData.errors)keys.push(k);keys.sort();var len=keys.length;html+=' <div class="zpl_rgtcnt"><div class="zpl_tblres"> <table class="zpl_tbl">  <thead><tr><th>Key</th><th>'+ZPI18N.getString("zp.error")+"</th></tr></thead><tbody>";for(var tempI=0;tempI<len;tempI++){var key=keys[tempI],split=resultData.errors[key].split(":");html+="<tr><td><span>"+split[0]+"</td><td>"+split[1]+"</span></td></tr>"}html+="</tbody></table></div></div>"}return html},inputFileVerify:function(){var container=Timetracker.Import.importContainer.find("#ttimport_verify_card"),map_Date=TimelyZComp.select.getValue(container.find("#imp_date")),map_job=TimelyZComp.select.getValue(container.find("#imp_job")),map_Jobslist=TimelyZComp.select.getValue(container.find("#imp_jobslist")),status=TimelyZComp.select.getValue(container.find("#imp_Status")),map_Description=TimelyZComp.select.getValue(container.find("#imp_Description"));""!==map_Description&&"-1"!==map_Description||(map_Description=-1);var map_BillableStatus=TimelyZComp.select.getValue(container.find("#imp_BillableStatus"));""!==map_BillableStatus&&"-1"!==map_BillableStatus||(map_BillableStatus=-1);var map_Workitem=TimelyZComp.select.getValue(container.find("#imp_Workitem"));""!==map_Workitem&&"-1"!==map_Workitem||(map_Workitem=-1);var map_Ftime=TimelyZComp.select.getValue(container.find("#imp_fromtime")),map_Ttime=TimelyZComp.select.getValue(container.find("#imp_totime")),mapfield=TimelyZComp.select.getValue(container.find("#imp_mapfield")),mapvalue=TimelyZComp.select.getValue(container.find("#imp_mapvalue")),showFldError=!1,map_repetitive=TimelyZComp.select.getValue(container.find("#imp_isrepititive"));if("-1"!==map_repetitive&&""!==map_repetitive){var map_frequency=TimelyZComp.select.getValue(container.find("#imp_repfrequency")),map_interval=TimelyZComp.select.getValue(container.find("#imp_repinterval")),map_untilldate=TimelyZComp.select.getValue(container.find("#imp_repuntilldate"));"-1"!==map_frequency&&"-1"!==map_interval&&"-1"!==map_untilldate&&""!==map_frequency&&""!==map_interval&&""!==map_untilldate||(showFldError=!0)}else map_repetitive=map_frequency=map_interval=map_untilldate="-1";if("-1"!=map_Jobslist&&""!=map_Jobslist||(map_Jobslist=-1),"-1"!=status&&""!=status||(status=-1),"-1"!==map_Date&&"-1"!==map_job&&"-1"!==map_Ftime&&"-1"!==map_Ttime&&""!==map_Date&&""!==map_job&&""!==map_Ftime&&""!==map_Ttime||(showFldError=!0),"-1"!==mapfield&&"-1"!=mapvalue&&""!==mapfield&&""!==mapvalue||(showFldError=!0),showFldError)Timetracker.Import.importObj.showTab(2);else{Timetracker.Import.importContainer.find("#ttimport_summary_card").html(ZPeople.LOADING_HTML);var params={mode:"importTTJobSchedule",jobname:map_job,projectname:map_Jobslist,date:map_Date,ftime:map_Ftime,ttime:map_Ttime,status:status,description:map_Description,billableStatus:map_BillableStatus,workitem:map_Workitem,isRepetitive:map_repetitive,frequency:map_frequency,interval:map_interval,repeatDate:map_untilldate,mapfield:mapfield,mapvalue:mapvalue,fileFormat:Timetracker.Import.fileFormat,conreqcsr:csrfToken};if(Timetracker.jobSchedule.hasCustomFields()){var customFieldDetails={},customFields=Timetracker.jobSchedule.getCustomFields();for(var iterator in customFields){var customField=customFields[iterator],customMappingValue=TimelyZComp.select.getValue(container.find("#imp_"+customField.labelName));customFieldDetails[customField.labelName]=""!==customMappingValue&&"-1"!==customMappingValue?customMappingValue:-1}params.customFieldDetails=JSON.stringify(customFieldDetails)}if(Timetracker.jobSchedule.isJobSchTLExtendEnabled()){var map_Extension=TimelyZComp.select.getValue(container.find("#imp_Extension"));params.extendAllowed=""===map_Extension||"-1"===map_Extension?-1:map_Extension}ZPeople.Request.send("/timeSheetImport.zp",params,function(response){Timetracker.Import.importSummary(response)},{},Timetracker.Util.generalFailureCallback)}},autoMappingFields:function(cont){if(TimelyZComp.select.setValue(cont.find("#imp_date_map"),Timetracker.Import.headerHash["schedule date"]),TimelyZComp.select.setValue(cont.find("#imp_job_map"),Timetracker.Import.headerHash["job name"]),TimelyZComp.select.setValue(cont.find("#imp_jobslist_map"),Timetracker.Import.headerHash["project name"]),TimelyZComp.select.setValue(cont.find("#imp_fromtime_map"),Timetracker.Import.headerHash["from time"]),TimelyZComp.select.setValue(cont.find("#imp_totime_map"),Timetracker.Import.headerHash["to time"]),TimelyZComp.select.setValue(cont.find("#imp_Status_map"),Timetracker.Import.headerHash["schedule published"]),TimelyZComp.select.setValue(cont.find("#imp_Description_map"),Timetracker.Import.headerHash["schedule description"]),TimelyZComp.select.setValue(cont.find("#imp_isrepititive_map"),Timetracker.Import.headerHash["repeated schedule"]),""!=TimelyZComp.select.getValue(cont.find("#imp_isrepititive_map"))&&"-1"!=TimelyZComp.select.getValue(cont.find("#imp_isrepititive_map"))&&(cont.find("#imp_repfrequency_map,#imp_repinterval_map,#imp_repuntilldate_map").closest("div").removeClass("zpl_DNI"),TimelyZComp.select.setValue(cont.find("#imp_repfrequency_map"),Timetracker.Import.headerHash["repeat frequency"]),TimelyZComp.select.setValue(cont.find("#imp_repinterval_map"),Timetracker.Import.headerHash["repeat interval"]),TimelyZComp.select.setValue(cont.find("#imp_repuntilldate_map"),Timetracker.Import.headerHash["repeat until date"])),Timetracker.jobSchedule.hasCustomFields()){var customFields=Timetracker.jobSchedule.getCustomFields();for(var iterator in customFields){var field=customFields[iterator];cont.find("#imp_"+field.labelName+"_map").length>0&&TimelyZComp.select.setValue(cont.find("#imp_"+field.labelName+"_map"),Timetracker.Import.headerHash[field.displayName.toLowerCase()])}}Timetracker.jobSchedule.isJobSchTLExtendEnabled()&&TimelyZComp.select.setValue(cont.find("#imp_Extension_map"),Timetracker.Import.headerHash[ZPI18N.getString("zp.jobschextend").toLowerCase()])},importTemplate:function(){var formObj=$("<form id='jobSchedule_imp_form' action='timeSheetImport.zp?mode=timesheetImportTemplate' method='post' target='exportresp1' style='display:none'/>").html("");formObj.append('<input type="hidden" value="'+csrfToken+'" name="conreqcsr"/>'),formObj.append('<input type="hidden" value="importTTJobSchedule" name="module"/>'),$("body").append(formObj),formObj.trigger("submit")},importConstructionExtra:function(){var cont=Timetracker.Import.importContainer.find("#ttimport_mapping_card");cont.find("#imp_isrepititive_map").on("zselectchange",function(e){"-1"==$(this)[0].value?(TimelyZComp.select.setValue(cont.find("#imp_repfrequency_map"),-1),TimelyZComp.select.setValue(cont.find("#imp_repinterval_map"),-1),TimelyZComp.select.setValue(cont.find("#imp_repuntilldate_map"),-1),cont.find("#imp_repfrequency_map,#imp_repinterval_map,#imp_repuntilldate_map").closest("div").addClass("zpl_DNI")):(cont.find("#imp_repfrequency_map,#imp_repinterval_map,#imp_repuntilldate_map").closest("div").removeClass("zpl_DNI"),TimelyZComp.select.setValue(cont.find("#imp_repfrequency_map"),Timetracker.Import.headerHash["repeat frequency"]),TimelyZComp.select.setValue(cont.find("#imp_repinterval_map"),Timetracker.Import.headerHash["repeat interval"]),TimelyZComp.select.setValue(cont.find("#imp_repuntilldate_map"),Timetracker.Import.headerHash["repeat until date"])),Timetracker.Import.setMappedUnMappedColumns(cont);var shwDiv=cont.find("[elem=mapUnMapDiv].zpl_act");"allFields"!=shwDiv.attr("value")&&(shwDiv.removeClass("zpl_act"),shwDiv.trigger("click"))})},validateFields:function(){var verifyDiv=Timetracker.Import.importContainer.find("#ttimport_verify_card"),mappingDiv=Timetracker.Import.importContainer.find("#ttimport_mapping_card"),isrepititive=TimelyZComp.select.getValue(mappingDiv.find("#imp_isrepititive_map"));if("-1"!==isrepititive&&""!==isrepititive){var repfrequency=TimelyZComp.select.getValue(mappingDiv.find("#imp_repfrequency_map")),repinterval=TimelyZComp.select.getValue(mappingDiv.find("#imp_repinterval_map")),repuntilldate=TimelyZComp.select.getValue(mappingDiv.find("#imp_repuntilldate_map"));"-1"!==repfrequency&&""!==repfrequency||TimelyZComp.select.setAttributes(verifyDiv.find("#imp_repfrequency"),{className:"ztextbox__error"}),"-1"!==repinterval&&""!==repinterval||TimelyZComp.select.setAttributes(verifyDiv.find("#imp_repinterval"),{className:"ztextbox__error"}),"-1"!==repuntilldate&&""!==repuntilldate||TimelyZComp.select.setAttributes(verifyDiv.find("#imp_repuntilldate"),{className:"ztextbox__error"}),verifyDiv.find("#imp_repfrequency,#imp_repinterval,#imp_repuntilldate").closest("div").removeClass("zpl_DNI")}else verifyDiv.find("#imp_repfrequency,#imp_repinterval,#imp_repuntilldate").closest("div").addClass("zpl_DNI");verifyDiv.find("#imp_isrepititive").on("zselectchange",function(){"-1"==$(this)[0].value?verifyDiv.find("#imp_repfrequency,#imp_repinterval,#imp_repuntilldate").closest("div").addClass("zpl_DNI"):(TimelyZComp.select.setValue(verifyDiv.find("#imp_repfrequency"),-1),TimelyZComp.select.setValue(verifyDiv.find("#imp_repinterval"),-1),TimelyZComp.select.setValue(verifyDiv.find("#imp_repuntilldate"),-1),verifyDiv.find("#imp_repfrequency,#imp_repinterval,#imp_repuntilldate").closest("div").removeClass("zpl_DNI"))})}},Timetracker.jobSchedule.fireScroll={loadMoreJobShedules:function(result,params,otherDetails){Timetracker.FireScroll.setFetchCount(Timetracker.jobSchedule.fireScroll.getMode(otherDetails.pageMode),result.usersList);let viewType=Timetracker.jobSchedule.calview;1===viewType?Timetracker.jobSchedule.Listing.constJobScheduleForWeekview(result,params,otherDetails):0===viewType&&Timetracker.jobSchedule.Listing.constJobScheduleForDayview(result,params,otherDetails)},fireScrollAvbl:function(pageMode){return["ts_operations","ts_team"].includes(pageMode)},getMode:function(pageMode){return"jobSch_"+(pageMode=pageMode||Timetracker.Page.getPageMode())}},TimetrackerOperations.locationjobSchedule={isRefresh:!0,isLocationJobScheduleAllowed:function(){return Timetracker.jobSchedule.isJobScheduleEnabled()&&Timetracker.generalSettings.isJobProLocApplicableEnabled()},init:function(){TimetrackerOperations.init(),Timetracker.permissionCheckForOperPages()&&(TimetrackerOperations.locationjobSchedule.isLocationJobScheduleAllowed()?TimetrackerOperations.locationjobSchedule.getLocJobSchdeulePage():(container.html("<div class='zpl_rgtcnt'></div>"),Timetracker.Util.showHideNoData({div:container,msg:ZPI18N.getString("zp.notallowedforpage"),cls:"zp_nd_permission"})))},getLocJobSchdeulePage:function(){0==settingsPage.container.find("#locjobschd_body").length&&(TimetrackerOperations.locationjobSchedule.constructViewPage(),TimetrackerOperations.locationjobSchedule.loadSchedules(),TimelyZComp.toolTip.intiliaze())},constructViewPage:function(){var html='<div class="zpl_btnmnu"><div class="zpl_rgt"><button class="zlabel zlabel--blue zlabel--medium" id="locjobschd_add" onclick="TimetrackerOperations.locationjobSchedule.addJobSchedule()">'+ZPI18N.getString("zp.addschedule")+'</button></div></div><div class="zpl_rgtcnt"><div id="locjobschd_body"></div></div>';settingsPage.container.append(html),settingsPage.container.addClass("zpl_crdwthful")},loadSchedules:function(){TimetrackerOperations.locationjobSchedule.isRefresh&&(Timetracker.util.appendLoading(),ZPeople.Request.send(Timetracker.constants.URL,{mode:"getLocationJobSchedules",conreqcsr:csrfToken},TimetrackerOperations.locationjobSchedule.getJobSchedulesCallback))},getJobSchedulesCallback:function(resultData){TimetrackerOperations.locationjobSchedule.isRefresh=!1,resultData&&resultData.errorCode&&resultData.errorCode==Timetracker.constants.ERROR_CODES.NO_PERM_CODE?(container.html("<div class='zpl_rgtcnt'></div>"),Timetracker.Util.showHideNoData({div:container,msg:ZPI18N.getString("zp.notallowedforpage"),cls:"zp_nd_permission"})):resultData&&resultData.schedules&&0!=resultData.schedules.length?TimetrackerOperations.locationjobSchedule.constructJobSchedulesList(resultData.schedules):Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.locjobschdnodata")}),Timetracker.util.removeLoading()},constructJobSchedulesList:function(resultData){if(0===(resultData=resultData||[]))return void Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.locjobschdnodata")});let locjobschdbody=settingsPage.container.find("#locjobschd_body");var docFrag=document.createDocumentFragment();$.each(resultData,function(index,data){docFrag.append($(TimetrackerOperations.locationjobSchedule.constructJobScheduleListRow(data))[0])}),locjobschdbody.html(""),locjobschdbody.append(docFrag)},constructJobScheduleListRow:function(data){let dom=$('<div class="zpl_tblcolpanl" id="locjobschd'+data.locationId+'"><div class="zpl_collapseheader"><div class="zpl_tgsprt d-flexclmcap5 a-itm-cntr"><em>Location : </em><b class="">'+data.locationName+'</b></div><div class="zpl_collaspeactions"><i class="PI_delete zpl_hvrsw" title="'+ZPI18N.getString("zp.delete")+'"></i></div></div><div id="locjobschds" class="zpl_collapsecontent"></div></div>');return ZPeopleComponents.collapsiblepanel(dom,{toggleButtonPosition:"right",toggleOnHeaderClick:!1,isActive:!1,beforepanelexpand:function(){TimetrackerOperations.locationjobSchedule.showHideJobScheduleDetails(dom,data)}}),$(dom).off().on("click",function(event){var ele=event.target;$(ele).hasClass("PI_delete")||$(ele).hasClass("zbutton__icon")||TimetrackerOperations.locationjobSchedule.updateJobSchedule(data)}),$(dom).find(".PI_delete").on("click",function(){var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.sschedule")]),body:ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.sschedule")]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(data.locationId,TimetrackerOperations.locationjobSchedule.deleteJobSchedule,data.locationId,0,extraDtls)}),dom},showHideJobScheduleDetails:function(obj,schdData){var locJocSchdObj=$(obj).find("#locjobschds");if(0===locJocSchdObj.find(".zpl_tblres").length){var docFrag=$('<div class="zpl_tblres"><table class="zpl_tbl"><thead><tr><th>'+ZPI18N.getString("zp.jobname")+"</th><th>"+ZPI18N.getString("zp.scheduletimerange")+"</th></tr></thead><tbody></tbody></table></div>");$.each(schdData.schedules,function(index,data){docFrag.find("tbody").append(TimetrackerOperations.locationjobSchedule.constructJobScheduleDetailRow(data)[0])}),Timetracker.util.init(),locJocSchdObj.append(docFrag)}},constructJobScheduleDetailRow:function(data){var time,type=data.type;return time=void 0!=type&&0==type?data.hoursInTimeFormat:Calendar.minstotimeFormat(data.fromTimeInMins)+" - "+Calendar.minstotimeFormat(data.toTimeInMins),$('<tr><td><span class="d-flexC flexclmcap"><span class="PI_s_leave icn"></span><span>'+data.jobName+"</span> </span></td><td><span>"+time+"</span></td></tr>")},addJobSchedule:function(){Layout.Page.container.find("#locjobschd_add").addClass("disabled"),TimetrackerOperations.locationjobSchedule.constructAddUpdateSchedulePopUp()},constructAddUpdateSchedulePopUp:function(data){var isUpdate=Timetracker.Validations.isDefiniteValue(data),header=isUpdate?ZPI18N.getString("zp.editschedule"):ZPI18N.getString("zp.addschedule"),body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn w400"><div><label>'+ZPI18N.getString("zp.location")+'</label></div><div><select elemType="select" id="locjobsch_location" placeholder ="'+ZPI18N.getString("zp.selectlocation")+'"></select></div></div><div class="zpl_secn"><div class="zpl_tblres"><table class="zpl_tbl zpl_w-100"><thead><tr><th id="thead_locjobschdclientselect" class="mw180">'+ZPI18N.getString("zp.clientname")+'</th><th class="mw180" id="thead_locjobschdprojectselect">'+ZPI18N.getString("zp.projectname")+'</th><th class="mw180" id="thead_locjobschdjobselect">'+ZPI18N.getString("zp.jobname")+"</th><th>"+ZPI18N.getString("zp.scheduletimerange")+'</th><th width="80"></th></tr></thead><tbody id="locjobschddtl_tbody"></tbody></table><div class="zpl_idiv"><a class="zpl_lnkbg zpl_drpdwn-js" id="addJobSchRowBtn">'+ZPI18N.getString("zp.addrow")+'</a></div></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.local.Effectivedate")+'</label></div><div class="d-flexclmcap5 w400"><div class="flex-basis50"><input id="locjobschd_from"></div><div class="flex-basis50"><input id="locjobschd_to"></div></div></div></div></div>',modal=ModuleComp.Modal.setup({id:"locationJobSchedulePopUp",type:1,header:header,body:body,backdrop:!0,closeOnSubmit:!1,modalClass:"zpl_mdl zpl_mmd",deleteOnHide:!1,closeonEsc:!0,buttonValue:isUpdate?ZPI18N.getString("zp.save"):ZPI18N.getString("zp.add"),successCallback:TimetrackerOperations.locationjobSchedule.validateAndAddUpdateJobSchedule,hiddenCallback:TimetrackerOperations.locationjobSchedule.onAddUpdateJobSchedulePopUpClose,extraDetails:{isUpdate:isUpdate}});if(modal.find("#zp_modal_blubtn").removeClass("disabled"),Timetracker.generalSettings.isBreakEnabled()){var timelogType=[{id:"add_timelog_row",name:ZPI18N.getString("zp.local.TimeLog"),callback:"TimetrackerOperations.locationjobSchedule.addRowByMenuCallback"},{id:"add_breaklog_row",name:ZPI18N.getString("zp.break"),callback:"TimetrackerOperations.locationjobSchedule.addRowByMenuCallback"}];Timetracker.Util.constructMoreOption(timelogType,"addJobSchRow",null,null,{skipIcon:!0,direction:"bottom"})}else modal.find("#addJobSchRowBtn").off().on("click",function(){TimetrackerOperations.locationjobSchedule.addRowByMenuCallback("add_timelog_row")});Timetracker.Location.constructLocationFilter("locjobsch_location",Timetracker.Filters.getParamsForFilter("LocationJobSchedule"),Timetracker.constants.TTCustomAdmin.EntryView,{defaultOption:{id:"",value:""}}),TimetrackerOperations.locationjobSchedule.addUpdateJobScheduleDetailRowActions(modal,isUpdate,data)},addRowByMenuCallback:function(event,params){modal=Timetracker.Util.getLayout().find("#locationJobSchedulePopUp");var locId=TimelyZComp.select.getValue(modal.find("#locjobsch_location"));locId=""!==locId?locId:"0","add_timelog_row"==event||"add_timelog_row"==params.options.id?TimetrackerOperations.locationjobSchedule.addJobScheduleDetailRow(modal.find("#locjobschddtl_tbody"),!1,locId):TimetrackerOperations.locationjobSchedule.addJobScheduleDetailRow(modal.find("#locjobschddtl_tbody"),!0,locId)},onAddUpdateJobSchedulePopUpClose:function(){var layout=Timetracker.Util.getLayout();layout.find("#locjobschd_add").removeClass("disabled"),modal=layout.find("#locationJobSchedulePopUp"),modal.find("input,select").each(function(i){ZPeopleComponents.isComponent(this)&&TimelyZComp.select.destroy(this)});var addbtn=layout.find("#addJobSchRowBtn");ZPeopleComponents.isComponent(addbtn)&&ZPeopleComponents.menu(addbtn).destroy(),TimelyZComp.dateField.destroy(modal.find("#locjobschd_from")),TimelyZComp.dateField.destroy(modal.find("#locjobschd_to"))},addUpdateJobScheduleDetailRowActions:function(modal,isUpdate,data,isFromLocationChange){var locjobschddtl_tbody=modal.find("#locjobschddtl_tbody");if(isUpdate)isFromLocationChange||(TimelyZComp.select.setValue(modal.find("#locjobsch_location"),data.locationId),TimelyZComp.select.setAttributes(modal.find("#locjobsch_location"),{disabled:!0})),TimetrackerOperations.locationjobSchedule.setJobScheduleDetailRow(locjobschddtl_tbody,data.locationId,data.schedules),TimelyZComp.dateField.intialize(modal.find("#locjobschd_from")),TimelyZComp.dateField.intialize(modal.find("#locjobschd_to")),TimelyZComp.dateField.setValue(modal.find("#locjobschd_from"),data.repeatFrom),TimelyZComp.dateField.setValue(modal.find("#locjobschd_to"),data.repeatUntil?data.repeatUntil:""),modal.data("locationschedule",data);else{isFromLocationChange||TimelyZComp.select.deselectAllOptions(modal.find("#locjobsch_location"));var locationId=TimelyZComp.select.getValue(modal.find("#locjobsch_location"));TimetrackerOperations.locationjobSchedule.addJobScheduleDetailRow(locjobschddtl_tbody,!1,""!==locationId?locationId:void 0),TimelyZComp.dateField.intialize(modal.find("#locjobschd_from")),TimelyZComp.dateField.intialize(modal.find("#locjobschd_to")),modal.find("#locjobschd_from").val(""),modal.find("#locjobschd_to").val("")}if(Timetracker.timelogs.bulkView.showEnabledDayWeekColumns("locjobschd",modal),!isFromLocationChange){if(Timetracker.generalSettings.isBreakEnabled()){modal.find("#locjobschd_addrow").hide();var dropdwonObj=modal.find("#locjobschd_addrow_dropdown");dropdwonObj.show(),dropdwonObj.find(".dropdown-menu").attr("style","top:-35.75px;left:"+(dropdwonObj.width()+20)+"px")}else modal.find("#locjobschd_addrow").show(),modal.find("#locjobschd_addrow_dropdown").hide();modal.find("#locjobsch_location").on("zselectchange",function(){TimetrackerOperations.locationjobSchedule.onLocationChange(this,modal)}),modal.find("#add_jobschd_row, #locjobschd_addrow").on("click",function(){var locId=modal.find("#locjobsch_location").val();TimetrackerOperations.locationjobSchedule.addJobScheduleDetailRow(locjobschddtl_tbody,!1,""!==locId?locId:"0")}),modal.find("#add_breakschd_row").on("click",function(){var locId=modal.find("#locjobsch_location").val();TimetrackerOperations.locationjobSchedule.addJobScheduleDetailRow(locjobschddtl_tbody,!0,""!==locId?locId:"0")}),modal.find("#locjobschd_from, #locjobschd_to").on("click",function(){Calendar.setUpCalendar(event,this)}),Timetracker.util.init()}},addJobScheduleDetailRow:async function(locjobschddtl_tbody,isBreakLog,locationId){var lastRowIndex=locjobschddtl_tbody.data("lastRowIndex");void 0===lastRowIndex&&(lastRowIndex=0);var locJobSchdRow='<tr id="locjobschddtlrow'+ ++lastRowIndex+'" class="ZPLRow"><td id="td_locjobschdclientselect" class="zpl_DNI"><input id="locjobschdclientselect'+lastRowIndex+'" type="client" name="client" class="mw150"/></td><td id="td_locjobschdprojectselect" class="zpl_DNI"><input id="locjobschdprojectselect'+lastRowIndex+'" type="project" name="project" class="mw150"/></td><td id="td_locjobschdjobselect"><input id="locjobschdjobselect'+lastRowIndex+'" type="job" name="job" elemtype="select" class="mw150"/></td><td><div><input id="schd_time_'+lastRowIndex+'" class="ztextbox w80" type="text" placeHolder="00:00"></div></td><td><div class="zpl_hvr"><i id="locjobschddtl_deleterow" class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'"></i></div></td></tr>';locjobschddtl_tbody.append($(locJobSchdRow)),locjobschddtl_tbody.find(),locjobschddtl_tbody.find("#schd_time_"+lastRowIndex).on("click",function(event){TimetrackerOperations.locationjobSchedule.constructBulklogAddEditPopUp(this,isBreakLog,event)}),1===locjobschddtl_tbody.find("tr.ZPLRow").length?locjobschddtl_tbody.find("tr.ZPLRow").find("#locjobschddtl_deleterow").parent().addClass("zpl_DNI"):locjobschddtl_tbody.find("#locjobschddtl_deleterow:hidden").parent().removeClass("zpl_DNI");var currlocJobSchdRow=locjobschddtl_tbody.find("#locjobschddtlrow"+lastRowIndex);currlocJobSchdRow.find("#locjobschddtl_deleterow").on("click",function(){TimetrackerOperations.locationjobSchedule.removeJobScheduleDetailRow(currlocJobSchdRow,locjobschddtl_tbody)});var operation="locationjobschedule",id="locjobschd";if(!0===isBreakLog)await Timetracker.jobs.Filters.createJobSelect(null,null,operation,currlocJobSchdRow.find("[name='project']"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{isBreakLog:!0,locationId:locationId||"0"}),currlocJobSchdRow.find("#td_"+id+"clientselect,#td_"+id+"projectselect").html(""),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&currlocJobSchdRow.find("#td_"+id+"clientselect").removeClass("zpl_DNI"),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects&&currlocJobSchdRow.find("#td_"+id+"projectselect").removeClass("zpl_DNI");else if("1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&(currlocJobSchdRow.find("#td_"+id+"clientselect").removeClass("zpl_DNI"),Timetracker.clients.getClients(id+"clientselect","0",currlocJobSchdRow.find("[name='client']"),!1,null,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"})),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects){currlocJobSchdRow.find("#td_"+id+"projectselect").removeClass("zpl_DNI");var clientId=TimelyZComp.select.getValue(currlocJobSchdRow.find("[name='client']"));await Timetracker.projects.Filters.createProjectSelect(!0,null,clientId,operation,null,currlocJobSchdRow.find("[name='project']"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"})}else await Timetracker.jobs.Filters.createJobSelect(null,null,operation,currlocJobSchdRow.find("[name='project']"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"});currlocJobSchdRow.find("[name='client']").on("zselectchange",function(event){event&&!event.detail.fromUI||Timetracker.projects.Filters.createProjectSelect(!0,null,event.detail.selectedValue,operation,null,currlocJobSchdRow.find("[name='project']"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"})}),currlocJobSchdRow.find("[name='project']").on("zselectchange",function(event){event&&!event.detail.fromUI||Timetracker.jobs.Filters.createJobSelect(null,null,operation,currlocJobSchdRow.find("[name='project']"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{locationId:locationId||"0"})}),currlocJobSchdRow.find("[name='job']").on("zselectchange",function(event){if(!event||event.detail.fromUI){var jobDataAtIndex,otherdetails={allowAll:!0,isNewKey:!0,skipJobReset:!0,locationId:locationId||"0"};isBreakLog&&(otherdetails.isBreakLog=isBreakLog);var jobIndex=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.jobs.jobData,event.detail.selectedValue,"jobId");if(-1!==jobIndex&&void 0!==Timetracker.jobs.jobData[jobIndex]){var jobDataIndex=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.jobs.jobData,event.detail.selectedValue,"jobId");jobDataAtIndex=Timetracker.jobs.jobData[jobDataIndex]}else otherdetails.isNewKey=!1;Timetracker.timelogs.setValuesInSelectInput(jobDataAtIndex,null,currlocJobSchdRow.attr("id"),null,otherdetails)}}),locjobschddtl_tbody.data("lastRowIndex",lastRowIndex)},setJobScheduleDetailRow:function(locjobschddtl_tbody,locationId,schdArr){$.each(schdArr,async function(index,data){var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",data);await TimetrackerOperations.locationjobSchedule.addJobScheduleDetailRow(locjobschddtl_tbody,isBreakLog,locationId);var lastRowIndex=locjobschddtl_tbody.data("lastRowIndex"),currRow=locjobschddtl_tbody.find("#locjobschddtlrow"+lastRowIndex),otherdetails={isNewKey:!0,allowAll:!0,locationId:locationId};isBreakLog&&(otherdetails.isBreakLog=!0),Timetracker.timelogs.setValuesInSelectInput(data,null,$(currRow).attr("id"),null,otherdetails);var hrsInput=$(currRow).find("[id^=schd_time_]");$(hrsInput).val(data.hoursInTimeFormat),$(hrsInput).attr("logtype",0),1!==data.type&&"1"!==data.type||($(hrsInput).attr("title",data.fromTimeInTimeFormat+" - "+data.toTimeInTimeFormat),$(hrsInput).attr("fromtime",data.fromTimeInMins),$(hrsInput).attr("totime",data.toTimeInMins),$(hrsInput).attr("logtype",1))})},eventHandlingLocJobSch:function(modalLayout){0!==modalLayout.length&&modalLayout.is(":visible")&&"bulklog_add_edit"==modalLayout.attr("id")&&$(".zpopover--overley").click(function(event){0==$.find("#bulklog_add_edit").length||$(event.target).closest("#bulklog_add_edit").length||$(event.target).is("#bulklog_add_edit")||(ZPeopleComponents.popover("#bulklog_add_edit").close(),$(".zpopover--overley").remove())})},removeJobScheduleDetailRow:function(obj,locjobschddtl_tbody){obj.find("input").each(function(i){ZPeopleComponents.isComponent(this)&&TimelyZComp.select.destroy(this)}),$(obj).remove(),1===locjobschddtl_tbody.find("tr.ZPLRow").length&&locjobschddtl_tbody.find("tr.ZPLRow").find("#locjobschddtl_deleterow").parent().addClass("zpl_DNI")},constructBulklogAddEditPopUp:function(obj,isBreakRow,event){var bulklog_modal=Timetracker.Util.getLayout().find("#bulklog_add_edit"),isShiftEnabled=Timetracker.isTTSthiftEnabled();0===bulklog_modal.length?(Layout.Page.container.append(Timetracker.timelogs.bulkView.constructBulklogAddEditPopUpModal(isShiftEnabled)),(bulklog_modal=Layout.Page.container.find("#bulklog_add_edit")).on("shown.bs.modal",function(){bulklog_modal.find("#bulk_timelog_hrstime").focus()}),isShiftEnabled&&(bulklog_modal.addClass("zpl_w560"),bulklog_modal.find(".zpl_breakpop").addClass("zpl_w-auto"))):(ZPeopleComponents.timefield(bulklog_modal.find("#bulk_timelog_fromtime")).destroy(),ZPeopleComponents.timefield(bulklog_modal.find("#bulk_timelog_totime")).destroy(),isShiftEnabled&&ZPeopleComponents.select(bulklog_modal.find("#bulk_timelog_fromselect")).destroy(),isShiftEnabled&&ZPeopleComponents.select(bulklog_modal.find("#bulk_timelog_toselect")).destroy(),bulklog_modal.find("#bulk_timelog_hrstime").removeClass("ztextbox__error"),bulklog_modal.find("#bulklog_submit").removeClass("disabled"),bulklog_modal.find("#error_msg").remove()),bulklog_modal.on("zpopoverclose",function(){bulklog_modal.remove()}),bulklog_modal.find("#bulk_timelog_hrstime").off("keyup").on("keyup",function(){$(this).removeClass("ztextbox__error"),bulklog_modal.find("#bulklog_submit").removeClass("disabled"),""===$(this).val()||$(this).val().match(Timetracker.util.maxhrsRegex)||($(this).addClass("ztextbox__error"),bulklog_modal.find("#bulklog_submit").addClass("disabled"))}),bulklog_modal.find("#bulklog_submit").off("click").on("click",function(){0!=TimetrackerOperations.locationjobSchedule.submitBulkLogAddEditCallback(bulklog_modal,obj)&&ZPeopleComponents.popover("#bulklog_add_edit").close()}),bulklog_modal.find("#bulk_timelog_hrs").parent().removeClass("zpl_DNI"),bulklog_modal.find("#bulk_timelog_hrs").prop("checked",!0),bulklog_modal.find("#bulk_timelog_hrstime").val("").attr("oldValue",""),bulklog_modal.find("#bulk_timelog_hrs").click();var opt={clearButton:"none",className:"w100"};if(opt.format=timeFormat.replace("a","tt"),opt.value=Calendar.currrentDate,ZPeopleComponents.timefield(bulklog_modal.find("#bulk_timelog_fromtime"),opt),ZPeopleComponents.timefield(bulklog_modal.find("#bulk_timelog_totime"),opt),isShiftEnabled){var statusArr=[];statusArr.push({label:ZPI18N.getString("zp.currentday"),value:"0"}),statusArr.push({label:ZPI18N.getString("zp.nextday"),value:"1"}),statusArr.push({label:ZPI18N.getString("zp.prevday"),value:"-1"}),opt={options:statusArr,selectedValue:"0",dropdownList:{appendTo:bulklog_modal.find(".zpl_breakpop")}},TimelyZComp.select.intialize(bulklog_modal.find("#bulk_timelog_fromselect"),opt),TimelyZComp.select.intialize(bulklog_modal.find("#bulk_timelog_toselect"),opt)}if(""!==$(obj).val())if($(obj).attr("fromtime")&&""!==$(obj).attr("fromtime")&&$(obj).attr("totime")&&""!==$(obj).attr("totime")){var fromtime=parseInt($(obj).attr("fromtime")),totime=parseInt($(obj).attr("totime"));bulklog_modal.find("#bulk_timelog_hrs").prop("checked",!0),bulklog_modal.find("#bulk_timelog_start_end").prop("checked",!1),bulklog_modal.find("#bulk_timelog_start_end").click();var fromDay=0,toDay=0;fromtime<0?(fromtime+=Timetracker.constants.PER_DAY_MIN,fromDay=-1):fromtime>Timetracker.constants.PER_DAY_MIN&&(fromtime-=Timetracker.constants.PER_DAY_MIN,fromDay=1),totime<0?(totime+=Timetracker.constants.PER_DAY_MIN,toDay=-1):fromtime>Timetracker.constants.PER_DAY_MIN&&(totime-=Timetracker.constants.PER_DAY_MIN,toDay=1),TimelyZComp.timeField.setValue(bulklog_modal.find("#bulk_timelog_fromtime"),Calendar.minstotimeFormat(fromtime)),TimelyZComp.timeField.setValue(bulklog_modal.find("#bulk_timelog_totime"),Calendar.minstotimeFormat(totime)),isShiftEnabled&&TimelyZComp.select.setValue(bulklog_modal.find("#bulk_timelog_fromselect"),fromDay),isShiftEnabled&&TimelyZComp.select.setValue(bulklog_modal.find("#bulk_timelog_toselect"),toDay)}else bulklog_modal.find("#bulk_timelog_hrstime").val($(obj).val()).attr("oldValue",$(obj).val());isBreakRow&&(bulklog_modal.find("#bulk_timelog_hrs").parent().addClass("zpl_DNI"),bulklog_modal.find("#bulk_timelog_hrs").prop("checked",!1),bulklog_modal.find("#bulk_timelog_start_end").prop("checked",!0),bulklog_modal.find("#bulk_timelog_start_end").click()),bulklog_modal.find("#log_hrs_span").text(""!==$(obj).val()?$(obj).val():"00:00"),TimetrackerOperations.locationjobSchedule.setBulklogAddEditPopUpModalPosition(obj,bulklog_modal);var popJson={forElement:event.target,type:"modal",open:function(){var hrsInpId="";""!==(hrsInpId=bulklog_modal.find("#bulk_timelog_hrs").is(":visible")?"bulk_timelog_hrstime":"bulk_timelog_start_end_time")&&setTimeout(()=>{bulklog_modal.find("#"+hrsInpId).focus()},100)}};ZPeopleComponents.popover("#bulklog_add_edit",popJson).open(),TimetrackerOperations.locationjobSchedule.eventHandlingLocJobSch(bulklog_modal)},setBulklogAddEditPopUpModalPosition:function(obj,bulklog_modal){var top_adjustment=30;"ts_teamuser"===Timetracker.Page.getPageMode()&&(top_adjustment=140);var left=$(obj).offset().left-0-560,top=$(obj).offset().top-top_adjustment;$(bulklog_modal).attr("style",$(bulklog_modal).attr("style")+"; left: "+left+"px; top: "+top+"px !important")},submitBulkLogAddEditCallback:function(modal,obj){var timelogtype=modal.find("#bulk_timelog_type").find("input[name='timelogTime']:checked").val();modal.find(".ztextbox--error__label").remove();var loggedHrs=0,isShiftEnabled=Timetracker.isTTSthiftEnabled();if("0"===timelogtype)modal.find("#bulk_timelog_hrstime").removeClass("ztextbox__error"),loggedHrs=modal.find("#bulk_timelog_hrstime").val(),$(obj).attr("title",""),$(obj).attr("fromtime",""),$(obj).attr("totime",""),$(obj).attr("logtype",0),$(obj).val(loggedHrs);else if("1"===timelogtype){var fromhrstot=TimelyZComp.timeField.getValue(modal.find("#bulk_timelog_fromtime")),tohrstot=TimelyZComp.timeField.getValue(modal.find("#bulk_timelog_totime")),fromDay=isShiftEnabled?TimelyZComp.select.getValue(modal.find("#bulk_timelog_fromselect")):0,toDay=isShiftEnabled?TimelyZComp.select.getValue(modal.find("#bulk_timelog_toselect")):0;if(void 0==fromhrstot||void 0==tohrstot||void 0==fromDay||void 0==toDay)return modal.find("#bulk_timelog_start_end_time").append('<span class="ztextbox--error__label" id="error_msg">'+ZPI18N.getString("zp.entervalidtime")+"</span>"),!1;if(fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.split(":")),toTime=Timetracker.util.getTotalTimeForHours(tohrstot.split(":")),isShiftEnabled){if(fromTime+=Timetracker.constants.PER_DAY_MIN*fromDay,toTime+=Timetracker.constants.PER_DAY_MIN*toDay,toTime<fromTime)return modal.find("#bulk_timelog_start_end_time").append('<span class="ztextbox--error__label" id="error_msg">'+ZPI18N.getString("zp.fromtimegreater")+"</span>"),!1;if(toTime-fromTime>Timetracker.constants.PER_DAY_MIN)return modal.find("#bulk_timelog_start_end_time").append('<span class="ztextbox--error__label" id="error_msg">'+ZPI18N.getString("zp.timeexceeded24")+"</span>"),!1}loggedHrs=toTime>=fromTime?toTime-fromTime:toTime+Timetracker.constants.PER_DAY_MIN-fromTime,loggedHrs=Calendar.minstohrs(loggedHrs),$(obj).attr("title",fromhrstot+" - "+tohrstot),$(obj).attr("interval",fromhrstot+" - "+tohrstot),$(obj).attr("logtype",1),$(obj).attr("fromtime",fromTime),$(obj).attr("totime",toTime),$(obj).val(loggedHrs)}$(obj).removeClass("ztextbox__error")},onLocationChange:function(obj,modal){var locjobschddtl_tbody=modal.find("#locjobschddtl_tbody");locjobschddtl_tbody.find("input,select").each(function(i){ZPeopleComponents.isComponent(this)&&TimelyZComp.select.destroy(this)}),locjobschddtl_tbody.html(""),locjobschddtl_tbody.data("");var data=modal.data("locationschedule"),isUpdate=data&&data.locationId==$(obj).val();TimetrackerOperations.locationjobSchedule.addUpdateJobScheduleDetailRowActions(modal,isUpdate,isUpdate?data:void 0,!0)},addJobSchedule:function(){Layout.Page.container.find("#locjobschd_add").addClass("disabled"),TimetrackerOperations.locationjobSchedule.constructAddUpdateSchedulePopUp()},addJobScheduleCallback:function(result,params){if(Timetracker.util.removeLoading(),result&&result.success){if(Timetracker.util.showAlert(2,result.successMsg),result.schedule){var locjobschdbody=Layout.Page.container.find("#locjobschd_body");0==locjobschdbody.children().length&&Timetracker.Util.showHideNoData({remove:!0}),locjobschdbody.append(TimetrackerOperations.locationjobSchedule.constructJobScheduleListRow(result.schedule)),Layout.Page.container.find("#locjobschd_body").removeClass("zpl_DNI")}}else{if(result&&result.errorCode===Timetracker.constants.ERROR_CODES.JOBSCHEDULE.ER_TS_JOBSCH_LOC_EXISTS&&result.errorMsg){var modal=Layout.Page.container.find("#locationJobSchedulePopUp");return modal.find("#locjobsch_location").parent().append("<div class='error-msg'>"+result.errorMsg+"</div>"),void modal.find("#zp_modal_blubtn").prop("disabled",!1)}Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(void 0,result?{errorMsg:result.errorMsg}:result))}ModuleComp.Modal.hide("locationJobSchedulePopUp")},updateJobSchedule:function(data){TimetrackerOperations.locationjobSchedule.constructAddUpdateSchedulePopUp(data)},updateJobScheduleCallback:function(result,params){result&&result.success?(Timetracker.util.showAlert(2,result.successMsg),result.schedule&&Timetracker.Util.getLayout().find("#locjobschd_body").find("#locjobschd"+result.schedule.locationId).replaceWith(TimetrackerOperations.locationjobSchedule.constructJobScheduleListRow(result.schedule))):Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(void 0,result?{errorMsg:result.errorMsg}:result));ModuleComp.Modal.hide("locationJobSchedulePopUp"),Layout.Page.container.find("#locationJobSchedulePopUp .zpl_crdcnt").removeClass("zpl_DNI"),Timetracker.util.removeLoading()},validateAndAddUpdateJobSchedule:function(modal){var pageLayout=Timetracker.Util.getLayout(),submitButton=modal.find("#zp_modal_blubtn");submitButton.addClass("disabled"),Timetracker.util.removeErrorMsg("locationJobSchedulePopUp");var extraDetails=modal.data("extraDetails"),isUpdate=extraDetails&&extraDetails.isUpdate,params={mode:isUpdate?"updateLocationJobSchedule":"addLocationJobSchedule",conreqcsr:csrfToken},locationIdObj=modal.find("#locjobsch_location"),locationId=TimelyZComp.select.getValue(locationIdObj);if("0"===locationId||""===locationId)return Timetracker.Util.appenErrorMsgForElem({obj:locationIdObj}),void submitButton.removeClass("disabled");if(!isUpdate&&0!==pageLayout.find("#locjobschd"+locationId).length)return Timetracker.Util.appenErrorMsgForElem({obj:locationIdObj,msg:ZPI18N.getString("zp.locschdexistserr")}),void submitButton.removeClass("disabled");params.assignedTo=locationId;var repeatFromObj=modal.find("#locjobschd_from"),fromDate=TimelyZComp.dateField.getValue(repeatFromObj);if(Timetracker.Validations.isEmpty(fromDate))return Timetracker.util.appendErrorMsg({obj:repeatFromObj.parent(),msg:ZPI18N.getString("zp.fromdateerr"),action:"append"}),void submitButton.removeClass("disabled");if(!Timetracker.DateTime.isDate(fromDate))return Timetracker.util.appendErrorMsg({obj:repeatFromObj.parent(),msg:ZPI18N.getString("zp.validdateerr"),action:"append"}),void submitButton.removeClass("disabled");params.repeatFrom=Timetracker.DateTime.getDateinDBformat(Calendar.parseDate(fromDate,uidateFormat),!0);var repeatUntilObj=modal.find("#locjobschd_to"),toDate=TimelyZComp.dateField.getValue(repeatUntilObj);if(!Timetracker.Validations.isEmpty(toDate)){if(!Timetracker.DateTime.isDate(toDate))return Timetracker.util.appendErrorMsg({obj:repeatUntilObj.parent(),msg:ZPI18N.getString("zp.validdateerr"),action:"append"}),void submitButton.removeClass("disabled");if(!Timetracker.DateTime.isValidDateRange(fromDate,toDate))return Timetracker.util.appendErrorMsg({obj:repeatUntilObj.parent(),msg:ZPI18N.getString("zp.fromtodateerr"),action:"append"}),void submitButton.removeClass("disabled");params.repeatUntil=Timetracker.DateTime.getDateinDBformat(Calendar.parseDate(toDate,uidateFormat),!0)}for(var isError,scheduleArr=new Array,schdRows=modal.find("#locjobschddtl_tbody").find("[id^=locjobschddtlrow]"),i=0;i<schdRows.length;i++){var schdRow=$(schdRows[i]),jobIdObj=schdRow.find("[name='job']"),jobId=TimelyZComp.select.getValue(jobIdObj),timeObj=schdRow.find("[id^=schd_time_]"),type=parseInt($(timeObj).attr("logtype")),hours=$(timeObj).val(),fromTimeVal=$(timeObj).attr("fromtime"),toTimeVal=$(timeObj).attr("totime");if(fromTimeVal=fromTimeVal?parseInt(fromTimeVal):fromTimeVal,toTimeVal=toTimeVal?parseInt(toTimeVal):toTimeVal,!Timetracker.Validations.isEmpty(jobId)&&"0"!==jobId||!Timetracker.Validations.isEmpty(fromTimeVal)||!Timetracker.Validations.isEmpty(toTimeVal)){if(isError=!1,(Timetracker.Validations.isEmpty(jobId)||"0"===jobId)&&(Timetracker.Util.appenErrorMsgForElem({obj:jobIdObj}),isError=!0),1==type?""===fromTimeVal||""===toTimeVal?(timeObj.addClass("ztextbox__error"),Timetracker.util.showAlert(1,ZPI18N.getString("zp.entervalidperiod")),isError=!0):hours=toTimeVal>fromTimeVal?toTimeVal-fromTimeVal:toTimeVal-fromTimeVal+1440:hours.match(Timetracker.util.maxWeekHrsRegex)?hours=parseInt(Timetracker.DateTime.convertToMins(hours)):(timeObj.addClass("ztextbox__error"),Timetracker.util.showAlert(1,ZPI18N.getString("zp.entervalidperiod")),isError=!0),isError)return void submitButton.removeClass("disabled");scheduleArr.push({jobId:jobId,fromTime:fromTimeVal,toTime:toTimeVal,hours:hours,type:type})}}if(0===scheduleArr.length)return Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#locjobschddtl_tbody").find("#td_locjobschdjobselect").find(":first")}),void submitButton.removeClass("disabled");params.schedules=JSON.stringify(scheduleArr),Timetracker.util.appendLoading(null,{type:"popup",containerId:"locationJobSchedulePopUp",containerClass:"zpl_mcnt"}),pageLayout.find("#locationJobSchedulePopUp .zpl_crdcnt").addClass("zpl_DNI"),ZPeople.Request.send(Timetracker.constants.URL,params,isUpdate?TimetrackerOperations.locationjobSchedule.updateJobScheduleCallback:TimetrackerOperations.locationjobSchedule.addJobScheduleCallback)},deleteJobSchedule:function(locationId){Layout.Page.container.find("#locjobschd_body").addClass("zpl_DNI"),Timetracker.util.appendLoading(),ZPeople.Request.send(Timetracker.constants.URL,{mode:"deleteLocationJobSchedule",assignedTo:locationId,conreqcsr:csrfToken},TimetrackerOperations.locationjobSchedule.deleteJobScheduleCallback)},deleteJobScheduleCallback:function(resultData,params){resultData&&resultData.success?(Timetracker.util.showAlert(2,resultData.successMsg),Layout.Page.container.find("#locjobschd"+params.assignedTo).remove(),0==Layout.Page.container.find("#locjobschd_body").children().length?Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.locjobschdnodata")}):Layout.Page.container.find("#locjobschd_body").removeClass("zpl_DNI")):Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(void 0,resultData?{errorMsg:resultData.errorMsg}:resultData)),Timetracker.util.removeLoading()}},Timetracker.jobSchedule.Form={fetchDisplayName:function(labelName){var cstmFields=Timetracker.jobSchedule.getCustomFields();if(void 0!==cstmFields)for(var itr=0;itr<cstmFields.length;itr++){var cstmFldObj=cstmFields[itr],cstmFldLabelName=cstmFldObj.labelName,cstmFldDispName=cstmFldObj.displayName;if(cstmFldLabelName===labelName)return cstmFldDispName}return""},validateField:function(user,fieldPermissions,action){var permission=fieldPermissions[action],type=action===Timetracker.constants.VIEW?Timetracker.constants.TTCustomAdmin.EntryView:Timetracker.constants.TTCustomAdmin.EntryEdit;return!!(Timetracker.isDataAdminForSpecificUsers&&Timetracker.isDataAdminForUser(user)||Timetracker.isTTCustomAdmin(type)&&Timetracker.isTTCustomAdminForUser(type,user)||"2"==permission&&user===erecno||("1"==permission||"2"==permission)&&user!==erecno&&ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.includes(user))},fetchAllowedJobSchFields:function(user,action){if(!Timetracker.jobSchedule.hasFieldPermissions())return null;var fieldPerms=Timetracker.jobSchedule.getFieldPermissions();if(Timetracker.isDataAdminForAllUsers())return Object.keys(fieldPerms);var jobSchAllowedFields=[];for(var field in fieldPerms)Timetracker.jobSchedule.Form.validateField(user,fieldPerms[field],action)&&jobSchAllowedFields.push(field);return jobSchAllowedFields},getFieldPermissionColumns:function(){if(Timetracker.jobSchedule.hasFieldPermissions()){var fieldPerms=Timetracker.jobSchedule.getFieldPermissions();return Object.keys(fieldPerms)}return null},fetchAllAllowedFields:function(user,action,customFields){if(!customFields){if(!Timetracker.jobSchedule.hasCustomFields())return null;customFields=Timetracker.jobSchedule.getCustomFields()}var allowedFileds=Timetracker.jobSchedule.Form.fetchAllowedJobSchFields(user,action)||[],filedsWithPerm=Timetracker.jobSchedule.Form.getFieldPermissionColumns()||[];customFields.forEach(customField=>{filedsWithPerm.includes(customField.labelName)||allowedFileds.push(customField.labelName)});return allowedFileds},isClientFieldAllowed:function(user,action){if(!Timetracker.isDataAdminForAllUsers()&&Timetracker.jobSchedule.hasFieldPermissions()){var fieldPerms=Timetracker.jobSchedule.getFieldPermissions();return!("Client"in fieldPerms&&!Timetracker.jobSchedule.Form.validateField(user,fieldPerms.Client,action))}return!0},isClientFilterAllowed:function(){if(!Timetracker.jobSchedule.hasFieldPermissions())return!0;var fieldPerms=Timetracker.jobSchedule.getFieldPermissions();return!(!Timetracker.isDataAdminForAllUsers()&&"Client"in fieldPerms&&"2"!=fieldPerms.Client.view)}},Timetracker.jobSchedule.timelogsView={JOBSCHEDULE_DETAILS_PRESENTDATE:{},populateJobSchDetailsCache:function(timelogsRes,isReset){Timetracker.jobSchedule.hasCustomFields()&&(void 0!==isReset&&isReset?0!=Object.keys(Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE).length&&(Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE={}):timelogsRes.hasOwnProperty("idSpecificDtlObj")?Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE=timelogsRes.idSpecificDtlObj:Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE={})},displayCriBriefJobSch:function(){var allowDisp=!1;return Timetracker.jobSchedule.hasCustomFields()&&Timetracker.timelogs.timeLogAllowedTypes.automaticLog&&erecno===Timetracker.timelogs.tserecno&&(allowDisp=!0),allowDisp},fetchJobschIdCorresJob:function(currSelectObj){var jobId=null!=currSelectObj&&currSelectObj.hasOwnProperty("jobId")?currSelectObj.jobId:null,jschId=null;if(null!=jobId&&0!=Object.keys(Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE).length){var jobSchData=Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE;return $.each(jobSchData,function(indexJschId,jschDtl){jschDtl.jobId==jobId&&(jschId=jschDtl.tschId)}),jschId}},constructBriefJobSch:function(){if(Timetracker.jobSchedule.timelogsView.displayCriBriefJobSch())if(0!=Object.keys(Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE).length){Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("JSCH_BRIEF_LIST","timelogs_list_view");var jobSchData=Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE,jobSchDom=Layout.Page.container.find("#jsch_brief_divs");if(jobSchDom.html(""),$.each(jobSchData,function(indexJschId,jschDtl){var fTime=Timetracker.DateTime.minstoTimeMeridian(jschDtl.fromTime),tTime=Timetracker.DateTime.minstoTimeMeridian(jschDtl.toTime),jTxt='<div class="jbs_wrkitm jc'+jschDtl.jobcolor+' M0I" name="jobSchedule" jschid="'+jschDtl.tschId+'" jobid="'+jschDtl.jobId+'" title="'+jschDtl.jobName+'" onclick="Timetracker.jobSchedule.timelogsView.constructDtlViewJobSch(this);"><div class="zpl_wrkitmnme"><span>'+jschDtl.jobName+"</span><em>"+fTime+"-"+tTime+"</em></div></div>";jobSchDom.append(jTxt)}),null!==Timetracker.timelogs.currentTimerJobData){var otherDtls={};otherDtls.runningJobId=Timetracker.timelogs.currentTimerJobData.jobId,Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("FREEZE_OTHER_JSCH",null,otherDtls)}else Timetracker.jobSchedule.timelogsView.setValuesInTimerBand(void 0,!0,{mode:"TIMER_MODE"})}else Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("CLR_ALL")},constructDtlViewJobSch:function(currObj){if(0!=Object.keys(Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE).length){if(Timetracker.timelogs.currentTimerJobData)return;var isFromTimerSelect=!(null==currObj||!currObj.hasOwnProperty("isFromTimerSelect"))&&currObj.isFromTimerSelect,jobScheduleId=null,activJschDom=currObj;Layout.Page.container.find('[name="jobSchedule"]').removeClass("zpl_act"),isFromTimerSelect?(jobScheduleId=currObj.jschid,activJschDom=Layout.Page.container.find("div[jschid='"+jobScheduleId+"']")):jobScheduleId=$(currObj).attr("jschid");var jobSchData=Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE.hasOwnProperty(jobScheduleId)?Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE[jobScheduleId]:null;if(null!=jobSchData){Layout.Page.container;var data={jobId:jobSchData.jobId,jobName:jobSchData.jobName};null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects&&jobSchData.hasOwnProperty("projectId")&&jobSchData.hasOwnProperty("projectName")&&(data.projectId=jobSchData.projectId,data.projectName=jobSchData.projectName),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&jobSchData.hasOwnProperty("clientId")&&jobSchData.hasOwnProperty("clientName")&&(data.clientId=jobSchData.clientId,data.clientName=jobSchData.clientName),Timetracker.timelogs.setValuesInSelectInput(data,"timerLogTime",void 0,null,{allowAll:!0,isNewKey:!0});Timetracker.jobSchedule.timelogsView.setValuesInTimerBand(jobSchData,!1,{workitem_id:"timertask",desc_id:"timerDesc",billStId:"timerbill",mode:"TIMER_MODE"}),$(activJschDom).addClass("zpl_act");var data_customFldDtls=jobSchData.hasOwnProperty("customFieldDetails")?jobSchData.customFieldDetails:null,def_cstmFields=Timetracker.jobSchedule.getCustomFields();if(void 0!==def_cstmFields){var allowedFileds=Timetracker.jobSchedule.Form.fetchAllAllowedFields(jobSchData.assignedTo,Timetracker.constants.VIEW,def_cstmFields);if(!allowedFileds||0==allowedFileds.length)return;Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("JSCH_DTL_VIEW","timelogs_list_view");for(var jTxt="",itr=0;itr<def_cstmFields.length;itr++){var cstmFldObj=def_cstmFields[itr],key=cstmFldObj.labelName;if(allowedFileds.includes(key)){var value="-";null!=data_customFldDtls&&0!=Object.keys(data_customFldDtls).length&&(value=data_customFldDtls.hasOwnProperty(key)?data_customFldDtls[key]:"-"),jTxt+='<div class="zpl_ttrstcnrw"><em>'+cstmFldObj.displayName+'</em><b title="'+value+'">'+value+"</b></div>"}}Layout.Page.container.find("#jsch_dtl_div").html(jTxt),Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("EXP_CLS","timelogs_list_view")}}}},setValuesInTimerBand:function(jschData,clrDisabled,idsJson){var workitem=null,desc=null,billableStatus=null,mode=idsJson.mode,billStLayout=null,descLayout=null,populateValues=null==mode||"FORM_EDIT_MODE"!==mode;if(clrDisabled){if(Layout.Page.container.find("#timertask").prop("disabled",!1),Layout.Page.container.find("#timerDesc").prop("disabled",!1),Layout.Page.container.find("#timerDescIcon").hasClass("Tclr"))Layout.Page.container.find("#timerDescIcon").removeClass("Tclr").addClass("gry"),""!==(descTxt=Layout.Page.container.find("#timerDescIcon").data("timerDesc"))&&(Layout.Page.container.find("#descTextArea").val(""),Layout.Page.container.find("#timerDescIcon").data("timerDesc",""));Timetracker.timelogs.registerDescInputDropdown(!0),TimelyZComp.select.setAttributes(Layout.Page.container.find("#timerbill"),{disabled:!1})}if(!clrDisabled&&populateValues){if(jschData.hasOwnProperty("workitem")&&(workitem=jschData.workitem),jschData.hasOwnProperty("desc")&&(desc=jschData.desc),jschData.hasOwnProperty("billableStatus")&&(billableStatus=jschData.billableStatus),null!==workitem&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)){var workItemDomId="TIMER_MODE"===mode?"timertask":Layout.Page.container.find('input[name="Work_Item"]').attr("id"),workItemObj=Layout.Page.container.find("#"+workItemDomId);Timetracker.Util.removeError(workItemObj);let extraJson={};extraJson.jobId=jschData.jobId,Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem(extraJson)?(extraJson.layout=workItemObj,extraJson.toAppendOption=workitem,Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson),"TIMER_MODE"===mode&&Timetracker.jobs.Filters.gettitle("timertask",!1)):(Timetracker.timelogs.workItem.destroySelect2ApplyInput({eleId:workItemDomId}),workitem=0==workitem.length&&"TIMER_MODE"!==mode?"":workitem,workItemObj.val(ZPeople.decodeTxt(workitem)))}var descTxt;if(null!==desc&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC))descTxt=0==(descTxt=jschData.desc).length?"":descTxt,"TIMER_MODE"===mode?(descLayout=Layout.Page.container.find("#timerDesc"),Timetracker.timelogs.registerDescViewPopup(descTxt),descLayout.val(ZPeople.decodeTxt(descTxt)),Layout.Page.container.find("#timerDescIcon").data("timerDesc",descTxt),descLayout.prop("disabled",!0)):(Layout.Page.container.find("textarea[name='Description']").val(ZPeople.decodeTxt(descTxt)),Layout.Page.container.find("textarea[name=Description]").addClass("disabled"));if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&-1!=billableStatus){var stVal="0";if(1!==billableStatus&&"1"!==billableStatus||(stVal="1"),"TIMER_MODE"===mode){billStLayout=Layout.Page.container.find("#timerbill");1===billableStatus||"1"===billableStatus?TimelyZComp.select.setValue(billStLayout,"1"):TimelyZComp.select.setValue(billStLayout,"0"),TimelyZComp.select.setAttributes(billStLayout,{disabled:!0})}else{billStLayout=Layout.Page.container.find("select[name=Billable_Status]");TimelyZComp.select.setValue(billStLayout,stVal),TimelyZComp.select.setAttributes(billStLayout,{disabled:!0})}}else{billStLayout=Layout.Page.container.find("#timerbill");TimelyZComp.select.setAttributes(billStLayout,{disabled:!1})}}else"FORM_EDIT_MODE"===mode&&(Layout.Page.container.find("select[name=Billable_Status]").prop("disabled",!0),Layout.Page.container.find("textarea[name=Description]").prop("disabled",!0),Layout.Page.container.find("select[name=Billable_Status]").closest(".zpl_secn").addClass("zpl_rlds"),Layout.Page.container.find("textarea[name=Description]").addClass("disabled"))},constructJschinTLForm:function(inpFldValuesObj){var tlWorkDate=null,jobId=null,layout=void 0!=ZP5Form.getFormClassObj()?ZP5Form.getLayout():Layout.Page.container,formMode=null!=inpFldValuesObj&&void 0!==inpFldValuesObj&&inpFldValuesObj.hasOwnProperty("formMode")?inpFldValuesObj.formMode:null;if("FORM_VIEW_MODE"===formMode)tlWorkDate=inpFldValuesObj.workDate,jobId=inpFldValuesObj.jobId;else{var inpDate=TimelyZComp.dateField.getValue(layout.find("input[name=Date]")),workDate=Calendar.parseDate(inpDate,uidateFormat);tlWorkDate=Timetracker.DateTime.getDateinDBformat(workDate);var jobInput=layout.find("input[name=JobId]");jobId=ZPeopleComponents.isComponent(jobInput)?TimelyZComp.select.getValue(jobInput):jobInput.val()}var erecNo=Timetracker.timelogs.tserecno;if("0"===jobId||void 0==jobId||null==jobId){var schDtlDiv=layout.find("#tlJschViewLst");0!==schDtlDiv.length&&schDtlDiv.remove()}else{var params={mode:"getJobSchedule",fetchTLJobschDtls:!0,conreqcsr:csrfToken,fromDate:tlWorkDate,toDate:tlWorkDate,users:erecNo,jobId:jobId};ZPeople.Request.send(Timetracker.constants.URL,params,function(resultData){var schDtlDiv=Layout.Page.container.find("#tlJschViewLst");if(0!==schDtlDiv.length&&schDtlDiv.remove(),null!=resultData&&0!=Object.keys(resultData).length){var userJschArr=resultData.hasOwnProperty("usersList")?resultData.usersList:null;if(null!=userJschArr&&0!=userJschArr.length&&userJschArr[0].hasOwnProperty("jobschArr")){var jschArr=userJschArr[0].jobschArr;if(0!=jschArr.length){var jschObj=jschArr[0],cstmFldValObj=jschObj.hasOwnProperty("customFieldDetails")?jschObj.customFieldDetails:void 0,def_cstmFields=Timetracker.jobSchedule.getCustomFields();if(void 0!==def_cstmFields){var allowedFileds=Timetracker.jobSchedule.Form.fetchAllAllowedFields(erecNo,Timetracker.constants.VIEW,def_cstmFields);if(!allowedFileds||0==allowedFileds.length)return;for(var jTxt='<div class="zpl_dfcrd zpl_lvecrd" id="tlJschViewLst"><div><b>'+ZPI18N.getString("zp.schedule")+'</b><table class="wd100_per zpl_itbl"><tbody>',itr=0;itr<def_cstmFields.length;itr++){var cstmFldObj=def_cstmFields[itr],key=cstmFldObj.labelName;if(allowedFileds.includes(key)){var value="-";void 0!=cstmFldValObj&cstmFldValObj.hasOwnProperty(key)&&(value=cstmFldValObj[key]),jTxt+="<tr><td><em>"+cstmFldObj.displayName+"</em></td><td><span>"+value+"</span></td></tr>"}}jTxt+="</tbody></table></div></div>",layout.find(".zpl_rgtcnt").append(jTxt),layout.find(".zpl_rgtcnt").addClass("zpl_flexgap3"),Timetracker.jobSchedule.timelogsView.setValuesInTimerBand(jschObj,!1,{mode:formMode})}}}}})}},eventHandlingsJobSchDtls:function(mode,viewId,otherDtls){if("JSCH_DTL_VIEW"!==mode&&"JSCH_BRIEF_LIST"!==mode&&"EXP_CLS"!==mode||Layout.Page.container.find("#tt_jobsch_brief_div").find('[name="jobSchedule"]').hasClass("zpl_act")&&Layout.Page.container.find("#main_jsch_dtl_id").removeClass("zpl_DNI"),"JSCH_DTL_VIEW"===mode)Layout.Page.container.find("#main_jsch_dtl_id").removeClass("zpl_DNI"),Layout.Page.container.find("#jsch_dtl_div").removeClass("zpl_DNI"),Layout.Page.container.find("#exp_id").addClass("opn");else if("JSCH_BRIEF_LIST"===mode)Layout.Page.container.find("#tt_jobsch_brief_div").removeClass("zpl_DNI"),Layout.Page.container.find("#main_jsch_dtl_id").addClass("zpl_DNI");else if("EXP_CLS"===mode)Layout.Page.container.find("#exp_id").off("click").on("click",function(e){$(this).toggleClass("opn"),Layout.Page.container.find("#jsch_dtl_div").toggleClass("zpl_DNI")});else if("BACK_JSCH_BREIF_LIST"===mode){var data=TimelyZComp.select.getValue(Layout.Page.container.find("#timerjobs"));if(void 0==data||"0"===data)Layout.Page.container.find("#main_jsch_dtl_id").addClass("zpl_DNI"),Timetracker.timelogs.resetDescModal();else{var hideField=!0;$.each(Timetracker.jobSchedule.timelogsView.JOBSCHEDULE_DETAILS_PRESENTDATE,function(ind,jschDtl){if(jschDtl.jobId==data)return hideField=!1,!1}),hideField&&(Timetracker.timelogs.resetDescModal(),Layout.Page.container.find("#main_jsch_dtl_id").addClass("zpl_DNI"))}}else if("CLR_ALL"===mode)Layout.Page.container.find("#tt_jobsch_brief_div").addClass("zpl_DNI"),Layout.Page.container.find("#main_jsch_dtl_id").addClass("zpl_DNI");else if("FREEZE_OTHER_JSCH"===mode){if(otherDtls.hasOwnProperty("runningJobId")){var runningJobId=otherDtls.runningJobId;Layout.Page.container.find("#jsch_brief_divs").addClass("disabled"),Layout.Page.container.find("div[jobid='"+runningJobId+"']").addClass("zpl_act")}}else"CLR_SEL_CLS"===mode&&(Layout.Page.container.find("#jsch_brief_divs").removeClass("disabled"),Layout.Page.container.find("#tt_jobsch_brief_div").find('[name="jobSchedule"]').removeClass("zpl_act"),Layout.Page.container.find("#main_jsch_dtl_id").addClass("zpl_DNI"))}};var Plugin=function(){"use strict";var matched,browser,configInfo,URL="timesheetDispAction.zp";function showLogsReportPage(){$("#logsReport").show(),$("#manualSync").hide()}function getInfo(){var param={mode:"getConfigInfo",pageType:"logs_page",conreqcsr:csrfToken};$.post(URL,param,function(result){result&&result.res&&showLogsPage(result.config_info)})}function showLogsPage(res){var logsHtml=getLogsHtml(res.logs);$("#logs1")[0].innerHTML=logsHtml,$("#vname").text(res.vendorname),$("#selectDay option").remove();var logFiles=res.logsFiles?res.logsFiles.split(";"):new Array;$("#selectDay").append("<option></option>");for(var i=0;i<logFiles.length-1;i++)$("#selectDay").append("<option value='"+logFiles[i]+"'>"+logFiles[i]+"</option>");$("#selectDay").select2({placeholder:ZPI18N.getString("zp.today"),allowClear:!0}),res.isRunning?(res.nextSyncTimeInDate&&($("#nextupdate_time").html(res.nextSyncTimeInDate),$("#nextupdate_div").show()),$("#stopSync").show(),$("#resumeSync").hide(),$("#resumeSync2").hide()):($("#nextupdate_div").hide(),$("#stopSync").hide(),$("#resumeSync").show(),$("#resumeSync2").show())}function getLogsHtml(logs){var logsHtml="";return logs&&$.each(logs,function(index,log_str){var log=JSON.parse(log_str);logsHtml+="<tr><td></td><td>"+log.sync_date+"</td><td>"+log.from_date+"</td><td>"+log.to_date+"</td><td>"+log.total_count+"</td><td>"+(void 0!==log.success_count?log.success_count:"")+"</td></tr>"}),logsHtml}function hideConfigPage(){$("#dvmodal-lft").animate({right:"-75%"},400,function(){$(".dvmodal-overlay").fadeOut("fast")})}return jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}},browser={},(matched=jQuery.uaMatch(navigator.userAgent)).browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),jQuery.browser=browser,{URL:URL,onLoad:function(){$("#startTime").timeEntry({show24Hours:!0,spinnerImage:"",showSeconds:!0}),$("#cAuth").focus(function(){"cAuth"==$(this).val()&&$(this).val("")}),$("#cRef").focus(function(){"cRef"==$(this).val()&&$(this).val("")}),$("#cAuth").blur(function(){""==$(this).val()&&$(this).val("cAuth")}),$("#cRef").blur(function(){""==$(this).val()&&$(this).val("cRef")}),$(".inputs").focus(function(){$(this).css("border-color","#a0bed9")}),$(".inputs").blur(function(){$(this).css("border-color","#ddd")}),$("#selectDay").select2({placeholder:ZPI18N.getString("zp.today"),allowClear:!0}),$("#datetimepicker1").datetimepicker({format:"DD-MM-YYYY HH:mm:ss",icons:{up:"IC-ar-top",down:"IC-ar-dwn",previous:"IC-ar-lft",next:"IC-ar-rgt",time:"IC-timer",date:"IC-CL-02"}}),$("#datetimepicker2").datetimepicker({format:"DD-MM-YYYY HH:mm:ss",icons:{up:"IC-ar-top",down:"IC-ar-dwn",previous:"IC-ar-lft",next:"IC-ar-rgt",time:"IC-timer",date:"IC-CL-02"}}),$("#datetimepicker1").on("dp.change",function(e){$("#datetimepicker2").data("DateTimePicker").minDate(e.date)}),$("#datetimepicker2").on("dp.change",function(e){$("#datetimepicker1").data("DateTimePicker").maxDate(e.date)}),showLogsReportPage(),getInfo()},showLogsReportPage:showLogsReportPage,showManualSyncPage:function(){$("#logsReport").hide(),$("#manualSync").show(),$(".IC-CL-02").first().click()},getInfo:getInfo,getLogs:function(date){var param={mode:"getLogs",conreqcsr:csrfToken};null!=date&&""!=date.trim()?(param.date=date,$.post(URL,param,function(result){if(result||result.res){var res=result.logs_info;$("#logs1")[0].innerHTML=getLogsHtml(res.logsArr)}})):getInfo()},showLogsPage:showLogsPage,getLogsHtml:getLogsHtml,showConfigPage:function(res){var param={mode:"getConfigInfo",pageType:"config_page",conreqcsr:csrfToken};$.post(URL,param,function(result){if(result&&result.res){var res=result.config_info;configInfo=res,$("#cAuth").val(res.cAuth),$("#delay").val(res.sysDelay),$("#startTime").val(res.lastSyncTimeInDate?res.lastSyncTimeInDate:"00:00:00"),$("#sleepTime").val(res.sleepTime/6e4),$("#timeZone").val(res.timeZone),void 0!==res.cRef?$("#cRef").val(res.cRef):res.isRunning||$("#resumeSync2").hide(),$("#sleepTime,#delay").css("border-color","#ddd"),$(".dvmodal-overlay").fadeIn(200,function(){$("#dvmodal-lft").animate({right:"0"},400)})}})},hideConfigPage:hideConfigPage,saveStart:function(){var param={mode:"updateSyncConfig",conreqcsr:csrfToken};if(""!=$("#cAuth").val().trim())param.cAuth=$("#cAuth").val().trim();else if(""==$("#cAuth").val().trim())return void $("#cAuth").css("border-color","red");if(""!=$("#cRef").val().trim())param.cRef=$("#cRef").val().trim();else if(""==$("#cRef").val().trim())return void $("#cRef").css("border-color","red");if(""!=$("#sleepTime").val().trim())if(param.sleepTime=$("#sleepTime").val().trim(),isNaN(param.sleepTime)||-1!==param.sleepTime.indexOf("."))$("#sleepTime").css("border-color","red");else if(param.sleepTime<60||param.sleepTime>10080)$("#sleepTime").css("border-color","red");else{if(""!=$("#timeZone").val().trim())param.timeZone=$("#timeZone").val().trim();else if(""==$("#timeZone").val().trim())return void $("#timeZone").css("border-color","red");if(""!=$("#delay").val().trim())if(param.delay=$("#delay").val().trim(),isNaN(param.delay)||-1!==param.delay.indexOf("."))$("#delay").css("border-color","red");else if(param.delay<0||param.delay>15)$("#delay").css("border-color","red");else{var isChanged=!0;if("cAuth"===param.cAuth&&void 0!==configInfo&&param.cRef===configInfo.cRef&&parseInt(param.sleepTime)===configInfo.sleepTime/6e4&&param.timeZone===configInfo.timeZone&&parseInt(param.delay)===configInfo.sysDelay&&(isChanged=!1),isChanged){if(1==Object.keys(param).length)return;hideConfigPage(),$.post(URL,param,function(result){result&&result.res&&getInfo()})}else alert(ZPI18N.getString("zp.nochangesmade")),hideConfigPage()}else $("#delay").css("border-color","red")}else $("#sleepTime").css("border-color","red")},resume:function(){var param={mode:"resumeSync",conreqcsr:csrfToken};hideConfigPage(),$("#stopSync").show(),$("#resumeSync").hide(),$("#resumeSync2").hide(),$.post(URL,param,function(res){setTimeout(function(){getInfo()},3e3)})},stop:function stop(confirmed){if(!confirmed&&confirm("Do you really want to stop ?")){stop(!0);var param={mode:"stopSync",conreqcsr:csrfToken};$.post(URL,param,function(res){getInfo()})}},manualUpdate:function manualUpdate(flag,obj,confirmed){$(obj).attr("disabled","disabled"),$("#countButton").attr("disabled","disabled");var param={mode:"manualUpdate",conreqcsr:csrfToken};if(flag){if(confirmed||!confirm("This may result in creating duplicate entries if data is already uploaded for the given date range. Do you really want to upload ?"))return $(obj).removeAttr("disabled"),void $("#countButton").removeAttr("disabled");manualUpdate(flag,obj,!0),param.uploadRecord=flag}var fDate=$("#datetimepicker1 input").val().trim(),tDate=$("#datetimepicker2 input").val().trim();""!=fDate&&""!=tDate&&(param.fDate=fDate,param.tDate=tDate),$.post(URL,param,function(res){if(!res||!res.res){var errorCode=res.errorCode;if("FL_1001"===errorCode)return alert(ZPI18N.getString("zp.datewithindays",["5"])),$(obj).removeAttr("disabled"),void $("#countButton").removeAttr("disabled");if("FL_1002"===errorCode)return alert(ZPI18N.getString("zp.validdateerr")),$(obj).removeAttr("disabled"),void $("#countButton").removeAttr("disabled")}showLogsPage(res),$(obj).removeAttr("disabled"),$("#countButton").removeAttr("disabled")})}}}();