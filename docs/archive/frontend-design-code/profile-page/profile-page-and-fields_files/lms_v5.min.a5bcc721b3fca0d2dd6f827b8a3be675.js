var lmsbase={_refer:{},_init:!0,_contArr:[],_role:null,_userDForm:null,isUserHavingReportingTo:null,courseFormId:null,courseInfoFormId:null,moduleFormId:null,contentFormId:null,formIdData:null,sessionFormId:null,usersFormId:null,resourceFormId:null,memberFormId:null,testFormId:null,userTestFormId:null,assignMentFormId:null,userassignMentFormId:null,courseBatchId:null,tabName:null,_groups:[ZPI18N.getString("zp.lms.feedback.courses"),ZPI18N.getString("zp.lms.associatedcontent"),ZPI18N.getString("zp.lms.base.resources"),ZPI18N.getString("zp.lms.base.options")],_modules:[["dashboard","mycourses","catalog"],["calendar","notes","discussions","feedback"],["trainers","rooms","team"],["reports","approval","settings"]],_modHash:{admin:{welcome:!1,dashboard:!1,mycourses:!0,mydata:!0,catalog:!0,learningplan:!0,course:!0,calendar:!0,notes:!0,discussions:!1,feedback:!1,trainers:!0,rooms:!0,team:!0,reports:!1,approval:!0,settings:!0},trainer:{welcome:!1,dashboard:!1,mycourses:!0,mydata:!0,catalog:!0,learningplan:!0,course:!0,calendar:!0,notes:!0,discussions:!1,feedback:!1,trainers:!1,rooms:!1,team:!0,reports:!1,approval:!1,settings:!1},learner:{welcome:!1,dashboard:!1,mycourses:!0,mydata:!0,catalog:!0,learningplan:!0,course:!0,calendar:!0,notes:!0,discussions:!1,feedback:!1,trainers:!1,rooms:!1,team:!0,reports:!1,approval:!1,settings:!1}},_qmodHash:{admin:{addCourseInfo:!0,addModuleInfo:!0,addSessionInfo:!0,addContentInfo:!0,addEmbedLinkInfo:!0,addOfflineTestInfo:!0,addOnlineTestInfo:!0,addAssignmentInfo:!0,trainerinfo:!0,adddiscussion:!0,discussioninfo:!0,memberinfo:!0,userinfo:!0,addroom:!0,editroom:!0,roominfo:!0,editSessionInfo:!0,editContentInfo:!0,editModuleInfo:!0,editEmbedLinkInfo:!0,editAssignmentInfo:!0,editOfflineTestInfo:!0,editOnlineTestInfo:!0,feedbackinfo:!0,addEditableContentInfo:!0,editEditableContentInfo:!0},trainer:{addCourseInfo:!0,addModuleInfo:!0,addEmbedLinkInfo:!0,addSessionInfo:!0,addContentInfo:!0,addOfflineTestInfo:!0,addOnlineTestInfo:!0,addAssignmentInfo:!0,trainerinfo:!0,adddiscussion:!0,discussioninfo:!0,memberinfo:!0,editSessionInfo:!0,editContentInfo:!0,editModuleInfo:!0,editEmbedLinkInfo:!0,editAssignmentInfo:!0,editOfflineTestInfo:!0,editOnlineTestInfo:!0,feedbackinfo:!0,addEditableContentInfo:!0,editEditableContentInfo:!0},learner:{addCourseInfo:!0,trainerinfo:!0,adddiscussion:!0,discussioninfo:!0,memberinfo:!0,feedbackinfo:!0}},_mod:{welcome:[ZPI18N.getString("zp.lms.base.Welcome"),"lmswelcome","IC-app"],mycourses:[ZPI18N.getString("zp.lms.courses"),"lmscourses","IC-app"],mydata:[ZPI18N.getString("zp.lms.courses"),"lmscourses","IC-app"],catalog:[ZPI18N.getString("zp.lms.course.catalog"),"lmscourses","IC-app"],course:[ZPI18N.getString("zp.lms.base.CourseDetails"),"lmscoursedetails","IC-app"],learningplan:[ZPI18N.getString("zp.lms.learningplan"),"lmslearningplan","IC-app"],module:[ZPI18N.getString("zp.lms.base.ModuleDetails"),"lmsmodule","IC-app"],sessions:[ZPI18N.getString("zp.lms.base.Sessions"),"lmssessions","IC-addsec"],team:[ZPI18N.getString("zp.lms.base.MyTeam"),showNewTab?"lmsTeam":"lmsusers","IC-add-job"],calendar:[ZPI18N.getString("zp.lms.base.Calendar"),"lmscalendarheader","IC-PA-02"],feedback:[ZPI18N.getString("zp.lms.base.Feedback"),"lmsfeedback","IC-app17"],discussions:[ZPI18N.getString("zp.lms.base.Discussions"),"lmsmessages","IC-V-call",!0],reports:[ZPI18N.getString("zp.lms.base.Reports"),"lmsreports","IC-app21"],settings:[ZPI18N.getString("zp.lms.base.AccountSettings"),"lmssettings","IC-app30"],waitlist:[ZPI18N.getString("zp.lms.base.WaitList"),"lmsbatches","IC-app31"],approval:[ZPI18N.getString("zp.lms.base.PendingRequests"),"lmsapprovals","IC-app31"],reports:[ZPI18N.getString("zp.lms.base.CourseReports"),"lmsreports","IC-app21"]},_qmod:{addfeedback:["Add Feedback","lmsfeedback",1],feedbackinfo:["Feedback Info","SingleFeedback",1],trainerinfo:["Trainer Info","lmstrainers",1],adddiscussion:["Add Message","lmsmessages",1],discussioninfo:["View message","lmsmessages",1],memberinfo:["Members","lmscoursemembers",4],addCourseInfo:["Course Info","lmscourses",1],addSessionInfo:["Session Info","lmssessions",1],addOfflineTestInfo:["Test Info","lms_offline_test_ques_handler",4],addSessionInfo:["Session Info","lms_session_hash",4],editSessionInfo:["Session Info","lms_session_hash",4],addOnlineTestInfo:["Test Info","lms_online_test_ques_handler",4],addAssignmentInfo:["AssignMent Info","lms_assignment_hash",4],addModuleInfo:["Module Info","lms_module_hash",4],addContentInfo:["Content Info","lms_file_hash",4],addEmbedLinkInfo:["Embed Info","lms_link_hash",4],addroom:["Add Room","lmsrooms",1],courseInfo:["Course Info","lmsapproval",1],planInfo:["Plan Info","lmsapproval",1],editroom:["Edit Room","lmsrooms",1],roominfo:["Room Info","lmsrooms",1],editContentInfo:["Edit Content","lms_file_hash",4],editModuleInfo:["Edit Module","lms_module_hash",4],editEmbedLinkInfo:["Edit Link","lms_link_hash",4],editAssignmentInfo:["Edit Assignment","lms_assignment_hash",4],editOfflineTestInfo:["Edit Test","lms_offline_test_ques_handler",4],editOnlineTestInfo:["Edit Test","lms_online_test_ques_handler",4],addEditableContentInfo:["Content Info","lms_content_ques_handler",4],editEditableContentInfo:["Content Info","lms_content_ques_handler",4]},subTabs:{mydata:{courses:[ZPI18N.getString("zp.lms.courses"),"lmscourses","IC-app"],plans:[ZPI18N.getString("zp.lms.learningplans"),"lmsPlan","IC-app"],notes:[ZPI18N.getString("zp.lms.base.Notes"),"lmsnotes","IC-app"],assessment:[ZPI18N.getString("zp.lms.mark.Assesment"),"lmsTeam","IC-app"],skillset:[ZPI18N.getString("zp.lms.trainers.SkillSet"),"lmsTeam","IC-app"],competency:[ZPI18N.getString("zp.lms.learningcompetency"),"lmsTeam","IC-app"],default:"courses"},catalog:{courses:[ZPI18N.getString("zp.lms.courses"),"lmscourses","IC-app"],plans:[ZPI18N.getString("zp.lms.learningplans"),"lmsPlan","IC-app"],default:"courses"},team:{reportees:[ZPI18N.getString("zp.reportees"),"lmsTeam","IC-app"],courses:[ZPI18N.getString("zp.lms.trainers.Courses"),"lmsTeam","IC-app"],assessment:[ZPI18N.getString("zp.lms.mark.Assesment"),"lmsTeam","IC-app"],default:"teammates"}},initiate:function(){lmsbase._refer=this,lmsbase.initConstruct(),lmsbase.updateUserDForm(),lms.notifyHash?lmsbase.checkFormIdsAvailable(lmsbase.hashQuesInit):lms.notifyHash=!0},updateUserDForm:function(){lmsbase._userDForm=uidateFormat.replace("%d","dd").replace("%b","MMM").replace("%Y","yyyy").replace("%m","mm").replace("%y","yy")},isValid:function(e){var t=!1;return null!=e&&null!=e&&(t=!0),t},isAdmin:function(e,t){var s=!1;return(isadmin&&("1"==e&&lms.selfSettingData.isSelfAdmincreate||"2"==e&&lms.iltSettingData.isIltAdmincreate)||!isadmin&&lms.settingData[0].settingPermission.isDataAdmin||lmsbase.isValid(lmscoursedetails.currentCourseData)&&lmscoursedetails.currentCourseData[0].isCourseAdmin||lmsbase.isValid(lmscoursedetails.currentCourseData))&&(s=!0),s},isUsercanhaveBatches:function(e,t){var s=!1;if(""==t&&(t=lmscoursedetails.currentCourseData[0]),null!=t&&null!=t){var r=!1;1==t.isCourseAdmin&&(r=!0);var l=!1;t.courseOwnerId==erecno&&(l=!0),(isadmin||r||l||lms.settingData[0].settingPermission.isDataAdmin||t.iscourseTrainer||t.isSharedCourse)&&(s=!0)}return s},isUsercanhavePublish:function(e,t){var s=!1;if(""==t&&(t=lmscoursedetails.currentCourseData[0]),null!=t&&null!=t){var r=!1;1==t.isCourseAdmin&&(r=!0);var l=!1;t.courseOwnerId==erecno&&(l=!0),(isadmin||r||l||lms.settingData[0].settingPermission.isDataAdmin)&&(s=!0)}return s},isCourseAdmin:function(e,t,s){var r=!1;if(t||(t=lmscoursedetails.currentCourseData&&lmscoursedetails.currentCourseData[0]),t){var l=!1;1==t.isCourseAdmin&&(l=!0);var a=!1;t.courseOwnerId==erecno&&(a=!0),"join"==s?(l||a)&&(r=!0):(isadmin&&("1"==e&&lms.selfSettingData.isSelfAdmincreate||"2"==e&&lms.iltSettingData.isIltAdmincreate)||!isadmin&&lms.settingData[0].settingPermission.isDataAdmin||l||a)&&(r=!0)}return r},isUsercanAddModule:function(e,t,s){var r=!1;if(""==t&&(t=lmscoursedetails.currentCourseData),null!=t&&null!=t){var l=!1;1==t.isCourseAdmin&&(l=!0);var a=!1;t.courseOwnerId==erecno&&(a=!0),(l||a)&&(r=!0)}return r},isAddCourseEnable:function(){var e=!1;return(isadmin||lms.settingData[0].settingPermission.isDataAdmin||1==lms.role&&(lms.selfSettingData.isTrainerCanAdd||lms.iltSettingData.isTrainerCanAdd)||lms.settingData[0].savedConfigData.isUserCanAdd[0])&&(lms.selfSettingData.isSelfenable||lms.iltSettingData.isIltenable||lms.manualSettingData.isManualenable)&&(e=!0),(lms.settingData[0].savedConfigData.isUserCanAdd.hasOwnProperty("zp.lms.settings.courseType.ILT")&&lms.iltSettingData.isIltenable||lms.settingData[0].savedConfigData.isUserCanAdd.hasOwnProperty("zp.lms.settings.courseType.manuals")&&lms.manualSettingData.isManualenable||lms.settingData[0].savedConfigData.isUserCanAdd.hasOwnProperty("zp.lms.settings.courseType.self")&&lms.selfSettingData.isSelfenable)&&(e=!0),e},isAddLpEnabled:function(){return!(!(isadmin||lms.settingData[0].settingPermission.isDataAdmin||lms.settingData[0].savedConfigData.isUserCanAdd[0])||!lms.lpSettingData.isLpEnable)||!(!lms.settingData[0].savedConfigData.isUserCanAdd.hasOwnProperty("zp.lms.learningplan")||!lms.lpSettingData.isLpEnable)},isAddmemberallowed:function(e,t){var s=!1;if(null!=t&&null!=t){var r=!1;1==t.isCourseAdmin&&(r=!0);t.courseOwnerId==erecno&&!0}return(r||lms.settingData[0].settingPermission.isDataAdmin)&&(s=!0),isadmin&&(s=!0),r&&t.isCourseAdmincanenroll&&(s=!0),s},checkFormIdsAvailable:function(e){lmsbase.courseFormId?e():(lmsbase.getFormId(e),lmscourses.getComponentsTab())},hashQuesInit:function(){var e=lmsbase._refer,t=lmsbase._mod[e.module],s=lmsbase._contArr[1];if(s.className="zp_content","lmswelcome"==t[1]&&(s.className="zp_intro"),lmsbase.subTabs[e.module]){let s=lmsbase.subTabs[e.module],r=""!=e.hashObject.level1?s[e.hashObject.level1][1]:lms.changeHash("hash",e.module+"/"+s.default,"disable");window[r].initiate.call({mode:e.module==e.prevmodule?"update":"add",elem:showNewTab?e.container:lmsbase._contArr[1],invokeby:e.invokeby,module:"mydata"==e.module?"mycourses":e.module,cache:e.modulecache,hashObject:e.hashObject,hash:e.hash,tabObject:t[0],type:"hash"})}else window[t[1]].initiate.call({mode:e.module==e.prevmodule?"update":"add",elem:showNewTab?e.container:lmsbase._contArr[1],invokeby:e.invokeby,module:"mydata"==e.module?"mycourses":e.module,cache:e.modulecache,hashObject:e.hashObject,hash:e.hash,tabObject:t[0],type:"hash"});if(lmsbase.removeClass(e.container,"zpl_fltr_flt"),""!=e.popup){var r=lmsbase._qmod[e.popup];window[r[1]].initiate.call({mode:e.popup==e.prevpopup?"update":"add",type:"ques",elem:4==r[2]?lmsbase._contArr[0].parentNode:lmsbase.openQHash(),invokeby:e.invokeby,module:e.popup,cache:e.qmodulecache,hashObject:e.quesObject,hash:e.hash})}else if(""!=e.prevpopup){4==(r=lmsbase._qmod[e.prevpopup])[2]?window[r[1]].close.call({mode:"close",type:"ques",elem:lmsbase._contArr[0].parentNode,invokeby:e.invokeby,module:e.prevpopup,cache:e.qmodulecache,hashObject:e.quesObject,hash:e.hash}):lmsbase.removeQHash()}},initConstruct:function(){if(lmsbase._init){var e=this._refer.container;e.className.includes("training zp_Tshw")||(e.className+=" training zp_Tshw");lmsbase._refer;this._init=!1,this._contArr=[e.appendChild(document.createElement("div")),e.appendChild(document.createElement("div")),e.appendChild(document.createElement("div")),e.appendChild(document.createElement("div")),e.appendChild(document.createElement("div"))],this.addClass(lmsbase._contArr[0],"zp_Lpane"),this.addClass(lmsbase._contArr[1],"zp_content"),this.addClass(lmsbase._contArr[2],"zp_Rpane"),this.addClass(lmsbase._contArr[3],"zp_fpv training"),$(".zp_fpv").attr("id","lmsfpv"),this.addClass(lmsbase._contArr[4],"zp_pv training"),this.isMaskLayerConstructed()||this.createMaskLayer(),this.addListener(lmsbase._contArr[0],"mousedown",lmsbase.listener),lmstooltip.initiate({attrib:"data-ttip",name:"tip-name"})}},openQHash:function(e){var t=this._contArr[4];t.className="zp_pv training "+(2==e?"zp_hpv":3==e?"zp_qpv":""),t.innerHTML="";var s=t.appendChild(document.createElement("div"));return s.className="zp_pwrap zp_tab",this.addClass(this._refer.container,"zp_Pshw"),this.addListener(t,"mousedown",this.listenQHash),s},removeQHash:function(){lmsbase.removeClass(this._refer.container,"zp_Pshw");var e=this._contArr[4];this.removeListener(e,"click",this.listenQHash)},closeQHash:function(){var e=lms.ParseURI("hash",location.hash);lms.changeHash("hash",e.substring(e.indexOf("/")+1),"disable")},listenQHash:function(e){if(""!=lmsbase._refer.popup.trim()){var t=window[lmsbase._qmod[lmsbase._refer.popup][1]];t.clickAction&&t.clickAction.call({eve:e})}},constructMaskv5:function(e,t,s,r){return lmsbase.mask=$(Layout.Page.container).closest(".zpl_container")[0].appendChild(document.createElement("div")),lmsbase.mask.className="zpl_mdl zpl_mopen "+e,lmsbase.mask.setAttribute("id","lms_msk"),t&&lmsbase.addListener(document,"keyup",lmsbase.closeMaskOnKeyup),s&&(lmsbase.closeCallbackObj={callback:s,params:r||""}),lmsbase.mask},closeMaskv5:function(){lmsbase.mask&&(lmsbase.closeCallbackObj&&(lmsbase.closeCallbackObj.callback(lmsbase.closeCallbackObj.params),delete lmsbase.closeCallbackObj),lmsbase.mask.remove(),delete lmsbase.mask,lmsbase.removeListener(document,"keyup",lmsbase.closeMaskOnKeyup))},closeMaskOnKeyup:function(e){27==e.keyCode&&(lmsbase.closeMaskv5(),lmsbase.removeListener(document,"keyup",lmsbase.closeMaskOnKeyup))},createMaskLayer:function(){var e=document.body.appendChild(document.createElement("div"));e.className="zp_msk training",e.style.display="none",lmsbase._maskElement=e},showMaskLayer:function(){var e=this._maskElement;return e.style.display="",e},hideMaskLayer:function(){var e=this._maskElement;return e.style.display="none",e.innerHTML="",e},isMaskLayerConstructed:function(){return!!lmsbase._maskElement},close:function(){var e=lms.hash.prev.split("/")[2];e&&window[lmsbase.subTabs[this.module][e][1]].close?window[lmsbase.subTabs[this.module][e][1]].close.call():window[lmsbase._mod[this.module][1]].close&&window[lmsbase._mod[this.module][1]].close.call({updateCache:this.updateCache})},resize:function(){window[lmsbase._mod[lmsbase._refer.module][1]].resize&&window[lmsbase._mod[lmsbase._refer.module][1]].resize.call(),""!=lmsbase._refer.popup&&window[lmsbase._qmod[lmsbase._refer.popup][1]].resize&&window[lmsbase._qmod[lmsbase._refer.popup][1]].resize.call()},constructLHS:function(){for(var e=0,t=lmsbase._groups,s='<ul leftPane class="tab-pane active">';e<t.length;e++){for(var r="",l=0,a=lmsbase._modules[e];l<a.length;l++)lmsbase._modHash[lmsbase._role][a[l]]&&(_o=lmsbase._mod[a[l]],("settings"!=a[l]||"settings"==a[l]&&showNewTab)&&(r+="<li "+(lmsbase._refer.module==a[l]?'class="sel"':"")+' rel="'+a[l]+'"><a>'+_o[0]+"</a>"+(_o[3]?'<span class="zp_disnum" id="unreadCount">'+lmsmessages.messageCountView()+"</span>":"")+"</li>"));r&&(s+='<li><a class="groupTitle">'+t[e]+"</a><ul>"+r+"</ul></li>")}this._contArr[0].innerHTML=s+"</ul>"},isvalidMod:function(e){this._role;return this._role=0==lms.role?"admin":1==lms.role?"trainer":2==lms.role?"manager":"learner",this._modHash[this._role].welcome?"welcome"===e:Boolean(this._modHash[this._role][e])},isvalidQMod:function(e){return""==e||Boolean(this._qmodHash[this._role][e])},addRole:function(){this._role||(this._role=0==lms.role?"admin":1==lms.role?"trainer":2==lms.role?"manager":"learner")},getFormId:function(e){zplms.get("/lms/formids",null,(function(t){lmsbase.listOfFormIds(t[1]),e(),e=null}))},lmsinit:function(){lmssettings.getSettingsData(),lmswelcome.getWelcomePageData()},listOfFormIds:function(e){null!=e&&$.each(e,(function(e,t){"P_LMSCourse"===t.formName?lmsbase.courseFormId=t.formId:"P_LMSCourseInfo"===t.formName?lmsbase.courseInfoFormId=t.formId:"P_LMSModule"===t.formName?lmsbase.moduleFormId=t.formId:"P_TrainingProgram"===t.formName?lmsbase.programFormId=t.formId:"P_LMSTrainer"===t.formName?lmsbase.trainerFormId=t.formId:"P_TrainingCategory"===t.formName?lmsbase.categoryFormId=t.formId:"P_LMSFiles"===t.formName?lmsbase.contentFormId=t.formId:"P_LMSSession"===t.formName?lmsbase.sessionFormId=t.formId:"P_LMSRooms"===t.formName?lmsbase.roomFormId=t.formId:"P_LMSFiles"===t.formName?lmsbase.contentFormId=t.formId:"P_LMSEmbedLink"===t.formName?lmsbase.embedLinkFormId=t.formId:"P_LMSResources"===t.formName?lmsbase.resourceFormId=t.formId:"P_LMSCourseUsers"===t.formName?lmsbase.memberFormId=t.formId:"P_LMSTest"===t.formName?lmsbase.testFormId=t.formId:"P_LMSUserTest"===t.formName?lmsbase.userTestFormId=t.formId:"P_LMSAssignment"===t.formName?lmsbase.assignMentFormId=t.formId:"P_LMSUserAssignment"===t.formName?lmsbase.userassignMentFormId=t.formId:"P_LMSCourseBatches"===t.formName&&(lmsbase.courseBatchId=t.formId)}))},addClass:function(e,t){new RegExp("(^|\\s)"+t+"(\\s|$)","g").test(e.className)||(e.className=(e.className+" "+t).replace(/\s+/g," ").replace(/(^ | $)/g,""))},removeClass:function(e,t){var s=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(s,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")},hasClass:function(e,t){var s=new RegExp("(\\s|^)"+t+"(\\s|$)");return(void 0===e.className?window.event.srcElement:e).className.match(s)},addListener:function(e,t,s,r){e.addEventListener(t,s,!1)},removeListener:function(e,t,s,r){e.removeEventListener(t,s,!1)},getElem:new Function("a","return document.getElementById(a)"),show:function(e){e&&(e.style.display="")},hide:function(e){e&&(e.style.display="none")},listener:function(e){var t;if(t=(t=e.target||e.srcElement).closest("[rel]")){var s=t.getAttribute("rel");lms.changeHash("hash",s)}},setModuleAdminPermission:function(){lmsbase._modHash[this._role]=lmsbase._modHash.admin,lmsbase._qmodHash[this._role]=lmsbase._qmodHash.admin,lmsbase._modHash[this._role].settings=!1},reInitialiseModulePermission:function(){for(var e=arguments,t=e.length-1;t>0;t--)"admin"==e[t]?(lmsbase._modHash[e[t]]={welcome:!1,dashboard:!1,mycourses:!0,mydata:!0,catalog:!0,learningplan:!0,course:!0,calendar:!0,notes:!0,discussions:!1,feedback:!1,trainers:!0,rooms:!0,team:!0,reports:!1,approval:!0,settings:!0},lmsbase._qmodHash[e[t]]={addCourseInfo:!0,addModuleInfo:!0,addSessionInfo:!0,addContentInfo:!0,addEmbedLinkInfo:!0,addOfflineTestInfo:!0,addOnlineTestInfo:!0,addAssignmentInfo:!0,trainerinfo:!0,adddiscussion:!0,discussioninfo:!0,memberinfo:!0,userinfo:!0,addroom:!0,editroom:!0,roominfo:!0,editSessionInfo:!0,editAssignmentInfo:!0,editContentInfo:!0,editModuleInfo:!0,editEmbedLinkInfo:!0,editAssignMentInfo:!0,editOfflineTestInfo:!0,editOnlineTestInfo:!0,feedbackinfo:!0,addEditableContentInfo:!0,editEditableContentInfo:!0}):"trainer"==e[t]?(lmsbase._modHash[e[t]]={welcome:!1,dashboard:!1,mycourses:!0,mydata:!0,catalog:!0,learningplan:!0,course:!0,calendar:!0,notes:!0,discussions:!1,feedback:!1,trainers:!1,rooms:!1,team:!0,reports:!1,approval:!1,settings:!1},lmsbase._qmodHash[e[t]]={addCourseInfo:!0,addModuleInfo:!0,addEmbedLinkInfo:!0,addSessionInfo:!0,addContentInfo:!0,addOfflineTestInfo:!0,addOnlineTestInfo:!0,addAssignmentInfo:!0,trainerinfo:!0,adddiscussion:!0,discussioninfo:!0,memberinfo:!0,editSessionInfo:!0,editContentInfo:!0,editModuleInfo:!0,editEmbedLinkInfo:!0,editAssignmentInfo:!0,editOfflineTestInfo:!0,editOnlineTestInfo:!0,feedbackinfo:!0,addEditableContentInfo:!0,editEditableContentInfo:!0}):"learner"==e[t]&&(lmsbase._modHash[e[t]]={welcome:!1,dashboard:!1,mycourses:!0,mydata:!0,catalog:!0,learningplan:!0,course:!0,calendar:!0,notes:!0,discussions:!1,feedback:!1,trainers:!1,rooms:!1,team:!0,reports:!1,approval:!1,settings:!1},lmsbase._qmodHash[e[t]]={addCourseInfo:!0,trainerinfo:!0,adddiscussion:!0,discussioninfo:!0,memberinfo:location.hash.indexOf("managerview")>-1,feedbackinfo:!0})}};const lmsdocument={parseStringToDOMElement(e){let t=document.createDocumentFragment();lmsdocument.parser||(lmsdocument.parser=new DOMParser);let s=lmsdocument.parser.parseFromString(e,"text/html").body.childNodes;if(s.length>1){for(const e of s)t.appendChild(e.cloneNode(!0));return t}return s[0].cloneNode(!0)},createElement:function(e,t){let s=document.createElement(e);for(let e in t)"li"!=e&&t.hasOwnProperty(e)&&s.setAttribute(e,t[e]);return s},createElementNS:function(e,t,s){s=s||ZPI18N.getString("zp.assessment.svg.circle.namespace");let r=document.createElementNS(s,e);for(let e in t)"li"!=e&&t.hasOwnProperty(e)&&r.setAttribute(e,t[e]);return r},createListElement:function(e,t,s){let r=document.createElement("ul");for(let t in e)e.hasOwnProperty(t)&&r.setAttribute(t,e[t]);for(let e=0;e<t;e++)r.appendChild(this.createElement("li",s[e]));return r},getElementByAttributes:function(e,t){let s=[],r="",l=[];for(let t in e)if(e.hasOwnProperty(t)){for(r="["+t+'*="',l=e[t].split(" "),i=0;i<l.length;i++)r+=l[i],i!=l.length-1&&(r+=" ");r+='"]',s.push(r)}let a=s.join("");return t?t.querySelector(a):document.querySelector(a)},createSavingElement(){let e=`<div class="zpl_atosv"><div class="zpl_atocnt"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i><span>${ZPI18N.getString("zp.saving")}</span></div></div>`;return lmsdocument.parseStringToDOMElement(e)},createSavedElement(){let e=lmsdocument.createSavingElement();return e.querySelector("span").textContent=ZPI18N.getString("zp.saved"),e.querySelector(".zpl_atocnt").classList.add("svd"),e},createInsertFieldButton(){let e=`<b title="${ZPI18N.getString("zp.lms.editor.insertField")}"><span class="PI_addlist"></span><span class="zei-arrow " style="float: right; "></span></b>`;return lmsdocument.parseStringToDOMElement(e)},createErrorElement:e=>lmsdocument.parseStringToDOMElement(`<span class="ztextbox--error__label">${e}</span>`),isNotEmpty:function(e){return null!=e&&null!=e&&""!=e},DOMToStringParser:function(e){return e.outerHTML}};var lmsnotify={_elem:null,_callback:null,show:function(e){this._elem&&this.close();var t=e.header||"Are you sure ?",s=e.body||"",r=e.button_text||"Ok",l=document.body.appendChild(document.createElement("div"));l.className="zp_msk training",l.innerHTML='<div class="zp_trCnfCnt'+(e.texttype&&"positive"==e.texttype?" zp_sucs":"")+'"><div class="zp_trCnfIn"><h2>'+t+'</h2><div class="zp_trCnfdta"><p>'+s+'</p></div><div class="zp_trCnfBtm"><div class="zp_btn"><button class="zpactn" _rel="cancel">'+(e.cancel_button_text||ZPI18N.getString("zp.cancel"))+'</button><button class="zpthm" _rel="save">'+r+"</button></div></div></div></div>",this._elem=l,this._succcallback=e.successCallback,this._cancelcallback=e.cancelCallback,lmsbase.addListener(l,"mousedown",lmsnotify.clickevent),lmsbase.addListener(document,"keyup",lmsnotify._keyup,!1)},_keyup:function(e){var t=e.which||e.keyCode||e.charCode;27==t?(lmsnotify._cancelcallback&&lmsnotify._cancelcallback.call({status:!1}),lmsnotify.close()):13==t&&(lmsnotify._succcallback.call({status:!0}),lmsnotify.close())},close:function(){var e=this._elem;document.body.removeChild(e),lmsbase.removeListener(e,"mousedown",lmsnotify.clickevent),lmsbase.removeListener(document,"keyup",lmsnotify._keyup,!1),this._elem=null,this._succcallback=null,this._cancelcallback=null},clickevent:function(e){var t=e.target||e.srcElement;"button"==t.tagName.toLowerCase()&&("save"==t.getAttribute("_rel")?lmsnotify._succcallback.call({status:!0}):"cancel"==t.getAttribute("_rel")&&lmsnotify._cancelcallback&&lmsnotify._cancelcallback.call({status:!1}),lmsnotify.close())}},lms_cards=function(){function e(){this.title_parent_node,this.buttons_parent_node,this.options_parent_node,this.tabs_parent_node,this.content_parent_node,this.tabNodes=[],this.contentNodes=[],this.node,this.event_manager=new zplms.EventManager,this.currentTabIndex,this.initParentNodes()}function t(e){this.getTitleContainer=function(){return e.getTitleContainer()},this.addButton=function(){return e.addButton()},this.addOption=function(){return e.addOption()},this.addTab=function(){return e.addTab()},this.getTitleContainer=function(){return e.getTitleContainer()},this.getContentContainer=function(){return e.getContentContainer()},this.getOptionsContainer=function(){return e.getOptionsContainer()},this.getTabsContainer=function(){return e.getTabsContainer()},this.getTabNode=function(t){return e.getTabNode(t)},this.getContentNode=function(t){return e.getContentNode(t)},this.toNode=function(){return e.toNode()},this.switchTab=function(t){return e.switchTabUsingIndex(t)},this.on=function(t,s){return e.on(t,s)},this.getCurrentTabIndex=function(){return e.getCurrentTabIndex()}}return e.prototype.initParentNodes=function(){var e=document.createElement("div");e.className="zp_nhdr",this.setTitleContainer(e);var t=document.createElement("div");t.className="zp_btn",this.setButtonsContainer(t),this.setOptionsContainer(document.createElement("ul")),this.setTabsContainer(document.createElement("ul"));var s=document.createElement("div");s.className="zp_nlft",this.setContentContainer(s)},e.prototype.addButton=function(e){var t=document.createElement("button");return t.className="zpthm",this.buttons_parent_node.appendChild(t),t},e.prototype.addOption=function(e){var t=document.createElement("li");return this.options_parent_node.appendChild(t),t},e.prototype.addTab=function(){var e=document.createElement("li");this.tabs_parent_node.appendChild(e),this.tabNodes.push(e);var t=document.createElement("div");return t.className="zp_setcnt zp_dyn",this.content_parent_node.appendChild(t),this.contentNodes.push(t),e},e.prototype.setTitleContainer=function(e){this.title_parent_node=e},e.prototype.setButtonsContainer=function(e){this.buttons_parent_node=e},e.prototype.setOptionsContainer=function(e){this.options_parent_node=e},e.prototype.setContentContainer=function(e){this.content_parent_node=e},e.prototype.setTabsContainer=function(e){this.tabs_parent_node=e},e.prototype.getTitleContainer=function(){return this.title_parent_node},e.prototype.getOptionsContainer=function(){return this.options_parent_node},e.prototype.getButtonsContainer=function(){return this.buttons_parent_node},e.prototype.getTabsContainer=function(){return this.tabs_parent_node},e.prototype.getContentContainer=function(){return this.content_parent_node},e.prototype.getTabNode=function(e){return this.tabNodes[e]},e.prototype.getContentNode=function(e){return this.contentNodes[e]},e.prototype.toNode=function(){if(this.node)return this.node;var e=document.createElement("div");e.className="zp_fmsk";var t=e.appendChild(document.createElement("div"));t.className="zp_Npv";var s=t.appendChild(document.createElement("div"));s.className="zp_nwrap",s.appendChild(this.toHeaderNode()),s.appendChild(this.toBodyNode());for(var r=this,l=function(e){r.onTabClick(e)},a=this.tabNodes.length-1;a>=0;a--)lmsbase.addListener(this.tabNodes[a],"click",l);return this.node=e},e.prototype.onTabClick=function(e){var t=new zplms.Event("tab_switch",{currentTabIndex:this.getCurrentTabIndex(),tabIndex:this.getTabIndex(e.currentTarget)},{event:e}),s=this;this.event_manager.dispatchEvent(t,(function(e){s.switchTabUsingElement(e.currentTarget)}))},e.prototype.getTabIndex=function(e){for(var t=this.tabNodes.length-1;t>=0;t--)if(e==this.tabNodes[t])return t;throw"Illegal Argument : Element is not a Tab element"},e.prototype.switchTabUsingIndex=function(e){for(var t=this.tabNodes.length-1;t>=0;t--)t==e?(lmsbase.addClass(this.tabNodes[t],"sel"),lmsbase.removeClass(this.contentNodes[t],"zp_dyn"),this.currentTabIndex=t):(lmsbase.removeClass(this.tabNodes[t],"sel"),lmsbase.addClass(this.contentNodes[t],"zp_dyn"))},e.prototype.switchTabUsingElement=function(e){for(var t=this.tabNodes.length-1;t>=0;t--)e==this.tabNodes[t]?(lmsbase.addClass(this.tabNodes[t],"sel"),lmsbase.removeClass(this.contentNodes[t],"zp_dyn"),this.currentTabIndex=t):(lmsbase.removeClass(this.tabNodes[t],"sel"),lmsbase.addClass(this.contentNodes[t],"zp_dyn"))},e.prototype.getCurrentTabIndex=function(){return this.currentTabIndex},e.prototype.toHeaderNode=function(){var e=document.createElement("div");e.className="zp_npvhd",e.appendChild(this.title_parent_node);var t=e.appendChild(document.createElement("div"));return t.className="zp_micn",t.appendChild(this.buttons_parent_node),t.appendChild(this.options_parent_node),e.appendChild(t),e},e.prototype.toBodyNode=function(){var e=document.createElement("div");e.className="zp_ncnt";var t=e.appendChild(document.createElement("div"));return t.className="zp_nsplt",t.appendChild(this.content_parent_node),t.appendChild(this.toTabNode()),e},e.prototype.toTabNode=function(){var e=document.createElement("div");return e.className="zp_ntab",e.appendChild(this.tabs_parent_node),e},e.prototype.on=function(e,t){if("tab_switch"!==e)throw"Event type not supported";this.event_manager.addEventListener(e,t)},{createCard:function(){return new t(new e)}}}(),lmsTabs={subTabsObj:null,getThirdLevelNavBar:function(e,t){var s=document.querySelector("#tltabcontainer"),r="lms_"+t.module,l="mycourses"==t.module?"mydata":t.module;s.setAttribute("data-tab",r),s.setAttribute("class","zpl_tabpane"),$.each(e,(function(e,t){if("default"!=e){var r=$('<li rel="'+e+'"></li>'),a=$('<a href="#lms-'+lmsbase._role+"/"+l+"/"+e+'">'+t[0]+"</a>");r.append(a),s.appendChild(r[0])}})),lmsbase.hasClass(s,"DN")&&s.classList.remove("DN"),lmsbase.hasClass(s.parentElement,"zpl_noTpnvPrf")&&s.parentElement.classList.remove("zpl_noTpnvPrf")},initiate:function(e,t){lmsTabs.subTabsObj=e,lmsTabs.getThirdLevelTab(e,t)},getThirdLevelTab:function(e,t){lmsTabs.getThirdLevelNavBar(e,t),lmsbase.addListener(document.querySelector("[data-tab=lms_"+t.module+"]"),"click",lmsTabs.clickHandle,!1)},switchTab:function(e){if(!lmsbase.hasClass(e,"zpl_act")){var t=e.parentNode.querySelectorAll(".zpl_act");t.length&&Array.prototype.forEach.call(t,(function(e){lmsbase.removeClass(e,"zpl_act")})),lmsbase.addClass(e,"zpl_act")}},clickHandle:function(e){var t=e.target.closest("li");t.getAttribute("rel");lmsTabs.switchTab(t)}};const lmsPopUp=function(){function e(){let e,t,s,r,l,a={},n={};return e=document.createElement("div"),e.className="zpl_minr",{setHeader:function(s){t&&t.remove();let r=`<div class="zpl_mhder"><div><h4>${s||""}</h4></div><div>`;t=lmsdocument.parseStringToDOMElement(r),e.appendChild(t)},setBody:function(t){s&&s.remove(),s=document.createElement("div"),s.className="zpl_mcnt",e.appendChild(s),t&&s.appendChild(t)},setFooter:function(){r&&r.remove(),r=document.createElement("div"),r.className="zpl_mfoter",e.appendChild(r)},setButton:function(e,t){let s=document.createElement("button");s.className=e.class,s.textContent=e.text,s.setAttribute("order",e.order),n[e.type]=s,r.appendChild(s),lmsbase.addListener(s,"click",t),reOrderElements(r,"order",r.querySelectorAll("button"))},setIcon:function(e,s){if("close"===e.type)!function(e){l&&l.remove(),l=lmsdocument.parseStringToDOMElement(`<a class="_cls PI_cls" title="${ZPI18N.getString("zp.close")}"></a>`),lmsbase.addListener(l,"click",e),t.appendChild(l),a.close=l}(s);else{!function(){if(!t.querySelector(".zpl_mhderrgt")){let e=document.createElement("div");e.className="zpl_mhderrgt",t.appendChild(e),a.close&&t.lastChild!==a.close&&(t.removeChild(a.close),t.appendChild(a.close))}}();let r=lmsdocument.parseStringToDOMElement(`<i class="${e.class+" "+e.icon}" title="${e.title}"></i>`);lmsbase.addListener(r,"click",s),a[e.type]=r,t.querySelector(".zpl_mhderrgt").appendChild(r)}},getRoot:function(){return e},getHeader:function(){return t},getBody:function(){return s},getFooter:function(){return r},getButton:i,getIcon:o,removeIcon:function(e){a[e]&&(o(e).remove(),delete a[e])},removeButton:function(e){n[e]&&(i(e).remove(),delete n[e])}};function i(e){return n[e]}function o(e){return a[e]}}function t(t){let s,r,l=new e,a="";return{assemblePopUp:function(){s&&s.remove(),s=document.createElement("div"),s.className="zpl_mdl "+a,r&&s.classList.add(r),l.setHeader(t.header),l.setBody(t.elem),l.setFooter(),t.saveCallback&&l.setButton(lmsPopUp.BUTTONS.SAVE,t.saveCallback),t.cancelCallback&&l.setButton(lmsPopUp.BUTTONS.CANCEL,t.cancelCallback),t.previewCallback&&l.setButton(lmsPopUp.BUTTONS.PREVIEW,t.previewCallback),t.closeCallback&&l.setIcon(lmsPopUp.ICONS.CLOSE,t.closeCallback),t.editCallback&&l.setIcon(lmsPopUp.ICONS.EDIT,t.editCallback),t.resetCallback&&l.setIcon(lmsPopUp.ICONS.RESET,t.resetCallback)},setButton:function(e,t){l.setButton(e,t)},setIcon:function(e,t){l.setIcon(e,t)},setSize:function(e){r=e},setPosition:function(e){a=e},getPopUpRoot:n,getPopUpHeader:function(){return l.getHeader()},getPopUpBody:function(){return l.getBody()},getIcon:function(e){return l.getIcon(e)},getButton:function(e){return l.getButton(e)},showPopUp:function(){s.classList.add("zpl_mopen"),s&&!settingsPage.container[0].contains(s)&&(settingsPage.container[0].appendChild(s),s.appendChild(n()))},removeIcon:function(e){l.removeIcon(e)},removeButton:function(e){l.removeButton(e)},hidePopUp:function(){s.classList.remove("zpl_mopen")},closePopUp:function(){s.remove(),n().remove()}};function n(){return l.getRoot()}}return{BUTTONS:Object.freeze({SAVE:Object.freeze({type:"save",class:"zlabel zlabel--blue zlabel--medium",text:ZPI18N.getString("zp.save"),order:1}),CANCEL:Object.freeze({type:"cancel",class:"zlabel zlabel--outline zlabel--medium",text:ZPI18N.getString("zp.cancel"),order:-1}),PREVIEW:Object.freeze({type:"preview",class:"zlabel zlabel--blue zlabel--outline zlabel--medium",text:ZPI18N.getString("zp.preview"),order:2})}),ICONS:Object.freeze({CLOSE:Object.freeze({type:"close",icon:"PI_cls",class:"_cls",title:ZPI18N.getString("zp.close")}),EDIT:Object.freeze({type:"edit",icon:"PI_edt",class:"zpl_ibg zpl_drpdwn-js",title:ZPI18N.getString("zp.edit")}),RESET:Object.freeze({type:"reset",icon:"PI_reset",class:"zpl_ibg zpl_drpdwn-js",title:ZPI18N.getString("zp.reset")})}),SIZE:Object.freeze({MEDIUM:"zpl_mmd"}),POSITION:Object.freeze({CENTER:"zpl_mcenter"}),createPopUp:e=>new t(e)}}(),lmsEmailEditor=function(){class e{constructor(e){this.id=(new Date).getTime(),this.mode=e,this.constructRoot(),this.COMPONENTS={}}constructRoot(){this.formRoot=document.createElement("form");let e=document.createElement("div");e.className="zpl_crd h100_per",this.baseRoot=document.createElement("div"),this.baseRoot.className="view"===this.mode?"zpl_crdcnt pnone":"zpl_crdcnt",this.formRoot.appendChild(e),e.appendChild(this.baseRoot)}setFrom(e){let t=`<div class="zpl_secn zpl_mailtmp"><div><label class="zpl_mtry">${ZPI18N.getString("zp.from")}</label></div><div><div class="zpl_idiv"><select id="${"from_"+this.id}" class="select-js" value="${e||""}" data-lazy-loading="true" data-width="100%"></select></div></div></div>`;this.fromContainer=lmsdocument.parseStringToDOMElement(t),this.baseRoot.appendChild(this.fromContainer)}setTo(){let e=`<div class="zpl_secn zpl_mailtmp"><div><label class="zpl_mtry">${ZPI18N.getString("zp.to")}</label></div><div><div class="zpl_idiv"><textarea id="${"to_"+this.id}"></textarea></div></div></div>`;this.toContainer=lmsdocument.parseStringToDOMElement(e),this.baseRoot.appendChild(this.toContainer)}setSubject(e){let t=`<div class="zpl_secn zpl_mailtmp"><div><label class="zpl_mtry">${ZPI18N.getString("zp.subject")}</label></div><div><input type="text" class="ztextbox" value="${e||""}"></div></div>`;this.subjectContainer=lmsdocument.parseStringToDOMElement(t),this.baseRoot.appendChild(this.subjectContainer)}setMessage(e){this.messageContainer&&this.messageContainer.remove();let t=`<div class="zpl_secn"><div><label class="zpl_mtry">${ZPI18N.getString("zp.message")}</label></div><div><div messageBox class="ztextbox hauto pauto"></div></div></div>`;this.messageContainer=lmsdocument.parseStringToDOMElement(t),this.messageBox=this.messageContainer.querySelector("[messageBox]"),this.messageBox.removeAttribute("messageBox"),e&&(this.messageBox.innerHTML=e),this.baseRoot.appendChild(this.messageContainer)}convertToEditor(e,t,s){this.messageContainer&&this.messageBox?(this.editorContainer=this.messageBox.parentElement,this.editorContainer.innerHTML=""):(this.editorContainer=document.createElement("div"),this.baseRoot.appendChild(this.editorContainer)),this.editor=lmseditormanager.initiate(this.editorContainer),this.editor.insertEditor(e,s,t)}initiateComponents(e){this.COMPONENTS["from_"+this.id]=ZPeopleComponents.select("#from_"+this.id,e&&e.from),this.COMPONENTS["to_"+this.id]=ZPeopleComponents.tokenfield("#to_"+this.id,e&&e.to)}}function t(t){let s=lmsPopUp.createPopUp(t),r=new e(t.type||"view");return{assembleEmailEditor:function(){s.assemblePopUp(),s.getPopUpBody().appendChild(r.formRoot),r.setFrom(t.from),r.setTo(t.to),r.setSubject(t.subject),r.setMessage(t.message)},initiateComponents:function(){r.initiateComponents(t.components)},changeToEditMode:function(){r.baseRoot.classList.remove("pnone"),r.messageContainer&&r.messageContainer.querySelector(".disabled")&&r.messageContainer.querySelector(".disabled").classList.remove(".disabled");r.mode="edit"},convertToEditor:function(e,t,s){r.convertToEditor(e,t,s)},getSubjectValue:l,getEditor:a,getZEditor:n,getZComponentInstance:i,getPopUp:function(){return s},showPopUp:function(){return s.showPopUp()},removeIcon:function(e){s.removeIcon(e)},removeButton:function(e){s.removeIcon(e)},addSubjectObserver:function(e){let t=r.subjectContainer.querySelector("input");Object.keys(e).forEach((s=>lmsbase.addListener(t,s,e[s])))},validate:function(){let e=!0;""===l().trim()?(o(r.subjectContainer.querySelector("input")),e=!1):c(r.subjectContainer.querySelector("input"));a()&&n()&&"<div><br></div>"===n().getContent().trim()?(o(r.editorContainer.querySelector('[_rel="editor_cont"]')),e=!1):c(r.editorContainer.querySelector('[_rel="editor_cont"]'));return e},close:function(){s.closePopUp(),i("from").destroy(),i("to").destroy()}};function l(){return r.subjectContainer.querySelector("input").value}function a(){return r.editor}function n(){return r.editor.rfr.zeEditor}function i(e){return r.COMPONENTS[e.toLowerCase()+"_"+r.id]}function o(e){e.parentElement.querySelector(".ztextbox--error__label")||(e.classList.add("ztextbox__error"),e.parentElement.appendChild(lmsdocument.createErrorElement(ZPI18N.getString("zp.lms.cannotbeempty"))))}function c(e){e.parentElement.querySelector(".ztextbox--error__label")&&(e.parentElement.querySelector(".ztextbox--error__label").remove(),e.classList.remove("ztextbox__error"))}}return{initiate:e=>new t(e)}}();var zplms={addClass:function(e,t){new RegExp("(^|\\s)"+t+"(\\s|$)","g").test(e.className)||(e.className=(e.className+" "+t).replace(/\s+/g," ").replace(/(^ | $)/g,""))},removeClass:function(e,t){var s=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(s,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")},addListener:document.addEventListener?function(e,t,s,r){e.addEventListener(t,s,Boolean(r))}:function(e,t,s){e.attachEvent("on"+t,s)},removeListener:document.removeEventListener?function(e,t,s,r){e.removeEventListener(t,s,Boolean(r))}:function(e,t,s){e.removeEventListener("on"+t,s)},getElem:new Function("a","return document.getElementById(a)"),prevDef:function(e){(e=e||event).stopPropagation?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1)},isEquivalent:function(e,t){var s=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(s.length!=r.length)return!1;for(var l=0;l<s.length;l++){var a=s[l];if(e[a]!==t[a])return!1}return!0},createSimpleCache:function(e,t){var s,r=0,l=[];return function(){var a=Array.prototype.pop.call(arguments),n=Array.prototype.pop.call(arguments);0==r?(Array.prototype.push.call(arguments,(function(e){try{t(e)?(r=3,s=e):r=0}catch(e){r=0}for(var a=l.length-1;a>=0;a--)l[a].callback(s,l[a].callbackObject);l=null})),e.apply(null,arguments),l.push({callback:n,callbackObject:a}),r=2):2==r?l.push({callback:n,callbackObject:a}):n(s,a)}},EventManager:function(){function e(){this.listeners={}}function t(e,t){window.setTimeout((function(){e._stopImmediatePropagation||!1===t(e)&&(e.returnValue=!1)}),0)}return e.prototype.addEventListener=function(e,t){var s=this.listeners[e];s||(s=this.listeners[e]=[]);for(var r=s.length-1;r>=0;r--)if(t==s[r])return;s.push(t)},e.prototype.removeEventListener=function(e,t){var s=this.listeners[e];if(s)for(var r=s.length-1;r>=0;r--)t==s[r]&&(s[r]=void 0)},e.prototype.removeAllEventListeners=function(e){this.listeners[e]=void 0},e.prototype.dispatchEvent=function(e,s){var r=this.listeners[e.type];if(r)for(var l=0,a=r.length;l<a;l++){var n=r[l];n&&t(e,n)}s&&window.setTimeout((function(){!e.defaultPrevented&&e.returnValue&&s(e)}),0)},e}(),Event:function(){function e(e,t,s){s=s||{},this.type=e,this.defaultPrevented=!1,this.returnValue=!0,this._stopImmediatePropagation=!1,this.details=t,s.event&&(this.currentTarget=event.currentTarget,this.target=event.target,this.timeStamp=event.timeStamp)}return e.prototype.preventDefault=function(){this.defaultPrevented=!0},e.prototype.stopImmediatePropagation=function(){this._stopImmediatePropagation=!0},e}(),isObjectEmpty:function(e){for(var t in e)return!1;return!0},doesObjectHaveValue:function(e,t){for(var s in e)if(e[s]==t)return!0;return!1},deepCheckObjects:function(e,t){if(zplms.isObjectEmpty(e))return zplms.isObjectEmpty(t);if(zplms.isObjectEmpty(t))return!1;if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;let s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(let l of s)if(!r.includes(l)||!zplms.deepCheckObjects(e[l],t[l]))return!1;return!0},isObjectsSame:function(e,t){if(zplms.isObjectEmpty(e))return zplms.isObjectEmpty(t);if(zplms.isObjectEmpty(t))return!1;for(var s in e)if(e[s]!==t[s])return!1;return!0},isNullOrUndefined:function(e){return null==e},formCacheCriteria:function(e){return e&&7e3==e.code},formatNumberForDisplaying:function(e){return Boolean(e%1)?e:Math.floor(e)},getUserDisplayName:function(e){var t=ZPeople.getUserDetailsById(e);return ZPeople.getUserDisplayName(t.fname,t.lname)},replaceWithClone:function(e){var t=e.cloneNode();return e.parentNode.replaceChild(t,e),t},addLoadingBar:function(e){e.appendChild(zplms.getLoadingBarElement())},removeLoadingBar:function(e){var t=e.querySelector("[loadbar]");t&&t.parentNode.removeChild(t)},hasLoadingBar:function(e){return Boolean(e.querySelector("[loadbar]"))},getLoadingBarElement:function(){var e=document.createElement("div");return e.className="ctable",e.setAttribute("_rel","loadbar"),e.setAttribute("loadbar",""),e.innerHTML='<div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div>',e},setupEventManager:function(e){var t=new zplms.EventManager;e.addListener=function(e,s){t.addEventListener(e,s)},e.removeListener=function(e,s){t.removeEventListener(e,s)},e.dispatchEvent=function(e){t.dispatchEvent(e)}},getUserDPNode:function(e,t,s){var r=e[s]||e.photoPath||e.thumb||e.userImage,l=document.createElement("div");if(!r||r.indexOf("userg_inactive.png")>-1||r.indexOf("user.png")>-1||r.indexOf("&fs=thumb")>-1){var a=e[t]||e.name||e.userName,n=a.length%10,i=a.match(/\b[a-z]/gi),o=((i=i||[])[0]||a.charAt(0))+(i[1]||a.charAt(1));l.className="ZP_photo pc"+n,l.textContent=zplms.encodeHTML(o)}else l.className="ZP_photo",l.innerHTML='<img src="'+r+'">';return l},get:function(e,t,s,r){zplms.ajax(e,t,"GET",s,r)},getAsync:function(e,t,s,r,l){zplms.ajax(e,t,"GET",s,r,l)},postAsync:function(e,t,s,r,l){zplms.ajax(e,t,"POST",s,r,l)},put:function(e,t,s,r){zplms.ajax(e,t,"PUT",s,r)},post:function(e,t,s,r){zplms.ajax(e,t,"POST",s,r)},patch:function(e,t,s,r){zplms.ajax(e,t,"PATCH",s,r)},delete:function(e,t,s,r){zplms.ajax(e,t,"DELETE",s,r)},ajax:function(e,t,s,r,l,a){$.ajax({url:e,data:t,method:s,success:r,async:a,error:l,headers:{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken}})},encodeHTML:function(e){return ZWAF.Encoder.encodeForHTML(e)},decodeIfEncoded:function(e){return isHTMLEncoded?ZPeople.decodeTxt(e):e},encodeIfDecoded:function(e){return isHTMLEncoded?e:zplms.encodeHTML(e)},fetchCourses:function(e,t,s,r,l){if(lmslearningplan.addedPlanDetails&&lmslearningplan.addedPlanDetails.planInfo&&lmslearningplan.addedPlanDetails.planInfo.planId&&"lpFetch"==s||"lpFetch"!=s){var a={method:"getCourseDetails",start:0,conreqcsr:csrfToken};if("lpFetch"==s){var n=2==l?event.target.getAttribute("rel").split("_")[1]:0,i=0==l||4==l||2==l?lmslearningplan.addedPlanDetails.addedCourse:1==l?lmslearningplan.addedPlanDetails.lockedCourses:{};if(1!=l||(i[event.target.closest('[class="zp_popup"]').getAttribute("rel").split("_")[1]]=event.target.closest('[class="zp_popup"]').getAttribute("rel").split("_")[1]),2==l)document.getElementById("level_"+n).querySelectorAll("li").forEach((function(e){i[e.getAttribute("id").split("_")[1]]=e.getAttribute("id").split("_")[1]}));var o={};a.planId=lmslearningplan.addedPlanDetails.planInfo.planId,a.courseFor=1==l?"learningPlanLockNotIn":"learningPlanNotIn",i&&!isEmpty(i)&&(Object.keys(i).forEach((function(e){o[e]=e})),a.planCourseIds=JSON.stringify(o))}else"lpFetch"!=s&&(a.courseFor="onBoarding",a.coursetype=t);r&&(a.searchtxt=r),1==l||3==l?$.post("/courseAction.zp",a,e):$.post("/courseAction.zp",a,(function(a){0==a[1].length&&1==l?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.NodatacourseCatalog")):(isSearchCallback=!(4!=l&&!r),lmslearningplan.constructCoursesPopup(a[1],isSearchCallback,2==l,n,s,e,t),!isSearchCallback&&isEmpty(lmslearningplan.selectedCourses)&&(lmslearningplan.menuObj=lmsgroupmenu.initiate(document.getElementById("coursePopup"))))}))}},msToDHM(e){let t=86400,s=3600,r=60,l="",a=Math.floor(Number(e)/1e3);return t=Math.floor(a/t),a-=24*t*3600,s=Math.floor(a/s),a-=3600*s,r=Math.floor(a/r),l=t>0?t+" "+(t>1?ZPI18N.getString("zp.lms.days.small"):ZPI18N.getString("zp.day")):s>0?s+" "+(s>1?ZPI18N.getString("zp.leavetype.hour.plural"):ZPI18N.getString("zp.leavetype.hour.singular")):r>0?r+" "+(r>1?ZPI18N.getString("zp.lms.mins"):ZPI18N.getString("zp.smin")):parseInt(a)+" "+ZPI18N.getString("zp.lms.seconds"),l},msToMins:function(e){let t=60,s=Math.floor(Number(e)/1e3);return t=Math.floor(s/t),t+" "+(t>1?ZPI18N.getString("zp.lms.mins"):ZPI18N.getString("zp.smin"))},milliSecToDaysHours:function(e,t){let s=86400,r=3600,l=60,a="";return e=Number(e)/1e3,s=parseInt(e/s),e-=24*s*3600,r=parseInt(e/r),e-=3600*r,l=parseInt(e/l),a=s>0?s+" "+(s>1?ZPI18N.getString("zp.lms.days.small"):ZPI18N.getString("zp.day")):r>0?r+" "+(r>1?ZPI18N.getString("zp.leavetype.hour.plural"):ZPI18N.getString("zp.leavetype.hour.singular")):l>0?l+" "+(l>1?ZPI18N.getString("zp.lms.mins"):ZPI18N.getString("zp.smin")):parseInt(e)+" "+ZPI18N.getString("zp.lms.seconds"),a},createDebounce:function(e,t){let s;return function(...r){clearTimeout(s),s=setTimeout((()=>{e.apply(this,r)}),t)}}};String.prototype.trim||(String.prototype.trim=function(){var e=this;return e=(e=e.replace(/^\s*(.*)/,"$1")).replace(/(.*?)\s*$/,"$1")}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),Date_Time_Format={DATE_TIME:function(e){if(null!=e){var t=new Date;e=this.convertToTimezone(e),t.setTime(e);var s=t.getUTCFullYear(),r=t.getUTCMonth(),l=t.getUTCDate(),a=new Date;a.setTime(this.convertToTimezone(a.getTime()));var n=a.getUTCFullYear(),i=a.getUTCDate(),o=a.getUTCMonth();a.setTime(a.setDate(a.getUTCDate()-1));var c,d,m=a.getUTCDate(),u=a.getUTCMonth();if(s===n)i===l&&r===o?d=ZPI18N.getString("zp.today"):m!==l||r!==o&&r!==u?(l<10&&(l="0"+l),d=l+" "+ZPDateTime.getMonth(r,"long")):d=ZPI18N.getString("zp.yesterday"),c=" "+d+" "+Date_Time_Format.getDisplayTime(t);else s!==n&&(c=Calendar.twoDig(l)+" "+ZPDateTime.getMonth(r,"long")+" "+s+" , "+Date_Time_Format.getDisplayTime(t));return c}},getDisplayTime:function(e){var t=e.getUTCHours(),s=e.getUTCMinutes(),r="";return"hh:mm a"===timeFormat&&(r="AM",t>=12?(t=t>12?t-12:t,r="PM"):0==t&&(t=12),t=t<10?"0"+t:t),0===s?s="00":s<10&&(s="0"+s),t+":"+s+" "+r},convertToTimezone:function(e,t){var s=new Date;return s.setTime(e),t=void 0!==t?t:ZPeople.TIME.userGMTString,e=s.getTime()+Number(t),!0!==ZPeople.TIME.useDaylightTime&&"true"!==ZPeople.TIME.useDaylightTime||!0!==ZPeople.TIME.inDaylightTime&&"true"!==ZPeople.TIME.inDaylightTime||(e+=Number(ZPeople.TIME.daylightTime)),e}},Date.MONTH_NAMES=new Array(["January","February","March","April","May","June","July","August","September","October","November","December"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),Date.WEEKS_DAYS=new Array(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["S","M","T","W","T","F","S"]),Date.prototype.getDateBy=function(e){var t=function(e){return(e<0||e>9?"":"0")+e};if(""!=e.trim()){e+="";var s="",r=0,l="",a="",n=this.getFullYear()+"",i=this.getMonth()+1,o=this.getDate(),c=this.getDay(),d={};for(d.YYYY=n,d.YY=n.substring(2,4),d.M=i,d.MM=t(i),d.MMMM=Date.MONTH_NAMES[0][i-1],d.MMM=Date.MONTH_NAMES[1][i-1],d.D=o,d.DD=t(o),d.E=Date.WEEKS_DAYS[1][c],d.EE=Date.WEEKS_DAYS[0][c];r<e.length;){for(l=e.charAt(r),a="";e.charAt(r)==l&&r<e.length;)a+=e.charAt(r++);null!=d[a.toUpperCase()]?s+=d[a.toUpperCase()]:s+=a}return s}},Date.prototype.diffTo=function(e,t){var s=new Date(e),r=Math.abs(s.getTime()-this.getTime());return"hours"==t?Math.floor(r/36e5):"minutes"==t?Math.floor(r/6e4):Math.floor(r/864e5)},Element.prototype.addStyle=function(e){if(e){for(var t in e)this.style[t]=e[t];return this}};var generateUniqueKey=function(){var e=0;return function(){return erecno+""+(new Date).getTime()+ ++e}}();function cloneObject(e){var t={};for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function reOrderElements(e,t,s){let r=Array.from(s||e.childNodes);r.sort(((e,s)=>{let l=e.getAttribute(t),a=s.getAttribute(t);return-1===parseInt(l)&&(l=r.length),-1===parseInt(a)&&(a=r.length),parseInt(l)-parseInt(a)})),r.forEach((t=>e.appendChild(t)))}function updateObj(e,t){Object.keys(t).forEach((s=>e[s]=t[s]))}const AppTimer=(()=>{class e{constructor(e,t,s,r=!1){if("number"!=typeof e||e<=0)throw new Error("Delay must be a positive number");if("function"!=typeof t)throw new Error("Callback must be a function");this._delay=e,this._callback=t,this._context=s,this._isRecurring=r,this.reset()}reset(){this._reInit(),this._cumulativeTime=0}_reInit(){this._clear(),this._startTime=null,this._runtime=0,this._remaining=this._delay,this._isRunning=!1,this._isTimerReset=!1}_clear(){this._timerId&&(clearTimeout(this._timerId),this._timerId=null)}start(){this._isRunning||(this._clear(),this._startTime=Date.now(),this._isRunning=!0,this._setTimeout())}_setTimeout(){this._timerId=setTimeout((()=>{this._run(),this._isRecurring?(this._reInit(),this.start()):this._isRunning=!1}),this._remaining)}pause(){if(this._isRunning){this._clear();const e=Math.max(0,Date.now()-this._startTime);this._runtime+=e,this._remaining-=e,this._isRunning=!1}}resume(){this._isRunning||(this._isTimerReset=!0,this.start())}checkout(){this._run()}_run(){const e=this._getTimeElapsed();this._cumulativeTime+=e,this._callback.call(this._context,{elapsedTime:e,cumulativeTime:this._cumulativeTime})}_getTimeElapsed(){return this._isTimerReset?this._startTime&&this._runtime>0?this._runtime+(Date.now()-this._startTime):0:this._startTime?Date.now()-this._startTime:0}}function t(t,s,r,l){const a=new e(t,s,r,l);return{start:()=>a.start(),pause:()=>a.pause(),resume:()=>a.resume(),reset:()=>a.reset(),checkout:()=>a.checkout(),isRunning:()=>a._isRunning}}return{createTimer:(e,s,r)=>t(e,s,r,!1),createInterval:(e,s,r)=>t(e,s,r,!0)}})(),lmsCache=function(){const e={};class t{constructor(){this.cache=e}generateUniqueKey(e,t){return JSON.stringify({action:t,params:e})}store(e,t,s){const r=this.generateUniqueKey(e,t);this.cache[r]=s}get(e,t){const s=this.generateUniqueKey(e,t);return this.cache[s]}has(e,t){const s=this.generateUniqueKey(e,t);return this.cache.hasOwnProperty(s)}invalidate(e,t){const s=this.generateUniqueKey(e,t);delete this.cache[s]}}return{create:function(){return new t}}}(),http=function(){const e=async(e,t,s,r,l)=>{let a,n;l&&l>5e3&&(a=new AbortController,n=a.signal,AppTimer.createTimer(l,(()=>a.abort())).start()),e=(e=>(e=>e.includes("images/")||e.includes(".js")||e.includes(".svg"))(e)||"null"==contextPath||"undefined"==contextPath||e.includes(`/${contextPath}/`)||e.startsWith("https://")?e.startsWith("/")||e.startsWith("https://")?e:`/${e}`:`/${contextPath}${e.startsWith("/")?"":"/"}${e}`)(e);const i=((e,t)=>{const s={"Content-Type":"application/json"};return"GET"!==e.toUpperCase()&&(s["X-ZCSRF-TOKEN"]=`${csrfParamName}=${csrfToken}`),MP.Extension.isTestEnvironment()&&(t["X-Is-Platform-Org"]=isPlatformOrg,t["X-Is-Test-Environment"]=isTestEnvironment,t["X-Pf-Ext-Id"]=pfExtId),new Headers({...s,...t})})(t,r),o=((e,t,s,r)=>{const l="GET"===e.toUpperCase(),a={method:e.toUpperCase(),headers:t,signal:r};return!l&&s&&(a.body=new URLSearchParams(s).toString(),t.set("Content-Type","application/x-www-form-urlencoded")),a})(t,i,s,n);"function"==typeof sandboxEventListeners&&sandboxEventListeners();const c="GET"===t.toUpperCase()?((e,t)=>{const s=new URLSearchParams(t).toString();return s?`${e}?${s}`:e})(e,s):e;return(async e=>{if(!e.ok){const t=await e.json();throw{status:e.status,statusText:e.statusText,message:t}}const t=e.headers.get("Content-Type")||"";return t.includes("application/json")?e.json():t.includes("text")?e.text():e.blob()})(await fetch(c,o))};return{get:(t,s={},r={},l)=>e(t,"GET",s,r,l),post:(t,s={},r={},l)=>e(t,"POST",s,r,l),put:(t,s={},r={},l)=>e(t,"PUT",s,r,l),patch:(t,s={},r={},l)=>e(t,"PATCH",s,r,l),delete:(t,s={},r={},l)=>e(t,"DELETE",s,r,l)}}(),lmsConstants={TAB_INDEX:{INACTIVE:-1,ACTIVE:0},ENTITY_TYPES:{FILE:0,LINK:1,MODULE:2,OFFLINE_TEST:3,ONLINE_TEST:4,ASSIGNMENT:5,SESSION:6},COURSE_TYPES:{SELF_PACED:"1",BLENDED:"2",E_MATERIAL:"3"}};deepFreeze(lmsConstants);const ENTITY_TYPE={FILE:{name:"files",idKey:"fileId",logo:"IC-Aimg",lockedEntityType:2},CONTENT:{name:"content",idKey:"fileId",logo:"IC-cnt3",lockedEntityType:1},LINK:{name:"embedLink",idKey:"linkId",logo:"IC-lnk",lockedEntityType:3},ASSIGNMENT:{name:"assignment",idKey:"assignId",logo:"IC-assignment",lockedEntityType:5},SESSION:{name:"session",idKey:"sessionId",logo:"IC-adit-his",lockedEntityType:4},ONLINE_TEST:{name:"onlineTest",idKey:"testId",logo:"IC-OT",lockedEntityType:7},OFFLINE_TEST:{name:"offlineTest",idKey:"testId",logo:"IC-CT",lockedEntityType:6},MODULE:{name:"module",idKey:"moduleId",logo:"IC-argt",lockedEntityType:8},SCORM:{name:"scorm",idKey:"scormId",logo:"IC-ei-scorm",lockedEntityType:9},getEntityByName:e=>Object.values(ENTITY_TYPE).find((t=>t.name===e)),getEntityByLockType:e=>Object.values(ENTITY_TYPE).find((t=>t.lockedEntityType===e))};deepFreeze(ENTITY_TYPE);const LOCK_TYPE={UNLOCKED:0,LOCK_UNTIL:1,ENTITY_COMPLETE:2,PRE_ENTITY:3};deepFreeze(LOCK_TYPE);const LMSROLE={COURSE_OWNER:"COURSEOWNER",COURSE_ADMIN:"COURSEADMIN",TRAINER:"TRAINER",LEARNER:"LEARNER"};deepFreeze(LMSROLE);const lmsFormConstants={I18NMAP:Object.freeze({"Self Paced Learning":"zp.lms.settings.SelfPaced","Blended Learning":"zp.lms.settings.InstructorLed","E-Material":"zp.lms.settings.DigitalDownloads",Days:"zp.lms.days",Minutes:"zp.lms.minutes",Hours:"zp.lms.hours","File Attachment":"zp.lms.assignment.attachFile","Text Submission":"zp.lms.assignment.inlinetext","No Submission":"zp.lms.assignment.noSubmission","Do Not Allow":"zp.lms.assignment.dontAllow",Allow:"zp.ttallow",Classroom:"zp.lms.classroom","E-learning":"zp.lms.elearning",WiFi:"zp.lms.rooms.wifi",Router:"zp.lms.rooms.router",Chairs:"zp.lms.rooms.chairs","Chairs with writing pad":"zp.lms.rooms.chairswithpad",Television:"zp.lms.rooms.tel",Projector:"zp.lms.rooms.projector",Phone:"zp.lms.rooms.phone","Headsets with microphone":"zp.lms.rooms.hphone",Speaker:"zp.lms.rooms.speaker",Monitor:"zp.lms.rooms.monitor",Laptop:"zp.lms.rooms.laptop",Notepad:"zp.lms.rooms.notepad",Pen:"zp.lms.rooms.pen",Pencil:"zp.lms.rooms.pencil","Bottled water":"zp.lms.rooms.water",Beverages:"zp.lms.rooms.beverages",Whiteboard:"zp.lms.rooms.whiteboard",Marker:"zp.lms.rooms.Marker","Learner marks entities as completed":"zp.lms.manualComplete","Learner accesses and fully views entities":"zp.lms.autoComplete","Learner either marks entities as completed or fully views them":"zp.lms.autoAndManualComplete","When trainer/course admin marks as complete":"zp.lms.trainer/courseadmincomplete","When all mandatory entities are completed":"zp.lms.manFile/sessioncomplete","Based on date":"zp.lms.basedondate","When the learner marks as complete":"zp.lms.learnermarkascomplet","When all mandatory entities are completed":"zp.lms.manFile/testcomplete","When the learner marks as complete":"zp.lms.learnermarkascomplet",Disallowed:"zp.lms.disallow",General:"zp.lms.category.name.general","Business Management":"zp.lms.category.name.business_management","IT & Software":"zp.lms.category.name.it_software","Personal development":"zp.lms.category.name.personal_development",Design:"zp.lms.category.name.design",Marketing:"zp.lms.category.name.marketing",Photography:"zp.lms.category.name.photography","Organization Policy":"zp.lms.category.name.organization_policy","Health & Fitness":"zp.lms.category.name.health_fitness","Programming & Development":"zp.lms.category.name.programming_development","Mobile & Development":"zp.lms.category.name.mobile_development",Workshops:"zp.lms.category.name.workshops",Games:"zp.lms.category.name.games","Customer Service":"zp.lms.category.name.customer_service",Safety:"zp.lms.category.name.saftey",Accounts:"zp.lms.category.name.accounts","Network & Security":"zp.lms.category.name.network_security","Human Resources":"zp.lms.category.name.human_resources",Sales:"zp.lms.category.name.sales",Languages:"zp.lms.category.name.languages"}),getValue:function(e){return null==this.I18NMAP[e]?lmsform.changetoI18N(e):lmsform.changetoI18N(this.I18NMAP[e])}};var lmstinymce={options:{theme:"inlite",inline:!0,plugins:"lists paste",selection_toolbar:"bold italic underline strikethrough | quicklink bullist numlist blockquote ",content_css:["http://fonts.googleapis.com/css?family=Lato:300,300i,400,400i","/newhr/js/tinymce/custom.css"],insert_toolbar:"none",paste_as_text:!0,formats:{removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,code,mark",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}],underline:{inline:"u",classes:"underline"}}},initiate:function(e){e&&"[object HTMLDivElement]"==Object.prototype.toString.call(e)&&(lmstinymce.options.target=e,"undefined"==typeof tinymce?(e.setAttribute("contenteditable",!0),e.focus()):tinymce.init(lmstinymce.options))},getcontent:function(){return"undefined"==typeof tinymce?lmstinymce.options.target.innerHTML:tinymce.activeEditor?tinymce.activeEditor.getContent():""},remove:function(){"undefined"==typeof tinymce?lmstinymce.options.target.setAttribute("contenteditable",!1):tinymce.activeEditor&&tinymce.activeEditor.remove()}},lmsfilter={viewObject:null,showClass:"zp_Fshw",listClass:"zp_sfltr",timerObj:null,create:function(e,t){if("add"==e||"addbar"==e)this.clearObject(!(!this.viewObject||t.target==this.viewObject.target)),this.viewObject=t,this.viewObject.events={_onchange:[],_onapply:[],_onclose:[],_onclear:[],_oninput:[]},this.viewObject.root=t.target.closest(".zp_content"),lmsbase.addClass(this.viewObject.root,this.showClass);else{if("clear"!=e||!lmsbase.hasClass(this.viewObject.root,this.showClass))return;(t=this.viewObject).selecteditems={srch:[],items:{}}}var s,r,l="",a=t.items,n=t.selecteditems?t.selecteditems:lmsfilter.getFltrObj(),i=n.items,o=n.srch;l+='<div class="zp_Lttl"><div class="zp_Lst"><div><div class="zp_Ldtl">'+ZPI18N.getString("zp.lms.content.filters")+'<span class="zp_lnk" _rel="clear">'+ZPI18N.getString("zp.clearAll")+'</span><i _rel="close" class="IC-cls"></i></div></div></div></div><div class="zp_Fscrl">',t.search&&(l+='<div class="zp_Sm"><div class="nobdr"><i class="IC-srch"></i><input placeholder='+ZPI18N.getString("zp.lms.search")+' type="text" _srch value="'+(o&&o[0]||"")+'"></div></div>');for(var c=0;c<a.length;c++)s=i[r=a[c].name]?i[r]:{},l+='<div class="zp_Sm"  type="'+(a[c].type?a[c].type:"select")+'" ><label>'+a[c].title+"</label>"+lmsmenu.getSelectElement(r,s,a[c].mode,null,a[c].emptyText,a[c].kind)+"</div>";return l+='</div><div class="zp_btn"><button class="zpthm zpn_btn" _rel="apply">'+ZPI18N.getString("zp.lms.content.apply")+'</button><button _rel="cancel" class="zpthm zpn_btn">'+ZPI18N.getString("zp.lms.cancel")+"</button></div>",t.target.innerHTML=l,"addbar"==e&&(lmsfilter.filterBar("add"),lmsbase.removeClass(lmsfilter.viewObject.root,lmsfilter.showClass)),this.timerObj=window.setInterval(lmsfilter.checkElemAvail,6e5),this},on:function(e,t){return"change"==e&&"function"==typeof t?this.viewObject.events._onchange.push(t):"apply"==e&&"function"==typeof t?this.viewObject.events._onapply.push(t):"close"==e&&"function"==typeof t?this.viewObject.events._onclose.push(t):"clear"==e&&"function"==typeof t?this.viewObject.events._onclear.push(t):"input"==e&&"function"==typeof t&&this.viewObject.events._oninput.push(t),this},bind:function(){var e=this.viewObject.target;lmsbase.addListener(e,"click",lmsfilter.handle)},menuAction:function(e,t){var s=t.getAttribute("_name"),r=lmsfilter.getObjNode(s);lmsmenu.initiate({elem:t.parentNode,type:"select",mode:r.mode,menulist:r.datalist,kind:r.kind,eve:e}).on("update",(function(){for(var e=lmsfilter.viewObject.items,t=this.elem.getAttribute("_name"),s=0;s<e.length;s++)if(e[s].name==t){e[s].datalist=this.options;break}})).on("input",(function(){var e=lmsfilter.viewObject.events._oninput,t=this;e.forEach((function(e){e.call(t)}))})).on("click",(function(){var e=lmsfilter.viewObject.notifyAction;if(e){this.fieldname=this.referObj.elem.querySelector("[_name]").getAttribute("_name"),e.call(this)}})).bind()},getObjNode:function(e){for(var t=lmsfilter.viewObject.items,s="",r=0;r<t.length;r++)if(t[r].name==e){s=t[r];break}return s},cleardata:function(e){("both"==e||"bar"==e)&&lmsfilter.filterBar("clear"),("both"==e||"card"==e)&&lmsfilter.create("clear"),lmsfilter.viewObject.events._onclear.forEach((function(e){e.call()}))},insertFilterItems:function(e){this.viewObject=null,this.filterBar("add",e)},filterBar:function(e){var t,s=lmsfilter.viewObject.root.querySelector(".zp_header"),r=s.querySelector(".zp_Tglst");"add"==e?(r||((r=s.appendChild(document.createElement("div"))).className="zp_Tglst",lmsbase.addListener(r,"mousedown",lmsfilter.handleFilterBar)),""!=(t=lmsfilter.constructFltrBar())?(lmsbase.addClass(s,lmsfilter.listClass),r.innerHTML=t):lmsbase.removeClass(s,lmsfilter.listClass)):"clear"==e&&r&&(lmsbase.removeClass(s,lmsfilter.listClass),r.parentNode.removeChild(r))},constructFltrBar:function(){var e="",t=lmsfilter.viewObject;if(t.search){var s=lmsfilter.viewObject.target.querySelector("[_srch]").value;e+=s?'<div _name="search"><div class="zp_Tg" data-value="searchtext">'+s.replace(/</g,"&lt;")+'<i class="IC-cls1"></i></div></div>':""}for(var r,l=t.target.querySelectorAll("[_type=select]"),a=0;a<l.length;a++)e+=""!=(r=lmsmenu.getSelectOptionsHtml(l[a])).trim()?'<div _name="'+l[a].getAttribute("_name")+'">'+r+"</div>":"";return e+=""!=e?'<span class="zp_link" _rel="clear">'+ZPI18N.getString("zp.clearAll")+"</span>":""},getFltrObj:function(){var e,t,s=lmsfilter.viewObject.root.querySelector(".zp_Tglst"),r=[],l={};s&&s.querySelectorAll("[_name]").forEach((function(s,a){if("search"==(e=s.getAttribute("_name")))""!=s.textContent&&r.push(s.textContent);else{var n;t=s.querySelectorAll(".zp_Tg");for(var i=0;i<t.length;i++){l[e]||(l[e]={});var o=(n=t[i]).querySelector("i");o=o?o?o.className:"":(o=n.querySelector("img"))?o.src:"",l[e][t[i].getAttribute("data-value")]=[(n.querySelector("em")||n).textContent,o]}}}));return{srch:r,items:l}},checkElemAvail:function(e){document.body.contains(lmsfilter.viewObject.target)||this.clearObject(!0)},clearObject:function(e){var t=lmsfilter.viewObject;if(e){var s=lmsfilter.viewObject.root.querySelector(".zp_Tglst");s&&lmsbase.removeListener(s,"mousedown",lmsfilter.handleFilterBar)}t&&(lmsfilter.timerObj&&window.clearInterval(lmsfilter.timerObj),lmsfilter.timerObj=null,t.target&&lmsbase.removeListener(t.target,"click",lmsfilter.handle),lmsfilter.viewObject=null)},getfiltereditems:function(){for(var e,t,s,r=this.viewObject.root.querySelector(".zp_Tglst").querySelectorAll("[_name]"),l={},a=0;a<r.length;a++)if("search"==(e=r[a].getAttribute("_name")))l.searchStr=r[a].textContent;else{t=r[a].querySelectorAll("[data-value]"),s=[];for(var n=0;n<t.length;n++)s.push(t[n].getAttribute("data-value"));l[e]=s}return l},delSelectitems:function(e,t,s){var r,l=lmsfilter.viewObject;if(l){if("card"==e||"both"==e)if("search"==t)r=l.target.querySelector("[_srch]").value="";else if(l.target){var a=l.target.querySelector("[_name="+t+"]"),n=a.querySelector("[data-text]");n&&"single"==n.getAttribute("_mode")?lmsmenu.delSelectItem(n,"single"):(r=a.querySelector("[data-value='"+s+"']"))&&lmsmenu.delSelectItem(r,"multi")}if("bar"==e||"both"==e){var i=l.root.querySelector(".zp_Tglst"),o=i.querySelector("[_name="+t+"]");o&&(o.removeChild(o.querySelector("[data-value='"+s+"']")),!o.querySelector("div")&&i.removeChild(o),i.querySelector("div")?lmsfilter.viewObject.events._onapply.forEach((function(e){e.call({filterObject:lmsfilter.getfiltereditems()})})):(this.filterBar("clear"),lmsfilter.viewObject.events._onclear.forEach((function(e){e.call()}))))}}},handle:function(e){lmsmenu.stopbubble(e);var t=e.target,s=t.getAttribute("_rel");if(/^font$/i.test(t.tagName)&&"IC-cls1"==t.className){var r=t.parentNode,l=r.getAttribute("data-value"),a=r.closest("[_name]").getAttribute("_name");lmsfilter.delSelectitems("card",a,l)}else if("close"==s||"cancel"==s)lmsbase.removeClass(lmsfilter.viewObject.root,lmsfilter.showClass),lmsfilter.viewObject.events._onclose.forEach((function(e){e.call()}));else if("apply"==s)lmsfilter.filterBar("add"),lmsbase.removeClass(lmsfilter.viewObject.root,lmsfilter.showClass),lmsfilter.viewObject.events._onapply.forEach((function(e){e.call({filterObject:lmsfilter.getfiltereditems()})}));else if("clear"==s)lmsfilter.cleardata("card");else{var n=t.closest("[_type=select]");n&&lmsfilter.menuAction(e,n)}},handleFilterBar:function(e){var t=e.target;if("clear"==t.getAttribute("_rel"))lmsfilter.cleardata("both");else if(/^(font|i)$/i.test(t.tagName)&&"IC-cls1"==t.className){var s=t.parentNode,r=s.getAttribute("data-value"),l=s.parentNode.getAttribute("_name");lmsfilter.delSelectitems("both",l,r)}}},lmstooltip={_attrib:null,_name:null,bleEL:null,docEl_hgt:document.documentElement.clientHeight,docEl_wid:document.documentElement.clientWidth,initiate:function(e){this._attrib=e.attrib,this._name=e.name,this.insertBleEL(),document.documentElement.addEventListener("mouseover",lmstooltip.showbubble,!1),document.documentElement.addEventListener("resize",lmstooltip.resize,!1)},insertBleEL:function(){var e=document.body.appendChild(document.createElement("div"));e.className="zp_tip",e.style.visibility="hidden",this.bleEL=e},showbubble:function(e){var t=lmstooltip.bleEL,s=lmstooltip._attrib,r=lmstooltip._name,l=e.target.closest("["+s+"]");if(t.removeAttribute(r),l){var a=l.getAttribute(s);if(a){t.textContent=a;var n=l.getAttribute(r);n&&t.setAttribute(r,n);var i=lmstooltip.getArrClass(l);t.style.visibility="visible",t.className="zp_tip pos "+i[0],t.style.top=i[1]+"px",t.style.left=i[2]+"px",window.setTimeout((function(){t.className="zp_tip "+i[0]}),10)}}else t.style.visibility="hidden",t.className="zp_tip"},updateBubble:function(e){var t=lmstooltip.bleEL,s=lmstooltip._attrib,r=lmstooltip._name,l=e.target.closest("["+s+"]");if(l.getAttribute(r)==t.getAttribute(r)&&l.hasAttribute(s)&&"visible"==t.style.visibility){var a=l.getAttribute(s);t.textContent=a}},getArrClass:function(e){var t=e.getBoundingClientRect(),s=lmstooltip.bleEL.getBoundingClientRect(),r=parseInt(t.width/2,10),l=parseInt(s.width/2,10)-r,a=parseInt(s.height/2,10)-parseInt(t.height/2,10);return lmstooltip.isBottom(t,s,r)?["tp",t.bottom+10,t.left-l]:lmstooltip.isLeft(t,s)?["rt",t.top-a,t.left-s.width-10]:lmstooltip.isRight(t,s)?["lt",t.top-a,t.right+10]:void 0},isBottom:function(e,t,s){return lmstooltip.docEl_hgt-e.bottom>t.height&&e.left>=s&&lmstooltip.docEl_wid-e.right>=s},isLeft:function(e,t){return e.left>t.width},isRight:function(e,t){return lmstooltip.docEl_wid-e.right>t.width},resize:function(){lmstooltip.docEl_hgt=document.documentElement.clientHeight,lmstooltip.docEl_wid=document.documentElement.clientWidth},remove:function(){var e=lmstooltip.bleEL;e.parentNode.removeChild(e),document.documentElement.removeEventListener("mouseover",lmstooltip.showbubble,!1),document.documentElement.removeEventListener("resize",lmstooltip.resize,!1),lmstooltip.bleEL=""}},dummylmsMenu={on:function(){return this},bind:function(){return this}},lmsmenu={tmp:{},cntr:0,initiate:function(e){return lmsmenu.tmp._robject&&lmsmenu.tmp._robject.elem&&e.elem==lmsmenu.tmp._robject.elem&&lmsmenu.tmp.menuElem&&"none"!=lmsmenu.tmp.menuElem.style.display?(this.hide("forced"),dummylmsMenu):(this.hide("forced"),"dropdown"==e.type?this.dropMenu(e):"select"==e.type&&"single"==e.mode?this.singleSelect(e):"select"==e.type&&"multi"==e.mode?this.multiSelect(e):"date"==e.type?this.datepicker(e):"daterange"==e.type?this.daterange(e):"time"==e.type?this.timepicker(e):"dropselect"==e.type?this.dropSelect(e):"")},on:function(e,t){return"click"==e&&"function"==typeof t?this.tmp._click.push(t):"update"==e&&"function"==typeof t?this.tmp._update.push(t):"input"==e&&"function"==typeof t?this.tmp._type.push(t):"close"==e&&"function"==typeof t&&this.tmp._close.push(t),this},bind:function(){var e=this.tmp,t=e.elem;if("time"==e._robject.type){var s=e._robject.elem;e.menuElem.addEventListener("mousedown",this.timeEvents.timclick,!1),s.addEventListener("input",this.timeEvents.inpAction,!1),s.addEventListener("keydown",this.timeEvents.kdAction,!1),s.addEventListener("blur",this.timeEvents.blrAction,!1),s.addEventListener("keypress",this.timeEvents.kpAction,!1),s.addEventListener("paste",this.timeEvents.psteAction,!1)}else"daterange"==e._robject.type?document.body.addEventListener("mousedown",this.daterangeEvents,!1):e.isbinding||(t.addEventListener("selectstart",this.stopbubble,!1),t.addEventListener("dragstart",this.stopbubble,!1),document.addEventListener("mousedown",this.hide,!1),document.addEventListener("scroll",this.hide,!1),document.addEventListener("mousewheel",this.hide,!1),document.addEventListener("wheel",this.hide,!1),window.addEventListener("resize",this.winrezie,!1),document.addEventListener("keyup",lmsmenu.events._keyup,!1),"date"!=this.tmp._robject.type&&(t.addEventListener("mousedown",this.events._mosdown,!1),document.addEventListener("keydown",lmsmenu.events._kypress,!1)),e._input&&e._input.addEventListener("focus",this.events._focus,!1),e.isbinding=!0)},hideTimeObj:function(){var e=this.tmp._robject.elem,t=lmsmenu.tmp.menuElem;t.removeEventListener("mousedown",lmsmenu.timeEvents.timclick,!1),e.removeEventListener("input",lmsmenu.timeEvents.inpAction,!1),e.removeEventListener("keydown",lmsmenu.timeEvents.kdAction,!1),e.removeEventListener("blur",lmsmenu.timeEvents.blrAction,!1),e.removeEventListener("keypress",lmsmenu.timeEvents.kpAction,!1),document.body.removeChild(t),this._menu=void 0,this.tmp={}},winrezie:function(){lmsmenu.hide()},stopHide:function(e){lmsmenu.tmp._robject.stopHide=e},hide:function(e,t){if(lmsmenu.tmp._robject&&lmsmenu.tmp._robject.stopHide)return!1;var s="object"==typeof e?"_mosevent":"string",r=!0;if(lmsmenu.tmp._robject&&"time"==lmsmenu.tmp._robject.type){var l=lmsmenu.tmp;l._robject.elem.value=l._inputVal,this.hideTimeObj()}else if(lmsmenu.tmp.elem){var a=lmsmenu.tmp,n=a._robject.elem,i=a.elem;if("_mosevent"==s){var o=e.target||e.srcElement;(o==n||n.contains(o)||o==i||i.contains(o))&&(r=!1)}else"string"==s&&"check"==e&&t&&t.elem==n&&(r=!1);if(r){if(i.removeEventListener("mousedown",lmsmenu.events._mosdown,!1),i.removeEventListener("selectstart",lmsmenu.stopbubble,!1),i.removeEventListener("dragstart",lmsmenu.stopbubble,!1),document.removeEventListener("mousedown",lmsmenu.hide,!1),document.removeEventListener("scroll",lmsmenu.hide,!1),document.removeEventListener("mousewheel",lmsmenu.hide,!1),window.removeEventListener("resize",lmsmenu.winrezie,!1),document.removeEventListener("keyup",lmsmenu.events._keyup,!1),/^(date|daterange)$/.test(a._robject.type)?(a.dpick.clearobj(),a.dpick.clearvar()):(i.removeEventListener("mousedown",lmsmenu.events._mosdown,!1),document.removeEventListener("keydown",lmsmenu.events._kypress,!1)),"dropdown"==a._robject.type&&zplms.removeClass(n,"zp_actv"),a._input){var c=a._input;c.removeEventListener("focus",lmsmenu.events._focus,!1),c.parentNode.removeChild(c),""==a._sdwdiv.innerHTML.trim()?lmsmenu.removeClass(a._sdwdiv,"ntxt"):lmsmenu.addClass(a._sdwdiv,"ntxt");var d=a._robject.elem;lmsmenu.removeClass(d,"bhd"),lmsmenu.removeClass(d,"thd")}if(a._span){var m=a._span;m.parentNode.removeChild(m)}i.parentNode.removeChild(i);var u=lmsmenu.tmp._close;for(var p in u)u[p].call();return lmsmenu.tmp={},!0}return!1}return!0},dropMenu:function(e){var t=0;let s=2==e.menutype?60:40;zplms.addClass(e.elem,"zp_actv");var r=document.body.appendChild(document.createElement("div"));r.innerHTML=e.htmlContent||function(s){for(var r='<div class="zpD_scrl"><ul _type="dropbox">',l=0;l<s.length;l++)for(var a in s[l])t++,e.menutype&&2==e.menutype?r+='<li _rel="'+a+'"><div _cont><div class="ZP_photo pc2"><img src="'+s[l][a][0]+'"></div>'+(s[l][a][1]?"<p>"+s[l][a][1]+"</p>":"")+(s[l][a][2]?"<em>"+s[l][a][2]+"</em>":"")+"</div></li>":r+='<li _rel="'+a+'">'+(s[l][a][1]&&""!=s[l][a][1]?'<font class="'+s[l][a][1]+'"></font>':"")+"<div _cont>"+s[l][a][0]+"</div></li>";return r+="</ul></div>"}(e.menulist),r.style.width=e.width,r.style.height=e.height?e.height:t*s+10+"px",r.style.maxHeight="300px",e.maxwidth&&(r.style.maxWidth=e.maxwidth),this.tmp.elem=r;var l=lmsmenu.getposition(e,!!e.arrowHead),a={position:"absolute",zIndex:"1000",width:e.width,left:l.left,top:l.top};e.maxwidth&&(a.maxWidth=e.maxwidth),this.addStyle(r,a);var n="zp_Am training";"sessionattnmenu"==e.elem.getAttribute("_rel")&&(n="zp_Am training attndicn zp_shw");var i=e.class||n;return e.arrowHead&&(i+=" "+l.arwCls),r.className=i,this.tmp._robject=e,this.tmp._click=[],this.tmp._update=[],this.tmp._type=[],this.tmp._close=[],this.tmp.selClass="zp_hvr",this.tmp.defsel=r.getElementsByTagName("li")[0],e.eve&&lmsmenu.stopbubble(e.eve),this},dropSelect:function(e){var t=document.body.appendChild(document.createElement("div"));t.className="zp_Am",t.setAttribute("tabIndex",-1);var s=t.appendChild(document.createElement("div"));s.setAttribute("_type","select"),s.className="zp_Sms thd",s.appendChild(document.createElement("p"));var r=s.appendChild(document.createElement("input"));r.setAttribute("autocomplete","off"),r.setAttribute("required","true"),r.tabIndex=0;var l=s.appendChild(document.createElement("div"));l.setAttribute("data-text","select"),l.setAttribute("_mode","single"),l.className="zp_Tglst";var a=t.appendChild(document.createElement("div"));return this.tmp._robject=e,this.tmp._click=[],this.tmp._update=[],this.tmp._type=[],this.tmp.selClass="zp_hvr",this.tmp._input=r,this.tmp._sdwdiv=l,this.tmp.elem=t,this.tmp.menuElem=a,lmsmenu.stopbubble(e.eve),lmsmenu.insMenuList(),window.setTimeout((function(){r.focus()}),10),this},singleSelect:function(e){var t=e.elem.getElementsByTagName("div")[0],s=t.querySelector(".zp_Tglst"),r=t.insertBefore(document.createElement("input"),s);r.setAttribute("autocomplete","off"),r.setAttribute("required","true"),r.tabIndex=0;var l=document.body.appendChild(document.createElement("div"));return 3==e.menutype?l.className="zp_Am assessment zp_shw":l.className="zp_Am training",l.setAttribute("tabIndex",-1),e.calbck="function"==typeof e.menulist?e.menulist:null,this.tmp._robject=e,this.tmp._robject=e,this.tmp._click=[],this.tmp._update=[],this.tmp._type=[],this.tmp.selClass="zp_hvr",this.tmp._input=r,this.tmp._sdwdiv=s,this.tmp.elem=l,this.tmp.menuElem=l,lmsmenu.stopbubble(e.eve),lmsmenu.insMenuList(),window.setTimeout((function(){r.focus()}),10),this},multiSelect:function(e){var t=e.elem.getElementsByTagName("div")[0],s=t.appendChild(document.createElement("span"));s.className="DN";var r=t.appendChild(document.createElement("input"));r.setAttribute("autocomplete","off"),r.setAttribute("required","true"),r.tabIndex=0,r.style.width="20px";var l=document.body.appendChild(document.createElement("div"));return l.className="zp_Am training",l.setAttribute("tabIndex",-1),e.calbck="function"==typeof e.menulist?e.menulist:null,e.menutype=e.menutype||1,this.tmp._robject=e,this.tmp._click=[],this.tmp._update=[],this.tmp._type=[],this.tmp.selClass="zp_hvr",this.tmp._sdwdiv=t.querySelector(".zp_Tglst"),this.tmp._input=r,this.tmp._span=s,this.tmp.elem=l,this.tmp.menuElem=l,lmsmenu.stopbubble(e.eve),lmsmenu.insMenuList(),window.setTimeout((function(){r.focus()}),10),this},datepicker:function(e){var t=function(e,t){var s=lmsmenu.tmp._click,r={type:e,date:t,referObj:lmsmenu.tmp._robject};for(var l in s)s[l].call(r)};this.tmp._robject=e;var s=document.body.appendChild(document.createElement("div"));s.className="zp_calcvr";var r=s.appendChild(document.createElement("div"));r.className="zp_calcvr",this.tmp.dpick=ZPDatePicker.initiate({target:r,dform:e.dform,today:e.date,range:e.range}).on("monthchge",(function(){t("monthchange",this.getDates())})).on("yearchge",(function(){t("yearchange",this.getDates())})).on("dateclick",(function(){var s=e.dform?this.getDate().getDateBy(e.dform):Calendar.formatDate(this.getDate());t("dateclick",s),lmsmenu.hide("forced")})).bind(),this.tmp.elem=s,this.tmp._robject=e,this.tmp._click=[],this.tmp._update=[],this.tmp._type=[];var l=lmsmenu.getposition(e,!1);return this.addStyle(s,{position:"absolute",zIndex:"1000",left:l.left,top:l.top}),s.className="training",e.eve&&lmsmenu.stopbubble(e.eve),this},daterangeEvents:function(e){var t=e.target,s=t.tagName.toLowerCase();t.closest(".zp_dtrng");if("button"==s){var r=t.getAttribute("_rel");if("save"==r){var l=(o=lmsmenu.tmp).dateRange,a=o._click;l&&-1!=l[0]?-1==l[1]&&(l=[l[0],l[0]]):l=[new Date,new Date],l[1].setHours(23,59,59,999);var n={type:"range",range:l,referObj:lmsmenu.tmp._robject};for(var i in a)a[i].call(n)}else if("clear"==r){a=lmsmenu.tmp._click,n={type:"range",range:[-1,-1],referObj:lmsmenu.tmp._robject};for(var i in a)a[i].call(n)}lmsmenu.hide("forced")}else if("a"==s&&t.closest("[_rel=ranges]")){var o=lmsmenu.tmp,c=parseInt(t.getAttribute("_rel"),10),d=o.rgeptn[c][0].split(" - "),m=o._robject.dform,u=[d[0].parseDate(m),d[1].parseDate(m)];lmsmenu.tmp.hdelem.innerHTML="<div><div>"+u[0].getDateBy("<p>DD</p><span>MMM YYYY</span><font>EE</font>")+"</div></div><div><div>"+u[1].getDateBy("<p>DD</p><span>MMM YYYY</span><font>EE</font>")+"</div></div>",lmsmenu.tmp.dateRange=u,lmsmenu.tmp.dpick.changeSelection(u)}else t.closest(".zp_dtrng")||lmsmenu.hide("forced")},daterange:function(e){var t=document.body.appendChild(document.createElement("div"));t.className="zp_dtrng training";var s=t.appendChild(document.createElement("div"));s.className="zp_rgtrng";var r=e.date.split(" - ");a1=r[0].parseDate(e.dform),a2=r[1]?r[1].parseDate(e.dform):a1;var l=s.appendChild(document.createElement("label"));l.innerHTML="<div><div>"+a1.getDateBy("<p>"+ZPI18N.getString("zp.lms.Date")+"</p><span>"+ZPI18N.getString("zp.lms.monthyear")+"</span><font>"+ZPI18N.getString("zp.lms.EE")+"</font>")+"</div></div><div><div>"+a2.getDateBy("<p>"+ZPI18N.getString("zp.lms.Date")+"</p><span>"+ZPI18N.getString("zp.lms.monthyear")+"</span><font>"+ZPI18N.getString("zp.lms.EE")+"</font>")+"</div></div>";var a=s.appendChild(document.createElement("div"));a.className="zp_calcvr";var n=e.rangepattern;if(n){for(var i='<ul class="zp_CPlst" _rel="ranges"><li><p>'+ZPI18N.getString("zp.lms.ranges")+":</p></li>",o=0;o<n.length;o++)i+="<li><a _rel="+o+">"+n[o][1]+"</a></li>";i+="</ul>";var c=t.appendChild(document.createElement("div"));c.className="zp_lftrng",c.innerHTML=i}var d=t.appendChild(document.createElement("div"));d.className="zp_btn",d.innerHTML='<button class="zpactn zp_actn" _rel="clear">'+ZPI18N.getString("zp.clearAll")+'</button><button class="zpthm" _rel="save">'+ZPI18N.getString("zp.save")+"</button>",this.tmp.dpick=ZPDatePicker.initiate({target:a,dform:e.dform,today:e.date,range:e.range,type:"range"}).on("dateclick",(function(){var e=this.getDates();lmsmenu.tmp.hdelem.innerHTML="<div><div>"+e[0].getDateBy("<p>DD</p><span>MMM YYYY</span><font>EE</font>")+"</div></div>"+(-1==e[1]?"<div><p> "+ZPI18N.getString("zp.lms.todate")+" </p></div>":"<div><div>"+e[1].getDateBy("<p>DD</p><span>MMM YYYY</span><font>EE</font>")+"</div></div>"),lmsmenu.tmp.dateRange=e})).bind(),this.tmp.rgeptn=n,this.tmp.elem=t,this.tmp.hdelem=l,this.tmp._robject=e,this.tmp.dateRange=[-1,-1],this.tmp._click=[],this.tmp._update=[],this.tmp._type=[];var m=lmsmenu.getposition(e,!1);return this.addStyle(t,{position:"absolute",zIndex:"1000",left:m.left,top:m.top}),e.eve&&lmsmenu.stopbubble(e.eve),this},timepicker:function(e){e.elem.parentNode;var t=document.body.appendChild(document.createElement("div"));return t.className="zp_Am training",t.setAttribute("tabIndex",-1),this.tmp._robject=e,this.tmp._click=[],this.tmp._update=[],this.tmp._type=[],this.tmp.selClass="zp_hvr",this.tmp._inputVal=e.elem.value,this.tmp.menuElem=t,lmsmenu.stopbubble(e.eve),this.insTimeMenuList(e.elem.value),this},timeEvents:{inpAction:function(){var e=lmsmenu.tmp,t=e._robject;this.value=this.value.replace("'","").replace("&","").replace("%","").replace(".","");var s="hh:mm a"==t.tform?lmsmenu.timeObj12hr(this.value):lmsmenu.timeObj24hr(this.value);e.menuElem.getElementsByTagName("ul")[0].innerHTML=s,e.menuElem.style.display="";var r=e.menuElem.querySelector("."+e.selClass);r&&r.scrollIntoView(!1),lmsmenu.setPosition(e.menuElem,t.elem.parentNode)},kdAction:function(e){var t=lmsmenu.tmp,s=(t.selClass,t._robject,e.which||e.keyCode||e.charCode),r=t.menuElem.getElementsByTagName("li");if(38==s)(l=t.menuElem.querySelector("."+lmsmenu.tmp.selClass))&&l!=r[0]&&(l.className="",(a=l.previousSibling).className=lmsmenu.tmp.selClass,this.value=a.innerHTML,a.scrollIntoView(!1));else if(40==s){var l,a;if((l=t.menuElem.querySelector("."+lmsmenu.tmp.selClass))&&l!=r[r.length-1])l.className="",(a=l.nextSibling).className=lmsmenu.tmp.selClass,this.value=a.innerHTML,a.scrollIntoView(!1)}else if(13==s){lmsmenu.tmp._robject.elem.blur()}},kpAction:function(e){var t=lmsmenu.tmp._robject.tform,s=e.which||e.keyCode||e.charCode;if(!/^(8|4[0689]|5[0-8]|3[7-9])$/.test(s)&&"HH:mm"==t)return e.preventDefault(),e.stopPropagation(),!1;var r=this.selectionStart,l=this.selectionEnd;if(r==l&&l==this.value.length&&!/^(37|8|46)$/.test(s)){var a=String.fromCharCode(s);("hh:mm a"==t?lmsmenu.get12hrTime(this.value+a):lmsmenu.get24hrTime(this.value+a))||(e.preventDefault(),e.stopPropagation())}},blrAction:function(e,t){var s=lmsmenu.tmp,r=s._robject.elem;if(!r.value.match("hh:mm a"==s._robject.tform?new RegExp("^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)([APap][mM])$"):new RegExp("^([0-1][0-9]|2[0-3])(:)([0-5][0-9])$"))){var l=s.menuElem.querySelector("."+s.selClass);r.value=l?l.innerHTML:s._inputVal}lmsmenu.hideTimeObj()},psteAction:function(e){e.preventDefault()},timclick:function(e){var t=e.target||e.srcElement,s=lmsmenu.tmp._robject.elem;if("li"==t.tagName.toLowerCase()){s.value=t.innerHTML;var r=lmsmenu.tmp._click;for(var l in r)r[l].call({value:s.value});lmsmenu.hideTimeObj()}}},insTimeMenuList:function(e){if(this.tmp._robject){var t=this.tmp._robject,s=t.tform,r=this.tmp.menuElem,l=(this.tmp._input,t.elem);e=""==e&&"HH:mm"==s?"00":""==e&&"hh:mm a"==s?"12":e;var a="hh:mm a"==s?this.timeObj12hr(e):this.timeObj24hr(e);r.innerHTML="<div><ul _type='selectbox'>"+a+"</ul></div>",lmsmenu.setPosition(r,t.elem.parentNode);var n=r.querySelector("."+this.tmp.selClass);n&&n.scrollIntoView(!1),this.tmp._prevalue=l.value,t.elem.focus();e=t.elem.value;t.elem.value="",t.elem.value=e}},timeObj12hr:function(e){for(var t,s=this.get12hrSelectTime(e),r="",l=this.tmp.selClass,a=0;a<24;a++)t=0==a?"12:00 am":12==a?"12:00 pm":a>12?a-12+":00 pm":a+":00 am",val1=t.replace("00","30"),r+="<li"+(t==s?" class='"+l+"'":"")+">"+t+"</li>",r+="<li"+(val1==s?" class='"+l+"'":"")+">"+val1+"</li>";return r},get12hrSelectTime:function(e){var t,s=e.length;return s>1&&":"==e[1]&&s++,(t=e.match(new RegExp(["^([0-9])$","^(0?[1-9]|1[012])$","^(0?[1-9]|1[012])(:)$","^(0?[1-9]|1[012])(:)([0-5])$","^(0?[1-9]|1[012])(:)([0-5][0-9])$","^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)$","^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)([APap])$","^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)([APap][mM])$"][s-1])))?((t=Array.prototype.slice.call(t,1))[0]||12)+":"+(t[2]?t[2]+(1==t[2].length?"0":""):"00")+" "+(t[4]||"am"):""},get12hrTime:function(e){var t,s,r=e.length;return r>1&&":"==e[1]&&r++,!!(r>0&&r<=8&&(t=e.match(new RegExp(["^([0-9])$","^(0?[1-9]|1[012])$","^(0?[1-9]|1[012])(:)$","^(0?[1-9]|1[012])(:)([0-5])$","^(0?[1-9]|1[012])(:)([0-5][0-9])$","^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)$","^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)([APap])$","^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)([APap][mM])$"][r-1]))))&&(t=Array.prototype.slice.call(t,1),r<4?{sel:(s=parseInt(t[0],10))>11?0:0==s?12:s}:4==r?{arr:[(e=0==e[0]?e.slice(1):e)+"0 AM",e+"5 PM",e+"0 AM",e+"5 PM"],sel:0}:r>4?{arr:[(s=0==(s=e.substring(0,5).trim())[0]?s.slice(1):s)+" AM",s+" PM"],sel:t[4]?/a/i.test(t[4][0])?0:1:0}:void 0)},timeObj24hr:function(e){for(var t,s=this.get24hrSelectTime(e),r="",l=this.tmp.selClass,a=0;a<24;a++)e=(t=a<10?"0"+a:a)+":00",val1=t+":30",r+="<li "+(e==s?"class='"+l+"'":"")+" >"+e+"</li>",r+="<li "+(val1==s?"class='"+l+"'":"")+" >"+val1+"</li>";return r},get24hrSelectTime:function(e){var t,s=e.length;return(t=e.match(new RegExp(["^([0-2])$","^([0-1][0-9]|2[0-3])$","^([0-1][0-9]|2[0-3])(:)$","^([0-1][0-9]|2[0-3])(:)([0-5])$","^([0-1][0-9]|2[0-3])(:)([0-5][0-9])$"][s-1])))?((t=Array.prototype.slice.call(t,1))[0]||12)+":"+(t[2]?t[2]+(1==t[2].length?"0":""):"00"):""},get24hrTime:function(e){var t,s=e.length;if(!(s>0&&s<6&&(t=e.match(new RegExp(["^([0-2])$","^([0-1][0-9]|2[0-3])$","^([0-1][0-9]|2[0-3])(:)$","^([0-1][0-9]|2[0-3])(:)([0-5])$","^([0-1][0-9]|2[0-3])(:)([0-5][0-9])$"][s-1])))))return!1;if(t=Array.prototype.slice.call(t,1),2==s)return{sel:r=parseInt(t[0],10)};if(s<4){var r=parseInt(t[0],10);return{sel:1==t[0].length&&r<=2?10*r:r}}return 4==s?{arr:[e+"0",e+"5"],sel:0}:5==s?{arr:[e],sel:0}:void 0},calhtml:function(){},getposition:function(e,t){var s,r,l=e.elem.getBoundingClientRect(),a=this.tmp.elem.getBoundingClientRect(),n=document.body.scrollTop,i=t?20:0,o=["tp","lft"];return window.innerWidth>l.left+a.width?r=l.left-i+"px":(r=l.left-a.width+l.width+i+"px",o[1]="rgt"),window.innerHeight-30>l.top+a.height?s=l.top+l.height+i+n+"px":(s=l.top-a.height+n+"px",o[0]="btm"),{left:r,top:s,arwCls:{tp_lft:"tpl",tp_rgt:"tpr",btm_lft:"btl",btm_rgt:"btr"}[o.join("_")]}},positionMenu:function(e,t){var s=t.getBoundingClientRect(),r=window.innerHeight,l=window.innerWidth,a=document.body.scrollTop;r-(s.top+s.height)>300?(e.style.top=s.top+s.height+a+"px",lmsmenu.addClass(t,"bhd")):(e.style.top=s.top-e.getBoundingClientRect().height+a+"px",lmsmenu.addClass(t,"thd")),l/2>s.left?e.style.left=s.left+"px":e.style.right=l-s.right+"px",e.style.minWidth=s.width+"px"},setPosition:function(e,t){var s=this.tmp._robject;if("dropselect"==s.type){var r=s.arrowHead,l=lmsmenu.getposition(s,!!r);this.addStyle(e,{position:"absolute",zIndex:"1000",width:s.width,left:l.left,top:l.top}),r&&(e.className+=" "+l.arwCls)}else lmsmenu.positionMenu(e,t)},stopbubble:function(e){(e=e||event).stopPropagation?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1)},events:{_focus:function(){this.addEventListener("input",lmsmenu.events._input,!1),this.addEventListener("paste",lmsmenu.events._onpaste,!1),this.addEventListener("focusout",lmsmenu.events._blur,!1)},_blur:function(){this.removeEventListener("input",lmsmenu.events._input,!1),this.removeEventListener("paste",lmsmenu.events._onpaste,!1),this.removeEventListener("focusout",lmsmenu.events._blur,!1)},_input:function(e){var t=lmsmenu.tmp,s=t._sdwdiv;lmsmenu.insMenuList(this.value),"multi"==t._robject.mode&&(lmsmenu.tmp.menuElem.style.display="",lmsmenu.updteInputField(!1));var r=t._input.value,l=lmsmenu.tmp._type;for(var a in l)lmsmenu.getoptionObject(r,lmsmenu.tmp._robject.name,l[a]);""!=r||""!=s.innerHTML.trim()?lmsmenu.addClass(s,"ntxt"):lmsmenu.removeClass(s,"ntxt")},_kypress:function(e){var t=lmsmenu.tmp,s=lmsmenu.tmp.selClass,r=lmsmenu.tmp.defsel;_robj=t._robject,_mnode=t.elem,_type=_robj.type,_mode=_robj.mode,_menElSt=lmsmenu.tmp.menuElem.style.display;var l=e.which||e.keyCode||e.charCode;String.fromCharCode(l);if(8==l&&"select"==_type&&"multi"==_robj.mode&&""==t._input.value){var a=t._robject.elem.querySelector("[_rel=items]");lmsmenu.delSelectItem(a.lastElementChild)}else if(13==l){if("none"==_menElSt)return;var n=_mnode.querySelector("."+s);if(!n)return;if("dropdown"==_type)n=n.hasAttribute("_rel")?n:n.parentNode,lmsmenu.clickAction(n,e),lmsmenu.hide("forced");else if("select"==_type&&"multi"==_mode){lmsmenu.clickAction(n,e),lmsmenu.tmp.menuElem.style.display="none";lmsmenu.tmp._input;lmsmenu.updteInputField(!0)}else lmsmenu.clickAction(n,e),lmsmenu.hide("forced")}else if(40==l){if("none"==_menElSt)return;var i=(o=_mnode.querySelector("."+s))?o.nextSibling:r||null;i&&(lmsmenu.addClass(i,s),o&&lmsmenu.removeClass(o,s),i.scrollIntoView(!1))}else if(38==l){if("none"==_menElSt)return;var o,c=(o=_mnode.querySelector("."+s))?o.previousSibling:r||null;c&&(lmsmenu.addClass(c,s),o&&lmsmenu.removeClass(o,s),c.scrollIntoView(!1))}},_onpaste:function(e){lmsmenu.stopbubble(e)},_keyup:function(e){27==(e.which||e.keyCode||e.charCode)&&lmsmenu.hide(e)},_mosdown:function(e){var t=(e=e||event).target||e.srcElement;if(t.closest("[_type=selectbox]")){if(""==(t=t.hasAttribute("_rel")?t:t.closest("[_rel]")))return;if(lmsmenu.clickAction(t,e),"multi"==lmsmenu.tmp._robject.mode)lmsmenu.tmp.menuElem.style.display="none",lmsmenu.tmp._input.value="";else 3==lmsmenu.tmp._robject.menutype?"0"!=t.getAttribute("_rel")&&(lmsmenu.getSelectionSingleList().toString()+",").split(",").length<9?lmsmenu.insMenuList(t):lmsmenu.insMenuList():lmsmenu.hide("forced")}else if(lmsmenu.tmp._robject.htmlContent){var s=lmsmenu.tmp._click;for(var r in s)s[r].call(e.srcElement||e.target);lmsmenu.hide("forced")}else{(t="sessionattnmenu"==lmsmenu.tmp._robject.elem.getAttribute("_rel")||"dropdown"==lmsmenu.tmp._robject.type&&2==lmsmenu.tmp._robject.menutype?t.closest("li"):t.hasAttribute("_rel")?t:t.parentNode).hasAttribute("_rel")&&(lmsmenu.clickAction(t,e),lmsmenu.hide("forced"))}}},delSelectItem:function(e,t){if("single"==t)e.innerHTML="",e.removeAttribute("_rel"),lmsmenu.removeClass(e,"ntxt");else if(e){var s=e.parentNode;s&&s.closest('[rel="ruleList"]')&&lmscourseapplicable.isDataChanged(!0,s.closest('[rel="ruleList"]').getAttribute("id").split("_")[1]),s.removeChild(e),""==s.innerHTML.trim()?lmsmenu.removeClass(s,"ntxt"):lmsmenu.addClass(s,"ntxt")}lmsmenu.insMenuList()},updteInputField:function(e){var t=this.tmp._input,s=this.tmp._span;e&&(t.value=""),this.addStyle(s,{position:"absolute",visibility:"hidden",display:"block"}),s.textContent=t.value,t.style.width=s.offsetWidth+10+"px",s.style={}},getMenuicon:function(e,t,s){return e&&"user"==e?t&&""!=t.trim()?'<div class="ZP_photo pc1"><img src="'+t+'"></div>':'<div class="ZP_photo pc'+s.length%10+'">'+s.substring(0,2)+"</div>":t&&""!=t?'<i class="'+t+'"></i>':""},insMenuList:function(e,t){if(!this.tmp._robject)return;var s=this.tmp._robject,r=this.tmp.elem,a=this.tmp.menuElem,n="",i=s.elem,o=s.menulist,c=s.htmlContent,d=s.calbck;const m=window.event;if(d&&!t){function u(){lmsmenu.getoptionObject(e,s.name,d,m)}n+="<li><font></font><div>"+ZPI18N.getString("zp.lms.loading")+"</div><i></i>",a.innerHTML=n+"</ul></div>",lmsmenu.setPosition(r,i),e&&lmsmenu.tmp._robject.inputTimeout?lmsmenu.setTimeout(u,lmsmenu.tmp._robject.inputTimeout):u()}else{_sel=3==s.menutype?this.getSelectionSingleList().toString()+",":this.getSelection().toString()+",",isSel=!1,l=!0,className="",3!=s.menutype&&(e=e?e.trim():"");var p=!1,g=s.kind;if(3==s.menutype){var f=_sel.split(","),v=!1;if(null!=e&&""!=e&&null!=e&&"0"!=e.getAttribute("_rel"))e.querySelector('[class="IC-cbox"]')?(e.querySelector('[class="IC-cbox"]').classList.add("zp_gclr"),e.setAttribute("class","sel")):e.querySelector('[class="IC-cbox "]')?(e.querySelector('[class="IC-cbox "]').classList.add("zp_gclr"),e.setAttribute("class","sel")):e.querySelector('[class="IC-cbox zp_gclr"]')&&(e.querySelector('[class="IC-cbox zp_gclr"]').classList.remove("zp_gclr"),e.removeAttribute("class")),e.closest("ul").querySelector('[_rel="0"]').hasAttribute("class")&&"sel"==e.closest("ul").querySelector('[_rel="0"]').getAttribute("class")?(e.closest("ul").querySelector('[_rel="0"]').removeAttribute("class"),e.closest("ul").querySelector('[_rel="0"]').querySelector('[class="IC-cbox zp_gclr"]').classList.remove("zp_gclr")):(f.length>9||-1!=f.indexOf("0"))&&(e.closest("ul").querySelector('[_rel="0"]').querySelector('[class="IC-cbox "]')?e.closest("ul").querySelector('[_rel="0"]').querySelector('[class="IC-cbox "]').setAttribute("class","IC-cbox zp_gclr"):e.closest("ul").querySelector('[_rel="0"]').querySelector('[class="IC-cbox"]').setAttribute("class","IC-cbox zp_gclr"));else for(var h in o)e&&!ZPeople.decodeTxt(o[h][0]).trim().toLowerCase().includes(""+e.toLowerCase())||(new RegExp("^"+e+"$","i").test(o[h][0])&&(p=!0),(!v&&-1!=f.indexOf("0")||0!=f.indexOf("0")&&r.querySelectorAll('[class="IC-cbox zp_gclr"]').length==$(".IC-cbox").length-1)&&(v=!0),isSel=!(-1==f.indexOf(h)&&!v&&document.querySelectorAll('[class="IC-cbox zp_gclr"]').length!=$(".IC-cbox").length-1),className=lmscourseconfig.courseAdminPermConfig(isSel,o,h,s.elem.getAttribute("rel").split("_")[1]),n+="<li "+(""!=className?"class='"+className+"'":"")+' _rel="'+h+'"><div><i '+(isSel?"class='IC-cbox zp_gclr'":"class='IC-cbox '")+'></i><span class="" _cont>'+o[h][0]+"</span></div></li>")}else if(2!=s.menutype)for(var h in o)e&&!ZPeople.decodeTxt(o[h][0]).trim().toLowerCase().includes(""+e.toLowerCase())||(new RegExp("^"+e+"$","i").test(o[h][0])&&(p=!0),isSel=new RegExp(h+",").test(_sel),n+="<li "+(isSel?" class='sel'":"")+' _rel="'+h+'">'+this.getMenuicon(g,o[h][1],o[h][0])+'<font class="IC-tck"></font><div _cont>'+o[h][0]+"</div>");else for(var h in o)(!e||0==ZPeople.decodeTxt(o[h][0]).trim().toLowerCase().indexOf(""+e.toLowerCase())||0==o[h][1].trim().toLowerCase().indexOf(""+e.toLowerCase())||o[h][3]&&0==o[h][3].trim().toLowerCase().indexOf(""+e.toLowerCase()))&&(new RegExp("^"+e+"$","i").test(o[h][0])&&(p=!0),isSel=new RegExp(h+",").test(_sel),n+="<li "+(isSel?" class='sel'":"")+' _rel="'+h+'">'+this.getMenuicon(g,o[h][2],o[h][1])+'<font class="IC-tck"></font><div _cont>'+(o[h][0]?"<em>"+o[h][0]+"</em>":"")+(o[h][1]?o[h][1]:"")+(o[h][2]?" "+o[h][2]:"")+(o[h][3]?" "+o[h][3]:"")+"</div></li>");""!=e&&!p&&s.allow_new&&(n+='<li _rel="newlyadded"><div><a>'+ZPI18N.getString("zp.lms.create")+"</a><span>"+e.replace(/</g,"&lt;")+"</span></div></li>"),""==n&&3!=lmsmenu.tmp._robject.menutype&&(n+='<li _rel="empty"><div>'+(s.emptystring?s.emptystring:ZPI18N.getString("zp.lms.nodatafound"))+"</div></li>"),(3==lmsmenu.tmp._robject.menutype&&!e||3!=lmsmenu.tmp._robject.menutype)&&(a.innerHTML=c||"<div><ul _type='selectbox'>"+n+"</ul></div>",lmsmenu.setPosition(r,i))}var b=a.querySelector("[_rel]");return this.tmp.defsel=b||null,b},getSelectionSingleList:function(){var e=this.tmp._robject.elem.querySelector('[class="zp_Tglst ntxt"]'),t=[];if(e)for(var s=e.getAttribute("_rel").split("|"),r=0;r<s.length;r++)""!=s[r]&&t.push(s[r]);return t},setTimeout(e,t){clearTimeout(lmsmenu.timeout),lmsmenu.timeout=setTimeout((function(){e(),clearTimeout(lmsmenu.timeout)}),t)},getoptionObject:function(e,t,s,r){s.call({event:r,value:e,name:t,updateOptionList:function(e,t){if(lmsmenu.tmp._robject){lmsmenu.tmp._robject.menulist=e,lmsmenu.insMenuList(t,!0);var s=lmsmenu.tmp._update;for(var r in s)s[r].call({elem:lmsmenu.tmp._robject.elem,options:e})}}})},updteMenuList:function(e){lmsmenu.addClass(e,"sel");var t=lmsmenu.tmp.selClass,s=e.parentNode.querySelector("."+t);lmsmenu.removeClass(s,t),lmsmenu.addClass(e,t)},getSelection:function(){var e=this.tmp._robject.elem.querySelector("[_rel=items]"),t=[];if(e)for(var s=e.getElementsByTagName("div"),r=0;r<s.length;r++)t.push(s[r].getAttribute("data-value"));return t},getSelectionList:function(){var e=this.tmp._robject.elem.querySelector("[_rel=items]"),t=[];if(e)for(var s=e.getElementsByTagName("div"),r=0;r<s.length;r++)t.push({name:s[r].getAttribute("data-value"),value:s[r].textContent});return t},clickAction:function(e,t){if(null!=e&&"empty"!=e.getAttribute("_rel")){var s=this.tmp,r=s._robject,l=r.type,a=r.mode,n=r.kind,i=s._click,o=e.getElementsByTagName("a").length>0,c=e.getAttribute("_rel")+(o?"_"+lmsmenu.cntr++:""),d="",m=e.querySelector("[_cont]"),u=e.querySelector("em");if(3==this.tmp._robject.menutype){_sval=document.querySelectorAll('[class="IC-cbox zp_gclr"]');var p=!1;"sel"==e.getAttribute("class")?c="":"sel"!=e.getAttribute("class")&&_sval.length==$(".IC-cbox").length-2&&(p=!0);for(var g=0;g<_sval.length;g++)if(e.getAttribute("_rel")!=_sval[g].parentNode.parentElement.getAttribute("_rel")){if("0"!=e.getAttribute("_rel")&&_sval.length==$(".IC-cbox").length-1||p){d=ZPI18N.getString("zp.all"),c="0";break}("0"!=_sval[g].parentElement.parentElement.getAttribute("_rel")&&"0"!=e.getAttribute("_rel")||"0"==e.getAttribute("_rel")&&"sel"==e.getAttribute("class")&&_sval[g].parentNode.parentElement.textContent==ZPI18N.getString("zp.lms.component.display_name.overview")||"0"==e.getAttribute("_rel")&&"sel"==e.getAttribute("class")&&_sval[g].parentNode.parentElement.textContent==ZPI18N.getString("zp.lms.courseSetting")&&lmscourseconfig.isAllSelect(r.elem.getAttribute("rel").split("_")[1]))&&(d+=""!=d?", "+_sval[g].parentNode.parentElement.textContent:_sval[g].parentNode.parentElement.textContent,c=""!=c?c+"|"+_sval[g].parentNode.parentElement.getAttribute("_rel"):_sval[g].parentNode.parentElement.getAttribute("_rel"))}"sel"!=e.getAttribute("class")&&_sval.length<$(".IC-cbox").length-1&&!p&&(d+=""!=d?", "+m.childNodes[0].textContent:m.childNodes[0].textContent),_val=[null,d]}else _val=o?[null,e.getElementsByTagName("span")[0].textContent]:u?[u.textContent,m.childNodes.length>1?m.childNodes[1].textContent:null]:[null,m.childNodes[0].textContent];var f={value:c,content:_val,referObj:r};if("select"==l&&"multi"==a){var v,h=lmsmenu.getSelection(),b=this.tmp._input,I={};h.indexOf(c)<0&&(I[c]=[_val[0]?_val[0]:"",_val[1]],n&&"user"==n?(v=e.getElementsByTagName("img"),I[c].push(v.length>0?v[0].src:null)):(v=e.getElementsByTagName("i"),I[c].push(v.length>0?v[0].className:null)),lmsmenu.tmp._robject.elem.querySelector("[_rel=items]").innerHTML+=this.getoptionHTML(I,r.kind),lmsmenu.positionMenu(lmsmenu.tmp.elem,lmsmenu.tmp._robject.elem)),f={items:lmsmenu.getSelectionList(),referObj:r},b&&setTimeout((function(){b.focus()}),10)}else if("select"==l&&"single"==a){var y=s._sdwdiv;y.setAttribute("_rel",c),y.setAttribute("data-text",d);var _=r.menulist[c];y.innerHTML=(void 0!==_&&_[1]?'<i class="'+_[1]+'"></i>':"")+"<div>"+(_val[0]?"<em>"+_val[0]+"</em>":"")+zplms.encodeHTML(_val[1])+"</div>"}for(var S in"membersfltrmenu"==this.tmp._robject.elem.getAttribute("_rel")&&(lmscoursemembers.moreactionmenu=[],lmscoursemembers.showMore=""),s._sdwdiv&&(""==s._sdwdiv.innerHTML.trim()?lmsmenu.removeClass(s._sdwdiv,"ntxt"):lmsmenu.addClass(s._sdwdiv,"ntxt")),i)i[S].call(f);lmsmenu.stopbubble(t)}},changeToSelectMenu:function(e,t,s,r,l,a,n){e.setAttribute("_type","select");var i=lmsmenu.tmp&&lmsmenu.tmp._robject?lmsmenu.tmp._robject.menutype:1;if("single"==s){var o='<div class="zp_Sms">'+(r?'<i class="'+r+'"></i>':"")+'<font class="IC-adwn"></font><p></p>';if("{}"==JSON.stringify(t))o+='<div class="zp_Tglst" data-text="'+(l||"")+'" _mode="single"></div>';else for(var c in t)o+=3==i||2!=i?'<div class="zp_Tglst ntxt" _rel="'+c+'"   data-text="'+(l||"")+'" _mode="single"><div>'+t[c][0]+"</div></div>":'<div class="zp_Tglst ntxt" _rel="'+c+'"   data-text="'+(l||"")+'" _mode="single"><div><em>'+t[c][0]+"</em>"+t[c][1]+"</div></div>";e.innerHTML+=o+"</div>"}else{o='<div class="zp_Mms"><font class="IC-adwn"></font><p></p>';var d=this.getoptionHTML(t,a,n);o+='<div _rel="items" class="zp_Tglst'+(""!=d?" ntxt":"")+'"  data-text="'+(l||"")+'" _mode="multi">'+d+"</div>",e.innerHTML+=o+"</div>"}},getSelectElement:function(e,t,s,r,l,a,n){var i="",o=lmsmenu.tmp&&lmsmenu.tmp._robject?lmsmenu.tmp._robject.menutype:1;if("multi"==s){var c=this.getoptionHTML(t,a,n);i='<div _type="select" _name="'+e+'" class="zp_Mms"><font class="IC-adwn"></font><p></p><div _rel="items" class="zp_Tglst'+(""!=c?" ntxt":"")+'"  data-text="'+(l||"")+'" _mode="multi">'+c+"</div></div>"}else if("single"==s){if(i='<div _type="select" _name="'+e+'" class="zp_Sms">'+(r?'<i class="'+r+'"></i>':"")+'<font class="IC-adwn"></font><p></p>',"{}"==JSON.stringify(t))i+='<div class="zp_Tglst" data-text="'+(l||"")+'" _mode="single"></div>';else for(var d in t)i+=2!=o?'<div class="zp_Tglst ntxt" _rel="'+d+'"   data-text="'+(l||"")+'" _mode="single">'+(t[d][2]?'<i class="'+t[d][2]+'"></i>':"")+"<div>"+t[d][0]+"</div></div>":'<div class="zp_Tglst ntxt" _rel="'+d+'"   data-text="'+(l||"")+'" _mode="single">'+(t[d][2]?'<i class="'+t[d][2]+'"></i>':"")+"<div><em>"+t[d][0]+"</em>"+t[d][1]+"</div></div>";i+="</div>"}return i},getoptionHTML:function(e,t,s){var r="";e=e||{};if(2!=(lmsmenu.tmp&&lmsmenu.tmp._robject?lmsmenu.tmp._robject.menutype:1))for(var l in e){var a="";a="noencode"==s?e[l][1]:e[l][1].replace(/</g,"&lt;"),r+='<div class="zp_Tg" data-value="'+l+'" >'+this.getMenuicon(t,e[l][2],e[l][1])+"<div>"+(1==e[l].length||""==e[l][1]?"noencode"==s?e[l][0]:e[l][0].replace(/</g,"&lt;"):a)+'</div><font class="IC-cls1"></font></div>'}else for(var l in e)r+='<div class="zp_Tg" data-value="'+l+'" >'+this.getMenuicon(t,e[l][2],e[l][1])+"<div><em>"+e[l][0].replace(/</g,"&lt;")+"</em>"+e[l][1].replace(/</g,"&lt;")+'</div><font class="IC-cls1"></font></div>';return r},getSelectOptions:function(e){var t=e.querySelector("[_mode=multi]"),s=e.querySelector("[_mode=single]"),r=[];if(t)for(var l=t.getElementsByTagName("div"),a=0;a<l.length;a++)r.push(l[a].getAttribute("data-value"));else{var n=s.getAttribute("_rel");n&&r.push(n)}return r},getSelectOptionsHtml:function(e){var t=e.querySelector("[_mode=multi]"),s=e.querySelector("[_mode=single]");if(t)return t.innerHTML;var r=s.getAttribute("_rel");return r?'<div class="zp_Tg"  data-value="'+r+'"><em>'+s.textContent+'</em><font class="IC-cls1"></font></div>':""},addClass:function(e,t){new RegExp("(^|\\s)"+t+"(\\s|$)","g").test(e.className)||""==t||(e.className=(e.className+" "+t).replace(/\s+/g," ").replace(/(^ | $)/g,""))},removeClass:function(e,t){var s=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(s,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")},hasClass:function(e,t){return e.className&&new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)},addStyle:function(e,t){if(t){for(var s in t)e.style[s]=t[s];return e}},changeToDropSelectMenu:function(e,t,s){var r="<label>"+(s?'<i class="'+s+'"></i>':"")+'<b valueholder _rel="'+t.id+'">'+t.value+'</b><i class="IC-adwn"></i>';e.innerHTML=r},updateDropMenuSelection:function(){var e=this.referObj.elem.querySelector("[valueholder]");e&&(e.setAttribute("_rel",this.value),e.innerHTML=this.content[1])},updateSelectMenuOption:function(e,t,s){var r=e.querySelector(".zp_Tglst");r.setAttribute("_rel",t),s&&s.length?r.innerHTML=(s[2]?'<i class="'+s[2]+'"></i>':"")+"<div>"+(s[0]?"<em>"+s[0]+"</em>":"")+s[1]+"</div>":(r.innerHTML="",r.classList.remove("ntxt"))}};const lmsnewsettings={commonSettingData:null,selfSettingData:null,iltSettingData:null,manualSettingData:null,typebasedData:null,getCategories:null,savedConfigData:null,notificationData:null,notiSavedData:null,gradeData:null,lmsnewsettings:null,sendAjaxRequest:!0,editFormOpen:!1,refer:{index:1,timeout:null},alertTabChange(e){let t=new InfoAlertMessage("",ZPI18N.getString("zp.cancelconfmsg"));t.yesButtonText=ZPI18N.getString("zp.proceed"),t.callback=()=>{e()},t.show()},getThirdLevelNavBar:function(){return'  <nav id="zp-tlevel-lms-contentmanager" class="navbar-default ZPSnav">    <div class="container-fluid">      <ul class="zpl_tabpane">        <li id="zp_subtab_lms_files" rel="files">          <a href="#lms-admin/contentmanager/files" >'+ZPI18N.getString("zp.lms.content.files")+'</a>        </li>        <li id="zp_subtab_lms_resources" rel="resources">          <a href="#lms-admin/contentmanager/resources" >'+ZPI18N.getString("zp.lms.base.resources")+"</a>        </li>      </ul>    </div>  </nav>"},showErrorMessage:function(e,t,s){lmsbase.addClass(e," ztextbox__error"),t.innerHTML=s,t.style.display="inline"},getThirdLevelTab:function(){var e=document.createElement("div");e.setAttribute("class","zpl_cstmProfNav"),e.setAttribute("rel","lms_thirdLevelTab"),e.setAttribute("skip-dn","true");var t=document.createElement("div");t.innerHTML=lmsnewsettings.getThirdLevelNavBar(),t=t.children[0],e.appendChild(t);var s=Layout.Page.pageContWrapper[0];s.insertBefore(e,s.children[0]),lmsbase.addListener(document.querySelector(".zpl_cstmProfNav"),"click",lmsfilemanager.clickHandle,!1)},switchTab:function(e){if(!lmsbase.hasClass(e,"zpl_act")){var t=e.parentNode.querySelectorAll(".zpl_act");t.length&&Array.prototype.forEach.call(t,(function(e){lmsbase.removeClass(e,"zpl_act")})),lmsbase.addClass(e,"zpl_act")}},getThirdLevelNavBar1:function(){return'<ul class="zpl_tabpane" id="contentmanager">        <li id="zp_subtab_lms_files" rel="files">          <a href="#lms-'+lmsbase._role+'/contentmanager/files" >Files</a>        </li>        <li id="zp_subtab_lms_resources" rel="resources">          <a href="#lms-'+lmsbase._role+'/contentmanager/resources" >Resources</a>        </li>'},getThirdLevelTab1:function(){if(document.querySelector("[rel=lms_thirdLevelTab]").classList.add("zpl_cstmProfNav"),$("[rel=lms_thirdLevelTab]").length&&($("[rel=lms_thirdLevelTab] #contentmanager").length&&$("[rel=lms_thirdLevelTab] > ul:not(#contentmanager)").addClass("DN")),document.querySelector("#contentmanager")&&(lmsbase.hasClass(document.querySelector("#contentmanager"),"DN")&&lmsbase.removeClass(document.querySelector("#contentmanager"),"DN")),!!!document.querySelector("#contentmanager")){var e=document.querySelector("[rel=lms_thirdLevelTab]"),t=document.createElement("div");t.innerHTML=lmsnewsettings.getThirdLevelNavBar1(),t=t.children[0],e.appendChild(t);var s=Layout.Page.pageContWrapper[0];s.insertBefore(e,s.children[0]),lmsbase.addListener(document.querySelector("#contentmanager"),"click",lmsfilemanager.clickHandle,!1)}},getSettingsData:function(e,t){return new Promise(((s,r)=>{if(null==lmsnewsettings.commonSettingData||e){const e={isFromNewSettings:!0};1===t&&(e.isSettings="true"),zplms.get("/lms/settings",e,(function(e){try{(isadmin||e[1]&&e[1][0].settingPermission.isSettingsAdmin)&&$.each(e[1],(function(e,t){null==t.allType&&(lmsnewsettings.selfSettingData=t.selfData,lmsnewsettings.iltSettingData=t.iltData,lmsnewsettings.manualSettingData=t.manualData,lmsnewsettings.lpData=t.lpData,lmsnewsettings.gradeData=t.gradeData,lmsnewsettings.existingGradeData=Object.assign([],lmsnewsettings.gradeData.gradeRating)),lmsnewsettings.typebasedData=t,lmsnewsettings.commonSettingData=t.commonSetting,lmsnewsettings.getCategories=t.categoryData,lmsnewsettings.savedConfigData=t.savedConfigData,lmsnewsettings.entityDataObject=t.entityDataObject,lmsnewsettings.courseTypeSettingIds=t.courseTypeSettingIds})),s()}catch(e){r(e)}}))}else s()}))},clickHandler:async function(e){var t=e.target.getAttribute("rel");if("generalsave"==t)lmsnewsettings.getGeneralSettings.saveGeneralOpts();else if("generalreset"==t)lmsnewsettings.getGeneralSettings.resetGeneralOpts();else if("gradingsave"==t)lmsnewsettings.getGradingSettings.saveGradingOpts();else if("gradingreset"==t){for(var s=document.querySelectorAll('[_srel="lettergradestatus"]'),r=0;r<s.length;r++)ZPeopleComponents.select(settingsPage.container.find("#"+s[r].getAttribute("id"))).destroy();lmsnewsettings.getGradingSettings.init(1)}else if("saveResetGrade"==t)lmsnewsettings.getGradingSettings.resetGradingOpts(1);else if("deletegrade"==t)document.querySelector('[rel="tableRow"]').querySelector("tbody").querySelectorAll("tr").length<2?ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.onegrade")):lmsnewsettings.getGradingSettings.delGradeSetting(e);else if("addGradeTypeRel"==t)lmsnewsettings.getGradingSettings.addGrade(e);else if("feedbacksave"==t)lmsnewsettings.getFeedback.saveFeedbackOpts();else if("feedbackAdditionalSave"===t)lmsnewsettings.getFeedback.saveFeedbackAdditionalSettings();else if("feedbackreset"==t||"learnerOpt"==t||"managerOpt"==t||"bothLMOpt"==t||"anytimeOpt"==t||"afterCCOpt"==t||"trainerMOpt"==t||"sptrainerMOpt"==t||"courseOpt"==t||"spcourseOpt"==t||"feedbackForLearner"==t||"spbothTCOpt"==t||"allOpt"==t||"spallOpt"==t||"attOpt"==t||"spattOpt"==t)"feedbackreset"==(t=t.startsWith("sp")?t.substring(2):t)?lmsnewsettings.getFeedback.resetFeedbackOpts(0,t):lmsnewsettings.getFeedback.resetFeedbackOpts(1,t);else if("feedbackAdditionalReset"===t||"canLearnerViewFeedback"===t)"feedbackAdditionalReset"===t?lmsnewsettings.getFeedback.initFeedbackAdditionalSettings():lmsnewsettings.getFeedback.feedbackAdditionalSettingsChanged();else if("discussionsave"==t)lmsnewsettings.getDiscussionSettings.saveDiscussionOpts();else if("discussionreset"==t)lmsnewsettings.getDiscussionSettings.resetDiscussionOpts();else if("reportssave"==t)lmsnewsettings.getReportsSettings.saveReportsOpts();else if("reportsreset"==t)lmsnewsettings.getReportsSettings.resetReportsOpts(0);else if("trainerOpt"==t||"adminOpt"==t||"bothOpt"==t||"sptrainerOpt"==t||"spadminOpt"==t||"spbothOpt"==t)t=t.startsWith("sp")?t.substring(2):t,lmsnewsettings.getReportsSettings.resetReportsOpts(1,t);else if("additionaloptsave"==t)lmsnewsettings.getAdditionOptionsSettings.saveAdditionalOpts();else if("additionaloptsreset"==t)lmsnewsettings.getAdditionOptionsSettings.resetAdditionalOpts(1);else if("createNewCategory"==t)lmsnewsettings.getCategoriesSettings.createCategory();else if("saveCategory"==t){var l=document.querySelector('[rel="createCategory"]').value;lmsnewsettings.getCategoriesSettings.createCategorys(l)}else if("editCategory"==t){var a=e.target.getAttribute("_rel").split("_");i=settingsPage.container.find('[_rel="catElem_'+a[2]+'"]').length>0?a[2]:a[1];var n=settingsPage.container.find('[_rel="catElem_'+i+'"]').find('[rel="catValue"]')[0].innerHTML;lmsnewsettings.getCategoriesSettings.editCategory(i,n.replace(/'/g,"&#39;").replace(/"/g,"&quot;"))}else if("saveEditCategory"==t){var i;a=e.target.getAttribute("_rel").split("_"),l=document.querySelector('[rel="editCategoryVal"]').value;i=settingsPage.container.find('[_rel="catElem_'+a[2]+'"]').length>0?a[2]:a[1],lmsnewsettings.getCategoriesSettings.editCategoryWithId(i,l,a[0])}else if("deleteCategory"==t){a=e.target.getAttribute("_rel").split("_");ModuleComp.Modal.delete((function(){lmsnewsettings.getCategoriesSettings.deleteCategory(a[1])}),ZPI18N.getString("zp.lms.settings.deleteCategory"),ZPI18N.getString("zp.lms.settings.categorydeletepermenently"),ZPI18N.getString("zp.confirm"))}else if("cancelCategory"==t)document.querySelector('[rel="addCategoryPopUp"]')?document.querySelector('[rel="addCategoryPopUp"]').remove():document.querySelector('[rel="editCategoryPopUp"]').remove();else if("coursenotireset"==t||"modulenotireset"==t||"discussionnotireset"==t||"lpnotireset"==t||"assignmentnotireset"==t||"managepermnotireset"==t||"feedbacknotireset"==t||"managerEvalnotireset"==t){var o="coursenotireset"==t?0:"modulenotireset"==t?1:"discussionnotireset"==t?2:"lpnotireset"==t?3:"assignmentnotireset"==t?4:"managepermnotireset"==t?5:"feedbacknotireset"==t?6:7;lmsnewsettings.resetNotiOpts(o)}else if("allow"==t||"spallow"==t||"dontallow"==t||"spdontallow"==t||"required"==t||"sprequired"==t||"notrequired"==t||"spnotrequired"==t||"allusers"==t||"spallusers"==t||"limitedusers"==t||"splimitedusers"==t){var c=t.startsWith("sp")?e.target.parentElement.getAttribute("for").split("_")[1]:e.target.getAttribute("_rel").split("_")[1],d=t.startsWith("sp")?e.target.parentElement.closest('[class = "zpl_secn"]').getAttribute("rel"):e.target.closest('[class="zpl_secn"]').getAttribute("rel");t.startsWith("sp")?lmsnewsettings.getManagePermsSettings.optionChange(t.substring(2),c,d):lmsnewsettings.getManagePermsSettings.optionChange(t,c,d)}else if("addCondition"==t){a=e.target.getAttribute("_rel").split("_"),d=e.target.closest('[class="zpl_secn"]').getAttribute("rel").split("_")[0];lmsnewsettings.getManagePermsSettings.addUsers(a[1],d)}else if("atodelete"==t){c=e.target.getAttribute("_rel").split("_")[1],d=e.target.closest('[class="zpl_secn"]').getAttribute("rel");var m=e.target.closest('[rel="newUser"]').getAttribute("_rel");lmsnewsettings.getManagePermsSettings.deleteOption(c,m,d)}else if("managepermsave"==t){var u="getLpPerm"==(p=e.target.closest('[class="zpl_rgtcnt"]').getAttribute("rel"))?0:"getSelfPerm"==p?1:"getIltPerm"==p?2:3;lmsnewsettings.getManagePermsSettings.configSave(u)}else if("managepermreset"==t){var p;"getLpPerm"==(p=e.target.closest('[class="zpl_rgtcnt"]').getAttribute("rel"))?lmsnewsettings.getLearningPlanSettings.init(1):"getSelfPerm"==p?lmsnewsettings.getSelfPacedSettings.init(1):"getIltPerm"==p?lmsnewsettings.getBlendedSettings.init(1):lmsnewsettings.getDigitalSettings.init(1)}else"add"==t?lmsnewsettings.getTrainers.addTrainers():"more"==t?lmstrainers.moreMenu(e.target,e,1):"trainerFilter"==t?lmsnewsettings.getTrainers.filterInstance?lmsnewsettings.getTrainers.filterInstance.constructFilter():lmsnewsettings.getTrainers.getFilterInstance().constructFilter():"trainerFilterCancel"==t?lmsnewsettings.getTrainers.reset(1):"trainerFilterReset"==t?(settingsPage.container.removeClass("zpl_fltr_flt"),lmsnewsettings.getTrainers.reset(0)):"trainerFilterApply"==t?(settingsPage.container.removeClass("zpl_fltr_flt"),await lmstrainers.getTrainers(lmsnewsettings.getTrainers.constructTrainers,2)):"trainerInfo"==t&&lmsnewsettings.getTrainers.trainerInfo(e.target.getAttribute("_trnrId"))},clickPopupHandler:function(e){var t=e.target.getAttribute("rel");"saveTrainer"==t?lmsnewsettings.getTrainers.saveTrainer():"cancelTrainer"==t?lmsnewsettings.getTrainers.cancelTrainer():"cancelTrainerInfo"==t&&lmsnewsettings.getTrainers.cancelTrainerInfo()},loadMore:async function(e){let t=e.tab;if(lmsnewsettings.refer.index=lmsnewsettings.refer.index+25,"tab-lms-trainers"==t){let e=lmstrainers.lastRequestParams;e&&(e.startIndex=lmsnewsettings.refer.index),await lmstrainers.getTrainers(lmsnewsettings.getTrainers.constructTrainers,1,null,e)}"tab-lms-rooms"==t&&lmsnewsettings.getRooms.fetchRooms(lmsnewsettings.getRooms.roomsIndex)},resetSaveEnable:function(e,t,s,r,l,a){if(1!=e&&(t=this),"general"==r||2!=e&&null!=t&&"general"==t.getAttribute("rel")?s?(document.querySelector('[rel="generalSettings"]').querySelector("[ispagedatachanged=true]")&&document.querySelector('[rel="generalSettings"]').querySelector("[ispagedatachanged=true]").removeAttribute("isPageDataChanged"),document.querySelector('[rel="generalHeaderButtons"]').classList.add("DNI")):lmsnewsettings.dataChanged("generalHeaderDiv")?lmsnewsettings.isDataChangedPopup("generalHeaderDiv","generalHeaderButtons"):(document.querySelector('[rel="generalHeaderButtons"]').classList.add("DNI"),document.querySelector('[rel="generalSettings"]').querySelector("[ispagedatachanged=true]")&&document.querySelector('[rel="generalSettings"]').querySelector("[ispagedatachanged=true]").removeAttribute("isPageDataChanged")):"additionalOpt"==r||2!=e&&null!=t&&"additionalOpt"==t.getAttribute("rel")?s?(document.querySelector('[rel="generalSettings"]').querySelector("[ispagedatachanged=true]")&&document.querySelector('[rel="generalSettings"]').querySelector("[ispagedatachanged=true]").removeAttribute("isPageDataChanged"),document.querySelector('[rel="addOptHeaderButtons"]').classList.add("DNI")):lmsnewsettings.dataChanged("addOptHeaderDiv",a)?lmsnewsettings.isDataChangedPopup("addOptHeaderDiv","addOptHeaderButtons"):(document.querySelector('[rel="addOptHeaderButtons"]').classList.add("DNI"),document.querySelector('[rel="generalSettings"]').querySelector("[ispagedatachanged=true]")&&document.querySelector('[rel="generalSettings"]').querySelector("[ispagedatachanged=true]").removeAttribute("isPageDataChanged")):null!=t&&"feedBack"==t.getAttribute("rel")?document.querySelector('[rel="feedbackHeaderButtons"]').classList.remove("DNI"):null!=t&&"discuss"==t.getAttribute("rel")?s?(document.querySelector('[rel="discussSettHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="discussSettHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="discussSettHeaderButtons"]').classList.remove("DNI")):lmsnewsettings.dataChanged("discussSettHeaderDiv")?lmsnewsettings.isDataChangedPopup("discussSettHeaderDiv","discussSettHeaderButtons"):document.querySelector('[rel="discussSettHeaderButtons"]').classList.add("DNI"):null!=t&&"reports"==t.getAttribute("rel")?(document.querySelector('[rel="reportsHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="reportsHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="reportsHeaderButtons"]').classList.remove("DNI"),lmsnewsettings.dataChanged("reportsHeaderDiv")?lmsnewsettings.isDataChangedPopup("reportsHeaderDiv","reportsHeaderButtons"):document.querySelector('[rel="reportsHeaderButtons"]').classList.add("DNI")):null!=t&&"courseNotiElem"==t.getAttribute("rel")?s?(document.querySelector('[rel="courseHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="courseHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="courseHeaderButtons"]').classList.remove("DNI")):lmsnewsettings.dataChanged("courseHeaderDiv")?lmsnewsettings.isDataChangedPopup("courseHeaderDiv","courseHeaderButtons"):document.querySelector('[rel="courseHeaderButtons"]').classList.add("DNI"):null!=t&&"moduleNotiElem"==t.getAttribute("rel")?s?(document.querySelector('[rel="moduleHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="moduleHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="moduleHeaderButtons"]').classList.remove("DNI")):lmsnewsettings.dataChanged("moduleHeaderDiv")?lmsnewsettings.isDataChangedPopup("moduleHeaderDiv","moduleHeaderButtons"):document.querySelector('[rel="moduleHeaderButtons"]').classList.add("DNI"):null!=t&&"discussNotiElem"==t.getAttribute("rel")?s?(document.querySelector('[rel="discussHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="discussHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="discussHeaderButtons"]').classList.remove("DNI")):lmsnewsettings.dataChanged("discussHeaderDiv")?lmsnewsettings.isDataChangedPopup("discussHeaderDiv","discussHeaderButtons"):document.querySelector('[rel="discussHeaderButtons"]').classList.add("DNI"):null!=t&&"lpNotiElem"==t.getAttribute("rel")?s?(document.querySelector('[rel="lpHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="lpHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="lpHeaderButtons"]').classList.remove("DNI")):lmsnewsettings.dataChanged("lpHeaderDiv")?lmsnewsettings.isDataChangedPopup("lpHeaderDiv","lpHeaderButtons"):document.querySelector('[rel="lpHeaderButtons"]').classList.add("DNI"):null!=t&&"assignNotiElem"==t.getAttribute("rel")?s?(document.querySelector('[rel="assignHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="assignHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="assignHeaderButtons"]').classList.remove("DNI")):lmsnewsettings.dataChanged("assignHeaderDiv")?lmsnewsettings.isDataChangedPopup("assignHeaderDiv","assignHeaderButtons"):document.querySelector('[rel="assignHeaderButtons"]').classList.add("DNI"):null!=t&&"mpNotiElem"==t.getAttribute("rel")?s?(document.querySelector('[rel="mpHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="mpHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="mpHeaderButtons"]').classList.remove("DNI")):lmsnewsettings.dataChanged("mpHeaderDiv")?lmsnewsettings.isDataChangedPopup("mpHeaderDiv","mpHeaderButtons"):document.querySelector('[rel="mpHeaderButtons"]').classList.add("DNI"):null!=t&&"fbNotiElem"==t.getAttribute("rel")?s?(document.querySelector('[rel="fbHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="fbHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="fbHeaderButtons"]').classList.remove("DNI")):lmsnewsettings.dataChanged("fbHeaderDiv")?lmsnewsettings.isDataChangedPopup("fbHeaderDiv","fbHeaderButtons"):document.querySelector('[rel="fbHeaderButtons"]').classList.add("DNI"):null!=t&&"managerEvalNotiElem"==t.getAttribute("rel")?s?(document.querySelector('[rel="managerEvalHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="managerEvalHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="managerEvalHeaderButtons"]').classList.remove("DNI")):lmsnewsettings.dataChanged("managerEvalHeaderDiv")?lmsnewsettings.isDataChangedPopup("managerEvalHeaderDiv","managerEvalHeaderButtons"):document.querySelector('[rel="managerEvalHeaderButtons"]').classList.add("DNI"):null!=t&&t&&(t.hasAttribute("rel")&&"lpmoderate"==t.getAttribute("rel")||t.element&&t.element[0]&&t.element[0].hasAttribute("rel")&&"lpmoderate"==t.element[0].getAttribute("rel"))?(ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpModerate")).getState()?lmsnewsettings.getManagePermsSettings.optionChange("required",0):lmsnewsettings.getManagePermsSettings.optionChange("notrequired",0,$(t).closest('[class="zpl_gbox wd100_per"]').attr("rel")),l=!0):null!=t&&t&&(t.hasAttribute("rel")&&"selfmoderate"==t.getAttribute("rel")||t.element&&t.element[0]&&t.element[0].hasAttribute("rel")&&"selfmoderate"==t.element[0].getAttribute("rel"))?(ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfModerate")).getState()?lmsnewsettings.getManagePermsSettings.optionChange("required",1):lmsnewsettings.getManagePermsSettings.optionChange("notrequired",1,$(t).closest('[class="zpl_gbox wd100_per"]').attr("rel")),l=!0):null!=t&&t&&(t.hasAttribute("rel")&&"iltmoderate"==t.getAttribute("rel")||t.element&&t.element[0]&&t.element[0].hasAttribute("rel")&&"iltmoderate"==t.element[0].getAttribute("rel"))?(ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltModerate")).getState()?lmsnewsettings.getManagePermsSettings.optionChange("required",2):lmsnewsettings.getManagePermsSettings.optionChange("notrequired",2,$(t).closest('[class="zpl_gbox wd100_per"]').attr("rel")),l=!0):null!=t&&t&&(t.hasAttribute("rel")&&"selfshare"==t.getAttribute("rel")||t.element&&t.element[0]&&t.element[0].hasAttribute("rel")&&"selfshare"==t.element[0].getAttribute("rel"))?(ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfShare")).getState()?lmsnewsettings.getManagePermsSettings.optionChange("allow",1):lmsnewsettings.getManagePermsSettings.optionChange("dontallow",1,$(t).closest('[class="zpl_gbox wd100_per"]').attr("rel")),l=!0):null!=t&&t&&(t.hasAttribute("rel")&&"iltshare"==t.getAttribute("rel")||t.element&&t.element[0]&&t.element[0].hasAttribute("rel")&&"iltshare"==t.element[0].getAttribute("rel"))?(ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltShare")).getState()?lmsnewsettings.getManagePermsSettings.optionChange("allow",2):lmsnewsettings.getManagePermsSettings.optionChange("dontallow",2,$(t).closest('[class="zpl_gbox wd100_per"]').attr("rel")),l=!0):null!=t&&t&&(t.hasAttribute("rel")&&"edatashare"==t.getAttribute("rel")||t.element&&t.element[0]&&t.element[0].hasAttribute("rel")&&"edatashare"==t.element[0].getAttribute("rel"))&&(ZPeopleComponents.toggleswitch(settingsPage.container.find("#edatashare")).getState()?lmsnewsettings.getManagePermsSettings.optionChange("allow",3):lmsnewsettings.getManagePermsSettings.optionChange("dontallow",3,$(t).closest('[class="zpl_gbox wd100_per"]').attr("rel")),l=!0),l||null!=t&&t.hasOwnProperty("rel")&&"mpPerm"==t.getAttribute("rel")){var n=settingsPage.container.find('[rel="createOpt"]').closest('[class="zpl_secn"]').attr("rel").split("_")[1],i=0==n?"getLpPerm":1==n?"getSelfPerm":2==n?"getIltPerm":"getedataPerm",o=0==n?"lpPermHeaderButtons":1==n?"selfPermHeaderButtons":2==n?"iltPermHeaderButtons":"edataPermHeaderButtons",c=0==n?"lpPermHeaderDiv":1==n?"selfPermHeaderDiv":2==n?"iltPermHeaderDiv":"edataPermHeaderDiv";s?(document.querySelector('[rel="'+i+'"]').querySelector("[ispagedatachanged=true]")&&document.querySelector('[rel="'+i+'"]').querySelector("[ispagedatachanged=true]").removeAttribute("isPageDataChanged"),document.querySelector('[rel="'+o+'"]').classList.add("DNI")):lmsnewsettings.dataChanged(c,n)?lmsnewsettings.isDataChangedPopup(c,o):document.querySelector('[rel="'+o+'"]').classList.add("DNI")}},reInitPage:function(e,t,s){if(document.querySelector('[rel="'+t+'"]')&&document.querySelector('[rel="'+t+'"]').classList.remove("DNI"),"generalHeaderDiv"==e)lmsnewsettings.getGeneralSettings.resetGeneralOpts();else if("addOptHeaderDiv"==e)1==s?lmsnewsettings.getAdditionOptionsSettings.resetAdditionalOpts(2):lmsnewsettings.getAdditionOptionsSettings.resetAdditionalOpts(1);else if("gradeHeaderDiv"==e)lmsnewsettings.getGradingSettings.resetGradingOpts(2);else if("feedbackHeaderDiv"==e)lmsnewsettings.getFeedback.resetFeedbackOpts(0);else if("discussSettHeaderDiv"==e)lmsnewsettings.getDiscussionSettings.resetDiscussionOpts();else if("reportsHeaderDiv"==e)lmsnewsettings.getReportsSettings.resetReportsOpts(0);else if("courseHeaderDiv"==e||"moduleHeaderDiv"==e||"discussHeaderDiv"==e||"lpHeaderDiv"==e||"assignHeaderDiv"==e||"mpHeaderDiv"==e||"fbHeaderDiv"==e||"managerEvalHeaderDiv"==e){var r="courseHeaderDiv"==e?0:"moduleHeaderDiv"==e?1:"discussHeaderDiv"==e?2:"lpHeaderDiv"==e?3:"assignHeaderDiv"==e?4:"mpHeaderDiv"==e?5:"fbHeaderDiv"==e?6:7;lmsnewsettings.resetNotiOpts(r)}},returnSaving:function(){return'<div id="savingHtml"><div class="zpl_atosv"><div class="zpl_atocnt"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i><span>'+ZPI18N.getString("zp.saving")+"</span></div></div></div>"},returnSaved:function(e){return lmsnewsettings.isDataChangedPopup(e,null,!0,0),document.querySelector('[rel="'+e+'"]').querySelector("[ispagedatachanged=true]")&&document.querySelector('[rel="'+e+'"]').querySelector("[ispagedatachanged=true]").removeAttribute("isPageDataChanged"),'<div id="savedHtml"><div class="zpl_atosv"><div class="zpl_atocnt svd"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i><span>'+ZPI18N.getString("zp.saved")+"</span></div></div></div>"},savedFadeOut:function(e){$('[rel="'+e+'"]').find("#savedHtml").fadeOut(1e3)},isDataChanged:function(e,t){var s=settingsPage.container.find("[ispagedatachanged=true]");if(t=1==t?1:0,s.length>0&&lmsnewsettings.dataChanged(s[0].getAttribute("rel"),null,t)&&s.length>0){var r=new InfoAlertMessage;r.title="",r.despcription=ZPI18N.getString("zp.cancelconfmsg"),r.yesButtonText=ZPI18N.getString("zp.proceed"),r.callback=function(t){lmsnewsettings.isDataChangedPopup(s[0].getAttribute("rel"),s[0].querySelector('[_rel="headButtons"]'),!0,1),e()},r.show()}else e()},isPageDataChanged:function(e,t){var s=settingsPage.container.find("[ispagedatachanged=true]");if(s.length>0&&lmsnewsettings.dataChanged(s[0].getAttribute("rel"))&&s.length>0){var r=new InfoAlertMessage;r.title="",r.despcription=ZPI18N.getString("zp.cancelconfmsg"),r.yesButtonText=ZPI18N.getString("zp.proceed"),r.callback=function(r){lmsnewsettings.isDataChangedPopup(s[0].getAttribute("rel"),s[0].querySelector('[_rel="headButtons"]'),!0,1),t(e)},r.show()}else t(e)},isDataChangedPopup:function(e,t,s,r){s?(document.querySelector('[rel="'+e+'"]').querySelector("[ispagedatachanged=true]")&&document.querySelector('[rel="'+e+'"]').querySelector("[ispagedatachanged=true]").removeAttribute("isPageDataChanged"),document.querySelector('[rel="'+e+'"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="'+e+'"]').querySelector('[id="savedHtml"]').remove(),"addOptHeaderDiv"==e&&1==r?lmsnewsettings.reInitPage(e,t,1):1==r&&lmsnewsettings.reInitPage(e,t)):(document.querySelector('[rel="'+e+'"]').setAttribute("isPageDataChanged",!0),document.querySelector('[rel="'+e+'"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="'+e+'"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="'+t+'"]').classList.remove("DNI"))},dataChanged:function(e,t,s){var r=!1;if("generalHeaderDiv"==e){var l=ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltenable")).getState(),a=ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfenable")).getState(),n=ZPeopleComponents.toggleswitch(settingsPage.container.find("#manualenable")).getState(),i=ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpenable")).getState();lmsnewsettings.iltSettingData.isIltenable==l&&lmsnewsettings.selfSettingData.isSelfenable==a&&lmsnewsettings.manualSettingData.isManualenable==n&&lmsnewsettings.lpData.isLpEnable==i||(r=!0)}else if("addOptHeaderDiv"==e){var o=ZPeopleComponents.toggleswitch(settingsPage.container.find("#allowshareableurl")).getState(),c=ZPeopleComponents.toggleswitch(settingsPage.container.find("#enableDisable")).getState();lmsnewsettings.commonSettingData.allowPublishUrl!=o&&(r=!0),lmsnewsettings.commonSettingData.allowNotify!=c&&(r=!0)}else if("gradeHeaderDiv"==e){var d=settingsPage.container.find('[id="nograde"]').prop("checked"),m=settingsPage.container.find('[id="passorfail"]').prop("checked"),u=settingsPage.container.find('[id="totalpoints"]').prop("checked"),p=settingsPage.container.find('[id="lettergrades"]').prop("checked");if(document.querySelector('[rel="tableRow"]').querySelector("tbody").querySelectorAll("tr").length==lmsnewsettings.gradeData.gradeRating.length&&lmsnewsettings.gradeData.noGrade==d&&lmsnewsettings.gradeData.passorfail==m&&lmsnewsettings.gradeData.totalPoints==u&&lmsnewsettings.gradeData.letterGrade==p&&lmsnewsettings.gradeData.minMark==document.querySelector('[rel="coursepassper"]').value||(r=!0),!r)for(var g,f,v,h,b,I,y=document.querySelector('[rel="tableRow"]'),_=0;_<lmsnewsettings.gradeData.gradeRating.length;_++)g=lmsnewsettings.gradeData.gradeRating[_].gradeRatingId,y.querySelector('[_crel="lettergrade_'+g+'"]')?(f=y.querySelector('[_crel="lettergrade_'+g+'"]').value,v=y.querySelector('[srel="lowerrange_'+g+'"]').value,h=y.querySelector('[srel="upperrange_'+g+'"]').value,b=1==ZPeopleComponents.select($('[rel="lettergradestatus_'+g+'"]').find("select")).getValue(),I=lmsnewsettings.gradeData.gradeRating[_].gradeValue.split("-"),lmsform.changetoI18N(lmsnewsettings.gradeData.gradeRating[_].usergrade)==f&&I[0]==v&&I[1]==h&&lmsnewsettings.gradeData.gradeRating[_].status==b||(r=!0)):r=!0}else if("feedbackHeaderDiv"==e){let e=lmsnewsettings.getFeedback.getFeedbackForValues();for(let t=0;t<3;t++)if(lmsnewsettings.commonSettingData.feedbackFor[t]!=e[t]){r=!0;break}let t=settingsPage.container.find('[id="allOpt"]').prop("checked")?"1":"2";ZPeople.decodeTxt(lmsnewsettings.commonSettingData.sessionFeedbackby)!=t&&(r=!0)}else if("feedbackAdditionalHeaderDiv"===e)lmsnewsettings.commonSettingData.canLearnerViewTrainerFeedback!=ZPeopleComponents.toggleswitch(settingsPage.container.find("#canLearnerViewFeedback")).getState()&&(r=!0);else if("discussSettHeaderDiv"==e){var S=ZPeople.decodeTxt(lmsnewsettings.commonSettingData.startDiscBy),C=[];null!=S&&(C=S.match(/[1-9]/g)),null==C||C.includes("1")==settingsPage.container.find("#disccourseadmin").prop("checked")&&C.includes("2")==settingsPage.container.find("#disctrainer").prop("checked")&&C.includes("3")==settingsPage.container.find("#disclearner").prop("checked")?null==C&&(settingsPage.container.find("#disccourseadmin").prop("checked")||settingsPage.container.find("#disctrainer").prop("checked")||settingsPage.container.find("#disclearner").prop("checked"))&&(r=!0):r=!0}else if("reportsHeaderDiv"==e){var P=document.querySelector("#reportExportSettings"),z=ZPeopleComponents.tokenfield(P).getAllValues();if(null!=lmsnewsettings.commonSettingData.empComponents&&lmsnewsettings.commonSettingData.empComponents.length!=z.length)r=!0;else if(null!=lmsnewsettings.commonSettingData.empComponents&&lmsnewsettings.commonSettingData.empComponents.length>0){var N=lmsnewsettings.commonSettingData.empComponents,T=Object.keys(N);for(var _ in T)if(N[T[_]]!=z[T[_]]){r=!0;break}}var w=settingsPage.container.find('[rel="adminOpt"]').prop("checked")?"2":settingsPage.container.find('[rel="trainerOpt"]').prop("checked")?"1":"3";lmsnewsettings.commonSettingData.reportsViewFr!=w&&(r=!0)}else if("lpPermHeaderDiv"==e||"selfPermHeaderDiv"==e||"iltPermHeaderDiv"==e||"edataPermHeaderDiv"==e){var M="lpPermHeaderDiv"==e?"zp.lms.learningplan":"selfPermHeaderDiv"==e?"zp.lms.settings.courseType.self":"iltPermHeaderDiv"==e?"zp.lms.settings.courseType.ILT":"zp.lms.settings.courseType.manuals",L="lpPermHeaderDiv"==e?"lpModerate":"selfPermHeaderDiv"==e?"selfModerate":"iltPermHeaderDiv"==e?"iltModerate":null,k="edataPermHeaderDiv"==e?"edatashare":"selfPermHeaderDiv"==e?"selfShare":"iltPermHeaderDiv"==e?"iltShare":null;stype="lpPermHeaderDiv"==e?0:"selfPermHeaderDiv"==e?1:"iltPermHeaderDiv"==e?2:3;var Z=lmsnewsettings.typebasedData.courseTypeSettingIds[M];Z||(M=0==t?"zp.lms.learningplan":1==t?"Self":2==t?"Ilt":"Manuals",Z=lmsnewsettings.typebasedData.courseTypeSettingIds[M]);var A=lmsnewsettings.savedConfigData[Z]?lmsnewsettings.savedConfigData[Z]:lmsnewsettings.savedConfigData[0],E=settingsPage.container.find('[id="allusers_'+stype+'"]').prop("checked")?0:1,D=null!=L&&settingsPage.container.find("#"+L)&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+L)).getState()?0:1,x=null!=k&&settingsPage.container.find("#"+k)&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+k)).getState()?0:1;if(!A||A.manageCreateOptions.create==E&&A.manageCreateOptions.moderate==D&&A.manageCreateOptions.share==x){var F,O=lmsnewsettings.getManagePermsSettings.configSave(stype,1),R=O?O[Z]:{};if(!Object.keys(R).length)return!0;for(var q=0;q<2;q++){1==q&&(q=2),F=0==q?R.create.users:R.moderate.users;var U=isEmpty(A)||isEmpty(A.applicableUsers)?{}:0==q&&A.applicableUsers[q]||A.applicableUsers[q]?A.applicableUsers[q]:{};for(var B in U)if("type"!=B&&"configType"!=B){if(key2="users"==B?"user":B,0==Object.keys(JSON.parse(U[B])).length&&0==Object.keys(F[key2]).length)continue;if(Object.keys(JSON.parse(U[B])).length!=Object.keys(F[key2]).length)return!0;if(Object.keys(JSON.parse(U[B])).length==Object.keys(F[key2]).length)for(var H in JSON.parse(U[B]))if(!F[key2][H])return!0}}}else r=!0}return r},showErrorField:function(e){let t="<span class='ztextbox--error__label'>"+ZPI18N.getString("zp.validvalue")+"</span>";!e.parentElement.querySelector("span")&&$(e.parentElement).append(t),e.classList.add("ztextbox__error")},getGeneralSettings:{init:async function(){if(0==settingsPage.container.find('[rel="generalSettings"]').length){await lmsnewsettings.getSettingsData(null,1);var e='<div class="zpl_rgtcnt" rel="generalSettings"><div class="zpl_crd"><div class="zpl_crdhdr" rel="generalHeaderDiv"><div><h4>'+ZPI18N.getString("zp.lms.newsettings.learningmethods")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.learningmethodsdesc")+'</p></div><div _rel="headButtons" rel="generalHeaderButtons" class="DNI"><button rel="generalreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="generalsave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="general" id="selfenable">'+ZPI18N.getString("zp.lms.settings.selfpacedtraining")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.selfpaceddesc")+'</p></div></div><div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="general" id="iltenable">'+ZPI18N.getString("zp.lms.settings.InstructorLed")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.iltdesc")+'</p></div></div><div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="general" id="manualenable">'+ZPI18N.getString("zp.lms.settings.DigitalDownloads")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.ematerialdesc")+'</p></div></div><div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="general" id="lpenable">'+ZPI18N.getString("zp.lms.learningplan")+"</h5><p>"+ZPI18N.getString("zp.lms.learningplan.enabledisabledesc")+'</p></div></div></div></div><div class="zpl_crd"><div class="zpl_crdhdr" rel="addOptHeaderDiv"><div><h4>'+ZPI18N.getString("zp.lms.newsettings.courseproperties")+'</h4></div><div rel="addOptHeaderButtons" class="DNI"><button rel="additionaloptsreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="additionaloptsave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="additionalOpt" id="allowshareableurl">'+ZPI18N.getString("zp.lms.newsettings.AllowShareableUrl")+"</h5><p>"+ZPI18N.getString("zp.lms.settings.courseurldesc")+'</p></div></div><div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="additionalOpt" id="enableDisable">'+ZPI18N.getString("zp.notifications")+"</h5><p>"+ZPI18N.getString("zp.lms.settings.AllowNotiDesc")+"</p></div></div></div></div></div>";settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(e),lmsnewsettings.getGeneralSettings.resetGeneralOpts(),lmsnewsettings.getAdditionOptionsSettings.resetAdditionalOpts(),ZPeopleComponents.toggleswitch(settingsPage.container.find('[rel="general"]')),settingsPage.container.find('[rel="general"]').on("ztoggleswitchchange",lmsnewsettings.resetSaveEnable),settingsPage.container.find('[rel="additionalOpt"]').on("ztoggleswitchchange",lmsnewsettings.resetSaveEnable),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1))}},saveGeneralOpts:function(){var e=ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltenable")).getState(),t=ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfenable")).getState(),s=ZPeopleComponents.toggleswitch(settingsPage.container.find("#manualenable")).getState(),r=ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpenable")).getState();if(e||t||s||r){var l={};l[lmsnewsettings.iltSettingData.settingId]=e,l[lmsnewsettings.selfSettingData.settingId]=t,l[lmsnewsettings.manualSettingData.settingId]=s,l[lmsnewsettings.lpData.settingId]=r;var a={settingIdsObj:JSON.stringify(l)};document.querySelector('[rel="generalHeaderButtons"]').classList.add("DNI"),document.querySelector('[rel="generalHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaving(),zplms.put("/lms/settings/general",a,(async function(e){"Success"==e[1].message?(document.querySelector('[id="savingHtml"]').remove(),document.querySelector('[rel="generalHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaved("generalSettings"),lmsnewsettings.savedFadeOut("generalHeaderDiv"),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),await lmsnewsettings.getSettingsData(!0,1)):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.settings.selatleast")),lmsnewsettings.getGeneralSettings.resetGeneralOpts()},resetGeneralOpts:function(){1==lmsnewsettings.iltSettingData.isIltenable?ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltenable")).switchOn():ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltenable")).switchOff(),1==lmsnewsettings.selfSettingData.isSelfenable?ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfenable")).switchOn():ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfenable")).switchOff(),1==lmsnewsettings.manualSettingData.isManualenable?ZPeopleComponents.toggleswitch(settingsPage.container.find("#manualenable")).switchOn():ZPeopleComponents.toggleswitch(settingsPage.container.find("#manualenable")).switchOff(),1==lmsnewsettings.lpData.isLpEnable?ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpenable")).switchOn():ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpenable")).switchOff(),lmsnewsettings.resetSaveEnable(2,null,!0,"general")}},getGradingSettings:{init:async function(e){if(1==e||2==e||0==settingsPage.container.find('[rel="gradeConstruct"]').length){2!=e&&await lmsnewsettings.getSettingsData(null,1);for(var t='<div class="zpl_rgtcnt" rel="gradeConstruct"><div class="zpl_crd"><div class="zpl_crdhdr" rel="gradeHeaderDiv"><div><h4>'+ZPI18N.getString("zp.lms.settings.Grading")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.gradingheadertxt")+'</p></div><div rel="gradeHeaderButtons" class="DNI"><button rel="gradingreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="gradingsave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="nograde" rel="saveResetGrade" type="checkbox" name="check" checked="" class="zcheckbox__helper"><label for="nograde" class="zcheckbox__label">'+ZPI18N.getString("zp.lms.newsettings.nograde")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.lms.gradeSetting.nogradenote")+'</span></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="totalpoints" rel="saveResetGrade" type="checkbox" name="check" checked="" class="zcheckbox__helper"><label for="totalpoints" class="zcheckbox__label">'+ZPI18N.getString("zp.lms.newsettings.totalpoints")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.lms.gradeSetting.totalpointsnote")+'</span></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="passorfail" rel="saveResetGrade" type="checkbox" name="check" checked="" class="zcheckbox__helper"><label for="passorfail" class="zcheckbox__label">'+ZPI18N.getString("zp.lms.newsettings.passfail")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.lms.newsettings.passfailnote")+'</span><div class="zpl_gbox" rel="minpassmark"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.lms.gradeSetting.minpassmark")+'</span><div><div class="ztextbox--group ztextbox--zicon zpl_inpticfild zh-alignright"><span class="ztextbox__icon">%</span><input type="text" class="ztextbox w100" value="'+lmsnewsettings.gradeData.minMark+'" name="minimummark" rel="coursepassper"></div></div></div></div></div></div><div class="zpl_secn"><div class="chkdectxt"><div class="zcheckbox"><input id="lettergrades" rel="saveResetGrade" type="checkbox" name="check" checked="" class="zcheckbox__helper"><label for="lettergrades" class="zcheckbox__label">'+ZPI18N.getString("zp.lms.newsettings.lettergrade")+'</label></div><span class="dectxt">'+ZPI18N.getString("zp.lms.newsettings.lettergradenote")+'</span><div class="zpl_tblres" rel="tableRow"><table class="zpl_tbl"><thead><tr><th rowspan="2" width="30%">'+ZPI18N.getString("zp.lms.newsettings.gradescale")+'</th><th rowspan="2" width="40%">'+ZPI18N.getString("zp.range")+'</th><th rowspan="2" width="20%">'+ZPI18N.getString("zp.status")+'</th><th width="80"></th></tr></thead><tbody>',s="",r=0;r<lmsnewsettings.gradeData.gradeRating.length;r++)s="","100"==lmsnewsettings.gradeData.gradeRating[r].gradeValue.split("-")[1]&&(s="disabled"),0!=settingsPage.container.find("#lettergradestatus_"+r).length&&ZPeopleComponents.select(settingsPage.container.find("#lettergradestatus_"+r)).destroy(),"undefined"==lmsnewsettings.gradeData.gradeRating[r].gradeRatingId?(id=settingsPage.container.find('[rel="newLetterGrade"]').length+1,t+='<tr _gradeRatingId="'+id+'" rel="newLetterGrade">'):(id=lmsnewsettings.gradeData.gradeRating[r].gradeRatingId,t+='<tr _gradeRatingId="'+id+'">'),t+='<td><input rel="saveResetGrade" id="gradeMark_'+id+'" _crel="lettergrade_'+id+'" _rel="'+id+'_gradeMark" type="text" _srel="gradeMark" class="ztextbox w150 text-uppercase" value="'+lmsform.changetoI18N(lmsnewsettings.gradeData.gradeRating[r].usergrade)+'"></td><td><div class="zpl_idiv"><div class="ztextbox--group ztextbox--zicon zpl_inpticfild zh-alignright w100"><span class="ztextbox__icon">%</span><input id="lowerBound_'+id+'" rel="saveResetGrade" _srel="lowerBound" srel="lowerrange_'+id+'" _rel="'+id+'_lowerBound" _type="num" type="text" class="ztextbox w100" value="'+lmsnewsettings.gradeData.gradeRating[r].gradeValue.split("-")[0]+'"></div><em>-</em><div class="ztextbox--group ztextbox--zicon zpl_inpticfild zh-alignright w100"><span class="ztextbox__icon">%</span><input id="upperBound_'+id+'" rel="saveResetGrade" _srel="upperBound" srel="upperrange_'+id+'" _rel="'+id+'_upperBound" _type="num" type="text" class="ztextbox w100 '+s+'" value="'+lmsnewsettings.gradeData.gradeRating[r].gradeValue.split("-")[1]+'"></div></div></td><td class="'+s+'" rel="lettergradestatus_'+id+'" _rel="lettergradestatus_'+id+'"><select _srel="lettergradestatus" id="lettergradestatus_'+id+'" class="select-js" data-content-type="image-text" style="display: none;"></select></td>',lmsnewsettings.gradeData.gradeRating.length>1&&(t+='<td><div class="zpl_hvr"><i class="PI_delete" rel="deletegrade" _rel="gradeTypeDel_'+id+'"></i></div></td>'),t+="</tr>";t+='</tbody></table><div class="zpl_idiv"><a class="zpl_lnkbg" rel="addGradeTypeRel">'+ZPI18N.getString("zp.lms.gradeSetting.addgrade")+"</a></div></div></div></div></div></div></div>",settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(t),lmsnewsettings.getGradingSettings.resetGradingOpts(),lmsbase.addListener(document.querySelector('[rel="gradeConstruct"]'),"focusin",lmsnewsettings.getGradingSettings.focusinHandler,!1),lmsbase.addListener(document.querySelector('[rel="gradeConstruct"]'),"focusout",lmsnewsettings.getGradingSettings.focusoutHandler,!1),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1),lmsbase.addListener(settingsPage.container[0],"input",lmsnewsettings.getGradingSettings.inputHandler,!1),settingsPage.container.find("#lettergrades").change((function(){settingsPage.container.find("#lettergrades").prop("checked")?(document.querySelector('[rel="tableRow"]').classList.remove("DNI"),lmsnewsettings.getGradingSettings.changePassFail()):document.querySelector('[rel="tableRow"]').classList.add("DNI")})),settingsPage.container.find("#passorfail").change((function(){settingsPage.container.find("#passorfail").prop("checked")?document.querySelector('[rel="minpassmark"]').classList.remove("DNI"):document.querySelector('[rel="minpassmark"]').classList.add("DNI")})))}},addGrade:function(e){var t=lmsnewsettings.existingGradeData;firstUp=t[0].gradeValue.split("-")[1],lastLow=t[t.length-1].gradeValue.split("-")[0],firstUp=parseInt(firstUp),lastLow=parseInt(lastLow);var s=document.querySelector('[rel="tableRow"]').querySelector("tbody").lastChild,r=(s.parentNode,100),l="",a="1";null!=s&&(rel=s.querySelector('[_srel="lowerBound"]'),r=rel.value,gradeId=s.getAttribute("_graderatingid"),rel=s.querySelector('[_rel="'+gradeId+'_gradeMark"]'),l=rel.value,a=ZPeopleComponents.select($('[_rel="lettergradestatus_'+gradeId+'"]').find("select")).getValue()),""!=l.trim()?0!=parseInt(r)?(r=parseInt(r)-1,id=settingsPage.container.find('[rel="newLetterGrade"]').length+1,lmsnewsettings.getGradingSettings.constructliElem("",0,r,a,id,2),lmsnewsettings.isDataChangedPopup("gradeHeaderDiv","gradeHeaderButtons")):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.toaddgrade")):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade"))},constructliElem:function(e,t,s,r,l,a){var n=[{label:ZPI18N.getString("zp.lms.gradeBook.pass"),value:1,iconClassName:"PI_tick2 grn"},{label:ZPI18N.getString("zp.lms.gradeBook.fail"),value:2,iconClassName:"PI_cls2 red"}],i="";1!=a&&2!=a?i+='<tr _gradeRatingId="'+l+'">':2==a&&(i+='<tr _gradeRatingId="'+l+'" rel="newLetterGrade">');var o="";"100"==s&&(o+=" disabled"),i+='<td><input rel="saveResetGrade" id="gradeMark_'+l+'" _crel="lettergrade_'+l+'" _rel="'+l+'_gradeMark" _srel="gradeMark" type="text" class="ztextbox w150 text-uppercase" value="'+lmsform.changetoI18N(e)+'"></td><td><div class="zpl_idiv"><div class="ztextbox--group ztextbox--zicon zpl_inpticfild zh-alignright w100"><span class="ztextbox__icon">%</span><input id="lowerBound_'+l+'" rel="saveResetGrade" _srel="lowerBound" srel="lowerrange_'+l+'" _rel="'+l+'_lowerBound" _type="num" type="text" class="ztextbox w100" value="'+t+'"></div><em>-</em><div class="ztextbox--group ztextbox--zicon zpl_inpticfild zh-alignright w100"><span class="ztextbox__icon">%</span><input id="upperBound_'+l+'" rel="saveResetGrade" _srel="upperBound" srel="upperrange_'+l+'" _rel="'+l+'_upperBound" _type="num" type="text" class="ztextbox w100 '+o+'" value="'+s+'"></div></div></td><td class="'+o+'" rel="lettergradestatus_'+l+'" _rel="lettergradestatus_'+l+'"><select _srel="lettergradestatus" id="lettergradestatus_'+l+'" class="select-js" data-content-type="image-text" style="display: none;"></select></td>';var c=document.querySelector('[rel="tableRow"]').querySelector("tbody").querySelectorAll("tr").length;(0==a&&lmsnewsettings.existingGradeData.length>0||1==a&&c>1||2==a&&c>=0)&&(i+='<td><div class="zpl_hvr"><i class="PI_delete" rel="deletegrade" _rel="gradeTypeDel_'+l+'"></i></div></td>'),1!=a&&(i+="</tr>"),0!=settingsPage.container.find("#lettergradestatus_"+l).length&&ZPeopleComponents.select(settingsPage.container.find("#lettergradestatus_"+l)).destroy(),1==a?document.querySelector('[_gradeRatingId="'+l+'"]').innerHTML=i:$('[rel="gradeConstruct"]').find("tbody").append(i);var d=1==r?1:2;if(ZPeopleComponents.select(settingsPage.container.find("#lettergradestatus_"+l)).addOption(n),ZPeopleComponents.select(settingsPage.container.find("#lettergradestatus_"+l)).setValue(d),settingsPage.container.find("#lettergradestatus_"+l).on("zselectchange",lmsnewsettings.getGradingSettings.callBackGradeParams),lmsbase.addListener(document.querySelector('[rel="gradeConstruct"]'),"focusin",lmsnewsettings.getGradingSettings.focusinHandler,!1),lmsbase.addListener(document.querySelector('[rel="gradeConstruct"]'),"focusout",lmsnewsettings.getGradingSettings.focusoutHandler,!1),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1),lmsbase.addListener(settingsPage.container[0],"input",lmsnewsettings.getGradingSettings.inputHandler,!1),0==a&&lmsnewsettings.existingGradeData.length>0||0!=a&&2==document.querySelector('[rel="tableRow"]').querySelector("tbody").querySelectorAll("tr").length){var m=document.querySelector('[rel="tableRow"]').querySelector("tbody").querySelector("tr");null==document.querySelector('[_rel="gradeTypeDel_'+m.getAttribute("_graderatingid")+'"]')&&(i='<td><div class="zpl_hvr"><i class="PI_delete" rel="deletegrade" _rel="gradeTypeDel_'+m.getAttribute("_graderatingid")+'"></i></div></td>',$(m).append(i))}settingsPage.container.find("#lettergrades").change((function(){settingsPage.container.find("#lettergrades").prop("checked")?(document.querySelector('[rel="tableRow"]').classList.remove("DNI"),lmsnewsettings.getGradingSettings.changePassFail()):document.querySelector('[rel="tableRow"]').classList.add("DNI")})),settingsPage.container.find("#passorfail").change((function(){settingsPage.container.find("#passorfail").prop("checked")?document.querySelector('[rel="minpassmark"]').classList.remove("DNI"):document.querySelector('[rel="minpassmark"]').classList.add("DNI")}))},focusinHandler:function(e){document.querySelector('[id="savedHtml"]')&&document.querySelector('[id="savedHtml"]').remove();var t=e.target;t.getAttribute("_srel"),t.getAttribute("_rel");lmsnewsettings.getGradingSettings.previousValue=e.target.value},focusoutHandler:function(e){var t=e.target,s=t.getAttribute("id")?t.getAttribute("id").split("_")[0]:"",r=e.target.closest("tr"),l=!1;"lowerBound"==s?l=lmsnewsettings.getGradingSettings.validateLowerBound(t.getAttribute("id"),t,r):"upperBound"==s?l=lmsnewsettings.getGradingSettings.validateUpperBound(t.getAttribute("id"),t,r):"gradeMark"==s&&(l=lmsnewsettings.getGradingSettings.validateGrade(t.getAttribute("id"),t,r)),l&&lmsnewsettings.isDataChangedPopup("gradeHeaderDiv","gradeHeaderButtons")},validateLowerBound:function(e,t,s){var r=s.nextElementSibling,l=e.split("_"),a=t.value,n=null,i=null,o=null,c=document.querySelector('[rel="tableRow"]').querySelector("tbody"),d=(n=c.querySelector('[srel="upperrange_'+l[1]+'"]')).value,m=c.querySelector('[_rel="'+l[1]+'_gradeMark"]').value;if(""==m)return t.value=lmsnewsettings.getGradingSettings.previousValue,ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade")),!1;if(a==lmsnewsettings.getGradingSettings.previousValue)return!1;if(null!=r&&(o=r.getAttribute("_gradeRatingId")),null==o)(a=parseInt(a))<(d=parseInt(d))&&""!=m.trim()?t.value=a:t.value=lmsnewsettings.getGradingSettings.previousValue;else{if(i=c.querySelector('[srel="upperrange_'+o+'"]'),_difflowerBound=c.querySelector('[srel="lowerrange_'+o+'"]'),_lowVal=_difflowerBound.value,!(t.value&&t.value<parseInt(n.value)&&t.value>parseInt(_difflowerBound.value)))return t.value=lmsnewsettings.getGradingSettings.previousValue,ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.range",[d,_lowVal])),!1;i.value=parseInt(t.value)-1}return!0},validateUpperBound:function(e,t,s){var r=s.previousElementSibling,l=e.split("_"),a=t.value,n=null,i=null,o=document.querySelector('[rel="tableRow"]').querySelector("tbody"),c=null;if(""==o.querySelector('[_rel="'+l[1]+'_gradeMark"]').value)return t.value=lmsnewsettings.getGradingSettings.previousValue,ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade")),!1;if(a==lmsnewsettings.getGradingSettings.previousValue)return!1;if(null!=r&&(c=r.getAttribute("_gradeRatingId")),null!=c){if(n=o.querySelector('[srel="lowerrange_'+l[1]+'"]'),i=o.querySelector('[srel="lowerrange_'+c+'"]'),_diffupperBound=o.querySelector('[srel="upperrange_'+c+'"]'),_upVal=_diffupperBound.value,_lowVal=n.value,!(t.value&&t.value<parseInt(_diffupperBound.value)&&t.value>parseInt(n.value)))return t.value=lmsnewsettings.getGradingSettings.previousValue,ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.range",[_upVal,_lowVal])),!1;i.value=parseInt(t.value)+1}return!0},validateGrade:function(e,t,s){var r=s.parentElement.querySelectorAll('[_srel="gradeMark"]'),l=t.value;if(l==lmsnewsettings.getGradingSettings.previousValue)return!1;if(l.length>100)return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.gradelength")),!1;if(""==l.trim())return t.value=lmsnewsettings.getGradingSettings.previousValue,!1;var a=0;l=l.toLowerCase();for(var n=0;n<r.length;n++)if(cmpVal=r[n].value.toLowerCase(),cmpVal==l&&a++,a>1)return t.value=lmsnewsettings.getGradingSettings.previousValue,ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.uniquegrade")),!1;return a<2&&(t.value=l),!0},editGradeType:function(e,t){var s=1==t?e.target.closest("tr"):e.target.closest("tr")[0],r=e.target,l=1==t?r.getAttribute("_srel"):r[0].getAttribute("_srel"),a=null,n={};"lowerBound"==l?a=s.nextElementSibling:"upperBound"==l&&(a=s.previousElementSibling);var i=s.getAttribute("_gradeRatingId"),o=s.querySelector('[_srel="gradeMark"]').value,c=s.querySelector('[_srel="lowerBound"]').value,d=s.querySelector('[_srel="upperBound"]').value,m=ZPeopleComponents.select($('[_rel="lettergradestatus_'+i+'"]').find("select")).getValue(),u="",p=null;if(null!=a&&null!=(u=a.getAttribute("_gradeRatingId"))&&(p=a.querySelector('[_srel="lowerBound"]').value+"-"+a.querySelector('[_srel="upperBound"]').value),""!=o.trim()){var g=[];gradeObj={gradeRatingId:i,gradeValue:o.toUpperCase(),gradeMark:c+"-"+d,gradeStatus:m},otherGradeObj={gradeRatingId:u,gradeMark:p},g.push(gradeObj),g.push(otherGradeObj),n.method="editGradeType",n.gradeSetting=JSON.stringify(g),n.conreqcsr=csrfToken,$.post("/gradeSettingAction.zp",n,(function(e){0==e[1].status?ModuleComp.Msg.showFailureMsg("Error while update grade"):(lmsnewsettings.gradeData.gradeRating=e[1].gradeRating,lmsnewsettings.getGradingSettings.changePassFail())}))}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade"))},callBackGradeParams:function(){var e=this.value,t=this.getAttribute("id").split("_")[1];ZPeopleComponents.select(settingsPage.container.find("#"+this.getAttribute("id"))).setValue(e);var s=document.querySelector('[rel="tableRow"]').querySelector("tbody").querySelectorAll("tr"),r=Number(document.querySelector('[srel="upperrange_'+t+'"]').getAttribute("value")),l=Number(document.querySelector('[srel="lowerrange_'+t+'"]').getAttribute("value"));if(1==e)for(var a=0;a<s.length;a++)r<=Number(s[a].querySelector('[srel="lowerrange_'+s[a].getAttribute("_graderatingid")+'"]').getAttribute("value"))&&ZPeopleComponents.select(settingsPage.container.find("#lettergradestatus_"+s[a].getAttribute("_graderatingid"))).setValue(e);else for(a=0;a<s.length;a++)l>=Number(s[a].querySelector('[srel="upperrange_'+s[a].getAttribute("_graderatingid")+'"]').getAttribute("value"))&&ZPeopleComponents.select(settingsPage.container.find("#lettergradestatus_"+s[a].getAttribute("_graderatingid"))).setValue(e);lmsnewsettings.getGradingSettings.resetGradingOpts(1)},inputHandler:function(e){var t=e.target,s=t.getAttribute("_type"),r=t.getAttribute("name");if("num"==s||"minimummark"==r){var l=t.value,a=l.replace(/[\\A-Za-z!"$%^&\-\)\(*+_={};:'@#~,.\/<>\" "\?|`\]\[]/g,"");l>100&&(a=100),e.target.value=a,e.target.setAttribute("value",a),"minimummark"==r||lmsnewsettings.dataChanged("gradeHeaderDiv")?lmsnewsettings.isDataChangedPopup("gradeHeaderDiv","gradeHeaderButtons"):document.querySelector('[rel="gradeHeaderButtons"]').classList.add("DNI")}},saveGradingOpts:function(){var e={};e.nograde=!!settingsPage.container.find("#nograde").prop("checked"),e.passorfail=!!settingsPage.container.find("#passorfail").prop("checked"),e.totalpoints=!!settingsPage.container.find("#totalpoints").prop("checked"),e.lettergrade=!!settingsPage.container.find("#lettergrades").prop("checked"),e.gradeSetting=lmsnewsettings.getGradingSettings.constructGradeParams(),-1!=e.gradeSetting&&(e.minimummark=document.querySelector('[rel="coursepassper"]').value,""==e.minimummark&&(e.minimummark=30),document.querySelector('[rel="gradeHeaderButtons"]').classList.add("DNI"),document.querySelector('[rel="gradeHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaving(),zplms.put("/lms/settings/grade",e,(function(e){if(null!=e[0]){document.querySelector('[id="savingHtml"]').remove(),document.querySelector('[rel="gradeHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaved("gradeConstruct"),lmsnewsettings.savedFadeOut("gradeHeaderDiv"),lmsnewsettings.gradeData=e[1],lmsnewsettings.existingGradeData=Object.assign([],lmsnewsettings.gradeData.gradeRating);for(var t=document.querySelector('[rel="tableRow"]').querySelector("tbody").querySelectorAll('[_srel="lettergradestatus"]'),s=0;s<t.length;s++)ZPeopleComponents.select(settingsPage.container.find("#"+t[s].getAttribute("id"))).destroy();lmsnewsettings.getGradingSettings.init(2),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.gradeSetting.updategrade"))}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.errorupdategrade"))})))},constructGradeParams:function(){for(var e=[],t={},s=document.querySelector('[rel="tableRow"]'),r=document.querySelector('[rel="tableRow"]').querySelector("tbody").querySelectorAll("tr"),l=0;l<r.length;l++){var a=r[l].getAttribute("_graderatingid"),n=s.querySelector('[_crel="lettergrade_'+a+'"]').value,i=s.querySelector('[srel="lowerrange_'+a+'"]').value,o=s.querySelector('[srel="upperrange_'+a+'"]').value,c=ZPeopleComponents.select($('[rel="lettergradestatus_'+a+'"]').find("select")).getValue();if(!n.trim())return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade")),-1;if(n.length>100)return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.gradelength")),-1;t={gradeMark:i+"-"+o,gradeValue:n.toUpperCase(),gradeStatus:c},"undefined"!=a&&(t.gradeRatingId=a),e.push(t)}return JSON.stringify(e)},resetGradingOpts:function(e){1==e?lmsnewsettings.dataChanged("gradeHeaderDiv")?(document.querySelector('[rel="gradeHeaderButtons"]').classList.remove("DNI"),lmsnewsettings.isDataChangedPopup("gradeHeaderDiv","gradeHeaderButtons")):document.querySelector('[rel="gradeHeaderButtons"]').classList.add("DNI"):(document.querySelector('[rel="gradeHeaderDiv"]')&&document.querySelector('[rel="gradeHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="gradeHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="gradeHeaderButtons"]')&&document.querySelector('[rel="gradeHeaderButtons"]').classList.add("DNI"),settingsPage.container.find("#nograde").prop("checked",!!lmsnewsettings.gradeData.noGrade),settingsPage.container.find("#passorfail").prop("checked",!!lmsnewsettings.gradeData.passorfail),settingsPage.container.find("#totalpoints").prop("checked",!!lmsnewsettings.gradeData.totalPoints),settingsPage.container.find("#lettergrades").prop("checked",!!lmsnewsettings.gradeData.letterGrade),lmsnewsettings.gradeData.letterGrade?lmsnewsettings.getGradingSettings.changePassFail():document.querySelector('[rel="tableRow"]').classList.add("DNI"),lmsnewsettings.gradeData.passorfail?document.querySelector('[rel="minpassmark"]').classList.remove("DNI"):document.querySelector('[rel="minpassmark"]').classList.add("DNI"))},delGradeNotify:function(e){lmsnotify.show({header:ZPI18N.getString("zp.lms.gradeSetting.lettergrade.deletelable"),body:"",button_text:ZPI18N.getString("zp.confirm"),texttype:"negative",successCallback:function(){this.status&&lmsnewsettings.getGradingSettings.delGradeSetting(e)},cancelCallback:function(){}})},delGradeSetting:function(e){var t=e.target.closest("tr"),s=t.getAttribute("_gradeRatingId"),r=t.querySelector('[_rel = "'+s+'_upperBound"]').value,l=t.nextSibling,a=null!=l?l.getAttribute("_gradeRatingId"):null,n=0,i="",o=1;null!=a?(n=l.querySelector('[_rel="'+a+'_lowerBound"]').value,i=l.querySelector('[_rel="'+a+'_gradeMark"]').value,o=ZPeopleComponents.select($('[_rel="lettergradestatus_'+a+'"]').find("select")).getValue()):a=0,ZPeopleComponents.select($("#lettergradestatus_"+s)).destroy(),t.remove(),lmsnewsettings.dataChanged("gradeHeaderDiv")?lmsnewsettings.isDataChangedPopup("gradeHeaderDiv","gradeHeaderButtons"):document.querySelector('[rel="gradeHeaderButtons"]').classList.add("DNI");var c=document.querySelector('[rel="tableRow"]').querySelector("tbody");if(1==c.querySelectorAll("tr").length){var d=c.querySelector("tr").getAttribute("_graderatingid");c.querySelector("tr").querySelector('[_rel="gradeTypeDel_'+d+'"]').closest("td").remove()}for(var m=0;m<lmsnewsettings.gradeData.gradeRating.length;m++)lmsnewsettings.gradeData.gradeRating[m]&&s==lmsnewsettings.gradeData.gradeRating[m].gradeRatingId&&delete lmsnewsettings.gradeData.gradeRating[m];var u=[];for(m=0;m<lmsnewsettings.gradeData.gradeRating.length;m++)lmsnewsettings.gradeData.gradeRating[m]&&u.push(lmsnewsettings.gradeData.gradeRating[m]);lmsnewsettings.gradeData.gradeRating=u,0!=a&&lmsnewsettings.getGradingSettings.constructliElem(i.toUpperCase(),n,r,o,a,1)},changePassFail:function(){var e;e=lmsnewsettings.existingGradeData?lmsnewsettings.existingGradeData:lmsnewsettings.gradeData.gradeRating;for(var t=[{label:ZPI18N.getString("zp.lms.gradeBook.pass"),value:1,iconClassName:"PI_tick2 grn"},{label:ZPI18N.getString("zp.lms.gradeBook.fail"),value:2,iconClassName:"PI_cls2 red"}],s="",r=0;r<e.length;r++)s=e[r].status?1:2,lmsnewsettings.existingGradeData?(settingsPage.container.find("#lettergradestatus_"+e[r].gradeRatingId).length>0&&(ZPeopleComponents.select(settingsPage.container.find("#lettergradestatus_"+e[r].gradeRatingId)).destroy(),document.querySelector('[_graderatingid="'+e[r].gradeRatingId+'"]').remove()),lmsnewsettings.getGradingSettings.constructliElem(e[r].usergrade,e[r].gradeValue.split("-")[0],e[r].gradeValue.split("-")[1],e[r].status,e[r].gradeRatingId,0)):(ZPeopleComponents.select(settingsPage.container.find("#lettergradestatus_"+e[r].gradeRatingId)).addOption(t),ZPeopleComponents.select(settingsPage.container.find("#lettergradestatus_"+e[r].gradeRatingId)).setValue(s),settingsPage.container.find("#lettergradestatus_"+e[r].gradeRatingId).on("zselectchange",lmsnewsettings.getGradingSettings.callBackGradeParams))}},getFeedback:{init:async function(){if(0==settingsPage.container.find('[rel="getFeedback"]').length){await lmsnewsettings.getSettingsData(null,1),0!=settingsPage.container.find("#feedbackby").length&&ZPeopleComponents.select(settingsPage.container.find("#feedbackby")).destroy(),0!=settingsPage.container.find("#whenfeedback").length&&ZPeopleComponents.select(settingsPage.container.find("#whenfeedback")).destroy(),0!=settingsPage.container.find("#feedbackappliedto").length&&ZPeopleComponents.select(settingsPage.container.find("#feedbackappliedto")).destroy();var e='<div class="zpl_rgtcnt" rel="getFeedback" id="feedbackFor"><div class="zpl_crd"><div class="zpl_crdhdr " rel="feedbackHeaderDiv"><div><h4>'+ZPI18N.getString("zp.feedback")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.feedbackdesc")+'</p></div><div _rel="headButtons" rel="feedbackHeaderButtons" class="DNI"><button rel="feedbackreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="feedbacksave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.lms.sessionfeedbackgivenby")+'</h5></div><div rel="sessionFeedback"><div class="zradiobutton zradiobutton--horizontal"><input id="allOpt" type="radio" name="sessFb" class="zradiobutton__helper" checked=""><label for="allOpt" rel="allOpt" _rel="1" class="zradiobutton__label"><span class="zradiobutton__text" rel="spallOpt">'+ZPI18N.getString("zp.lms.alllearners")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="attOpt" type="radio" name="sessFb" class="zradiobutton__helper"><label for="attOpt" rel="attOpt" _rel="2" class="zradiobutton__label"><span class="zradiobutton__text" rel="spattOpt">'+ZPI18N.getString("zp.lms.sessionattendees")+'</span></label></div></div></div><div class="zpl_secn "><div><h5>'+ZPI18N.getString("zp.lms.newsettings.givenForTrainerOrcourseContent")+'</h5></div><div rel="feedbackFor"><div class="zcheckbox zcheckbox--horizontal"><input id="trainerMOpt" rel="trainerMOpt" type="checkbox" name="check" class="zcheckbox__helper"><label for="trainerMOpt" class="zcheckbox__label">'+ZPI18N.getString("zp.lms.settings.TrainerM")+'</label></div><div class="zcheckbox zcheckbox--horizontal"><input id="courseOpt" rel="courseOpt" type="checkbox" name="check" class="zcheckbox__helper"><label for="courseOpt" class="zcheckbox__label">'+ZPI18N.getString("zp.lms.settings.course")+'</label></div><div class="zcheckbox zcheckbox--horizontal"><input id="feedbackForLearner" rel="feedbackForLearner"  type="checkbox" name="check" class="zcheckbox__helper"><label for="feedbackForLearner" class="zcheckbox__label">Learner</label></div></div></div></div></div>'+lmsnewsettings.getFeedback.additionalSettingsHTML()+"</div>";settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(e),lmsnewsettings.getFeedback.resetFeedbackOpts(0),lmsnewsettings.getFeedback.initFeedbackAdditionalSettings(),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1))}},additionalSettingsHTML:()=>`<div class="zpl_crd">\n\t\t\t\t\t\t\t<div class="zpl_crdhdr" rel="feedbackAdditionalHeaderDiv">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<h4>${ZPI18N.getString("zp.lms.feedback.session.view")}</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div _rel="headButtons" rel="feedbackAdditionalSettingButton" class="DNI">\n\t\t\t\t\t\t\t\t\t<button rel="feedbackAdditionalReset" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.reset")}</button>\n\t\t\t\t\t\t\t\t\t<button rel="feedbackAdditionalSave" type="button" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.save")}</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t\t\t\t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t<div class="zpl_tgsprt">\n\t\t\t\t\t\t\t\t\t\t<h5 class="zpl_tgl">\n\t\t\t\t\t\t\t\t\t\t\t<input class="togbutton-js" style="display: none;" rel="canLearnerViewFeedback" id="canLearnerViewFeedback">\n\t\t\t\t\t\t\t\t\t\t\t${ZPI18N.getString("zp.lms.feedback.session.learner.view.header")}\n\t\t\t\t\t\t\t\t\t\t</h5>\n\t\t\t\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.lms.feedback.session.learner.view.desc",["<b>"+ZPI18N.getString("zp.lms.course")+"</b>","<b>"+ZPI18N.getString("zp.feedback")+"</b>"])}</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`,getFeedbackForValues(){let e=[];return settingsPage.container.find('[id="trainerMOpt"]').prop("checked")&&e.push(1),settingsPage.container.find('[id="courseOpt"]').prop("checked")&&e.push(2),settingsPage.container.find('[id="feedbackForLearner"]').prop("checked")&&e.push(3),e},saveFeedbackOpts:function(){var e=settingsPage.container.find('[rel="learnerOpt"]').prop("checked")?"3":settingsPage.container.find('[rel="managerOpt"]').prop("checked")?"4":"5",t=settingsPage.container.find('[rel="anytimeOpt"]').prop("checked")?"1":"2";let s=lmsnewsettings.getFeedback.getFeedbackForValues(),r=settingsPage.container.find('[id="allOpt"]').prop("checked")?"1":"2",l=ZPeopleComponents.toggleswitch(settingsPage.container.find("#canLearnerViewFeedback")).getState();var a={feedbackgivenby:e,whencanfeedbackgiven:t,feedbackfor:JSON.stringify(s),canLearnerViewTrainerFeedback:l,sessionFeedback:r};document.querySelector('[rel="feedbackHeaderButtons"]').classList.add("DNI"),document.querySelector('[rel="feedbackHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaving(),zplms.put("/lms/settings/feature",a,(async function(e){"Success"==e[1].message?(document.querySelector('[id="savingHtml"]').remove(),document.querySelector('[rel="feedbackHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaved("getFeedback"),lmsnewsettings.savedFadeOut("feedbackHeaderDiv"),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),await lmsnewsettings.getSettingsData(!0,1)):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))},resetFeedbackOpts:function(e,t){0==e?(settingsPage.container.find("#trainerMOpt").prop("checked",lmsnewsettings.commonSettingData.feedbackFor.includes(1)),settingsPage.container.find("#courseOpt").prop("checked",lmsnewsettings.commonSettingData.feedbackFor.includes(2)),settingsPage.container.find("#feedbackForLearner").prop("checked",lmsnewsettings.commonSettingData.feedbackFor.includes(3)),settingsPage.container.find("#allOpt").prop("checked","1"==lmsnewsettings.commonSettingData.sessionFeedbackby),settingsPage.container.find("#attOpt").prop("checked","2"==lmsnewsettings.commonSettingData.sessionFeedbackby),document.querySelector('[rel="feedbackHeaderButtons"]').classList.add("DNI")):1==e&&("allOpt"!=t&&"attOpt"!=t||(settingsPage.container.find('[id="allOpt"]').prop("checked","allOpt"==t),settingsPage.container.find('[id="attOpt"]').prop("checked","attOpt"==t)),lmsnewsettings.dataChanged("feedbackHeaderDiv")?(lmsnewsettings.isDataChangedPopup("feedbackHeaderDiv","feedbackHeaderButtons"),document.querySelector('[rel="feedbackHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="feedbackHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="feedbackHeaderButtons"]').classList.remove("DNI")):(document.querySelector('[rel="feedbackHeaderButtons"]').classList.add("DNI"),document.querySelector('[rel="getFeedback"]').querySelector("[ispagedatachanged=true]")&&document.querySelector('[rel="getFeedback"]').querySelector("[ispagedatachanged=true]").removeAttribute("isPageDataChanged")))},initFeedbackAdditionalSettings(){lmsnewsettings.commonSettingData.canLearnerViewTrainerFeedback?ZPeopleComponents.toggleswitch(settingsPage.container.find("#canLearnerViewFeedback")).switchOn():ZPeopleComponents.toggleswitch(settingsPage.container.find("#canLearnerViewFeedback")).switchOff(),settingsPage.container.find("#canLearnerViewFeedback").on("ztoggleswitchchange",(e=>{lmsnewsettings.clickHandler({target:e.currentTarget})}))},saveFeedbackAdditionalSettings(){var e={canLearnerViewTrainerFeedback:ZPeopleComponents.toggleswitch(settingsPage.container.find("#canLearnerViewFeedback")).getState()};document.querySelector('[rel="feedbackAdditionalSettingButton"]').classList.add("DNI"),document.querySelector('[rel="feedbackAdditionalHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaving(),zplms.put("/lms/settings/feature",e,(async function(e){"Success"==e[1].message?(document.querySelector('[id="savingHtml"]').remove(),document.querySelector('[rel="feedbackAdditionalHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaved("getFeedback"),lmsnewsettings.savedFadeOut("feedbackAdditionalHeaderDiv"),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),await lmsnewsettings.getSettingsData(!0,1)):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))},feedbackAdditionalSettingsChanged(){if(lmsnewsettings.dataChanged("feedbackAdditionalHeaderDiv"))lmsnewsettings.isDataChangedPopup("feedbackAdditionalHeaderDiv","feedbackAdditionalSettingButton"),document.querySelector('[rel="feedbackAdditionalSettingButton"]').classList.remove("DNI");else{document.querySelector('[rel="feedbackAdditionalSettingButton"]').classList.add("DNI");let e=document.querySelector('[rel="getFeedback"]');e.querySelector("[ispagedatachanged=true]")&&e.removeAttribute("isPageDataChanged")}}},getDiscussionSettings:{init:async function(){if(0==settingsPage.container.find('[rel="getDiscussion"]').length){await lmsnewsettings.getSettingsData(null,1);var e='<div class="zpl_rgtcnt" rel="getDiscussion"><div class="zpl_crd"><div class="zpl_crdhdr " rel="discussSettHeaderDiv"><div><h4>'+ZPI18N.getString("zp.lms.settings.Discussions")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.discussionsdesc")+'</p></div><div _rel="headButtons" rel="discussSettHeaderButtons" class="DNI"><button rel="discussionreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="discussionsave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.lms.newsettings.WhostartDiscussion")+'</h5></div><div><div class="zcheckbox zcheckbox--horizontal"><input rel="discuss" id="disccourseadmin" type="checkbox" name="check" class="zcheckbox__helper" checked="" onclick="lmsnewsettings.resetSaveEnable(1, this)"><label for="disccourseadmin" class="zcheckbox__label">'+ZPI18N.getString("zp.lms.courseadmin")+'</label></div><div class="zcheckbox zcheckbox--horizontal"><input rel="discuss" id="disctrainer" type="checkbox" name="check" class="zcheckbox__helper" checked="" onclick="lmsnewsettings.resetSaveEnable(1, this)"><label for="disctrainer" class="zcheckbox__label">'+ZPI18N.getString("zp.lms.base.Trainers")+'</label></div><div class="zcheckbox zcheckbox--horizontal"><input rel="discuss" id="disclearner" type="checkbox" name="check" class="zcheckbox__helper" checked="" onclick="lmsnewsettings.resetSaveEnable(1, this)"><label for="disclearner" class="zcheckbox__label">'+ZPI18N.getString("zp.lms.learners")+"</label></div></div></div></div></div></div>";settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(e),lmsnewsettings.getDiscussionSettings.resetDiscussionOpts(),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1))}},saveDiscussionOpts:function(){var e=[];settingsPage.container.find("#disccourseadmin").prop("checked")&&e.push("1"),settingsPage.container.find("#disctrainer").prop("checked")&&e.push("2"),settingsPage.container.find("#disclearner").prop("checked")&&e.push("3");for(var t=[],s=0;s<e.length;s++){var r={};r.ids=e[s],t.push(r)}var l={whocanstartdiscussion:t=JSON.stringify(t)};document.querySelector('[rel="discussSettHeaderButtons"]').classList.add("DNI"),document.querySelector('[rel="discussSettHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaving(),zplms.put("/lms/settings/feature",l,(async function(e){"Success"==e[1].message?(document.querySelector('[id="savingHtml"]').remove(),document.querySelector('[rel="discussSettHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaved("getDiscussion"),lmsnewsettings.savedFadeOut("discussSettHeaderDiv"),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),await lmsnewsettings.getSettingsData(!0,1)):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))},resetDiscussionOpts:function(){document.querySelector('[rel="discussSettHeaderButtons"]').classList.add("DNI");var e=ZPeople.decodeTxt(lmsnewsettings.commonSettingData.startDiscBy),t=[];null!=e&&(t=e.match(/[1-9]/g)),settingsPage.container.find("#disccourseadmin").prop("checked",!(null==t||!t.includes("1"))),settingsPage.container.find("#disctrainer").prop("checked",!(null==t||!t.includes("2"))),settingsPage.container.find("#disclearner").prop("checked",!(null==t||!t.includes("3")))}},getReportsSettings:{init:async function(){if(0==settingsPage.container.find('[rel="getReport"]').length){await lmsnewsettings.getSettingsData(null,1);var e='<div class="zpl_rgtcnt" rel="getReport"><div class="zpl_crd"><div class="zpl_crdhdr " rel="reportsHeaderDiv"><div><h4>'+ZPI18N.getString("zp.reports")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.reportsdesc")+'</p></div><div _rel="headButtons" rel="reportsHeaderButtons" class="DNI"><button rel="reportsreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="reportssave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.lms.newsettings.ViewReports")+'</h5></div><div><div><div class="zradiobutton zradiobutton--horizontal"><input rel="adminOpt" type="radio" name="Admin" class="zradiobutton__helper" checked=""><label for="adminOpt" rel="adminOpt" _rel="2" class="zradiobutton__label"><span class="zradiobutton__text" rel="spadminOpt">'+ZPI18N.getString("zp.admin")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input rel="trainerOpt" type="radio" name="Trainer" class="zradiobutton__helper"><label for="trainerOpt" rel="trainerOpt" _rel="1" class="zradiobutton__label"><span class="zradiobutton__text" rel="sptrainerOpt">'+ZPI18N.getString("zp.lms.trainer")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input rel="bothOpt" type="radio" name="Both (Admin &amp; Trainer)" class="zradiobutton__helper"><label for="bothOpt" rel="bothOpt" _rel="3" class="zradiobutton__label"><span class="zradiobutton__text" rel="spbothOpt">'+ZPI18N.getString("zp.lms.newsettings.reportsboth")+'</span></label></div></div></div></div><div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.pa.reportsettings.includeappraiseedatahdr")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.reportsexportdesc")+'</p></div><div><textarea class="tokenfieldId-js" style="display: none;" rel="reports" id="reportExportSettings"></textarea></div></div></div></div></div>';settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(e),lmsnewsettings.getReportsSettings.resetReportsOpts(0),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1),settingsPage.container.find("select").on("zselectchange",lmsnewsettings.resetSaveEnable),settingsPage.container.find("#reportExportSettings").on("ztokenfieldtokenadd ztokenfieldtokenremove",lmsnewsettings.resetSaveEnable),lmsnewsettings.getReportsSettings.reportExportOpts())}},reportExportOpts:function(){var e=[],t=[],s={};resultData=[];var r={};if(null!=lmsnewsettings.commonSettingData.empComponents&&lmsnewsettings.commonSettingData.empComponents.length>0)for(var l=0;l<lmsnewsettings.commonSettingData.empComponents.length;l++)(r={}).name=ZPeople.decodeTxt(lmsnewsettings.commonSettingData.empComponents[l].displayName),r.id=lmsnewsettings.commonSettingData.empComponents[l].compId,e.push(r);else s.name=ZPI18N.getString("zp.nodatafound"),s.id="-1",e.push(s);if(null!=lmsnewsettings.commonSettingData.exportEmpComps&&lmsnewsettings.commonSettingData.exportEmpComps.length>0)for(l=0;l<lmsnewsettings.commonSettingData.exportEmpComps.length;l++)(r={}).name=ZPeople.decodeTxt(lmsnewsettings.commonSettingData.exportEmpComps[l].displayName),r.id=lmsnewsettings.commonSettingData.exportEmpComps[l].compId,t.push(r);var a={values:t,data:e,dropdownList:{contentType:"text"},dataMapping:{text:"name",value:"id",id:"id"},placeholder:"Select",search:{by:"name"},allowDuplicateValues:!1};ZPeopleComponents.tokenfield(document.querySelector('[id="reportExportSettings"]')).destroy(),ZPeopleComponents.tokenfield("#reportExportSettings",a)},saveReportsOpts:function(){var e=document.querySelector("#reportExportSettings"),t=ZPeopleComponents.tokenfield(e).getAllValues(),s=[];if(t.length>0)for(var r in t)s.push(t[r].id);var l={reportsfor:settingsPage.container.find('[rel="adminOpt"]').prop("checked")?"2":settingsPage.container.find('[rel="trainerOpt"]').prop("checked")?"1":"3",exportEmpComps:s?s.toString():void 0};document.querySelector('[rel="reportsHeaderButtons"]').classList.add("DNI"),document.querySelector('[rel="reportsHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaving(),zplms.put("/lms/settings/feature",l,(async function(e){"Success"==e[1].message?(document.querySelector('[id="savingHtml"]').remove(),document.querySelector('[rel="reportsHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaved("getReport"),lmsnewsettings.savedFadeOut("reportsHeaderDiv"),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),await lmsnewsettings.getSettingsData(!0,1)):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))},resetReportsOpts:function(e,t){0==e?(settingsPage.container.find('[rel="adminOpt"]').prop("checked","2"==lmsnewsettings.commonSettingData.reportsViewFr),settingsPage.container.find('[rel="trainerOpt"]').prop("checked","1"==lmsnewsettings.commonSettingData.reportsViewFr),settingsPage.container.find('[rel="bothOpt"]').prop("checked","3"==lmsnewsettings.commonSettingData.reportsViewFr),lmsnewsettings.getReportsSettings.reportExportOpts(),document.querySelector('[rel="reportsHeaderButtons"]').classList.add("DNI")):1==e&&(settingsPage.container.find('[rel="adminOpt"]').prop("checked","adminOpt"==t),settingsPage.container.find('[rel="trainerOpt"]').prop("checked","trainerOpt"==t),settingsPage.container.find('[rel="bothOpt"]').prop("checked","bothOpt"==t),lmsnewsettings.dataChanged("reportsHeaderDiv")?(document.querySelector('[rel="reportsHeaderDiv"]').querySelector('[id="savedHtml"]')&&document.querySelector('[rel="reportsHeaderDiv"]').querySelector('[id="savedHtml"]').remove(),document.querySelector('[rel="reportsHeaderButtons"]').classList.remove("DNI"),lmsnewsettings.isDataChangedPopup("reportsHeaderDiv","reportsHeaderButtons")):document.querySelector('[rel="reportsHeaderButtons"]').classList.add("DNI"))}},getAdditionOptionsSettings:{saveAdditionalOpts:function(){var e={};e[lmsnewsettings.iltSettingData.settingId]=lmsnewsettings.iltSettingData.isIltenable,e[lmsnewsettings.selfSettingData.settingId]=lmsnewsettings.selfSettingData.isSelfenable,e[lmsnewsettings.manualSettingData.settingId]=lmsnewsettings.manualSettingData.isManualenable;var t=ZPeopleComponents.toggleswitch(settingsPage.container.find("#enableDisable")).getState()?1:0,s={settingIdsObj:JSON.stringify(e),publishurl:ZPeopleComponents.toggleswitch(settingsPage.container.find("#allowshareableurl")).getState(),allowNotify:t};document.querySelector('[rel="addOptHeaderButtons"]').classList.add("DNI"),document.querySelector('[rel="addOptHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaving(),zplms.put("/lms/settings/general",s,(async function(e){"Success"==e[1].message?(document.querySelector('[id="savingHtml"]').remove(),document.querySelector('[rel="addOptHeaderDiv"]').innerHTML+=lmsnewsettings.returnSaved("generalSettings"),lmsnewsettings.savedFadeOut("addOptHeaderDiv"),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),await lmsnewsettings.getSettingsData(!0,1),lmsnewsettings.commonSettingData.allowNotify?lmsnewsettings.commonSettingData.allowNotify&&settingsPage.addLeftTabs(5,0,[{tabArr:[{tabURL:"settings/service/lms/coursenotification",dispName:"Course"},{tabURL:"settings/service/lms/modulenotification",dispName:"Module"},{tabURL:"settings/service/lms/discussionnotification",dispName:"Discussions"},{tabURL:"settings/service/lms/learningplannotification",dispName:"Learning plan"},{tabURL:"settings/service/lms/assignmentnotification",dispName:"Assignments"},{tabURL:"settings/service/lms/managepermnotification",dispName:"Moderation"},{tabURL:"settings/service/lms/feedbacknotification",dispName:"Feedback"},{tabURL:"settings/service/lms/managerevaluationnotification",dispName:"Manager evaluation"},{tabURL:"settings/service/lms/remindernotification",dispName:ZPI18N.getString("zp.reminders")}],tabURL:"settings/service/lms/coursenotification",dispName:"Notification"}],!0):settingsPage.removeLeftTab(5,1,!0)):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))},resetAdditionalOpts:function(e){document.querySelector('[rel="addOptHeaderButtons"]').classList.add("DNI"),lmsnewsettings.commonSettingData.allowPublishUrl?ZPeopleComponents.toggleswitch(settingsPage.container.find("#allowshareableurl")).switchOn():ZPeopleComponents.toggleswitch(settingsPage.container.find("#allowshareableurl")).switchOff(),lmsnewsettings.commonSettingData.allowNotify?ZPeopleComponents.toggleswitch(settingsPage.container.find("#enableDisable")).switchOn():ZPeopleComponents.toggleswitch(settingsPage.container.find("#enableDisable")).switchOff(),lmsnewsettings.resetSaveEnable(2,null,!0,"additionalOpt",null,e)},enableNoti:function(){ZPNewTabs.updateSysOperTopSubtab("lms",{tabArr:[{tabArr:[{tabURL:"settings/service/lms/coursenotification",dispName:"Course"},{tabURL:"settings/service/lms/modulenotification",dispName:"Module"},{tabURL:"settings/service/lms/discussionnotification",dispName:"Discussions"},{tabURL:"settings/service/lms/learningplannotification",dispName:"Learning plan"},{tabURL:"settings/service/lms/assignmentnotification",dispName:"Assignments"},{tabURL:"settings/service/lms/managepermnotification",dispName:"Moderation"},{tabURL:"settings/service/lms/feedbacknotification",dispName:"Feedback"},{tabURL:"settings/service/lms/managerevaluationnotification",dispName:"Manager evaluation"},{tabURL:"settings/service/lms/remindernotification",dispName:ZPI18N.getString("zp.reminders")}],tabURL:"settings/service/lms/coursenotification",dispName:"Notification"}],tabURL:"settings/service/lms/coursenotification",dispName:"Automation"},3)}},getCategoriesSettings:{init:async function(e){if(0==settingsPage.container.find('[rel="getCategories"]').length){1==e?await lmsnewsettings.getSettingsData(null,0):await lmsnewsettings.getSettingsData(null,1);var t='<div class="zpl_btnmnu"><div class="zpl_rgt"><button class="zlabel zlabel--blue zlabel--medium" rel="createNewCategory">'+ZPI18N.getString("zp.addcategory")+'</button></div></div><div class="zpl_rgtcnt" rel="getCategories"><div class="zpl_secn"><div><div class="zpl_cat" rel="CategoriesElem">';$.each(lmsnewsettings.getCategories,(function(e,s){t+='<div rel="catElem" _rel="catElem_'+s.categoryId+'"><div class="zpl_Fldtl"><h5 rel="catValue">'+lmsFormConstants.getValue(s.categoryName.replace(/\s+/g," "))+'</h5></div><div class="zpl_actn"><span><i class="PI_edt" rel="editCategory" _rel="'+lmsFormConstants.getValue(s.categoryName.replace(/\s+/g," "))+"_"+s.categoryId+'"></i>',"General"!==s.categoryName&&(t+='<i class="PI_delete" rel="deleteCategory" _rel="deleteCategory_'+s.categoryId+'"></i>'),t+="</span></div></div>"})),settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(t),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1))}},createCategory:function(){var e='<div class="zpl_mdl zpl_mcenter zpl_mopen" data-modal-box="addcategory" rel="addCategoryPopUp"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.addcategory")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.addEditCategory")+'</p></div><a class="_cls PI_cls" rel="cancelCategory"></a></div><div class="zpl_mcnt zpl_fm"><form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><input type="text" class="ztextbox" id="suggestFieldId" rel="createCategory"></div></div></div></div></form></div><div class="zpl_mfoter"><button type="button" class="zlabel zlabel--blue zlabel--medium" rel="saveCategory">'+ZPI18N.getString("zp.save")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" rel="cancelCategory">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>";settingsPage.container.append(e),lmsbase.addListener(document.querySelector('[rel="addCategoryPopUp"]'),"click",lmsnewsettings.clickPopupHandler,!1),document.querySelector('[rel="addCategoryPopUp"]').querySelector('[rel="createCategory"]').focus(),document.querySelector('[rel="addCategoryPopUp"]').querySelector('[rel="createCategory"]').autocomplete="off"},createCategorys:function(e){if(e.indexOf("<")>-1||e.indexOf(">")>-1)ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));else if(e.trim())if(e.length>=100)ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.exceedmaxlength"));else{var t={data:e.trim().replace(/\s+/g," ")};zplms.post("/lms/settings/categories",t,(function(e){"success"==e[1][0]?(lmsnewsettings.getCategoriesSettings.fetchCategorys(1),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.categoryaddedmsg"))):ModuleComp.Msg.showFailureMsg(e[1][0])}))}else lmsnewsettings.showErrorField(document.querySelector('[rel="createCategory"]'))},fetchCategorys:function(e){zplms.get("/lms/settings/categories",null,(function(t){null!=t[1]&&(lmsnewsettings.getCategories=t[1]),1==e&&(settingsPage.container.find('[rel="getCategories"]').remove(),lmsnewsettings.getCategoriesSettings.init(1))}))},editCategory:function(e,t){var s='<div class="zpl_mdl zpl_mcenter zpl_mopen" data-modal-box="addcategory" rel="editCategoryPopUp"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.editcat")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.addEditCategory")+'</p></div><a class="_cls PI_cls" rel="cancelCategory"></a></div><div class="zpl_mcnt zpl_fm"><form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><input type="text" class="ztextbox" id="suggestFieldId" rel="editCategoryVal" value = "'+t+'"></div></div></div></div></form></div><div class="zpl_mfoter"><button type="button" class="zlabel zlabel--blue zlabel--medium" rel="saveEditCategory" _rel="'+t+"_"+e+'">'+ZPI18N.getString("zp.save")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" rel="cancelCategory">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>";settingsPage.container.append(s),lmsbase.addListener(document.querySelector('[rel="editCategoryPopUp"]'),"click",lmsnewsettings.clickPopupHandler,!1),document.querySelector('[rel="editCategoryPopUp"]').querySelector('[rel="editCategoryVal"]').focus(),document.querySelector('[rel="editCategoryPopUp"]').querySelector('[rel="editCategoryVal"]').setSelectionRange(2*t.length,2*t.length),document.querySelector('[rel="editCategoryPopUp"]').querySelector('[rel="editCategoryVal"]').autocomplete="off"},editCategoryWithId:function(e,t,s){if(t.indexOf("<")>-1||t.indexOf(">")>-1)ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));else if(t.trim()){if(s==t.replace(/\s+/g," "))return void document.querySelector('[rel="editCategoryPopUp"]').remove();var r={data:t.replace(/\s+/g," ")};zplms.patch("/lms/settings/categories/"+e,r,(function(e){"success"==e[1][0]?(lmsnewsettings.getCategoriesSettings.fetchCategorys(1),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.categoryeditmsg"))):ModuleComp.Msg.showFailureMsg(e[1][0])}))}else lmsnewsettings.showErrorField(document.querySelector('[rel="editCategoryVal"]'))},deleteCategory:function(e){zplms.delete("/lms/settings/categories/"+e,lmsnewsettings.paramsObj,(function(e){"success"==e[1][0]?(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.categorydeletemsg")),lmsnewsettings.getCategoriesSettings.fetchCategorys(1)):ModuleComp.Msg.showFailureMsg(e[1][0])}))}},getManagePermsSettings:{applicableData:null,constructApplicableUsers:function(e,t,s,r){if(0==t||1==t&&1==lmsnewsettings.selfSettingData.isSelfenable||2==t&&1==lmsnewsettings.iltSettingData.isIltenable||3==t&&1==lmsnewsettings.manualSettingData.isManualenable){var l=0;if(e){var a=1==s?s+1:s;for(var n in e.applicableUsers[a])0!=Object.keys(JSON.parse(e.applicableUsers[a][n])).length&&(l+=Object.keys(JSON.parse(e.applicableUsers[a][n])).length)}var i="",o=0==s?"create":"moderate";if(r&&1==s&&0==document.querySelectorAll('[rel="moderate_'+t+'"]').length&&(i+='<div class="zpl_gboxwhti"><div class="zpl_secn" rel="moderate_'+t+'"><div rel="moderateOpt" _rel="rel="moderate""></div></div></div>',rel=0==t?"lpModSettings":1==t?"selfModSettings":2==t?"iltModSettings":"",settingsPage.container.find('[rel="'+rel+'"]')&&settingsPage.container.find('[rel="'+rel+'"]').append(i)),r&&document.querySelectorAll('[rel="'+o+"_"+t+'"]').length<2){var c=0==s?ZPI18N.getString("zp.lms.learningplan.adminInfo"):ZPI18N.getString("zp.lms.learningplan.adminModInfo");3!=t?i='<div class="zpl_idiv" rel="adminInfo"><div class="zpl_info"><em>'+c+"</em></div></div>":3==t&&(i=""),i+='<div class="zpl_idiv"><div class="zpl_gbox" rel="'+o+'"><div class="zpl_idiv" rel="addCon"><a class="zpl_lnkbg" rel="addCondition" _rel="atouseradd_'+t+"_"+s+'">'+ZPI18N.getString("zp.lms.addcondition")+"</a></div></div></div>",0==s&&settingsPage.container.find('[rel="createOpt"]').find('[class="zpl_idiv"]')?settingsPage.container.find('[rel="createOpt"]').find('[class="zpl_idiv"]').remove():settingsPage.container.find('[rel="moderateOpt"]').find('[class="zpl_idiv"]')&&settingsPage.container.find('[rel="moderateOpt"]').find('[class="zpl_idiv"]').remove(),0==s?settingsPage.container.find('[rel="createOpt"]').append(i):settingsPage.container.find('[rel="moderateOpt"]').append(i)}i="";for(var d=0;d<l;d++)i+='<div class="zpl_idiv"  rel="newUser" _rel="newUser_'+t+"_"+d+'" srel="atoCondition_'+d+'"><div><select rel="selElem" _rel="'+t+'" id="newUser_'+t+"_"+s+"_"+d+'" class="select-js" style="display: none;"></select></div><div><span>'+ZPI18N.getString("zp.lms.learningplan.is")+'</span></div><div><select rel="selElem" _rel="'+t+'" id="atoval_'+t+"_"+s+"_"+d+'" class="select-js" style="display: none;"></select></div><div><i class="PI_delete" rel="atodelete" _rel="atodelete_'+t+"_"+s+"_"+d+'"></i></div></div>';l>0&&(0==s?$(i).insertBefore($('[rel="create_'+t+'"]').find('[rel="addCon"]')):$(i).insertBefore($('[rel="moderate_'+t+'"]').find('[rel="addCon"]')),lmsnewsettings.getManagePermsSettings.setATOValues(e,t,s))}},setATOValues:function(e,t,s,r){var l,a=0==s?"create":"moderate",n="moderate"==a?1:0,i=isEmpty(e)||isEmpty(e.applicableUsers)?{}:0==n&&e.applicableUsers[n]?e.applicableUsers[n]:e.applicableUsers[n+1]?e.applicableUsers[n+1]:{},o=0,c=[];for(var d in i)if(0!=Object.keys(JSON.parse(i[d])).length&&"type"!=d)for(var m in JSON.parse(i[d])){l="desi"==d?1:"dept"==d?2:"role"==d?3:"group"==d?7:6,c=[{label:ZPI18N.getString("zp.designation"),value:1},{label:ZPI18N.getString("zp.department"),value:2},{label:ZPI18N.getString("zp.role"),value:3},{label:ZPI18N.getString("zp.group"),value:7},{label:ZPI18N.getString("zp.user"),value:6}];var u=settingsPage.container.find('[rel="'+a+"_"+t+'"]').find("#newUser_"+t+"_"+s+"_"+o);if(u.length){var p=ZPeopleComponents.select(u);p.addOption(c),p.setValue(l),u.on("zselectchange",lmsnewsettings.getManagePermsSettings.fetchOptions)}c=lmsnewsettings.getManagePermsSettings.fetchapplicableUserView(d,t,null,n);var g=lmsnewsettings.getManagePermsSettings.createServerSearchObj(d,t,null,n);c.push({label:JSON.parse(i[d])[m],value:m});var f=settingsPage.container.find('[rel="'+a+"_"+t+'"]').find("#atoval_"+t+"_"+s+"_"+o);if(f.length){var v=ZPeopleComponents.select(f);v.addOption(c),v.setValue(m),v.setAttributes(g),f.on("zselectchange",lmsnewsettings.getManagePermsSettings.valueSelectListener)}o++,!0}if(r&&0!=settingsPage.container.find('[rel="'+a+'"]').find("#newUser_"+t+s).length){c=[{label:ZPI18N.getString("zp.designation"),value:1},{label:ZPI18N.getString("zp.department"),value:2},{label:ZPI18N.getString("zp.role"),value:3},{label:ZPI18N.getString("zp.group"),value:7},{label:ZPI18N.getString("zp.user"),value:6}];var h=settingsPage.container.find('[rel="'+a+'"]').find("#newUser_"+t+"_"+s+"_"+o);if(h.length){var b=ZPeopleComponents.select(h);b.addOption(c),b.setValue(0),h.on("zselectchange",lmsnewsettings.getManagePermsSettings.fetchOptions)}c=[{label:ZPI18N.getString("zp.lms.nodatafound"),value:1}];var I=settingsPage.container.find('[rel="'+a+'"]').find("#atoval_"+t+"_"+s+"_"+o);if(I.length){var y=ZPeopleComponents.select(I);y.addOption(c),y.setValue(0),I.on("zselectchange",lmsnewsettings.getManagePermsSettings.valueSelectListener)}r=!1}},createServerSearchObj:function(e,t,s,r,l){return{dataSource:{search:function(s){return new Promise((function(a,n){s.query,s.pages,s.pages;lmsnewsettings.getManagePermsSettings.fetchapplicableUserView(e,t,s.query,r,l,a)}))},paginated:!0},search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults")},isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0,fitForElement:!0},serverSearch:!0,cacheData:!0,sort:!0,lazyLoading:!1,showSearchField:!0,placeholder:"Select"}},delConstructedSelElem:function(e){var t;t=e?document.querySelectorAll('[rel="'+e+'"]')?document.querySelector('[rel="'+e+'"]').querySelectorAll('[rel="selElem"]'):"":$('[rel="selElem"]');for(var s=0;s<t.length;s++)ZPeopleComponents.select($("#"+t[s].getAttribute("id"))).destroy()},fetchOptions:function(){var e=this.getAttribute("id").split("_"),t=ZPeopleComponents.select($('[id="'+this.getAttribute("id")+'"]')).getValue();ZPeopleComponents.select(settingsPage.container.find("#atoval_"+e[1]+"_"+e[2]+"_"+e[3])).destroy(),options=lmsnewsettings.getManagePermsSettings.createServerSearchObj(t,e[1],null,e[2],1),ZPeopleComponents.select(settingsPage.container.find('[rel="'+this.closest('[class="zpl_gbox"]').getAttribute("rel")+'"]').find("#atoval_"+e[1]+"_"+e[2]+"_"+e[3])).setAttributes(options),ZPeopleComponents.select(this).zclassName="ztextbox__error"==ZPeopleComponents.select(this).zclassName?"":null,$(this.parentElement).find(".ztextbox--error__label").remove()},fetchapplicableUserView:function(e,t,s,r,l,a){var n;if(s){var i={type:n=1==l?e:"desi"==e?1:"dept"==e?2:"role"==e?3:"group"==e?7:6};s&&(i.searchTxt=s),zplms.get("/lms/learningplans/"+n+"/criteria",i,(function(e){if(lmsnewsettings.getManagePermsSettings.applicableUserView(e[1],t,r),null!=lmsnewsettings.getManagePermsSettings.applicableData){var s={results:lmsnewsettings.getManagePermsSettings.applicableData,more:50==lmsnewsettings.getManagePermsSettings.applicableData.length};a(s)}}))}else{if(n=1!=l?e:1==e?"desi":2==e?"dept":3==e?"role":7==e?"group":"users",lmsnewsettings.getManagePermsSettings.applicableUserView(lmsnewsettings.entityDataObject[n],t,r),!a)return lmsnewsettings.getManagePermsSettings.applicableData;var o={results:lmsnewsettings.getManagePermsSettings.applicableData,more:50==lmsnewsettings.getManagePermsSettings.applicableData.length};a(o)}},applicableUserView:function(e,t,s){var r,l,a=[],n=0==t?"zp.lms.learningplan":1==t?"zp.lms.settings.courseType.self":2==t?"zp.lms.settings.courseType.ILT":"zp.lms.settings.courseType.manuals";lmsnewsettings.optType=t;var i=lmsnewsettings.typebasedData.courseTypeSettingIds[n];i||(n=0==t?"zp.lms.learningplan":1==t?"Self":2==t?"Ilt":"Manuals",i=lmsnewsettings.typebasedData.courseTypeSettingIds[n]),l=0==s?!!lmsnewsettings.savedConfigData[i]&&lmsnewsettings.savedConfigData[i].isTrainerCanAdd:!!lmsnewsettings.savedConfigData[i]&&lmsnewsettings.savedConfigData[i].isTrainerCanMod,lmsnewsettings.opt=0==s?"create_":"moderate_",r=lmsnewsettings.getManagePermsSettings.checkUsrValSelected(e,s,t),Object.keys(e).forEach((function(s){(s!=ZPI18N.getString("zp.admin")&&"zp.lms.settings.courseType.manuals"!=n||"zp.lms.settings.courseType.manuals"==n)&&(tmp={},tmp.label=s,tmp.value=e[s],a.push(tmp)),s!=ZPI18N.getString("zp.admin")||r[1]||l||0!=lmsnewsettings.type&&(1!=lmsnewsettings.type||0==t||3==t)||(tmp={},tmp.label=ZPI18N.getString("zp.lms.trainer"),tmp.value="2",a.push(tmp))})),lmsnewsettings.getManagePermsSettings.applicableData=a},checkUsrValSelected:function(e,t,s){var r={};r[0]=e,r[1]=!1;for(var l=0==t?document.querySelector('[rel="create_'+s+'"]').querySelectorAll('[rel="newUser"]'):document.querySelector('[rel="moderate_'+s+'"]').querySelectorAll('[rel="newUser"]'),a=0;a<l.length;a++){var n=ZPeopleComponents.select(l[a].querySelectorAll('[rel="selElem"]')[1]).getValue();if(""!=n&&(fId=n,fVal=l[a].querySelectorAll('[rel="selElem"]')[1].nextSibling.innerText,r[1]="Trainer"==fVal,fVal!=ZPI18N.getString("zp.select")))for(let t in e)if(e[t]==fId){delete e[t];break}}return r},optionChange:function(e,t,s){if("allusers"==e)lmsnewsettings.getManagePermsSettings.delConstructedSelElem(s),settingsPage.container.find('[id="allusers_'+t+'"]').prop("checked",!0),settingsPage.container.find('[id="limitedusers_'+t+'"]').prop("checked",!1),settingsPage.container.find('[rel="createOpt"]').find('[class="zpl_idiv"]')&&settingsPage.container.find('[rel="createOpt"]').find('[class="zpl_idiv"]').remove(),lmsnewsettings.resetSaveEnable(1,null,!1,"mpPerm",!0);else if("limitedusers"==e){settingsPage.container.find('[id="limitedusers_'+t+'"]').prop("checked",!0),settingsPage.container.find('[id="allusers_'+t+'"]').prop("checked",!1);var r=0==t?lmsnewsettings.courseTypeSettingIds["zp.lms.learningplan"]:1==t?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]:lmsnewsettings.courseTypeSettingIds.Self:2==t?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]:lmsnewsettings.courseTypeSettingIds.Ilt:lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]:lmsnewsettings.courseTypeSettingIds.Manuals,l=lmsnewsettings.savedConfigData[r]?lmsnewsettings.savedConfigData[r]:lmsnewsettings.savedConfigData[0];lmsnewsettings.getManagePermsSettings.delConstructedSelElem(s),lmsnewsettings.getManagePermsSettings.constructApplicableUsers(l,t,0,!0),lmsnewsettings.resetSaveEnable(1,null,!1,"mpPerm",!0)}else if("allow"==e)settingsPage.container.find("#lpShare").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpShare")).getState()?ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpShare")).switchOn():settingsPage.container.find("#selfShare").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfShare")).getState()?ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfShare")).switchOn():settingsPage.container.find("#iltShare").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltShare")).getState()&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltShare")).switchOn();else if("dontallow"==e)settingsPage.container.find("#lpShare").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpShare")).getState()?ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpShare")).switchOff():settingsPage.container.find("#selfShare").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfShare")).getState()?ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfShare")).switchOff():settingsPage.container.find("#iltShare").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltShare")).getState()&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltShare")).switchOff();else if("required"==e){settingsPage.container.find("#lpModerate").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpModerate")).getState()?ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpModerate")).switchOn():settingsPage.container.find("#selfModerate").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfModerate")).getState()?ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfModerate")).switchOn():settingsPage.container.find("#iltModerate").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltModerate")).getState()&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltModerate")).switchOn();r=0==t?lmsnewsettings.courseTypeSettingIds["zp.lms.learningplan"]:1==t?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]:lmsnewsettings.courseTypeSettingIds.Self:2==t?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]:lmsnewsettings.courseTypeSettingIds.Ilt:lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]:lmsnewsettings.courseTypeSettingIds.Manuals,l=lmsnewsettings.savedConfigData[r]?lmsnewsettings.savedConfigData[r]:lmsnewsettings.savedConfigData[0];lmsnewsettings.getManagePermsSettings.constructApplicableUsers(l,t,1,!0)}else"notrequired"==e&&(settingsPage.container.find("#lpModerate").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpModerate")).getState()?ZPeopleComponents.toggleswitch(settingsPage.container.find("#lpModerate")).switchOff():settingsPage.container.find("#selfModerate").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfModerate")).getState()?ZPeopleComponents.toggleswitch(settingsPage.container.find("#selfModerate")).switchOff():settingsPage.container.find("#iltModerate").length>0&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltModerate")).getState()&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#iltModerate")).switchOff(),lmsnewsettings.getManagePermsSettings.delConstructedSelElem(s),settingsPage.container.find('[rel="moderateOpt"]').find('[class="zpl_idiv"]')&&settingsPage.container.find('[rel="moderateOpt"]').find('[class="zpl_idiv"]').closest('[class="zpl_gboxwhti"]')&&settingsPage.container.find('[rel="moderateOpt"]').find('[class="zpl_idiv"]').closest('[class="zpl_gboxwhti"]').remove())},addUsers:function(e,t){var s="moderate"==t?1:0,r=0==s?"create_"+e:"moderate_"+e,l=document.querySelector('[rel="'+r+'"]').querySelectorAll('[rel="newUser"]'),a=0==l.length?1:JSON.parse(l[l.length-1].getAttribute("_rel").split("_")[2])+1;if(0==l.length||0!=ZPeopleComponents.select($($(l).get(-1).children[2].querySelector('[id*="atoval"]'))).getValue()){var n='<div class="zpl_idiv" rel="newUser" _rel="newUser_'+e+"_"+a+'" rel="atoCondition_'+a+'"><div><select rel="selElem" id="newUser_'+e+"_"+s+"_"+a+'" rel="abc" class="select-js" style="display: none;"></select></div><div><span>'+ZPI18N.getString("zp.lookup.is")+'</span></div><div><select rel="selElem" id="atoval_'+e+"_"+s+"_"+a+'" class="select-js" style="display: none;" data-show-search-field="true"></select></div><div><i rel="atodelete" _rel="atodelete_'+e+"_"+s+"_"+a+'" class="PI_delete"></i></div></div>';$('[rel="'+t+"_"+e+'"]').find('[rel="addCon"]').before(n);var i=[{label:ZPI18N.getString("zp.designation"),value:1},{label:ZPI18N.getString("zp.department"),value:2},{label:ZPI18N.getString("zp.role"),value:3},{label:ZPI18N.getString("zp.group"),value:7},{label:ZPI18N.getString("zp.user"),value:6}];ZPeopleComponents.select(settingsPage.container.find('[rel="'+r+'"]').find("#newUser_"+e+"_"+s+"_"+a)).addOption(i),ZPeopleComponents.select(settingsPage.container.find('[rel="'+r+'"]').find("#newUser_"+e+"_"+s+"_"+a)).setValue(0),settingsPage.container.find('[rel="'+r+'"]').find("#newUser_"+e+"_"+s+"_"+a).on("zselectchange",lmsnewsettings.getManagePermsSettings.fetchOptions),i=[{label:ZPI18N.getString("zp.lms.nodatafound"),value:1}],ZPeopleComponents.select(settingsPage.container.find('[rel="'+r+'"]').find("#atoval_"+e+"_"+s+"_"+a)).addOption(i),ZPeopleComponents.select(settingsPage.container.find('[rel="'+r+'"]').find("#atoval_"+e+"_"+s+"_"+a)).setValue(0),settingsPage.container.find('[rel="'+r+'"]').find("#atoval_"+e+"_"+s+"_"+a).on("zselectchange",lmsnewsettings.getManagePermsSettings.valueSelectListener)}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.settings.selatleast"))},valueSelectListener:function(){var e=this.getAttribute("id").split("_")[1],t=0==e?"lpPermHeaderButtons":1==e?"selfPermHeaderButtons":2==e?"iltPermHeaderButtons":"edataPermHeaderButtons";document.querySelector('[rel="'+t+'"]').classList.remove("DNI"),lmsnewsettings.resetSaveEnable(1,null,!1,"mpPerm",!0),ZPeopleComponents.select(this).zclassName="ztextbox__error"==ZPeopleComponents.select(this).zclassName?"":null,$(this.parentElement).find(".ztextbox--error__label").remove()},deleteOption:function(e,t,s){for(var r=document.querySelector('[rel="'+s+'"]').querySelector('[_rel="'+t+'"]').querySelectorAll('[rel="selElem"]'),l=0;l<r.length;l++)ZPeopleComponents.select(settingsPage.container.find("#"+r[l].getAttribute("id"))).destroy();document.querySelector('[rel="'+s+'"]').querySelector('[_rel="'+t+'"]').remove();var a=0==e?"lpPermHeaderButtons":1==e?"selfPermHeaderButtons":2==e?"iltPermHeaderButtons":"edataPermHeaderButtons";document.querySelector('[rel="'+a+'"]').classList.remove("DNI"),lmsnewsettings.resetSaveEnable(1,null,!1,"mpPerm",!0)},configSave:function(e,t){var s,r,l,a=!1,n={},i={},o={},c="",d={},m={},u={},p={},g={},f={};if(s="0"==e?lmsnewsettings.courseTypeSettingIds["zp.lms.learningplan"]:"1"==e?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]:lmsnewsettings.courseTypeSettingIds.Self:"2"==e?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]:lmsnewsettings.courseTypeSettingIds.Ilt:lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]:lmsnewsettings.courseTypeSettingIds.Manuals,c=settingsPage.container.find('[id="allusers_'+e+'"]').prop("checked")?0:1,i={},o={},0==e||1==e&&lmsnewsettings.selfSettingData.isSelfenable||2==e&&lmsnewsettings.iltSettingData.isIltenable||3==e&&lmsnewsettings.manualSettingData.isManualenable)if(d={},m={},u={},p={},g={},f={},1==c){if(1==c&&0!=settingsPage.container.find('[rel="createOpt"]').find('[rel="newUser"]').length){r=document.querySelector('[rel="create_'+e+'"]').querySelector('[rel="createOpt"]').querySelectorAll('[rel="newUser"]');for(var v=0;v<r.length;v++)l=r[v].getAttribute("_rel").split("_")[2],0!=$('[id="newUser_'+e+"_0_"+l+'"]').length&&(r[v].getAttribute("_rel").split("_")[1],fCont=ZPeopleComponents.select($('[id="newUser_'+e+"_0_"+l+'"]')).getValue(),fId=ZPeopleComponents.select($('[id="atoval_'+e+"_0_"+l+'"]')).getValue(),0==fCont&&(a=!0,lmsnewsettings.getManagePermsSettings.appendErrorMsg({elem:$('[id="newUser_'+e+"_0_"+l+'"]'),msg:ZPI18N.getString("zp.fieldupdate.fieldemptyerror")})),0!=fId?1==fCont?m[fId]=fId:2==fCont?u[fId]=fId:7==fCont?p[fId]=fId:3==fCont?g[fId]=fId:6==fCont&&(f[fId]=fId):(a=!0,lmsnewsettings.getManagePermsSettings.appendErrorMsg({elem:$('[id="atoval_'+e+"_0_"+l+'" ]'),msg:ZPI18N.getString("zp.fieldupdate.fieldemptyerror")})))}d.desi=m,d.dept=u,d.group=p,d.role=g,d.user=f,i.users=d}else 0==c&&(d.desi=m,d.dept=u,d.group=p,d.role=g,d.user=f,i.users=d);i.opt=c,o.create=i,i={};var h=3==e?"edatashare":1==e?"selfShare":2==e?"iltShare":null;if(c=null!=h&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+h)).getState()?0:1,i.opt=c,o.share=i,i={},d={},m={},u={},p={},g={},f={},0==(c=null!=(h=0==e?"lpModerate":1==e?"selfModerate":2==e?"iltModerate":null)&&ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+h)).getState()?0:1)){if(0!=settingsPage.container.find('[rel="moderateOpt"]').find('[rel="newUser"]').length){r=document.querySelector('[rel="moderate_'+e+'"]').querySelector('[rel="moderateOpt"]').querySelectorAll('[rel="newUser"]');for(v=0;v<r.length;v++)l=r[v].getAttribute("_rel").split("_")[2],0!=$('[id="newUser_'+e+"_1_"+l+'"]').length&&(r[v].getAttribute("_rel").split("_")[1],fCont=ZPeopleComponents.select($('[id="newUser_'+e+"_1_"+l+'"]')).getValue(),fId=ZPeopleComponents.select($('[id="atoval_'+e+"_1_"+l+'"]')).getValue(),0==fCont&&(a=!0,lmsnewsettings.getManagePermsSettings.appendErrorMsg({elem:$('[id="newUser_'+e+"_1_"+l+'"]'),msg:ZPI18N.getString("zp.fieldupdate.fieldemptyerror")})),0!=fId?1==fCont?m[fId]=fId:2==fCont?u[fId]=fId:7==fCont?p[fId]=fId:3==fCont?g[fId]=fId:6==fCont&&(f[fId]=fId):(a=!0,lmsnewsettings.getManagePermsSettings.appendErrorMsg({elem:$('[id="atoval_'+e+"_1_"+l+'" ]'),msg:ZPI18N.getString("zp.fieldupdate.fieldemptyerror")})))}d.desi=m,d.dept=u,d.group=p,d.role=g,d.user=f,i.users=d}else 1==c&&(d.desi=m,d.dept=u,d.group=p,d.role=g,d.user=f,i.users=d);if(i.opt=c,o.moderate=i,n[s]=o,1!=a){if(1==t)return n;var b={configtype:e,isFromNewSettings:!0,settingIdsObj:JSON.stringify(n)},I=0==e?"lpPermHeaderButtons":1==e?"selfPermHeaderButtons":2==e?"iltPermHeaderButtons":"edataPermHeaderButtons",y=0==e?"lpPermHeaderDiv":1==e?"selfPermHeaderDiv":2==e?"iltPermHeaderDiv":"edataPermHeaderDiv";document.querySelector('[rel="'+I+'"]').classList.add("DNI"),document.querySelector('[rel="'+y+'"]').innerHTML+=lmsnewsettings.returnSaving(),zplms.put("/lms/settings/permission",b,(function(e){"Success"==e[1].message?(document.querySelector('[id="savingHtml"]').remove(),$('[rel="'+y+'"]').find("#savedHtml")&&$('[rel="'+y+'"]').find("#savedHtml").remove(),document.querySelector('[rel="'+y+'"]').innerHTML+=lmsnewsettings.returnSaved(y),lmsnewsettings.savedFadeOut(y),lmsnewsettings.savedConfigData=e[1].savedConfigData,ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess"))):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))}},appendErrorMsg:function(e){if(e.elem&&0!=e.elem.length&&(ZPeopleComponents.select(e.elem).zclassName="ztextbox__error"==ZPeopleComponents.select(e.elem).zclassName?ZPeopleComponents.select(e.elem).zclassName:"ztextbox__error",ZPeopleComponents.select(e.elem).zclassName="ztextbox__error",e.msg)){var t=$(e.elem).parent();0==$(t).find(".ztextbox--error__label").length&&t.append('<span class="ztextbox--error__label">'+e.msg+"</span>")}},resetManagePermsOpts:function(e,t){var s=0==e?"lpPermHeaderButtons":1==e?"selfPermHeaderButtons":2==e?"iltPermHeaderButtons":"edataPermHeaderButtons";t?document.querySelector('[rel="'+s+'"]').classList.remove("DNI"):document.querySelector('[rel="'+s+'"]').classList.add("DNI");var r,l,a,n;a=0==e?ZPI18N.getString("zp.lms.learningplan"):1==e?ZPI18N.getString("zp.lms.settings.SelfPaced"):2==e?ZPI18N.getString("zp.lms.settings.InstructorLed"):ZPI18N.getString("zp.lms.settings.DigitalDownloads"),l=0==e?lmsnewsettings.courseTypeSettingIds["zp.lms.learningplan"]:1==e?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]:lmsnewsettings.courseTypeSettingIds.Self:2==e?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]:lmsnewsettings.courseTypeSettingIds.Ilt:lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]?lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]:lmsnewsettings.courseTypeSettingIds.Manuals,r=(n=lmsnewsettings.savedConfigData[l]?lmsnewsettings.savedConfigData[l]:lmsnewsettings.savedConfigData[0])?n.manageCreateOptions:null,settingsPage.container.find('[id="allusers_'+e+'"]').prop("checked",!!(r&&0==r.create||!n&&a==ZPI18N.getString("zp.lms.settings.DigitalDownloads"))),settingsPage.container.find('[id="limitedusers_'+e+'"]').prop("checked",!!(r&&1==r.create||!n&&a!=ZPI18N.getString("zp.lms.settings.DigitalDownloads")));var i=1==e?"selfShare":2==e?"iltShare":3==e?"edatashare":"";i&&(r&&0==r.share||!n?ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+i)).switchOn():ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+i)).switchOff()),(i=0==e?"lpModerate":1==e?"selfModerate":2==e?"iltModerate":"")&&(r&&1==r.moderate||!n?ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+i)).switchOff():ZPeopleComponents.toggleswitch(settingsPage.container.find("#"+i)).switchOn()),(!n&&a!=ZPI18N.getString("zp.lms.settings.DigitalDownloads")||r&&1==r.create)&&(0==e||3==e?(0==e?"isLP":"eMaterial",lmsnewsettings.getManagePermsSettings.constructApplicableUsers(n,e,0,!1)):lmsnewsettings.getManagePermsSettings.constructApplicableUsers(n,e,0,!1)),r&&0==r.moderate&&(0==e||3==e?(0==e?"isLP":"eMaterial",lmsnewsettings.getManagePermsSettings.constructApplicableUsers(n,e,1,!1)):lmsnewsettings.getManagePermsSettings.constructApplicableUsers(n,e,1,!1))}},getLearningPlanSettings:{init:async function(e){var t=!!document.querySelector('[rel="getLpPerm"]')&&(null!=e&&1!=e);await lmsnewsettings.getSettingsData(null,1),lmsnewsettings.getManagePermsSettings.delConstructedSelElem();var s=lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds["zp.lms.learningplan"]]?lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds["zp.lms.learningplan"]]:lmsnewsettings.savedConfigData[0],r='<div class="zpl_rgtcnt" rel="getLpPerm"><div class="zpl_crd"><div class="zpl_crdhdr zpl_rgt" rel="lpPermHeaderDiv"><div><h4>'+ZPI18N.getString("zp.lms.learningplan")+"</h4><p>"+ZPI18N.getString("zp.lms.settings.mcmultilptitle")+'</p></div><div rel="lpPermHeaderButtons" class="DNI"><button rel="managepermreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="managepermsave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn zpl_secn2"><div><div class="zpl_gbox wd100_per"><div><h4>'+ZPI18N.getString("zp.add")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.lpdesc")+'</p></div><div class="zpl_gboxwhti"><div class="zpl_secn" rel="create_0"><div rel="createOpt" _rel="create"><div class="zradiobutton zradiobutton--horizontal"><input id="allusers_0" name="cOpt_0" rel="allusers" _rel="allusers_0" type="radio" value="" class="zradiobutton__helper"><label for="allusers_0" rel="allusers" _rel="allusers_0" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.permissionallusers")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input  id="limitedusers_0" name="cOpt_0" rel="limitedusers" _rel="limitedusers_0" type="radio" value="" class="zradiobutton__helper" checked=""><label for="limitedusers_0" rel="limitedusers" _rel="limitedusers_0" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.selectedemps")+"</span></label></div>";s&&s.manageCreateOptions&&1==s.manageCreateOptions.create&&(r+='<div class="zpl_idiv" rel="adminInfo"><div class="zpl_info"><em>'+ZPI18N.getString("zp.lms.learningplan.adminInfo")+'</em></div></div><div class="zpl_idiv"><div class="zpl_gbox" rel="create_0"><div class="zpl_idiv" rel="addCon"><a class="zpl_lnkbg" rel="addCondition" _rel="atouseradd_0_0">'+ZPI18N.getString("zp.lms.addcondition")+"</a></div></div></div>"),r+='</div></div></div></div></div><div><div class="zpl_gbox wd100_per" rel="lpModSettings"><div><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="lpmoderate" id="lpModerate">'+ZPI18N.getString("zp.moderate")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.lpmoddesc")+"</p></div></div>",s&&s.manageCreateOptions&&0==s.manageCreateOptions.moderate&&(r+='<div class="zpl_gboxwhti"><div class="zpl_secn" rel="moderate_0"><div rel="moderateOpt" _rel="" rel="moderate"><div class="zpl_idiv" rel="adminInfo"><div class="zpl_info"><em>'+ZPI18N.getString("zp.lms.learningplan.adminModInfo")+'</em></div></div><div class="zpl_idiv"><div class="zpl_gbox" rel="moderate"><div class="zpl_idiv" rel="addCon"><a class="zpl_lnkbg" rel="addCondition"_rel="atouseradd_0_1">'+ZPI18N.getString("zp.lms.addcondition")+"</a></div></div></div></div></div></div>"),r+="</div></div></div></div></div></div>",settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(r),lmsnewsettings.getManagePermsSettings.resetManagePermsOpts(0,t),ZPeopleComponents.toggleswitch(settingsPage.container.find('[rel="lpmoderate"]')),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1),settingsPage.container.find('[rel="lpmoderate"]').on("ztoggleswitchchange",lmsnewsettings.resetSaveEnable))}},getSelfPacedSettings:{init:async function(e){var t=!!document.querySelector('[rel="getSelfPerm"]')&&(null!=e&&1!=e);await lmsnewsettings.getSettingsData(null,1),lmsnewsettings.getManagePermsSettings.delConstructedSelElem();var s=lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]]?lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.self"]]:lmsnewsettings.savedConfigData[0];s||(s=lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds.Self]?lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds.Self]:lmsnewsettings.savedConfigData[0]);var r='<div class="zpl_rgtcnt" rel="getSelfPerm"><div class="zpl_crd"><div class="zpl_crdhdr zpl_rgt" rel="selfPermHeaderDiv"><div><h4>'+ZPI18N.getString("zp.lms.settings.SelfPaced")+"</h4><p>"+ZPI18N.getString("zp.lms.settings.mcmultititle")+'</p></div><div rel="selfPermHeaderButtons" class="DNI"><button rel="managepermreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="managepermsave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn zpl_secn2"><div><div class="zpl_gbox wd100_per"><div><h4>'+ZPI18N.getString("zp.add")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.selfdesc")+'</p></div><div class="zpl_gboxwhti"><div class="zpl_secn" rel="create_1"><div rel="createOpt" _rel="create"><div class="zradiobutton zradiobutton--horizontal"><input id="allusers_1" name="cOpt_1" rel="allusers" _rel="allusers_1" type="radio" value="" class="zradiobutton__helper"><label for="allusers_1" rel="allusers" _rel="allusers_1" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.permissionallusers")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input  id="limitedusers_1" name="cOpt_1" rel="limitedusers" _rel="limitedusers_1" type="radio" value="" class="zradiobutton__helper" checked=""><label for="limitedusers_1" rel="limitedusers" _rel="limitedusers_1" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.selectedemps")+"</span></label></div>";s&&s.manageCreateOptions&&1==s.manageCreateOptions.create&&(r+='<div class="zpl_idiv" rel="adminInfo"><div class="zpl_info"><em>'+ZPI18N.getString("zp.lms.learningplan.adminInfo")+'</em></div></div><div class="zpl_idiv"><div class="zpl_gbox" rel="create_1"><div class="zpl_idiv" rel="addCon"><a class="zpl_lnkbg" rel="addCondition" _rel="atouseradd_1_0">'+ZPI18N.getString("zp.lms.addcondition")+"</a></div></div></div>"),r+='</div></div></div></div></div><div><div class="zpl_gbox wd100_per"><div><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="selfshare" id="selfShare">'+ZPI18N.getString("zp.lms.share")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.selfsharedesc")+'</p></div></div></div></div><div><div class="zpl_gbox wd100_per" rel="selfModSettings"><div><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="selfmoderate" id="selfModerate">'+ZPI18N.getString("zp.moderate")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.selfmoddesc")+"</p></div></div>",s&&s.manageCreateOptions&&0==s.manageCreateOptions.moderate&&(r+='<div class="zpl_gboxwhti"><div class="zpl_secn" rel="moderate_1"><div rel="moderateOpt" _rel="" rel="moderate"><div class="zpl_idiv" rel="adminInfo"><div class="zpl_info"><em>'+ZPI18N.getString("zp.lms.learningplan.adminModInfo")+'</em></div></div><div class="zpl_idiv"><div class="zpl_gbox" rel="moderate"><div class="zpl_idiv" rel="addCon"><a class="zpl_lnkbg" rel="addCondition"_rel="atouseradd_1_1">'+ZPI18N.getString("zp.lms.addcondition")+"</a></div></div></div></div></div></div>"),r+="</div></div></div></div></div></div>",settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(r),lmsnewsettings.getManagePermsSettings.resetManagePermsOpts(1,t),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1),ZPeopleComponents.toggleswitch(settingsPage.container.find('[rel="selfshare"]')),settingsPage.container.find('[rel="selfshare"]').on("ztoggleswitchchange",lmsnewsettings.resetSaveEnable),ZPeopleComponents.toggleswitch(settingsPage.container.find('[rel="selfmoderate"]')),settingsPage.container.find('[rel="selfmoderate"]').on("ztoggleswitchchange",lmsnewsettings.resetSaveEnable))}},getBlendedSettings:{init:async function(e){var t=!!document.querySelector('[rel="getIltPerm"]')&&(null!=e&&1!=e);await lmsnewsettings.getSettingsData(null,1),lmsnewsettings.getManagePermsSettings.delConstructedSelElem();var s=lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]]?lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.ILT"]]:lmsnewsettings.savedConfigData[0];s||(s=lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds.Ilt]?lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds.Ilt]:lmsnewsettings.savedConfigData[0]);var r='<div class="zpl_rgtcnt" rel="getIltPerm"><div class="zpl_crd"><div class="zpl_crdhdr zpl_rgt" rel="iltPermHeaderDiv"><div><h4>'+ZPI18N.getString("zp.lms.settings.InstructorLed")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.blendeddesc")+'</p></div><div rel="iltPermHeaderButtons" class="DNI"><button rel="managepermreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="managepermsave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn zpl_secn2"><div><div class="zpl_gbox wd100_per"><div><h4>'+ZPI18N.getString("zp.add")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.blendeddesc")+'</p></div><div class="zpl_gboxwhti"><div class="zpl_secn" rel="create_2"><div rel="createOpt" _rel="create"><div class="zradiobutton zradiobutton--horizontal"><input id="allusers_2" name="cOpt_2" rel="allusers" _rel="allusers_2" type="radio" value="" class="zradiobutton__helper"><label for="allusers_2" rel="allusers" _rel="allusers_2" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.permissionallusers")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input  id="limitedusers_2" name="cOpt_2" rel="limitedusers" _rel="limitedusers_2" type="radio" value="" class="zradiobutton__helper" checked=""><label for="limitedusers_2" rel="limitedusers" _rel="limitedusers_2" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.selectedemps")+"</span></label></div>";s&&s.manageCreateOptions&&1==s.manageCreateOptions.create&&(r+='<div class="zpl_idiv" rel="adminInfo"><div class="zpl_info"><em>'+ZPI18N.getString("zp.lms.learningplan.adminInfo")+'</em></div></div><div class="zpl_idiv"><div class="zpl_gbox" rel="create_2"><div class="zpl_idiv" rel="addCon"><a class="zpl_lnkbg" rel="addCondition" _rel="atouseradd_2_0">'+ZPI18N.getString("zp.lms.addcondition")+"</a></div></div></div>"),r+='</div></div></div></div></div><div><div class="zpl_gbox wd100_per"><div><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="iltshare" id="iltShare">'+ZPI18N.getString("zp.lms.share")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.blendedsharedesc")+'</p></div></div></div></div><div><div class="zpl_gbox wd100_per" rel="iltModSettings"><div><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="iltmoderate" id="iltModerate">'+ZPI18N.getString("zp.moderate")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.blendedmoddesc")+"</p></div></div>",s&&s.manageCreateOptions&&0==s.manageCreateOptions.moderate&&(r+='<div class="zpl_gboxwhti"><div class="zpl_secn" rel="moderate_2"><div rel="moderateOpt" _rel="" rel="moderate"><div class="zpl_idiv" rel="adminInfo"><div class="zpl_info"><em>'+ZPI18N.getString("zp.lms.learningplan.adminModInfo")+'</em></div></div><div class="zpl_idiv"><div class="zpl_gbox" rel="moderate"><div class="zpl_idiv" rel="addCon"><a class="zpl_lnkbg" rel="addCondition"_rel="atouseradd_2_1">'+ZPI18N.getString("zp.lms.addcondition")+"</a></div></div></div></div></div></div>"),r+="</div></div></div></div></div></div>",settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(r),lmsnewsettings.getManagePermsSettings.resetManagePermsOpts(2,t),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1),ZPeopleComponents.toggleswitch(settingsPage.container.find('[rel="iltshare"]')),settingsPage.container.find('[rel="iltshare"]').on("ztoggleswitchchange",lmsnewsettings.resetSaveEnable),ZPeopleComponents.toggleswitch(settingsPage.container.find('[rel="iltmoderate"]')),settingsPage.container.find('[rel="iltmoderate"]').on("ztoggleswitchchange",lmsnewsettings.resetSaveEnable))}},getDigitalSettings:{init:async function(e){var t=!!document.querySelector('[rel="getEDataPerm"]')&&(null!=e&&1!=e);await lmsnewsettings.getSettingsData(null,1),lmsnewsettings.getManagePermsSettings.delConstructedSelElem();var s=lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]]?lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds["zp.lms.settings.courseType.manuals"]]:lmsnewsettings.savedConfigData[0];s||(s=lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds.Manuals]?lmsnewsettings.savedConfigData[lmsnewsettings.courseTypeSettingIds.Manuals]:lmsnewsettings.savedConfigData[0]);var r='<div class="zpl_rgtcnt" rel="getEDataPerm"><div class="zpl_crd"><div class="zpl_crdhdr zpl_rgt" rel="edataPermHeaderDiv"><div><h4>'+ZPI18N.getString("zp.lms.settings.DigitalDownloads")+"</h4><p>"+ZPI18N.getString("zp.lms.settings.mcmultidigitaltitle")+'</p></div><div rel="edataPermHeaderButtons" class="DNI"><button rel="managepermreset" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+'</button><button rel="managepermsave" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button></div></div><div class="zpl_crdcnt"><div class="zpl_secn zpl_secn2"><div><div class="zpl_gbox wd100_per"><div><h4>'+ZPI18N.getString("zp.add")+"</h4><p>"+ZPI18N.getString("zp.lms.newsettings.edatadesc")+'</p></div><div class="zpl_gboxwhti"><div class="zpl_secn" rel="create_3"><div rel="createOpt" _rel="create"><div class="zradiobutton zradiobutton--horizontal"><input id="allusers_3" name="cOpt_3" rel="allusers" _rel="allusers_3" type="radio" value="" class="zradiobutton__helper"><label for="allusers_3" rel="allusers" _rel="allusers_3" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.permissionallusers")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input  id="limitedusers_3" name="cOpt_3" rel="limitedusers" _rel="limitedusers_3" type="radio" value="" class="zradiobutton__helper" checked=""><label for="limitedusers_3" rel="limitedusers" _rel="limitedusers_3" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.selectedemps")+"</span></label></div>";s&&s.manageCreateOptions&&1==s.manageCreateOptions.create&&(r+='<div class="zpl_idiv"><div class="zpl_gbox" rel="create_3"><div class="zpl_idiv" rel="addCon"><a class="zpl_lnkbg" rel="addCondition" _rel="atouseradd_3_0">'+ZPI18N.getString("zp.lms.addcondition")+"</a></div></div></div>"),r+='</div></div></div></div></div><div><div class="zpl_gbox wd100_per" rel="edataModSettings"><div><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" rel="edatashare" id="edatashare">'+ZPI18N.getString("zp.lms.share")+"</h5><p>"+ZPI18N.getString("zp.lms.newsettings.edatasharedesc")+"</p></div></div></div></div></div></div></div></div>",settingsPage.container[0].id.includes("-lms")&&(settingsPage.container.html(r),lmsnewsettings.getManagePermsSettings.resetManagePermsOpts(3,t),ZPeopleComponents.toggleswitch(settingsPage.container.find('[rel="edatashare"]')),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1),settingsPage.container.find('[rel="edatashare"]').on("ztoggleswitchchange",lmsnewsettings.resetSaveEnable))}},getRooms:{baseEl:null,roomsIndex:1,facilitiesIndex:1,uploadHelperObject:{},formValues:{},init:function(){ZPeople.FireScroll.reset(),lmsnewsettings.getRooms.roomsIndex=1,lmsnewsettings.getRooms.baseEl=document.querySelector("#tab-lms-rooms"),lmsnewsettings.getRooms.baseContainer=document.querySelector("#mainwrp-o-lms"),settingsPage.container.html(""),lmsbase.getFormId(lmsnewsettings.getRooms.layoutConstruction)},layoutConstruction:function(){html='<div class="zpl_btnmnu"><div class="zpl_rgt"><button _rel="addRoom" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.lms.rooms.addrooms")+'</button><i _rel="addFacPopup" class="zpl_ibg PI_facility tooltip-js" title="'+ZPI18N.getString("zp.lms.rooms.addfacility")+'" data-title-position="bottom"></i></div></div><div class="zpl_rgtcnt"><div _rel="rlist" class="zpl_tblres"></div></div>',settingsPage.container.html(html),lmsbase.addListener(lmsnewsettings.getRooms.baseEl,"click",lmsnewsettings.getRooms.clickHandler),lmsnewsettings.getRooms.fetchRooms(1)},fetchRooms:function(e){var t={start:e};zplms.get("/lms/rooms",t,(function(t){if(t[1].length>0)if(settingsPage.container.find("[_rel=addRoom]").removeClass("zpl_DNI"),lmsnewsettings.getRooms.constructRooms(t[1]||[],1==e?"new":"update"),lmsnewsettings.getRooms.roomsIndex=25==t[1].length?lmsnewsettings.getRooms.roomsIndex+25:"end","end"==lmsnewsettings.getRooms.roomsIndex)ZPeople.FireScroll.setParam("triggered",!0),lmstrainers.lastRequestParams=null;else{ZPeople.FireScroll.setParam("triggered",!1),ZPeople.FireScroll.init(lmsnewsettings.loadMore,lms,{tab:"tab-lms-rooms"},!0);const e=$("#tab-lms-rooms");e.height()&&e.prop("scrollHeight")<=e.height()&&lmsnewsettings.loadMore({tab:"tab-lms-rooms"})}else lmsnewsettings.getRooms.showNoData(lmsnewsettings.getRooms.baseEl.querySelector('[_rel="rlist"]')),settingsPage.container.find("[_rel=addRoom]").addClass("zpl_DNI")}))},constructRooms:function(e,t){html="","new"==t&&(html='<table class="zpl_tbl"><thead><tr><th width="30%">'+ZPI18N.getString("zp.lms.sessions.RoomName")+"</th><th>"+ZPI18N.getString("zp.location")+"</th><th>"+ZPI18N.getString("zp.lms.facilities")+"</th><th>"+ZPI18N.getString("zp.lms.batches.Capacity")+'</th><th width="80"></th></tr></thead><tbody id="roomsList"></tbody></table>',settingsPage.container.find('[_rel="rlist"]').html(html));let s="";for(var r=0;r<e.length;r++)roomObj=e[r],s+='<tr roomid="'+roomObj.roomId+'" _rel="editroom"><td><div class="zpl_em"><div class="zpl_emimg">'+lmsnewsettings.getRooms.getRoomImageHTML(roomObj)+'</div><div class="zpl_emdts"><div><b>'+roomObj.roomName+"</b></div></div></div></td><td><span>"+(roomObj.locationName?roomObj.locationName:"")+'</span></td><td _rel="fac"></td><td><span>'+roomObj.roomcapacity+'</span></td><td><div class="text-center"><div class="zpl_hvr"><i _rel="deleteroom" class="PI_delete" data-ttip="'+ZPI18N.getString("zp.delete")+'"/></div></div></td></tr>';settingsPage.container.find("#roomsList").append(s);for(var l=0;l<e.length;l++){var a=e[l].ROOMFC,n=lmsnewsettings.getRooms.baseEl.querySelector('[roomid="'+e[l].roomId+'"]').querySelector('[_rel="fac"]');if(a.length>0)for(var i=0,o=0,c=0;c<a.length;c++){if((d=document.createElement("div")).setAttribute("class","zpl_tg"),d.innerHTML="<span>"+lmsFormConstants.getValue(a[c].FC)+"</span>",d.setAttribute("facid","facility"+c),n.appendChild(d),i+=d.offsetWidth,o+=1,c==a.length-1&&i<=n.offsetWidth)break;if(i+180>=n.offsetWidth||o>5){var d;(d=document.createElement("div")).setAttribute("class","zpl_tg");var m="moreFac"+e[l].roomId;d.innerHTML=`<a id=${m}>+${a.length-c}</a>`,n.replaceChild(d,n.querySelector("[facid=facility"+c+"]")),lmsnewsettings.getRooms.constructMoreOption(a,"allFac"+e[l].roomId,o-1,m);break}}n.removeAttribute("_rel")}},constructMoreOption:function(e,t,s,r){if(e.length>0){var l='<div id="'+t+'" class="zpl_drpdwn zpl_tagdrpdwn zmenu zposition--bottomright zh-radiustopright" data-type="list"><ul data-body="true" style="height: auto;">';let a=0;$.each(e,(function(e,t){a>=s&&(l+='<li data-item-type="custom"><div class="zpl_tg"><span>'+lmsFormConstants.getValue(t.FC)+"</span></div></li>"),a++})),l+="</ul></div>",$(settingsPage.mainWrapId).append(l),ZPeopleComponents.menu("#"+t,{forElement:"#"+r}),settingsPage.container.find("#"+r).off().on("click",(e=>{e.stopPropagation(),ZPeopleComponents.menu("#"+t).show()}))}},getRoomImageHTML:function(e){var t="";if(e.roomImageInfo&&!lmsnewsettings.getRooms.checkIfTheExtensionIsUnSupported(e.roomImageInfo.extension))e.roomImageInfo.additionalInfo={fileId:e.roomId,type:4},src=lmsfileaction.generateSourceURL(e.roomImageInfo),t="<img src="+src+">";else{var s=ZPeople.decodeTxt(e.roomName),r=(s=s.replace("<","").replace(">","")).length%5,l=s.match(/\b[a-z0-9]/gi);l=l||[];var a=s.charAt(0);l[1]?a+=l[1]:a+=s.charAt(1),t='<span class="zpl_pichr PC'+r+'">'+a+"</span>"}return t},checkIfTheExtensionIsUnSupported:function(e){return["gif","apng","avif","mng","flif","svg","swf","flv","rag","cpt","webp","xbm"].includes(e)},fetchFormFields:function(e){var t={formId:lmsbase.roomFormId,mode:"getFormComponents",conreqcsr:csrfToken};$.post("/formAction.zp",t,(function(t){7e3==t.code&&(lmsnewsettings.getRooms.formFields=t.message.formComponentDetails[0].column1,e())}))},constructAddEditRoomPopup:function(e,t){formFields=lmsnewsettings.getRooms.formFields,formValues=lmsnewsettings.getRooms.formValues,lmsnewsettings.getRooms.currentRoomId=t,divEl=document.createElement("div"),divEl.setAttribute("class","zpl_mdl zpl_mcenter zpl_mopen"),divEl.setAttribute("_rel","roompopup"),html='<div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+("edit"==e?ZPI18N.getString("zp.lms.rooms.editroom"):ZPI18N.getString("zp.lms.rooms.addrooms"))+"</h4><p>"+ZPI18N.getString("zp.lms.rooms.roomdescription")+'</p></div><a class="_cls PI_cls" _rel="close"></a></div><div class="zpl_mcnt zpl_fm"><form id="room_form"><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><div class="zpl_upld prof" listElement _rel="image"><div class="zpl_fldrp" clickElement attachmentList _rel="'+("edit"==e?"":"local")+'" rel="uploadImage"><i class="PI_image"></i><p>'+ZPI18N.getString("zp.lms.rooms.chooseimage")+"</p>","edit"==e&&""!=lmsnewsettings.getRooms.formValues[t][4].componentValue&&(html+='<div class="zpl_profcnt" _rel="roomimage"><img src="'+lmsfileaction.generateSourceURL(lmsnewsettings.getRooms.formValues[t][4].componentValue)+'"><div class="zpl_imgact"><span class="zlabel zlabel--blue" _rel="local"><i class="PI_edt tooltip-js" title="'+ZPI18N.getString("zp.edit")+'" data-title-position="bottom"></i></span><span class="zlabel zlabel--red" _rel="deleteimage"><i class="PI_reset tooltip-js" title="'+ZPI18N.getString("zp.reset")+'" data-title-position="bottom"></i></span></div></div>'),html+='</div></div></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+lmsform.changetoI18N(formFields[0].displayName)+'</label></div><div _rel="name"><input _rel= "room_name_id" type="text" maxlength = "'+formFields[0].maxLength+'" class="ztextbox" value="'+("edit"==e?lmsnewsettings.getRooms.formValues[t][0].componentValue:"")+'"><span _rel="name_span" class="ztextbox--error__label" style = "display : none;">'+ZPI18N.getString("zp.lms.rooms.roomname-empty")+'</span></div></div><div class="zpl_secn zpl_twoclum"><div _rel="capacity"><label class="zpl_mtry">'+lmsform.changetoI18N(formFields[1].displayName)+'</label><input type="text" _rel="room_capacity_id" maxlength = "5" class="ztextbox" value="'+("edit"==e?lmsnewsettings.getRooms.formValues[t][1].componentValue:"")+'"><span _rel="capacity_span" class="ztextbox--error__label" style = "display : none;">'+ZPI18N.getString("zp.lms.rooms.roomcapacity-empty")+'</span></div><div _rel="location"><label>'+lmsform.changetoI18N(formFields[2].displayName)+'</label><select _rel="locmenu"  style="display: none;" class="select-js"></select><span _rel= "location_span" class="ztextbox--error__label" style="display: none;">'+ZPI18N.getString("zp.lms.rooms.roomlocation-empty")+'</span></div></div><div class="zpl_secn"><div><label>'+lmsform.changetoI18N(formFields[3].displayName)+'</label></div><div _rel="facilities"><textarea _rel="facmenu" class="tokenfieldId-js" style="display: none;"></textarea></div></div></div></div></form></div><div class="zpl_mfoter"><button class="zlabel zlabel--blue zlabel--medium" type="button" id="room_submit" _rel="saveroom">'+ZPI18N.getString("zp.save")+'</button><button class="zlabel zlabel--outline zlabel--medium" type="button" _rel="roomclose">'+ZPI18N.getString("zp.cancel")+"</button></div></div>",divEl.innerHTML=html,lmsnewsettings.getRooms.baseContainer.appendChild(divEl),"edit"==e&&""==lmsnewsettings.getRooms.formValues[t][4].componentValue&&lmsnewsettings.getRooms.baseContainer.querySelector("[clickElement]").setAttribute("_rel","local"),lmsnewsettings.getRooms.popupEl=lmsnewsettings.getRooms.baseContainer.querySelector("[_rel=roompopup]"),lmsbase.addListener(divEl,"click",lmsnewsettings.getRooms.clickPopupHandler),lmsbase.addListener(divEl,"input",(function(e){null!=event.target.closest("[_rel=capacity]")&&lmsformcomponents.numberFun(e)}),!1);var s=[];for(var r in arr=formFields[2].Options,formFields[2].Options){(d={}).value=arr[r].Id,d.label=arr[r].Value,s.push(d)}var l={options:s,dropdownList:{fitForElement:!0,isTextHTMLEncoded:!0},isLabelHTMLEncoded:!0};ZPeopleComponents.select(divEl.querySelector("[_rel=locmenu]")).setAttributes(l),"edit"==e&&ZPeopleComponents.select(divEl.querySelector("[_rel=locmenu]")).setValue(lmsnewsettings.getRooms.formValues[t][2].componentValue_ID);var a=[];for(var r in arr=formFields[3].OptionsWithId,arr){(d={}).id=arr[r].Id,d.name=lmsFormConstants.getValue(arr[r].Value),d.decodedText=ZPeople.decodeTxt(lmsFormConstants.getValue(arr[r].Value)),a.push(d)}s={data:a,dropdownList:{contentType:"text",fitForElement:!0,closeOnSelect:!1,isTextHTMLEncoded:!0,hideItemOnSelect:!0},isLabelHTMLEncoded:!0,dataMapping:{text:"name",value:"id",id:"id"},search:{by:"decodedText"},allowDuplicateValues:!1};if("edit"==e){var n=lmsnewsettings.getRooms.formValues[t][3].componentValue_ID.split(";");if(""!==n[0]){for(var i=lmsnewsettings.getRooms.formValues[t][3].componentValue,o=[],c=0;c<n.length;c++){var d;(d={}).id=n[c],d.name=lmsFormConstants.getValue(i[c]),o.push(d)}s.values=o}}ZPeopleComponents.tokenfield(divEl.querySelector("[_rel=facmenu]"),s),lmsnewsettings.getRooms.invokeUploadManager()},invokeUploadManager:function(){var e={clickElement:lmsnewsettings.getRooms.popupEl.querySelector('[rel="uploadImage"]'),moduleName:"lms",multiple:!1,MAXSIZE:5242880,SUPPORTED_SOURCES:lmsfileaction.SOURCE.BOTH,requiredFileTypes:"image",version:5};e.callbackObject=e;var t={MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED:1,type:lmsuploadmanager.UPLOADMANAGER_TYPE.SINGLEIMAGEUPLOADMANAGER,listElement:lmsnewsettings.getRooms.popupEl.querySelector("[listElement]")};lmsnewsettings.getRooms.uploadHelperObject=lmsuploadmanager.initUploadManager(t,new lmsfileaction.upload(e)),lmsnewsettings.getRooms.uploadHelperObject.attachCallback("onbeforeupload",SingleImageUploadManager.onBeforeUpload),lmsnewsettings.getRooms.uploadHelperObject.attachCallback("getSingleAttachment",lmsnewsettings.getRooms.onFileStored),lmsnewsettings.getRooms.uploadHelperObject.attachCallback("onafterupload",SingleImageUploadManager.onAfterUpload),lmsnewsettings.getRooms.uploadHelperObject.attachCallback("getPreviewObject",lmsattachment.getPreviewObject),lmsnewsettings.getRooms.uploadHelperObject.attachCallback("lightbox_src_callback",lmsattachment.lightbox_src_callback),lmsnewsettings.getRooms.uploadHelperObject.attachCallback("lightbox_click_callback",lmsattachment.lightbox_click_callback),lmsnewsettings.getRooms.uploadHelperObject.attachCallback("onMaximumUploadLimitReached",SingleImageUploadManager.onMaximumNumberOfUploadLimitReached),null!=formValues[lmsnewsettings.getRooms.currentRoomId]&&""!=formValues[lmsnewsettings.getRooms.currentRoomId][4].componentValue&&null!=formValues[lmsnewsettings.getRooms.currentRoomId][4].componentValue&&lmsnewsettings.getRooms.uploadHelperObject.addSavedFiles([formValues[lmsnewsettings.getRooms.currentRoomId][4].componentValue]),lmsnewsettings.getRooms.uploadHelperObject.bind()},onFileStored:function(e){$("[rel=uploadImage]").children().addClass("zpl_DNI");var t=document.createElement("div");return t.setAttribute("class","zpl_profcnt"),t.setAttribute("_rel","roomimage"),t.innerHTML='<img src="'+lmsfileaction.generateSourceURL(e,void 0,void 0,!0)+'"><div class="zpl_imgact"><span class="zlabel zlabel--blue" _rel="local"><i class="PI_edt tooltip-js" title="'+ZPI18N.getString("zp.edit")+'" data-title-position="bottom"></i></span><span class="zlabel zlabel--red" _rel="deleteimage"><i class="PI_reset tooltip-js" title="'+ZPI18N.getString("zp.reset")+'" data-title-position="bottom"></i></span></div>',lmsnewsettings.getRooms.popupEl.querySelector("[clickElement]").removeAttribute("_rel"),t},showAddRoom:function(){lmsnewsettings.getRooms.formFields?lmsnewsettings.getRooms.constructAddEditRoomPopup("add"):lmsnewsettings.getRooms.fetchFormFields((function(){lmsnewsettings.getRooms.constructAddEditRoomPopup("add")}))},showEditRoom:function(e){roomId=e.closest("[roomid]").getAttribute("roomid"),params={mode:"fetchSingleRecord",formId:lmsbase.roomFormId,recordId:roomId,isApprovalEnabled:!1,conreqcsr:csrfToken},lmsnewsettings.sendAjaxRequest&&!lmsnewsettings.editFormOpen&&(lmsnewsettings.sendAjaxRequest=!1,$.post("/formAction.zp",params,(function(e){7e3==e.code&&(e.recordId=roomId,lmsnewsettings.getRooms.formValues[roomId]=e.message.recordDetails[0].column1,lmsnewsettings.getRooms.formFields?(lmsnewsettings.getRooms.constructAddEditRoomPopup("edit",roomId),lmsnewsettings.sendAjaxRequest=!0,lmsnewsettings.editFormOpen=!0):lmsnewsettings.getRooms.fetchFormFields((function(){lmsnewsettings.getRooms.constructAddEditRoomPopup("edit",roomId),lmsnewsettings.sendAjaxRequest=!0,lmsnewsettings.editFormOpen=!0})))})))},closeRoomPopup:function(e){lmsnewsettings.getRooms.popupEl.parentElement.removeChild(lmsnewsettings.getRooms.popupEl),ZPeopleComponents.select(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="locmenu"]')).destroy(),ZPeopleComponents.tokenfield(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="facmenu"]')).destroy(),lmsnewsettings.editFormOpen=!1,e&&lmsnewsettings.getRooms.fetchRooms(1)},deleteRoom:function(e){params={mode:"deleteRecords",recordIds:e.closest("[roomid]").getAttribute("roomid"),formId:lmsbase.roomFormId,conreqcsr:csrfToken},$.post("/formAction.zp",params,(function(t){7e3==t.code?(1==lmsnewsettings.getRooms.baseEl.querySelectorAll("[roomid]").length?(e.closest("[roomid]").parentElement.removeChild(e.closest("[roomid]")),settingsPage.container.find("[_rel=addRoom]").addClass("zpl_DNI"),lmsnewsettings.getRooms.showNoData(lmsnewsettings.getRooms.baseEl.querySelector('[_rel="rlist"]'))):(e.closest("[roomid]").parentElement.removeChild(e.closest("[roomid]")),settingsPage.container.find("[_rel=addRoom]").removeClass("zpl_DNI")),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.deleteroom-success"))):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.rooms.deleteroom-fail"))}))},isMandatorySelected:function(){var e=lmsnewsettings.getRooms.popupEl.querySelector('[_rel="name"]').querySelector("input").value,t=lmsnewsettings.getRooms.popupEl.querySelector('[_rel="capacity"]').querySelector("input").value;divEl=lmsnewsettings.getRooms.popupEl;var s=ZPeopleComponents.select(divEl.querySelector("[_rel=locmenu]")).getValue(),r=lmsnewsettings.getRooms.popupEl.querySelector('[_rel="room_name_id"]').className,l=lmsnewsettings.getRooms.popupEl.querySelector('[_rel="room_capacity_id"]').className;return null!==e&&""!==e||"ztextbox"!==r||(lmsbase.addClass(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="room_name_id"]')," ztextbox__error"),lmsnewsettings.getRooms.popupEl.querySelector('[_rel="name_span"]').style.display="inline"),null!==e&&""!==e&&"ztextbox ztextbox__error"===r&&(lmsbase.removeClass(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="room_name_id"]'),"ztextbox ztextbox__error"),lmsbase.addClass(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="room_name_id"]')," ztextbox"),lmsnewsettings.getRooms.popupEl.querySelector('[_rel="name_span"]').style.display="none"),null!==t&&""!==t||"ztextbox"!==l||(lmsbase.addClass(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="room_capacity_id"]')," ztextbox__error"),lmsnewsettings.getRooms.popupEl.querySelector('[_rel="capacity_span"]').style.display="inline"),null!==t&&""!==t&&"ztextbox ztextbox__error"===l&&(lmsbase.removeClass(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="room_capacity_id"]'),"ztextbox ztextbox__error"),lmsbase.addClass(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="room_capacity_id"]')," ztextbox"),lmsnewsettings.getRooms.popupEl.querySelector('[_rel="capacity_span"]').style.display="none"),null!==s&&""!==s||(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="location_span"]').style.display="inline",ZPeopleComponents.select("[_rel=locmenu]").setAttributes({className:"ztextbox__error"})),null!==s&&""!==s&&(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="location_span"]').style.display="none",ZPeopleComponents.select("[_rel=locmenu]").setAttributes({className:"ztextbox"})),""!=e&&""!=t&&""!=s},saveRoom:function(e,t){if(lmsnewsettings.getRooms.isMandatorySelected()){for(var s=lmsnewsettings.getRooms.popupEl.querySelector('[_rel="name"]').querySelector("input").value,r=lmsnewsettings.getRooms.popupEl.querySelector('[_rel="capacity"]').querySelector("input").value,l=ZPeopleComponents.select(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="locmenu"]')).getValue(),a=ZPeopleComponents.tokenfield(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="facmenu"]')).getAllValues(),n="",i=0;i<a.length-1;i++)n+=a[i].id+";";if(0!=a.length&&(n+=a[a.length-1].id),roomImage="add"==t?null:"",0!=lmsnewsettings.getRooms.uploadHelperObject.getAllFilesForSaving().length){roomImage=lmsnewsettings.getRooms.uploadHelperObject.getAllFilesForSaving()[0].fileInfo.contentId;var o=lmsnewsettings.getRooms.uploadHelperObject.getAllFilesForSaving()[0].fileInfo.extension;if(lmsnewsettings.getRooms.checkIfTheExtensionIsUnSupported(o))return void ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.files.unsupported"))}zp_mode="add"==t?"addRecord":"updateRecord",currentRoomId="edit"==t?lmsnewsettings.getRooms.currentRoomId:void 0,params={zp_mode,zp_tableName:"P_LMSRooms",zp_formId:lmsbase.roomFormId,zp_recordId:currentRoomId,lms_RoomName:s,lms_RoomCapacity:r,lms_RoomLocation:l,lms_RoomFacilities:"undefined"!=n?n:void 0,isPicklistIdEnabled:!0,lms_RoomImage:roomImage,loginUserZUID:_LOGGEDIN_ZUID,isDraft:!1,conreqcsr:csrfToken},"add"==t?(lmsrooms.successMsg=ZPI18N.getString("zp.lms.rooms.addroom-success"),lmsrooms.failureMsg=ZPI18N.getString("zp.lms.rooms.addroom-fail")):(lmsrooms.successMsg=ZPI18N.getString("zp.lms.rooms.updateroom-success"),lmsrooms.failureMsg=ZPI18N.getString("zp.lms.rooms.updateroom-fail")),$.post("/addUpdateRecord.zp",params,(function(e){7e3==e[0].code?(lmsnewsettings.getRooms.closeRoomPopup(!0),ModuleComp.Msg.showSuccessMsg(lmsrooms.successMsg)):(lmsnewsettings.getRooms.closeRoomPopup(),ModuleComp.Msg.showFailureMsg(lmsrooms.failureMsg)),lmsrooms.successMsg=lmsrooms.failureMsg=null}))}},showFacPopup:function(){lmsnewsettings.getRooms.baseContainer.querySelector("[_rel=facpopup]")?lmsbase.addClass(lmsnewsettings.getRooms.baseContainer.querySelector("[_rel=facpopup]"),"zpl_mopen"):(divEl=document.createElement("div"),divEl.setAttribute("class","zpl_mdl zpl_mopen"),divEl.setAttribute("_rel","facpopup"),html='<div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.lms.facilities")+'</h4></div><div class="zpl_mhderrgt"><button _rel="addNewFacility" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.lms.rooms.addfacility")+'</button></div><a class="_cls PI_cls" _rel="close"></a></div><div class="zpl_mcnt zpl_fm"><div id = "noFacility"></div><div><div class="zpl_cat" _rel="facilities"></div></div></div></div></div></div>',divEl.innerHTML=html,lmsnewsettings.getRooms.fetchFacilities(1),lmsnewsettings.getRooms.baseEl.appendChild(divEl),lmsnewsettings.getRooms.popupEl=lmsnewsettings.getRooms.baseContainer.querySelector("[_rel=facpopup]"),lmsbase.addListener(divEl,"click",lmsnewsettings.getRooms.clickPopupHandler))},noDataConstructionForFacilities:function(){divEle=document.createElement("div");var e='<div class="zpl_Emptydata"><div><h4>'+ZPI18N.getString("zp.lms.rooms.nofacility")+'</h4><button class="zlabel zlabel--blue zlabel--medium" _rel = "addNewFacility">'+ZPI18N.getString("zp.lms.rooms.addfacility")+"</button></div></div>";divEle.innerHTML=e,lmsnewsettings.getRooms.popupEl.querySelector("#noFacility").appendChild(divEle)},facilitiesScrollHandle:function(){"end"!=lmsnewsettings.getRooms.facilitiesIndex&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&lmsnewsettings.getRooms.fetchRooms(lmsnewsettings.getRooms.facilitiesIndex)},fetchFacilities:function(e){var t={formId:lmsbase.roomFormId,start:e};zplms.get("/lms/facilities",t,(function(t){"success"==t[1].status&&1==e&&(lmsbase.addListener(lmsnewsettings.getRooms.popupEl.querySelector('[_rel="facilities"]'),"scroll",lmsnewsettings.getRooms.facilitiesScrollHandle,!1),25==t[1].facilities.length?lmsnewsettings.getRooms.facilitiesIndex+=25:lmsnewsettings.getRooms.facilitiesIndex="end"),lmsnewsettings.getRooms.listFacilities(t[1].facilities,1==e?"new":"update")}))},listFacilities:function(e,t){if(null==e)divEl.querySelector('[_rel="addNewFacility"]').remove(),lmsnewsettings.getRooms.noDataConstructionForFacilities(),lmsbase.addListener(document.querySelector('_rel = ["addNewFacility"]'),"click",lmsnewsettings.getRooms.clickHandler);else for(var s=0;s<e.length;s++)divEl=document.createElement("div"),divEl.setAttribute("facid",e[s].optionId),divEl.innerHTML='<div class="zpl_Fldtl"><h5>'+lmsFormConstants.getValue(e[s].optionValue)+'</h5></div><div class="zpl_actn"><span><i class="PI_edt" _rel="editFacility" rel="'+lmsFormConstants.getValue(e[s].optionValue)+'" facid="'+e[s].optionId+'"></i><i class="PI_delete" _rel="deletefac"></i></span></div>',lmsnewsettings.getRooms.popupEl.querySelector('[_rel="facilities"]').appendChild(divEl)},returnFacilitiesAfterDeletion:function(e){return lmsnewsettings.getRooms.formFields[3].OptionsWithId.filter((t=>t.Id!=e))},deleteFacility:function(e){let t=e.closest("[facid]").getAttribute("facid");zplms.delete("/lms/facilities/"+t,null,(function(s){"success"==s[1].status?(e.closest("[facid]").parentNode.removeChild(e.closest("[facId]")),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.deletefacility-success")),lmsnewsettings.getRooms.formFields&&(lmsnewsettings.getRooms.formFields[3].OptionsWithId=lmsnewsettings.getRooms.returnFacilitiesAfterDeletion(t))):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.rooms.deletefacility-fail"))}))},showAddFacilityPopUp:function(){var e='<div class="zpl_mdl zpl_mcenter zpl_mopen" data-modal-box="room_faci" rel="addFacilityPopUp"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.lms.rooms.addfacility")+"</h4><p>"+ZPI18N.getString("zp.lms.rooms.facility-description")+'</p></div><a class="_cls PI_cls" _rel="cancelFacility"></a></div><div class="zpl_mcnt zpl_fm"><form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.rooms.facilities.facilityname")+'</label></div><div><input type="text" class="ztextbox" id="suggestFieldId" rel="addFacility"><span _rel="addfacilities_span" class="ztextbox--error__label ztextbox__error" style = "display : none;"></span></div></div></div></div></form></div><div class="zpl_mfoter"><button type="button" class="zlabel zlabel--blue zlabel--medium" _rel="saveNewFacility">'+ZPI18N.getString("zp.add")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" _rel="cancelFacility">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>";settingsPage.container.append(e),lmsbase.addListener(document.querySelector('[rel="addFacilityPopUp"]'),"click",lmsnewsettings.clickPopupHandler,!1),document.querySelector('[rel="addFacilityPopUp"]').querySelector('[rel="addFacility"]').focus(),document.querySelector('[rel="addFacilityPopUp"]').querySelector('[rel="addFacility"]').autocomplete="off"},removeExtraSpaces:function(e){return e.replace(/\s+/g," ").trim()},showEditFacilityPopUp:function(e,t){var s='<div class="zpl_mdl zpl_mcenter zpl_mopen" data-modal-box="edit_faci" rel="editFacilityPopUp"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.lms.rooms.editfacility")+"</h4><p>"+ZPI18N.getString("zp.lms.rooms.facility-description")+'</p></div><a class="_cls PI_cls" _rel="cancelFacility"></a></div><div class="zpl_mcnt zpl_fm"><form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><input type="text" class="ztextbox" id="suggestFieldId" rel="editFacilityVal" value = "'+t+'"><span _rel="editfacilities_span" class="ztextbox--error__label ztextbox__error" style = "display : none;">'+ZPI18N.getString("zp.lms.rooms.addfacility-duplicate")+'</span></div></div></div></div></form></div><div class="zpl_mfoter"><button type="button" class="zlabel zlabel--blue zlabel--medium" _rel="saveEditFacility" dataName="'+t+'" dataId="'+e+'">Save</button><button type="button" class="zlabel zlabel--outline zlabel--medium" _rel="cancelFacility">Cancel</button></div></div></div>';settingsPage.container.append(s),lmsbase.addListener(document.querySelector('[rel="editFacilityPopUp"]'),"click",lmsnewsettings.clickPopupHandler,!1);var r=document.querySelector('[rel="editFacilityPopUp"]').querySelector('[rel="editFacilityVal"]');r.setSelectionRange(r.value.length,r.value.length),r.focus(),document.querySelector('[rel="editFacilityPopUp"]').querySelector('[rel="editFacilityVal"]').autocomplete="off"},showErrorMessageForDuplicateFaciity:function(){lmsbase.addClass(document.querySelector('[rel="addFacility"')," ztextbox__error"),document.querySelector('[_rel="addfacilities_span"]').style.display="inline"},saveFacility:function(e){if(null!=e&&""!=e)if(e.indexOf("<")>-1||e.indexOf(">")>-1)lmsnewsettings.showErrorMessage(document.querySelector('[rel="addFacility"'),document.querySelector('[_rel="addfacilities_span"]'),ZPI18N.getString("zp.lms.forms.cannotinclude"));else if(/^(?=.*[^\s])[\s\S]+$/.test(e)){e=lmsnewsettings.getRooms.removeExtraSpaces(e);var t={formId:lmsbase.roomFormId,value:e};zplms.post("/lms/facilities",t,(function(e){if("success"==e[1].status){facObj=e[1].facility,divEl=document.createElement("div"),divEl.setAttribute("facid",facObj.optionId),divEl.innerHTML='<div class="zpl_Fldtl"><h5>'+ZSEC.Encoder.encodeForHTML(lmsFormConstants.getValue(facObj.optionValue))+'</h5></div><div class="zpl_actn"><span><i class="PI_edt" _rel="editFacility" rel="'+ZSEC.Encoder.encodeForHTML(lmsFormConstants.getValue(facObj.optionValue))+'" facid="'+facObj.optionId+'"></i><i class="PI_delete" _rel="deletefac"></i></span></div>',lmsnewsettings.getRooms.popupEl.querySelector('[_rel="facilities"]').insertBefore(divEl,lmsnewsettings.getRooms.popupEl.querySelector('[_rel="facilities"]').firstChild),document.querySelector('[rel="addFacilityPopUp"]').remove(),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.addfacility-success"));var t={Value:ZSEC.Encoder.encodeForHTML(lmsFormConstants.getValue(facObj.optionValue)),Id:facObj.optionId,systemValue:facObj.systemValue};lmsnewsettings.getRooms.formFields&&lmsnewsettings.getRooms.formFields[3].OptionsWithId.push(t)}else"duplicate facility"==e[1].message?lmsnewsettings.showErrorMessage(document.querySelector('[rel="addFacility"'),document.querySelector('[_rel="addfacilities_span"]'),ZPI18N.getString("zp.lms.rooms.addfacility-duplicate")):"empty facility"==e[1].message?lmsnewsettings.showErrorMessage(document.querySelector('[rel="addFacility"'),document.querySelector('[_rel="addfacilities_span"]'),ZPI18N.getString("zp.lms.rooms.addfacility-empty")):ModuleComp.Msg.showFailureMsg(failMsg)}))}else lmsnewsettings.showErrorMessage(document.querySelector('[rel="addFacility"'),document.querySelector('[_rel="addfacilities_span"]'),ZPI18N.getString("zp.lms.rooms.facilities.invalidfacility"));else lmsnewsettings.showErrorMessage(document.querySelector('[rel="addFacility"'),document.querySelector('[_rel="addfacilities_span"]'),ZPI18N.getString("zp.lms.rooms.addfacility-empty"))},editFacilityWithId:function(e,t,s,r){var l=/^(?=.*[^\s])[\s\S]+$/;if(t.trim()){if(s==t.replace(/\s+/g," "))return void document.querySelector('[rel="editFacilityPopUp"]').remove();t=lmsnewsettings.getRooms.removeExtraSpaces(t);var a={formId:lmsbase.roomFormId,value:t}}null!=t&&""!=t&&l.test(t)?(l.test(t)||lmsnewsettings.showErrorMessage(document.querySelector('[rel="editFacilityVal"'),document.querySelector('[_rel="editfacilities_span"]'),ZPI18N.getString("zp.lms.rooms.facilities.invalidfacility")),t.indexOf("<")>-1||t.indexOf(">")>-1?lmsnewsettings.showErrorMessage(document.querySelector('[rel="editFacilityVal"'),document.querySelector('[_rel="editfacilities_span"]'),ZPI18N.getString("zp.lms.forms.cannotinclude")):zplms.put("/lms/facilities/"+e,a,(function(e){if("success"==e[1].status){facObj=e[1];var t=document.querySelector('div[facid="'+facObj.optionId+'"]');t.querySelector("h5").innerHTML=ZSEC.Encoder.encodeForHTML(lmsFormConstants.getValue(facObj.optionValue)),t.querySelector('i[_rel="editFacility"]').setAttribute("rel",lmsFormConstants.getValue(facObj.optionValue)),document.querySelector('[rel="editFacilityPopUp"]').remove(),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.editfacility-success"));var s={Value:ZSEC.Encoder.encodeForHTML(lmsFormConstants.getValue(facObj.optionValue)),Id:facObj.optionId,systemValue:facObj.systemValue};if(lmsnewsettings.getRooms.formFields){const e=lmsnewsettings.getRooms.formFields[3].OptionsWithId.findIndex((e=>e.Id===facObj.optionId));-1!==e&&(lmsnewsettings.getRooms.formFields[3].OptionsWithId[e]=s)}}else"duplicate facility"==e[1].message?lmsnewsettings.showErrorMessage(document.querySelector('[rel="editFacilityVal"'),document.querySelector('[_rel="editfacilities_span"]'),ZPI18N.getString("zp.lms.rooms.addfacility-duplicate")):"empty facility"==e[1].message?lmsnewsettings.showErrorMessage(document.querySelector('[rel="editFacilityVal"'),document.querySelector('[_rel="editfacilities_span"]'),ZPI18N.getString("zp.lms.rooms.addfacility-empty")):lmsnewsettings.showErrorMessage(document.querySelector('[rel="editFacilityVal"'),document.querySelector('[_rel="editfacilities_span"]'),failMsg)}))):lmsnewsettings.showErrorMessage(document.querySelector('[rel="editFacilityVal"'),document.querySelector('[_rel="editfacilities_span"]'),ZPI18N.getString("zp.lms.rooms.addfacility-empty"))},showNoData:function(e){var t=new EmptyPages("zp_nd_room",lmsnodata.noDatav5.roomsNew.general.title,lmsnodata.noDatav5.roomsNew.general.desc,settingsPage.container.find(".zpl_tblres"));t.setButton(ZPI18N.getString("zp.lms.rooms.addrooms"),lmsnewsettings.getRooms.showAddRoom),t.show()},clickHandler:function(e){var t=(e=e||this.eve).target,s=t.getAttribute("_rel")||null!=t.closest("[_rel]")?t.closest("[_rel]").getAttribute("_rel"):t.closest("[_rel]");if("addRoom"==s)lmsnewsettings.getRooms.showAddRoom();else if("editroom"==s)lmsnewsettings.getRooms.showEditRoom(t);else if("deleteroom"==s)ModuleComp.Modal.delete((function(){lmsnewsettings.getRooms.deleteRoom(t)}),ZPI18N.getString("zp.lms.entitydelete",["room"]),ZPI18N.getString("zp.lms.permenentlydelEntity",["Room"]),void 0);else if("addFacPopup"==s)lmsnewsettings.getRooms.showFacPopup();else if("addNewFacility"==s)lmsnewsettings.getRooms.showAddFacilityPopUp();else if("editFacility"==s)lmsnewsettings.getRooms.showEditFacilityPopUp(e.target.getAttribute("facid"),event.target.getAttribute("rel").replace(/'/g,"&#39;").replace(/"/g,"&quot;"));else if("cancelFacility"==s)document.querySelector('[rel="addFacilityPopUp"]')?document.querySelector('[rel="addFacilityPopUp"]').remove():document.querySelector('[rel="editFacilityPopUp"]').remove();else if("saveNewFacility"==s){var r=document.querySelector('[rel="addFacility"]').value;lmsnewsettings.getRooms.saveFacility(r)}else if("saveEditFacility"==s){r=document.querySelector('[rel="editFacilityVal"]').value;lmsnewsettings.getRooms.editFacilityWithId(e.target.getAttribute("dataId"),r,e.target.getAttribute("dataName"),t)}},clickPopupHandler:function(e){var t=(e=e||this.eve).target,s=t.getAttribute("_rel")||t.closest("[_rel]").getAttribute("_rel");if("close"==s)lmsnewsettings.getRooms.popupEl.parentElement.removeChild(lmsnewsettings.getRooms.popupEl),lmsnewsettings.editFormOpen=!1;else if("deletefac"==s)ModuleComp.Modal.delete((function(){lmsnewsettings.getRooms.deleteFacility(t)}),ZPI18N.getString("zp.lms.entitydelete",["facility"]),ZPI18N.getString("zp.lms.permenentlydelEntity",["Facility"]),void 0);else if("saveroom"==s){var r=lmsnewsettings.getRooms.currentRoomId?"edit":"add";lmsnewsettings.getRooms.saveRoom(t,r)}else"roomclose"==s?lmsnewsettings.getRooms.closeRoomPopup():"deleteimage"==s&&(lmsnewsettings.getRooms.popupEl.querySelector("[_rel=roomimage]").parentElement.removeChild(lmsnewsettings.getRooms.popupEl.querySelector("[_rel=roomimage]")),lmsnewsettings.getRooms.popupEl.querySelector("[clickElement]").setAttribute("_rel","local"))}},getTrainers:{init:async function(){lmsnewsettings.refer.index=1,ZPeople.FireScroll.reset(),lmsnewsettings.getTrainers.filterInstance&&lmsnewsettings.getTrainers.filterInstance.clearBreadCrumbs(),!lmsnewsettings.getTrainers.filterInstance&&lmsnewsettings.getTrainers.getFilterInstance(),await lmstrainers.getTrainers(lmsnewsettings.getTrainers.constructTrainers,1),lmsbase.addListener(settingsPage.container[0],"click",lmsnewsettings.clickHandler,!1)},getFilterInstance:function(){lmsnewsettings.getTrainers.filterInstance=lmsfilterutil.getFilterInstance(lmsnewsettings.getTrainers.getFilterObject(),settingsPage.container),lmsnewsettings.getTrainers.filterInstance.setFilterCallbacks({callback:async function(e){await lmstrainers.getTrainers(lmsnewsettings.getTrainers.constructTrainers,2,e)}},{callback:lmstrainers.resetAppliedFilters},{callback:async function(e){await lmstrainers.getTrainers(lmsnewsettings.getTrainers.constructTrainers,3,e)}})},getFilterObject:function(){let e=[];return e.push(lmsnewsettings.getTrainers.getSortByFilterObject()),e.push(lmsnewsettings.getTrainers.getEmployeeStatusFilterObject()),e},getSortByFilterObject:function(){let e=[{value:"1",label:ZPI18N.getString("zp.lms.AtoZ")},{value:"2",label:ZPI18N.getString("zp.lms.ZtoA")}];return{type:"select",label:ZPI18N.getString("zp.sortby"),encodeHTML:!0,id:"sortByFil",options:{options:e,placeholder:ZPI18N.getString("zp.select")}}},getEmployeeStatusFilterObject:function(){let e=[{value:"1",label:ZPI18N.getString("zp.lms.active")},{value:"2",label:ZPI18N.getString("zp.inactive")}];return{type:"select",label:ZPI18N.getString("zp.employeestatus"),encodeHTML:!0,id:"empStatusFil",options:{options:e,placeholder:ZPI18N.getString("zp.select")}}},constructTrainers:function(e){var t;0!=settingsPage.container.find("#sortBy").length&&ZPeopleComponents.select(settingsPage.container.find("#sortBy")).destroy(),0!=settingsPage.container.find("#empStatus").length&&ZPeopleComponents.select(settingsPage.container.find("#empStatus")).destroy();var s="";1==lmsnewsettings.refer.index&&(0==$("#lmsApplFil").length&&(s='<div class="zpl_btnmnu" id="headerTrainer"><div class="zpl_rgt"><button class="zlabel zlabel--blue zlabel--medium" data-popup-open="addtrainer" rel="add">'+ZPI18N.getString("zp.lms.trainers.addTrainers")+'</button><i class="zpl_ibg PI_fltr" rel="trainerFilter"></i></div></div>'),s+='<div class="zpl_rgtcnt" rel="getTrainers">',0!=e.length&&(s+='<div class="zpl_secn"><div><div class="zpl_usr_crd" rel="trainersList">'));for(var r=0;r<e.length;r++){data=e[r],t="-",data.trainerStars>0&&(t=data.trainerStars),s+='<div _trnrId="'+data.trainerId+'" rel="trainerInfo" title="'+data.trainerName+'"><font class="zpl_hvr"><i type="button" class="PI_more" id="'+data.trainerId+'" rel="trainerMore"></i></font><div class="zpl_prfl"><img src='+data.trainerImage+' alt="" _trnrId="'+data.trainerId+'" rel="trainerInfo"></div><h4 rel="trainerInfo" _trnrId="'+data.trainerId+'" data-ttip="'+data.trainerEmployeeId+" - "+data.trainerName+'"><em rel="trainerInfo" _trnrId="'+data.trainerId+'">'+data.trainerEmployeeId+' -</em rel="trainerInfo" _trnrId="'+data.trainerId+'">'+data.trainerName+'</h4><div class="zpl_rtbtm"><div class="zpl_str">';for(var l=0;l<5;l++)s+=t>l?'<i class="PI_star ylw"></i>':'<i class="PI_star gry"></i>';s+="</div></div></div>"}if(1==lmsnewsettings.refer.index?(s+="</div></div></div>",s+="</div>",lmsnewsettings.getTrainers.filterInstance&&lmsnewsettings.getTrainers.filterInstance.closeFilter(),0!=$("#lmsApplFil").length?settingsPage.container.append(s):settingsPage.container.html(s)):settingsPage.container.find('[rel="trainersList"]').append(s),0==e.length&&1==lmsnewsettings.refer.index)lmsnewsettings.getTrainers.showNoData(document.querySelector("#tab-lms-trainers")),settingsPage.container.find("[rel=add]").addClass("zpl_DNI");else if("end"==lmsnewsettings.getTrainers.index)ZPeople.FireScroll.setParam("triggered",!0);else if(25==e.length){ZPeople.FireScroll.setParam("triggered",!1),settingsPage.container.find("[rel=add]").removeClass("zpl_DNI"),ZPeople.FireScroll.init(lmsnewsettings.loadMore,"tab-lms-trainers",{tab:"tab-lms-trainers"},!0);const e=$("#tab-lms-trainers");e.height()&&e.prop("scrollHeight")<=e.height()&&lmsnewsettings.loadMore({tab:"tab-lms-trainers"})}settingsPage.container.find('[rel="trainerMore"]').on("click",(function(e){lmsnewsettings.getTrainers.trainerId=this.getAttribute("id"),ZPeopleComponents.isComponent("#trainerDeleter_"+lmsnewsettings.getTrainers.trainerId)&&(ZPeopleComponents.menu($("#trainerDeleter_"+lmsnewsettings.getTrainers.trainerId)).destroy(),$("#trainerDeleter_"+lmsnewsettings.getTrainers.trainerId).remove()),settingsPage.container.find('[_trnrid="'+data.trainerId+'"]').on("mouseleave",(function(e){settingsPage.container.find('[rel="trainerMore"]').parent().removeClass("zpl_hvrsw")}));lmsnewsettings.getTrainers.trainerId;var t={contentType:"icon-text",className:"zpl_drpdwn"};t.forElement="#"+lmsnewsettings.getTrainers.trainerId,t.itemclick=lmsnewsettings.getTrainers.deleteTrainerMore,t.hide=e=>{$(e.detail.forElement[0].parentElement).removeClass("zpl_hvrsw")},t.show=e=>{$(e.detail.forElement[0].parentElement).addClass("zpl_hvrsw")};var s=[];s.push({id:"deleteMore",label:ZPI18N.getString("zp.delete"),iconClass:"PI_delete",className:"red"}),ZPeopleComponents.createMenu("trainerDeleter_"+lmsnewsettings.getTrainers.trainerId,s,t),ZPeopleComponents.menu("#trainerDeleter_"+lmsnewsettings.getTrainers.trainerId).show()}))},deleteTrainerMore:function(){ModuleComp.Modal.delete((function(){lmsnewsettings.getTrainers.deleteTrainer(lmsnewsettings.getTrainers.trainerId)}),ZPI18N.getString("zp.lms.entitydelete",["Trainer"]),ZPI18N.getString("zp.lms.permenentlydelEntity",["Trainer"]),ZPI18N.getString("zp.confirm"))},deleteTrainer:function(e){zplms.delete("/lms/trainers/"+e,null,(function(t){"success"==t[1].status?(document.querySelector('[_trnrid="'+e+'"]').remove(),0==document.querySelector(".zpl_usr_crd").childElementCount?settingsPage.container.find("[rel=add]").addClass("zpl_DNI"):settingsPage.container.find("[rel=add]").removeClass("zpl_DNI"),0==document.querySelector(".zpl_usr_crd").childElementCount&&lmsnewsettings.getTrainers.showNoData(document.querySelector("#tab-lms-trainers")),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.trainers.deleteMsg"))):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.trainers.unableDeleteMsg"))}))},showNoData:function(e){var t=lmstrainers.filterMode?lmsnodata.noDatav5.trainersNew.filter.title:lmsnodata.noDatav5.trainersNew.general.title,s=lmstrainers.filterMode?lmsnodata.noDatav5.trainersNew.filter.desc:lmsnodata.noDatav5.trainersNew.general.desc,r=new EmptyPages("zp_nd_trainer",t,s,settingsPage.container.find(".zpl_rgtcnt"));r.setButton(ZPI18N.getString("zp.lms.trainers.AddTrainers"),lmsnewsettings.getTrainers.addTrainers),r.show()},getDataforTrainers:async function(e,t){var s=[],r={};if(null!=e&&""!==e){var l={formId:lmsbase.trainerFormId,mode:"fetchFormLookupOtions",luFcIds:JSON.stringify(lmstrainers.luFcIds),searchtxt:e,conreqcsr:csrfToken};try{const t=await new Promise(((e,t)=>{ZPeople.Request.send("/formAction.zp",l,(s=>{s?e(s):t(new Error("Failed to fetch form lookup options."))}))}));lmsnewsettings.getTrainers.menuAction(t,e,1)}catch(e){console.error("Error in async operation:",e)}}else lmstrainers.luFcIds=[],await lmstrainers.getFormComponents(lmstrainers.menuAction,1);return null!=lmsnewsettings.trainerData?$.each(lmsnewsettings.trainerData,(function(e,t){var r={};r.name=t.Value,r.id=t.Id,s.push(r)})):(r.name=ZPI18N.getString("zp.nodatafound"),r.id="-1",s.push(r)),s},menuAction:function(e,t,s){var r=[];7e3==e.code?lmstrainers.luFcIds.length>0?null!=e.message?(lmstrainers.formData=e,r=e.message[lmstrainers.luFcIds]):r=[]:(lmstrainers.luFcIds=[],lmstrainers.formData=e,r=[],r=e.message.formComponentDetails[0].column1[0].Options?e.message.formComponentDetails[0].column1[0].Options:e.message.formComponentDetails[0].column1[0].AddOptions,lmstrainers.luFcIds.push(e.message.formComponentDetails[0].column1[0].formComponentId)):r=[],lmsnewsettings.trainerData=r},addTrainers:async function(){var e='<div class="zpl_mdl zpl_mcenter zpl_mopen" data-modal-box="addtrainer" rel="addTrainer"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.lms.trainers.AddTrainers")+"</h4><p>"+ZPI18N.getString("zp.lms.trainers.trainersdesc")+'</p></div><a class="_cls PI_cls" rel="cancelTrainer"></a></div><div class="zpl_mcnt zpl_fm"><form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.trainers.choosetrainer")+'</label></div><div><textarea _rel="trainersmenu" class="tokenfieldId-js" style="display: none;" id="addTrainers"></textarea><span _rel="addtrainers_span" class="ztextbox--error__label ztextbox__error" style = "display : none;">'+ZPI18N.getString("zp.lms.trainers.selectTrainer")+'</span></div></div></div></div></form></div><div class="zpl_mfoter"><button type="button" class="zlabel zlabel--blue zlabel--medium" rel="saveTrainer">'+ZPI18N.getString("zp.save")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" rel="cancelTrainer">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>";settingsPage.container.append(e),lmsbase.addListener(document.querySelector('[rel="addTrainer"]'),"click",lmsnewsettings.clickPopupHandler,!1);resultData=[],lmsnewsettings.getTrainers.getTrainerFormId();let t={dataSource:{search:async function(e){return new Promise((async function(t,s){e.query,e.pages;var r=100*(e.pages-1),l=await lmsnewsettings.getTrainers.getDataforTrainers(e.query,r);respObj={results:l,more:50==l.length},t(respObj)}))},paginated:!0},search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults"),delay:20,criteria:"startswith"},isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0,fitForElement:!0},serverSearch:!0,cacheData:!0,lazyLoading:!1,showSearchField:!0,placeholder:ZPI18N.getString("zp.select"),viewPerPage:100,dataMapping:{text:"name",value:"id",id:"id"}};ZPeopleComponents.tokenfield("#addTrainers",t)},getTrainerFormId:async function(){var e={isTrainerForm:!0};try{let t=await new Promise(((t,s)=>{zplms.get("/lms/formids",e,(e=>{e?t(e):s(new Error("Failed to fetch result data"))}))}));lmsbase.trainerFormId=t[1][0].formId}catch(e){console.error("Error fetching trainer form ID:",e)}},saveTrainer:function(){var e=document.querySelector("#addTrainers"),t=ZPeopleComponents.tokenfield(e).getAllValues(),s={};if(t.length>0){for(var r in t)s[t[r].id]=t[r].id;lmstrainers.addTrainers(s,1)}else lmsnewsettings.showErrorMessage(document.querySelector('[_rel = "trainersmenu"]'),document.querySelector('[_rel="addtrainers_span"]'),ZPI18N.getString("zp.lms.trainers.selectTrainer"))},cancelTrainer:function(){ZPeopleComponents.tokenfield(document.querySelector('[id="addTrainers"]')).destroy(),document.querySelector('[rel="addTrainer"]').remove()},filterConstruction:function(){var e='<div class="zpl_fltr" rel="filterDiv"><div><div class="zpl_fltrhd"><h5>'+ZPI18N.getString("zp.filter")+'</h5><i class="PI_cls" rel="trainerFilterCancel"></i></div></div><div class="zpl_fltrcnt"><div><div class="zpl_fltclps fltopn"><div><font><i class="IC-ar-rgt"></i><b>System Filter</b></font></div><div class="zpl_fltrlst"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.sortby")+'</label></div><div rel="sortBy"><select value="EH" class="zselectbox select-js has-focus has-mfocus" style="display: none;" id="sortBy"></select></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.employeestatus")+'</label></div><div rel="empStatus"><select value="EH" class="zselectbox select-js has-focus has-mfocus" style="display: none;" id="empStatus"></select></div></div></div></div></div></div><div><button type="button" class="zlabel zlabel--blue zlabel--medium" rel="trainerFilterApply">'+ZPI18N.getString("zp.apply")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" rel="trainerFilterReset">'+ZPI18N.getString("zp.reset")+"</button></div></div>";settingsPage.container.append(e),settingsPage.container.addClass("zpl_fltr_flt"),lmsnewsettings.getTrainers.reset(2)},resetTrainerParams:function(){lmstrainers.sortByMode=0,lmstrainers.empStatusMode=0,lmstrainers.lastRequestParams=null,lmsnewsettings.refer.index=0},reset:function(e){if(0!=e&&1!=e||(settingsPage.container.find("#sortBy").length>0&&ZPeopleComponents.select(settingsPage.container.find("#sortBy")).destroy(),settingsPage.container.find("#empStatus").length>0&&ZPeopleComponents.select(settingsPage.container.find("#empStatus")).destroy(),lmsnewsettings.getTrainers.resetTrainerParams()),0==e||2==e){if(settingsPage.container.find("#sortBy").length>0){var t=[{label:ZPI18N.getString("zp.lms.AtoZ"),value:1},{label:ZPI18N.getString("zp.lms.ZtoA"),value:2}];ZPeopleComponents.select(settingsPage.container.find("#sortBy")).addOption(t),ZPeopleComponents.select(settingsPage.container.find("#sortBy")).setValue(lmstrainers.sortByMode)}settingsPage.container.find("#empStatus").length>0&&(t=[{label:ZPI18N.getString("zp.lms.active"),value:1},{label:ZPI18N.getString("zp.inactive"),value:2}],ZPeopleComponents.select(settingsPage.container.find("#empStatus")).addOption(t),ZPeopleComponents.select(settingsPage.container.find("#empStatus")).setValue(lmstrainers.empStatusMode)),0==e&&lmsnewsettings.getTrainers.init()}else 1==e&&document.querySelector('[rel="filterDiv"]').remove()},trainerInfo:function(e,t){lmstrainers.trainerId=e,lmsreports.fday=Calendar.formatDate(lmsreports.getFirstDay()),lmsreports.lday=Calendar.formatDate(lmsreports.getLastDay());var s={courseFilter:"progress",firstDay:lmsreports.fday,lastDay:lmsreports.lday,startIndex:lmstrainers.inforefer.index};zplms.get("/lms/trainers/"+e,s,(function(t){lmsnewsettings.getTrainers.constructTrainerInfo(t[1],e)}))},constructTrainerInfo:function(e,t){$("[rel=trainerInfoPopup]").remove();var s='<div class="zpl_mdl zpl_mopen" rel="trainerInfoPopup"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.lms.trainers.TrainerDetails")+'</h4></div><a class="_cls PI_cls" rel="cancelTrainerInfo"></a></div><div class="zpl_mcnt"><div class="zpl_trdtl"><div><div class="zpl_trinf"><img src="'+e.trainerImage+'" alt=""><h4 title="'+e.trainerName+'"><em>'+e.trainerEmployeeId+" -</em> "+e.trainerName+"</h4>";s+=e.trainerempId!=erecno?'<a><i class="PI_chat" uid="'+e.trainerZuid+'" ischat="true" onclick="ZPeople.initUserChat(event, '+e.trainerZuid+')"></i></a>':"",s+='</div></div><div class="zpl_trtng"><p><span>'+ZPI18N.getString("zp.rating")+" :</span>";for(var r=0;r<5;r++)e.overallTrainerRating>r?s+='<i class="PI_star ylw"></i>':s+='<i class="PI_star gry"></i>';s+="</p></div></div><div>",null!=e.activeCourseList&&0!=e.activeCourseList.length?$.each(e.activeCourseList,(function(e,t){t.startDate=null!=t.batchStartDate?t.batchStartDate:"",null==t.duration&&(t.duration=0),t.courseImageInfo.additionalInfo={fileId:t.courseId,type:6};var r=t.courseImageInfo.isSystemImage?"/newhr/images/lmsbg/cat"+t.courseImage+".svg":lmsfileaction.generateSourceURL(t.courseImageInfo);s+='<div class="zpl_lmscrs fulwdt cmpct"><div><div class="zpl_crsimg"><img src="'+r+'" alt=""></div><div><h4>'+t.courseName+"</h4><ul><li><p>"+ZPI18N.getString("zp.lms.base.Sessions")+" :</p><span>"+t.trainerCompleteCount+"/"+t.totalSessionCount+"</span></li><li><p>"+ZPI18N.getString("zp.lms.trainers.batchlastdate")+":</p><span>"+t.startDate+"</span></li></ul></div></div></div>"})):s+='<div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_template"></div><h4>'+ZPI18N.getString("zp.lms.nocoursesavailable")+"</h4></div></div>",s+="</div></div></div></div>",settingsPage.container.append(s),lmsbase.addListener(document.querySelector('[rel="trainerInfoPopup"]'),"click",lmsnewsettings.clickPopupHandler,!1)},cancelTrainerInfo:function(){document.querySelector('[rel="trainerInfoPopup"]').remove()},noDataConstruction:function(){var e='<div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_trainer"></div><h4>'+ZPI18N.getString("zp.lms.timetoaddtrainer")+"</h4><p>"+ZPI18N.getString("zp.lms.notrainerdesc")+"</p></div></div>";document.querySelector('[rel="getTrainers"]').innerHTML=e}},isLMSNotificationEnabled:()=>lmsnewsettings.isTabExist(2)||lmsnewsettings.commonSettingData?.allowNotify,isTabExist:e=>!!ZPNewTabs.getTabObj(Layout.HashUtil.SETTINGS).lms.tabArr[e]},lmsCustomNotification=function(){class e{static openedTemplatePopup;constructor(e,t){this.groupData=e,this.parentContainer=t}constructGroup(){this.notificationActions=[],this.buttonStateFlag=0,this.groupContainer=document.createElement("div"),this.groupContainer.classList.add("zpl_rgtcnt"),this.parentContainer.appendChild(this.groupContainer);let e=document.createElement("div");e.classList.add("zpl_crd");let s=document.createElement("div");s.className="zpl_crdcnt zpl_noticollapse",e.appendChild(this.getHeader()),e.appendChild(s),this.groupContainer.appendChild(e),this.notificationListContainer=s;const r=this;this.groupData.notifications.forEach((e=>{let s=new t(e,r);s.constructNotification(),r.notificationActions.push(s)}))}getHeader(){let e=document.createElement("div");return e.classList="zpl_crdhdr zpl_rgt",e.innerHTML=`<div><h4>${this.groupData.displayName}</h4></div>`,this.header=e,e}getButtons(){let e=this,t=document.createElement("div"),s=document.createElement("button");s.classList="zlabel zlabel--blue zlabel--medium",s.textContent=ZPI18N.getString("zp.save");let r=document.createElement("button");return r.classList="zlabel zlabel--outline zlabel--medium",r.textContent=ZPI18N.getString("zp.reset"),lmsbase.addListener(s,"click",(()=>e.saveCallback())),lmsbase.addListener(r,"click",(()=>e.resetCallback())),t.appendChild(s),t.appendChild(r),this.buttons=t,t}showButtons(){this.header.contains(this.buttons)||this.header.appendChild(this.getButtons()),this.buttonStateFlag++}hideButtons(){this.buttonStateFlag--,this.sanitizeButtonFlag(),0===this.buttonStateFlag&&this.buttons.remove()}sanitizeButtonFlag(){this.buttonStateFlag<0&&(this.buttonStateFlag=0)}isModified(){let t=this.groupContainer.querySelectorAll("[data-modified]").length>0;return e.openedTemplatePopup&&(t=t||e.openedTemplatePopup.isContentModified()),t}isButtonVisible(){return this.buttons&&this.buttons.parentElement}saveCallback(){const e=this;function t(){e.updateSaving();let t=e.getModifiedData();lmsCustomNotification.updateNotificationAndTemplateStatus(t,(t=>e.successCallback(t)))}this.warningPopup(t)||t()}warningPopup(e){let t=this.getModifiedData();if("REMINDER_NOTIFICATIONS"===this.groupData.groupKey&&t.notifications.disabled.length>0){let t=new InfoAlertMessage(ZPI18N.getString("zp.lms.notification.disable.warning.header"),ZPI18N.getString("zp.lms.notification.disable.warning.body"));return t.setCallback(e),t.show(),!0}return!1}successCallback(e){this.updateSaved(),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.messages.statusUpdatedSuccess")),this.notificationActions.forEach((e=>e.toggleStatusSavedCallback()))}updateSaving(){this.buttons.remove(),this.buttonStateFlag=0,this.saving=lmsdocument.createSavingElement(),this.header.appendChild(this.saving)}updateSaved(){let e=lmsdocument.createSavedElement();this.header.replaceChild(e,this.saving),$(e).fadeOut("slow",(()=>e.remove())),this.saving.remove()}getModifiedData(){let e={templates:{disabled:[],enabled:[]},notifications:{disabled:[],enabled:[]}};return this.groupContainer.querySelectorAll("[data-modified]").forEach((function(t){let s=t.getAttribute("data-modified");e[s.split("_")[0]][s.split("_")[1]].push(s.split("_")[2])})),e}resetCallback(){this.groupContainer.remove(),this.constructGroup()}getListContainer(){return this.notificationListContainer}toNode(){return this.groupContainer}construct(){this.parentContainer.innerHTML="",this.constructGroup()}close(){e.openedTemplatePopup&&e.openedTemplatePopup.close()}}class t{constructor(e,t){this.notificationData=e,this.notificationGroup=t,this.parentContainer=t.getListContainer(),this.templates=[],this.COMPONENTS={}}constructNotification(){let e=document.createElement("div");e.classList.add("zpl_secn"),this.notificationContainer=e,this.parentContainer.appendChild(e),this.notificationData.templates&&this.notificationData.templates.length>1?this.appendCollapsePanel():this.appendNotificationPanel()}appendCollapsePanel(){let e=`<div><div class="collapsible" aria-multiselectable="true"><div id="collapsiblePanel_${this.notificationData.notificationId}" data-toggle-button-position="right" data-toggle-on-header-click="true" class="zpl_collapsepanel " aria-expanded="false"></div></div></div>`,t=lmsdocument.parseStringToDOMElement(e);this.notificationContainer.appendChild(t),this.appendCollapseHeader(),this.appendCollapseContent(),this.initiateComponent()}appendCollapseHeader(){let e=`<div id="collapsiblePanelHeader_${this.notificationData.notificationId}" class="zpl_collapseheader"><div><div class="zpl_secn"><div><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input id="toggle_${this.notificationData.notificationId}" class="togbutton-js" style="display: none;">`+this.notificationData.displayName+"</h5>"+`<p>${this.notificationData.description}</p></div></div></div></div></div>`;this.notificationContainer.querySelector("#collapsiblePanel_"+this.notificationData.notificationId).appendChild(lmsdocument.parseStringToDOMElement(e))}appendCollapseContent(){let e=`<div id="collapsiblePanelContent_${this.notificationData.notificationId}" class="zpl_collapsecontent"><div class="zpl_secn zpl_secn2"><div><div class="zpl_gbox"><div class="zpl_gboxwhti"><div class="zpl_secn" id="templatecontainer"></div></div></div></div></div></div>`,t=lmsdocument.parseStringToDOMElement(e);this.templateContainer=t.querySelector("#templatecontainer"),this.templateContainer.removeAttribute("templatecontainer"),this.notificationContainer.querySelector("#collapsiblePanelHeader_"+this.notificationData.notificationId).insertAdjacentElement("afterend",t);const r=this;this.notificationData.templates.forEach((function(e){let t=new s(e,r);t.constructTemplate(),r.templates.push(t)}))}appendNotificationPanel(){let e=this.notificationData,t=`<div class="d-flexC"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input id="toggle_${e.notificationId}" class="togbutton-js">`+e.displayName+"</h5>"+`<p> ${e.description} </p></div></div>`,s=lmsdocument.parseStringToDOMElement(t);this.notificationContainer.appendChild(s),this.adaptNotificationTemplate(s),this.initiateComponent()}adaptNotificationTemplate(e){if(1===this.notificationData.templates.length){let t=new s(this.notificationData.templates[0],this);t.setTemplateContainer(e),t.appendActionIcons(),t.initiateComponent(),this.templates.push(t)}}initiateComponent(){const e=this;let t=ZPeopleComponents.toggleswitch("#toggle_"+this.notificationData.notificationId,{on:e.notificationData.isEnabled,change:()=>e.switchCallback()});if(this.COMPONENTS["toggle_"+this.notificationData.notificationId]=t,this.notificationData.templates.length>1){let t=ZPeopleComponents.collapsiblepanel("#collapsiblePanel_"+this.notificationData.notificationId,{beforepanelcollapse:()=>!e.isToggleWorking||(e.isToggleWorking=!1,!1),isActive:!1});this.COMPONENTS["collapsiblePanel_"+this.notificationData.notificationId]=t}}getToggleState(){return this.COMPONENTS["toggle_"+this.notificationData.notificationId].getState()}switchCallback(){this.isToggleWorking=!0,this.showOrHideButton(),this.toggleTemplates()}showOrHideButton(){this.updateStatusModified(),this.enableDisablePanelContent(),this.isToggleStateModified()?this.getNotificationGroup().showButtons():this.getNotificationGroup().hideButtons()}isToggleStateModified(){return this.notificationData.isEnabled!==this.getToggleState()}updateStatusModified(){let e=this.getToggleState(),t=document.getElementById("toggle_"+this.notificationData.notificationId);this.notificationData.isEnabled!==e?t.setAttribute("data-modified","notifications_"+(e?"enabled_":"disabled_")+this.notificationData.notificationId):t.removeAttribute("data-modified")}toggleTemplates(){let e=this.getToggleState();this.templates.forEach((function(t){t.parentToggled(e)}))}enableDisablePanelContent(){let e=this.getToggleState(),t=document.getElementById("collapsiblePanelContent_"+this.notificationData.notificationId);t&&(e?t.classList.remove("disabled","zswitchnone"):t.classList.add("disabled","zswitchnone"))}childToggled(e){if(!e&&!this.isToggleStateModified()){for(let e of this.templates)if(e.getToggleState())return;this.COMPONENTS["toggle_"+this.notificationData.notificationId].switchOff(),this.isToggleWorking=!1}}toggleStatusSavedCallback(){this.notificationData.isEnabled=this.getToggleState(),this.updateStatusModified(),this.templates.forEach((e=>e.toggleStatusSavedCallback()))}getTemplateListContainer(){return this.templateContainer}getNotificationGroup(){return this.notificationGroup}toNode(){return this.notificationContainer}}class s{constructor(e,t){this.templateData=e,this.notificationAction=t,this.parentContainer=t.getTemplateListContainer(),this.COMPONENTS={}}setTemplateContainer(e){this.templateContainer=e}constructTemplate(){if(this.templateContainer)return;let e=Object.values(this.templateData.role);this.templateContainer=document.createElement("div"),this.templateContainer.className="d-flexC";let t=`<div class="zpl_tgsprt"><h5 class="zpl_tgl"><input id="toggle_${this.templateData.templateId}" class="togbutton-js" style="display: none;">`+e[0]+"</h5></div>";this.templateContainer.innerHTML=t,this.appendActionIcons(),this.parentContainer.appendChild(this.templateContainer),this.initiateComponent()}appendActionIcons(){let e=this,t=document.createElement("div");if(t.id="icons_"+this.templateData.templateId,t.className="MLauto",t.innerHTML=`<div class="zpl_hvr"><i class="PI_eye" title="${ZPI18N.getString("zp.viewmmtemplate")}"></i></div>`,lmsbase.addListener(t.querySelector(".PI_eye"),"click",(()=>e.viewTemplate())),!this.templateData.isSystem){let s=document.createElement("i");s.className="PI_reset",s.setAttribute("title",ZPI18N.getString("zp.resettemplate")),lmsbase.addListener(s,"click",(()=>e.resetTemplate())),t.firstChild.insertBefore(s,t.querySelector(".PI_eye"))}this.templateContainer.appendChild(t)}updateActionIcons(){this.templateContainer.querySelector('[id="icons_'+this.templateData.templateId+'"]').remove(),this.appendActionIcons()}viewTemplate(){this.templateData.message?this.openTemplate():this.fetchContentInfo()}fetchContentInfo(){let e=this;this.templateData.isSystem||!this.templateData.contentId||this.templateData.message?(this.templateData.message=this.templateData.systemTemplate.message,this.openTemplate()):lmsfetchFile.fetchFile({contentId:e.templateData.contentId,isReplaceEmbedsInFile:!0,callback:t=>{e.templateData.message=t.content,e.openTemplate()}},{type:3},"edit")}openTemplate(){this.editorHandler=new r(this),this.editorHandler.initiate(),this.editorHandler.open()}resetTemplate(e){let t=this,s=new DeleteAlertMessage(ZPI18N.getString("zp.lms.notification.template.reset.title"),ZPI18N.getString("zp.lms.notification.template.reset.description"));s.yesButtonText=ZPI18N.getString("zp.reset"),s.setCallback((()=>{t.saveToDefaultTemplate(e)})),s.show()}saveToDefaultTemplate(e){let t=this;lmsCustomNotification.revertToDefaultTemplate(this.templateData.templateId,(s=>{1===s[0]&&(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.notification.template.restore.success")),t.updateDefaultTemplateData(),t.updateActionIcons(),e&&e())}))}updateDefaultTemplateData(){this.templateData.isSystem=!0,this.templateData.message=this.templateData.systemTemplate.message,this.templateData.subject=this.templateData.systemTemplate.subject}initiateComponent(){const e=this,t=ZPeopleComponents.toggleswitch("#toggle_"+this.templateData.templateId,{on:e.templateData.isEnabled,change:t=>e.switchCallback(t)});this.COMPONENTS["toggle_"+this.templateData.templateId]=t}getToggleState(){let e=this.COMPONENTS["toggle_"+this.templateData.templateId];return e?e.getState():this.templateData.isEnabled}switchCallback(){this.getNotificationAction().childToggled(this.getToggleState()),this.showOrHideButton()}isToggleStateModified(){return this.templateData.isEnabled!==this.getToggleState()}parentToggled(e){let t=this.COMPONENTS["toggle_"+this.templateData.templateId];t&&e!=this.getToggleState()&&(e?t.switchOn():t.switchOff())}showOrHideButton(){this.updateStatusModified(),this.isToggleStateModified()?this.getNotificationAction().getNotificationGroup().showButtons():this.getNotificationAction().getNotificationGroup().hideButtons()}updateStatusModified(){let e=document.getElementById("toggle_"+this.templateData.templateId);if(e){let t=this.getToggleState();this.templateData.isEnabled!==t?e.setAttribute("data-modified","templates_"+(!0===t?"enabled_":"disabled_")+this.templateData.templateId):e.removeAttribute("data-modified")}}toggleStatusSavedCallback(){this.templateData.isEnabled=this.getToggleState(),this.updateStatusModified()}getNotificationAction(){return this.notificationAction}toNode(){return this.templateContainer}}function r(t){let s,r,l=t.templateData,a=lmsEmailEditor.initiate(o());return{initiate:n,isContentModified:T,open:i,close:w};function n(){a.getPopUp().setSize(lmsPopUp.SIZE.MEDIUM),a.assembleEmailEditor()}function i(){a.showPopUp(),a.initiateComponents(),function(){let e=a.getZComponentInstance("from"),t=a.getZComponentInstance("to");e.container[0].classList.add("pnone"),t.container[0].classList.add("pnone")}(),e.openedTemplatePopup=this}function o(){return{editCallback:p,previewCallback:h,closeCallback:I,resetCallback:l.isSystem?void 0:g,from:1,header:t.notificationAction.notificationData.displayName,subject:l.subject,message:l.message,insertFields:l.insertDollarFields,components:{from:m(),to:u()},type:"view"}}function c(e){N()}function d(){let e={editorHeight:"450px",isMiniEditor:!1,enableSubmit:!1,enableSmily:!1,enableOnlyImageEmbeds:!0,additionalParams:{templateId:l.templateId},contentChangedCallback:z,type:3,fileName:"EmailEditor",needEditorFocus:!1,moduleName:"EmailEditor"};l.insertDollarFields&&(e.enableInsertField=!!l.insertDollarFields,e.insertFields=l.insertDollarFields),a.convertToEditor(e,{contentInfo:{content:l.message},isEmbedsAlreadyReplaced:!0,embeds:{}},"edit"),s=a.getZEditor(),s.afterEditorLoad(_),s.editordiv.querySelector('[class="PI_addlist"]')&&s.editordiv.querySelector('[class="PI_addlist"]').closest("li").classList.add("zpl_act")}function m(){let e={options:[],dataMapping:{label:"name",value:"id"}};return e.options.push({name:l.from,id:1}),e}function u(){let e={values:[],data:[],dataMapping:{text:"name",value:"id",id:"id"},search:{by:"name"}};return Object.keys(l.role).forEach((t=>{let s={id:t,name:l.role[t],removable:!1};e.values.push(s)})),e}function p(){d(),a.addSubjectObserver({input:c}),a.changeToEditMode(),a.removeIcon(lmsPopUp.ICONS.EDIT.type)}function g(){t.resetTemplate((function(){var e;w(),e=!!s,a=lmsEmailEditor.initiate(o()),s=void 0,r=void 0,n(),i(),e&&p()}))}function f(){a.getEditor().saveEditorContent({mode:l.contentId?"edit":"add",contentId:l.contentId,callback:e=>{l.contentId=e.fileInfo.contentId,l.message=s.getContent(),function(){let e={templateId:l.templateId,isSystem:y(),subject:a.getSubjectValue(),contentId:l.contentId};lmsCustomNotification.updateNotificationTemplate(e,(e=>{1===e[0]&&(function(e){l.subject=e.subject,S(),N(),l.isSystem!==e.isSystem&&(l.isSystem=e.isSystem,l.isSystem&&a.getPopUp().getIcon(lmsPopUp.ICONS.RESET.type)?a.getPopUp().removeIcon(lmsPopUp.ICONS.RESET.type):l.isSystem||a.getPopUp().getIcon(lmsPopUp.ICONS.RESET.type)||a.getPopUp().setIcon(lmsPopUp.ICONS.RESET,g),t.updateActionIcons())}(e[1]),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.notification.template.update.success")))}))}()}})}function v(){I()}function h(){!function(){a.getPopUp().hidePopUp();let e=document.createElement("i");e.className="zpl_ibg PI_back";let s=lmsPopUp.createPopUp({header:t.notificationAction.notificationData.displayName,elem:b()});s.setSize(lmsPopUp.SIZE.MEDIUM),s.assemblePopUp();let r=s.getPopUpHeader().querySelector("div");function l(){s.closePopUp(),a.getPopUp().showPopUp()}r.className="d-flexclmcap8 a-itm-cntr",r.insertBefore(e,r.querySelector("h4")),lmsbase.addListener(e,"click",l),s.showPopUp()}()}function b(){let e=s?s.getContent():l.message;e=function(e){if(l.dollarReplaceHTML){Object.keys(l.dollarReplaceHTML).forEach((t=>{e=e.replaceAll(t,l.dollarReplaceHTML[t])}))}return e}(e);let t="<form>";return t+='<div class="zpl_crd">',t+='<div class="zpl_crdcnt P0I ovh">',t+='<div class="pnone">',t+='<div style="font-family: Helvetica Neue, Helvetica, Arial, sans-serif;font-size: 15px; position: relative; margin: 0 -8px 0;">',t+='<div style="left: 0;right: 0; background-color: rgb(25,101,202);padding-top: 6%;">',t+='<div style="width:100%; max-width: 620px;box-sizing: border-box;margin: auto;overflow: hidden;position: relative; margin-top: -24px;">',t+='<div style="background: #fff;padding: 8% 6% 0; box-sizing: border-box; ">',t+=function(){if(logo&&"null"!=logo)return`<img src="/${portalname||"people"}/viewPhoto?filename=${logo}" style="top: -6px;left: 0;height: 40px; position: relative;" alt="../images/logo.png">`;return`<a class="DB ${Layout.isPeoplePlus?"zpl_lmspplog":"logo_l"}" style="top: -6px;left: 0;height: 32px; width: 32px;position: relative;"></a>`}(),t+=`<img src="${l.notificationImage}" style="max-width: 280px; width: 100%; margin: 0 auto;display: block;padding: 0 0 24px;" alt="">`,t+="</div>",t+="</div>",t+="</div>",t+='<div style="width:100%; max-width: 620px;box-sizing: border-box;margin: auto;overflow: hidden;position: relative; box-shadow: -2px 2px 2px -1px rgba(0, 0, 0, 0.09),2px 2px 2px -1px rgba(0, 0, 0, 0.09); margin-bottom: 3%;">',t+='<div style="padding: 2px 6% 30px;position: relative;">',t+=e,t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</form>",lmsdocument.parseStringToDOMElement(t)}function I(){T()?function(e){let t=new DeleteAlertMessage(ZPI18N.getString("zp.lms.card.warning.unsavedchanges.header"));t.setCallback(e),t.show()}(w):w()}function y(){let e=document.createElement("div");e.innerHTML=s.getContent(),$(e).find("br").remove();let t=document.createElement("div");return t.innerHTML=l.systemTemplate.message,e.isEqualNode(t)&&l.systemTemplate.subject===a.getSubjectValue()}function _(){S(),C().addEventListener("mousedown",P),C().addEventListener("click",P),C().addEventListener("keyup",P),C().addEventListener("keydown",P),C().addEventListener("input",P)}function S(){r=s.getContent()}function C(){return s.iframe.contentDocument}function P(){let e=C().getSelection().getRangeAt(0),t=e.startContainer,s=e.startOffset,r=e.endContainer,l=e.endOffset;if(t.nodeType===Node.TEXT_NODE&&/\$\{([^\}].*?)\}/.test(t.textContent)){for(;s>0&&!/\s/.test(t.textContent[s-1])&&!/\}/.test(t.textContent[s-1])&&!/\$/.test(t.textContent[s-1]);)s--;for(s--;l<t.textContent.length&&!/\s/.test(t.textContent[l])&&!/\$/.test(t.textContent[l])&&!/\}/.test(t.textContent[l]);)l++;l++,/^\$\{([^\}].*?)\}/.test(t.textContent.substring(s,l))&&(e.setStart(t,s<0?0:s),e.setEnd(r,l>t.textContent.length?t.textContent.length:l))}}function z(){N()}function N(){a.validate()&&T()?(a.getPopUp().getButton(lmsPopUp.BUTTONS.SAVE.type)||a.getPopUp().setButton(lmsPopUp.BUTTONS.SAVE,f),a.getPopUp().getButton(lmsPopUp.BUTTONS.CANCEL.type)||a.getPopUp().setButton(lmsPopUp.BUTTONS.CANCEL,v)):(a.getPopUp().removeButton(lmsPopUp.BUTTONS.SAVE.type),a.getPopUp().removeButton(lmsPopUp.BUTTONS.CANCEL.type))}function T(){let e=r&&r!==s.getContent();return e=e||a.getSubjectValue()!==l.subject,e}function w(){s&&C()&&(C().removeEventListener("mousedown",P),C().removeEventListener("click",P),C().removeEventListener("keyup",P),C().removeEventListener("keydown",P),C().removeEventListener("input",P)),a.close(),e.openedTemplatePopup=void 0}}return{NOTIFICATION_GROUP:{},initiate(t){if(!lmsnewsettings.isLMSNotificationEnabled())return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.invalidurl")),void this.moveBackward();let s=this;const r=settingsPage.container[0];this.NOTIFICATION_GROUP[t]?this.NOTIFICATION_GROUP[t].construct():this.getGroupData(t,(function(l){s.NOTIFICATION_GROUP[t]=new e(l,r),s.NOTIFICATION_GROUP[t].construct()}))},hashChangeCallback(e,t){let s=this;function r(){s.NOTIFICATION_GROUP[e].close(),t()}this.NOTIFICATION_GROUP[e].isModified()?lmsnewsettings.alertTabChange(r):r()},getGroupData(e,t){const s=this;s.notificationSettings?t(s.notificationSettings.getNotificationGroupData(e)):lmsCustomNotification.fetchNotification((function(r){s.notificationSettings=new LMSNotificationSettingsData(r[1].groups),t(s.notificationSettings.getNotificationGroupData(e))}))},moveBackward(){window.history.length>2?window.history.back():window.location.hash="#settings/service/lms/general"},fetchNotification(e){zplms.get("/lms/settings/notifications",null,e)},updateNotificationAndTemplateStatus(e,t){let s={notificationObject:JSON.stringify(e)};zplms.put("/lms/settings/notifications",s,t)},updateNotificationTemplate(e,t){let s={subject:e.subject,contentId:e.contentId,isSystem:e.isSystem};zplms.put("/lms/settings/notifications/templates/"+e.templateId,s,t)},revertToDefaultTemplate(e,t){zplms.put("/lms/settings/notifications/templates/"+e+"/reset",null,t)}}}();function LMSNotificationSettingsData(e){this.groups=e}lms={role:3,typebasedData:null,isTrainerCreate:null,commonTypeSettingData:null,manualSettingData:null,selfSettingData:null,iltSettingData:null,commonSettingData:null,allCategoryData:null,favCategoryData:null,allTrainerData:null,typeData:null,isSkillsetTabEnabled:null,notificationKeys:null,cache:{},defaultCategory:null,notifyHash:!0,appname:"lms",_page:{},config:{root:lmsbase,init:"initiate",hashchange:"onhashchange",initHash:null,ishashchge:!0,initAccess:!0},hash:{prev:"",cur:""},initiate:function(){null==lms.typebasedData||null==lms.allTrainerData?zplms.post("/lms/init",null,(function(e){"LMS tab is disabled"!==e[1].msg?(isadmin?lms.role=0:e[1].isTrainer&&(lms.role=1),lmsbase.addRole(),lmswelcome.categories=e[1].lmsCategories,lms.settingData=e[1].lmsSettings,lms.allCategoryData=e[1].lmsCategories,lms.favCategoryData=e[1].lmsfavCategories,lms.allTrainerData=e[1].lmsallTrainers,lms.typeData=e[1].lmsTypes,lms.courseCodes=e[1].lmsCourseCodes,lms.defaultCategory=e[1].defaultCategory,lms.notificationData=new LMSNotificationSettingsData(e[1].notificationData),lms.isSkillsetTabEnabled=e[1].isSkillSetEnabled,lmsmessages.UnreadCount=e[1].UnreadmessageCount,document.getElementById("zpeople_userimage").src=ZPeople.CURR_USER.zpeoplePhoto,$.each(e[1].lmsSettings,(function(t,s){lms.typebasedData=s,lms.selfSettingData=s.selfData,lms.iltSettingData=s.iltData,lms.manualSettingData=s.manualData,lms.lpSettingData=s.lpData,lms.commonSettingData=s.commonSetting;lmsbase.isAddCourseEnable();null==lms.isUserHavingReportingTo&&(lms.isUserHavingReportingTo=e[1].isUserHavingReportingTo,lms.isDataAdmin=lms.settingData[0].settingPermission.isDataAdmin,lms.isSettingsAdmin=lms.settingData[0].settingPermission.isSettingsAdmin,lmsbase.reInitialiseModulePermission("admin","trainer","learner"),!isadmin&&lms.isDataAdmin&&lmsbase.setModuleAdminPermission(),lmsbase._modHash[lmsbase._role].welcome=!e[1].LMSWelcomeIndex,lmsbase._modHash[lmsbase._role].user=lms.isUserHavingReportingTo,lmsbase._modHash[lmsbase._role].approval=isadmin||lms.isDataAdmin||lms.isUserHavingReportingTo||lms.settingData[0].selfData.isSelfUserModPerm||lms.settingData[0].iltData.isILTUserModPerm||lms.settingData[0].lpData.isLPUserModPerm,lmsbase._modHash[lmsbase._role].settings=isadmin||lms.isSettingsAdmin),reportsViewFr=lms.commonSettingData.reportsViewFr,hasPermission=(2==reportsViewFr||3==reportsViewFr)&&(isadmin||lms.isDataAdmin)||(1==reportsViewFr||3==reportsViewFr)&&1==lms.role,lmsbase._modHash[lmsbase._role].reports=hasPermission&&isOldReports,lms.tabConstruct()}))):ZPeople.Message.showWarningMsg(e[1].msg)})):lms.tabConstruct()},previewPage:function(){Layout.Page.hash=window.location.hash;var e=window.location.href.split("#")[1].split("-")[1].split("/")[0];"learner"==e?(lmscourses.previewType=1,isadmin=!1,lms.role=3):"trainer"==e?(isadmin=!1,lms.role=1):"admin"==e&&(isadmin=!0,lms.role=0),lms.initiate()},tabConstruct:function(){var e={};if(Layout){e.hash=Layout.Page.hash,e.container=Layout.Page.container[0],e.invokeby="people";let t=e.container.closest(".zpl_iwrpr");t.removeAttribute("tabindex"),t.removeAttribute("aria-label"),lms.config.ishashchge=!1}else e.hash=window.location.hash,e.container=document.getElementById("lmsmain"),e.invokeby="self";lms.config.initHash||(lms.config.initHash="#"+lms.appname+(lmsbase._modHash[lmsbase._role].welcome?"/welcome":"/mydata/courses")),lms._page=e,lms.initApp(e)},resize:function(){var e=lms.ParseURI("app",lms.hash.cur);lmsbase.resize.call({module:e.moduleStr,qmodule:e.popup})},close:function(){this.unload("app"),Layout||(window.addEventListener?window.removeEventListener("hashchange",hashchange,!1):window.attachEvent&&window.detachEvent("onhashchange",hashchange),lms._page={},lms.hash={prev:"",cur:""},lms.config.ishashchge=!0),lmsfileaction.unload()},unload:function(e){lmsbase.close.call({type:e,module:lms.ParseURI("app",lms.hash.prev).moduleStr,updateCache:function(e,t){lms.cache[e]=t}})},initHashChange:function(){var e=function(){lms._page.hash=location.hash,lms.initApp(lms._page)};window.addEventListener?window.addEventListener("hashchange",e,!1):window.attachEvent&&window.attachEvent("onhashchange",e),window.addEventListener("resize",lms.resize,!1),this.config.ishashchge=!1},initApp:function(e){this.config.ishashchge&&this.initHashChange();var t=e.hash;if(""==t){var s=""!=this.hash.cur?this.hash.cur:""!=this.hash.prev?this.hash.prev:this.config.initHash;this.updateloc(s)}else if(this.hash.cur!=t){var r=this.ParseURI("app",t);if(this.isvalidApp(r.appname)&&lmsbase.isvalidMod(r.moduleStr)&&lmsbase.isvalidQMod(r.popupStr)){var l=this.hash.prev=this.hash.cur;if(this.hash.cur=t,e.appname=r.appname,e.module=r.moduleStr,e.popup=r.popupStr,e.hashObject=this.ParseURI("keys",r.unparsedHashURI,"all"),e.quesObject=this.ParseURI("keys",r.unparsedQuesURI,"all"),""!=l){var a=this.ParseURI("app",l);e.prevmodule=a.moduleStr,e.prevpopup=a.popupStr}else e.prevmodule="",e.prevpopup="";e.modulecache=lms.cache[r.moduleStr]||"",e.qmodulecache=""!=r.popupStr&&lms.cache[r.popupStr]||"";var n=lms.hash.prev.split("/")[2],i=lms.hash.cur.split("/")[2];""!=l&&(e.prevmodule!=e.module||n&&i&&n!=i)&&this.unload("module"),lmsbase.initiate.call(e)}else"settings"!=t.split("/")[1]&&this.revertHash()}},revertHash:function(){this.updateloc(""!=this.hash.cur?this.hash.cur:this.config.initHash)},changeHash:function(e,t,s,r){if(t!=="addCourseInfo/"+lmscourses.currentCourseId&&$("#coursegradeview").hide(),"hash"==e){if((t="#"+lms.appname+"/"+t)==lms.hash.cur)return}else"ques"===e&&-1==t.indexOf("?")&&(t="?"+t);lms.notifyHash=!s||"disable"!=s,this.updateloc(t)},updateloc:function(e){var t=this.ParseURI("hash",e),s=this.ParseURI("ques",e);""==t&&(t=this.ParseURI("hash",location.hash)),location.hash=t+s},isvalidApp:function(e){return e==lms.appname},ParseURI:function(e,t,s){return"app"==e?lms.parseURIForAppInfo(t):"hash"==e?lms.parseURIForHash(t):"ques"==e?lms.parseURIForQues(t):"keys"==e?lms.parseURIForKeyValue(t,s):""},parseURIForHash:function(e){var t=e.indexOf("?");return e.substring(e.indexOf("#"),t>-1?t:void 0)},parseURIForAppInfo:function(e){var t=this.ParseURI("ques",e),s=this.ParseURI("hash",e),r=s.indexOf("#"),l=t.indexOf("?"),a={appname:"",role:"",moduleStr:"",unparsedHashURI:"",popupStr:"",unparsedQuesURI:""};if(0==r){var n=/^#(\w+)\/([^\/]+)(?:\/(.*))?$/;(i=s.match(n))&&(a.appname=i[1],a.role=lmsbase._role,a.moduleStr=i[2],a.unparsedHashURI=i[3]||"")}if(l>-1){n=/^\?(\w+)(\/|$)/;var i=t.match(n);a.popupStr=i[1],a.unparsedQuesURI=t.replace(n,"")}return a},parseURIForQues:function(e){var t=e.indexOf("?");return t>-1&&e.substring(t).length>1?e.substring(t):""},parseURIForKeyValue:function(e,t){for(var s,r,l,a=function(e){var t=e.split(":"),s={},r=t[1];return s[t[0]]=r.indexOf(",")>-1?r.split(","):r,s},n=function(e){for(var t,s,r=e.split(":"),l={},a=r[1].split("&"),n={},i=0;i<a.length;i++)(t=a[i].split("=")).length>1&&(s=t[1],n[t[0]]=s.indexOf(",")>-1?s.split(","):s);return l[r[0]]=n,l},i=function(e){for(var t,s,r=e.split("&"),l={},a=0;a<r.length;a++)s=(t=r[a].split("="))[1],l[t[0]]=s.indexOf(",")>-1?s.split(","):s;return l},o=e.indexOf("?"),c=(e=o>-1?e.substring(0,o):e).split("/"),d=c.length,m=(t="all"==t||t>d?d:t,1),u={},p=0;p<t;p++)r=(s=c[p]).indexOf(":"),l=s.indexOf("="),s.indexOf("#")>-1?t<d&&t++:r>-1&&l<0?(u["level"+m]=a(s),m++):r>-1&&l>-1?(u["level"+m]=n(s),m++):r<0&&l>-1?(u["level"+m]=i(s),m++):r<0&&(u["level"+m]=s,m++);return u},getKeyByValue:function(e,t){return Object.keys(e).find((s=>e[s]===t))}},LMSNotificationSettingsData.prototype.hasAnyNotification=function(){return this.groups.length>0},LMSNotificationSettingsData.prototype.getNotificationUsingId=function(e){for(var t=0,s=this.getAllNotifications();t<s.length;t++)if(s[t].notificationId==e)return s[t]},LMSNotificationSettingsData.prototype.getNotificationUsingKey=function(e){for(var t=0,s=this.getAllNotifications();t<s.length;t++)if(s[t].notificationKey==e)return s[t]},LMSNotificationSettingsData.prototype.getNotificationGroupData=function(e){for(const t of this.groups)if(t.groupKey==e)return t},LMSNotificationSettingsData.prototype.getNotificationGroups=function(){return this.groups},LMSNotificationSettingsData.prototype.getAllNotifications=function(){if(!this.notifications){this.notifications=[];for(var e=0;e<this.groups.length;e++)for(var t=0;t<this.groups[e].notifications.length;t++)this.notifications.push(this.groups[e].notifications[t])}return this.notifications},LMSNotificationSettingsData.prototype.isEnabled=function(e){return lms.commonSettingData.allowNotify&&1==this.getNotificationUsingKey(e).status},LMSNotificationSettingsData.prototype.updateNotificationStatus=function(e,t){if(!(t>=0&&t<=2))throw new RangeError("status out of range");this.getNotificationUsingId(e).status=t},LMSNotificationSettingsData.prototype.loadNotificationTemplates=function(e){let t=this;this.templates?e():this.fetchNotificationTemplates((s=>{t.responseCallback(s),e()}))},LMSNotificationSettingsData.prototype.fetchNotificationTemplates=function(e){let t={method:"fetchAllNotificationTemplates",conreqcsr:csrfToken};$.post("/notificationAction.zp",t,e)},LMSNotificationSettingsData.prototype.responseCallback=function(e){e[0]?(this.templates=e[1],this.insertTemplatesIntoNotification()):ZPeople.Message.showFailureMsg(e[1].message)},LMSNotificationSettingsData.prototype.insertTemplatesIntoNotification=function(){let e=this;this.templates&&this.groups.forEach((t=>{t.notifications.forEach((t=>{t.templates=e.templates[t.notificationId]}))}))},LMSNotificationSettingsData.prototype.getTemplate=function(e,t){if(this.templates)for(let s of this.templates[t])if(s.templateId==e)return s;return null};var lmscourses={_root:null,currentCourseId:"",currentBatchId:"",menuCallBack:null,selectedTab:"",courseInfoData:"",currentCourseInfoId:"",previousSectionId:"",currentSectionindex:"",currentSectionId:"",currentSectionName:"",skillData:null,selcourseType:"",selcourseSysVal:"",allcourseData:null,courseAddMode:"",shareCourseId:"",shareData:null,shareMode:"",isSharedCourse:!1,startIndex:0,mode:0,getDetails:{},formComponents:null,temp:{},courseFormComponents:null,courseName:null,componentTabs:null,randomImage:1,updateImage:"",currentCourseName:"",locationOptions:[],newUrl:"",fetchCat:1,defaultBatchId:"",trainerOptions:null,roomOptions:null,usersOptions:null,type:"",previousValues:[],formParams:"",previousSectionIndex:0,baseType:"",currentBatchName:"",currentBatchAdmin:"",categoryListpopUp:"",selectSectionName:"",editValues:[],multiSelectArray:[],singleSelectArray:[],getUrl:"",coursecode:"",isBatch:!1,editCourseAdmin:"",isUnlimtcount:!1,aboutCourse:"",courselearn:"",blendedFlag:0,previewType:0,menuObj:"",isCourseAdmin:!1,isUserhavingfavCat:!1,courseOwner:"",elem:"",_relem:"",filterObject:{},scrollvariable:0,filterDataArray:[],currentPage:"",currentMode:0,isSearched:!1,moduleName:"",isentityupdated:!1,settingOpened:0,courseCurrency:"",currencylistData:null,learnerJoinedBatchId:"",types:{1:ZPI18N.getString("zp.lms.settings.SelfPaced"),2:ZPI18N.getString("zp.lms.settings.InstructorLed"),3:ZPI18N.getString("zp.lms.settings.DigitalDownloads")},typeKeys:["zp.lms.settings.SelfPaced","zp.lms.settings.InstructorLed","zp.lms.settings.DigitalDownloads"],EVENT_TYPE:{COURSE_COMPLETION:"course_completion"},initiate:function(e){lmscourses.currentMode=0,lmscourses.currentPage=this.module,lmscourses.startIndex=0,lmscourses._relem=this.elem,lmscourses.filterObject={},$(".zp_transfm").hide(),ZPeople.FireScroll.reset();let t=this.elem.closest(".zpl_iwrpr");if(t.tabIndex=lmsConstants.TAB_INDEX.ACTIVE,"mycourses"===this.module?t.ariaLabel=ZPI18N.getString("zp.common.page.active",[ZPI18N.getString("zp.lms.base.MyCourses")]):"catalog"===this.module&&(t.ariaLabel=ZPI18N.getString("zp.common.page.active",[ZPI18N.getString("zp.lms.course.CourseCatalog")])),"addCourseInfo"==this.module)lmscourses._relem.innerHTML="",lmscourses.currentCourseId=this.hashObject.level1,lmscourseconfig.showAddCourseDetails("overview",lmscourses.currentCourseId),lmscourses.elem=document.getElementById("courseList"),lmscourses.elem.appendChild(zplms.getLoadingBarElement());else{lmscourses._relem.innerHTML="",lmscourses._root=this.elem,lmscourses.tabName="mycourses"==this.module?"My Courses":"Course Catalog",lmscourses.moduleName=this.module;var s="";if(lmscourses.filter.getFilterInstance(),0==$("#headerpositioncourse").length){s+='<div class="zpl_btnmnu" id="headerpositioncourse"><div class="zpl_rgt">';var r=lmsbase.isAddCourseEnable();"mycourses"==lmscourses.currentPage&&r&&(s+='<div class="zpl_splitbtn"><div>',s+=`<button class="zlabel zlabel--blue zlabel--medium" tabindex="${lmsConstants.TAB_INDEX.INACTIVE}" rel="createCourse" id="createCourse"> ${ZPI18N.getString("zp.lms.course.courseadd")} </button>`,s+="</div></div>"),"Course Catalog"==lmscourses.tabName&&(s+='<i class="zpl_ibg PI_plus_sqr" id="categoryList" title="'+ZPI18N.getString("zp.lms.pickfavcategory")+'"></i>'),s+="</div></div>"}s+=`<div class='zpl_rgtcnt'><div class='zpl_crdgrid' id='courseList' _rel='courseList' aria-label="${ZPI18N.getString("zp.wcag.proceedingto.list",[ZPI18N.getString("zp.lms.courses.lowercase")])}" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" role="list"></div></div>`,s+="<div class='zpl_fltr' id='filterBox'></div>",this.elem.innerHTML=s,lmsbase.addListener(this.elem,"click",lmscourses.courseHandle,!1),lmscourses.getCourseGridDetails(),lmscourses.elem=document.getElementById("courseList")}},getCourseCardLabel(e,t,s){let r=lmscourses.types[parseInt(s)];return`${ZPI18N.getString("zp.lms.course")} ${e}: ${t}, ${ZPI18N.getString("zp.type")}: ${r}`},courseHandle:function(e){if(lmscourses.isSelected())return!0;var t=e.target;if(e.target.closest("[id='categoryList']"))lmscourses.fetchFavouriteCategorys();else{"createCourse"===t.getAttribute("rel")&&lmscourseconfig.showAddCourse();var s=e.target.closest('[_crel="nextpage"]');"end"!=lmscourses.startIndex?s&&"coursenextpage"==s.getAttribute("_rel")&&lmscourses.getCourseGridDetails("",void 0,2):s&&s.remove()}},categoriesHandle:function(e){"catgeories"!=e.target.id&&lmscourses.getCourseGridDetails({FavCategories:e.target.id})},openPreNextPages:function(){$(".zp_content").show(),$(".zp_fpv").hide(),$(".zp_cwrap").show(),$(".zp_Lstwrap").removeClass("zp_gy")},getCourseBasicDetails:function(e,t,s){var r={method:"getCourseBasicDetails",courseFor:s,courseId:e,conreqcsr:csrfToken};$.post("/courseAction.zp",r,(function(e){t(e[1])}))},getCourseGridDetails:function(e,t,s,r,l){var a=lmscourses._relem.querySelector("#zp_page_loading");a&&a.remove(),$(lmscourses._relem).append(ZPeople.LOADING_HTML),lmscourses.scrollvariable=1,e=e||{},"end"==lmscourses.startIndex&&(lmscourses.startIndex=0);var n="",i="";"mycourses"==this.currentPage?(n="MyCourses",lmscourses.currentCourseId=""):"catalog"==this.currentPage&&(n="Course Catalog",lmscourses.currentCourseId=""),lmscourses.tabName=n,r&&(n=r),2==s&&"nameSearch"!=l&&(i="filterBy");var o="";if(-1!==Layout.Page.hash.indexOf("addCourseInfo/")){var c=Layout.Page.hash.split("/");o=c[c.length-1],n="addCourseInfo"}var d="end"!=lmscourses.startIndex&&-1!=lmscourses.startIndex&&0!=lmscourses.startIndex?lmscourses.startIndex+1:lmscourses.startIndex,m={method:"getCourseDetails",courseFor:n,modeOfView:"basicGrid",filterBy:lmscourses.filterObject.filterBy,courseId:o,start:d,conreqcsr:csrfToken};-1===Layout.Page.hash.indexOf("/reports")&&-1===Layout.Page.hash.indexOf("/calendar")||(m={method:"getCourseDetails",courseFor:n,modeOfView:"basicGrid",filterBy:i,courseId:o,start:d,conreqcsr:csrfToken}),lmscalendar.inputvalue&&void 0!==lmscalendar.inputvalue&&(m.courseName=lmscalendar.inputvalue,lmscalendar.inputvalue=void 0),null!=lmscourses.filterObject.sCategory&&null!=lmscourses.filterObject.sCategory&&(m.searchbyCat=lmscourses.filterObject.sCategory),null!=lmscourses.filterObject.sTrainer&&null!=lmscourses.filterObject.sTrainer&&(m.searchbyTrainer=lmscourses.filterObject.sTrainer),null!=lmscourses.filterObject.sState&&null!=lmscourses.filterObject.sState&&(m.searchbyState=lmscourses.filterObject.sState),null!=lmscourses.filterObject.sDate&&null!=lmscourses.filterObject.sDate&&(m.startDateFilter=lmscourses.filterObject.sDate),null!=lmscourses.filterObject.eDate&&null!=lmscourses.filterObject.eDate&&(m.endDateFilter=lmscourses.filterObject.eDate),null!=lmscourses.filterObject.sType&&null!=lmscourses.filterObject.sType&&(m.searchbyType=lmscourses.filterObject.sType),null!=lmscourses.filterObject.sProgress&&null!=lmscourses.filterObject.sProgress&&(m.searchbyProgress=lmscourses.filterObject.sProgress),null!=lmscourses.filterObject.sortCourse&&null!=lmscourses.filterObject.sortCourse&&(m.sortCourse=lmscourses.filterObject.sortCourse),null!=lmscourses.filterObject.courseName&&null!=lmscourses.filterObject.courseName&&(m.courseName=lmscourses.filterObject.courseName);var u;lmscourses.filterObject.courseName&&(u=!0);var p=lmsbase._refer.hash;if($.post("/courseAction.zp",m,(function(e){let r="end"!=lmscourses.startIndex&&-1!=lmscourses.startIndex&&0!=lmscourses.startIndex?lmscourses.startIndex+1:lmscourses.startIndex;if(lmsbase._refer.hash==p&&(null==m.start||null==m.start||m.start==r)){lmscourses.scrollvariable=0,lmscoursedetails.currentCourseData=lmscourses.allcourseData=e[1],0!=e[1].length&&1;var l=lmscourses._relem.querySelector("#zp_page_loading");if(l&&l.remove(),1!=s&&(0==lmscourses.currentMode||"MyCourses"==n||"Course Catalog"==n))if(lmscourses.openPreNextPages(),2!=s&&(lmscourses.tabName,lmscourses.filter.courseFilter(this.event)),e[1]&&e[1][0].courseInfo.length)document.querySelector('[id="courseList"]').classList.add("zpl_crdgrid"),lmscourses.courseCardView(e[1],0==lmscourses.startIndex?"new":"update",s);else{if(0==lmscourses.startIndex){lmscourses._relem.querySelector('[class="zp_CCcat"]')&&2!=s&&lmscourses._relem.querySelector('[class="zp_CCcat"]').remove(),"Course Catalog"==lmscourses.tabName?u?ZPI18N.getString("zp.lms.coursefilter"):"admin"==lmsbase._role?ZPI18N.getString("zp.lms.course.createcourse",["lmscourseconfig.showAddCourse()"]):ZPI18N.getString("zp.lms.course.coursenocourse"):u?ZPI18N.getString("zp.lms.coursefilter"):"trainer"==lmsbase._role?ZPI18N.getString("zp.lms.course.coursetrainernocourse"):ZPI18N.getString("zp.lms.course.joincourse"),document.querySelector('[id="courseList"]').classList.remove("zpl_crdgrid");let e=lmscourses.hasAddPerm()?"hasAddPerm":"noAddPerm",t=u?lmsnodata.noDatav5[lmscourses.tabName].onSearch:"MyCourses"==lmscourses.tabName?lmsnodata.noDatav5[lmscourses.tabName][e]:lmsnodata.noDatav5[lmscourses.tabName].general;lmscourses.showNoData(t,lmscourses._relem.querySelector("[_rel='courseList']")),$("#emptycoursecat").click((function(){lms.changeHash("hash","allcourses")}))}lmscourses.startIndex="end"}null!=t&&""!=t&&t(e[1])}})),1!=s&&0==lmscourses.currentMode&&null==lmscourses.componentTabs){var g={method:"getComponentTabs",conreqcsr:csrfToken};$.post("/courseAction.zp",g,(function(e){null!=e[1]&&(lmscourses.componentTabs=e[1])}))}},hasAddPerm:function(){return!(!lms.lpSettingData.isLpEnable||!(isadmin||lms.settingData[0].settingPermission.isDataAdmin||lms.settingData[0].savedConfigData.isUserCanAdd[0]&&!lms.settingData[0].savedConfigData.isUserCanAdd[0].isTrainer||lmsbase.isAddCourseEnable()&&lms.settingData[0].savedConfigData.isUserCanAdd.hasOwnProperty("zp.lms.learningplan")))||!!(lms.selfSettingData.isSelfenable||lms.iltSettingData.isIltenable||lms.manualSettingData.isManualenable)},removeLoading:function(){var e=document.querySelector("[_rel=loadbar]");e&&e.parentNode.removeChild(e)},courseCardView:function(e,t,s){var r=lmscourses._relem.querySelector("#zp_page_loading");r&&r.remove(),2!=s&&$("#courseList").html(""),$("#courseList").find("#suggestCourseli").remove(),$(".zp_Lstwrap").find("#suggestCourseli").remove(),lmscourses.smode=0,lmscourses.allcourseData=e;if("new"==t&&0==lmscourses.startIndex){var l=lmscourses._relem.querySelector('[_rel="courseList"]');l&&(l.innerHTML="")}let a=!!e[0].courseInfo[0]?.suggestCoursesList,n=e[0].courseInfo.length;for(let t=0;t<e[0].courseInfo.length;t++){let s=e[0].courseInfo[t];s&&lmscourses.cardConstrct(s,void 0,void 0,t,a)}if($("#suggestRgt").click((function(){var e=parseInt($(".zpl_Ccrdsugst").find("[_rel='suggest_viewedCnt']").text());lmscourses.nextPrevSuggestCourse(this,e,"rght")})),$("#suggestLft").click((function(){var e=parseInt($(".zpl_Ccrdsugst").find("[_rel='suggest_viewedCnt']").text());lmscourses.nextPrevSuggestCourse(this,e,"lft")})),$("#suggest_fav").click((function(){var e=$("#courseList").find(".zpl_Ccrdsugst").attr("_suggestid");lmscourses.isFav(e,event)})),(i=lmscourses._relem.querySelector('[_rel="coursenextpage"]'))&&i.remove(),n>=50){e[0].courseInfo.length<lmscourses.startIndex&&0==e[0].courseInfo.length?lmscourses.startIndex=-1:"end"!=lmscourses.startIndex&&-1!=lmscourses.startIndex&&(lmscourses.startIndex=e[0].courseInfo[0]&&e[0].courseInfo[0].suggestBy?lmscourses.startIndex+n-1:lmscourses.startIndex+n);var i=lmscourses._relem.querySelector('[_crel="nextpage"]'),o=document.createElement("div");o.setAttribute("class","zp_memarw"),o.setAttribute("_crel","nextpage"),o.setAttribute("_rel","coursenextpage"),lmscourses._relem.querySelector('[_rel="courseList"]').appendChild(o),ZPeople.FireScroll.setParam("triggered",!1),ZPeople.FireScroll.init(lmscourses.loadMore,"lms",null,!0);let t=$(lmscourses._relem);t.height()&&t.prop("scrollHeight")<=t.height()&&("catalog"==lmsbase._refer.module||"mydata"==lmsbase._refer.module&&"courses"==lmsbase._refer.hashObject.level1)&&lmscourses.getCourseGridDetails("",void 0,2)}else{ZPeople.FireScroll.setParam("triggered",!0),lmscourses.startIndex="end",(i=lmscourses._relem.querySelector('[_rel="coursenextpage"]'))&&i.remove()}},loadMore:function(){("catalog"==lmsbase._refer.module||"mydata"==lmsbase._refer.module&&"courses"==lmsbase._refer.hashObject.level1)&&lmscourses.getCourseGridDetails("",void 0,2)},constructAddedCourseCard:function(e,t){let s={method:"getCourseInfoDetails",courseFor:lmscourses.tabName,courseId:e,start:0,modeOfView:"fullGrid",viewFor:"courseInfo",conreqcsr:csrfToken};t&&0!=t&&null!=t&&(s.batchId=t),$.post("/courseAction.zp",s,(function(e){(e[1][0].courseType&&"3"!=e[1][0].courseType||e[1][0].type&&"E-Material"!=e[1][0].type)&&(e[1][0].courseState||(e[1][0].courseState="Drafted",e[1][0].stateType=0)),lmscourses.cardConstrct(e[1][0],void 0,!0),lmscourses._relem.querySelector('[_rel="courseList"]').classList.add("zpl_crdgrid"),lmscourses._relem.querySelector('[_rel="courseList"] #emptPage')&&lmscourses._relem.querySelector('[_rel="courseList"] #emptPage').remove()}))},getCourseImageUrl:function(e,t){return t?e.courseImageUrl?e.courseImageUrl:lmscourses.generateRandomCourseImage(e,t):lmsfileaction.generateSourceURL(e)},generateRandomCourseImage:function(e,t){if(t&&(!e.courseImageUrl||""==e.courseImageUrl)){let e=Math.floor(Math.random()*Math.floor(44));return e+=1,ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+e+".svg")}},cardConstrct:function(e,t,s,r,l){if(e.suggestCoursesList){var a=e.suggestCoursesList[0].courseId,n="";n+='<div class="zpl_Cr zpl_Ccrdsugst" _suggestid="'+e.suggestCoursesList[0].courseId+'" id="suggestCourseli" >',e.suggestCoursesList[0].courseImageInfo.additionalInfo={fileId:e.suggestCoursesList[0].courseId,type:6};var i="zpl_Crh";e.suggestCoursesList[0].courseImageInfo.isSystemImage&&(e.suggestCoursesList[0].courseImageInfo.courseImageUrl=e.suggestCoursesList[0].courseImageUrl,i="zpl_Crh CBg1"+e.suggestCoursesList[0].bannerBGData.clrId),n+='<div style="background:url('+lmscourses.getCourseImageUrl(e.suggestCoursesList[0].courseImageInfo,e.suggestCoursesList[0].courseImageInfo.isSystemImage)+') right/cover" _rel="suggest_courseImage" class="'+i+'" _clickrel="suggestOverview"></div>',n+='<div class="zpl_Crc" _clickrel="suggestOverview"><font>'+ZPI18N.getString("zp.lms.course.SuggestedBy")+'</font><h4 _rel="suggest_name">'+e.suggestCoursesList[0].courseName+'</h4> <p _rel="suggest_desc">'+e.suggestCoursesList[0].description+" </p>",n+='<div class="zpl_msp-crdcnt">',n+=lmscourses.constructSuggestedByUsers(e.suggestBy,a),n+="</div></div>",n+='<div class="zpl_Crsldr"><div><font _rel="suggest_viewedCnt">1</font> / <span id="totalCnt">'+e.suggestCoursesList.length+'</span></div><label><i class="PI_alft" id="suggestLft"></i><i class="PI_argt" id="suggestRgt"></i> </label></div>',n+="</div>",(n=$(n)).data("dataval",e),t&&t.hasOwnProperty("container")?t.container.appendChild(n[0]):$("#courseList").find("[id^=getCourseOverView1_]").length>0?0==$("#suggestCourseli").length&&$(n).insertBefore($("#courseList").find("[id^=getCourseOverView1_]")[0]):0==$(".zp_Lstwrap").find("#suggestCourseli").length&&lmscourses._relem.querySelector('[_rel="courseList"]').appendChild(n[0]),$("#suggestCourseli").click((function(){if("suggestOverview"==event.target.closest("div").getAttribute("_clickrel")){var t=$("#courseList").find(".zpl_Ccrdsugst").attr("_suggestid");lmscourses.isCourseAdmin=e.isCourseAdmin,lmscourses.courseOwner=e.courseOwnerId,lmscourses.getCourseOverView(t,c,e.batchName,e.isShared,e.type,e.courseType,e.batchAdmin,e)}}))}if(null!=e.courseName){var o=!1;n="";null!=e.startDate&&e.startDate,n+=`<div class="zpl_Cr" id="getCourseOverView1_${e.courseId}" role="listitem" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" aria-label="${lmscourses.getCourseCardLabel(l?r:r+1,e.courseName,e.courseType)}">`;var c="";isadmin||"Course Catalog"==lmscourses.tabName||t?null!=e.batchId&&null!=e.batchId?c=e.batchId:null!=e.defaultBatchId&&"null"!=e.defaultBatchId&&(c=e.defaultBatchId):("My Courses"==lmscourses.tabName||t)&&""!=e.userBatchId&&null!=e.userBatchId&&null!=e.userBatchId&&(c=e.userBatchId),null!=e.courseImage&&(lmscourses.updateImage=e.courseImage),e.isSystem&&(e.courseImageInfo.additionalInfo={fileId:e.courseId,type:6});i="zpl_Crh";if(e.isSystem||(i="zpl_Crh CBg"+e.bannerBGData.clrId),n+='<div class="'+i+'" _rel="courseBaseOverview" style="background:url('+lmscourses.getCourseImageUrl(e.courseImageInfo,!e.isSystem)+') right/cover"></div>',t&&t.hasOwnProperty("state")&&(n+='<div class="zpl_Crf" id="myTeamState_'+e.courseId+'">',n+='<div class="zpl_lnk"><b>'+t.state.courseState+"</b></div>",n+="</div>"),!t&&""!=e.courseState&&null!=e.courseState){n+='<div class="zpl_Crf">';let t=lmscourses.getCourseStateClass(e.stateType);"Course Catalog"==lmscourses.tabName?0!=e.stateType&&"-1"!=e.courseState||!isadmin&&1!=lms.role||!("1"==e.courseType&&lms.selfSettingData.isSelfTrainerpublish||"2"==e.courseType&&lms.iltSettingData.isIltTrainerpublish||"3"==e.courseType&&lms.manualSettingData.isManualTrainerpublish)?"1"==e.courseType?3!=e.stateType&&15!=e.stateType||lmsbase.isCourseAdmin(e.courseType,e,"join")?n+='<div><b class="'+t+'">'+e.courseState+"</b></div>":(n+='<div class="zpl_lnk" id="register_'+e.courseId+'"><b>',n+=e.courseState,n+="</b></div>"):(6==e.stateType?n+='<div class="zpl_lnk" id="viewBatchlst'+e.courseId+'"><b>':n+='<div _rel="courseBaseOverview"><b class="'+t+'">',null!=e.userGrade&&1==e.userGrade?n+='<span class="zpl_Cmgrd">'+ZPeople.decodeTxt(e.courseState)+"</span>":n+=e.courseState,n+="</b></div>"):n+='<div class="zpl_lnk"><b>'+e.courseState+"</b></div>":"MyCourses"==lmscourses.tabName&&(n+="<div>",n+='<b class="'+t+'">'+ZPeople.decodeTxt(e.courseState)+"</b>",n+="</div>"),n+="</div>"}n+='<div class="zpl_Crc" _rel="courseBaseOverview" id="getCourseOverView_'+e.courseId+'">',"1"==e.courseType?n+='<i class="PI_slf" title="'+ZPI18N.getString("zp.lms.settings.SelfPaced")+'"></i>':"2"==e.courseType?n+='<i class="PI_ilt" title="'+ZPI18N.getString("zp.lms.settings.InstructorLed")+'"></i>':n+='<i class="PI_emtrl" title="'+ZPI18N.getString("zp.lms.settings.DigitalDownloads")+'"></i>',null!=e.trainers&&$.each(e.trainers,(function(e,t){n+='<div _rel="courseBaseOverview" class="ZP_photo" title="'+t.trainerName+'"><img src="'+t.trainerImage+'"></div>'})),n+="<label>",null!=e.startDate&&""!=e.startDate&&3==lms.role&&(n+="<em>"+e.startDate+"</em>"),null!=e.courseLocation&&""!==e.courseLocation&&3==lms.role&&(n+='<em class="zpl_ldot">'+e.courseLocation+"</em>"),n+="</label>",e.courseName=ZPeople.escapeHtml(ZPeople.decodeTxt(e.courseName)),n+='<h4 title="'+e.courseName+'">'+e.courseName+"</h4>",null!=e.description&&(n+='<p title="'+e.description+'">'+e.description+"</p>"),n+="</div>",t&&t.hasOwnProperty("managerEvaluation")&&(n+='<i class="PI_more" id="cardMore_'+e.courseId+'" title="'+ZPI18N.getString("zp.lms.more")+'" rel="cardMore"></i>',n+=lmscourses.constructCourseMoreMenu(e.courseId,e.isPublished,e.isDisabled,e.courseType,e,!0),o=!0),t||("3"==e.courseType?e.courseOwnerId!=erecno||t&&"myTeam"==t||(n+='<i class="PI_more" id="cardMore_'+e.courseId+'" title="'+ZPI18N.getString("zp.lms.more")+'" rel="cardMore"></i>',n+=lmscourses.constructCourseMoreMenu(e.courseId,e.isPublished,e.isDisabled,e.courseType,e),o=!0):!(lmsbase.isCourseAdmin(e.courseType,e)||(3===lms.role||1===lms.role)&&e.isUserJoined&&e.isUsercanUnenroll)||t&&"myTeam"==t||(n+='<i class="PI_more" id="cardMore_'+e.courseId+'" title="'+ZPI18N.getString("zp.lms.more")+'" rel="cardMore"></i>',n+=lmscourses.constructCourseMoreMenu(e.courseId,e.isPublished,e.isDisabled,e.courseType,lmsbase.isCourseAdmin(e.courseType,e)?e:void 0),o=!0)),n+="</div>",(n=$(n)).data("dataval",e),t&&t.hasOwnProperty("container")?t.container.appendChild(n[0]):s?lmscourses._relem.querySelector('[_rel="courseList"]').insertBefore(n[0],lmscourses._relem.querySelector('[_rel="courseList"]').firstChild):lmscourses._relem.querySelector('[_rel="courseList"]').appendChild(n[0]),o&&(ZPeopleComponents.isComponent(`#courseMore_${e.courseId}`)&&(ZPeopleComponents.menu($(`#courseMore_${e.courseId}`)).destroy(),$(`#courseMore_${e.courseId}`).remove()),ZPeopleComponents.menu($(`#courseMore_${e.courseId}`),{forElement:$("#courseList").find(`#cardMore_${e.courseId}`),appendTo:$("#courseList"),itemclick:s=>{if(s.detail.attrs.id.includes("del")){if(0==e.isPublished||2==e.isPublished||3==e.isPublished||4==e.isPublished||5==e.isPublished)lmscourses.deleteRecord(e.courseId+"");else if(1==e.isPublished){let t="";t=e.isDisabled?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable"),lmscourses.disableCourse(e.courseId+"",t)}}else s.detail.attrs.id.includes("settings")?lmscourseoverview.changeOverViewHash(e.courseId,e.batchId,e.type,e.courseType,"","mode"):s.detail.attrs.id.includes("clone")?lmscourses.cloneCoursePopup(e.courseType,e.courseId):s.detail.attrs.id.includes("unenroll")?lmscourses.showUnenrollPopup(e.courseId):s.detail.attrs.id.includes("managerevaluation")&&t.hasOwnProperty("managerEvaluation")&&t.managerEvaluation(e)},show:e=>{e.detail.forElement.addClass("zpl_act")},hide:e=>{e.detail.forElement.removeClass("zpl_act")}})),$("#getCourseOverView1_"+e.courseId).click((function(t){"courseBaseOverview"==t.target.closest("div").getAttribute("_rel")&&(lmscourses.type=e.type,lmsbase.isUsercanhaveBatches(e.courseType,e)||e.iscourseTrainer?(c=e.batchId,lmscourses.learnerJoinedBatchId=e.batchId):(lmscourses.learnerJoinedBatchId=e.joinedBatchId,c=e.joinedBatchId),lmscourses.isCourseAdmin=e.isCourseAdmin,lmscourses.courseOwner=e.courseOwnerId,lmscourses.getCourseOverView(e.courseId,c,e.batchName,e.isShared,e.type,e.courseType,e.batchAdmin,e))})),$("#register_"+e.courseId).click((function(){1!=e.isPublished||3!=e.stateType&&15!=e.stateType||lmscourses.courseRegister(e.courseId,c,this,e.courseType)})),$("#viewBatchlst"+e.courseId).click((function(){1==e.isPublished&&6==e.stateType&&lmscourses.cardviewBatchlist(e.courseId,this,event)})),$("#cardMore_"+e.courseId).click((function(t){lmscourses.showCourseMoreMenu(e.courseId,e.type,e.courseType,e.courseImage)})),$("#myTeamState_"+e.courseId).click((function(){t.hasOwnProperty("state")&&t.state.callback(e)}))}lmscourses.courseCurrency=e.courseCurrency},getCourseStateClass:function(e){switch(e){case 7:return"ylw";case 8:case 14:return"grn";default:return""}},constructCourseMoreMenu:function(e,t,s,r,l,a){let n='<div id="courseMore_'+e+'" class="zpl_drpdwn" data-type="list" data-content-type="icon-text">';if(a)n+='<li data-icon-class="PI_setting" id="managerevaluation_'+e+'" rel="'+e+'">'+ZPI18N.getString("zp.lms.managerevaluation.ManagerEvaluation")+"</li>";else{let a="";if(a=1==t?s?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable"):ZPI18N.getString("zp.lms.delete"),lmsbase.isCourseAdmin(r,l)){(isadmin||lms.settingData[0].settingPermission.isDataAdmin||l.isCourseOwner||l.isCourseAdmin&&l.isCourseSettingsEnabled)&&(n+='<li data-icon-class="PI_setting" id="settings_'+e+'" rel="'+e+'">'+ZPI18N.getString("zp.lms.setting")+"</li>"),n+='<li data-icon-class="PI_clone" id="cloneCourse_'+e+'" rel="'+e+'">'+ZPI18N.getString("zp.lms.clonecourse")+"</li>",a!=ZPI18N.getString("zp.enable")&&(n+='<li data-item-type="separator" class="zmenu__separator" role="separator"></li>'),n+="<li data-icon-class="+(a==ZPI18N.getString("zp.enable")?"PI_tick2":a==ZPI18N.getString("zp.disable")?"PI_disable":"PI_delete")+' class="'+(a==ZPI18N.getString("zp.lms.delete")?"red":"")+'" id="del_'+e+'" rel="'+e+'">'+a+"</li>",l&&l.isJoined&&(a==ZPI18N.getString("zp.enable")&&(n+='<li data-item-type="separator" class="zmenu__separator" role="separator"></li>'),n+='<li data-icon-class="PI_close-account" id="unenroll_'+e+'" rel="'+e+'">'+ZPI18N.getString("zp.lms.settings.Unenroll")+"</li>")}else n+='<li data-icon-class="PI_close-account" id="unenroll_'+e+'" rel="'+e+'">'+ZPI18N.getString("zp.lms.settings.Unenroll")+"</li>"}return n+="</div>",n},showCourseMoreMenu:function(e,t,s,r){lmscourses.updateImage=r,lmscourses.currentCourseId=e,lmscourses.tempCourseId=e,lmscourses.selcourseType=t,lmscourses.selcourseSysVal=s,ZPeopleComponents.menu($(`#courseMore_${e}`)).show()},showNoData:function(e,t){new EmptyPages("zp_nd_desgn",e.title,e.desc,$(t)).show()},nextPrevSuggestCourse:function(e,t,s){var r=$(e).parent().parent().parent().data().dataval,l=r.suggestCoursesList,a=r;if("rght"==s){var n=t-1;if(t!=l.length&&$(".zpl_Ccrdsugst").find("[_rel='suggest_viewedCnt']").text(t+1),(c=n+1)==l.length)return;l[c].courseName=ZPeople.decodeTxt(l[c].courseName),$(".zpl_Ccrdsugst").find("[_rel='suggest_name']").text(l[c].courseName),l[c].courseImageInfo.additionalInfo={fileId:l[c].courseId,type:6};var i=l[c].courseImageInfo.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+l[c].courseImage+".svg"):lmsfileaction.generateSourceURL(l[c].courseImageInfo);$(".zpl_Ccrdsugst").find("[_rel='suggest_courseImage']").css("background-image","url("+i+")");var o=l[c].courseId;$("#courseList").find(".zpl_Ccrdsugst").attr("_suggestid",o),$(".zpl_Ccrdsugst .zpl_msp-crdcnt").html(lmscourses.constructSuggestedByUsers(a.suggestBy,o))}else{if(0==(n=t-1))return;$(".zpl_Ccrdsugst").find("[_rel='suggest_viewedCnt']").text(t-1);var c=n-1;$(".zpl_Ccrdsugst").find("[_rel='suggest_name']").text(ZPeople.decodeTxt(l[c].courseName)),l[c].courseImageInfo.additionalInfo={fileId:l[c].courseId,type:6};i=l[c].courseImageInfo.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+l[c].courseImage+".svg"):lmsfileaction.generateSourceURL(l[c].courseImageInfo);$(".zpl_Ccrdsugst").find("[_rel='suggest_courseImage']").css("background-image","url("+i+")");o=l[c].courseId;if($("#courseList").find(".zpl_Ccrdsugst").attr("_suggestid",o),$(".zpl_Ccrdsugst .zpl_msp-crdcnt").html(lmscourses.constructSuggestedByUsers(a.suggestBy,o)),1==$(".zpl_Ccrdsugst").find("[_rel='suggest_viewedCnt']").text())return}},constructSuggestedByUsers:function(e,t){let s=0,r='<div class="zpl_avatarimg">';if($.each(e,(function(e,l){null!=l[t]&&(s+=1,$.each(l[t],(function(e,t){s<5&&(r+='<div class="zpl_em">',r+='<div class="zpl_emimg" title="'+t.name+'"><img src="'+t.photoPath+'"></div>',r+="</div>")})))})),s>4){let e=s-4;r+='<span class="zpl_totaltxt" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'">+'+e+"</span>"}return r+="</div>",r},gridMoreMenu:function(e,t,s,r,l,a,n,i,o){lmscourses.updateImage=i,lmscourses.currentCourseId=e,lmscourses.tempCourseId=e,lmscourses.selcourseType=a,lmscourses.selcourseSysVal=n;var c="";c=1==s?l?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable"):ZPI18N.getString("zp.lms.delete");var d="";d=lmsbase.isCourseAdmin(n,o)?o.isJoined?[{edit:[ZPI18N.getString("zp.lms.setting")]},{del:[c]},{clone:[ZPI18N.getString("zp.lms.clonecourse")]},{unenroll:[ZPI18N.getString("zp.lms.settings.Unenroll")]}]:[{edit:[ZPI18N.getString("zp.lms.setting")]},{del:[c]},{clone:[ZPI18N.getString("zp.lms.clonecourse")]}]:[{unenroll:["Unenroll"]}],lmsmenu.initiate({elem:r.target,width:"130px",type:"dropdown",arrowHead:!0,menulist:d,eve:r}).on("close",(function(){lmscourses.tempCourseId=null})).on("click",(function(){lmsbase.isCourseAdmin(n,o)?("share"==this.value?lmscourses.shareCourse.showAddUserShareOrSuggest(lmscourses.tempCourseId+"","share"):"del"!=this.value||0!=s&&2!=s&&3!=s&&4!=s&&5!=s?"del"==this.value&&1==s&&lmscourses.disableCourse(lmscourses.tempCourseId+"",c):lmscourses.deleteRecord(lmscourses.tempCourseId+""),"edit"==this.value&&lmscourseoverview.changeOverViewHash(o.courseId,o.batchId,a,n,"","mode"),"clone"==this.value&&lmscourses.cloneCoursePopup(n,e),"unenroll"==this.value&&lmscourses.unenroll(e)):"unenroll"==this.value&&lmscourses.unenroll(e)})).bind()},getCourseOverView:function(e,t,s,r,l,a,n,i){lmscourseoverview.aboutCourse="",lmscourses.currentMode=1,lmscourses.selcourseType=l,lmscourses.selcourseSysVal=a,lmscourses.getCourseUrl(),lmscourses.isSharedCourse=r,lmscourses.currentCourseId=e,lmscourses.currentBatchId=t,lmscoursedetails.currentCourseData=null,lmscourses.currentBatchName="",lmscourses.currentBatchAdmin="",null!=s&&(lmscourses.currentBatchName=s),null!=n&&(lmscourses.currentBatchAdmin=n),lmscoursedetails.disableComponentData=null,lmscourses.changeOverViewHash(e,lmscourses.currentBatchId,l,a,"enable",i)},changeOverViewHash:function(e,t,s,r,l,a){lmscourses.moduleName="",lmscoursedetails.isBatchCreated="",lmscourses.currentCourseId=e,lmscourses.currentBatchId=t;var n="";n="Digital downloads"==s?"course/"+e+"/digitaldownloads":null==r||"1"==r?"course/"+e+"/overview":""!=lmscourses.currentBatchId&&"undefined"!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId?"course/"+e+"/batch/"+lmscourses.currentBatchId+"/overview":"course/"+e+"/overview",lmsbatches.batchData=null,lmscourses.selectedTab="overview",lmscoursedetails.tabCallbackId=0,"disable"!=l&&lmscourses.openOverview(n,a)},openOverview:function(e,t){var s=window.location.href.split("#"),r=s[0].split("/");s[0]="",r[r.length-1]="training";for(var l=0;l<r.length;l++)r[l].includes("?")&&(ques=r[l].split("?"),ques[0]="training?",r[l]=ques[0]+ques[1]),l==r.length-1?s[0]+=r[l]:s[0]+=r[l]+"/";var a=window.location.hash.split("/")[0],n="view";null!=t&&t.isArchivedAdmin&&(t.isCourseOwner||t.isCourseAdmin?n="adminview":t.iscourseTrainer&&(n="trainerview")),a=a.split("-")[0]+"-"+n,s[0]+=a+"/"+e,window.open(s[0])},tabScrollMinimize:function(){var e=document.getElementById("hideme").getBoundingClientRect();if(e.top<46-e.height+50)$("#tempTab").find("li").removeClass("sel"),$($("#tempTab").find("li")[lmscoursedetails.tabCallbackId]).addClass("sel"),$("#courseContainer").addClass("shw");else{var t=lmscoursedetails.totalbuttons.indexOf(lmscoursedetails._coursetab[lmsbase._role][lmscoursedetails.tabCallbackId][0]);t=-1==t?lmscoursedetails.tabCallbackId:t,$("#courseTabs").find("li").removeClass("sel"),$($("#courseTabs").find("li")[t]).addClass("sel"),$("#courseContainer").removeClass("shw")}},isFav:function(e,t){var s={};s="object"!=typeof t?t?{method:"removeFavourite",courseId:e,conreqcsr:csrfToken}:{method:"isFavourite",courseId:e,conreqcsr:csrfToken}:"PI_fav zpl_fav"==t.target.className?{method:"removeFavourite",courseId:e,conreqcsr:csrfToken}:{method:"isFavourite",courseId:e,conreqcsr:csrfToken},$.post("/courseAction.zp",s,(function(e){"object"==typeof t?"addsuccess"==e[1].status?(t.target.className="PI_fav zpl_fav",ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.addedtofavourites"))):"removesuccess"==e[1].status&&(t.target.className="PI_fav",ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.removedfromfavourites"))):"addsuccess"==e[1].status?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.addedtofavourites")):"removesuccess"==e[1].status&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.removedfromfavourites"))}))},addInfoCourse:function(){var e={formId:lmsbase.courseFormId,mode:"getFormComponents",isPageMode:!1,formMode:"ADD",isPopUpMode:!0,callback:lmscourses.initiate,containerId:"course_form"};ZPForm.isQuickAdd=!1,ZPForm.load(e)},editCourse:function(e){var t={formId:lmsbase.courseFormId,recordId:e,formMode:"EDIT",isPageMode:!1,isPopUpMode:!0,containerId:"course_form"};ZPForm.isQuickAdd=!1,ZPForm.load(t)},deleteRecord:function(e){let t=lmsbase.courseFormId;if(lmscourses.params={mode:"deleteRecords",recordIds:e,formId:t,courseId:e,conreqcsr:csrfToken},void 0!==e&&""!==e.trim()){let t=new DeleteAlertMessage,s=ZPI18N.getString("zp.lms.settings.course");t.title=ZPI18N.getString("zp.lms.entitydelete",[s]),t.despcription=ZPI18N.getString("zp.lms.permenentlydelEntity",[s]),t.yesButtonText=ZPI18N.getString("zp.confirm"),t.cancelButtonText=ZPI18N.getString("zp.cancel"),t.callback=function(){lmscourses.deletecourse(e)},t.show()}},deletecourse:function(e){$.post("/formAction.zp",lmscourses.params,(function(t){if(7e3==t.code){if(delete lms.courseCodes[lmscourses.params.recordIds],"catalog"==lmscourses.currentPage||"mycourses"==lmscourses.currentPage){if($("#getCourseOverView1_"+e).remove(),!lmscourses._relem.querySelector("#courseList [id*='getCourseOverView']")){lmscourses._relem.querySelector('[_rel="courseList"]').classList.remove("zpl_crdgrid");let e=lmscourses.hasAddPerm()?"hasAddPerm":"noAddPerm",t="MyCourses"==lmscourses.tabName?lmsnodata.noDatav5[lmscourses.tabName][e]:lmsnodata.noDatav5[lmscourses.tabName].general;lmscourses.showNoData(t,lmscourses._relem.querySelector("[_rel='courseList']"))}}else lmscoursedetails.backtoCourse();ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.coursedel"))}else 422==t.code?ZPeople.Message.showWarningMsg(t.message):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.course.coursenotdel"))}))},getCourseUrl:function(){var e=window.location.href.split("#"),t=e[0].split("/");e[0]="",t[t.length-1]="training";for(var s=0;s<t.length;s++)s==t.length-1?e[0]+=t[s]:e[0]+=t[s]+"/";lmscourses.getUrl=e[0]+"#lms-view/",lmscourses.getUrl+=lmscoursedetails.componentUrl(lmscourses.currentCourseId),lmscourses.getUrl+="/overview"},disableCourse:function(e,t,s){let r=lmsbase.constructMaskv5("zpl_mcenter",!0);lmscourses.disableCoursePopUp=r.appendChild(document.createElement("div")),lmscourses.disableCoursePopUp.className="zpl_minr",lmscourses.disableCoursePopUp.innerHTML=`<div class="zpl_mhder">\n                                                        <div><h4>${t+" "+ZPI18N.getString("zp.lms.course")} </h4></div>\n                                                        <a class="_cls PI_cls" onclick="lmsbase.closeMaskv5()" title="${ZPI18N.getString("zp.lms.close")}"></a>\n                                                    </div>\n                                                    <div class="zpl_mcnt zpl_fm">\n                                                        <form>\n                                                            <div class="zpl_crd">\n                                                                <div class="zpl_crdcnt">\n                                                                    <div class="zpl_secn">\n                                                                        <div><label>${ZPI18N.getString("zp.lms.messages.comments")}</label></div>\n                                                                        <div>\n                                                                            <textarea class="ztextbox" id="cmnt_val" placeholder="${ZPI18N.getString("zp.apprCmtMandatoryErr")}"></textarea>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </form>\n                                                    </div>`;let l='<div class="zpl_mfoter"><button class="zlabel zlabel--blue zlabel--medium" type="button" onclick="lmscourses.updateEnableDisableCmnt(\''+e+"','"+t+"','"+s+"')\">"+t+"</button></div>";$(lmscourses.disableCoursePopUp).append(l)},updateEnableDisableCmnt:function(e,t,s){var r=$("#cmnt_val").val();if($("#cmnt_val").val().length>2048)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.exceedmaxlength"));else{if(r.includes(">")||r.includes("<"))return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));var l="";l=t!=ZPI18N.getString("zp.enable"),"overview"==s&&(t==ZPI18N.getString("zp.enable")?$('[_rel="del"]').find("div").text(ZPI18N.getString("zp.disable")):$('[_rel="del"]').find("div").text(ZPI18N.getString("zp.enable")));var a={method:"disableCourse",enabledisable:l,courseId:e,enableDisableComment:r,conreqcsr:csrfToken};$.post("/courseAction.zp",a,(function(e){if(1==e[1]){"overview"!=s?lmscourses.filter.filterInstance.resetBreadCrumbs():(lmscoursedetails.iscourseEdit=!0,lmscoursedetails.currentCourseData=null,lmscoursedetails.initiate());var r=ZPI18N.getString("zp.enable");t==r?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.courseenable")),$('[_rel="del"]').find("div").text(ZPI18N.getString("zp.disable"))):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.coursedis")),$('[_rel="del"]').find("div").text(ZPI18N.getString("zp.enable")))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.course.coursenotdis"))})),lmsbase.closeMaskv5()}},publishCourse:function(e,t,s,r,l,a,n,i){var o="";if(""!=n&&null!=n&&(o=n),"1"==lmscourses.selcourseSysVal&&(1==lmscoursedetails.currentCourseData[0].isPublished||1!=lmscoursedetails.currentCourseData[0].isPublished&&("1"==lms.selfSettingData.isSelfModerateOpt||lms.selfSettingData.isSelfUserModPerm||4==lmscoursedetails.currentCourseData[0].isPublished))||"2"==lmscourses.selcourseSysVal&&(lmscoursedetails.currentCourseData[0].isBatchPublished||!lmscoursedetails.currentCourseData[0].isBatchPublished&&("1"==lms.iltSettingData.isIltModerateOpt||lms.iltSettingData.isILTUserModPerm||4==lmscoursedetails.currentCourseData[0].isModerateStatus))){var c={method:"publishCourse",courseId:e,batchId:o,publishState:l=!l,conreqcsr:csrfToken};lmscoursedetails.courseTabdetails.mode&&(c.mode=lmscoursedetails.courseTabdetails.mode),$.post("/courseAction.zp",c,(function(e){e[1].isPublish==ZPI18N.getString("zp.submittedforapproval")?(document.querySelector('[id="publishButton"]').innerText=ZPI18N.getString("zp.waitingmsg"),document.querySelector('[rel="coursestate"]')&&(document.querySelector('[rel="coursestate"]').innerText=ZPI18N.getString("zp.waitingmsg")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.submittedforapproval"))):$.each(e[1],(function(s,r){1==e[1].isPublish&&(lmscoursedetails.currentCourseData=null,lmscoursedetails.initiate()),lmscoursedetails.initObj.mode="update",1==l&&1==r?(1==l?$(t).text(ZPI18N.getString("zp.published")):("members"==a&&$("[data-id^='addBtn']").show(),lmscoursedetails.ispublish=l,$(t).text(ZPI18N.getString("zp.lms.course.unpublish"))),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.coursepub"))):0==l&&1==r?($(t).text(ZPI18N.getString("zp.publish")),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.course.unpublishMsg")),l||"members"!=a||$("[data-id^='addBtn']").hide()):ZPeople.Message.showWarningMsg(r)}))}))}else{c={method:"sendForModApproval",batchId:o,courseId:e,publishState:l=!l,conreqcsr:csrfToken};$.post("/courseAction.zp",c,(function(e){1==e[1].msg||0==e[1].msg?1==l?($(t).text(ZPI18N.getString("zp.approved")),document.querySelector('[rel="coursestate"]')&&(document.querySelector('[rel="coursestate"]').innerText=ZPI18N.getString("zp.approved")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.approvals.approvesuccessmsg"))):($(t).text(ZPI18N.getString("zp.rejected")),document.querySelector('[rel="coursestate"]')&&(document.querySelector('[rel="coursestate"]').innerText=ZPI18N.getString("zp.rejected")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.approvals.Denysuccessmsg"))):e[1].isPublish?ZPeople.Message.showWarningMsg(e[1].isPublish):ZPeople.Message.showWarningMsg(i)}))}},sendForModApproval:function(e,t,s){var r={method:"sendForModApproval",batchId:t,courseId:e,conreqcsr:csrfToken};$.post("/courseAction.zp",r,(function(e){1==e[1].isPublish?(document.querySelector('[id="publishButton"]').innerHTML=ZPI18N.getString("zp.published"),document.querySelector('[rel="coursestate"]')&&(document.querySelector('[rel="coursestate"]').innerText=ZPI18N.getString("zp.published")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.coursepub"))):1==e[1].msg||0==e[1].msg?(document.querySelector('[id="publishButton"]').innerHTML=ZPI18N.getString("zp.waitingmsg"),document.querySelector('[rel="coursestate"]')&&(document.querySelector('[rel="coursestate"]').innerText=ZPI18N.getString("zp.waitingmsg")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.submittedforapproval"))):ZPeople.Message.showWarningMsg(e[1].isPublish)}))},courseRegister:function(e,t,s,r){var l={courseId:e,batchId:t,type:1};zplms.post("lms/courses/users",l,(function(l){1==l[1].registrationStatus?($(s).text(l[1].message)&&$(s).removeClass("zpl_lnk"),ZPeople.Message.showSuccessMsg(l[1].sucessmessage),lmscourses.changeOverViewHash(e,t,r,"disable","",""),lmscoursedetails.currentCourseData=null,lmscoursedetails.disableComponentData=null,lmscoursedetails.initiate(),lmscoursedetails.initObj.mode="update"):ZPeople.Message.showWarningMsg(l[1].message)}))},cardviewBatchlist:function(e,t,s,r){var l={method:"getCourseInfoDetails",courseId:e,planId:r,modeOfView:"fullGrid",courseFor:"courseOverview",start:0,viewFor:"batchInfo",conreqcsr:csrfToken};$.post("/courseAction.zp",l,(function(t){t[1][0].allbatches?lmscourses.viewJoinbatchList(t[1][0].allbatches,e):"Permission denied"==t[1][0].message&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ttpermdenied"))}))},viewJoinbatchList:function(e,t){let s=lmsbase.constructMaskv5("zpl_mcenter zpl_mmd",!0);lmscourses.viewBatchesPopup=s.appendChild(document.createElement("div")),lmscourses.viewBatchesPopup.className="zpl_minr";let r=`<div class="zpl_mhder">\n\t\t\t\t\t  \t<div><h4>${ZPI18N.getString("zp.lms.availablebatch")}</h4></div>\n\t\t\t\t\t  \t<a class="_cls PI_cls" onclick="lmsbase.closeMaskv5()" title="${ZPI18N.getString("zp.lms.close")}"></a>\n\t\t\t\t\t  </div>`;$(lmscourses.viewBatchesPopup).append(r);let l=`<div class="zpl_mcnt zpl_fm">\n\t\t\t\t\t\t<div class="zpl_crdlst zpl_vwbatch">\n\t\t\t\t\t\t\t${lmscourses.constructBatchList(e)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;$(lmscourses.viewBatchesPopup).append(l),$("[id^=viewbatchregister_]").click((function(){lmsbase.closeMaskv5();var e=$(this).attr("_batchrel");lmscourseoverview.courseOverviewRegister(t,e,this,"2")}))},constructBatchList:function(e){let t="";return 1==e[0].isCommonRequest?(t+='<div class="zpl_catlst">',t+='<div class="zpl_ellipsis"><b>'+ZPI18N.getString("zp.lms.course.registrationclosed")+"</b></div>",t+='<div class="zpl_catlstrgt"><div><button class="zlabel zlabel--blue zlabel--medium" id="viewbatchregister_'+e[0].batchId+'" _batchrel="'+e[0].batchId+'">'+e[0].courseState+"</button></div></div>",t+="</div>"):4==e[0].stateType?(t+='<div class="zpl_catlst">',t+='<div class="zpl_catlstrgt"><div class="d-flexclmcap8 d-flexC"><i class="'+lmscourses.getStatusClass(e[0].courseState)+'">'+e[0].courseState+"</i></div></div>",t+="</div>"):$.each(e,(function(e,s){t+='<div class="zpl_catlst">',t+='<div class="zpl_ellipsis">',t+='<b title="'+s.batchName+'">'+s.batchName+"</b>",t+='<div class="d-flexC">',t+='<div class="d-flexC flexclmcap4">',t+=lmscourses.getSeatOrLocationIcon(1),t+='<span title="'+ZPI18N.getString("zp.lms.course.seatsAvailable")+'">'+s.availableCount+"</span>",t+="</div>",null!=s.locationName&&""!=s.locationName&&(t+='<em class="zpl_dots sm"></em>',t+='<div class="d-flexC flexclmcap4">',t+=lmscourses.getSeatOrLocationIcon(2),t+='<span title="'+s.locationName+'">'+s.locationName+"</span>",t+="</div>"),t+="</div>",t+="</div>",t+="<div>",t+='<div class="zpl_compoffar">',t+='<div class="d-flexC d-flexclmcap10">',t+="<div><b>"+lmscourses.convertDateFormat(s.startDate)+"</b></div>",t+='<i class="PI_arw_travl"></i>',t+="<div><b>"+lmscourses.convertDateFormat(s.endDate)+"</b></div>",t+="</div>",t+="<div><em>"+lmscourses.dateDiff(lmscourses.convertDateFormat(s.startDate),lmscourses.convertDateFormat(s.endDate))+"</em></div>",t+="</div>",t+="</div>",t+='<div class="zpl_catlstrgt">',s.isBatchPublished&&""!=s.courseState&&(-1!==Layout.Page.hash.indexOf("/learningplan")?(t+="<div>",t+='<button class="zlabel zlabel--blue zlabel--medium" id="viewbatchregister_'+s.batchId+'" _batchrel="'+s.batchId+'">'+ZPI18N.getString("zp.lms.course.coursejoinnow")+"</button>",t+="</div>"):3==s.stateType||15==s.stateType?(t+="<div>",t+='<button class="zlabel zlabel--blue zlabel--medium" id="viewbatchregister_'+s.batchId+'" _batchrel="'+s.batchId+'">'+s.courseState+"</button>",t+="</div>"):t+='<div class="d-flexclmcap8 d-flexC"><i class="'+lmscourses.getStatusClass(s.courseState)+'"></i>'+s.courseState+"</div>"),t+="</div>",t+="</div>"})),t},convertDateFormat:function(e){const t={jan:"01",feb:"02",mar:"03",apr:"04",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",oct:"10",nov:"11",dec:"12"};let s="",r="",l="",a=dateFmt.includes("/")?"/":dateFmt.includes(".")?".":(dateFmt.includes("-"),"-");const n=e.toLowerCase().split(a);dateFmt.toLowerCase().split(a).forEach(((e,a)=>{e.includes("d")?s=n[a]:e.includes("m")?(r=n[a],r=isNaN(Number(r))?t[r.toLowerCase()]:r):e.includes("y")&&(l=n[a])}));return`${s}-${r}-${l}`},dateDiff:function(e,t){let[s,r,l]=e.split("-").map(Number),a=new Date(l,r-1,s);t||(t=(new Date).toISOString().substr(0,10));let[n,i,o]=t.split("-").map(Number),c=new Date(o,i-1,n);if(a>c){let e=a;a=c,c=e}let d=[31,l%4==0&&l%100!=0||l%400==0?29:28,31,30,31,30,31,31,30,31,30,31],m=c.getFullYear()-l,u=c.getMonth()-a.getMonth(),p=c.getDate()-a.getDate();p<0&&(u--,p+=d[a.getMonth()]);let g=[];return m>0&&g.push(`${m} Years`),u>0&&g.push(`${u} Months`),(p>0||0===m&&0===u&&0===p)&&g.push(`${p} Days`),g.join(" ")},getSeatOrLocationIcon:function(e){return'<span class="'+(1==e?"PI_seat_loca":"PI_work_loca")+'"><span class="path1"></span><span class="path2"></span></span>'},getStatusClass:function(e){switch(e.toLowerCase()){case"requested":return"PI_pending ylw";case"completed":case"join now":return"PI_tick2_fil grn";case"closed":return"PI_cls2 red";default:return"PI_pending2 ylw"}},showUnenrollPopup:function(e){if(null!=e&&""!=e.trim()){let t=new DeleteAlertMessage;t.title=ZPI18N.getString("zp.lms.unenrollpopuptitle"),t.despcription=ZPI18N.getString("zp.lms.unenrollpopupdesc"),t.yesButtonText=ZPI18N.getString("zp.confirm"),t.cancelButtonText=ZPI18N.getString("zp.cancel"),t.callback=function(){lmscourses.unenroll(e)},t.show()}},unenroll:function(e,t){var s="";"null"!=lmscourses.currentBatchId&&""!=lmscourses.currentBatchId&&(s=lmscourses.currentBatchId);var r={courseId:e,user:erecno,status:1,batchId:s};zplms.put("lms/courses/users",r,(function(e){if("Sucess"==e[1].registrationStatus){if($(t).text(ZPI18N.getString("zp.lms.course.coursejoinnow")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.courseunenroll")),r&&r.courseId&&$(lmscourses._relem).find("#getCourseOverView1_"+r.courseId).remove(),!lmscourses._relem.querySelector("#courseList [id*='getCourseOverView']")){lmscourses._relem.querySelector('[_rel="courseList"]').classList.remove("zpl_crdgrid");let e=lmscourses.hasAddPerm()?"hasAddPerm":"noAddPerm",t="MyCourses"==lmscourses.tabName?lmsnodata.noDatav5[lmscourses.tabName][e]:lmsnodata.noDatav5[lmscourses.tabName].general;lmscourses.showNoData(t,lmscourses._relem.querySelector("[_rel='courseList']"))}}else ZPeople.Message.showWarningMsg(e[1].registrationStatus)}))},cloneCoursePopup:function(e,t){let s=lmsbase.constructMaskv5("zpl_mcenter",!0,(function(){2==e&&lmscourses.destroySelect(lmscourses.cloneCoursePopUp.querySelector("#cloneBatch"))}));lmscourses.cloneCoursePopUp=s.appendChild(document.createElement("div")),lmscourses.cloneCoursePopUp.className="zpl_minr";let r='<div class="zpl_mhder">';r+="<div><h4>"+ZPI18N.getString("zp.lms.clonecourse")+"</h4></div>",r+='<a class="_cls PI_cls" rel="closeClone" title="'+ZPI18N.getString("zp.lms.close")+'"></a>',r+="</div>",r+='<div class="zpl_mcnt zpl_fm">',r+="<form>",r+='<div class="zpl_crd">',r+='<div class="zpl_crdcnt">',2==e&&(r+='<div class="zpl_secn" id="batchList">',r+="<div><label>"+ZPI18N.getString("zp.lms.batches.Batch")+"</label></div>",r+='<select id="cloneBatch"></select>',r+="</div>"),r+='<div class="zpl_secn">',r+="<div><label>"+ZPI18N.getString("zp.clone")+"</label></div>",r+='<div id="clonefrOption">',r+='<div class="zcheckbox disabled">',r+='<input type="checkbox" name="clone" _rel="cloneOverview" class="zcheckbox__helper" value="">',r+='<label class="zcheckbox__label" name="clone">'+ZPI18N.getString("zp.lms.component.display_name.overview")+"</label>",r+="</div>",r+='<div class="zcheckbox">',r+='<input type="checkbox" _rel="cloneModules" class="zcheckbox__helper" value="" name="clone">',r+='<label class="zcheckbox__label" name="clone">'+ZPI18N.getString("zp.lms.batches.clonemodulesonly")+"</label>",r+="</div>",r+='<div class="zcheckbox">',r+='<input type="checkbox" _rel="cloneMembers" class="zcheckbox__helper" value="" name="clone">',r+='<label class="zcheckbox__label" name="clone">'+ZPI18N.getString("zp.lms.component.display_name.members")+"</label>",r+='<i class="PI_info tooltip-js" data-title-position="right" data-title-display-type="callout" title="'+ZPI18N.getString("zp.lms.archivedmembernotclone")+'"></i>',r+="</div>",r+="</div>",r+="</div>",r+="</div>",r+="</div>",r+="</form>",r+="</div>",r+='<div class="zpl_mfoter">',r+='<button type="button" class="zlabel zlabel--blue zlabel--medium" rel="cloneCourse">'+ZPI18N.getString("zp.clone")+"</button>",r+="</div>",lmscourses.cloneCoursePopUp.innerHTML=r,lmscourses.cloneCoursePopUp.querySelector('[_rel="cloneOverview"]').checked=!0,$(lmscourses.cloneCoursePopUp).find("[name='clone']").click((function(){let e=this.parentElement.querySelector("[type='checkbox']");"cloneOverview"!=e.getAttribute("_rel")&&(e.checked=!e.checked)})),$(lmscourses.cloneCoursePopUp).find('[rel="closeClone"]').click((function(){lmsbase.closeMaskv5()})),$(lmscourses.cloneCoursePopUp).find("[rel='cloneCourse']").click((function(){lmscourses.updateCloneCourse(e)})),2==e&&lmscourses.initCloneBatches("#cloneBatch")},initCloneBatches:function(e){let t={dataSource:{search:function(e){return new Promise((function(t,s){const r={method:"cloneBatchList",courseId:lmscourses.currentCourseId,searchtxt:e.query,conreqcsr:csrfToken};$.post("/courseAction.zp",r,(function(e){const s=[];$.each(e[1],(function(e,t){s.push({label:e,value:t})}));let r={results:s,more:100==s.length};t(r)}))}))},paginated:!0},placeholder:ZPI18N.getString("zp.select"),dropdownList:{fitForElement:!0,isTextHTMLEncoded:!0},cacheData:!0,sort:!0,lazyLoading:!1,serverSearch:!0,showSearchField:!0,search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.nodatafound")},isLabelHTMLEncoded:!0};ZPeopleComponents.select(e).setAttributes(t)},batchView:function(e){var t={};Object.keys(e[1]).forEach((function(s){t[e[1][s]]=[s,""]})),lmscourses.menuCallBack(t,lmscourses.inputvalue)},createApplicableToMenu:function(e,t){lmscourses.menuObj.insertMenu({elem:e,type:"select",mode:"single",allow_new:!1,menutype:1,menulist:t}),lmsmenu.changeToSelectMenu(e,{},"single",null,"Select","","noencode")},updateCloneCourse:function(e){let t="";"2"==e&&(t=ZPeopleComponents.select("#cloneBatch").getValue());let s="course";if(document.querySelector("[_rel='cloneModules']").checked&&(s="coursemodule"),document.querySelector("[_rel='cloneMembers']").checked&&(s="coursemembers"),document.querySelector("[_rel='cloneModules']").checked&&document.querySelector("[_rel='cloneMembers']").checked&&(s="coursemodulemembers"),("coursemodule"==s||"coursemembers"==s||"coursemodulemembers"==s)&&""==t&&"2"==e)return $("#batchList").find('[_rel="cloneSpan"]').remove(),$("#batchList").append("<span _rel='cloneSpan' class='ztextbox--error__label'>Batch cannot be empty</span>"),ZPeopleComponents.select("#cloneBatch").setAttributes({className:"ztextbox__error"}),!1;lmsbase.mask.querySelector("[rel='cloneCourse']")&&lmsbase.mask.querySelector("[rel='cloneCourse']").classList.add("disabled");var r={method:"updateCloneCourse",courseId:lmscourses.currentCourseId,batchId:t,clonefr:s};zplms.post("/courseAction.zp",r,(function(e){if(null!=e[1]){var t="";"0"!=e[1].clonedBatchId&&(t=e[1].clonedBatchId),lmscoursedetails.currentCourseData=null,lmscourses.changeOverViewHash(e[1].clonedCourseId,t,e[1].courseType,"enable"),(e[1].courseType&&"3"!=e[1].courseType||e[1].type&&"E-Material"!=e[1].type)&&(e[1].courseState||(e[1].courseState="Drafted",e[1].stateType=0)),e[1].courseName&&(e[1].courseName=ZPeople.escapeHtml(e[1].courseName)),e[1].clonedCourseId&&(e[1].courseId=e[1].clonedCourseId),e[1].isPublished&&(e[1].isPublished=0),t&&(e[1].batchId=t),lmscourses.cardConstrct(e[1],void 0,!0)}lmscourses.destroySelect("#cloneBatch"),lmsbase.closeMaskv5()}))},destroySelect:function(e){ZPeopleComponents.isComponent(e)&&ZPeopleComponents.select(e).destroy()},clonefrselect:function(e){"info"!=$(e).attr("id")&&$(e).find("i").toggleClass("zp_gclr")},courselistener:function(e){for(var t={},s=0;s<e.length;s++)t[e[s].coptionsid]=[e[s].type,"IC-tck"];lmscourses.menuCallBack(t,lmscourses.inputvalue)},close:function(){lmscourses.startIndex=0,$(".zp_Rpane").remove(),lmscourses.formComponents=null,lmscourses.courseFormComponents=null,lmscourses.filterObject={},lmscourses.filter.filterInstance&&lmscourses.filter.filterInstance.closeFilter(),ZPeople.FireScroll.setParam("triggered",!0),addCourseForm.destroyCourseInitFields(),lmsbase.closeMaskv5(),null!=lmscourses.elem&&lmsbase.addListener(lmscourses.elem,"scroll",lmscourses.scrollhandle,!1)},fetchMenu:function(){lmscourses.tabName.localeCompare("My Courses")?(lmscourses.getCourseGridDetails(" ",lmscourses.courselistener,"mycourses"),lmscourses.menuCallBack=this.updateOptionList,lmscourses.inputvalue=this.value):(lmscourses.getCourseGridDetails(" ",lmscourses.courselistener,"allCourses"),lmscourses.menuCallBack=this.updateOptionList,lmscourses.inputvalue=this.value)},fetchFavouriteCategorys:function(){zplms.get("/lms/settings/categories",null,(function(e){if(null!=e[1]){if(lmsbase.mask&&lmsbase.mask.classList.contains("zpl_mopen"))return;lmscourses.constructCategoriesPopUp(e[1])}}))},searchFavouriteCategorys:function(e,t){var s=[],r=e.value;if(""!=r)for(var l=0;l<t.length;++l){var a=t[l];a.categoryName.includes(r)&&s.push(a)}else s=t;var n="";$(".zp_slctinpt").html("");for(l=0;l<s.length;l++)className="",s[l].isFavourite&&(className="sel"),n+='<li class="'+className+'" _rel="'+s[l].categoryId+'">'+s[l].categoryName+"</li>";$(".zp_slctinpt").html(n)},constructCategoriesPopUp:function(e){let t=lmsbase.constructMaskv5("",!0);lmscourses.categoryListpopUp=t.appendChild(document.createElement("div")),lmscourses.categoryListpopUp.className="zpl_minr";let s="",r="";for(var l=0;l<e.length;l++)s="zpl_tg zpl_tgbrd zpl_tgchip ",e[l].isFavourite&&(s+="zpl_act"),r+=`<div class="${s}" _rel="${e[l].categoryId}">\n                        <span>${lmsFormConstants.getValue(e[l].categoryName)}</span>\n                      </div>`;lmscourses.categoryListpopUp.innerHTML=`<div class="zpl_mhder" id="phead">\n                                                    <div>\n                                                        <h4>${ZPI18N.getString("zp.lms.pickfavcategory")}</h4>\n                                                    </div>\n                                                    <a class="_cls PI_cls" _rel="categoryListClose" title="${ZPI18N.getString("zp.lms.close")}"></a>\n                                                </div>\n                                                <div class="zpl_mcnt">\n                                                    <div class="zpl_crd h100_per">\n                                                        <div class="zpl_crdcnt">\n                                                            <div class="zpl_secn">\n                                                                <div class="zpl_tglist zpl_trntg">\n                                                                    ${r}\n                                                                </div>\n                                                            </div> \n                                                        </div>\n                                                    </div>\n                                                </div>`,lmsbase.addListener(lmscourses.categoryListpopUp,"click",lmscourses.handleCategoryList,"false"),$("#searchcat").keyup((function(){lmscourses.searchFavouriteCategorys(this,e)}))},closeCategoryList:function(){lmsbase.removeListener(lmscourses.categoryListpopUp,"click",lmscourses.handleCategoryList,"false"),lmscourses.categoryListpopUp.remove()},handleCategoryList:function(e){var t=e.target,s=t.getAttribute("_rel");s&&"categoryListClose"==s?lmsbase.closeMaskv5():(t=e.target.closest(".zpl_tg"))&&(t.classList.contains("zpl_act")?lmscourses.updateCategory(t.children[0].textContent,t.getAttribute("_rel"),t,1):lmscourses.updateCategory(t.children[0].textContent,t.getAttribute("_rel"),t,0))},updateCategory:function(e,t,s,r){var l={textContent:e};zplms.patch("/lms/categories/"+t+"/favourite",l,(function(e){null!=e[1]&&(0==e[1]?($(s).removeClass("zpl_act"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.sucRemovedfromFav"))):($(s).addClass("zpl_act"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.sucaddToFav"))))}))},isSelected:function(){return""!=window.getSelection().toString()},filterobject:function(e){_params={},e.searchStr&&e.searchStr.length>0&&(_params.title=e.searchStr),e.courseFilter&&(_params.courseFilter=e.courseFilter[0]),e.completestatus&&(_params.completestatus=e.completestatus[0]),e.coursetype&&(_params.coursetype=e.coursetype[0]),lmscourses.getCourseGridDetails(_params)},getSkills:function(){var e="";if(""!=lmscourses.currentCourseId&&null!=lmscourses.currentCourseId&&null!=lmscourses.currentCourseId&&(e=lmscourses.currentCourseId),null==lmscourses.skillData){var t={method:"getSkillsList",courseId:e,conreqcsr:csrfToken};$.post("/courseAction.zp",t,(function(e){null!=e[1]&&(lmscourses.skillData=e[1])}))}},getComponentsTab:function(){if(null==lmscourses.componentTabs){var e={method:"getComponentTabs",conreqcsr:csrfToken};$.post("/courseAction.zp",e,(function(e){null!=e[1]&&(lmscourses.componentTabs=e[1])}))}}};lmscourses.shareCourse={isShare:!0,suggestFrnd:[],selectedUsers:{},showAddUserShareOrSuggest:function(e,t,s){"suggest"==t?lmscourses.shareCourse.isShare=!1:"share"==t&&(lmscourses.shareCourse.isShare=!0,s&&s>0&&(lmscourses.shareBatchId=s)),lmscourses.shareCourseId=e,lmscourses.shareMode="1",lmscourses.shareCourse.shareCourse(t)},constructShareCoursePopUp_v5:function(e,t,s){s&&s>0&&(lmscourses.shareBatchId=s),lmscourses.shareCourseId=e,lmscourses.shareMode="1";let r=lmsbase.constructMaskv5("zpl_mcenter",!0);lmscourses.shareCourse.shareCoursePopUp=r.appendChild(document.createElement("div")),lmscourses.shareCourse.shareCoursePopUp.className="zpl_minr",lmscourses.shareCourse.shareCoursePopUp.innerHTML=`<div class="zpl_mhder">\n                                                                <div><h4>${ZPI18N.getString("zp.lms.shareto")}</h4></div>\n                                                                <a class="_cls PI_cls" _rel="close"></a>\n                                                              </div>\n                                                              <div class="zpl_mcnt zpl_fm">\n                                                                <form>\n                                                                    <div class="zpl_crd">\n                                                                        <div class="zpl_crdcnt">\n                                                                            <div class="zpl_secn">\n                                                                            </div>\n                                                                            <div class="zpl_secn" id="sharedCourseMemb">\n                                                                            </div>\n                                                                        </div>\n                                                                    </div>\n                                                                </form>\n                                                              </div>\n                                                              <div class="zpl_mfoter">\n                                                                <button class="zlabel zlabel--blue zlabel--medium" type="button">${ZPI18N.getString("zp.lms.share")}</button>\n                                                              </div>`,lmsbase.addListener(lmscourses.shareCourse.shareCoursePopUp,"click",lmscourses.shareCourse.clickActionPopup,!1);let l={method:"getSharedCourseMembers",courseId:lmscourses.shareCourseId,conreqcsr:csrfToken};$.post("/courseAction.zp",l,(function(e){if(null!=e[1]&&null!=e[1].userIds){let t=`<div>\n                                <div class="zpl_tblres">\n                                    <table class="zpl_tbl wd100_per" >\n                                        <thead>\n                                            <tr>\n                                                <th>${ZPI18N.getString("zp.lms.course.sharedusers")}</th><th width="100"><div class="text-center"></div></th>\n                                            </tr>\n                                        </thead>\n                                        <tbody id="sharedCourseMembCont"></tbody>\n                                    </table>\n                                </div>\n                            </div>`;$("#sharedCourseMemb").append(t),lmscourses.shareCourse.sharedMembersView(e)}}))},shareCourse:function(e){var t="";"suggest"==e?(t=ZPI18N.getString("zp.lms.suggestAfriend"),button='<button class="zpthm" _rel="add">'+ZPI18N.getString("zp.lms.suggest")+"</button>"):(t=ZPI18N.getString("zp.lms.shareto"),button='<button class="zpthm" _rel="add">'+ZPI18N.getString("zp.lms.share")+"</button>"),lmscourses.popup=lmsbase.showMaskLayer();var s='<div class="zp_popup" style="width:600px;"><div class="zp_Pohd"><font>'+t+'</font><i class="IC-cls" _rel="close"></i></div><div class="zp_Pocnt" style="max-height:700px;"><div _rel="shareMenu" >'+lmsformcomponents.htmlField({formComponentId:"sharedToIds",fieldType:25,emptyText:ZPI18N.getString("zp.select")})+'</div></div><div class="zp_btn">'+button+"</div></div>";lmscourses.popup.innerHTML=s,lmsbase.addListener(lmscourses.popup,"click",lmscourses.shareCourse.clickActionPopup,!1);var r=lmscourses.popup.querySelector('[_rel="shareMenu"]');if(lmscourses.menuRef=lmsgroupmenu.initiate(r),lmscourses.menuRef.insertMenu({elem:r.querySelector(".zp_Sm"),type:"select",mode:"multi",allow_new:!1,menutype:2,menulist:lmscourses.shareCourse.fetchUsers}),"suggest"!=e){var l={method:"getSharedCourseMembers",courseId:lmscourses.shareCourseId,conreqcsr:csrfToken};$.post("/courseAction.zp",l,(function(e){if(null!=e[1]&&null!=e[1].userIds){$("#getCourseOverView1_"+lmscourses.shareCourseId).find(".IC-share").addClass("zp_shrd");var t='<div class="zp_Pttl">'+ZPI18N.getString("zp.lms.course.sharedusers")+'</div><ul class="zp_CPlst" id="sharewth">';t+="</ul>",$(".zp_Pocnt").append(t),lmscourses.shareCourse.sharedMembersView(e)}}))}},sharedMembersView:function(e){$.each(e[1].userIds,(function(e,t){$.each(t,(function(e,t){let s=`<tr id="shareTo_${t.userId}">\n                                <td>\n                                    <div class="zpl_em">\n                                        <div class="zpl_emimg">\n                                            <img src="${t.photoPath}">\n                                        </div>\n                                        <div class="zpl_emdts">\n                                            <div><b>${t.name}</b></div>\n                                        </div>\n                                    </div>\n                                </td>\n                                <td>\n                                    <div class="text-center"><div class="zpl_hvr" onclick="lmscourses.shareCourse.removedSharedCourseMembers('${t.userId}')"><i class="PI_delete"></i></div></div>\n                                </td>\n                            </tr>`;$("#sharedCourseMembCont").append(s)}))}))},removedSharedCourseMembers:function(e){var t={method:"removeSharedCourseMembers",courseId:lmscourses.shareCourseId,shareTo:e,conreqcsr:csrfToken};$.post("/courseAction.zp",t,(function(t){$("#sharedCourseMembCont").find("#shareTo_"+e).remove()}))},clickActionPopup:function(e){var t=e.target.getAttribute("_rel");"add"==t?lmscourses.shareCourse.getSelectedCourses():"close"==t&&lmsbase.closeMaskv5()},popupClose:function(){$(".zp_popup").hide(),$(".zp_msk").hide()},fetchUsers:function(){lmscourses.shareCourse.menuCallBack=this,null!=this.value?lmscourses.shareCourse.getSearchUsers(lmscourses.shareCourse.menuAction,this.value):lmscourses.shareCourse.getUsers(lmscourses.shareCourse.menuAction)},getUsers:function(e){var t={courseId:lmscourses.shareCourseId,start:0};zplms.get("/lms/users",t,e)},getSearchUsers:function(e,t){var s={courseId:lmscourses.shareCourseId,searchtxt:t};zplms.get("/lms/users",s,e)},menuAction:function(e){if(null!=e[1])var t=e[1];else t=[];lmscourses.shareCourse.menuCallBack.updateOptionList(function(e,t,s){for(var r={},l=[],a=0;a<e.length;a++)(l=[]).push(e[a][s].empId,e[a][s].empname,""),r[e[a][t]]=l;return r}(t,"Id","Value"),lmscourses.shareCourse.menuCallBack.inputvalue),lmscourses.shareCourse.menuCallBack=null},getSelectedCourses:function(){var e=lmscourses.popup.querySelectorAll("[_name=sharedToIds] [data-value]");if(e.length){var t,s=[];for(lmscourses.shareCourse.selectedUsers={},lmscourses.shareCourse.suggestFrnd=[],t=e.length-1;t>=0;t--)lmscourses.shareCourse.selectedUsers={},lmscourses.shareCourse.isShare?s[t]=e[t].getAttribute("data-value"):(lmscourses.shareCourse.selectedUsers.userId=e[t].getAttribute("data-value"),lmscourses.shareCourse.suggestFrnd.push(lmscourses.shareCourse.selectedUsers));lmscourses.shareCourse.isShare?lmscourses.shareCourse.updateShareCourse(s):lmscourses.shareCourse.updateFriendSuggest(s)}else $("[_rel='shareMenu']").find(".etxt").text(ZPI18N.getString("zp.lms.selectShare"))},updateFriendSuggest:function(e){var t=JSON.stringify(lmscourses.shareCourse.suggestFrnd),s={method:"updateUserSuggestCourse",suggestCourseId:lmscourses.currentCourseId,usersIds:t,mode:"multiple",enrollType:0,conreqcsr:csrfToken};$.post("/courseUsersAction.zp",s,(function(e){"Sucess"==e[1].message?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.suggestSent")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.requestFailed")),lmscourses.shareCourse.popupClose()}))},updateShareCourse:function(e){var t={method:"shareCourse",courseId:lmscourses.shareCourseId,batchId:lmscourses.shareBatchId,shareTo:e.toString(),shareType:lmscourses.shareMode,conreqcsr:csrfToken};$.post("/courseAction.zp",t,(function(e){"Course share is not allowed"==e[1].message?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.coursesharenotallow")):null!=e[1].message&&ZPeople.Message.showSuccessMsg(e[1].message),lmscourses.shareCourse.popupClose()}))}},lmscourses.filter={ematerialType:"",isFilterAvailable:!1,isFilterApplied:!1,appliedFilter:{},allcourseBind:function(e){lmscourses.filter.getOptions(this,e,"sortbyall","sortby_all"),lmscourses.filter.getOptions(this,e,"catall","sortby_all"),lmscourses.filter.getOptions(this,e,"trainerall","sortby_all"),lmscourses.filter.getOptions(this,e,"dateRangeFilter","date_all"),lmscourses.filter.getOptions(this,e,"typeall","sortby_all"),(isadmin||lms.settingData[0].settingPermission.isDataAdmin)&&lmscourses.filter.getOptions(this,e,"stateall","sortby_all")},getFilterInstance:function(){lmscourses.filter.filterInstance=lmsfilterutil.getFilterInstance(lmscourses.filter.getFilterObject()),lmscourses.filter.filterInstance.setFilterCallbacks({callback:lmscourses.filter.filterSearch},{callback:lmscourses.filter.resetFilter},{callback:lmscourses.filter.filterSearch})},getFilterObject:function(){let e=[];return"My Courses"==lmscourses.tabName?(e.push(lmscourses.filter.getTypeFilterObject()),e.push(lmscourses.filter.getSortByFilterObject()),(isadmin||lms.settingData[0].settingPermission.isDataAdmin||1==lms.role&&(lms.selfSettingData.isTrainerCanAdd||lms.iltSettingData.isTrainerCanAdd))&&e.push(lmscourses.filter.getStateFilterObject(lmscourses.tabName))):"Course Catalog"==lmscourses.tabName&&(e.push(lmscourses.filter.getSortByFilterObject()),e.push(lmscourses.filter.getCategoriesFilterObject()),e.push(lmscourses.filter.getTrainerFilterObject()),(isadmin||lms.settingData[0].settingPermission.isDataAdmin)&&e.push(lmscourses.filter.getStateFilterObject(lmscourses.tabName)),e.push(lmscourses.filter.getCourseFromDateFilterObject()),e.push(lmscourses.filter.getCourseToDateFilterObject())),e},getTypeFilterObject:function(){let e=[];if("My Courses"==lmscourses.tabName)return e.push({value:"1",label:ZPI18N.getString("zp.lms.sharedtome")}),null!=lms.typeData&&null!=lms.typeData&&$.each(lms.typeData,(function(t,s){let r={};r.value=s.typeId,r.label=lmsFormConstants.getValue(s.typeName),"3"==s.typeSysVal?lmscourses.filter.ematerialType=s.typeId:lmscourses.filter.ematerialType="",e.push(r)})),{type:"select",label:ZPI18N.getString("zp.type"),id:"typeFil",options:{options:e,placeholder:ZPI18N.getString("zp.select"),change:lmscourses.filter.handleTypeChange,dropdownList:{fitForElement:!0}}}},getSortByFilterObject:function(){let e=[{value:"1",label:ZPI18N.getString("zp.lms.AtoZ")},{value:"2",label:ZPI18N.getString("zp.lms.ZtoA")}];return{type:"select",label:ZPI18N.getString("zp.sortby"),id:"sortByFil",options:{options:e,placeholder:ZPI18N.getString("zp.select"),dropdownList:{fitForElement:!0}}}},getStateFilterObject:function(e){let t=[];return(isadmin||lms.settingData[0].settingPermission.isDataAdmin||1==lms.role&&(lms.selfSettingData.isTrainerCanAdd||lms.iltSettingData.isTrainerCanAdd))&&(t.push({value:"1",label:ZPI18N.getString("zp.drafted")}),t.push({value:"2",label:ZPI18N.getString("zp.lms.course.published")}),t.push({value:"3",label:ZPI18N.getString("zp.lms.disabled")})),{type:"select",label:ZPI18N.getString("zp.state"),id:"stateFil",options:{options:t,placeholder:"My Courses"==e?ZPI18N.getString("zp.all"):ZPI18N.getString("zp.lms.course.published"),dropdownList:{fitForElement:!0}}}},getCategoriesFilterObject:function(){let e=[];return null!=lms.favCategoryData&&null!=lms.favCategoryData&&lms.favCategoryData.length>0?($.each(lms.favCategoryData,(function(t,s){let r={};1==s.isFavourite&&(lmscourses.isUserhavingfavCat=s.isFavourite),r.value=s.categoryId,r.label=ZPeople.decodeTxt(s.categoryName),e.push(r)})),e.splice(0,0,{value:"2",label:ZPI18N.getString("zp.lms.allcategories")})):e=[{value:"0",label:ZPI18N.getString("zp.lms.allcategories")}],{type:"select",label:ZPI18N.getString("zp.categories"),encodeHTML:!0,id:"catFil",options:{options:e,placeholder:ZPI18N.getString("zp.lms.allcategories"),dropdownList:{fitForElement:!0},showSearchField:!0}}},getTrainerFilterObject:function(){let e=[];return null!=lms.allTrainerData&&null!=lms.allTrainerData&&lms.allTrainerData.length>0&&$.each(lms.allTrainerData,(function(t,s){let r={};r.label=s.trainerEmployeeId+" - "+ZPeople.decodeTxt(s.trainerName),r.value=s.trainerempId,e.push(r)})),{type:"select",label:ZPI18N.getString("zp.lms.base.Trainers"),id:"trainerFil",encodeHTML:!0,options:{options:e,placeholder:ZPI18N.getString("zp.select"),search:{showNoResultsMessage:ZPI18N.getString("zp.lms.trainers.noTrainersfound")},dropdownList:{fitForElement:!0},showSearchField:!0}}},getCourseFromDateFilterObject:function(){return{type:"datefield",label:ZPI18N.getString("zp.fromdate"),id:"courseFromDate",validation:"dateFrom"}},getCourseToDateFilterObject:function(){return{type:"datefield",label:ZPI18N.getString("zp.todate"),id:"courseToDate",validation:"dateTo"}},handleTypeChange:function(e){lmscourses.filter.filterInstance.showAllFilters(),""!=e.detail.value&&(e.detail.value==lmscourses.filter.ematerialType?lmscourses.filter.filterInstance.hideFilter("stateFil"):2==e.detail.value&&lmscourses.filter.filterInstance.hideAllFilters(["typeFil","stateFil"]))},courseFilter:function(e){$("#courseFilter").remove(),$("#mylensearch").remove(),$("#courseSearchBox").remove();let t=`<i class="zpl_ibg PI_lens" id="mylensearch" title="${ZPI18N.getString("zp.search")}" aria-label="${ZPI18N.getString("zp.lens")}" role="button" aria-haspopup="dialog" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}"></i>\n        \t\t\t<i class="zpl_ibg PI_fltr" id="courseFilter" title="${ZPI18N.getString("zp.filter")}" aria-label="${ZPI18N.getString("zp.filter")}" role="button" aria-haspopup="dialog" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}"></i>`;$("#headerpositioncourse .zpl_rgt").append(t);let s=`<div class="search-cmn" id="courseSearchBox">\n                            <i class="PI_lens"></i>\n                            <input required="" type="text" class="ztextbox" placeholder="${ZPI18N.getString("zp.search")}" id="searchnamemy" onkeyup="lmscourses.filter.searchCourse(this,event)">\n                            <i class="PI_cls" id="closeSearch" title="${ZPI18N.getString("zp.lms.close")}"></i>\n                        </div>`;$("#headerpositioncourse").append(s);let r=function(e){27==e.keyCode&&(lmscourses.filter.closeSearch(),lmsbase.removeListener(document,"keyup",r))};$("#mylensearch").click((function(){lmscourses.isSearched=!1,$("#searchnamemy").val(""),$("#courseSearchBox").addClass("opn"),$("#searchnamemy").focus(),lmsbase.addListener(document,"keyup",r)})),$("#closeSearch").click((function(){lmscourses.filter.closeSearch(),lmsbase.removeListener(document,"keyup",r)})),$("#courseFilter").click((function(){lmscourses.filter.filterInstance.constructFilter()}))},closeSearch:function(){$("#courseSearchBox").removeClass("opn"),lmscourses.startIndex=0;let e=lmscourses.filterObject?lmscourses.filterObject.courseName:"";lmscourses.filterObject={},lmscourses.isSearched&&""!=e&&(lmscourses.filter.clearAppliedFilters(),$(lmscourses._relem).find("#courseList").html(""),lmscourses.getCourseGridDetails()),lmscourses.filterObject.courseName&&(lmscourses.filterObject.courseName=null)},getFilters:function(e){let t=[];return 0!=e&&1!=e||(t.push(lmscourses.filter.getTypeFilter(e)),t.push(lmscourses.filter.getSortByFilter()),0==e||(t.push(lmscourses.filter.getCategoriesFilter()),t.push(lmscourses.filter.getTrainerFilter())),(isadmin||lms.settingData[0].settingPermission.isDataAdmin||1==lms.role&&(lms.selfSettingData.isTrainerCanAdd||lms.iltSettingData.isTrainerCanAdd))&&t.push(lmscourses.filter.getStateFilter())),t},getTypeFilter:function(e){let t=[];0==e?(t.push({value:"1",text:[ZPI18N.getString("zp.lms.sharedtome")]}),t.push({value:"2",text:[ZPI18N.getString("zp.lms.learningplan")]}),null!=lms.typeData&&null!=lms.typeData&&$.each(lms.typeData,(function(e,s){let r={};r.value=s.typeId,r.text=[ZPI18N.getString(s.typeName)],"3"==s.typeSysVal?lmscourses.filter.ematerialType=s.typeId:lmscourses.filter.ematerialType="",t.push(r)}))):t=[{value:"1",text:[ZPI18N.getString("zp.lms.feedback.courses")]},{value:"2",text:[ZPI18N.getString("zp.lms.learningplan")]}];let s=lmscourses.filter.appliedFilter.typeFil?lmscourses.filter.appliedFilter.typeFil.value:"";return{type:0,attrObj:{id:"typeFil"},options:t,selectType:"single",events:[{event:"change",callback:lmscourses.filter.handleFilterChange}],defaultVal:s,label:ZPI18N.getString("zp.type")}},getSortByFilter:function(){return{type:0,attrObj:{id:"sortByFil"},options:[{value:"1",text:[ZPI18N.getString("zp.lms.AtoZ")]},{value:"2",text:[ZPI18N.getString("zp.lms.ZtoA")]}],selectType:"single",defaultVal:lmscourses.filter.appliedFilter.sortByFil?lmscourses.filter.appliedFilter.sortByFil.value:"",label:ZPI18N.getString("zp.lms.sortby")}},getStateFilter:function(){let e=[{value:"1",text:[ZPI18N.getString("zp.drafted")]},{value:"2",text:[ZPI18N.getString("zp.lms.course.published")]},{value:"3",text:[ZPI18N.getString("zp.lms.disabled")]}],t=lmscourses.filter.appliedFilter.stateFil?lmscourses.filter.appliedFilter.stateFil.value:"";return{type:0,attrObj:{id:"stateFil"},options:e,selectType:"single",label:ZPI18N.getString("zp.state"),defaultVal:t,placeholder:ZPI18N.getString("zp.lms.course.published")}},getCategoriesFilter:function(){let e=[];null!=lms.favCategoryData&&null!=lms.favCategoryData&&lms.favCategoryData.length>0?($.each(lms.favCategoryData,(function(t,s){let r={};1==s.isFavourite&&(lmscourses.isUserhavingfavCat=s.isFavourite),r.value=s.categoryId,r.text=[lmsFormConstants.getValue(s.categoryName)],e.push(r)})),lmscourses.isUserhavingfavCat&&e.splice(0,0,{value:"1",text:[ZPI18N.getString("zp.lms.favourites")]}),e.splice(1,0,{value:"2",text:[ZPI18N.getString("zp.lms.allcategories")]})):e=[{value:"0",text:[ZPI18N.getString("zp.lms.allcategories")]}];let t=lmscourses.filter.appliedFilter.catFil?lmscourses.filter.appliedFilter.catFil.value:"";return{type:0,attrObj:{id:"catFil"},options:e,selectType:"single",label:ZPI18N.getString("zp.categories"),defaultVal:t,placeholder:ZPI18N.getString("zp.lms.allcategories")}},getTrainerFilter:function(){let e=[];null!=lms.allTrainerData&&null!=lms.allTrainerData&&lms.allTrainerData.length>0&&$.each(lms.allTrainerData,(function(t,s){let r={};r.text=[s.trainerEmployeeId+" - "+ZPeople.decodeTxt(s.trainerName)],r.value=s.trainerempId,e.push(r)}));let t=lmscourses.filter.appliedFilter.trainerFil?lmscourses.filter.appliedFilter.trainerFil.value:"";return{type:0,attrObj:{id:"trainerFil"},options:e,selectType:"single",label:ZPI18N.getString("zp.lms.base.Trainers"),defaultVal:t,emptyVal:ZPI18N.getString("zp.lms.trainers.noTrainersfound")}},toggleFilter:function(e){e||(Layout.Page.parentContainer.hasClass("zpl_fltr_flt")?(Layout.Page.parentContainer.removeClass("zpl_fltr_flt"),lmsbase.removeListener(document,"keyup",lmscourses.filter.hideFilterOnKeyup),lmscourses.filter.isFilterAvailable=!1):(Layout.Page.parentContainer.addClass("zpl_fltr_flt"),lmsbase.addListener(document,"keyup",lmscourses.filter.hideFilterOnKeyup),lmscourses.filter.isFilterAvailable=!0))},hideFilterOnKeyup:function(e){27==e.keyCode&&(lmscourses.filter.toggleFilter(),lmsbase.removeListener(document,"keyup",lmscourses.filter.hideFilterOnKeyup))},handleFilterChange:function(e){let t=e.target.value;lmscourses.filter.showFilters(document.querySelector("#filterBox")),t==lmscourses.filter.ematerialType?lmscourses.filter.hideFilters(["stateFil"]):2==t&&lmscourses.filter.hideFilters(["all"],["typeFil"])},hideFilters:function(e,t){e&&("all"==e[0]?$.each($(".zpl_fltrlst").find("select"),(function(e,s){t.includes(s.getAttribute("id"))||($(s.closest(".zpl_secn")).hide(),$(s).attr("hidden",!0))})):$.each(e,(function(e,t){$("#"+t).closest(".zpl_secn").hide(),$("#"+t).attr("hidden",!0)})))},showFilters:function(e){$.each($(e).find('[menu="menu-lms-select2"]'),(function(e,t){$(t.closest(".zpl_secn")).show(),$(t).attr("hidden",!1)}))},setAttributes:function(e,t){for(let s in t)e.setAttribute(s,t[s])},getElementByAttributes:function(e,t){let s=[],r="",l=[];for(let t in e)if(e.hasOwnProperty(t)){for(r="["+t+'*="',l=e[t].split(" "),i=0;i<l.length;i++)r+=l[i],i!=l.length-1&&(r+=" ");r+='"]',s.push(r)}let a=s.join("");return t?t.querySelector(a):document.querySelector(a)},filterSearch:function(e){$("#courseList").html("");var t=lmscourses._relem.querySelector("#zp_page_loading");t&&t.remove();let s="";lmscourses.startIndex=0,lmscourses.filterObject={};let r="";r="My Courses"==lmscourses.tabName?"MyCourses":lmscourses.tabName;let l=0!=Object.keys(e)?e.appliedFilters:{};var a="",n="",i="",o="",c="",d="",m="";if(l.hasOwnProperty("courseFromDate")&&l.courseFromDate.selectedvalues[0]&&l.hasOwnProperty("courseToDate")&&l.courseToDate.selectedvalues[0]){function u(e){function t(e){if(isNaN(e))return e;return{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"}[Number(e)]}let s=e.split(/[-./]/);return dateFmt.startsWith("y")?e=s[2]+"-"+t(s[1])+"-"+s[0]:dateFmt.startsWith("m")?e=s[1]+"-"+t(s[0])+"-"+s[2]:dateFmt.startsWith("d")&&(e=s[0]+"-"+t(s[1])+"-"+s[2]),e}a=new Date(u(l.courseFromDate.selectedvalues[0].value)).getTime(),n=new Date(u(l.courseToDate.selectedvalues[0].value)).setHours(23,59,59,999),lmscourses.filterObject.sDate=a,lmscourses.filterObject.eDate=n,s="dateRangeFilter"}if(l.hasOwnProperty("typeFil")&&l.typeFil.selectedvalues[0]&&(c=l.typeFil.selectedvalues[0].value,lmscourses.filterObject.sType=c,s="MyCourses"==r?"typemy":"typeall"),l.hasOwnProperty("sortByFil")&&l.sortByFil.selectedvalues[0]&&(m=1==(m=l.sortByFil.selectedvalues[0].value)?0:1,lmscourses.filterObject.sortCourse=m,s="MyCourses"==r?"sortbymy":"sortbyall"),l.hasOwnProperty("stateFil")&&l.stateFil.selectedvalues[0]&&(d=l.stateFil.selectedvalues[0].value,lmscourses.filterObject.sState=d,s="stateall"),l.hasOwnProperty("catFil")&&l.catFil.selectedvalues[0]&&(i=l.catFil.selectedvalues[0].value,lmscourses.filterObject.sCategory=i,s="catall"),l.hasOwnProperty("trainerFil")&&l.trainerFil.selectedvalues[0]&&(o=l.trainerFil.selectedvalues[0].value,lmscourses.filterObject.sTrainer=o,s="trainerall"),""!=c&&(s="MyCourses"==r?"typemy":"typeall"),""==s)return lmscourses.filter.filterInstance.clearBreadCrumbs(),void lmscourses.getCourseGridDetails();$(lmscourses._relem).append(ZPeople.LOADING_HTML);let p={method:"getCourseDetails",courseFor:r,modeOfView:"basicGrid",searchbyCat:i,searchbyTrainer:o,searchbyState:d,searchbyType:c,searchbyProgress:"",startDateFilter:lmscourses.filterObject.sDate,endDateFilter:lmscourses.filterObject.eDate,sortCourse:m,filterBy:s,start:0,conreqcsr:csrfToken};lmscourses.filterObject.filterBy=s,$.post("/courseAction.zp",p,(function(e){if(e[1]&&e[1][0].courseInfo.length)document.querySelector('[id="courseList"]').classList.add("zpl_crdgrid"),lmscourses.courseCardView(e[1],0==lmscourses.startIndex?"new":"update");else{if(0==lmscourses.startIndex){document.querySelector('[id="courseList"]').classList.remove("zpl_crdgrid");var t=lmscourses._relem.querySelector("#zp_page_loading");t&&t.remove();let e=lmsnodata.noDatav5[lmscourses.tabName].onFilter;lmscourses.showNoData(e,lmscourses._relem.querySelector("[_rel='courseList']"))}lmscourses.startIndex="end"}}))},resetFilter:function(){lmscourses.startIndex=0,lmscourses.filterObject={},$(lmscourses._relem).find("#courseList").html(""),lmscourses.getCourseGridDetails()},constructAppliedFilter:function(e,t,s,r,l){$("#lmsApplFil").remove();let a=document.createElement("div");a.className="zpl_fltrvw",a.id="lmsApplFil";let n=document.createElement("div"),i=document.createElement("ul");i.className="zpl_fltrvwlst",i.setAttribute("aria-label",ZPI18N.getString("zp.filter.applied")),i.setAttribute("tabindex",lmsConstants.TAB_INDEX.ACTIVE),i.setAttribute("role","tablist"),n.appendChild(i),$.each(t,(function(e,r){let a="";a=`<li _rel='${r.value}' fil='${e}' role="tab" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}">`,a+="<label>"+r.label+(r.value&&""!=r.value?" :":"")+"</label>",r.value&&""!=r.value&&(a+=1==l?"<span>"+$("#"+e).find("[value="+r.value+"]").text()+"</span>":"<span>"+r.value+"</span>"),a+='<a class="PI_cls" _rel="closeFilter_'+e+'"></a>',a+="</li>",$(i).append(a),lmsbase.addListener($(i).find("[_rel='closeFilter_"+e+"']")[0],"click",(function(){lmscourses.filter.closeFilters(e,s,t)}),!1)})),$(a).append(n);let o=`<div class="d-flexcap MLauto">\n                        <a class="red" _rel="resetFilter">${ZPI18N.getString("zp.reset")}</a>\n                      </div>`;$(a).append(o),lmsbase.addListener($(a).find("[_rel='resetFilter']")[0],"click",(function(){lmscourses.filter.resetAppliedFilters(r,t)}),!1),$(a).insertAfter($(e))},closeFilters:function(e,t,s){e&&($("[fil='"+e+"']").remove(),s&&delete s[e],$("#lmsApplFil ul").children().length||$("#lmsApplFil").remove(),$("select#"+e)[0]&&$("select#"+e)[0].setAttribute("selected",!1),t&&(t.params?(t.params.pop(),t.params.push(e)):t.params=[e]),t&&t.callback(...t.params))},resetAppliedFilters:function(e,t){lmscourses.filter.clearAppliedFilters(t),e&&(e.params=e.params||[]),e&&e.callback(...e.params)},clearAppliedFilters:function(e){$("#lmsApplFil").remove(),$.each(e,(function(t){delete e[t]}))},mycourseBind:function(e){lmscourses.menuObj=lmsgroupmenu.initiate(document.getElementById("mycoursefilter")),lmscourses.filter.getOptions(this,e,"sortbymy"),lmscourses.filter.getOptions(this,e,"typemy"),(isadmin||lms.settingData[0].settingPermission.isDataAdmin||1==lms.role&&(lms.selfSettingData.isTrainerCanAdd||lms.iltSettingData.isTrainerCanAdd))&&lmscourses.filter.getOptions(this,e,"stateall","sortby_all")},getOptions:function(e,t,s,r){var l=ZPI18N.getString("zp.lms.sortby");if("sortbyall"==s&&(l=ZPI18N.getString("zp.lms.recentlycreate")),"sortbyall"==s||"sortbymy"==s){var a={};(o=[]).push(ZPI18N.getString("zp.lms.AtoZ")),a[1]=o,(c=[]).push(ZPI18N.getString("zp.lms.ZtoA")),a[2]=c;var n=document.getElementById(s);lmscourses.filter.createMenu(a,n,r,l)}if("catall"==s)if(a={},null!=lms.favCategoryData&&null!=lms.favCategoryData&&lms.favCategoryData.length>0){n="";var i=[];$.each(lms.favCategoryData,(function(e,t){i=[],n=document.getElementById(s),1==t.isFavourite&&(lmscourses.isUserhavingfavCat=t.isFavourite),i.push(lmsFormConstants.getValue(t.categoryName)),a[t.categoryId]=i})),lmscourses.isUserhavingfavCat&&((o=[]).push(ZPI18N.getString("zp.lms.favourites")),a[1]=o),(c=[]).push(ZPI18N.getString("zp.lms.allcategories")),a[2]=c,lmscourses.filter.createMenu(a,n,r,ZPI18N.getString("zp.lms.allcategories"))}else{a={},(i=[]).push(ZPI18N.getString(ZPI18N.getString("zp.lms.allcategories"))),a[1]=i;n=document.getElementById(s);lmscourses.filter.createMenu(a,n,r,ZPI18N.getString("zp.lms.allcategories"))}if("trainerall"==s){a={};n=document.getElementById(s);null!=lms.allTrainerData&&null!=lms.allTrainerData&&lms.allTrainerData.length>0&&$.each(lms.allTrainerData,(function(e,t){var r=[];r.push(t.trainerEmployeeId,t.trainerName,""),a[t.trainerempId]=r,n=document.getElementById(s)})),lmscourses.filter.createMenu(a,n,r,ZPI18N.getString("zp.lms.base.Trainers"),2,ZPI18N.getString("zp.lms.trainers.noTrainersfound"))}if("dateRangeFilter"==s){n=document.getElementById(s);lmscourses.filter.createDateMenu(a,n,r,"Date")}if("typeall"==s){a={},(c=[]).push(ZPI18N.getString("zp.lms.feedback.courses")),a[1]=c,(i=[]).push(ZPI18N.getString("zp.lms.learningplan")),a[2]=i;n=document.getElementById(s);lmscourses.filter.createMenu(a,n,r,ZPI18N.getString("zp.lms.type"))}if((isadmin||lms.settingData[0].settingPermission.isDataAdmin||1==lms.role&&(lms.selfSettingData.isTrainerCanAdd||lms.iltSettingData.isTrainerCanAdd))&&"stateall"==s){var o,c;a={};(o=[]).push(ZPI18N.getString("zp.drafted")),a[1]=o,(c=[]).push(ZPI18N.getString("zp.lms.course.published")),a[2]=c,(i=[]).push(ZPI18N.getString("zp.lms.disabled")),a[3]=i;n=document.getElementById(s);lmscourses.filter.createMenu(a,n,r,ZPI18N.getString("zp.lms.course.published"))}if("typemy"==s){a={};null!=lms.typeData&&null!=lms.typeData&&$.each(lms.typeData,(function(e,t){var s=[];s.push(ZPI18N.getString(t.typeName)),"3"==t.typeSysVal?lmscourses.filter.ematerialType=t.typeId:lmscourses.filter.ematerialType="",a[t.typeId]=s})),(i=[]).push(ZPI18N.getString("zp.lms.sharedtome")),a[1]=i;var d=[];d.push(ZPI18N.getString("zp.lms.learningplan")),a[2]=d;n=document.getElementById(s);lmscourses.filter.createMenu(a,n,r,ZPI18N.getString("zp.lms.type"))}},searchCourse:function(e){var t=$(e).val();if(13===event.keyCode){if(""==t&&(!lmscourses.hasOwnProperty("filterObject")||0==Object.keys(lmscourses.filterObject).length||lmscourses.filterObject.hasOwnProperty("courseName")&&""==lmscourses.filterObject.courseName)||lmscourses.hasOwnProperty("filterObject")&&lmscourses.filterObject.hasOwnProperty("courseName")&&t==lmscourses.filterObject.courseName)return;lmscourses.startIndex=0,lmscourses.filterObject={},lmscourses.filterObject.courseName=t,lmscourses.filter.filterInstance.clearBreadCrumbs(),$(lmscourses._relem).find("#courseList").html(""),lmscourses.getCourseGridDetails("","","2","","nameSearch"),lmscourses.isSearched=!0}},sortBycourse:function(e){var t=[];if(null===lmscourses.allcourseData||0===lmscourses.allcourseData.length)return!1;for(var s=0;s<lmscourses.allcourseData.length;s++)t.push(lmscourses.allcourseData[s].courseName);for(s=0;s<t.length;s++)t[s]=t[s].toUpperCase();1==e?t.sort((function(e,t){return e<t?-1:e>t?1:0})):t.sort((function(e,t){return e>t?-1:e<t?1:0})),result=[];for(s=0;s<t.length;s++)for(var r,l=0;l<lmscourses.allcourseData.length;l++)if(r={},lmscourses.allcourseData[l].courseName.toUpperCase()===t[s]){r=lmscourses.allcourseData[l],result.push(r);break}lmscourses.courseCardView(result,0==lmscourses.startIndex?"new":"update")},createMenu:function(e,t,s,r){lmscourses.menuObj.insertMenu({elem:t,type:"select",mode:"single",menulist:e,click:lmscourses.filter.filterSearch}),lmsmenu.changeToSelectMenu(t,{},"single",null,r)},createMenu:function(e,t,s,r,l,a){lmscourses.menuObj.insertMenu({elem:t,type:"select",mode:"single",menutype:l,menulist:e,click:lmscourses.filter.filterSearch,emptystring:a||ZPI18N.getString("zp.lms.nodatafound")}),lmsmenu.changeToSelectMenu(t,{},"single",null,r)},createDateMenu:function(e,t,s,r){function l(e,t){if("week"==e){var s=(l=new Date).getDate()-l.getDay(),r=new Date(l.setDate(s)),l=new Date;return(a=new Date(l.setDate(s))).setDate(a.getDate()+7),r.getDateBy(t)+" - "+a.getDateBy(t)}if("month"==e){l=new Date,r=new Date(l.getFullYear(),l.getMonth());var a=new Date(l.getFullYear(),l.getMonth()+1,0);return r.getDateBy(t)+" - "+a.getDateBy(t)}if("quarter"==e){var n=(l=new Date).getMonth()+1,i=Math.ceil(n/3);r=new Date(l.getFullYear(),3*(i-1)),a=new Date(l.getFullYear(),3*i,0);return r.getDateBy(t)+" - "+a.getDateBy(t)}if("year"==e){l=new Date,r=new Date(l.getFullYear(),0),a=new Date(l.getFullYear(),12,0);return r.getDateBy(t)+" - "+a.getDateBy(t)}if("nyear"==e){l=new Date,r=new Date(l.getFullYear()+1,0),a=new Date(l.getFullYear()+1,12,0);return r.getDateBy(t)+" - "+a.getDateBy(t)}if("nquarter"==e){n=(l=new Date).getMonth()+1;4==(i=Math.ceil(n/3))?(l=new Date(l.getFullYear()+1),i=1):i+=1;r=new Date(l.getFullYear(),3*(i-1)),a=new Date(l.getFullYear(),3*i,0);return r.getDateBy(t)+" - "+a.getDateBy(t)}return null}new Date;var a=lmsbase._userDForm,n=[[l("week",a),ZPI18N.getString("zp.lms.thisweek")],[l("month",a),ZPI18N.getString("zp.lms.thismonth")],[l("quarter",a),ZPI18N.getString("zp.lms.thisquarter")],[l("nquarter",a),ZPI18N.getString("zp.lms.nextquarter")],[l("year",a),ZPI18N.getString("zp.lms.thisyear")],[l("nyear",a),ZPI18N.getString("zp.lms.nextyear")]];lmsgroupmenu.initiate(document.getElementById(s)).insertMenu({elem:t,type:"daterange",dform:a,name:"date1",rangepattern:n,clickAction:lmscourses.filter.dateFilterSearch})},dateFilterSearch:function(){lmscourses.filter.filterSearch(this)}},lmscourses.completCourse={courseComplete:function(e){null!=lmscourses.currentBatchId&&""!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&lmscourses.currentBatchId;var t={method:"courseComplete",courseId:lmscourses.currentCourseId,conreqcsr:csrfToken};$.post("/courseAction.zp",t,(function(t){1==t[1].status&&$(e).text(t[1].message)}))},userCourseComplete:function(e){lmscoursedetails.disableComponentData=null;var t="";null!=lmscourses.currentBatchId&&""!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&(t=lmscourses.currentBatchId);var s={method:"selfUserComplete",courseId:lmscourses.currentCourseId,batchId:t,user:erecno,conreqcsr:csrfToken};$.post("/courseAction.zp",s,(function(e){1==e[1].status&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.coursecomplete")),lmscoursedetails.currentCourseData=null,lmscoursedetails.getDisabledcomponents(lmscourses.currentCourseId),lmscoursedetails.initObj.mode="add")}))},userCourseInComplete:function(e){lmscoursedetails.disableComponentData=null;var t="";null!=lmscourses.currentBatchId&&""!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&(t=lmscourses.currentBatchId);var s={method:"selfUserInComplete",courseId:lmscourses.currentCourseId,batchId:t,user:erecno,conreqcsr:csrfToken};$.post("/courseAction.zp",s,(function(t){1==t[1].status&&($(e).text(t[1].message),lmscoursedetails.currentCourseData=null,lmscoursedetails.getDisabledcomponents(lmscourses.currentCourseId),lmscoursedetails.initObj.mode="add")}))}},zplms.setupEventManager(lmscourses);var lmscoursedetails={currentCourseData:null,courseTypeval:"",tabCallbackId:0,addmemtabId:0,hashUrl:"",totalbuttons:[],isFav:!1,iscourseEdit:!1,isComplete:!1,totalEntityCnt:0,userEntityCnt:0,disableComponentData:null,hasPreActivity:null,hasPostActivity:null,isBatchCreated:!1,courseEntityData:null,isUserJoined:!1,activityData:null,currentTab:null,isCourseTrainer:!1,isGradeUpdated:!1,ispublish:!1,currentIndex:0,isCourseHash:!1,allbatchData:null,noGrade:!1,showUserGrade:!1,showOtherGrade:!1,isUserComplete:!1,isMangercanenroll:!1,islearnerviewgrade:!1,isDuration:!1,isMandatoryFeedback:!1,isUserMappedToCourse:!1,mandatoryviewbased:"fromlearner",switchObj:{1:ZPI18N.getString("zp.lms.module"),2:ZPI18N.getString("zp.lms.content.files"),3:ZPI18N.getString("zp.lms.base.Sessions"),4:ZPI18N.getString("zp.lms.component.display_name.prepostactivity")},_coursetab:{admin:[["Overview"],["Module"],["Session"],["Members"],["Files"],["Notes"],["Discussion"],["Feedback"],["Reports"],["Pre & Post Learning"]],learner:[["Overview"],["Module"],["Session"],["Files"],["Members"],["Notes"],["Discussion"],["Feedback"],["Reports"],["Pre & Post Learning"]],trainer:[["Overview"],["Module"],["Session"],["Files"],["Members"],["Notes"],["Discussion"],["Feedback"],["Reports"],["Pre & Post Learning"]]},initiate:async function(e){""==lmscourses.currentCourseId&&(lmscoursedetails.disableComponentData=null,lmscoursedetails.currentCourseData=null,lmscoursedetails.activityData=null),"courseEdit"==e&&(lmscoursedetails.iscourseEdit=!0),lmscourses.getCourseUrl(),lmscoursedetails.initObj=this,""==lmscourses.currentCourseId&&(lmscourses.currentCourseId=lms._page.hashObject.level1),null!=lms._page.hashObject&&null!=lms._page.hashObject.level4?lmscourses.selectedTab=lms._page.hashObject.level4:null!=lms._page.hashObject&&null!=lms._page.hashObject.level2&&(lmscourses.selectedTab=lms._page.hashObject.level2),""==lmscourses.currentBatchId&&null!=lms._page.hashObject.level3&&null==lms._page.hashObject.level3.role&&(lmscourses.currentBatchId=lms._page.hashObject.level3);lmscourses.selectedTab;lmscourses.currentCourseId!=lms._page.hashObject.level1?(lmscourses.currentCourseId=lms._page.hashObject.level1,null!=lms._page.hashObject&&null!=lms._page.hashObject.level4?lmscourses.selectedTab=lms._page.hashObject.level4:null!=lms._page.hashObject&&null!=lms._page.hashObject.level2&&(lmscourses.selectedTab=lms._page.hashObject.level2),null!=lms._page.hashObject.level3&&null==lms._page.hashObject.level3.role&&(lmscourses.currentBatchId=lms._page.hashObject.level3),await lmscoursedetails.getDisabledcomponents(lmscourses.currentCourseId,"newMode")):await lmscoursedetails.getDisabledcomponents(lmscourses.currentCourseId,e)},componentUrl:function(e){return"null"!=lmscourses.currentBatchId&&""!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&"undefined"!=lmscourses.currentBatchId?"course/"+e+"/batch/"+lmscourses.currentBatchId:"course/"+e},tabCallback:function(e,t,s,r){"temp"!=r?($("#courseTabs").find("li").removeClass("sel"),$(e).addClass("sel")):$($("#courseTabs").find("li")[lmscoursedetails.tabCallbackId]).addClass("sel");var l,a="hash";l=lmscoursedetails.componentUrl(t),$("[data-id='addBtn']").find("button").off("click"),lmsmodule.chapterData=null;var n=$(e).text(),i=lmsmodule.selem||lmscontent.elem||lmsmembers.elem||lmssessions.elem;if(i){var o=i.querySelector('[_crel = "nextpage"]');o&&o.remove()}if(lmssessions.currentTab=n,document.getElementById("courseContainer").scroll(0,0),n!=lmscourses.selectedTab){$('[data-id="courseView"]').removeClass("zp_Tmes"),$('[data-id="courseView"]').removeClass("zp_Cfdk"),lmsbase.removeQHash(),lmsmodule.closeEvents(n);var c=lmsbase._role;if(lmsbase._role="view",n==ZPI18N.getString("zp.lms.component.display_name.overview"))lmscoursedetails.hashUrl=l+"/overview",lmscourses.selectedTab="overview",lmscoursedetails.tabCallbackId=0,$("[data-id^='addBtn']").hide(),$(".zp_Lstwrap").addClass("zp_gy"),lmscoursedetails.iscourseEdit=!0,lms.changeHash(a,lmscoursedetails.hashUrl,"disable"),lmsbase._role=c,lmscoursedetails.getCourseDetails(t,"tabCallback","","","","overview");else if(n==ZPI18N.getString("zp.lms.component.display_name.module"))!lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0])||lmsmodule.addModuleCheck()||lmscourses.selcourseType!=ZPI18N.getString("zp.lms.settings.InstructorLed")&&"Blended Learning"!=lmscourses.selcourseType&&"Blended learning"!=lmscourses.selcourseType&&"zp.lms.settings.InstructorLed"!=lmscourses.selcourseType||createBatch.addpopup(),lmscoursedetails.currentIndex=1,lmssessions.listOfMode="",lmscoursedetails.hashUrl=l+"/module",lmscourses.selectedTab="module",lmscoursedetails.addRecordCallback("zp.lms.modules.addmodule",lmsmodule.showAddModule),$(".zp_Lstwrap").addClass("zp_gy"),lmscoursedetails.elem=document.getElementById("courseContainer"),lmscoursedetails.elem.querySelector('[data-id="courseView"]').setAttribute("id","modulesList"),lmsmodule.initiate(),lms.changeHash(a,lmscoursedetails.hashUrl,"disable");else if(n==ZPI18N.getString("zp.lms.component.display_name.sessions"))lmscoursedetails.currentIndex=3,lmscoursedetails.hashUrl=l+"/sessions",lmscourses.selectedTab="sessions",lmssessions.listOfMode="allSession",lmscoursedetails.addRecordCallback(ZPI18N.getString("zp.lms.modules.addsession"),lmssessions.showAddSession),$(".zp_Lstwrap").addClass("zp_gy"),lmssessions.initiate("course"),lms.changeHash(a,lmscoursedetails.hashUrl,"disable");else if(n==ZPI18N.getString("zp.lms.component.display_name.members"))lmscoursedetails.hashUrl=l+"/members",lmscourses.selectedTab="members",(lmscourses.isCourseAdmin||lmscourses.courseOwner==erecno||lmscoursedetails.isCourseTrainer||isadmin||lms.settingData[0].settingPermission.isDataAdmin&&!lmscoursedetails.isUserJoined)&&"Completed"==lmscoursedetails.isComplete?lmscoursedetails.addRecordCallback("zp.lms.coursedetails.notifytoall",lmsmembers.gradePublishToall):lmscoursedetails.addRecordCallback("Add Members",lmscoursemembers.addMembers),lmscoursemembers.fetchCourseMembersList(),lms.changeHash(a,lmscoursedetails.hashUrl,"disable");else if(n==ZPI18N.getString("zp.lms.component.display_name.files"))lmscoursedetails.currentIndex=2,lmscoursedetails.hashUrl=l+"/files",lmscourses.selectedTab="files",lmscontent.listOfMode="allContent",lmsmodule.currentModuleId,lmscoursedetails.addRecordCallback("Add Files",lmscontent.showAddContent),$(".zp_Lstwrap").addClass("zp_gy"),lmscontent.initiate.call({type:"integ",mode:"new"}),lms.changeHash(a,lmscoursedetails.hashUrl,"disable");else if(n==ZPI18N.getString("zp.lms.component.display_name.notes")){lmscoursedetails.hashUrl=l+"/notes",lmscourses.selectedTab="notes",lmscoursedetails.addRecordCallback("zp.lms.notes.addnote",lmsnotes.addNote),$(".zp_Ldtl").parent().parent().remove();var d=document.querySelector('[data-id="courseView"]'),m={header:!1,filter:!1,bodyClass:""};lmsnotes.initiate.call({type:"hash",mode:"add",integ:!0,htmlConf:m,elem:d,baseUri:l+"/",courseId:lmscoursedetails.currentCourseData[0].courseId,entityId:lmscoursedetails.currentCourseData[0].courseId,courseName:lmscoursedetails.currentCourseData[0].courseName,batchId:"null"!=lmscourses.currentBatchId?lmscourses.currentBatchId:void 0,batchName:lmscourses.currentBatchName,entityType:1,hashObject:{level1:""}}),lms.changeHash(a,lmscoursedetails.hashUrl,"disable")}else if(n==ZPI18N.getString("zp.lms.component.display_name.discussion")){lmscoursedetails.hashUrl=l+"/discussion",lmscourses.selectedTab="discussion",lmscoursedetails.addRecordCallback("zp.lms.coursedetails.startadiscussion",lmsmessages.addMessagePopup),$(".zp_Ldtl").parent().parent().remove();d=document.querySelector('[data-id="courseView"]'),m={header:!1,bodyClass:""};lmsmessages.canUserStartDiscussion&&(lmscoursedetails.currentCourseData[0].isCourseAdmin||lmscoursedetails.currentCourseData[0].iscourseTrainer)?canStartDiscussionForCourse=!0:canStartDiscussionForCourse=!1,lmsmessages.initiate.call({type:"hash",mode:"add",integ:!0,htmlConf:m,elem:d,baseUri:l+"/",courseId:lmscoursedetails.currentCourseData[0].courseId,courseName:lmscoursedetails.currentCourseData[0].courseName,batchId:"null"!=lmscourses.currentBatchId?lmscourses.currentBatchId:void 0,batchName:lmscourses.currentBatchName,entityData:lmscoursedetails.currentCourseData[0],hashObject:{level1:""},canStartDiscussionForCourse}),lms.changeHash(a,lmscoursedetails.hashUrl,"disable")}else if(n==ZPI18N.getString("zp.lms.component.display_name.feedback")){lmscoursedetails.hashUrl=l+"/feedback",lmscourses.selectedTab="feedback",lmscoursedetails.addRecordCallback("zp.lms.feedback.writefeedback"),$("[data-id^='addBtn']").hide(),$(".zp_Ldtl").parent().parent().remove();d=document.querySelector('[data-id="courseView"]');lmsbase.addClass(d,"zp_Tfeed"),lmsbase.addListener(document.getElementById("courseContainer"),"scroll",lmscoursedetails.scrollListener,!1);var u=lmscoursedetails.currentCourseData[0];d=zplms.replaceWithClone(d),lmscoursedetails.courseFeedbackView=null;var p=lmscoursedetails.getModeOfView();if((isadmin||lmsbase.isCourseAdmin(lmscourses.selcourseType,lmscoursedetails.currentCourseData[0]))&&"learnerview"!=p){var g=lmsfeedback_v1.createCourseFeedbackView(u.courseId,u.batchId,u.courseType,d);g.start(),lmscoursedetails.courseFeedbackView=g}else lmscoursedetails.isUserJoined&&lmsMemberFeedback.getIndividualMemberFeedback(d,erecno);lms.changeHash(a,lmscoursedetails.hashUrl,"disable")}else if(n==ZPI18N.getString("zp.reports")){lmscoursedetails.hashUrl=l+"/reports",lmscourses.selectedTab="reports",lmscoursedetails.addRecordCallback("zp.reports");var f={type:"hash",integ:!0,htmlConf:m={header:!1,bodyClass:""},elem:d=document.querySelector('[data-id="courseView"]'),baseUri:l+"/",integ:!0,entityData:lmscoursedetails.currentCourseData[0],courseId:lmscoursedetails.currentCourseData[0].courseId,batchId:"null"!=lmscourses.currentBatchId?lmscourses.currentBatchId:void 0,tabName:"reports"};lmsmodule.handleChecks()||lmscoursedetails.isCourseTrainer||isadmin||lms.isDataAdmin?f.view="adminReports":f.view="learnerReports",lmscoursereports.initiate.call(f),lms.changeHash(a,lmscoursedetails.hashUrl,"disable")}else if(n==ZPI18N.getString("zp.lms.component.display_name.grade"))$("[data-id^='addBtn']").hide(),$("[rel='memberAddMenu']").hide(),$("[rel='moduleMenu']").hide(),lmscoursedetails.hashUrl=l+"/grade",lmscourses.selectedTab="grade",lmscoursemembers.learnergrade.fetchlearnerGrade(),lms.changeHash(a,lmscoursedetails.hashUrl,"disable");else if(n==ZPI18N.getString("zp.lms.component.display_name.prepostactivity")){lmscourses.selectedTab="prepostactivity",lmscoursedetails.hashUrl=l+"/prepostactivity",lmscoursedetails.addRecordCallback("zp.lms.component.display_name.prepostactivity"),(d=document.querySelector('[data-id="courseView"]')).setAttribute("class","zp_Cdet zp_CMmdl"),$(".zp_Lstwrap").addClass("zp_gy"),d.appendChild(lmsmodule.addLoading()),lmsprepostactivities.initiate(),lms.changeHash(a,lmscoursedetails.hashUrl,"disable")}lmsbase._role=c,lmscourses.temp={module:lmsmodule.close,sessions:lmssessions.close,members:lmsmembers.close},"module"!=lmscourses.selectedTab&&"sessions"!=lmscourses.selectedTab&&"members"!=lmscourses.selectedTab||lmscourses.temp[lmscourses.selectedTab](),lmscoursedetails.resize()}var v=lmscoursedetails.hashUrl.split("/").pop().toUpperCase();"PREPOSTACTIVITY"==v&&(v=ZPI18N.getString("zp.lms.component.display_name.prepostactivity").toUpperCase());for(var h=0;h<lmscoursedetails._coursetab[lmsbase._role].length;h++)if(-1!=v.indexOf(lmscoursedetails._coursetab[lmsbase._role][h][0].toUpperCase())){if(document.querySelector('[_srel="'+v.toLowerCase()+'"]')&&document.querySelector('[_srel="'+v.toLowerCase()+'"]').hasAttribute("_rel")){lmscoursedetails.tabCallbackId=document.querySelector('[_srel="'+v.toLowerCase()+'"]').getAttribute("_rel")[0];break}lmscoursedetails.tabCallbackId=h;break}"temp"==r&&$($("#courseTabs").find("li")[lmscoursedetails.tabCallbackId]).addClass("sel")},courseNotes:function(){$(".zp_content").show(),this.elem.innerHTML="",lmsnotes._root=this.elem;var e=this.elem.appendChild(document.createElement("div"));e.className="zp_fltrs",e.innerHTML='<div class="zp_Lttl"></div><div class="zp_cwrap" _rel="ntebdy"> </div>';var t=this.elem.appendChild(document.createElement("div"));t.setAttribute("_rel","ntebdy"),t.innerHTML=' <div class="zp_Lstwrap zp_Tnote" _rel="nlist"></div>',lmsbase.addListener(this.elem,"click",lmsnotes.noteHandle,!1),lmsbase.addListener(document,"keyup",lmsnotes.onkeydown,!1);var s={courseId:lmscourses.currentCourseId};lmsnotes.fetchNotes(s)},tempTabs:function(e){if(0==$("#tempheaderDiv").length){var t='<div class="zp_Chd zp_temp" id="tempheaderDiv">';$.each(e,(function(e,s){var r="";lmscoursedetails.currentCourseData[0].isSystem?(lmscoursedetails.currentCourseData[0].courseImageInfo.additionalInfo={fileId:lmscoursedetails.currentCourseData[0].courseId,type:6},r=lmsfileaction.generateSourceURL(lmscoursedetails.currentCourseData[0].courseImageInfo)):r=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+s.courseImage+".svg"),t+='<h2 class="Cbg'+s.bannerBGData.clrId+'"><div class="ZP_photo pc2" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src="'+r+'"></div>'+s.courseName+"</h2>"})),t+='<div class="zp_Tabs" ><div class="zp_micn zp_frt">',t+='</div><ul id="tempTab">',$.each(lmscoursedetails._coursetab[lmsbase._role],(function(e,s){(!lmscourses.isCourseAdmin||lmscourses.isCourseAdmin&&lmscoursedetails.currentCourseData[0].courseAdmintabInfo&&lmscoursedetails.currentCourseData[0].courseAdmintabInfo[erecno]&&(JSON.parse(lmscoursedetails.currentCourseData[0].courseAdmintabInfo[erecno].tabIds).includes("0")||JSON.parse(lmscoursedetails.currentCourseData[0].courseAdmintabInfo[erecno].tabIds).includes(lmscoursedetails._coursetabIds[s])))&&(t+="<li onclick=\"lmscoursedetails.tabCallback(this,'"+lmscourses.currentCourseId+"','"+lmscourses.currentBatchId+"')\">"+s[0]+"</li>")})),t+="</ul>",t+="</div>",t+="</div>",$('[data-id="courseMain"]').append(t)}},getModeOfView:function(){var e="preview",t=window.location.href.split("#")[1].split("/");return"lms-adminview"==t[0]||"lms-trainerview"==t[0]?e="adminview":"lms-learnerview"==t[0]&&(e="learnerview"),e},getCourseDetails:function(e,t,s,r,l,a){1!==t&&(t=lmscoursedetails.getModeOfView());var n="";if(""!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&(n=lmscourses.currentBatchId),null==lmscoursedetails.currentCourseData||null==lmscoursedetails.activityData||"newMode"==t||lmscourses.isentityupdated){var i={method:"getCourseInfoDetails",courseId:e,batchId:n,modeOfView:"fullGrid",courseFor:"courseOverview",viewFor:"courseInfo",start:0,tab:lmscourses.selectedTab,modeofhashview:t,conreqcsr:csrfToken};"addCourseInfo"==lms._page.popup&&(i.isCourseSettings=!0),$.post("/courseAction.zp",i,(function(n){if(null!=n[1]){if(null==n[1][0].isBatchPublished?lmscoursedetails.ispublish=n[1][0].isPublished:lmscoursedetails.ispublish=n[1][0].isBatchPublished,"2"==n[1][0].courseType&&n[1][0].batchId&&""===lmscourses.currentBatchId&&lmscourses.currentBatchId<1){lmscourses.currentBatchId=n[1][0].batchId;let t="course/"+e+"/batch/"+n[1][0].batchId+"/"+lmscourses.selectedTab;return lms.changeHash("hash",t,"disable"),void lmscoursedetails.getCourseDetails(e,"tabCallback","","","",lmscourses.selectedTab)}if("1"==lmscourses.selcourseSysVal?(lms.selfSettingData.isSelfUserModPerm=n[1][0].isSelfUserModPerm,lms.selfSettingData.isSelfUserCanShare=n[1][0].isSelfUserCanShare,lms.selfSettingData.isSelfModerateOpt=n[1][0].isSelfModerateOpt):"2"==lmscourses.selcourseSysVal&&(lms.iltSettingData.isILTUserModPerm=n[1][0].isILTUserModPerm,lms.iltSettingData.isIltUserCanShare=n[1][0].isIltUserCanShare,lms.iltSettingData.isIltModerateOpt=n[1][0].isIltModerateOpt,lmscoursedetails.totalLearnersCount=n[1][0].joinedCount),(lmscoursedetails.ispublish||lms.settingData[0].settingPermission.isDataAdmin||!lmscoursedetails.currentCourseData||lmscoursedetails.currentCourseData[0].isCourseAdmin||lmscoursedetails.isCourseTrainer||isadmin&&-1===Layout.Page.hash.indexOf("lms-learner/course"))&&"Permission denied"!=n[1][0].message){lmscoursegrade.gradeSetting=n[1][0].gradeSetting,lmscoursedetails.startCourseEntity=n[1][0].totalUserEntityCnt;if(lmscourses.updateImage=n[1][0].courseImage,lmscourses.coursecode=ZPeople.decodeTxt(n[1][0].courseCode),lmscourses.currentCourseName=n[1][0].courseName,lmscoursedetails.hasPreActivity=n[1][0].hasPreActivity,lmscoursedetails.hasPostActivity=n[1][0].hasPostActivity,1==t)return void s(n);null==lmscourses.allcourseData&&(lmscoursedetails.currentCourseData=lmscourses.allcourseData=n[1]),lmscoursedetails.currentCourseData=n[1],lmscoursedetails.activityData=n[1],lmscoursedetails.getCourseTabView(n[1],t,r,l,a)}else{var i='<div class="zp_nopermission"><div><div class="zp_noprm"><i class="CR-noperm"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i></i><label><h3>'+ZPI18N.getString("zp.assessment.preview.nopermission")+"</h3><p>"+ZPI18N.getString("zp.lms.learningplan.notauthorised")+"</p></label></div></div></div>";$("#wrapper").after(i),$("#wrapper").addClass("DN")}lmscourses.courseCurrency=lmscoursedetails.currentCourseData[0].courseCurrency}})),lmscourses.isentityupdated=!1}else{lmscourses.updateImage=lmscoursedetails.currentCourseData[0].courseImage,lmscourses.coursecode=lmscoursedetails.currentCourseData[0].courseCode,1==t?s(resultData):(null==lmscourses.allcourseData&&(lmscourses.allcourseData=lmscoursedetails.currentCourseData),lmscoursedetails.getCourseTabView(lmscoursedetails.currentCourseData,t,r,"",a))}},getDisabledcomponents:function(e,t){return new Promise(((s,r)=>{let l="";""!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&(l=lmscourses.currentBatchId);var a=lmscoursedetails.getModeOfView();if(null==lmscoursedetails.disableComponentData||"newMode"==t){var n={method:"getDisabledComponentTabs",courseId:e,batchId:l,modeofhashview:a,conreqcsr:csrfToken};$.post("/courseAction.zp",n,(function(e){try{if(e[1].message&&"Permission denied"===e[1].message){var l='<div class="zp_nopermission"><div><div class="zp_noprm"><i class="CR-noperm"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i></i><label><h3>'+ZPI18N.getString("zp.assessment.preview.nopermission")+"</h3><p>"+ZPI18N.getString("zp.lms.learningplan.notauthorised")+"</p></label></div></div></div>";return $("#wrapper").after(l),$("#wrapper").addClass("DN"),s()}lmscoursedetails.disableComponentData=e,lmscoursedetails.viewComponentData(lmscoursedetails.disableComponentData,t),lmscourses.currencylistData=e[1].currencylist,3==e[1].courseType&&document.querySelector('[rel="lockSettingTab"]')&&document.querySelector('[rel="lockSettingTab"]').remove(),s()}catch(e){r(e)}}))}else lmscoursedetails.viewComponentData(lmscoursedetails.disableComponentData,t),s()}))},viewComponentData:function(e,t){if(lmscoursedetails._coursetab[lmsbase._role]=[],lmscoursedetails._coursetabNames=[],lmscoursedetails._coursetabIds={},null!=e&&null!=e[1]){var s=e[1].DisabledTabs;lmscoursedetails.isUserComplete=e[1].userCoursecompleteState,""!=e[1].type&&null!=e[1].type&&(lmscourses.selcourseType=e[1].type,lmscourses.selcourseSysVal=e[1].courseType,lmscourses.isCourseAdmin=e[1].isCourseAdmin,lmscourses.courseOwner=e[1].courseOwnerId,lmscoursedetails.isUserJoined=e[1].isUserJoined,lmscoursedetails.totalLearnersCount=e[1].totalLearnersCount,lmscoursedetails.isCourseTrainer=e[1].isCourseTrainer,lmscoursedetails.isMangercanenroll=e[1].isMangercanenroll,lmscoursedetails.islearnerviewgrade=e[1].islearnerviewgrade,lmscoursedetails.hasPreActivity=null==lmscoursedetails.hasPreActivity?e[1].hasPreActivity:lmscoursedetails.hasPreActivity,lmscoursedetails.hasPostActivity=null==lmscoursedetails.hasPostActivity?e[1].hasPostActivity:lmscoursedetails.hasPostActivity)}else s=[];for(var r=[],l=0;l<s.length;l++)r.push(""+s[l].ids);for(l=0;l<lmscourses.componentTabs.length;l++)tabName=lmsform.changetoI18N(lmscourses.componentTabs[l].tabName),compName=lmscourses.componentTabs[l].compName,-1!=$.inArray(lmscourses.componentTabs[l].tabId,r)||"RATING"==compName||"FeedbackTab"==tabName||"Blended Learning"!=lmscourses.selcourseType&&"zp.lms.settings.InstructorLed"!=lmscourses.selcourseType&&"SESSIONS"==compName||("3"==lmscourses.selcourseSysVal?"OVERVIEW"!=compName&&"MODULE"!=compName&&"FILES"!=compName&&"NOTES"!=compName||(lmscoursedetails._coursetab[lmsbase._role].push([tabName]),lmscoursedetails._coursetabNames.push([compName]),lmscoursedetails._coursetabIds[tabName]=lmscourses.componentTabs[l].tabId):"FEEDBACK"==compName?lmscoursedetails.canViewFeedbackTab()&&(lmscoursedetails._coursetab[lmsbase._role].push([tabName]),lmscoursedetails._coursetabNames.push([compName]),lmscoursedetails._coursetabIds[tabName]=lmscourses.componentTabs[l].tabId):"Feedback"!==tabName&&("MEMBERS"==compName?(lmscourses.isCourseAdmin||lmscourses.courseOwner==erecno||lmscoursedetails.isCourseTrainer||isadmin||lms.settingData[0].settingPermission.isDataAdmin||2==lms.role&&lmscoursedetails.isMangercanenroll)&&(lmscoursedetails._coursetab[lmsbase._role].push([tabName]),lmscoursedetails._coursetabNames.push([compName]),lmscoursedetails._coursetabIds[tabName]=lmscourses.componentTabs[l].tabId):"Members"!==tabName&&("REPORTS"==compName&&(lmscourses.isCourseAdmin||lmscourses.courseOwner==erecno||lmscoursedetails.isCourseTrainer||lmscoursedetails.isUserJoined||lms.settingData[0].settingPermission.isDataAdmin||isadmin)?(lmscoursedetails._coursetab[lmsbase._role].push([tabName]),lmscoursedetails._coursetabNames.push([compName]),lmscoursedetails._coursetabIds[tabName]=lmscourses.componentTabs[l].tabId):"PREPOSTACTIVITY"==compName?(isadmin||lmscourses.isCourseAdmin||lmscourses.courseOwner==erecno||lms.settingData[0].settingPermission.isDataAdmin||!lmscoursedetails.isCourseTrainer&&lmscoursedetails.isUserJoined&&(lmscoursedetails.hasPostActivity||lmscoursedetails.hasPreActivity))&&(lmscoursedetails._coursetab[lmsbase._role].push([tabName]),lmscoursedetails._coursetabNames.push([compName]),lmscoursedetails._coursetabIds[tabName]=lmscourses.componentTabs[l].tabId):"REPORTS"!=compName&&("GRADE"==compName?lmscoursedetails.isUserJoined&&lmscoursedetails.isUserComplete&&lmscoursedetails.islearnerviewgrade&&(lmscoursedetails._coursetab[lmsbase._role].push([tabName]),lmscoursedetails._coursetabNames.push([compName]),lmscoursedetails._coursetabIds[tabName]=lmscourses.componentTabs[l].tabId):"GRADE"!=compName&&(lmscoursedetails._coursetab[lmsbase._role].push([tabName]),lmscoursedetails._coursetabNames.push([compName]),lmscoursedetails._coursetabIds[tabName]=lmscourses.componentTabs[l].tabId)))));t=lmscoursedetails.getModeOfView(),lmscoursedetails.getCourseDetails(lmscourses.currentCourseId,t)},canViewFeedbackTab(){if(isadmin||lmscourses.courseOwner==erecno||lmscourses.isCourseAdmin||lms.settingData[0].settingPermission.isDataAdmin)return!0;if(lmscoursedetails.isUserJoined){let e=lms.settingData[0].commonSetting.feedbackFor,t=parseInt(lmscoursedetails.disableComponentData[1].courseType),s=lms.settingData[0].commonSetting.canLearnerViewTrainerFeedback;if(e.indexOf(2)>-1)return!0;if(2===t&&(e.indexOf(1)>-1||e.indexOf(3)>-1&&s))return!0}return!1},isManagerenroll:function(){var e=!1;return"1"==lmscourses.selcourseSysVal&&lms.selfSettingData.isSelfManagerenroll&&(e=!0),"2"==lmscourses.selcourseSysVal&&lms.iltSettingData.isIltManagerenroll&&(e=!0),e},courseMoreoption:function(e,t,s,r){var l;l=[e];var a=document.getElementById("moreoption");lmsmenu.initiate({elem:a,width:"160px",type:"dropdown",arrowHead:!0,menulist:l,eve:s}).on("click",(function(){var t='<li id="courseliTabs" class="moretabs" onclick="lmscoursedetails.tabCallback(\''+e[this.value][0]+"','"+r+"')\">"+e[this.value][0]+"</li>";lmscoursedetails.tabCallback(t,lmscourses.currentCourseId,lmscourses.currentBatchId),lmscoursedetails.optionChange(event)})).bind()},moreoption:function(e){var t=0,s=0,r=[],l=[];for(s=0;t<$(".zp_Tabs").width()-$("#sample")[0].getBoundingClientRect().width;s++)0==s?(t+=$("#courseTabs li").eq(s)[0].getBoundingClientRect().width,r[s]=$("#courseTabs li").eq(s)[0].innerHTML):(t+=$("#courseTabs li").eq(s)[0].getBoundingClientRect().width,r[s]=$("#courseTabs li").eq(s)[0].innerHTML.replace("&amp;","&"));for(l=r.concat(),i=s;i<lmscoursedetails._coursetab[lmsbase._role].length;i++)l[i]=$("#courseTabs li").eq(i)[0].innerHTML.replace("&amp;","&");lmscoursedetails.totalbuttons=l.concat(),s-=1,r.pop();var a={},n=0;for(i=0;i<l.length;i++)-1==$.inArray(l[i],r)&&(a[n+=1]=[l[i]]);lmscoursedetails.courseMoreoption(a,lmscoursedetails._coursetab[lmsbase._role].length,"click",e.courseId)},moreoptiondisplay:function(){try{var e=document.getElementById("moreoption"),t=0,s=0,r={0:0};for(r[1]=$(".zp_Tabs").width()-$("#sample")[0].getBoundingClientRect().width,s=0;t<r[1];s++)0==s?(t+=$("#courseTabs li").eq(s)[0].getBoundingClientRect().width,r[2]=[$("#courseTabs li").eq(s)[0].getBoundingClientRect().width]):(t+=$("#courseTabs li").eq(s)[0].getBoundingClientRect().width,r[2].push($("#courseTabs li").eq(s)[0].getBoundingClientRect().width));return(s-=1)<lmscoursedetails._coursetab[lmsbase._role].length?e.closest("ul").style.visibility="visible":e.closest("ul").style.visibility="hidden",r[0]=s-1,r}catch(t){if(e)return e.closest("ul").style.visibility="hidden",r[0]=s-1,r}},optionChange:function(e){var t=lmscoursedetails.moreoptiondisplay(),s=lmscoursedetails.totalbuttons.indexOf(lmscoursedetails._coursetab[lmsbase._role][lmscoursedetails.tabCallbackId][0]),r=document.getElementById("courseTabs"),l=r.childNodes[s],a=0,n=$("#courseTabs li").eq(s)[0].getBoundingClientRect().width;for(i=0;i<t[0];i++)a+=t[2][i];if(a+n>t[1])var o=r.childNodes[t[0]-1];else o=r.childNodes[t[0]];r.insertBefore(l,o);var c=o.innerHTML.replace("&amp;","&");lmscoursedetails.totalbuttons[lmscoursedetails.totalbuttons.indexOf(c)]=lmscoursedetails.totalbuttons[s],lmscoursedetails.totalbuttons[s]=c,l.setAttribute("class","sel")},getCourseTabView:function(e,t,s,r,l){try{lmscoursecertificate.templateId=null,lmscoursecertificate.templatePublishStatus=null}catch(e){}(null!=lmscoursedetails.initObj&&("add"==lmscoursedetails.initObj.mode||"update"==lmscoursedetails.initObj.mode)||lmscoursedetails.iscourseEdit)&&($("#coursePreView").remove(),$(".zp_fpv").show(),$.each(e,(function(t,a){null!=a.duration&&""!=a.duration&&(lmscoursedetails.isDuration=!0),lmscoursedetails.courseTabdetails=a,null!=a.inforecordId&&(lmscourses.currentCourseInfoId=a.inforecordId),lmscourses.isCourseAdmin=a.isCourseAdmin,lmscourses.courseOwner=a.courseOwnerId,(null!=a.allbatches&&a.allbatches.length>0||null!=lmscourses.currentBatchId&&""!=lmscourses.currentBatchId)&&(lmscoursedetails.isBatchCreated=!0);var n='<div class="zp_pwrap zp_tab zp_cmpl" id="coursePreView"><div class="zp_pcnt" data-id="courseMain">';n+='<div class="zp_Lstwrap  zp_gy" id="courseContainer" courseId="'+a.courseId+'" '+(a.batchId?'batchId="'+a.batchId+'"':"")+">",n+='<div class="zp_Chd">';var i="";i=null==a.courseImage?"10":a.courseImage;var o=a.bannerBGData.clrId+" Cpt"+a.bannerBGData.patternId,c=a.defaultCAData&&null!=a.defaultCAData.empName?a.defaultCAData:a.courseAdminInfo.length>0&&null!=a.courseAdminInfo[0].name?a.courseAdminInfo[0]:"";n+='<div class="zp_Phdr Cbg'+o+'" id="hideme" aria-label="'+lmscoursedetails.getCourseLabel(ZPeople.escapeHtml(ZPeople.decodeTxt(a.courseName)),c,lmsform.changetoI18N(a.category),a.courseCategoryInfo,a)+'" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'">';var d="ZP_img";if(lmscoursedetails.currentCourseData[0].isSystem?(lmscoursedetails.currentCourseData[0].courseImageInfo.additionalInfo={fileId:lmscoursedetails.currentCourseData[0].courseId,type:6},i=lmsfileaction.generateSourceURL(lmscoursedetails.currentCourseData[0].courseImageInfo)):(i=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+i+".svg"),d="ZP_img bg70"),n+='<div class="'+d+'" style="background-image: url('+i+')"></div>',n+='<div class="zp_micn">',""==lmscourses.currentBatchName&&(lmscourses.currentBatchName=a.batchName,lmscourses.currentBatchAdmin=a.batchAdmin),lmscoursedetails.isComplete=a.batchCompleteState,n+='<div class="zp_btn">',lmsbase.isUsercanhavePublish(a.courseType,a))if("-1"==a.stateType||lmscoursedetails.currentCourseData&&lmscoursedetails.currentCourseData[0].isDisabled)n+="<button>"+ZPI18N.getString("zp.sdisabled")+"</button>";else if(lmsbase.isUsercanhavePublish(a.courseType,a)&&"3"!==lmscourses.selcourseSysVal){var m="";"1"==lmscourses.selcourseSysVal&&(a.isSelfUserModPerm&&1!=a.isPublished||(lmscourses.courseOwner==erecno||a.isCourseAdmin)&&(a.isSelfUserModPerm&&0==a.isPublished||4==a.isPublished))?m=ZPI18N.getString("zp.publish"):"2"!=lmscourses.selcourseSysVal||a.isBatchPublished||!a.isILTUserModPerm&&(lmscourses.courseOwner!=erecno&&!a.isCourseAdmin||!a.isILTUserModPerm&&4!=a.isModerateStatus)?3==a.isPublished&&"1"==lmscourses.selcourseSysVal&&!a.isSelfUserModPerm||"2"==lmscourses.selcourseSysVal&&!a.isBatchPublished&&!a.isILTUserModPerm&&3==a.isModerateStatus?m=ZPI18N.getString("zp.waitingmsg"):(0!=a.isPublished||"1"!=lmscourses.selcourseSysVal||a.isSelfUserModPerm)&&("2"!=lmscourses.selcourseSysVal||a.isBatchPublished||a.isILTUserModPerm||0!=a.isModerateStatus&&a.hasOwnProperty("isModerateStatus"))?5==a.isPublished&&"1"==lmscourses.selcourseSysVal||5==a.isModerateStatus&&!a.isBatchPublished&&"2"==lmscourses.selcourseSysVal?m=ZPI18N.getString("zp.resendforapproval"):1==a.isPublished&&"1"==lmscourses.selcourseSysVal?m=ZPI18N.getString("zp.lms.course.unpublish"):"2"==lmscourses.selcourseSysVal&&1==a.isPublished&&1==a.isBatchPublished&&"Completed"==a.batchCompleteState?m="Batch Completed":"2"==lmscourses.selcourseSysVal&&1==a.isPublished&&1==a.isBatchPublished&&(m=ZPI18N.getString("zp.lms.course.unpublish")):m=ZPI18N.getString("zp.sendforapproval"):m=lmscoursedetails.isBatchCreated&&null!=a.isBatchPublished&&0==a.isBatchPublished?ZPI18N.getString("zp.lms.batchpublish"):ZPI18N.getString("zp.publish"),"3"!==lmscourses.selcourseSysVal&&""!=m&&(n+='<button id="publishButton" data-ttip="'+m+'">'+m+"</button>")}n+="</div>",n+="<ul>",lmscourses.previewType?lmsbase.isCourseAdmin(a.courseType,a)||a.isJoined&&"1"==lmscourses.selcourseSysVal&&lmscourseoverview.completeCourseCheck()&&(n+="<li><b>",n+='<span><i class="IC-mre" id="courseMore"  data-ttip="'+ZPI18N.getString("zp.lms.more")+'"></i></span>',n+="</b></li>"):(n+="<li><b>",n+='<span><i class="IC-mre" id="courseMore"  data-ttip="'+ZPI18N.getString("zp.lms.more")+'"></i></span>',n+="</b></li>"),n+="</ul></div>",n+='<div class="zp_PhdrDtl">',"2"==lmscourses.selcourseSysVal?(n+='<p _rel="visbatch" id="batchcont" class="zp_btvw">',a.batchName||(a.batchName=lmscourses.currentBatchName),a.batchName&&null!=a.allbatches&&a.allbatches.length>0&&lmsbase.isUsercanhaveBatches(a.courseType,a)||a.isClonemembersenabled?(n+='<span id="activeBatchName" class="zp_CBdwn" _batchrel="'+a.batchId+'" title="'+a.batchName+'"><em>'+a.batchName+"</em>",a.allbatches.length>1&&!lmscourses.previewType&&(n+='<i class="IC-adwn"></i>'),n+="</span>"):null!=a.joinedBatchId&&null!=a.batchName&&(n+='<span  id="userBatchName" class="zp_CBdwn" _batchrel="'+a.batchId+'">'+a.batchName+'<i class=""></i></span>'),n+=lmscoursedetails.getArchiveAdminhtml(a,lmscourses.selcourseSysVal),n+="</p>"):n+=lmscoursedetails.getArchiveAdminhtml(a,lmscourses.selcourseSysVal),n+="<h4>",null!=a.courseCode&&""!=a.courseCode&&(n+="<span>"+a.courseCode+"</span>"),n+='<font title="'+ZPeople.escapeHtml(ZPeople.decodeTxt(a.courseName))+'">'+ZPeople.escapeHtml(ZPeople.decodeTxt(a.courseName))+"</font></h4>";n+="<p>",null!=a.category&&""!=a.category&&(n+="<font>"+lmsform.changetoI18N(a.category)+"</font>"),null!=a.courseCategoryInfo&&""!=a.courseCategoryInfo&&(a.courseCategoryInfo.length>3?($.each(a.courseCategoryInfo,(function(e,t){if(n+='<font class="zp_ldot">'+t.category+"</font>",2==e)return!1})),n+='<font class="zp_ldot"><a id="category_more">'+ZPI18N.getString("zp.more")+"</a></font>"):$.each(a.courseCategoryInfo,(function(e,t){n+='<font class="zp_ldot">'+t.category+"</font>"}))),a.defaultCAData&&null!=a.defaultCAData.empName&&"3"!==lmscourses.selcourseSysVal?n+='<font class="zp_ldot" title="'+a.defaultCAData.empId+" - "+a.defaultCAData.empName+'"><i>'+a.defaultCAData.empId+"</i>"+a.defaultCAData.empName+"</font>":a.courseAdminInfo.length>0&&null!=a.courseAdminInfo[0].name&&"3"!==lmscourses.selcourseSysVal&&(n+='<font class="zp_ldot" title="'+a.courseAdminInfo[0].employeeId+" - "+a.courseAdminInfo[0].name+'"><i>'+a.courseAdminInfo[0].employeeId+"</i>"+a.courseAdminInfo[0].name+"</font>"),n+="</p>";var u="";if(1==lmscoursedetails.currentCourseData[0].isLearnerCostEnabled&&""!=a.courseCurrency&&null!=a.courseCurrency&&""!=a.courseCost&&0!=a.courseCost){u=lmscourses.currencylistData[a.courseCurrency].slice(0,3),n+='<p><span class="prctag"><i class="IC-prctg"></i><em>'+u+"</em>  "+a.courseCost+"</span> </p>"}var p=!1;lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0],"join")||(p=a.isUserGroupBased),lms_pre_and_post_course_activities.hasAnyPreCourseActivities(e[0])&&lms_pre_and_post_course_activities.hasAnyPendingPreCourseActivities(e[0])||0!=a.startCourse||!a.isUserJoined&&!p||0!=lmscoursedetails.startCourseEntity||a.isCourseCompleted||(n+='<div class="zp_Sbtn" _rel="startCourseDiv"><button _rel="startCourse" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'">'+ZPI18N.getString("zp.lms.coursedetails.startCourse")+'<i class="IC-player"></i></button></div>'),lmscoursecertificate.templateId=a.templateId,lmscoursecertificate.templatePublishStatus=a.templatePublishStatus;var g=!1;(0==a.certificateOption&&a.isCourseCompleted||0!=a.certificateOption&&a.certificateDownload)&&(g=!0),a.isUserJoined&&a.templateId&&g&&a.templatePublishStatus&&(n+='<div class="zp_Sbtn" _rel="startCourseDiv"><button _rel="downloadCertificateLMS" class="zp_Sbclr2" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'">'+ZPI18N.getString("zp.lms.certificate.downloadcertificate")+'<i class="IC-down"></i></button></div>'),lms_pre_and_post_course_activities.hasAnyPostCourseActivities(a)&&lms_pre_and_post_course_activities.hasAnyPendingPostCourseActivities(a)&&(n+='<div class="zp_Sbtn" container="post_course_activity_button"></div>'),n+="</div>",lmscoursedetails.isUserJoined=a.isUserJoined,lmscoursedetails.isUserMappedToCourse=a.isUserMappedToCourse,lmscoursedetails.totalEntityCnt=a.totalEntityCnt;var f=ZPI18N.getString("zp.lms.content.Completed"),v=100*a.totalUserEntityCnt/a.totalEntityCnt;if((a.isJoined||p&&!lmscourses.isCourseAdmin)&&(a.userCoursecompleteState&&100==v||"2"==lmscourses.selcourseSysVal&&"Completed"==a.batchCompleteState&&100==Math.round(v)?(f=ZPI18N.getString("zp.lms.course.coursecompleted"),lmscoursedetails.userEntityCnt=a.totalEntityCnt):lmscoursedetails.userEntityCnt=a.totalUserEntityCnt,a.userCoursecompleteState&&(v=100),lms_pre_and_post_course_activities.hasAnyPreCourseActivities(a)&&lms_pre_and_post_course_activities.hasAnyPendingPreCourseActivities(a)||!a.isUserJoined||!lmscoursedetails.ispublish||(n+='<div class="zp_CSprog" id="courseProgress"><p><span>',a.userCoursecompleteState||(n+=a.totalUserEntityCnt+"</span><span>"+ZPI18N.getString("zp.lms.of")+" "+a.totalEntityCnt+" "),n+=f+'</span></p><div><div class="zp_detprogbar" style="width:'+Math.round(v)+'%"></div></div></div>')),n+="</div>",lmscourses.selcourseType=a.type,lmscourses.isCourseAdmin||!lms_pre_and_post_course_activities.hasAnyPreCourseActivities(a)||!lms_pre_and_post_course_activities.hasAnyPendingPreCourseActivities(a)||l){n+='<div class="zp_Tabs"><div class="zp_micn zp_frt" id="sample">',n+='<ul><li><b><div class="zp_hd"></div> <span><i class="IC-mre"  id="moreoption" onclick="lmscoursedetails.moreoption(\''+a+'\')"data-ttip="'+ZPI18N.getString("zp.lms.more")+'"></i></i></span> </b></li></ul>',n+='<div class="zp_btn" data-id="addBtn" style="display:none"><button class="zpthm" >'+ZPI18N.getString("zp.lms.coursedetails.AddMembers")+"</button></div>",n+='</div><ul id="courseTabs" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" role="tablist">';var h=0;$.each(lmscoursedetails._coursetab[lmsbase._role],(function(e,t){lmscourses.selcourseType=a.type;var s,r=t[0];"Grade"==t[0]&&(s="tabName=grade");var l=!1;ZPI18N.getString("zp.lms.component.display_name.module")!=r&&"Module"!=lmsform.changetoI18N(r)||(l=!0),(!lmscourses.isCourseAdmin||lmscourses.isCourseAdmin&&lmscoursedetails.currentCourseData[0].courseAdmintabInfo&&lmscoursedetails.currentCourseData[0].courseAdmintabInfo[erecno]&&(JSON.parse(lmscoursedetails.currentCourseData[0].courseAdmintabInfo[erecno].tabIds).includes("0")||JSON.parse(lmscoursedetails.currentCourseData[0].courseAdmintabInfo[erecno].tabIds).includes(lmscoursedetails._coursetabIds[r])))&&(null==lmscourses.selcourseType&&"Sessions"!=t[0]||"1"==lmscourses.selcourseSysVal&&"Sessions"!=t[0]?n+='<li id="courseliTabs" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" role="tab" order="'+e+'"'+(s||"")+' _module = "'+l+'" _srel="'+r.toLowerCase()+'" _rel="'+h+'" onclick="lmscoursedetails.tabCallback(this,\''+a.courseId+"','"+lmscourses.currentBatchId+"')\">"+lmsform.changetoI18N(r)+"</li>":"2"!=lmscourses.selcourseSysVal||lmscoursedetails.sharedCourseTabs(t)?"3"==lmscourses.selcourseSysVal&&(n+='<li id="courseliTabs" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" role="tab" order="'+e+'" '+(s||"")+' _module = "'+l+'" _srel="'+r.toLowerCase()+'" _rel="'+h+'" onclick="lmscoursedetails.tabCallback(this,\''+a.courseId+"','"+lmscourses.currentBatchId+"')\">"+lmsform.changetoI18N(r)+"</li>"):n+='<li id="courseliTabs" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" role="tab" order="'+e+'" '+(s||"")+' _module = "'+l+'" _srel="'+r.toLowerCase()+'" _rel="'+h+'" onclick="lmscoursedetails.tabCallback(this,\''+a.courseId+"','"+lmscourses.currentBatchId+"')\">"+lmsform.changetoI18N(r)+"</li>",h++)})),n+="</ul>",n+="</div>"}n+="</div>",n+='<div data-id="courseView" class="zp_Cdet"></div></div></div>',n+="</div>",$(".zp_fpv").append(n),"close"==r&&(lmsbase.closeQHash(),lmsbase.removeQHash(),lmsform.close()),lms_pre_and_post_course_activities.hasAnyPreCourseActivities(a)&&lms_pre_and_post_course_activities.hasAnyPendingPreCourseActivities(a)||(lmscoursedetails.moreoptiondisplay(),lmscoursedetails.tempTabs(lmscoursedetails.currentCourseData)),lmscoursedetails.isFav=a.isFavourite;var b=document.getElementById("courseContainer");if(lmsbase.addListener(b,"scroll",lmscourses.tabScrollMinimize,!1),lmsbase.addListener(window,"resize",lmscoursedetails.resize,!1),lmsbase.isUsercanhavePublish(a.courseType,a)&&"3"!==lmscourses.selcourseSysVal&&$("#publishButton").click((function(){lmscoursedetails.publishCourse(a)})),null!=a.allbatches&&a.allbatches.length>1&&!lmscourses.previewType&&$("#activeBatchName").click((function(){lmscoursedetails.allbatchData=a.allbatches;var e=$(this).attr("_batchrel");lmsbatches.getPopupBatch("visit",e)})),$('[_rel="startCourse"]').click((function(e){lmscoursedetails.startCourse()})),$("#courseadminvwfilter").click((function(){var e=document.getElementById("courseadminvwfilter");lmscoursedetails.createViewModeMenu(e,"Status",this.event)})),$("#courseProgress").click((function(e){lmscoursedetails.getLearnerEntityProgressbar()})),$('[_rel="downloadCertificateLMS"]').click((function(e){lmscoursecertificate.downloadFun()})),$("#courseMore").click((function(e){var t=[];$("#courseTabs").find("li").each((function(e){t[e]=[$(this).text()]})),lmscoursedetails._coursetab[lmsbase._role]=t,lmscourseoverview.courseBannerMore(this,"click",a.courseName,lmscourses.currentBatchId,a.isPublished,a.batchCompleteState,a.isDisabled,a)})),$("#category_more").click((function(){lmscoursedetails.getMoreCategory(a)})),$("#courseCompleteButton").click((function(){lmscourses.completCourse.courseComplete(this)})),"updateBatchhash"==s){var I="";null!=a.batchId?I=a.batchId:lmscourses.currentBatchId?I=lmscourses.currentBatchId:null!=a.allbatches&&a.allbatches.length>0&&(I=a.allbatches[0].batchId),lmscourses.changeOverViewHash(lmscourses.currentCourseId,I,lmscourses.selcourseType,lmscourses.selcourseSysVal,"disable")}}))),lmscoursedetails.currentCourseData=e;var a=lmsmodule.selem||lmscontent.elem||lmsmembers.elem||lmssessions.elem;if(a&&(elem=a.querySelector('[_crel = "nextpage"]'),elem&&elem.remove()),lms_pre_and_post_course_activities.hasAnyPostCourseActivities(e[0])&&lms_pre_and_post_course_activities.hasAnyPendingPostCourseActivities(e[0])&&!lms_pre_and_post_course_activities.doesUserHaveGrade()&&(lms_pre_and_post_course_activities.constructPostCourseActivityHeaderButton(),$('[_rel="startCourseDiv"]').addClass("zp_dyn"),$("#courseTabs [tabName=grade]").addClass("zp_dyn"),"grade"==lmscourses.selectedTab)){lmscourses.selectedTab="overview";var n=this.getCurrentCourseBaseHash()+"/overview";lms.changeHash("hash",n,"disable")}if(lms_pre_and_post_course_activities.hasAnyPreCourseActivities(e[0])&&lms_pre_and_post_course_activities.hasAnyPendingPreCourseActivities(e[0])){lms_pre_and_post_course_activities.createPreCourseActivityView(e[0],document.querySelector('[data-id="courseView"]'));n=this.getCurrentCourseBaseHash()+"/precourseactivities";lms.changeHash("hash",n,"disable")}else if("overview"==lmscourses.selectedTab)$($("#courseTabs").find("li")[0]).addClass("sel"),lmscourseoverview.initiate(e),lmscoursedetails.tabCallbackId=0,$("[data-id^='addBtn']").hide();else if("module"==lmscourses.selectedTab)lmssessions.listOfMode="",!lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0])||lmsmodule.addModuleCheck()||lmscourses.selcourseType!=ZPI18N.getString("zp.lms.settings.InstructorLed")&&"Blended Learning"!=lmscourses.selcourseType&&"Blended learning"!=lmscourses.selcourseType&&"zp.lms.settings.InstructorLed"!=lmscourses.selcourseType||createBatch.addpopup(),lmscoursedetails.addRecordCallback("zp.lms.modules.addmodule",lmsmodule.showAddModule),lmscoursedetails.elem=document.getElementById("courseContainer"),lmscoursedetails.elem.querySelector('[data-id="courseView"]').setAttribute("id","modulesList"),lmsmodule.initiate();else if("sessions"==lmscourses.selectedTab)lmssessions.listOfMode="allSession",lmscoursedetails.addRecordCallback(ZPI18N.getString("zp.lms.modules.addsession"),lmssessions.showAddSession),lmssessions.initiate();else if("members"==lmscourses.selectedTab)$("[data-id='addBtn']").show(),(lmscourses.isCourseAdmin||lmscourses.courseOwner==erecno||lmscoursedetails.isCourseTrainer||isadmin||lms.settingData[0].settingPermission.isDataAdmin&&!lmscoursedetails.isUserJoined)&&"Completed"==lmscoursedetails.isComplete?lmscoursedetails.addRecordCallback("zp.lms.coursedetails.notifytoall",lmsmembers.gradePublishToall):lmscoursedetails.addRecordCallback("Add Members",lmscoursemembers.addMembers),lmscoursemembers.fetchCourseMembersList();else if("files"==lmscourses.selectedTab)$("[data-id='addBtn']").show(),lmscontent.listOfMode="allContent",lmsmodule.currentModuleId="",lmscoursedetails.addRecordCallback("Add Files",lmscontent.showAddContent),lmscontent.initiate.call({type:"integ"});else if("notes"==lmscourses.selectedTab)lmscoursedetails.addRecordCallback("zp.lms.notes.addnote",lmsnotes.addNote),lmscoursedetails.initObj.htmlConf={header:!1,filter:!1,bodyClass:""},lmsnotes.initiate.call(p(lmscoursedetails.initObj));else if("discussion"==lmscourses.selectedTab)lmscoursedetails.addRecordCallback("zp.lms.coursedetails.startadiscussion",lmsmessages.addMessagePopup),lmscoursedetails.initObj.htmlConf={header:!1,bodyClass:""},lmsmessages.initiate.call(p(lmscoursedetails.initObj));else if("feedback"==lmscourses.selectedTab){elem=document.querySelector('[data-id="courseView"]'),lmsbase.addClass(elem,"zp_Tfeed"),$("[data-id^='addBtn']").hide(),lmsbase.addListener(document.getElementById("courseContainer"),"scroll",lmscoursedetails.scrollListener,!1);var i=lmscoursedetails.currentCourseData[0];elem=zplms.replaceWithClone(elem);var o=lmscoursedetails.getModeOfView();if(lmscoursedetails.courseFeedbackView=null,(isadmin||lmsbase.isCourseAdmin(lmscourses.selcourseType,lmscoursedetails.currentCourseData[0]))&&"learnerview"!=o){var c=lmsfeedback_v1.createCourseFeedbackView(i.courseId,i.batchId,i.courseType,elem);c.start(),lmscoursedetails.courseFeedbackView=c}else lmscoursedetails.isUserJoined&&lmsMemberFeedback.getIndividualMemberFeedback(elem,erecno)}else if("reports"==lmscourses.selectedTab)elem=document.querySelector('[data-id="courseView"]'),lmscoursedetails.addRecordCallback("zp.reports"),lmscoursedetails.initObj.tabName="reports",lmscoursedetails.initObj.htmlConf={header:!1,bodyClass:""},lmscoursereports.initiate.call(p(lmscoursedetails.initObj));else if("grade"==lmscourses.selectedTab)$("[data-id='addBtn']").hide(),lmscoursemembers.learnergrade.fetchlearnerGrade();else if("prepostactivity"==lmscourses.selectedTab){var d=document.querySelector('[data-id="courseView"]');d.setAttribute("class","zp_Cdet zp_CMmdl"),d.appendChild(lmsmodule.addLoading()),lmsprepostactivities.initiate()}var m=location.hash.split("?")[0];(m=m.split("/").pop().toUpperCase()).includes("ROLE")&&(m="FEEDBACK");for(var u=0;u<lmscoursedetails._coursetabNames.length;u++)if(-1!=m.indexOf(lmscoursedetails._coursetabNames[u][0].toUpperCase())){if(document.querySelector('[_srel="'+m.toLowerCase()+'"]')&&document.querySelector('[_srel="'+m.toLowerCase()+'"]').hasAttribute("_rel")){lmscoursedetails.tabCallbackId=document.querySelector('[_srel="'+m.toLowerCase()+'"]').getAttribute("_rel")[0];break}lmscoursedetails.tabCallbackId=u;break}function p(e){e.type="hash",e.mode="add",e.integ=!0,e.entityData=lmscoursedetails.currentCourseData[0],e.courseId=e.entityId=lmscoursedetails.currentCourseData[0].courseId,e.courseName=lmscoursedetails.currentCourseData[0].courseName,e.batchId="null"!=lmscourses.currentBatchId?lmscourses.currentBatchId:void 0,e.batchName=lmscourses.currentBatchName,e.entityType=1,e.feedbackOf="course";var t=document.querySelector('[data-id="courseView"]');e.elem=t;return e.baseUri="course/"+e.courseId+"/",e.hashObject?"batch"==e.hashObject.level2?(e.baseUri+="batch/"+e.batchId+"/",e.hashObject.level1=e.hashObject.level4||"",e.hashObject.level2=e.hashObject.level5||"",e.hashObject.level3=e.hashObject.level6||""):(e.hashObject.level1=e.hashObject.level2||"",e.hashObject.level2=e.hashObject.level3||"",e.hashObject.level3=e.hashObject.level4||""):e.hashObject={level1:""},"feedback"==lmscourses.selectedTab&&e.hashObject&&(e.hashObject.feedbackFor="courseAndSessions"),"discussion"==lmscourses.selectedTab&&lmsmessages.canUserStartDiscussion&&(lmscoursedetails.currentCourseData[0].isCourseAdmin||lmscoursedetails.currentCourseData[0].iscourseTrainer)?e.canStartDiscussionForCourse=!0:e.canStartDiscussionForCourse=!1,"reports"==lmscourses.selectedTab&&(lmsmodule.handleChecks()||lmscoursedetails.isCourseTrainer||isadmin||lms.isDataAdmin?e.view="adminReports":e.view="learnerReports"),e}lmscoursedetails.resize(),$($("#courseTabs").find("li").removeClass("sel")[lmscoursedetails.tabCallbackId]).addClass("sel")},getArchiveAdminhtml:function(e,t){var s="";if(e.isArchivedAdmin){if((l=window.location.hash).indexOf("adminview")>-1||l.indexOf("learnerview")>-1||l.indexOf("trainerview")>-1){var r="";l.indexOf("adminview")>-1?r=l.split("-adminview/")[1]:l.indexOf("learnerview")>-1&&(r=l.split("-learnerview/")[1]),l.indexOf("trainerview")>-1&&(r=l.split("-trainerview/")[1]),lms.changeHash("hash",r,"enable")}else{r=l.split("-view/")[1];lms.changeHash("hash",r,"enable")}"2"==t?s+='<span class="zp_CBdwn" id="courseadminvwfilter"><em><i class="IC-user"></i></em><i class="IC-adwn"></i></span>':(s+='<p _rel="visbatch"  class="zp_btvw">',s+='<span class="zp_CBdwn" id="courseadminvwfilter"><em><i class="IC-user"></i></em><i class="IC-adwn"></i></span>',s+="</p>")}else{var l;if((l=window.location.hash).indexOf("adminview")>-1||l.indexOf("learnerview")>-1||l.indexOf("trainerview")>-1){r="";l.indexOf("adminview")>-1?r=l.split("-adminview/")[1]:l.indexOf("learnerview")>-1?r=l.split("-learnerview/")[1]:l.indexOf("trainerview")>-1&&(r=l.split("-trainerview/")[1]),lms.changeHash("hash",r,"enable")}}return s},publishCourse:function(e){$(".zp_msk").html("");var t=!1;if("1"==e.courseType?1==e.isPublished?t=!0:0==e.isPublished&&(t=!1):"2"==e.courseType&&(t=e.isBatchPublished),lmscoursedetails.ispublish=t,1!=lmscoursedetails.currentCourseData[0].isPublished&&"1"==lmscourses.selcourseSysVal&&("1"==e.isSelfModerateOpt||e.isSelfUserModPerm||4==e.isPublished)||"2"==lmscourses.selcourseSysVal&&!lmscoursedetails.currentCourseData[0].isBatchPublished&&("1"==e.isIltModerateOpt||e.isILTUserModPerm||4==lmscoursedetails.currentCourseData[0].isModerateStatus))if(0==lmscoursedetails.currentCourseData[0].isFromLP&&("1"==lmscourses.selcourseSysVal&&lms.notificationData.isEnabled("COURSE_PUBLISHED_NOTIFICATION_KEY")||"2"==lmscourses.selcourseSysVal&&(lmscoursedetails.currentCourseData[0].isPublished?lms.notificationData.isEnabled("BATCH_PUBLISHED_NOTIFICATION_KEY"):lms.notificationData.isEnabled("COURSE_PUBLISHED_NOTIFICATION_KEY")))){var s='<div class="zp_trCnfCnt zp_sucs"><div class="zp_trCnfIn">';if("2"==lmscourses.selcourseSysVal){var r=e.batchName?e.batchName:lmscourses.currentBatchName;s+=r?"<h2>"+r+" - "+ZPI18N.getString("zp.lms.course.batchpubnotify")+"</h2>":"<h2>"+ZPI18N.getString("zp.lms.course.batchpubnotify")+"</h2>"}else s+="<h2>"+ZPI18N.getString("zp.lms.course.selfpubnotify")+"</h2>";s+='<div class="zp_trCnfdta"><p>'+ZPI18N.getString("zp.lms.course.pubnotifydesc")+'</p></div><div class="zp_trCnfBtm"><div class="zp_btn"><button class="zpactn" onclick="lmscoursedetails.closePopUp(this, \'0\')">'+ZPI18N.getString("zp.no")+'</button><button class="zpthm" onclick="lmscoursedetails.closePopUp(this, \'1\')">'+ZPI18N.getString("zp.yes")+"</button></div></div></div></div>",$(".zp_msk").append(s),$(".zp_msk").show()}else lmscourses.publishCourse(e.courseId,this,e.type,e.courseType,t,lmscourses.selectedTab,lmscourses.currentBatchId,e);else"1"==lmscourses.selcourseSysVal&&1==lmscoursedetails.currentCourseData[0].isPublished||"2"==lmscourses.selcourseSysVal&&lmscoursedetails.currentCourseData[0].isBatchPublished?lmscourses.publishCourse(e.courseId,this,e.type,e.courseType,t,lmscourses.selectedTab,lmscourses.currentBatchId,e):lmscourses.sendForModApproval(e.courseId,lmscourses.currentBatchId,this)},closePopUp:function(e,t){$(".zp_msk").hide(),lmscoursedetails.courseTabdetails.mode=t,"1"==lmscourses.selcourseSysVal&&(1==lmscoursedetails.currentCourseData[0].isPublished||1!=lmscoursedetails.currentCourseData[0].isPublished&&("1"==lms.selfSettingData.isSelfModerateOpt||lms.selfSettingData.isSelfUserModPerm||4==lmscoursedetails.currentCourseData[0].isPublished))||"2"==lmscourses.selcourseSysVal&&(lmscoursedetails.currentCourseData[0].isBatchPublished||!lmscoursedetails.currentCourseData[0].isBatchPublished&&("1"==lms.iltSettingData.isIltModerateOpt||lms.iltSettingData.isILTUserModPerm)||4==lmscoursedetails.currentCourseData[0].isModerateStatus)?lmscourses.publishCourse(lmscoursedetails.courseTabdetails.courseId,e,lmscoursedetails.courseTabdetails.type,lmscoursedetails.courseTabdetails.courseType,lmscoursedetails.ispublish,lmscourses.selectedTab,lmscourses.currentBatchId,lmscoursedetails.courseTabdetails):lmscourses.sendForModApproval(lmscoursedetails.courseTabdetails.courseId,lmscourses.currentBatchId,e)},startCourse:function(e){var t=document.getElementById("courseTabs"),s=t.querySelector('[class="sel"]'),r=t.querySelector('[_module="true"]');s&&lmsbase.removeClass(s,"sel"),r&&lmsbase.addClass(r,"sel");var l=lmscourses.currentCourseId,a=lmscoursedetails.componentUrl(l);lmscoursedetails.currentIndex=1,lmssessions.listOfMode="",lmscoursedetails.hashUrl=a+"/module",lmscourses.selectedTab="module",lmscoursedetails.addRecordCallback("zp.lms.modules.addmodule",lmsmodule.showAddModule),$(".zp_Lstwrap").addClass("zp_gy"),lmsmodule.initiate("startCourse"),lms.changeHash("hash",lmscoursedetails.hashUrl,"disable")},backtoCourse:function(){var e=window.location.href.split("#"),t=e[0].split("/");e[0]="",t[t.length-1]="zp#";for(var s=0;s<t.length;s++)t[s].includes("?")&&(ques=t[s].split("?"),ques[0]="zp?",t[s]=ques[0]+ques[1]),s==t.length-1?e[0]+=t[s]:e[0]+=t[s]+"/";e[0]+="lms/mydata/courses",lmscourses.addCourse=!1,window.location.replace(e[0])},sharedCourseTabs:function(e){var t=!1;return lmsbase.isAdmin(erecno)||lmscoursedetails.currentCourseData[0].isCourseOwner||lmscoursedetails.currentCourseData[0].iscourseTrainer||lmscoursedetails.currentCourseData[0].isJoined||!lmscoursedetails.currentCourseData[0].isSharedCourse||"Notes"!=e[0]&&"Discussion"!=e[0]&&"Feedback"!=e[0]||(t=!0),t},openPreview:function(){lmscourses.getCourseUrl(),window.open(lmscourses.getUrl)},addRecordCallback:function(e,t){if(!lmscourses.previewType)if($('[rel="moduleMenu"]')&&$('[rel="moduleMenu"]').remove(),$('[rel="memberMenu"]')&&$('[rel="memberMenu"]').remove(),"Add Files"==e||"Sessions"==e||"Add Session"==e||"Files"==e||"zp.lms.modules.addsession"==e||"zp.reports"==e||"zp.lms.component.display_name.prepostactivity"==e||"zp.lms.feedback.writefeedback"==e||(null!==lmscoursedetails.currentCourseData&&!lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0],"join")&&1!==lms.role||"Completed"==lmscoursedetails.isComplete&&("2"==lmscourses.selcourseSysVal&&!lmscourses.currentBatchId||"undefined"!=lmscourses.currentBatchId))&&"zp.lms.modules.addmodule"==e&&"zp.lms.coursedetails.notifytoall"!==e||"zp.lms.feedback.writefeedback"==e&&(3!==lms.role&&!1===lms.isUserHavingReportingTo&&"3"!==lms.commonSettingData.feedbackGivenBy&&"5"!==lms.commonSettingData.feedbackGivenBy||1!==lmscoursedetails.currentCourseData[0].canGiveFeedback||"2"===lms.settingData[0].commonSetting.whenCanGivenFeeeback&&!lmscoursedetails.currentCourseData[0].userCoursecompleteState))$("[data-id='addBtn']").hide(),$("[data-id='addBtn1']").hide();else if(null!==lmscoursedetails.currentCourseData&&(lmsbase.isUsercanAddModule(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0])&&"zp.lms.modules.addmodule"==e||"zp.lms.coursedetails.notifytoall"==e||"Add Members"==e&&lmsbase.isAddmemberallowed(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0]))&&"zp.lms.coursedetails.startadiscussion"!=e||"zp.lms.notes.addnote"==e||"zp.lms.coursedetails.startadiscussion"==e&&lmscoursedetails.currentCourseData[0].canUserStartDiscussion&&(isadmin||lms.isDataAdmin||lmscoursedetails.currentCourseData[0].isCourseAdmin||lmscoursedetails.currentCourseData[0].iscourseTrainer||lmscoursedetails.currentCourseData[0].iscourseUser)||"zp.lms.feedback.writefeedback"==e){if("zp.lms.modules.addmodule"==e){$("[data-id='addBtn']").hide(),$("[data-id='addBtn1']").hide();var s='<div class="zp_frt" rel="moduleMenu"><div class="zp_dropbtn"><div rel="moduleCloneMenu"><span rel="addModule">'+ZPI18N.getString("zp.lms.modules.addmodule")+'</span><i class="IC-adwn" rel="cloneMenu"></i></div></div></div>';$("[id='sample']").append(s),lmsbase.addListener(document.getElementById("sample"),"click",lmscoursedetails.clickPopupHandler,!1)}else if("Add Members"==e){$("[data-id='addBtn']").hide(),$("[data-id='addBtn1']").hide();s='<div class="zp_frt" rel="memberMenu"><div class="zp_dropbtn"><div rel="memberAddMenu"><span rel="addMemmberPopup">'+ZPI18N.getString("zp.lms.coursedetails.AddMembers")+'</span><i class="IC-adwn" rel="addMemberMenu"></i></div></div></div>';$("[id='sample']").append(s),lmsbase.addListener(document.getElementById("sample"),"click",lmscoursedetails.clickPopupHandler,!1)}else $("[data-id^='addBtn']").show(),$("[data-id^='addBtn']").find("button").text(lmsform.changetoI18N(e));"zp.lms.feedback.writefeedback"==e?($("[data-id^='addBtn']").find("button").click((function(){$("[id^=zp_addedit_record_]").remove(),t()})),"zp.lms.feedback.writefeedback"==e&&-1!==Layout.Page.hash.indexOf("/user?userinfo")&&(SingleFeedback.refer.courseId=$("#courseFeedBack").attr("courseId"),SingleFeedback.refer.batchId=$("#courseFeedBack").attr("batchId"),t()),"zp.lms.feedback.writefeedback"==e&&("1"==lmscourses.selcourseSysVal&&0==lmscoursedetails.currentCourseData[0].isPublished||"2"==lmscourses.selcourseSysVal&&0==lmscoursedetails.currentCourseData[0].isBatchPublished||"zp.lms.feedback.writefeedback"==e&&2!=lms.settingData[0].commonSetting.feedbackFor&&3!=lms.settingData[0].commonSetting.feedbackFor)&&$("[data-id^='addBtn']").hide()):"zp.lms.modules.addsession"==e?null!=lms.allTrainerData?$("[data-id^='addBtn']").find("button").click((function(){$("[id^=zp_addedit_record_]").remove(),t()})):$("[data-id^='addBtn']").find("button").click((function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.modules.noTrainerAdd"))})):$("[data-id^='addBtn']").find("button").click((function(){$("[id^=zp_addedit_record_]").remove(),t()}))}else $("[data-id='addBtn']").hide();lmscourses.previewType&&("zp.lms.notes.addnote"==e?($("[data-id='addBtn']").show(),$("[data-id^='addBtn']").find("button").text(ZPI18N.getString(e)),$("[data-id^='addBtn']").find("button").click((function(){$("[id^=zp_addedit_record_]").remove(),t()}))):$("[data-id='addBtn']").hide())},clickPopupHandler:function(e){var t=e.target,s=t.getAttribute("rel");s&&t.closest('[rel="addModule"]')?lmsmodule.showAddModule():s&&t.closest('[rel="cloneMenu"]')?lmscoursedetails.moduleCloneMenu(t,e):s&&t.closest('[rel="addMemberMenu"]')?lmscoursedetails.addMemberMenu(t,e):s&&t.closest('[rel="addMemmberPopup"]')&&(lmscoursedetails.addmemtabId=0,lmscoursemembers.addMembers())},addMemberMenu:function(e,t){lmsmenu.initiate({elem:e.closest('[rel="memberAddMenu"]'),width:"200px",type:"dropdown",arrowHead:!1,menulist:[{"usr/grp":[ZPI18N.getString("zp.lms.member.userandgroup")],req:[ZPI18N.getString("zp.lms.member.requestedusers")],OtherCourse:[ZPI18N.getString("zp.lms.member.othercourses")],import:[ZPI18N.getString("zp.lms.member.importcsv")]}],eve:t}).on("click",(function(){"usr/grp"==this.value?lmscoursedetails.addmemtabId=0:"req"==this.value?lmscoursedetails.addmemtabId=1:"OtherCourse"==this.value?lmscoursedetails.addmemtabId=2:"import"==this.value&&(lmscoursedetails.addmemtabId=3),lmscoursemembers.addMembers()})).bind()},moduleCloneMenu:function(e,t){lmsmenu.initiate({elem:e.closest('[rel="moduleCloneMenu"]'),width:"120px",type:"dropdown",arrowHead:!1,menulist:[{import:[ZPI18N.getString("zp.import")]}],eve:t}).on("click",(function(){"import"==this.value&&lmsclonecontent.initiate()})).bind()},geteditCourseRecord:function(e,t){$.each(t.courseDetails,(function(e,t){$(".zp_PhdrDtl").find("h4").text(t.courseName),$(".zp_PhdrDtl").find("font").html(t.trainerName),$($(".zp_PhdrDtl").find("em")[0]).html('<i class="IC-loc"></i>'+t.roomName+" Room,"+t.courseLocation),$($(".zp_PhdrDtl").find("em")[1]).html('<i class="IC-cal-month"></i>'+t.startDate)}))},close:function(){Layout.Page.container.find(".zp_content").show(),Layout.Page.container.find(".zp_fpv").hide(),lmscourses.currentBatchAdmin="",lmscourses.currentBatchId=""},resize:function(){lmscoursedetails.moreoptiondisplay()},getCourseEntityProgress:function(){var e="";if(""!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&(e=lmscourses.currentBatchId),null==lmscoursedetails.courseEntityData){var t={method:"getCourseEntityProgress",courseId:lmscourses.currentCourseId,batchId:e,modeOfView:"getfullView",conreqcsr:csrfToken};$.post("/courseAction.zp",t,(function(e){lmscoursedetails.courseEntityData=e[1];var t=lmscoursedetails.courseEntityData;if(lmscoursedetails.startCourseEntity=t.totalUserEntityCnt,t&&0!=t.totalEntityCnt){lmscoursedetails.totalEntityCnt=t.totalEntityCnt,lmscoursedetails.userEntityCnt=t.totalUserEntityCnt;var s=100*t.totalUserEntityCnt/t.totalEntityCnt;if(0!=lmscoursedetails.startCourseEntity){var r=document.querySelector('[_rel="startCourseDiv"]');r&&r.remove()}var l="";if(1==t.userCoursecompleteState){s=100*lmscoursedetails.userEntityCnt/t.totalEntityCnt;l+="<p><span>"+ZPI18N.getString("zp.lms.course.coursecompleted")+'</span></p><div><div class="zp_detprogbar" style="width:'+Math.round(s)+'%"></div></div></div>'}else{l="<p> <span>"+t.totalUserEntityCnt+" of "+t.totalEntityCnt+"</span>"+ZPI18N.getString("zp.lms.content.Completed")+'</p><div><div class="zp_detprogbar" style="width:'+Math.round(s)+'%"></div></div>';var a=document.getElementById("hideme").getAttribute("aria-label").match(new RegExp(`${ZPI18N.getString("zp.status")}:\\s*(\\d+)\\s*of\\s*(\\d+)`));if(a){a=`${ZPI18N.getString("zp.lms.course.completedentity",[a[1],a[2]])}`;var n=`${ZPI18N.getString("zp.lms.course.completedentity",[t.totalUserEntityCnt,t.totalEntityCnt])}`,i=document.querySelector(`[aria-label*="${a}"]`);i&&i.setAttribute("aria-label",i.getAttribute("aria-label").replace(a,n))}}$("#courseProgress").html(l),1==lmsEntityView.entityPreview&&$('[_rel="coursePercentage"]').html(lmsEntityLayoutBuilder.constructCourseProgressBar(t.totalUserEntityCnt,t.totalEntityCnt,s))}lmscoursedetails.isComplete=t.courseCompleted,t.courseCompleted&&lmscourses.completCourse.userCourseComplete()})),lmscourses.isentityupdated=!0}},getMoreCategory:function(e){if(e.courseCategoryInfo.length>3){$(".zp_msk").html("");'<div class="zp_Pohd"><font>Category</font><i class="IC-cls" onclick="lmscourseoverview.closePopUp()"></i></div>','<div class="zp_Pocnt" style="max-height:500px;"> <ul class="zp_CPlst" id="catullist">',"</ul></div></div>",$(".zp_msk").append('<div class="zp_popup" id="zp_popeight" style="width:600px"><div class="zp_Pohd"><font>Category</font><i class="IC-cls" onclick="lmscourseoverview.closePopUp()"></i></div><div class="zp_Pocnt" style="max-height:500px;"> <ul class="zp_CPlst" id="catullist"></ul></div></div>'),$(".zp_msk").show(),$.each(e.courseCategoryInfo,(function(e,t){var s="<li><h4>"+t.category+"</h4></li>";$("#catullist").append(s)}))}},getCurrentCourseBaseHash:function(){return"course/"+lmscourses.currentCourseId+(lmscourses.currentBatchId?"/batch/"+lmscourses.currentBatchId:"")},scrollListener:function(e){"feedback"==lmscourses.selectedTab&&lmscoursedetails.courseFeedbackView&&lmscoursedetails.courseFeedbackView.onscroll(e)},reloadCurrentCourse:function(){var e=this.getCurrentCourseBaseHash()+"/overview";lms.changeHash("hash",e,"enable")},hardReloadCurrentCourse:function(){if(-1===window.location.hash.indexOf("overview")){var e=this.getCurrentCourseBaseHash()+"/overview";lmscourses.currentCourseId="",lmscourses.currentBatchId="",lms.changeHash("hash",e,"enable")}else window.location.reload()},changeTab:function(e){var t=this.getCurrentCourseBaseHash()+"/"+e;lms.changeHash("hash",t,"enable")},onload:function(){var e=function(){lmscourses.addListener(lmscourses.EVENT_TYPE.COURSE_COMPLETION,lmscoursedetails.onLearnerCompletedTheCourse),lmscourses.addListener(lmscourses.EVENT_TYPE.BULK_ENROLL,lmscoursedetails.onBulkEnrollCompleted),lmsbase.removeListener(window,"DOMContentLoaded",e)};lmsbase.addListener(window,"DOMContentLoaded",e)}(),onLearnerCompletedTheCourse:function(e){lms_pre_and_post_course_activities.getCourseContainer(e.courseId,e.batchId)&&lmsnotify.show({header:ZPI18N.getString("zp.lms.learner.coursecompleted.info.header"),body:ZPI18N.getString("zp.lms.learner.coursecompleted.info.body"),button_text:ZPI18N.getString("zp.refresh"),cancel_button_text:ZPI18N.getString("zp.lms.button.doItLater"),texttype:"positive",successCallback:function(){this.status?(1==lmsEntityView.entityPreview&&(document.querySelector(".zp_fmsk").remove(),lmsEntityView.entityPreview=!1),document.body.classList.remove("zp_Tcfpv"),lmscoursedetails.hardReloadCurrentCourse()):lmscoursedetails.refreshCourseProgress()},cancelCallback:function(){lmscoursedetails.refreshCourseProgress()}})},onBulkEnrollCompleted(e){e.courseId===lmscourses.currentCourseId&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.messages.membersaddedSuccessfully")),-1!==window.location.hash.indexOf("/members")&&-1===window.location.hash.indexOf("?memberinfo/")&&e.enrolledUsersCount&&lmscoursemembers.fetchCourseMembersList())},refreshCourseProgress:function(){lmscoursedetails.courseEntityData=null,lmscoursedetails.getCourseEntityProgress()},createViewModeMenu:function(e,t,s){lmscoursegrade.gradeSetting;var r=lmscoursedetails.currentCourseData[0].isCourseOwner,l=lmscoursedetails.currentCourseData[0].isCourseAdmin,a=lmscoursedetails.currentCourseData[0].isCourseTrainer,n=[];r||l?n.push({adminview:[ZPI18N.getString("zp.lms.courseadmin")]}):a&&n.push({trainerview:[ZPI18N.getString("zp.local.Trainer")]}),lmscoursedetails.isUserMappedToCourse&&n.push({learnerview:[ZPI18N.getString("zp.lms.learner")]}),lmsmenu.initiate({elem:e,width:"200px",type:"dropdown",arrowHead:!1,menulist:n,eve:s}).on("click",(function(){var e=this.value,t=window.location.href.split("#"),s=t[0].split("/");t[0]="",s[s.length-1]="training";for(var r=0;r<s.length;r++)s[r].includes("?")&&(ques=s[r].split("?"),ques[0]="training?",s[r]=ques[0]+ques[1]),r==s.length-1?t[0]+=s[r]:t[0]+=s[r]+"/";var l=lmscourses.currentCourseId,a="";a=""!=lmscourses.currentBatchId&&"undefined"!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId?"course/"+l+"/batch/"+lmscourses.currentBatchId+"/"+lmscourses.selectedTab:"course/"+l+"/"+lmscourses.selectedTab;var n=window.location.hash.split("/")[0];"learnerview"!=e||"#lms-adminview"!=n&&"#lms-trainerview"!=n?"adminview"==e&&"#lms-learnerview"==n?(n=n.split("-")[0]+"-adminview",lmscoursedetails.currentCourseData=null,lmscoursedetails.disableComponentData=null):"trainerview"==e&&"#lms-learnerview"==n&&(n=n.split("-")[0]+"-trainerview",lmscoursedetails.currentCourseData=null,lmscoursedetails.disableComponentData=null):(n=n.split("-")[0]+"-learnerview",lmscoursedetails.currentCourseData=null,lmscoursedetails.disableComponentData=null),t[0]+=n+"/"+a,window.location.href=t[0]})).bind()},getLearnerEntityProgressbar:function(e){null!=e&&"Mandatory Items"!=e&&""!=e||(e="getfullView");var t={method:"getCourseEntityProgress",courseId:lmscourses.currentCourseId,batchId:lmscourses.currentBatchId,modeOfView:e,viewbased:"fromlearner",user:erecno,conreqcsr:csrfToken};$.post("/courseAction.zp",t,(function(t){if(null!=t[1])if("All"!=e)lmscoursemembers.memberinfo.memberProgress(t[1],"banner");else{var s=lmscoursemembers.memberinfo.getPedningActivityhtml(t[1],"banner");$("#pgbaractivity").html(""),$("#pgbaractivity").append(s),$("#poppupcomplete").text(t[1].completionPercentage+"%")}}))},getCourseLabel:function(e,t,s,r,l){let a=`${ZPI18N.getString("zp.lms.course.view")} ${e}`;if(r&&r.length>0){const e=[];$.each(r,(function(t,s){if(r.length>3&&3===t)return!1;e.push(s.category)}));const t=r.length>3?`, ${ZPI18N.getString("zp.more")}`:"";s+=`${e.join(", ")}${t}`}if("3"==lmscourses.selcourseSysVal)s&&(a+=`, ${ZPI18N.getString("zp.category")}: ${s}`);else{const e=t.empName||t.name||"";a+=s?`, ${ZPI18N.getString("zp.category")}: ${s}, ${ZPI18N.getString("zp.lms.course")} ${ZPI18N.getString("zp.lms.course.createdby")}: ${e}`:`, ${ZPI18N.getString("zp.lms.course")} ${ZPI18N.getString("zp.lms.course.createdby")}: ${e}`}let n=100*l.totalUserEntityCnt/l.totalEntityCnt,i=ZPI18N.getString("zp.lms.content.Completed"),o=!1;if(lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0],"join")||(o=l.isUserGroupBased),l.isJoined||o&&!lmscourses.isCourseAdmin){(l.userCoursecompleteState&&100===n||"2"===lmscourses.selcourseSysVal&&"Completed"===l.batchCompleteState&&100===Math.round(n))&&(i=ZPI18N.getString("zp.lms.course.coursecompleted")),l.userCoursecompleteState&&(n=100);(!lms_pre_and_post_course_activities.hasAnyPreCourseActivities(l)||!lms_pre_and_post_course_activities.hasAnyPendingPreCourseActivities(l))&&l.isUserJoined&&lmscoursedetails.ispublish&&(a+=`, ${ZPI18N.getString("zp.status")}: `,l.userCoursecompleteState?a+=i:a+=`${ZPI18N.getString("zp.lms.course.completedentity",[l.totalUserEntityCnt,l.totalEntityCnt])}`)}return a+=`, ${ZPI18N.getString("zp.common.cancelpopup")}`,a}},lms_pre_and_post_course_activities={onload:function(){var e=function(){lmstest.addListener(lmstest.EVENT_TYPE.ATTEMPT_COMPLETION,lms_pre_and_post_course_activities.onTestCompleted),lmstest.addListener(lmstest.EVENT_TYPE.TEST_SKIPPED,lms_pre_and_post_course_activities.onTestSkipped),lmsfeedback_v1.addListener(lmsfeedback_v1.EVENT_TYPE.FEEDBACK_COMPLETION,lms_pre_and_post_course_activities.onFeedbackCompleted),lmsfeedback_v1.addListener(lmsfeedback_v1.EVENT_TYPE.FEEDBACK_SKIPPED,lms_pre_and_post_course_activities.onFeedbackSkipped),lmsbase.removeListener(window,"DOMContentLoaded",e)};lmsbase.addListener(window,"DOMContentLoaded",e)}(),getCurrentCourseInfo:function(){return lmscoursedetails.currentCourseData&&lmscoursedetails.currentCourseData[0]},hasAnyPreCourseActivities:function(e){return e&&e.pre_course_activities_details},hasAnyPendingPreCourseActivities:function(e){return!e.pre_course_activities_details.hasUserCompleted},hasAnyPostCourseActivities:function(e){return e&&e.post_course_activities_details},hasAnyPendingPostCourseActivities:function(e){return!e.post_course_activities_details.hasUserCompleted},hasAnyPendingMandatoryPostCourseActivities:function(e){return lms_pre_and_post_course_activities.hasAnyPendingMandatoryCourseActivities(e.post_course_activities_details)},hasAnyPostTest:function(e){return Boolean(lms_pre_and_post_course_activities.getPostTestInfo(null,e))},hasAnyPendingPostTest:function(e){var t=lms_pre_and_post_course_activities.getPostTestInfo(null,e);return!(t.hasUserCompletedTheTest||t.hasUserSkippedTheTest)},hasAnyPendingMandatoryPostTest:function(e){var t=lms_pre_and_post_course_activities.getPostTestInfo(null,e);return!(t.hasUserCompletedTheTest||t.hasUserSkippedTheTest)&&t.isMandatory},hasAnyFeedback:function(e){return Boolean(lms_pre_and_post_course_activities.getFeedbackInfo(null,null,e))},hasAnyPendingFeedback:function(e){var t=lms_pre_and_post_course_activities.getFeedbackInfo(null,null,e);return!(t.hasUserCompleted||t.hasUserSkipped)},doesUserHaveGrade:function(e){var t=lms_pre_and_post_course_activities.getPostCourseActivityInfo();return t&&t.doesUserHaveGrade},hasAnyPendingMandatoryFeedback:function(e){var t=lms_pre_and_post_course_activities.getFeedbackInfo(null,null,e);return!(t.hasUserCompleted||t.hasUserSkipped)&&t.isMandatory},getPreTestInfo:function(e){var t=lmscoursedetails.currentCourseData&&lmscoursedetails.currentCourseData[0],s=t.pre_course_activities_details;return t&&s&&lms_pre_and_post_course_activities.getEntityInfo(s,"testId",e)},getPostTestInfo:function(e,t){var s=(t=t||lmscoursedetails.currentCourseData&&lmscoursedetails.currentCourseData[0]).post_course_activities_details;return t&&s&&(e?lms_pre_and_post_course_activities.getEntityInfo(s,"testId",e):lms_pre_and_post_course_activities.getEntityInfo(s,"entityType",8))},getFeedbackInfo:function(e,t,s){var r=(s=s||lmscoursedetails.currentCourseData&&lmscoursedetails.currentCourseData[0]).post_course_activities_details;if(s&&r){var l=lms_pre_and_post_course_activities.getEntityInfo(r,"entityType",lmsfeedback.constants.ENTITY_TYPE);if(!e)return l;if(l.courseId==e&&l.batchId==t)return l}},getTestInfo:function(e,t){return lms_pre_and_post_course_activities.getEntityInfo(e,"testId",t)},getEntityInfo:function(e,t,s){for(var r=e.entities,l=0;l<r.length;l++){var a=r[l];if(a[t]==s)return a}},hasAnyPendingMandatoryCourseActivities:function(e){for(var t=e.entities,s=0;s<t.length;s++){var r=t[s];switch(r.entityType){case 10:if(!r.hasUserCompleted&&!r.hasUserSkipped&&r.isMandatory)return!0;break;case 8:if(!r.hasUserCompletedTheTest&&!r.hasUserSkippedTheTest&&r.isMandatory)return!0}}return!1},areAllEntitiesCompleted:function(e){for(var t=e.entities,s=0;s<t.length;s++){var r=t[s];switch(r.entityType){case 10:if(!r.hasUserCompleted&&!r.hasUserSkipped)return!1;break;case 8:if(!r.hasUserCompletedTheTest&&!r.hasUserSkippedTheTest)return!1;break;case 2:if(!r.hasUserCompleted)return!1}}return!0},getPreCourseActivityInfo:function(){var e=lmscoursedetails.currentCourseData&&lmscoursedetails.currentCourseData[0];return e&&e.pre_course_activities_details},getPostCourseActivityInfo:function(){var e=lmscoursedetails.currentCourseData&&lmscoursedetails.currentCourseData[0];return e&&e.post_course_activities_details},hasAnyInModulePostCourseActivities:function(e){return e&&getInModulePostCourseActivityInfo(e)},hasAnyPendingInModulePostActivities:function(e){return!getInModulePostCourseActivityInfo(e).hasUserCompleted},getInModulePostCourseActivityInfo:function(){var e=lms_pre_and_post_course_activities.getPostCourseActivityInfo();if(e)return lms_pre_and_post_course_activities.getEntityInfo(e,"entityType","2")},getInModulePostTestInfo:function(e){var t=lms_pre_and_post_course_activities.getInModulePostCourseActivityInfo();if(t)return lms_pre_and_post_course_activities.getEntityInfo(t,"testId",e)},getCourseContainer:function(e,t){return document.querySelector("#courseContainer[courseId='"+e+"']"+(t?"[batchId='"+t+"']":""))},constructPostCourseActivityHeaderButton:function(){var e=lms_pre_and_post_course_activities.getPostCourseActivityInfo(),t=lms_pre_and_post_course_activities.getCourseContainer(e.courseId,e.batchId);if(t){var s=t.querySelector("[container=post_course_activity_button]");s&&lms_pre_and_post_course_activities.constructCourseActivityHeaderButton(e,s)}},constructCourseActivityHeaderButton:function(e,t){for(var s=e.entities,r=0;r<s.length;r++){var l=s[r];if(8===l.entityType)if(l.canUserTakeAttempt&&!l.hasUserSkippedTheTest)return void lms_pre_and_post_course_activities.constructTestButton(l,t)}},constructTestButton:function(e,t){(t=zplms.replaceWithClone(t)).innerHTML='<button tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'">'+ZPI18N.getString("zp.lms.test.takeTest")+"</button>";var s=t.childNodes[0];s.setAttribute("_rel","takeTest"),s.setAttribute("testId",e.testId),lmsbase.addListener(t,"click",(function(){lmstest.takeTest(e.assessmentId)}))},constructFeedbackButton:function(e,t){(t=zplms.replaceWithClone(t)).innerHTML="<button>"+ZPI18N.getString("zp.lms.feedback.writefeedback")+'<i class="IC-comment"></i></button>',t.childNodes[0].setAttribute("_rel","writeFeedback"),lmsbase.addListener(t,"click",(function(){lmsfeedback_v1.writeFeedback(e.courseId,e.batchId)}))},createPreCourseActivityView:function(e,t){var s=e.pre_course_activities_details,r=document.createElement("div");r.className="zp_Aslst",r.setAttribute("container","pre_course_activities_view");var l='<i class="IC-CT"></i><div tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+ZPI18N.getString("zp.lms.course.pretest",[e.courseName])+'"><h5>'+ZPI18N.getString("zp.lms.test.preTest.learner.intermediateCard.header")+'</h5><div class="zp_PTlst"><div><ul entityContainer class="zp_PTlist"></ul></div></div><div class="zp_btn"><button continue class="zpthm">'+ZPI18N.getString("zp.continue")+"</button></div></div>";r.innerHTML=l;var a=r.querySelector("[entityContainer]");a.removeAttribute("entityContainer");for(var n=s.entities,i=0;i<n.length;i++){var o=n[i];a.appendChild(this.getEntityNode(o,i))}var c=r.querySelector("[continue]");s.hasUserCompleted?(c.setAttribute("tabindex",lmsConstants.TAB_INDEX.ACTIVE),c.setAttribute("aria-label",ZPI18N.getString("zp.lms.course.resume",[e.courseName]))):(c.setAttribute("tabindex",lmsConstants.TAB_INDEX.INACTIVE),lmsbase.addClass(c,"disabled")),lmsbase.addListener(c,"click",(function(){lmscoursedetails.reloadCurrentCourse(),lmscoursedetails.getCourseEntityProgress()})),t.appendChild(r)},createPostCourseActivityView:function(e){var t=e.post_course_activities_details,s=document.createElement("div");s.className="zp_Aslst",s.setAttribute("container","post_course_activities_view");var r=document.querySelector("#courseContainer [_rel='startCourseDiv'] [_rel='downloadCertificateLMS']"),l=document.querySelector("#courseContainer #courseTabs [tabName=grade]"),a='<i class="IC-CT"></i><div><h5>'+ZPI18N.getString("zp.lms.postCourseActivities.overview.card.header")+'</h5><div class="zp_PTlst"><div><ul entityContainer class="zp_PTlist"></ul></div></div><div buttonContainer class="zp_btn">'+(l||t&&t.canUserViewGrade?'<button view class="zpthm">'+ZPI18N.getString("zp.lms.button.viewGrade")+"</button>":"")+(r?'<button download class="zpthm">'+ZPI18N.getString("zp.lms.certificate.downloadcertificate")+"</button>":"")+"</div></div>";s.innerHTML=a;var n=s.querySelector("[entityContainer]");if(n.removeAttribute("entityContainer"),t)for(var i=t.entities,o=0;o<i.length;o++){var c=i[o];n.appendChild(this.getEntityNode(c))}var d=s.querySelector("[download]");d&&lmsbase.addListener(d,"click",(function(){lmscoursecertificate.downloadFun()}));var m=s.querySelector("[view]");m&&lmsbase.addListener(m,"click",(function(){lmscoursedetails.changeTab("grade")}));var u=s.querySelector("[buttonContainer]");return null==t||t.doesUserHaveGrade||lmsbase.addClass(u,"disabled"),s},getEntityId:function(e){if(8==e.entityType||7==e.entityType)return e.testId},getEntityNode:function(e,t){var s;if(8==e.entityType?s=0==e.type?this.convertInModuleOnlineTestElement(e):this.convertTestInfoAsElement(e,t):10==e.entityType?(lmscoursedetails.isMandatoryFeedback=e.isMandatory,s=this.convertFeedbackInfoAsElement(e)):2==e.entityType?s=this.convertModuleInfoAsElement(e):11==e.entityType&&(s=this.convertManagerEvaluationInfoAsElement(e)),s)switch(s.entityInfo=e,e.entityType){case 10:s.setAttribute("courseId",e.courseId),e.batchId&&s.setAttribute("batchId",e.batchId),s.setAttribute("entityType","feedback");break;case 2:s.setAttribute("courseId",e.courseId),e.batchId&&s.setAttribute("batchId",e.batchId),s.setAttribute("entityType","InModule");break;default:s.setAttribute("entityId",this.getEntityId(e))}return s},convertTestInfoAsElement:function(e,t){t=null!=t?t:0;var s=document.createElement("li");if(s.setAttribute("testId",e.testId),s.setAttribute("tabindex",lmsConstants.TAB_INDEX.ACTIVE),0===parseInt(e.reviewStatus)?s.setAttribute("aria-label",ZPI18N.getString("zp.lms.course.testyetreviewed",[lmscoursedetails.currentCourseData[0].courseName])):s.setAttribute("aria-label",`${ZPI18N.getString("zp.lms.activity")} ${t+1} - ${e.testName}, ${ZPI18N.getString("zp.type")} : ${ZPI18N.getString("zp.lms.test.onlineTest")}, ${ZPI18N.getString("zp.lms.duration")}: ${e.duration}`),s.testInfo=e,s.innerHTML='<i class="IC-rdo-cir-1'+(e.hasUserCompletedTheTest||e.hasUserSkippedTheTest?' sel"':'"')+'></i><div><div><i class="IC-OT"></i><div '+(0===parseInt(e.reviewStatus)?"":'tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'"')+"><h5><font>"+e.testName+'</font></h5><p><em class="zp_ldot">'+ZPI18N.getString("zp.type")+": <b>"+ZPI18N.getString("zp.lms.test.onlineTest")+"</b></em>"+(e.duration?'<em class="zp_ldot">'+ZPI18N.getString("zp.lms.duration")+":"+e.duration+"</em>":"")+(e.startDate?'<em class="zp_ldot">'+ZPI18N.getString("zp.lms.startdate")+": <b>"+e.startDate+"</b></em>":"")+(e.isMandatory?'<em class="zp_ylclr zp_ldot">'+ZPI18N.getString("zp.lms.mandatory")+"</em>":"")+"</p>"+(0===parseInt(e.reviewStatus)?'<font class="zp_notinf bgylw"><span><i class="IC-rvwpnd"></i>'+e.status+"</span></font>":"")+'</div></div><div><div class="zp_btn">'+(e.canUserSkipTest?'<button skipTest class="zpactn" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'">'+ZPI18N.getString("zp.skip")+"</button>":"")+(e.canUserTakeAttempt?'<button takeTest tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'">'+(e.numberOfAttemptsTaken>0?ZPI18N.getString("zp.lms.test.takeAnotherAttempt"):ZPI18N.getString("zp.lms.test.takeTest"))+"</button>":"")+"</div></div></div>",e.canUserSkipTest){var r=s.querySelector("[skipTest]");r.removeAttribute("skipTest"),lmsbase.addListener(r,"click",(function(){lmstest.skipTest(e.testId)}))}if(e.canUserTakeAttempt){var l=s.querySelector("[takeTest]");l.removeAttribute("takeTest"),lmsbase.addListener(l,"click",(function(){lmstest.takeTest(e.assessmentId)}))}return s},convertFeedbackInfoAsElement:function(e){var t=document.createElement("li");if(t.feedbackInfo=e,t.innerHTML='<i class="IC-rdo-cir-1'+(e.hasUserCompleted||e.hasUserSkipped?' sel"':'"')+'></i><div><div><i class="IC-feedback"></i><div><h5><font>'+ZPI18N.getString("zp.feedback")+'</font></h5><p><em class="zp_ldot">'+ZPI18N.getString("zp.type")+": <b>"+ZPI18N.getString("zp.feedback")+"</b></em>"+(e.startDate?'<em class="zp_ldot">'+ZPI18N.getString("zp.lms.startdate")+": <b>"+e.startDate+"</b></em>":"")+(e.isMandatory?'<em class="zp_ylclr zp_ldot">'+ZPI18N.getString("zp.lms.mandatory")+"</em>":"")+'</p></div></div><div><div class="zp_btn">'+(e.canUserSkipFeedback?'<button skip class="zpactn">'+ZPI18N.getString("zp.skip")+"</button>":"")+(e.canUserGiveFeedback?"<button write>"+ZPI18N.getString("zp.lms.feedback.writefeedback")+"</button>":"")+"</div></div></div>",e.canUserSkipFeedback){var s=t.querySelector("[skip]");s.removeAttribute("skip"),lmsbase.addListener(s,"click",(function(){lmsfeedback_v1.skipFeedback(e.courseId,e.batchId)}))}if(e.canUserGiveFeedback){var r=t.querySelector("[write]");r.removeAttribute("write"),lmsbase.addListener(r,"click",(function(){lmsfeedback_v1.writeFeedback(e.courseId,e.batchId)}))}return t},convertModuleInfoAsElement:function(e){var t=document.createElement("li");t.moduleInfo=e,t.className="pdopn",t.innerHTML='<i class="IC-rdo-cir-1'+(e.hasUserCompleted?' sel"':'"')+'></i><div><div><i class="IC-CT"></i><div><h5><font>'+ZPI18N.getString("zp.lms.moduleActivities")+'</font></h5></div></div></div><div container="listing" class="zp_pdlst"></div>';var s=t.querySelector("[container=listing]");s.removeAttribute("container");for(var r=e.entities,l=0;l<r.length;l++){var a=r[l];s.appendChild(this.getEntityNode(a,l))}return t},convertInModuleOnlineTestElement:function(e){var t=document.createElement("div");t.setAttribute("testId",e.testId),t.testInfo=e;var s='<i class="IC-CT"></i><a action="view">'+e.testName+"</a>"+(e.canUserTakeAttempt?'<div><div class="zp_btn" action="takeTest"><button class="zpthm">'+ZPI18N.getString("zp.lms.test.takeTest")+"</button></div></div>":"");t.innerHTML=s;var r=t.querySelector("[action=view]");if(r.removeAttribute("action"),lmsbase.addListener(r,"click",(function(){lmscoursedetails.changeTab("module"),setTimeout((function(){lmstest.viewOnlineTestInfo(e)}))})),e.canUserTakeAttempt){var l=t.querySelector("[action=takeTest]");l.removeAttribute("action"),lmsbase.addListener(l,"click",(function(){lmstest.takeTest(e.assessmentId)}))}return t},convertManagerEvaluationInfoAsElement:function(e){var t=document.createElement("li");if(t.managerEvaluationInfo=e,t.innerHTML='<i class="IC-rdo-cir-1'+(e.hasUserCompleted||e.hasUserSkipped?' sel"':'"')+'></i><div><div><i class="IC-mngevl"></i><div><h5><font>Manager Evaluation</font></h5><p><em class="zp_ldot">'+ZPI18N.getString("zp.type")+": <b>Manager Evaluation</b></em>"+(e.startDate?'<em class="zp_ldot">'+ZPI18N.getString("zp.lms.startdate")+": <b>"+e.startDate+"</b></em>":"")+'<em class="zp_ylclr zp_ldot">'+(e.isSkipped?ZPI18N.getString("zp.skiped"):ZPI18N.getString("zp.lms.mandatory"))+'</em></p></div></div><div><div class="zp_btn">'+(e.canUserViewEvaluation?"<button viewEvaluation>View Evaluation</button>":"")+"</div></div></div>",e.canUserViewEvaluation){var s=t.querySelector("[viewEvaluation]");s.removeAttribute("viewEvaluation"),lmsbase.addListener(s,"click",(function(){lmsmanagerevaluationView.viewEvaluationForLearner(lmscourses.currentCourseId,lmscourses.currentBatchId)}))}return t},onTestSkipped:function(e){lms_pre_and_post_course_activities.onTestCompleted(e)},onTestCompleted:function(e){var t,s,r=e.testInfo.testId,l=document.getElementById("courseContainer");if(l){var a=l.querySelector("[_rel='takeTest'][testId='"+r+"']");a&&a.parentNode&&a.parentNode.removeChild(a),(t=l.querySelector("[overview_container] [PostCourseAssessmentNotify][testId='"+r+"']"))&&t.parentNode&&t.parentNode.removeChild(t),(s=l.querySelector("[overview_container] [PreCourseAssessmentNotify][testId='"+r+"']"))&&s.parentNode&&s.parentNode.removeChild(s);var n=l.querySelector("[container='pre_course_activities_view'] [testId='"+r+"']");if(n||(n=l.querySelector("[container='post_course_activities_view'] [testId='"+r+"']")),n&&n.parentNode){var i=n.testInfo;for(var o in e.testInfo)i[o]=e.testInfo[o];n.parentNode.replaceChild(lms_pre_and_post_course_activities.getEntityNode(i),n)}}if(lmsnotify._elem&&lmsnotify._elem.getAttribute("testId")==r&&lmsnotify.close(),i=lms_pre_and_post_course_activities.getPreTestInfo(r)){for(var o in e.testInfo)i[o]=e.testInfo[o];lms_pre_and_post_course_activities.onPreCourseActivityCompleted(i)}else if(i=lms_pre_and_post_course_activities.getPostTestInfo(r)){for(var o in e.testInfo)i[o]=e.testInfo[o];lms_pre_and_post_course_activities.onPostCourseActivityCompleted(i)}else if(i=lms_pre_and_post_course_activities.getInModulePostTestInfo(r)){for(var o in e.testInfo)i[o]=e.testInfo[o];lms_pre_and_post_course_activities.onInModulePostCourseActivityCompleted(i)}},onFeedbackSkipped:function(e){lms_pre_and_post_course_activities.onFeedbackCompleted(e,!0)},onFeedbackCompleted:function(e,t){var s=lms_pre_and_post_course_activities.getCourseContainer(e.feedbackInfo.courseId,e.feedbackInfo.batchId);if(s){var r=s.querySelector("[container='post_course_activities_view'] [entityType=feedback]");if(r&&r.parentNode){var l=r.feedbackInfo;for(var a in e.feedbackInfo)l[a]=e.feedbackInfo[a];r.parentNode.replaceChild(lms_pre_and_post_course_activities.getEntityNode(l),r)}var n=s.querySelector("[_rel='writeFeedback']");n&&n.parentNode&&n.parentNode.removeChild(n)}if(l=lms_pre_and_post_course_activities.getFeedbackInfo(e.feedbackInfo.courseId,e.feedbackInfo.batchId)){for(var a in e.feedbackInfo)l[a]=e.feedbackInfo[a];t||(courseInfo=lms_pre_and_post_course_activities.getCurrentCourseInfo(),courseInfo.canGiveFeedback=2),lms_pre_and_post_course_activities.onPostCourseActivityCompleted(l)}},onPreCourseActivityCompleted:function(e){lms_pre_and_post_course_activities.areAllEntitiesCompleted(lms_pre_and_post_course_activities.getPreCourseActivityInfo())&&lms_pre_and_post_course_activities.onAllPreCourseActivitiesCompleted()},onPostCourseActivityCompleted:function(e){lms_pre_and_post_course_activities.areAllEntitiesCompleted(lms_pre_and_post_course_activities.getPostCourseActivityInfo())?lms_pre_and_post_course_activities.onAllPostCourseActivitiesCompleted():(lms_pre_and_post_course_activities.constructPostCourseActivityHeaderButton(),lms_pre_and_post_course_activities.checkWhetherUserHasGradeAndUpdateUI())},onInModulePostCourseActivityCompleted:function(e){lms_pre_and_post_course_activities.areAllEntitiesCompleted(lms_pre_and_post_course_activities.getInModulePostCourseActivityInfo())&&lms_pre_and_post_course_activities.onAllInModulePostCourseActivitiesCompleted()},onAllInModulePostCourseActivitiesCompleted:function(){var e=lms_pre_and_post_course_activities.getInModulePostCourseActivityInfo();if(e){e.hasUserCompleted=!0;var t=lms_pre_and_post_course_activities.getCourseContainer(e.courseId,e.batchId);if(t){var s=t.querySelector("[container='post_course_activities_view'] [entityType=InModule]");s&&s.parentNode&&s.parentNode.replaceChild(lms_pre_and_post_course_activities.getEntityNode(e),s)}lms_pre_and_post_course_activities.onPostCourseActivityCompleted()}},onAllPreCourseActivitiesCompleted:function(){var e=lms_pre_and_post_course_activities.getPreCourseActivityInfo();if(e){e.hasUserCompleted=!0;var t=lms_pre_and_post_course_activities.getCourseContainer(e.courseId,e.batchId);if(t){var s=t.querySelector("[container='pre_course_activities_view']");if(s){var r=s.querySelector("[continue]");r&&(lmsbase.removeClass(r,"disabled"),r.setAttribute("tabindex",lmsConstants.TAB_INDEX.ACTIVE))}var l=t.querySelector("[_rel='startCourseDiv']");l&&l&&lmsbase.removeClass(l,"zp_dyn")}}},onAllPostCourseActivitiesCompleted:function(){var e=lms_pre_and_post_course_activities.getPostCourseActivityInfo();if(e){e.hasUserCompleted=!0,e.doesUserHaveGrade=!0;var t=lms_pre_and_post_course_activities.getCourseContainer(e.courseId,e.batchId);if(t){var s=t.querySelector("#courseTabs [tabName=grade]");s&&lmsbase.removeClass(s,"zp_dyn");var r=t.querySelector("[container='post_course_activities_view']");if(r){var l=r.querySelector("[buttonContainer]");l&&lmsbase.removeClass(l,"disabled")}var a=t.querySelector("[_rel='startCourseDiv']");a&&a&&lmsbase.removeClass(a,"zp_dyn"),lms_pre_and_post_course_activities_result.refreshPostCourseActivitiesResultsView()}}},enableGradeTab:function(){var e=lms_pre_and_post_course_activities.getPostCourseActivityInfo();if(e){var t=lms_pre_and_post_course_activities.getCourseContainer(e.courseId,e.batchId);if(t){var s=t.querySelector("#courseTabs [tabName=grade]");s&&lmsbase.removeClass(s,"zp_dyn")}}},enablePostActivityButtons:function(){var e=lms_pre_and_post_course_activities.getPostCourseActivityInfo();if(e){var t=lms_pre_and_post_course_activities.getCourseContainer(e.courseId,e.batchId);if(t){var s=t.querySelector("[container='post_course_activities_view']");if(s){var r=s.querySelector("[buttonContainer]");r&&lmsbase.removeClass(r,"disabled")}}}},hidePostActivityHeaderButtons:function(){var e=lms_pre_and_post_course_activities.getPostCourseActivityInfo();if(e){var t=lms_pre_and_post_course_activities.getCourseContainer(e.courseId,e.batchId);if(t){var s=t.querySelector("[container='post_course_activity_button']");s&&lmsbase.addClass(s,"zp_dyn")}}},enableCertificationButton:function(){var e=lms_pre_and_post_course_activities.getPostCourseActivityInfo();if(e){var t=lms_pre_and_post_course_activities.getCourseContainer(e.courseId,e.batchId);if(t){var s=t.querySelector("[_rel='startCourseDiv']");s&&s&&lmsbase.removeClass(s,"zp_dyn")}}},checkWhetherUserHasGradeAndUpdateUI:function(){var e=lms_pre_and_post_course_activities.getPostCourseActivityInfo();if(e){if(e.doesUserHaveGrade)return;var t={method:"doesUserHaveGrade",courseId:e.courseId,batchId:e.batchId||void 0,conreqcsr:csrfToken};$.post("/gradeSettingAction.zp",t,(function(t){t.status&&(e.doesUserHaveGrade=t.status,e.doesUserHaveGrade&&(lms_pre_and_post_course_activities.enableGradeTab(),lms_pre_and_post_course_activities.enableCertificationButton(),lms_pre_and_post_course_activities.enablePostActivityButtons(),lms_pre_and_post_course_activities.hidePostActivityHeaderButtons()))}))}}},lmslearningplan={root:{},addedPlanDetails:{},data:{},lockCourseId:{},selectedCourses:{},courseImg:{},isManagerView:!1,userId:"",uploadConfig:{multiple:!0,requiredFileTypes:"image",MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED:50,MAXSIZE:5242880},initiate:function(){lmslearningplan.root=this.elem,lmslearningplan.isManagerView="managerview"==this.hash.split("-")[1].split("/")[0],lmslearningplan.isManagerView&&(lmslearningplan.userId=this.hash.split("-")[1].split("/")[4]),lmslearningplan.getLearningPlanDetails(this.hashObject.level1,!1,void 0,{content:[null,ZPI18N.getString("zp.lms.trainers.ActiveCourses")]}),lmsbase.addListener(lmslearningplan.root,"click",lmslearningplan.clickHandler,!1)},changeLearningEditHash:function(e,t,s){if(""!=e&&"undefined"!=e&&null!=e&&"null"!=e&&null!=e){var r="learningplan/"+e;lmscourses.openOverview(r),s&&(lmslearningplan.addedPlanDetails.planInfo=t[1])}},createPlanMenu:function(e,t){if(e){var s=[{course:[ZPI18N.getString("zp.lms.course")]}];lmsbase.isAddCourseEnable();(isadmin||lms.settingData[0].settingPermission.isDataAdmin||lms.settingData[0].savedConfigData.isUserCanAdd[0]||lms.settingData[0].savedConfigData.isUserCanAdd.hasOwnProperty("zp.lms.learningplan"))&&(s=[{course:[ZPI18N.getString("zp.lms.course")]},{plan:[ZPI18N.getString("zp.lms.learningplan")]}]),lmsmenu.initiate({elem:e.closest('[rel="createPlan"]'),width:"130px",type:"dropdown",arrowHead:!1,menulist:s,eve:t}).on("click",(function(){if("course"==this.value)lmscourseconfig.showAddCourse();else if("plan"==this.value){var e=Math.floor(Math.random()*Math.floor(44));e+=1,lmslearningplan.addLearningPlan(e,!0)}})).bind()}},getLearningPlanDetails:function(e,t,s,r){var l={isForCard:t};val=null!=r?r.content[1]==ZPI18N.getString("zp.lms.trainers.ActiveCourses")?1:lmslearningplan.isManagerView?2:void 0:void 0,null!=val&&(l.mode=val),lmslearningplan.isManagerView&&(l.userId=lmslearningplan.userId),zplms.get("/lms/learningplans/"+e,l,(function(l){s?s(l):(lmslearningplan.addedPlanDetails=e?l[1][0]:l[1],t?t&&lmslearningplan.layoutConstruction(l[1][0],t):lmslearningplan.viewPlan(l[1][0],r))}))},layoutConstruction:function(e,t,s){var r="",l="",a="zpl_Crh";(e=e.planInfo?e.planInfo:e).lpImageInfo&&e.lpImageInfo.isSystemImage?(a="zpl_Crh CBg"+((l="null"!=e.image?e.image:1)%4+1),l=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+l+".svg")):null===e||e.lpImageInfo.isSystemImage||(e.lpImageInfo.additionalInfo={fileId:e.planId,type:8},l=lmsfileaction.generateSourceURL(e.lpImageInfo));var n=e.isUserCompletedPlan?ZPI18N.getString("zp.completed"):e.isUserJoinedPlan?ZPI18N.getString("zp.lms.course.joined"):ZPI18N.getString("zp.lms.course.coursejoinnow");t||(r+='<div class="zpl_Cr zpl_grpcrs" rel="lPlan" id="lPlan_'+e.planId+'">'),r+='<div rel="planOverview" id="planId_'+e.planId+'" style="background: url('+l+') right/cover" class="'+a+'"></div>';var i=e.isFavourite?1:0;e.isPlanOwner&&(r+='<i class="PI_more" rel="cardMore" id="cardMore_'+i+"_"+e.planId+'" title="'+ZPI18N.getString("zp.lms.more")+'"></i>',r+=lmslearningplan.constructLpMoreMenu(e.planId,e.publishState,e.disabled)),r+='<div class="zpl_Crc" rel="planOverview" id="planId_'+e.planId+'"><h4 rel="planOverview" id="planId_'+e.planId+'" title="'+e.planName+'">'+e.planName+"</h4>",r+='<label><em rel="planOverview" id="planId_'+e.planId+'">'+e.totalAvailableCourseCnt+" "+ZPI18N.getString("zp.lms.trainers.Courses")+"</em></label>",e.isPlanOwner||(e.isUserJoinedPlan?r+='<div><div class="zpl_whtbg '+(e.isUserCompletedPlan?"grn":"ylw")+'">'+(e.isUserCompletedPlan?ZPI18N.getString("zp.completed"):ZPI18N.getString("zp.chkinprogress"))+"</div></div>":r+='<div><button class="zlabel zlabel--blue zlabel--medium" rel="enrollPlan_'+e.planId+'" onclick="lmslearningplan.enrollPlan(\''+e.planId+"', 0)\">"+n+"</button></div>"),r+="</div>",t||(r+="</div>"),t?document.querySelector('[id="lPlan_'+e.planId+'"]')&&(document.querySelector('[id="lPlan_'+e.planId+'"]').innerHTML=r):s?(r=$(r),lmscourses._relem.querySelector('[_rel="courseList"]').insertBefore(r[0],lmscourses._relem.querySelector('[_rel="courseList"]').firstChild)):$("#courseList").append(r),e.isPlanOwner&&(ZPeopleComponents.isComponent(`#lpMore_${e.planId}`)&&(ZPeopleComponents.menu($(`#lpMore_${e.planId}`)).destroy(),$(`#lpMore_${e.planId}`).remove()),ZPeopleComponents.menu($(`#lpMore_${e.planId}`),{forElement:$("#courseList").find(`#cardMore_${i}_${e.planId}`),appendTo:$("#courseList"),itemclick:t=>{if(1==e.publishState){let t="";t="true"==e.disabled?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable"),lmslearningplan.disablePlan(e.planId+"",t)}else if(t.detail.attrs.id.includes("dellp")){let e=t.detail.attrs.rel;if(void 0!==e&&""!==e.trim()){let t=ZPI18N.getString("zp.lms.learningplan"),s=new DeleteAlertMessage;s.title=ZPI18N.getString("zp.lms.entitydelete",[t]),s.despcription=ZPI18N.getString("zp.lms.permenentlydelEntity",[t]),s.yesButtonText=ZPI18N.getString("zp.confirm"),s.cancelButtonText=ZPI18N.getString("zp.cancel"),s.callback=function(){lmslearningplan.deletePlan(e)},s.show()}}},show:e=>{e.detail.forElement.addClass("zpl_act")},hide:e=>{e.detail.forElement.removeClass("zpl_act")}}),$(`#cardMore_${i}_${e.planId}`).click((function(){lmslearningplan.showMoreMenu(e.planId)})))},constructLpMoreMenu:function(e,t,s){let r='<div id="lpMore_'+e+'" class="zpl_drpdwn" data-type="list" data-content-type="icon-text">';return r+='<li data-icon-class="'+(1==t?"true"==s?"PI_tick2":"PI_disable":"PI_delete")+'" id="dellp_'+e+'" rel="'+e+'" class="'+(1==t?"true"!=s?"red":"":"red")+'">'+(1==t?"true"==s?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable"):ZPI18N.getString("zp.delete"))+"</li>",r+="</div>",r},showMoreMenu:function(e){e&&ZPeopleComponents.menu($(`#lpMore_${e}`)).show()},enrolledMembers:function(){zplms.get("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/members",null,(function(e){lmslearningplan.constructEnrolledMembers(e[1].enrolledMembers),document.querySelector('[rel="memberCnt"]').innerHTML=e[1].enrolledMemberCnt}))},constructEnrolledMembers:function(e){$(".zp_msk").html("");var t='<div class="zp_popup fulhgt pad30" style="width:620px"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.learningplan.enrolledusers")+'</font><i class="IC-cls" onclick="lmslearningplan.closePopup()" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></div><div class="zp_Pocnt"><ul class="zp_CPlst zp_VS">';$.each(e,(function(e,s){t+='<li><div class="ZP_photo"><img src="'+s.image+'"><i class="IC-tck1"></i></div><h4><i>'+s.employeeId+"</i>"+s.name+"</h4><a>"+s.desigName+"</a>";var r=ZPI18N.getString("zp.lms.inprogress");-1==s.completedCourseCnt&&(r=ZPI18N.getString("zp.lms.content.Completed")),t+='<span class="zp_gclr">'+r+"</span></li>"})),t+="</ul></div></div>",$(".zp_msk").show(),$(".zp_msk").append(t)},addLearningPlan:function(e,t){var s={planName:document.querySelector('[rel="plan_name"]')&&""!=document.querySelector('[rel="plan_name"]').innerText.trim()&&document.querySelector('[rel="plan_name"]').innerText.length<100?document.querySelector('[rel="plan_name"]').innerText.trim():ZPI18N.getString("zp.lms.learningplan.untitled")};!t&&lmslearningplan.addedPlanDetails.planInfo&&void 0!==lmslearningplan.addedPlanDetails.planInfo.planId?s.planId=lmslearningplan.addedPlanDetails.planInfo.planId:s.image=e,zplms.post("/lms/learningplans",s,(function(e){"Added successfully"==e[1].msg?(lmslearningplan.isEdited=!0,t&&(lmslearningplan.changeLearningEditHash(e[1].planId,e[1],!0),lmslearningplan.layoutConstruction(e[1],void 0,!0))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.plannameempty"))}))},enrollPlan:function(e,t){zplms.post("/lms/learningplans/"+e+"/enroll",null,(function(s){"Enrolled successfully"==s[1].msg?0==t?(document.querySelector('[rel="enrollPlan_'+e+'"]').innerHTML="Joined",document.querySelector('[rel="enrollPlan_'+e+'"]').disabled=!0,lmslearningplan.changeLearningEditHash(e)):(document.querySelector('[rel="enrollPlanIn_'+e+'"]').innerHTML="Joined",document.querySelector('[rel="enrollPlanIn_'+e+'"]').disabled=!0,lmslearningplan.getLearningPlanDetails(lmslearningplan.addedPlanDetails.planInfo.planId,!1,void 0,{content:[null,ZPI18N.getString("zp.lms.trainers.ActiveCourses")]})):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.adminerrormsg"))}))},markUnmarkFavourite:function(e,t,s){var r={method:"markUnmarkFavourite",planId:e,conreqcsr:csrfToken};$.post("/learningPlanAction.zp",r,(function(r){1==t?(s.setAttribute("id","lpFav_1_"+e),s.classList.add("zpl_fav"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.addedtofavourites"))):(s.setAttribute("id","lpFav_0_"+e),s.classList.remove("zpl_fav"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.removedfromfavourites")))}))},createPlan:function(e){$(".zp_Rpane").remove(),lmslearningplan.addedPlanDetails={};var t=e%4+1;t="zp_Abgimg zp_photoscrn CBg"+t;var s=ZPI18N.getString("zp.sendforapproval");lms.settingData[0].lpData.isLPUserModPerm&&(s=ZPI18N.getString("zp.publish"));var r='<div class="zp_pwrap zp_tab" id="createLearningPlan"><div class="zp_ACttl zp_atlimg"><div class="'+t+'" style="background-image:url('+ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+e+".svg")+')" id="planBgImg" rel="planBgImg"><p>'+ZPI18N.getString("zp.change")+'</p></div><div class="zp_micn"><div class="zp_bgicn"><a href="https://www.zoho.com/people/help/adminguide/lms/learningplan.html" target="_blank" data-ttip="'+ZPI18N.getString("zp.lms.learningplan.lphelpdoclink")+'"><i class="IC-Hlp"></i></a></div><div class="zp_btn"><button rel="publishstatus" class="zpthm">'+s+'</button></div></div><h1><div contenteditable="true" id="planName" rel="plan_name" onfocusout="lmslearningplan.addLearningPlan()">'+ZPI18N.getString("zp.lms.learningplan.untitled")+'</div></h1><div class="zp_ACinf"><ul><li class="lnk"><i class="IC-clock"></i><font rel="setDuration">'+ZPI18N.getString("zp.lms.learningplan.setduration")+"</font></li><li><p>"+ZPI18N.getString("zp.lms.trainers.Courses")+' :</p><b id="courseCount">0</b></li><li><p>'+ZPI18N.getString("zp.lms.learningplanmsg.planowners")+' :</p><b rel="planOwners">1</b></li></ul></div></div><div class="zp_Acnt"><div class="zp_Alft"><div class="zp_ACcnt"><div class="zp_ACwel" id="description"><h5 class="zpA"><i class="IC-intro1"></i>'+ZPI18N.getString("zp.lms.learningplan.learningoutcomes")+'<div class="zp_asrgt"><i class="IC-Aedt" id="desc_body" rel="addplandetailsedit"></i></div></h5><div class="zpA"><div class="" id="showmoreorless" rel="addplandetails">'+ZPI18N.getString("zp.lms.learningplan.enterdesc")+'</div></div></div><div class="zp_ACwel" rel="addedCoursesDiv" id="showCouOpts" ><h5 class="zpA"><i class="IC-learn-plan"></i>'+ZPI18N.getString("zp.lms.learningplan.learningpath")+'<div class="zp_micn zp_actcrs" id="header1"><div class="zp_Sm zp_nobr mtp0" rel="showCouCrOpt" id="showCouCrOpt"></div><div class="zp_dropbtn"><div rel="addCouLev"><span rel="addCourse">'+ZPI18N.getString("zp.lms.course.coursecreate")+'</span><i class="IC-adwn" rel="addMenu"></i></div></div></div></h5><div id="addedCourses"><div class="ZPNdata" id="nomyc" style="display: flex !important;"><div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.learningplan.nocourseleveltag")+'</h3><p><a rel="addCourse">'+ZPI18N.getString("zp.lms.course.coursecreate")+"</a> "+ZPI18N.getString("zp.or")+' <a rel="addLevel">'+ZPI18N.getString("zp.lms.learningplan.addlevel")+"</a> "+ZPI18N.getString("zp.lms.learningplan.toinitiatecoulevel")+'</p></label></div></div></div></div></div></div><div class="zp_Argt"><div class="zp_ACrgcnt"><div class="zp_vopt"><h4>'+ZPI18N.getString("zp.lms.learningplan.enrollmentandoutcome")+"</h4><p>"+ZPI18N.getString("zp.lms.learningplan.enrollmentandoutcomedesc")+'</p><font class="zp_lnkblu"><p _rel="newRule"><i class="IC-plus" _rel="newRule"></i><span _rel="newRule">'+ZPI18N.getString("zp.lms.learningplan.createrule")+"</span></p></font></div></div></div></div></div>";document.getElementsByClassName("zp_pv training")[0].innerHTML+=r,$("#planName").focus(),lmslearningplan.SelectText("#planName",0,document.getElementById("planName").innerText.length-1),lmslearningplan.setCurrentCursorPosition(document.getElementById("planName").innerText.length,"planName"),document.getElementById("top_message_outer").parentElement.classList.add("zp_Pshw"),document.getElementById("lms").classList.add("assessment"),document.getElementsByClassName("zp_pv training")[0].classList.remove("zp_hpv"),document.getElementsByClassName("zp_pv training")[0].classList.add("zp_Apv"),lmsbase.addListener(document.getElementById("createLearningPlan"),"click",lmslearningplan.clickPopupHandler,!1),lmslearningplan.menuConstruction("showCouCrOpt"),$("#showCouCrOpt").hide(),$(document).on("keypress",(function(e){if(13==e.keyCode)return e.preventDefault(),!1})),$(document).ready((function(){$("#showmoreorless").each((function(){var e=$(this).html();if(e.length>1e3){var t=e.substring(0,1e3);e.substring(1e3,e.length);$(this).empty().html(t),$('<a href="javascript:void(0);" id="read-more" onclick=lmslearningplan.showMore()>'+ZPI18N.getString("zp.lms.learningplan.viewmore")+"</a>").insertAfter("#showmoreorless")}}))}))},SelectText:function(e,t,s){var r=$(e)[0],l=r.childNodes[0],a=r.childNodes[0];l.nodeValue=l.nodeValue.trim();var n=document.createRange();n.setStart(l,t),n.setEnd(a,s+1);var i=window.getSelection();i.removeAllRanges(),i.addRange(n)},createRange:function(e,t,s){if(s||((s=document.createRange()).selectNode(e),s.setStart(e,0)),0===t.count)s.setEnd(e,t.count);else if(e&&t.count>0)if(e.nodeType===Node.TEXT_NODE)e.textContent.length<t.count?t.count-=e.textContent.length:(s.setEnd(e,t.count),t.count=0);else for(var r=0;r<e.childNodes.length&&(s=lmslearningplan.createRange(e.childNodes[r],t,s),0!==t.count);r++);return s},setCurrentCursorPosition:function(e,t){if(e>=0){var s=window.getSelection();range=lmslearningplan.createRange(document.getElementById(t).parentNode,{count:e}),range&&(range.collapse(!1),s.removeAllRanges(),s.addRange(range))}},deletePlan:function(e){zplms.delete("/lms/learningplans/"+e,null,(function(t){"Plan deleted successfully"==t[1].msg?document.getElementById("planId_"+e).closest('[rel="lPlan"]').remove():"Plan can only be disabled after the publish"==t[1].msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.plandelpublishperm")):"Login user can't delete the plan"==t[1].msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.plandelnoperm")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.plandelhavemem"))}))},disablePlan:function(e,t,s){let r=lmsbase.constructMaskv5("zpl_mcenter",!0);lmslearningplan.disablePlanPopUp=r.appendChild(document.createElement("div")),lmslearningplan.disablePlanPopUp.className="zpl_minr",lmslearningplan.disablePlanPopUp.innerHTML=`<div class="zpl_mhder">\n                                                        <div><h4>${t+" "+ZPI18N.getString("zp.lms.learningplan")} </h4></div>\n                                                        <a class="_cls PI_cls" onclick="lmsbase.closeMaskv5()" title="${ZPI18N.getString("zp.lms.close")}"></a>\n                                                    </div>\n                                                    <div class="zpl_mcnt zpl_fm">\n                                                        <form>\n                                                            <div class="zpl_crd">\n                                                                <div class="zpl_crdcnt">\n                                                                    <div class="zpl_secn">\n                                                                        <div><label>${ZPI18N.getString("zp.lms.messages.comments")}</label></div>\n                                                                        <div>\n                                                                            <textarea class="ztextbox" id="cmnt_val" placeholder="${ZPI18N.getString("zp.apprCmtMandatoryErr")}"></textarea>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </form>\n                                                    </div>`;let l='<div class="zpl_mfoter"><button class="zlabel zlabel--blue zlabel--medium" type="button" onclick="lmslearningplan.updateEnableDisableCmnt(\''+e+"','"+t+"','"+s+"')\">"+t+"</button></div>";$(lmslearningplan.disablePlanPopUp).append(l)},updateEnableDisableCmnt:function(e,t,s){var r=$("#cmnt_val").val();if($("#cmnt_val").val().length>2048)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.exceedmaxlength"));else{if(r.includes(">")||r.includes("<"))return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));var l={enabledisable:t!=ZPI18N.getString("zp.enable"),enableDisableComment:r};zplms.patch("/lms/learningplans/"+e+"/"+(l.enabledisable?"disable":"enable"),l,(function(e){if(1==e[1]){lmscourses.filter.filterInstance.resetBreadCrumbs();var s=ZPI18N.getString("zp.enable");t==s?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.learningplan.planenable")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.learningplan.plandisable"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplan.plannotdisable"))})),lmsbase.closeMaskv5()}},publishPlanPopup:function(){if(1!=lmslearningplan.addedPlanDetails.planInfo.publishState&&lmslearningplan.addedPlanDetails.planInfo&&(lms.settingData[0].lpData.isLPUserModPerm||4==lmslearningplan.addedPlanDetails.planInfo.publishState)){var e=document.getElementById("addedCourses").querySelectorAll('[class="zp_ascrs zp_crsmar"]'),t=0;if(e.forEach((function(e){e.querySelector('[rel="noCourse"]')&&(t+=1)})),!isEmpty(lmslearningplan.addedPlanDetails.planEntities)&&lmslearningplan.addedPlanDetails.planInfo.totalCourseCnt&&0!=lmslearningplan.addedPlanDetails.planInfo.totalCourseCnt){$(".zp_msk").html("");var s='<div class="zp_trCnfCnt zp_sucs"><div class="zp_trCnfIn"><h2>'+ZPI18N.getString("zp.lms.learningplanmsg.publishplancon")+'</h2><div class="zp_trCnfdta">';s+=0==t?"<p>"+ZPI18N.getString("zp.lms.learningplanmsg.publishplanconmsg")+"</p>":"<p>"+ZPI18N.getString("zp.lms.learningplanmsg.publishplanleveluntagconmsg")+"</p>",s+='</div><div class="zp_trCnfBtm"><div class="zp_btn"><button class="zpactn" onclick="lmslearningplan.closePopup()" data-ttip="'+ZPI18N.getString("zp.lms.close")+'">'+ZPI18N.getString("zp.no")+'</button><button class="zpthm" onclick="lmslearningplan.publishPlan()">'+ZPI18N.getString("zp.yes")+"</button></div></div></div></div>",$(".zp_msk").append(s),$(".zp_msk").show()}else isEmpty(lmslearningplan.addedPlanDetails.planEntities)?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.publishplan")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.atleastonemandmsg"))}else if(lms.settingData[0].lpData.isLPUserModPerm)lmslearningplan.addedPlanDetails.planInfo&&1==lmslearningplan.addedPlanDetails.planInfo.publishState&&lmslearningplan.publishPlan();else{var r=!0;isEmpty(lmslearningplan.addedPlanDetails.planEntities)?(r=!1,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.publishplan"))):0==lmslearningplan.addedPlanDetails.courseInfo.length&&0==lmslearningplan.addedPlanDetails.courseLevelInfo.length&&(r=!1,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.atleastonemandmsg"))),r&&lmslearningplan.publishPlan()}},publishPlan:function(){var e={isPublish:lmslearningplan.addedPlanDetails.planInfo.publishState};lms.settingData[0].lpData.isLPUserModPerm||4==lmslearningplan.addedPlanDetails.planInfo.publishState||1==lmslearningplan.addedPlanDetails.planInfo.publishState||(e.mode=3),zplms.post("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/publish",e,(function(e){"Plan should have atleast one mandatory course"!=e[1].msg&&"Plan have the users"!=e[1].msg?(0==e[1].publishState&&lms.settingData[0].lpData.isLPUserModPerm||4==e[1].publishState?document.querySelector('[rel="publishstatus"]').innerHTML=ZPI18N.getString("zp.publish"):0!=e[1].publishState&&5!=e[1].publishState||lms.settingData[0].lpData.isLPUserModPerm?3==e[1].publishState?(document.querySelector('[rel="publishstatus"]').innerHTML=ZPI18N.getString("zp.waitingmsg"),lmslearningplan.closePopup()):1==e[1].publishState&&(document.querySelector('[rel="publishstatus"]').innerHTML=ZPI18N.getString("zp.lms.course.unpublish"),lmslearningplan.closePopup()):(document.querySelector('[rel="publishstatus"]').innerHTML=ZPI18N.getString("zp.sendforapproval"),lmslearningplan.closePopup()),lmslearningplan.addedPlanDetails.planInfo.publishState=e[1].publishState,lmslearningplan.isEdited=!0,lmslearningplan.closePopup()):"Plan have the users"==e[1].msg?(lmslearningplan.closePopup(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.planunpublish"))):lms.settingData[0].lpData.isLPUserModPerm?(lmslearningplan.closePopup(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.atleastonemandmsg"))):"Added successfully"==e[1].msg?document.querySelector('[rel="publishstatus"]').innerHTML=ZPI18N.getString("zp.waitingmsg"):(lmslearningplan.closePopup(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.atleastonemandmsg")))}))},viewPlan:function(e,t){if(e){lmslearningplan.isFromLP=!0,lms.settingData[0].lpData.isLPUserModPerm=e.planInfo.isLPUserModPerm;var s=0==e.planInfo.durationType?"zp.lms.minutes":1==e.planInfo.durationType?"zp.lms.hours":2==e.planInfo.durationType?"zp.lms.days":3==e.planInfo.durationType?"zp.weeks":4==e.planInfo.durationType?"zp.lms.learningplan.months":5==e.planInfo.durationType?"zp.lms.learningplan.years":"",r="null"==e.planInfo.description?ZPI18N.getString("zp.lms.learningplan.enterdesc"):ZPeople.decodeTxt(e.planInfo.description),l="null"!=e.planInfo.duration&&"0"!=e.planInfo.duration?e.planInfo.duration:30,a="",n="zp_Abgimg zp_photoscrn";if(e.planInfo.lpImageInfo&&e.planInfo.lpImageInfo.isSystemImage)n="zp_Abgimg zp_photoscrn CBg"+(n=(a="null"!=e.planInfo.image?e.planInfo.image:1)%4+1),a=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+a+".svg");else null===e.planInfo||e.planInfo.lpImageInfo.isSystemImage||(e.planInfo.lpImageInfo.additionalInfo={fileId:e.planInfo.planId,type:8},a=lmsfileaction.generateSourceURL(e.planInfo.lpImageInfo));lmslearningplan.src=a;var i='<div class="zp_pwrap zp_tab" id="createLearningPlan"><div class="zp_ACttl zp_atlimg">';if(e.planInfo.isPlanOwner&&!lmslearningplan.isManagerView){var o=ZPI18N.getString("zp.sendforapproval");e.planInfo.isLPUserModPerm&&1!=e.planInfo.publishState||4==e.planInfo.publishState?o=ZPI18N.getString("zp.publish"):1==e.planInfo.publishState?o=ZPI18N.getString("zp.lms.course.unpublish"):3==e.planInfo.publishState?o=ZPI18N.getString("zp.waitingmsg"):5==e.planInfo.publishState&&(o=ZPI18N.getString("zp.resendforapproval")),i+='<div class="'+n+'" style="background-image:url('+a+')" id="planBgImg" rel="planBgImg"><p>'+ZPI18N.getString("zp.change")+'</p></div><div class="zp_micn"><div class="zp_bgicn"><a href="https://www.zoho.com/people/help/adminguide/lms/learningplan.html" target="_blank" data-ttip="'+ZPI18N.getString("zp.lms.learningplan.lphelpdoclink")+'"><i class="IC-Hlp"></i></a></div>',0==e.planInfo.enrolledMemberCnt&&(i+='<div class="zp_btn"><button rel="publishstatus" class="zpthm">'+o+"</button></div>"),i+='</div><h1><div contenteditable="true" rel="plan_name" onfocusout="lmslearningplan.addLearningPlan()">'+e.planInfo.planName+'</div></h1><div class="zp_ACinf"><ul>',i+=null!=t.referObj&&"showCouCrOpt"==t.referObj.elem.getAttribute("id")?'<li class="lnk"><i class="IC-clock"></i><font rel="setDuration">'+ZPI18N.getString("zp.lms.learningplan.setduration")+"</font></li>":'<li class="lnk"><i class="IC-clock"></i><font rel="setDuration">'+l+" "+ZPI18N.getString(s)+"</font></li>",i+="<li><p>"+ZPI18N.getString("zp.lms.trainers.Courses")+' :</p><b id="courseCount">0</b></li>',(e.planInfo.publishState||0!=e.planInfo.enrolledMemberCnt)&&(i+='<li class="memberCnt"><p>'+ZPI18N.getString("zp.lms.learningplan.enrolledusers")+' : </p><b rel="memberCnt">'+e.planInfo.enrolledMemberCnt+"</b></li>"),i+="<li><p>"+ZPI18N.getString("zp.lms.learningplanmsg.planowners")+' :</p><b rel="planOwners">'+e.planInfo.planOwnersCnt+"</b></li>",i+='</ul></div></div><div class="zp_Acnt"><div class="zp_Alft"><div class="zp_ACcnt"><div class="zp_ACwel"><h5 class="zpA"><i class="IC-intro1"></i>'+ZPI18N.getString("zp.lms.learningplan.learningoutcomes")+'<div class="zp_asrgt"><i class="IC-Aedt" id="desc_body" rel="addplandetailsedit"></i></div></h5><div class="zpA"><div class="" id="showmoreorless" rel="addplandetails">'+r+'</div></div></div><div class="zp_ACwel" rel="addedCoursesDiv" id="showCouOpts" ><h5 class="zpA"><i class="IC-learn-plan"></i>'+ZPI18N.getString("zp.lms.learningplan.learningpath")+'<div class="zp_micn zp_actcrs" id="header1"><div class="zp_Sm zp_nobr mtp0" rel="showCouOpt" id="showCouOpt"></div><div class="zp_dropbtn"><div rel="addCouLev"><span rel="addCourse">'+ZPI18N.getString("zp.lms.course.coursecreate")+'</span><i class="IC-adwn" rel="addMenu"></i></div></div></div></h5><div id="addedCourses">',0==lmslearningplan.addedPlanDetails.courseInfo.length&&0==lmslearningplan.addedPlanDetails.courseLevelInfo.length&&(i+='<div class="ZPNdata" id="nomyc" style="display: flex !important;"><div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.learningplan.nocourseleveltag")+'</h3><p><a rel="addCourse">'+ZPI18N.getString("zp.lms.course.coursecreate")+"</a> "+ZPI18N.getString("zp.or")+' <a rel="addLevel">'+ZPI18N.getString("zp.lms.learningplan.addlevel")+"</a> "+ZPI18N.getString("zp.lms.learningplan.toinitiatecoulevel")+"</p></label></div></div>"),i+='</div></div></div></div><div class="zp_Argt"><div class="zp_ACrgcnt"></div></div></div>'}else{var c=e.planInfo.isUserCompletedPlan?ZPI18N.getString("zp.completed"):e.planInfo.isUserJoinedPlan?ZPI18N.getString("zp.chkinprogress"):ZPI18N.getString("zp.lms.course.coursejoinnow");i+='<div class="'+n+'" style="background-image:url('+a+')"></div><div class="zp_micn"><div class="zp_bgicn"><a href="https://www.zoho.com/people/help/adminguide/lms/learningplan.html" target="_blank" data-ttip="'+ZPI18N.getString("zp.lms.learningplan.lphelpdoclink")+'"><i class="IC-Hlp"></i></a></div>',lmslearningplan.isManagerView||(i+='<div class="zp_btn">',e.planInfo.isLPUserModPerm&&1!=e.planInfo.isLpModerateOpt?(0==e.planInfo.publishState||4==e.planInfo.publishState?o=ZPI18N.getString("zp.publish"):1==e.planInfo.publishState?o=ZPI18N.getString("zp.lms.course.unpublish"):3==e.planInfo.publishState?o=ZPI18N.getString("zp.waitingmsg"):5==e.planInfo.publishState&&(o=ZPI18N.getString("zp.resendforapproval")),i+='<button rel="publishstatus" class="zpthm">'+o+"</button>"):e.planInfo.isUserJoinedPlan?i+='<button disabled="true" rel="enrollPlanIn_'+e.planInfo.planId+'" onclick="lmslearningplan.enrollPlan(\''+e.planInfo.planId+"', 1)\">"+c+"</button>":i+='<button rel="enrollPlanIn_'+e.planInfo.planId+'" onclick="lmslearningplan.enrollPlan(\''+e.planInfo.planId+"', 1)\">"+c+"</button>",i+="</div>"),i+="</div><h1><div>"+e.planInfo.planName+'</div></h1></div><div class="zp_Acnt"><div class="zp_Alft"><div class="zp_ACcnt"><div class="zp_Edtl"><div><div class="ZP_photo"><img src="'+e.planInfo.planOwnerNameImg+'"></div><div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.content.Createdby")+"</div><h4>"+e.planInfo.planOwnerName+'</h4></div></div><div><i class="IC-clock"></i><div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.duration")+'</div><span href="">'+l+" "+ZPI18N.getString(s)+'</span></div></div><div class="zp_stp5"><i class="IC-achieve"></i><div><div class="zp_Pttl" rel="leaoutcomes">'+ZPI18N.getString("zp.lms.learningplan.learnerachievement")+'</div></div></div></div><div class="zp_ACwel" rel="addedCoursesDiv"><h5 class="zpA"><i class="IC-intro1"></i>'+ZPI18N.getString("zp.lms.learningplan.learningoutcomes")+'</h5><div class="zpA"><div id="showmoreorless">'+r+"</div></div></div>";var d="zp_Cdis";(e.planInfo.isUserJoinedPlan||lmslearningplan.isManagerView)&&(d=""),i+='<div class="zp_ACwel '+d+'" id="addedCourses"><h5 class="zpA"><i class="IC-learn-plan"></i>'+ZPI18N.getString("zp.lms.learningplan")+' <span id="courseCount">( 0 '+ZPI18N.getString("zp.lms.trainers.Courses")+" )</span></h5></div></div>"}i+="</div>",document.getElementsByClassName("zp_pv training")[0].innerHTML=i,null!=t&&null!=t.referObj&&"showCouCrOpt"==t.referObj.elem.getAttribute("id")&&(document.getElementById("showCouOpt").id="showCouCrOpt",$("#showCouCrOpt").attr("rel","showCouCrOpt"),$(".memberCnt").hide()),$("#showCouCrOpt").hide(),$("#showCouOpt").hide(),document.getElementById("top_message_outer").parentElement.classList.add("zp_Pshw"),document.getElementById("lms").classList.add("assessment"),document.getElementsByClassName("zp_pv training")[0].classList.remove("zp_hpv"),document.getElementsByClassName("zp_pv training")[0].classList.add("zp_Apv"),lmsbase.addListener(document.getElementById("createLearningPlan"),"click",lmslearningplan.clickPopupHandler,!1),lmslearningplan.constructCourseAndLevelList(e,!1),e.planInfo.isPlanOwner&&!lmslearningplan.isManagerView?lmslearningplan.createdRule(e.planEntities,1):lmslearningplan.createdRule(e.planEntities),e.planInfo.isPlanOwner&&!lmslearningplan.isManagerView&&(null!=t.referObj?lmslearningplan.menuConstruction(t.referObj.elem.getAttribute("id"),void 0,t.content[1]):lmslearningplan.menuConstruction("showCouOpt",void 0,t.content[1])),$(document).on("keypress",(function(e){if(13==e.keyCode)return e.preventDefault(),!1})),$(document).ready((function(){$("#showmoreorless").each((function(){var e=$(this).html();if(e.length>1e3){var t=e.substring(0,1e3);e.substring(1e3,e.length);$(this).empty().html(t),$('<a href="javascript:void(0);" id="read-more" onclick=lmslearningplan.showMore()>'+ZPI18N.getString("zp.lms.learningplan.viewmore")+"</a>").insertAfter("#showmoreorless")}}))}))}},planOwnersPopup:function(){lmslearningplan.popup=lmsbase.showMaskLayer();var e='<div class="zp_popup" rel="planOwnersAdd" style="width:600px;"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.learningplanmsg.planowners")+'</font><i class="IC-cls" rel="closePlanOwners"></i></div><div class="zp_Pocnt" style="max-height:700px;" rel="planOwnersFetchs"><div class="zp_Sm " rel="planOwnersFetch" ></div></div><div class="zp_btn"><button class="zpthm" rel="addPlanOwners">'+ZPI18N.getString("zp.lms.course.add")+"</button></div></div>";lmslearningplan.popup.innerHTML=e,lmsbase.addListener(document.querySelector('[rel="planOwnersAdd"]'),"click",lmslearningplan.clickPopupHandler,!1),lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="planOwnersFetchs"]')),lmslearningplan.fetchPlanOwners(document.querySelector('[rel="planOwnersFetch"]'),lmslearningplan.fetchAddedOwners())},addPlanOwners:function(){var e={};document.querySelector('[_rel="items"]').querySelectorAll('[class="zp_Tg"]').forEach((function(t){var s=t.getAttribute("data-value");e[s]=s}));var t={planOwners:JSON.stringify(e)};zplms.post("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/admins",t,(function(e){"Plan owners added successfully"==e[1].msg?(lmslearningplan.popupClose(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.learningplanmsg.planownerssucmsg")),document.querySelector('[rel="planOwners"]').innerHTML=e[1].planOwnersCnt):(lmslearningplan.popupClose(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.nouserselected")))}))},fetchAddedOwners:function(){zplms.get("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/admins",{mode:1},(function(e){if(e[1].arr.length>0){var t='<div class="zp_Pttl">'+ZPI18N.getString("zp.lms.learningplanmsg.planowners")+'</div><ul class="zp_CPlst" id="addedOwners"></ul>';$(".zp_Pocnt").append(t),lmslearningplan.addedOwnersView(e)}}))},addedOwnersView:function(e){$.each(e[1].arr,(function(e,t){$.each(t,(function(e,t){var s='<li id="owner_'+t.userId+'" rel="planOwnerIds"><div class="ZP_photo" title="'+t.name+'"><img src="'+t.photoPath+'"><i class="IC-tck1"></i></div><h4>'+t.name+"</h4>";t.isPlanAdmin||(s+='<div class="zp_micn"><ul><li><b class=""><span><i class="IC-cls" rel="removePlanOwner"></i></span></b></li></ul></div>'),s+="</li>",$("#addedOwners").append(s)}))}))},popupClose:function(){$(".zp_popup").hide(),$(".zp_msk").hide()},removePlanOwner:function(e){var t={},s=e.closest('[rel="planOwnerIds"]').getAttribute("id").split("_")[1];t[s]=s;var r={planOwners:JSON.stringify(t),mode:4};zplms.delete("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/admins",r,(function(e){"Plan owners added successfully"==e[1].msg?(document.querySelector('[id="owner_'+s+'"]').remove(),document.querySelector('[rel="planOwners"]').textContent=JSON.parse(document.querySelector('[rel="planOwners"]').innerHTML)-1):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.adminerrormsg"))}))},fetchPlanOwners:function(e,t,s){s=null!=s?s:{},lmslearningplan.menuObj.insertMenu({elem:e,type:"select",mode:"multi",allow_new:!1,menutype:1,menulist:lmslearningplan.fetchPlanOwnersObj,click:t}),lmsmenu.changeToSelectMenu(e,s,"multi",null,ZPI18N.getString("zp.select"))},fetchUsersForOwner:function(e,t){var s={type:6,mode:3};t&&(s.searchTxt=t),zplms.get("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/criteria",s,e)},fetchPlanOwnersObj:function(e){lmslearningplan.menuCallBack=this.updateOptionList,lmslearningplan.inputvalue=this.value,null!=this.value?lmslearningplan.fetchUsersForOwner(lmslearningplan.planOwnersView,this.value):lmslearningplan.fetchUsersForOwner(lmslearningplan.planOwnersView)},planOwnersView:function(e){var t={};Object.keys(e[1]).forEach((function(s){t[e[1][s]]=[s,""]})),lmslearningplan.menuCallBack(t,lmslearningplan.inputvalue)},showLess:function(){var e=ZPeople.decodeTxt(lmslearningplan.addedPlanDetails.planInfo.description);if(e.length>1e3){var t=e.substring(0,1e3);e.substring(1e3,e.length);$("#showmoreorless").empty().html(t),$("#read-less").addClass("DN"),document.getElementById("read-more")?$("#read-more").removeClass("DN"):$('<a href="javascript:void(0);" id="read-more" onclick=lmslearningplan.showMore()>'+ZPI18N.getString("zp.lms.learningplan.viewmore")+"</a>").insertAfter("#showmoreorless")}},showMore:function(e){$("#read-more").addClass("DN"),$("#showmoreorless").empty().html(ZPeople.decodeTxt(lmslearningplan.addedPlanDetails.planInfo.description)),document.getElementById("read-less")?$("#read-less").removeClass("DN"):$('<a href="javascript:void(0);" id="read-less" onclick=lmslearningplan.showLess()>'+ZPI18N.getString("zp.lms.learningplan.viewless")+"</a>").insertAfter("#showmoreorless")},setDurationPopup:function(){document.getElementById("setdur")&&document.getElementById("setdur").remove();var e=document.body.appendChild(document.createElement("div"));e.className="zp_Am assessment zp_setDr tpl zp_shw ",e.setAttribute("rel","durationPopup"),e.id="setdur";var t=document.querySelector('[rel="setDuration"]').innerHTML===ZPI18N.getString("zp.lms.learningplan.setduration")?30:document.querySelector('[rel="setDuration"]').innerHTML.split(" ")[0],s='<div class="zp_arcntn"><div class="zp_arttl"><h4>'+ZPI18N.getString("zp.lms.learningplan.setduration")+'</h4><i class="IC-cls" onclick="lmslearningplan.closeDurationPopup()"></i></div><div class="zp_arctn"><div class="zp_Sm zp_nobr zp_lp"><div><ul><li><div class="zp_hints"><p>'+ZPI18N.getString("zp.lms.learningplan.setdurationdesc")+'</p></div><div class="zp_Sm zp_c3"><div><input required=" " id="duration" placeholder=" " type="text " value="'+t+'"></div></div><div class="zp_Sm  zp_c3" rel="durationMenu"></div></li></ul></div></div></div><div class="zp_btn "><button class="zpthm" onclick="lmslearningplan.saveDuration()">'+ZPI18N.getString("zp.lms.save")+"</button></div></div>";e.innerHTML=s;var r=document.querySelector('[rel="setDuration"]'),l=lmslearningplan.getDurationPosition(r,e,!0),a="left:"+l.left+"; top:"+l.top+";width:420px";e.setAttribute("style",a),lmsbase.addClass(e,l.arwCls),lmsbase.addListener(r,"click",lmslearningplan.clickHandle,!1),lmslearningplan.menuObj=lmsgroupmenu.initiate(document.getElementById("setdur")),lmslearningplan.menuConstruction("durationMenu")},getDurationPosition:function(e,t,s){var r,l,a=e.getBoundingClientRect(),n=t.getBoundingClientRect(),i=document.body.scrollTop,o=s?20:0,c=["tp","lft"];return l=a.left-o+"px",window.innerHeight>a.top+n.height?r=a.top+a.height+o+i-10+"px":(r=a.top-n.height+i-10+"px",c[0]="btm"),{left:l,top:r,arwCls:{tp_lft:"up",tp_rgt:"tpr",btm_lft:"dwn",btm_rgt:"btr"}[c.join("_")]}},saveDuration:function(){var e=document.getElementById("duration").value,t=0;null!=document.querySelector('[rel="durationMenu"]').querySelector('[class="zp_Tglst ntxt"]')&&null!=document.querySelector('[rel="durationMenu"]').querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel")?t=document.querySelector('[rel="durationMenu"]').querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel"):lmslearningplan.addedPlanDetails.planInfo.durationType&&"null"!=lmslearningplan.addedPlanDetails.planInfo.durationType&&(t=lmslearningplan.addedPlanDetails.planInfo.durationType);var s={duration:e.trim(),durationType:t};zplms.patch("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId,s,(function(e){var t=0==e[1].durationType?"zp.lms.minutes":1==e[1].durationType?"zp.lms.hours":2==e[1].durationType?"zp.lms.days":3==e[1].durationType?"zp.weeks":4==e[1].durationType?"zp.lms.learningplan.months":"zp.lms.learningplan.years";document.querySelector('[rel="setDuration"]').innerHTML=e[1].duration+" "+ZPI18N.getString(t),lmslearningplan.addedPlanDetails.planInfo.durationType=e[1].durationType,lmslearningplan.closeDurationPopup()}))},closeDurationPopup:function(){document.getElementById("setdur").remove()},planImageChange:function(){$("#lpimg1").addClass("zp_dyn"),$("#lpimg2").removeClass("zp_dyn")},bgSelect:function(e,t){$(e).addClass("sel");var s="",r={planInfoId:lmslearningplan.addedPlanDetails.planInfo.currentLpInfoId};r.isCustomImg=1===t,1==t?(r.xAxis=$("input#xVal").val(),r.yAxis=$("input#yVal").val(),r.width=$("input#width").val(),r.height=$("input#height").val(),r.uploadFile=lmslearningplan.addedPlanDetails.planInfo.fileInfo.contentId):($(".zp_BGimg").find(".sel").each((function(){1==$(this).hasClass("sel")&&(s=$(this).find("img").attr("src").split("cat")[1].split(".svg")[0].split(".")[0])})),r.image=s),zplms.patch("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId,r,(function(e){var t="";null!=e[1]&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.coursebgimgupdated")),null==lmslearningplan.addedPlanDetails.planInfo||e[1].lpImageInfo.isSystemImage?($(".zp_popup").remove(),$(".zp_msk").hide(),$.each(e,(function(r,l){if(lmslearningplan.addedPlanDetails.planInfo.lpImageInfo=e[1].lpImageInfo,lmslearningplan.addedPlanDetails.planInfo.currentLpInfoId=l.infoId,e[1].lpImageInfo.isSystemImage){t="CBg"+(t=lmslearningplan.addedPlanDetails.planInfo.image%4+1),document.querySelector('[rel="planBgImg"]').classList.remove(t),lmslearningplan.addedPlanDetails.planInfo.lpImageInfo.isSystemImage=!0,lmslearningplan.addedPlanDetails.planInfo.image=s,document.getElementById("cropLpImg")&&document.getElementById("cropLpImg").classList.remove("DN");var a=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+s+".svg");document.querySelector('[rel="planBgImg"]').style.backgroundImage="url("+a+")",t="CBg"+(t=s%4+1),document.querySelector('[rel="planBgImg"]').classList.add(t),lmslearningplan.src=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+s+".svg")}}))):(lmslearningplan.showuploadedPhoto(e[1]),null!=lmslearningplan.addedPlanDetails.planInfo&&(lmslearningplan.addedPlanDetails.planInfo.lpImageInfo.isSystemImage&&(t="CBg"+(t=lmslearningplan.addedPlanDetails.planInfo.image%4+1),document.querySelector('[rel="planBgImg"]').classList.remove(t)),lmslearningplan.addedPlanDetails.planInfo.lpImageInfo=e[1].savedFileInfo,lmslearningplan.src=lmsfileaction.generateSourceURL(lmslearningplan.addedPlanDetails.planInfo.lpImageInfo)))),lmslearningplan.isEdited=!0}))},showuploadedPhoto:function(e){lmslearningplan.changeButtons(),lmslearningplan.addedPlanDetails.planInfo.fileInfo=e.savedFileInfo;var t={fileId:lmslearningplan.addedPlanDetails.planInfo.planId,type:"8"};lmslearningplan.addedPlanDetails.planInfo.fileInfo.additionalInfo=t,$(".zp_Bgupd").remove();var s='<div class="zp_Bgupd"><div attachmentList><img style="width:400; height:400;" src="'+lmsfileaction.generateSourceURL(lmslearningplan.addedPlanDetails.planInfo.fileInfo,void 0,void 0,!0)+'" alt="" id="brandingLpImage"></div></div>';$(".zp_BGupld").prepend(s)},imgSelect:function(){$(".zp_msk").html("");var e="";lmslearningplan.addedPlanDetails.planInfo.lpImageInfo&&lmslearningplan.addedPlanDetails.planInfo.lpImageInfo.isSystemImage?e=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+lmslearningplan.addedPlanDetails.planInfo.image+".svg"):null===lmslearningplan.addedPlanDetails.planInfo||lmslearningplan.addedPlanDetails.planInfo.lpImageInfo.isSystemImage||(lmslearningplan.addedPlanDetails.planInfo.lpImageInfo.additionalInfo={fileId:lmslearningplan.addedPlanDetails.planInfo.planId,type:8},e=lmsfileaction.generateSourceURL(lmslearningplan.addedPlanDetails.planInfo.lpImageInfo));var t='<div class="zp_popup fulhgt pad30" style="width:70%"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.learningplan.customupload")+'</font><i class="IC-cls" onclick="lmslearningplan.closePopup(4);"></i></div><div class="zp_Pocnt" style="max-height: calc(100% - 90px) !important; min-height: calc(100% - 90px) !important;"><div id="lpimg1"><div class="zp_BGupld" attachmentTab><div class="zp_Bgupd" attachmentList><div id="cropLpImg"><img src="'+e+'" alt="" id="brandingLpImage"></div></div><div id="lpButtons"><p>'+ZPI18N.getString("zp.lms.learningplan.lpimagedesc")+'</p><div class="zp_btn"><button class="zpthm" onclick="lmslearningplan.planImageChange()">'+ZPI18N.getString("zp.lms.SystemImage")+'</button><button class="zpthm" _rel="attach" action="local" style="" id="lpImgUpload">'+ZPI18N.getString("zp.lms.customImage")+'</button></div><div class="zp_hint"><b>'+ZPI18N.getString("zp.note")+" :</b><span>"+ZPI18N.getString("zp.lms.learningplan.lpimgnote")+'</span></div><div class="zp_btn zp_dyn"><button class="zpthm" onclick="uploadimg(this)">'+ZPI18N.getString("zp.lms.save")+'</button><button class="zpactn" onclick="uploadimg(this)">'+ZPI18N.getString("zp.lms.cancel")+'</button></div></div></div></div><div class="zp_dyn" id="lpimg2"><ul class="zp_BGimg">';for(i=1;i<45;i++)t+='<li><div onclick="lmslearningplan.bgSelect(this, 0)"><img src="'+(e=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+i+".svg"))+'" alt=""><i class="IC-tck"></i></div></li>';$(".zp_msk").show(),$(".zp_msk").append(t),lmslearningplan.invokeUploadManager()},invokeUploadManager:function(e){e=e||[];var t=document.getElementById("lpImgUpload");dropElement=lmsbase.pageCont;var s={clickElement:t,dropElement,moduleName:lms.appname,multiple:lmslearningplan.uploadConfig.multiple,MAXSIZE:lmslearningplan.uploadConfig.MAXSIZE,MAX_NUMBER_OF_FILES_PER_UPLOAD:lmslearningplan.uploadConfig.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED,SUPPORTED_SOURCES:lmsfileaction.SOURCE.LOCAL,callbackObject:lmslearningplan.uploadConfig,requiredFileTypes:"image",ACTION_ATTRIBUTE:"action",additionalInfo:{subModule:"lpImage"}},r={listElement:document.querySelector("[attachmentTab]"),MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED:lmslearningplan.uploadConfig.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED,type:lmsuploadmanager.UPLOADMANAGER_TYPE.SINGLEIMAGEUPLOADMANAGER};lmslearningplan.uploadHelperObject=lmsuploadmanager.initUploadManager(r,new lmsfileaction.upload(s)),lmslearningplan.uploadHelperObject.attachCallback("getSingleAttachment",lmslearningplan.getSingleAttachmentHTML),lmslearningplan.uploadHelperObject.attachCallback("onbeforeupload",SingleImageUploadManager.onBeforeUpload),lmslearningplan.uploadHelperObject.attachCallback("onafterupload",lmslearningplan.onAfterUpload),lmslearningplan.uploadHelperObject.attachCallback("getPreviewObject",lmsattachment.getPreviewObject),lmslearningplan.uploadHelperObject.attachCallback("lightbox_src_callback",lmsattachment.lightbox_src_callback),lmslearningplan.uploadHelperObject.attachCallback("lightbox_click_callback",lmsattachment.lightbox_click_callback),lmslearningplan.uploadHelperObject.attachCallback("onMaximumUploadLimitReached",SingleImageUploadManager.onMaximumNumberOfUploadLimitReached),lmslearningplan.uploadHelperObject.addSavedFiles(e),lmslearningplan.uploadHelperObject.bind()},onAfterUpload:function(e,t,s,r){SingleImageUploadManager.onAfterUpload(e,t,s,r);var l=lmsattachment.STATUS_CODE;s.code==l.FILESTOREDSUCCESSFULLY&&(lmslearningplan.addedPlanDetails.planInfo.fileInfo=s.fileInfo,lmslearningplan.addedPlanDetails.planInfo.isCustomImg=!0,document.getElementById("cropLpImg")&&document.getElementById("cropLpImg").classList.add("DN"),lmslearningplan.cropImage())},getSingleAttachmentHTML:function(e){$("#brandingLpImage").remove();var t=e.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+e.imageID+".svg"):lmsfileaction.generateSourceURL(e,void 0,void 0,!0),s=document.createElement("div");return s.innerHTML='<img src="'+t+'" id="brandingLpImage">',s},changeButtons:function(){$("#lpUpdateButtons").remove(),$("#lpButtons .zp_btn").show(),$(".zp_Bgupd").remove();var e='<div class="zp_Bgupd" attachmentList><img src="'+lmslearningplan.src+'" alt="" id="brandingLpImage"></div>';$(".zp_BGupld").prepend(e)},cropImage:function(){$("#lpButtons .zp_btn").hide();var e='<div class="zp_btn" id="lpUpdateButtons"><button class="zpthm" onclick="lmslearningplan.bgSelect(this, 1);">'+ZPI18N.getString("zp.lms.savetheimage")+'</button><button class="zpthm" onclick="lmslearningplan.changeButtons();">'+ZPI18N.getString("zp.lms.cancel")+"</button></div>";$("#lpButtons").append(e);$("#brandingLpImage").append('<div class="zp_crpimg"><input type="hidden" name="x" id="xVal" /><input type="hidden" name="y" id="yVal" /><input type="hidden" name="width" id="width" /><input type="hidden" name="height" id="height"/></div>'),$("#brandingLpImage").Jcrop({onSelect:lmslearningplan.getPosition,bgFade:!0,bgOpacity:.7,minSize:[0,0],aspectRatio:2/2.35,allowSelect:!1},(function(){var e=this;bounds=e.getBounds(),boundx=bounds[0],boundy=bounds[1],e.setSelect(lmslearningplan.getDimensions(e))}))},getDimensions:function(e){var t=e.ui.holder,s=$(t).width(),r=$(t).height();if(s==r)return[0,0,s,r];if(s<r){var l=s;return[0,a=Math.round((r-s)/2),0,a+l]}if(s>r){var a;l=r;return[a=Math.round((s-r)/2),0,a+l,0]}return[Math.round(s/2-preview_width/2),Math.round(r/2-preview_height/2),Math.round(s/2+preview_width/2),Math.round(r/2+preview_height/2)]},getPosition:function(e){$("#brandingLpImage").find("input#width").val(parseInt(e.w)),$("#brandingLpImage").find("input#xVal").val(parseInt(e.x)),$("#brandingLpImage").find("input#yVal").val(parseInt(e.y)),$("#brandingLpImage").find("input#height").val(parseInt(e.h))},submitCallback:function(){var e={},t=lmslearningplaneditor.editor.addplandetails.getContent();e.description=t,s=ZPFeeds.removeTrailingEmptyDivs(t);var s=ZPFeeds.getTextContent(s);s&&zplms.patch("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId,e,(function(t){lmslearningplan.addedPlanDetails.planInfo.description=ZPeople.escapeHtml(e.description);var s=ZPeople.decodeTxt(lmslearningplan.addedPlanDetails.planInfo.description);if(s.length>1e3){var r=s.substring(0,1e3);s.substring(1e3,s.length);$("#showmoreorless").empty().html(r),$("#read-less").addClass("DN"),document.getElementById("read-more")?$("#read-more").removeClass("DN"):$('<a href="javascript:void(0);" id="read-more" onclick=lmslearningplan.showMore()>'+ZPI18N.getString("zp.lms.learningplan.viewmore")+"</a>").insertAfter("#showmoreorless")}else document.querySelector('[rel="addplandetails"]').innerHTML=e.description;document.getElementById("desc_body")&&document.getElementById("desc_body").classList.remove("zp_dyn")}))},cancelCallback:function(){var e=ZPeople.decodeTxt(lmslearningplan.addedPlanDetails.planInfo.description);if(lmslearningplan.addedPlanDetails.planInfo.description&&"null"!=lmslearningplan.addedPlanDetails.planInfo.description&&e.length>1e3){var t=e.substring(0,1e3);e.substring(1e3,e.length);$("#showmoreorless").empty().html(t),$("#read-less").addClass("DN"),document.getElementById("read-more")?$("#read-more").removeClass("DN"):$('<a href="javascript:void(0);" id="read-more" onclick=lmslearningplan.showMore()>'+ZPI18N.getString("zp.lms.learningplan.viewmore")+"</a>").insertAfter("#showmoreorless")}else{document.querySelector('[rel="addplandetails"]').innerHTML=lmslearningplan.addedPlanDetails.planInfo.description&&"null"!=lmslearningplan.addedPlanDetails.planInfo.description?e:ZPI18N.getString("zp.lms.learningplan.enterdesc")}document.getElementById("desc_body")&&document.getElementById("desc_body").classList.remove("zp_dyn")},constructCourseAndLevelList:function(e,t){var s,r,l,a=0,n="",i=src="",o=!1;if(lmslearningplan.addedPlanDetails.addedCourse={},$(".zp_ascrs").remove(),e.courseLevelInfo&&0!=e.courseLevelInfo.length)for(var c=0;c<e.courseLevelInfo.length;c++){l=e.courseLevelInfo[c],o=!(!lmslearningplan.addedPlanDetails.planInfo.isPlanOwner||lmslearningplan.isManagerView),i+='<div class="zp_ascrs zp_crsmar" rel="llist" id="level_'+l.levelId+'" _rel="leveldrag" _irel="leveldrag" ><h4>',lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView&&(i+='<i class="IC-drag" _rel="leveldrag"></i>'),i+='<div style="display: none;" rel="zp_hid"></div><div class="zp_lvlnm" contenteditable="'+o+'" id="levelNameEdit" rel="levelNameEdit_'+l.levelId+'" onfocusout="lmslearningplan.addlevelInfo(this)" data-ttip="'+ZPI18N.getString("zp.lms.courseoverview.edit")+'">'+l.levelName+"</div>",l.courseInfo[0]&&document.getElementById("level_"+l.levelId)&&document.getElementById("level_"+l.levelId).querySelector('[class="ZPNdata"]')&&document.getElementById("level_"+l.levelId).querySelector('[class="ZPNdata"]').remove(),lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView&&(i+='<div class="zp_aicn">',l.courseInfo[0]&&(i+='<i class="IC-addcourse" rel="levelId_'+l.levelId+'" onclick="zplms.fetchCourses(null, null, \'lpFetch\', null, 2)" data-ttip="'+ZPI18N.getString("zp.lms.course.coursecreate")+'"></i>'),i+='<i class="IC-more" rel="leveldel" data-ttip="'+ZPI18N.getString("zp.lms.more")+'"></i></div>'),i+="</h4>",l.courseInfo[0]&&(i+="<div rel=levelCourseList>");for(var d=0;d<l.courseInfo.length;d++)if(r=l.courseInfo[d][0]){lmslearningplan.addedPlanDetails.addedCourse[r.courseId]=r.courseId,r.courseImageInfo.isSystemImage?src=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+r.courseImageInfo.imageID+".svg"):(r.courseImageInfo.additionalInfo={fileId:r.courseId,type:6},src=lmsfileaction.generateSourceURL(r.courseImageInfo)),n="",(r.courseId==t||r.isLockedCourse&&!r.isLockedCoursesCompleted)&&(n="zp_lcked "),a+=1,r.isMandatoryCourse&&(n+="zp_mand"),s=r.courseId,r.batchId&&(lmsbase.isUsercanhaveBatches(r.courseType,r)||r.iscourseTrainer)?s=r.courseId+"_"+r.batchId:r.joinedBatchId&&(s=r.courseId+"_"+r.joinedBatchId);var m="";(lmslearningplan.addedPlanDetails.planInfo.isUserJoinedPlan&&(!r.isLockedCourse||r.isLockedCourse&&r.isLockedCoursesCompleted)||lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView)&&(m=lmslearningplan.isManagerView&&(r.isCourseOwner||r.isCourseAdmin||r.isCourseTrainer)?"":"coursePreview"),i+='<ul class="zp_CPlst zp_drgpad" rel="clist"><li class="'+n+'" _rel="coursedrag" _irel="coursedrag" rel="'+m+'" id="course_'+r.courseId+'" _crel="course_'+s+'"courseuserid="'+r.courseUserId+'">',lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView&&(i+='<i class="IC-drag" _rel="coursedrag"></i>'),i+='<div style="display: none;" rel="zp_hid"></div><div class="ZP_photo" rel="'+m+'"><img src='+src+'></div><h4 rel="'+m+'" _rel="cname">',null!=r.batchName&&null!=r.batchName&&(i+='<span rel="'+m+'">'+r.batchName+"</span>"),i+=r.courseName+'</h4><a rel="'+m+'">'+r.type+"</a>",lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView&&r.duration&&(i+='<a class="zp_ldot" rel="'+m+'">'+r.duration+"</a>"),i+='<div class="zp_aicn">';var u="IC-lock-fil";r.isLockedCourse&&r.isLockedCoursesCompleted&&(u="IC-unlock-fil"),lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView?(i+='<i class="'+u+'" rel="lockCourse_'+r.courseId+'" data-ttip="'+ZPI18N.getString("zp.lms.learningplan.tolock")+'" onclick="lmslearningplan.lockedCourses(this)"></i>',i+='<i class="IC-more" rel="levelCourseMore" data-ttip="'+ZPI18N.getString("zp.lms.more")+'"></i>'):r.isLockedCourse&&lmslearningplan.addedPlanDetails.planInfo.isUserJoinedPlan?i+='<i class="'+u+'" rel="lockCourse_'+r.courseId+'" data-ttip="'+ZPI18N.getString("zp.lms.learningplan.lockedcourses")+'" onclick="lmslearningplan.lockedCourses(this)"></i>':r.isLockedCourse&&(i+='<i class="'+u+'" rel="lockCourse_'+r.courseId+'" data-ttip="'+ZPI18N.getString("zp.lms.learningplan.lockedcourses")+'" onclick=""></i>'),i+="</div>",i+='<div class="flddv" rel="lpcourseadd">',lmslearningplan.isManagerView||r.isCourseAdmin||r.isCourseOwner||r.iscourseTrainer||lmslearningplan.isManagerView||!lmslearningplan.addedPlanDetails.planInfo.isUserJoinedPlan||r.isUserJoined||!(!r.isLockedCourse||r.isLockedCourse&&r.isLockedCoursesCompleted)?(lmslearningplan.isManagerView&&r.courseState==ZPI18N.getString("zp.chkinprogress")||!lmslearningplan.isManagerView&&(lmslearningplan.addedPlanDetails.planInfo.isPlanOwner||lmslearningplan.addedPlanDetails.planInfo.isUserJoinedPlan&&(!r.isLockedCourse||r.isLockedCourse&&r.isLockedCoursesCompleted)))&&(i+='<span class="">'+r.courseState+"</span>"):(i+='<div class="zp_btn">',r.type==ZPI18N.getString("zp.lms.settings.InstructorLed")?i+='<button class="zpthm" onclick="lmscourses.cardviewBatchlist(\''+r.courseId+"', this, event, '"+lmslearningplan.addedPlanDetails.planInfo.planId+"')\">"+ZPI18N.getString("zp.lms.course.coursejoinnow")+"</button>":i+='<button class="zpthm" onclick="lmscourseoverview.courseOverviewRegister(\''+r.courseId+"', '', this, '"+r.type+"')\">"+ZPI18N.getString("zp.lms.course.coursejoinnow")+"</button>",i+="</div>"),i+="</div></li></ul>"}0==l.courseInfo.length&&(i+='<div class="ZPNdata" rel="noCourse" id="noCourse_'+l.levelId+'" style="display: flex;"><div><label><p><a rel="levelId_'+l.levelId+'" onclick="zplms.fetchCourses(null, null, \'lpFetch\', null, 2)">'+ZPI18N.getString("zp.lms.course.coursecreate")+"</a> "+ZPI18N.getString("zp.lms.learningplan.toinitiatecoulevel")+"</p></label></div></div>"),l.courseInfo[0]&&(i+="</div>"),i+="</div>"}if(i+='<div rel="courseListDiv">',e.courseInfo&&0!=e.courseInfo.length)for(c=0;c<e.courseInfo.length;c++)if(0!=(r=e.courseInfo[c][0]?e.courseInfo[c][0]:e.courseInfo[c]).length){lmslearningplan.addedPlanDetails.addedCourse[r.courseId]=r.courseId,i+='<ul class="zp_CPlst zp_drgpad" rel="clist">',r.courseImageInfo.isSystemImage?src=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+r.courseImageInfo.imageID+".svg"):(r.courseImageInfo.additionalInfo={fileId:r.courseId,type:6},src=lmsfileaction.generateSourceURL(r.courseImageInfo)),n="",(r.courseId==t||r.isLockedCourse&&!r.isLockedCoursesCompleted)&&(n="zp_lcked "),a+=1,r.isMandatoryCourse&&(n+="zp_mand"),s=r.courseId,r.batchId&&(lmsbase.isUsercanhaveBatches(r.courseType,r)||r.iscourseTrainer)?s=r.courseId+"_"+r.batchId:r.joinedBatchId&&(s=r.courseId+"_"+r.joinedBatchId);m="";(lmslearningplan.isManagerView&&!r.isCourseOwner&&!r.isCourseAdmin&&!r.isCourseTrainer||lmslearningplan.addedPlanDetails.planInfo.isUserJoinedPlan&&(!r.isLockedCourse||r.isLockedCourse&&r.isLockedCoursesCompleted)||lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView)&&(m=lmslearningplan.isManagerView&&(r.isCourseOwner||r.isCourseAdmin||r.isCourseTrainer)?"":"coursePreview"),i+='<li class="'+n+'" _rel="coursedrag" _irel="coursedrag" rel="'+m+'" id="course_'+r.courseId+'" _crel="course_'+s+'"courseuserid="'+r.courseUserId+'">',lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView&&(i+='<i class="IC-drag" _rel="coursedrag"></i>'),i+='<div style="display: none;" rel="zp_hid"></div><div class="ZP_photo"rel="'+m+'"><img src='+src+'></div><h4 rel="'+m+'" _rel="cname">',null!=r.batchName&&null!=r.batchName&&(i+='<span rel="'+m+'">'+r.batchName+"</span>"),i+=r.courseName+'</h4><a rel="'+m+'">'+r.type+"</a>",lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView&&r.duration&&(i+='<a class="zp_ldot" rel="'+m+'">'+r.duration+"</a>"),i+='<div class="zp_aicn">';u="IC-lock-fil";r.isLockedCourse&&r.isLockedCoursesCompleted&&(u="IC-unlock-fil"),lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView?(i+='<i class="'+u+'" rel="lockCourse_'+r.courseId+'" data-ttip="'+ZPI18N.getString("zp.lms.learningplan.tolock")+'" onclick="lmslearningplan.lockedCourses(this)"></i>',i+='<i class="IC-more" rel="courseMore" data-ttip="'+ZPI18N.getString("zp.lms.more")+'"></i>'):r.isLockedCourse&&lmslearningplan.addedPlanDetails.planInfo.isUserJoinedPlan?i+='<i class="'+u+'" rel="lockCourse_'+r.courseId+'" data-ttip="'+ZPI18N.getString("zp.lms.learningplan.lockedcourses")+'" onclick="lmslearningplan.lockedCourses(this)"></i>':r.isLockedCourse&&(i+='<i class="'+u+'" rel="lockCourse_'+r.courseId+'" data-ttip="'+ZPI18N.getString("zp.lms.learningplan.lockedcourses")+'" onclick=""></i>'),i+="</div>",i+='<div class="flddv" rel="lpcourseadd">',lmslearningplan.isManagerView||r.isCourseAdmin||r.isCourseOwner||r.iscourseTrainer||!lmslearningplan.addedPlanDetails.planInfo.isUserJoinedPlan||r.isUserJoined||!(!r.isLockedCourse||r.isLockedCourse&&r.isLockedCoursesCompleted)?(lmslearningplan.isManagerView&&r.courseState==ZPI18N.getString("zp.chkinprogress")||!lmslearningplan.isManagerView&&(lmslearningplan.addedPlanDetails.planInfo.isPlanOwner||lmslearningplan.addedPlanDetails.planInfo.isUserJoinedPlan&&(!r.isLockedCourse||r.isLockedCourse&&r.isLockedCoursesCompleted)))&&(i+='<span class="">'+r.courseState+"</span>"):(i+='<div class="zp_btn">',r.type==ZPI18N.getString("zp.lms.settings.InstructorLed")?i+='<button class="zpthm" onclick="lmscourses.cardviewBatchlist(\''+r.courseId+"', this, event, '"+lmslearningplan.addedPlanDetails.planInfo.planId+"')\">"+ZPI18N.getString("zp.lms.course.coursejoinnow")+"</button>":i+='<button class="zpthm" onclick="lmscourseoverview.courseOverviewRegister(\''+r.courseId+"', '', this, '"+r.type+"')\">"+ZPI18N.getString("zp.lms.course.coursejoinnow")+"</button>",i+="</div>"),i+="</div>",i+="</li></ul>"}i+="</div>",e.courseLevelInfo&&0!=e.courseLevelInfo.length||e.courseInfo&&0!=e.courseInfo.length?document.getElementById("addedCourses").innerHTML=i:document.getElementById("addedCourses").innerHTML+=i,document.getElementById("courseCount")&&(document.getElementById("courseCount").innerHTML=lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&!lmslearningplan.isManagerView?a:"("+a+" "+ZPI18N.getString("zp.lms.trainers.Courses")+")"),0!=a&&($("#showCouCrOpt").show()&&$("#showCouOpt").show()),lmslearningplan.elem=$('[id="addedCourses"]')[0],document.addEventListener("mousedown",lmsdragging.startDragging,!1)},markasmand:function(){if(lmslearningplan.addedPlanDetails.planInfo&&document.querySelector('[id="course_'+lmslearningplan.addedPlanDetails.planInfo.courseId+'"]')&&document.querySelector('[id="course_'+lmslearningplan.addedPlanDetails.planInfo.courseId+'"]').classList.contains("zp_mand")&&1==lmslearningplan.addedPlanDetails.planInfo.publishState&&1==$(".zp_mand").length)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.learningplanmsg.atleastonemandmsg"));else{lmslearningplan.addedPlanDetails.planInfo.courseId;zplms.patch("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/courses/"+lmslearningplan.addedPlanDetails.planInfo.courseId+"/mandatory",null,(function(e){"updated successfully"==e[1].status&&(lmslearningplan.addedPlanDetails.planInfo.totalCourseCnt=e[1].totalCourseCnt,document.getElementById("course_"+lmslearningplan.addedPlanDetails.planInfo.courseId).classList.contains("zp_mand")?document.getElementById("course_"+lmslearningplan.addedPlanDetails.planInfo.courseId).classList.remove("zp_mand"):document.getElementById("course_"+lmslearningplan.addedPlanDetails.planInfo.courseId).classList.add("zp_mand"))}))}},lockedCourses:function(e){lmslearningplan.addedPlanDetails.lockedCourses={};var t=e.getAttribute("rel").split("_")[1];zplms.get("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/courses/"+t,null,(function(e){lmslearningplan.lockedCoursesConstruction(e[1],t)}))},lockedCoursesConstruction:function(e,t){$(".zp_msk").html("");var s="",r=lmslearningplan.addedPlanDetails.planInfo.isPlanOwner?ZPI18N.getString("zp.lms.learningplan.tolock"):ZPI18N.getString("zp.lms.learningplan.locksettings"),l='<div class="zp_popup" rel="lockCourse_'+t+'" style="width:600px"><div class="zp_Pohd"><font>'+r+'</font><i class="IC-cls" rel="lockedClose" onclick="lmslearningplan.closePopup(2)" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></div><div class="zp_Pocnt" style="max-height:700px;"><div class="zp_Attl">';lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&(l+="<span>"+ZPI18N.getString("zp.lms.learningplan.locksettingsdesc")+'</span><div class="zp_Cslctd" rel="courselocksettings"><div class="zp_Sm" rel="coursemenu"></div></div>',0!=e.length&&(l+="<p>"+ZPI18N.getString("zp.lms.learningplan.selectedcourses")+"</p>"));var a=lmslearningplan.addedPlanDetails.planInfo.isPlanOwner?"zp_CPlst":"zp_CPlst noclck";l+='<ul class="'+a+'">',$.each(e,(function(e,r){lmslearningplan.addedPlanDetails.lockedCourses[r.courseId]=r.courseId,r.courseImageInfo.isSystemImage?s=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+r.courseImageInfo.imageID+".svg"):(r.courseImageInfo.additionalInfo={fileId:r.courseId,type:6},s=lmsfileaction.generateSourceURL(r.courseImageInfo)),l+='<li id="lockCourse_'+r.courseId+'"><div class="ZP_photo"><img src="'+s+'"></div><h4>',r.batchName&&(l+="<span>"+r.batchName+"</span>"),l+=r.courseName+"</h4>",lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&(l+='<div class="zp_micn"><ul><li onclick="lmslearningplan.deleteCourseLevel(\''+r.courseId+"', '"+t+'\')"><b class=""><span><i class="IC-trash"></i></span></b></li></ul></div>'),l+="</li>"})),l+="</ul></div></div>",lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&(l+='<div class="zp_btn"><button class="zpthm" onclick="lmslearningplan.addCoursesToPlan(1, \''+t+"')\">"+ZPI18N.getString("zp.lms.save")+"</button></div>"),l+="</div>",$(".zp_msk").show(),$(".zp_msk").append(l),lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&(lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="courselocksettings"]')),lmslearningplan.courseSettingsMenu(zplms.fetchCourses(null,null,"lpFetch",null,3),document.querySelector('[rel="coursemenu"]')))},constructCoursesPopup:function(e,t,s,r,l,a,n){var i="";if(!t&&isEmpty(lmslearningplan.selectedCourses)&&($(".zp_msk").html(""),$("#coursePopup").remove(),i='<div class="zp_popup" id="coursePopup" style="width:600px; height: 92%;"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.learningplan.addcourses")+'</font><i class="IC-cls" onclick="lmslearningplan.closePopup(3)" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></div><div class="zp_Sm"><div><i class="IC-srch"></i><input required="" id="courseSearch" placeholder="'+ZPI18N.getString("zp.lms.learningplan.searchcoursename")+'" type="text" value="" onkeyup="lmslearningplan.searchCourse(this,event, \''+l+"', '"+n+'\')"></div></div><div class="zp_Pocnt" style="height: calc(100% - 220px);"><ul rel="courseBody" class="zp_CPlst">'),0!=e.length?$.each(e,(function(e,a){var n="";a.courseImageInfo.isSystemImage?n=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+a.courseImageInfo.imageID+".svg"):(a.courseImageInfo.additionalInfo={fileId:a.courseId,type:6},n=lmsfileaction.generateSourceURL(a.courseImageInfo)),lmslearningplan.courseImg[a.courseId]=n;var o=!!t;i+='<li id="selCourse_'+a.courseId+'" rel="'+n+'" onclick="lmslearningplan.selectCourses(\''+a.courseId+"', '"+n+"', "+s+", '"+r+"', "+o+", null, '"+l+'\')"><div class="ZP_photo"><img src='+n+"></i></div><h4>",null!=a.batchName&&null!=a.batchName&&(i+="<span>"+a.batchName+"</span>");var c="";lmslearningplan.selectedCourses.hasOwnProperty(a.courseId)&&(c="sel"),i+=a.courseName+'</h4><div class="zp_micn"><ul><li class="'+c+'" id="entityId_'+a.courseId+'"><b><span><i class="IC-tck"></i></span></b></li></ul></div></li>'})):i+="No data found",!t&&isEmpty(lmslearningplan.selectedCourses)){if(i+="</ul></div>",void 0===document.getElementsByClassName("zp_popbtm")[0]){var o="zp_popbtm";isEmpty(lmslearningplan.selectedCourses)&&(o="zp_popbtm disabled"),i+='<div rel="coursePlanList" class="'+o+'">',"lpFetch"==l?(a="",i+='<div class="zp_btn"><button class="zpthm" onclick="lmslearningplan.addCoursesToPlan(0, null, '+s+", '"+r+"')\">"+ZPI18N.getString("zp.lms.save")+"</button></div>"):i+='<div class="zp_btn"><button class="zpthm" onclick='+a+">"+ZPI18N.getString("zp.lms.save")+"</button></div>",i+='<div class="zp_Cmem"><ul id="coursePlanList"></ul>',s||"lpFetch"!=l||(i+='<span rel="levelIn" class="zp_dyn">'+ZPI18N.getString("zp.lms.learningplan.in")+'</span><div class="zp_Sm zp_c3" id="levelMenu"></div>'),i+="</div></div>"}i+="</div>",$(".zp_msk").show(),$(".zp_msk").append(i)}else document.querySelector('[rel="courseBody"]').innerHTML=i;$("#createPopup").click((function(){$("#courseSearch").focus(),$("#courseSearch").val("")}))},searchCourse:function(e,t,s,r){var l=$(e).val();"lpFetch"!=s?zplms.fetchCourses(null,r,s,l):"lpFetch"==s&&zplms.fetchCourses(null,null,"lpFetch",l,0)},selectCourses:function(e,t,s,r,l,a,n){if(!a&&$("#entityId_"+e).toggleClass("sel"),$("#entityId_"+e).hasClass("sel")){if(Object.keys(lmslearningplan.selectedCourses).length<4)(i=document.createElement("li")).setAttribute("rel","cImg_"+e),i.innerHTML='<div class="ZP_photo"><img src='+t+'><i class="IC-tck1"></i></div>',document.getElementById("coursePlanList").appendChild(i);else if(Object.keys(lmslearningplan.selectedCourses).length>3){var i;document.getElementById("coursePlanList").querySelector('[rel="imgCount"]')&&document.getElementById("coursePlanList").querySelector('[rel="imgCount"]').parentElement.remove(),(i=document.createElement("li")).setAttribute("rel","cImg_plusCourse"),i.innerHTML='<div class="ZP_photo Mrecnt" rel="imgCount">'+(Object.keys(lmslearningplan.selectedCourses).length-3)+"</div>",document.getElementById("coursePlanList").appendChild(i)}0==Object.keys(lmslearningplan.selectedCourses).length&&("lpFetch"==n&&(document.querySelector('[rel="levelIn"]')&&document.querySelector('[rel="levelIn"]').classList.remove("zp_dyn"),document.getElementById("levelMenu")&&document.getElementById("levelMenu").classList.remove("zp_dyn")),document.getElementById("coursePopup").querySelector('[rel="coursePlanList"]').classList.remove("disabled")),lmslearningplan.selectedCourses.hasOwnProperty(e)||(lmslearningplan.selectedCourses[e]=e),document.getElementById("levelMenu")&&null===document.getElementById("levelMenu").querySelector('[class="zp_Sms"]')&&"lpFetch"==n&&lmslearningplan.createLevelMenu(document.getElementById("levelMenu"),lmslearningplan.fetchAddedLevels())}else{delete lmslearningplan.selectedCourses[e],document.getElementById("coursePlanList").innerHTML="";var o=0;Object.keys(lmslearningplan.selectedCourses).forEach((function(t){var s=document.createElement("li");if(o<4){var r=lmslearningplan.courseImg[t];s.setAttribute("rel","cImg_"+e),s.innerHTML='<div class="ZP_photo"><img src='+r+'><i class="IC-tck1"></i></div>'}else document.getElementById("coursePlanList").querySelector('[rel="imgCount"]')&&document.getElementById("coursePlanList").querySelector('[rel="imgCount"]').parentElement.remove(),s.setAttribute("rel","cImg_plusCourse"),s.innerHTML='<div class="ZP_photo Mrecnt" rel="imgCount">'+(Object.keys(lmslearningplan.selectedCourses).length-4)+"</div>";o+=1,document.getElementById("coursePlanList").appendChild(s)})),isEmpty(lmslearningplan.selectedCourses)&&"lpFetch"==n&&(document.querySelector('[rel="levelIn"]')&&document.querySelector('[rel="levelIn"]').classList.add("zp_dyn"),document.getElementById("levelMenu")&&document.getElementById("levelMenu").classList.add("zp_dyn"),document.getElementById("coursePopup").querySelector('[rel="coursePlanList"]')&&document.getElementById("coursePopup").querySelector('[rel="coursePlanList"]').classList.add("disabled"))}l&&zplms.fetchCourses(null,null,"lpFetch",null,4),l&&($("#courseSearch").focus(),$("#courseSearch").val(""))},fetchAddedLevels:function(e,t){zplms.get("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/levels",null,e)},fetchLevels:function(e){lmslearningplan.menuCallBack=this.updateOptionList,lmslearningplan.inputvalue=this.value,null!=this.value?lmslearningplan.fetchAddedLevels(lmslearningplan.levelView,this.value):lmslearningplan.fetchAddedLevels(lmslearningplan.levelView)},levelView:function(e){for(var t={},s=0;s<e[1].length;s++)t[e[1][s].levelId]=[e[1][s].levelName,""];lmslearningplan.menuCallBack(t,lmslearningplan.inputvalue)},createLevel:function(){$(".zp_msk").html("");var e='<div class="zp_popup" style="width:600px"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.learningplan.addlevel")+'</font><i class="IC-cls" onclick="lmslearningplan.closePopup()" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></div><div class="zp_Pocnt" style="max-height:700px;"><div class="zp_Sm"><label>'+ZPI18N.getString("zp.lms.sessions.name")+'</label><div><input required="" id="levelName" type="text" value="" placeholder="'+ZPI18N.getString("zp.lms.learningplan.levelname")+'"></div></div></div><div class="zp_btn"><button class="zpthm" onclick="lmslearningplan.addlevelInfo()">'+ZPI18N.getString("zp.lms.save")+"</button></div></div>";$(".zp_msk").show(),$(".zp_msk").append(e),document.querySelector('[id="levelName"]').focus(),$("#levelName").on("keypress",(function(e){if(13==e.keyCode)return lmslearningplan.addlevelInfo(),!1}))},addlevelInfo:function(e){var t={levelName:e?document.querySelector('[rel="levelNameEdit_'+e.getAttribute("rel").split("_")[1]+'"]').innerHTML:document.getElementById("levelName").value};e&&(t.levelId=e.getAttribute("rel").split("_")[1]),t.parentLevelId=$("#addedCourses").find(".zp_ascrs.zp_crsmar:last")[0]?$("#addedCourses").find(".zp_ascrs.zp_crsmar:last")[0].getAttribute("id").split("_")[1]:0,t.mode=1,zplms.post("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/levels",t,(function(e){0!=e[1].courseLevelInfo&&document.getElementById("nomyc")&&document.getElementById("nomyc").remove(),lmslearningplan.constructCourseAndLevelList(e[1],!1),$("#showCouOpt").find(".zp_Tglst").attr("data-text",ZPI18N.getString("zp.lms.trainers.ActiveCourses")),$("#showCouCrOpt").find(".zp_Tglst").attr("data-text",ZPI18N.getString("zp.lms.trainers.ActiveCourses")),lmslearningplan.closePopup()}))},addCoursesToPlan:function(e,t,s,r){if(document.getElementById("coursePopup")&&document.getElementById("coursePopup").querySelector('[rel="coursePlanList"]')&&document.getElementById("coursePopup").querySelector('[rel="coursePlanList"]').classList.add("disabled"),s||(r=0===e&&null!=$("#levelMenu").find(".zp_Tglst").attr("_rel")?$("#levelMenu").find(".zp_Tglst").attr("_rel"):0),1==e){var l={};selectedItems=0===e?document.getElementById("coursePopup").querySelectorAll('[class="sel"]'):document.querySelector('[rel="courselocksettings"]').querySelectorAll('[class="zp_Tg"]'),selectedItems.forEach((function(t){var s=0==e?t.getAttribute("id").split("_")[1]:t.getAttribute("data-value");l[s]=s,lmslearningplan.selectedCourses=l}))}var a=1===e?t:0,n=0;document.querySelector('[id="levelMenu"]')&&null!=document.querySelector('[id="levelMenu"]').querySelector('[class="zp_Tglst ntxt"]')&&null!=document.querySelector('[id="levelMenu"]').querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel")&&(s=!0),s&&document.querySelector('[id="level_'+r+'"]').querySelector('[rel="levelCourseList"]')&&document.querySelector('[id="level_'+r+'"]').querySelector('[rel="levelCourseList"]').lastChild&&document.querySelector('[id="level_'+r+'"]').querySelector('[rel="levelCourseList"]').lastChild.querySelector("li")?n=document.querySelector('[id="level_'+r+'"]').querySelector('[rel="levelCourseList"]').lastChild.querySelector("li").getAttribute("id").split("_")[1]:document.querySelector('[rel="courseListDiv"]')&&document.querySelector('[rel="courseListDiv"]').lastChild&&document.querySelector('[rel="courseListDiv"]').lastChild.querySelector('[_irel="coursedrag"]')&&!document.querySelector('[rel="courseListDiv"]').lastChild.querySelector('[_irel="coursedrag"]').closest('[rel="llist"]')&&(n=0===e&&0==r?document.querySelector('[rel="courseListDiv"]').lastChild.querySelector('[_irel="coursedrag"]').id.split("_")[1]:0);var i={levelId:r,courseIds:JSON.stringify(lmslearningplan.selectedCourses),mappedCourseId:a,type:e};0===e&&(i.parentCourseId=n),i.mode=1,zplms.post("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/courses",i,(function(e){"Mapped successfully"==e[1].msg&&(document.getElementById("coursePopup")&&document.getElementById("coursePopup").querySelector('[rel="coursePlanList"]').classList.remove("disabled"),0!=e[1].courseInfo&&document.getElementById("nomyc")&&document.getElementById("nomyc").remove(),lmslearningplan.selectedCourses={},lmslearningplan.addedPlanDetails.courseInfo=e[1].courseInfo,lmslearningplan.addedPlanDetails.courseLevelInfo=e[1].courseLevelInfo,lmslearningplan.addedPlanDetails.isLevelMapped=e[1].isLevelMapped,lmslearningplan.constructCourseAndLevelList(e[1],a),$("#showCouOpt").find(".zp_Tglst").attr("data-text",ZPI18N.getString("zp.lms.trainers.ActiveCourses")),$("#showCouCrOpt").find(".zp_Tglst").attr("data-text",ZPI18N.getString("zp.lms.trainers.ActiveCourses")),lmslearningplan.closePopup(),lmslearningplan.isEdited=!0)}))},dragAndDropNoImgHandle:function(e){if(0!==e&&0==document.querySelector('[id="level_'+e+'"]').querySelectorAll('[rel="clist"]').length&&0==document.querySelector('[id="level_'+e+'"]').querySelectorAll('[rel="noCourse"]').length){var t='<div class="ZPNdata" rel="noCourse" id="noCourse_'+e+'" style="display: flex;"><div><label><p><a rel="levelId_'+e+'" onclick="zplms.fetchCourses(null, null, \'lpFetch\', null, 2)">'+ZPI18N.getString("zp.lms.course.coursecreate")+"</a> "+ZPI18N.getString("zp.lms.learningplan.toinitiatecoulevel")+"</p></label></div></div>";document.getElementById("level_"+e).innerHTML+=t}else 0!==e&&0!=document.querySelector('[id="level_'+e+'"]').querySelectorAll('[rel="clist"]').length&&0!=document.querySelector('[id="level_'+e+'"]').querySelectorAll('[rel="noCourse"]').length&&document.querySelector('[id="level_'+e+'"]').querySelector('[rel="noCourse"]').remove()},courseSettingsMenu:function(e,t){lmslearningplan.menuObj.insertMenu({elem:t,type:"select",mode:"multi",allow_new:!1,menutype:1,menulist:lmslearningplan.courseSettings,click:e}),lmsmenu.changeToSelectMenu(t,{},"multi",null,ZPI18N.getString("zp.select"))},courseSettings:function(e){lmslearningplan.menuCallBack=this.updateOptionList,lmslearningplan.inputvalue=this.value,null!=this.value?zplms.fetchCourses(lmslearningplan.courseForLock,null,"lpFetch",this.value,1):zplms.fetchCourses(lmslearningplan.courseForLock,null,"lpFetch",null,1)},courseForLock:function(e){var t={};Object.keys(e[1]).forEach((function(s){t[e[1][s].courseId]=[e[1][s].courseName,""]})),lmslearningplan.menuCallBack(t,lmslearningplan.inputvalue)},deleteCourseLevel:function(e,t){lmslearningplan.addedPlanDetails.planInfo&&(e||lmslearningplan.addedPlanDetails.planInfo.courseId||0==lmslearningplan.addedPlanDetails.planInfo.courseId)?!t&&(document.querySelector('[id="course_'+lmslearningplan.addedPlanDetails.planInfo.courseId+'"]')&&document.querySelector('[id="course_'+lmslearningplan.addedPlanDetails.planInfo.courseId+'"]').classList.contains("zp_mand")&&$(".zp_mand").attr("id").split("_")[1]==lmslearningplan.addedPlanDetails.planInfo.courseId||document.querySelector('[id="level_'+lmslearningplan.addedPlanDetails.planInfo.levelId+'"]')&&0==lmslearningplan.addedPlanDetails.planInfo.courseId&&(1==document.querySelector('[id="level_'+lmslearningplan.addedPlanDetails.planInfo.levelId+'"]').querySelectorAll('[class="zp_mand"]').length||document.querySelector('[id="level_'+lmslearningplan.addedPlanDetails.planInfo.levelId+'"]').querySelectorAll('[class="zp_mand"]').length==$(".zp_mand").length))&&1==lmslearningplan.addedPlanDetails.planInfo.publishState&&1==$(".zp_mand").length?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.learningplanmsg.atleastonemandmsg")):(courseId=t?e:lmslearningplan.addedPlanDetails.planInfo.courseId?lmslearningplan.addedPlanDetails.planInfo.courseId:0,t&&(mappedCourseId=t),levelId=0==lmslearningplan.addedPlanDetails.planInfo.courseId&&lmslearningplan.addedPlanDetails.planInfo.levelId?lmslearningplan.addedPlanDetails.planInfo.levelId:0,result=0!==courseId?"courses/"+courseId:"levels/"+levelId,zplms.delete("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/"+result,params,(function(s){if("Course deleted successfully"==s[1].msg){var r=0;if(e)document.getElementById("lockCourse_"+e).remove(),delete lmslearningplan.addedPlanDetails.lockedCourses[e],document.getElementsByClassName("zp_popup")[0].querySelector('[class="zp_CPlst"]')&&0==document.getElementsByClassName("zp_popup")[0].querySelector('[class="zp_CPlst"]').querySelectorAll("li").length&&document.querySelector('[id="course_'+t+'"]').classList.remove("zp_lcked");else if(0==lmslearningplan.addedPlanDetails.planInfo.courseId||lmslearningplan.addedPlanDetails.planInfo.levelId){if(0!=lmslearningplan.addedPlanDetails.planInfo.courseId&&(r=1,delete lmslearningplan.addedPlanDetails.addedCourse[lmslearningplan.addedPlanDetails.planInfo.courseId],document.getElementById("course_"+lmslearningplan.addedPlanDetails.planInfo.courseId).remove(),0==document.getElementById("level_"+lmslearningplan.addedPlanDetails.planInfo.levelId).querySelectorAll("li").length)){document.getElementById("level_"+lmslearningplan.addedPlanDetails.planInfo.levelId).querySelector('[class="IC-edit"]')&&document.getElementById("level_"+lmslearningplan.addedPlanDetails.planInfo.levelId).querySelector('[class="IC-edit"]').remove(),document.querySelector('[rel="levelId_'+lmslearningplan.addedPlanDetails.planInfo.levelId+'"]')&&document.querySelector('[rel="levelId_'+lmslearningplan.addedPlanDetails.planInfo.levelId+'"]').remove();var l='<div class="ZPNdata" rel="noCourse" id="noCourse_'+lmslearningplan.addedPlanDetails.planInfo.levelId+'" style="display: flex;"><div><label><p><a rel="levelId_'+lmslearningplan.addedPlanDetails.planInfo.levelId+'" onclick="zplms.fetchCourses(null, null, \'lpFetch\', null, 2)">'+ZPI18N.getString("zp.lms.course.coursecreate")+"</a> "+ZPI18N.getString("zp.lms.learningplan.toinitiatecoulevel")+"</p></label></div></div>";document.getElementById("level_"+lmslearningplan.addedPlanDetails.planInfo.levelId).innerHTML+=l}}else r=1,delete lmslearningplan.addedPlanDetails.addedCourse[lmslearningplan.addedPlanDetails.planInfo.courseId],document.getElementById("course_"+lmslearningplan.addedPlanDetails.planInfo.courseId)&&document.getElementById("course_"+lmslearningplan.addedPlanDetails.planInfo.courseId).closest('[rel="clist"]').remove();if(0!=levelId){var a=document.getElementById("level_"+lmslearningplan.addedPlanDetails.planInfo.levelId).querySelectorAll("li");(0!=lmslearningplan.addedPlanDetails.planInfo.courseId&&0==a.length||0==lmslearningplan.addedPlanDetails.planInfo.courseId)&&(a.forEach((function(e){r+=1,delete lmslearningplan.addedPlanDetails.addedCourse[e.getAttribute("id").split("_")[1]]})),document.getElementById("level_"+lmslearningplan.addedPlanDetails.planInfo.levelId).remove())}if(document.getElementById("addedCourses")&&!document.getElementById("addedCourses").querySelector('[rel="llist"]')&&0==document.getElementById("addedCourses").querySelectorAll("li").length){l='<div class="ZPNdata" id="nomyc" style="display: flex !important;"><div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.learningplan.nocourseleveltag")+"</h3><p><a onclick=\"zplms.fetchCourses(null, null, 'lpFetch', null, 0)\">"+ZPI18N.getString("zp.lms.course.coursecreate")+"</a> "+ZPI18N.getString("zp.or")+' <a onclick="lmslearningplan.createLevel()">'+ZPI18N.getString("zp.lms.learningplan.addlevel")+"</a> "+ZPI18N.getString("zp.lms.learningplan.toinitiatecoulevel")+"</p></label></div></div>";document.getElementById("addedCourses").innerHTML+=l}document.getElementById("courseCount")&&0!=r&&(document.getElementById("courseCount").innerHTML=JSON.parse(document.getElementById("courseCount").innerHTML)-r),0==document.getElementById("courseCount").innerHTML&&($("#showCouCrOpt").hide()&&$("#showCouOpt").hide()),lmslearningplan.isEdited=!0}else"Course has enrolled Users"==s[1].msg&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.course.coursenotdel"))}))):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.course.coursenotdel"))},createdRule:function(e,t){if(lmslearningplan.addedPlanDetails.planInfo.isPlanOwner){var s,r='<div class="zp_vopt"><h4>'+ZPI18N.getString("zp.lms.learningplan.enrollmentandoutcome")+"</h4><p>"+ZPI18N.getString("zp.lms.learningplan.enrollmentandoutcomedesc")+"</p>";if(e){for(var l=0;l<e.length;l++)for(var a in r+='<ul class="zp_olist">',e[l]){r+="<li rel="+(m=e[l][a]).ruleId+'><h4><span rel="rName">'+m.ruleName+'</span><div class="zp_aicn"><i class="IC-edit" onclick="lmslearningplan.editRule(\''+m.ruleId+'\')" data-ttip="'+ZPI18N.getString("zp.lms.courseoverview.edit")+'"></i><i class="IC-trash" onclick="lmslearningplan.deleteRule(\''+m.ruleId+'\')" data-ttip="'+ZPI18N.getString("zp.lms.delete")+'"></i></div></h4>';for(var n=0;n<2;n++){var i=m[n];if(!isEmpty(i)){r+="<div><p>",r+=0==n?ZPI18N.getString("zp.lms.learningplan.enrollment"):ZPI18N.getString("zp.lms.learningplan.outcomes"),r+=" :</p>";for(var o=0;o<i.length;o++){var c=i[o];if(0!=c.length){s=0==o?"zp.designation":1==o?"zp.department":2==o?"zp.lms.learningplan.role":3==o?"zp.lms.learningplan.skills":4==o?"zp.location":5==o?"zp.lms.members.user":6==o?"zp.group":"zp.experience",r+="<span>"+ZPI18N.getString(s)+" "+ZPI18N.getString("zp.lms.learningplan.is")+" ";for(var d=0;d<c.length;d++)r+=0!=d?", ":"",r+=c[d];r+="</span>"}}r+="</div>"}}r+="</li>"}r+="</ul>"}lmslearningplan.addedPlanDetails.planInfo.isPlanOwner&&(r+='<font class="zp_lnkblu"><p onclick="lmslearningplan.createNewRule()"><i class="IC-plus"></i><span>',r+=0!=e.length?ZPI18N.getString("zp.lms.learningplan.newrule"):ZPI18N.getString("zp.lms.learningplan.createrule")+"</span></p></font>",r+="</div>"),document.getElementsByClassName("zp_ACrgcnt")[0].innerHTML=r}else{r="";if(e){for(l=0;l<e.length;l++)for(var a in e[l]){var m;if(m=e[l][a][1])for(o=0;o<m.length;o++)0!=m[o].length&&(r+="<span>"+m[o]+"</span>");else r+="<span>-</span>"}0==e.length&&(r+="<span>-</span>")}else r+="<span>-</span>";var u=document.querySelector('[rel="leaoutcomes"]');$(r).insertAfter($(u))}},createNewRule:function(){$(".zp_msk").html("");var e='<div class="zp_popup" style="width:800px; height: 92%;"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.learningplan.enrollmentandoutcome")+'</font><i class="IC-cls" onclick="lmslearningplan.closePopup()" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></div><div class="zp_Pocnt" style="height: calc(100% - 128px);"><div class="zp_Attl"><span>'+ZPI18N.getString("zp.lms.learningplan.enrollmentandoutcomesetdesc")+'</span><div class="zp_STapl nopd"><div class="zp_Enttl"><div id="" class="zp_Sm"><h4>'+ZPI18N.getString("zp.lms.learningplan.rulename")+'</h4><div><input rel="ruleName" id="ruleName" type="text" value="'+ZPI18N.getString("zp.lms.learningplan.createrule")+'"></div></div></div><div class="zp_ATflcnt"><h4>'+ZPI18N.getString("zp.lms.learningplan.applicableto")+'</h4><div id="applicableTo"><div class="zp_ATfltr" rel="applicableMenu_1"><div class="zp_Sm zp_c2" rel="applicableToType_1"></div><span>'+ZPI18N.getString("zp.lms.learningplan.is")+'</span><div class="zp_Sm zp_c7" rel="applicableTo_1"></div></div><div class="zp_ATfltr zp_ATfltad"><div rel="applicableNewRule" onclick="lmslearningplan.addNewRule(this, 0)"><i class="IC-plus"></i>'+ZPI18N.getString("zp.lms.learningplan.addcondition")+'</div></div></div></div><div class="zp_ATflcnt"><h4>'+ZPI18N.getString("zp.lms.learningplan.outcomes")+'</h4><div id="outComes"><div class="zp_ATfltr" rel="outcomeMenu_1"><div class="zp_Sm zp_c2" rel="outcomeType_1"></div><span>'+ZPI18N.getString("zp.lms.learningplan.is")+'</span><div class="zp_Sm zp_c7" rel="outcome_1"></div></div><div class="zp_ATfltr zp_ATfltad"><div rel="outcomeNewRule" onclick="lmslearningplan.addNewRule(this, 1)"><i class="IC-plus"></i>'+ZPI18N.getString("zp.lms.learningplan.addoutcome")+'</div></div></div></div></div></div></div><div class="zp_btn"><button class="zpthm disabled" rel="saveRule" onclick="lmslearningplan.addApplicableToAndOutcome(0)">'+ZPI18N.getString("zp.lms.save")+"</button></div></div>";$(".zp_msk").show(),$(".zp_msk").append(e),document.querySelector('[rel="ruleName"]').focus();var t=2*$("#ruleName").val().length;document.querySelector('[id="ruleName"]').setSelectionRange(t,t),lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="applicableMenu_1"]')),lmslearningplan.menuConstruction("applicableToType_1",1),lmslearningplan.createApplicableToOrOutcomeMenu(document.querySelector('[rel="applicableTo_1"]'),lmslearningplan.fetchApplicableToOrOutcome(),void 0,1),lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="outcomeMenu_1"]')),lmslearningplan.menuConstruction("outcomeType_1",1),lmslearningplan.createApplicableToOrOutcomeMenu(document.querySelector('[rel="outcome_1"]'),lmslearningplan.fetchApplicableToOrOutcome(),void 0,2)},addNewRule:function(e,t,s){var r="",l=0;0===t?(r+='<div class="zp_ATfltr" rel="applicableMenu_'+(l=$("#applicableTo").find(".zp_Sm.zp_c7").length+1)+'"><div class="zp_Sm zp_c2" rel="applicableToType_'+l+'"></div><span>is</span>',s!=ZPI18N.getString("zp.experience")&&(r+='<div class="zp_Sm zp_c7" rel="applicableTo_'+l+'"></div>'),1!=l&&(r+='<font><i class="IC-cls" rel="close0_'+l+'" onclick="lmslearningplan.cancelCondition(this)" data-ttip="'+ZPI18N.getString("zp.lms.cancel")+'"></i></font>'),s==ZPI18N.getString("zp.experience")&&(r+='<div class="zp_Sm zp_c7 zp_Dinf" id="expelem_'+l+'"><div ><input type="text"><font>'+ZPI18N.getString("zp.lms.learningplan.years")+"</font></div></div>",document.querySelector('[rel="saveRule"]').classList.remove("disabled")),r+="</div>"):(r+='<div class="zp_ATfltr" rel="outcomeMenu_'+(l=$("#outComes").find(".zp_Sm.zp_c7").length+1)+'"><div class="zp_Sm zp_c2" rel="outcomeType_'+l+'"></div><span>is</span><div class="zp_Sm zp_c7" rel="outcome_'+l+'"></div>',1!=l&&(r+='<font><i class="IC-cls" rel="close1_'+l+'" onclick="lmslearningplan.cancelCondition(this)" data-ttip="'+ZPI18N.getString("zp.lms.cancel")+'"></i></font>'),r+="</div>");var a=e.parentElement;if($(r).insertBefore($(a)),0===t)lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="applicableMenu_'+l+'"]')),lmslearningplan.menuConstruction("applicableToType_"+l,l,s),s!=ZPI18N.getString("zp.experience")&&lmslearningplan.createApplicableToOrOutcomeMenu(document.querySelector('[rel="applicableTo_'+l+'"]'),lmslearningplan.fetchApplicableToOrOutcome(),void 0,1);else{lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="outcomeMenu_'+l+'"]')),lmslearningplan.menuConstruction("outcomeType_"+l,l,s);var n=s==ZPI18N.getString("zp.designation")?1:s==ZPI18N.getString("zp.department")?2:s==ZPI18N.getString("zp.lms.learningplan.role")?3:s==ZPI18N.getString("zp.lms.learningplan.skills")?4:s==ZPI18N.getString("zp.location")?5:s==ZPI18N.getString("zp.lms.members.user")?6:s==ZPI18N.getString("zp.group")?7:0;lmslearningplan.createApplicableToOrOutcomeMenu(document.querySelector('[rel="outcome_'+l+'"]'),lmslearningplan.fetchApplicableToOrOutcome(),void 0,2,n)}},fetchApplicableToOrOutcome:function(e,t,s){if(t||event.target.parentElement&&$(event.target.parentElement).closest(".zp_Sm").attr("rel")){var r=$(event.target.parentElement).closest(".zp_Sm").attr("rel").split("_"),l="applicableTo"===r[0]?document.querySelector('[rel="applicableToType_'+r[1]+'"]'):document.querySelector('[rel="outcomeType_'+r[1]+'"]');if((l=null!=l.querySelector('[class="zp_Tglst ntxt"]')?l.querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel"):(l=l.querySelector('[class="zp_Tglst"]').getAttribute("data-text"))==ZPI18N.getString("zp.designation")?1:l==ZPI18N.getString("zp.department")?2:l==ZPI18N.getString("zp.lms.learningplan.role")?3:l==ZPI18N.getString("zp.lms.learningplan.skills")?4:l==ZPI18N.getString("zp.location")?5:l==ZPI18N.getString("zp.lms.members.user")?6:l==ZPI18N.getString("zp.group")?7:0)>0){("applicableTo"===r[0]||0!=document.getElementById("applicableTo").querySelectorAll('[class="zp_Tglst ntxt"]').length&&document.getElementById("applicableTo").querySelectorAll('[class="zp_ATfltr"]').length!=document.getElementById("applicableTo").querySelectorAll('[class="zp_Tglst ntxt"]').length-1)&&document.querySelector('[rel="saveRule"]').classList.remove("disabled");var a={type:l};t&&(a.searchTxt=t),zplms.get("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/criteria",a,e)}}else!s&&$("#applicableTo .zp_Tg").length<1&&$(".zp_Dinf").length<1?document.querySelector('[rel="saveRule"]').classList.add("disabled"):$("#applicableTo").find(".zp_Sm.zp_c7").find(".zp_Tglst.ntxt").length>1&&document.querySelector('[rel="saveRule"]').classList.remove("disabled")},createApplicableToOrOutcomeMenu:function(e,t,s,r,l){var a=1==r||2==r&&(4==l||7==l)?"multi":"single";s=null!=s?s:{},lmslearningplan.menuObj.insertMenu({elem:e,type:"select",mode:a,allow_new:!1,menutype:1,menulist:lmslearningplan.fetchApplicableOrOutcome,click:t}),lmsmenu.changeToSelectMenu(e,s,a,null,ZPI18N.getString("zp.select"))},fetchApplicableOrOutcome:function(e){lmslearningplan.menuCallBack=this.updateOptionList,lmslearningplan.inputvalue=this.value,null!=this.value?lmslearningplan.fetchApplicableToOrOutcome(lmslearningplan.applicableToOrOutcomeView,this.value):lmslearningplan.fetchApplicableToOrOutcome(lmslearningplan.applicableToOrOutcomeView)},applicableToOrOutcomeView:function(e){var t={};Object.keys(e[1]).forEach((function(s){t[e[1][s]]=[s,""]})),lmslearningplan.menuCallBack(t,lmslearningplan.inputvalue)},editRule:function(e){for(var t,s=0;s<lmslearningplan.addedPlanDetails.planEntities.length;s++)for(var r in lmslearningplan.addedPlanDetails.planEntities[s])e==r&&(t=lmslearningplan.addedPlanDetails.planEntities[s][e]);$(".zp_msk").html("");for(var l='<div class="zp_popup" style="width:800px; height: 92%;"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.learningplan.enrollmentandoutcome")+'</font><i class="IC-cls" onclick="lmslearningplan.closePopup(0)" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></div><div class="zp_Pocnt" style="height: calc(100% - 128px);"><div class="zp_Attl" rel="rule_'+e+'"><span>'+ZPI18N.getString("zp.lms.learningplan.enrollmentandoutcomesetdesc")+'</span><div class="zp_STapl nopd"><div class="zp_Enttl"><div id="" class="zp_Sm"><h4>'+ZPI18N.getString("zp.lms.learningplan.rulename")+'</h4><div><input rel="ruleName" type="text" value="'+t.ruleName+'"></div></div></div><div class="zp_ATflcnt"><h4>'+ZPI18N.getString("zp.lms.learningplan.applicableto")+'</h4><div id="applicableTo">',a=0;a<2;a++){var n=1;if(t[a])for(s=0;s<8;s++)0!=t[a][s].length&&(0==a?(l+='<div class="zp_ATfltr" rel="applicableMenu_'+n+'"><div class="zp_Sm zp_c2" rel="applicableToType_'+n+'"></div><span>'+ZPI18N.getString("zp.lms.learningplan.is")+"</span>",7!=s&&(l+='<div class="zp_Sm zp_c7" rel="applicableTo_'+n+'"></div>'),1!=n&&(l+='<font><i class="IC-cls" rel="close0_'+n+'" onclick="lmslearningplan.cancelCondition(this)" data-ttip="'+ZPI18N.getString("zp.lms.cancel")+'"></i></font>'),7==s&&(l+='<div class="zp_Sm zp_c7 zp_Dinf" id="expelem_'+n+'"><div ><input type="text"><font>'+ZPI18N.getString("zp.lms.learningplan.years")+"</font></div></div>"),l+="</div>"):(l+='<div class="zp_ATfltr" rel="outcomeMenu_'+n+'"><div class="zp_Sm zp_c2" rel="outcomeType_'+n+'"></div><span>'+ZPI18N.getString("zp.lms.learningplan.is")+'</span><div class="zp_Sm zp_c7" rel="outcome_'+n+'"></div>',1!=n&&(l+='<font><i class="IC-cls" rel="close1_'+n+'" onclick="lmslearningplan.cancelCondition(this)" data-ttip="'+ZPI18N.getString("zp.lms.cancel")+'"></i></font>'),l+="</div>"),n+=1);else 1==a&&(l+='<div class="zp_ATfltr" rel="outcomeMenu_'+n+'"><div class="zp_Sm zp_c2" rel="outcomeType_'+n+'"></div><span>'+ZPI18N.getString("zp.lms.learningplan.is")+'</span><div class="zp_Sm zp_c7" rel="outcome_'+n+'"></div></div>');l+=0==a?'<div class="zp_ATfltr zp_ATfltad"><div rel="applicableNewRule" onclick="lmslearningplan.addNewRule(this, 0)"><i class="IC-plus"></i>'+ZPI18N.getString("zp.lms.learningplan.addcondition")+'</div></div></div></div><div class="zp_ATflcnt"><h4>'+ZPI18N.getString("zp.lms.learningplan.outcomes")+'</h4><div id="outComes">':'<div class="zp_ATfltr zp_ATfltad"><div rel="outcomeNewRule" onclick="lmslearningplan.addNewRule(this, 1)"><i class="IC-plus"></i>'+ZPI18N.getString("zp.lms.learningplan.addoutcome")+"</div></div>"}l+='</div></div></div></div></div><div class="zp_btn"><button class="zpthm" rel="saveRule" onclick="lmslearningplan.addApplicableToAndOutcome(1, \''+e+"')\">"+ZPI18N.getString("zp.lms.save")+"</button></div></div>",$(".zp_msk").show(),$(".zp_msk").append(l);var i={},o=[];for(a=0;a<2;a++){n=1;if(t[a]){var c=0==a?t.eData0:t.eData1;i={};for(s=0;s<8;s++)if(0!=t[a][s].length){var d=0==s?"zp.designation":1==s?"zp.department":2==s?"zp.lms.learningplan.role":3==s?"zp.lms.learningplan.skills":4==s?"zp.location":5==s?"zp.lms.members.user":6==s?"zp.group":"zp.experience";0==a?(lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="applicableMenu_'+n+'"]')),lmslearningplan.menuConstruction("applicableToType_"+n,n,ZPI18N.getString(d)),7==s?(document.querySelector('[rel="applicableMenu_'+n+'"]').querySelector('[id="expelem_'+n+'"]').querySelector("input").value=t[a][s][0],lmslearningplan.getEditValues(c[s])):lmslearningplan.createApplicableToOrOutcomeMenu(document.querySelector('[rel="applicableTo_'+n+'"]'),lmslearningplan.fetchApplicableToOrOutcome(null,null,!0),lmslearningplan.getEditValues(c[s]),1)):(lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="outcomeMenu_'+n+'"]')),lmslearningplan.menuConstruction("outcomeType_"+n,n,ZPI18N.getString(d)),lmslearningplan.createApplicableToOrOutcomeMenu(document.querySelector('[rel="outcome_'+n+'"]'),lmslearningplan.fetchApplicableToOrOutcome(null,null,!0),lmslearningplan.getEditValues(c[s]),2,s+1)),n+=1,0!=lmslearningplan.data.length&&(i[s]=lmslearningplan.data)}o.push(i)}else 1==a&&(lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="outcomeMenu_'+n+'"]')),lmslearningplan.menuConstruction("outcomeType_"+n,n),lmslearningplan.createApplicableToOrOutcomeMenu(document.querySelector('[rel="outcome_'+n+'"]'),lmslearningplan.fetchApplicableToOrOutcome(null,null,!0),void 0,2))}lmslearningplan.data=o},getEditValues:function(e){var t={},s=[];return $.each(e,(function(e,r){Object.keys(r).forEach((function(e){t[r[e]]=[e,""],s.push(r[e])}))})),lmslearningplan.data=s,t},getApplicableOrOutcomeType:function(){var e=this.elem.getAttribute("rel").split("_");if(lmslearningplan.applicableOrOutcomeType=this.elem.querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel"),"applicableToType"!==e[0]||null==document.querySelector('[rel="applicableTo_'+e[1]+'"]')&&!document.getElementById("expelem_"+e[1])){if(document.querySelector('[rel="outcomeType_'+e[1]+'"]')&&document.querySelector('[rel="outcomeType_'+e[1]+'"]').querySelector('[class="zp_Tglst ntxt"]')&&(document.querySelector('[rel="outcomeType_'+e[1]+'"]').querySelector('[class="zp_Tglst ntxt"]').getAttribute("data-text")==ZPI18N.getString("zp.lms.learningplan.skills")||document.querySelector('[rel="outcomeType_'+e[1]+'"]').querySelector('[class="zp_Tglst ntxt"]').getAttribute("data-text")==ZPI18N.getString("zp.group"))){document.querySelector('[rel="outcomeMenu_'+e[1]+'"]').remove();r=1==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.designation"):2==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.department"):5==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.location"):7==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.group"):ZPI18N.getString("zp.select");lmslearningplan.addNewRule(document.querySelector('[rel="outcomeNewRule"]'),1,r)}if(4==lmslearningplan.applicableOrOutcomeType||7==lmslearningplan.applicableOrOutcomeType){document.querySelector('[rel="outcomeMenu_'+e[1]+'"]').remove();var t=4==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.lms.learningplan.skills"):ZPI18N.getString("zp.group");lmslearningplan.addNewRule(document.querySelector('[rel="outcomeNewRule"]'),1,t)}if(null!=document.querySelector('[rel="outcome_'+e[1]+'"]')&&null!=document.querySelector('[rel="outcome_'+e[1]+'"]').querySelector('[_rel="items"]')){var s=document.querySelector('[rel="outcome_'+e[1]+'"]').querySelector('[_rel="items"]');s.classList.remove("ntxt"),s.innerHTML=""}else document.querySelector('[rel="outcome_'+e[1]+'"]')&&null!=document.querySelector('[rel="outcome_'+e[1]+'"]').querySelector('[class="zp_Tglst ntxt"]')&&(document.querySelector('[rel="outcome_'+e[1]+'"]').querySelector('[class="zp_Tglst ntxt"]').innerHTML=ZPI18N.getString("zp.select"))}else if(8==lmslearningplan.applicableOrOutcomeType)document.querySelector('[rel="applicableMenu_'+e[1]+'"]').remove(),lmslearningplan.addNewRule(document.querySelector('[rel="applicableNewRule"]'),0,ZPI18N.getString("zp.experience"));else if(document.querySelector('[rel="applicableToType_'+e[1]+'"]')&&document.getElementById("expelem_"+e[1])){document.querySelector('[rel="applicableMenu_'+e[1]+'"]').remove();var r=1==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.designation"):2==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.department"):3==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.lms.learningplan.role"):4==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.lms.learningplan.skills"):5==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.location"):6==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.lms.members.user"):7==lmslearningplan.applicableOrOutcomeType?ZPI18N.getString("zp.group"):ZPI18N.getString("zp.select");lmslearningplan.addNewRule(document.querySelector('[rel="applicableNewRule"]'),0,r)}else{var l=document.querySelector('[rel="applicableTo_'+e[1]+'"]').querySelector('[_rel="items"]');l.innerHTML="",l.classList.remove("ntxt")}},addApplicableToAndOutcome:function(e,t){var s={},r=[],l=[],a={},n={},i={},o=[],c=0,d=!1;$("#applicableTo").each((function(){var e=""==document.querySelector('[rel="ruleName"]').value?"Rule":document.querySelector('[rel="ruleName"]').value,s=[];if(n={},$("#applicableTo").find(".zp_ATfltr").each((function(){if(document.querySelector('[class="zp_ATfltr zp_ATfltad"]')!=this){if(c++,applicabledesigArr=[],applicabledepsArr=[],applicableroleArr=[],applicableskillArr=[],applicablelocArr=[],applicableuserArr=[],applicablegroupArr=[],applicablerexpArr=[],a={},null!=$(this).attr("_rel"))a.type=$(this).attr("_rel"),a.typeId=$(this).attr("_typeId");else if(null!=$(this).find(".zp_Tglst").attr("_rel"))a.type=$(this).find(".zp_Tglst").attr("_rel");else{var e=$(this).find(".zp_Tglst").attr("data-text");a.type=e==ZPI18N.getString("zp.designation")?1:e==ZPI18N.getString("zp.department")?2:e==ZPI18N.getString("zp.lms.learningplan.role")?3:e==ZPI18N.getString("zp.lms.learningplan.skills")?4:e==ZPI18N.getString("zp.location")?5:e==ZPI18N.getString("zp.lms.members.user")?6:e==ZPI18N.getString("zp.group")?7:e==ZPI18N.getString("zp.experience")?8:0}if($("[rel^=applicableTo_"+c+"]").find(".zp_Tg").each((function(){1==a.type?applicabledesigArr.push("desig:"+$(this).attr("data-value")):2==a.type?applicabledepsArr.push("dep:"+$(this).attr("data-value")):3==a.type?applicableroleArr.push("role:"+$(this).attr("data-value")):4==a.type?applicableskillArr.push("skill:"+$(this).attr("data-value")):5==a.type?applicablelocArr.push("loc:"+$(this).attr("data-value")):6==a.type?applicableuserArr.push("user:"+$(this).attr("data-value")):7==a.type&&applicablegroupArr.push("group:"+$(this).attr("data-value"))})),8==a.type&&""!=$("#expelem_"+c).find("input").val()){var t=$("#expelem_"+c).find("input").val();applicablerexpArr.push("exp:"+t)}1==a.type&&0!=applicabledesigArr.length?n.designation=applicabledesigArr.toString():2==a.type&&0!=applicabledepsArr.length?n.department=applicabledepsArr.toString():3==a.type&&0!=applicableroleArr.length?n.role=applicableroleArr.toString():4==a.type&&0!=applicableskillArr.length?n.skill=applicableskillArr.toString():5==a.type&&0!=applicablelocArr.length?n.location=applicablelocArr.toString():6==a.type&&0!=applicableuserArr.length?n.user=applicableuserArr.toString():7==a.type&&0!=applicablegroupArr.length?n.group=applicablegroupArr.toString():8==a.type&&0!=applicablerexpArr.length&&(n.exp=applicablerexpArr.toString()),a.applicableToIds=n,s.push(a),(applicabledesigArr.length>0||applicabledepsArr.length>0||applicableroleArr.length>0||applicableskillArr.length>0||applicablelocArr.length>0||applicableuserArr.length>0||applicablegroupArr.length>0||applicablerexpArr.length>0)&&(d=!0)}})),d){(i={})[e]=n,i.ruleName=e,i.ruleId=t||lmslearningplan.addedPlanDetails.ruleId,o.push(i)}s=[]})),s={};for(var m=document.getElementById("outComes").querySelectorAll('[class="zp_Sm zp_c7"]'),u=0;u<m.length;u++){var p=m[u],g=document.querySelector('[rel="outcomeType_'+p.getAttribute("rel").split("_")[1]+'"]');if(4==(g=null!=g.querySelector('[class="zp_Tglst ntxt"]')?g.querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel"):(g=g.querySelector('[class="zp_Tglst"]').getAttribute("data-text"))==ZPI18N.getString("zp.designation")?1:g==ZPI18N.getString("zp.department")?2:g==ZPI18N.getString("zp.lms.learningplan.role")?3:g==ZPI18N.getString("zp.lms.learningplan.skills")?4:g==ZPI18N.getString("zp.location")?5:g==ZPI18N.getString("zp.lms.members.user")?6:g==ZPI18N.getString("zp.group")?7:0)||7==g)for(var f=p.querySelectorAll("[data-value]"),v=0;v<f.length;v++){var h=(p=f[v]).getAttribute("data-value");l.push(h)}else p.querySelector('[class="zp_Tglst ntxt"]')&&l.push(p.querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel"));0!=l.length&&(s[g]=l),l=[]}if(!isEmpty(s)&&r.push(s),0!=o.length){var b={applicableToId:JSON.stringify(o),outcomeId:JSON.stringify(r),ruleId:t||lmslearningplan.addedPlanDetails.ruleId,mode:e};1==e&&(b.removeIds=JSON.stringify(lmslearningplan.data)),zplms.post("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/criteria/add",b,(function(e){delete lmslearningplan.addedPlanDetails.ruleId,lmslearningplan.closePopup(),lmslearningplan.createdRule(e[1].planEntities,0),lmslearningplan.addedPlanDetails.planEntities=e[1].planEntities}))}},deleteRule:function(e){for(var t,s={},r=[],l=0;l<lmslearningplan.addedPlanDetails.planEntities.length;l++)for(var a in lmslearningplan.addedPlanDetails.planEntities[l])e==a&&(t=lmslearningplan.addedPlanDetails.planEntities[l][e]);for(var n=0;n<2;n++){var i=0==n?t.eData0:t.eData1;if(i){s={};for(l=0;l<8;l++)0!=t[n][l].length&&(lmslearningplan.getEditValues(i[l]),s[l]=lmslearningplan.data);r.push(s)}}var o={ruleId:e||document.querySelector('[rel="ruleName"]').value,removeIds:JSON.stringify(r)};zplms.delete("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/criteria",o,(function(t){"Rule deleted successfully"==t[1].msg?(document.querySelector('[rel="'+e+'"]').remove(),Object.keys(lmslearningplan.addedPlanDetails.planEntities).forEach((function(t){count=t,lmslearningplan.addedPlanDetails.planEntities[parseInt(t)][e]&&lmslearningplan.addedPlanDetails.planEntities.splice(t,1)})),0==lmslearningplan.addedPlanDetails.planEntities.length&&(document.getElementsByClassName("zp_lnkblu")[0].getElementsByTagName("span")[0].innerText=ZPI18N.getString("zp.lms.learningplan.createrule"))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.publishplan"))}))},createMenu:function(e,t,s,r,l){lmslearningplan.menuObj.insertMenu({elem:t,type:"select",mode:"single",menulist:e,click:l}),lmsmenu.changeToSelectMenu(t,{},"single",null,r)},createLevelMenu:function(e,t){lmslearningplan.menuObj.insertMenu({elem:e,type:"select",mode:"single",menulist:lmslearningplan.fetchLevels,click:t}),lmsmenu.changeToSelectMenu(e,{},"single",null,ZPI18N.getString("zp.lms.learningplan.selectlevel"))},createCourseLevelMenu:function(e,t){lmsmenu.initiate({elem:e.closest('[rel="addCouLev"]'),width:"130px",type:"dropdown",arrowHead:!1,menulist:[{level:[ZPI18N.getString("zp.lms.learningplan.addlevel")]}],eve:t}).on("click",(function(){"level"==this.value&&lmslearningplan.createLevel()})).bind()},cardMore:function(e,t,s,r,l){var a=[],n=0==e.getAttribute("id").split("_")[1]?ZPI18N.getString("zp.lms.markfavourite"):ZPI18N.getString("zp.lms.unmarkfavourite"),i="";i=1==r?l?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable"):ZPI18N.getString("zp.lms.delete"),a=document.querySelector('[rel="enrollPlan_'+t+'"]')?[{markfav:[n]}]:[{markfav:[n]},{delete:[i]}],lmsmenu.initiate({elem:e,width:"150px",type:"dropdown",arrowHead:!0,menulist:a,eve:s}).on("click",(function(){if("markfav"==this.value){var e="Mark as favorite"==this.content[1]?1:0;lmslearningplan.markUnmarkFavourite(t,e,this.referObj.elem)}else"delete"==this.value&&lmslearningplan.deletePlan(t)})).bind()},courseMore:function(e,t){var s=[];if(lmslearningplan.addedPlanDetails.planInfo.isPlanOwner){var r=e.closest('[id="course_'+lmslearningplan.addedPlanDetails.planInfo.courseId+'"]')&&e.closest('[id="course_'+lmslearningplan.addedPlanDetails.planInfo.courseId+'"]').classList.contains("zp_mand")?ZPI18N.getString("zp.lms.learningplan.nonmarkasmand"):ZPI18N.getString("zp.lms.markasmand");s=0!=lmslearningplan.addedPlanDetails.planInfo.courseId?[{markasmand:[r]},{delete:[ZPI18N.getString("zp.lms.delete")]}]:[{delete:[ZPI18N.getString("zp.lms.delete")]}]}lmsmenu.initiate({elem:e,width:"180px",type:"dropdown",arrowHead:!0,menulist:s,eve:t}).on("click",(function(){"markasmand"==this.value?lmslearningplan.markasmand():"delete"==this.value&&lmslearningplan.deleteCourseLevel()})).bind()},menuConstruction:function(e,t,s){var r={},l=document.querySelector('[rel="'+e+'"]');if(s=null==s?ZPI18N.getString("zp.select"):s,e==="applicableToType_"+t||e==="outcomeType_"+t){if(e==="applicableToType_"+t&&0!=t||e==="outcomeType_"+t)(o=[]).push(ZPI18N.getString("zp.select")),r[0]=o;if((c=[]).push(ZPI18N.getString("zp.designation")),r[1]=c,(d=[]).push(ZPI18N.getString("zp.department")),r[2]=d,e==="applicableToType_"+t)(m=[]).push(ZPI18N.getString("zp.lms.learningplan.role")),r[3]=m;if(s!=ZPI18N.getString("zp.lms.learningplan.skills"))(u=[]).push(ZPI18N.getString("zp.lms.learningplan.skills")),r[4]=u;if((p=[]).push(ZPI18N.getString("zp.location")),r[5]=p,e==="applicableToType_"+t){var a=[];a.push(ZPI18N.getString("zp.lms.members.user")),r[6]=a}var n=[];if(n.push(ZPI18N.getString("zp.group")),r[7]=n,e==="applicableToType_"+t){var i=[];i.push(ZPI18N.getString("zp.experience")),r[8]=i}(e==="applicableToType_"+t?document.getElementById("applicableTo"):document.getElementById("outComes")).querySelectorAll('[class="zp_Sm zp_c2"]').forEach((function(e){var t=null!=e.querySelector('[class="zp_Tglst ntxt"]')?e.querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel"):null!=e.querySelector('[class="zp_Tglst"]')&&e.querySelector('[class="zp_Tglst"]').getAttribute("data-text")?e.querySelector('[class="zp_Tglst"]').getAttribute("data-text"):"";""!=(t=t==ZPI18N.getString("zp.designation")?1:t==ZPI18N.getString("zp.department")?2:t==ZPI18N.getString("zp.lms.learningplan.role")?3:t==ZPI18N.getString("zp.lms.learningplan.skills")?4:t)&&delete r[t]})),lmslearningplan.createMenu(r,l,"applicableTo_Menu",s,lmslearningplan.getApplicableOrOutcomeType)}if("durationMenu"===e){var o,c,d,m,u,p;(o=[]).push(ZPI18N.getString("zp.lms.minutes")),r[0]=o,(c=[]).push(ZPI18N.getString("zp.lms.hours")),r[1]=c,(d=[]).push(ZPI18N.getString("zp.lms.days")),r[2]=d,(m=[]).push(ZPI18N.getString("zp.weeks")),r[3]=m,(u=[]).push(ZPI18N.getString("zp.lms.learningplan.months")),r[4]=u,(p=[]).push(ZPI18N.getString("zp.lms.learningplan.years")),r[5]=p;l=document.querySelector('[rel="durationMenu"]');var g=document.querySelector('[rel="setDuration"]').innerHTML===ZPI18N.getString("zp.lms.learningplan.setduration")||""==document.querySelector('[rel="setDuration"]').innerHTML.split(" ")[1]?ZPI18N.getString("zp.lms.minutes"):document.querySelector('[rel="setDuration"]').innerHTML.split(" ")[1];lmslearningplan.createMenu(r,l,"duration_Menu",g)}"showCouOpt"!==e&&"showCouCrOpt"!=e||((o=[]).push(ZPI18N.getString("zp.lms.trainers.ActiveCourses")),r[0]=o,(c=[]).push(ZPI18N.getString("zp.lms.reports.allCourses")),r[1]=c,s=s==ZPI18N.getString("zp.select")?r[0]:s,lmslearningplan.menuObj=lmsgroupmenu.initiate(document.querySelector('[id="showCouOpts"]')),lmslearningplan.createMenu(r,l,"showCouOpts",s,lmslearningplan.courseMenuCallback))},cancelCondition:function(e){var t=e.getAttribute("rel").split("_");"close0"==t[0]?e.closest('[rel="applicableMenu_'+t[1]+'"]').remove():e.closest('[rel="outcomeMenu_'+t[1]+'"]').remove(),0!=$("#applicableTo").find(".zp_Sm.zp_c7").find(".zp_Tglst.ntxt").length&&document.querySelector('[rel="saveRule"]').classList.remove("disabled")},courseMenuCallback:function(e){lmslearningplan.getLearningPlanDetails(lmslearningplan.addedPlanDetails.planInfo.planId,!1,void 0,e)},closePopup:function(e){2==e&&(document.querySelector('[class="zp_CPlst"]')&&0==document.querySelector('[class="zp_CPlst"]').querySelectorAll("li").length||document.querySelector('[class="zp_CPlst noclck"]')&&0==document.querySelector('[class="zp_CPlst noclck"]').querySelectorAll("li").length)&&document.getElementById("course_"+document.querySelector('[class="zp_popup"]').getAttribute("rel").split("_")[1]).classList.remove("zp_lcked"),3==e&&(lmslearningplan.selectedCourses={}),4!=e||lmslearningplan.addedPlanDetails.planInfo.lpImageInfo.isSystemImage||document.getElementById("planBgImg").setAttribute("style","background-image:url("+lmsfileaction.generateSourceURL(lmslearningplan.addedPlanDetails.planInfo.lpImageInfo)+")"),$(".zp_msk").html(""),$(".zp_msk").hide()},closePreview:function(){lmscourses.startIndex=0,lmslearningplan.startIndex=0;var e=document.getElementById("createLearningPlan");lmsbase.closeQHash(),lmsbase.removeQHash(),lmscoursedetails.backtoCourse(),document.getElementById("lms").classList.remove("assessment"),lmsbase.removeListener(e,"click",lmslearningplan.clickPopupHandler,!1),document.getElementById("createLearningPlan").remove(),document.getElementById("top_message_outer").parentElement.classList.remove("zp_Pshw"),lmslearningplan.isFromLP&&lmslearningplan.isEdited?lmslearningplan.getLearningPlanDetails(lmslearningplan.addedPlanDetails.planInfo.planId,!0):!lmslearningplan.isFromLP&&lmscourses.getCourseGridDetails(),lmslearningplan.addedPlanDetails=null},clickHandler:function(e){var t=e.target;"planOverview"===t.getAttribute("rel")?lmslearningplan.changeLearningEditHash(t.getAttribute("id").split("_")[1]):"createPlan"===t.getAttribute("rel")&&lmslearningplan.createPlanMenu()},getCourseUrl:function(e,t){var s=window.location.href.split("#"),r=s[0].split("/");s[0]="",r[r.length-1]="training";for(var l=0;l<r.length;l++)l==r.length-1?s[0]+=r[l]:s[0]+=r[l]+"/";var a=window.location.hash.split("/")[0];a=a.split("-")[0]+"-view";var n=lmslearningplan.componentUrl(e,t);s[0]+=a+"/"+n,window.open(s[0])},componentUrl:function(e,t){return e&&t?"course/"+e+"/batch/"+t+"/overview":"course/"+e+"/overview"},clickPopupHandler:function(e){var t=e.target,s=t.getAttribute("rel");if(document.querySelector('[rel="durationPopup"]')&&lmslearningplan.closeDurationPopup(),"setDuration"===s)lmslearningplan.setDurationPopup();else if("planBgImg"===t.closest("div").getAttribute("rel"))lmslearningplan.imgSelect();else if("addplandetailsedit"==s)callback={},lmslearningplaneditor.initiate(callback,"addplandetails",document.querySelector('[rel="addplandetails"]'));else if("addplandetailssubmit"==s)lmslearningplan.submitCallback();else if("addMenu"==s)lmslearningplan.createCourseLevelMenu(t,e);else if("addLevel"==s)lmslearningplan.createLevel();else if("addCourse"==s)zplms.fetchCourses(null,null,"lpFetch",null,0);else if("publishstatus"==s)lmslearningplan.publishPlanPopup();else if("coursePreview"==s){var r=e.target.closest("li").getAttribute("_crel").split("_"),l=null==t.getAttribute("courseUserId")?t.closest('[_rel="coursedrag"]').getAttribute("courseUserId"):t.getAttribute("courseUserId");lmslearningplan.isManagerView?lmsusers.openCourseProgress(r[1],r[2],l,!0):lmslearningplan.getCourseUrl(r[1],r[2])}else"newRule"==t.getAttribute("_rel")?lmslearningplan.createNewRule():"memberCnt"==s?lmslearningplan.enrolledMembers():"planOwners"==s?lmslearningplan.planOwnersPopup():"addPlanOwners"===s?lmslearningplan.addPlanOwners():"closePlanOwners"===s?lmslearningplan.popupClose():"removePlanOwner"==s?lmslearningplan.removePlanOwner(t):"cancel"==s?lmslearningplan.cancelCallback():"courseMore"==s||"levelCourseMore"==s||"leveldel"==s?(lmslearningplan.addedPlanDetails.planInfo.courseId="courseMore"==s||"levelCourseMore"==s?t.closest("li").getAttribute("id").split("_")[1]:0,lmslearningplan.addedPlanDetails.planInfo.levelId=("levelCourseMore"==s||"leveldel"==s)&&t.closest('[rel="llist"]')?t.closest('[rel="llist"]').getAttribute("id").split("_")[1]:0,lmslearningplan.courseMore(t,e)):"closePreview"===s&&lmslearningplan.closePreview()}},lmslearningplaneditor={editor:[],initiate:function(e,t,s){$("#read-more")&&$("#read-more").addClass("DN"),$("#read-less")&&$("#read-less").addClass("DN");var r=document.querySelector('[rel="addplandetails"]').innerText===ZPI18N.getString("zp.lms.learningplan.enterdesc")?ZPI18N.getString("zp.lms.learningplan.enterdesc"):ZPeople.decodeTxt(lmslearningplan.addedPlanDetails.planInfo.description),l={subBtnName:"zp.save",divId:t,subBtnId:"submitbtn",parentCon:"editor_container",cancelNOtneeded:!1,isTopBar:!0};e.submitButton=!0;var a=document.createElement("div");a.id="zp-fd-typebox",a.innerHTML=ZPFeeds.Editor.getEditorContainer(l),e.submitButton?(a.querySelector("#submitbtn").setAttribute("rel",t+"submit"),a.querySelector("#zp_editor_cancelbtn").setAttribute("rel","cancel")):$("#submitbtn",a).hide(),s.innerHTML="",s.appendChild(a);document.getElementById("desc_body")&&document.getElementById("desc_body").classList.add("zp_dyn"),lmslearningplaneditor.editor[t]=ZPFeeds.Editor.getEditor(t,"Training",{isOtherEditor:!0},l),lmslearningplaneditor.editor[t].setContent(r)}},lmsmessages={_root:null,popup:null,scrollElem:null,UnreadCount:0,editor:null,lastRequestParams:{},htmlConf:{header:!0,body:!0,filter:!0,headerClass:"zp_header",attachScroll:!0,scrollQueryString:".zp_Lstwrap",scrollElem:"",bodyClass:"zp_cwrap",headerHTML:'<div class="zp_hdtit"><h2><font>'+ZPI18N.getString("zp.lms.base.Discussions")+"</font></h2></div>",buttonHTML:'<div class="zp_frt zp_micn"><div class="zp_btn"><button class="zpthm" _rel="newMsg">'+ZPI18N.getString("zp.lms.messages.startnewdiscussion")+'</button></div><ul><li class="zp_fltricn sel"><b><span><i class="IC-fltr" _rel="fltr" data-ttip='+ZPI18N.getString("zp.lms.filter")+"></i></span></b></li></ul></div></div>",bodyHTML:'<div class="zp_Lstwrap zp_Tmes" id="message"></div>',filterClass:"zp_fltrs",filterHTML:'<div class="zp_Lttl"></div>'},_rfr:{messageIndex:1,favouritesOnly:!1,batchId:"",courseId:"",courseName:"",courseType:null,entitytype:0,entityid:null,baseUri:"",prevHash:"",status:"all"},_rfr_popup:{commentIndex:1,messageDetails:{},menuReference:{}},integ:!1,filterMode:!1,canuserStartDiscussion:!1,initiate:function(){if("hash"==this.type){lmsmessages.hashMode(this);var e=lmsnotes.isHashValidAndWithFilter(this.hashObject,{title:{search:!0},courseId:{type:"array",datatype:"number",name:"course",integ:lmsnotes.integ},favourite:{type:"string",validValues:{1:!0},name:{1:"Favourite"}}});lmsmessages.validityObjHandle(e)}else lmsmessages.quesMode(this)},integrationMode:function(e){lmsmessages.integ=!0,lmsmessages._rfr.batchId=null!=e.batchId&&""!=e.batchId&&"null"!=e.batchId?e.batchId:void 0,lmsmessages._rfr.baseUri=e.baseUri,lmsmessages._rfr.courseId=e.courseId,lmsmessages._rfr.courseName=e.courseName,lmsmessages._rfr.entityData=e.entityData,lmsmessages._rfr.courseType=e.entityData.typesysVal,lmsmessages.htmlConf.header=e.htmlConf.header,lmsmessages.htmlConf.bodyClass=e.htmlConf.bodyClass},hashMode:function(e){if("add"==e.mode){lmsmessages.reInitialise(),e.integ&&lmsmessages.integrationMode(e),lmsmessages.layoutConstruction(e);var t=lmsmessages.addLoading();lmsmessages._root.parentElement.querySelector("#message").appendChild(t),lmsmessages.canStartDiscussionForCourse=e.canStartDiscussionForCourse}},messageCountView:function(){return lmsmessages.UnreadCount<=0||null==lmsmessages.UnreadCount||null==lmsmessages.UnreadCount?"":lmsmessages.UnreadCount},unreadCount:function(){lmsmessages.UnreadCount=lmsmessages.UnreadCount+1,document.getElementById("unreadCount").innerText=lmsmessages.UnreadCount},layoutConstruction:function(e){lmsbase.removeClass(e.elem.parentElement,"zp_gy"),lmsbase.removeClass(e.elem,"zp_CMmdl"),lmsbase.removeClass(e.elem,"zp_crsMem"),lmsmessages._root=e.elem,e.elem.innerHTML="";var t=lmsmessages.htmlConf,s=null;if(t.header&&((s=e.elem.appendChild(document.createElement("div"))).className=t.headerClass,s.innerHTML=t.headerHTML),e.integ)lmsbase.addClass(e.elem,"zp_Tmes"),e.elem.id="message",e.elem.setAttribute("role","list"),e.elem.setAttribute("aria-label",ZPI18N.getString("zp.lms.course.discussioninfo"));else{var r=e.elem.appendChild(document.createElement("div"));r.className=t.bodyClass,r.innerHTML=t.bodyHTML}if(t.filter){var l=e.elem.appendChild(document.createElement("div"));l.className=t.filterClass,l.innerHTML=t.filterHTML}t.attachScroll&&(lmsmessages.scrollElem=e.integ?e.elem.closest(t.scrollQueryString):e.elem.querySelector(t.scrollQueryString),lmsbase.addListener(lmsmessages.scrollElem,"scroll",lmsmessages.scrollHandle,!1)),lmsbase.addListener(e.elem,"click",lmsmessages.msgHandle,!1)},constructDiscussionButton:function(){var e=lmsmessages.htmlConf;lmsmessages.canuserStartDiscussion&&null!=this._root?$(".zp_hdtit").append($(e.buttonHTML)):($(".zp_hdtit").append($(e.buttonHTML)),lmsbase.hide(document.querySelector('[_rel="newMsg"]')))},quesMode:function(e){if(lmsmessages.reInitialise_Popup(),lmsmessages.validateHashParamsObject(e.module,e.hashObject))if(lmsmessages.popup=e.elem,"discussioninfo"==e.module){var t={messageId:e.hashObject.level1};lmsmessages.getSingleMessage(t)}else lmsmessages.showAddMessage();else lmsbase.closeQHash(),lmsbase.removeQHash()},validityObjHandle:function(e){e.valid&&e.filterMode&&e.fltrObj&&e.fltrObj.items.courseId?(lmsmessages.validityObject=e,CoursesList.get(0,lmsmessages.setCourseDataAndValidateCourse)):lmsmessages.hashHandling(e)},hashHandling:function(e){if(e.valid){var t={};if(lmsmessages.filterMode=e.filterMode,e.filterMode)lmsmessages.integ||lmsmessages.viewFilter("addbar",e.fltrObj),t=e.hashObject.level1.filter;else lmsmessages._root.querySelector(".zp_header .zp_Tglst")&&lmsfilter.filterBar("clear");lmsmessages.getMessages(t)}else lmsmessages.revertHash(),lmsmessages.getMessages()},setCourseDataAndValidateCourse:function(e){if(!lmsmessages.courseDataForHash){var t={};e.forEach((function(e){t[e.courseId]=e.courseName})),lmsmessages.courseDataForHash=t}var s=function(e,t){for(prop in t){if(!e[prop])return!1;t[prop][0]=e[prop]}return!0}(lmsmessages.courseDataForHash,lmsmessages.validityObject.fltrObj.items.courseId);lmsmessages.validityObject.valid=lmsmessages.validityObject.valid&&s,lmsmessages.hashHandling(lmsmessages.validityObject),lmsmessages.validityObject=null},validateHashParamsObject:function(e,t){return void 0===t.level2&&(!("adddiscussion"!=e||""!=t.level1||!lmsmessages.canUserStartDiscussion)||!!("discussioninfo"==e&&t.level1&&t.level1>0&&t.level1<=0x8000000000000000))},viewFilter:function(e,t){var s=lmsmessages._root.querySelector(".zp_fltrs");lmsfilter.create(e,{target:s,container:"",items:[{name:"courseId",title:ZPI18N.getString("zp.lms.course.coursename"),datalist:lmsmessages.fetchFilterCourseMenu,mode:"multi",type:"select",emptyText:ZPI18N.getString("zp.select"),labelicon:""},{name:"favourite",title:ZPI18N.getString("zp.lms.favourite"),datalist:{1:[ZPI18N.getString("zp.lms.favourite"),""]},mode:"single",type:"select",emptyText:ZPI18N.getString("zp.select"),labelicon:""},{name:"status",title:ZPI18N.getString("zp.status"),datalist:{read:[ZPI18N.getString("zp.lms.read"),""],unread:[ZPI18N.getString("zp.lms.unread"),""]},mode:"single",type:"select",emptyText:ZPI18N.getString("zp.select"),labelicon:""}],search:!0,selecteditems:t},!0).on("change",(function(){})).on("apply",(function(){var e=this.filterObject,t={};e.searchStr&&e.searchStr.length>0&&(t.title=e.searchStr),e.status?(t.status=e.status[0],lmsmessages._rfr.status=t.status):lmsmessages._rfr.status="all",e.courseId&&(t.courseId=e.courseId),e.favourite?t.favourite=e.favourite[0]:lmsmessages._rfr.favouritesOnly=!1;var s=lmsnotes.makeHash(t);s&&(lmsmessages.filterMode=!0,lmsmessages._rfr.prevHash=lmsmessages._rfr.baseUri+"discussions/filter:"+s,lms.changeHash("hash",lmsmessages._rfr.prevHash,"disable"),lmsmessages.getMessages(t))})).on("clear",(function(){lmsmessages.filterMode&&(lmsmessages.filterMode=!1,lms.changeHash("hash","discussions","disable"),lmsmessages._rfr.favouritesOnly=!1,lmsmessages._rfr.status="all",lmsmessages.getMessages())})).on("close",(function(){})).bind()},msgHandle:function(e){if(""==window.getSelection().toString()){var t=e.target,s=t.getAttribute("_rel");if("newMsg"==s)lmsmessages.addMessagePopup();else if("del"==s)lmsmessages.deleteDiscussionOnConfirmation(t.closest(".zp_Lst").getAttribute("message_Id"));else if("fav"==s){var r=t.closest(".zp_Lst"),l=lmsmessages.changeFavouriteIcon(t);lmsmessages._rfr.favouritesOnly?(r.parentNode.removeChild(r),lmsmessages.isLoadbarNeeded(),lmsmessages.isNoDataReq()):lmsmessages.changeToolTip(e,l),lmsmessages.markAsFavourite(r.getAttribute("message_id"),l)}else if("onlyFavourites"==s)lmsmessages.getOnlyFavourites(e);else if("fltr"==s)lmsmessages.viewFilter("add");else if(null!=t.closest('[_rel= "memList"]')){(r=t.closest(".zp_Lst[message_id]"))&&(membersList.init(r.getAttribute("message_id"),1,r.querySelector('[_rel="memList"]'),membersList.getAddedMembersMiniView),membersList.getMembersPopup())}else{(r=t.closest(".zp_Lst[message_id]"))&&lmsmessages.viewMessage(r)}}},getOnlyFavourites:function(e){var t=e.target,s=lmsmessages._rfr;s.messageIndex=1,s.favouritesOnly=!s.favouritesOnly,lmsmessages.changeFavouriteIcon(t),t.setAttribute("data-ttip",s.favouritesOnly?ZPI18N.getString("zp.lms.messages.showall"):ZPI18N.getString("zp.lms.messages.favourites")),lmstooltip.showbubble(e),lmsmessages.getMessages()},isLoadbarNeeded:function(){"end"!=lmsmessages._rfr.messageIndex&&lmsmessages.scrollElem.scrollHeight<=lmsmessages.scrollElem.clientHeight&&lmsmessages.getMessages()},isNoDataReq:function(){var e=lmsmessages._root.parentElement.querySelector("#message");e.childNodes.length||(lmsmessages.filterMode||lmsbase.hide(document.querySelector('[_rel="fltr"]')),lmsnodata.showNoData({mode:"general",container:e,module:"messages",content:(lmsmessages.integ&&lmsmessages.canStartDiscussionForCourse||!lmsmessages.integ&&lmsmessages.canUserStartDiscussion&&lmsmessages.filterMode,ZPI18N.getString("zp.lms.messages.nodiscussionavailable"))}))},changeFavouriteIcon:function(e){return lmsbase.hasClass(e,"zp_fav")?(lmsbase.removeClass(e,"zp_fav"),0):(lmsbase.addClass(e,"zp_fav"),1)},changeToolTip:function(e,t){lmstooltip.showbubble(e)},markAsFavourite:function(e,t){lmsmessages.successMsg=t?ZPI18N.getString("zp.lms.addedtofavourites"):ZPI18N.getString("zp.lms.removedfromfavourites"),lmsmessages.failureMsg=" "+(t?ZPI18N.getString("zp.lms.unabletoaddtofavourites"):ZPI18N.getString("zp.lms.unabletoremovefromfavourites"))+" ",zplms.put("/lms/discussions/"+e+"/favourite",null,(function(e){"success"==e.status?ZPeople.Message.showSuccessMsg(lmsmessages.successMsg):ZPeople.Message.showFailureMsg(lmsmessages.failureMsg),lmsmessages.successMsg=lmsmessages.failureMsg=null}))},addMessagePopup:function(e,t){null!=e?(lmsmessages._rfr.entityid=e,lmsmessages._rfr.entitytype=t,lmsmessages.integ=!0):(lmsmessages._rfr.entityid=null,lmsmessages._rfr.entitytype=0),lmsmessages.addorRemoveSelClass(),lms.changeHash("ques","adddiscussion","disable"),lmsmessages.reInitialise_Popup(),lmsmessages.showAddMessage()},viewMessage:function(e){var t={messageId:e.getAttribute("message_Id"),courseId:e.getAttribute("course_Id")};if(t.messageId!=lmsmessages._rfr_popup.messageDetails.messageId){lmsmessages.addorRemoveSelClass(),lmsmessages.reInitialise_Popup(),lmsbase.addClass(e,"sel"),lms.changeHash("ques","discussioninfo/"+t.messageId,"disable"),lmsmessages.popup=lmsbase.openQHash(),lmsmessages.getSingleMessage(t);var s=$(e).hasClass("zp_unrd");$("#unreadCount").text(0!=lmsmessages.UnreadCount?lmsmessages.UnreadCount:""),s&&(lmsmessages.UnreadCount=lmsmessages.UnreadCount-1,s&&lmsmessages.UnreadCount>0?$("#unreadCount").text(lmsmessages.UnreadCount):$("#unreadCount").text(""),$(e).removeClass("zp_unrd"))}},commentScrollHandle:function(){"end"!=lmsmessages._rfr_popup.commentIndex&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&lmsmessages.fetchComments()},scrollHandle:function(){"end"!=lmsmessages._rfr.messageIndex&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&lmsmessages.getMessages(lmsmessages.lastRequestParams,!0)},getMessages:function(e,t){if(1==(e=e||{}).favourite&&(lmsmessages._rfr.favouritesOnly=!0,delete e.favourite),e.favouritesOnly=lmsmessages._rfr.favouritesOnly,e.status="all"!=lmsmessages._rfr.status?lmsmessages._rfr.status:e.status,lmsmessages.integ&&(lmsmessages._rfr.batchId&&(e.batchId=lmsmessages._rfr.batchId),lmsmessages._rfr.courseId&&(e.courseId=lmsmessages._rfr.courseId)),e.erecno=erecno,!t){if(!lmsnotes.isRequestDuplicate(e,lmsmessages.lastRequestParams,["title","courseId","status","favouritesOnly"]))return;lmsmessages._rfr.messageIndex=1}for(var s in e.startIndex=lmsmessages._rfr.messageIndex,e)e[s]instanceof Array?e[s]=e[s].toString():"String"==typeof e[s]&&(e[s]=e[s].trim());zplms.get("lms/discussions",e,(function(e){if(e[1]&&e[1].nopermission){var t=lmscoursedetails.componentUrl(lmscourses.currentCourseId);lms.changeHash("hash",t+"/overview")}else{lmsmessages.canuserStartDiscussion=e.canUserStartDiscussion,lmsmessages.constructDiscussionButton(),"failure"==e.status&&lmsbase.hide(document.querySelector('[_rel="fltr"]'));var s=lmsmessages._rfr.messageIndex;lmsmessages.messageListView(e.messageArray||[],1==s?"new":"update")}}))},messageListView:function(e,t){lmsmessages.removeLoading();var s=lmsmessages._root.parentElement.querySelector("#message");"new"==t&&(e.length>0?(lmsbase.show(document.querySelector('[_rel="fltr"]')),lmsnodata.clearNoData(s)):(lmsmessages.filterMode&&lmsbase.show(document.querySelector('[_rel="fltr"]')),lmsnodata.showNoData({mode:lmsmessages.filterMode?"filter":"general",container:s,module:"messages",content:lmsmessages.integ&&lmsmessages.canStartDiscussionForCourse||!lmsmessages.integ&&lmsmessages.canUserStartDiscussion&&!lmsmessages.filterMode?ZPI18N.getString("zp.lms.messages.nodiscussionavailable"):ZPI18N.getString("zp.lms.messages.nodiscussionfound")})));for(var r=0;r<e.length;r++){e[r].discussionMems&&(membersList.discussionMemCache[e[r].messageId]={},membersList.discussionMemCache[e[r].messageId].addedMembers=e[r].discussionMems.addedMembers,membersList.discussionMemCache[e[r].messageId].isOwner=e[r].postedBy==erecno);var l=lmsmessages.getMessageCard(e[r],r);s.appendChild(l),"private"==e[r].discussionType&&(listElement=l.querySelector('[_rel="selectedMem"]'),membersList.getAddedMembersMiniView(e[r].discussionMems.addedMembers,listElement.querySelector('[_rel="memList"]'),150,0))}if(25==e.length){var a=lmsmessages.addLoading();s.appendChild(a),lmsmessages._rfr.messageIndex+=25}else lmsmessages._rfr.messageIndex="end"},getMessageCard:function(e,t){var s=ZPDateTime.getDateDisplayFormat(e.createdTime),r=document.createElement("div"),l=e.title,a=document.createElement("div");a.innerHTML=e.content;var n=ZPeople.decodeTxt(a.innerText||a.textContent),i=document.createElement("span");return i.innerText?i.innerText=n:i.textContent=n,e.ISREAD&&"true"!=e.ISREAD?r.className="zp_unrd zp_Lst"+(e.messageId==lmsmessages._rfr_popup.messageDetails.messageId?" sel":""):r.className="zp_Lst"+(e.messageId==lmsmessages._rfr_popup.messageDetails.messageId?" sel":""),r.setAttribute("message_Id",e.messageId),r.setAttribute("course_Id",e.courseId),r.setAttribute("tabindex",lmsConstants.TAB_INDEX.ACTIVE),r.setAttribute("role","listitem"),r.setAttribute("aria-haspopup","dialog"),r.setAttribute("aria-label",`${ZPI18N.getString("zp.lms.sdiscussion")}${t+1}: ${l}`),r.innerHTML='<div><div class="zp_Ldtl">'+lmsmessages.getUserDP(e.userInfo).outerHTML+'<div class="zp_Tdts"><h3>'+l+"</h3><font><span>"+e.userInfo.name+"</span>"+(lmsmessages.integ?"":'<p class="zp_ldot">'+e.courseName+"</p>")+"</font><em>"+s+"</em>"+(e.attach?'<span> <i class="IC-atch" _rel="attch" data-ttip='+ZPI18N.getString("zp.lms.messages.attach")+"></i></span>":"")+(""!=n?lmseditor.validateGivenContent(i.outerHTML):"")+'</div></div><div _rel="selectedMem" class="zp_Cmem"><ul _rel="memList"></ul></div><div class="zp_Lrgt"><i _rel="fav" class="IC-favorite '+(e.isFavourite?"zp_fav":"")+'" data-ttip="'+(e.isFavourite?ZPI18N.getString("zp.lms.unmarkfavourite"):ZPI18N.getString("zp.lms.markfavourite"))+'"></i>'+("private"==e.discussionType&&e.postedBy==erecno||"public"==e.discussionType&&(e.postedBy==erecno||0==lms.role||lms.isDataAdmin)?'<i class="IC-trash"  _rel="del" data-ttip='+ZPI18N.getString("zp.delete")+"></i>":"")+"</div></div>",r},getSingleMessage:function(e){lmsmessages._rfr_popup.commentIndex=1,lmsmessages._rfr_popup.messageDetails={};var t={startIndex:lmsmessages._rfr_popup.commentIndex};e.courseId&&(t.courseId=e.courseId),zplms.get("/lms/discussions/"+e.messageId,t,(function(e){if(e[1]&&e[1].nopermission){var t=lmscoursedetails.componentUrl(lmscourses.currentCourseId);lms.changeHash("hash",t+"/overview")}else if("success"==e.status)lmsmessages.addorRemoveSelClass(e.messageId),e.comments&&e.comments.length>0?lmsmessages._rfr_popup.commentIndex+=25:lmsmessages._rfr_popup.commentIndex="end",lmsmessages._rfr_popup.messageDetails.courseId=e.courseId,lmsmessages._rfr_popup.messageDetails.messageId=e.messageId,e.postedToMemInfo&&(membersList.discussionMemCache[e.messageId]={},membersList.discussionMemCache[e.messageId].addedMembers=e.postedToMemInfo.addedMembers,membersList.discussionMemCache[e.messageId].yetToAddMembers=e.postedToMemInfo.yetToAddMembers,membersList.discussionMemCache[e.messageId].isOwner=e.postedBy==erecno,membersList.discussionMemCache[e.messageId].isYetToAddListFetched=!0),lmsmessages.singleMessageView(e);else{var s,r;lmsmessages.addorRemoveSelClass(),"Illegal Access"==e.message?(s=e.message,r=ZPI18N.getString("zp.lms.messages.illegalaccess")):(s=e.message,r=ZPI18N.getString("zp.lms.messages.nosuchmessagefound"));var l='<div class="zp_pvhd"><div class="zp_mark"><h4>'+s+'</h4></div><div class="zp_micn"><ul><li><b><span><i _rel="close" class="IC-cls"></i></span></b></li></ul></div></div><div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+r+"</h2></div>";lmsmessages.popup.innerHTML=l}}))},singleMessageView:function(e){lmsmessages.popup.parentNode.setAttribute("class","zp_pv zp_msgview");var t=e.title,s=ZPDateTime.getDateDisplayFormat(e.createdTime),r=e.postedToMemInfo?'<em class="zp_lnk" _rel="membersCount">'+Object.keys(e.postedToMemInfo.addedMembers).length+" "+(Object.keys(e.postedToMemInfo.addedMembers).length>1?ZPI18N.getString("zp.lms.messages.particpants"):ZPI18N.getString("zp.lms.messages.particpant"))+"</em>":"",l='<div class="zp_pvhd"><div class="zp_mark">'+lmsmessages.getUserDP(e.userInfo).outerHTML+"<h4>"+e.userInfo.name+"</h4><font>"+r+'<em class = "zp_ldot">'+s+'</em><em class = "zp_ldot">'+e.courseName+"</em><em"+(e.BatchName?' class = "zp_ldot">'+e.BatchName:">")+"</em></font></div>";l+='<div class="zp_micn"><ul>',l+=e.postedBy==erecno||0==lms.role?'<li><b><span><i _rel="messagedel" data-ttip="'+ZPI18N.getString("zp.delete")+'" class="IC-trash"></i></span></b></li>':"",l+='<li><b><span><i _rel="fav" class="IC-favorite '+(e.isFavourite?"zp_fav":"")+'"></i></span></b></li>',l+='<li><b><span><i _rel="close" data-ttip="'+ZPI18N.getString("zp.close")+'" class="IC-cls"></i></span></b></li></ul></div></div>',l+='<div class="zp_pcnt" id="comment"><div class="zp_Pdesc" ><div class="zp_DMcnt"><div><div class="zp_msdec"><h2>'+t+"</h2>",l+="<p>"+lmseditor.validateGivenContent(ZPeople.decodeTxt(e.content),!0)+'</p></div><label id="commentsStart">'+e.commentsCount+" "+ZPI18N.getString("zp.lms.messages.comments")+"</label>",l+='<ul class="zp_tDmsg" id="commentsList"></ul></div></div></div></div></div>',lmsmessages.popup.innerHTML=l,lmsmessages._rfr_popup.messageDetails.commentsCount=e.commentsCount;var a=lmsmessages.popup.querySelector("#comment");lmsbase.addListener(a,"scroll",lmsmessages.commentScrollHandle,!1);var n=document.createElement("div");n.className="zp_CMedt",n.setAttribute("miniEditor",""),n.appendChild(lmsmessages.getUserDP(ZPeople.getUserDetailsById(erecno))),n.appendChild(document.createElement("label")).appendChild(document.createElement("div")).appendChild(CommentBox.init(lmsmessages.commentBoxCallback,{submitButton:!0,scrollToBottom:!0})),a.querySelector("#commentsList").parentNode.appendChild(n),lmsmessages.listComments(e.comments)},commentBoxCallback:function(e,t){var s={subBtnName:"zp.submit",divId:"zp_lmsmessage",subBtnId:"submitbtn",parentCon:"editor_container",cancelnotneeded:!0,isTopBar:!0},r=document.createElement("div");r.id="zp-fd-typebox",r.innerHTML=ZPFeeds.Editor.getEditorContainer(s),t.submitButton?r.querySelector("#submitbtn").setAttribute("_rel","submit"):lmsbase.hide(r.querySelector("#submitbtn")),e.parentNode.replaceChild(r,e);lmsmessages.editor=ZPFeeds.Editor.getEditor("zp_lmsmessage","Training",{isOtherEditor:!0},s),t.scrollToBottom&&lmsmessages.gotoBottom()},fetchComments:function(){var e={courseId:lmsmessages._rfr_popup.messageDetails.courseId,startIndex:lmsmessages._rfr_popup.commentIndex};zplms.get("/lms/discussions/"+lmsmessages._rfr_popup.messageDetails.messageId+"/comments",e,(function(e){"success"==e.status?(lmsmessages._rfr_popup.commentIndex+=25,lmsmessages.listComments(e.commentArray)):(lmsmessages._rfr_popup.commentIndex="end",lmsmessages.removeLoading())}))},listComments:function(e){lmsmessages.removeLoading();for(var t=lmsmessages.popup.querySelector("#commentsList"),s=document.createDocumentFragment(),r=0;r<e.length;r++)s.appendChild(lmsmessages.getCommentCard(e[r]));if(25==e.length){var l=lmsmessages.addLoading();s.appendChild(l,s.childNodes[0])}else lmsmessages._rfr_popup.commentIndex="end";t.appendChild(s,t.childNodes[0]),0==t.childNodes.length&&lmsbase.hide(lmsmessages.popup.querySelector("#commentsStart"))},addMessageComment:function(){var e=ZPFeeds.getSmileysAndMentions(lmsmessages.editor.getContent(),ZPeople.isSearchAllowed);e=ZPFeeds.removeTrailingEmptyDivs(e);var t=ZPFeeds.getTextContent(e);if(0!==(t=t.trim()).length||0!==$("<div>").append(e).find("img").length){var s={courseId:lmsmessages._rfr_popup.messageDetails.courseId,comment:e};zplms.post("/lms/discussions/"+lmsmessages._rfr_popup.messageDetails.messageId+"/comments",s,(function(e){"success"==e.status&&(e.userInfo=ZPeople.getUserDetailsById(erecno),0==lmsmessages.popup.querySelector("#commentsList").childNodes.length&&lmsbase.show(lmsmessages.popup.querySelector("#commentsStart")),lmsmessages._rfr_popup.messageDetails.commentsCount+=1,lmsmessages.popup.querySelector('[id="commentsStart"]').innerText=lmsmessages._rfr_popup.messageDetails.commentsCount+" "+ZPI18N.getString("zp.lms.messages.comments"),lmsmessages.popup.querySelector("#commentsList").appendChild(lmsmessages.getCommentCard(e)),lmsmessages.editor.setContent(""),lmsmessages.gotoBottom())}))}else lmsmessages.editor.setContent("")},getCommentCard:function(e){var t;t=e.commentedBy==erecno?ZPI18N.getString("zp.lms.messages.you"):e.userInfo.name;var s=ZPDateTime.getDateDisplayFormat(e.createdTimeInMillis),r=document.createElement("li");return r.setAttribute("comment_Id",e.commentId),r.innerHTML=lmsmessages.getUserDP(e.userInfo).outerHTML+"<span><a>"+t+"</a><em>"+s+"</em><font>"+ZPFeeds.Activity.validateContent(e.comment)+"</font></span>",r},getUserDP:function(e,t,s){var r=e[s]||e.photoPath||e.thumb,l=document.createElement("div");if(!r||r.indexOf("userg_inactive.png")>-1||r.indexOf("user.png")>-1||r.indexOf("&fs=thumb")>-1){var a=ZPeople.decodeTxt(e[t]||e.name),n=a.length%10,i=a.match(/\b[a-z]/gi),o=((i=i||[])[0]||a.charAt(0))+(i[1]||a.charAt(1));l.className="ZP_photo pc"+n,l.textContent=o}else l.className="ZP_photo",l.innerHTML='<img src="'+r+'">';return l},showAddMessage:function(){popupEl=document.createElement("div"),lmsbase.addClass(popupEl,"zp_fmsk"),popupEl.innerHTML='<div class="zp_Npv zp_nstrt"><div class="zp_nwrap" _rel="adddisccont"></div></div>';var e='<div class="zp_npvhd"><div class="zp_nhdr"><p>'+ZPI18N.getString("zp.lms.messages.startnewdiscussion")+'</p></div><div class="zp_micn"><ul><li><b><span><i class="IC-cls" _rel="close" data-ttip="'+ZPI18N.getString("zp.close")+'"></i></span></b></li></ul></div></div>',t='<div class="zp_ncnt"><div class="zp_nsplt"><div class="zp_Pdsc"><div class="zp_Pdhdr"><div><div><p class="zp_Pttl">'+ZPI18N.getString("zp.lms.messages.title")+'</p><div class="zp_Sm zp_titl" name="titleNode">'+lmsformcomponents.getTextField({labelName:"title",isMandatory:!0,formComponentId:null,fieldType:"input",maxLength:200})+"</div></div></div>";lmsmessages.integ||(t+='<div><div _rel="courseMenu"><p class="zp_Pttl">'+ZPI18N.getString("zp.lms.course.coursename")+"</p>"+lmsformcomponents.htmlField({formComponentId:"courseId",fieldType:26,emptyText:ZPI18N.getString("zp.select")})+'</div><div style="display:none" _rel="batchMenu"><p class="zp_Pttl">'+ZPI18N.getString("zp.lms.batches.BatchName")+"</p>"+lmsformcomponents.htmlField({formComponentId:"batchId",fieldType:26,emptyText:ZPI18N.getString("zp.lms.sall")})+"</div></div>"),t+='<div _rel="membersSel"><div><p class="zp_Pttl">'+ZPI18N.getString("zp.lms.component.display_name.members")+'</p><div class="zp_Sm zp_nobr"><div><ul><li _rel="allMemsButton"><i radiobutton class="IC-rdo zp_gclr"></i><span>'+ZPI18N.getString("zp.lms.messages.allMembers")+'</span></li><li _rel="selectedMemsButton"><i radiobutton class="IC-rdo"></i><span>'+ZPI18N.getString("zp.lms.messages.selectedMems")+'</span></li></ul></div></div><div _rel="selectedMem" class="zp_Cmem"><p _rel="allMemsInfo"><i class="IC-information"></i> '+ZPI18N.getString("zp.lms.messages.allMembersInfo")+' </p><ul class="zp_dyn" _rel="memList"></ul><div _rel="choose" class="zp_lnk zp_dyn"><div >'+ZPI18N.getString("zp.lms.messages.choose")+"</div></div></div></div></div>",t+='</div><div class="zp_Pddes"><p class="zp_Pttl">'+ZPI18N.getString("zp.lms.messages.description")+'</p><div _rel="editor_container"></div></div></div></div></div>';var s='<div class="zp_setbut"><div _rel="start">'+ZPI18N.getString("zp.lms.messages.start")+"</div></div>";popupEl.querySelector("[_rel=adddisccont]").innerHTML=e+t+s,lmsbase.addListener(popupEl,"click",lmsmessages.clickAction,!1),lmsmessages.popup=popupEl,lmsbase._contArr[0].parentNode.appendChild(lmsmessages.popup),lmsmessages.popup.querySelector('[name="titleNode"]').querySelector("input").focus(),lmsmessages.integ||(popupEl.querySelector('[_rel="membersSel"]').style.display="none"),container=popupEl.querySelector("[_rel=editor_container]"),lmsmessages.editor=lmseditormanager.initiate(container),editorParams={editorHeight:"350px",isMiniEditor:!1,enableSubmit:!1,type:2,needEditorFocus:!1,moduleName:"Discussions"},lmsmessages.editor.insertEditor(editorParams,"add");lmsmessages.popup.querySelector("[body]");if(lmsmessages.integ){if(membersList.setCourseId(lmsmessages._rfr.courseId),lmsmessages._rfr.batchId&&membersList.setBatchId(lmsmessages._rfr.batchId),2!=lmsmessages._rfr.courseType)return;lmsmessages.BatchMenuHandler.courseId=lmsmessages._rfr.courseId}else{lmsmessages._rfr_popup.timeInterval=1e3;var r=lmsmessages.popup.querySelector('[_rel="courseMenu"]');lmsmessages._rfr_popup.menuReference.course=lmsgroupmenu.initiate(r),lmsmessages._rfr_popup.menuReference.course.insertMenu({elem:r.querySelector(".zp_Sm"),type:"select",mode:"single",allow_new:!1,click:lmsmessages.BatchMenuHandler.onCourseSelected,menulist:lmsmessages.fetchStartDiscussionCourseMenu})}var l=lmsmessages.popup.querySelector('[_rel="batchMenu"]');lmsmessages._rfr_popup.menuReference.batch=lmsgroupmenu.initiate(l),lmsmessages._rfr_popup.menuReference.batch.insertMenu({elem:l.querySelector(".zp_Sm"),type:"select",mode:"single",allow_new:!1,click:lmsmessages.BatchMenuHandler.onBatchSelected,menulist:lmsmessages.BatchMenuHandler.fetchBatchMenu})},fetchStartDiscussionCourseMenu:function(){menureference=this,null!=this.value?(clearTimeout(lmsmessages._rfr_popup.timeInterval),lmsmessages._rfr_popup.timeInterval=setTimeout((function(){CoursesList.get(1,lmsmessages.fetchStartDiscussionCourseMenuCallback,menureference,menureference.value)}),1e3)):CoursesList.get(1,lmsmessages.fetchStartDiscussionCourseMenuCallback,this)},fetchFilterCourseMenu:function(){lmsmessages.filterCourseMenuList?this.updateOptionList(lmsmessages.filterCourseMenuList,this.value):CoursesList.get(0,lmsmessages.fetchFilterCourseMenuCallback,this)},fetchStartDiscussionCourseMenuCallback:function(e,t){lmsmessages.startDiscussionCourseMenuList=lmsmessages.menuConstructor(e,"courseName","courseId"),t.updateOptionList(lmsmessages.startDiscussionCourseMenuList,t.value)},fetchFilterCourseMenuCallback:function(e,t){lmsmessages.filterCourseMenuList=lmsmessages.menuConstructor(e,"courseName","courseId"),t.updateOptionList(lmsmessages.filterCourseMenuList,t.value)},menuConstructor:function(e,t,s,r){for(var l={},a=e.length-1;a>=0;a--)l[e[a][s]]=[e[a][t],e[r]];return l},clickAction:function(e){var t=(e=e||this.eve).target,s=t.getAttribute("_rel")||t.closest("[_rel]").getAttribute("_rel");"close"==s?(lmsmessages.popupClose(),BatchesList.clear()):"start"==s?lmsmessages.checkInputsValid():"del"==s?lmsmessages.deleteCommentOnConfirmation(t.parentNode.getAttribute("comment_Id")):"messagedel"==s?lmsmessages.deleteDiscussionOnConfirmation(lmsmessages._rfr_popup.messageDetails.messageId):"fav"==s?lmsmessages.markFavouriteOnCard(this.eve):"submit"==s?lmsmessages.addMessageComment():"bottom"==s?lmsmessages.gotoBottom():"allMemsButton"==s?lmsmessages.getAllMembersView(t.closest('[_rel="membersSel"]')):"selectedMemsButton"==s?(t=t.closest('[_rel="membersSel"]'),lmsbase.addClass(t.querySelector("[_rel=selectedMemsButton]").querySelector("[radiobutton]"),"zp_gclr"),lmsbase.removeClass(t.querySelector("[_rel=allMemsButton]").querySelector("[radiobutton]"),"zp_gclr"),lmsbase.addClass(t.querySelector("[_rel=allMemsInfo]"),"zp_dyn"),""==t.querySelector("[_rel=memList]").innerHTML&&lmsbase.addClass(t.querySelector("[_rel=memList]"),"zp_dyn"),lmsbase.removeClass(t.querySelector("[_rel=choose]"),"zp_dyn")):"choose"==s?(membersList.setType(0),membersList.setListElement(lmsmessages.popup.querySelector("[_rel=selectedMem]")),membersList.getMembersPopup()):"membersCount"==s&&(membersList.init(lmsmessages._rfr_popup.messageDetails.messageId,1,lmsmessages.popup.querySelector('[_rel="membersCount"]'),membersList.updateAddedMembersCount),membersList.getMembersPopup())},getAllMembersView:function(e){lmsbase.addClass(e.querySelector("[_rel=allMemsButton]").querySelector("[radiobutton]"),"zp_gclr"),lmsbase.removeClass(e.querySelector("[_rel=selectedMemsButton]").querySelector("[radiobutton]"),"zp_gclr"),lmsbase.removeClass(e.querySelector("[_rel=allMemsInfo]"),"zp_dyn"),lmsbase.addClass(e.querySelector("[_rel=memList]"),"zp_dyn"),lmsbase.addClass(e.querySelector("[_rel=choose]"),"zp_dyn"),e.querySelector("[_rel=memList]").innerHTML="",membersList._rfr.addedMembers={},membersList._rfr.yetToAddMembers={}},gotoBottom:function(){var e=lmsmessages.popup.querySelector("#comment");e.scrollTop=e.scrollHeight-e.clientHeight},markFavouriteOnCard:function(e){var t=lmsmessages.changeFavouriteIcon(e.target);if(lmsmessages.markAsFavourite(lmsmessages._rfr_popup.messageDetails.messageId,t),lmsmessages.changeToolTip(e,t),lmsmessages._root){var s=lmsmessages._root.parentElement.querySelector("#message [message_id='"+lmsmessages._rfr_popup.messageDetails.messageId+"']");if(s){var r=s.querySelector(".IC-favorite");t=lmsmessages.changeFavouriteIcon(r)}}},popupClose:function(){lmsmessages.popup.parentNode.removeChild(lmsmessages.popup),lmsmessages.popup="",lmsbase.closeQHash(),lmsbase.removeQHash(),lmsmessages.addorRemoveSelClass(),lmsmessages.editor=null,lmsmessages.reInitialise_Popup()},checkInputsValid:function(e){var t=lmsmessages.popup,s=!0,r={};if(!lmsmessages.integ){var l=t.querySelector('[_name="courseId"] .zp_Tglst');if(r.courseId=l.getAttribute("_rel"),lmsmessages._rfr.courseName=l.innerText||l.textContent,r.courseId)null!=t.querySelector('[_rel = "cname"]')&&(lmsbase.removeClass(t.querySelector('[_rel="courseMenu"]').querySelector("[type=singleSelect]"),"zp_err"),t.querySelector('[_rel = "cname"]').parentNode.removeChild(t.querySelector('[_rel = "cname"]')));else if(s=!1,null==t.querySelector('[_rel = "cname"]'))lmsbase.addClass(t.querySelector('[_rel="courseMenu"]').querySelector("[type=singleSelect]"),"zp_err"),(e=document.createElement("span")).innerHTML=ZPI18N.getString("zp.lms.messages.coursenameempty"),e.setAttribute("_rel","cname"),e.className="etxt",$(e).insertAfter(l.parentElement);var a=t.querySelector('[_name="batchId"] .zp_Tglst');null!=a.getAttribute("_rel")&&(r.batchId=a.getAttribute("_rel"))}(r.title=t.querySelector("[name='title']").value.trim(),r.title)?null!=t.querySelector('[_rel = "title"]')&&(lmsbase.removeClass(t.querySelector('[name="titleNode"]'),"zp_err"),t.querySelector('[_rel = "title"]').parentNode.removeChild(t.querySelector('[_rel = "title"]'))):(s=!1,null==t.querySelector('[_rel = "title"]')&&(lmsbase.addClass(t.querySelector('[name="titleNode"]'),"zp_err"),(e=document.createElement("span")).innerHTML=ZPI18N.getString("zp.lms.messages.titleempty"),e.setAttribute("_rel","title"),e.className="etxt",t.querySelector('[name="titleNode"]').appendChild(e)));s&&(postedToMem=membersList.getAddedMembersToStartDiscussion(),Object.keys(postedToMem).length>0&&(r.postedToMem=postedToMem),lmsmessages.editor?lmseditorSave.getEditorContent(lmsmessages.editor.rfr,(function(e){lmsmessages.attachDesc(e,r)})):lmsmessages.addMessage(r))},attachDesc:function(e,t){e&&(t.content=e.content,t.embedContentIds=e.embedIds.embedContentIds?e.embedIds.embedContentIds:void 0,t.embedUrlIds=e.embedIds.embedUrlIds?e.embedIds.embedUrlIds:void 0),lmsmessages.addMessage(t)},addMessage:function(e){var t={batchId:lmsmessages.integ?lmsmessages._rfr.batchId:e.batchId,courseId:lmsmessages.integ?lmsmessages._rfr.courseId:e.courseId,title:e.title,content:null!=e.content?e.content:"",embedContentIds:e.embedContentIds,embedUrlIds:e.embedUrlIds,postedToMem:e.postedToMem?Object.keys(e.postedToMem).toString():void 0,postedToType:e.postedToMem?1:void 0};0!=lmsmessages._rfr.entitytype&&(t.entityId=lmsmessages._rfr.entityid,t.entityType=lmsmessages._rfr.entitytype),zplms.post("/lms/discussions",t,(function(e){if("success"==e.status){e.userInfo={};var t=ZPeople.getUserDetailsById(erecno);if(e.userInfo.name=t.name,e.userInfo.photoPath=t.thumb,e.userInfo.designationName=t.thumb,e.userInfo.employeeId=t.empid,(0==lmsmessages._rfr.entitytype||null==lmsmessages._rfr.entitytype)&&lmsmessages.doesMessageSatisfyFilter(e)){var s=lmsmessages._root.parentElement.querySelector("#message"),r=s.querySelector('[_rel="nodata"]');r?s.replaceChild(lmsmessages.getMessageCard(e),r):s.insertBefore(lmsmessages.getMessageCard(e),s.childNodes[0]),"private"==e.discussionType&&(listElement=s.querySelector('[_rel="selectedMem"]'),membersList._rfr.addedMembers[erecno]=e.userInfo,membersList.updateDiscussionCache(e.messageId),membersList.getAddedMembersMiniView(membersList._rfr.addedMembers,listElement.querySelector('[_rel="memList"]'),150,0),membersList.reInit())}lmsmessages.popupClose(),lmsbase.show(document.querySelector('[_rel="fltr"]')),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.messages.addmesssage-success")),lmscoursedetails.activityData=null}else lmsmessages.handleFailureWhileAddingDiscussion()}),(()=>lmsmessages.handleFailureWhileAddingDiscussion()));var s=lmsmessages.popup.querySelector("[_rel=start]");lmsbase.addClass(s,"zp_btndis")},handleFailureWhileAddingDiscussion(){const e=lmsmessages.popup.querySelector("[_rel=start]");lmsbase.removeClass(e,"zp_btndis"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.messages.addmesssage-fail"))},doesMessageSatisfyFilter:function(e){var t=lmsmessages.lastRequestParams;if(t.title&&-1==e.title.indexOf(t.title))return!1;if(t.favouritesOnly)return!1;if(t.courseId){var s;for("string"==typeof t.courseId&&(t.courseId=[t.courseId]),s=0;s<t.courseId.length;s++)if(e.courseId==t.courseId[s])return!0;return!1}return!0},deleteCommentOnConfirmation:function(e){lmsnotify.show({header:ZPI18N.getString("zp.lms.messages.wanttodelcomment"),body:ZPI18N.getString("zp.lms.messages.commentdeletiondesc"),button_text:ZPI18N.getString("zp.lms.messages.deletecomment"),texttype:"negative",successCallback:function(){this.status&&lmsmessages.deleteCommentRecord(e)}})},deleteDiscussionOnConfirmation:function(e){lmsnotify.show({header:ZPI18N.getString("zp.lms.entitydelete",["discussion"]),body:ZPI18N.getString("zp.lms.permenentlydelEntity",["Discussion"]),button_text:ZPI18N.getString("zp.delete"),texttype:"negative",successCallback:function(){this.status&&lmsmessages.deleteMessageRecord(e)}})},deleteCommentRecord:function(e){var t={action:"deleteComment",commentId:e,conreqcsr:csrfToken};$.post("/messageAction.zp",t,(function(e){if("success"==e.status){var t=lmsmessages.popup.querySelector('#commentsList [comment_Id="'+e.commentId+'"]');t.parentNode.removeChild(t),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.messages.commentdelete-success")),lmsmessages._rfr_popup.messageDetails.commentsCount-=1,lmsmessages.popup.querySelector('[id="commentsStart"]').innerText=lmsmessages._rfr_popup.messageDetails.commentsCount+" "+ZPI18N.getString("zp.lms.messages.comments"),0==lmsmessages.popup.querySelector("#commentsList").childNodes.length&&lmsbase.hide(lmsmessages.popup.querySelector("#commentsStart"))}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.messages.commentdelete-fail"))}))},deleteMessageRecord:function(e){zplms.delete("/lms/discussions/"+e,null,(function(e){if("success"==e.status){var t=lmsmessages._root.parentElement.querySelector('#message [message_Id="'+e.messageId+'"]');t.parentNode.removeChild(t),lmsmessages.isLoadbarNeeded(),lmsmessages.popup&&lmsmessages.popupClose(),lmsmessages.isNoDataReq(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.messages.messagedelete-success"))}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.messages.messagedelete-fail"))}))},BatchMenuHandler:{courseId:null,cache:{},onCourseSelected:function(){var e=lmsmessages._rfr_popup.menuReference.course.getValue(this.elem,this.type)[0];if(e!=lmsmessages.BatchMenuHandler.courseId){lmsmessages.BatchMenuHandler.courseId=e;var t=CoursesList.getCourseInfo(e,1),s=this.elem.parentNode.nextElementSibling,r=s.querySelector('[_name="batchId"] .zp_Tglst'),l=$(r).find("div");l&&($(r).addClass(".zp_Tglst").removeClass(".zp_Tglst ntxt"),r&&r.removeAttribute("_rel"),l.remove()),2==t.typesysVal?s.style.display="":s.style.display="none"}if(e!=membersList.courseId){membersList.setCourseId(e);t=CoursesList.getCourseInfo(e,1);membersEl=lmsmessages.popup.querySelector("[_rel=membersSel]"),1==t.typesysVal?(membersEl.querySelector('[_rel="allMemsInfo"]').innerHTML='<i class="IC-information"></i>'+ZPI18N.getString("zp.lms.messages.allMembersInfo"),lmsmessages.getAllMembersView(membersEl),membersEl.style.display=""):(membersEl.querySelector('[_rel="allMemsInfo"]').innerHTML='<i class="IC-information"></i>'+ZPI18N.getString("zp.lms.messages.allMembersblendedInfo"),membersEl.style.display="none")}},onBatchSelected:function(){var e=lmsmessages._rfr_popup.menuReference.batch.getValue(this.elem,this.type)[0];e!=membersList.batchId&&(membersList.setBatchId(e),membersEl=lmsmessages.popup.querySelector("[_rel=membersSel]"),lmsmessages.getAllMembersView(membersEl),membersEl.style.display="")},fetchBatchMenu:function(){null!=lmsmessages.BatchMenuHandler.courseId&&(void 0!==lmsmessages.BatchMenuHandler.cache[lmsmessages.BatchMenuHandler.courseId]?this.updateOptionList(lmsmessages.BatchMenuHandler.cache[lmsmessages.BatchMenuHandler.courseId],this.value):(this.courseId=lmsmessages.BatchMenuHandler.courseId,BatchesList.get(lmsmessages.BatchMenuHandler.courseId,lmsmessages.BatchMenuHandler.fetchBatchMenuCallback,this)))},updateCache:function(e,t){this.cache[e]=t},fetchBatchMenuCallback:function(e,t){lmsmessages.BatchMenuHandler.updateCache(this.courseId,lmsmessages.menuConstructor(e,"batchName","batchId")),t.updateOptionList(lmsmessages.BatchMenuHandler.cache[this.courseId],t.value)},reset:function(){this.courseId=null,this.cache={}}},removeLoading:function(){var e=document.querySelector("[_rel=loadbar]");e&&e.parentNode.removeChild(e)},addLoading:function(){var e=document.createElement("div");return e.className="ctable",e.style.height="64px",e.setAttribute("_rel","loadbar"),e.innerHTML='<div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div>',e},addorRemoveSelClass:function(e){if(lmsmessages._root){var t=lmsmessages._root,s=t.parentElement.querySelector("#message .sel[message_Id]");if(s&&s.getAttribute("message_Id")==e)return;s&&lmsbase.removeClass(s,"sel"),e&&(s=t.parentElement.querySelector("#message [message_Id='"+e+"']"))&&lmsbase.addClass(s,"sel")}},revertHash:function(){lmsmessages._rfr.prevHash?lms.changeHash("hash",lmsmessages._rfr.prevHash,"disable"):lmsmessages.integ?lms.changeHash("hash",lmsmessages._rfr.baseUri+"discussion"):lms.changeHash("hash",lmsmessages._rfr.baseUri+"discussions")},reInitialise:function(){lmsmessages._root=null,lmsmessages.scrollElem=null,lmsmessages._rfr={messageIndex:1,favouritesOnly:!1,courseId:"",courseName:"",baseUri:"",prevHash:"",status:"all"},lmsmessages.integ=!1,lmsmessages.lastRequestParams={};var e=lmsmessages.htmlConf;e.header=!0,e.bodyClass="zp_cwrap",membersList.reInitialise()},reInitialise_Popup:function(){lmsmessages.popup=null,lmsmessages.editor=null,CoursesList.clear(0),CoursesList.clear(1),lmsmessages.BatchMenuHandler.reset(),lmsmessages._rfr_popup.menuReference.course&&lmsgroupmenu.destroy(lmsmessages._rfr_popup.menuReference.course),lmsmessages._rfr_popup.menuReference.batch&&lmsgroupmenu.destroy(lmsmessages._rfr_popup.menuReference.batch),lmsmessages._rfr_popup={commentIndex:1,messageDetails:{},menuReference:{}}},close:function(){lmsbase.removeListener(lmsmessages._root,"click",lmsmessages.msgHandle,!1),lmsmessages.htmlConf.attachScroll&&lmsbase.removeListener(lmsmessages.scrollElem,"scroll",lmsmessages.scrollHandle,!1),lmsmessages.reInitialise(),lmsmessages.reInitialise_Popup()}},CoursesList=function(){var e=["/lms/courses/list","/messageAction.zp"],t={},s={};return{get:function(r,l,a,n){null==n&&void 0!==t[r]?l(t[r],a):function(r,l,a,n){var i={searchName:null!=n?n:void 0};zplms.get(e[r],i,(function(e){!function(e,r,l,a,n){null==n?(t[r]=e.courses||[],l(t[r],a)):(s[r]=e.courses||[],l(s[r],a))}(e,r,l,a,n),r=l=null}))}(r,l,a,n)},clear:function(e){return Boolean(e?delete t[e]:courseCache={})},getCourseInfo:function(e,r){for(var l=t[r],a=l.length-1;a>=0;a--)if(l[a].courseId==e)return l[a];var n=s[r];for(a=n.length-1;a>=0;a--)if(n[a].courseId==e)return n[a];return null}}}(),BatchesList=function(){var e={};return{get:function(t,s,r){void 0!==e[t]?s(e[t],r):function(t,s,r){var l={action:"getbatchList",courseId:t};$.get("/messageAction.zp",l,(function(l){!function(t,s,r,l){e[s]=t.courses.batches||[],r(e[s],l)}(l,t,s,r),t=s=null}))}(t,s,r)},update:function(t,s){e[t]=s},clear:function(t){return Boolean(t?delete e[t]:e={})}}}(),CommentBox=function(){var e=null,t=null,s=null;function r(l){lmsbase.removeListener(e,"focus",r,!1),s&&s(e,t),e=s=t=null}return{init:function(l,a){var n=document.createElement("textarea");return n.placeholder=ZPI18N.getString("zp.lms.messages.typeyourtext"),n.autocomplete="off",lmsbase.addListener(n,"focus",r,!1),s=l,t=a,e=n}}}(),membersList={membersCache:{},discussionMemCache:{},messageType:{NEWMSG:0,ADDEDMSG:1},_rfr:{root:null,messageId:null,courseId:null,batchId:null,isOwner:!1,type:-1,yetToAddMembers:{},addedMembers:{},listElement:null,saveCallback:null,menuReference:null},init:function(e,t,s,r){membersList.reInit(),membersList._rfr.type=t,membersList._rfr.saveCallback=r,membersList._rfr.messageId=e,membersList._rfr.listElement=s},setCourseId:function(e){membersList.reInit(),membersList._rfr.courseId=e},setBatchId:function(e){membersList._rfr.batchId=e},setMessageId:function(e){membersList.reInit(),membersList._rfr.messageId=e},setListElement:function(e){membersList._rfr.listElement=e},setType:function(e){membersList._rfr.type=e,membersList._rfr.type==membersList.messageType.NEWMSG&&(membersList._rfr.isOwner=!0)},reInit:function(){membersList._rfr={messageId:null,courseId:null,batchId:null,isOwner:!1,type:-1,yetToAddMembers:{},addedMembers:{},listElement:null,saveCallback:null,menuReference:null}},getMembersPopup:function(){_rfr=membersList._rfr,discussionMemCache=membersList.discussionMemCache,_rfr.type==membersList.messageType.ADDEDMSG&&(_rfr.addedMembers=discussionMemCache[_rfr.messageId].addedMembers,_rfr.isOwner=discussionMemCache[_rfr.messageId].isOwner),membersList.getPopupHTML()},getPopupHTML:function(){_rfr=membersList._rfr;var e=lmsbase.showMaskLayer();_rfr.root=e;var t='<div class="zp_popup" popup style="width:700px"><div class="zp_Pohd"><font> '+(_rfr.isOwner?ZPI18N.getString("zp.lms.messages.choosemembs"):ZPI18N.getString("zp.lms.messages.participants"))+(null!=_rfr.addedMembers&&Object.keys(_rfr.addedMembers).length>0?"<span>("+Object.keys(_rfr.addedMembers).length+")</span></font> ":"</font>")+'<i class="IC-cls" _rel="close" data-ttip="'+ZPI18N.getString("zp.close")+'"></i></div>';if(_rfr.isOwner?t+=lmsformcomponents.htmlField({formComponentId:"membersId",fieldType:25,displayName:null,emptyText:"Select"}):t+='<div class="zp_Sm"><div><i class="IC-srch"></i><input _rel="search" placeholder="'+ZPI18N.getString("zp.lms.messages.srchparticipant")+'" type="text" value=""></div></div>',t+='<div class="zp_Pocnt" style="max-height:500px;"><div clas="zp_Attl">'+(_rfr.isOwner&&Object.keys(_rfr.addedMembers).length>0?'<div class="zp_Cslctd"><p>'+ZPI18N.getString("zp.lms.messages.addedmembers")+"</p>":"")+'<ul class="zp_CPlst" _rel="AddedMem"></ul>'+(_rfr.isOwner&&Object.keys(_rfr.addedMembers).length>0?"</div>":"")+"</div></div>",_rfr.isOwner&&(t+='<div class="zp_btn"><button class="zpn_btn zpthm" _rel="save">'+ZPI18N.getString("zp.save")+"</button></div>"),t+="</div>",e.innerHTML=t,AddedMemContainer=e.querySelector("[_rel=AddedMem]"),null!=_rfr.addedMembers&&Object.keys(_rfr.addedMembers).length>0&&AddedMemContainer.appendChild(membersList.getAddedMembersHTML(_rfr.addedMembers,_rfr.isOwner)),_rfr.isOwner)membersMenu=lmsgroupmenu.initiate(e),membersMenu.insertMenu({elem:e.querySelector('[_type="select"]').parentElement,type:"select",mode:"multi",allow_new:!1,menutype:2,menulist:membersList.getYetToAddMembersMenu});else{var s=document.querySelector('[_rel="search"]');lmsbase.addListener(s,"keyup",membersList.searchAddedMembers,!1)}lmsbase.addListener(e,"click",membersList.mebersPopupClickAction,!1)},getAddedMembersHTML:function(e,t){var s=document.createDocumentFragment();if(e&&Object.keys(e).length>0)for(addedMember in e)memberEl=document.createElement("li"),memberEl.setAttribute("userId",addedMember),memberEl.innerHTML=lmsmessages.getUserDP(e[addedMember]).outerHTML+"<h4><i>"+e[addedMember].employeeId+"</i>"+e[addedMember].name+"</h4><a>"+(e[addedMember].designationName?ZSEC.Encoder.encodeForHTML(e[addedMember].designationName):"")+"</a>",t&&erecno!=addedMember&&(memberEl.innerHTML+='<div class="zp_micn"><ul><li><b class=""><span><i class="IC-cls" _rel="deleteMember" data-ttip="'+ZPI18N.getString("zp.lms.messages.deletemember")+'"></i></span></b></li></ul></div>'),s.appendChild(memberEl);return s},getYetToAddMembersMenu:function(){_rfr=membersList._rfr,_rfr.menuReference=this,null!=_rfr.menuReference.value?(clearTimeout(_rfr.timeInterval),_rfr.timeInterval=setTimeout((function(){_rfr.type==membersList.messageType.NEWMSG?membersList.fetchCourseMembers(_rfr.menuReference.value):membersList.fetchDiscussionYetToAddMembers(_rfr.menuReference.value)}),1e3)):_rfr.type==membersList.messageType.NEWMSG?membersList.fetchCourseMembers():membersList.fetchDiscussionYetToAddMembers()},fetchCourseMembers:function(e){_rfr=membersList._rfr,membersCache=membersList.membersCache;var t=1;if(e||null==_rfr.batchId||null==membersCache[_rfr.batchId]){if(null==_rfr.batchId&&!e&&null!=_rfr.courseId&&null!=membersCache[_rfr.courseId]){if(_rfr.yetToAddMembers=JSON.parse(JSON.stringify(membersCache[_rfr.courseId])),t=0,Object.keys(_rfr.addedMembers).length>0)for(user in _rfr.addedMembers)_rfr.yetToAddMembers[user]&&delete _rfr.yetToAddMembers[user];membersList.getMembersMenu(_rfr.yetToAddMembers)}}else{if(_rfr.yetToAddMembers=JSON.parse(JSON.stringify(membersCache[_rfr.batchId])),t=0,Object.keys(_rfr.addedMembers).length>0)for(user in _rfr.addedMembers)_rfr.yetToAddMembers[user]&&delete _rfr.yetToAddMembers[user];membersList.getMembersMenu(_rfr.yetToAddMembers)}if(t){var s={courseId:_rfr.courseId,batchId:null!=_rfr.batchId?_rfr.batchId:void 0,searchStr:e};zplms.get("/lms/discussions/"+(null!=_rfr.messageId?this._rfr.messageId:"0")+"/users",s,(function(t){if("success"==t.status){if(null!=_rfr.batchId)if(e)for(user in t.yetToAddMembers)Object.keys(membersCache[_rfr.batchId]).includes(user)||(membersCache[_rfr.batchId][user]=t.yetToAddMembers[user]);else membersCache[_rfr.batchId]=t.yetToAddMembers;else if(e)for(user in t.yetToAddMembers)Object.keys(membersCache[_rfr.courseId]).includes(user)||(membersCache[_rfr.courseId][user]=t.yetToAddMembers[user]);else membersCache[_rfr.courseId]=t.yetToAddMembers;if(Object.keys(_rfr.addedMembers).length>0)for(user in _rfr.addedMembers)t.yetToAddMembers[user]&&delete t.yetToAddMembers[user];_rfr.yetToAddMembers=t.yetToAddMembers,membersList.getMembersMenu(_rfr.yetToAddMembers)}}))}},fetchDiscussionYetToAddMembers:function(e){if(_rfr=membersList._rfr,discussionMemCache=membersList.discussionMemCache,!e&&membersList.discussionMemCache[_rfr.messageId].isYetToAddListFetched&&discussionMemCache[_rfr.messageId].isOwner&&null!=discussionMemCache[_rfr.messageId].yetToAddMembers)_rfr.yetToAddMembers=JSON.parse(JSON.stringify(discussionMemCache[_rfr.messageId].yetToAddMembers?discussionMemCache[_rfr.messageId].yetToAddMembers:null)),_rfr.addedMembers=JSON.parse(JSON.stringify(discussionMemCache[_rfr.messageId].addedMembers)),_rfr.isOwner=discussionMemCache[_rfr.messageId].isOwner,membersList.getMembersMenu(_rfr.yetToAddMembers);else if(discussionMemCache[_rfr.messageId].isOwner){var t={searchStr:e};zplms.get("/lms/discussions/"+_rfr.messageId+"/members",t,(function(t){if("success"==t.status&&t.yetToAddMembers){if(_rfr.isOwner=!0,e)for(user in t.yetToAddMembers)Object.keys(discussionMemCache[_rfr.messageId].yetToAddMembers).includes(user)||(discussionMemCache[_rfr.messageId].yetToAddMembers[user]=t.yetToAddMembers[user]);else membersList.discussionMemCache[_rfr.messageId].isYetToAddListFetched=!0,discussionMemCache[_rfr.messageId].yetToAddMembers=t.yetToAddMembers;_rfr.yetToAddMembers=JSON.parse(JSON.stringify(discussionMemCache[_rfr.messageId].yetToAddMembers)),membersList.getMembersMenu(t.yetToAddMembers)}}))}},getMembersMenu:function(e){_rfr=membersList._rfr;var t={};for(member in e){var s=[];s.push(_rfr.yetToAddMembers[member].employeeId,_rfr.yetToAddMembers[member].name,""),t[member]=s}_rfr.menuReference.updateOptionList(t)},searchAddedMembers:function(e){if(searchValue=e.target.value,""==searchValue)var t=membersList.getAddedMembersHTML(_rfr.addedMembers,_rfr.isOwner);else{_rfr=membersList._rfr;var s={};for(member in _rfr.addedMembers)(_rfr.addedMembers[member].name.trim().toLowerCase().includes(""+searchValue.toLowerCase())||_rfr.addedMembers[member].employeeId.trim().toLowerCase().includes(""+searchValue.toLowerCase()))&&(s[member]=_rfr.addedMembers[member]);t=membersList.getAddedMembersHTML(s,_rfr.isOwner)}AddedMemContainer=e.target.closest("[popup]").querySelector("[_rel=AddedMem]"),AddedMemContainer.innerHTML="",AddedMemContainer.appendChild(t)},mebersPopupClickAction:function(e){var t=e.target,s=t.getAttribute("_rel");"close"==s?membersList.popupClose():"save"==s?membersList.saveMembers():"deleteMember"==s&&membersList.deleteMember(t)},popupClose:function(){var e=lmsbase.hideMaskLayer();lmsbase.removeListener(e,"click",membersList.mebersPopupClickAction,!1),membersList._rfr.type==membersList.messageType.ADDEDMSG?membersList.addedMsgCallback():membersList.newMsgCallback(),membersList._rfr.type==membersList.messageType.ADDEDMSG&&membersList.reInit()},saveMembers:function(){_rfr=membersList._rfr,membersElems=_rfr.root.querySelector("[_rel=items]").querySelectorAll("[data-value]"),membersIds=[];for(var e=0;e<membersElems.length;e++)membersIds.push(membersElems[e].getAttribute("data-value"));if(0==membersIds.length)_rfr.root.querySelector("[errmsg]").innerText=ZPI18N.getString("zp.lms.messages.plsselctuser");else if(_rfr.root.querySelector("[errmsg]").innerText="",membersList._rfr.type==membersList.messageType.ADDEDMSG){lmsbase.addClass(_rfr.root.querySelector("[_rel=save]"),"zp_btndis");var t={postedToMem:membersIds.toString()};zplms.put("/lms/discussions/"+_rfr.messageId+"/users",t,(function(e){lmsbase.removeClass(_rfr.root.querySelector("[_rel=save]"),"zp_btndis"),"success"==e.status?(membersList.updateAddedMembersList(membersIds),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.messages.membersAdd-success"))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.messages.membersAdd-fail"))}))}else membersList.updateAddedMembersList(membersIds)},updateAddedMembersList:function(e,t){_rfr=membersList._rfr;for(var s=0;s<e.length;s++)_rfr.addedMembers=_rfr.addedMembers?_rfr.addedMembers:{},_rfr.addedMembers[e[s]]=_rfr.yetToAddMembers[e[s]],delete _rfr.yetToAddMembers[e[s]];membersList.popupClose()},addedMsgCallback:function(){_rfr=membersList._rfr,listElement=_rfr.listElement,membersList.updateDiscussionCache(_rfr.messageId),_rfr.saveCallback(_rfr.addedMembers,listElement,150,0)},newMsgCallback:function(){_rfr=membersList._rfr,listElement=_rfr.listElement,addedMembers=_rfr.addedMembers,Object.keys(addedMembers).length>0?(lmsbase.removeClass(listElement.querySelector('[_rel="memList"]'),"zp_dyn"),membersList.getAddedMembersMiniView(_rfr.addedMembers,listElement.querySelector('[_rel="memList"]'),listElement.offsetWidth,listElement.querySelector("[_rel=choose]").offsetWidth)):(listElement.querySelector('[_rel="memList"]').innerHTML="",lmsbase.addClass(listElement.querySelector('[_rel="memList"]'),"zp_dyn"))},updateAddedMembersCount:function(e,t){t.innerHTML=Object.keys(e).length+" "+(Object.keys(e).length>1?ZPI18N.getString("zp.lms.messages.particpants"):ZPI18N.getString("zp.lms.messages.particpant")),t=lmsmessages._root.querySelector('[message_Id= "'+lmsmessages._rfr_popup.messageDetails.messageId+'"]').querySelector("[_rel=selectedMem]"),membersList.getAddedMembersMiniView(_rfr.addedMembers,t.querySelector('[_rel="memList"]'),150,0)},getAddedMembersMiniView:function(e,t,s,r){var l=0,a=0;for(addedMember in t.innerHTML="",e){var n=document.createElement("li");if(n.setAttribute("lastElem",""),n.setAttribute("title",e[addedMember].name),n.appendChild(lmsmessages.getUserDP(e[addedMember])),t.appendChild(n),a++,(l+=n.offsetWidth)>s-(r+38)){var i=document.createElement("li");i.innerHTML='<div class="ZP_photo">+'+(Object.keys(e).length-a+1),t.replaceChild(i,t.querySelector("[lastElem]"));break}n.removeAttribute("lastElem")}},updateDiscussionCache:function(e){_rfr=membersList._rfr,membersList.discussionMemCache[e]=null!=membersList.discussionMemCache[e]?membersList.discussionMemCache[e]:{},membersList.discussionMemCache[e].yetToAddMembers=_rfr.yetToAddMembers,membersList.discussionMemCache[e].addedMembers=_rfr.addedMembers,membersList.discussionMemCache[e].isOwner=_rfr.isOwner},deleteMember:function(e){if(userId=e.closest("[userId]").getAttribute("userId"),_rfr=membersList._rfr,membersList._rfr.type==membersList.messageType.NEWMSG){null!=_rfr.batchId?_rfr.batchId:_rfr.courseId;_rfr.yetToAddMembers[userId]=_rfr.addedMembers[userId],delete _rfr.addedMembers[userId],membersList.deleteMemberFromUI(e,userId)}else lmsbase.addClass(e,"zp_btndis"),zplms.delete("/lms/discussions/"+_rfr.messageId+"/members/"+userId,null,(function(t){lmsbase.removeClass(e,"zp_btndis"),"success"==t.status&&(_rfr.yetToAddMembers[userId]=_rfr.addedMembers[userId],delete _rfr.addedMembers[userId],membersList.updateDiscussionCache(_rfr.messageId),membersList.deleteMemberFromUI(e,userId))}))},deleteMemberFromUI:function(e,t){e.closest("[userId]").parentNode.removeChild(e.closest("[userId]"))},getAddedMembersToStartDiscussion:function(){return membersList._rfr.addedMembers},reInitialise:function(){membersList.membersCache={},membersList.discussionMemCache={},membersList._rfr={root:null,messageId:null,courseId:null,batchId:null,isOwner:!1,type:-1,yetToAddMembers:{},addedMembers:{},listElement:null,saveCallback:null,menuReference:null}}},lmstest={type:{IN_MODULE:0,PRE_COURSE:1,POST_COURSE:2},EVENT_TYPE:{ATTEMPT_COMPLETION:"attempt_completion",TEST_SKIPPED:"test_skipped",TEST_REVIEWED:"test_reviewed",MARK_UPDATE:"mark_updated"},listOfMode:"",index:1,currentTestId:"",editor:null,testId:null,lockmode:"",infodata:{},testMarksData:null,statusswtichbutton:"",onload:function(){var e=function(){lmstest.addListener(lmstest.EVENT_TYPE.ATTEMPT_COMPLETION,lmstest.onAssessmentCompleted),lmstest.addListener(lmstest.EVENT_TYPE.TEST_SKIPPED,lmstest.onAssessmentSkipped),lmstest.addListener(lmstest.EVENT_TYPE.TEST_REVIEWED,lmsLearnersTestMarkUpdatedView.onAssessmentReviewed),lmstest.addListener(lmstest.EVENT_TYPE.MARK_UPDATE,lmstest.onAssessmentUpdated),lmsbase.removeListener(window,"DOMContentLoaded",e)};lmsbase.addListener(window,"DOMContentLoaded",e)}(),viewEntityInfo(e,t,s,r=lmsmodule.onlineTestInfo[e]){lmstest.testInfo=r,lmstest.testId=e,t.setAttribute("testInfoContainer",""),t.setAttribute("testId",e),(s=s||lmsEntityPopUpManager.getInstance()).initContainer(0),s.setTextTypeList(ZPI18N.getString("zp.type"),ZPI18N.getString("zp.lms.test.type.online"),"IC-ei-online"),r.status&&s.setTextTypeList(ZPI18N.getString("zp.status"),r.status,"IC-inf-status");let l=null;r.duration&&(l=r.duration>0?zplms.msToMins(r.duration):ZPI18N.getString("zp.assessment.tab.setup.preferences.timer.notimer"),s.setTextTypeList(ZPI18N.getString("zp.lms.duration"),l,"IC-inf-duration"));let a=null;if(r.testMark&&r.userMark&&parseInt(r.userMark)>-1&&parseInt(r.testMark)>0?s.setMarkTypeList(ZPI18N.getString("zp.lms.mark.marks"),zplms.formatNumberForDisplaying(r.userMark),zplms.formatNumberForDisplaying(r.testMark),"IC-inf-gradescored"):r.testMark&&parseInt(r.testMark)>-1?(s.setTextTypeList(ZPI18N.getString("zp.lms.mark.marks"),zplms.formatNumberForDisplaying(r.testMark),"IC-inf-gradescored"),a=zplms.formatNumberForDisplaying(r.testMark)):r.userMark&&parseInt(r.userMark)>-1&&(s.setTextTypeList(ZPI18N.getString("zp.lms.mark.marks"),r.userMark,"IC-inf-gradescored"),a=r.userMark),r.passPercentage&&s.setTextTypeList(ZPI18N.getString("zp.lms.test.passPercentage"),zplms.formatNumberForDisplaying(r.passPercentage)+"%","IC-inf-pass"),r.numberOfAttemptsTaken){s.setTextTypeList(ZPI18N.getString("zp.lms.test.attemptsTaken"),r.numberOfAttemptsTaken,"IC-inf-attempts",{attemptTaken:""});let e=s.getInfoContainer().querySelector("[attemptTaken]");e.removeAttribute("attemptTaken"),lmstest.constructAttemptList(e,r),zplms.isNullOrUndefined(r.numberOfAttemptsLeft)||-1==r.numberOfAttemptsLeft||s.setTextTypeList(ZPI18N.getString("zp.lms.test.AttemptsLeft"),-1==r.numberOfAttemptsLeft?ZPI18N.getString("zp.lms.test.Unlimited"):r.numberOfAttemptsLeft,"IC-inf-attempts-left")}r.maximumAttemptsAllowed&&s.setTextTypeList(ZPI18N.getString("zp.lms.test.maximumAttemptsAllowed"),-1==r.maximumAttemptsAllowed?ZPI18N.getString("zp.lms.test.Unlimited"):r.maximumAttemptsAllowed,"IC-inf-allowed-attempts");let n="";if(r.attemptsAllowedType){switch(parseInt(r.attemptsAllowedType)){case 0:n=ZPI18N.getString("zp.lms.test.formComponent.attemptsAllowedType.options.attemptsAvailable");break;case 1:n=ZPI18N.getString("zp.lms.test.formComponent.attemptsAllowedType.options.testCompleted");break;case 2:n=ZPI18N.getString("zp.lms.test.formComponent.attemptsAllowedType.options.courseCompleted")}s.setTextTypeList(ZPI18N.getString("zp.lms.test.formComponent.attemptsAllowedType.displayName",[""]),n,"IC-inf-reattempt")}var i;if(r.gradeCategoryDetails&&s.setTextTypeList(ZPI18N.getString("zp.lms.gradebook.gradeCategory"),r.gradeCategoryDetails.categoryName,"IC-inf-gradescored"),r.showMarksToAssessee&&s.setTextTypeList(ZPI18N.getString("zp.lms.test.showMarksToLearner"),r.showMarksToAssessee,"IC-inf-gradescored"),r.showMarksToAssesseeValue>=0){switch(parseInt(r.showMarksToAssesseeValue)){case 1:i=ZPI18N.getString("zp.lms.test.showMarksToAssessee.displayCorrectAnswersOnPassingOrFinalAttempt");break;case 0:case 2:i=ZPI18N.getString("zp.no");break;case 3:i=ZPI18N.getString("zp.lms.test.showMarksToAssessee.diplayCorrectAnswersOnFinalAttempt");break;case 4:i=ZPI18N.getString("zp.lms.test.showMarksToAssessee.diplayCorrectAnswersOnPassing")}s.setTextTypeList(ZPI18N.getString("zp.lms.test.showCorrectAnswersToLearner"),i,"IC-inf-showans")}r.description&&s.setTextTypeList(ZPI18N.getString("zp.lms.messages.description"),ZPeople.decodeTxt(r.description),"IC-inf-description",{class:"descwrap"});let o=document.createElement("div");o.classList.add("zp_scrmcnt_ftr"),o.appendChild(document.createElement("div"));let c=o.appendChild(document.createElement("div"));if(c=c.appendChild(document.createElement("div")),c.classList.add("zp_scrmbtn"),o.appendChild(c),r.assessmentId&&r.canUserPreview){let e=document.createElement("button");e.textContent=ZPI18N.getString("zp.lms.test.previewTest"),c.appendChild(e),lmsbase.addListener(e,"click",(()=>ZPAssessAPI.previewAssessment(r.assessmentId,!0)))}if(r.canUserTakeAttempt){let e=document.createElement("button");e.textContent=r.numberOfAttemptsTaken>0?ZPI18N.getString("zp.lms.test.takeAnotherAttempt"):ZPI18N.getString("zp.lms.test.takeTest"),e.appendChild(document.createElement("i")),e.querySelector("i").classList.add("IC-argt"),c.appendChild(e),lmsbase.addListener(e,"click",(()=>ZPAssessAPI.startAssessment(r.assessmentId,!1)))}if(r.canUserSkipTest){let e=document.createElement("button");e.textContent=ZPI18N.getString("zp.lms.test.skipTest"),c.appendChild(e),lmsbase.addListener(e,"click",(()=>lmstest.skipTest(r.testId)))}let d=lmsdocument.createElement("div",{class:"zp_prvwcnt"}),m=lmsdocument.createElement("div",{class:"zp_scrmcnt"}),u=lmsdocument.createElement("div",{class:"zp_scrmcnt_mn"});d.appendChild(m),m.appendChild(u),u.appendChild(s.getInfoContainer()),lmstest.getOnlineLabel(s,l,a,n,r,i),t.appendChild(d),m.appendChild(o)},getOnlineLabel:function(e,t,s,r,l,a){let n=[`${ZPI18N.getString("zp.lms.course.onlinedetail")}: ${ZPI18N.getString("zp.type")}: ${ZPI18N.getString("zp.lms.test.type.online")}`];if(l.status&&n.push(`${ZPI18N.getString("zp.status")}: ${l.status}`),null!=t&&n.push(`${ZPI18N.getString("zp.lms.session.duration")}: ${t}`),null!=s&&n.push(`${ZPI18N.getString("zp.lms.mark.marks")}: ${s}`),l.passPercentage&&n.push(`${ZPI18N.getString("zp.lms.test.passPercentage")}: ${zplms.formatNumberForDisplaying(l.passPercentage)}`),l.numberOfAttemptsTaken&&(n.push(`${ZPI18N.getString("zp.lms.test.attemptsTaken")}: ${l.numberOfAttemptsTaken}`),!zplms.isNullOrUndefined(l.numberOfAttemptsLeft)&&-1!=l.numberOfAttemptsLeft)){const e=-1==l.numberOfAttemptsLeft?ZPI18N.getString("zp.lms.test.Unlimited"):l.numberOfAttemptsLeft;n.push(`${ZPI18N.getString("zp.lms.test.AttemptsLeft")}: ${e}`)}if(l.maximumAttemptsAllowed){const e=-1==l.maximumAttemptsAllowed?ZPI18N.getString("zp.lms.test.Unlimited"):l.maximumAttemptsAllowed;n.push(`${ZPI18N.getString("zp.lms.test.maximumAttemptsAllowed")}: ${e}`)}""!==r&&n.push(`${ZPI18N.getString("zp.lms.test.formComponent.attemptsAllowedType.displayName",[""])}: ${r}`),l.gradeCategoryDetails&&n.push(`${ZPI18N.getString("zp.lms.gradebook.gradeCategory")}: ${l.gradeCategoryDetails.categoryName}`),l.showMarksToAssessee&&n.push(`${ZPI18N.getString("zp.lms.test.showMarksToLearner")}: ${l.showMarksToAssessee}`),a&&n.push(`${ZPI18N.getString("zp.lms.test.showCorrectAnswersToLearner")}: ${a}`),l.description&&n.push(`${ZPI18N.getString("zp.sdescription")}: ${ZPeople.decodeTxt(l.description)}`);const i=n.join(", "),o=e.getInfoContainer();o.setAttribute("tabindex",lmsConstants.TAB_INDEX.ACTIVE),o.setAttribute("aria-label",i)},constructAttemptList(e,t){if(t.assessmentId&&t.numberOfAttemptsTaken>0){let s=document.createElement("div"),r=document.createElement("a");r.append(document.createTextNode("Show attempts "));let l,a=document.createElement("i");a.classList.add("IC-ar-dwn"),r.append(a),s.append(r),e.appendChild(s),lmsbase.addListener(s,"click",(()=>{a.classList.contains("IC-ar-dwn")?t.attemptList?(l=lmsLearnersTestMarkUpdatedView.showLearnersAllAttempt(t.testId,t.assessmentId,t.attemptList,erecno),e.appendChild(l),a.classList.replace("IC-ar-dwn","IC-ar-top")):lmsLearnersTestMarkUpdatedView.fetchLearnerAttempts(erecno,t.assessmentId,((s,r)=>{"success"===r&&(s=s[1],l=lmsLearnersTestMarkUpdatedView.showLearnersAllAttempt(t.testId,t.assessmentId,s.employee_attempts,erecno),e.appendChild(l),a.classList.replace("IC-ar-dwn","IC-ar-top"),t.attemptList=s.employee_attempts)})):(l&&l.remove(),a.classList.replace("IC-ar-top","IC-ar-dwn"))}))}},viewOfflineTestInfo(e,t,s,r=lmsmodule.offlineTestInfo[e]){lmstest.testInfo=r,lmstest.testId=e,t.setAttribute("testInfoContainer",""),t.setAttribute("testId",e),(s=s||lmsEntityPopUpManager.getInstance()).initContainer(0),s.setTextTypeList(ZPI18N.getString("zp.type"),ZPI18N.getString("zp.lms.test.type.offline"),"IC-ei-offline");let l=null;r.duration&&(l=Math.floor(r.duration/6e4)+" "+ZPI18N.getString("zp.lms.mins"),s.setTextTypeList(ZPI18N.getString("zp.lms.duration"),l,"IC-inf-duration")),r.gradeCategoryName&&s.setTextTypeList(ZPI18N.getString("zp.lms.gradebook.gradeCategory"),zplms.decodeIfEncoded(r.gradeCategoryName),"IC-inf-gradescored"),r.description&&s.setTextTypeList(ZPI18N.getString("zp.lms.messages.description"),zplms.decodeIfEncoded(r.description),"IC-inf-description",{class:"descwrap"});let a=lmsdocument.createElement("div",{class:"zp_prvwcnt"}),n=lmsdocument.createElement("div",{class:"zp_scrmcnt"}),i=lmsdocument.createElement("div",{class:"zp_scrmcnt_mn"});a.appendChild(n),n.appendChild(i),i.appendChild(s.getInfoContainer()),lmstest.getOfflineLabel(s,l,r),t.appendChild(a)},getOfflineLabel:function(e,t,s){const r=[`${ZPI18N.getString("zp.lms.course.offlinedetaill")}: ${ZPI18N.getString("zp.type")}: ${ZPI18N.getString("zp.lms.test.type.offline")}`];null!=t&&r.push(`${ZPI18N.getString("zp.lms.session.duration")}: ${t}`),s.gradeCategoryName&&r.push(`${ZPI18N.getString("zp.lms.session.gradeCategory")}: ${zplms.decodeIfEncoded(s.gradeCategoryName)}`),s.description&&r.push(`${ZPI18N.getString("zp.sdescription")}: ${zplms.decodeIfEncoded(s.description)}`);const l=r.join(", "),a=e.getInfoContainer();a.setAttribute("tabindex",lmsConstants.TAB_INDEX.ACTIVE),a.setAttribute("aria-label",l)},initiate:function(){lmscoursedetails.currentCourseData?"addTestInfo"==this.module||"editTestInfo"==this.module?(lmsmodule.currentModuleId=this.hashObject.level1,lmstest.showAddTest()):lmssessions.startIndex=1:lmsmodule.getCourseBatchData(lmscourses.currentBatchId,lmstest.reinitiate,this)},reinitiate:function(e,t){lmsmodule.defaultDate=e,"addTestInfo"==t.module||"editTestInfo"==t.module?(lmsmodule.currentModuleId=t.hashObject.level1,lmstest.showAddTest()):lmssessions.startIndex=1},getEditFormComponents:function(e,t,s){lmstest.currentTestId=e;var r={mode:"fetchSingleRecord",formId:lmsbase.testFormId,recordId:e,isApprovalEnabled:!1,courseId:lmscourses.currentCourseId,conreqcsr:csrfToken};$.post("/formAction.zp",r,(function(e){lmsform.editDetails=e,lmstest.showAddTest("edit")}))},getOfflineTestDetails:function(e,t){var s=lmsmodule.offlineTestInfo[e],r="",l="",a="",n="";s.startTime&&(s.timeFormatted?r=s.startTime:(r=(r=s.startTime.split(":"))[0]/1e3,l=Math.floor(r/3600),0==(a=r%60)&&(a="00"),n="AM","hh:mm a"===timeFormat&&l>=12?(l>12&&(l-=12),n="PM"):"HH:mm"===timeFormat&&(n=""),r=l+":"+a+" "+n)),lmstest.testId=e,lmstest.testInfo=s;var i="";if(s.startDate&&(s.startDate=lmsmodule.orgDateFormat(s.startDate),s.startDate&&(i=ZPDateTime.getDateDisplayFormatWithoutTime(new Date(s.startDate.parseDate(lmsbase._userDForm))))),1==t){var o=lmsbase.openQHash(),c="";c='<div class="zp_pvhd" id="phead"><div class="zp_mark"><span>'+ZPI18N.getString("zp.lms.courseoverview.Testinfo")+"</span></div>",c+='<div class="zp_micn"><ul><li onclick="lmstest.closePopup(\''+e+'\')" id=""><b class=""><span><i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></span></b></li></ul></div>',c+="</div>",c+='<div class="zp_pcnt" id="">'}else{$("body").addClass("zp_Tcfpv"),$(".zp_pwrap").find(".zp_Tmlft").remove(),$(".zp_pvcnt").hide(),lmscontent.fileViewTabOpenClose();c='<div class="zp_Tmlft">';c+='<div class="zp_CSdet" _rel="fileContent">'}if(s.duration||(s.duration=""),c+='<div class="zp_CItb">',c+="<ul>",c+="<li><div><p>"+ZPI18N.getString("zp.lms.coursename")+"</p></div><div><font>"+s.testName+"</font></div></li>",c+="<li><div><p>"+ZPI18N.getString("zp.type")+"</p></div><div><font>"+ZPI18N.getString("zp.lms.test.type.offline")+"</font></div></li>",i&&(c+="<li><div><p>"+ZPI18N.getString("zp.lms.startdate")+"</p></div><div><span>"+i+"</span></div></li>"),s.startTime&&(c+="<li><div><p>"+ZPI18N.getString("zp.starttime")+"</p></div><div><span>"+r+"</span></div></li>"),s.duration&&(c+="<li><div><p>"+ZPI18N.getString("zp.lms.duration")+"</p></div><div><span>"+s.duration+"</span></div></li>"),s.gradeCategoryName&&(c+="<li><div><p>"+ZPI18N.getString("zp.lms.gradebook.gradeCategory")+"</p></div><div><span>"+s.gradeCategoryName+"</span></div></li>"),s.description&&(c+="<li><div><p>"+ZPI18N.getString("zp.lms.messages.description")+"</p></div><div><span>"+s.description+"</span></div></li>"),c+="</ul>",s.contentResource&&0!=s.contentResource.length){c+='<div _rel="attachments" class="zpa_comp"><h4 class="zp_Pttl">'+ZPI18N.getString("zpp.resources")+'</h4><div class="attch_view"><div id="filesAttch">';for(var d="",m=0;m<s.contentResource.length;m++){var u={contentId:s.contentResource[m].metaInfo.contentId,extension:s.contentResource[m].metaInfo.extension,name:s.contentResource[m].fileName,size:s.contentResource[m].metaInfo.size,type:s.contentResource[m].metaInfo.type};(d=ListingUploadManager.getSingleAttachmentHTML(u,lmsuploadmanager.ATTACHMENT_TYPE.SAVED,null,{deleteButton:!1})).setAttribute("link",s.contentResource[m].resourceId),c+=d.outerHTML}c+="</div></div></div>"}if(1==t){c+='<div class="zp_DMcnt"><div id="commemeter"><label>'+ZPI18N.getString("zp.lms.messages.comments")+'</label><ul class="zp_Dmsg" id="commentsList"></ul></div></div>',c+="</div></div>",o.innerHTML=c;var p=s.discussionComments.length;for(m=0;m<p;m++){var g=lmsmessages.getCommentCard(s.discussionComments[p-m-1]);document.getElementById("commentsList").appendChild(g)}c="";var f={subBtnName:"zp.submit",divId:"zp_lmstestcomments",subBtnId:"submitbtn",parentCon:"editor_container",cancelnotneeded:!0,isTopBar:!0};c+=ZPFeeds.Editor.getEditorContainer(f),$("#commemeter").append(c),lmstest.editor=ZPFeeds.Editor.getEditor("zp_lmstestcomments","Training","",f),ZE_Init.needEditorFocus=!1,lmsbase.addListener(document.getElementById("submitbtn"),"click",lmstest.submitDiscussion,!1)}else c+='<div class="zp_CSttl"><i class="IC-back" data-ttip="'+ZPI18N.getString("zp.lms.back")+'" onclick="lmscontent.contentClose()"></i><font>'+s.testName+'</font> <div><i class="IC-tbmax" _rel = "sIcon" onclick="lmscontent.fileViewTabOpenClose()"></i></div></div>',$("[data-id='courseMain']").after(c),lmscontent.sideBarConstruction();(o=document.querySelector('[_rel="attachments"]'))&&lmsbase.addListener(o,"click",lmsmodule.saveToDownload,!1)},viewOnlineTestInfo:function(e,t){lmstest.testInfo=e,lmstest.testId=e.testId;var s='<div testInfoContainer testId="'+e.testId+'" class="zp_CItb">';if(lmscoursedetails.isUserJoined&&e.type===lmstest.type.POST_COURSE&&!e.doesUserHaveCompletedAllMandatory&&(s+='<font class="zp_notinf bgylw m0"><span><i class= "IC-information"> </i>'+ZPI18N.getString("zp.lms.test.post.warning")+"</span> </font>"),s+="<ul>",s+="<li><div><p>"+ZPI18N.getString("zp.lms.coursename")+"</p></div><div><font>"+e.testName+"</font></div></li>",s+="<li><div><p>"+ZPI18N.getString("zp.type")+"</p></div><div><font>"+ZPI18N.getString("zp.lms.test.type.online")+"</font></div></li>",e.status&&(s+="<li><div><p>"+ZPI18N.getString("zp.status")+"</p></div><div><font status>"+e.status+"</font></div></li>"),e.maximumAttemptsAllowed&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.test.maximumAttemptsAllowed")+"</p></div><div><span>"+(-1==e.maximumAttemptsAllowed?ZPI18N.getString("zp.lms.test.Unlimited"):e.maximumAttemptsAllowed)+"</span></div></li>"),e.numberOfAttemptsTaken&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.test.attemptsTaken")+"</p></div><div><span>"+e.numberOfAttemptsTaken+"</span></div></li>",zplms.isNullOrUndefined(e.numberOfAttemptsLeft)||-1!=e.numberOfAttemptsLeft&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.test.AttemptsLeft")+"</p></div><div><span>"+(-1==e.numberOfAttemptsLeft?ZPI18N.getString("zp.lms.test.Unlimited"):e.numberOfAttemptsLeft)+"</span></div></li>")),void 0!==e.attemptsAllowedType){let t="";switch(parseInt(e.attemptsAllowedType)){case 0:t=ZPI18N.getString("zp.lms.test.formComponent.attemptsAllowedType.options.attemptsAvailable");break;case 1:t=ZPI18N.getString("zp.lms.test.formComponent.attemptsAllowedType.options.testCompleted");break;case 2:t=ZPI18N.getString("zp.lms.test.formComponent.attemptsAllowedType.options.courseCompleted")}s+="<li><div><p>"+ZPI18N.getString("zp.lms.test.formComponent.attemptsAllowedType.displayName",[""])+"</p></div><div><span>"+t+"</span></div></li>"}if(e.startDate&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.startdate")+"</p></div><div><span>"+e.startDate+"</span></div></li>"),e.startTime&&(s+="<li><div><p>"+ZPI18N.getString("zp.starttime")+"</p></div><div><span>"+e.startTime+"</span></div></li>"),e.duration&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.duration")+"</p></div><div><span>"+e.duration+"</span></div></li>"),e.gradeCategoryDetails&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.gradebook.gradeCategory")+"</p></div><div><span>"+e.gradeCategoryDetails.categoryName+"</span></div></li>"),e.description&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.messages.description")+"</p></div><div><span>"+e.description+"</span></div></li>"),e.testMark&&"0.0"!=e.testMark&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.mark.marks")+"</p></div><div><span>"+zplms.formatNumberForDisplaying(e.testMark)+"</span></div></li>"),e.passPercentage&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.test.passPercentage")+"</p></div><div><span>"+zplms.formatNumberForDisplaying(e.passPercentage)+"%</span></div></li>"),e.showMarksToAssessee&&(s+="<li><div><p>"+ZPI18N.getString("zp.lms.test.showMarksToLearner")+"</p></div><div><span>"+e.showMarksToAssessee+"</span></div></li>"),e.showMarksToAssesseeValue>=0){var r;switch(parseInt(e.showMarksToAssesseeValue)){case 1:r=ZPI18N.getString("zp.lms.test.showMarksToAssessee.displayCorrectAnswersOnPassingOrFinalAttempt");break;case 0:case 2:r=ZPI18N.getString("zp.no");break;case 3:r=ZPI18N.getString("zp.lms.test.showMarksToAssessee.diplayCorrectAnswersOnFinalAttempt");break;case 4:r=ZPI18N.getString("zp.lms.test.showMarksToAssessee.diplayCorrectAnswersOnPassing")}s+="<li><div><p>"+ZPI18N.getString("zp.lms.test.showCorrectAnswersToLearner")+"</p></div><div><span>"+r+"</span></div></li>"}if(e.userMark&&(s+="<li><div><p>"+(e.numberOfAttemptsLeft>0?ZPI18N.getString("zp.lms.test.obtainedMarks.lastAttempt"):ZPI18N.getString("zp.lms.test.obtainedMarks"))+"</p></div><div><span>"+("-1"!=zplms.formatNumberForDisplaying(e.userMark)?zplms.formatNumberForDisplaying(e.userMark)+" / "+zplms.formatNumberForDisplaying(e.totalMarks):"-")+"</span></div></li>"),s+="</ul>",e.contentResource&&e.contentResource.length){for(var l='<div _rel="attachments" class="zpa_comp"><h4 class="zp_Pttl">'+ZPI18N.getString("zpp.resources")+'</h4><div class="attch_view"><div id="filesAttch">',a=0;a<e.contentResource.length;a++){var n={contentId:e.contentResource[a].metaInfo.contentId,extension:e.contentResource[a].metaInfo.extension,name:e.contentResource[a].fileName,size:e.contentResource[a].metaInfo.size,type:e.contentResource[a].metaInfo.type},i=ListingUploadManager.getSingleAttachmentHTML(n,lmsuploadmanager.ATTACHMENT_TYPE.SAVED,null,{deleteButton:!1});i.setAttribute("link",e.contentResource[a].resourceId),l+=i.outerHTML}s+=l+="</div></div></div>"}if(1==t){var o="";e.canUserPreview&&e.assessmentId&&(o+='<div class="zp_btn"><button previewTest class="zpthm">'+ZPI18N.getString("zp.lms.test.previewTest")+"</button></div>");var c=lmsbase.openQHash(),d="";d='<div class="zp_pvhd" id="phead"><div class="zp_mark"><span>'+ZPI18N.getString("zp.lms.courseoverview.Testinfo")+"</span></div>",d+='<div class="zp_micn">'+o+"<ul><li onclick=\"lmstest.closePopup('"+lmstest.testId+'\')" id=""><b class=""><span><i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></span></b></li></ul></div>',d+="</div>",d+='<div class="zp_pcnt">',d+=s,d+='<div class="zp_DMcnt"><div id="commemeter"><label>'+ZPI18N.getString("zp.lms.messages.comments")+'</label><ul class="zp_Dmsg" id="commentsList"></ul></div></div>',d+="</div></div>",c.innerHTML=d;var m=e.discussionComments.length;for(a=0;a<m;a++){var u=lmsmessages.getCommentCard(e.discussionComments[m-a-1]);document.getElementById("commentsList").appendChild(u)}d="";var p={subBtnName:"zp.submit",divId:"zp_lmstestcomments",subBtnId:"submitbtn",parentCon:"editor_container",cancelnotneeded:!0,isTopBar:!0};d+=ZPFeeds.Editor.getEditorContainer(p),$("#commemeter").append(d),lmstest.editor=ZPFeeds.Editor.getEditor("zp_lmstestcomments","Training","",p),ZE_Init.needEditorFocus=!1,lmsbase.addListener(document.getElementById("submitbtn"),"click",lmstest.submitDiscussion,!1)}else{o="";o+='<div class="zp_btn">',e.canUserPreview&&e.assessmentId&&(o+='<button previewTest class="zpthm">'+ZPI18N.getString("zp.lms.test.previewTest")+"</button>"),e.canUserViewResult&&(o+='<button viewResult class="zpthm">'+ZPI18N.getString("zp.assessment.result.view_result")+"</button>"),e.canUserTakeAttempt&&(o+='<button startTest class="zpthm">'+(e.numberOfAttemptsTaken>0?ZPI18N.getString("zp.lms.test.takeAnotherAttempt"):ZPI18N.getString("zp.lms.test.takeTest"))+"</button>"),e.canUserSkipTest&&(o+='<button skipTest class="zpthm">'+ZPI18N.getString("zp.lms.test.skipTest")+"</button>"),s+=o+="</div>",$("body").addClass("zp_Tcfpv"),$(".zp_pwrap").find(".zp_Tmlft").remove(),$(".zp_pvcnt").hide(),2!=t&&lmscontent.fileViewTabOpenClose();d='<div class="zp_Tmlft">';d+='<div class="zp_CSdet" _rel="fileContent">',d+=s,d+='<div class="zp_CSttl"><i class="IC-back" data-ttip="'+ZPI18N.getString("zp.lms.back")+'" onclick="lmscontent.contentClose()"></i><font>'+e.testName+"</font>"+(2!=t?'<div><i class="IC-tbmax" _rel = "sIcon" onclick="lmscontent.fileViewTabOpenClose()"></i></div>':"")+"</div>",$("[data-id='courseMain']").after(d),2!=t&&lmscontent.sideBarConstruction()}if(e.contentResource&&e.contentResource.length){var g=document.querySelector('.training [_rel="attachments"]');lmsbase.addListener(g,"click",lmsmodule.saveToDownload,!1)}e.canUserPreview&&e.assessmentId&&$(".training [previewTest]").click((function(){ZPAssessAPI.previewAssessment(e.assessmentId,!0)})),e.canUserTakeAttempt&&$(".training [startTest]").click((function(){ZPAssessAPI.startAssessment(e.assessmentId,!1)})),e.canUserViewResult&&$(".training [viewResult]").click((function(){lmstest.showLastAttemptResult(e.testId,e.assessmentId)})),e.canUserSkipTest&&$(".training [skipTest]").click((function(){lmstest.skipTest(e.testId)}))},onAssessmentSkipped:function(e){lmstest.onAssessmentCompleted(e)},onAssessmentCompleted:function(e){let t=e.testInfo.testId,s=$("[testInfoContainer][testId='"+t+"']");if(s.length>0){let r=lmstest.testInfo;if(r&&r.testId==t)for(let t in e.testInfo)r[t]=e.testInfo[t];r.attemptList=void 0;let l=s[0];l.querySelector(".zp_prvwcnt").remove(),lmstest.viewEntityInfo(t,l,null,r)}else t==lmsLearnersTestMarkUpdatedView.testId&&lmsLearnersTestMarkUpdatedView.onAssessmentAttempted(e);e.testInfo.incompleteList&&(lmstest.makeEntitiesAsIncomplete(e.testInfo.incompleteList),lmscoursedetails.courseEntityData=null,lmscoursedetails.getCourseEntityProgress()),e.testInfo.modulecomplete&&Object.keys(e.testInfo.modulecomplete).forEach((function(t){let s=[1];s.push(e.testInfo.modulecomplete[t]),lmscontent.moduleCompleteEnabledisable(s,t);let r=lmsmodule.moduleInfo[t];r.isCompleted=e.testInfo.modulecomplete[t].isModuleUpdated,ModuleTab.onUpdated(r)}));let r=lmsmodule.onlineTestInfo[t];updateObj(r,e.testInfo),ModuleEntity.onUpdated(r)},onAssessmentUpdated:function(e){if(lmsmodule.offlineTestInfo[e.testId]&&(lmsmodule.offlineTestInfo[e.testId].memberMark=e.obtainedMark,lmsmodule.offlineTestInfo[e.testId].testMark=e.totalMark,lmsmodule.offlineTestInfo[e.testId].canMarkAsComplete="2",lmsmodule.offlineTestInfo[e.testId].isCompleted=e.isCompleted,ModuleEntity.onUpdated(lmsmodule.offlineTestInfo[e.testId])),1==lmsEntityView.entityPreview){let t=$('[_sec = "entityrght_'+e.testId+'"]'),s=t.find('[_crel="'+e.testId+'"]');s.removeClass(),s.addClass("IC-tckfil sel"),t[0].hasAttribute("mId")&&lmsEntityView.updateModuleProgress(t[0].getAttribute("mId"),1),lmsEntityView.instance.userMark=e.obtainedMark,lmsEntityView.instance.totalMark=e.totalMark,lmsEntityView.currEntityId==e.testId&&lmsEntityContainer.changeEntityContainerStatus(1)}},showAddTest:function(e){var t={formId:lmsbase.testFormId,courseId:lmscourses.currentCourseId,mode:"getFormComponents",conreqcsr:csrfToken};$.post("/formAction.zp",t,(function(t){"edit"==e?lmstest.constructTestFields(t.message.formComponentDetails,e,lmsform.editDetails.message.recordDetails[0].column1):lmstest.constructTestFields(t.message.formComponentDetails,e)}))},constructTestFields:function(e,t,s){document.getElementById("form")&&document.getElementById("form").remove(),"edit"==t?lms.changeHash("ques","editTestInfo/"+lmsmodule.currentModuleId,"disable"):lms.changeHash("ques","addTestInfo/"+lmsmodule.currentModuleId,"disable");var r=lmsbase.openQHash();null==s&&(s=[]);var l='<div class="zp_pvhd" id="phead"><div class="zp_mark"><span>'+("edit"==t?ZPI18N.getString("zp.lms.edittest"):ZPI18N.getString("zp.lms.modules.addtest"))+'</span> </div><div class="zp_micn"><ul><li onclick="closepreview()" id=""></li>';l+='<li onclick="lmsmodule.closeQHash()" id=""><b class=""><span><i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></span></b> </li></ul></div></div>',$(r).append(l);var a=lmsform.initiate(),n=0;"edit"==t&&(n=1),a.innerHTML+='<<div class="zp_btn">'+lmsform.insertField("submit",lmstest.updateTestInfo,ZPI18N.getString("zp.lms.save"),n)+"</div>";var i=document.createElement("div");if(i.className="zp_pcnt",i.setAttribute("_rel","scrollElement"),null!=s[6])var o=""!=s[6].componentValue?1:0;else o=1;var c={};c=lmscoursedetails.currentCourseData?lmscoursedetails.currentCourseData[0]:lmsmodule.defaultDate,e[0].column1[2].defaultDate={startDate:c.startDate,endDate:c.endDate},e[0].column1[1].fieldType==lmsform.fieldtype.DECIMAL&&(e[0].column1[1].fieldType=lmsform.fieldtype.NUMBER),s[1]&&s[1].componentType==lmsform.fieldtype.DECIMAL&&(s[1].componentType=lmsform.fieldtype.NUMBER,s[1].componentValue&&(s[1].componentValue=parseInt(s[1].componentValue)+"")),lmsform.currentFormId=lmsbase.testFormId,lmstest.dateField=e[0].column1[6],i.innerHTML+='<div class="zp_Sm zp_c5">'+lmsformcomponents.labelName(e[0].column1[0])+lmsform.insertField(e[0].column1[0],"","",1,s[0])+"</div>",i.innerHTML+='<div class="zp_Sm zp_c5">'+lmsformcomponents.labelName(e[0].column1[1])+lmsform.insertField(e[0].column1[1],"","",0,s[1])+"</div>",i.innerHTML+='<div class="zp_Sm zp_c5">'+lmsformcomponents.labelName(e[0].column1[2])+lmsform.insertField(e[0].column1[2],"","",0,s[2])+"</div>",i.innerHTML+='<div class="zp_Sm zp_c3">'+lmsformcomponents.labelName(e[0].column1[3])+lmsform.insertField(e[0].column1[3],"","",2,s[3])+"</div>",i.innerHTML+='<div class="zp_Sm zp_c2">'+lmsformcomponents.labelName(e[0].column1[4])+lmsform.insertField(e[0].column1[4],"","",0,s[4],1)+"</div>",i.innerHTML+='<div class="zp_Sm">'+lmsformcomponents.labelName(e[0].column1[5])+lmsform.insertField(e[0].column1[5],"","",1,s[5])+"</div>",i.innerHTML+='<div class="zp_Attl"><p>'+ZPI18N.getString("zp.lms.content.Lock/Unlocksettings")+"</p><span>"+ZPI18N.getString("zp.lms.TestlockOrunlock")+'</span><div class="zp_c5" id="lockUntil"><div class="zp_Sm zp_c5" id="lockUntilThen"></div><div class="zp_Sm zp_c5" _rel="dateFieldLock">'+lmsform.insertField(e[0].column1[6],"","",2,s[6])+"</div></div>",i.innerHTML+='<div class="zp_Attl">'+lmsformcomponents.labelName(e[0].column1[7],1)+lmsform.insertField(e[0].column1[7],"","","",s[7])+"</div>",a.appendChild(i),"edit"==t&&(a.innerHTML+=lmsformcomponents.hiddenField("zp_recordId",lmstest.currentTestId)),a.innerHTML+=lmsformcomponents.hiddenField("zp_tableName","P_LMSTest"),a.innerHTML+=lmsformcomponents.hiddenField("zp_formId",lmsbase.testFormId),r.appendChild(a),lmsformcomponents.bind(r),o&&"edit"==t?lmstest.getLockSettings(this,window.event,"lockUntilThen","lockUntil",1):(lmstest.getLockSettings(this,window.event,"lockUntilThen","lockUntil"),$('[_rel="dateFieldLock"]').hide(),lmstest.lockmode="unlock"),lmsform.editDetails=""},getLockSettings:function(e,t,s,r,l){var a={},n=[];n.push(ZPI18N.getString("zp.lms.unlock")),a[1]=n;var i=[];i.push(ZPI18N.getString("zp.lms.lockuntil")),a[2]=i;var o=document.getElementById(s),c="";c=1!=l?ZPI18N.getString("zp.lms.unlock"):ZPI18N.getString("zp.lms.lockuntil"),lmstest.createMenu(a,o,r,c)},createMenu:function(e,t,s,r){lmsform.Obj.insertMenu({elem:t,type:"select",mode:"single",menulist:e,click:lmstest.getLockOptions}),lmsmenu.changeToSelectMenu(t,{},"single",null,r)},getLockOptions:function(e){"2"!=e.value?($('[_rel="dateFieldLock"]').hide(),lmstest.lockmode="unlock"):($('[_rel="dateFieldLock"]').show(),lmstest.lockmode="lock")},testStatusUpdate:function(e,t){var s;s=t.checked?1:0;var r={method:"updateTestStatus",testId:e,conreqcsr:csrfToken,status:s};$.post("/testAction.zp",r,(function(e){}))},updateTestInfo:function(e){if(e.resourceType=5,e.courseId=lmscourses.currentCourseId,e.lmsRecordId=lmsmodule.currentModuleId,"addRecord"==e.zp_mode){lmsmodule.lastEntityId(e.lmsRecordId),e.parentEntityId=lmsmodule.lastEntity;var t={method:"checkParentEntityExist",currentBatchId:lmscourses.currentBatchId,currentModuleId:e.lmsRecordId,conreqcsr:csrfToken};$.post("/moduleAction.zp",t,(function(t){"success"==t[1].message?(e.parentEntityId=t[1].parentEntityId,lmstest.valUpdateTest(e)):(lmsformcomponents.onAllUploadsFinished(),ZPeople.Message.showFailureMsg("unable to Add Test"))}))}else lmstest.valUpdateTest(e)},valUpdateTest:function(e){"unlock"==lmstest.lockmode&&(e.lms_LockUntil="");var t="";""!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&(t=lmscourses.currentBatchId),e.batchId=t,$.post("/addUpdateRecord.zp",e,(function(t){$.each(t,(function(t,s){7e3==s.code?(lmsbase.closeQHash(),lmsbase.removeQHash(),lmsmodule.getAddEditedTest(s.pkId,s,e.zp_mode,"test"),lmsformcomponents.onAllUploadsFinished(),lmscoursedetails.activityData=null,ZPeople.Message.showSuccessMsg("Test Added Successfully")):(lmsformcomponents.onAllUploadsFinished(),ZPeople.Message.showFailureMsg("unable to Add Test"))})),lmstest.lockmode=""}))},getComments:function(e){var t='<div class="zp_pv zp_markatndvw" id="markattendview"><div class="zp_pwrap zp_tab"><div class="zp_pvhd" id="phead"><div class="zp_micn"><ul>';t+='<li id=""><b class=""> <span> <i class="IC-mre"  data-ttip="'+ZPI18N.getString("zp.lms.more")+'"></i></span></b></li><li onclick="lmstest.closePopup('+e+')" id=""><b class=""> <span><i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></span></b></li></ul></div>',t+='<div class="zp_mark"><span>'+ZPI18N.getString("zp.lms.courseoverview.test")+"</span></div></div>",t+='<div class="zp_pcnt" id="assContent">',t+="</div>",t+="</div></div></div>",$("body").addClass("zp_Pshw"),$(".main-wrp").append(t);var s={method:"fetchTestComments",testId:e,conreqcsr:csrfToken};lmstest.testId=e,$("#assContent").html("");t="<div class='zp_Pdesc'><div><h3 id='nocmt'><center>"+ZPI18N.getString("zp.lms.assignment.startdis")+"</center></h3>";t+='<ul class="zp_Dmsg" id="commentsList">',t+="</ul></div></div>",$("#assContent").append(t),$.post("/testAction.zp",s,(function(e){if(null!=e&&0!=e[1].length){document.getElementById("nocmt").style.display="none",resultdata=e[1];for(var t=0;t<resultdata.length;t++){var s=lmsmessages.getCommentCard(resultdata[t]);document.getElementById("commentsList").appendChild(s)}}else document.getElementById("nocmt").style.display="block";var r="",l={subBtnName:"zp.submit",divId:"zp_lmstestcomments",subBtnId:"submitbtn",parentCon:"editor_container"};r+=ZPFeeds.Editor.getEditorContainer(l),$("#assContent").append(r),lmstest.editor=ZPFeeds.Editor.getEditor("zp_lmstestcomments","Training","",l),lmsbase.addListener(document.getElementById("submitbtn"),"click",lmstest.submitDiscussion,!1)}))},submitDiscussion:function(){var e=ZPFeeds.getSmileysAndMentions(lmstest.editor.getContent(),ZPeople.isSearchAllowed);e=ZPFeeds.removeTrailingEmptyDivs(e);var t=ZPFeeds.getTextContent(e);if(0!==(t=t.trim()).length||0!==$("<div>").append(e).find("img").length){var s={method:"updateTestComment",testId:lmstest.testId,comment:e,conreqcsr:csrfToken};$.post("/testAction.zp",s,(function(e){if(null!=e[1]){lmstest.editor.setContent("");var t=ZPeople.getUserDetailsById(erecno),s=[];s.name=t.name,s.photoPath=t.zpeoplePhoto,e[1].userInfo=s;var r=lmsmessages.getCommentCard(e[1]);document.getElementById("commentsList").appendChild(r),lmstest.testInfo.discussionComments.push(e[1])}}))}else lmsmessages.editor.setContent("")},closePopup:function(e){try{if(lmsbase.removeListener(document.getElementById("submitbtn"),"click",lmstest.submitDiscussion,!1),e){ZE_Init.needEditorFocus=!0;var t=$("#commentsList").find("li").length;0!=t&&($("#comments_"+e)[0].innerHTML=t,$("#comments_"+e).closest("em").css("visibility","visible"))}lmsbase.removeQHash()}catch(e){$("body").removeClass("zp_Pshw"),$(".zp_markatndvw").remove(),lmsbase.removeQHash()}lmstest.testId=null,lmsmessages.editor=""},showOnlineTestResults:function(e,t){let s;lmscourses.currentBatchId&&""!=lmscourses.currentBatchId.trim()&&"null"!=lmscourses.currentBatchId&&"0"!=lmscourses.currentBatchId&&(s=lmscourses.currentBatchId),lmstest.getOnlineTestResults(e.testId,1,s,1,"",(function(s){t&&t(),s.status?lmsLearnersTestMarkUpdatedView.initiate(e,s,"onlineTest"):ZPeople.Message.showFailureMsg(s.message)}))},showOfflineTestResults:function(e,t){lmstest.getOfflineTestResults(e.testId,1,1,"",(function(s){t&&t(),s.status?lmsLearnersTestMarkUpdatedView.initiate(e,s,"offlineTest"):ZPeople.Message.showFailureMsg(s.message)}))},getFormComponents:zplms.createSimpleCache((function(e,t,s){var r={method:"getFormComponents",courseId:e};r[csrfParamName]=csrfToken,$.post("/testAction.zp",r,t)}),zplms.formCacheCriteria),getOnlineTestRecordDetails:function(e,t,s){var r={method:"fetchOnlineTestRecord",testId:e};r[csrfParamName]=csrfToken,$.post("/testAction.zp",r,t)},getOfflineTestRecordDetails:function(e,t,s){var r={method:"fetchOfflineTestRecord",testId:e};r[csrfParamName]=csrfToken,$.post("/testAction.zp",r,t)},deleteOnlineTest:function(e,t,s){lmstest._deleteOnlineTest(e,(function(e){4e3==e.code?ZPeople.Message.showFailureMsg(e.message):t(e,s)}))},_deleteOnlineTest:function(e,t,s){var r={method:"deleteOnlineTest",testId:e};r[csrfParamName]=csrfToken,$.post("/testAction.zp",r,t)},doesCurrentUserHavePermissionToAttemptTest:function(){return lmscoursedetails.currentCourseData[0].isUserJoined},showLastAttemptResult:function(e,t,s){s?ZPAssessAPI.showResult(t,s,portalName):lmstest.getLastAttemptIdOfUser(e,(function(e){e.status&&ZPAssessAPI.showResult(t,e.attemptId,portalName)}))},showLastAttemptReview:function(e,t,s){t?ZPAssessAPI.openAttemptReview(e,t,s,portalName):lmstest.getLastAttemptIdOfUser(testId,(function(r){r.status&&ZPAssessAPI.openAttemptReview(e,t,s,portalName)}))},getLastAttemptIdOfUser:function(e,t){var s={method:"getLastAttemptIdOfUser",testId:e};s[csrfParamName]=csrfToken,$.post("/testAction.zp",s,t)},canUserEditOrDeleteOnlineTest:function(e,t){var s={method:"canUserEditOrDeleteOnlineTest",testId:e};s[csrfParamName]=csrfToken,$.post("/testAction.zp",s,t)},canUserEditOnlineTest:function(e,t){var s={method:"canUserEditOnlineTest",testId:e};s[csrfParamName]=csrfToken,$.post("/testAction.zp",s,t)},getOnlineTestResults:function(e,t,s,r,l,a,n){var i={method:"getOnlineTestResults",testId:e,sort:r,batchId:s,searchTxt:l,startIndex:t,filterObj:JSON.stringify(n)};i[csrfParamName]=csrfToken,$.post("/testAction.zp",i,a)},getOfflineTestResults:function(e,t,s,r,l,a){var n={method:"getOfflineTestResults",testId:e,sort:s,searchTxt:r,startIndex:t,filterObj:JSON.stringify(a)};n[csrfParamName]=csrfToken,$.post("/testAction.zp",n,l)},updateUserObtainedMark:function(e,t,s,r){var l={method:"updateUserObtainedMark",testId:e,user:s,mark:t};l[csrfParamName]=csrfToken,$.post("/testAction.zp",l,r)},getPreCourseAssessmentSettings:function(e,t){var s={method:"getPreCourseAssessmentSettings",courseId:e};s[csrfParamName]=csrfToken,$.post("/testAction.zp",s,(function(e){t(e)})).fail((function(e){"You dont have permission"==JSON.parse(e.responseText).message&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.assessment.error.nopermission"))}))},getPostCourseAssessmentSettings:function(e,t){var s={method:"getPostCourseAssessmentSettings",courseId:e};s[csrfParamName]=csrfToken,$.post("/testAction.zp",s,(function(e){t(e)})).fail((function(e){"You dont have permission"==JSON.parse(e.responseText).message&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.assessment.error.nopermission"))}))},updatePreAssessmentSettings:function(e,t,s){var r={method:"updatePreCourseAssessmentSettings",courseId:e};for(var l in t)r[l]=t[l];r[csrfParamName]=csrfToken,$.post("/testAction.zp",r,(function(e){s(e)})).fail((function(e){"You dont have permission"==JSON.parse(e.responseText).message&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.assessment.error.nopermission"))}))},updatePostAssessmentSettings:function(e,t,s){var r={method:"updatePostCourseAssessmentSettings",courseId:e};for(var l in t)r[l]=t[l];r[csrfParamName]=csrfToken,$.post("/testAction.zp",r,(function(e){s(e)})).fail((function(e){"You dont have permission"==JSON.parse(e.responseText).message&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.assessment.error.nopermission"))}))},takeTest:function(e){ZPAssessAPI.startAssessment(e,!1)},skipTest:function(e){lmstest._skipTest(e,(function(t){t.status?(ZPeople.Message.showSuccessMsg(t.message),lmstest.dispatchEvent({type:lmstest.EVENT_TYPE.TEST_SKIPPED,testInfo:{testId:e,status:ZPI18N.getString("zp.skiped"),canUserSkipTest:!1,hasUserSkippedTheTest:!0}})):ZPeople.Message.showFailureMsg(t.message)}))},_skipTest:function(e,t){var s={method:"skipTest",testId:e};s[csrfParamName]=csrfToken,$.post("/testAction.zp",s,t)},editAttemptForLearner:function(e,t,s,r,l){let a={method:"editAttempts"};a.testId=e,a.assessmentId=t,a.courseId=lmscourses.currentCourseId,a.batchId=lmscourses.currentBatchId&&lmscourses.currentBatchId>0?lmscourses.currentBatchId:void 0,a.attempts_increased=r,a.user=s,a.conreqcsr=csrfToken,$.post("/testAction.zp",a,l)},getAssessmentDetail:function(e,t){},makeEntitiesAsIncomplete:function(e){$.each(e,(function(e,t){let s,r=parseInt(t.lockedEntityType);if(s=1===r?lmsmodule.fileInfo[t.lockedEntityId]:2===r?lmsmodule.editableContentInfo[t.lockedEntityId]:lmsmodule.embedLinkInfo[t.lockedEntityId],s.isCompleted=!1,ModuleEntity.onUpdated(s),document.querySelector('div[rel="content"][_rel="'+t.lockedEntityId+'"] .zp_Lrgt .IC-tckfil')){let e="",s="1"==t.lockedEntityType?"files":"2"==t.lockedEntityType?"editableContent":"embedLink",r="1"==t.lockedEntityType?lmsfiles.getCompletionPercentage(t.lockedEntityId,lmsmodule.fileInfo[t.lockedEntityId].metaInfo.fileType,lmsmodule.fileInfo[t.lockedEntityId].progressData):0,l=document.querySelector('div[rel="content"][_rel="'+t.lockedEntityId+'"] .zp_Lrgt .IC-tckfil'),a=l.hasAttribute("_cmore")?l.getAttribute("_cmore"):"";if(""==a&&(a=lmsEntityView.entityMappingObject[lmsEntityView.entityTypeObject["editableContent"==s?"content":s]].completeiconrel),e=lmsmodule.constructProgressIcon(!1,r,t.lockedEntityId,s,a,"IC-tck1",!1),l.outerHTML=e,1==lmsEntityView.entityPreview&&(l=$('[_vrel="moduleView"]').find('[_crel="'+t.lockedEntityId+'"]')[0],e=lmsmodule.constructProgressIcon(!1,r,t.lockedEntityId,s,a,"IC-tck1",!0),l.outerHTML=e,$('[_vrel="moduleView"]').find('[_crel="'+t.lockedEntityId+'"]')[0].parentElement.hasAttribute("mId")&&lmsEntityView.updateModuleProgress($('[_vrel="moduleView"]').find('[_crel="'+t.lockedEntityId+'"]')[0].parentElement.getAttribute("mId"),0)),"1"==t.lockedEntityType?lmsmodule.fileInfo[t.lockedEntityId].canMarkAsComplete="2":"2"==t.lockedEntityType?lmsmodule.editableContentInfo[t.lockedEntityId].canMarkAsComplete="2":lmsmodule.embedLinkInfo[t.lockedEntityId].canMarkAsComplete="2",document.querySelector('div[rel="content"][_rel="'+t.lockedEntityId+'"]').classList.contains("zp_mand")){let e=document.querySelector('div[rel="content"][_rel="'+t.lockedEntityId+'"]');e.parentElement.previousElementSibling.querySelector(".IC-tckfil")&&(e.parentElement.previousElementSibling.querySelector(".IC-tckfil").setAttribute("class","IC-tck1"),1==lmsEntityView.entityPreview&&$('[_vrel="moduleView"]').find('[rel="content"][_rel="'+t.lockedEntityId+'"]').parent()[0].previousElementSibling.querySelector(".IC-tckfil").setAttribute("class","IC-tck1"))}else{let e=document.querySelector('div[rel="content"][_rel="'+t.lockedEntityId+'"]').parentElement;if(e){let s=0;for(;s<e.childNodes.length;s++){if(e.childNodes[s].querySelector(".IC-tckfil"))break}s===e.childNodes.length&&e.previousElementSibling.querySelector(".IC-tckfil")&&(e.previousElementSibling.querySelector(".IC-tckfil").setAttribute("class","IC-tck1"),1==lmsEntityView.entityPreview&&(e=$('[_vrel="moduleView"]').find('[rel="content][_rel="'+t.lockedEntityId+'"]').parent()[0],e.previousElementSibling.querySelector(".IC-tckfil").setAttribute("class","IC-tck1")))}}lmscardConstruct.lockUpdateForLearner(t.lockedEntityId,1,1)}}))},updateAssessment:function(e){lmsOnlineTestForm&&lmsOnlineTestForm.HOOKS.updateAssessmentCard(e,e.assessment_id)},canUserTakeAttempt(e){if(e.isLocked||e.module&&e.module.isLocked)return!1;switch(e.tag){case lmstest.type.PRE_COURSE:return 0===e.numberOfAttemptsTaken&&lmscoursedetails.currentCourseData[0].courseCompleteState;case lmstest.type.IN_MODULE:return lmstest.canUserTakeAttemptBasedOnAttemptType(e);case lmstest.type.POST_COURSE:return(lmscoursedetails.currentCourseData[0].courseCompleteState||100===lmscoursedetails.currentCourseData[0].moduleCompletePercentage)&&lmstest.canUserTakeAttemptBasedOnAttemptType(e);default:return!1}},canUserTakeAttemptBasedOnAttemptType(e){switch(e.attemptsAllowedType){case 0:return-1===e.maximumAttemptsAllowed||e.maximumAttemptsAllowed>e.numberOfAttemptsTaken;case 1:return!e.isCompleted;case 2:return!lmscoursedetails.currentCourseData[0].courseCompleteState}return!1},updateCompletedLearnersCount(e,t){let s=lmsmodule.offlineTestInfo[e]?lmsmodule.offlineTestInfo[e]:lmsmodule.onlineTestInfo[e];s&&(s.completedLearnersCount=t,ModuleEntity.onUpdated(s))}};zplms.setupEventManager(lmstest);let lmsSelectAssessPopup={initiate:function(e){this.popup=lmsbase.showMaskLayer(),this.popup.innerHTML="";let t=document.createElement("div");t.setAttribute("class","zp_popup fulhgt pad30"),t.style.width="700px",t.innerHTML='<div class="zp_Pohd"><font>Select Assessment</font><span>Find Assessment based on your requirement</span><i class="IC-cls"></i></div><div id="" class="zp_Sm"><div><i class="IC-srch"></i><input required="" id="" placeholder="Search assessment" type="text"></div></div>';let s=document.createElement("div");s.setAttribute("class","zp_Pocnt"),s.style.maxHeight="600px",s.appendChild(document.createElement("div").appendChild(this.listOfAssess(e))),t.appendChild(s),lmsbase.addListener(t.querySelector(".IC-cls"),"click",lmsSelectAssessPopup.close),this.popup.appendChild(t)},listOfAssess:function(e){let t=document.createElement("div");return t.setAttribute("class","zp_Pndlst"),t.appendChild(this.constructUlElem(e)),t},constructUlElem:function(e){let t=document.createElement("ul");return $.each(e,(function(e,s){let r=document.createElement("li");r.innerHTML="<div><div><b>"+s.name+"</b><p><span>Question:<b>"+s.question_count+'</b></span><span class="zp_ldot">Max Score: <b>'+(s.score||0)+'</b></span><span class="zp_ldot">Duration: <b>'+s.duration+'</b></span><span class="zp_ldot">Version: <b>'+s.version+'</b></span></p></div></div><div><div class="zp_btn"><button class="">Select</button></div></div>',lmsbase.addListener(r.querySelector(".zp_btn"),"click",lmsSelectAssessPopup.onSelectAssessment),t.appendChild(r)})),t},onSelectAssessment:function(e){},close:function(){lmsSelectAssessPopup.popup.innerHTML="",lmsbase.hideMaskLayer()}};!function(e){function t(e,t,s,r){this.courseId=e,this.type=t,this.container=s,this.state=0,this.close_callback=r}function s(e,t,s){this.proto.constructor.call(this,e,lmstest.type.PRE_COURSE,t,s)}function r(e,t,s){this.proto.constructor.call(this,e,lmstest.type.POST_COURSE,t,s)}function l(e){return{start:function(){e.construct()},alertAndClose:function(){e.alertAndClose()},forceClose:function(){e.close()}}}t.prototype.construct=function(){this.preRequestConstruction(),this.fetchDataAndPostRequestConstruct()},t.prototype.preRequestConstruction=function(){var e=document.createElement("header");e.innerHTML="<h2>"+this.getHeader()+"</h2>",this.container.appendChild(e),zplms.addLoadingBar(this.container)},t.prototype.getHeader=function(e){throw"Unsupported operation exception"},t.prototype.fetchDataAndPostRequestConstruct=function(){var e=this;this.state=1,this.sendRequestTofetchSettingsData((function(t){e.fetchDataCallback(t)}))},t.prototype.sendRequestTofetchSettingsData=function(e){throw"Unsupported operation exception"},t.prototype.fetchDataCallback=function(e){e.status?this.fetchDataSuccessCallback(e.settings):this.fetchDataFailureCallback(e)},t.prototype.fetchDataSuccessCallback=function(e){this.postRequestSuccessConstruction(e),this.settingsData=e,this.setupRecordDataInUI(),this.state=2},t.prototype.fetchDataFailureCallback=function(e){this.state=3},t.prototype.postRequestSuccessConstruction=function(e){zplms.removeLoadingBar(this.container);var t=document.createElement("div");t.className="zp_Tcnt",lmsform.initiate(0,!1,t),t.innerHTML=this.convertSettingsDataAsHTML(e);var s=t.querySelector("[subContentContainer]"),r=t.querySelector("[statusContainer]");r.removeAttribute("status"),lmstest.statusswtichbutton=lms_ui_switch.createSwitch(),lmstest.statusswtichbutton.setCallback((function(e){e?lmsbase.removeClass(s,"disabled"):lmsbase.addClass(s,"disabled")})),e.status?lmstest.statusswtichbutton.toggleOn():(lmstest.statusswtichbutton.toggleOff(),lmsbase.addClass(s,"disabled")),r.insertBefore(lmstest.statusswtichbutton.toNode(),r.firstChild),this.statusSwitch=lmstest.statusswtichbutton;var l=document.createElement("div");l.className="zp_btn";var a=l.appendChild(document.createElement("button"));a.className="zpthm",a.textContent=ZPI18N.getString("zp.save"),this.saveButtonNode=a;var n=t.querySelector('[action="addTest"]');n.removeAttribute("action"),e.testInfo&&(n.style.display="none",n.parentNode.insertBefore(this.convertTestInfoAsElement(e.testInfo),n)),this.addTestButtonNode=n,this.container.appendChild(t),this.container.appendChild(l),lmsformcomponents.bind();var i=this;if(lmsbase.addListener(a,"click",(function(){i.validateAndSave()})),lmsbase.addListener(n,"click",(function(){i.addTest()})),e.isGradingEnabled){var o=t.querySelector("li [name='isMandatory']"),c=o.parentNode;function d(){i.valueBeforeDefaultValuePopulationOfMandatoryField=lmsbase.hasClass(o,"zp_gclr"),lmsbase.addClass(c,"disabled"),lmsbase.addClass(o,"zp_gclr")}var m=t.querySelector("[gradeCategoryMenu]");m.removeAttribute("gradeCategoryMenu");var u={};e.gradeCategoryDetails&&(u[e.gradeCategoryDetails.categoryId]=[e.gradeCategoryDetails.categoryName],d()),lmsform.Obj.insertMenu(lmscoursegrade.createGradeCategoryMenu(this.courseId,m,u,(function(){0!=this.getSelectedValue()?d():(i.valueBeforeDefaultValuePopulationOfMandatoryField?lmsbase.addClass(o,"zp_gclr"):lmsbase.removeClass(o,"zp_gclr"),lmsbase.removeClass(c,"disabled")),i.currentSelectedGradeCategoryDetails=this.getSelectedData()})))}this.form=$.extend({},lmsform)},t.prototype.convertSettingsDataAsHTML=function(e){throw"Unsupported operation exception"},t.prototype.clickHandler=function(e){var t=e.target.closest("[action]");if(t)if("deleteTest"==t.getAttribute("action")){var s=(r=t.closest("[testId]")).testInfo;this.deleteTest(s,r)}else{var r;if(r=t.closest("[testId]")){s=r.testInfo;this.openTest(s)}}},t.prototype.convertTestInfoAsElement=function(e){var t=document.createElement("div");if(t.className="zp_Tatch",t.setAttribute("testId",e.testId),t.setAttribute("rel","testElement"),e.canUserPreview||e.canUserDelete||e.canUserEdit){var s=document.createElement("div");s.className="zp_Ticn",s.innerHTML='<i class="IC-more"></i>',t.appendChild(s);var r=this;lmsbase.addListener(s,"click",(function(l){l.skipAction=!0;var a=[];e.canUserPreview&&e.assessmentId&&a.push({preview:[ZPI18N.getString("zp.preview")]}),e.canUserEdit&&a.push({edit:[ZPI18N.getString("zp.lms.courseoverview.edit")]}),e.canUserDelete&&a.push({delete:[ZPI18N.getString("zp.lms.delete")]}),a.length<=0?s.parentNode&&s.parentNode.removeChild(s):lmsmenu.initiate({elem:l.target,width:"130px",type:"dropdown",arrowHead:!0,menulist:a,eve:l}).on("click",(function(){"delete"==this.value?r.deleteTest(e,t):"edit"==this.value?r.editTest(e,t):"preview"==this.value&&r.previewTest(e)})).bind()}))}var l=document.createElement("font");l.innerHTML='<i class="IC-OT"></i>',t.appendChild(l);var a=l.appendChild(document.createElement("div")),n=document.createElement("h4");if(n.innerHTML=e.name,a.appendChild(n),e.duration){var i=document.createElement("p");i.innerHTML=ZPI18N.getString("zp.duration")+" : <b>"+e.duration+"</b>",a.appendChild(i)}return t},t.prototype.setupRecordDataInUI=function(){this.currentSelectedGradeCategoryDetails=this.settingsData.gradeCategoryDetails||null,this.currentTestInfo=this.settingsData.testInfo||null,this.lastSavedRecordData=this.getCurrentRecordDataInUI()},t.prototype.getCurrentRecordDataInUI=function(){var e=lmsform;try{(lmsform=this.form).params={};var t=lmsform.formvalidate("",0,1);return t.gradeCategoryId=this.currentSelectedGradeCategoryDetails?this.currentSelectedGradeCategoryDetails.categoryId:null,t.testId=this.currentTestInfo?this.currentTestInfo.testId:null,t.status=this.statusSwitch.value()?1:0,lmsform.params={},t}finally{lmsform=e}},t.prototype.validateAndSave=function(){var e=this;this.validate((function(){e.saveCurrentDataInUI()}))},t.prototype.saveCurrentDataInUI=function(){this.save(this.getCurrentRecordDataInUI())},t.prototype.save=function(e){delete e.testId,lmsbase.addClass(this.saveButtonNode,"disabled");var t=this;this.sendRequestToSaveSettings(e,(function(s){lmsbase.removeClass(t.saveButtonNode,"disabled"),s.status?t.saveSuccessCallback(e,s):t.saveFailureCallback(s)}))},t.prototype.validate=function(e){var t=this,s=lmsform;try{(lmsform=this.form).submitCallback=function(s){t.doAdditionalValidation(s)&&e()},lmsform.validationFailureCallback=function(e){t.doAdditionalValidation(e)},lmsform.formvalidate()}finally{lmsform=s}},t.prototype.doAdditionalValidation=function(e){throw"Unsupported operation exception"},t.prototype.sendRequestToSaveSettings=function(e,t){throw"Unsupported operation exception"},t.prototype.saveSuccessCallback=function(e,t){this.updateLastSavedRecordData(e),ZPeople.Message.showSuccessMsg(t.message)},t.prototype.saveFailureCallback=function(e){ZPeople.Message.showFailureMsg(e.message)},t.prototype.updateLastSavedRecordData=function(e){for(var t in e)this.lastSavedRecordData[t]=e[t]},t.prototype.deleteTest=function(e,t){var s=this;lmsnotify.show({header:ZPI18N.getString("zp.lms.entitydelete",[ZPI18N.getString("zp.lms.courseoverview.test")]),body:ZPI18N.getString("zp.lms.permenentlydelEntity",[ZPI18N.getString("zp.lms.courseoverview.test")]),button_text:ZPI18N.getString("zp.lms.delete"),texttype:"negative",successCallback:function(){this.status&&lmstest._deleteOnlineTest(e.testId,(function(r){7e3==r.code?(s.onTestDeletedSuccess(e,t,r),lmstest.statusswtichbutton.toggleOff(),$(".zp_Tscnt").addClass("disabled")):s.onTestDeletedFailure(r)}))},cancelCallback:function(){}})},t.prototype.onTestDeletedSuccess=function(e,t,s){this.currentTestInfo=null,this.updateLastSavedRecordData({testId:null}),t.parentNode.removeChild(t),this.addTestButtonNode.style.display="",ZPeople.Message.showSuccessMsg(s.message)},t.prototype.onTestDeletedFailure=function(e){ZPeople.Message.showFailureMsg(e.message)},t.prototype.openTest=function(e,t){e.canUserEdit?this.editTest(e,t):this.previewTest(e)},t.prototype.previewTest=function(e){ZPAssessAPI.previewAssessment(e.assessmentId,!0)},t.prototype.addTest=function(){this.type==lmstest.type.PRE_COURSE&&lmsOnlineTestForm.CREATE.addPreLearning(this.courseId,this.closeCallBack.bind(this)),this.type==lmstest.type.POST_COURSE&&lmsOnlineTestForm.CREATE.addPostLearning(this.courseId,this.closeCallBack.bind(this))},t.prototype.closeCallBack=function(e,t){if(!t)return!0;let s=e.tabs.getTabInstances()[ZPI18N.getString("zp.lms.mark.Assesment")],r=lmsOnlineTestForm.HOOKS.getTestData(e,s);this.currentTestInfo=this.convertRecordDataAsTestInfo(r);let l=document.querySelector("[rel='testElement']");return l?l.parentNode.replaceChild(this.convertTestInfoAsElement(this.currentTestInfo),l):(this.updateLastSavedRecordData({testId:this.currentTestInfo.testId}),this.addTestButtonNode.style.display="none",this.addTestButtonNode.parentNode.insertBefore(this.convertTestInfoAsElement(this.currentTestInfo),this.addTestButtonNode.nextSibling)),!0},t.prototype.editTest=function(e,t){this.type==lmstest.type.PRE_COURSE&&lmsOnlineTestForm.CREATE.editPreLearning(e.testId,this.courseId,this.closeCallBack.bind(this)),this.type==lmstest.type.POST_COURSE&&lmsOnlineTestForm.CREATE.editPostLearning(e.testId,this.courseId,this.closeCallBack.bind(this))},t.prototype.convertRecordDataAsTestInfo=function(e){var t={name:e.testName,testId:e.testId,assessmentId:e.assessmentId,duration:0==e.durationType&&e.durationValue?e.durationValue+" "+ZPI18N.getString("zp.lms.mins"):null};return this.currentTestInfo?(t.canUserPreview=this.currentTestInfo.canUserPreview,t.canUserEdit=this.currentTestInfo.canUserEdit,t.canUserDelete=this.currentTestInfo.canUserDelete):(t.canUserPreview=!!t.assessmentId,t.canUserEdit=t.canUserDelete=!0),t},t.prototype.hasAnyUnsavedChanges=function(){return 2==this.state&&!zplms.isObjectsSame(this.lastSavedRecordData,this.getCurrentRecordDataInUI())},t.prototype.alertAndClose=function(){this.hasAnyUnsavedChanges()&&this.alert(),this.close()},t.prototype.alert=function(){var e=this;lmsnotify.show({header:ZPI18N.getString("zp.lms.confirmChanges"),body:ZPI18N.getString("zp.lms.course.coursesettingsupdate"),button_text:ZPI18N.getString("zp.lms.saveCourse"),texttype:"negative",successCallback:function(){e.saveAllValidData()}})},t.prototype.saveAllValidData=function(){throw"Unsupported operation exception"},t.prototype.close=function(){this.container.innerHTML="";var e=this.close_callback;e&&e()},s.prototype=new t,s.prototype.constructor=s,s.prototype.proto=new t,s.prototype.sendRequestTofetchSettingsData=function(e){lmstest.getPreCourseAssessmentSettings(this.courseId,e)},s.prototype.getHeader=function(e){return ZPI18N.getString("zp.lms.preCourseRequirements.tabName")},s.prototype.convertSettingsDataAsHTML=function(e){var t='<div class="zp_Sm zp_nbr"><div><ul><li statusContainer><h4>'+ZPI18N.getString("zp.lms.test.EnableTest")+"</h4><em>"+ZPI18N.getString("zp.lms.test.preTest.description")+'</em></li></ul></div></div><div class="zp_Tscnt" subContentContainer><div class="zp_Tcvr"><div>';return e.isGradingEnabled&&(t+='<div class="zp_grdscl">'+lmsformcomponents.labelName({displayName:"zp.lms.gradebook.gradeCategory"},"h4")+"<p>"+ZPI18N.getString("zp.lms.test.formComponent.gradeCategory.courseActivities.displayMessage")+'</p><div class="zp_Sm zp_c3" gradeCategoryMenu></div></div>'),t+='<div class="zp_Lbtn" action="addTest"><div><span>'+ZPI18N.getString("zp.lms.modules.addtest")+'</span><i class="IC-plus"></i></div></div>',t+='<div class="zp_Sm zp_lp zp_nbr"><div><ul>'+lmsform.insertField({fieldType:lmsform.fieldtype.CHECKBOX,labelName:"isMandatory",displayName:ZPI18N.getString("zp.lms.mandatory"),autofillvalue:e.isMandatory?"true":"false"},"","","horizontal")+"</ul></div></div></div></div></div>"},s.prototype.validate=function(e){return e()},s.prototype.saveAllValidData=function(){this.saveCurrentDataInUI()},s.prototype.sendRequestToSaveSettings=function(e,t){lmstest.updatePreAssessmentSettings(this.courseId,e,t)},r.prototype=new t,r.prototype.constructor=s,r.prototype.proto=new t,r.prototype.sendRequestTofetchSettingsData=function(e){lmstest.getPostCourseAssessmentSettings(this.courseId,e)},r.prototype.getHeader=function(e){return ZPI18N.getString("zp.lms.postCourseRequirements.tabName")},r.prototype.postRequestSuccessConstruction=function(e){this.proto.postRequestSuccessConstruction.call(this,e)},r.prototype.convertSettingsDataAsHTML=function(e){var t='<div class="zp_Sm zp_nbr"><div><ul><li statusContainer><h4>'+ZPI18N.getString("zp.lms.test.EnableTest")+'</h4></li></ul></div></div><div class="zp_Tscnt" subContentContainer><div class="zp_Tcvr"><div>';return e.isGradingEnabled&&(t+='<div class="zp_grdscl">'+lmsformcomponents.labelName({displayName:"zp.lms.gradebook.gradeCategory"},"h4")+"<p>"+ZPI18N.getString("zp.lms.test.formComponent.gradeCategory.courseActivities.displayMessage")+'</p><div class="zp_Sm zp_c3" gradeCategoryMenu></div></div>'),t+='<div class="zp_Lbtn" action="addTest"><div><span>'+ZPI18N.getString("zp.lms.modules.addtest")+'</span><i class="IC-plus"></i></div></div>',t+='<div class="zp_Sm zp_lp zp_nbr"><div><ul>'+lmsform.insertField({fieldType:lmsform.fieldtype.CHECKBOX,labelName:"isMandatory",displayName:ZPI18N.getString("zp.lms.mandatory"),autofillvalue:e.isMandatory?"true":"false"},"","","horizontal")+"</ul></div></div></div></div></div>"},r.prototype.getWhenToInitiateField=function(e,t,s){var r={};r.fieldType=lmsform.fieldtype.NUMBER,r.autofillvalue=t||"",r.displayName="",r.labelName="openTimeDelay",r.no_autofocus=!0;var l={formComponentId:"timeUnitFormComponent"};l.fieldType=lmsform.fieldtype.LOOKUP,l.displayType=lmsform.fieldtype.SELECT_DISPLYTYPE,l.Options=[ZPI18N.getString("zp.cday"),ZPI18N.getString("zp.week"),ZPI18N.getString("zp.month")],l.OptionsAsLMSMenuFormatArray=[[ZPI18N.getString("zp.cday")],[ZPI18N.getString("zp.week")],[ZPI18N.getString("zp.month")]],l.OptionsWithId=[{Value:ZPI18N.getString("zp.cday"),Id:"0"},{Value:ZPI18N.getString("zp.week"),Id:"1"},{Value:ZPI18N.getString("zp.month"),Id:"2"}],l.autofillvalue=0==s?ZPI18N.getString("zp.cday"):1==s?ZPI18N.getString("zp.week"):ZPI18N.getString("zp.month"),l.displayName="",l.labelName="openTimeDelayUnit";var a=ZPI18N.getString("zp.lms.test.postTest.formComponent.whenToInitiate.options.deferredAfterCompletion.displayName").split("{0}"),n='<div whenToInitiateContainer class="zp_Sm zp_nobr zp_lp">';return n+="<label>"+ZPI18N.getString("zp.lms.test.postTest.formComponent.whenToInitiate.displayName")+"</label>",n+="<div>",n+="<ul>",n+="<li>"+lmsformcomponents.getSimpleRadioButtonField({fieldType:lmsform.fieldtype.RADIO_OPTION,labelName:"openTimeType",displayName:ZPI18N.getString("zp.lms.test.postTest.formComponent.whenToInitiate.options.immediatelyAfterCompletion.displayName"),autofillvalue:0==e,value:0})+"</li>",n+="<li>",n+=lmsformcomponents.getSimpleRadioButtonField({fieldType:lmsform.fieldtype.RADIO_OPTION,labelName:"openTimeType",autofillvalue:1==e,value:1}),n+="<span>"+a[0]+"</span>",n+='<div class="zp_Smsub Smmax"><div class="zp_Sm" openTimeDelayContainer>'+lmsform.insertField(r,"","",0,void 0)+"</div></div>",n+='<div class="zp_Smsub Smmax90">'+lmsform.insertField(l,"","",1,void 0,"","zp_Sm",!0)+"</div>",n+="<span>"+a[1]+"</span>",n+="</li>",n+="</ul>",n+="</div>",n+="</div>",lmsform.selectMenuArray[l.formComponentId]=l.OptionsAsLMSMenuFormatArray,n},r.prototype.doAdditionalValidation=function(e){return!("1"==e.openTimeType&&!e.openTimeDelay)||(lmsform.removeErrorText(this.whenToInitiateContainer),lmsform.setErrorClass(this.openTimeDelayContainerNode),lmsform.setErrorText(this.whenToInitiateContainer,ZPI18N.getString("zp.duration")+" "+ZPI18N.getString("zp.lms.cannotbeEmpty")),!1)},r.prototype.getCurrentRecordDataInUI=function(){var e=this.proto.getCurrentRecordDataInUI.call(this);return e.openTimeDelayUnit=e.openTimeDelayUnit||0,e},r.prototype.saveAllValidData=function(){var e=this.getCurrentRecordDataInUI();"1"!=e.openTimeType||e.openTimeDelay||(delete e.openTimeType,delete e.openTimeDelay,delete e.openTimeDelayUnit),this.save(e)},r.prototype.sendRequestToSaveSettings=function(e,t){lmstest.updatePostAssessmentSettings(this.courseId,e,t)},e.createCoursePreAssessmentSettingsView=function(e,t,r){return new l(new s(e,t,r))},e.createCoursePostAssessmentSettingsView=function(e,t,s){return new l(new r(e,t,s))}}(lmstest);const lmsLearnersTestMarkUpdatedView={initiate:function(e,t,s,r){this.learnersDataObj={},this.assessmentId=0,this.startIndex=1,this.sortType=1,this.learnersAttemptObj={},this.learnerDetails=r,this.testData=e,this.moduleName=s,this.totalLearners=lmscoursedetails.totalLearnersCount,this.testId=e.testId,this.passPercentage=e.passPercentage&&parseInt(e.passPercentage),this.notifyMenuList=[{msg:[ZPI18N.getString("zp.lms.notification.MESSAGE_MEMBERS_NOTIFICATION_KEY.displayName")]}],this.assessmentId=e.assessmentId,this.maxAttempt=e.maximumAttemptsAllowed?parseInt(e.maximumAttemptsAllowed):-1,this.completedLearnersCount=t&&t.completedLearnersCount,this.constructMarkUpdatedCard(e,t?t.results:void 0,s,r)},constructMarkUpdatedCard:function(e,t,s,r){this.moduleName&&this.moduleName.toLowerCase().replaceAll(" ","").indexOf("onlinetest")>-1?(this.type=1,s=ZPI18N.getString("zp.lms.test.onlineTest")):this.moduleName&&this.moduleName.toLowerCase().replaceAll(" ","").indexOf("offlinetest")>-1&&(this.type=2,s=ZPI18N.getString("zp.lms.test.offlineTest"));let l=this.getEntityDetails(e,!!r,e.tag===lmstest.type.IN_MODULE),a=this.constructFilterObjArr();a.length&&(e.type===lmstest.type.PRE_COURSE?(r||(this.notifyMenuList=[],a[0].status.skipped=ZPI18N.getString("zp.skiped")),s=ZPI18N.getString("zp.lms.preCourseRequirements.tabName")):e.type===lmstest.type.POST_COURSE?(r||(this.notifyMenuList=[],a[0].status.skipped=ZPI18N.getString("zp.skiped")),s=ZPI18N.getString("zp.lms.postCourseRequirements.tabName")):this.passPercentage&&this.passPercentage>0&&(r||(a[0].status.pass=ZPI18N.getString("zp.lms.gradeBook.pass"),a[0].status.fail=ZPI18N.getString("zp.lms.gradeBook.fail")))),lmsLearnersTestMarkUpdatedView.outerCardNpwrap=lmsnewupdatecard.constructMarkUpdatedCardOuter(s,e.testId,e.testName,l,e.gradeCategoryDetails||e.gradeCategoryName,lmsLearnersTestMarkUpdatedView.searchLearner,this.notifyMenuList,this.notifyCallback,a,this.filteredCallback,this.closeCallback,r),lmsLearnersTestMarkUpdatedView.outerCardNpwrap.appendChild(this.constructInnerView(t))},constructInnerView:function(e){const t=document.createElement("div");t.setAttribute("class","zp_ncnt");const s=document.createElement("div");s.setAttribute("class","zp_nsplt");const r=document.createElement("div");r.setAttribute("class","zp_nlft");const l=document.createElement("div");let a=this.constructOuterBox(e);return l.appendChild(a),r.appendChild(l),s.appendChild(r),t.appendChild(s),t},constructOuterBox:function(e){let t=document.createElement("div");return t.setAttribute("class","zp_lstlrnr"),e&&(lmscoursedetails.isCourseTrainer||lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0]))?(t.appendChild(this.constructInnerHead(this.type)),t.appendChild(this.constructLearnerDetails(e))):lmscoursedetails.isUserJoined&&!e&&lmsLearnersTestMarkUpdatedView.fetchLearnerAttempts(erecno,lmsLearnersTestMarkUpdatedView.assessmentId,(function(e,s){"success"===s&&(t.appendChild(lmsLearnersTestMarkUpdatedView.getLearnersAttemptHead()),t.appendChild(lmsLearnersTestMarkUpdatedView.getLearnerAttemptDetails(lmsLearnersTestMarkUpdatedView.testId,lmsLearnersTestMarkUpdatedView.assessmentId,e[1].employee_attempts))),zplms.removeLoadingBar(t)})),this.learnersListView=t,t},constructInnerHead:function(){let e=document.createElement("div");e.setAttribute("class","lsthdr");let t="";return(lmscoursedetails.isCourseTrainer||lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0]))&&(t=1===this.type?'<div class="hdralgn"><div><span>'+ZPI18N.getString("zp.lms.learners")+'</span><i class="IC-l-ar-top"></i></div></div><div><div><span>'+ZPI18N.getString("zp.attempt")+"</span></div></div><div><div><span>"+ZPI18N.getString("zp.status")+"</span></div></div><div><div><span>"+ZPI18N.getString("zp.lms.mark.marks")+'</span></div></div><div class="wdsml"></div>':"<div><div><span>"+ZPI18N.getString("zp.lms.learners")+'</span><i class="IC-l-ar-top"></i></div></div><div><div><span>'+ZPI18N.getString("zp.lms.mark.marks")+"</span></div></div>"),e.innerHTML=t,lmsbase.addListener(e.querySelector(".IC-l-ar-top"),"click",this.sortHandle),e},sortHandle:function(e){let t,s=e.target;lmsbase.hasClass(s,"IC-l-ar-top")?(s.classList.remove("IC-l-ar-top"),s.classList.add("IC-l-ar-dwn"),t=2):(s.classList.remove("IC-l-ar-dwn"),s.classList.add("IC-l-ar-top"),t=1),lmsLearnersTestMarkUpdatedView.startIndex=1,lmsLearnersTestMarkUpdatedView.sortType=t,lmsLearnersTestMarkUpdatedView.getRecords(e,"new")},constructLearnerDetails:function(e){if(e&&(lmscoursedetails.isCourseTrainer||lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0]))){let t=document.createElement("div");if(t.setAttribute("class","zp_lstusr"),1===this.type){const s=document.createElement("div");s.setAttribute("class","zp_usrcnt");const r=document.createElement("div");r.setAttribute("class","zp_usrrw"),this.constructLearnersRow(r,e),this.usrRow=r,s.appendChild(r),t.appendChild(s)}else this.usrRow=t,this.constructLearnersRow(t,e);return t}},constructLearnersRow:function(e,t,s){if("new"===s&&(e.innerHTML=""),1===this.type?$.each(t,(function(t,s){lmsLearnersTestMarkUpdatedView.learnersDataObj[s.userErecno]=s;const r=document.createElement("div");r.setAttribute("class","zp_usrcvr"),r.appendChild(lmsLearnersTestMarkUpdatedView.getLearnersLastAttempt(s)),e.appendChild(r)})):$.each(t,(function(t,s){lmsLearnersTestMarkUpdatedView.learnersDataObj[s.userId]=s,e.appendChild(lmsLearnersTestMarkUpdatedView.getLearnersLastAttempt(s))})),e.querySelector(".zp_anc")&&e.querySelector(".zp_anc").remove(),25===t.length&&t.length<this.totalLearners){let s=document.createElement("div");e.appendChild(s),s.setAttribute("class","zp_anc fulcvr"),s.innerHTML=ZPI18N.getString("zp.lms.loadmore"),lmsbase.addListener(s,"click",this.getRecords),this.startIndex+=t.length}},getLearnersLastAttempt:function(e){let t=document.createElement("div");if(t.setAttribute("class","zp_usrdtl"),t.setAttribute("rel","onlineTest_"+(e.userErecno?e.userErecno:e.userId)),1===this.type){let s=e.status,r="",l="-",a=e.isSkipped,n="";null==s?(s="IC-ases_incmp zp_gryclr",r=ZPI18N.getString("zp.lms.course.notstarted")):"1"==s?(e.hasUserCompletedTheTest?(s="IC-ases_cmp zp_grclr",r=this.passPercentage?ZPI18N.getString("zp.lms.gradeBook.pass"):ZPI18N.getString("zp.completed")):(s="IC-ases_incmp zp_rdclr",r=ZPI18N.getString("zp.lms.gradeBook.fail")),l=e.marksObtained,n="/ "+e.totalMarks):(s="IC-rvwpnd zp_ylclr",r=ZPI18N.getString("zp.lms.reviewpending"));let i=0,o=parseInt(this.maxAttempt)+parseInt(e.extra_attempts);e.attemptsTaken&&o<e.attemptsTaken&&(o=e.attemptsTaken),e.attemptsTaken&&this.maxAttempt>-1&&(i=e.attemptsTaken/o*100);let c='<div><div title="'+e.userName+'" >'+(e.attemptsTaken>0?'<i class="IC-argt" ></i>':"")+'<div class="ZP_photo" ><img src="'+e.userImage+'"><i class="IC-tck1 attnd"></i></div><label class="zp_dtlalgn"><p>'+e.userName+"</p></label></div></div><div><div><font><span>"+e.attemptsTaken+"</span>"+(-1!==this.maxAttempt?"/ <span>"+o+"</span>":"")+'</font><div class="zp_CSprog"><div><div class="zp_detprogbar" style="width:'+i+'%"></div></div></div></div></div><div><div>'+(a&&"false"!==a?'<span class="zp_grclr">'+ZPI18N.getString("zp.skiped")+"</span>":'<i data-ttip="'+r+'" class="'+s+'"></i>')+'</div></div><div><div><label class="zp_memfld disabled"><span>'+l+n+'</span></label></div></div><div class="wdsml"></div>';if(t.innerHTML=c,e.attemptsTaken>0){let e='<div><div class="zp_micn"><ul><li><b><span><i class="IC-more"></i></span></b></li></ul></div></div>';t.querySelector(".wdsml").innerHTML=e,lmsbase.addListener(t.querySelector(".zp_usrdtl .wdsml .zp_micn li"),"click",lmsLearnersTestMarkUpdatedView.moreDetails),lmsbase.addListener(t.querySelector(".IC-argt"),"click",lmsLearnersTestMarkUpdatedView.learnersAllAttemptAction)}}else{let s='<div><div title="'+e.userName+'" ><div class="ZP_photo"><img src="'+e.userImage+'" ><i class="IC-tck1 attnd"></i></div><label class="zp_dtlalgn"><p>'+e.userName+'</p></label></div></div><div><div><label class="zp_memfld"><div><span>'+(e.userTestMark&&"null"!=e.userTestMark?e.userTestMark+"/ "+lmsLearnersTestMarkUpdatedView.testData.testMark:"-")+"</span></div></label></div></div>";t.innerHTML=s,lmsbase.addListener(t.querySelector(".zp_memfld"),"click",this.updateMarkFocusIn)}return t},updateMarkFocusIn:function(e){let t=e.target.closest(".zp_memfld");if(!lmsbase.hasClass(t,"zp_edtshw")){let e=lmsLearnersTestMarkUpdatedView.testData.testMark,s=t.querySelector("span").innerHTML;s=s.indexOf("/")>-1?s.split("/")[0]:"-",t.classList.add("zp_edtshw"),t.innerHTML="<div><input> / <span>"+e+"</span></div>",t.querySelector("input").value=s,lmsLearnersTestMarkUpdatedView.inputEventListeners(t,e)}},inputEventListeners:function(e,t){let s=null;lmsbase.addListener(e.querySelector("input"),"focusin",(function(){s=this.value,"-"===s&&(this.value=0)})),lmsbase.addListener(e.querySelector("input"),"input",(function(){this.value=this.value.replace(/[\\A-Za-z!"$%^&\-\)\(*+_={};:'@#~,.\/<>\" "\?|`\]\[]/g,""),parseInt(this.value)>parseInt(t)&&(this.value=t)})),lmsbase.addListener(e.querySelector("input"),"focusout",(function(e){let r=e.target.closest("div"),l=this.value?parseInt(this.value):"-"===s?0:s,a=e.target.closest(".zp_usrdtl").getAttribute("rel").split("_")[1],n=e.target.closest(".zp_memfld"),i=lmsLearnersTestMarkUpdatedView.learnersDataObj[a];if(n&&n.classList.remove("zp_edtshw"),l!==s){let e=lmsLearnersTestMarkUpdatedView.testId;lmstest.updateUserObtainedMark(e,l,a,(function(t){if(!0===t.status){let s={};if(s[ZPI18N.getString("zp.lms.completedlearners")]=t.count.testcount+" "+ZPI18N.getString("zp.of")+" "+t.count.totalcount,lmsnewupdatecard.updateEntityDetails(1,s),lmstest.updateCompletedLearnersCount(e,t.count.testcount),ZPeople.Message.showSuccessMsg(t.message),!n.parentElement.querySelector("i.IC-alert")&&Boolean("0"!=lmscoursegrade.gradeSetting.gradeScale&&(lmsLearnersTestMarkUpdatedView.testData.gradeCategoryName||"3"==lmscoursegrade.gradeSetting.gradeScale))&&i&&i.doesUserHaveGrade){let e=document.createElement("i");e.setAttribute("class","IC-alert zp_rdclr"),e.setAttribute("data-ttip",ZPI18N.getString("zp.lms.course.entity.result.card.grade.individual.info")),n.parentElement.appendChild(e)}}}))}r.innerHTML="<span>"+l+"/ "+t+"</span>"}))},getRecords:function(e,t){let s=lmsLearnersTestMarkUpdatedView;s.usrRow&&("new"===t?(s.startIndex=1,s.learnersDataObj={}):s.usrRow.querySelector(".zp_anc").classList.add("disabled"),1===s.type?lmstest.getOnlineTestResults(s.testId,s.startIndex,""!==lmscourses.currentBatchId&&"null"!==lmscourses.currentBatchId&&lmscourses.currentBatchId>-1?lmscourses.currentBatchId:void 0,s.sortType,s.searchTxt,(function(e){if(!0===e.status&&"success"===e.message)s.constructLearnersRow(s.usrRow,e.results,t);else if("new"===t){let e="<h3>"+ZPI18N.getString("zp.lms.nomembers")+"</h3>";lmsnodata.showNoData({mode:"general",container:s.usrRow,module:"members",content:e})}else t||s.usrRow.querySelector(".zp_anc").remove()}),s.filterObj):lmstest.getOfflineTestResults(s.testId,s.startIndex,s.sortType,s.searchTxt,(function(e){if(!0===e.status&&"success"===e.message)s.constructLearnersRow(s.usrRow,e.results,t);else if("new"===t){let e="<h3>"+ZPI18N.getString("zp.lms.nomembers")+"</h3>";lmsnodata.showNoData({mode:"general",container:s.usrRow,module:"members",content:e})}else t||s.usrRow.querySelector(".zp_anc").remove()}),s.filterObj))},learnersAllAttemptAction:function(e){let t=e.target.closest(".zp_usrcvr"),s=e.target;if(s.classList.add("disabled"),t)if(lmsbase.hasClass(t,"maxmz"))t.classList.remove("maxmz"),s.classList.remove("disabled"),t.querySelector(".zp_usrsub")&&t.querySelector(".zp_usrsub").remove();else{t.classList.add("maxmz");let e=t.querySelector(".zp_usrdtl").getAttribute("rel").split("_")[1];lmsLearnersTestMarkUpdatedView.fetchLearnerAttempts(e,lmsLearnersTestMarkUpdatedView.assessmentId,(function(r,l){if("success"===l){r=r[1];let s=lmsLearnersTestMarkUpdatedView.showLearnersAllAttempt(lmsLearnersTestMarkUpdatedView.testId,lmsLearnersTestMarkUpdatedView.assessmentId,r.employee_attempts,e);t.appendChild(s)}s.classList.remove("disabled")}))}},fetchLearnerAttempts:function(e,t,s){let r={method:"getListOfAttempts"};r.assessmentId=t,r.user=e,r.conreqcsr=csrfToken,$.post("/testAction.zp",r,s)},learnerAttemptCallback:function(e){1==e[0]&&e[1].employee_attempts&&(lmsLearnersTestMarkUpdatedView.learnersAttemptObj[learnerErecNo]=e[1].employee_attempts)},showLearnersAllAttempt:function(e,t,s,r){let l=document.createElement("div");return l.setAttribute("class","zp_usrsub"),l.appendChild(this.getLearnersAttemptHead()),l.appendChild(this.getLearnerAttemptDetails(e,t,s,r)),l},getLearnersAttemptHead:function(){let e=document.createElement("div");e.setAttribute("class","lsthdr");let t="<div><div><span>"+ZPI18N.getString("zp.attempt")+"</span></div></div><div><div><span>"+ZPI18N.getString("zp.date")+"</span></div></div><div><div><span>"+ZPI18N.getString("zp.status")+"</span></div></div><div><div><span>"+ZPI18N.getString("zp.lms.mark.marks")+'</span></div></div><div class="wdsml"><div></div></div>';return e.innerHTML=t,e},getLearnerAttemptDetails:function(e,t,s,r){let l=document.createElement("div");return l.setAttribute("class","zp_lstusr"),$.each(s,(function(s,r){let a=document.createElement("div");a.setAttribute("class","zp_usrdtl");let n=r.attempt_status,i="IC-ases_cmp zp_grclr",o="IC-Vwreslt",c=ZPI18N.getString("zp.assessment.result.view_result"),d=ZPI18N.getString("zp.completed"),m=r.mark_scored,u="/ "+r.total_mark;switch(n){case"pass":d=ZPI18N.getString("zp.lms.gradeBook.pass");break;case"fail":i="IC-ases_incmp zp_rdclr",d=ZPI18N.getString("zp.lms.gradeBook.fail");break;case"review_pending":i="IC-rvwpnd zp_ylclr",d=ZPI18N.getString("zp.lms.reviewpending"),m="-",c="",o="",u=""}let p="<div><div><span>"+(s+1)+"</span></div></div><div><div><span>"+ZPDateTime.getDateDisplayFormatWithoutTime(r.attempt_endtime)+'</span></div></div><div><div><i data-ttip= "'+d+'"class="'+i+'"></i></div></div><div><div><span>'+m+u+'</span></div></div><div class="wdsml"><div>';"review_pending"!==n&&(p+='<div class="zp_micn"><ul><li data-ttip="'+c+'"><b><span>'+(""===o?"":'<i class="IC-Vwreslt"></i>')+"</span></b></li></ul></div>"),p+="</div></div>",a.innerHTML=p,l.appendChild(a),"review_pending"!==n&&lmsbase.addListener(a.querySelector(".zp_usrdtl .wdsml .zp_micn li"),"click",(function(){lmstest.showLastAttemptResult(e,t,r.attempt_id)}))})),l},getEntityDetails:function(e,t,s){let r={};if(1===this.type){let l=this.maxAttempt;!0===t?(r[ZPI18N.getString("zp.lms.test.maximumAttemptsAllowed")]=-1===l?ZPI18N.getString("zp.lms.test.Unlimited"):l,-1!==l&&(r[ZPI18N.getString("zp.lms.test.AttemptsLeft")]=e.numberOfAttemptsLeft),r[ZPI18N.getString("zp.lms.course.status")]=e.status):t||(r[ZPI18N.getString("zp.lms.maximummarks")]=e.testMark,r[ZPI18N.getString("zp.lms.completedlearners")]=this.completedLearnersCount+" "+ZPI18N.getString("zp.of")+" "+lmscoursedetails.totalLearnersCount,e.duration&&(s?e.duration>0?r[ZPI18N.getString("zp.lms.duration")]=Math.floor(e.duration/6e4)+" "+ZPI18N.getString("zp.lms.mins"):r[ZPI18N.getString("zp.lms.duration")]=ZPI18N.getString("zp.assessment.tab.setup.preferences.timer.notimer"):r[ZPI18N.getString("zp.lms.duration")]=e.duration),this.passPercentage&&this.passPercentage>0&&(r[ZPI18N.getString("zp.lms.test.passPercentage")]=this.passPercentage))}else r[ZPI18N.getString("zp.lms.maximummarks")]=e.testMark,r[ZPI18N.getString("zp.lms.completedlearners")]=this.completedLearnersCount+" "+ZPI18N.getString("zp.of")+" "+lmscoursedetails.totalLearnersCount,r[ZPI18N.getString("zp.lms.duration")]=Math.floor(e.duration/6e4)+" "+ZPI18N.getString("zp.lms.mins");return r},searchLearner:function(e){lmsLearnersTestMarkUpdatedView.searchTxt=e,lmsLearnersTestMarkUpdatedView.getRecords(null,"new")},notifyCallback:function(e){1===lmsLearnersTestMarkUpdatedView.type?lmsmsgmembers.getMsgMemberByEntityType("onlinetest"):lmsmsgmembers.getMsgMemberByEntityType("offlinetest")},constructFilterObjArr:function(){if(lmscourses.courseOwner===erecno||lmscourses.isCourseAdmin||lmscoursedetails.isCourseTrainer){if(1===this.type){let e=-1==this.maxAttempt?15:this.maxAttempt,t={status:{attended:ZPI18N.getString("zp.assessment.result.attended"),unattended:ZPI18N.getString("zp.assessment.result.unattended"),pending:ZPI18N.getString("zp.lms.reviewpending")},score:{1:"0% - 20%",2:"21% - 40%",3:"41% - 60%",4:"61% - 80%",5:"81% - 100%"}},s={};for(let t=0;t<=e;t++)s["equal_"+t]=[t];return s["greaterthan_"+e]=[ZPI18N.getString("zp.lms.morethan",[e])],[t,{attempt:s}]}return[{status:{attended:ZPI18N.getString("zp.lms.mark.given"),unattended:ZPI18N.getString("zp.lms.mark.notgiven")},score:{1:"0% - 20%",2:"21% - 40%",3:"41% - 60%",4:"61% - 80%",5:"81% - 100%"}}]}return[]},filteredCallback:function(e){lmsLearnersTestMarkUpdatedView.filterObj=e,lmsLearnersTestMarkUpdatedView.getRecords(null,"new")},moreDetails:function(e,t){let s=e.target.closest(".zp_usrdtl").getAttribute("rel").split("_")[1],r=lmsLearnersTestMarkUpdatedView.learnersDataObj[s],l=[];null!=r.status&&"null"!==r.status&&l.push("1"===r.status?{result:[ZPI18N.getString("zp.assessment.result.view_result")]}:{pending:[ZPI18N.getString("zp.lms.reviewpending")]}),lmsLearnersTestMarkUpdatedView.testData.type!==lmstest.type.PRE_COURSE&&-1!==lmsLearnersTestMarkUpdatedView.maxAttempt&&r.attemptsTaken>=parseInt(lmsLearnersTestMarkUpdatedView.maxAttempt)+parseInt(r.extra_attempts)&&"1"===r.status&&l.push({editAttempt:[ZPI18N.getString("zp.lms.test.addattempt")]}),lmsbase.isCourseAdmin(-1,"","join")&&r.attemptsTaken>0&&l.push({export:[ZPI18N.getString("zp.assessment.export.attempts")]}),l.length>0&&lmsmenu.initiate({elem:e.target.closest("li"),maxwidth:"150px",type:"dropdown",menulist:l,eve:t}).on("click",(function(){"result"===this.value||"pending"===this.value?lmstest.showLastAttemptResult(lmsLearnersTestMarkUpdatedView.testId,lmsLearnersTestMarkUpdatedView.assessmentId,r.attemptIds[0]):"editAttempt"===this.value?lmsAddAttempt.initiate(lmsLearnersTestMarkUpdatedView.editAttemptForLearner,r.attemptsTaken,s):"export"===this.value&&ZPAssessAPI.exportIndividualUserReport(r.assessmentId,s)})).bind()},editAttemptForLearner:function(e,t){lmstest.editAttemptForLearner(lmsLearnersTestMarkUpdatedView.testId,lmsLearnersTestMarkUpdatedView.assessmentId,t,e,(function(s){!0===s[1]&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.test.addattempt.msg.success")),lmsLearnersTestMarkUpdatedView.updateLearnerDetails(t,"editAttempt",e))}))},updateLearnerDetails:function(e,t,s,r){let l=lmsLearnersTestMarkUpdatedView.outerCardNpwrap.querySelector('.zp_usrcvr [rel="onlineTest_'+e+'"]');if("editAttempt"===t&&l){let t=l.childNodes[1],r=t.firstChild.firstChild,a=r.childNodes[0].innerHTML,n=r.childNodes[2].innerHTML,i=parseInt(n)+parseInt(s);r.childNodes[2].innerHTML=i,t.querySelector(".zp_detprogbar").style.width=100*a/i+"%",lmsLearnersTestMarkUpdatedView.learnersDataObj[e].extra_attempts=parseInt(lmsLearnersTestMarkUpdatedView.learnersDataObj[e].extra_attempts)+parseInt(s)}else{if(l){let t=lmsLearnersTestMarkUpdatedView.getLearnersLastAttempt(s),r=l.parentElement;r.setAttribute("class","zp_usrcvr"),r.innerHTML="",r.appendChild(t),lmsLearnersTestMarkUpdatedView.learnersDataObj[e]=s}let t={},a=document.querySelector('[count="onlineTestTcount"][testid="'+r+'"]');a&&(a.innerHTML=s.completedLearnersCount+" / "+lmscoursedetails.totalLearnersCount),t[ZPI18N.getString("zp.lms.completedlearners")]=s.completedLearnersCount+" "+ZPI18N.getString("zp.of")+" "+s.totalLearnersCount,lmsnewupdatecard.updateEntityDetails(1,t)}},onAssessmentReviewed:function(e){let t=e.testInfo;e.testId==lmsLearnersTestMarkUpdatedView.testId&&(lmsLearnersTestMarkUpdatedView.updateLearnerDetails(t.userErecno,"",t,e.testId),lmstest.updateCompletedLearnersCount(e.testId,t.completedLearnersCount))},onAssessmentAttempted:function(e){if(lmsLearnersTestMarkUpdatedView.outerCardNpwrap&&e.testInfo.testId==lmsLearnersTestMarkUpdatedView.testId&&lmsLearnersTestMarkUpdatedView.learnerDetails){lmsnewupdatecard.closePopup();let s=lmsLearnersTestMarkUpdatedView.testData;if(s&&s.testId==e.testInfo.testId)for(var t in e.testInfo)s[t]=e.testInfo[t];lmsLearnersTestMarkUpdatedView.initiate(s,void 0,lmsLearnersTestMarkUpdatedView.moduleName,lmsLearnersTestMarkUpdatedView.learnerDetails)}},closeCallback:function(){lmsLearnersTestMarkUpdatedView.searchTxt="",lmsLearnersTestMarkUpdatedView.filterObj=null,lmsLearnersTestMarkUpdatedView.outerCardNpwrap=null,lmsLearnersTestMarkUpdatedView.testId=null}};zplms.setupEventManager(lmsLearnersTestMarkUpdatedView);const lmsAddAttempt={initiate:function(e,t,s){this.callback=e,this.editPopup=lmsbase.showMaskLayer(),this.learnerId=s,this.value=1;let r='<div class="zp_popup pad30" id="zp_pop78" style="width:500px"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.test.addattempt")+"</font><span>"+ZPI18N.getString("zp.lms.test.addattempt.desc")+'</span><i class="IC-cls"></i></div><div class="zp_Pocnt" style="max-height:600px;"><div><font class="zp_notinf bgylw mt0"><span><i class="IC-information"></i>'+ZPI18N.getString("zp.lms.test.addattempt.current")+"<b>"+t+'</b></span></font><div class="zp_Iinc">'+ZPI18N.getString("zp.lms.test.addattempt.tobeadded")+'<div class="zp_Smsub Smmax90"><div class="zp_Sm smbx"></div></div></div></div></div><div class="zp_btn"><button class="zpthm">'+ZPI18N.getString("zp.save")+"</button></div></div>";this.editPopup.innerHTML=r,this.attemptMenu(this.editPopup.querySelector(".zp_Sm")),lmsbase.addListener(this.editPopup.querySelector(".IC-cls"),"click",this.closePopup),lmsbase.addListener(this.editPopup.querySelector(".zpthm"),"click",this.addAttempt)},attemptMenu:function(e){lmsgroupmenu.initiate(e.parentElement).insertMenu({elem:e,type:"select",mode:"single",menulist:{1:["1"],2:["2"],3:["3"],4:["4"],5:["5"]},click:function(e){lmsAddAttempt.value=e.value}}),lmsmenu.changeToSelectMenu(e,{},"single",null,"1")},closePopup:function(){lmsAddAttempt.editPopup.innerHTML="",lmsAddAttempt.editPopup=void 0,lmsbase.hideMaskLayer()},addAttempt:function(){lmsAddAttempt.callback(lmsAddAttempt.value,lmsAddAttempt.learnerId),lmsAddAttempt.closePopup()}};var lmsfeedback={constants:{ENTITY_TYPE:10},_root:null,scrollElem:null,htmlConf:{header:!0,headerClass:"zp_header zp_CChgt",updateHash:!0,updateQues:!0,attachScroll:!0,scrollValue:.7,popupAttachScroll:!0,scrollQueryString:".zp_Lstwrap",popupScrollQueryString:".zp_pcnt",bodyClass:"zp_cwrap",headerHTML:'<div class="zp_hdtit"><h2><font>'+ZPI18N.getString("zp.lms.base.Feedback")+'</font></h2></div><div class="zp_CCcat"><div><div><div class="zp_Tabs"><ul><li _rel="courses">'+ZPI18N.getString("zp.lms.feedback.courses")+'</li><li _rel="trainers">'+ZPI18N.getString("zp.lms.feedback.trainer")+'</li></ul></div></div><div _rel="searchDiv"></div></div><div class="zp_Csrch"> <div id="" class="zp_Sm"><div> <i class="IC-srch"></i> <input required="" id="searchName" placeholder='+ZPI18N.getString("zp.lms.search")+' type="text" onkeydown="lmsfeedback.search(event)"></div></div><div><div class="zp_micn" id="closeSearch"><ul><li > <b class=""><span> <i class="IC-cls" _rel="close"></i> </span> </b></li> </ul></div>',bodyHTML:'<div class="zp_Lstwrap zp_Tfeed" id="feedback"><div class="zp_fdcnt" _rel="fklist" type="courses" style="display:none"></div><div class="zp_fdcnt" _rel="fklist" type="trainers" style="display:none"></div></div>'},_refer:{feedbackFor:void 0,timeUpdaterValue:null,baseUri:"",prevHash:"",courses:{startIndex:1},trainers:{startIndex:1},courseAndSessions:{courseId:"",batchId:"",startIndex:1}},integData:{courseId:"",courseName:"",sessionId:"",trainerId:"",averageRating:0,totalUser:0},defaultValues:{feedbackFor:"courses",searchName:""},isSession:!1,integ:!1,initiate:function(){/^(hash|integ)$/i.test(this.type)?lmsfeedback.hashMode(this):lmsfeedback.quesMode(this)},search:function(e){13===e.keyCode&&(SingleFeedback.popupClose(),lmsfeedback.updateSeachRefer(e))},integrationMode:function(e){lmsfeedback.integ=!0,lmsfeedback._refer.baseUri=e.baseUri,lmsfeedback.integData.courseId=e.courseId,lmsfeedback.integData.courseName=e.courseName,lmsfeedback.htmlConf.header=e.htmlConf.header,lmsfeedback.htmlConf.bodyClass=e.htmlConf.bodyClass},hashMode:function(e){"add"==e.mode&&(lmsfeedback.reInitialise(),e.integ&&lmsfeedback.integrationMode(e),lmsfeedback.layoutConstruction(e));var t=lmsfeedback.isHashValid(e.hashObject);if(t.isValid){if(lmsfeedback.updateRefer(t.hashObject)){var s=lmsfeedback._refer;"courseAndSessions"==s.feedbackFor?(s[s.feedbackFor].courseId=e.courseId,s[s.feedbackFor].batchId=e.batchId?e.batchId:0):s[s.feedbackFor].searchName=decodeURIComponent(s[s.feedbackFor].searchName),"nodata"!=s[s.feedbackFor].startIndex&&(s[s.feedbackFor].startIndex=1,lmsfeedback.getFeedbackList()),lmsfeedback.integ||lmsfeedback.switchListing(lmsfeedback._root.querySelector("[_rel='"+s.feedbackFor+"']")),t.updateHashMode&&lmsfeedback.makeAndUpdateHash()}}else lmsfeedback.revertHash()},makeAndUpdateHash:function(){if(lmsfeedback.htmlConf.updateHash){var e=lmsfeedback._refer;"courseAndSessions"==e.feedbackFor?hashStr="feedback":hashStr="feedback/"+e.feedbackFor+(e[e.feedbackFor].searchName?"/name="+e[e.feedbackFor].searchName:""),e.prevHash=e.baseUri+hashStr,lms.changeHash("hash",e.prevHash,"disable")}},revertHash:function(){lmsfeedback._refer.prevHash?lms.changeHash("hash",lmsfeedback._refer.prevHash,"disable"):lms.changeHash("hash",lmsfeedback._refer.baseUri+"feedback")},updateRefer:function(e){var t=lmsfeedback._refer,s=lmsfeedback.defaultValues,r=!1;return t.feedbackFor!=e.feedbackFor&&(t.feedbackFor=lmsfeedback.integ?"courseAndSessions":e.feedbackFor||s.feedbackFor,r=!0),lmsfeedback.integ||t[t.feedbackFor].searchName==e.searchName||(t[t.feedbackFor].searchName=e.searchName||s.searchName,r=!0,$(".zp_Csrch").addClass("zp_CCsrch")),r},layoutConstruction:function(e){lmsbase.removeClass(e.elem,"zp_CMmdl"),lmsbase.removeClass(e.elem,"zp_crsMem"),lmsfeedback._root=e.elem,lmsfeedback._root.innerHTML="";var t=lmsfeedback.htmlConf;if(lmsfeedback.integ){lmsbase.removeClass(e.elem,"zp_Cfdk"),lmsbase.addClass(e.elem,"zp_Tfeed"),lmsbase.removeClass(e.elem.parentNode,"zp_gy"),(r=e.elem.appendChild(document.createElement("div"))).className="zp_fdcnt",r.setAttribute("_rel","fklist"),r.setAttribute("id","feedback"),r.setAttribute("type","courseAndSessions")}else{if(t.header){var s=e.elem.appendChild(document.createElement("div"));s.className=t.headerClass,s.innerHTML=t.headerHTML}var r;(r=e.elem.appendChild(document.createElement("div"))).className=t.bodyClass,r.innerHTML=t.bodyHTML}t.attachScroll&&(lmsfeedback.scrollElem=lmsfeedback.integ?e.elem.closest(t.scrollQueryString):e.elem.querySelector(t.scrollQueryString),lmsbase.addListener(lmsfeedback.scrollElem,"scroll",lmsfeedback.scrollHandle,!1)),lmsbase.addListener(e.elem,"click",lmsfeedback.clickHandle,!1)},isHashValid:function(e){var t="",s=""==e.level1,r=s||"courses"!=e.level1&&"trainers"!=e.level1&&"feedback"!=e.level1;s=s||!r;var l=!e.level2||"object"==typeof e.level2&&(t=e.level2.name),a=s&&l,n={isValid:a,updateHashMode:r};return a&&(n.hashObject={feedbackFor:e.level1,searchName:t}),n},showListing:function(e){var t=lmsfeedback._refer;if(feedbackFor=e.getAttribute("_rel"),t.feedbackFor!=feedbackFor&&(t.feedbackFor=feedbackFor,SingleFeedback.popupClose(),lmsfeedback.switchListing(e),lmsfeedback.makeAndUpdateHash(),1==t[t.feedbackFor].startIndex)){lmsfeedback.getFeedbackList();lmsfeedback._root.querySelector('[_rel = "fklist"][type="'+t.feedbackFor+'"]')}},switchListing:function(e){var t=lmsfeedback._refer;lmsfeedback.switchTab(e),lmsfeedback.setSearchBar();var s=lmsfeedback._root.querySelector('[_rel = "fklist"][type="'+t.feedbackFor+'"]');lmsfeedback.switchContainer(s)},switchTab:function(e){if(!lmsbase.hasClass(e,"sel")){var t=e.parentNode.querySelectorAll(".sel");t.length&&Array.prototype.forEach.call(t,(function(e){lmsbase.removeClass(e,"sel")})),lmsbase.addClass(e,"sel")}},switchContainer:function(e){for(var t=e.parentNode.childNodes,s=t.length-1;s>=0;s--)t[s].style.display=t[s]==e?"":"none"},getFeedbackList:function(){var e=lmsfeedback._refer,t={action:"fetchFeedbackList",feedbackFor:e.feedbackFor,courseId:e[e.feedbackFor].courseId,batchId:0!=e[e.feedbackFor].batchId?e[e.feedbackFor].batchId:void 0,startIndex:e[e.feedbackFor].startIndex,onlySessions:"courseAndSessions"==e.feedbackFor?1!=e[e.feedbackFor].startIndex:void 0,searchName:e[e.feedbackFor].searchName||void 0};return 1==e[e.feedbackFor].startIndex&&(container=lmsfeedback._root.querySelector('[_rel = "fklist"][type="'+e.feedbackFor+'"]'),container.appendChild(lmsmessages.addLoading())),$.get("/feedbackAction.zp",t,lmsfeedback.listFeedbacks),!0},listFeedbacks:function(e){if(lmsfeedback.removeLoading(),"noPermission"!=e.status){var t,s,r=lmsfeedback._refer,l=lmsfeedback._root.querySelector('[_rel = "fklist"][type="'+r.feedbackFor+'"]'),a=document.createDocumentFragment(),n=1==r[r.feedbackFor].startIndex?"new":"update";if("failure"==e.status)return lmsfeedback.integ||(lmsfeedback._root.querySelector("[_rel=searchDiv]").innerHTML=""),s="courses"==r.feedbackFor?ZPI18N.getString("zp.lms.course.coursenocourse"):"trainers"==r.feedbackFor?ZPI18N.getString("zp.lms.feedback.notrainer"):ZPI18N.getString("zp.lms.feedback.Nofeedbacksavailable"),void lmsnodata.showNoData({mode:r.feedbackFor,container:l,module:"Feedback",content:s});if("courses"==r.feedbackFor)dataArray=e.feedbackArray||[],t=lmsfeedback.getCourseCard,s=ZPI18N.getString("zp.lms.course.coursenocourse");else if("trainers"==r.feedbackFor)dataArray=e.feedbackArray||[],t=lmsfeedback.getTrainerCard,s=ZPI18N.getString("zp.lms.feedback.notrainer");else{var i=document.createElement("p");lmsbase.addClass(i,"zp_Pttl"),i.innerHTML=ZPI18N.getString("zp.lms.course"),i.setAttribute("_rel","course");var o=document.createElement("p");lmsbase.addClass(o,"zp_Pttl"),o.innerHTML=ZPI18N.getString("zp.lms.base.Sessions"),o.setAttribute("_rel","session"),"new"==n?(dataArray=e.feedbackArray[0].sessions||[],isEmpty(e.feedbackArray[0].course)?dataArray=[]:(a.appendChild(i),a.appendChild(lmsfeedback.getCourseCard(e.feedbackArray[0].course))),0!=dataArray.length&&a.appendChild(o)):dataArray=e.feedbackArray[0].sessions||[],s=ZPI18N.getString("zp.lms.feedback.Nofeedbacksavailable"),t=lmsfeedback.getSessionCard}"new"==n&&(dataArray.length>0||a.querySelector("[_rel='course']")?(lmsfeedback.integ||(lmsfeedback._root.querySelector("[_rel=searchDiv]").innerHTML='<i class="IC-srch" _rel="search"></i>'),lmsnodata.clearNoData(l)):(lmsfeedback.integ||(lmsfeedback._root.querySelector("[_rel=searchDiv]").innerHTML=""),lmsnodata.showNoData({mode:r.feedbackFor,container:l,module:"Feedback",content:s})));for(var c=0;c<dataArray.length;c++)a.appendChild(t(dataArray[c]));25==dataArray.length?(r[r.feedbackFor].startIndex+=25,a.appendChild(lmsmessages.addLoading())):r[r.feedbackFor].startIndex="new"!=n||dataArray.length||a.querySelector("[_rel='course']")?ZPI18N.getString("zp.lms.end"):ZPI18N.getString("zp.lms.nodata"),l.appendChild(a)}else{var d=lmscoursedetails.componentUrl(lmscourses.currentCourseId);lms.changeHash("hash",d+"/overview")}},getCourseCard:function(e){var t=document.createElement("div");t.className="zp_Lst"+(e.courseId==SingleFeedback.refer[SingleFeedback.refer.feedbackOf+"Id"]?" sel":""),t.courseInfo=e,t.setAttribute("_rel","feedback"),t.setAttribute("course_Id",e.courseId),lmsfeedback.integ&&(lmsfeedback.integData.averageRating=e.averageRating,lmsfeedback.integData.totalUser=e.reviewsCount);var s=e.courseImageInfo;s.additionalInfo={fileId:e.courseId,type:6};var r=s.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+s.imageID+".svg"):lmsfileaction.generateSourceURL(s);return t.innerHTML='<div><div class="zp_Ldtl"><div class="ZP_photo pc2"><img src='+r+'></div><div class="zp_Tdts"><h3 name>'+e.courseName+"</h3><font><a>"+e.courseOwnerInfo.name+'</a></font></div></div><div class="zp_Lrgt">'+lmsfeedback.getStarHtml(e.averageRating,null,1,16).outerHTML+"<font>("+e.reviewsCount+")</font></div></div>",t},getTrainerCard:function(e){var t=document.createElement("div");return t.className="zp_Lst"+(e.trainerId==SingleFeedback.refer[SingleFeedback.refer.feedbackOf+"Id"]?" sel":""),t.trainerInfo=e,t.setAttribute("_rel","feedback"),t.setAttribute("trainer_Id",e.trainerId),t.innerHTML='<div><div class="zp_Ldtl ">'+lmsmessages.getUserDP(e.userInfo).outerHTML+'<div class="zp_Tdts"><h3>'+e.userInfo.name+'</h3><font> <p class="zp_ldot">'+e.coursesCount+" "+ZPI18N.getString("zp.lms.feedback.courses")+'</p></font></div></div><div class="zp_Lrgt">'+lmsfeedback.getStarHtml(e.overallTrainerRating,null,1,16).outerHTML+"<font>("+e.reviewsCount+")</font></div></div>",t},getSessionCard:function(e){var t=document.createElement("div");return t.className="zp_Lst"+(e.sessionId==SingleFeedback.refer[SingleFeedback.refer.feedbackOf+"Id"]?" sel":""),t.sessionInfo=e,t.setAttribute("session_Id",e.sessionId),t.setAttribute("_rel","feedback"),t.innerHTML='<div><div class="zp_Ldtl">'+lmsmessages.getUserDP(e.userInfo).outerHTML+'<div class="zp_Tdts"><h3>'+e.sessionName+'</h3><font> <p class="zp_ldot">'+e.userInfo.name+'</p></font></div></div><div class="zp_Lrgt">'+lmsfeedback.getStarHtml(e.averageRating,null,1,16).outerHTML+"<font>("+e.reviewsCount+")</font></div></div>",t},clickHandle:function(e){var t=e.target,s=t.getAttribute("_rel");if("search"==s&&$(".zp_Csrch").addClass("zp_CCsrch"),"close"==s){$(".zp_Csrch").removeClass("zp_CCsrch"),lmsfeedback.resetSearchBar(),lmsfeedback.sendSearchRequest();var r="feedback/"+("courses"==lmsfeedback._refer.feedbackFor?"courses":"trainers");lms.changeHash("hash",r),SingleFeedback.refer={sessionId:"",courseId:"",trainerId:"",feedbackOf:"",stars:"all",role:4,index:1,stats:!0,timeUpdaterValue:null,baseUri:"",prevHash:"",entityData:null}}if("courses"==s||"trainers"==s)lmsfeedback.showListing(t);else{var l=t.closest("[_rel='feedback']");if(l&&!lmsbase.hasClass(l,"sel")){lmsfeedback._refer;null!=l.getAttribute("course_id")?(entityName="course",entityId=l.courseInfo.courseId):null!=l.getAttribute("trainer_id")?(entityName="trainer",entityId=l.trainerInfo.trainerId):(entityName="session",entityId=l.sessionInfo.sessionId);var a="feedbackinfo/"+entityName+"/"+entityId;SingleFeedback.initiate.call({mode:"update",type:"ques",elem:lmsbase.openQHash(),hashObject:{level1:entityName,level2:entityId},integ:!!lmsfeedback.integ}),lms.changeHash("ques",a,"disable")}}},resetSearchBar:function(){lmsfeedback._refer[lmsfeedback._refer.feedbackFor].searchName="",lmsfeedback._root.querySelector("#searchName").value=""},setSearchBar:function(e){lmsfeedback._root.querySelector("#searchName").value=e||lmsfeedback._refer[lmsfeedback._refer.feedbackFor].searchName},scrollHandle:function(){var e=lmsfeedback._refer;"end"!=e[e.feedbackFor].startIndex&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&lmsfeedback.getFeedbackList()},updateSeachRefer:function(e){var t=e.target,s=lmsfeedback._refer,r=t.value,l=s[s.feedbackFor].searchName;if(r!=l){if(s[s.feedbackFor].searchName=r,lmsfeedback.makeAndUpdateHash(),"nodata"==s[s.feedbackFor].startIndex&&0==r.indexOf(l))return!1;lmsfeedback.sendSearchRequest()}},sendSearchRequest:function(){var e=lmsfeedback._refer;e[e.feedbackFor].startIndex=1,lmsfeedback.getFeedbackList()},removeLoading:function(){var e=this._root.querySelector("[_rel=loadbar]");e&&e.parentNode.removeChild(e)},addLoading:function(e,t){e=this._root.querySelector("[_rel="+e+"]");t&&(e.innerHTML="");var s=e.appendChild(document.createElement("div"));s.className="ctable",s.setAttribute("_rel","loadbar"),s.innerHTML='<div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div>'},getStarHtml:function(e,t,s,r){var l=!1;10*e%10>=5&&(l=Number(e.toString().charAt(0))+1);var a=document.createElement("div"),n=1;if(a.className=t||"ZPmrate ML0I",s&&1==s)for(;n<=5;){a.appendChild(document.createElement("div")).className=(l==n?"IC-star-h":"IC-star")+" FL S"+r+" CP "+(n<=e||l==n?"ylw":"gry"),n++}else for(var i=1;i<=e;i++){a.appendChild(document.createElement("div")).className="IC-star S11 CP ylw"}return a},addorRemoveSelClass:function(e){if(lmsfeedback._root){var t=lmsfeedback._root,s=t.querySelector("#feedback .sel");if(s&&s.getAttribute(SingleFeedback.refer.feedbackOf+"_Id")==e)return;s&&lmsbase.removeClass(s,"sel"),e&&(s=t.querySelector("#feedback ["+SingleFeedback.refer.feedbackOf+"_Id='"+e+"']"))&&lmsbase.addClass(s,"sel")}},reInitialise:function(){lmsfeedback._root=null,lmsfeedback.scrollElem=null,lmsfeedback.searchTimerValue=500,lmsfeedback._refer={feedbackFor:void 0,timeUpdaterValue:null,baseUri:"",prevHash:"",courses:{startIndex:1,searchName:"",searchTimer:null},trainers:{startIndex:1,searchName:"",searchTimer:null},courseAndSessions:{courseId:"",batchId:"",startIndex:1,searchName:""}},lmsfeedback.integData={courseId:"",courseName:"",sessionId:"",trainerId:"",averageRating:0,totalUser:0},lmsfeedback.integ=!1;var e=lmsfeedback.htmlConf;e.header=!0,e.bodyClass="zp_cwrap"},close:function(){lmsbase.removeListener(lmsfeedback._root,"click",lmsfeedback.handle,!1),lmsfeedback.htmlConf.attachScroll&&lmsbase.removeListener(lmsfeedback.scrollElem,"scroll",lmsfeedback.scrollHandle,!1),lmsfeedback.reInitialise()}},AddFeedback=function(){var e={TRAINER:4,LEARNER:3,MANAGER:2},t={COURSE:0,SESSION:1,LEARNER:2},s={courseId:void 0,batchId:void 0,sessionId:void 0,role:void 0,type:void 0,feedbackFrom:void 0,feedbackFor:void 0,learnerErecno:void 0,showStars:!0},r=null,l=null,a=null,n=5,i=!1;function o(e){var l,a=e.target.getAttribute("_rel");"post"==a?(l=function(){var e=r.querySelector("[name=review]").value.trim(),t=n,l=e.length;if("notification"==s.feedbackFrom&&2==s.role){s.feedbackFor=[],usersElems=r.querySelector("[_rel=items]").querySelectorAll("[data-value]");for(var a=0;a<usersElems.length;a++)s.feedbackFor.push(usersElems[a].getAttribute("data-value"));if(0==s.feedbackFor.length)return void(r.querySelector("[errmsg]").innerText=ZPI18N.getString("zp.lms.feedback.NoSubordinatesSelected"));r.querySelector("[errmsg]").innerText=""}var i=r.querySelector("[_rel=commentBox]");if(r.querySelector("[_rel=commentExceeded]")){if(l>=2048)return;lmsbase.removeClass(i,"zp_err"),i.removeChild(r.querySelector(".etxt"))}else if(l>=2048){var o=document.createElement("span");return o.setAttribute("_rel","commentExceeded"),lmsbase.addClass(i,"zp_err"),lmsbase.addClass(o,"etxt"),o.innerText=ZPI18N.getString("zp.exceedmaxlength"),void i.appendChild(o)}return{review:e||void 0,stars:t}}(),l&&function(e,l){if(0==s.type)lmsfeedback_v1.sendRequestToSubmitFeedback(s.feedbackId,l,e,(function(e){"notification"==s.feedbackFrom?d({status:"success"}):g({status:"success"})}),(function(e){if("notification"==s.feedbackFrom)!function(e,t){var s=r.querySelector('[_rel="fdk_content"]'),l=_(e,t);s.parentNode.replaceChild(l,s)}("INTERNAL_ERROR"==e.responseJSON.code?"PROBLEM_SENDING_FEEDBACK":e.responseJSON.code,e.responseJSON.message);else switch(e.responseJSON.code){case"FEEDBACK_ALREADY_GIVEN":g({status:"given"});break;case"COMPLETE_ALL_MANDATORY_TO_PROVIDE_FEEDBACK":g({status:"incomplete_entities",message:e.responseJSON.message});break;default:g({status:"failure"})}}));else if(s.type===t.LEARNER)lmsfeedback_v1.sendRequestToSubmitLearnerFeedback(s.sessionId,s.feedbackId,e,(e=>g(e)),(e=>z(e)));else{var a={action:"addFeedback",courseId:s.courseId,batchId:s.batchId,review:e,stars:l,type:s.type,role:s.role,sessionId:s.sessionId,feedbackFor:s.feedbackFor?s.feedbackFor.toString():void 0,conreqcsr:csrfToken};$.post("/feedbackAction.zp",a,(function(e){"notification"==s.feedbackFrom?d(e):(g(e),function(e){let t=lmsmodule.sessionInfo[e.sessionId];t&&(lmsmodule.sessionInfo[e.sessionId].feedback=e,lmsmodule.sessionInfo[e.sessionId].canGiveFeedback=2)}(e))}))}}(l.review,l.stars)):"close"==a?f():b(e)}function c(e){return e.courseImageInfo.courseImage.additionalInfo={fileId:e.courseId,type:6},'<div class="zp_feedhdr"><div><div class="zp_fdimg" style="background-image:url('+(e.courseImageInfo.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+e.courseImageInfo.courseImage+".svg"):lmsfileaction.generateSourceURL(e.courseImageInfo.courseImage))+')"></div><div class="zp_fdttl"><h4>'+e.courseName+"</h4>"+(s.batchId?"<span>"+e.batchName+'</span><span class="zp_ldot">'+e.batchStartDate+"</span>":"")+(s.sessionId?"<p>"+e.sessionName+"</p>":"")+"</div></div>"+(3==s.role&&e.userGrade?"<font>"+ZPI18N.getString(e.userGrade)+"</font>":"")+"</div>"}function d(e){var t=document.createElement("div");if(t.setAttribute("_rel","fdk_content"),"success"==e.status){lmsbase.addClass(t,"zp_sucus");var s="<img src="+ZPeople.getResourceURL(hrImageUrl+"lms_feedback_successfully_given.png")+"><h4>"+ZPI18N.getString("zp.lms.feedback.Yay")+" !</h4>"+(e.isFeedbackAlreadyGiven?"<p>"+ZPI18N.getString("zp.lms.feedbackalredygiven")+"</p>":"<p>"+ZPI18N.getString("zp.lms.feedback.postfeedback-success")+"</p>")}else{lmsbase.addClass(t,"zp_fail");s="<h4>"+ZPI18N.getString("zp.lms.feedback.Oops")+" !</h4><p>"+ZPI18N.getString("zp.lms.feedback.probleminsendingfeedback")+"</p>"}if(t.innerHTML=s,e.isFeedbackAlreadyGiven){var l=c(e),a=document.createElement("div");lmsbase.addClass(a,"zp_feed"),a.innerHTML=l,a.appendChild(t),r.appendChild(a)}else r.querySelector('[_rel="fdk_content"]').parentNode.replaceChild(t,r.querySelector('[_rel="fdk_content"]'))}function m(){u((function(e){"success"==e.status?3==s.role&&e.isFeedbackAlreadyGiven||2==s.role&&0==e.subOrdinatesForWhomFeedbackNotGiven.length?(e.isFeedbackAlreadyGiven=!0,d(e)):function(e){var t=lmsfeedback.getStarHtml(n,!1,1,22);t.setAttribute("_rel","stars");var l=document.createElement("div");lmsbase.addClass(l,"zp_feed");var a=c(e),i='<div class="zp_feedcvr" _rel="fdk_content"><div class="zp_feedcnt"><div class="zp_Attl">'+(s.sessionId?"Session ":"Course ")+"feedback by <b>"+(3==s.role?"learner":"manager")+"</b></div>";2==s.role&&(i+=lmsformcomponents.htmlField({formComponentId:"subordinatesIds",fieldType:25,displayName:null,emptyText:"Select"}),subOrdinatesList=function(e){for(var t={},s=e.subOrdinatesForWhomFeedbackNotGiven,r=0;r<s.length;r++)t[s[r].userId]=[s[r].userInfo.name,""];return t}(e)),i+='<div><div class="zp_Pttl"> '+ZPI18N.getString("zp.lms.feedback.rateexperience")+" </div>"+t.outerHTML+'<div class="zp_Pttl"> '+ZPI18N.getString("zp.lms.feedback.sharethoughts")+' </div><div class="zp_Sm" _rel=commentBox>'+lmsformcomponents.getTextArea({labelName:"review",isMandatory:!0,formComponentId:null,fieldType:"textarea"})+'</div><div class="zp_btn"><button class="zpthm" _rel="post">'+ZPI18N.getString("zp.lms.feedback.sendFeeback")+"</button></div></div></div></div>",l.innerHTML=a+i,r.appendChild(l),lmsbase.addListener(r,"click",o,!1),2==s.role&&(r.menuReference=lmsgroupmenu.initiate(r),r.menuReference.insertMenu({elem:r.querySelector('[_type="select"]').parentElement,type:"select",mode:"multi",allow_new:!1,menulist:subOrdinatesList})),t=r.querySelector("[_rel=stars]"),lmsbase.addListener(t,"mouseleave",h,!1),lmsbase.addListener(t,"mouseover",b,!1)}(e):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.permissiondenied"))}))}function u(e){var t={action:"getFeedbackInfo",courseId:s.courseId,batchId:s.batchId,role:s.role,sessionId:s.sessionId};$.get("/feedbackAction.zp",t,e)}function p(){"notification"==s.feedbackFrom?(r=document.getElementById("lms"),m()):(r=lmsbase.showMaskLayer(),function(){let e;s.showStars&&(e=lmsfeedback.getStarHtml(n,!1,1,22),e.setAttribute("stars",""));var t='<div class="zp_popup" style="width:550px;"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.feedback.writefeedback")+'</font><i class="IC-cls" _rel="close" '+lmstooltip._attrib+'="'+ZPI18N.getString("zp.close")+'"></i></div><div class="zp_Pocnt" style="max-height:700px;">';t+=(e?'<div class="zp_Pttl">'+ZPI18N.getString("zp.lms.feedback.rateexperience")+"</div>"+e.outerHTML:"")+'<div class="zp_Pttl">'+ZPI18N.getString("zp.lms.feedback.sharethoughts")+'</div><div class="zp_Sm" _rel=commentBox>'+lmsformcomponents.getTextArea({labelName:"review",isMandatory:!0,formComponentId:null,fieldType:"textarea"})+'</div></div><div class="zp_btn"><button class="zpthm" _rel="post">'+ZPI18N.getString("zp.post")+"</button></div></div>",r.innerHTML=t,lmsbase.addListener(r,"click",o,!1),r.querySelector("textarea").focus(),e&&(e=r.querySelector("[stars]"),lmsbase.addListener(e,"mouseleave",h,!1),lmsbase.addListener(e,"mouseover",b,!1))}())}function g(e){switch(f(),e.status){case"success":!function(e){if(lmsfeedback.integ){lmsbase.hide(document.querySelector("[data-id^='addBtn']"));var t=lmsfeedback._refer[lmsfeedback._refer.feedbackFor].courseId,s=lmsfeedback._root.querySelector("[course_id ='"+t+"']").querySelector('[class="zp_Lrgt"]');averageRating=(e.stars+lmsfeedback.integData.averageRating*lmsfeedback.integData.totalUser)/(lmsfeedback.integData.totalUser+1),lmsfeedback.integData.totalUser+=1,s.innerHTML=lmsfeedback.getStarHtml(averageRating,null,1,16).outerHTML,fontelem=document.createElement("font"),fontelem.innerHTML="("+lmsfeedback.integData.totalUser+")",s.appendChild(fontelem)}}(e),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.feedback.postfeedback-success")),lmsMemberFeedback.onFeedbackShared();break;case"given":ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.feedbackalredygiven"));break;case"incomplete_entities":e.message?ZPeople.Message.showWarningMsg(e.message):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.feedback.complete.mandatory"));break;default:ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.feedback.postfeedback-fail"))}l&&l(e,a)}function f(){r.innerHTML="",lmsbase.hideMaskLayer(),lmsbase.removeListener(r,"click",o,!1),r=null}function v(e){(s={}).courseId=e.courseId,s.batchId=e.batchId||void 0,s.sessionId=e.sessionId||void 0,s.type=e.type||t.COURSE,s.role=e.role,s.feedbackFor=e.feedbackFor,s.feedbackFrom=e.feedbackFrom,s.showStars=!1!==e.showStars,s.feedbackId=null,s.templateType=null,s.templateId=null,s.learnerErecno=e.learnerErecno,l=a=null,n=5,i=!1}function h(e){for(var t=r.querySelectorAll(".IC-star"),s=t.length-1,l=n-1;s>=0;s--)s>l?(lmsbase.removeClass(t[s],"ylw"),lmsbase.addClass(t[s],"gry")):(lmsbase.removeClass(t[s],"gry"),lmsbase.addClass(t[s],"ylw"));i=!1}function b(e){i||(i=!0,n=I());var t=e.target;lmsbase.hasClass(t,"IC-star")&&($(t,r).prevAll().removeClass("gry").addClass("ylw"),$(t,r).removeClass("gry").addClass("ylw"),$(t,r).nextAll().removeClass("ylw").addClass("gry")),"click"==e.type&&(n=I())}function I(){return r.querySelectorAll(".IC-star.ylw").length}function y(e,t){u((function(s){if("success"==s.status){r=document.getElementById("lms");var l=document.createElement("div");lmsbase.addClass(l,"zp_feed");var a=c(s);l.innerHTML=a,l.appendChild(_(e,t)),r.innerHTML="",r.appendChild(l)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.internalservererror"))}))}function _(e,t){var s=document.createElement("div");switch(e){case"FEEDBACK_ALREADY_GIVEN":lmsbase.addClass(s,"zp_sucus");var r="<h4>"+ZPI18N.getString("zp.lms.feedback.Yay")+" !</h4><p>"+ZPI18N.getString("zp.lms.feedbackalredygiven")+"</p>";break;case"MANAGER_FEEDBACK_NOT_ALLOWED":lmsbase.addClass(s,"zp_fail");r="<h4>"+ZPI18N.getString("zp.lms.feedback.Oops")+" !</h4><p>"+ZPI18N.getString("zp.lms.feedback.message.managerFeedbackNotAllowed")+"</p>";break;case"NO_PERMISSION":case"FEEDBACK_NOT_YET_STARTED":lmsbase.addClass(s,"zp_fail");r="<h4>"+ZPI18N.getString("zp.lms.feedback.Oops")+" !</h4><p>"+t+"</p>";break;case"PROBLEM_LOADING_FEEDBACK":lmsbase.addClass(s,"zp_fail");r="<h4>"+ZPI18N.getString("zp.lms.feedback.Oops")+" !</h4><p>"+ZPI18N.getString("zp.lms.feedback.message.probleminloadingfeedback")+"</p>";break;case"PROBLEM_LOADING_FEEDBACK":lmsbase.addClass(s,"zp_fail");r="<h4>"+ZPI18N.getString("zp.lms.feedback.Oops")+" !</h4><p>"+ZPI18N.getString("zp.lms.feedback.probleminloadingfeedback")+"</p>";break;case"PROBLEM_SENDING_FEEDBACK":lmsbase.addClass(s,"zp_fail");r="<h4>"+ZPI18N.getString("zp.lms.feedback.Oops")+" !</h4><p>"+ZPI18N.getString("zp.lms.feedback.probleminsendingfeedback")+"</p>";break;default:lmsbase.addClass(s,"zp_fail");r="<h4>"+ZPI18N.getString("zp.lms.feedback.Oops")+" !</h4><p>"+ZPI18N.getString("zp.internalservererror")+"</p>"}return s.innerHTML=r,s}function S(){if(0==s.templateType)P();else try{ZPSurveyAPI.getCustomFeedback({courseId:s.courseId,batchId:s.batchId,templateId:s.templateId}),"notification"==s.feedbackFrom&&u((function(e){if("success"==e.status){r=document.getElementById("lms");var t=document.createElement("div");lmsbase.addClass(t,"zp_feed");var s=c(e);t.innerHTML=s;var l=document.createElement("div");t.appendChild(l),lmsbase.addClass(l,"zp_sucus");var a="<p>"+ZPI18N.getString("zp.lms.feedback.message.checkNewWindowToProvideFeedback")+"</p>";l.innerHTML=a,r.innerHTMl="",r.appendChild(t)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.internalservererror"))}))}catch(e){"notification"==s.feedbackFrom?y("PROBLEM_LOADING_FEEDBACK"):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.feedback.message.probleminloadingfeedback"))}}function C(){P()}function P(){p()}function z(e){switch(e.responseJSON.code){case"FEEDBACK_ALREADY_GIVEN":ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.feedbackalredygiven"));break;case"NO_PERMISSION":case"FEEDBACK_NOT_YET_STARTED":ZPeople.Message.showFailureMsg(e.responseJSON.message);break;case"INTERNAL_ERROR":ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.internalservererror"));break;default:ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.feedback.postfeedback-fail"))}}return menuReference=null,{ROLE:cloneObject(e),TYPE:cloneObject(t),init:function(r,a,n){if(r.courseId&&r.role===e.LEARNER||r.sessionId&&r.role===e.TRAINER)return v(r),"function"==typeof a&&(l=a),function(){if(0==s.type){if(s.role==e.MANAGER)return void("notification"==s.feedbackFrom?y("MANAGER_FEEDBACK_NOT_ALLOWED"):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.feedback.message.managerFeedbackNotAllowed")));lmsfeedback_v1.sendRequestToStartFeedback(s.courseId,s.batchId,(function(e){var t=e.feedback;s.feedbackId=t.feedbackId,s.templateType=t.settings.templateType,s.templateId=t.settings.templateId,S()}),(function(e){"notification"==s.feedbackFrom?y(e.responseJSON.code,e.responseJSON.message):z(e)}))}else s.type===t.LEARNER?lmsfeedback_v1.sendRequestToStartLearnerFeedback(s.sessionId,s.learnerErecno,(e=>{s.feedbackId=e.feedbackId,C()}),(e=>{z(e)})):C()}(),AddFeedback}}}(),SingleFeedback={_role:[{},{},{2:[ZPI18N.getString("zp.lms.feedback.manager")]},{3:[ZPI18N.getString("zp.lms.settings.learner")]},{4:[ZPI18N.getString("zp.lms.all")]}],root:null,scrollElem:null,popup:null,htmlConf:{header:!0,updateHash:!0,headerClass:"zp_pvhd",attachScroll:!0,scrollQueryString:".zp_Lstwrap",scrollValue:.8,bodyClass:"zp_pcnt",headerHTML:'<div class="zp_micn"><ul><li><b><span><i _rel="close" class="IC-cls"></i></span></b></li></ul></div>',bodyHTML:'<div class="zp_fdbck" _rel="fkchart" style="display:none"></div><div class="zp_fdbfltr" _rel="fkfilter" style="display:none"></div><div class="zp_Pdesc" _rel="fkreview"></div>'},modeOfInvocation:"ques",refer:{sessionId:"",courseId:"",trainerId:"",feedbackOf:"",stars:"all",role:4,index:1,stats:!0,timeUpdaterValue:null,baseUri:"",prevHash:"",entityData:null},defaultValues:{role:4,stars:"all",batchId:"all",batchName:"All"},integ:!1,initiate:function(){SingleFeedback.modeOfInvocation=this.type,"hash"==this.type?SingleFeedback.hashMode(this):SingleFeedback.quesMode(this)},integrationMode:function(e){SingleFeedback.integ=!0,SingleFeedback.htmlConf.header=e.htmlConf.header,SingleFeedback.htmlConf.bodyClass=e.htmlConf.bodyClass},hashMode:function(e){"add"==e.mode&&(SingleFeedback.reInitialise(e),e.integ&&SingleFeedback.integrationMode(e),SingleFeedback.layoutConstruction(e)),SingleFeedback.hashHandling(e)},quesMode:function(e){SingleFeedback.htmlConf.bodyClass="zp_pcnt",SingleFeedback.reInitialise(e),(e.integ||e.hash&&"course"==lms.parseURIForAppInfo(e.hash).moduleStr)&&(SingleFeedback.integ=!0),SingleFeedback.layoutConstruction(),SingleFeedback.hashHandling(e)},hashHandling:function(e){var t=SingleFeedback.isHashValid(e.hashObject);t.isValid?SingleFeedback.updateRefer(t)&&(lmsfeedback.addorRemoveSelClass(SingleFeedback.refer[SingleFeedback.refer.feedbackOf+"Id"]),SingleFeedback.refer.index=1,null!=SingleFeedback.refer.entityData&&SingleFeedback.showHeader(SingleFeedback.refer.entityData),SingleFeedback.fetchFeedbacks()):SingleFeedback.revertHash()},updateRefer:function(e){var t=SingleFeedback.refer,s=SingleFeedback.defaultValues,r=!1;return t.feedbackOf!=e.feedbackOf&&(t.feedbackOf=e.feedbackOf,t.stats=r=!0,t.index=1),t[t.feedbackOf+"Id"]!=e.entityId&&(t[t.feedbackOf+"Id"]=e.entityId,t.stats=r=!0,t.index=1,t.entityData=null),SingleFeedback.integ&&(t.batchId="null"!=lmscourses.currentBatchId?lmscourses.currentBatchId:void 0,t.batchId=!lms.settingData[0].settingPermission.isDataAdmin||Number(lmscourses.currentBatchId)>0?t.batchId:"all"),e.isFilterMode&&(SingleFeedback.integ||t.batchId==e.filterObject.batchId||(t.batchId=e.filterObject.batchId||s.batchId,t.stats=r=!0),t.role!=e.filterObject.role&&(t.role=e.filterObject.role||s.role,r=!0),t.stars!=e.filterObject.stars&&(t.stars=e.filterObject.stars||s.stars,r=!0)),r},layoutConstruction:function(){SingleFeedback.root.innerHTML="","ques"==SingleFeedback.modeOfInvocation&&lmsbase.addClass(SingleFeedback.root,"zp_feedview");var e=SingleFeedback.htmlConf;if(e.header){var t=SingleFeedback.root.appendChild(document.createElement("div"));t.setAttribute("header",""),t.className=e.headerClass,t.innerHTML=e.headerHTML}var s=SingleFeedback.root.appendChild(document.createElement("div"));s.setAttribute("body",""),s.className=e.bodyClass,s.innerHTML=e.bodyHTML,SingleFeedback.scrollElem=s,lmsbase.addListener(SingleFeedback.scrollElem,"scroll",SingleFeedback.scrollHandle,!1),"hash"==SingleFeedback.modeOfInvocation&&lmsbase.addListener(SingleFeedback.root,"click",SingleFeedback.clickAction,!1)},isHashValid:function(e){SingleFeedback.integ;var t={},s="course"==e.level1||"trainer"==e.level1||"session"==e.level1,r=e.level2>0&&e.level2<=0x8000000000000000,l="object"==typeof e.level3&&"object"==typeof e.level3.filter;if((e={isValid:(s&&r)|(l&&(t=SingleFeedback.validateFilterParams(e.level3.filter))),feedbackOf:e.level1,entityId:e.level2,isFilterMode:l,filterObject:t}).isValid&&"course"==e.feedbackOf&&e.isFilterMode&&t.batchId&&"all"!=t.batchId&&!SingleFeedback.integ){var a=SingleFeedback.refer.entityData;if(a)if(2==a.typesysVal)if(null!=a.allbatches){var n=SingleFeedback.validateBatchId(a.allbatches,t.batchId);n?t.batchName=n.batchName:e.isValid=!1}else SingleFeedback.refer.info=!0;else delete t.batchId}return e},validateFilterParams:function(e){for(var t in e)if("batchId"==t){if(!(e[t]>=1&&e[t]<=0x8000000000000000||"all"==e[t].toLowerCase()))return!1}else if("role"==t){for(var s=SingleFeedback._role,r=!0,l=0;l<s.length&&r;l++)s[l][l]&&s[l][l][0].toLowerCase()==e[t].toLowerCase()&&(r=!1,e[t]=l);if(r)return!1}else{if("stars"!=t)return!1;if(!(e[t]>=1&&e[t]<=5||"all"==e[t].toLowerCase()))return!1}return e},fetchBatches:function(e,t){var s={method:"getBatchWithCnt",courseId:e,conreqcsr:csrfToken};$.post("/batchAction.zp",s,t)},validateBatchId:function(e,t){for(var s=0;s<e.length;s++)if(e[s].batchId==t)return e[s];return!1},showHeader:function(e){if(SingleFeedback.htmlConf.header){var t='<div class="zp_mark">',s=SingleFeedback.root.querySelector("[header]");if(e){var r=SingleFeedback.refer;if("course"==r.feedbackOf){var l=e.courseImageInfo;l.additionalInfo={fileId:e.courseId,type:6},t+='<div class="ZP_photo"><img src='+(l.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+l.imageID+".svg"):lmsfileaction.generateSourceURL(l))+"></div><h4>"+e.courseName+"</h4><font>"+(2!=e.typesysVal||SingleFeedback.integ?'<em class="zp_ldot"><p>'+e.courseOwnerInfo.name+"</p></em>":'<span class="zp_CBdwn" _rel="batch" batchId="'+SingleFeedback.refer.batchId+'">'+("all"!=SingleFeedback.refer.batchId?SingleFeedback.refer.batchName:ZPI18N.getString("zp.lms.all"))+'<i class="IC-up"></i></span>')+"</font>"}else"trainer"==r.feedbackOf?t+=lmsmessages.getUserDP(e.userInfo).outerHTML+"<h4>"+e.userInfo.name+'</h4><font><em class="zp_ldot"><p>'+e.coursesCount+"</p> "+ZPI18N.getString("zp.lms.feedback.courses")+"</em></font>":t+=lmsmessages.getUserDP(e.userInfo).outerHTML+"<h4>"+e.sessionName+'</h4><font><em class="zp_ldot"><p>'+e.userInfo.name+"</p></em></font>"}else t+="<h4>"+ZPI18N.getString("zp.lms.notfound")+"</h4>";t+="</div>"+SingleFeedback.htmlConf.headerHTML,s.innerHTML=t}},makeAndUpdateHash:function(){var e=SingleFeedback.refer,t="";t="/"+e.feedbackOf+"/"+e[e.feedbackOf+"Id"]+"/";var s={batchId:e.batchId,role:SingleFeedback._role[e.role][e.role][0].toLowerCase(),stars:e.stars};for(prop in("trainer"==e.feedbackOf||e.entityData&&1==e.entityData.typesysVal||"session"==e.feedbackOf||SingleFeedback.integ)&&delete s.batchId,t+="filter:",s)t+=prop+"="+s[prop]+"&";t=t.slice(0,t.length-1),e.prevHash="hash"==SingleFeedback.modeOfInvocation?e.baseUri+"feedback"+t:"feedbackinfo"+t,lms.changeHash(SingleFeedback.modeOfInvocation,e.prevHash,"disable")},revertHash:function(){SingleFeedback.refer.prevHash?lms.changeHash(SingleFeedback.modeOfInvocation,SingleFeedback.refer.prevHash,"disable"):"hash"==SingleFeedback.modeOfInvocation?lms.changeHash(SingleFeedback.modeOfInvocation,SingleFeedback.refer.baseUri+"feedback"):(lmsbase.removeQHash(),lmsbase.closeQHash())},clickAction:function(e){var t=(e=e||this.eve).target,s=t.getAttribute("_rel"),r=t.parentNode.getAttribute("_rel");if("close"==s)SingleFeedback.popupClose();else if("del"==s)lmsfeedback.deleteFeedbackOnConfirmation(t);else if("myrev"==s)"your"!=SingleFeedback.refer.stars&&lmsfeedback.showMyReview();else if("role"==s||"role"==r)SingleFeedback.changeRole("role"==s?t:t.parentNode,e);else if("starall"==s)SingleFeedback.refer.stars="all",SingleFeedback.refer.index=1,SingleFeedback.fetchFeedbacks(),SingleFeedback.showFilBar();else if("batch"==s||"batch"==r)SingleFeedback.showBatchListPopup(SingleFeedback.refer.courseId);else{var l=null;if(l=t.closest("[_strcnt]")){var a=l.getAttribute("_strcnt");SingleFeedback.refer.stars!=a&&(SingleFeedback.refer.stars=a,SingleFeedback.refer.index=1,SingleFeedback.fetchFeedbacks(),SingleFeedback.showFilBar())}}},fetchFeedbacks:function(){var e=SingleFeedback.refer,t={action:"fetchFeedback",startIndex:e.index,stats:e.stats};t.info=!Boolean(SingleFeedback.refer.entityData),"course"==e.feedbackOf?(t.courseId=e.courseId,"all"!=e.batchId&&(t.batchId=e.batchId||void 0)):"trainer"==e.feedbackOf?t.trainerId=e.trainerId:t.sessionId=e.sessionId,4!=e.role&&(t.role=e.role),"all"!=e.stars&&(t.stars=e.stars),1==e.index&&SingleFeedback.clearTimeUpdater(),$.get("/feedbackAction.zp",t,SingleFeedback.showFeedbacks)},showFeedbacks:function(e){var t=SingleFeedback.refer,s=1==t.index?"new":"update";if(e.info){if(t.entityData=e.info,SingleFeedback.isEmpty(e.info))return SingleFeedback.showHeader(),SingleFeedback.root.querySelector("[_rel='fkreview']").innerHTML='<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+e.message+"</h2></div>",SingleFeedback.hideChart(),SingleFeedback.hideFilBar(),!1;if("course"==t.feedbackOf&&2==t.entityData.typesysVal&&"all"!=t.batchId){var r=SingleFeedback.validateBatchId(t.entityData.allbatches,t.batchId);if(!r)return SingleFeedback.showHeader(),void(SingleFeedback.root.querySelector("[_rel='fkreview']").innerHTML='<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.lms.batches.nobatchfound")+"</h2></div>");t.batchName=r.batchName}SingleFeedback.showHeader(e.info)}SingleFeedback.makeAndUpdateHash(),t.stats&&(t.stats=!1,SingleFeedback.isEmpty(e.stats)||SingleFeedback.isEmpty(e.stats.stars)?(t.statsData={totaluser:0,averageRating:0,totalreview:0,stars:{"1star":0,"2star":0,"3star":0,"4star":0,"5star":0}},SingleFeedback.hideChart(),SingleFeedback.hideFilBar()):(t.statsData=e.stats,SingleFeedback.showChart(),SingleFeedback.showFilBar())),SingleFeedback.showReview(s,e.feedbackArray||[])},showChart:function(){var e,t=SingleFeedback.refer.statsData,s=this.root.querySelector("[_rel=fkchart]"),r=t.totalUsers;s.style.display="";var l='<div class="zp_fdalgn"><div class="zp_rtng"><div class="zp_Lrtng">';l+='<div class="zp_avrgrtng"><p>'+ZPI18N.getString("zp.lms.averagerating")+"</p><span>"+t.averageRating.toFixed(1)+'<span class="IC-star ylw"></span></span><em>'+(0==r?"No":r)+" "+ZPI18N.getString("zp.users")+"</em>"+(0!=lms.role&&1!=lms.role&&t.userReview?'<div class="zp_myrtng"><a><p _rel="myrev" '+lmstooltip._attrib+"="+ZPI18N.getString("zp.lms.feedback.seeyourreview")+">"+ZPI18N.getString("zp.lms.feedback.myrating")+"</p>"+SingleFeedback.getStarHtml(Math.floor(t.userReview?t.userReview.stars:0),!1,1,14)+"</a></div>":"")+"</div>";var a=t.totalReviews||-1;l+='<div class="zp_Lrtngcvr">';for(var n=5;n>=1;n--)e=t.stars[n]||0,l+='<div _strcnt="'+n+'">'+SingleFeedback.getStarHtml(n,!1)+"<span>"+n+" "+ZPI18N.getString("zp.lms.feedback.star")+'</span><div class="zp_rtngprg"><div style="width:'+Math.round(e/a*100)+'%;"></div></div><em>'+e+"</em></div>";l+="</div>",s.innerHTML=l+"</div></div></div>"},hideChart:function(){var e=this.root.querySelector("[_rel=fkchart]");e.innerHTML="",e.style.display="none"},showFilBar:function(){var e=this.root.querySelector("[_rel=fkfilter]"),t=this.refer.role;e.style.display="";var s,r,l=this._role[t];for(var a in l)s=a,r=l[a][0];var n="<span>"+("all"!=this.refer.stars?("your"!=this.refer.stars?ZPI18N.getString("zp.lms.feedback.showingreviewsmessage",[this.refer.stars]):ZPI18N.getString("zp.lms.feedback.showingyourreviewmessage"))+ZPI18N.getString("zp.lms.feedback.showallreviews",['<a _rel="starall" style="visibility:visible">'])+"</span>":ZPI18N.getString("zp.lms.feedback.showallstars")+" "+ZPI18N.getString("zp.lms.feedback.showallreviews",['<a _rel="starall" style="visibility:hidden">'])+"</span>");n+="course"==SingleFeedback.refer.feedbackOf?'<span _rel="role" rid="'+s+'">'+r+'<i class="IC-up"></i></span>':"",e.innerHTML=n},hideFilBar:function(){var e=this.root.querySelector("[_rel=fkfilter]");e.innerHTML="",e.style.display="none"},isFiltermode:function(){return"all"!=this.refer.stars},showReview:function(e,t){var s=this.root.querySelector("[_rel=fkreview]");"update"==e?SingleFeedback.removeLoading():"new"==e&&(t.length>0?(SingleFeedback.setTimeUpdater(),lmsnodata.clearNoData(s)):lmsnodata.showNoData({mode:SingleFeedback.isFiltermode()?"filter":"general",container:s,module:"Feedback",content:ZPI18N.getString("zp.lms.feedback.noreviewavailable")}));for(var r=document.createDocumentFragment(),l=0;l<t.length;l++){var a=t[l].feedbackFor;if(2==t[l].role&&a.length>0)for(var n=0;n<a.length;n++)r.appendChild(SingleFeedback.constructReviewElement(t[l],t[l].feedbackFor[n]));else r.appendChild(SingleFeedback.constructReviewElement(t[l]))}s.appendChild(r),25==t.length?(SingleFeedback.refer.index+=25,lmsfeedback.addLoading()):SingleFeedback.refer.index="end"},isFilterEnabled:function(){var e=SingleFeedback.refer;return"all"!=e.batchId||"all"!=e.stars||4!=e.role},constructReviewElement:function(e,t){var s,r,l;return r=(s=new Date(parseInt(e.postedTime,10)).diffTo(new Date,"minutes"))>1440?new Date(parseInt(e.postedTimeInMillis,10)).getDateBy("dd MMM yyyy"):s>60?Math.floor(s/60)+" "+ZPI18N.getString("zp.lms.feedback.hoursago"):s>0?s+" "+ZPI18N.getString("zp.lms.feedback.minutesago"):ZPI18N.getString("zp.lms.feedback.justnow"),(l=document.createElement("div")).className="zp_Fcnt",l.setAttribute("_feedbackId",e.feedbackId),l.innerHTML=lmsmessages.getUserDP(e.userInfo).outerHTML+'<span class="zp_rleshw">'+e.userInfo.name+(2==e.role&&t?"<span> "+ZPI18N.getString("zp.lms.for")+"</span> "+t.userInfo.name:"")+'</span><div class="zp_Rvstr"'+(Math.floor(s/1440)?"":"_diffMin="+s%1440)+">"+r+"</div>"+this.getStarHtml(e.stars,null,1,11)+(e.review?"<p>"+ZPeople.escapeHtml(e.review)+"</p>":""),l},timeUpdater:function(){timeStringMaker=function(){var e="",t=parseInt(this.getAttribute("_diffmin"),10);if(t<1440)e=t>60?Math.floor(t/60)+" "+ZPI18N.getString("zp.lms.feedback.hoursago"):t>0?t+" "+ZPI18N.getString("zp.lms.feedback.minutesago"):" "+ZPI18N.getString("zp.lms.feedback.justnow"),this.setAttribute("_diffmin",t);else{var s=new Date;s.setDate(s.getDate()-1),e=s.getDateBy("dd MMM yyyy"),this.removeAttribute("_diffmin")}this.textContent=e},$("[_feedbackid] > [_diffmin]",SingleFeedback._root).each((function(){var e=parseInt(this.getAttribute("_diffmin"),10);this.setAttribute("_diffmin",++e)})).each(timeStringMaker).length||SingleFeedback.clearTimeUpdater()},setTimeUpdater:function(){SingleFeedback.refer.timeUpdaterValue||(SingleFeedback.refer.timeUpdaterValue=window.setInterval(SingleFeedback.timeUpdater,6e4))},clearTimeUpdater:function(){window.clearInterval(SingleFeedback.refer.timeUpdaterValue),SingleFeedback.refer.timeUpdaterValue=null},getStarHtml:function(e,t,s,r){var l="<div"+(t?" class="+t+" ":' class="ZPmrate ML0I"')+">",a=1;if(s&&1==s)for(;a<=5;)l+='<div class="IC-star FL S'+r+" CP  "+(a<=e?"ylw":"gry")+'"></div>',a++;else{r=r||11;for(let t=1;t<=e;t++)l+=`<div class="IC-star S${r} CP ylw"></div>`}return l+"</div>"},showMyReview:function(){if(SingleFeedback.refer.stars="your",SingleFeedback.refer.statsData.userReview){var e=SingleFeedback.refer.statsData.userReview,t=ZPeople.getUserDetailsById(erecno);e.userInfo={},e.userInfo.name=t.name,e.userInfo.photoPath=t.thumb;var s=[];s.push(e),SingleFeedback.showReview("new",s)}else{var r=SingleFeedback._root.querySelector("[_rel=fkreview]");lmsnodata.showNoData({mode:"myreview",container:r,module:"Feedback",content:ZPI18N.getString("zp.lms.feedback.usernotwrittenreview")})}SingleFeedback.showFilBar()},scrollHandle:function(){"end"!=SingleFeedback.refer.index&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&SingleFeedback.fetchFeedbacks()},changeRole:function(e,t){lmsmenu.initiate({elem:e,width:"130px",type:"dropdown",arrowHead:!0,menulist:SingleFeedback._role,eve:t}).on("click",(function(){var e=this.value;e!=SingleFeedback.refer.role&&(SingleFeedback.refer.role=e,SingleFeedback.refer.index=1,"your"==SingleFeedback.refer.stars&&(SingleFeedback.refer.stars=SingleFeedback.defaultValues.stars),SingleFeedback.fetchFeedbacks(),this.referObj.elem.setAttribute("rid",SingleFeedback.refer.role),this.referObj.elem.textContent=this.content[1],this.referObj.elem.innerHTML+='<i class="IC-up"></i>')})).bind()},changeCourse:function(e,t){lmsmenu.initiate({elem:e,width:"200px",type:"dropdown",arrowHead:!0,menulist:function(e,t,s){for(var r=[],l={},a=0;a<e.length;a++)l[e[a][t]]=[e[a][s]],r.push(l),l={};return r}(SingleFeedback.courseData,"courseId","courseName"),eve:t}).on("click",(function(){var e=this.value;SingleFeedback._rfr.courseId!=e&&(SingleFeedback._rfr.courseId=e,SingleFeedback._rfr.courseName=this.content,SingleFeedback._rfr.inx=1,"your"==SingleFeedback._rfr.stars&&(SingleFeedback._rfr.stars="all"),SingleFeedback._rfr.stats=!0,SingleFeedback.fetchData(),SingleFeedback.setCourseMenu())})).bind()},addFeedback:function(){var e={courseId:lmsfeedback._refer[lmsfeedback._refer.feedbackFor].courseId,batchId:lmsfeedback._refer[lmsfeedback._refer.feedbackFor].batchId,role:AddFeedback.ROLE.LEARNER};AddFeedback.init(e,SingleFeedback.addFeedbackCallback)},addFeedbackCallback:function(e){if("success"==e.status){var t=SingleFeedback.refer;if(e.courseId==t.courseId){if(t.statsData.averageRating=(t.statsData.averageRating*t.statsData.totaluser+e.stars)/(t.statsData.totaluser+1),t.statsData.totalUser+=1,!("all"!=t.stars&&"your"!=t.stars&&t.stars!=e.stars||t.role!=e.role&&4!=t.role)){var s=ZPeople.getUserDetailsById(erecno);e.userInfo={name:s.name,photoPath:s.thumb};var r=SingleFeedback.root.querySelector("[_rel=fkreview]"),l=r.querySelector("[_feedbackid]"),a=SingleFeedback.constructReviewElement(e);l||lmsnodata.clearNoData(r),r.insertBefore(a,l),SingleFeedback.setTimeUpdater()}t.statsData.userReview=e,t.statsData.averageRating=(t.statsData.averageRating*t.statsData.totaluser+e.stars)/(t.statsData.totaluser+1),t.statsData.stars[e.stars+"star"]++,t.statsData.totaluser++}}},showBatchListPopup:function(e){var t=document.createElement("div");t.className="zp_popup",t.style.width="600px",t.innerHTML='<div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.batchList")+'</font><i class="IC-cls" _rel="close"></i></div><div class="zp_Pocnt" container style="max-height: 300px;"><ul list class="zp_CPlst zp_CSwtb">'+SingleFeedback.getBatchRow({batchName:ZPI18N.getString("zp.lms.all")}).outerHTML+"</ul>"+lmsdashboard.addLoading().outerHTML+"</div>",SingleFeedback.popup=lmsbase.showMaskLayer(),SingleFeedback.popup.appendChild(t),lmsbase.addListener(SingleFeedback.popup,"click",SingleFeedback.popup_clickHandle,!1),SingleFeedback.refer.entityData&&SingleFeedback.refer.entityData.allbatches?SingleFeedback.listBatches(SingleFeedback.refer.entityData.allbatches):SingleFeedback.fetchBatches(e,SingleFeedback.fetchBatchesCallback)},fetchBatches:function(e,t){var s={method:"getBatchWithCnt",courseId:e,conreqcsr:csrfToken};$.post("/batchAction.zp",s,t)},fetchBatchesCallback:function(e){SingleFeedback.refer.entityData.allbatches=e[1],SingleFeedback.listBatches(e[1])},listBatches:function(e){var t=SingleFeedback.popup.querySelector("[container]");if(lmsdashboard.removeLoading(t),e.length){for(var s=t.querySelector("[list]"),r=0;r<e.length;r++)s.appendChild(SingleFeedback.getBatchRow(e[r]));t.appendChild(s)}},getBatchRow:function(e){var t=document.createElement("li");return t.setAttribute("batch",""),t.batchInfo=e,t.appendChild(document.createElement("h4")).innerHTML=e.batchName,t},popup_clickHandle:function(e){var t,s=e.target;if("close"==s.getAttribute("_rel"))lmsbase.hideMaskLayer();else if(t=s.closest("[batch]")){var r=t.batchInfo;SingleFeedback.changeBatch(r),lmsbase.hideMaskLayer()}},changeBatch:function(e){e?SingleFeedback.refer.batchId!=e.batchId&&(SingleFeedback.refer.batchId=String(e.batchId),SingleFeedback.refer.batchName=e.batchName,SingleFeedback.refer.index=1,SingleFeedback.refer.stats=!0,SingleFeedback.fetchFeedbacks()):"all"!==SingleFeedback.refer.batchId&&(SingleFeedback.refer.batchId="all",SingleFeedback.refer.batchName="All",SingleFeedback.refer.index=1,SingleFeedback.refer.stats=!0,SingleFeedback.fetchFeedbacks()),SingleFeedback.updateBatchName()},updateBatchName:function(){var e=SingleFeedback.root.querySelector("[_rel=batch]");e.innerHTML=SingleFeedback.refer.batchName;var t=document.createElement("i");t.className="IC-up",e.appendChild(t)},deleteFeedbackOnConfirmation:function(e){e.closest(".zp_Fcnt").getAttribute("_feedbackId");ZPeople.BSModal.confirm((function(){SingleFeedback.deleteFeedback(params),null}))},deleteFeedback:function(e,t){var s={action:"deleteFeedback",feedbackId:e,isCourseFeedback:"course"==SingleFeedback.refer.feedbackOf,conreqcsr:csrfToken};$.post("/feedbackAction.zp",s,(function(e){if("success"==e.status){var t=lmsfeedback._root.querySelector("[_feedbackId='"+e.feedbackId+"']"),s=t.querySelectorAll(".IC-star.ylw").length;if(t.parentNode.removeChild(t),lmsfeedback.courseStat.stars[s+"star"]--,lmsfeedback.courseStat.totaluser--,lmsfeedback.courseStat.userReview=null,lmsfeedback.courseStat.totaluser)lmsfeedback.courseStat.averageRating=(lmsfeedback.courseStat.averageRating*(lmsfeedback.courseStat.totaluser+1)-s)/lmsfeedback.courseStat.totaluser,lmsfeedback.showChart(),lmsfeedback.showFilBar();else{lmsfeedback.courseStat.averageRating=0,lmsfeedback.hideChart(),lmsfeedback.hideFilBar(),lmsfeedback.clearTimeUpdater();var r=lmsfeedback._root.querySelector("[_rel=fkreview]");lmsnodata.showNoData({mode:"ondelete",container:r,module:"Feedback",args:ZPI18N.getString("zp.lms.feedback.noreviewavailable")})}}lmsfeedback.params=null}))},popupClose:function(){lmsbase.closeQHash(),lmsbase.removeQHash(),lmsfeedback.addorRemoveSelClass(),SingleFeedback.refer={sessionId:"",courseId:"",trainerId:"",feedbackOf:"",stars:"all",role:4,index:1,stats:!0,timeUpdaterValue:null,baseUri:"",prevHash:"",entityData:null}},isEmpty,reInitialise:function(e){SingleFeedback.root=e.elem,SingleFeedback.scrollElem=null,SingleFeedback.popup=null;SingleFeedback.refer={feedbackOf:e.feedbackOf,courseId:e.courseId||"",trainerId:e.trainerId||"",batchId:e.batchId||SingleFeedback.defaultValues.batchId,batchName:e.batchName||SingleFeedback.defaultValues.batchName,stars:"all",role:4,index:1,stats:!0,timeUpdaterValue:null,entityData:e.entityData||null,statsData:{totaluser:0,averageRating:0,totalreview:0,stars:{"1star":0,"2star":0,"3star":0,"4star":0,"5star":0}},baseUri:e.baseUri||"",prevHash:""},SingleFeedback.integ=!1,SingleFeedback.htmlConf.header=!0},close:function(){SingleFeedback.clearTimeUpdater(),lmsbase.removeListener(SingleFeedback._root,"click",SingleFeedback.handle,!1),SingleFeedback.htmlConf.attachScroll&&lmsbase.removeListener(SingleFeedback.scrollElem,"scroll",SingleFeedback.scrollHandle,!1),SingleFeedback.reInitialise()}},lmsfeedback_survey_integration={EVENT_TYPE:{TEMPLATE_ADDED:"template_added",TEMPLATE_EDITED:"template_edited"},onTemplateAdded:function(e){lmsfeedback_survey_integration.dispatchEvent({type:lmsfeedback_survey_integration.EVENT_TYPE.TEMPLATE_ADDED,templateInfo:lmsfeedback_survey_integration.formatTemplateJSON(e)})},onTemplateEdited:function(e){lmsfeedback_survey_integration.dispatchEvent({type:lmsfeedback_survey_integration.EVENT_TYPE.TEMPLATE_EDITED,templateInfo:lmsfeedback_survey_integration.formatTemplateJSON(e)})},formatTemplateJSON:function(e){return{name:e.template_name,templateId:e.template_id,type:1}}};zplms.setupEventManager(lmsfeedback_survey_integration);var lmsfeedback_v1={EVENT_TYPE:{FEEDBACK_COMPLETION:"feedback_completion",FEEDBACK_SKIPPED:"feedback_skipped"},sendRequestToFetchInitFeedbackTabData:function(e,t,s,r){var l="/lms/courses/"+e+(t?/batches/+t:"")+"/feedbacks/init";zplms.get(l,null,s,r)},exportFeedback:function(e,t,s,r,l,a,n,i){let o="lms/courses/"+t+"/feedbacks/export";if(!e)throw new Error("Export type required");o+="?exportType="+parseInt(e),s&&(o+="&batchId="+s),r&&(o+="&sessionId="+r),l&&(o+="&trainerId="+l),a&&(o+="&ownerErecno="+a),n&&(o+="&learnerErecno="+n),void 0!==i&&(o+="&type="+i),lmsExportDetails.sendRequest(o)},sendRequestToFetchInitCourseFeedbackSettingsTabData:function(e,t,s){var r="/lms/courses/"+e+"/settings/feedback/init";zplms.get(r,null,t,s)},sendRequestToFetchCourseTemplates:function(e,t,s,r,l,a,n){var i="/lms/courses/"+e+"/settings/feedback/templates",o={startIndex:r,onlyTagged:t};s&&(o.search=s),zplms.get(i,o,a,n)},sendRequestToDeleteCourseTemplate:function(e,t,s,r){var l="/lms/courses/"+e+"/settings/feedback/templates/"+t;zplms.delete(l,null,s,r)},sendRequestToFetchCourseFeedbackSettings:function(e,t,s,r){var l="/lms/courses/"+e+"/settings/feedback",a={version:t};zplms.get(l,a,s,r)},sendRequestToUpdateCourseFeedbackSettings:function(e,t,s,r){var l="/lms/courses/"+e+"/settings/feedback";zplms.put(l,{settingsData:JSON.stringify(t)},s,r)},sendRequestToFetchCourseFeedbacks:function(e,t,s,r,l,a,n,i){var o="/lms/courses/"+e+(t?/batches/+t:"")+"/feedbacks",c={};r&&(c.version=r),s&&(c.role=s),l&&(c.ownerErecno=l),a&&(c.startIndex=a),zplms.get(o,c,n,i)},sendRequestFetchSessionFeedbacks:function(e,t,s,r,l,a,n){var i="/lms/courses/"+e+(t?/batches/+t:"")+"/sessions"+(s?"/"+s:"")+"/feedbacks",o={};r&&(o.ownerErecno=r),l&&(o.startIndex=l),zplms.get(i,o,a,n)},sendRequestToFetchTrainerFeedbacks:function(e,t,s,r,l,a,n){var i="/lms/courses/"+e+(t?/batches/+t:"")+"/trainers"+(s?"/"+s:"")+"/feedbacks",o={};r&&(o.ownerErecno=r),l&&(o.startIndex=l),zplms.get(i,o,a,n)},sendRequestToFetchSessionFeedbackStats:function(e,t,s,r,l){var a="/lms/courses/"+e+(t?/batches/+t:"")+"/sessions"+(s?"/"+s:"")+"/feedbacks/stats";zplms.get(a,null,r,l)},sendRequestToFetchTrainerFeedbackStats:function(e,t,s,r,l){var a="/lms/courses/"+e+(t?/batches/+t:"")+"/trainers"+(s?"/"+s:"")+"/feedbacks/stats";zplms.get(a,null,r,l)},sendRequestToFetchSessions:function(e,t,s,r,l,a,n){var i="/lms/courses/"+e+(t?/batches/+t:"")+"/feedbacks/sessions";zplms.get(i,{search:s,startIndex:r,reporteeId:n},l,a)},sendRequestToStartFeedback:function(e,t,s,r){var l="/lms/courses/"+e+(t&&t>0?/batches/+t:"")+"/feedbacks/start";zplms.post(l,null,s,r)},sendRequestToSkipFeedback:function(e,t,s,r){var l="/lms/courses/"+e+(t?/batches/+t:"")+"/feedbacks/skip";zplms.post(l,null,s,r)},sendRequestToSubmitFeedback:function(e,t,s,r,l){var a="/lms/courses/"+(currentCourseId||lmscourses.currentCourseId)+"/feedbacks/"+e+"/submit",n={stars:t,review:s};zplms.post(a,n,r,l),lmscoursedetails.isMandatoryFeedback&&lmscoursedetails.getCourseEntityProgress()},sendRequestToStartLearnerFeedback:function(e,t,s,r){var l="/lms/courses/"+lmscourses.currentCourseId+"/batches/"+lmscourses.currentBatchId+"/sessions/"+e+"/learners/"+t+"/feedbacks/start";zplms.post(l,{},s,r)},sendRequestToSubmitLearnerFeedback:function(e,t,s,r,l){let a="/lms/courses/"+lmscourses.currentCourseId+"/batches/"+lmscourses.currentBatchId+"/sessions/"+e+"/feedbacks/"+t+"/submit",n={review:s};zplms.post(a,n,r,l)},getFeedbackForLearner:function(e,t,s,r){let l="/lms/courses/"+lmscourses.currentCourseId+"/batches/"+lmscourses.currentBatchId+"/learners/"+(e?e+"/":"")+"feedbacks";zplms.get(l,{startIndex:t},s,r)},getFeedbackForLearnerBySession:function(e,t,s,r,l){let a="/lms/courses/"+lmscourses.currentCourseId+"/batches/"+lmscourses.currentBatchId+"/sessions/"+e+"/learners/"+(t?t+"/":"")+"feedbacks";zplms.get(a,{startIndex:s},r,l)},getFeedbackForLearnerByTrainer:function(e,t,s,r,l){let a="/lms/courses/"+lmscourses.currentCourseId+"/batches/"+lmscourses.currentBatchId+"/trainers/"+e+"/learners/"+(t?t+"/":"")+"feedbacks";zplms.get(a,{startIndex:s},r,l)},sendRequestToNotifyPendingUsers:function(e,t,s,r){var l="/lms/courses/"+e+(t?/batches/+t:"")+"/feedbacks/pendingUsers/notify";zplms.post(l,null,s,r)},writeFeedback:function(e,t){var s={courseId:e,batchId:t||null,role:AddFeedback.ROLE.LEARNER};AddFeedback.init(s,null)},skipFeedback:function(e,t){this.sendRequestToSkipFeedback(e,t,(function(s){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.feedback.skipFeedback.message.success")),lmsfeedback_v1.dispatchEvent({type:lmsfeedback_v1.EVENT_TYPE.FEEDBACK_SKIPPED,feedbackInfo:{courseId:e,batchId:t,status:ZPI18N.getString("zp.skiped"),canUserSkipFeedback:!1,hasUserSkipped:!0}})}),(function(e){e.responseJSON.code,ZPeople.Message.showFailureMsg(e.responseJSON.message)}))},constructReviewElement:function(e,t){var s,r,l;return r=(s=new Date(parseInt(e.postedTime,10)).diffTo(new Date,"minutes"))>1440?new Date(parseInt(e.postedTime,10)).getDateBy("dd MMM yyyy"):s>60?Math.floor(s/60)+" "+ZPI18N.getString("zp.lms.feedback.hoursago"):s>0?s+" "+ZPI18N.getString("zp.lms.feedback.minutesago"):ZPI18N.getString("zp.lms.feedback.justnow"),(l=document.createElement("div")).className="zp_Fcnt",l.setAttribute("_feedbackId",e.feedbackId),l.innerHTML=zplms.getUserDPNode(e.owner,"displayName","displayPictureURL").outerHTML+'<span class="zp_rleshw">'+e.owner.displayName+("manager"==e.role&&t?"<span> "+ZPI18N.getString("zp.lms.for")+"</span> "+zplms.encodeHTML(t.displayName):"")+'</span><div class="zp_Rvstr"'+(Math.floor(s/1440)?"":"_diffMin="+s%1440)+">"+r+"</div>"+(e.stars>-1?SingleFeedback.getStarHtml(e.stars,null,1,11):"")+(e.review?"<p>"+ZPeople.escapeHtml(e.review)+"</p>":""),l},constructReviewElementForLearner:function(e){var t,s,r;return s=(t=new Date(parseInt(e.postedTime,10)).diffTo(new Date,"minutes"))>1440?new Date(parseInt(e.postedTime,10)).getDateBy("dd MMM yyyy"):t>60?Math.floor(t/60)+" "+ZPI18N.getString("zp.lms.feedback.hoursago"):t>0?t+" "+ZPI18N.getString("zp.lms.feedback.minutesago"):ZPI18N.getString("zp.lms.feedback.justnow"),(r=document.createElement("div")).className="zp_Fcnt",r.setAttribute("_feedbackId",e.feedbackId),r.innerHTML=zplms.getUserDPNode(e.learnerInfo,"displayName","displayPictureURL").outerHTML+'<span class="zp_rleshw">'+e.learnerInfo.displayName+"<span> "+ZPI18N.getString("zp.sby")+"</span> "+e.owner.displayName+(e.sessionName?"<span> for</span> "+e.sessionName:"")+'</span><div class="zp_Rvstr"'+(Math.floor(t/1440)?"":"_diffMin="+t%1440)+">"+s+"</div>"+(e.stars>-1?SingleFeedback.getStarHtml(e.stars,null,1,11):"")+(e.review?"<p>"+e.review+"</p>":""),r},createCourseFeedbackView:function(){function e(e,t,s,r){this.courseId=e,this.batchId=t,this.courseType=parseInt(s),this.container=r}function t(e){return{start:function(){e.construct()},onscroll:function(t){e.onscroll(t)}}}return e.prototype.construct=function(){this.preRequestConstruction(),this.fetchDataAndPostRequestConstruction()},e.prototype.preRequestConstruction=function(){zplms.addLoadingBar(this.container)},e.prototype.fetchDataAndPostRequestConstruction=function(){var e=this;this.sendRequestToFetchInitData((function(t){e.fetchDataSuccessCallback(t)}),(function(t){e.fetchDataFailureCallback(t)}))},e.prototype.sendRequestToFetchInitData=function(e,t){lmsfeedback_v1.sendRequestToFetchInitFeedbackTabData(this.courseId,this.batchId,e,t)},e.prototype.fetchDataSuccessCallback=function(e){this.stats=e.data.stats,this.canUserNotifyPendingUsers=e.data.canUserNotifyPendingUsers,this.currentTemplate=e.data.latestTemplate,this.templateId=this.currentTemplate.templateId,this.postRequestConstruction(),this.state=2},e.prototype.fetchDataFailureCallback=function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)},e.prototype.postRequestConstruction=function(){zplms.removeLoadingBar(this.container),this.constructStatsBar(),this.constructTabs(),this.changeCourseTab()},e.prototype.constructStatsBar=function(){var e=document.createElement("div");e.className="zp_dfeed";var t="<div><div><h4>"+ZPI18N.getString("zp.lms.feedback.averagerating")+"</h4>"+lmsfeedback.getStarHtml(this.stats.averageRating,null,1,16).outerHTML+"</div><div><ul><li><b>"+this.stats.totalResponses+"</b><p>"+ZPI18N.getString("zp.responses")+"</p></li><li><b>"+this.stats.pendingResponses+"</b><p>"+ZPI18N.getString("zp.pending")+"</p>"+(this.stats.pendingResponses>0&&this.canUserNotifyPendingUsers?'<a action="notifyPendingUsers">'+ZPI18N.getString("zp.sendreminder")+"</a>":"")+"</li></ul></div></div>";if(e.innerHTML=t,this.notifyButtonElement=e.querySelector("[action='notifyPendingUsers']"),this.notifyButtonElement){this.notifyButtonElement.removeAttribute("action");var s=this;lmsbase.addListener(this.notifyButtonElement,"click",(function(){s.notifyPendingUsers()}))}this.container.appendChild(e)},e.prototype.notifyPendingUsers=function(){var e=this;lmsfeedback_v1.sendRequestToNotifyPendingUsers(this.courseId,this.batchId,(function(){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.notification.message.success")),e.hideNotifyButton()}),(function(e){var t=e.responseJSON;t.code,ZPeople.Message.showFailureMsg(t.message)}))},e.prototype.hideNotifyButton=function(){lmsbase.addClass(this.notifyButtonElement,"zp_dyn")},e.prototype.constructTabs=function(){var e=document.createElement("div");e.className="zp_Tabs";var t,s='<div templateMenuContainer class="zp_frt DFI zp_dyn"><span class="dgry MR15">'+ZPI18N.getString("zp.template")+' :</span><div class="zp_Smsub"><div templateMenuNode class="zp_Sm W120 zp_nobr MT0I"></div></div></div><ul><li tabName="course">'+ZPI18N.getString("zp.lms.course")+"</li>"+(2===this.courseType&&this.batchId?'<li tabName="session">'+ZPI18N.getString("zp.lms.session")+'</li><li tabName="learner">'+ZPI18N.getString("zp.lms.learner")+"</li>":"")+"</ul>";if(e.innerHTML=s,this.container.appendChild(e),(t=document.createElement("div")).className="zp_fdcnt assessment",lmsbase.addClass(t,"zp_dyn"),this.defaultCourseTabContainer=t,this.container.appendChild(t),(t=document.createElement("div")).className="zp_fdcnt assessment",lmsbase.addClass(t,"zp_dyn"),this.container.appendChild(t),this.customCourseTabContainer=t,2==this.courseType&&this.batchId){var r=document.createElement("div");r.className="zp_fdcnt assessment",lmsbase.addClass(r,"zp_dyn"),this.sessionTabContainer=r,this.container.appendChild(r);let e=document.createElement("div");e.className="zp_fdcnt assessment",lmsbase.addClass(e,"zp_dyn"),this.learnerTabContainer=e,this.container.appendChild(e)}this.templateMenuContainer=this.container.querySelector("[templateMenuContainer]"),this.templateMenuContainer.removeAttribute("templateMenuContainer");var l=this.templateMenuContainer.querySelector("[templateMenuNode]");l.removeAttribute("templateMenuNode"),this.templateMenuNode=l;var a={};a[1==this.currentTemplate.type?this.currentTemplate.templateId:"default"]=[zplms.encodeHTML(this.currentTemplate.name)],lmsmenu.changeToSelectMenu(l,a,"single",null,ZPI18N.getString("zp.select"));var n=this;lmsbase.addListener(l,"click",(function(){n.showTemplateMenu()})),this.courseTabElement=this.container.querySelector("[tabName=course]"),this.courseTabElement.removeAttribute("tabName"),lmsbase.addListener(this.courseTabElement,"click",(function(){n.changeCourseTab()})),this.sessionTabElement=this.container.querySelector("[tabName=session]"),this.sessionTabElement&&(this.sessionTabElement.removeAttribute("tabName"),lmsbase.addListener(this.sessionTabElement,"click",(function(){n.changeSessionTab()}))),this.learnerTabElement=this.container.querySelector("[tabName=learner]"),this.learnerTabElement&&(this.learnerTabElement.removeAttribute("tabName"),lmsbase.addListener(this.learnerTabElement,"click",(()=>n.changeLearnerTab())))},e.prototype.showTemplateMenu=function(){var e=this;lmsmenu.initiate({elem:this.templateMenuNode,type:"select",mode:"single",menulist:function(){var t=this;lmsfeedback_v1.sendRequestToFetchCourseTemplates(e.courseId,!0,t.value,0,25,(function(e){for(var s=e.templates,r={},l=0,a=s.length;l<a;l++)0==s[l].type?r.default=[zplms.encodeHTML(s[l].name)]:r[s[l].templateId]=[zplms.encodeHTML(s[l].name)];t.updateOptionList(r)}),(function(){t.updateOptionList({})}))}}).on("click",(function(){e.changeTemplate("default"==this.value?null:this.value)})).bind()},e.prototype.showCourseTab=function(){lmsbase.addClass(this.courseTabElement,"sel"),lmsbase.removeClass(this.templateId?this.customCourseTabContainer:this.defaultCourseTabContainer,"zp_dyn")},e.prototype.hideCourseTab=function(){lmsbase.removeClass(this.courseTabElement,"sel"),lmsbase.addClass(this.defaultCourseTabContainer,"zp_dyn"),lmsbase.addClass(this.customCourseTabContainer,"zp_dyn")},e.prototype.showSessionTab=function(){this.sessionTabElement&&(lmsbase.addClass(this.sessionTabElement,"sel"),lmsbase.removeClass(this.sessionTabContainer,"zp_dyn"))},e.prototype.hideSessionTab=function(){this.sessionTabElement&&(lmsbase.removeClass(this.sessionTabElement,"sel"),lmsbase.addClass(this.sessionTabContainer,"zp_dyn"))},e.prototype.showLearnerTab=function(){this.learnerTabElement&&(lmsbase.addClass(this.learnerTabElement,"sel"),lmsbase.removeClass(this.learnerTabContainer,"zp_dyn"))},e.prototype.hideLearnerTab=function(){this.learnerTabElement&&(lmsbase.removeClass(this.learnerTabElement,"sel"),lmsbase.addClass(this.learnerTabContainer,"zp_dyn"))},e.prototype.showTemplateMenuContainer=function(){lmsbase.addClass(this.templateMenuContainer,"DFI"),lmsbase.removeClass(this.templateMenuContainer,"zp_dyn")},e.prototype.hideTemplateMenuContainer=function(){lmsbase.addClass(this.templateMenuContainer,"zp_dyn"),lmsbase.removeClass(this.templateMenuContainer,"DFI")},e.prototype.changeCourseTab=function(){"course"!=this.currentTab&&(this.currentTab="course",this.showTemplateMenuContainer(),this.hideSessionTab(),this.hideLearnerTab(),this.resetScroll(),this.courseTabView||this.customFeedbackView||this.constructCourseTabView(),this.showCourseTab())},e.prototype.showCourseContainer=function(){this.templateId?(lmsbase.removeClass(this.customCourseTabContainer,"zp_dyn"),lmsbase.addClass(this.defaultCourseTabContainer,"zp_dyn")):(lmsbase.addClass(this.customCourseTabContainer,"zp_dyn"),lmsbase.removeClass(this.defaultCourseTabContainer,"zp_dyn"))},e.prototype.constructCourseTabView=function(){this.templateId?(this.customCourseTabContainer=zplms.replaceWithClone(this.customCourseTabContainer),this.invokeCustomFeedback(this.courseId,this.batchId,this.templateId,this.customCourseTabContainer),this.customFeedbackView=!0):(this.courseTabView||(this.courseTabView=lmsfeedback_v1.createCourseFeedbackListingView(this.courseId,this.batchId,null,this.defaultCourseTabContainer),this.courseTabView.start()),this.customFeedbackView=!1),this.showCourseContainer()},e.prototype.changeSessionTab=function(){"session"!=this.currentTab&&(this.currentTab="session",this.hideTemplateMenuContainer(),this.hideCourseTab(),this.hideLearnerTab(),this.resetScroll(),this.constructSessionTabView(),this.showSessionTab())},e.prototype.constructSessionTabView=function(){this.sessionTabView||(this.sessionTabView=lmsfeedback_v1.createSessionFeedbackListingView(this.courseId,this.batchId,this.sessionTabContainer),this.sessionTabView.start())},e.prototype.changeTemplate=function(e){this.templateId!=e&&(this.templateId=e,this.refreshCourseTabView())},e.prototype.refreshCourseTabView=function(){this.constructCourseTabView()},e.prototype.invokeCustomFeedback=function(e,t,s,r){ZPFeedbackStats(s,r,e,t)},e.prototype.onscroll=function(e){switch(this.currentTab){case"learner":return this.learnerTabView&&this.learnerTabView.onscroll(e);case"session":return this.sessionTabView&&this.sessionTabView.onscroll(e);case"course":return!this.customFeedbackView&&this.courseTabView&&this.courseTabView.onscroll(e)}},e.prototype.changeLearnerTab=function(){"learner"!==this.currentTab&&(this.currentTab="learner",this.hideTemplateMenuContainer(),this.hideCourseTab(),this.hideSessionTab(),this.resetScroll(),this.constructLearnerTabView(),this.showLearnerTab())},e.prototype.constructLearnerTabView=function(){this.learnerTabView||(this.learnerTabView=lmsfeedback_v1.createLearnerFeedbackListingView(this.courseId,this.batchId,this.learnerTabContainer),this.learnerTabView.start())},e.prototype.resetScroll=function(){document.getElementById("courseContainer").scroll(0,0)},function(s,r,l,a){return new t(new e(s,r,l,a))}}(),createCourseFeedbackListingView:function(){function e(e,t,s,r){this.courseId=e,this.batchId=t,this.container=r,this.state=0,this.role="learner",this.ownerErecno=null,this.startIndex=1,this.version=s}function t(e){return{start:function(){e.construct()},onscroll:function(t){e.onscroll(t)}}}return e.prototype.construct=function(){this.preRequestConstruction(),this.constructFeedbackListingView()},e.prototype.preRequestConstruction=function(){var e=document.createElement("div");e.className="zp_Alft";var t='<div class="fdbck_rprt"><div class="zp_ACcnt"><div class="zp_ACwel"><div class="zp_flter"><div class="zp_fltcnt"><div class="zp_revw"><div class="zp_btn"><div class="zp_Mtfil"><div class="MB0I"><div class="exprtbtn"><label><i class="IC-exprt" style="vertical-align: baseline;"></i><b style="vertical-align: baseline;">'+ZPI18N.getString("zp.export")+'</b></label></div></div></div></div></div><div class="zp_Mtfil"><div><div roleMenuNode class="fcs"></div><div ownerMenuNode class="zp_Sm"></div></div></div></div></div><div container="listing" class="zp_Pdesc"></div></div></div></div>';e.innerHTML=t,this.listingContainer=e.querySelector("[container=listing]"),this.listingContainer.removeAttribute("container"),this.container.appendChild(e);var s=e.querySelector("[roleMenuNode]");s.removeAttribute("roleMenuNode"),this.roleMenuNode=s;var r=e.querySelector("[ownerMenuNode]");r.removeAttribute("ownerMenuNode"),this.ownerMenuNode=r;var l={id:this.role,value:ZPI18N.getString("zp.lms.learner")};lmsmenu.changeToDropSelectMenu(s,l,"IC-users"),s.querySelector(".IC-adwn").remove();var a={};a.all=[ZPI18N.getString("zp.all")],lmsmenu.changeToSelectMenu(r,a||{},"single",null,ZPI18N.getString("zp.all"));var n=this;lmsbase.addListener(r,"click",(function(){n.showOwnerMenu()})),lmsbase.addListener(e.querySelector(".exprtbtn"),"click",(function(){n.sendRequestToExportFeedback()}))},e.prototype.constructFeedbackListingView=function(){this.listingContainer=zplms.replaceWithClone(this.listingContainer),zplms.addLoadingBar(this.listingContainer);var e=this;this.sendRequestToFetchFeedbacks((function(t){e.fetchDataSuccessCallback(t)}),(function(t){e.fetchDataFailureCallback(t)}))},e.prototype.fetchDataAndPostRequestConstruction=function(){var e=this;this.sendRequestToFetchFeedbacks((function(t){e.fetchDataSuccessCallback(t)}),(function(){e.fetchDataFailureCallback(response)}))},e.prototype.sendRequestToExportFeedback=function(){if(!this.listingContainer.querySelector(".zp_Fcnt"))return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.feedback.cannot.be.exported"));let e=this;lmsExportEntityDetailsPopup.openExportPopUp((function(t){lmsfeedback_v1.exportFeedback(t,e.courseId,void 0,void 0,void 0,void 0,void 0,AddFeedback.TYPE.COURSE)}))},e.prototype.sendRequestToFetchFeedbacks=function(e,t){var s=this;lmsfeedback_v1.sendRequestToFetchCourseFeedbacks(this.courseId,this.batchId,this.role,this.version,this.ownerErecno,this.startIndex,(function(t){s.startIndex=t.hasMoreRecords?s.startIndex+25:"end",e(t)}),t)},e.prototype.fetchDataSuccessCallback=function(e){this.postRequestConstruction(e.feedbacks,e.hasMoreRecords)},e.prototype.fetchDataFailureCallback=function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)},e.prototype.postRequestConstruction=function(e,t){e.length>0?this.addFeedbacksToView(e,t):lmsnodata.showNoData({mode:"filter",container:this.listingContainer,module:"Feedback",content:ZPI18N.getString("zp.lms.feedback.noreviewavailable")})},e.prototype.onscroll=function(e){"end"!=this.startIndex&&e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight<1&&this.updateFeedbackListingView()},e.prototype.updateFeedbackListingView=function(e,t){var s=this;this.sendRequestToFetchFeedbacks((function(e){s.addFeedbacksToView(e.feedbacks,e.hasMoreRecords)}),(function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)}))},e.prototype.addFeedbacksToView=function(e,t){zplms.removeLoadingBar(this.listingContainer);for(var s=document.createDocumentFragment(),r=0;r<e.length;r++){var l=e[r].feedbackFor;if("manager"==e[r].role&&l.length>0)for(var a=0;a<l.length;a++)s.appendChild(lmsfeedback_v1.constructReviewElement(e[r],l[a]));else s.appendChild(lmsfeedback_v1.constructReviewElement(e[r]))}t&&zplms.addLoadingBar(s),this.listingContainer.appendChild(s)},e.prototype.showRoleMenu=function(e){var t=this;lmsmenu.initiate({elem:this.roleMenuNode,width:"155px",type:"dropdown",arrowHead:!1,menulist:[{learner:[ZPI18N.getString("zp.lms.settings.learner")]},{manager:[ZPI18N.getString("zp.lms.feedback.manager")]}]}).on("click",lmsmenu.updateDropMenuSelection).on("click",(function(){t.changeRole(this.value)})).bind()},e.prototype.changeRole=function(e){if(this.role!=e){var t={};t.all=[ZPI18N.getString("zp.all")],this.ownerMenuNode.innerHTML="",lmsmenu.changeToSelectMenu(this.ownerMenuNode,t||{},"single",null,ZPI18N.getString("zp.all")),this.role=e,this.ownerErecno=null,this.refreshFeedbackListingView()}},e.prototype.showOwnerMenu=function(e){var t=this;lmsmenu.initiate({elem:this.ownerMenuNode,type:"select",mode:"single",allow_new:!1,menulist:function(){var e=this;"learner"==t.role&&lmsmembers.sendRequestToFetchLearners(t.courseId,t.batchId,e.value,null,null,(function(t){for(var s=t.learners,r={all:[ZPI18N.getString("zp.all")]},l=0;l<s.length;l++)r[s[l].erecno]=[zplms.encodeHTML(s[l].displayName)];e.updateOptionList(r)}))}}).on("click",(function(e){t.changeOwnerErecno("all"==this.value?null:this.value)})).on("update",(function(e){})).bind()},e.prototype.changeOwnerErecno=function(e){e!=this.ownerErecno&&(this.ownerErecno=e,this.refreshFeedbackListingView())},e.prototype.refreshFeedbackListingView=function(){this.startIndex=1,this.constructFeedbackListingView()},function(s,r,l,a){return new t(new e(s,r,l,a))}}(),createSessionFeedbackListingView:function(){function e(e,t,s){this.courseId=e,this.batchId=t,this.container=s,this.type="session",this.sessionId=null,this.trainerId=null,this.ownerErecno=null,this.startIndex=1}function t(e){return{start:function(){e.construct()},onscroll:function(t){e.onscroll(t)}}}return e.prototype.construct=function(){this.preRequestConstruction(),this.constructFeedbackListingView()},e.prototype.preRequestConstruction=function(){var e=document.createElement("div");e.className="zp_Alft";e.innerHTML='<div class="fdbck_rprt"><div class="zp_ACcnt"><div class="zp_ACwel"><div class="zp_flter"><div class="zp_fltcnt"><div container="stats" class="zp_revw"></div><div class="zp_Mtfil"><div><div typeMenuNode class="fcs"></div><div valueMenuNode class="zp_Sm"></div></div></div></div></div><div container="listing" class="zp_Pdesc"></div></div></div></div>',this.listingContainer=e.querySelector("[container=listing]"),this.listingContainer.removeAttribute("container"),this.statsContainer=e.querySelector("[container=stats]"),this.statsContainer.removeAttribute("container"),this.appendExportButton(this.statsContainer),this.container.appendChild(e);var t=e.querySelector("[typeMenuNode]");t.removeAttribute("typeMenuNode"),this.typeMenuNode=t;var s=e.querySelector("[valueMenuNode]");s.removeAttribute("valueMenuNode"),this.valueMenuNode=s;var r={id:this.type,value:"session"==this.type?ZPI18N.getString("zp.lms.session"):"trainer"==this.type?ZPI18N.getString("zp.lms.trainer"):ZPI18N.getString("zp.lms.learner")};lmsmenu.changeToDropSelectMenu(t,r,"IC-users");var l={};l.all=[ZPI18N.getString("zp.all")],lmsmenu.changeToSelectMenu(s,l||{},"single",null,ZPI18N.getString("zp.all"));var a=this;lmsbase.addListener(t,"click",(function(){a.showTypeMenu()})),lmsbase.addListener(s,"click",(function(){a.showValueMenu()}))},e.prototype.constructFeedbackListingView=function(){this.listingContainer=zplms.replaceWithClone(this.listingContainer),zplms.addLoadingBar(this.listingContainer);var e=this;this.sendRequestToFetchFeedbacks((function(t){e.fetchDataSuccessCallback(t)}),(function(){e.fetchDataFailureCallback(response)}))},e.prototype.fetchDataAndPostRequestConstruction=function(){var e=this;this.sendRequestToFetchFeedbacks((function(t){e.fetchDataSuccessCallback(t)}),(function(){e.fetchDataFailureCallback(response)}))},e.prototype.sendRequestToFetchFeedbacks=function(e,t){var s=this;"trainer"==this.type?lmsfeedback_v1.sendRequestToFetchTrainerFeedbacks(this.courseId,this.batchId,this.trainerId,this.ownerErecno,this.startIndex,(function(t){s.startIndex=t.hasMoreRecords?s.startIndex+25:"end",e(t)}),t):lmsfeedback_v1.sendRequestFetchSessionFeedbacks(this.courseId,this.batchId,this.sessionId,this.ownerErecno,this.startIndex,(function(t){s.startIndex=t.hasMoreRecords?s.startIndex+25:"end",e(t)}),t)},e.prototype.fetchDataSuccessCallback=function(e){this.postRequestConstruction(e.feedbacks,e.hasMoreRecords)},e.prototype.fetchDataFailureCallback=function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)},e.prototype.postRequestConstruction=function(e,t){e.length>0?this.addFeedbacksToView(e,t):lmsnodata.showNoData({mode:"filter",container:this.listingContainer,module:"Feedback",content:ZPI18N.getString("zp.lms.feedback.noreviewavailable")})},e.prototype.onscroll=function(e){"end"!=this.startIndex&&e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight<1&&this.updateFeedbackListingView()},e.prototype.updateFeedbackListingView=function(e,t){var s=this;this.sendRequestToFetchFeedbacks((function(e){s.addFeedbacksToView(e.feedbacks,e.hasMoreRecords)}),(function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)}))},e.prototype.addFeedbacksToView=function(e,t){zplms.removeLoadingBar(this.listingContainer);for(var s=document.createDocumentFragment(),r=0;r<e.length;r++)s.appendChild(lmsfeedback_v1.constructReviewElement(e[r]));t&&zplms.addLoadingBar(s),this.listingContainer.appendChild(s)},e.prototype.showTypeMenu=function(e){var t=this;lmsmenu.initiate({elem:this.typeMenuNode,width:"155px",type:"dropdown",arrowHead:!1,menulist:[{session:[ZPI18N.getString("zp.lms.session")]},{trainer:[ZPI18N.getString("zp.lms.feedback.trainer")]},{learner:[ZPI18N.getString("zp.lms.settings.learner")]}]}).on("click",lmsmenu.updateDropMenuSelection).on("click",(function(){t.changeType(this.value)})).bind()},e.prototype.changeType=function(e){if(this.type!=e){var t,s={};"session"==e||"learner"==e?(s.all=[ZPI18N.getString("zp.all")],t=ZPI18N.getString("zp.all")):t=ZPI18N.getString("zp.select"),this.valueMenuNode.innerHTML="",lmsmenu.changeToSelectMenu(this.valueMenuNode,s||{},"single",null,t),this.type=e,this.sessionId=null,this.trainerId=null,this.ownerErecno=null,"trainer"!=e&&(this.refreshFeedbackListingView(),this.refreshStatsView())}},e.prototype.showValueMenu=function(e){var t=this;lmsmenu.initiate({elem:this.valueMenuNode,type:"select",mode:"single",allow_new:!1,menulist:function(){var e=this;"learner"==t.type?lmsmembers.sendRequestToFetchLearners(t.courseId,t.batchId,e.value,null,null,(function(t){for(var s=t.learners,r={all:[ZPI18N.getString("zp.all")]},l=0;l<s.length;l++)r[s[l].erecno]=[zplms.encodeHTML(s[l].displayName)];e.updateOptionList(r)})):"trainer"==t.type?lmstrainers.fetchTrainers(t.courseId,t.batchId,e.value,null,(function(t){for(var s=t.trainers,r={},l=0;l<s.length;l++)r[s[l].trainerId]=[zplms.encodeHTML(s[l].displayName)];e.updateOptionList(r)})):"session"==t.type&&lmsfeedback_v1.sendRequestToFetchSessions(t.courseId,t.batchId,e.value,null,(function(t){for(var s=t.sessions,r={all:[ZPI18N.getString("zp.all")]},l=0;l<s.length;l++)r[s[l].sessionId]=[zplms.encodeHTML(s[l].name)];e.updateOptionList(r)}))}}).on("click",(function(e){switch(t.type){case"session":t.changeSession("all"==this.value?null:this.value);break;case"trainer":t.changeTrainer(this.value);break;case"learner":t.changeOwnerErecno("all"==this.value?null:this.value)}})).on("update",(function(e){})).bind()},e.prototype.changeSession=function(e){e!=this.sessionId&&(this.sessionId=e,this.refreshFeedbackListingView(),this.refreshStatsView())},e.prototype.changeTrainer=function(e){e!=this.trainerId&&(this.trainerId=e,this.refreshFeedbackListingView(),this.refreshStatsView())},e.prototype.changeOwnerErecno=function(e){e!=this.ownerErecno&&(this.ownerErecno=e,this.refreshFeedbackListingView(),this.refreshStatsView())},e.prototype.refreshFeedbackListingView=function(){this.startIndex=1,this.constructFeedbackListingView()},e.prototype.refreshStatsView=function(){this.sessionId||this.trainerId?this.constructStatsView():(this.statsContainer.innerHTML="",this.appendExportButton(this.statsContainer))},e.prototype.constructStatsView=function(){var e=zplms.replaceWithClone(this.statsContainer);this.statsContainer=e;var t=this;this.sendRequestToFetchFeedbackStats((function(s){var r="<div><font>"+ZPI18N.getString("zp.rating")+": </font>"+lmsfeedback.getStarHtml(s.stats.averageRating,null,1,16).outerHTML+"</div><div><font>"+ZPI18N.getString("zp.responses")+": </font><b>"+s.stats.totalResponses+"</b></div>";e.innerHTML=r,t.appendExportButton(e)}),(function(){}))},e.prototype.appendExportButton=function(e){let t=this,s=document.createElement("div");s.innerHTML='<div class="zp_Mtfil"><div class="MB0I"><div class="exprtbtn"><label><i class="IC-exprt" style="vertical-align: baseline;"></i><b style="vertical-align: baseline;">Export</b></label></div></div></div>',e.firstChild?e.insertBefore(s.firstChild,e.firstChild):e.appendChild(s.firstChild),lmsbase.addListener(e.querySelector(".exprtbtn"),"click",(function(){t.sendRequestToExportFeedback()}))},e.prototype.sendRequestToExportFeedback=function(){if(!this.listingContainer.querySelector(".zp_Fcnt"))return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.feedback.cannot.be.exported"));let e=this;lmsExportEntityDetailsPopup.openExportPopUp((function(t){lmsfeedback_v1.exportFeedback(t,e.courseId,e.batchId,e.sessionId,e.trainerId,e.ownerErecno,void 0,AddFeedback.TYPE.SESSION)}))},e.prototype.sendRequestToFetchFeedbackStats=function(e,t){"trainer"==this.type?lmsfeedback_v1.sendRequestToFetchTrainerFeedbackStats(this.courseId,this.batchId,this.trainerId,e,t):"session"==this.type&&lmsfeedback_v1.sendRequestToFetchSessionFeedbackStats(this.courseId,this.batchId,this.sessionId,e,t)},function(s,r,l){return new t(new e(s,r,l))}}(),createLearnerFeedbackListingView:function(){function e(e,t,s){this.courseId=e,this.batchId=t,this.container=s,this.type="learner",this.sessionId=null,this.learnerErecno=null,this.ownerErecno=null,this.startIndex=1}function t(e){return{start:function(){e.construct()},onscroll:function(t){e.onscroll(t)}}}return e.prototype.construct=function(){this.preRequestConstruction(),this.constructFeedbackListingView()},e.prototype.preRequestConstruction=function(){var e=document.createElement("div");e.className="zp_Alft";e.innerHTML='<div class="fdbck_rprt"><div class="zp_ACcnt"><div class="zp_ACwel"><div class="zp_flter"><div class="zp_fltcnt"><div container="stats" class="zp_revw"></div><div class="zp_Mtfil"><div><div typeMenuNode class="fcs"></div><div valueMenuNode class="zp_Sm"></div></div></div></div></div><div container="listing" class="zp_Pdesc"></div></div></div></div>',this.listingContainer=e.querySelector("[container=listing]"),this.listingContainer.removeAttribute("container"),this.statsContainer=e.querySelector("[container=stats]"),this.statsContainer.removeAttribute("container"),this.appendExportButton(this.statsContainer),this.container.appendChild(e);var t=e.querySelector("[typeMenuNode]");t.removeAttribute("typeMenuNode"),this.typeMenuNode=t;var s=e.querySelector("[valueMenuNode]");s.removeAttribute("valueMenuNode"),this.valueMenuNode=s;var r={id:this.type,value:"session"==this.type?ZPI18N.getString("zp.lms.session"):"trainer"==this.type?ZPI18N.getString("zp.lms.trainer"):ZPI18N.getString("zp.lms.learner")};lmsmenu.changeToDropSelectMenu(t,r,"IC-users");var l={};l.all=[ZPI18N.getString("zp.all")],lmsmenu.changeToSelectMenu(s,l||{},"single",null,ZPI18N.getString("zp.all"));var a=this;lmsbase.addListener(t,"click",(function(){a.showTypeMenu()})),lmsbase.addListener(s,"click",(function(){a.showValueMenu()}))},e.prototype.constructFeedbackListingView=function(){this.listingContainer=zplms.replaceWithClone(this.listingContainer),zplms.addLoadingBar(this.listingContainer);var e=this;this.sendRequestToFetchFeedbacks((function(t){e.fetchDataSuccessCallback(t)}),(function(t){e.fetchDataFailureCallback(t)}))},e.prototype.sendRequestToFetchFeedbacks=function(e,t){let s=this;"learner"===this.type||"session"===this.type&&!this.sessionId||"trainer"===this.type&&!this.ownerErecno?lmsfeedback_v1.getFeedbackForLearner(this.learnerErecno,this.startIndex,(function(t){s.startIndex=25===t.length?s.startIndex+25:"end",e(t)}),t):"session"===this.type?lmsfeedback_v1.getFeedbackForLearnerBySession(this.sessionId,this.learnerErecno,this.startIndex,(function(t){s.startIndex=25===t.length?s.startIndex+25:"end",e(t)}),t):"trainer"===this.type&&lmsfeedback_v1.getFeedbackForLearnerByTrainer(this.ownerErecno,this.learnerErecno,this.startIndex,(function(t){s.startIndex=25===t.length?s.startIndex+25:"end",e(t)}),t)},e.prototype.fetchDataSuccessCallback=function(e){this.postRequestConstruction(e,e.hasMoreRecords)},e.prototype.fetchDataFailureCallback=function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)},e.prototype.postRequestConstruction=function(e,t){e.length>0?this.addFeedbacksToView(e,t):lmsnodata.showNoData({mode:"filter",container:this.listingContainer,module:"Feedback",content:ZPI18N.getString("zp.lms.feedback.noreviewavailable")})},e.prototype.onscroll=function(e){"end"!=this.startIndex&&e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight<1&&this.updateFeedbackListingView()},e.prototype.resetScroll=function(){document.getElementById("courseContainer").scroll(0,0)},e.prototype.updateFeedbackListingView=function(e,t){var s=this;this.sendRequestToFetchFeedbacks((function(e){s.addFeedbacksToView(e,e.hasMoreRecords)}),(function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)}))},e.prototype.addFeedbacksToView=function(e,t){zplms.removeLoadingBar(this.listingContainer);for(var s=document.createDocumentFragment(),r=0;r<e.length;r++)s.appendChild(lmsfeedback_v1.constructReviewElementForLearner(e[r]));t&&zplms.addLoadingBar(s),this.listingContainer.appendChild(s)},e.prototype.showTypeMenu=function(e){var t=this;lmsmenu.initiate({elem:this.typeMenuNode,width:"155px",type:"dropdown",arrowHead:!1,menulist:[{session:[ZPI18N.getString("zp.lms.session")]},{trainer:[ZPI18N.getString("zp.lms.feedback.trainer")]},{learner:[ZPI18N.getString("zp.lms.settings.learner")]}]}).on("click",lmsmenu.updateDropMenuSelection).on("click",(function(){t.changeType(this.value),t.refreshFeedbackListingView()})).bind()},e.prototype.changeType=function(e){if(this.type===e)return;this.resetScroll();let t,s={};"session"===e||"learner"===e||"trainer"===e?(s.all=[ZPI18N.getString("zp.all")],t=ZPI18N.getString("zp.all")):t=ZPI18N.getString("zp.select"),this.valueMenuNode.innerHTML="",lmsmenu.changeToSelectMenu(this.valueMenuNode,s||{},"single",null,t),this.type=e,this.sessionId=null,this.ownerErecno=null,this.learnerErecno=null},e.prototype.showValueMenu=function(e){let t=this;lmsmenu.initiate({elem:this.valueMenuNode,type:"select",mode:"single",allow_new:!1,menulist:function(){var e=this;"learner"===t.type?lmsmembers.sendRequestToFetchLearners(t.courseId,t.batchId,e.value,null,null,(function(t){let s=t.learners,r={all:[ZPI18N.getString("zp.all")]};for(let e=0;e<s.length;e++)r[s[e].erecno]=[zplms.encodeHTML(s[e].displayName)];e.updateOptionList(r)})):"trainer"===t.type?lmstrainers.fetchTrainers(t.courseId,t.batchId,e.value,null,(function(t){let s=t.trainers,r={all:[ZPI18N.getString("zp.all")]};for(let e=0;e<s.length;e++)r[s[e].erecno]=[zplms.encodeHTML(s[e].displayName)];e.updateOptionList(r)})):"session"===t.type&&lmsfeedback_v1.sendRequestToFetchSessions(t.courseId,t.batchId,e.value,null,(function(t){for(var s=t.sessions,r={all:[ZPI18N.getString("zp.all")]},l=0;l<s.length;l++)r[s[l].sessionId]=[zplms.encodeHTML(s[l].name)];e.updateOptionList(r)}))}}).on("click",(function(e){switch(t.type){case"session":t.changeSession("all"===this.value?null:this.value);break;case"trainer":t.changeOwnerErecno("all"===this.value?null:this.value);break;case"learner":t.changeLearner("all"===this.value?null:this.value)}})).on("update",(function(e){})).bind()},e.prototype.changeSession=function(e){e!==this.sessionId&&(this.sessionId=e,this.refreshFeedbackListingView())},e.prototype.changeLearner=function(e){e!==this.learnerErecno&&(this.learnerErecno=e,this.refreshFeedbackListingView())},e.prototype.changeOwnerErecno=function(e){e!==this.ownerErecno&&(this.ownerErecno=e,this.refreshFeedbackListingView())},e.prototype.refreshFeedbackListingView=function(){this.startIndex=1,this.constructFeedbackListingView()},e.prototype.appendExportButton=function(e){let t=this,s=document.createElement("div");s.innerHTML='<div class="zp_Mtfil"><div class="MB0I"><div class="exprtbtn"><label><i class="IC-exprt" style="vertical-align: baseline;"></i><b style="vertical-align: baseline;">Export</b></label></div></div></div>',e.firstChild?e.insertBefore(s.firstChild,e.firstChild):e.appendChild(s.firstChild),lmsbase.addListener(e.querySelector(".exprtbtn"),"click",(function(){t.sendRequestToExportFeedback()}))},e.prototype.sendRequestToExportFeedback=function(){if(!this.listingContainer.querySelector(".zp_Fcnt"))return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.feedback.cannot.be.exported"));let e=this;lmsExportEntityDetailsPopup.openExportPopUp((function(t){lmsfeedback_v1.exportFeedback(t,e.courseId,e.batchId,e.sessionId,void 0,e.ownerErecno,e.learnerErecno,AddFeedback.TYPE.LEARNER)}))},function(s,r,l){return new t(new e(s,r,l))}}()};zplms.setupEventManager(lmsfeedback_v1);var lmsMemberFeedback={elem:null,memberId:null,sessionStartInd:1,sessionFeedbackStartInd:1,getIndividualMemberFeedback:function(e,t,s){lmsMemberFeedback.memberId=t,lmsMemberFeedback.type="course",lmsMemberFeedback.isFromMemberInfo=s;var r=document.createElement("div");r.setAttribute("class","zp_fdcnt assessment");var l='<div class="zp_Alft"><div class="fdbck_rprt"><div class="zp_ACcnt"><div class="zp_ACwel">';2==lmscourses.selcourseSysVal&&""!=lmscourses.currentBatchId&&(l+='<div class="zp_flter"><div class="zp_fltcnt"><div class="zp_Mtfil"><div><div typeMenuNode class="fcs"></div><div valueMenuNode class="zp_Sm"></div></div></div></div></div>'),l+='<div container="listing" class="zp_Pdesc"></div></div></div></div></div>',r.innerHTML=l,e.appendChild(r);var a=r.querySelector("[container=listing]");if(a.removeAttribute("container"),lmsMemberFeedback.elem=a,2==lmscourses.selcourseSysVal&&""!=lmscourses.currentBatchId){var n=r.querySelector("[typeMenuNode]");n.removeAttribute("typeMenuNode"),lmsMemberFeedback.typeMenuNode=n;var i=r.querySelector("[valueMenuNode]");i.removeAttribute("valueMenuNode"),lmsMemberFeedback.valueMenuNode=i;var o={id:lmsMemberFeedback.type,value:"session"==lmsMemberFeedback.type?ZPI18N.getString("zp.lms.session"):ZPI18N.getString("zp.lms.course")};lmsmenu.changeToDropSelectMenu(n,o,"IC-users");var c={};c.all=[ZPI18N.getString("zp.all")],lmsmenu.changeToSelectMenu(i,c||{},"single",null,ZPI18N.getString("zp.all"));lmsbase.addListener(n,"click",lmsMemberFeedback.typeMenu),lmsbase.addListener(i,"click",lmsMemberFeedback.valueMenu)}lmsMemberFeedback.memberFeedbackAction()},typeChange:function(e){lmsMemberFeedback.type=e;var t={};t.all=[ZPI18N.getString("zp.all")],lmsMemberFeedback.valueMenuNode.innerHTML="",lmsmenu.changeToSelectMenu(lmsMemberFeedback.valueMenuNode,t||{},"single",null,ZPI18N.getString("zp.all")),lmsMemberFeedback.memberFeedbackAction()},typeMenu:function(){let e=[{course:[ZPI18N.getString("zp.lms.course")]},{session:[ZPI18N.getString("zp.lms.session")]}];lms.settingData[0].commonSetting.canLearnerViewTrainerFeedback&&e.push({sessionFeedbackToMe:[ZPI18N.getString("zp.lms.feedback.received")]}),lmsmenu.initiate({elem:lmsMemberFeedback.typeMenuNode,width:"155px",type:"dropdown",arrowHead:!1,menulist:e}).on("click",lmsmenu.updateDropMenuSelection).on("click",(function(){lmsMemberFeedback.typeChange(this.value)})).bind()},valueMenu:function(){lmsmenu.initiate({elem:lmsMemberFeedback.valueMenuNode,type:"select",mode:"single",allow_new:!1,menulist:function(){var e=this,t={all:[ZPI18N.getString("zp.all")]};"session"!=lmsMemberFeedback.type&&"sessionFeedbackToMe"!=lmsMemberFeedback.type||lmsfeedback_v1.sendRequestToFetchSessions(lmscourses.currentCourseId,lmscourses.currentBatchId,e.value,lmsMemberFeedback.sessionStartInd,(function(s){for(var r=s.sessions,l=0;l<r.length;l++)t[r[l].sessionId]=[zplms.encodeHTML(r[l].name)];e.updateOptionList(t),s.hasMoreRecords&&(lmsMemberFeedback.sessionStartInd+=25)}),(()=>{}),lmsMemberFeedback.memberId!=erecno?lmsMemberFeedback.memberId:void 0)}}).on("click",(function(e){lmsMemberFeedback.valueMenuNode.classList.add("disabled"),lmsMemberFeedback.memberFeedbackAction(this.value)})).on("update",(function(e){})).bind()},memberFeedbackAction:function(e){lmsMemberFeedback.elem.innerHTML="",zplms.addLoadingBar(lmsMemberFeedback.elem),"session"==lmsMemberFeedback.type?lmsfeedback_v1.sendRequestFetchSessionFeedbacks(lmscourses.currentCourseId,lmscourses.currentBatchId,"all"==e?void 0:e,lmsMemberFeedback.memberId,lmsMemberFeedback.sessionFeedbackStartInd,lmsMemberFeedback.feedbackSuccess,lmsMemberFeedback.feedbackFailure):"sessionFeedbackToMe"==lmsMemberFeedback.type?e&&"all"!==e?lmsfeedback_v1.getFeedbackForLearnerBySession(e,lmsMemberFeedback.memberId,lmsMemberFeedback.sessionFeedbackStartInd,lmsMemberFeedback.feedbackSuccess,lmsMemberFeedback.feedbackFailure):lmsfeedback_v1.getFeedbackForLearner(lmsMemberFeedback.memberId,lmsMemberFeedback.sessionStartInd,lmsMemberFeedback.feedbackSuccess,lmsMemberFeedback.feedbackFailure):"course"==lmsMemberFeedback.type&&(lmsMemberFeedback.valueMenuNode&&lmsMemberFeedback.valueMenuNode.classList.add("disabled"),lmsfeedback_v1.sendRequestToFetchCourseFeedbacks(lmscourses.currentCourseId,lmscourses.currentBatchId,"learner",void 0,lmsMemberFeedback.memberId,1,lmsMemberFeedback.feedbackSuccess,lmsMemberFeedback.feedbackFailure),zplms.removeLoadingBar(lmsMemberFeedback.elem))},feedbackSuccess:function(e){"course"!=lmsMemberFeedback.type&&lmsMemberFeedback.valueMenuNode.classList.remove("disabled"),zplms.removeLoadingBar(lmsMemberFeedback.elem);var t=document.createDocumentFragment();let s=e.feedbacks||e;if(s.length>0){for(var r=0;r<s.length;r++)"sessionFeedbackToMe"==lmsMemberFeedback.type?t.appendChild(lmsfeedback_v1.constructReviewElementForLearner(s[r])):t.appendChild(lmsfeedback_v1.constructReviewElement(s[r]));lmsMemberFeedback.elem.appendChild(t),"session"==lmsMemberFeedback.type&&e.hasMoreRecords&&(lmsMemberFeedback.sessionFeedbackStartInd+=25)}else if("200"==e.code&&"course"==lmsMemberFeedback.type){var l=document.createElement("ul");l.setAttribute("id","IndividualUserReport"),l.setAttribute("class","zpA fdbck_Intrct"),lmsMemberFeedback.ulElem=l,lmsMemberFeedback.elem.appendChild(l),lmsMemberFeedback.fetchLearnerFeedback(l)}else lmsnodata.showNoData({mode:"filter",container:lmsMemberFeedback.elem,module:"Feedback",content:ZPI18N.getString("zp.lms.feedback.noreviewavailable")})},feedbackFailure:function(e){lmsMemberFeedback.valueMenuNode&&lmsMemberFeedback.valueMenuNode.classList.remove("disabled"),ZPeople.Message.showFailureMsg(e.responseJSON.message)},fetchLearnerFeedback:function(e){!lmsMemberFeedback.isFromMemberInfo&&lmscoursedetails.isUserJoined?lmsfeedback_v1.sendRequestToStartFeedback(lmscourses.currentCourseId,lmscourses.currentBatchId,(function(t){if(!t.feedback.hasUserCompletedTheAllModule)return void lmsnodata.showNoData({mode:"completeMandatory",container:lmsMemberFeedback.elem,module:"Feedback",content:ZPI18N.getString("zp.lms.feedback.noreviewavailable")});let s=t.feedback;ZPSurveyAPI.getMemberFeedbackReport(lmscourses.currentCourseId,""==lmscourses.currentBatchId?0:lmscourses.currentBatchId,lmsMemberFeedback.memberId,null==s.settings.templateId?0:s.settings.templateId,e,lmscoursedetails.isUserJoined,s.settings.templateType,lmsMemberFeedback.writeFeedbackCallback)}),(function(e){switch(e.responseJSON.code){case"FEEDBACK_ALREADY_GIVEN":lmsMemberFeedback.setMemberFeedback();break;case"NO_PERMISSION":case"FEEDBACK_NOT_YET_STARTED":ZPeople.Message.showFailureMsg(e.responseJSON.message);let t=lmscoursedetails.componentUrl(lmscourses.currentCourseId);lms.changeHash("hash",t+"/overview");break;case"INTERNAL_ERROR":ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.internalservererror"));break;default:ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.feedback.postfeedback-fail"))}})):lmsMemberFeedback.setMemberFeedback()},writeFeedbackCallback:function(){lmsfeedback_v1.writeFeedback(lmscourses.currentCourseId,""==lmscourses.currentBatchId?null:lmscourses.currentBatchId)},setMemberFeedback:function(){lmsMemberFeedback.ulElem.innerHTML="",ZPSurveyAPI.getMemberFeedbackReport(lmscourses.currentCourseId,""==lmscourses.currentBatchId?0:lmscourses.currentBatchId,lmsMemberFeedback.memberId,0,lmsMemberFeedback.ulElem)},onFeedbackShared:function(e){lmsMemberFeedback.elem&&(e?lmsMemberFeedback.setMemberFeedback():lmsMemberFeedback.memberFeedbackAction())}};!function(e){function t(e,t,s){this.courseId=e,this.container=t,this.state=0,this.version=-1,this.settingsData={},this.templateData={},this.templateMenu={},this.close_callback=s}function s(e){return{start:function(){e.construct()},alertAndClose:function(){e.alertAndClose()},forceClose:function(){e.close()},onTemplateAdded:function(t){e.onTemplateAdded(t)},onTemplateEdited:function(t){e.onTemplateEdited(t)}}}t.prototype.construct=function(){this.contructInitialView()},t.prototype.contructInitialView=function(){var e=document.createDocumentFragment(),t=document.createElement("header");t.innerHTML="<h2>"+ZPI18N.getString("zp.feedback")+"</h2>",this.header=t,this.formContainer=document.createElement("div");var s=document.createElement("div");s.className="zp_btn",this.buttonContainer=s,e.appendChild(this.header),e.appendChild(this.formContainer),e.appendChild(this.buttonContainer),this.container.appendChild(e),zplms.addLoadingBar(this.formContainer),this.fetchInitDataAndPostRequestConstruction()},t.prototype.fetchInitDataAndPostRequestConstruction=function(){var e=this;this.state=1,this.sendRequestToFetchInitData((function(t){e.fetchInitDataSuccessCallback(t)}),(function(t){e.fetchInitDataFailureCallback(JSON.parse(t.responseText))}))},t.prototype.sendRequestToFetchInitData=function(e,t){lmsfeedback_v1.sendRequestToFetchInitCourseFeedbackSettingsTabData(this.courseId,e,t)},t.prototype.sendRequestToFetchSettingsData=function(e,t){lmsfeedback_v1.sendRequestToFetchCourseFeedbackSettings(this.courseId,this.version,e,t)},t.prototype.fetchInitDataSuccessCallback=function(e){this.gradeScale=e.data.gradeScale,this.previousTemplates=e.data.previousTemplates,this.previousTemplate=null,this.savedTemplate=this.currentTemplate=e.data.settings.template,this.currentTemplateState="saved",this.settingsData[-1]=e.data,this.constructSettingsView(),this.state=2},t.prototype.fetchInitDataFailureCallback=function(e){ZPeople.Message.showFailureMsg(e.message),this.state=3},t.prototype.constructVersionMenu=function(){var e=this.settingsData[-1];if(e){this.version=e.version,this.maximumVersion=e.version,versionMenuNode=document.createElement("div"),versionMenuNode.className="zp_Sm zp_c5";var t={};t[this.maximumVersion]=[this.maximumVersion],lmsmenu.changeToSelectMenu(versionMenuNode,t,"single",null,ZPI18N.getString("zp.select")),this.versionMenuNode=versionMenuNode,this.header.appendChild(this.versionMenuNode);var s=this;lmsbase.addListener(this.versionMenuNode,"click",(function(){s.showVersionMenu()}))}},t.prototype.showVersionMenu=function(){var e=this;lmsmenu.initiate({elem:this.versionMenuNode,type:"select",mode:"single",menulist:function(){for(var t=[],s=e.maximumVersion;s>0;s--)t[s]=[s];this.updateOptionList(t)}}).on("click",(function(){e.changeVersion(this.value)})).bind()},t.prototype.changeVersion=function(e){this.version!=e&&(this.version=e,this.refreshSettingsView())},t.prototype.updateVersionMenu=function(e){this.version=e;var t={};t[this.version]=[this.version],lmsmenu.changeToSelectMenu(this.versionMenuNode,t,"single",null,ZPI18N.getString("zp.select"))},t.prototype.constructButtons=function(){var e=document.createElement("button");e.className="zpthm",e.textContent=ZPI18N.getString("zp.save"),this.saveButtonNode=e,this.buttonContainer.appendChild(this.saveButtonNode);var t=this;lmsbase.addListener(e,"click",(function(){t.validateAndSave()}))},t.prototype.refreshSettingsView=function(){this.constructSettingsView()},t.prototype.constructSettingsView=function(){this.formContainer=zplms.replaceWithClone(this.formContainer),zplms.hasLoadingBar(this.formContainer)||zplms.addLoadingBar(this.formContainer);var e=this;this.fetchSettingsData((function(t){e.fetchSettingsDataSuccessCallback(t)}),(function(){e.fetchSettingsDataFailureCallback(response)}))},t.prototype.fetchSettingsData=function(e,t){var s=this.settingsData[this.version];if(s)e(s);else{var r=this;this.sendRequestToFetchSettingsData((function(t){r.settingsData[t.settings.version]=t.settings,-1==r.version&&(r.settingsData[-1]=t.settings),e(t)}),t)}},t.prototype.fetchSettingsDataSuccessCallback=function(e){this.postRequestConstruction(e.settings),this.setupRecordDataInUI(e.settings),this.onSettingsViewConstructed()},t.prototype.fetchSettingsDataFailureCallback=function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message),this.state=3},t.prototype.postRequestConstruction=function(e){zplms.removeLoadingBar(this.formContainer);var t=this.formContainer;lmsform.initiate(0,!1,this.formContainer);var s='<div class="zp_Ldtl"><p>'+ZPI18N.getString("zp.lms.course.feedback.settings.formComponent.templateMenu.header")+"</p><span>"+ZPI18N.getString("zp.lms.course.feedback.settings.formComponent.templateMenu.info")+'</span><div class="zp_frmcnt"><button class="zp_fltbtn fill" action="addTemplate"><i class="IC-plus"></i>'+ZPI18N.getString("zp.lms.button.chooseTemplate")+"</button></div></div>";1==this.gradeScale||2==this.gradeScale?(s+='<div class="zp_Sm zp_c5" gradeCategoryMenu>'+lmsformcomponents.labelName({displayName:"zp.lms.gradebook.gradeCategory"},"h4")+"</div>",s+='<div class="zp_Sm zp_c2 zp_dyn">'+lmsformcomponents.labelName({displayName:"zp.lms.mark.marks"},"h4")+lmsform.insertField({fieldType:lmsform.fieldtype.NUMBER,labelName:"marks",isMandatory:!1,maxLength:5,no_autofocus:!0,displayName:ZPI18N.getString("zp.lms.mark.marks")},"","",0,{componentValue:e.marks||""})+"</div>"):3==this.gradeScale&&(s+='<div class="zp_Sm zp_c2">'+lmsformcomponents.labelName({displayName:"zp.lms.mark.marks"},"h4")+lmsform.insertField({fieldType:lmsform.fieldtype.NUMBER,labelName:"marks",isMandatory:!1,maxLength:5,no_autofocus:!0,displayName:ZPI18N.getString("zp.lms.mark.marks")},"","",0,{componentValue:e.marks||""})+"</div>"),s+='<div class="zp_Sm zp_nbr"><div><ul>'+lmsform.insertField({fieldType:lmsform.fieldtype.CHECKBOX,labelName:"isMandatory",displayName:ZPI18N.getString("zp.lms.mandatory"),autofillvalue:e.isMandatory?"true":"false"},"","","horizontal")+"</ul></div></div>",this.formContainer.innerHTML=s;var r=t.querySelector('[action="addTemplate"]');r.removeAttribute("action"),this.addTemplateButtonNode=r,r.parentNode.insertBefore(this.currentTemplateNode=this.convertTemplateInfoAsElement(e.template,"live"),r.nextSibling),this.constructArchivedTemplatesView(),lmsformcomponents.bind();var l=this;if(lmsbase.addListener(r,"click",(function(){l.showTemplateMenu()})),1==this.gradeScale||2==this.gradeScale){var a=t.querySelector("li [name='isMandatory']"),n=a.parentNode,i=t.querySelector("[name='marks']"),o=i.parentNode.parentNode;function c(){lmsbase.removeClass(o,"zp_dyn")}function d(){i.setAttribute("datamandatory","true")}function m(){l.valueBeforeDefaultValuePopulationOfMandatoryField=lmsbase.hasClass(a,"zp_gclr"),lmsbase.addClass(n,"disabled"),lmsbase.addClass(a,"zp_gclr")}var u=t.querySelector("[gradeCategoryMenu]");u.removeAttribute("gradeCategoryMenu");var p={};e.gradeCategory&&(p[e.gradeCategory.categoryId]=[e.gradeCategory.categoryName],m(),c(),d()),lmsform.Obj.insertMenu(lmscoursegrade.createGradeCategoryMenu(this.courseId,u,p,(function(){var e=this.getSelectedValue();0!=e?(m(),c(),d()):(l.valueBeforeDefaultValuePopulationOfMandatoryField?lmsbase.addClass(a,"zp_gclr"):lmsbase.removeClass(a,"zp_gclr"),lmsbase.removeClass(n,"disabled"),lmsbase.addClass(o,"zp_dyn"),i.setAttribute("datamandatory","false")),l.gradeCategoryId=0==e?null:e})))}this.form=$.extend({},lmsform)},t.prototype.onSettingsViewConstructed=function(){this.constructButtons()},t.prototype.constructArchivedTemplatesView=function(){if(this.archivedTemplatesStack=[],this.previousTemplates.length>0){for(var e=this.previousTemplates,t=document.createDocumentFragment(),s=e.length-1;s>=0;s--){var r={node:t.insertBefore(this.convertTemplateInfoAsElement(e[s],"archived"),t.firstChild),template:e[s]};this.archivedTemplatesStack.push(r)}this.currentTemplateNode.parentNode.insertBefore(t,this.currentTemplateNode.nextSibling)}},t.prototype.pushAsArchivedTemplate=function(e){var t=this.convertTemplateInfoAsElement(e,"archived");this.currentTemplateNode.parentNode.insertBefore(t,this.currentTemplateNode.nextSibling);var s={node:t,template:e};this.archivedTemplatesStack.push(s)},t.prototype.popArchivedTemplate=function(){var e=this.archivedTemplatesStack.pop();if(e){var t=e.node;t.parentNode&&t.parentNode.removeChild(t)}},t.prototype.showTemplateMenu=function(e){if(!this.templateMenu.state){var t=this;t.templateMenu={startIndex:0,endOfData:!1},lmsmenu.initiate({elem:this.addTemplateButtonNode,width:"180px",height:"200px",type:"dropdown",htmlContent:'<div><div scrollContainer class="zpD_scrl"><ul _type="dropbox"><li _rel="new"><div class="zp_bclr" _rel="new"><i class="IC-plus"></i><span _cont>'+ZPI18N.getString("zp.lms.course.feedback.settings.formComponent.templateMenu.listing.createNew")+'</span></div></li></ul><ul class="zp_tpbr" defaultTemplateSection _type="dropbox"></ul><ul class="zp_tpbr" existingTemplatesSection _type="dropbox"><li class="nohvr"><p class="zp_tbttl" _cont>'+ZPI18N.getString("zp.lms.course.feedback.settings.formComponent.templateMenu.listing.existingTemplates")+"</p></li></ul></div></div>",arrowHead:!1}).on("click",(function(){"new"==this.value?t.createTemplate():t.changeTemplate("default"==this.value?null:this.value)})).on("close",(function(){t.templateMenu.state=0})).bind(),lmsmenu.tmp._robject.htmlContent=!1;var s=lmsmenu.tmp.elem;s.style.height="";var r=s.querySelector("[defaultTemplateSection]");r.removeAttribute("defaultTemplateSection");var l=s.querySelector("[existingTemplatesSection]");l.removeAttribute("existingTemplatesSection"),l.style.display="none",i(r);var a=s.querySelector("[scrollContainer]");a.removeAttribute("scrollContainer"),lmsbase.addListener(a,"scroll",(function(){!t.templateMenu.endOfData&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&u()}),!1),t.fetchTemplates((function(e,t){e.length&&(o(r),l.style.display="",c(e,t),d(e),1==e.length&&m())}),(function(){r.innerHTML='<li class="nohvr"><span>'+ZPI18N.getString("zp.lms.feedback.message.noTemplatesFound")+"</span>"})),this.templateMenu.state=1}function n(e){var s=document.createElement("li");s.setAttribute("_rel",0==e.type?"default":e.templateId);var r="<span _cont>"+zplms.encodeHTML(e.name)+"</span></li>";s.innerHTML=r;var l=s.querySelector("[action=delete]");return l&&(l.removeAttribute("action"),lmsbase.addListener(l,"mousedown",(function(r){lmsmenu.stopHide(!0),lmsmenu.stopbubble(),t.deleteTemplateConfirmation((function(){window.setTimeout((function(){lmsmenu.stopHide(!1)})),t.deleteTemplate(e.templateId,(function(){t.templateMenu.startIndex--,s.parentNode&&s.parentNode.removeChild(s),u()}))}),(function(){window.setTimeout((function(){lmsmenu.stopHide(!1)}))}))}))),s}function i(e){var t=document.createElement("li");t.setAttribute("loadbar",""),t.className="nohvr",t.innerHTML="<span>"+ZPI18N.getString("zp.lms.loading")+"</span></li>",e.appendChild(t)}function o(e){var t=e.querySelector("[loadbar]");t&&t.parentNode.removeChild(t)}function c(e,s){o(l);for(var a=0,c=e.length;a<c;a++)0==e[a].type?r.appendChild(n(e[a])):l.appendChild(n(e[a]));s&&i(l),t.templateMenu.startIndex+=e.length}function d(e){for(var s=0,r=e.length;s<r;s++)0==e[s].type?t.templateData.default=e[s]:t.templateData[e[s].templateId]=e[s]}function m(){o(l);var e=l.childNodes[0];l.innerHTML=e.outerHTML+'<li class="nohvr"><span>'+ZPI18N.getString("zp.lms.feedback.message.noTemplatesFound")+"</span></li>"}function u(){t.templateMenu.endOfData?1==t.templateMenu.startIndex&&m():t.fetchTemplates((function(e,s){e.length?(c(e,s),d(e)):1==t.templateMenu.startIndex&&m()}),(function(){ZPeople.Message.showFailureMsg(response.responseJSON.message)}))}},t.prototype.fetchTemplates=function(e,t){var s=this;lmsfeedback_v1.sendRequestToFetchCourseTemplates(this.courseId,!1,null,s.templateMenu.startIndex,null,(function(t){s.templateMenu.endOfData=!t.hasMoreRecords,e(t.templates,t.hasMoreRecords)}),t)},t.prototype.changeTemplate=function(e){if(this.templateId!=e){this.templateType=e?1:0,this.templateId=e,this.currentTemplate=this.templateData[e||"default"];var t=this.convertTemplateInfoAsElement(this.currentTemplate,"unsaved");this.currentTemplateNode.parentNode.replaceChild(t,this.currentTemplateNode),this.currentTemplateNode=t,this.currentTemplateState="unsaved"}},t.prototype.convertTemplateInfoAsElement=function(e,t){var s=document.createElement("div");if(s.className="zp_Tatch",1==e.type&&"archived"!=t){var r=document.createElement("div");r.className="zp_Ticn",r.innerHTML='<i class="IC-more"></i>',s.appendChild(r);var l=this;lmsbase.addListener(r,"click",(function(t){t.skipAction=!0,lmsmenu.initiate({elem:t.target,width:"130px",type:"dropdown",arrowHead:!0,menulist:[{preview:[ZPI18N.getString("zp.preview")],edit:[ZPI18N.getString("zp.edit")]}],eve:t}).on("click",(function(){"preview"==this.value?l.previewTemplate(e.templateId):"edit"==this.value&&l.editTemplate(e.templateId)})).bind()}))}var a=document.createElement("p");if("archived"==t)a.className="arch",a.innerHTML=ZPI18N.getString("zp.lms.feedback.Archived"),s.appendChild(a);else if("live"==t||"saved"==t){(a=document.createElement("p")).className="live",a.innerHTML=ZPI18N.getString("zp.lms.feedback.Live")}s.appendChild(a);var n=document.createElement("font");s.appendChild(n);var i=n.appendChild(document.createElement("div")),o=document.createElement("h4");o.innerHTML=zplms.encodeHTML(e.name),i.appendChild(o);var c=document.createElement("p"),d=document.createElement("font");if(d.innerHTML=ZPI18N.getString("zp.questions")+" : <b>"+zplms.encodeHTML(e.questionsCount)+"</b>",c.appendChild(d),0!=e.templateType||"archived"!=t){var m=document.createElement("font");m.innerHTML=ZPI18N.getString("zp.Used")+" : <b>"+zplms.encodeHTML(e.responseCount)+"</b>",c.appendChild(m)}return i.appendChild(c),s},t.prototype.showArchivedTemplate=function(){this.previousTemplateNode&&lmsbase.removeClass(this.previousTemplateNode,"zp_dyn")},t.prototype.hideArchivedTemplate=function(){this.previousTemplateNode&&lmsbase.addClass(this.previousTemplateNode,"zp_dyn")},t.prototype.updateCurrentTemplateNodeAsArchived=function(){var e=this.convertTemplateInfoAsElement(this.savedTemplate,"archived");this.previousTemplateNode?this.previousTemplateNode.parentNode.replaceChild(e,this.previousTemplateNode):this.addTemplateButtonNode.parentNode.insertBefore(e,this.addTemplateButtonNode.nextSibling),this.previousTemplateNode=e,this.previousTemplate=this.savedTemplate},t.prototype.updateCurrentTemplateNodeAsSaved=function(){var e=this.convertTemplateInfoAsElement(this.currentTemplate,"live");this.currentTemplateNode.parentNode.replaceChild(e,this.currentTemplateNode),this.currentTemplateNode=e,this.currentTemplateState="saved",this.savedTemplate=this.currentTemplate},t.prototype.setupRecordDataInUI=function(e){this.gradeCategoryId=e.gradeCategory?e.gradeCategory.categoryId:null,this.templateType=e.templateType,this.templateId=e.templateId,this.version=e.version,this.lastSavedRecordData=this.getCurrentRecordDataInUI()},t.prototype.getCurrentRecordDataInUI=function(){var e=lmsform;try{(lmsform=this.form).params={};var t=lmsform.formvalidate("",0,1);return t.gradeCategoryId=this.gradeCategoryId||null,t.templateType=this.templateType,t.templateId=this.templateId,t.openTimeDelay=t.openTimeDelay||null,t.marks=t.marks||null,lmsform.params={},t}finally{lmsform=e}},t.prototype.validateAndSave=function(){var e=this;this.validate((function(){e.saveCurrentDataInUI()}))},t.prototype.saveCurrentDataInUI=function(){this.save(this.getCurrentRecordDataInUI())},t.prototype.disableSaveButton=function(e){lmsbase.addClass(this.saveButtonNode,"disabled")},t.prototype.enableSaveButton=function(e){lmsbase.removeClass(this.saveButtonNode,"disabled")},t.prototype.disableVersionMenu=function(e){lmsbase.addClass(this.versionMenuNode,"disabled")},t.prototype.enableVersionMenu=function(e){lmsbase.removeClass(this.versionMenuNode,"disabled")},t.prototype.save=function(e){this.disableSaveButton();var t=this;this.sendRequestToSaveSettingsData(e,(function(s){t.enableSaveButton(),t.saveSuccessCallback(e,s)}),(function(e){t.enableSaveButton(),t.saveFailureCallback(e)}))},t.prototype.validate=function(e){var t=this,s=lmsform;try{(lmsform=this.form).submitCallback=function(t){e()},lmsform.validationFailureCallback=function(e){t.doAdditionalValidation(e)},lmsform.formvalidate()}finally{lmsform=s}},t.prototype.sendRequestToSaveSettingsData=function(e,t,s){lmsfeedback_v1.sendRequestToUpdateCourseFeedbackSettings(this.courseId,e,t,s)},t.prototype.saveSuccessCallback=function(e,t){this.updateLastSavedRecordData(e),this.version<t.settings.version?this.pushAsArchivedTemplate(this.savedTemplate):this.version>t.settings.version&&this.popArchivedTemplate(),this.savedTemplate=this.currentTemplate,this.currentTemplateState="saved",this.version=t.settings.version,this.refreshCurrentTemplateNode(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.feedback.settings.message.update.success"))},t.prototype.saveFailureCallback=function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)},t.prototype.updateLastSavedRecordData=function(e){for(var t in e)this.lastSavedRecordData[t]=e[t]},t.prototype.createTemplate=function(){ZPSurveyAPI.initAddLMSFeedback(this.courseId)},t.prototype.onTemplateAdded=function(e){var t=e.templateInfo;t.sourceTemplateId&&t.sourceTemplateId==this.currentTemplate.templateId&&($.extend(this.currentTemplate,t),this.currentTemplateState="unsaved",this.refreshCurrentTemplateNode()),this.templateMenu&&(this.templateMenu.endOfData=!1)},t.prototype.editTemplate=function(e){ZPSurveyAPI.initEditFeedback(e,this.courseId)},t.prototype.previewTemplate=function(e){ZPSurveyAPI.openLMSFeedBackPreview(e,this.courseId,null)},t.prototype.refreshArchivedTemplateNode=function(){if(this.previousTemplate){var e=this.convertTemplateInfoAsElement(this.previousTemplate,"archived");this.previousTemplateNode?this.previousTemplateNode.parentNode.replaceChild(e,this.previousTemplateNode):this.currentTemplateNode.parentNode.insertBefore(e,this.currentTemplateNode.nextSibling),this.previousTemplateNode=e}else this.hideArchivedTemplate()},t.prototype.refreshCurrentTemplateNode=function(){if(this.currentTemplate){var e=this.convertTemplateInfoAsElement(this.currentTemplate,this.currentTemplateState);this.currentTemplateNode.parentNode.replaceChild(e,this.currentTemplateNode),this.currentTemplateNode=e}},t.prototype.onTemplateEdited=function(e){var t=e.templateInfo;this.currentTemplate.templateId==t.templateId&&($.extend(this.currentTemplate,t),this.refreshCurrentTemplateNode());for(var s=0,r=this.archivedTemplatesStack||[];s<r.length;s++){var l=r[s],a=l.template;if(a.templateId==t.templateId){$.extend(a,t);var n=l.node,i=this.convertTemplateInfoAsElement(a,"archived");n.parentNode.replaceChild(i,n)}}},t.prototype.deleteTemplateConfirmation=function(e,t){lmsnotify.show({header:ZPI18N.getString("zp.lms.entitydelete",[ZPI18N.getString("zp.template")]),body:ZPI18N.getString("zp.lms.permenentlydelEntity",[ZPI18N.getString("zp.template")]),button_text:ZPI18N.getString("zp.lms.delete"),texttype:"negative",successCallback:function(){this.status&&e()},cancelCallback:t})},t.prototype.deleteTemplate=function(e,t){lmsfeedback_v1.sendRequestToDeleteCourseTemplate(this.courseId,e,(function(e){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.feedback.template.message.delete.success")),t()}),(function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)}))},t.prototype.hasAnyUnsavedChanges=function(){return 2==this.state&&!zplms.isObjectsSame(this.lastSavedRecordData,this.getCurrentRecordDataInUI())},t.prototype.alertAndClose=function(){this.hasAnyUnsavedChanges()&&this.alert(),this.close()},t.prototype.alert=function(){var e=this;lmsnotify.show({header:ZPI18N.getString("zp.lms.confirmChanges"),body:ZPI18N.getString("zp.lms.course.coursesettingsupdate"),button_text:ZPI18N.getString("zp.lms.saveCourse"),texttype:"negative",successCallback:function(){e.saveAllValidData()}})},t.prototype.saveAllValidData=function(){var e=this.getCurrentRecordDataInUI();"1"!=e.openTimeType||e.openTimeDelay||(delete e.openTimeType,delete e.openTimeDelay,delete e.openTimeDelayUnit),this.save(e)},t.prototype.close=function(){this.container.innerHTML="";var e=this.close_callback;e&&e()},t.prototype.getWhenToInitiateField=function(e,t,s){var r={};r.fieldType=lmsform.fieldtype.NUMBER,r.autofillvalue=t||"",r.displayName="",r.labelName="openTimeDelay",r.no_autofocus=!0;var l={formComponentId:"timeUnitFormComponent"};l.fieldType=lmsform.fieldtype.LOOKUP,l.displayType=lmsform.fieldtype.SELECT_DISPLYTYPE,l.Options=[{Value:ZPI18N.getString("zp.cday"),Id:"day"},{Value:ZPI18N.getString("zp.week"),Id:"week"},{Value:ZPI18N.getString("zp.month"),Id:"month"}],l.OptionsAsLMSMenuFormatArray=[[ZPI18N.getString("zp.cday")],[ZPI18N.getString("zp.week")],[ZPI18N.getString("zp.month")]],l.OptionsWithId=[{Value:ZPI18N.getString("zp.cday"),Id:"day"},{Value:ZPI18N.getString("zp.week"),Id:"week"},{Value:ZPI18N.getString("zp.month"),Id:"month"}],l.autofillvalue="day"==s?ZPI18N.getString("zp.cday"):"week"==s?ZPI18N.getString("zp.week"):ZPI18N.getString("zp.month"),l.displayName="",l.labelName="openTimeDelayUnit";var a=ZPI18N.getString("zp.lms.test.postTest.formComponent.whenToInitiate.options.deferredAfterCompletion.displayName").split("{0}"),n='<div whenToInitiateContainer class="zp_Sm zp_nobr zp_lp">';return n+="<h4>"+ZPI18N.getString("zp.lms.test.postTest.formComponent.whenToInitiate.displayName")+"</h4>",n+="<div>",n+="<ul>",n+="<li>"+lmsformcomponents.getSimpleRadioButtonField({fieldType:lmsform.fieldtype.RADIO_OPTION,labelName:"openTimeType",displayName:ZPI18N.getString("zp.lms.test.postTest.formComponent.whenToInitiate.options.immediatelyAfterCompletion.displayName"),autofillvalue:0==e,value:0})+"</li>",n+="<li>",n+=lmsformcomponents.getSimpleRadioButtonField({fieldType:lmsform.fieldtype.RADIO_OPTION,labelName:"openTimeType",autofillvalue:1==e,value:1}),n+="<span>"+a[0]+"</span>",n+='<div class="zp_Smsub Smmax"><div class="zp_Sm" openTimeDelayContainer>'+lmsform.insertField(r,"","",0,void 0)+"</div></div>",n+='<div class="zp_Smsub Smmax90">'+lmsform.insertField(l,"","",1,void 0,"","zp_Sm",!0)+"</div>",n+="<span>"+a[1]+"</span>",n+="</li>",n+="</ul>",n+="</div>",n+="</div>"},e.createCourseFeedbackSettingsView=function(e,r,l){return new s(new t(e,r,l))}}(lmsfeedback);var lmscalendar={today:new Date,month:"",year:"",curdate:"",curWeek:"",view:"",todayflag:0,_root:"",menuCallBack:"",currentCourseId:"",currentBatchId:"",_htmlRoot:"",getCalView:function(e,t){if(0==$(".zp_cwrap ").length){lmscalendar.month=e-1,lmscalendar.year=t;var s='<div class="zp_cwrap "> <div class="zp_Tcal zp_Lstwrap "><div class="zp_lwrap"><div class="zpt-cal">';s+='<div class="zp_Lttl"> <div class="zp_Lst"> <div><div>'+ZPI18N.getString("zp.sun")+"</div><div>"+ZPI18N.getString("zp.mon")+"</div> <div>"+ZPI18N.getString("zp.tue")+"</div><div>"+ZPI18N.getString("zp.wed")+"</div><div>"+ZPI18N.getString("zp.thu")+"</div><div>"+ZPI18N.getString("zp.fri")+"</div><div>"+ZPI18N.getString("zp.sat")+"</div></div></div></div>",s+='<div class="zpt-calContainer" id="calContainer"></div></div></div></div></div>',lmscalendar._htmlRoot.innerHTML+=s}},previousNavigation:function(){var e=lmscalendar._htmlRoot.querySelectorAll('[class="zpt-calCol sel"]');e.length>0&&(e[0].className="zpt-calCol"),"month"==lmscalendar.view?(lmscalendar.todayflag=1,lmscalendar.previousMonth()):(lmscalendar.currweek=lmscalendar.previousWeek(lmscalendar.curWeek),lmscalendar.populateWeekDates(lmscalendar.currweek)),lmscalendar.todaySel()},nextNavigation:function(){var e=lmscalendar._htmlRoot.querySelectorAll('[class="zpt-calCol sel"]');e.length>0&&(e[0].className="zpt-calCol"),"month"==lmscalendar.view?(lmscalendar.todayflag=1,lmscalendar.nextMonth()):(lmscalendar.currweek=lmscalendar.nextWeek(lmscalendar.curWeek),lmscalendar.populateWeekDates(lmscalendar.currweek)),lmscalendar.todaySel()},nextMonth:function(){var e=lmscalendar._htmlRoot.querySelector('[id="calContainer"]');e.scroll(e.scrollTop,e.scrollLeft);lmscalendar.month,lmscalendar.year;lmscalendar.curdate=1,11==lmscalendar.month?(lmscalendar.month=0,lmscalendar.year=lmscalendar.year+1):lmscalendar.month=lmscalendar.month+1;var t="calendar/month/"+(lmscalendar.month+1)+"/"+lmscalendar.year;lms.changeHash("hash",t,"disable"),$("#currMonth").html(months[lmscalendar.month]+" "+lmscalendar.year),lmscalendar.populateMonthDates()},previousMonth:function(){var e=lmscalendar._htmlRoot.querySelector('[id="calContainer"]');e.scroll(e.scrollTop,e.scrollLeft);var t=lmscalendar.month,s=lmscalendar.year;lmscalendar.curdate=1,0==t?(lmscalendar.month=11,lmscalendar.year=s-1):lmscalendar.month=t-1;var r="calendar/month/"+(lmscalendar.month+1)+"/"+lmscalendar.year;lms.changeHash("hash",r,"disable"),$("#currMonth").html(months[lmscalendar.month]+" "+lmscalendar.year),lmscalendar.populateMonthDates()},getCurrentWeek:function(){var e=lmscalendar.year;if(0==lmscalendar.todayflag)var t=lmscalendar.month;else t=parseInt(lmscalendar.month)+1;""==lmscalendar.curdate?lmscalendar.curdate=curdate:lmscalendar.curdate=lmscalendar.curdate;var s=lmscalendar.curdate;lmscalendar.month!==(new Date).getMonth()&&(s="01");var r=new Date(e,t,s),l=r.getDay(),a=r.getDate();return l<weekstarts&&(a-=7),this.weekfromdate=new Date(e,t,curdate),this.weekfromdate.setDate(a-l+weekstarts),this.weektodate=new Date(e,t,curdate),this.weektodate.setDate(a-l+6+weekstarts),{from:this.weekfromdate,to:this.weektodate}},nextWeek:function(e){void 0!==e&&(this.weektodate=e.to,this.weekfromdate=e.from),this.weektodate.setDate(this.weektodate.getDate()+7),this.weekfromdate.setDate(this.weekfromdate.getDate()+7),lmscalendar.month=this.weekfromdate.getMonth(),lmscalendar.year=this.weekfromdate.getFullYear(),hashmonth=parseInt(lmscalendar.month)+1;var t="calendar/week/"+hashmonth+"/"+lmscalendar.year;return lms.changeHash("hash",t,"disable"),{from:this.weekfromdate,to:this.weektodate}},previousWeek:function(e){void 0!==e&&(this.weektodate=e.to,this.weekfromdate=e.from),this.weektodate.setDate(this.weektodate.getDate()-7),this.weekfromdate.setDate(this.weekfromdate.getDate()-7),lmscalendar.month=this.weekfromdate.getMonth(),lmscalendar.year=this.weekfromdate.getFullYear(),hashmonth=parseInt(lmscalendar.month)+1;var t="calendar/week/"+hashmonth+"/"+lmscalendar.year;return lms.changeHash("hash",t,"disable"),{from:this.weekfromdate,to:this.weektodate}},getOptions:function(e,t,s,r){var l={},a=["My courses"];l[1]=a;a=["All courses"];l[2]=a;var n=document.getElementById(s);lmscalendar.createMenu(l,n,r,"MySessions")},createMenu:function(e,t,s,r){lmsgroupmenu.initiate(document.getElementById(s)).insertMenu({elem:t,type:"select",mode:"single",menulist:e}),lmsmenu.changeToSelectMenu(t,{},"single",null,r)},populateCalendar:function(e,t,s,r){"week"!=e&&lmscalendar.getCalView(t,s),$("#zp_calMode").find(".sel").removeClass("sel");var l="week"!==e?2:1;$("#zp_calMode").find("li[order="+l+"]").addClass("sel");var a=weekstarts,n="";if("month"==e){if(lmscalendar.month>=12&&(lmscalendar.month=0,lmscalendar.year+=1),-1==lmscalendar.month){var o=new Date;lmscalendar.month=o.getMonth(),lmscalendar.year=o.getFullYear()}if(hashmonth=parseInt(lmscalendar.month)+1,null==r){var c="calendar/month/"+hashmonth+"/"+lmscalendar.year;lms.changeHash("hash",c,"disable")}lmscalendar._htmlRoot.querySelector('[class="IC-alft"]').setAttribute("data-ttip",ZPI18N.getString("zp.calprevmonth")),lmscalendar._htmlRoot.querySelector('[class="IC-argt"]').setAttribute("data-ttip",ZPI18N.getString("zp.calnextmonth"));Calendar.getFirstDayofMonth(s,t);lmscalendar.view=e;for(var d=0;d<days.length;d++)a=a>5?0:a+1;for(var m=0;m<6;m++){for(n+='<div class="zpt-calRow">',i=0;i<6;i++)n+='<div class="zpt-calCol"><div class="zpt-calHdr"><b>0</b><span></span></div></div>';n+='<div class="zpt-calCol"><div class="zpt-calHdr"><b>0</b><span></span></div></div></div>'}$(".zpt-calContainer").append(n),$(".zpt-calRow").hasClass("zpt_calWeek")&&$(".zpt-calRow").removeClass("zpt_calWeek"),lmscalendar.populateMonthDates(r)}else{hashmonth=parseInt(lmscalendar.month)+1;c="calendar/week/"+hashmonth+"/"+lmscalendar.year;for(lms.changeHash("hash",c,"disable"),lmscalendar._htmlRoot.querySelector('[class="IC-alft"]').setAttribute("data-ttip",ZPI18N.getString("zp.calprevweek")),lmscalendar._htmlRoot.querySelector('[class="IC-argt"]').setAttribute("data-ttip",ZPI18N.getString("zp.calnextweek")),lmscalendar.view=e,$(".zpt-calContainer").html(""),n+='<div class="zpt-calRow">',i=0;i<7;i++)n+='<div class="zpt-calCol "><div class="zpt-calHdr"><b>0</b><span></span></div></div>';n+="</div>",$(".zpt-calContainer").append(n),$(".zpt-calRow").addClass("zpt_calWeek"),document.getElementById("calContainer").classList.contains("zp_ht25")?document.getElementById("calContainer").classList.remove("zp_ht25"):document.getElementById("calContainer").classList.contains("zp_ht20")?document.getElementById("calContainer").classList.remove("zp_ht20"):document.getElementById("calContainer").classList.contains("zp_ht16")&&document.getElementById("calContainer").classList.remove("zp_ht16"),lmscalendar.populateWeekDates(t,s)}lmscalendar.month===(new Date).getMonth()&&(lmscalendar.todaySel(),lmscalendar.gotoToday())},gotoToday:function(){if(Layout.Page.hash.includes("calendar/")){var e=new Date;lmscalendar.day=e.getDate(),lmscalendar.month=e.getMonth(),lmscalendar.year=e.getFullYear();var t=lmscalendar.year+"-"+(e.getMonth()+1)+"-"+lmscalendar.day,s=lmscalendar._htmlRoot.querySelectorAll('[date="'+t+'"]');if(0!=s.length&&"zpt-calCol sel"==s[0].className)return void document.getElementById("todaysDate").scrollIntoView();var r=lmscalendar._htmlRoot.querySelectorAll('[class^="zpt-calCol sel"]');if(r.length>0&&(r[0].className="zpt-calCol"),"month"==lmscalendar.view){var l="calendar/month/"+parseInt(e.getMonth()+1)+"/"+lmscalendar.year;lms.changeHash("hash",l,"disable"),lmscalendar.populateMonthDates()}else{l="calendar/week/"+parseInt(e.getMonth()+1)+"/"+lmscalendar.year;lms.changeHash("hash",l,"disable"),lmscalendar.populateWeekDates()}var a=lmscalendar._htmlRoot.querySelectorAll('[date="'+t+'"]');a[0].className="zpt-calCol sel","month"==lmscalendar.view&&a[0].setAttribute("id","todaysDate")}},todaySel:function(){var e=lmscalendar._htmlRoot.querySelectorAll('[class="zpt-calCol sel"]');e.length>0&&("zpt-calCol sel prev"==e[0].className?e[0].className="zpt-calCol prev":e[0].className="zpt-calCol");var t=new Date;mon=t.getMonth()+1,date=t.getDate(),year=t.getFullYear();var s=year+"-"+mon+"-"+date,r=lmscalendar._htmlRoot.querySelectorAll('[date="'+s+'"]');0!=r.length&&(r[0].className="zpt-calCol sel","month"==lmscalendar.view&&r[0].setAttribute("id","todaysDate"))},populateMonthDates:function(e){""==lmscalendar.month&&""==lmscalendar.year?(month=lmscalendar.today.getMonth(),year=lmscalendar.today.getFullYear()):(month=lmscalendar.month,year=lmscalendar.year),$("#currMonth").html(months[month]+" "+year);var t=Calendar.daysInMonth(year,month-1),s=Calendar.daysInMonth(year,month);Layout.Page.parentContainer.find(".zpt-calContainer").find(".zpt-calCol").html("");var r=Layout.Page.parentContainer.find(".zpt-calContainer").find(".zpt-calCol"),l=Calendar.getFirstDayofMonth(year,month),a=!1,n=1,o=1,c=l;for(c--,i=0;i<r.length;i++)i!=l||a||(a=!0),a&&n&&o<=s?c>=0&&-1!=c&&0!=l?($(r[c]).addClass("prev"),r[c].innerHTML='<div class="zpt-calHdr"><b>'+t+"</b><span></span></div>",$(r[c]).attr("date",year+"-"+month+"-"+t),n++,28===i&&$($(".zpt-calContainer").children().get(4)).show(),35===i&&$($(".zpt-calContainer").children().get(5)).show(),42===i&&$($(".zpt-calContainer").children().get(6)).show(),t--,-1==--c&&(i=l-1)):($(r[i]).removeClass("prev"),r[i].innerHTML='<div class="zpt-calHdr"><b>'+o+"</b><span></span></div>",$(r[i]).attr("date",year+"-"+(month+1)+"-"+o),o++,28===i&&$($(".zpt-calContainer").children().get(4)).show(),35===i&&$($(".zpt-calContainer").children().get(5)).show(),42===i&&$($(".zpt-calContainer").children().get(6)).show()):(r[i].innerHTML="",28==i&&$($(".zpt-calContainer").children().get(4)).hide(),35==i&&$($(".zpt-calContainer").children().get(5)).hide(),42===i&&$($(".zpt-calContainer").children().get(6)).hide());$(".zpt-calContainer").removeClass("zp_ht20"),$(".zpt-calContainer").removeClass("zp_ht16"),$(".zpt-calContainer").addClass("zp_ht25"),void 0!==$($(".zpt-calContainer").children()).get(4)&&""===$($(".zpt-calContainer").children()).get(4).style.display&&($(".zpt-calContainer").removeClass("zp_ht25"),$(".zpt-calContainer").removeClass("zp_ht16"),$(".zpt-calContainer").addClass("zp_ht20")),void 0!==$($(".zpt-calContainer").children()).get(5)&&"table"===$($(".zpt-calContainer").children()).get(5).style.display&&($(".zpt-calContainer").removeClass("zp_ht25"),$(".zpt-calContainer").removeClass("zp_ht20"),$(".zpt-calContainer").addClass("zp_ht16")),"forweek"!=e&&lmscalendar.getCalendarData("month",month,year)},populateWeekDates:function(e){var t="";if(null==e){lmscalendar.todayflag=0;var s=new Date;lmscalendar.curdate=s.getDate(),lmscalendar.curWeek=lmscalendar.getCurrentWeek(),t=lmscalendar.curWeek}else t=e;var r=t.from,l=t.to.getMonth();t.to.getYear();$("#currMonth").html(t.from.getDate()+" "+ZPDateTime.months_short[t.from.getMonth()]+" "+t.from.getFullYear()+" - "+t.to.getDate()+" "+ZPDateTime.months_short[t.to.getMonth()]+" "+t.to.getFullYear()),$("#currMonth").attr("data-ttip",t.from.getDate()+" "+ZPDateTime.months_short[t.from.getMonth()]+" "+t.from.getFullYear()+" - "+t.to.getDate()+" "+ZPDateTime.months_short[t.to.getMonth()]+" "+t.to.getFullYear());for(var a=Layout.Page.parentContainer.find(".zpt-calContainer").find(".zpt-calCol"),n=0;n<7;n++){var i=new Date(r);i.getMonth()<l||i.getYear(),a[n].innerHTML='<div class="zpt-calHdr"><b>'+i.getDate()+"</b><span></span></div>",$(a[n]).attr("date",i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()),r.setDate(r.getDate()+1)}r.setDate(r.getDate()-7),lmscalendar.getCalendarData("week","","")},getCalendarData:function(e,t,s){var r="";if("week"==e){var l=Calendar.formatDate(lmscalendar.curWeek.from),a=Calendar.formatDate(lmscalendar.curWeek.to);r={method:"lmsCalendarView",month:0,year:null,fromDate:l,toDate:a,conreqcsr:csrfToken}}else r="month"===e?{method:"lmsCalendarView",month:t,year:s,conreqcsr:csrfToken}:{method:"lmsCalendarView",todaydate:curyear+"-"+(curmonth+1)+"-"+curdate,conreqcsr:csrfToken};r.courseId=lmscalendar.currentCourseId,r.batchId=lmscalendar.currentBatchId,null==r.courseId&&delete r.courseId,null==r.batchId&&delete r.batchId,$(".zpt-evnt").remove(),$(".ZPcalvw-month-item").remove(),$.post("/lmsCalendarAction.zp",r,(function(s){var l=s[1];null!=l[0]&&"undefined"!=l[0]&&$.each(l[0],(function(s,r){lmscalendar.constructCalData(r,s),curmonth==t&&"month"===e&&lmscalendar.gotoToday()})),null!=(l=l[1])[0]&&$.each(l[0],(function(t,s){"month"===e&&(s.date=r.year+"-"+(r.month+1)+"-"+s.date),"week"==e&&(s.date=lmscalendar.year+"-"+(lmscalendar.month+1)+"-"+s.date),lmscalendar.constructHoliday(s)}))}))},constructHoliday:function(e){var t=e.date.split("-"),s=t[1],r=t[2];"0"===s.charAt(0)&&(t[1]=s.replace("0","")),"0"===r.charAt(0)&&(t[2]=r.replace("0",""));var l=t[0]+"-"+t[1]+"-"+t[2];$(".zpt-calContainer").find(".zpt-calCol");$("[date='"+l+"']").append(e.txt)},constructCalData:function(e,t,s){var r={},l=new Array,a="",n=0;e.sessionobj&&($.each(e.sessionobj,(function(e,t){t.sessionStartTime=t.sessionStartTime/36e5;var s=Math.floor(t.sessionStartTime)/1;if(t.sessionStartTime%1!=0){var l=t.sessionStartTime%1;s+=l*=.6}t.sessionEndTime=t.sessionEndTime/36e5;var n=Math.floor(t.sessionEndTime)/1;if(t.sessionEndTime%1!=0){var i=t.sessionEndTime%1;n+=i*=.6}s>=12?(s-=12,s=parseFloat(s).toFixed(2),s+=" PM"):(s=parseFloat(s).toFixed(2),s+=" AM"),n>=12?(n-=12,n=parseFloat(n).toFixed(2),n+=" PM"):(n=parseFloat(n).toFixed(2),n+=" AM");var o=t.courseImage%4+1,c=1===o?" CBg1":2===o?" CBg2":3===o?" CBg3":" CBg4";null==document.getElementById("cal_"+t.sessionId)&&null==document.getElementById("cal_"+t.sessionId)&&(a+='<div class="zpl_crscal " id="cal_'+t.sessionId+'" onclick="lmscalendar.getViewCard(\''+t.sessionId+'\')"><div class="jc'+c+'" data-popup-open="calinfo"><em>'+s+" - "+n+"</em><div><b>"+t.sessionName+"</b> "+ZPI18N.getString("zp.lms.with")+" <b>"+ZPeople.decodeTxt(t.sessionTrainer)+"</b>"+t.courseName+"</div></div></div>"),r.date=t.sessionStartDate})),r.txt=a,l.push(r),"week"==s?NewCalendar.populateWeekCalendar(lmscalendar.weekCalendarObj,l):(lmscalendar.populateData(l,n),n++))},getViewCard:function(e){lmscalendar.isRequestSent||(lmscalendar.isRequestSent=!0,zplms.get("/lms/sessions/"+e,{startIndex:0,modeForView:"session"},(function(e){lmscalendar.isRequestSent=!1;var t=e[1][Object.keys(e[1])][0];lmscalendar.getSessionDetails(t,1)})))},getSessionDetails:function(e,t){var s=e,r="",l="",a="";""!=s.sessionStartDate&&(r=s.sessionStartDate),""!=s.sessionStartTime&&null!=s.sessionStartTime&&(l=s.sessionStartTime),""!=s.sessionEndTime&&null!=s.sessionEndTime&&(a=s.sessionEndTime);var n="";let i="";if(t){i=lmsbase.constructMaskv5("zpl_msm",!0).appendChild(document.createElement("div")),i.className="zpl_minr",n='<div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.lms.sessions.SessionInfo")+'</h4></div><a class="_cls PI_cls" onclick="lmsbase.closeMaskv5()" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></a></div>'}else $("body").addClass("zp_Tcfpv"),$(".zp_pwrap").find(".zp_Tmlft").remove(),$(".zp_pvcnt").hide(),n='<div class="zp_Tmlft">',n+='<div class="zp_CSdet" _rel="fileContent">';if(n+='<div class="zpl_mcnt zpl_fm"><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.coursename")+'</label></div><div><div class="zpl_recordview">'+s.sessionName+'</div></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.date")+'</label></div><div><div class="zpl_recordview">'+r+'</div></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.starttime")+'</label></div><div><div class="zpl_recordview">'+l+'</div></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.endtime")+'</label></div><div><div class="zpl_recordview">'+a+'</div></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.course.coursename")+'</label></div><div><div class="zpl_recordview">'+s.courseName+'</div></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.trainer")+'</label></div><div><div class="zpl_recordview">'+s.sessionTrainer+"</div></div></div>",s.description&&(n+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.messages.description")+'</label></div><div><div class="zpl_recordview">'+zplms.encodeHTML(s.description)+"</div></div></div>"),s.typeOfSession===ZPI18N.getString("zp.lms.classroom")&&s.sessionRoom&&(n+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.room")+'</label></div><div><div class="zpl_recordview">'+s.sessionRoom+"</div></div></div>"),s.gradeCategoryId&&(n+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.courseSetting.gradecategory")+'</label></div><div><div class="zpl_recordview">'+s.gradeCategoryName+"</div></div></div>"),n+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.gradeSetting.type")+'</label></div><div><div class="zpl_recordview">'+s.typeOfSession+"</div></div></div></div></div></div>",s.contentResource&&0!=s.contentResource.length){row+='<div _rel="attachments" class="zpa_comp"<h4 class="zp_Pttl">'+ZPI18N.getString("zpp.resources")+'</h4><div class="attch_view"><div id="filesAttch">';for(var o="",c=0;c<s.contentResource.length;c++){var d={contentId:s.contentResource[c].metaInfo.contentId,extension:s.contentResource[c].metaInfo.extension,name:s.contentResource[c].fileName,size:s.contentResource[c].metaInfo.size,type:s.contentResource[c].metaInfo.type};(o=ListingUploadManager.getSingleAttachmentHTML(d,lmsuploadmanager.ATTACHMENT_TYPE.SAVED,null,{deleteButton:!1})).setAttribute("link",s.contentResource[c].resourceId),row+=o.outerHTML}row+="</div></div></div>"}1==t?i?i.innerHTML=n:settingsPage.container.append(n):(row+='<div class="zp_CSttl"><i class="IC-back" data-ttip="'+ZPI18N.getString("zp.lms.back")+'" onclick="lmscontent.contentClose()"></i><font>'+s.sessionName+'</font><div> <i class="IC-tbmax" _rel = "sIcon" onclick="lmscontent.fileViewTabOpenClose()"></i></div></div>',$("[data-id='courseMain']").after(row),lmscontent.sideBarConstruction());var m=document.querySelector('[_rel="attachments"]');m&&lmsbase.addListener(m,"click",lmsmodule.saveToDownload,!1);var u=document.querySelector('[_rel="sessionRecording"]');u&&lmsbase.addListener(u,"click",lmssessions.sessionRecordingClick,!1);var p=document.querySelector('[_rel="sessionRecordingDiv"]');p&&lmsbase.addListener(p,"click",lmssessions.sessionRecordingClick,!1)},populateData:function(e,t){$.each(e,(function(e,t){var s=t.date.split("-"),r=s[1],l=s[2];"0"===r.charAt(0)&&(s[1]=r.replace("0","")),"0"===l.charAt(0)&&(s[2]=l.replace("0",""));var a=s[0]+"-"+s[1]+"-"+s[2];$(".zpt-calContainer").find(".zpt-calCol");$("[date='"+a+"']").append(t.txt)}))},courselistener:function(e){var t={};0!==e.length&&(t[0]=[ZPI18N.getString("zp.lms.course.allcourse"),""]);for(var s=0;s<e.length;s++)"Blended Learning"!==e[s].type&&"zp.lms.settings.InstructorLed"!==e[s].type||(t[e[s].courseId]=[e[s].courseName,""]);lmscalendar.menuCallBack(t,lmscalendar.inputvalue)},fetchCourseMenu:function(){lmscalendar.menuCallBack=this.updateOptionList,lmscalendar.inputvalue=this.value,lmscourses.getCourseGridDetails("",lmscalendar.courselistener,"1","Course Catalog")},fetchBatchMenu:function(){lmscalendar.menuCallBack=this.updateOptionList,lmscalendar.inputvalue=this.value;var e={method:"getBatchWithCnt",courseId:lmscalendar.currentCourseId,conreqcsr:csrfToken};$.post("/batchAction.zp",e,(function(e){lmscalendar.batchListener(e[1])}))},batchListener:function(e){var t={};if(e)for(var s=0;s<e.length;s++)t[e[s].batchId]=[e[s].batchName,""];lmscalendar.menuCallBack(t,lmscalendar.inputvalue)},clickAction:function(){"courseId"==this.fieldname&&(lmscalendar.currentCourseId=this.value)}},lmscalendarheader1={menuObj:"",initiate:function(e,t){if(lmscalendar._htmlRoot=this.elem,lmscalendar._htmlRoot.className+=" zp_calT",lmscalendar.currentCourseId=null,lmscalendar.currentBatchId=null,"month"!=this.hashObject.level1&&"week"!=this.hashObject.level1&&(this.hashObject.level1="month"),isNaN(this.hashObject.level2)||isNaN(this.hashObject.level3)||Number(this.hashObject.level2)<1||Number(this.hashObject.level2)>12||Number(this.hashObject.level3)<1e3||Number(this.hashObject.level3)>9999){Calendar.formatDate(new Date);this.hashObject.level1="month",this.hashObject.level2=lmscalendar.today.getMonth()+1,this.hashObject.level3=lmscalendar.today.getFullYear()}if("hash"!=this.type||"month"!=this.hashObject.level1&&""!=this.hashObject.level1&&"week"!=this.hashObject.level1||"NaN"!=this.hashObject.level2&&"NaN"!=this.hashObject.level3&&null!=this.hashObject.level2&&null!=this.hashObject.level3){if("hash"==this.type&&("month"==this.hashObject.level1||"week"==this.hashObject.level1)){Calendar.formatDate(new Date),a=lmscalendarheader.constructHeader();if(this.elem.innerHTML=a,$(".zp_fpv").hide(),lmscalendarheader.lftbutton=lmscalendar._htmlRoot.querySelector(".PI_alft"),lmscalendarheader.rgtbutton=lmscalendar._htmlRoot.querySelector(".PI_argt"),lmsbase.addListener(lmscalendarheader.lftbutton,"click",lmscalendar.previousNavigation,!1),lmsbase.addListener(lmscalendarheader.rgtbutton,"click",lmscalendar.nextNavigation,!1),s=parseInt(this.hashObject.level2),r=parseInt(this.hashObject.level3),"month"==this.hashObject.level1)if(this.hashObject.level2>12){this.hashObject.level2=12;var s=parseInt(this.hashObject.level2),r=parseInt(this.hashObject.level3);s=parseInt(lmscalendar.today.getMonth())+1,lmscalendar.month=s,lmscalendar.year=r,lmscalendar.populateCalendar("month",lmscalendar.month,lmscalendar.year);var l="calendar/month/"+s+"/"+lmscalendar.today.getFullYear();lms.changeHash("hash",l,"disable")}else lmscalendar.populateCalendar("month",s,r);else if("week"==this.hashObject.level1){s=parseInt(this.hashObject.level2),r=parseInt(this.hashObject.level3);lmscalendar.populateCalendar("month",s,r,"forweek");o="calendar/week/"+s+"/"+r;lms.changeHash("hash",o,"disable"),lmscalendar.populateCalendar("week")}}}else{Calendar.formatDate(new Date);var a=lmscalendarheader.constructHeader();if(this.elem.innerHTML=a,$(".zp_fpv").hide(),lmscalendarheader.lftbutton=lmscalendar._htmlRoot.querySelector(".PI_alft"),lmscalendarheader.rgtbutton=lmscalendar._htmlRoot.querySelector(".PI_argt"),lmsbase.addListener(lmscalendarheader.lftbutton,"click",lmscalendar.previousNavigation,!1),lmsbase.addListener(lmscalendarheader.rgtbutton,"click",lmscalendar.nextNavigation,!1),""!=this.hashObject.level1||null==this.hashObject.level2||null==this.hashObject.levl3){var n=parseInt(lmscalendar.today.getMonth())+1,i=parseInt(lmscalendar.today.getFullYear()),o="calendar/month/"+n+"/"+i;lms.changeHash("hash",o,"disable"),lmscalendar.month=n,lmscalendar.year=i,lmscalendar.populateCalendar("month",lmscalendar.month,lmscalendar.year)}else lmscalendar.populateCalendar("month",lmscalendar.month,lmscalendar.year)}lmscalendarheader.menuObj=lmsgroupmenu.initiate(this.elem.querySelector("#all-course"));var c=this.elem.querySelector("#allcourse");lmscalendarheader.groupCalMenu(c),lmscalendar._root=lms._page.container.querySelector('[class="zp_content"]'),lmsbase.addListener(lmscalendar._htmlRoot,"click",lmscalendarheader.clickHandler,!1)},clickHandler:function(e){var t=e.target,s=t.getAttribute("class");s&&null!=s&&"PI_argt"==s?lmscalendar.nextNavigation():s&&"PI_alft"==s&&lmscalendar.previousNavigation(),elem=t.getAttribute("_rel"),"Today"===elem&&lmscalendar.gotoToday()},groupCalMenu:function(e){lmscalendarheader.menuObj.insertMenu({elem:e,type:"select",mode:"single",menulist:lmscalendarheader.fetchCourses,click:lmscalendarheader.clickActionCal}),lmsmenu.changeToSelectMenu(e,{},"single",null,ZPI18N.getString("zp.lms.feedback.courses"))},fetchCourses:function(e){lmscalendar.menuCallBack=this.updateOptionList,lmscalendar.inputvalue=this.value,3===lms.role?lmscourses.getCourseGridDetails("",lmscalendar.courselistener,"1","MyCourses"):lmscourses.getCourseGridDetails("",lmscalendar.courselistener,"1","Course Catalog")},clickActionCal:function(e){lmscalendar.currentCourseId=e.value;for(var t=lmscalendar._htmlRoot.querySelectorAll('[class="zpt-evnt red"]'),s=0;s<t.length;s++)t[s].remove();lmscalendar.getCalendarData(lmscalendar.view,lmscalendar.month,lmscalendar.year)},constructHeader:function(){var e='<div class="zp_header" id="headerposition">';return e+='<div class="zp_CCcat"><div><div><div class="zp_Tabs" id="zp_calMode"><ul><li order="1" class="week" onclick="lmscalendar.populateCalendar(\'week\')">'+ZPI18N.getString("zp.week")+"</li>",e+='<li order="2" class="month sel" onclick="lmscalendar.populateCalendar(\'month\')">'+ZPI18N.getString("zp.month")+'</li></ul></div></div><font class="zp_caldt">',e+="<a data-ttip="+ZPI18N.getString("zp.today")+' id="Today" _rel="Today">'+ZPI18N.getString("zp.today")+'</a><i class="IC-alft" data-ttip='+ZPI18N.getString("zp.calprevmonth")+'></i><i class="IC-argt" data-ttip='+ZPI18N.getString("zp.calnextmonth")+'></i><font id="currMonth"></font></font>',e+='<div id="all-course" _rel="all-course"><div class="zp_Sm" id="allcourse"></div></div>',e+="</div></div></div>"}},lmsfileaction=function(){var e={};e[lms.appname]=!0;var t="lmsFileUpload",s="lmsFileDownload";function r(){S()}window.URL=window.URL||window.webkitURL,lmsbase.addListener(window,"hashchange",r);var l={FILEINTRANSIT:95,FILETRANSFERRED:96,INVALIDMODULENAME:97,AUTHORISATIONSUCCESSFUL:98,AUTHORISATIONFAILURE:99,FILETRANSFERSUCCESSFUL:100,FILETRANSFERFAILURE:101,VIRUSFOUND:102,FILESTOREDSUCCESSFULLY:103},a={UNSUPPORTED_FILE_TYPE:1,MAX_SIZE_EXCEEDED:2,IMAGE_SIZE_EXCEEDED:3},n={document:".doc,.docx,.odt,.sxw,.rtf",text_plain:".txt,.text,.xml,.log,.conf,.properties,.eml",text_executable:".c,.cpp,.html,.htm,.js,.css,.java,.jsp,.jspf,.py,.python,.go,.sh",text_table:".csv,.tsv",sheet:".xls,.xlsx,.ods,.sxc",presentation:".ppt,.pptx,.pps,.odp,.sxi",pdf:".pdf",zip:".zip,.rar,.7z",harmful:".pif,.application,.gadget,.msi,.msp,.com,.scr,.hta,.cpl,.msc,.jar,.bat,.cmd,.vb,.vbs,.vbe,.jse,.ws,.wsf,.wsc,.wsh,.ps1,.ps1xml,.ps2,.ps2xml,.psc1,.psc2,.msh,.msh1,.msh2,.mshxml,.msh1xml,.msh2xml,.scf,.lnk,.inf,.reg,.dll,.cgi,.docm,.dotm,.xlsm,.xltm,.xlam,.pptm,.potm,.ppam,.ppsm,.sldm,.ade,.adp,.apk,.bat,.chm,.cmd,.com,.cpl,.dll,.dmg,.exe,.hta,.ins,.isp,.jar,.js,.jse,.lib,.lnk,.mde,.msc,.msi,.msp,.mst,.nsh,.pif,.scr,.sct,.shb,.sys,.vb,.vbe,.vbs,.vxd,.wsc,.wsf,.wsh,.cab"},i={LOCAL:"local",CLOUD:"cloud",BOTH:"both"};function o(e,t){t||(this.file=e,this._uploadId=T(),this.errors={},this._hasErrors=!1)}function c(e){this.proto.constructor.call(this,e),this.state=0,this.queue=[],this.width=void 0,this.height=void 0}function d(){return this.storeArray=[],this.storeObject={},this}function m(){return this.storeArray=[],this.storeObject={},this}o.prototype.uploadId=function(){return this._uploadId},o.prototype.name=function(){return this.file.name},o.prototype.size=function(){return this.file.size},o.prototype.type=function(){return this.file.type},o.prototype.extension=function(){return void 0===this._extension&&(this._extension=k(this.name())),this._extension},o.prototype.toBlob=function(){return this.file},o.prototype.url=function(){return P(this.toBlob())},o.prototype.hasErrors=function(){return this._hasErrors},o.prototype.setERROR=function(e){this._hasErrors=!0,this.errors[e]=!0},o.prototype.toMap=function(){return{name:this.name(),size:this.size(),type:this.type(),extension:this.extension(),uploadId:this.uploadId(),hasErrors:this.hasErrors(),errors:this.hasErrors()?this.errors:void 0}},c.prototype=new o(null,!0),c.prototype.constructor=c.constructor,c.prototype.proto=new o(null,!0),c.prototype.dimensions=function(e){if(0==this.state){this.state=1,this.queue.push(e);var t=this,s=document.createElement("img"),r=this.url();s.src=r,s.style.zIndex="-9999999",s.style.opacity="0",s.onload=function(){t.state=2,z(r),this.parentNode.removeChild(this),t.width=this.naturalWidth,t.height=this.naturalHeight;for(var e=t.queue.length-1;e>=0;e--)t.queue[e](t.width,t.height)},document.body.appendChild(s)}else if(1==this.state)this.queue.push(e);else if(2==this.state){if(!e)return{width:this.width,height:this.height};e(this.width,this.height)}},c.prototype.toMap=function(){var e=this.proto.toMap.call(this);return e.width=this.width,e.height=this.height,e},d.prototype.overwrite=!1,d.prototype.parent={},d.prototype.proto=d.prototype,d.prototype.addToStore=function(e,t){var s=this.storeArray,r=this.storeObject,l={key:e,value:t};if(null==r[e]){var a=s.push(l);return r[e]=a-1,!0}return!!this.overwrite&&(s[r[e]]=l,!0)},d.prototype.deleteFromStore=function(e){if(!this.isEmpty()&&null!=this.storeObject[e]){var t=this.storeArray,s=this.storeObject,r=s[e],l=t.length-1;if(delete s[e],r!=l){var a=t[l];s[a.key]=r,t[r]=a}return t.length--,!0}return!1},d.prototype.getStoreObject=function(e){if(null!=this.storeObject[e])return this.storeArray[this.storeObject[e]].value},d.prototype.getAllStoreObjects=function(){return this.storeArray},d.prototype.isEmpty=function(){return 0==this.storeArray.length},d.prototype.resetStore=function(){this.storeArray=[],this.storeObject={}};var u=new d;delete u.storeArray,delete u.storeObject,m.prototype=u,m.prototype.constructor=m,m.prototype.parent=u.proto,m.prototype.proto=u,m.prototype.deleteFromStore=function(e){var t=this.getStoreObject(e);if(t)return t.requestStore.deleteAllReferences(),this.parent.deleteFromStore.call(this,e)},m.prototype.contains=function(e){for(var t=this.getAllStoreObjects(),s=t.length-1;s>=0;s--)uploadObjectInStore=t[s].value,uploadObjectInStore.equals(e)},m.prototype.areAllUploadInstanceDead=function(){for(var e=this.getAllStoreObjects(),t=e.length-1;t>=0;t--)if(uploadObject=e[t].value,uploadObject.isAlive())return!1;return!0};var p=new m,g=new d;function f(){return this.storeArray=[],this.storeObject={},this}function v(){this.click=null,this.validateupload=null,this.beforeupload=null,this.uploading=null,this.afterupload=null,this.authorisationSuccessful=null,this.authorisationFailure=null,this.invalidModuleNameGiven=null,this.fileTransferSuccessful=null,this.fileTransferFailure=null,this.virusFound=null,this.fileStoredSuccessfully=null,this.kill=null,this.bind=null,this.unbind=null,this.dropZoneEnter=null,this.dropZoneExit=null,this.lazyloadAdditionalInfo=null,this.enteredDropZone=!1,this.enteredDropZoneElement=null,this.isAdditionalInfoLazyLoaded=!1}function h(e,t,s,r){this.list=e,this.processingFunction=t,this.ondone=s,this.currentIndex=0,this.callbackObject=r,this.state=0}function b(e,t,s){if(e){for(var r=(e=e.split(",")).length-1,l={};r>=0;r--)void 0!==this.fileTypes[e[r]]&&(l[e[r]]=!0);this.fileTypes=l}else if(t){for(r=(t=t.split(",")).length-1,l=w(this.fileTypes);r>=0;r--)void 0!==this.fileTypes[t[r]]&&(l[t[r]]=!1);this.fileTypes=l}s&&(this.requiredExtensions=s)}f.prototype=g,f.prototype.constructor=f,f.prototype.parent=g.proto,f.prototype.proto=g,f.prototype.addToStore=function(e,t){if(this.parent.addToStore.call(this,e,t))return this.parent.addToStore.call(this.proto,e,t)},f.prototype.deleteFromStore=function(e){if(this.parent.deleteFromStore.call(this,e))return this.parent.deleteFromStore.call(this.proto,e)},f.prototype.deleteAllReferences=function(){for(var e=this.getAllStoreObjects(),t=0;t<e.length;t++)this.parent.deleteFromStore.call(this.proto,e[t].value.uploadId)},f.prototype.hasAnyPendingUploads=function(){for(var e=this.getAllStoreObjects(),t=0;t<e.length;t++){var s=e[t].value;if(s.state==l.FILEINTRANSIT||s.state==l.FILETRANSFERRED||s.state==l.AUTHORISATIONSUCCESSFUL||s.state==l.FILETRANSFERSUCCESSFUL)return!0}return!1},f.prototype.abortAllOngoingUploads=function(){for(var e=this.getAllStoreObjects(),t=0;t<e.length;t++){var s=e[t].value;s.state==l.FILEINTRANSIT&&s.xhr.abort()}},f.prototype.prepareForDeletion=function(){for(var e=this.getAllStoreObjects(),t=0;t<e.length;t++){var s=e[t].value;if(s.state==l.FILEINTRANSIT)s.xhr.abort();else if(s.state!=l.FILESTOREDSUCCESSFULLY&&s.state!=l.AUTHORISATIONSUCCESSFUL&&s.state!=l.FILETRANSFERSUCCESSFUL&&s.state!=l.FILETRANSFERRED)continue;this.deleteFromStore(s.key)}},v.prototype.on=function(e,t){return!!this.hasOwnProperty(e)&&(this[e]=t,!0)},v.prototype.isLazyLoadedAdditionalInfo=function(){var e=this.isAdditionalInfoLazyLoaded;return this.isAdditionalInfoLazyLoaded=!0,e},v.prototype.resetDropZone=function(){this.enteredDropZone=!1,this.enteredDropZoneElement=null},h.prototype.start=function(){if(0!=this.state)throw"Illegal Invocation, already started";this.state=1;var e=this;this.nextInvoker=function(){e.next()},this.stopInvoker=function(){e.stop()},this.process()},h.prototype.process=function(){this.currentIndex<this.list.length?(0,this.processingFunction)(this.list[this.currentIndex],this.nextInvoker,this.stopInvoker,this.callbackObject):this.stop()},h.prototype.next=function(){if(1!=this.state)throw"Illegal Invocation, already stopped or not started yet";this.currentIndex++,this.process()},h.prototype.stop=function(){if(2==this.state)throw"Illegal Invocation, already stopped";this.state=2,(0,this.ondone)(this.callbackObject,this.currentIndex)},b.EXTENSIONS=n,b.MIMES={image:"image/*",video:"video/*",audio:"audio/*",text:"text/*"},b.getAllSupportedFileTypes=function(){var e=this.EXTENSIONS,t=this.MIMES,s="";for(var r in e)s+=e[r]+",";for(var r in t)s+=t[r]+",";return s.slice(0,s.length-1)},b.isSupportedFile=function(e){var t=e.extension||k(e.name),s=e.type;return t&&(s.indexOf("image/")>-1||s.indexOf("video/")>-1||s.indexOf("audio/")>-1||s.indexOf("text/")>-1||this.isSupportedEXTENSION(t))},b.isSupportedEXTENSION=function(e){var t=this.EXTENSIONS;for(var s in t){if((","+t[s]+",").indexOf(","+e+",")>-1)return!0}return!1},b.prototype.fileTypes={image:!0,video:!0,audio:!0,document:!0,presentation:!0,sheet:!0,text:!0,pdf:!0,zip:!0,others:!0,harmful:!1,unknown:!0},b.prototype.isRequiredFile=function(e,t){var s=b.EXTENSIONS;return t?e.indexOf("image/")>-1?this.fileTypes.image:e.indexOf("video/")>-1?this.fileTypes.video:e.indexOf("audio/")>-1?this.fileTypes.audio:(","+s.document+",").indexOf(","+t+",")>-1?this.fileTypes.document:(","+s.sheet+",").indexOf(","+t+",")>-1?this.fileTypes.sheet:(","+s.presentation+",").indexOf(","+t+",")>-1?this.fileTypes.presentation:(","+s.pdf+",").indexOf(","+t+",")>-1?this.fileTypes.pdf:(","+s.zip+",").indexOf(","+t+",")>-1?this.fileTypes.zip:e.indexOf("text/")>-1||(","+s.text_plain+",").indexOf(","+t+",")>-1||(","+s.text_executable+",").indexOf(","+t+",")>-1||(","+s.text_table+",").indexOf(","+t+",")>-1?this.fileTypes.text:(","+s.harmful+",").indexOf(","+t+",")>-1?this.fileTypes.harmful:this.fileTypes.others:this.fileTypes.unknown},b.prototype.getSupportedFilesTypes=function(){var e="",t=this.requiredExtensions||b.EXTENSIONS,s=b.MIMES,r=this.fileTypes;for(var l in r)if(r[l]){if("others"==l||"unknown"==l||"harmful"==l){e="";break}"text"==l?(e+=t.text_plain+",",e+=t.text_executable+",",e+=t.text_table+",",e+=s.text+","):t[l]?e+=t[l]+",":s[l]&&(e+=s[l]+",")}return e.slice(0,e.length-1)};window.setInterval;var I,y,_,S,C=window.setTimeout,P=(window.clearInterval,window.clearTimeout,window.URL.createObjectURL),z=window.URL.revokeObjectURL,N=window.encodeURIComponent,T=window.generateUniqueKey,w=window.cloneObject,M=window.requestIdleCallback||function(e,t){C(e,t.timeout)};function L(t){return e[t]}function k(e){var t=e.lastIndexOf(".");return t>-1?e.slice(t):""}function Z(e,t){return e/(((new Date).getTime()-t)/1e3)}function A(e,t,s){return Math.ceil(function(e,t,s){return(t-e)/Z(e,s)}(e,t,s))+" seconds remaining"}function E(e){for(var t=["byte","KB","MB","GB","TB","PB","EB","ZB","YB"],s=0;s<t.length;s++){if(e<1024){var r=Math.floor(100*e)/100,l=Boolean(r%1)?r:Math.floor(r);return l+" "+(s?t[s]:l>1?t[s]+"s":t[s])}e/=1024}}function D(e,t){if(e.dataTransfer.items){t=t||1/0;for(var s=[],r=e.dataTransfer.items,l=0;l<r.length&&l<=t;l++)"file"===r[l].kind&&s.push(r[l].getAsFile());return s}return e.dataTransfer.files}function x(e){return{name:e.name,type:e.type,size:e.size}}function F(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"}function O(e){(function(e){return D(e,1).length>0})(e)&&(e.preventDefault(),e.dataTransfer.dropEffect="none")}function R(e,t,s,r,l){var a={portalId:_LOGGEDIN_ACCZSOID,fileId:e,type:t,isThumbnail:Boolean(r),mode:l||lms.appname,isInline:!s};return UDS_DOWNLOAD_URL+"/webdownload?x-service="+UDS_DOWNLOAD_SERVICE_CODE+"&event-id="+T()+"&x-cli-msg="+N(JSON.stringify(a))}function q(e,t,s,r){var l=previewEngineUrl+"/";if("thumbnail"==t||"image"==t)l+=t+"/"+previewServiceId+"/"+e;else if("pdf"==t)l+=t+"/"+previewServiceId+"/"+e;else if("document"==t||"presentation"==t||"sheet"==t)l+="preview/"+previewServiceId+"/"+e;else if("video"==t)l+=t+"/"+previewServiceId+"/"+e+"/",l+="byterange";else if("text/plain"==t||"text/executable"==t)l+="text/"+previewServiceId+"/"+e;else{if("audio"!=t)throw"Unknown Preview Type";l+="audio/"+previewServiceId+"/"+e}var a={moduleName:"LMS",fileId:s.fileId,type:s.type,portalId:_LOGGEDIN_ACCZSOID};if(1==r){let e="";return"presentation"==t&&lmsEntityView.entityPreview&&lmsmodule.fileInfo[lmsEntityView.currEntityId].progressData&&lmsmodule.fileInfo[lmsEntityView.currEntityId].progressData.currPagesViewed?e="&slide="+lmsmodule.fileInfo[lmsEntityView.currEntityId].progressData.currPagesViewed/1e3:"document"==t&&lmsEntityView.entityPreview&&lmsmodule.fileInfo[lmsEntityView.currEntityId].progressData&&lmsmodule.fileInfo[lmsEntityView.currEntityId].progressData.currPagesViewed&&(e="&page="+lmsmodule.fileInfo[lmsEntityView.currEntityId].progressData.currPagesViewed/1e3),l+"?cli-msg="+N(btoa(JSON.stringify(a)))+"&frameorigin="+window.location.origin+e}return l+"?cli-msg="+N(btoa(JSON.stringify(a)))+"&frameorigin="+window.location.origin}function U(e){var t=this.getResponseHeader("x-msg");if(null!=t){var s=JSON.parse(t);if(s.uploadId=this.uploadId,s.instanceKey=this.instanceKey,s.code==l.AUTHORISATIONFAILURE){var r=JSON.parse(this.getResponseHeader("x-error"));s.error=r}W(s)}else G.call(this.upload)}function B(){this.startTime=(new Date).getTime();var e=p.getStoreObject(this.instanceKey),t=e.events.onUploadStart;t&&t({uploadId:this.uploadId,callbackObject:e.callbackObject})}function H(){p.getStoreObject(this.instanceKey).requestStore.getStoreObject(this.uploadId).state=l.FILETRANSFERRED}function V(){p.getStoreObject(this.instanceKey).requestStore.getStoreObject(this.uploadId).state=l.FILETRANSFERFAILURE}function j(e){var t,s,r=p.getStoreObject(this.instanceKey),l=r.events.uploading;if(l){var a={remainingTime:A(e.loaded,e.total,this.startTime),uploadSpeed:(t=e.loaded,s=this.startTime,E(Math.floor(Z(t,s)))+"ps"),percentUploaded:Math.floor(e.loaded/e.total*100)+"%"};l({uploadId:this.uploadId,callbackObject:r.callbackObject},a)}}function G(e){var t=p.getStoreObject(this.instanceKey);if(t.autoretry){t.autoretry=!1;var s=t.requestStore.getStoreObject(this.uploadId);t.uploadFileByXHR(s.file)}else{W({instanceKey:this.instanceKey,uploadId:this.uploadId,code:l.FILETRANSFERFAILURE,message:"An error occured in the File Transfer"})}}function W(e){var t,s=e.uploadId,r=g.getStoreObject(s);if(!r)return!1;var a,n=(t=p.getStoreObject(r.uploadObjectKey)).callbackObject;r.state=e.code,e.code==l.FILESTOREDSUCCESSFULLY?(a=t.events.onFileStoredSuccessfully,r.fileInfo=w(e.fileInfo)):e.code==l.FILETRANSFERSUCCESSFUL?a=t.events.fileTransferSuccessful:(e.name=r.file.name,e.size=r.file.size,e.code==l.VIRUSFOUND?(a=t.events.onVirusFound,t.requestStore.deleteFromStore(s)):e.code==l.FILETRANSFERFAILURE?a=t.events.onFileTransferFailure:e.code==l.AUTHORISATIONFAILURE?(a=t.events.onAuthorisationFailure,t.requestStore.deleteFromStore(s)):e.code==l.AUTHORISATIONSUCCESSFUL?a=t.events.onAuthorisationSuccessful:e.code==l.INVALIDMODULENAME&&(a=t.events.onInvalidModuleNameGiven)),t.isAlive()?(r.isCancelled?r.renotifyObject=e:(a?delete e.code:a=t.events.afterupload,a(e,n)),t.isReadyToBeKilled()&&t.kill()):t.requestStore.hasAnyPendingUploads()||p.deleteFromStore(t.instanceKey)}function Y(e){for(;null!=e;){if(e.parentNode===document)return!0;e=e.parentNode}return!1}function X(e){this.instanceKey=T(),this.clickElement=e.clickElement,this.endAttribute="end"+T(),this.dropElement=e.dropElement,this.moduleName=e.moduleName,this.callbackObject=e.callbackObject,this.SUPPORTED_SOURCES=e.SUPPORTED_SOURCES,this.SUPPORTED_FILE_EXTENSIONS=e.SUPPORTED_FILE_EXTENSIONS,this.acceptUpdateClickAction=!1,this.appInfo=w(e.additionalInfo),this._isSoftKillEnabled=!1,this.isDead=!1,e.multiple?(this.multiple=!0,this.folderUpload=Boolean(this.folderUpload),e.MAX_NUMBER_OF_FILES_PER_UPLOAD&&(this.MAX_NUMBER_OF_FILES_PER_UPLOAD=e.MAX_NUMBER_OF_FILES_PER_UPLOAD)):this.MAX_NUMBER_OF_FILES_PER_UPLOAD=1,this.requiredFileTypes=new b(e.requiredFileTypes,e.notRequiredFileTypes,e.SUPPORTED_FILE_EXTENSIONS),this.requiredFileTypes.fileTypes.image&&e.MAX_IMAGE_SIZE&&(this.MAX_IMAGE_SIZE={WIDTH:e.MAX_IMAGE_SIZE.WIDTH,HEIGHT:e.MAX_IMAGE_SIZE.HEIGHT},this.isImageValidationRequired=!0),e.ACTION_ATTRIBUTE&&(this.ACTION_ATTRIBUTE=e.ACTION_ATTRIBUTE),e.MAXSIZE&&(this.MAXSIZE=e.MAXSIZE),this.events=new v,this.requestStore=new f}return _=!1,I=function(){_||(lmsbase.addListener(document.documentElement,"dragover",O),_=!0)},y=function(){_&&(lmsbase.removeListener(document.documentElement,"dragover",O),_=!1)},function(){var e=!1;function t(){!function(){for(var e,t=p.getAllStoreObjects(),s=t.length-1;s>=0;s--)Y((e=t[s].value).clickElement)||e.kill()}(),e=!1}S=function(){e||(M(t),e=!0)}}(),X.prototype.BYTES_LENGTH=1024,X.prototype.MAXSIZE=5242880,X.prototype.ACTION_ATTRIBUTE="_rel",X.prototype.MAX_NUMBER_OF_FILES_PER_UPLOAD=10,X.prototype.multiple=!1,X.prototype.folderUpload=!1,X.prototype.clickHandler=function(e){var t,s=this.events.click;if(s)this.acceptUpdateClickAction=!this.acceptUpdateClickAction,s(this.updateClickActionInvoker,e);else if(t=(t=e.target).closest("["+this.endAttribute+"] ["+this.ACTION_ATTRIBUTE+"]")||t){var r=t.getAttribute(this.ACTION_ATTRIBUTE);if(r==i.LOCAL||r==i.CLOUD){var l=this.events.validateupload;(this.NUMBER_OF_FILES_TO_UPLOAD=l(this.clickElement))>0&&(r!=i.LOCAL||this.SUPPORTED_SOURCES!=i.LOCAL&&this.SUPPORTED_SOURCES!=i.BOTH?r!=i.CLOUD||this.SUPPORTED_SOURCES!=i.CLOUD&&this.SUPPORTED_SOURCES!=i.BOTH||(lmsfileaction.activeCloudObject=this,Files.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl.replace("attachLimit=1","attachLimit="+lmsfileaction.activeCloudObject.NUMBER_OF_FILES_TO_UPLOAD)+(lmsfileaction.activeCloudObject.SUPPORTED_FILE_EXTENSIONS?"&fileExtensions="+lmsfileaction.activeCloudObject.SUPPORTED_FILE_EXTENSIONS.toString()+"&fileMimeTypes="+lmsfileaction.activeCloudObject.SUPPORTED_FILE_EXTENSIONS.toString():""),"LMS"),"editor"==this.appInfo.submodule&&lmsbase.addClass(document.querySelector(".modal-backdrop"),"zp_mskt0")):this.localFilePicker())}}},X.prototype.onSelect=function(e){this.filesHandler(e.target.files),this.onClose(e)},X.prototype.onDrop=function(e){var t=this.events.validateupload;if((this.NUMBER_OF_FILES_TO_UPLOAD=t(this.clickElement))>0){var s=D(e);this.filesHandler(s)}this.events.resetDropZone();var r=this.events.dropZoneExit;r&&r(this.dropElement)},X.prototype.localFilePicker=function(){var e=document.getElementById(t);e||((e=document.body.appendChild(document.createElement("input"))).id=t,e.name=t),e.value="",e.type="file",e.multiple=Boolean(this.multiple),e.webkitdirectory=Boolean(this.folderUpload),void 0===this.acceptValue&&(this.acceptValue=this.requiredFileTypes.getSupportedFilesTypes()),e.accept=this.acceptValue,e.style.zIndex="-9999999",e.style.opacity="0",e.onchange=this.onChangeInvoker,e.click()},X.prototype.onClose=function(e){e.target.parentNode.removeChild(e.target)},X.prototype.filesHandler=function(e){e.length&&this.validateFiles(e)},X.prototype.uploadViaXHRs=function(e){for(var t=0;t<e.length;t++)this.uploadFileByXHR(e[t])},X.prototype.uploadFileByXHR=function(e){var t=e.uploadId(),s=new XMLHttpRequest;s.instanceKey=s.upload.instanceKey=this.instanceKey,s.uploadId=s.upload.uploadId=t,lmsbase.addListener(s.upload,"loadstart",B),lmsbase.addListener(s.upload,"load",H),lmsbase.addListener(s.upload,"progress",j),lmsbase.addListener(s.upload,"error",G),lmsbase.addListener(s.upload,"abort",V),this.appInfo.portalId=_LOGGEDIN_ACCZSOID,this.appInfo.moduleName=this.moduleName,s.open("post",UDS_UPLOAD_URL,!0),s.setRequestHeader("x-streammode","1"),s.setRequestHeader("x-service",UDS_UPLOAD_SERVICE_CODE),s.setRequestHeader("app-info",JSON.stringify(this.appInfo)),s.setRequestHeader("file-info",JSON.stringify({fileName:N(e.name()),contentType:e.type(),fileSize:e.size()})),s.setRequestHeader("upload-id",t),s.setRequestHeader("x-fclient-version","2"),s.withCredentials=!0,s.onload=U,this.updateUploadInRequestStore(t,s,e),s.send(e.toBlob())},X.prototype.updateUploadInRequestStore=function(e,t,s){var r={uploadId:e,uploadObjectKey:this.instanceKey,file:s,xhr:t,state:l.FILEINTRANSIT,isCancelled:!1};this.requestStore.addToStore(e,r)},X.prototype.validateFiles=function(e){var t=this;new h(e,(function(e,s,r,l){return t.validateFile(e,s,r,l)}),(function(e,s){return t.afterValidation(e.files)}),{files:[],number_of_valid_files:0}).start()},X.prototype.validateFile=function(e,t,s,r){if(r.number_of_valid_files>=this.NUMBER_OF_FILES_TO_UPLOAD||r.number_of_valid_files>=this.MAX_NUMBER_OF_FILES_PER_UPLOAD)s();else{e=function(e){return 0==e.type.indexOf("image/")?new c(e):new o(e)}(e);if(r.files.push(e),this.requiredFileTypes.isRequiredFile(e.type(),e.extension())||e.setERROR(a.UNSUPPORTED_FILE_TYPE),e.size()>this.MAXSIZE&&e.setERROR(a.MAX_SIZE_EXCEEDED),e instanceof c&&this.isImageValidationRequired){var l=this;e.dimensions((function(s,n){l.validateImageSize(s,n)||e.setERROR(a.IMAGE_SIZE_EXCEEDED),e.hasErrors()||r.number_of_valid_files++,t()}))}else e.hasErrors()||r.number_of_valid_files++,t()}},X.prototype.validateImageSize=function(e,t){return e<=this.MAX_IMAGE_SIZE.WIDTH&&t<=this.MAX_IMAGE_SIZE.HEIGHT},X.prototype.afterValidation=function(e){for(var t=e.length-1,s=[],r=[];t>=0;t--)e[t].hasErrors()||s.push(e[t]),r.push(e[t].toMap());(0,this.events.beforeupload)(r,this.callbackObject),s.length&&(null==this.events.lazyloadAdditionalInfo||this.events.isLazyLoadedAdditionalInfo()?this.uploadViaXHRs(s):this.triggerAppInfoLazyLoading(s))},X.prototype.prepareFiles=function(e,t){for(var s,r,l=[],n=[],i=this.MAXSIZE,o=this.multiple?this.MAX_NUMBER_OF_FILES_PER_UPLOAD:1,c=this.NUMBER_OF_FILES_TO_UPLOAD,d=0;d<e.length&&l.length<=o&&l.length<=c;d++)(r=x(s=e[d])).errors={},r.hasErrors=!1,r.uploadId=s.uploadId=T(),r.extension=k(r.name),this.requiredFileTypes.isRequiredFile(r.type,r.extension)?s.size<i||"cloud"==t?l.push(s):(r.hasErrors=!0,r.errors[a.MAX_SIZE_EXCEEDED]=!0):(r.hasErrors=!0,r.errors[a.UNSUPPORTED_FILE_TYPE]=!0,s.size>i&&(r.errors[a.MAX_SIZE_EXCEEDED]=!0)),n.push(r);return e.length=d,{validFilesArr:l,filesArr:n}},X.prototype.updateClickAction=function(e){if(this.acceptUpdateClickAction){this.acceptUpdateClickAction=!this.acceptUpdateClickAction;var t=this.events.validateupload;(this.NUMBER_OF_FILES_TO_UPLOAD=t(this.clickElement))>0&&(e!=i.LOCAL||this.SUPPORTED_SOURCES!=i.LOCAL&&this.SUPPORTED_SOURCES!=i.BOTH?e!=i.CLOUD||this.SUPPORTED_SOURCES!=i.CLOUD&&this.SUPPORTED_SOURCES!=i.BOTH||(lmsfileaction.activeCloudObject=this,Files.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl.replace("attachLimit=1","attachLimit="+lmsfileaction.activeCloudObject.NUMBER_OF_FILES_TO_UPLOAD),"LMS")):this.localFilePicker())}},X.prototype.abortUploads=function(e){e=e instanceof Array?e:[e];for(var t=0;t<e.length;t++)this.abortUpload(e[t])},X.prototype.abortUpload=function(e){var t=this.requestStore.getStoreObject(e);t.isCancelled=!0,t.state==l.FILEINTRANSIT&&t.xhr.abort()},X.prototype.retryUpload=function(e){var t=this.requestStore.getStoreObject(e);t&&t.isCancelled&&(t.isCancelled=!1,t.state==l.FILETRANSFERFAILURE?this.uploadFileByXHR(t.file):t.state!=l.FILETRANSFERRED&&this.renotify(e))},X.prototype.renotify=function(e){var t=this.requestStore.getStoreObject(e);W(t.renotifyObject),delete t.renotifyObject},X.prototype.bind=function(){lmsbase.addListener(this.clickElement,"click",this.clickHandlerInvoker,!1),this.clickElement.parentElement.setAttribute(this.endAttribute,""),this.dropElement&&(lmsbase.addListener(this.dropElement,"dragenter",this.onDragEnterInvoker,!1),lmsbase.addListener(this.dropElement,"dragleave",this.onDragExitInvoker,!1),lmsbase.addListener(this.dropElement,"dragover",F,!1),lmsbase.addListener(this.dropElement,"drop",this.onDropInvoker,!1),I()),delete this.helperObject.bind,delete this.helperObject.on;var e=this.events.bind;e&&e()},X.prototype.unbind=function(){lmsbase.removeListener(this.clickElement,"click",this.clickHandlerInvoker,!1),this.clickElement.removeAttribute(this.endAttribute),this.dropElement&&(lmsbase.removeListener(this.dropElement,"dragenter",this.onDragEnterInvoker,!1),lmsbase.removeListener(this.dropElement,"dragleave",this.onDragExitInvoker,!1),lmsbase.removeListener(this.dropElement,"dragover",F,!1),lmsbase.removeListener(this.dropElement,"drop",this.onDropInvoker,!1)),p.areAllUploadInstanceDead()&&y();var e=this.events.unbind;e&&e()},X.prototype.kill=function(){this.requestStore.abortAllOngoingUploads(),this.unbind(),this.requestStore.hasAnyPendingUploads()||p.deleteFromStore(this.instanceKey),this.isDead=!0;var e=this.events.kill;e&&e(this.callbackObject)},X.prototype.onDragEnter=function(e){e.dataTransfer.dropEffect="copy";var t=this.events.dropZoneEnter;this.events.enteredDropZoneElement=e.target,t&&!this.events.enteredDropZone&&(this.events.enteredDropZone=!0,t(this.dropElement))},X.prototype.onDragExit=function(e){if(e.target===this.events.enteredDropZoneElement&&this.events.enteredDropZone){this.events.resetDropZone();var t=this.events.dropZoneExit;t&&t(this.dropElement)}},X.prototype.enableSoftKill=function(){this._isSoftKillEnabled=!0,this.isReadyToBeKilled()&&this.kill()},X.prototype.disableSoftKill=function(){this._isSoftKillEnabled=!1},X.prototype.isReadyToBeKilled=function(){return this._isSoftKillEnabled&&!this.requestStore.hasAnyPendingUploads()},X.prototype.isSoftKillEnabled=function(){return this._isSoftKillEnabled},X.prototype.isAlive=function(){return!this.isDead},X.prototype.triggerAppInfoLazyLoading=function(e){var t=this.events.lazyloadAdditionalInfo,s=this;null!=t&&t((function(t){s.appInfo=w(t),s.uploadViaXHRs(e)}))},X.prototype.equals=function(e){return this.clickElement===e.clickElement},{SOURCE:w(i),upload:function(e){if(!function(e){if(!L(e.moduleName))throw"Unregistered Module, use lmsfileaction.register(moduleName) to register your module";for(var t=p.getAllStoreObjects(),s=t.length-1;s>=0;s--)if(t[s].value.clickElement===e.clickElement)throw"Instance already running for the click element";return!0}(e))throw"Illegal uploadSpecObject";var t=new X(e),s=t.instanceKey;t.clickHandlerInvoker=function(e){return t.clickHandler(e)},t.onDropInvoker=function(e){return t.onDrop(e)},t.onDragEnterInvoker=function(e){return t.onDragEnter(e)},t.onDragExitInvoker=function(e){return t.onDragExit(e)},t.onChangeInvoker=s=>e.customChangeInvoker?e.customChangeInvoker.bind(t.callbackObject)(t,s):t.onSelect(s),t.updateClickActionInvoker=function(e,s){return t.updateClickAction(e)},this.on=function(e,s){return t.events.on(e,s)},this.bind=function(){return t.bind()},this.abortUploads=function(e){return t.abortUploads(e)},this.retryUpload=function(e){return p.getStoreObject(s).retryUpload(e)},this.kill=function(){return t.kill()},this.enableSoftKill=function(){return t.enableSoftKill()},this.disableSoftKill=function(){return t.disableSoftKill()},this.isAlive=function(){return t.isAlive()},t.helperObject=this,p.addToStore(s,t)},getErrors:function(){return w(a)},getStatusCodes:function(){return w(l)},register:function(t){e[t]=!0},isModuleRegistered:L,wmsCallback:function(e){W(e)},previewCallBack:function(e){},cloudUploadHandler:function(e,t){var s={};if(!e.values){var r=[e];(e={}).values=r}for(var l=0;l<e.values.length;l++){e.values[l].docType="image"==e.values[l].docType?"image/"+lmsfileaction.getFileExtension(e.values[l].docName):"video"==e.values[l].docType?"video/"+lmsfileaction.getFileExtension(e.values[l].docName):e.values[l].docType;var a={name:decodeURIComponent(e.values[l].docName),id:e.values[l].docId,type:e.values[l].mimeType?e.values[l].mimeType:e.values[l].docType};s[l]=a}if(s.length=e.values.length,s.length){var n=t.prepareFiles(s,"cloud");onbeforeupload=t.events.beforeupload,onupload=t.events.uploading,onbeforeupload(n.filesArr,t.callbackObject)}t.appInfo.portalId=_LOGGEDIN_ACCZSOID,t.appInfo.moduleName=t.moduleName;for(l=0;l<e.values.length;l++){var i={callbackObject:t.callbackObject,uploadId:n.validFilesArr[l].uploadId};uploadMonitorVar={typeOfUpload:"cloud"},onupload(i,uploadMonitorVar);var o={uploadId:n.validFilesArr[l].uploadId,docName:e.values[l].docName,accountId:e.values[l].accountId,provider:e.values[l].provider,docId:e.values[l].docId,docType:e.values[l].docType,mimeType:e.values[l].mimeType,filePath:e.values[l].filePath};lmsfileaction.uploadFile(o,t)}},uploadFile:function(e,t){appInfo={},appInfo.moduleName=t.appInfo.moduleName,appInfo.portalId=t.appInfo.portalId,params={action:"cloudFileUpload",docObj:JSON.stringify(e),appInfo:JSON.stringify(appInfo),conreqcsr:csrfToken},$.post("/fileAction.zp",params,(function(e){null!=e&&(onafterupload=t.events.afterupload,onafterupload(e,t.callbackObject))}))},generateSourceURL:function(e,t,s,r,l){e.extension=e.extension||lmsfileaction.getFileExtension(e.name),e.fileType=e.fileType||lmsfileaction.getFileType(e.type,e.extension),e.additionalInfo=e.additionalInfo||{fileId:e.contentId,type:0};var a=t?"thumbnail":e.fileType,n=e.additionalInfo;return 0==e.fileType.indexOf("text")&&1==e.sourceType?lmsfetchFile.generateSourceUrl(e):r||"thumbnail"!=a&&"sheet"!=a&&"presentation"!=a&&"document"!=a&&"image"!=a&&"audio"!=a&&"text/plain"!=a&&"text/executable"!=a||!lmsfileaction.isPreviewEngineSupported(a,e.extension)?"pdf"==e.fileType?"pdfViewer.zp?mode=LMS&fileId="+e.additionalInfo.fileId+"&type="+e.additionalInfo.type+"&contentId="+e.contentId:"sheet"==a||"document"==a||"presentation"==a?((n=w(n)||{fileId:contentId,type:0}).action="preview",n.moduleName=s||lms.appname,lmsfileaction.generateURL("fileAction.zp",n)):R(n.fileId,n.type,!1,t):1==l?q(e.contentId,a,n,l):q(e.contentId,a,n)},isPreviewEngineSupported:function(e,t){var s=".doc,.docx,.odt,.rtf",r=".xlsx",l=".ppt,.pptx,.pps",a=".txt,.xml,.log,.conf,.properties,.eml",n=".c,.cpp,.html,.htm,.js,.css,.java,.jsp,.py,.go,.sh";return t.indexOf(".")&&(t="."+t),t=","+t+",","document"==e?(","+s+",").indexOf(t)>-1:"sheet"==e?(","+r+",").indexOf(t)>-1:"presentation"==e?(","+l+",").indexOf(t)>-1:"text/plain"==e||"text/executable"==e?(","+a+",").indexOf(t)>-1||(","+n+",").indexOf(t)>-1:"thumbnail"==e||"image"==e||"audio"==e||void 0},setPreviewData:function(e,t,s){var r={requestURL:lmsfileaction.generateSourceURL(e,s),previewId:e.previewId||e.contentId};t=t||this.setPreviewURL,lmsfileaction.getPreviewData(r,s,t)},getPreviewData:function(e,t,s){var r=e.requestURL,l=new XMLHttpRequest;l.previewId=e.previewId,l.onload=function(){var e=URL.createObjectURL(this.response);s(e,this.previewId),s=null},l.open("get",r,!0),l.responseType="blob",l.setRequestHeader("app-Info",JSON.stringify({moduleName:lms.appname})),t&&l.setRequestHeader("file-Info",JSON.stringify(t)),l.withCredentials=!0,l.send()},setPreviewURL:function(e,t){lmsfileuploaddownload.setElementSource(this.getElement("previewId",t),e).removeAttribute("previewId")},getElement:function(e,t){return document.querySelector("["+e+"='"+t+"']")},setElementSource:function(e,t,s){s=s||"";var r=function(){z(t),lmsbase.removeListener(e,"load",r),t=r=null};return t.startsWith("blob")&&lmsbase.addListener(e,"load",r),e},saveToLocal:function(e,t,s){lmsfileaction._saveToLocal(R(e,t,!0,!1,s))},_saveToLocal:function(e){var t=document.getElementById(s);t||((t=document.createElement("iframe")).id=s,t.name=s),t.src=e,t.style.zIndex="-9999999",t.style.display="none",document.body.appendChild(t)},getFileExtension:k,getFileSize:E,generateURL:function(e,t){var s="";for(var r in t)s+=r+"="+t[r]+"&";return e+"?"+(s=s.slice(0,s.length-1))},getFileType:function(e,t){t.indexOf(".")&&(t="."+t),t=","+t+",";var s="unknown",r=n;return e.indexOf("image")>-1?s="image":e.indexOf("video")>-1?s="video":e.indexOf("audio")>-1?s="audio":(","+r.document+",").indexOf(t)>-1?s="document":(","+r.sheet+",").indexOf(t)>-1?s="sheet":(","+r.presentation+",").indexOf(t)>-1?s="presentation":(","+r.text_plain+",").indexOf(t)>-1?s="text/plain":(","+r.text_table+",").indexOf(t)>-1?s="text/table":(","+r.text_executable+",").indexOf(t)>-1?s="text/executable":(","+r.pdf+",").indexOf(t)>-1?s="pdf":(","+r.zip+",").indexOf(t)>-1?s="zip":""==e&&",.,"==t||(s="others"),s},initVideoPlayer:function(e,t){e instanceof HTMLVideoElement||(e=document.getElementById(e)),lmsfileaction.is_HLS_Supported()?e.src=t:lmsfileaction.initDashPlayer(e,t)},initDashPlayer:function(e,t){var s=dashjs.MediaPlayer().create();return s.setXHRWithCredentialsForType("GET",!0),s.setXHRWithCredentialsForType("MPD",!0),s.setXHRWithCredentialsForType("XLinkExpansion",!0),s.setXHRWithCredentialsForType("InitializationSegment",!0),s.setXHRWithCredentialsForType("IndexSegment",!0),s.setXHRWithCredentialsForType("MediaSegment",!0),s.setXHRWithCredentialsForType("BitstreamSwitchingSegment",!0),s.setXHRWithCredentialsForType("other",!0),e instanceof HTMLVideoElement||(e=document.getElementById(e)),s.initialize(e,t,!0),s},getDisplayFileType:function(e,t){},is_HLS_Supported:function(){},getOS:function(){},unload:function(){y(),S()}}}(),lmsuploadmanager=function(){var e={SINGLEIMAGEUPLOADMANAGER:1,LISTINGUPLOADMANAGER:2,INLINELISTINGUPLOADMANAGER:3},t={NEW:"new",ERROR:"error",SAVED:"saved",UPLOADED:"uploaded"},s={INPROGRESS:1,SUCCESS:2,FAILURE:3,NOTAVAILABLE:4},r=lmsfileaction.getStatusCodes(),l="uploadInfoId",a="uploadId",n="attachment";function i(){return this.storeArray=[],this.storeObject={},this}function o(){return this.storeArray=[],this.storeObject={},this.uploadIdMapping={},this}i.prototype.overwrite=!1,i.prototype.parent={},i.prototype.proto=i.prototype,i.prototype.addToStore=function(e,t){var s=this.storeArray,r=this.storeObject,l={key:e,value:t};if(null==r[e]){var a=s.push(l);return r[e]=a-1,!0}return!!this.overwrite&&(s[r[e]]=l,!0)},i.prototype.deleteFromStore=function(e){if(!this.isEmpty()&&null!=this.storeObject[e]){var t=this.storeArray,s=this.storeObject,r=s[e],l=t.length-1;if(delete s[e],r!=l){var a=t[l];s[a.key]=r,t[r]=a}return t.length--,!0}return!1},i.prototype.getStoreObject=function(e){if(null!=this.storeObject[e])return this.storeArray[this.storeObject[e]].value},i.prototype.getAllStoreObjects=function(){return this.storeArray},i.prototype.isEmpty=function(){return 0==this.storeArray.length},i.prototype.resetStore=function(){this.storeArray=[],this.storeObject={}};var c=new i;function d(){return this}function m(){this.ondelete=null,this.getSingleAttachment=null,this.onbeforeupload=null,this.onUploading=null,this.onafterupload=null,this.onAuthorisationSuccessful=null,this.onAuthorisationFailure=null,this.onFileTransferSuccessful=null,this.onFileTransferFailure=null,this.onInvalidModuleNameGiven=null,this.onVirusFound=null,this.onFileStoredSuccessfully=null,this.onCleanUp=null,this.getPreviewObject=null,this.lightbox_src_callback=null,this.lightbox_click_callback=null,this.onMaximumUploadLimitReached=null,this.onUploadsStart=null,this.onUploadsFinished=null,this.onkill=null}function u(e,t,s){this.uploadInfoId=f(),this.isDeleted=!1,this.isUploaded=e,this.uploadStatus=t,this.uploadId=s}delete c.storeArray,delete c.storeObject,o.prototype=c,o.prototype.constructor=o,o.prototype.parent=c.proto,o.prototype.proto=c,o.prototype.addToStore=function(e,t){t.uploadId&&(this.uploadIdMapping[t.uploadId]=e),this.parent.addToStore.call(this,e,t)},o.prototype.deleteFromStore=function(e){var t=this.getStoreObject(e);t&&t.uploadId&&delete this.uploadIdMapping[t.uploadId],this.parent.deleteFromStore.call(this,e)},o.prototype.getStoreObjectUsingUploadId=function(e){var t=this.getUploadInfoId(e);if(t)return this.getStoreObject(t)},o.prototype.getUploadInfoId=function(e){return this.uploadIdMapping[e]},o.prototype.hasAnyVisibleAttachments=function(){for(var e=this.storeArray,t=0;t<e.length;t++)if(!e[t].value.isDeleted)return!0;return!1},o.prototype.hasAnyPendingUploads=function(){for(var e,t=this.storeArray,r=0;r<t.length;r++)if(!(e=t[r].value).isDeleted&&e.getUploadStatus()==s.INPROGRESS)return!0;return!1},o.prototype.getUploadedFiles=function(){for(var e,t=this.storeArray,r=0,l=[];r<t.length;r++)(e=t[r].value).isUploaded&&e.uploadStatus==s.SUCCESS&&!e.isDeleted&&l.push({element:e.attachmentElement,fileInfo:e.fileInfo});return l},o.prototype.getDeletedFiles=function(){for(var e,t=this.storeArray,s=0,r=[];s<t.length;s++)!(e=t[s].value).isUploaded&&e.isDeleted&&r.push(e.fileInfo);return r},o.prototype.getDeletedUploads=function(){for(var e,t=this.storeArray,r=0,l=[];r<t.length;r++)(e=t[r].value).isUploaded&&e.uploadStatus==s.SUCCESS&&e.isDeleted&&l.push(e.fileInfo);return l},o.prototype.getAllFilesForSaving=function(){for(var e,t=this.storeArray,r=0,l=[];r<t.length;r++)(e=t[r].value).isDeleted||(e.isUploaded?e.uploadStatus==s.SUCCESS&&l.push({element:e.attachmentElement,fileInfo:e.fileInfo}):l.push({element:e.attachmentElement,fileInfo:e.fileInfo}));return l},d.prototype.useDashPlayer=!1,d.prototype.autoplay=!0,d.prototype.queryKey=null,d.prototype.text_background="white",d.prototype.allow=["download","info","fullmode"],d.prototype.encoded=!0,d.prototype.set=function(e,t){return void 0!==this[e]&&(this[e]=t,!0)},m.prototype.on=function(e,t){if(!this.hasOwnProperty(e))throw"Illegal argument - "+e+" doesn't exist";if("function"!=typeof t)throw"Illegal argument - function required";this[e]=t},u.prototype.markAsDeleted=function(){this.isDeleted=!0},u.prototype.setFileInfo=function(e){this.fileInfo=e},u.prototype.setAttachmentElement=function(e){this.attachmentElement=e},u.prototype.getAttachmentElement=function(){return this.attachmentElement},u.prototype.hasAttachmentElement=function(){return Boolean(this.attachmentElement)},u.prototype.getUploadStatus=function(){return this.uploadStatus},u.prototype.createImmutableWrapperObject=function(){var e=this;return{isUploaded:function(){return e.isUploaded},getUploadStatus:function(){return e.uploadStatus},getFileInfo:function(){return e.fileInfo},getAttachmentElement:function(){return e.attachmentElement},isDeleted:function(){return e.isDeleted}}};var p=new i,g=window.cloneObject,f=window.generateUniqueKey;function v(e,t){t||(this.instanceKey=f(),this.listElement=e.listElement,this.uploadInfoId_Key=l+f(),this.queryKey=a+f(),this.attachmentTag=n+f(),this.undoStack=[],this.filesStore=new o,this.callbacks=new m,this.lightbox=new d,this.NUMBER_OF_SAVED_FILES=0,this.NUMBER_OF_UPLOADED_FILES=0,this.NUMBER_OF_FILES_UPLOADING=0),e.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED&&(this.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED=e.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED),e.listAttribute&&(this.listAttribute=e.listAttribute),e.actionAttribute&&(this.actionAttribute=e.actionAttribute),e.actionDelete&&(this.actionDelete=e.actionDelete),e.actionCancel&&(this.actionCancel=e.actionCancel),e.actionRetry&&(this.actionRetry=e.actionRetry)}setTimeout=window.setTimeout,clearTimeout=window.clearTimeout,requestAnimationFrame=window.requestAnimationFrame||function(e){setTimeout(e,0)},v.prototype.proto=v.prototype,v.prototype.parent={},v.prototype.listAttribute="attachmentList",v.prototype.actionAttribute="rel",v.prototype.actionDelete="delete",v.prototype.actionCancel="cancel",v.prototype.actionRetry="retry",v.prototype.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED=1,v.prototype.onafterUpload=function(e,t){var l=e.uploadId,a=this.filesStore.getStoreObjectUsingUploadId(l);callback=null,e.code==r.AUTHORISATIONFAILURE?(a.uploadStatus=s.FAILURE,callback=this.callbacks.onAuthorisationFailure,this.decrementNumberOfUploadedFiles(),this.decrementNumberOfUploadingFiles()):e.code==r.INVALIDMODULENAME?(a.uploadStatus=s.FAILURE,callback=this.callbacks.onInvalidModuleNameGiven,this.decrementNumberOfUploadedFiles(),this.decrementNumberOfUploadingFiles()):e.code==r.FILETRANSFERSUCCESSFUL?callback=this.callbacks.onFileTransferSuccessful:e.code==r.FILETRANSFERFAILURE?(a.uploadStatus=s.FAILURE,callback=this.callbacks.onFileTransferFailure,this.decrementNumberOfUploadedFiles(),this.decrementNumberOfUploadingFiles()):e.code==r.VIRUSFOUND?(a.uploadStatus=s.FAILURE,callback=this.callbacks.onVirusFound,this.decrementNumberOfUploadedFiles(),this.decrementNumberOfUploadingFiles()):e.code==r.FILESTOREDSUCCESSFULLY&&(a.uploadStatus=s.SUCCESS,a.fileInfo=e.fileInfo,callback=this.callbacks.onFileStoredSuccessfully,this.decrementNumberOfUploadingFiles()),callback||(callback=this.callbacks.onafterupload),callback&&(delete e.uploadId,callback(this.listElement,this.getAttachmentElement(l),e,t))},v.prototype.addSavedFiles=function(e){if(e.length){for(var r=this.listElement.querySelector("["+this.listAttribute+"]"),l=document.createDocumentFragment(),a=0;a<e.length;a++){var n=new u(!1,s.NOTAVAILABLE),i=this.callbacks.getSingleAttachment;n.setFileInfo(e[a]);var o=l.appendChild(i(e[a],t.SAVED));o[this.uploadInfoId_Key]=n.uploadInfoId,o.setAttribute(this.attachmentTag,""),n.setAttachmentElement(o),this.filesStore.addToStore(n.uploadInfoId,n)}r.appendChild(l),this.NUMBER_OF_SAVED_FILES+=e.length}},v.prototype.validateUpload=function(e,t){if(this.NUMBER_OF_UPLOADED_FILES+this.NUMBER_OF_SAVED_FILES<this.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED)return this.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED-(this.NUMBER_OF_UPLOADED_FILES+this.NUMBER_OF_SAVED_FILES);var s=this.callbacks.onMaximumUploadLimitReached;s&&s({clickElement:e,listElement:this.listElement},t)},v.prototype.uploadMonitor=function(e,t){var s=e.uploadId,r=this.callbacks.onUploading;r&&r(this.getAttachmentElement(s),t,e.callbackObj)},v.prototype.bind=function(){lmsbase.addListener(this.listElement,"click",this.clickHandlerInvoker,!1),delete this.helperObject.attachCallback,delete this.helperObject.addSavedFiles,delete this.helperObject.setLightBoxConfiguration},v.prototype.unbind=function(){lmsbase.removeListener(this.listElement,"click",this.clickHandlerInvoker,!1)},v.prototype.kill=function(e){this.unbind(),this.cleanUpListElement(),p.deleteFromStore(this.instanceKey);var t=this.callbacks.onkill;t&&t(e)},v.prototype.showList=function(){var e=this.listElement;e.style.display="",requestAnimationFrame((function(){e.scrollIntoView(!1),e=null}))},v.prototype.hideList=function(){this.listElement.style.display="none"},v.prototype.getAttachmentElement=function(e){return this.filesStore.getStoreObjectUsingUploadId(e).getAttachmentElement()},v.prototype.cleanUpListElement=function(){var e=this.listElement.querySelectorAll("["+this.listAttribute+"] ["+this.attachmentTag+"]");if(e.length)for(var t,r=this.callbacks.onCleanUp,l=e.length-1;l>=0;l--){var a=(t=e[l])[this.uploadInfoId_Key],n=this.filesStore.getStoreObject(a);delete t[this.uploadInfoId_Key],t.removeAttribute(this.attachmentTag),!n||n.isDeleted||n.uploadStatus==s.INPROGRESS||n.uploadStatus==s.FAILURE?t.parentNode.removeChild(t):r&&r(t)}},v.prototype.getAllUploadInfoIds=function(){for(var e,t=this.listElement.querySelector("["+this.listAttribute+"]").childNodes,s=[],r=0;r<t.length;r++)e=t[r],s[r]=e[this.uploadInfoId_Key];return s},v.prototype.deleteAttachment=function(e){var t=this.filesStore.getStoreObject(e);if(!t.isDeleted){var s=this.callbacks.ondelete,r=t.createImmutableWrapperObject(),l=this;r.deleteThis=function(){delete r.deleteThis,l._deleteAttachment(t)},s&&!s(r)||(delete r.deleteThis,this._deleteAttachment(t))}},v.prototype._deleteAttachment=function(e){if(!e.isDeleted){e.markAsDeleted();var t=e.attachment;if(e.isUploaded?e.uploadStatus==s.INPROGRESS?(this.abortUploads(e.uploadId),this.decrementNumberOfUploadedFiles(),this.decrementNumberOfUploadingFiles()):e.uploadStatus==s.SUCCESS?this.decrementNumberOfUploadedFiles():this.filesStore.deleteFromStore(e.uploadInfoId):this.NUMBER_OF_SAVED_FILES--,e.hasAttachmentElement()){t=e.getAttachmentElement();e.getUploadStatus()==s.FAILURE?t.parentNode.removeChild(t):t.style.display="none"}}},v.prototype.light_box_src_callback=function(e,t){var s=e.callbackObj.managerInstanceKey,r=p.getStoreObject(s),l=r.filesStore.getStoreObject(e.callbackObj.uploadInfoId),a=r.callbacks.lightbox_src_callback;l.fileInfo,e.callbackObj=e.callbackObj.passedObject,a(e,t)},v.prototype.light_box_click_callback=function(e){var t=e.managerInstanceKey;p.getStoreObject(t).callbacks.lightbox_click_callback.call(this,e.passedObject)},v.prototype.generatePreviewObject=function(e){var t=e.fileInfo;t.extension=t.extension||lmsfileaction.getFileExtension(t.name),t.fileType=t.fileType||lmsfileaction.getFileType(t.type,t.extension),getPreviewObject=this.callbacks.getPreviewObject;var s=getPreviewObject(t);return s.callbackObj={managerInstanceKey:this.instanceKey,uploadInfoId:e.uploadInfoId,passedObject:s.callbackObj},s},v.prototype.init_LIGHTBOX=function(e){var t=this.filesStore.getStoreObject(e);if(t.fileInfo&&!t.isDeleted){for(var s=this.getAllUploadInfoIds(),r=0,l=[];r<s.length;r++){var a=s[r],n=this.filesStore.getStoreObject(a);if(n&&n.fileInfo&&!n.isDeleted){n.previewInfo||(n.previewInfo=this.generatePreviewObject(n));var i=l.push(n.previewInfo);e==a&&(previewStartIndex=i-1)}}if(l.length){var o={startIndex:previewStartIndex,items:l,allow:this.lightbox.allow,queryKey:this.lightbox.queryKey,text_background:this.lightbox.text_background,autoplay:this.lightbox.autoplay,useDashPlayer:this.lightbox.useDashPlayer,encoded:this.lightbox.encoded};zplightbox.initiate(o).on("click",this.light_box_click_callback).on("src_not_given",this.light_box_src_callback).bind()}}},v.prototype.clickHandler=function(e){var t=e.target,s=t.closest("["+this.attachmentTag+"]");if(s){var r=s[this.uploadInfoId_Key],l=t.getAttribute(this.actionAttribute);r&&(l==this.actionDelete?this.deleteAttachment(r):this.init_LIGHTBOX(r))}},v.prototype.incrementNumberOfUploadingFiles=function(){if(this.NUMBER_OF_FILES_UPLOADING++,1==this.NUMBER_OF_FILES_UPLOADING){var e=this.callbacks.onUploadsStart,t=this.callbackObject;e&&setTimeout((function(){e(t),e=t=null}),0)}},v.prototype.decrementNumberOfUploadingFiles=function(){if(this.NUMBER_OF_FILES_UPLOADING--,!this.NUMBER_OF_FILES_UPLOADING){var e=this.callbacks.onUploadsFinished,t=this.callbackObject;e&&setTimeout((function(){e(t),e=t=null}),0)}},v.prototype.incrementNumberOfUploadedFiles=function(){this.NUMBER_OF_UPLOADED_FILES++},v.prototype.decrementNumberOfUploadedFiles=function(){this.NUMBER_OF_UPLOADED_FILES--};var h=new v({},!0);function b(e){v.call(this,e)}b.prototype=h,b.prototype.constructor=b,b.prototype.parent=h.proto,b.prototype.proto=b.prototype,b.prototype.addSavedFiles=function(e){this.parent.addSavedFiles.call(this,e),e.length?this.showList():this.hideList()},b.prototype.onbeforeUpload=function(e,r){this.showList();for(var l=this.listElement.querySelector("["+this.listAttribute+"]"),a=document.createDocumentFragment(),n=this.callbacks.getSingleAttachment,i=0;i<e.length;i++){var o=e[i].uploadId,c=new u(!0,e[i].hasErrors?s.FAILURE:s.INPROGRESS,o);c.getUploadStatus()===s.INPROGRESS&&(this.incrementNumberOfUploadedFiles(),this.incrementNumberOfUploadingFiles()),this.filesStore.addToStore(c.uploadInfoId,c),delete e[i].uploadId;try{var d=a.appendChild(n(e[i],e[i].hasErrors?t.ERROR:t.NEW,r));d.setAttribute(this.attachmentTag,""),d[this.uploadInfoId_Key]=c.uploadInfoId,c.setAttachmentElement(d)}catch(e){}}l.appendChild(a)},b.prototype._deleteAttachment=function(e){this.parent._deleteAttachment.call(this,e),this.filesStore.hasAnyVisibleAttachments()||this.hideList()};var I=new v({},!0);function y(e){v.call(this,e)}y.prototype=I,y.prototype.constructor=b,y.prototype.parent=I.proto,y.prototype.proto=b.prototype,y.prototype.onbeforeUpload=function(e,r){var l=this.callbacks.onbeforeupload,a=e[0],n=a.uploadId,i=new u(!0,a.hasErrors?s.FAILURE:s.INPROGRESS,n);i.getUploadStatus()===s.INPROGRESS&&(this.incrementNumberOfUploadedFiles(),this.incrementNumberOfUploadingFiles()),this.filesStore.addToStore(i.uploadInfoId,i),delete a.uploadId,l(this.listElement,a,i.getUploadStatus()==s.INPROGRESS?t.NEW:t.ERROR,r)},y.prototype.validateUpload=function(e,t){if(!this.filesStore.hasAnyPendingUploads()&&this.NUMBER_OF_SAVED_FILES<=1)return 1;var s=this.callbacks.onMaximumUploadLimitReached;s&&s({clickElement:e,listElement:this.listElement},t)},y.prototype.onafterUpload=function(e,s){if(e.code==r.FILESTOREDSUCCESSFULLY)for(var l,a=this.filesStore.getAllStoreObjects(),n=a.length-1;n>=0;n--)if((l=a[n].value).uploadId==e.uploadId){try{var i=this.listElement.querySelector("["+this.listAttribute+"]"),o=this.callbacks.getSingleAttachment,c=i.appendChild(o(e.fileInfo,t.UPLOADED,s));c.setAttribute(this.attachmentTag,""),c[this.uploadInfoId_Key]=l.uploadInfoId,l.setAttachmentElement(c)}catch(e){}l.setFileInfo(e.fileInfo)}else this._deleteAttachment(l);this.parent.onafterUpload.call(this,e,s)},y.prototype.addSavedFiles=function(e){this.showList(),this.parent.addSavedFiles.call(this,e)},y.prototype.bind=function(){return!1},y.prototype.unbind=function(){return!1};var _=new v({},!0);function S(e){v.call(this,e)}return S.prototype=_,S.prototype.constructor=S,S.prototype.parent=_.proto,S.prototype.proto=S.prototype,S.prototype.onbeforeUpload=function(e,t){for(var r=0;r<e.length;r++){var l=e[r].uploadId,a=new u(!0,e[r].hasErrors?s.FAILURE:s.INPROGRESS,l);a.getUploadStatus()===s.INPROGRESS&&(this.incrementNumberOfUploadedFiles(),this.incrementNumberOfUploadingFiles()),this.filesStore.addToStore(a.uploadInfoId,a),delete e[r].uploadId,onbeforeupload=this.callbacks.onbeforeupload,onbeforeupload(e[r],t)}},{ATTACHMENT_TYPE:g(t),UPLOADMANAGER_TYPE:g(e),UPLOAD_STATUS:g(s),initUploadManager:function(t,s){var r=t.type==e.SINGLEIMAGEUPLOADMANAGER?new y(t):t.type==e.INLINELISTINGUPLOADMANAGER?new S(t):new b(t),l=r.instanceKey;return r.abortUploads=s.abortUploads,r.retryUpload=s.retryUpload,r.clickHandlerInvoker=function(e){return r.clickHandler(e)},s.on("validateupload",(function(e,t){return r.validateUpload(e,t)})),s.on("beforeupload",(function(e,t){return r.onbeforeUpload(e,t)})),s.on("afterupload",(function(e,t){return r.onafterUpload(e,t)})),s.on("uploading",(function(e,t){return r.uploadMonitor(e,t)})),s.on("bind",(function(){return r.bind()})),s.on("unbind",(function(){return r.unbind()})),s.on("kill",(function(e){return r.kill(e)})),s.addSavedFiles=function(e){return r.addSavedFiles(e)},s.attachCallback=function(e,t){return r.callbacks.on(e,t)},s.setLightBoxConfiguration=function(e,t){return r.lightbox.set(e,t)},s.getUploadedFiles=function(e){return r.filesStore.getUploadedFiles(e)},s.getDeletedUploads=function(){return r.filesStore.getDeletedUploads()},s.getDeletedFiles=function(){return r.filesStore.getDeletedFiles()},s.getAllFilesForSaving=function(){return r.filesStore.getAllFilesForSaving()},s.hasAnyPendingUploads=function(){return r.filesStore.hasAnyPendingUploads()},delete s.abortUploads,delete s.retryUpload,r.helperObject=s,p.addToStore(l,r),s}}}(),zplightbox={_sDIM:{width:null,height:null},_permit:{print:!1,download:!1,info:!1,fullmode:!1},_itemlen:0,_clk:[],_cls:[],_timoutKey:null,_chov:!1,_events:{wheel:!1,drag:!1},_layer:{_root:null,_hd:null,_info:null,_body:null,_foot:null,_lftnav:null,_rgtnav:null,_zoom:[]},_dragdata:{initX:null,initY:null,scX:null,scY:null},_text_background:"white",_cNode:{_inx:null,_oDIM:{width:null,height:null},_cDIM:{width:null,height:null},_mode:"NOR",_zstate:-1,resize:!1},_startIndex:0,_queryKey:"previewId",_use_dash_player:!1,_autoplay:!0,_itemList:[],encoded:!1,_refer:{infoIndex:void 0},defaultValues:{_permit:["print","download","info","fullmode"]},_srcNotGiven:null,onload:void(window.URL=window.URL||window.webkitURL),initiate:function(e){return this._itemList=e.items,this._startIndex=e.startIndex,this._use_dash_player=Boolean(e.useDashPlayer),this._autoplay=Boolean(e.autoplay),this.encoded=Boolean(e.encoded),e.queryKey&&(this._queryKey=e.queryKey),this._permit=e.allow||this.defaultValues._permit,this},on:function(e,t){return"click"==e&&"function"==typeof t?this._clk.push(t):"close"==e&&"function"==typeof t?this._cls.push(t):"src_not_given"==e&&"function"==typeof t&&(this._srcNotGiven=t),this},bind:function(){this._itemlen=this._itemList.length-1,this.addPreviewLayer(),this._sDIM={width:this._layer._body.offsetWidth,height:this._layer._body.offsetHeight},this.loadpreview(this._startIndex);var e=this;return this._layer._root.addEventListener("click",this.clickHandlerInvoker=function(t){e.clickhandle(t)},!1),document.addEventListener("keyup",this.keyHandlerInvoker=function(t){e.keyhandle(t)},!1),document.addEventListener("mousemove",this.mousemoveHandlerInvoker=function(t){e.initclear(t)},!1),window.addEventListener("resize",this.resizeHandlerInvoker=function(){e.resizeHandle(event)},!1),this},addPreviewLayer:function(){var e=this._layer,t=e._root;(t=Layout.Page.container.closest(".main-wrp")[0].appendChild(document.createElement("div"))).className="zpl_Lbx",t.setAttribute("_rel","lightBoxCont"),e._root=t;var s=t.appendChild(document.createElement("div"));s.className="zpl_Lbx_hdr",e._hd=s;var r=t.appendChild(document.createElement("div"));r.className="zpl_Lbx_bdy",e._body=r;var l=r.appendChild(document.createElement("i"));l.className="PI_alft disb",l.setAttribute("_rel","lftnav"),l.setAttribute("title",ZPI18N.getString("zp.previous")),e._lftnav=l;var a=r.appendChild(document.createElement("i"));a.className="PI_argt",a.setAttribute("_rel","rgtnav"),a.setAttribute("title",ZPI18N.getString("zp.next")),e._rgtnav=a;var n=t.appendChild(document.createElement("div"));n.className="zpl_Lbx_ftr",e._foot=n},loadpreview:function(e){this._itemList[e=e||0];this.initCNode(),this._cNode._inx=e;var t=this._layer._lftnav,s=this._layer._rgtnav;0==e?(t.className="PI_alft disb",s.className="PI_argt"):e==this._itemList.length-1?(t.className="PI_alft",s.className="PI_argt disb"):(t.className="PI_alft",s.className="PI_argt"),this.showPreview()},initCNode:function(){this._cNode={_inx:null,_oDIM:{width:0,height:0},_cDIM:{width:0,height:0},_mode:"NOR",_zstate:-1,resize:!1}},showPreview:function(){var e=this._itemList[this._cNode._inx];this.addHeader(e),this.removeFooter(e),this.addbody(e),this.addFooter(e),this.addNavigation(),this.updateInfo()},addHeader:function(e){this._permit;var t=document.createElement("h6");t.className="addPopTitle",this.encoded?t.innerHTML=e.name:t.textContent=e.name;var s='<div class = "zpl_Lbx_ttl"><h6 title="'+e.name+'">'+e.name+'</h6></div><div class="zpl_Lbx_cls"><span><i class="PI_cls" _rel ="close" title="'+ZPI18N.getString("zp.close")+'"></i><em _rel="Esc">Esc</em></span></div>';this._layer._hd.innerHTML=s,this._layer._hd.style.display=""},addbody:function(e){this._layer;var t=[],s=this,r=this._layer._body;r.className="zpl_Lbx_bdy";let l=e.type;s.clearExistingContainers(r);const a=document.createElement("div");"image"!=l&&"audio"!=l&&"video"!=l||(a.className="zpl_Lbx_pv",a.setAttribute("_rel","previewCont"),r.appendChild(a));var n=e.src,i=!Boolean(n),o=i&&this.generateUniqueKey();if(e.callbackObj.additionalInfo&&2==e.callbackObj.additionalInfo.type){a.className="zpl_Lbx_pv",a.setAttribute("_rel","previewCont");const e=document.createElement("div");e.className="zpl_Emptydata Emp_dark";const t='<div><div class="zpl_emptimg zp_nd_file"></div><h4>'+ZPI18N.getString("zp.lms.resoursefilesnotpreviewed")+"</h4><p>"+ZPI18N.getString("zp.lms.downloadtoview")+'</p><font><button class="zlabel zlabel--blue zlabel--medium" _type="download" _rel="more">'+ZPI18N.getString("zp.Download")+"</button></font></div>";e.innerHTML=t,a.appendChild(e),r.appendChild(a)}else if("image"==e.type){a.appendChild(zplms.getLoadingBarElement()),r.className="zpl_Lbx_bdy zpl_Lbximg";var c=a.appendChild(document.createElement("img"));if(c.id="imgLBx",c.style.display="none",c.onload=function(e){s.onload_image(e)},i){c.setAttribute(this._queryKey,o);var d={type:e.type,previewId:o};t.push(d)}else c.src=n;c.oncontextmenu=function(){return!1}}else if("pdf"==e.type){var m=r.appendChild(document.createElement("iframe"));if(m.type="application/pdf",m.width="100%",m.height="100%",i){m.setAttribute(this._queryKey,o);var d={type:e.type,previewId:o};t.push(d)}else m.src=n+"#toolbar=0"}else if("audio"==e.type){a.appendChild(zplms.getLoadingBarElement());var u=a.appendChild(document.createElement("audio"));if(u.controls=!0,u.preload="auto",u.autoplay=this._autoplay,u.style.display="none",u.onloadedmetadata=function(e){s.onload_common(e)},i){u.setAttribute(this._queryKey,o);d={type:e.type,previewId:o};t.push(d)}else u.src=n;u.oncontextmenu=function(){return!1},u.controlsList="nodownload"}else if("video"==e.type){r.className="zpl_Lbx_bdy zpl_Lbximg",a.appendChild(zplms.getLoadingBarElement()),a.style.height="100%";var p=a.appendChild(document.createElement("video"));if(p.controls=!0,p.preload="auto",p.style.width="100%",p.style.height="100%",p.autoplay=this._autoplay,p.style.display="none",p.onloadedmetadata=function(e){s.onloadmetadata_video(e)},i){p.setAttribute(this._queryKey,o);d={type:e.type,previewId:o};t.push(d)}else this._use_dash_player?lmsfileuploaddownload.initDashPlayer(p,n):p.src=n;p.oncontextmenu=function(){return!1},p.controlsList="nodownload"}else if("document"==e.type||"presentation"==e.type||"sheet"==e.type||0==e.type.indexOf("text")){r.appendChild(zplms.getLoadingBarElement());var g=r.appendChild(document.createElement("iframe"));if(g.width="100%",g.height="100%",g.style.display="none",g.onload=function(t){s.onload_common(t),callbackObject=e.callbackObj||e.callbackObj.passedObject,0==e.type.indexOf("text")&&1==callbackObject.sourceType&&lmseditor.validateContent(g)},e.type.indexOf("text/")>-1&&(g.style.background=this._text_background),i){g.setAttribute(this._queryKey,o);d={type:e.type,previewId:o};t.push(d)}else g.src=n}else r.appendChild(lmsattachment.getDisplayIcon(e.type));t.length&&((d=t[0]).callbackObj=e.callbackObj,this._srcNotGiven(d,(function(t,r){var l=e,a=d;s.updateSRC(t,l,a,r),l=a=null})))},clearExistingContainers:function(e){const t=e||this._layer._body,s=t.querySelector('[_rel = "previewCont"]');s&&s.remove();const r=$(t).find("iframe");r&&r.remove();const l=t.querySelector('[_rel = "loadbar"]');l&&l.remove();const a=e.querySelector('[_rel = "zoomBarCont"]');a&&a.remove()},addZoomBar:function(){const e=this._layer._body;if(null!=e){const t=document.createElement("div");t.className="zpl_Lbx_zom",t.setAttribute("_rel","zoomBarCont"),t.innerHTML='<div><span>100%</span><div><i class="PI_plus"></i><input class="" type="range" id= "zoomRange" min="0" max="100" value="0"><i class="PI_minus"></i></div><span>0%</span></div>',e.appendChild(t),this._layer._zoom=t.querySelectorAll("i"),$(t).find("#zoomRange").on("input",(function(){zplightbox.zoomFile(this.value)}))}},zoomFile:function(e){const t=$(window.document).find(".zpl_Lbx_bdy").find("#zoomRange"),s=this._layer._body.querySelector("#imgLBx");let r=(t.val()-t.attr("min"))/(t.attr("max")-t.attr("min")),l=0,a=this._cNode._mode;if("NOR"!=a)if("HGT"==a){let e=parseInt(this._cNode._oDIM.height),t=parseInt(this._cNode._cDIM[0]);l=Math.round((e-t)/100);let a=t+100*Math.round(r*l);s.style.height=(a>e?e:a)+"px",zplightbox.updateZoomBtnClass(r)}else{let e=parseInt(this._cNode._oDIM.width),t=parseInt(this._cNode._cDIM[1]);l=Math.round((e-t)/100);let a=t+100*Math.round(r*l);s.style.width=(a>e?e:a)+"px",this.updateZoomBtnClass(r)}},updateZoomBtnClass:function(e){const t=this._layer._body.querySelector(".PI_minus"),s=this._layer._body.querySelector(".PI_plus");0==e&&t?t.className="PI_minus zp_opac":e>0&&e<100&&t&&s?(t.className="PI_minus",s.className="PI_plus"):100==e&&s&&(s.className="PI_plus zp_opac")},updateSRC:function(e,t,s,r){var l=this._layer._body.querySelector("["+this._queryKey+"='"+r+"']");l?("pdf"==t.type?lmsfileaction.setElementSource(l,e,"#toolbar=0"):"audio"==t.type?("poster"==s.type?t.poster_src=e:t.src=e,l.src=e):"video"==t.type?"poster"==s.type?(t.poster_src=e,l.src=e):(t.src=e,this._use_dash_player?lmsfileaction.initDashPlayer(l,e):l.src=e):(t.src=e,l.src=e),l.removeAttribute("previewId")):this._root?t.src=e:e.startsWith("blob")?URL.revokeObjectURL(e):t.src=e},onload_image:function(e){this.removeLoading(),_node=this._itemList[this._cNode._inx],_node.width=e.target.naturalWidth,_node.height=e.target.naturalHeight,this._cNode._oDIM={width:_node.width,height:_node.height};var t=this.getPviewSize();e.target.style.height=t[0],e.target.style.width=t[1],e.target.style.display="",this.setZoomProp(),this._cNode._zstate>-1&&zplightbox.addZoomBar()},onloadmetadata_video:function(e){this.removeLoading(),e.target.style.display="";this._itemList[this._cNode._inx]},onload_common:function(e){this.removeLoading(),e.target.style.display="",e.target.onload=null;this._itemList[this._cNode._inx]},addNavigation:function(){var e="none",t=this._layer;this._itemList.length>1&&(e=""),t._lftnav.style.display=e,t._rgtnav.style.display=e},addFooter:function(e){var t=this._permit,s='<div class="zpl_Lbx_act">'+(t.indexOf("info")>-1?'<div class="zpl_Lbx_drp" _rel="infoPopup"><span><i class="PI_info'+(this._layer.isInfoCardOpen?" sel":"")+'" _rel="more" _type="info" title="'+ZPI18N.getString("zp.info")+'"></i></span></div>':"")+(t.indexOf("download")>-1&&(!e.kind||"DL"==e.kind)?'<i class="PI_downld" _rel="more" _type="download" title="'+ZPI18N.getString("zp.Download")+'"></i>':"")+(t.indexOf("print")>-1?'<i class="PI_print" _rel="more" _type="print" title="'+ZPI18N.getString("zp.print")+'"></i>':"")+"</div>";this._layer._foot.innerHTML=s,this._layer._foot.style.display="",this.setZoomProp()},removeFooter:function(e){this._layer._foot.innerHTML="",this.removeZoomProp()},constructInfo:function(e,t,s){var r=this._layer;const l=r._foot.querySelector('[_rel = "infoPopup"]');l.className="zpl_Lbx_drp opn",this._layer._root.className="zpl_Lbx sldopn info_sld";const a=r._foot.querySelector('[_type = "info"]');a&&(a.className="PI_info sel"),r.info=l,l&&r.info.appendChild(t),this._layer.isInfoCardOpen=!0},updateInfo:function(){this._layer._foot.querySelector('[_type = "info"]'),this._layer._root.querySelector('[_rel = "infoCardPopup"]');this._permit.indexOf("info")>-1&&this._layer.isInfoCardOpen&&this.moreActions("info")},toggleInfo:function(){const e=this._layer._foot.querySelector('[_type = "info"]');e&&e.classList.toggle("sel");const t=this._layer._foot.querySelector('[_rel = "infoPopup"]');t&&t.classList.toggle("opn"),this._layer._root.classList.toggle("sldopn"),this._layer._root.classList.toggle("info_sld"),this._layer.isInfoCardOpen=!1,this.resizeHandle()},hideInfo:function(){this._layer._root.className="zpl_Lbx",this.resizeHandle()},setZoomProp:function(){var e=this._cNode;if("image"==this._itemList[e._inx].type&&("HGT"==e._mode&&parseInt(e._cDIM[0],10)<e._oDIM.height||"WID"==e._mode&&parseInt(e._cDIM[1],10)<e._oDIM.width)){e._zstate=0}else this.removeZoomProp()},removeZoomProp:function(){this._cNode._zstate=-1},getPviewSize:function(){var e,t=this._cNode,s=t._oDIM.height,r=t._oDIM.width,l=this._sDIM.height,a=this._sDIM.width,n="HGT"==(e=s>r?s<l?"NOR":r*l/s<a?"HGT":"WID":r<a?s>l?"HGT":"NOR":s*a/r>l?"HGT":"WID")?[l+"px","auto"]:"WID"==e?["auto",a+"px"]:[s+"px",r+"px"];return t._cDIM=n,t._mode=e,n},keyhandle:function(e){var t=e.which||e.keyCode||e.charCode,s=this._cNode;39==t&&s._inx<this._itemList.length-1?this.loadpreview(++s._inx):37==t&&s._inx>0?this.loadpreview(--s._inx):27==t&&this.closePreview()},clickhandle:function(e){var t=e.target||e.src,s=(t.tagName.toLowerCase(),this._cNode),r=t.getAttribute("_rel");if("lftnav"==r&&s._inx>0)this.loadpreview(--s._inx);else if("rgtnav"==r&&s._inx<this._itemList.length-1)this.loadpreview(++s._inx);else if(this.hasClass(t,"PI_minus")&&!this.hasClass(t,"zp_opac"))this.zoomHandler(1);else if(this.hasClass(t,"IC-zoom")&&!this.hasClass(t,"zp_opac"))this.zoomHandler(0);else if(this.hasClass(t,"PI_plus")&&!this.hasClass(t,"zp_opac"))this.zoomHandler(-1);else if("hideinfo"==r||t.closest('[_rel = "hideinfo"]'))this.toggleInfo();else if("more"==r){var l=t.getAttribute("_type");this.moreActions(l)}else"close"!=r&&"Esc"!=r||this.closePreview()},moreActions:function(e){var t=this._clk,s=this._cNode,r={type:e};if("info"==e){if(r.encoded=this.encoded,this._refer.infoIndex===s._inx)return void this.toggleInfo();this._refer.infoIndex=s._inx,r.container=document.createElement("div"),r.setTitle=function(e){r.title=e}}for(var l in t)t[l].call(r,this._itemList[s._inx].callbackObj);"info"==e&&this.constructInfo(r.title,r.container)},initclear:function(e){var t=function(e){r._chov||(r._hd.style.opacity=e,r._hd.style.opacity=e,r._foot.style.opacity=e)},s=this._timoutKey,r=this._layer;t(1),s&&window.clearTimeout(s);var l=e.target||e.srcElement;r._chov=!!(r._hd.contains(l)||r._foot.contains(l)||r._lftnav.contains(l)||r._rgtnav.contains(l)),this._timoutKey=window.setTimeout((function(){t(0)}),3e3)},wheelHandle:function(e){var t=e.deltaY||e.wheelDelta||e.detail;this.zoomHandler(t)},dragHandle:function(e){var t=this._dragdata,s=this._layer._body;t.initX=e.clientX,t.initY=e.clientY,t.scX=s.scrollLeft,t.scY=s.scrollTop;var r=this,l=function(e){var t=r._dragdata,s=r._layer._body;s.scrollLeft=t.scX+t.initX-e.clientX,s.scrollTop=t.scY+t.initY-e.clientY},a=function(){document.body.removeEventListener("mousemove",l,!1),document.body.removeEventListener("mouseup",a,!1),document.body.removeEventListener("mouseout",a,!1)};document.body.addEventListener("mousemove",l,!1),document.body.addEventListener("mouseup",a,!1),document.body.addEventListener("mouseout",a,!1)},zoomHandler:function(e){var t,s=this._cNode;if("image"!=this._itemList[s._inx].type)return;t=this._layer._body.querySelector("img");var r=s._oDIM.height,l=s._oDIM.width,a=s._mode,n="HGT"==a?parseInt(t.style.height,10):t.style.height,i="WID"==a?parseInt(t.style.width,10):t.style.width,o=100,c=parseInt(s._cDIM[0],10),d=parseInt(s._cDIM[1],10);e<0?"HGT"==a&&n<r?n=((n+=o)>r?r:n)+"px":"WID"==a&&i<l&&(i=((i+=o)>l?l:i)+"px"):e>0?"HGT"==a?n=((n-=o)<c?c:n)+"px":"WID"==a&&(i=((i-=o)<d?d:i)+"px"):0==e&&(n=s._cDIM[0],i=s._cDIM[1]),n==s._cDIM[0]&&i==s._cDIM[1]&&s.resize&&(this.getPviewSize(),s.resize=!1,n=s._cDIM[0],i=s._cDIM[1]);var m=this._layer._zoom,u=0;if("HGT"==a&&n==r||"WID"==a&&i==l?(u=1,m[0].className="PI_minus",m[1].className="PI_plus zp_opac",s._zstate=1):"HGT"==a&&n==s._cDIM[0]||"WID"==a&&i==s._cDIM[1]?(m[0].className="PI_minus zp_opac",m[1].className="PI_plus",s._zstate=0):(u=1,m[0].className="PI_minus",m[1].className="PI_plus",s._zstate=1),1!=u||this._events.drag)this._events.drag=!1,document.body.removeEventListener("mousedown",this.dragHandlerInvoker,!1);else{var p=this;document.body.addEventListener("mousedown",this.dragHandlerInvoker=function(e){p.dragHandle(e)},!1),this._events.drag=!0}t.style.height=n,t.style.width=i,t.style.maxWidth="none";if(document.querySelector("#zoomRange")&&0!=e){const t=this._layer._body.querySelector("#zoomRange");let s=parseInt(t.value),r=this.getNoOfZoomsPossibleForAImage(this._cNode);e<0?t.value=s+Math.round(100/r):e>0&&(t.value=s-Math.round(100/r))}},getNoOfZoomsPossibleForAImage:function(e){if(e||this._cNode){let e=0,t=this._cNode._mode;if("NOR"!=t)if("HGT"==t){let t=parseInt(this._cNode._oDIM.height),s=parseInt(this._cNode._cDIM[0]);e=Math.round((t-s)/100)}else{let t=parseInt(this._cNode._oDIM.width),s=parseInt(this._cNode._cDIM[1]);e=Math.round((t-s)/100)}return e}},resizeHandle:function(){var e=this._cNode,t=e._zstate;this._sDIM={width:this._layer._body.offsetWidth,height:this._layer._body.offsetHeight},e.resize=!0,0==t&&this.zoomHandler(0)},removeLoading:function(){zplms.removeLoadingBar(this._layer._body)},closePreview:function(){this._layer._root.removeEventListener("click",this.clickHandlerInvoker,!1),document.removeEventListener("keyup",this.keyHandlerInvoker,!1),document.removeEventListener("mousemove",this.mousemoveHandlerInvoker,!1),window.removeEventListener("resize",this.resizeHandlerInvoker,!1),this._events.wheel&&(this._layer._body.removeEventListener("mousewheel",this.wheelHandlerInvoker,!1),this._layer._body.removeEventListener("DOMMouseScroll",this.domMouseScrollHandlerInvoker,!1)),this._events.drag&&document.body.removeEventListener("mousedown",this.dragHandlerInvoker,!1);var e=this._layer._root;e.parentNode.removeChild(e);for(var t=this._itemList,s=t.length-1;s>=0;s--)0==t[s].src.indexOf("blob")&&(URL.revokeObjectURL(t[s].src),t[s].src=""),t[s].poster_src&&0==t[s].poster_src.indexOf("blob")&&(URL.revokeObjectURL(t[s].poster_src),t[s].poster_src="");this._sDIM={width:null,height:null},this._permit={print:!1,download:!1,info:!1,fullmode:!1},this._itemlen=0,this._itemList=[],this._clk=[],this._timoutKey=null,this._chov=!1,this._events={wheel:!1,drag:!1},this._layer={_root:null,_hd:null,_info:null,_body:null,_foot:null,_lftnav:null,_rgtnav:null,_zoom:[]},this._dragdata={initX:null,initY:null,scX:null,scY:null},this.initCNode(),this._startIndex=0,this._srcNotGiven=null,this._refer={infoIndex:void 0},this._queryKey="previewId"},hasClass:function(e,t){var s=new RegExp("(\\s|^)"+t+"(\\s|$)");return!!(void 0===e.className?window.event.srcElement:e).className.match(s)},generateUniqueKey},zplightbox_introFiles=Object.create(zplightbox);zplightbox_introFiles.proto=zplightbox,zplightbox_introFiles.initiate=function(e){if(e.allow)for(var t=0;t<e.allow.length;t++)"info"==e.allow[t]&&e.allow.splice(t,1);else e.allow=["print","download","fullmode"];return this.proto.initiate.call(this,e)},zplightbox_introFiles.bind=function(){this.proto.bind.call(this),this.addLeftpane(),this.updateInfo();var e=this;lmsbase.addListener(this._layer._info,"click",(function(t){e.clickHandler(t)}),!1)},zplightbox_introFiles.addLeftpane=function(){var e=document.createElement("div"),t=e.appendChild(document.createElement("div"));t.className="zp_FLbx zp_flvw",t.setAttribute("introFiles","");for(var s=0,r=this._itemList;s<r.length;s++){t.appendChild(this.getItemCard(r[s])).item_index=s}this.constructInfo(ZPI18N.getString("zp.lms.introfiles"),e,{buttons:!1})},zplightbox_introFiles.getItemCard=function(e){var t=document.createElement("div");return t.className="zp_Lst",t.setAttribute("introFile",""),t.innerHTML='<div><div class="zp_Llft">'+lmsattachment.getDisplayIcon(e.type,1==e.callbackObj.sourceType?"ContentFile":"").outerHTML+'</div><div class="zp_Ldtl"><div class="zp_Tdts"><h3>'+e.name+"</h3></div></div>",t},zplightbox_introFiles.updateInfo=function(){var e=this._layer._info.querySelector("[introFiles]");if(e){var t=e.querySelector(".sel");t&&lmsbase.removeClass(t,"sel"),lmsbase.addClass(e.childNodes[this._cNode._inx],"sel")}},zplightbox_introFiles.clickHandler=function(e){var t=e.target.closest("[introfile]");t&&t.item_index!=this._cNode._inx&&this.loadpreview(t.item_index)},lmsnodata={noData:{messages:{general:'<div><div class="nodiscussions"></div><label><h3>'+ZPI18N.getString("zp.lms.nodiscussion")+"</h3><p>"+ZPI18N.getString("zp.lms.discussiondescr")+"</p></label></div>",filter:'<div><div class="nodiscussions"></div><label><h3>'+ZPI18N.getString("zp.lms.nomessagefilter")+"</h3></label></div>"},Feedback:{courseAndSessions:'<div><div class="nofeedback"></div><label><h3>'+ZPI18N.getString("zp.lms.nofeedback")+"</h3><p>"+ZPI18N.getString("zp.lms.feedbackdesc")+"</p></label></div>",courses:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.coursereview")+"</h3></label></div>",trainers:'<div><div class="notrainer"></div><label><h3>'+ZPI18N.getString("zp.lms.trainerreview")+"</h3></label></div>",general:'<div><div class="nofeedback"></div><label><h3>'+ZPI18N.getString("zp.lms.nofeedback")+"</h3><p>"+ZPI18N.getString("zp.lms.feedbackdesc")+"</p></label></div>",filter:'<div><div class="nofeedback"></div><label><h3>'+ZPI18N.getString("zp.lms.nofeedbackfilter")+"</h3></label></div>",completeMandatory:'<div><div class="nofeedback"></div><label><h3>'+ZPI18N.getString("zp.lms.feedback.complete.mandatory")+"</h3></label></div>"},notes:{general:'<div><div class="nonotes"></div><label><h3>'+ZPI18N.getString("zp.lms.nonotes")+"</h3><p>"+ZPI18N.getString("zp.lms.nonotesdesc")+"</p></label></div>",ondelete:'<div><div class="nonotes"></div><label><h3>'+ZPI18N.getString("zp.lms.nonotes")+"</h3><p>"+ZPI18N.getString("zp.lms.nonotesdesc")+"</p></label></div>",filter:'<div><div class="nonotes"></div><label><h3>'+ZPI18N.getString("zp.lms.nonotesfilter")+"</h3></label></div>",FilesIntegration:'<div><div class="nonotes"></div><label><h3>'+ZPI18N.getString("zp.lms.nonotes")+"</h3><p>"+ZPI18N.getString("zp.lms.nonotesdesc")+'</p><button {1} class="btn btn-primary">{2}</button></label></div>'},"Course Catalog":{general:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.NodatacourseCatalog")+"</h3><p>"+ZPI18N.getString("zp.lms.courseCatalogdesc")+"</p></label></div>",onFilter:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.coursefilter")+"</h3></label></div>"},MyCourses:{general:'<div><div class="nomyc"></div><label><p>'+ZPI18N.getString("zp.lms.Mycourse")+"</p></label></div>",onFilter:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.coursefilter")+"</h3></label></div>"},courses:{general:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.coursereview")+"</h3></label></div>"},trainers:{general:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.nocoursesavailable")+"</h3></label></div>",ondelete:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.nocoursesavailable")+"</h3></label></div>"},Trainers:{general:'<div><div class="notrainer"></div><label><h3>'+ZPI18N.getString("zp.lms.timetoaddtrainer")+"</h3><p>"+ZPI18N.getString("zp.lms.notrainerdesc")+"</p></label></div>",ondelete:'<div><div class="notrainer"></div><label><h3>'+ZPI18N.getString("zp.lms.timetoaddtrainer")+"</h3><p>"+ZPI18N.getString("zp.lms.notrainerdesc")+"</p></label></div>"},Rooms:{general:'<div><div class="noroom"></div><label><h3>'+ZPI18N.getString("zp.lms.norooms")+"</h3><p>"+ZPI18N.getString("zp.lms.noroomsdesc")+"</p></label></div>",ondelete:'<div><div class="noroom"></div><label><h3>'+ZPI18N.getString("zp.lms.norooms")+"</h3><p>"+ZPI18N.getString("zp.lms.noroomsdesc")+"</p></label></div>"},Approval:{general:'<div><div class="noapproval"></div><label><h3>'+ZPI18N.getString("zp.lms.approvals")+"</h3><p>"+ZPI18N.getString("zp.lms.approvalsDesc")+"</p></label></div>"},Reports:{ondelete:'<div><div class="noreport"></div><label><h3>'+ZPI18N.getString("zp.lms.noreports")+"</h3></label></div>",general:'<div><div class="noreport"></div><label><h3>'+ZPI18N.getString("zp.reports.noreports")+"</h3></label></div>",onDisable:'<div><div class="noreport"></div><label><h3>'+ZPI18N.getString("zp.lms.reports.onBothViewsDisable")+"</h3></label></div>"},modules:{general:'<div><div class="nomodule"></div><label><h3>'+ZPI18N.getString("zp.lms.nomodule")+"</h3></label></div>",clone:'<div><div class="nomodule"></div><lable><h3>{0}</h3></lable></div>'},sessions:{general:'<div><div class="nosession"></div><label><h3>'+ZPI18N.getString("zp.lms.nosessiontodis")+"</h3></label></div>"},files:{general:'<div><div class="nofiles"></div><label><h3>'+ZPI18N.getString("zp.lms.nofiles")+"</h3></label></div>",filter:'<div><div class="nofiles"></div><label><h3>'+ZPI18N.getString("zp.lms.nofiles")+"</h3></label></div>"},resources:{general:'<div><div class="nofiles"></div><label><h3>'+ZPI18N.getString("zp.lms.noresources")+"</h3></label></div>",filter:'<div><div class="nofiles"></div><h3>'+ZPI18N.getString("zp.lms.noresources")+"</h3></div>"},batches:{general:'<div><div class="nobatch"></div><label><h3>'+ZPI18N.getString("zp.lms.batces.CreateBatch")+"</h3><p>"+ZPI18N.getString("zp.lms.batches.noData")+'<a onclick="batchHtml.createandrepeatbatch()">'+ZPI18N.getString("zp.lms.batces.CreateBatch")+"</a><p></label></div>"},noGradeMembers:{general:'<div><div class="nograde"></div><label><h3>'+ZPI18N.getString("zp.lms.gradeSetting.noGradeNoData")+"</h3><p>"+ZPI18N.getString("zp.lms.gradeSetting.noGradeNoSystem")+"</p></label></div>"},gradeBook:{general:'<div><div class="nograde"></div><label><h3>'+ZPI18N.getString("zp.lms.gradeSetting.noGradeNoData")+"</h3><p>"+ZPI18N.getString("zp.lms.gradeSetting.noGradeNoDatatxt")+"</p></label></div>"},assignmentList:{general:'<div><div class="nomember"></div><label><h3>'+ZPI18N.getString("zp.lms.nomembers")+"</h3><p>There are no members for displaying</p></label></div>"},courseCertificate:{general:'<div _rel="nodataCertificate"><div class="nocertificate"></div><label><h3>'+ZPI18N.getString("zp.lms.certificate.Certificates")+"</h3><p>"+ZPI18N.getString("zp.lms.certificate.nodatacertificate")+'<a onclick="lmscoursecertificate.createTemplate()">'+ZPI18N.getString("zp.lms.certificate.createCertificate")+"</a></p></label></div>"},members:{general:'<div><div class="nomember"></div><label>{0}</label></div>'},plan:{general:'<div><div class="nomember"></div><label><h3>'+ZPI18N.getString("zp.lms.nomembers")+"</h3></label></div>"},noprepostactivity:{general:'<div><div class="noprepost"></div><font><h3>'+ZPI18N.getString("zp.lms.noprepostactivities")+"</h3><p>"+ZPI18N.getString("zp.lms.noprepostdesc")+'</p><div class="zp_btn"><button class="zpthm" onclick="lmsprepostactivities.createActivity()">'+ZPI18N.getString("zp.lms.courseSetting")+"</button></div></font></div>"},common:'<i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5>{0}</h5>'},noDatav5:{messages:{general:'<div><div class="nodiscussions"></div><label><h3>'+ZPI18N.getString("zp.lms.nodiscussion")+"</h3><p>"+ZPI18N.getString("zp.lms.discussiondescr")+"</p></label></div>",filter:'<div><div class="nodiscussions"></div><label><h3>'+ZPI18N.getString("zp.lms.nomessagefilter")+"</h3></label></div>"},Feedback:{courseAndSessions:'<div><div class="nofeedback"></div><label><h3>'+ZPI18N.getString("zp.lms.nofeedback")+"</h3><p>"+ZPI18N.getString("zp.lms.feedbackdesc")+"</p></label></div>",courses:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.coursereview")+"</h3></label></div>",trainers:'<div><div class="notrainer"></div><label><h3>'+ZPI18N.getString("zp.lms.trainerreview")+"</h3></label></div>",general:'<div><div class="nofeedback"></div><label><h3>'+ZPI18N.getString("zp.lms.nofeedback")+"</h3><p>"+ZPI18N.getString("zp.lms.feedbackdesc")+"</p></label></div>",filter:'<div><div class="nofeedback"></div><label><h3>'+ZPI18N.getString("zp.lms.nofeedbackfilter")+"</h3></label></div>",completeMandatory:'<div><div class="nofeedback"></div><label><h3>'+ZPI18N.getString("zp.lms.feedback.complete.mandatory")+"</h3></label></div>"},notesNew:{general:{title:ZPI18N.getString("zp.lms.notes.nodata"),desc:ZPI18N.getString("zp.lms.notes.nodatadesc")},filter:{title:ZPI18N.getString("zp.lms.notes.nodatafilter"),desc:""}},contentmgmtNew:{filesNew:{general:{title:ZPI18N.getString("zp.lms.cm.nofilesdata"),desc:ZPI18N.getString("zp.lms.cm.nofilesdatadesc")},filter:{title:ZPI18N.getString("zp.lms.cm.nofilesdatafilter"),desc:""}},resourcesNew:{general:{title:ZPI18N.getString("zp.lms.cm.noresourcesdata"),desc:ZPI18N.getString("zp.lms.cm.noresourcesdatadesc")},filter:{title:ZPI18N.getString("zp.lms.cm.noresourcesdatafilter"),desc:""}}},trainersNew:{general:{title:ZPI18N.getString("zp.lms.timetoaddtrainer"),desc:ZPI18N.getString("zp.lms.trainers.nodatadesc")},filter:{title:ZPI18N.getString("zp.lms.trainers.nodatafilter"),desc:""}},roomsNew:{general:{title:ZPI18N.getString("zp.lms.rooms.nodata"),desc:ZPI18N.getString("zp.lms.rooms.nodatadesc")}},competencyNew:{general:{title:ZPI18N.getString("zp.lms.competency.nodata"),desc:ZPI18N.getString("zp.lms.competency.nodatadesc")}},teammatesNew:{filter:{title:ZPI18N.getString("zp.lms.noSubordinates"),desc:ZPI18N.getString("zp.lms.team.teammates.nodatafilter")}},notes:{general:'<div><div class="nonotes"></div><label><h3>'+ZPI18N.getString("zp.lms.nonotes")+"</h3><p>"+ZPI18N.getString("zp.lms.nonotesdesc")+"</p></label></div>",ondelete:'<div><div class="nonotes"></div><label><h3>'+ZPI18N.getString("zp.lms.nonotes")+"</h3><p>"+ZPI18N.getString("zp.lms.nonotesdesc")+"</p></label></div>",filter:'<div><div class="nonotes"></div><label><h3>'+ZPI18N.getString("zp.lms.nonotesfilter")+"</h3></label></div>",FilesIntegration:'<div><div class="nonotes"></div><label><h3>'+ZPI18N.getString("zp.lms.nonotes")+"</h3><p>"+ZPI18N.getString("zp.lms.nonotesdesc")+'</p><button {1} class="btn btn-primary">{2}</button></label></div>'},"Course Catalog":{general:{title:ZPI18N.getString("zp.lms.noDataCourseCatalogTitle"),desc:ZPI18N.getString("zp.lms.courseCatalogdesc")},onFilter:{title:ZPI18N.getString("zp.lms.noDataFilter",["filter criteria"]),desc:""},onSearch:{title:ZPI18N.getString("zp.lms.noDataFilter",["your search term"]),desc:""}},MyCourses:{hasAddPerm:{title:ZPI18N.getString("zp.lms.noDataMyCoursesTitle"),desc:ZPI18N.getString("zp.lms.noDataMyCoursesDesc",[ZPI18N.getString("zp.lms.noDataCourseCreation")])},noAddPerm:{title:ZPI18N.getString("zp.lms.noDataMyCoursesTitle"),desc:ZPI18N.getString("zp.lms.noDataMyCoursesDesc",[""])},onFilter:{title:ZPI18N.getString("zp.lms.noDataFilter",["filter"]),desc:""},onSearch:{title:ZPI18N.getString("zp.lms.noDataFilter",["search"]),desc:""}},courses:{general:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.coursereview")+"</h3></label></div>"},trainers:{general:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.nocoursesavailable")+"</h3></label></div>",ondelete:'<div><div class="nomyc"></div><label><h3>'+ZPI18N.getString("zp.lms.nocoursesavailable")+"</h3></label></div>"},Trainers:{general:'<div><div class="notrainer"></div><label><h3>'+ZPI18N.getString("zp.lms.timetoaddtrainer")+"</h3><p>"+ZPI18N.getString("zp.lms.notrainerdesc")+"</p></label></div>",ondelete:'<div><div class="notrainer"></div><label><h3>'+ZPI18N.getString("zp.lms.timetoaddtrainer")+"</h3><p>"+ZPI18N.getString("zp.lms.notrainerdesc")+"</p></label></div>"},Rooms:{general:'<div><div class="noroom"></div><label><h3>'+ZPI18N.getString("zp.lms.norooms")+"</h3><p>"+ZPI18N.getString("zp.lms.noroomsdesc")+"</p></label></div>",ondelete:'<div><div class="noroom"></div><label><h3>'+ZPI18N.getString("zp.lms.norooms")+"</h3><p>"+ZPI18N.getString("zp.lms.noroomsdesc")+"</p></label></div>"},Approval:{general:'<div><div class="noapproval"></div><label><h3>'+ZPI18N.getString("zp.lms.approvals")+"</h3><p>"+ZPI18N.getString("zp.lms.approvalsDesc")+"</p></label></div>"},Reports:{ondelete:'<div><div class="noreport"></div><label><h3>'+ZPI18N.getString("zp.lms.noreports")+"</h3></label></div>",general:'<div><div class="noreport"></div><label><h3>'+ZPI18N.getString("zp.reports.noreports")+"</h3></label></div>",onDisable:'<div><div class="noreport"></div><label><h3>'+ZPI18N.getString("zp.lms.reports.onBothViewsDisable")+"</h3></label></div>"},modules:{general:'<div><div class="nomodule"></div><label><h3>'+ZPI18N.getString("zp.lms.nomodule")+"</h3></label></div>",clone:'<div><div class="nomodule"></div><lable><h3>{0}</h3></lable></div>'},sessions:{general:'<div><div class="nosession"></div><label><h3>'+ZPI18N.getString("zp.lms.nosessiontodis")+"</h3></label></div>"},files:{general:'<div><div class="nofiles"></div><label><h3>'+ZPI18N.getString("zp.lms.nofiles")+"</h3></label></div>",filter:'<div><div class="nofiles"></div><label><h3>'+ZPI18N.getString("zp.lms.nofiles")+"</h3></label></div>"},resources:{general:'<div><div class="nofiles"></div><label><h3>'+ZPI18N.getString("zp.lms.noresources")+"</h3></label></div>",filter:'<div><div class="nofiles"></div><h3>'+ZPI18N.getString("zp.lms.noresources")+"</h3></div>"},batches:{general:'<div><div class="nobatch"></div><label><h3>'+ZPI18N.getString("zp.lms.batces.CreateBatch")+"</h3><p>"+ZPI18N.getString("zp.lms.batches.noData")+'<a onclick="batchHtml.createandrepeatbatch()">'+ZPI18N.getString("zp.lms.batces.CreateBatch")+"</a><p></label></div>"},noGradeMembers:{general:'<div><div class="nograde"></div><label><h3>'+ZPI18N.getString("zp.lms.gradeSetting.noGradeNoData")+"</h3><p>"+ZPI18N.getString("zp.lms.gradeSetting.noGradeNoSystem")+"</p></label></div>"},gradeBook:{general:'<div><div class="nograde"></div><label><h3>'+ZPI18N.getString("zp.lms.gradeSetting.noGradeNoData")+"</h3><p>"+ZPI18N.getString("zp.lms.gradeSetting.noGradeNoDatatxt")+"</p></label></div>"},assignmentList:{general:'<div><div class="nomember"></div><label><h3>'+ZPI18N.getString("zp.lms.nomembers")+"</h3><p>There are no members for displaying</p></label></div>"},courseCertificate:{general:'<div _rel="nodataCertificate"><div class="nocertificate"></div><label><h3>'+ZPI18N.getString("zp.lms.certificate.Certificates")+"</h3><p>"+ZPI18N.getString("zp.lms.certificate.nodatacertificate")+'<a onclick="lmscoursecertificate.createTemplate()">'+ZPI18N.getString("zp.lms.certificate.createCertificate")+"</a></p></label></div>"},members:{general:'<div><div class="nomember"></div><label>{0}</label></div>'},noprepostactivity:{general:'<div><div class="noprepost"></div><font><h3>'+ZPI18N.getString("zp.lms.noprepostactivities")+"</h3><p>"+ZPI18N.getString("zp.lms.noprepostdesc")+'</p><div class="zp_btn"><button class="zpthm" onclick="lmsprepostactivities.createActivity()">'+ZPI18N.getString("zp.lms.courseSetting")+"</button></div></font></div>"},common:'<i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5>{0}</h5>',myPlans:{hasAddPerm:{title:ZPI18N.getString("zp.lms.learningplan.noDataMyPlanTitle"),desc:ZPI18N.getString("zp.lms.learningplan.noDataMyPlanDesc",[ZPI18N.getString("zp.lms.learningplan.noDataCreation")])},noAddPerm:{title:ZPI18N.getString("zp.lms.learningplan.noDataMyPlanTitle"),desc:ZPI18N.getString("zp.lms.learningplan.noDataMyPlanDesc",[""])},filter:{title:ZPI18N.getString("zp.lms.noDataFilter",["filter"]),desc:""},search:{title:ZPI18N.getString("zp.lms.noDataFilter",["search"]),desc:""}},applicablePlans:{general:{title:ZPI18N.getString("zp.lms.learningplan.noDataCourseCatalogTitle"),desc:ZPI18N.getString("zp.lms.courseCatalogdesc")},filter:{title:ZPI18N.getString("zp.lms.noDataFilter",["filter"]),desc:""},search:{title:ZPI18N.getString("zp.lms.noDataFilter",["search"]),desc:""}}},showNoData:function(e){var t,s=lmsnodata.noData[e.module];s&&(t=s[e.mode]),t||(t=lmsnodata.noData.common);var r=e.content||[];r instanceof Array||(r=[r]),t=t.replace(/{\d+?}/g,(function(e){return lmsnodata.replace(e,r)})),e.container.innerHTML='<div class="ZPNdata" _rel="nodata" style="display:flex;">'+t+"</div>"},replace:function(e,t){return t[e.slice(1,e.length-1)]},clearNoData:function(e){e.innerHTML=""},showNoDataV5:function(e,t,s,r){new EmptyPages(e,t,s,r).show()}};var lmsdragging={cDrop:null,tempDrag:"",shiftX:null,shiftY:null,draggedElem:null,moveElem:null,contentELem:null,parentModuleId:null,currentLevelId:0,parentLevelId:0,isLevelTag:!1,previousSibling:null,moduleFirst:0,resourceElem:null,draggedRow:null,flag:0,startDragging:function(e){var t="",s=e.target;lmsdragging.close(),"IC-drag"==s.getAttribute("class")&&(s.closest(".zp_Lst")&&s.closest(".zp_Lst").id.match("module")?(lmsdragging.moveElem="module",lmsdragging.draggedRow=s.closest(".zp_Lst"),t=lmsdragging.draggedRow.querySelector("h3 font").textContent,lmsdragging.contentElem=lmsdragging.draggedRow.nextSibling):"coursedrag"==s.getAttribute("_rel")?(lmsdragging.moveElem="coursedrag",lmsdragging.draggedRow=s.closest('[rel="clist"]'),lmsdragging.draggedRow.closest('[rel="llist"]')&&(lmsdragging.parentLevelId=lmsdragging.draggedRow.closest('[rel="llist"]').getAttribute("id").split("_")[1],lmsdragging.isLevelTag=!0),t=lmsdragging.draggedRow.querySelector('[_rel="cname"]').innerHTML.split("</span>")[1]?lmsdragging.draggedRow.querySelector('[_rel="cname"]').innerHTML.split("</span>")[1]:lmsdragging.draggedRow.querySelector('[_rel="cname"]').innerHTML.split("</span>")[0],lmsdragging.contentElem=lmsdragging.draggedRow.nextSibling):"leveldrag"==s.getAttribute("_rel")?(lmsdragging.moveElem="leveldrag",lmsdragging.draggedRow=s.closest('[_irel="leveldrag"]'),document.querySelector('[rel="addedCoursesDiv"]').classList.add("lvlhd"),t=lmsdragging.draggedRow.querySelector('[id="levelNameEdit"]').innerHTML,lmsdragging.contentElem=lmsdragging.draggedRow.nextSibling):"rubricdrag"==s.getAttribute("_rel")?(lmsdragging.moveElem="rubricdrag",lmsdragging.draggedRow=s.closest("[rubricId]"),t=lmsdragging.draggedRow.querySelector('[name="criteriaGroup"]').value):"criteriadrag"==s.getAttribute("_rel")?(lmsdragging.moveElem="criteriadrag",lmsdragging.draggedRow=s.closest("tr"),t=lmsdragging.draggedRow.querySelector('[name="criteriaName"]').value):(lmsdragging.moveElem="content",lmsdragging.draggedRow=s.closest(".zp_Lst"),lmsdragging.parentModuleId=lmsdragging.draggedRow.parentElement.getAttribute("id").split("_")[1],t=s.parentElement.parentElement.querySelector('[class="zp_Tdts"]').firstChild.textContent),lmsdragging.draggedElem=s,lmsdragging.previousSibling=lmsdragging.draggedRow.previousSibling,document.addEventListener("mousemove",lmsdragging.mouseMove,!1),document.addEventListener("mouseup",lmsdragging.mouseUp,!1),lmsdragging.tempDrag=s.parentElement.querySelector('[rel="zp_hid"]'),document.ondragstart=function(){return!1},lmsdragging.tempDrag.style.display="block",lmsdragging.tempDrag.className="zp_drgcnt",lmsdragging.tempDrag.innerHTML=ZPeople.escapeHtml(t),lmsdragging.draggedRow.style.opacity=.1,lmsdragging.shiftX=e.clientX-lmsdragging.tempDrag.getBoundingClientRect().left,lmsdragging.shiftY=e.clientY-lmsdragging.tempDrag.getBoundingClientRect().top,lmsdragging.tempDrag.style.position="absolute",lmsdragging.tempDrag.style.zIndex=1e3,document.body.append(lmsdragging.tempDrag),lmsdragging.moveAt(e.pageX,e.pageY))},mouseUp:function(e){document.removeEventListener("mousemove",lmsdragging.mouseMove,!1),document.removeEventListener("mouseup",lmsdragging.mouseUp,!1),lmsdragging.tempDrag.style.display="none";var t=document.createElement("div");if(t.style.display="none",t.setAttribute("rel","zp_hid"),lmsdragging.draggedElem.parentElement.appendChild(t),lmsdragging.tempDrag.className="",lmsdragging.draggedRow.style.opacity=1,("coursedrag"==lmsdragging.moveElem||"leveldrag"==lmsdragging.moveElem)&&lmslearningplan.elem&&lmslearningplan.elem.querySelector('[class="zp_drgbrdr"]')?lmslearningplan.elem.querySelector('[class="zp_drgbrdr"]').remove():"rubricdrag"==lmsdragging.moveElem?lmsrubrics.root.querySelector('[class="zp_drgbrdr"]').remove():"criteriadrag"==lmsdragging.moveElem?lmsrubrics.root.querySelector('[class="zp_drgbrdr tbbdr"]').remove():lmsmodule.elem&&lmsmodule.elem.querySelector('[class="zp_drgbrdr"]')&&lmsmodule.elem.querySelector('[class="zp_drgbrdr"]').remove(),"content"==lmsdragging.moveElem){var s="",r="",l="",a="",n=(r=lmsdragging.draggedRow.getAttribute("id").split("_")[1],lmsdragging.draggedRow.getAttribute("id").split("_")[0]),i=0,o=lmsdragging.draggedRow.nextSibling;1==lmsdragging.flag&&(s=0,lmsdragging.cDrop&&lmsdragging.cDrop.nextSibling.firstChild&&lmsdragging.cDrop.nextSibling?(l=lmsdragging.cDrop.nextSibling.getAttribute("id").split("_")[1],lmsdragging.cDrop.nextSibling.insertBefore(lmsdragging.draggedRow,lmsdragging.cDrop.nextSibling.firstChild),i=1):lmsdragging.cDrop&&(l=lmsdragging.cDrop.nextSibling.getAttribute("id").split("_")[1],lmsdragging.cDrop.nextSibling.append(lmsdragging.draggedRow),i=1)),lmsdragging.cDrop&&0==lmsdragging.flag&&(s=lmsdragging.cDrop.getAttribute("id").split("_")[1],l=lmsdragging.cDrop.parentElement.getAttribute("id").split("_")[1],lmsdragging.cDrop.nextSibling&&lmsdragging.cDrop.nextSibling.getAttribute("_mrel")&&(lmsdragging.cDrop=lmsdragging.cDrop.nextSibling),lmsdragging.cDrop.after(lmsdragging.draggedRow),i=1);var c=0;(b=lmsdragging.previousSibling)&&b.id.toLowerCase().match("module")&&(b=b.previousSibling),b&&!b.id.toLowerCase().match("module")&&(c=b.getAttribute("id").split("_")[1]),(c!=s||l!=lmsdragging.parentModuleId&&null!=lmsdragging.parentModuleId)&&1==i&&r!=s&&lmsdragging.updateEntitySorting(s,l,r,n),lmsbase.removeClass(lmsmodule.elem,"zp_CMrem"),o&&o.id.match("resources")&&lmsdragging.draggedRow.after(o)}else if("coursedrag"==lmsdragging.moveElem){var d=0;r=lmsdragging.draggedRow.querySelector("li")?lmsdragging.draggedRow.querySelector("li").getAttribute("id").split("_")[1]:lmsdragging.draggedRow.getAttribute("id").split("_")[1];i=0;var m=!1;lmsbase.removeClass(lmslearningplan.elem,"zp_drp"),lmsdragging.cDrop&&!lmsdragging.cDrop.closest('[rel="courseListDiv"]')&&lmsdragging.cDrop.closest('[rel="llist"]')&&(lmsdragging.cDrop.closest('[rel="llist"]')&&(lmsdragging.currentLevelId=lmsdragging.cDrop.closest('[rel="llist"]').getAttribute("id").split("_")[1]),lmsdragging.isLevelTag=!0,m=!0),lmsdragging.courseFirst?(m?lmsdragging.cDrop.closest('[rel="llist"]').querySelector('[rel="levelCourseList"]')?lmsdragging.cDrop.closest('[rel="llist"]').querySelector('[rel="levelCourseList"]').insertBefore(lmsdragging.draggedRow,lmsdragging.cDrop.closest('[rel="llist"]').querySelector('[rel="levelCourseList"]').firstChild):lmsdragging.cDrop.closest('[rel="llist"]').append(lmsdragging.draggedRow):(document.querySelector('[class="zp_drgbrdr"]')&&document.querySelectorAll('[class="zp_drgbrdr"]').forEach((e=>e.remove())),lmslearningplan.elem.querySelector('[rel="courseListDiv"]').insertBefore(lmsdragging.draggedRow,lmslearningplan.elem.querySelector('[rel="courseListDiv"]').firstChild)),i=1):lmsdragging.cDrop&&1==lmsdragging.flag?(lmsdragging.currentLevelId&&lmsdragging.cDrop.hasAttribute("rel")&&"llist"===lmsdragging.cDrop.getAttribute("rel")?lmsdragging.cDrop.append(lmsdragging.draggedRow):lmsdragging.cDrop.after(lmsdragging.draggedRow),d=lmsdragging.cDrop.querySelector("li")?lmsdragging.cDrop.querySelector("li").getAttribute("id").split("_")[1]:0,i=1):lmsdragging.cDrop&&0==lmsdragging.flag&&(d=lmsdragging.cDrop.querySelector("li").getAttribute("id").split("_")[1],lmsdragging.cDrop.hasAttribute("id")&&(r=lmsdragging.cDrop.getAttribute("id").split("_")[1]),lmsdragging.cDrop.nextSibling&&(lmsdragging.cDrop=lmsdragging.cDrop.nextSibling),lmsdragging.cDrop.after(lmsdragging.draggedRow),i=1),r===d&&(d=lmsdragging.draggedRow.closest('[rel="clist"]')&&lmsdragging.draggedRow.closest('[rel="clist"]').previousSibling&&lmsdragging.draggedRow.closest('[rel="clist"]').previousSibling.querySelector("li")?lmsdragging.draggedRow.closest('[rel="clist"]').previousSibling.querySelector("li").getAttribute("id").split("_")[1]:0);c=0;lmsdragging.previousSibling&&lmsdragging.previousSibling.querySelector("li")&&(c=lmsdragging.previousSibling.querySelector("li").getAttribute("id").split("_")[1]),(c!=d||lmsdragging.currentLevelId!=lmsdragging.parentLevelId&&null!=lmsdragging.parentLevelId)&&1==i&&r!=d&&lmsdragging.updateCourseSorting(d,r,lmsdragging.currentLevelId,lmsdragging.parentLevelId),lmsdragging.isLevelTag&&lmsdragging.parentLevelId&&lmslearningplan.dragAndDropNoImgHandle(lmsdragging.parentLevelId),lmsdragging.isLevelTag&&lmsdragging.currentLevelId&&lmslearningplan.dragAndDropNoImgHandle(lmsdragging.currentLevelId),lmsbase.removeClass(lmslearningplan.elem,"zp_CMrem")}else if("leveldrag"==lmsdragging.moveElem){var u="",p=0;i=0;lmsbase.removeClass(lmslearningplan.elem,"zp_drp"),lmsdragging.levelFirst?(p=0,u=lmsdragging.draggedRow.getAttribute("id").split("_")[1],lmslearningplan.elem.insertBefore(lmsdragging.draggedRow,lmslearningplan.elem.firstChild),i=1):lmsdragging.cDrop&&lmsdragging.cDrop.nextSibling&&(lmsdragging.cDrop.after(lmsdragging.draggedRow),u=lmsdragging.draggedRow.getAttribute("id").split("_")[1],p=lmsdragging.cDrop.getAttribute("id").split("_")[1],i=1);c=0;(b=lmsdragging.previousSibling)&&"leveldrag"==b.getAttribute("_rel")&&(c=b.getAttribute("id").split("_")[1]),c!=p&&null!=p&&1==i&&u!=p&&lmsdragging.updateLevelSorting(u,p),document.querySelector('[rel="addedCoursesDiv"]').classList.remove("lvlhd")}else if("rubricdrag"==lmsdragging.moveElem){var g="",f=0;lmsbase.removeClass(lmsrubrics.root,"zp_drp"),lmsdragging.cDrop&&(lmsdragging.cDrop.after(lmsdragging.draggedRow),g=lmsdragging.draggedRow.closest("[rubricid]").getAttribute("rubricid"),f=lmsdragging.draggedRow.nextSibling.closest("[rubricid]")?lmsdragging.draggedRow.nextSibling.closest("[rubricid]").getAttribute("rubricid"):null),0!=f&&g!=f&&lmsdragging.updateRubricSorting(g,f)}else if("criteriadrag"==lmsdragging.moveElem){var v="",h=0;lmsbase.removeClass(lmsrubrics.root,"zp_drp"),lmsdragging.cDrop&&(lmsdragging.cDrop.after(lmsdragging.draggedRow),v=lmsdragging.draggedRow.querySelector("[criteriaid]").getAttribute("criteriaid"),h=lmsdragging.draggedRow.nextSibling?lmsdragging.draggedRow.nextSibling.querySelector("[criteriaid]").getAttribute("criteriaid"):null),0!=h&&v!=h&&lmsdragging.updateCriteriaSorting(v,h)}else{l="",a="",i=0;lmsbase.removeClass(lmsmodule.elem,"zp_drp"),lmsdragging.moduleFirst?(a=0,l=lmsdragging.draggedRow.getAttribute("id").split("_")[1],lmsmodule.elem.insertBefore(lmsdragging.draggedRow,lmsmodule.elem.firstChild.nextSibling),lmsdragging.draggedRow.after(lmsdragging.contentElem),i=1):lmsdragging.cDrop&&lmsdragging.cDrop.nextSibling&&(lmsdragging.cDrop.nextSibling.after(lmsdragging.draggedRow),lmsdragging.draggedRow.after(lmsdragging.contentElem),l=lmsdragging.draggedRow.getAttribute("id").split("_")[1],a=lmsdragging.cDrop.getAttribute("id").split("_")[1],i=1);var b;c=0;(b=lmsdragging.previousSibling)&&b.id&&b.id.match("module")&&(c=b.getAttribute("id").split("_")[1]),(c!=a&&null!=a||0===a)&&1==i&&l!=a&&lmsdragging.updateModuleSorting(l,a)}},updateEntitySorting:function(e,t,s,r){currModule=document.querySelector("#currentModule_"+t),currModule.classList.add("disabled");var l={method:"updateContentList",parentEntityId:e,currentModuleId:t,currentEntityId:s,parentModuleId:lmsdragging.parentModuleId,type:r,conreqcsr:csrfToken};$.post("/moduleAction.zp",l,(function(e){currModule.classList.remove("disabled")}))},updateModuleSorting:function(e,t){lmscourses.currentBatchId;var s={method:"updateModuleSorting",currentModuleId:e,parentModuleId:t,batchId:lmscourses.currentBatchId,courseId:lmscourses.currentCourseId,conreqcsr:csrfToken};$.post("/moduleAction.zp",s,(function(e){}))},updateCourseSorting:function(e,t,s,r){if(""!==e&&""!==t&&e!==t){var l={parentCourseId:e,levelId:s,parentLevelId:r,courseId:t};zplms.put("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/courses/order",l,(function(e){}))}},updateLevelSorting:function(e,t){if(""!==t&&""!==e&&t!==e){var s={parentLevelId:t,levelId:e};zplms.put("/lms/learningplans/"+lmslearningplan.addedPlanDetails.planInfo.planId+"/levels/order",s,(function(e){}))}},updateRubricSorting:function(e,t){""!==e&&0!==t&&e!==t&&lmsrubrics.moveRubric(e,t)},updateCriteriaSorting:function(e,t){""!==e&&0!==t&&e!==t&&lmsrubrics.moveCriteria(e,t)},moveAt:function(e,t){"leveldrag"==lmsdragging.moveElem?(lmsdragging.tempDrag.style.left=e-lmsdragging.tempDrag.offsetWidth/2+"px",lmsdragging.tempDrag.style.top=t-lmsdragging.tempDrag.offsetHeight/2+"px"):(lmsdragging.tempDrag.style.left=e-lmsdragging.shiftX-5+"px",lmsdragging.tempDrag.style.top=t-lmsdragging.shiftY-10+"px")},hElement:function(e,t){var s=t.getBoundingClientRect().top,r=3/4*(t.getBoundingClientRect().bottom-s);return e<=s+r?e-r:e},mouseMove:function(e){lmsdragging.moveAt(e.pageX,e.pageY),lmsdragging.tempDrag.hidden=!0;var t=document.elementFromPoint(e.clientX,e.clientY),s="";if(t&&"zp_drgbrdr"!=t.getAttribute("class")&&"zp_drgbrdr tbbdr"!=t.getAttribute("class")){if(t&&t.getAttribute("id")&&"coursedrag"==lmsdragging.moveElem){var r=document.elementFromPoint(e.clientX,e.clientY+50);document.querySelector('[class="zp_drgbrdr"]')&&document.querySelectorAll('[class="zp_drgbrdr"]').forEach((e=>e.remove())),(l=document.createElement("div")).className="zp_drgbrdr",t.parentElement.hasAttribute("rel")&&"addedCoursesDiv"!=t.parentElement.getAttribute("rel")&&t.parentElement.append(l)}else lmsdragging.courseFirst=0;if(t&&"leveldrag"==lmsdragging.moveElem){r=document.elementFromPoint(e.clientX,e.clientY+25);document.querySelector('[class="zp_drgbrdr"]')&&document.querySelectorAll('[class="zp_drgbrdr"]').forEach((e=>e.remove())),(l=document.createElement("div")).className="zp_drgbrdr",r&&!r.closest('[_irel="leveldrag"]')?(lmsdragging.levelFirst=1,lmslearningplan.elem.querySelector('[rel="llist"]').append(l)):(r&&r.parentElement.append(l),lmsdragging.levelFirst=0)}else lmsdragging.levelFirst=0;if(t&&(t.getAttribute("data-id")||t.closest(".zp_modlhd"))&&"module"==lmsdragging.moveElem){let t=document.elementFromPoint(e.clientX,e.clientY+25);if(!lmsmodule.elem.querySelector('[class="zp_drgbrdr"]')){let e=document.createElement("div");e.className="zp_drgbrdr",lmsmodule.elem.insertBefore(e,lmsmodule.elem.firstChild.nextSibling)}t.closest('[id^="module_"]')?(lmsmodule.elem.querySelector('[class="zp_drgbrdr"]')&&lmsmodule.elem.querySelector('[class="zp_drgbrdr"]').remove(),lmsdragging.moduleFirst=1):lmsdragging.moduleFirst=0}else lmsdragging.moduleFirst=0;if(t&&"rubricdrag"==lmsdragging.moveElem)if((r=document.elementFromPoint(e.clientX,e.clientY+30))&&r.closest('[_irel="rubricdrag"]'))lmsrubrics.root.querySelector('[class="zp_drgbrdr"]')&&lmsrubrics.root.querySelector('[class="zp_drgbrdr"]').remove(),lmsdragging.rubricFirst=1,(l=document.createElement("div")).className="zp_drgbrdr",r.closest('[_irel="rubricdrag"]').parentElement.insertBefore(l,r.closest('[_irel="rubricdrag"]').nextSibling);else lmsdragging.rubricFirst=0;else lmsdragging.rubricFirst=0;if(t&&"criteriadrag"==lmsdragging.moveElem){if((r=document.elementFromPoint(e.clientX,e.clientY+30)).closest("[rubricid]").getAttribute("rubricid")!=lmsdragging.draggedRow.closest("[rubricid]").getAttribute("rubricid"))return;if(r&&r.closest('[_irel="criteriadrag"]'))lmsrubrics.root.querySelector('[class="zp_drgbrdr tbbdr"]')&&lmsrubrics.root.querySelector('[class="zp_drgbrdr tbbdr"]').remove(),"heading"==r.closest('[_irel="criteriadrag"]').previousSibling.querySelector("_rel")&&(lmsdragging.criteriaFirst=1),(l=document.createElement("div")).className="zp_drgbrdr tbbdr",r.closest('[_irel="criteriadrag"]').parentElement.insertBefore(l,r.closest('[_irel="criteriadrag"]').nextSibling);else lmsdragging.criteriaFirst=0}else lmsdragging.criteriaFirst=0;if(!(t.getAttribute("data-id")&&""!=t.getAttribute("data-id")||t.getAttribute("id")&&""!=t.getAttribute("id")||"leveldrag"==lmsdragging.moveElem&&lmsdragging.levelFirst||("module"==lmsdragging.moveElem?t.closest('[id="module^"]')&&t.closest('[data-id="courseView"]')&&t.closest('[data-id="courseView"]').getAttribute("data-id")||(lmsdragging.cDrop=null,lmsmodule.elem.querySelector('[class="zp_drgbrdr"]')&&lmsmodule.elem.querySelector('[class="zp_drgbrdr"]').remove()):"coursedrag"==lmsdragging.moveElem?document.querySelector('[rel="addedCoursesDiv"]').querySelector('[class="zp_drgbrdr"]')&&document.querySelector('[rel="addedCoursesDiv"]').querySelectorAll('[class="zp_drgbrdr"]').forEach((e=>e.remove())):"rubricdrag"==lmsdragging.moveElem?r.closest('[_irel="rubricdrag"]')&&r.closest('[_irel="rubricdrag"]').getAttribute("_irel")||(lmsdragging.cDrop=null,lmsrubrics.root.querySelector('[class="zp_drgbrdr"]')&&lmsrubrics.root.querySelector('[class="zp_drgbrdr"]').remove()):"criteriadrag"==lmsdragging.moveElem&&(t.closest('[_irel="criteriadrag"]')&&t.closest('[_irel="criteriadrag"]').getAttribute("_irel")||(lmsdragging.cDrop=null,lmsrubrics.root.querySelector('[class="zp_drgbrdr tbbdr"]')&&lmsrubrics.root.querySelector('[class="zp_drgbrdr tbbdr"]').remove())),t.id&&t.id.match("module")||"leveldrag"==t.getAttribute("_rel")||"coursedrag"==t.getAttribute("_rel")||"rubricdrag"==t.getAttribute("_rel")||"criteriadrag"==t.getAttribute("_rel")||"zp_drgbrdr"==t.getAttribute("class")||"zp_drgbrdr tbbdr"==t.getAttribute("class")))){if(s=lmsdragging.hElement(e.clientY,t),t=document.elementFromPoint(e.clientX,s),lmsdragging.tempDrag.hidden=!1,!t)return;var l,a="";if("module"==lmsdragging.moveElem?(a=t.closest('[id^="module_"]'),lmsbase.addClass(lmsmodule.elem,"zp_drp")):"leveldrag"==lmsdragging.moveElem?(a=t.closest('[_irel="leveldrag"]'),lmsbase.addClass(lmslearningplan.elem,"zp_drp")):"rubricdrag"==lmsdragging.moveElem?(a=r.closest('[_irel="rubricdrag"]'),lmsbase.addClass(lmsrubrics.root,"zp_drp")):"criteriadrag"==lmsdragging.moveElem?(a=t.closest('[_irel="criteriadrag"]'),lmsbase.addClass(lmsrubrics.root,"zp_drp")):"coursedrag"==lmsdragging.moveElem?(a=t.closest('[rel="clist"]'),lmsbase.addClass(lmslearningplan.elem,"zp_drp"),a||(t.closest('[rel="llist"]')?(a=t.closest('[rel="llist"]')).querySelector('[rel="clist"]')&&(a=a.querySelector('[rel="clist"]')):(a=lmslearningplan.elem.querySelector('[rel="courseListDiv"]')).firstChild&&(a=a.firstChild),lmsdragging.courseFirst=a?1:0),lmsdragging.flag=a?1:0):"content"==lmsdragging.moveElem&&(a=t.closest(".zp_Lst"),lmsbase.addClass(lmsmodule.elem,"zp_CMrem"),a&&(lmsdragging.flag=a.id.match("module")?1:0)),!a)return;if(lmsdragging.cDrop!=a)if(!lmsdragging.cDrop&&a&&(lmsdragging.cDrop=a),lmsdragging.cDrop&&(lmsdragging.cDrop=a),(l=document.createElement("div")).className="zp_drgbrdr",lmsdragging.cDrop){if(lmsrubrics.root&&lmsrubrics.root.querySelector('[class="zp_drgbrdr"]'))return lmsrubrics.root.querySelector('[class="zp_drgbrdr"]').remove(),void lmsdragging.cDrop.after(l);if(lmsrubrics.root&&lmsrubrics.root.querySelector('[class="zp_drgbrdr tbbdr"]'))return lmsbase.addClass(l,"tbbdr"),lmsrubrics.root.querySelector('[class="zp_drgbrdr tbbdr"]').remove(),void lmsdragging.cDrop.after(l);if(lmsmodule.elem&&lmsmodule.elem.querySelector('[class="zp_drgbrdr"]'))return lmsmodule.elem.querySelector('[class="zp_drgbrdr"]').remove(),void lmsdragging.cDrop.after(l);if(lmslearningplan.elem&&lmslearningplan.elem.querySelector('[class="zp_drgbrdr"]'))return lmslearningplan.elem.querySelector('[class="zp_drgbrdr"]')?lmslearningplan.elem.querySelector('[class="zp_drgbrdr"]').remove():document.querySelector('[class="zp_drgbrdr"]').remove(),void lmsdragging.cDrop.after(l)}}}},close:function(){lmsdragging.cDrop=null,lmsdragging.tempDrag=null,lmsdragging.shiftX=null,lmsdragging.shiftY=null,lmsdragging.draggedElem=null,lmsdragging.moveElem=null,lmsdragging.contentELem=null,lmsdragging.parentModuleId=null,lmsdragging.previousSibling=null,lmsdragging.moduleFirst=0,lmsdragging.courseFirst=0,lmsdragging.levelFirst=0,lmsdragging.draggedRow=null,lmsdragging.currentLevelId=0,lmsdragging.parentLevelId=0,lmsdragging.sourceRubricId=0,lmsdragging.destinationRubricId=0,lmsdragging.rubricFirst=0,lmsdragging.sourceCriteriaId=0,lmsdragging.destinationCriteriaId=0,lmsdragging.criteriaFirst=0,lmsdragging.isLevelTag=!1}},lmsgroupmenu={stack:{},count:0,timeintvl:null,genUkey:function(){return(new Date).getTime()+"_"+this.count++},initiate:function(e){var t=this.genUkey(),s=new TRMenu(e,t);return this.stack[t]={elem:e,refer:s},e.setAttribute("_ukey",t),e.setAttribute("_ukeytype","form"),e.addEventListener("mousedown",lmsgroupmenu.handle,!1),this.initSchedule(),s},initSchedule:function(){this.timeintvl||(this.timeintvl=window.setInterval(this.sheduleCleanup,18e5))},handle:function(e){var t=this.getAttribute("_ukey");lmsgroupmenu.stack[t].refer.handle(e)},sheduleCleanup:function(){var e=lmsgroupmenu.stack;for(var t in e)document.contains(e[t].refer.root)||lmsgroupmenu.destroy(e[t].refer);JSON.stringify(e)===JSON.stringify({})&&window.clearInterval(lmsgroupmenu.timeintvl)},destroy:function(e){if(null!=e){var t=e.root,s=e.scrollCont,r=t.getAttribute("_ukey");for(var l in t.removeAttribute("_ukey"),t.removeEventListener("mousedown",lmsgroupmenu.handle,!1),s&&s.removeEventListener("mousewheel",e.menuHide,!1),e)delete e[l];delete this.stack[r]}}},TRMenu=function(e){return this.root=e,this.listObj={},this};TRMenu.prototype.scrollContainer=function(e){this.scrollCont=e,e.addEventListener("scroll",this.menuHide,!1)},TRMenu.prototype.menuHide=function(e){lmsmenu.hide("forced"),e.stopPropagation()},TRMenu.prototype.insertMenu=function(e){var t=lmsgroupmenu.genUkey();return e.elem.setAttribute("_ukey",t),this.listObj[t]=e,this},TRMenu.prototype.removeMenu=function(e){var t=e.getAttribute("_ukey");return t&&delete this.listObj[t],e.removeAttribute("_ukey"),this},TRMenu.prototype.updateMenu=function(e){var t=e.elem.getAttribute("_ukey");return this.listObj[t]=e,this},TRMenu.prototype.handle=function(e){var t=e.target;if(/^font$/i.test(t.tagName)&&lmsmenu.hasClass(t,"IC-cls1"))return lmsmenu.delSelectItem(t.parentNode),!0;var s=t.getAttribute("_ukey");if(!s){if(!(t=t.closest("[_ukey]")))return;s=t.getAttribute("_ukey")}var r=t.getAttribute("_ukeytype");if(s&&"form"!=r&&this.listObj[s]){var l=this.listObj[s],a=l.type;if("select"==a)this.select(l,e);else if("time"==a)this.time(l,e);else if("date"==a||"daterange"==a){var n=/^input/i.test(t.tagName)?t:t.getElementsByTagName("input")[0];this.date(l,e,n)}}},TRMenu.prototype.select=function(e,t){lmsmenu.initiate({elem:e.elem,type:"select",mode:e.mode,width:e.width||null,menutype:e.menutype||1,allow_new:e.allow_new,inputTimeout:e.inputTimeout,menulist:e.menulist,htmlContent:e.htmlContent,emptystring:e.emptystring,eve:t}).on("click",(function(){e.click&&e.click(this)})).bind()},TRMenu.prototype.time=function(e,t){lmsmenu.initiate({type:"time",tform:e.tform,elem:e.elem,width:e.width||null,maxHeight:"500px",eve:t}).on("click",(function(){e.click&&e.click(this)})).bind()},TRMenu.prototype.date=function(e,t,s){var r=s.value.trim();lmsmenu.initiate({elem:e.elem,inputElem:s,type:e.type||"date",date:""!=r?r:(new Date).getDateBy(e.dform),dform:e.dform,range:e.range,rangepattern:e.rangepattern||null,eve:t}).on("click",(function(){var t=this.referObj;"dateclick"==this.type?(t.inputElem.value=this.date,window.setTimeout((function(){t.inputElem.focus()}),0),e.click&&e.click(this)):"range"==this.type&&(t.inputElem.value=-1!=this.range[0]?this.range[0].getDateBy(t.dform)+" - "+this.range[1].getDateBy(t.dform):"",e.clickAction.call(this))})).bind()},TRMenu.prototype.getValueObject=function(){var e,t=this.listObj,s={};for(var r in t)s[(e=t[r]).name||r]=this.getValue(e.elem,e.type);return s},TRMenu.prototype.getValue=function(e,t){return"select"==t?lmsmenu.getSelectOptions(e):/^input$/i.test(e.tagName)?e.value:" "};const lmsCombndMenu={initiate:function(e,t,s,r){e=e||"1";let l=document.createElement("div");l.setAttribute("class","zp_ATfltr");let a=document.createElement("div");a.setAttribute("class","zp_Sm zp_c2");let n=document.createElement("div");if(n.setAttribute("class","zp_Sm zp_c7"),l.appendChild(a),l.appendChild(n),s){let e=document.createElement("font"),t=document.createElement("i");t.setAttribute("class","IC-cls"),e.appendChild(t),lmsbase.addListener(e,"click",(function(e){s(e,a,n),lmsCombndMenu.removeMenu(a),lmsCombndMenu.removeMenu(n)})),l.appendChild(e)}if(this.menuObj=lmsgroupmenu.initiate(l),t){let e=t[0];e.elem=a,lmsCombndMenu.insertMenu(a,e);let s=t[1];s.elem=n,lmsCombndMenu.insertMenu(n,s)}if(!r)return l;r.appendChild(l)},insertMenu:function(e,t){lmsCombndMenu.menuObj.insertMenu(t),lmsmenu.changeToSelectMenu(e,t._opts,t.mode,t.label,t.dft)},removeMenu:function(e){lmsCombndMenu.menuObj.removeMenu(e)}};var lmsform={fieldtype:{TEXTFIELD:1,LOOKUP:26,PICKLIST:25,RADIO_OPTION:101,EMAIL_ADDRESS:4,NUMBER:5,RADIO_DISPLYTYPE:101,MULTISELECT_DISPLYTYPE:102,SELECT_DISPLYTYPE:100,DATEFIELD:10,TEXTAREA:3,TIMEFIELD:34,CHECKBOX:9,FILEUPLOAD:18,MULTIFILEUPLOAD:31,IMAGE:20,DECIMAL:19},modeVar:{start:0,end:1,norm:2},defaultDate:[],refObj:{},lookUpId:"",selectItems:"",currentFormId:"",fileUploadObj:{},multiselect:[],singleSelect:[],fileList:[],currtableName:"",lookup:{},selectMenuArray:[],picklist:{},flag:0,params:{},submitCallback:"",closeCallBack:"",Obj:{},singleSelectItems:[],multiSelectItems:[],dateItems:[],timeItems:[],currentFormId:"",formref:"",fileUploadData:[],multiFileUploadItems:[],singleFileUploadItems:[],fileInfoContent:[],savedAttachments:[],updateOptionsCallback:null,mandatoryFlag:0,dropdownkey:[],dateMeta:{},timeMeta:{},numberItems:{},initiate:function(e,t,s){lmsform.Obj&&!t&&lmsform.close(e);var r=s||document.createElement("form");return r.id=t?"batchform":"form",r.setAttribute("onsubmit","return false"),lmsbase.addListener(r,"input",lmsform.inputFieldVal,!1),lmsbase.addListener(r,"focusout",lmsform.getFocusOutEvent,!1),lmsbase.addListener(r,"click",lmsform.getClickEvent,!1),lmsform.formref=r,r},on:function(e,t){return"updateOptions"==e&&"function"==typeof t&&(this.updateOptionsCallback=t),this},insertField:function(e,t,s,r,l,a,n,i,o,c,d){t&&(lmsform.submitCallback=t),lmsform.refObj={1:lmsformcomponents.getTextField,3:lmsformcomponents.getTextArea,4:lmsformcomponents.getEmailField,5:lmsformcomponents.getNumberField,25:lmsformcomponents.getSelectOptions,26:lmsformcomponents.getSelectOptions,34:lmsformcomponents.getTimeField,9:lmsformcomponents.getCheckBoxField,10:lmsformcomponents.getDateField,18:lmsformcomponents.fileUploadField,20:lmsformcomponents.imageFieldUpload,31:lmsformcomponents.fileUploadField};var m="",u=e.fieldType||e.componentType;return null!=u&&(m+=lmsform.refObj[u](e,r,l,a,n,i,o,c,d)),"string"==typeof e&&(m+="submit"==e?lmsformcomponents.getSubmitField(e,s,r):""),m},menuAction:function(e){if(7e3==e.code){var t=lmsform.lcId,s=e.message[t],r={};lmsform.singleSelect[t]&&(lmsform.selectMenuArray[lmsform.lcId][0]=[ZPI18N.getString("zp.select")],r[0]=[ZPI18N.getString("zp.select")]);for(var l=0;l<s.length;l++)r[s[l].Id]=[lmsFormConstants.getValue(s[l].Value)],lmsform.selectMenuArray[lmsform.lcId][s[l].Id]=[lmsFormConstants.getValue(s[l].Value)];lmsform.menuCallBack.updateOptionList(r,lmsform.menuCallBack.inputvalue)}},fetchMembers:function(){var e=event.target.closest('[type="multi"],[type="single"]');if(e){lmsform.lcId=e.querySelector('[_type="select"]').getAttribute("_name"),lmsform.menuCallBack=this;var t=null,s=null;(t=lmsform.singleSelect[lmsform.lcId]?lmsform.singleSelect:lmsform.multiselect)[lmsform.lcId]&&(s=t[lmsform.lcId].selfcallback),null!=this.value?s?t[lmsform.lcId].selfcallback(lmsform.menuAction,this.value,lmsform.lcId):lmsform.getSearchComponents(lmsform.menuAction,this.value,lmsform.lcId):(lmsform.luFcIds=[],s?t[lmsform.lcId].selfcallback(lmsform.menuAction,this.value,lmsform.lcId):lmsform.searchMenu(lmsform.menuAction,lmsform.lcId))}},searchMenu:function(e,t){var s={formId:lmsform.currentFormId,mode:"fetchFormLookupOtions",luFcIds:JSON.stringify([t]),courseId:lmscourses.currentCourseId?lmscourses.currentCourseId:void 0,batchId:lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&"0"!=lmscourses.currentBatchId?lmscourses.currentBatchId:void 0,conreqcsr:csrfToken};$.post("/formAction.zp",s,e)},getSearchComponents:function(e,t,s){var r={formId:lmsform.currentFormId,mode:"fetchFormLookupOtions",luFcIds:JSON.stringify([s]),searchtxt:t,courseId:lmscourses.currentCourseId,batchId:lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&"0"!=lmscourses.currentBatchId?lmscourses.currentBatchId:"",conreqcsr:csrfToken};$.post("/formAction.zp",r,e)},getClickEvent:function(e){var t=e.target.getAttribute("fieldName");if("submitbutton"===t&&lmsform.updateSelectOptions(),"radioChoice"==t||"checkBoxChoice"==t||"courseChoice"==t)if("radioChoice"==t){for(var s=e.target.closest("ul").querySelectorAll('[class ^= "IC-rdo"]'),r=0;r<s.length;r++)s[r].className="IC-rdo";e.target.closest("li").querySelector('[class="IC-rdo"]').className="IC-rdo zp_gclr"}else if("checkBoxChoice"==t){var l=e.target.closest("li").firstChild;"IC-cbox"==l.className?l.className="IC-cbox zp_gclr":l.className="IC-cbox"}else if("courseChoice"==t){for(s=lmsform.formref.querySelectorAll('[class ^= "PI_tick2_fil"]'),r=0;r<s.length;r++)$(s[r].parentElement).removeClass("zpl_act");$(e.target.closest("div[courserad]")).addClass("zpl_act")}},inputFieldVal:function(e){"numberId"===e.target.getAttribute("fieldName")&&lmsformcomponents.numberFun(e)},getFocusOutEvent:function(e){var t=e.target.getAttribute("fieldName");t&&("datefield"===t||"enddatefield"===t?lmsformcomponents.dateVallidate(e):("startTime"===t||"endTime"===t)&&lmsformcomponents.timeVallidate(e))},updateSelectOptions:function(){var e=lmsform.formvalidate("",0,1);if(e&&"P_LMSRooms"==e.zp_tableName){for(var t=[],s=0;s<lmsform.singleSelectItems.length;s++){for(var r=lmsform.singleSelectItems[s].querySelector("[_name]").getAttribute("_name"),l=1,a=(Object.keys(lmsform.selectMenuArray[r]),Object.values(lmsform.selectMenuArray[r])),n=0;n<a.length;n++){var i=document.createElement("div");i.innerHTML=a[n],a[n]=i.textContent,lmsform.singleSelectItems[s].querySelector('[_mode="single"]').textContent.trim().toString()==a[n].trim().toString()&&(l=0)}if(1===l)""!=(c={data:lmsform.singleSelectItems[s].textContent,tableName:lmsform.singleSelect[r].datatable,formId:r,length:0}).data&&t.push(c)}for(s=0;s<lmsform.multiSelectItems.length;s++){r=lmsform.multiSelectItems[s].querySelector("[_name]").getAttribute("_name"),Object.keys(lmsform.selectMenuArray[r]),a=Object.values(lmsform.selectMenuArray[r]);var o=lmsform.multiSelectItems[s].querySelectorAll('[_mode="multi"]');for(n=0;n<o[0].childNodes.length;n++){for(var c,d=o[0].childNodes[n].textContent,m=0,u=0;u<a.length;u++)a[u][0]=ZPeople.decodeTxt(a[u][0]);for(u=0;u<a.length;u++)d.trim()===a[u][0].trim()&&(m=1);if(0===m)""!=(c={data:d,formId:r,length:1}).data&&t.push(c);for(u=0;u<a.length;u++)a[u][0]=ZPeople.escapeHtml(a[u][0])}}var p={updateData:JSON.stringify(t)};0!=t.length?zplms.put("/lms/options",p,(function(e){e[1].length>0?lmsform.updateArray(JSON.parse(JSON.stringify(e[1]))):lmsform.formvalidate()})):lmsform.formvalidate()}else lmsform.formvalidate()},updateArray:function(e){for(var t=0,s={};t<e.length;t++){var r=e[t];s[e[t].formId]||(s[e[t].formId]=[]),s[e[t].formId].push({Value:r.data,Id:r.newId});var l=lmsform.selectMenuArray[e[t].formId];l[e[t].newId]=[ZPeople.escapeHtml(e[t].data)],lmsform.selectMenuArray[e[t].formId]=l}lmsform.updateOptionsCallback&&lmsform.updateOptionsCallback(s),lmsform.formvalidate()},formvalidate:function(e,t,s){lmsformcomponents.onUploadsStart(),lmsform.mandatoryFlag=0;var r=lmsform.formref.querySelectorAll('[dataMandatory="true"]');for(s&&(r=[]),N=0;N<r.length;N++)if(r[N].getAttribute("type")){var l=r[N];if(txt=l.parentElement.querySelector('[class="ztextbox--error__label"]'),""==r[N].value.trim()){if(lmsform.mandatoryFlag=1,r[N].value="",!r[N].classList.contains("ztextbox__error"))lmsbase.addClass(l,"ztextbox__error"),(m=document.createElement("span")).innerHTML=r[N].getAttribute("displayName")+" "+ZPI18N.getString("zp.lms.cannotbeEmpty"),m.className="ztextbox--error__label",txt||$(m).insertAfter(r[N].parentElement)}else lmsbase.removeClass(l,"ztextbox__error"),txt&&txt.remove()}var a=lmsform.formref.querySelectorAll("[_name]");for(s&&(a=[]),N=0;N<a.length;N++){var n="single"==a[N].parentElement.getAttribute("type")?lmsform.singleSelect:lmsform.multiselect;if(1==n[a[N].getAttribute("_name")].dataMandatory)if((m=document.createElement("span")).innerHTML=n[a[N].getAttribute("_name")].displayName+" "+ZPI18N.getString("zp.lms.cannotbeempty"),m.className="etxt",n==lmsform.singleSelect)(o=a[N].closest('[class^="zp_Sm"]').parentElement).querySelector('[_rel="0"]')||null==o.querySelector("[_rel]")?(o.querySelector('[class="etxt"]')||(lmsbase.addClass(o,"zp_err"),o.append(m)),lmsform.mandatoryFlag=1):o.querySelector('[class="etxt"]')&&(lmsbase.removeClass(o,"zp_err"),o.querySelector('[class="etxt"]').remove());else if(n==lmsform.multiselect){var i=a[N].querySelector('[_mode="multi"]'),o=a[N].closest('[class^="zp_Sm"]');0==i.childNodes.length?(o.querySelector('[class="etxt"]')||(lmsbase.addClass(o,"zp_err"),o.append(m)),lmsform.mandatoryFlag=1):o.querySelector('[class="etxt"]')&&(lmsbase.removeClass(o,"zp_err"),o.querySelector('[class="etxt"]').remove())}}var c=lmsform.formref.querySelectorAll('[fieldName="singleFileUpload"],[fieldName="mulitFileUpload"]');for(s&&(c=[]),N=0;N<c.length;N++){var d=c[N].getAttribute("formId");if("true"==c[N].getAttribute("dataMandatory")){var m,u=lmsform.fileInfoContent[d].getAllFilesForSaving(),p=c[N].querySelector('[_rel="local"]'),g=c[N].parentElement.querySelector('[class="etxt"]');if(g&&g.remove(),0==u.length)lmsform.mandatoryFlag=1,lmsbase.addClass(p,"zp_Ferr"),(m=document.createElement("span")).innerHTML=c[N].getAttribute("name")+" "+ZPI18N.getString("zp.lms.cannotbeempty"),m.className="etxt",$(m).insertAfter(c[N]);else lmsform.mandatoryFlag=0}}let f=lmsform.formFtr?[...lmsform.formref.querySelectorAll("[_req]"),...lmsform.formFtr.querySelectorAll("[_req]")]:lmsform.formref.querySelectorAll("[_req]");for(N=0;N<lmsform.singleSelectItems.length;N++){var v=(T=lmsform.singleSelectItems[N].querySelector('[_type="select"]')).getAttribute("_name"),h=(w=lmsform.singleSelect[v]).name,b=lmsform.selectMenuArray[v];if(b&&null!=T.querySelector("[_rel]")&&0!=T.querySelector("[_rel]").getAttribute("_rel")){for(var I=Object.keys(b),y=Object.values(b),_=0,S=0;S<y.length;S++){var C=T.textContent,P=y[S][0],z=document.createElement("div");z.innerHTML=P,y[S]=z.textContent,C.trim()==y[S].trim()&&(25==w.fieldType?lmsform.params[h]=ZPeople.decodeTxt(lmsform.dropdownkey[I[S]]):lmsform.params[h]=I[S],_=1)}0==_&&(lmsform.params[h]="")}else null!=T.querySelector("[_rel]")&&0==T.querySelector("[_rel]").getAttribute("_rel")&&(lmsform.params[h]="")}for(var N=0;N<lmsform.multiSelectItems.length;N++){v=(T=lmsform.multiSelectItems[N].querySelector('[_type="select"]')).getAttribute("_name");var T,w=lmsform.multiselect[v],M=[],L=(i=lmsform.multiSelectItems[N].querySelectorAll('[_mode="multi"]')[0].childNodes,"");if(26==w.fieldType)for(S=0;S<i.length;S++)M[S]=i[S].getAttribute("data-value"),L+=S==i.length-1?M[S]:M[S]+";";else for(S=0;S<i.length;S++)M[S]=ZPeople.decodeTxt(lmsform.dropdownkey[i[S].getAttribute("data-value")])||i[S].textContent,L+=S==i.length-1?M[S]:M[S]+";";lmsform.params[w.name]=L}var k=lmsform.formref.querySelectorAll("[courseRad]");for(N=0;N<k.length;N++)k[N].classList.contains("zpl_act")&&(lmsform.params[k[N].childNodes[2].getAttribute("name")]=ZPeople.decodeTxt(k[N].childNodes[2].getAttribute("value")));var Z=lmsform.formref.querySelectorAll('[class="IC-rdo zp_gclr"]');for(N=0;N<Z.length;N++)Z[N].getAttribute("name")&&(lmsform.params[Z[N].getAttribute("name")]=Z[N].getAttribute("value"));var A=lmsform.formref.querySelectorAll('[fieldName="checkBoxChoice"]');for(N=0;N<A.length;N++)A[N].getAttribute("name")&&(lmsform.params[A[N].getAttribute("name")]="IC-cbox zp_gclr"==A[N].className);var E=lmsform.formref.querySelectorAll('[fieldName="singleFileUpload"]');for(N=0;N<E.length;N++){var D=E[N].getAttribute("formid");0!=lmsform.fileInfoContent[D].getAllFilesForSaving().length&&(lmsform.params[E[N].getAttribute("displayname")]=lmsform.fileInfoContent[D].getAllFilesForSaving()[0].fileInfo.contentId)}var x=lmsform.formref.querySelectorAll('[fieldName="ImageField"]');for(N=0;N<x.length;N++){D=x[N].getAttribute("formid");0!=lmsform.fileInfoContent[D].getAllFilesForSaving().length&&(lmsform.params[x[N].getAttribute("displayname")]=lmsform.fileInfoContent[D].getAllFilesForSaving()[0].fileInfo.contentId)}var F=lmsform.formref.querySelectorAll('[fieldName="multiFileUpload"]');for(N=0;N<F.length;N++){D=F[N].getAttribute("formid");var O=F[N].getAttribute("displayname");if((u=lmsform.fileInfoContent[D].getAllFilesForSaving()).length>0){for(var R="[",q=0;q<u.length;q++)R+=u[q].fileInfo.contentId+",",R+=JSON.stringify(u[q].fileInfo.name),q!=u.length-1&&(R+=",");R+="]",lmsform.params[O]=R}else lmsform.params[O]="[]"}for(N=0;N<f.length;N++)if(null!=f[N].name)if("date"==f[N].getAttribute("key"))""!=f[N].value?lmsform.params[f[N].name]=f[N].value:lmsform.params[f[N].name]="";else if("fileuploadbutton"==f[N].getAttribute("id")||"multifileuploadbutton"==f[N].getAttribute("id"))0;else{if(f[N].value.indexOf("<")>-1||f[N].value.indexOf(">")>-1)return t=0,lmsformcomponents.onAllUploadsFinished(),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));lmsform.params[f[N].name]=f[N].value}return 1==lmsform.mandatoryFlag&&lmsformcomponents.onAllUploadsFinished(),0!=t&&(0===lmsform.mandatoryFlag?lmsform.submitCallback&&lmsform.submitCallback(lmsform.params):lmsform.validationFailureCallback&&lmsform.validationFailureCallback(lmsform.params)),lmsform.params},changetoI18N:function(e){var t="";return""!=e&&null!=e&&""==(t=ZPI18N.getString(e.trim()))&&(t=e),t},getEditFormComponents:function(e,t,s){var r={mode:"fetchSingleRecord",formId:t,recordId:e,isApprovalEnabled:!1,conreqcsr:csrfToken};$.post("/formAction.zp",r,(function(e){lmsform.editDetails=e,s&&s(e.message.recordDetails)}))},close:function(e){lmsform.formref&&(lmsbase.removeListener(lmsform.formref,"input",lmsform.inputFieldVal,!1),lmsbase.removeListener(lmsform.formref,"focusout",lmsform.getFocusOutEvent,!1),lmsbase.removeListener(lmsform.formref,"click",lmsform.getClickEvent,!1)),document.getElementById("form")&&document.getElementById("form").remove(),e||(lmsform.multiFileUploadItems=[],lmsform.singleFileUploadItems=[],lmsform.fileInfoContent=[],lmsform.savedAttachments=[]),lmsform.fileUploadObj={},lmsform.lookup={},lmsform.selectMenuArray=[],lmsform.picklist={},lmsform.flag=0,lmsform.params={},lmsform.Obj={},lmsform.multiselect=[],lmsform.singleSelect=[],lmsform.fileList=[],lmsform.currtableName="",lmsform.submitCallback="",lmsform.onBeforeUploadManagerBind="",lmsform.validationFailureCallback="",lmsform.multiSelectItems=[],lmsform.singleSelectItems=[],lmsform.refObj={},lmsform.dateItems=[],lmsform.timeItems=[],lmsform.formref="",lmsform.closeCallBack="",lmsform.mandatoryFlag=0,lmsform.updateOptionsCallback=null,lmsform.dropdownkey=[],lmsform.defaultDate=[],lmsform.dateMeta={},lmsform.timeMeta={},lmsform.numberItems={}},getFormComponents:function(e,t,s){var r={mode:"getFormComponents",formId:e,courseId:t};r[csrfParamName]=csrfToken,$.post("/formAction.zp",r,s)},getSingleRecord:function(e,t,s,r){var l={mode:"fetchSingleRecord",formId:t,recordId:e,courseId:s};l[csrfParamName]=csrfToken,$.post("/formAction.zp",l,r)},cacheCriteria:function(e){return e&&7e3==e.code},autofocus:function(){var e=lmsform.formref.querySelector("[autofocus]");if(e){lmsbase.addListener(e,"focus",(function e(){var t=this.value;this.value="",this.value=t,lmsbase.removeListener(this,"focus",e)})),e.focus()}},setErrorText:function(e,t){var s=document.createElement("span");s.className="etxt",s.setAttribute("formError",""),s.textContent=t,!e.querySelector("[formError]")&&e.appendChild(s)},removeErrorText:function(e,t){var s=e.querySelector("[formError]");s&&s.parentNode.removeChild(s)},setErrorClass:function(e){lmsbase.addClass(e,"zp_err")},removeErrorClass:function(e){lmsbase.removeClass(e,"zp_err")}};const addCourseForm={formElem:"",submitCallback:[],formIds:new Set,formParams:[],initiate:()=>(document.getElementById("form")&&document.getElementById("form").remove(),addCourseForm.formElem=lmsdocument.createElement("form",{onsubmit:"return false",id:"form"}),addCourseForm.formElem.mandatoryFields=[],addCourseForm.submitCallback=[],addCourseForm.formParams=[],addCourseForm.formIds=new Set,addCourseForm.formElem),get formId(){return this._formId},set formId(e){this.formParams[e]={},this._formId=e},getLabel:e=>lmsdocument.parseStringToDOMElement(lmsformcomponents.labelName(e)),insertField(e,t,s){let r=e.fieldType||e.componentType;if(r)switch(r){case 1:case 5:let l=1!=r;return addCourseForm.getInputField(e,l,t);case 10:return addCourseForm.getDateField(e,s);case 25:return addCourseForm.getSingleSelectField(e)}},getInputField(e,t,s){let r=document.createElement("div"),l=lmsdocument.createElement("input",{class:"ztextbox",_req:"",fieldName:"input",formId:addCourseForm._formId,formCompId:e.formComponentId,fieldType:e.fieldType,type:"text",name:e.labelName,autocomplete:"off",autofocus:"",displayName:lmsform.changetoI18N(e.displayName)});return e.maxLength&&t&&l.setAttribute("maxlength",e.maxLength>5?5:e.maxLength),s&&l.setAttribute("placeholder",s),r.appendChild(l),e.isMandatory&&!addCourseForm.formElem.mandatoryFields.includes(l)&&addCourseForm.formElem.mandatoryFields.push(l),t&&lmsbase.addListener(l,"input",addCourseForm.validateNumberField),r},getDateField(e,t){let s=document.createElement("div"),r=t?"endDate_"+e.formComponentId:"startDate_"+e.formComponentId,l=lmsdocument.createElement("input",{id:r,_req:"","data-format":dateFmt,"data-spin-buttons":"none","data-calendar-icon":!0,"data-picker":!0,type:"text",fieldName:"dateField",formId:addCourseForm._formId,formCompId:e.formComponentId,displayName:lmsform.changetoI18N(e.displayName),name:e.labelName}),a=new Date;t&&a.setDate(a.getDate()+5);let n=a.getMonth(),i=a.getFullYear(),o=a.getDate();return o<10&&(o="0"+o),n<10&&(n="0"+n),a.setFullYear(i,n,o),l.selectedValue=Calendar.formatDate(a),s.appendChild(l),e.isMandatory&&!addCourseForm.formElem.mandatoryFields.includes(l)&&addCourseForm.formElem.mandatoryFields.push(l),s},getSingleSelectField(e){let t=document.createElement("div"),s=lmsdocument.createElement("select",{id:"singleSelect_"+e.formComponentId,_req:"",fieldName:"select",formCompId:e.formComponentId,fieldType:e.fieldType,type:"select",name:e.labelName,formId:addCourseForm._formId,displayName:lmsform.changetoI18N(e.displayName)});return t.appendChild(s),e.isMandatory&&!addCourseForm.formElem.mandatoryFields.includes(s)&&addCourseForm.formElem.mandatoryFields.push(s),s.initData=addCourseForm.getSelectInitOpts(e),t},getSelectInitOpts(e){let t=[];e.OptionsWithId&&e.OptionsWithId.forEach((e=>t.push({label:lmsFormConstants.getValue(e.Value),value:e.Id})));let s={options:t,dropdownList:{fitForElement:!0}};return e.change&&(s.change=e.change),e.selectedValue&&(s.selectedValue=e.selectedValue),e.placeholder&&(s.placeholder=e.placeholder),s},getSubmitField(e){let t=lmsdocument.createElement("button",{class:"zlabel zlabel--blue zlabel--medium",type:"button",fieldName:"submitbutton"});return t.textContent=e,lmsbase.addListener(t,"click",addCourseForm.handleFormSubmit),t},setSubmitCallback(e,t){addCourseForm.submitCallback.push({formId:addCourseForm._formId,callback:e,_params:t})},bind(e){let t=addCourseForm.formElem.querySelectorAll("input[formid='"+e+"']");for(let e=0;e<t.length;e++)if(t[e].autofocus){t[e].focus();break}let s=addCourseForm.formElem.querySelectorAll("select[formid='"+e+"']");for(let e=0;e<s.length;e++)if(s[e].hasAttribute("id")&&addCourseForm.destroyField(s[e].getAttribute("id"),"select")){let t=s[e].getAttribute("id"),r=s[e].initData;if(!r)continue;let l="";r.selectedValue&&(l=r.selectedValue,delete r.selectedValue),ZPeopleComponents.select("#"+t).setAttributes(r),l&&ZPeopleComponents.select("#"+t).setValue(l)}let r=addCourseForm.formElem.querySelectorAll("[fieldName='dateField'][formid='"+e+"']");for(let e=0;e<r.length;e++)if(r[e].hasAttribute("id")&&addCourseForm.destroyField(r[e].getAttribute("id"),"dateField")){let t=r[e].getAttribute("id"),s="";r[e].selectedValue&&(s=r[e].selectedValue,delete r[e].selectedValue),ZPeopleComponents.datefield("#"+t,{change:addCourseForm.validateDateField}),s&&ZPeopleComponents.datefield("#"+t).setValue(s)}},isFieldInitialized:e=>ZPeopleComponents.isComponent("#"+e),destroyField:(e,t)=>!addCourseForm.isFieldInitialized(e)||("select"==t?ZPeopleComponents.select("#"+e).destroy():"dateField"==t&&ZPeopleComponents.datefield("#"+e).destroy(),!0),validateNumberField(e){let t=e.target.value.replace(/[\\A-Za-z!"$%^&\-\)\(*+_={};:'@#~,.\/<>\" "\?|`\]\[]/g,"");0==t&&(t=""),e.target.value=t},parseDate(e){if("dd-MM-yyyy"!=dateFmt&&"dd/MM/yyyy"!=dateFmt&&"dd.MM.yyyy"!=dateFmt)return new Date(e);let t=e.split(/[-./]/);return new Date(`${t[1]}/${t[0]}/${t[2]}`)},validateDateField(e){let t="",s="",r=e.target.attr("id").split("_")[0],l=addCourseForm.formElem.querySelector("[id*='endDate']").getAttribute("id");"startDate"==r?(t=e.detail.value,s=addCourseForm.getFieldVal(addCourseForm.formElem.querySelector("[id*='endDate']"))):(s=e.detail.value,t=addCourseForm.getFieldVal(addCourseForm.formElem.querySelector("[id*='startDate']"))),addCourseForm.parseDate(t)>addCourseForm.parseDate(s)&&ZPeopleComponents.datefield("#"+l).setValue(t)},handleFormSubmit(){if(addCourseForm.validateForm()){let e=addCourseForm.submitCallback[0].formId,t=addCourseForm.submitCallback[1]?addCourseForm.submitCallback[1].formId:void 0,s=addCourseForm.submitCallback[0].callback,r=addCourseForm.submitCallback[1]?addCourseForm.submitCallback[1].callback:"",l=addCourseForm.submitCallback[0]._params,a=addCourseForm.submitCallback[1]?addCourseForm.submitCallback[1]._params:"";t&&addCourseForm.formIds.has(t)?s(Object.assign({},l,addCourseForm.formParams[e],addCourseForm.getDefaultFormParams(e)),{callback:r,params:Object.assign({},a,addCourseForm.formParams[t],addCourseForm.getDefaultFormParams(t))}):s(Object.assign({},l,addCourseForm.formParams[e],addCourseForm.getDefaultFormParams(e)))}},getDefaultFormParams:e=>({zp_formId:e,zp_mode:"addRecord",loginUserZUID:_LOGGEDIN_ZUID,isDraft:!1,conreqcsr:csrfToken}),validateForm(){addCourseForm.adjustButtonOpacity(!0);let e=addCourseForm.formElem.mandatoryFields,t=!0;for(let s=0;s<e.length;s++){let r=e[s],l=addCourseForm.getFieldVal(r),a=r.parentElement.parentElement.querySelector("[class='ztextbox--error__label']");""==l.trim()?(!r.classList.contains("ztextbox__error")&&!a&&addCourseForm.showMissingField(r),t=!1):(r.hasAttribute("fieldName")&&"dateField"==r.getAttribute("fieldName")?ZPeopleComponents.datefield("#"+r.getAttribute("id")).container.removeClass("ztextbox__error"):lmsbase.removeClass(r,"ztextbox__error"),a&&a.remove())}if(!t)return addCourseForm.adjustButtonOpacity(!1),t;let s=addCourseForm.formElem.querySelectorAll("[_req]");for(let e=0;e<s.length;e++){let t=s[e],r=addCourseForm.getFieldVal(t),l=t.getAttribute("formid");addCourseForm.formIds.add(l);let a=t.getAttribute("name");addCourseForm.formParams[l][a]=r}return!0},showMissingField(e){e.hasAttribute("fieldName")&&"dateField"==e.getAttribute("fieldName")?ZPeopleComponents.datefield("#"+e.getAttribute("id")).container.addClass("ztextbox__error"):lmsbase.addClass(e,"ztextbox__error");let t=lmsdocument.createElement("span",{class:"ztextbox--error__label"});t.textContent=e.getAttribute("displayName")+" "+ZPI18N.getString("zp.lms.cannotbeEmpty"),$(t).insertAfter(e.parentElement)},getFieldVal(e){let t=e.getAttribute("fieldname"),s=e.hasAttribute("id")?e.getAttribute("id"):null;switch(t){case"input":return e.value;case"dateField":return addCourseForm.isFieldInitialized(s)&&null!=ZPeopleComponents.datefield("#"+s).getValue().dateString?ZPeopleComponents.datefield("#"+s).getValue().dateString:"";case"select":return addCourseForm.isFieldInitialized(s)?ZPeopleComponents.select("#"+s).getValue():""}},adjustButtonOpacity(e){if(document.querySelector("[fieldName='submitbutton']")){let t=document.querySelector("[fieldName='submitbutton']"),s=e?"pointer-events:none;opacity:0.5;":"pointer-events:all;opacity:1.0;";t&&(t.style=s)}},clearFields(){addCourseForm.formElem.querySelectorAll("#batchFields").forEach((function(e){let t=e.querySelectorAll("[_req]");for(i=0;i<t.length;i++){let e=addCourseForm.formElem.mandatoryFields.indexOf(t[i]);-1!=e&&addCourseForm.formElem.mandatoryFields.splice(e,1)}e.remove()}))},destroyCourseInitFields(){(addCourseForm.formElem?addCourseForm.formElem.querySelectorAll("[_req]"):[]).forEach((function(e){switch(e.getAttribute("fieldname")){case"select":fieldId=e.getAttribute("id"),ZPeopleComponents.isComponent("#"+fieldId)&&ZPeopleComponents.select("#"+fieldId).destroy();break;case"dateField":fieldId=e.getAttribute("id"),ZPeopleComponents.isComponent("#"+fieldId)&&ZPeopleComponents.datefield("#"+fieldId).destroy()}}))}};var lmsformcomponents={hiddenField:function(e,t){return"<input hidden value="+t+" name="+e+' _req="">'},htmlField:function(e){return e.fieldType===lmsform.fieldtype.PICKLIST?'<div class="zp_Sm" type="multiSelect" "'+e.menuAttributes+'">'+(lmsform.changetoI18N(e.displayName)?lmsformcomponents.labelName(e):"")+lmsmenu.getSelectElement(e.formComponentId,e.defaultSelection?e.defaultSelection:{},"multi",null,e.emptyText,"noencode")+'<span errMsg class="etxt"></span></div>':'<div class="zp_Sm" type="singleSelect" "'+e.menuAttributes+'">'+(lmsform.changetoI18N(e.displayName)?lmsformcomponents.labelName(e):"")+lmsmenu.getSelectElement(e.formComponentId,e.defaultSelection?e.defaultSelection:{},"single",null,e.emptyText||ZPI18N.getString("zp.select"))+'<span errMsg class="etxt"></span></div>'},labelName:function(e,t){var s="";return(e.isMandatory||e.isMand)&&(s="zpl_mtry"),null!=t&&1!=t?"zpl_mtry"==s?"<"+t+' class="'+s+'"><font>'+lmsform.changetoI18N(e.displayName)+"</font></"+t+">":"<"+t+' class="'+s+'">'+lmsform.changetoI18N(e.displayName)+"</"+t+">":1==t?'<p class="'+s+'">'+lmsform.changetoI18N(e.displayName)+"</p>":'<div><label class="'+s+'">'+lmsform.changetoI18N(e.displayName)+"</label></div>"},getTextField:function(e,t,s,r,l,a){return null!=s&&""!=s||((s={}).componentValue=""),'<div><input class="ztextbox" _req="" fieldName="textId" displayName="'+lmsform.changetoI18N(e.displayName)+'" formId="'+e.formComponentId+'" value="'+s.componentValue+'" maxlength="'+e.maxLength+'" fieldType='+e.fieldType+' type="text" name='+e.labelName+" dataMandatory="+e.isMandatory+' autocomplete="off" autofocus></div>'},getNumberField:function(e,t,s,r){var l="",a=e.placeHolder?e.placeHolder:"";null==s||""==s?(s={},l=e.autofillvalue||""):l=""!=e.autofillvalue&&null==s.componentValue?e.autofillvalue:s.componentValue,"zeroPossible"!=t&&0==l&&(l="");var n="<div>";return r&&(n+='<i class="IC-dummy" data-text='+ZPI18N.getString("zp.lms.mins")+"></i>"),e.extraCallback&&(lmsform.numberItems[e.formComponentId]={_callback:e.extraCallback}),n+='<input _req="" fieldName="numberId" placeholder = "'+a+'" displayName="'+lmsform.changetoI18N(e.displayName)+'" formId="'+e.formComponentId+'" value="'+l+'" maxlength="'+(e.maxLength>5?5:e.maxLength)+'" fieldType='+e.fieldType+' type="text"  name='+e.labelName+' autocomplete="off" dataMandatory='+e.isMandatory+" "+(e.no_autofocus?"":"autofocus")+" "+(e.minimumValue?'min="'+e.minimumValue+'"':"")+(e.maximumValue?'max="'+e.maximumValue+'"':"")+"></div>"},getSelectOptions:function(e,t,s,r,l,a,n,i,o){return null!=s&&""!=s||((s={}).componentValue=""),e.displayType==lmsform.fieldtype.MULTISELECT_DISPLYTYPE?lmsformcomponents.getMultiSelectOptions(e,s,r,l,t,a,i):e.displayType==lmsform.fieldtype.SELECT_DISPLYTYPE?lmsformcomponents.getSingleSelectOptions(e,s,r,t,l,a,n,i,o):e.displayType==lmsform.fieldtype.RADIO_DISPLYTYPE?lmsformcomponents.getRadiOption(e,t,s):""},getMultiSelectOptions:function(e,t,s,r,l,a,n){null==e.OptionsWithId&&(e.OptionsWithId=e.AddOptionsWithId),null==e.Options&&(e.Option=e.AddOptions);var i=e.fieldType==lmsform.fieldtype.PICKLIST?e.OptionsWithId:e.Options;if(e.Options)for(var o=0;o<e.Options.length;)lmsform.dropdownkey[i[o].Id]=i[o].Value,lmsform.lookup[i[o].Id]=[lmsFormConstants.getValue(i[o].Value)],o++;lmsform.selectMenuArray[e.formComponentId]=lmsform.lookup,lmsform.lookup={},"disabled"!=s&&(s="enabled"),lmsform.multiselect[e.formComponentId]={datatable:e.refTableName,formId:e.formComponentId,name:e.labelName,dataMandatory:e.isMandatory,skey:"multiselect",displayName:lmsform.changetoI18N(e.displayName),createNew:s,flag:a,fieldType:e.fieldType};var c={};if(""!=e.autofillvalue)for(var d=0;d<e.Options.length;d++)e.autofillvalue==e.OptionsWithId[d].Value&&(c[e.OptionsWithId[d].Id]=[lmsform.changetoI18N(e.displayName)]);if(""!=t.componentValue){"string"==typeof t.componentValue_ID&&(t.componentValue_ID=t.componentValue_ID.split(";")),"string"==typeof t.componentValue&&(t.componentValue=[t.componentValue]);for(d=0;d<t.componentValue.length;d++)26!=e.fieldType||"P_LMSCategory"==e.refTableName?c[t.componentValue_ID[d]]=[lmsFormConstants.getValue(ZPeople.decodeTxt(t.componentValue[d]))]:c[t.componentValue_ID[d]]=[t.componentValue[d]]}a||(lmsform.selectMenuArray[e.formComponentId]=c);var m=ZPI18N.getString("zp.select");l&&(m=ZPI18N.getString("zp.lms.sall")+" "+lmsform.changetoI18N(e.displayName));var u='<div class="'+r+'" formId='+e.formComponentId+' type="multi">';return n&&(u+=lmsformcomponents.labelName(e)),u+=lmsmenu.getSelectElement(e.formComponentId,c,"multi",null,m,"","noencode")+"</div>"},getSingleSelectOptions:function(e,t,s,r,l,a,n,i,o){if(null==e.OptionsWithId&&(e.OptionsWithId=e.AddOptionsWithId),null==e.Options&&(e.Options=e.AddOptions),lmsform.picklist={},1!=r&&(lmsform.picklist[0]=[ZPI18N.getString("zp.select")]),e.Options)for(var c=e.fieldType==lmsform.fieldtype.PICKLIST?e.OptionsWithId:e.Options,d=0;d<e.Options.length;)lmsform.dropdownkey[c[d].Id]=c[d].Value,26!=e.fieldType||"P_LMSCategory"==e.refTableName?lmsform.picklist[c[d].Id]=[lmsFormConstants.getValue(ZPeople.decodeTxt(c[d].Value))]:lmsform.picklist[c[d].Id]=[c[d].Value],d++;"disabled"!=s&&(s="enabled");var m=!1;e.click&&(m=e.click),lmsform.selectMenuArray[e.formComponentId]=lmsform.picklist,lmsform.singleSelect[e.formComponentId]={datatable:e.refTableName,formId:e.formComponentId,name:e.labelName,dataMandatory:e.isMandatory,fieldType:e.fieldType,displayName:lmsform.changetoI18N(e.displayName),createNew:s,flag:a,click:m,skey:"singleselect"},e.callback&&(lmsform.singleSelect[e.formComponentId].callback=e.callback),e.selfcallback&&(lmsform.singleSelect[e.formComponentId].selfcallback=e.selfcallback);var u={};if(""!=e.autofillvalue&&""==t.componentValue)for(var p=0;p<e.Options.length;p++)e.OptionsWithId[p].Value=e.OptionsWithId[p].Value,e.autofillvalue=e.autofillvalue,e.autofillvalue==e.OptionsWithId[p].Value&&(u[e.OptionsWithId[p].Id]=[lmsFormConstants.getValue(e.autofillvalue)]);t.componentValue?26!=e.fieldType||"P_LMSCategory"==e.refTableName?u[t.componentValue_ID]=[lmsFormConstants.getValue(ZPeople.decodeTxt(t.componentValue))]:u[t.componentValue_ID]=[t.componentValue,"",t.componentIcon]:a||(u[0]=[ZPI18N.getString("zp.select")]),a||(lmsform.selectMenuArray[e.formComponentId]=u),n||(n=ZPI18N.getString("zp.select"));var g='<div class="'+l+'" formId='+e.formComponentId+' type="single"';return o&&(g+='_rel="'+o+'"'),g+=">",i&&(e.header?g+=lmsformcomponents.labelName(e,"h4"):g+=lmsformcomponents.labelName(e)),g+=lmsmenu.getSelectElement(e.formComponentId,u,"single",null,n),g+=e.additionalHtml?e.additionalHtml:"",g+="</div>"},getTimeField:function(e,t,s){if(null==s||null==s||""==s||null!=s.componentValue&&""==s.componentValue){var r=new Date,l=r.getHours()+1;if("hh:mm a"==timeFormat)if(24==r)if(0==t){var a=date.getMinutes();s.componentValue="11:"+a+" pm"}else s.componentValue="11:59 pm";else{var n=l>=12?"pm":"am";l=(l%=12)||12,(s={}).componentValue=0==t?l+":00 "+n:l+":30 "+n}else{var i="";l="",s={};i=r.getMinutes(),24==(l=r.getHours()+1)&&(l="00"),i=0==t?"00":"30",s.componentValue=l+":"+i}}else if(""!=s.componentValue&&"hh:mm a"==timeFormat){var o=ZPeople.decodeTxt(s.componentValue);0==o.charAt(0)&&(o=o.substr(1)),"PM"==(o=o.split(" "))[1]?o[1]="pm":o[1]="am",s.componentValue=o[0]+" "+o[1]}e.extraCallback&&(lmsform.timeMeta[e.formComponentId]={_callback:e.extraCallback});var c=0==t?"startTime":"endTime";return null==e.timeFormat&&(e.timeFormat="hh:mm"),'<div ><i class="IC-time-duration"></i><input type="text" key="time"  displayName="'+lmsform.changetoI18N(e.displayName)+'" value="'+s.componentValue+'" formId="'+e.formComponentId+'" fieldName="'+c+'" dataMandatory='+e.isMandatory+" name="+e.labelName+' placeholder="'+e.timeFormat+'"  _req="" ></div>'},getDateField:function(e,t,s){if(e.defaultDate&&(lmsform.defaultDate[e.formComponentId]=e.defaultDate),e.defaultDate&&e.defaultDate.startDate&&(null!=s&&""!=s||((s={}).componentValue=ZPeople.decodeTxt(e.defaultDate.startDate).parseDate(lmsbase._userDForm),s.componentValue=Calendar.formatDate(s.componentValue))),null!=s&&""!=s||((s={}).componentValue=""),""!=s.componentValue){var r=ZPeople.decodeTxt(s.componentValue).parseDate(lmsbase._userDForm);s.componentValue=Calendar.formatDate(r)}else{r=new Date;1==t&&r.setDate(r.getDate()+5);var l=r.getMonth(),a=r.getFullYear(),n=r.getDate();n<10&&(n="0"+n),l<10&&(l="0"+l),r.setFullYear(a,l,n),s.componentValue=Calendar.formatDate(r)}e.extraCallback&&(lmsform.dateMeta[e.formComponentId]={_callback:e.extraCallback});var i="";return 0==t?i="datefield":1==t?i="enddatefield":2==t&&(i="normalDateField"),'<div><i class="IC-vcal"></i><input type="text" formId="'+e.formComponentId+'" displayName="'+lmsform.changetoI18N(e.displayName)+'" key="date" fieldName="'+i+'" value="'+s.componentValue+'" dataMandatory='+e.isMandatory+" name="+e.labelName+' _req=""></div>'},getTextArea:function(e,t,s){return null!=s&&""!=s||((s={}).componentValue=""),s.componentValue&&(s.componentValue=s.componentValue.replace(/<br>/g,"\n")),'<div><textarea class="zp_txtfocs"  maxlength="'+e.maxlength+'" type="textArea" dataMandatory='+e.isMandatory+' formId="'+e.formComponentId+'" displayName="'+lmsform.changetoI18N(e.displayName)+'" _req="" name="'+e.labelName+'" value="'+s.componentValue+'" fieldName="TextAreaId" autofocus>'+s.componentValue+"</textarea></div>"},imageFieldUpload:function(e,t,s){return lmsform.fileUploadData[e.formComponentId]=e,lmsform.savedAttachments[e.formComponentId]=s,'<label _rel="local" _irel="image"><div attachmentList formId="'+e.formComponentId+'" displayName="'+e.labelName+'"  fieldName="ImageField">'+ZPI18N.getString("zp.lms.uploadroompic")+"</div></label>"},fileUploadField:function(e,t,s){lmsform.fileUploadData[e.formComponentId]=e,lmsform.savedAttachments[e.formComponentId]=s,maxSize=1073741824;var r="multiFileUpload";31!=e.fieldType&&(r="singleFileUpload");var l='<div class="zpa_comp" formId="'+e.formComponentId+'"  displayName="'+e.labelName+'" name="'+lmsform.changetoI18N(e.displayName)+'" fieldName="'+r+'"  dataMandatory='+e.isMandatory+" >";return l+=ListingUploadManager.getAttachmentHTML(maxSize).outerHTML,l+=ListingUploadManager.getAttachmentListHTML().outerHTML,l+="</div>"},invokeUploadManager:function(e,t,s){var r=lmsform.fileUploadData[e];t=t||[];var l=r.fieldType!=lmsform.fieldtype.IMAGE?lmsform.formref.querySelector('[formId="'+e+'"]'):lmsform.formref.querySelector('[formId="'+e+'"]').parentElement,a=lmsform.formref.querySelector('[formId="'+e+'"]');lmsform.formref.querySelector('[formId="'+e+'"]').parentElement.querySelector("[attachmentList]");s=r.fieldType==lmsform.fieldtype.MULTIFILEUPLOAD;var n={clickElement:l,dropElement:a,moduleName:lms.appname,multiple:s,MAXSIZE:1073741824,SUPPORTED_SOURCES:lmsfileaction.SOURCE.BOTH};r.fieldType===lmsform.fieldtype.IMAGE?(n.requiredFileTypes="image",n.MAXSIZE=5242880):(r.fieldType==lmsform.fieldtype.FILEUPLOAD||r.fieldType===lmsform.fieldtype.MULTIFILEUPLOAD&&"lms_CourseIntroFiles"==r.labelName)&&(n.notRequiredFileTypes="zip,others,unknown"),n.callbackObject=n;var i={MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED:s?3:1,type:r.fieldType!=lmsform.fieldtype.IMAGE?lmsuploadmanager.UPLOADMANAGER_TYPE.LISTINGUPLOADMANAGER:lmsuploadmanager.UPLOADMANAGER_TYPE.SINGLEIMAGEUPLOADMANAGER,listElement:r.fieldType!=lmsform.fieldtype.IMAGE?lmsform.formref.querySelector('[formId="'+e+'"]').parentElement.querySelector("[attachmentTab]"):lmsform.formref.querySelector('[formId="'+e+'"]').parentElement};lmsform.fileInfoContent[e]=lmsuploadmanager.initUploadManager(i,new lmsfileaction.upload(n)),r.fieldType!=lmsform.fieldtype.IMAGE?(lmsform.fileInfoContent[e].attachCallback("getSingleAttachment",ListingUploadManager.getSingleAttachmentHTML),lmsform.fileInfoContent[e].attachCallback("onUploading",ListingUploadManager.uploadMonitor),lmsform.fileInfoContent[e].attachCallback("onAuthorisationFailure",ListingUploadManager.onAuthorisationFailure),lmsform.fileInfoContent[e].attachCallback("onFileTransferFailure",ListingUploadManager.onFileTranserFailure),lmsform.fileInfoContent[e].attachCallback("onVirusFound",ListingUploadManager.onVirusFound),lmsform.fileInfoContent[e].attachCallback("onFileStoredSuccessfully",ListingUploadManager.onFileStored),lmsform.fileInfoContent[e].attachCallback("getPreviewObject",lmsattachment.getPreviewObject),lmsform.fileInfoContent[e].attachCallback("lightbox_src_callback",lmsattachment.lightbox_src_callback),lmsform.fileInfoContent[e].attachCallback("lightbox_click_callback",lmsattachment.lightbox_click_callback),lmsform.fileInfoContent[e].attachCallback("onMaximumUploadLimitReached",ListingUploadManager.onMaximumNumberOfUploadLimitReached)):(lmsform.fileInfoContent[e].attachCallback("getSingleAttachment",SingleImageUploadManager.getSingleAttachmentHTML),lmsform.fileInfoContent[e].attachCallback("onbeforeupload",SingleImageUploadManager.onBeforeUpload),lmsform.fileInfoContent[e].attachCallback("onafterupload",SingleImageUploadManager.onAfterUpload),lmsform.fileInfoContent[e].attachCallback("getPreviewObject",lmsattachment.getPreviewObject),lmsform.fileInfoContent[e].attachCallback("lightbox_src_callback",lmsattachment.lightbox_src_callback),lmsform.fileInfoContent[e].attachCallback("lightbox_click_callback",lmsattachment.lightbox_click_callback),lmsform.fileInfoContent[e].attachCallback("onMaximumUploadLimitReached",SingleImageUploadManager.onMaximumNumberOfUploadLimitReached)),lmsform.fileInfoContent[e].attachCallback("onUploadsStart",lmsformcomponents.onUploadsStart),lmsform.fileInfoContent[e].attachCallback("onUploadsFinished",lmsformcomponents.onAllUploadsFinished),s&&lmsform.savedAttachments[e]&&null!=lmsform.savedAttachments[e].componentValue?lmsform.fileInfoContent[e].addSavedFiles(lmsform.savedAttachments[e].componentValue):s||null==lmsform.savedAttachments[e]||""==lmsform.savedAttachments[e]||""==lmsform.savedAttachments[e].componentValue||lmsform.fileInfoContent[e].addSavedFiles([lmsform.savedAttachments[e].componentValue]),lmsform.onBeforeUploadManagerBind&&lmsform.onBeforeUploadManagerBind(e),lmsform.fileInfoContent[e].bind()},getSubmitField:function(e,t,s){var r="";return"submit"===e&&(r='<button class="zlabel zlabel--blue zlabel--medium" type="button" fieldName="submitbutton">'+t+"</button>"+lmsformcomponents.hiddenField("zp_mode",1==s?"updateRecord":"addRecord")+lmsformcomponents.hiddenField("loginUserZUID",_LOGGEDIN_ZUID)+lmsformcomponents.hiddenField("isDraft",!1)+lmsformcomponents.hiddenField("conreqcsr",csrfToken)),r},getCloseField:function(e,t,s,r){return t&&(lmsform.closeCallBack=t),'<button class="zpthm" type="button" fieldName="closebutton">'+s+"</button>"},getCheckBoxField:function(e,t,s,r){null!=s&&""!=s||((s={}).componentValue="");var l="IC-cbox";""==s.componentValue?"true"==e.autofillvalue&&(l="IC-cbox zp_gclr"):l="true"==s.componentValue||1==s.componentValue?"IC-cbox zp_gclr":"IC-cbox";var a='<li><i formId = "'+e.formComponentId+'" displayName="'+lmsform.changetoI18N(e.displayName)+'" dataMandatory="'+e.isMandatory+'" name="'+e.labelName+'" fieldName="checkBoxChoice" class ="'+l+'"></i>';return a+=e.em?'<h4 fieldName="checkBoxChoice">'+lmsform.changetoI18N(e.displayName)+"</h4>":'<span fieldName="checkBoxChoice">'+lmsform.changetoI18N(e.displayName)+"</span>",a+=e.em?"<em>"+e.em+"</em>":"",a+=(e.innerDiv?'<div class="zp_Smsub">'+e.innerDiv+"</div>"+(e.extraTxt?e.extraTxt:""):"")+"</li>","horizontal"==t?a:"<ul>"+a+"</ul>"},getSimpleCheckBoxField:function(e,t){null!=t&&""!=t||((t={}).componentValue="");var s="IC-cbox";return""==t.componentValue?"true"==e.autofillvalue&&(s="IC-cbox zp_gclr"):s="true"==t.componentValue||1==t.componentValue?"IC-cbox zp_gclr":"IC-cbox",'<i formId = "'+e.formComponentId+'" displayName="'+lmsform.changetoI18N(e.displayName)+'" dataMandatory="'+e.isMandatory+'" name="'+e.labelName+'" fieldName="checkBoxChoice" class ="'+s+'"></i>'+(e.displayName?"<span>"+lmsform.changetoI18N(e.displayName)+"</span>":"")},getRadiOption:function(e,t,s){var r="",l="",a="span";2==t?l="radioChoiceStatic":3==t?(l="courseChoice",a="h4"):l="radioChoice",r+='<div formId="'+e.formComponentId+'" class = "">',r+=3==t?'<div class="zpl_crdlst">':"<ul>";for(var n=0;n<e.Options.length;n++){var i="";3==t&&(i="zpl_catlst zpl_catlstgry "),(""!=s.componentValue&&s.componentValue==e.OptionsWithId[n].Value||""==s.componentValue&&e.autofillvalue===e.OptionsWithId[n].Value)&&(3==t?i+="zpl_act":i="zp_gclr"),3==t?r+='<div courseRad class="'+i+'" fieldName="'+l+'">':(r+='<li fieldVal="'+e.OptionsWithId[n].SysValue+'" name="'+e.labelName+'" fieldName="'+l+'" _radio="true"><i class="IC-rdo '+i+'" ',r+=' fieldName="'+l+'"  displayName="'+lmsform.changetoI18N(e.displayName)+'" name="'+e.labelName+'"  fieldVal="'+e.OptionsWithId[n].SysValue+'" value="'+e.OptionsWithId[n].Value+'"></i>'),"Self Paced Learning"==e.OptionsWithId[n].Value||"zp.lms.settings.SelfPaced"==e.OptionsWithId[n].Value?r+='<span class="PI_slf icn lv_bgclr10" fieldName="'+l+'" name="'+e.labelName+'" fieldVal="'+e.OptionsWithId[n].SysValue+'"></span><div><h5 fieldName="'+l+'" name="'+e.labelName+'" fieldVal="'+e.OptionsWithId[n].SysValue+'">'+lmsFormConstants.getValue(e.Options[n])+'</h5><p fieldName="'+l+'" name="'+e.labelName+'" fieldVal="'+e.OptionsWithId[n].SysValue+'">It is an employees analysis of their own performance.</p></div>':"Blended Learning"==e.OptionsWithId[n].Value||"zp.lms.settings.InstructorLed"==e.OptionsWithId[n].Value?r+='<span class="PI_ilt icn lv_bgclr3" fieldName="'+l+'" name="'+e.labelName+'" fieldVal="'+e.OptionsWithId[n].SysValue+'"></span><div><h5 fieldName="'+l+'" name="'+e.labelName+'" fieldVal="'+e.OptionsWithId[n].SysValue+'">'+lmsFormConstants.getValue(e.Options[n])+'</h5><p fieldName="'+l+'" name="'+e.labelName+'" fieldVal="'+e.OptionsWithId[n].SysValue+'">It is the feedback taken from other team members with whom an employee has worked with.</p></div>':"E-Material"!=e.OptionsWithId[n].Value&&"zp.lms.settings.DigitalDownloads"!=e.OptionsWithId[n].Value||(r+='<span class="PI_emtrl icn lv_bgclr5" fieldName="'+l+'" name="'+e.labelName+'" fieldVal="'+e.OptionsWithId[n].SysValue+'"></span><div><h5 fieldName="'+l+'" name="'+e.labelName+'" fieldVal="'+e.OptionsWithId[n].SysValue+'">'+lmsFormConstants.getValue(e.Options[n])+'</h5><p fieldName="'+l+'" name="'+e.labelName+'" fieldVal="'+e.OptionsWithId[n].SysValue+'">It is the feedback taken from other team members with whom an employee has worked with.</p></div>'),r+=3==t?'<span class="PI_tick2_fil" fieldName="'+l+'"  displayName="'+lmsform.changetoI18N(e.displayName)+'" name="'+e.labelName+'"  fieldVal="'+e.OptionsWithId[n].SysValue+'" value="'+e.OptionsWithId[n].Value+'"></span></div>':"<"+a+' fieldName="'+l+'" fieldVal="'+e.OptionsWithId[n].SysValue+'" name="'+e.labelName+'" >'+lmsFormConstants.getValue(e.Options[n])+"</h4></"+a+">"}return r+=3==t?"</div></div>":"</ul></div>"},getSimpleRadioButtonField:function(e){var t=e.autofillvalue?"IC-rdo zp_gclr":"IC-rdo";return'<i formId = "'+e.formComponentId+'" displayName="'+lmsform.changetoI18N(e.displayName)+'" dataMandatory="'+e.isMandatory+'" name="'+e.labelName+'" fieldName="radioChoice" class ="'+t+'" value="'+e.value+'"></i>'+(e.displayName?"<span>"+lmsform.changetoI18N(e.displayName)+"</span>":"")},bind:function(e){lmsform.Obj=lmsgroupmenu.initiate(lmsform.formref),lmsform.singleSelectItems=lmsform.formref.querySelectorAll('[type="single"]'),lmsform.multiSelectItems=lmsform.formref.querySelectorAll('[type="multi"]'),lmsform.selectItems=lmsform.formref.querySelectorAll('[_type="select"]'),lmsform.dateItems=lmsform.formref.querySelectorAll('[key="date"]'),lmsform.timeItems=lmsform.formref.querySelectorAll('[key="time"]'),lmsform.multiFileUploadItems=lmsform.formref.querySelectorAll('[fieldName="multiFileUpload"]'),lmsform.singleFileUploadItems=lmsform.formref.querySelectorAll('[fieldName="singleFileUpload"]'),lmsform.imageFieldItems=lmsform.formref.querySelectorAll('[fieldName="ImageField"]');for(var t=0;t<lmsform.selectItems.length;t++){var s="",r="",l=lmsform.selectItems[t].getAttribute("_name");lmsform.selectItems[t].querySelector('[_mode="single"]')?(s=lmsform.singleSelect,r="single"):(s=lmsform.multiselect,r="multi");var a=!1,n=1;l&&(a="disabled"!=s[l].createNew,n=s[l].flag,click=s[l].click,callback=s[l].callback,lmsform.Obj.insertMenu({elem:lmsform.selectItems[t].parentElement,type:"select",mode:r,allow_new:a,menulist:n?lmsform.selectMenuArray[l]:lmsform.fetchMembers,click:click?callback:""}))}for(t=0;t<lmsform.dateItems.length;t++){l=lmsform.dateItems[t].getAttribute("formid");var i=lmsform.defaultDate[l];i||((i=[]).startDate="",i.endDate=""),lmsform.Obj.insertMenu({elem:lmsform.dateItems[t],type:"date",dform:lmsbase._userDForm,range:[i.startDate,i.endDate],click:lmsform.dateMeta[l]?lmsform.dateMeta[l]._callback:""})}for(t=0;t<lmsform.timeItems.length;t++){l=lmsform.timeItems[t].getAttribute("formid");lmsform.Obj.insertMenu({elem:lmsform.timeItems[t],type:"time",tform:timeFormat,name:"time2",click:lmsform.timeMeta[l]?lmsform.timeMeta[l]._callback:""})}for(t=0;t<lmsform.multiFileUploadItems.length;t++){l=lmsform.multiFileUploadItems[t].getAttribute("formid");lmsformcomponents.invokeUploadManager(l)}for(t=0;t<lmsform.imageFieldItems.length;t++){l=lmsform.imageFieldItems[t].getAttribute("formid");lmsformcomponents.invokeUploadManager(l)}for(t=0;t<lmsform.singleFileUploadItems.length;t++){l=lmsform.singleFileUploadItems[t].getAttribute("formid");lmsformcomponents.invokeUploadManager(l)}if(null!=e){var o=e.querySelectorAll("input");for(t=0;t<o.length;t++)if(e.querySelectorAll("input")[t].autofocus){e.querySelectorAll("input")[t].focus();break}}else lmsform.autofocus();(o=lmsform.formref.querySelector('[_rel="scrollElement"]'))&&lmsform.Obj.scrollContainer(o)},textFun:function(e){var t=e.target.value.replace(/[\\!"$%^&\-\)\(*+_={};:'@#~,.\/<>\" "\?|`\]\[]/g,"");e.target.value=t},numberFun:function(e){var t=e.target,s=t.value.replace(/[\\A-Za-z!"$%^&\-\)\(*+_={};:'@#~,.\/<>\" "\?|`\]\[]/g,""),r=(t.min&&Number(t.min),t.max?Number(t.max):1/0);0==s?s="":s>r&&(s=r),e.target.value=s;var l=t.getAttribute("formid"),a=lmsform.numberItems[l];a&&a._callback&&a._callback(t)},convertTime12to24:function(e){var t=(e=e.split(" "))[0].split(":");return t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),e[1]?("am"==e[1]?12==t[0]&&(t[0]=0):(12==t[0]&&(t[0]=0),t[0]+=12),60*t[0]+t[1]):60*t[0]+t[1]},timeVallidate:function(e){var t=e.target,s=t.getAttribute("formid"),r=lmsform.timeMeta[s];r&&r._callback&&r._callback(t);var l=lmsform.formref.querySelector('[fieldName="startTime"]').value,a=lmsform.formref.querySelector('[fieldName="endTime"]').value;null!=a&&null!=l&&(lmsformcomponents.convertTime12to24(l)>=lmsformcomponents.convertTime12to24(a)&&lmsformcomponents.setEndTime(l))},timeVal12:function(e,t,s,r){var l=r?lmsmodule.popUp.querySelector('[_wrel="endTime_'+s+'"]'):lmsform.formref.querySelector('[fieldName="endTime"]');"pm"==e[1]?11==t[0]?l.value="11:59 pm":(t[1]=t[1]+30,t[1]>59&&(t[0]=t[0]+1,t[1]=t[1]-60),t[1]<10&&(t[1]="0"+t[1]),l.value=t[0]+":"+t[1]+" pm"):"am"==e[1]&&(11==t[0]?(t[1]=t[1]+30,t[1]>59&&(t[0]=t[0]+1,e[1]="pm"),t[1]=t[1]-60):(t[1]=t[1]+30,t[1]>59&&(t[0]++,t[0]>=13&&(t[0]-=12),t[1]=t[1]-60)),t[1]<10&&(t[1]="0"+t[1]),l.value=t[0]+":"+t[1]+" "+e[1])},timeVal24:function(e,t,s,r){var l=r?lmsmodule.popUp.querySelector('[_wrel="endTime_'+s+'"]'):lmsform.formref.querySelector('[fieldName="endTime"]');t[1]+=30,t[1]>59?(t[0]+=1,t[0]>23?l.value="23:59":(t[1]=t[1]-60,t[1]<10&&(t[1]="0"+t[1]),l.value=t[0]+":"+t[1])):(t[1]<10&&(t[1]="0"+t[1]),l.value=t[0]+":"+t[1])},setEndTime:function(e){var t=(e=e.split(" "))[0].split(":");t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),e[1]?lmsformcomponents.timeVal12(e,t):lmsformcomponents.timeVal24(e,t)},dateVallidate:function(){var e=lmsform.formref.querySelector('[fieldName="datefield"]'),t=lmsform.formref.querySelector('[fieldName="enddatefield"]'),s=new Date;if(null!=e&&null!=t){var r=new Date(e.value.parseDate(lmsbase._userDForm)),l=new Date(t.value.parseDate(lmsbase._userDForm));r.setHours(s.getHours()),r.setMinutes(s.getMinutes()),s.setHours(s.getHours()-1);var a=e.getAttribute("formid"),n=lmsform.dateMeta[a];n&&n._callback&&n._callback(r,s);var i=Calendar.formatDate(s);r.getTime()<s.getTime()&&60002831779!=_LOGGEDIN_ACCZSOID&&(e.value=i),e&&t&&r.getTime()>l.getTime()&&(t.value=e.value)}},onUploadsStart:function(){if(lmsform.formref){let e=lmsform.formref.querySelector('[fieldName="submitbutton"]');e&&(e.style="pointer-events:none;opacity:0.5;")}if(lmsform.formFtr){let e=lmsform.formFtr.querySelector('[fieldName="submitbutton"]');e&&(e.style="pointer-events:none;opacity:0.5;")}},onAllUploadsFinished:function(){if(lmsform.formref){var e=lmsform.formref.querySelector('[fieldName="submitbutton"]');e&&(e.style="pointer-events:all;opacity:1.0;")}if(lmsform.formFtr){let e=lmsform.formFtr.querySelector('[fieldName="submitbutton"]');e&&(e.style="pointer-events:all;opacity:1.0;")}}},lms_ui_switch=function(){function e(e,t){this.createNode(e,t)}function t(e){this.value=function(){return e.value()},this.toggleOn=function(){return e.toggleOn()},this.toggleOff=function(){return e.toggleOff()},this.toNode=function(){return e.toNode()}}return e.prototype.createNode=function(e,t){var s=document.createElement("div");s.className="zp_SFswtch";var r=document.createElement("input");r.className="cmn-toggle-small cmn-toggle-round-small",r.type="checkbox",r.checked=!1,this.input=r,s.appendChild(r),s.appendChild(document.createElement("span"));lmsbase.addListener(t||s,"click",(function(){r.checked=!r.checked,e&&e(r.checked)})),this.node=s},e.prototype.toggleOn=function(){this.input.checked=!0},e.prototype.toggleOff=function(){this.input.checked=!1},e.prototype.value=function(){return this.input.checked},e.prototype.toNode=function(){return this.node},{createSwitch:function(s,r){return new t(new e(s,r))}}}(),lms_ui_checkbox=function(){function e(){this.createNode()}function t(e){this.value=function(){return e.value()},this.toggleOn=function(){return e.toggleOn()},this.toggleOff=function(){return e.toggleOff()},this.getTextContainer,this.toNode=function(){return e.toNode()}}return e.prototype.createNode=function(){var e=document.createDocumentFragment(),t=document.createElement("i");t.className=(this.value,"zp_gclr"),this.i_tag=t,this.span_tag=document.createElement("span"),e.appendChild(t),e.appendChild(span_tag);var s=this;function r(){s.value()?s.toggleOff():s.toggleOn()}lmsbase.addListener(this.i_tag,"click",r),lmsbase.addListener(this.span_tag,"click",r),this.node=e},e.prototype.getTextContainer=function(e){return this.span_tag},e.prototype.toggleOn=function(){lmsbase.addClass(this.i_tag,"zp_gclr")},e.prototype.toggleOff=function(){lmsbase.removeClass(this.i_tag,"zp_gclr")},e.prototype.value=function(){lmsbase.hasClass(this.i_tag,"zp_gclr")},e.prototype.toNode=function(){return this.node},{createCheckbox:function(){return new t(new e)}}}(),lmstrainers={root:null,popup:null,luFcIds:[],refer:{index:1,timeout:null},inforefer:{index:1,timeout:null},moreMenuLst:[{del:["Delete"]}],trainersAdded:[],lastRequestParams:null,thours:0,filterMode:!1,trainerQuickAddID:"",trainerData:null,formData:null,optionvalue:[],barValue:[],sortByMode:0,empStatusMode:0,appliedFilter:{},IdMappingToParam:{sortByTrainer:"sortBy",empStatusTrainer:"empStatus"},valueToText:{sortBy:{1:ZPI18N.getString("zp.lms.AtoZ"),2:ZPI18N.getString("zp.lms.ZtoA")},empStatus:{1:ZPI18N.getString("zp.lms.active"),2:ZPI18N.getString("zp.inactive")}},initiate:function(){"hash"==this.type?lmstrainers.hashMode(this):lmstrainers.quesMode(this)},hashMode:function(e){"add"==e.mode&&(lmstrainers.reInitialise(),lmstrainers.layoutConstruction(e),lmstrainers.initObj=e,lmstrainers.getTrainers())},quesMode:function(e){lmstrainers.validateHashParamsObject(e.module,e.hashObject)?(lmstrainers.popup=e.elem,lmstrainers.trainerInfo(e.hashObject.level1)):(lmsbase.closeQHash(),lmsbase.removeQHash())},validateHashParamsObject:function(e,t){return void 0===t.level2&&!!("trainerinfo"==e&&t.level1&&t.level1>0&&t.level1<=0x8000000000000000)},layoutConstruction:function(e){lmstrainers.root=e.elem,e.elem.innerHTML="";var t=e.elem.appendChild(document.createElement("div"));t.className="zp_header zp_CChgt",t.innerHTML='<div class="zp_hdtit"><h2><font>'+e.tabObject+'</font></h2></div><div class="zp_frt zp_micn"><div class="zp_btn"><button class="zpthm" _rel="add">'+ZPI18N.getString("zp.lms.trainers.AddTrainers")+'</button></div></div><div class="zp_CCcat"><div><div id="trainerfilter"><div class="zp_Sm " id="sortBy"></div><div class="zp_Sm " id="empStatus"></div><i class="IC-reset-01" onclick="lmstrainers.reset()"></i></div></div></div></div></div></div>';var s=e.elem.appendChild(document.createElement("div"));s.className="zp_cwrap",s.innerHTML='<div class="zp_Lstwrap zp_Ttra" _rel="trlst" id="trainersList"></div>';var r=e.elem.appendChild(document.createElement("div"));r.className="zp_fltrs",r.innerHTML='<div class="zp_Lttl"></div>',lmstrainers.elem=document.getElementById("trainersList"),lmsbase.addListener(lmstrainers.root,"click",lmstrainers.handle,!1),lmstrainers.elem.appendChild(zplms.getLoadingBarElement()),lmstrainers.filterBind(event)},filterBind:function(e){lmstrainers.menuObj=lmsgroupmenu.initiate(document.getElementById("trainerfilter")),lmstrainers.getOptions(this,e,"sortBy"),lmstrainers.getOptions(this,e,"empStatus")},getOptions:function(e,t,s,r){var l={},a=document.getElementById(s);if("sortBy"==s)(n=[]).push(ZPI18N.getString("zp.lms.AtoZ")),l[1]=n,(i=[]).push(ZPI18N.getString("zp.lms.ZtoA")),l[2]=i,lmstrainers.createMenu(l,a,r,ZPI18N.getString("zp.lms.sortby"));else if("empStatus"==s){var n,i;(n=[]).push(ZPI18N.getString("zp.lms.active")),l[1]=n,(i=[]).push(ZPI18N.getString("zp.inactive")),l[2]=i,lmstrainers.createMenu(l,a,r,ZPI18N.getString("zp.employeestatus"))}},createMenu:function(e,t,s,r){lmstrainers.menuObj.insertMenu({elem:t,type:"select",mode:"single",menulist:e,click:lmstrainers.filterSearch}),lmsmenu.changeToSelectMenu(t,{},"single",null,r)},filterSearch:function(){lmstrainers.refer.index=1,lmstrainers.getTrainers()},reset:function(){lmstrainers.refer.index=1,lmstrainers.layoutConstruction(lmstrainers.initObj),lmstrainers.getTrainers()},scrollHandle:function(){"end"!=lmstrainers.refer.index&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&lmstrainers.getTrainers()},getTrainers:async function(e,t,s,r){lmsnewsettings.refer.index=2==t||3==t?1:lmsnewsettings.refer.index;var l={startIndex:1==t?lmsnewsettings.refer.index:lmstrainers.refer.index};if(r)l=r;else{let e=s&&0!=Object.keys(s)?s.appliedFilters:{};var a=1==t||2==t||3==t?0:document.getElementById("sortBy").querySelector('[class="zp_Tglst ntxt"]'),n=1==t||2==t||3==t?0:document.getElementById("empStatus").querySelector('[class="zp_Tglst ntxt"]');e.hasOwnProperty("sortByFil")&&e.sortByFil.selectedvalues[0]&&(2==t||3==t)&&(a=e.sortByFil.selectedvalues[0].value),e.hasOwnProperty("empStatusFil")&&e.empStatusFil.selectedvalues[0]&&(2==t||3==t)&&(n=e.empStatusFil.selectedvalues[0].value),lmstrainers.filterMode=!!s&&0!=Object.keys(s.appliedFilters).length,lmstrainers.sortByMode=a,lmstrainers.empStatusMode=n,l.sortBy=lmstrainers.sortByMode,l.empStatus=lmstrainers.empStatusMode}lmstrainers.lastRequestParams=l;let i=await new Promise(((e,t)=>{try{zplms.get("/lms/trainers",l,(t=>{e(t)}))}catch(e){t(e)}}));if(null!=e&&(0!=settingsPage.container.find('[rel="getTrainers"]').length&&1==lmsnewsettings.refer.index&&settingsPage.container.find('[rel="getTrainers"]').remove(),e(i[1]),1==t||2==t))return i[1];var o=lmstrainers.refer.index;lmstrainers.trainerData=i[1],lmstrainers.listTrainers(i[1]||[],1==o?"new":"update");var c=lmstrainers.elem.querySelector('[_rel="trainernextpage"]');if(c&&c.remove(),i[1]&&25==i[1].length){if(c=lmstrainers.elem.querySelector('[_crel = "nextpage"]'))c.setAttribute("_rel","trainernextpage");else if(!lmstrainers.elem.querySelector('[_rel="trainernextpage"]')&&"end"!=lmstrainers.refer.index){lmstrainers.elem.innerHTML+='<div class="zp_memarw" _crel = "nextpage" _rel="trainernextpage"><div class="zp_anc">Load more records...</div></div>'}}else lmstrainers.refer.index="end"},closeFilters:function(e){lmstrainers.getTrainers(lmsnewsettings.getTrainers.constructTrainers,3,lmstrainers.IdMappingToParam[e])},resetAppliedFilters:function(){lmsnewsettings.getTrainers.reset(0)},listTrainers:function(e,t){lmstrainers.trainersAdded=e;var s="";if(null!=lmstrainers.root){s=lmstrainers.root.querySelector("[_rel=trlst]"),"new"==t&&(e.length>0?lmsnodata.clearNoData(s):lmsnodata.showNoData({mode:"general",container:s,module:"Trainers",content:ZPI18N.getString("zp.lms.trainers.toaddtrainers",["lmstrainers.addTrainersPopup()"])}));for(var r=document.createDocumentFragment(),l=0;l<e.length;l++)r.appendChild(lmstrainers.getTrainerCard(e[l]));s.appendChild(r),lmstrainers.refer.index=25==e.length?lmstrainers.refer.index+25:"end"}},getTrainerCard:function(e){var t=document.createElement("div");t.className="zp_CUlst",t.setAttribute("_trnrId",e.trainerId),t.innerHTML='<i class="IC-mre" data-ttip="'+ZPI18N.getString("zp.lms.more")+'" _rel="more"></i><div class="ZP_photo"><img src='+e.trainerImage+'></div><h4 data-ttip="'+e.trainerEmployeeId+" - "+e.trainerName+'"><i>'+e.trainerEmployeeId+"</i>"+e.trainerName+"</h4>";for(var s='<div class="ZPmrate ML0I">',r=0;r<5;r++)e.trainerStars>r?s+='<div class="IC-star FL S13 gry CP ylw"></div>':s+='<div class="IC-star FL S13 gry CP"></div>';return s+="</div>",t.innerHTML+=s,t},trainerInfoPopup:function(e){lms.changeHash("ques","trainerinfo/"+e,"disable"),lmstrainers.popup=lmsbase.openQHash(),lmstrainers.inforefer.index=1,lmstrainers.trainerInfo(e)},trainerInfo:function(e,t){lmstrainers.trainerId=e,lmsreports.fday=Calendar.formatDate(lmsreports.getFirstDay()),lmsreports.lday=Calendar.formatDate(lmsreports.getLastDay());var s={courseFilter:"progress",firstDay:lmsreports.fday,lastDay:lmsreports.lday,startIndex:lmstrainers.inforefer.index};zplms.get("/lms/trainers/"+e,s,(function(t){lmstrainers.constructTrainerInfo(t,e)}))},constructTrainerInfo:function(e,t){var s=e[1];if(1===lmstrainers.inforefer.index){var r=lmstrainers.getinfoheader(s,t);lmstrainers.popup.innerHTML=r,lmstrainers.infoelem=document.getElementById("active"),lmsbase.addListener(lmstrainers.infoelem,"click",lmstrainers.handle,!1),lmstrainers.constructInfoBody(s)}else lmstrainers.constructInfoBody(s);(null==s.activeCourseList||null!=s.activeCourseList&&0==s.activeCourseList.length)&&lmsnodata.showNoData({mode:"general",container:document.getElementById("active"),module:"trainers",content:ZPI18N.getString("zp.lms.course.coursenocourse")}),lmstrainers.thours&&lmsreports.setBar(lmstrainers.optionValue,lmstrainers.barValue,"trainerReport",void 0,"trainerReports");var l=lmstrainers.infoelem.querySelector('[_rel="trainerinfonextpage"]');if(l&&l.remove(),e[1]&&50==e[1].activeCourseList.length){if(l=lmstrainers.infoelem.querySelector('[_crel = "infonextpage"]'))l.setAttribute("_rel","trainerinfonextpage");else if(!lmstrainers.infoelem.querySelector('[_rel="trainerinfonextpage"]')&&"end"!=lmstrainers.inforefer.index){lmstrainers.infoelem.innerHTML+='<div class="zp_memarw" _crel = "infonextpage" _rel="trainerinfonextpage"><div class="zp_anc">Load more records...</div></div>'}lmstrainers.inforefer.index=lmstrainers.inforefer.index+50}else lmstrainers.inforefer.index="end"},getinfoheader:function(e,t){for(var s='<div class="zp_pvhd" id="phead"><div class="zp_mark"><span> '+ZPI18N.getString("zp.lms.trainers.TrainerDetails")+'</span></div><div class="zp_micn"><ul><li  id=""><b class=""><span><i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'" onclick=lmstrainers.closepreview()></i></span></b></li></ul></div></div><div class="zp_pcnt"><div class="zp_CPcnt"><div class="zp_CPlt"><div class="ZP_photo" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src='+e.trainerImage+"></div><h4><i>"+e.trainerEmployeeId+"</i>"+e.trainerName+"</h4>",r='<div class="ZPmrate ML0I">',l=0;l<5;l++)e.overallTrainerRating>l?r+='<div class="IC-star FL S20 gry CP ylw"></div>':r+='<div class="IC-star FL S20 gry CP"></div>';s+=r+="</div><br/><br/>",s+='<ul> <li class="zp_btnFloating"><i class="CR-cmsg S17" uid="'+e.trainerZuid+'" ischat="true" onclick="ZPeople.initUserChat(event, '+e.trainerZuid+')"><i class="path1"></i><i class="path2"></i></i></li></ul>',s+="</div>",null==e.aboutme&&(e.aboutme="");return null!=e.activeCourseList&&e.activeCourseList.length,null!=e.completedCourseList&&e.completedCourseList.length,s+='</div><div><div class="zp_CPbx">',""!=e.aboutme&&(ZPI18N.getString("zp.aboutme"),e.aboutme),s+='<div><div class="zp_Tabs"><ul class=""><li class="sel" id="active_lms" onclick="lmstrainers.showActive(this)">'+ZPI18N.getString("zp.lms.trainers.Courses")+"</li>",s+="</ul></div>",s+='<div class="zp_navtog" id="active"></div></div></div>'},constructInfoBody:function(e){var t="";null!=e.activeCourseList&&0!=e.activeCourseList.length&&($.each(e.activeCourseList,(function(e,s){s.startDate=null!=s.batchStartDate?s.batchStartDate:"",null==s.duration&&(s.duration=0),s.courseImageInfo.additionalInfo={fileId:s.courseId,type:6};var r=s.courseImageInfo.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+s.courseImage+".svg"):lmsfileaction.generateSourceURL(s.courseImageInfo);t+='<ul class="zp_CPlst"><li><div class="ZP_photo" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src='+r+"> </div><h4>"+s.courseName+"</h4>",t+="<span>"+s.startDate+"</span><a>"+s.trainerCompleteCount+"/"+s.totalSessionCount+" "+ZPI18N.getString("zp.lms.base.Sessions")+"</a>","1"==s.courseType&&s.duration&&(t+="<span>"+s.durationVal+" "+lmsform.changetoI18N(s.durationType)+"</span>"),t+="</li> </ul>"})),document.getElementById("active").innerHTML+=t)},showActive:function(){lmstrainers.popup.querySelector("#active").classList.remove("DN"),lmstrainers.popup.querySelector("#complete").classList.add("DN"),lmstrainers.popup.querySelector("#active_lms").classList.add("sel"),lmstrainers.popup.querySelector("#complete_lms").classList.remove("sel")},scrollWin:function(e){var t=lmstrainers.popup.querySelector(".zp_pcnt").scrollHeight;0==e?lmstrainers.popup.querySelector(".zp_pcnt").animate({scrollTop:"0px"},500):lmstrainers.popup.querySelector(".zp_pcnt").animate({scrollTop:t},500)},closepreview:function(){lmstrainers.inforefer.index=1,lmsbase.closeQHash(),lmstrainers.popup.classList.add("DN")},moreMenu:function(e,t,s){lmsmenu.initiate({elem:e,width:"130px",type:"dropdown",arrowHead:!0,menulist:lmstrainers.moreMenuLst,eve:t}).on("click",(function(){var e=this.referObj.elem.closest("[_trnrid]").getAttribute("_trnrid");"del"==this.value&&lmstrainers.deleteTrainerOnConfirmation(e,s)})).bind()},deleteTrainerOnConfirmation:function(e,t){var s=ZPI18N.getString("zp.lms.settings.TrainerM");lmsnotify.show({header:ZPI18N.getString("zp.lms.entitydelete",[s]),body:ZPI18N.getString("zp.lms.permenentlydelEntity",[s]),button_text:ZPI18N.getString("zp.lms.delete"),texttype:"negative",successCallback:function(){this.status&&lmstrainers.deleteTrainer(t)},cancelCallback:function(){}})},deleteTrainer:function(e){zplms.delete("/lms/trainers/"+trainerId,null,(function(t){if("success"==t[1].status){var s=0,r=1==e?document.querySelector("[_trnrId='"+t[1].trainerId+"']"):lmstrainers.root.querySelector("[_rel='trlst'] [_trnrId='"+t[1].trainerId+"']");r.parentNode.removeChild(r),lmstrainers.isNoDataReq();for(var l=0;l<lmstrainers.trainersAdded.length;l++)void 0!==lmstrainers.lastRequestParams.trainers&&lmstrainers.lastRequestParams.trainers[s]===lmstrainers.trainersAdded[l].trainerempId&&(s++,lmstrainers.lastRequestParams.trainers.splice(lmstrainers.lastRequestParams.trainers.indexOf(lmstrainers.params.trainerempId),1)),lmstrainers.trainersAdded[l].trainerId===lmstrainers.params.trainerId&&delete lmstrainers.trainersAdded[l];ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.trainers.deleteMsg"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.trainers.unableDeleteMsg"))}))},addTrainersPopup:function(){lmstrainers.popup=lmsbase.showMaskLayer();var e='<div class="zp_popup" style="width:600px;"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.trainers.AddTrainers")+'</font><i class="IC-cls" _rel="close"></i></div><div class="zp_Pocnt" style="max-height:700px;"><div _rel="employeeMenu">'+lmsformcomponents.htmlField({formComponentId:"employeeIds",fieldType:25,emptyText:ZPI18N.getString("zp.select")})+'</div></div><div class="zp_btn"><button class="zpthm" _rel="add">'+ZPI18N.getString("zp.lms.add")+"</button></div></div>";lmstrainers.popup.innerHTML=e,lmsbase.addListener(lmstrainers.popup,"click",lmstrainers.clickActionPopup,!1);var t=lmstrainers.popup.querySelector('[_rel="employeeMenu"]');lmstrainers.menuRef=lmsgroupmenu.initiate(t),lmstrainers.menuRef.insertMenu({elem:t.querySelector(".zp_Sm"),type:"select",mode:"multi",allow_new:!1,menutype:2,menulist:lmstrainers.fetchNonTrainers})},clickActionPopup:function(e){var t=e.target.getAttribute("_rel");"add"==t?lmstrainers.getSelectedTrainers():"close"==t&&lmstrainers.popupClose()},popupClose:function(){lmstrainers.popup.innerHTML="",lmsbase.hideMaskLayer(),lmsbase.removeListener(lmstrainers.popup,"click",lmstrainers.clickActionPopup,!1),lmstrainers.popup=null,lmsgroupmenu.destroy(lmstrainers.menuRef),lmstrainers.menuRef=null},fetchNonTrainers:function(){lmstrainers.menuCallBack=this,null!=this.value?lmstrainers.getSearchComponents(lmstrainers.menuAction,this.value):(lmstrainers.luFcIds=[],lmstrainers.getFormComponents(lmstrainers.menuAction))},getFormComponents:function(e,t){var s={formId:lmsbase.trainerFormId,mode:"getFormComponents",conreqcsr:csrfToken};return new Promise(((r,l)=>{try{zplms.post("/formAction.zp",s,(s=>{e(s,null,t),r()}))}catch(e){l(e)}}))},getSearchComponents:function(e,t){var s={formId:lmsbase.trainerFormId,mode:"fetchFormLookupOtions",luFcIds:JSON.stringify(lmstrainers.luFcIds),searchtxt:t,conreqcsr:csrfToken};$.post("/formAction.zp",s,e)},menuAction:function(e,t,s){var r=[];7e3==e.code?lmstrainers.luFcIds.length>0?null!=e.message?(lmstrainers.formData=e,r=e.message[lmstrainers.luFcIds]):r=[]:(lmstrainers.luFcIds=[],lmstrainers.formData=e,r=[],r=e.message.formComponentDetails[0].column1[0].Options?e.message.formComponentDetails[0].column1[0].Options:e.message.formComponentDetails[0].column1[0].AddOptions,lmstrainers.luFcIds.push(e.message.formComponentDetails[0].column1[0].formComponentId)):r=[];for(var l=[],a=0;a<lmstrainers.trainersAdded.length;a++)void 0!==lmstrainers.trainersAdded[a]&&(l[a]=lmstrainers.trainersAdded[a].trainerempId);1==s?lmsnewsettings.trainerData=r:(lmstrainers.menuCallBack&&lmstrainers.menuCallBack.updateOptionList(function(e,t,s){for(var r={},a=[],n="",i=0;i<e.length;i++)a=[],n=ZPeople.getUserDisplayName(e[i][s].EMPLOYEEFIRSTNAME,e[i][s].EMPLOYEELASTNAME),a.push(e[i][s].EMPLOYEEID,n,""),r[e[i][t]]=a;for(i=0;i<l.length;i++)r[l[i]]&&delete r[l[i]];return r}(r,"Id","LookupValue"),lmstrainers.menuCallBack.inputvalue),lmstrainers.menuCallBack=null)},getSelectedTrainers:function(){var e=lmstrainers.popup.querySelectorAll("[_name=employeeIds] [data-value]");if(e.length){var t,s={},r=[];for(t=e.length-1;t>=0;t--)r[t]=e[t].getAttribute("data-value"),s[r[t]]=r[t];lmsnotes.isRequestDuplicate({trainers:r},lmstrainers.lastRequestParams)?lmstrainers.addTrainers(s):lmstrainers.setResponseMessage(ZPI18N.getString("zp.lms.trainers.AlreadyTrainers"))}else lmstrainers.setResponseMessage(ZPI18N.getString("zp.lms.trainers.selectSomeone"))},addTrainers:function(e,t){var s={trainersList:JSON.stringify(e)};zplms.post("/lms/trainers",s,(function(e){1==t?"success"==e[1].status?(lmsnewsettings.getTrainers.cancelTrainer(),lmsnewsettings.getTrainers.init(),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.trainers.TrainerSuccess"))):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.trainers.AlreadyTrainers")):"success"==e[1].status?(lmssessions.formComponents=null,lmstrainers.popupClose(),lmstrainers.refer.index=1,lmstrainers.getTrainers(),lms.allTrainerData=null,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.trainers.TrainerSuccess"))):lmstrainers.setResponseMessage(ZPI18N.getString("zp.lms.trainers.AlreadyTrainers")),"success"==e[1].status?(lmstrainers.popupClose(),lmstrainers.refer.index=1,lmstrainers.getTrainers(),lms.allTrainerData=null,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.trainers.TrainerSuccess"))):lmstrainers.setResponseMessage(ZPI18N.getString("zp.lms.trainers.AlreadyTrainers"))}))},setResponseMessage:function(e){var t=lmstrainers.popup.querySelector("[_name=employeeIds]");lmsbase.addClass(t,"zp_err"),lmstrainers.popup.querySelector("[_name=employeeIds]~[errMsg]").textContent="*"+e,window.clearTimeout(lmstrainers.refer.timeout),lmstrainers.refer.timeout=window.setTimeout((function(){var e=lmstrainers.popup.querySelector("[_name=employeeIds]");lmsbase.removeClass(e,"zp_err"),lmstrainers.popup.querySelector("[_name=employeeIds]~[errMsg]").textContent=""}),1500)},viewfilter:function(){var e=lmstrainers.root.querySelector(".zp_fltrs");lmsfilter.create("add",{target:e,container:"",items:[{name:"skllst",title:"Skill set",datalist:{css:["CSS","IC-tck"],html:["HTML","IC-tck"]},mode:"multi",type:"select",emptyText:"Select",labelicon:"IC-tck"},{name:"cn",title:"Courses",datalist:{java:["JAVA","IC-tck"],cpp:["C++","IC-tck"]},mode:"single",type:"select",emptyText:"Select",labelicon:"IC-tck"},{name:"sb",title:"SortBy",datalist:{rating:["High rating","IC-tck"],exp:["High experience","IC-tck"]},mode:"single",type:"select",emptyText:"Select",labelicon:"IC-tck"}],search:!0},!0).on("change",(function(){})).on("apply",(function(){params={start:ZPTraining.startindex,conreqcsr:csrfToken,method:"getTrainerswithfilter"};var e=this.filterObject;e.searchStr&&e.searchStr.length>0&&(params.name=e.searchStr),e.skllst&&(params.skillSet=e.skllst.toString()),e.cn&&(params.courseId=e.cn.toString()),e.sb&&(params.sortBy=e.sb[0]),$.post("/trainingAction.zp",params,(function(e){lmstrainers._listObject=e[1]||[],lmstrainers.listTrainers()}))})).on("close",(function(){})).on("clear",(function(){lmstrainers.getTrainers()})).bind()},handle:function(e){var t=e.target,s=t.getAttribute("_rel");if("add"==s)lmstrainers.addTrainersPopup();else if("fltr"==s)lmstrainers.viewfilter();else if("more"==s)lmstrainers.moreMenu(t,e);else if(t.closest('[_crel="nextpage"]'))lmstrainers.getTrainers();else if(t.closest('[_crel="infonextpage"]'))lmstrainers.trainerInfo(lmstrainers.trainerId);else{var r=t.closest("[_trnrId]");if(r){var l=r.getAttribute("_trnrId");lmstrainers.trainerInfoPopup(l)}}},isNoDataReq:function(){var e=lmstrainers.root.querySelector("[_rel=trlst]");e.childNodes.length||lmsnodata.showNoData({mode:"ondelete",container:e,module:"Trainers",content:ZPI18N.getString("zp.lms.trainers.toaddtrainers",["lmstrainers.addTrainersPopup()"])})},reInitialise:function(){lmstrainers.root=null,lmstrainers.popup=null,lmstrainers.formData=null,lmstrainers.lastRequestParams={},lmstrainers.refer={index:1,timeout:null}},close:function(){lmsbase.removeListener(lmstrainers.root,"click",lmstrainers.handle,!1),lmstrainers.reInitialise()},addSessiontrainerToMeeting:function(e){var t={action:"addTrainertoMeeting",trainerId:e.value,conreqcsr:csrfToken};$.post("/trainerAction.zp",t,(function(e){e[1].error?lmssessionform.dontallowTrainer=!0:lmssessionform.dontallowTrainer=!1}))},fetchTrainers:function(e,t,s,r,l,a){var n="/lms/courses/"+e+(t?/batches/+t:"")+"/trainers";zplms.get(n,{search:s,startIndex:r},l,a)}},lmsrooms={root:null,scrollElem:null,popup:null,refer:{index:1},_rfr_popup:{roomId:""},facility_refer:{startIndex:1,params:null,isClicked:!1},initiate:function(){"hash"==this.type?lmsrooms.hashMode(this):lmsrooms.quesMode(this)},hashMode:function(e){if("add"==e.mode){lmsrooms.reInitialise(),lmsrooms.layoutConstruction(e);var t=lmsrooms.addLoading();lmsrooms.root.querySelector("#roomsList").appendChild(t),lmsrooms.getRoomDetails()}},quesMode:function(e){if(lmsrooms.validateQuesParamsObject(e.module,e.hashObject))if("roominfo"==e.module)lmsrooms._rfr_popup.roomId=e.hashObject.level1,lmsrooms.addorRemoveSelClass(lmsrooms._rfr_popup.roomId),lmsrooms.viewRoom();else if("editroom"==e.module){lmsrooms.popup=e.elem,lmsrooms.constructFormHeader(e.module);var t=e.hashObject.level1;lmsrooms.editRoom(t)}else lmsrooms.popup=e.elem,lmsrooms.constructFormHeader(e.module),lmsrooms.addRoom();else lmsbase.closeQHash(),lmsbase.removeQHash()},validateQuesParamsObject:function(e,t){return void 0===t.level2&&("addroom"==e&&""==t.level1||(!!("editroom"==e&&t.level1&&t.level1>0&&t.level1<=0x8000000000000000)||!!("roominfo"==e&&t.level1&&t.level1>0&&t.level1<=0x8000000000000000)))},layoutConstruction:function(e){lmsrooms.root=e.elem,e.elem.innerHTML="";var t=e.elem.appendChild(document.createElement("div"));t.className="zp_header",t.innerHTML='<div class="zp_hdtit"><h2><font>'+e.tabObject+'</font></h2></div><div class="zp_frt zp_micn"><div class="zp_btn"><button class="zpthm" _rel="addRoom" >'+ZPI18N.getString("zp.lms.rooms.addrooms")+'</button></div><ul><li><b><span><i class="IC-custom" _rel="facilities" data-ttip="'+ZPI18N.getString("zp.lms.rooms.addfacility")+'"></i></span></b></li></ul></div>';var s=e.elem.appendChild(document.createElement("div"));s.className="zp_cwrap",s.innerHTML='<div class="zp_Lstwrap zp_Troom" id="roomsList"></div>',lmsrooms.scrollElem=e.elem.querySelector(".zp_Lstwrap"),lmsbase.addListener(e.elem,"click",lmsrooms.roomsHandle,!1),lmsbase.addListener(lmsrooms.scrollElem,"scroll",lmsrooms.scrollHandle,!1)},roomsHandle:function(e){var t=e.target,s=t.getAttribute("_rel");if("addRoom"==s)lmsrooms.addorRemoveSelClass(),lmsrooms.getPopup("addroom");else if("more"==s)lmsrooms.moreMenuOptions(t,e);else if("facilities"==s)lmsrooms.showFacilityPopup();else{var r=t.closest(".zp_Lst[roomId]");if(r){var l=r.getAttribute("roomId");l!=lmsrooms._rfr_popup.roomId&&(lmsrooms.addorRemoveSelClass(),lmsbase.addClass(r,"sel"),lmsrooms._rfr_popup.roomId=l,lmsrooms.viewRoom())}}},scrollHandle:function(){"end"!=lmsrooms.refer.index&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&lmsrooms.getRoomDetails()},facilityScrollHandle:function(){"end"!=lmsrooms.facility_refer.startIndex&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&lmsrooms.getFacilities()},getRoomDetails:function(){lmsrooms.refer;var e={method:"getRoomsDetails",start:lmsrooms.refer.index,conreqcsr:csrfToken};$.post("/roomAction.zp",e,(function(e){var t=lmsrooms.refer.index;lmsrooms.roomsView(e[1]||[],1==t?"new":"update")}))},roomsView:function(e,t){lmsrooms.removeLoading();var s=document.getElementById("roomsList");"new"==t&&(e.length>0?lmsnodata.clearNoData(s):lmsnodata.showNoData({mode:"general",container:s,module:"Rooms",content:ZPI18N.getString("zp.lms.base.toaddrooms",["\"lms.changeHash('ques', 'addroom')\""])}));for(var r=0;r<e.length;r++){var l=lmsrooms.getRoomCard(e[r]);s.appendChild(l);var a=e[r].ROOMFC;if(a.length>0)for(var n=0,i=l.querySelector('[_rel="fac"]'),o=0;o<a.length;o++){var c=document.createElement("label");if(c.innerHTML=lmsform.changetoI18N(a[o].FC),c.setAttribute("_rel","facility"+o),i.appendChild(c),n+=c.offsetWidth,o==a.length-1&&n<=i.offsetWidth)break;if(n+150>=i.offsetWidth){var d=document.createElement("span");d.innerHTML="+"+(a.length-o)+" more",i.replaceChild(d,i.querySelector("[_rel=facility"+o+"]"));break}}}if(25==e.length){lmsrooms.refer.index+=10;var m=lmsrooms.addLoading();s.appendChild(m)}else lmsrooms.refer.index="end"},getRoomCard:function(e){var t=document.createElement("div");t.className="zp_Lst "+(e.roomId==lmsrooms._rfr_popup.roomId?"sel":""),t.setAttribute("roomId",e.roomId);var s=e.ROOMFC,r='<div><div class="zp_Llft">'+lmsrooms.getRoomDP(e)+'</div><div class="zp_Ldtl"><div class="zp_Tdts"><h3>'+e.roomName+'</h3><div><i class="IC-loc"></i><em>'+e.locationName+"</em>"+(e.pvenue?'<em class="zp_ldot">'+e.pvenue+"</em>":"")+"</div>";return s.length>0&&(r+='<div _rel="fac">',r+="</div>"),r+="</div></div>",r+='<div class="zp_Lfrm">'+e.roomcapacity+"</div>",r+='<div class="zp_Lrgt"><i class="IC-mre" data-ttip='+ZPI18N.getString("zp.more")+' _rel="more"></i></div>',t.innerHTML=r,t},getRoomDP:function(e){var t="";if(e.roomImageInfo&&!lmsnewsettings.getRooms.checkIfTheExtensionIsUnSupported(e.roomImageInfo.extension))e.roomImageInfo.additionalInfo={fileId:e.Id,type:4},src=lmsfileaction.generateSourceURL(e.roomImageInfo),t='<div class="ZP_photo pc"><img src='+src+"></div>";else{var s=ZPeople.decodeTxt(e.roomName),r=(s=s.replace("<","").replace(">","")).length%10,l=s.match(/\b[a-z0-9]/gi);l=l||[];var a=s.charAt(0);l[1]?(a+=l[1],a+=l[2]||""):(a+=s.charAt(1),a+=s.charAt(2)),t='<div class="ZP_photo pc'+r+'">'+a+"</div>"}return t},getRoomCapacity:function(e){var t={method:"getRoomsDetails",recordId:$(e).val(),start:ZPTraining.startindex,conreqcsr:csrfToken};$.post("/roomAction.zp",t,(function(e){null!=e[1]&&$.each(e[1],(function(e,t){Layout.Page.container.find("#zp_form_container").find("div[folabel='Registration_Count']").find("input").val(t.roomcapacity)}))}))},getPopup:function(e,t){var s=e+(t?"/"+t:"");lms.changeHash("ques",s,"disable"),lmsrooms.popup=lmsbase.openQHash(),lmsrooms.constructFormHeader(e),"addroom"==e?lmsrooms.addRoom():lmsrooms.editRoom(t)},constructFormHeader:function(e){lmsrooms.popup.innerHTML="";var t=document.createDocumentFragment(),s=t.appendChild(document.createElement("div"));s.className="zp_pvhd",s.innerHTML='<div class="zp_mark"><span>'+("facilities"==e?ZPI18N.getString("zp.lms.rooms.facilities"):"editroom"==e?ZPI18N.getString("zp.lms.rooms.editroom"):ZPI18N.getString("zp.lms.rooms.addroom"))+'</span></div><div class="zp_micn"><ul><li><b><span><i class="IC-cls" _rel="close" data-ttip='+ZPI18N.getString("zp.close")+"></i></span></b></li></ul></div>";t.appendChild(lmsrooms.addLoading());lmsrooms.popup.appendChild(t)},addRoom:function(){lmsrooms.addorRemoveSelClass(),lmsrooms.formData?lmsrooms.constructFields(lmsrooms.formData):lmsrooms.getFormComponents(lmsrooms.constructFields)},editRoom:function(e){lmsrooms._rfr_popup.roomId=e,lmsrooms.formsComponentValues[e]?(lmsrooms.addorRemoveSelClass(e),lmsrooms.constructValuesforFields(lmsrooms.formData,lmsrooms.formsComponentValues[e])):lmsrooms.getSingleRecordValues(e)},getFormComponents:function(e,t){var s={formId:lmsbase.roomFormId,mode:"getFormComponents",conreqcsr:csrfToken};$.post("/formAction.zp",s,(function(s){if(7e3==s.code)lmsrooms.formData=s,e(lmsrooms.formData,t);else{lmsrooms.removeLoading();var r=document.createElement("div");r.className="col-lg-12 text-center",r.innerHTML='<div class="PArds"></div><h2 class="ZPNdt">'+s.message+"</h2></div>",lmsrooms.popup.appendChild(r)}}))},getSingleRecordValues:function(e){var t={mode:"fetchSingleRecord",formId:lmsbase.roomFormId,recordId:e,isApprovalEnabled:!1,conreqcsr:csrfToken};$.post("/formAction.zp",t,(function(t){if(7e3==t.code)t.recordId=e,lmsrooms.addorRemoveSelClass(e),lmsrooms.formsComponentValues[e]=t,lmsrooms.constructValuesforFields(lmsrooms.formData,t);else{lmsrooms.removeLoading(),lmsrooms.addorRemoveSelClass();var s=document.createElement("div");s.className="col-lg-12 text-center",s.innerHTML='<div class="PArds"></div><h2 class="ZPNdt">'+t.message+"</h2></div>",lmsrooms.popup.appendChild(s)}}))},addorRemoveSelClass:function(e){if(lmsrooms.root){var t=lmsrooms.root,s=t.querySelector("#roomsList .sel[roomId]");if(s&&s.getAttribute("roomId")==e)return;s&&lmsbase.removeClass(s,"sel"),e&&(s=t.querySelector("#roomsList [roomId='"+e+"']"))&&lmsbase.addClass(s,"sel")}},constructFields:function(e,t){lmsform.currentFormId=e.formDetails.formId,lmsrooms.removeLoading();var s=e.formDetails,r=e.message.formComponentDetails[0].column1,l=t?t.message.recordDetails[0].column1:{};l.length>0&&(l[4].componentValue.additionalInfo={fileId:lmsrooms._rfr_popup.roomId,type:4});var a=lmsform.initiate();mode=t?1:0;var n='<div class="zp_btn">'+lmsform.insertField("submit",lmsrooms.addUpdateRecord,ZPI18N.getString("zp.lms.rooms.save"),mode)+"</div>";a.innerHTML=n,lmsform.on("updateOptions",lmsrooms.updateOptionsCallback);var i=document.createElement("div");i.className="zp_pcnt";var o="";o+='<div class="zp_adfldr"><div>',o+='<div class="zp_Sm">'+lmsformcomponents.labelName(r[0])+lmsform.insertField(r[0],"","","",l[0])+"</div>",o+='<div class="zp_Sm">'+lmsformcomponents.labelName(r[1])+lmsform.insertField(r[1],"","","",l[1])+"</div></div>",o+=lmsform.insertField(r[4],"","","",l[4]),o+="</div>",o+=lmsform.insertField(r[2],"","",1,l[2],"disabled","zp_Sm","","",1),o+=lmsform.insertField(r[3],"","","",l[3],"","zp_Sm",1,"",1),i.innerHTML=o,a.appendChild(i);var c="";c+=lmsformcomponents.hiddenField("zp_tableName",s.tableName),c+=lmsformcomponents.hiddenField("zp_formId",s.formId),t&&(c+=lmsformcomponents.hiddenField("zp_recordId",t.recordId)),a.innerHTML+=c,lmsrooms.popup.appendChild(a),lmsformcomponents.bind(a)},constructValuesforFields:function(e,t){e?lmsrooms.constructFields(e,t):lmsrooms.getFormComponents(lmsrooms.constructValuesforFields,t)},clickAction:function(){"close"==this.eve.target.getAttribute("_rel")&&lmsrooms.popupClose()},addUpdateRecord:function(e){"addRecord"==e.zp_mode?(lmsrooms.successMsg=ZPI18N.getString("zp.lms.rooms.addroom-success"),lmsrooms.failureMsg=ZPI18N.getString("zp.lms.rooms.addroom-fail")):(lmsrooms.successMsg=ZPI18N.getString("zp.lms.rooms.updateroom-success"),lmsrooms.failureMsg=ZPI18N.getString("zp.lms.rooms.updateroom-fail")),$.post("/addUpdateRecord.zp",e,(function(e){7e3==e[0].code?(delete lmsrooms.formsComponentValues[e[0].pkId],lmsrooms.popupClose(),lmsrooms.refer.index=1,lmsrooms.getRoomDetails(),ZPeople.Message.showSuccessMsg(lmsrooms.successMsg),lmsformcomponents.onAllUploadsFinished()):(lmsformcomponents.onAllUploadsFinished(),ZPeople.Message.showFailureMsg(lmsrooms.failureMsg)),lmsrooms.successMsg=lmsrooms.failureMsg=null}))},updateOptionsCallback:function(e){if(isEmpty(lmsform.newOptionsMap))for(var t=lmsrooms.formData.message.formComponentDetails[0].column1,s=t.length-1;s>0;s--)if(25==t[s].fieldType){if(e[t[s].formComponentId])for(var r=e[t[s].formComponentId],l=r.length-1;l>=0;l--)r[l].Value=ZPeople.escapeHtml(r[l].Value),t[s].OptionsWithId.push(r[l]),t[s].Options.push(r[l].Value)}else 26==t[s].fieldType&&e[t[s].formComponentId]&&(t[s].Options=t[s].Options.concat(e[t[s].formComponentId]))},deleteRoomOnConfirmation:function(e){lmsrooms.params={mode:"deleteRecords",recordIds:e.getAttribute("roomId"),formId:lmsbase.roomFormId,conreqcsr:csrfToken},lmsrooms.tempElem=e,lmsnotify.show({header:ZPI18N.getString("zp.lms.entitydelete",["room"]),body:ZPI18N.getString("zp.lms.permenentlydelEntity",["Room"]),button_text:ZPI18N.getString("zp.delete"),texttype:"negative",successCallback:function(){this.status&&lmsrooms.deleteRoom()}})},deleteRoom:function(){$.post("/formAction.zp",lmsrooms.params,(function(e){7e3==e.code?(lmsrooms.tempElem.parentNode.removeChild(lmsrooms.tempElem),lmssessions.formComponents=null,lmsrooms.isLoadbarNeeded(),lmsrooms.isNoDataReq(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.deleteroom-success"))):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.deleteroom-fail")),lmsrooms.tempElem=lmsrooms.params=null}))},moreMenuOptions:function(e,t,s){_m=[{edit:[ZPI18N.getString("zp.edit")]},{del:[ZPI18N.getString("zp.delete")]}];var r=e.closest(".zp_Lst[roomId]");t=r?r.getAttribute("roomId"):"";lmsmenu.initiate({elem:e,width:"130px",type:"dropdown",arrowHead:!0,menulist:_m,eve:s}).on("click",(function(){"edit"==this.value?lmsrooms.getPopup("editroom",t):"del"==this.value&&lmsrooms.deleteRoomOnConfirmation(r)})).bind()},getSingleRoom:function(e){var t='<div class="zp_pvhd"><div class="zp_mark"><span>'+ZPI18N.getString("zp.lms.rooms.roomdetails")+'</span></div><div class="zp_micn"><ul><li><b><span><i class="IC-cls" _rel="close"></i></span></b></li></ul></div></div>',s='<div class="zp_pcnt"><div class="zp_vwrm"><div class = "zp_vwpht">'+lmsrooms.getRoomDP(e[0])+'</div><div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.sessions.RoomName")+"</div><h3>"+e[0].roomName+'</h3></div><div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.batches.Location")+"</div><span>"+e[0].locationName+'</span></div><div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.batches.Capacity")+"</div><span>"+e[0].roomcapacity+"</span></div>";if(0!=e[0].ROOMFC.length){s+='<div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.rooms.facilities")+"</div><ul>";for(var r=0;r<e[0].ROOMFC.length;r++)s+="<li>"+lmsform.changetoI18N(e[0].ROOMFC[r].FC)+"</li>";s+="</ul></div>"}s+="</div></div>",lmsrooms.popup.innerHTML=t+s},viewRoom:function(){lmsrooms.popup=lmsbase.openQHash(),lmsbase.removeClass(lmsrooms.popup.parentElement,"training"),lmsbase.addClass(lmsrooms.popup.parentElement,"zp_rpv");var e={method:"getRoomsDetails",recordId:lmsrooms._rfr_popup.roomId,conreqcsr:csrfToken};$.post("roomAction.zp",e,(function(e){if(0!=e[1].length)lms.changeHash("ques","roominfo/"+lmsrooms._rfr_popup.roomId,"disable"),lmsrooms.getSingleRoom(e[1]);else{var t='<div class="zp_pvhd"><div class="zp_mark"><span>'+ZPI18N.getString("zp.lms.rooms.roomdetails")+'</span></div><div class="zp_micn"><ul><li><b><span><i class="IC-cls" _rel="close"></i></span></b></li></ul></div></div>',s='<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.lms.rooms.roomdoesnotexist")+"</h2></div></div>";lmsrooms.popup.innerHTML=t+s}}))},onAfterAddfacility:function(e,t){if("success"==e[1].status){var s=lmsrooms.getSingleFacility(e[1].facility);t.closest("#new_facility").parentNode.replaceChild(s,t.closest("#new_facility")),lmsrooms.facility_refer.isClicked=!1,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.addfacility-success")),lmsrooms.formData=null,lmsbase.removeListener(t.closest("#new_facility"),"keyup",lmsrooms.saveFacility,!1)}else"duplicate facility"==e[1].message?(lmsrooms.facility_refer.isClicked=!1,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.addfacility-duplicate"))):(lmsrooms.facility_refer.isClicked=!1,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.rooms.addfacility-fail")))},onAfterEditFacility:function(e,t){"success"==e[1].status?((t=t.closest("#facility")).setAttribute("class",""),t.childNodes[0].textContent=lmsrooms.facility_refer.params.value,lmsrooms.facility_refer.isClicked=!1,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.editfacility-success")),lmsrooms.refer.index=1,lmsrooms.getRoomDetails(),lmsrooms.formData=null,lmsbase.removeListener(t,"keyup",lmsrooms.saveFacility,!1)):"duplicate facility"==e[1].message?(lmsrooms.facility_refer.isClicked=!1,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.addfacility-duplicate"))):(lmsrooms.facility_refer.isClicked=!1,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.editfacility-fail")))},getParams:function(e){return e.closest("#facility")?params={method:"editFacility",formId:lmsbase.roomFormId,optionId:e.closest("#facility").getAttribute("data_value"),value:e.parentNode.querySelector("[type = 'text']").value,conreqcsr:csrfToken}:params={method:"addFacility",formId:lmsbase.roomFormId,value:e.parentNode.querySelector("[type = 'text']").value,conreqcsr:csrfToken},params},saveFacility:function(e){var t=e.target;if(13==(e.which||e.keyCode||e.charCode)&&!lmsrooms.facility_refer.isClicked){t.parentNode.querySelector("[type = 'text']").value;if(lmsrooms.facility_refer.isClicked=!0,lmsrooms.facility_refer.params=lmsrooms.getParams(t),""==lmsrooms.facility_refer.params.value.trim())return void(lmsrooms.facility_refer.isClicked=!1);$.post("roomAction.zp",lmsrooms.facility_refer.params,(function(e){"addFacility"==lmsrooms.facility_refer.params.method?lmsrooms.onAfterAddfacility(e,t):lmsrooms.onAfterEditFacility(e,t)}))}},addFacility:function(){var e=document.createElement("div");e.id="new_facility",lmsbase.addClass(e,"zp_Sm"),e.innerHTML='<div><input type="text"></div>';var t=lmsrooms.popup.querySelector("[_rel='addFacility']").nextSibling;null==lmsrooms.popup.querySelector("#new_facility")&&t.parentNode.insertBefore(e,t),lmsrooms.popup.querySelector("[type='text']").focus(),lmsbase.addListener(e,"keyup",lmsrooms.saveFacility,!1)},editFacility:function(e){e.setAttribute("class","zp_actin"),e.querySelector("[type = 'text']").value=e.childNodes[0].textContent,lmsbase.addListener(e,"keyup",lmsrooms.saveFacility,!1)},deleteFacility:function(e){params={method:"deleteFacility",optionId:e.getAttribute("data_value"),conreqcsr:csrfToken},$.post("roomAction.zp",params,(function(t){"success"==t[1].status?(e.parentNode.removeChild(e),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.deletefacility-success")),lmsrooms.refer.index=1,lmsrooms.getRoomDetails(),lmsrooms.formData=null):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.rooms.deletefacility-fail"))}))},deleteFacilityOnConfirm:function(e,t){lmsnotify.show({header:ZPI18N.getString("zp.lms.entitydelete",["facility"]),body:ZPI18N.getString("zp.lms.permenentlydelEntity",["Facility"]),button_text:ZPI18N.getString("zp.delete"),texttype:"negative",successCallback:function(){this.status&&lmsrooms.deleteFacility(t)}})},facilityPopupHandle:function(e){var t=e.target,s=t.getAttribute("_rel"),r=t.closest("#facility");if("addFacility"==s)lmsrooms.addFacility();else if("edit"==s)lmsrooms.editFacility(r);else if("delete"==s){r=t.closest("#facility");lmsrooms.deleteFacilityOnConfirm(lmsrooms.deleteFacility,r)}else"close"==s&&lmsrooms.popupClose()},getSingleFacility:function(e){var t=document.createElement("div");t.setAttribute("id","facility"),t.setAttribute("data_value",e.optionId);var s="<label>"+lmsform.changetoI18N(e.optionValue)+'</label><div class="zp_Sm"><div><input type="text"></div></div>';return 0==e.systemValue&&(s+='<font><i class="IC-edit" data-ttip='+ZPI18N.getString("zp.edit")+' _rel="edit"></i><i class="IC-trash" data-ttip='+ZPI18N.getString("zp.delete")+' _rel="delete"></i></font>'),t.innerHTML=s,t},listFacilities:function(e){for(var t=lmsrooms.popup.querySelector("[class='zp_Scat']"),s=document.createDocumentFragment(),r=0;r<e.length;r++)s.appendChild(lmsrooms.getSingleFacility(e[r]));if(50==e.length){lmsrooms.facility_refer.startIndex+=50;var l=lmsrooms.addLoading();s.appendChild(l)}else lmsrooms.facility_refer.startIndex="end";t.appendChild(s,t.childNodes[0])},getFacilities:function(){var e={method:"getFacilities",formId:lmsbase.roomFormId,start:lmsrooms.facility_refer.startIndex,conreqcsr:csrfToken};$.post("roomAction.zp",e,(function(e){lmsrooms.removeLoading(),"success"==e[1].status?lmsrooms.listFacilities(e[1].facilities):lmsrooms.facility_refer.startIndex="end"}))},showFacilityPopup:function(){lmsrooms.popup=lmsbase.openQHash(),lmsrooms.constructFormHeader("facilities");var e=lmsform.initiate(),t=document.createElement("div");t.className="zp_pcnt",t.id="facilityList";var s;s='<div class="zp_Scat"><a _rel="addFacility"><i class="IC-plus-big"></i>'+ZPI18N.getString("zp.lms.rooms.addfacility")+"</a></div>",t.innerHTML=s,e.innerHTML=t,lmsrooms.popup.appendChild(t),lmsrooms.getFacilities(),lmsrooms.scrollElem=lmsrooms.popup.querySelector("#facilityList"),lmsbase.addListener(lmsrooms.scrollElem,"scroll",lmsrooms.facilityScrollHandle,!1),lmsbase.addListener(lmsrooms.popup,"click",lmsrooms.facilityPopupHandle,!1)},popupClose:function(){lmsrooms.addorRemoveSelClass(),lmsrooms._rfr_popup={roomId:""},lmsrooms.facility_refer={startIndex:1,params:null,isClicked:!1},lmsrooms.popup.innerHTML="",lmsbase.removeQHash(),lmsbase.closeQHash()},isLoadbarNeeded:function(){"end"!=lmsrooms.refer.index&&lmsrooms.scrollElem.scrollHeight<=lmsrooms.scrollElem.clientHeight&&lmsrooms.getRoomDetails()},isNoDataReq:function(){var e=lmsrooms.root.querySelector("#roomsList");e.childNodes.length||lmsnodata.showNoData({mode:"ondelete",container:e,module:"Rooms",content:ZPI18N.getString("zp.lms.base.toaddrooms")})},addLoading:function(){var e=document.createElement("div");return e.className="ctable",e.style.height="64px",e.setAttribute("_rel","loadbar"),e.innerHTML='<div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div>',e},removeLoading:function(){var e=document.querySelector("[_rel=loadbar]");e&&e.parentNode.removeChild(e)},reInitialise:function(){lmsrooms.root=null,lmsrooms.popup=null,lmsrooms.scrollElem=null,lmsrooms.formData=null,lmsrooms.formsComponentValues={},lmsrooms.refer={index:1},lmsrooms._rfr_popup={roomId:""},lmsrooms.facility_refer={startIndex:1,params:null,isClicked:!1}},close:function(){lmsbase.removeListener(lmsrooms.root,"click",lmsrooms.roomsHandle,!1),lmsbase.removeListener(lmsrooms.scrollElem,"scroll",lmsrooms.scrollHandle,!1),lmsbase.removeListener(lmsrooms.popup,"click",lmsrooms.facilityPopupHandle,!1),lmsbase.removeListener(lmsrooms.scrollElem,"scroll",lmsrooms.facilityScrollHandle,!1),lmsrooms.reInitialise()}},lmsusers={root:null,userInfoPopup:null,popup:null,currentUserId:null,userData:null,selectedUsers:{},selectedUserarr:[],courseData:null,enrollMode:null,refer:{index:1},filteruser:{index:1},filterdesig:{index:1},inforefer:{index:1,lpindex:1,timeout:null},activeCourseIndex:1,activeLearningPlanIndex:1,menuCallBack:"",inputvalue:"",selCnt:0,constructMenu:0,elem:"",initiate:function(e,t){if("userinfo"==this.module&&1!=t)lmsusers.getUserInfoDetails(this.hashObject.level1,this.elem);else{lmsusers.reInitialise(),lmsusers.root=this.elem,lmsusers.root.innerHTML="",$(".zp_fpv").hide();var s='<div class="zp_header zp_CChgt" id="lmsuserheaderposition"><div class="zp_hdtit"><h2><font>'+this.tabObject+"</font></h2></div>";s+=lmsusers.layoutConstruction(),lmsusers.root.innerHTML+=s,lmsusers.filterConstruction(),lmsusers.root.querySelector(".zp_slctlst").classList.add("DN"),lmsusers.getSubordinatesList()}lmsbase.addListener(lmsusers.root,"click",lmsusers.clickHandler,!1)},filterConstruction:function(e){if("reset"==e){lmsusers.root.querySelector("#userfilter").classList.remove("DN");var t=lmsusers.root.querySelector("#designation_users");t.querySelector(".zp_Sms").remove(),lmsusers.designationFilterConstruction(t),(t=lmsusers.root.querySelector("#sub_users")).querySelector(".zp_Sms").remove(),lmsusers.reporteesFilterConstruction(t)}else{var s='<div class="zp_CCcat" id="userfilter"><div><div id="designationUser"><div class="zp_Sm " id= "designation_users"></div><div class="zp_Sm " id= "sub_users"></div><i class="IC-reset-01"  data-ttip="'+ZPI18N.getString("zp.lms.reset")+'" onclick="lmsusers.resetFunction()"></i></div>';lmsusers.root.querySelector("#lmsuserheaderposition").innerHTML+=s}},designationFilterConstruction:function(e){lmsusers.menuObj.insertMenu({elem:e,type:"select",mode:"single",menulist:lmsusers.fetchDesignation,click:lmsusers.filterDesignation}),lmsmenu.changeToSelectMenu(e,{},"single",null,ZPI18N.getString("zp.lms.Designation"))},fetchDesignation:function(e){lmsusers.menuCallBack=this.updateOptionList,lmsusers.inputvalue=this.value,null!=this.value?lmsusers.getDesginationList(lmsusers.desigView,this.value):lmsusers.getDesginationList(lmsusers.desigView)},desigView:function(e){var t={};t[0]=[ZPI18N.getString("zp.lms.sall"),""];for(var s=Object.keys(e[1]),r=Object.values(e[1]),l=0;l<s.length;l++)t[r[l]]=[s[l],""];lmsusers.menuCallBack(t,lmsusers.inputvalue)},getDesginationList:function(e,t){lmsusers.refer.index=1,lmsusers.filterdesig.index=1;var s={method:"getDesgination",searchTxt:t,conreqcsr:csrfToken};lmsusers.filterSearchUser&&(s.user=lmsusers.filterSearchUser.value),$.post("/courseUsersAction.zp",s,e)},filterDesignation:function(e){if(0!=e.value||null!=document.getElementById("sub_users").querySelector('[class="zp_Tglst ntxt"]')){lmsusers.filterSearchdesig=e;var t={method:"getSubordinatesList",mode:"designationFilter",Desgination:e.value,startIndex:lmsusers.filterdesig.index,conreqcsr:csrfToken};null!=document.getElementById("sub_users").querySelector('[class="zp_Tglst ntxt"]')&&(t.user=document.getElementById("sub_users").querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel")),$.post("/courseUsersAction.zp",t,(function(e){var t;if(lmsusers.root.querySelector(".zp_slctlst").classList.add("DN"),lmsusers.subordinateView(e[1],1==lmsusers.filterdesig.index?"new":"update"),(t=lmsusers.elem.querySelector('[_rel="designationfilternextpage"]'))&&t.remove(),e[1]&&25==e[1].length){if(t=lmsusers.elem.querySelector('[_crel = "designextpage"]'))t.setAttribute("_rel","designationfilternextpage");else if(!lmsusers.elem.querySelector('[_rel="designationfilternextpage"]')&&"end"!=lmsusers.refer.index){var s='<div class="zp_memarw" _crel = "designextpage" _rel="designationfilternextpage"><div class="zp_anc">'+ZPI18N.getString("zp.lms.loadmore")+"</div></div>";lmsusers.elem.innerHTML+=s}}else(t=lmsusers.elem.querySelector('[_rel="designationfilternextpage"]'))&&t.remove();lmsusers.filterdesig.index=e[1].length>0?lmsusers.filterdesig.index+25:"end"}))}else lmsusers.getSubordinatesList(),lmsusers.refer.index=1},reporteesFilterConstruction:function(e){lmsusers.menuObj.insertMenu({elem:e,type:"select",mode:"single",menulist:lmsusers.fetchReportees,menutype:2,click:lmsusers.filterUser}),lmsmenu.changeToSelectMenu(e,{},"single",null,ZPI18N.getString("zp.lms.reportees"))},fetchReportees:function(e){lmsusers.menuCallBack=this.updateOptionList,lmsusers.inputvalue=this.value,null!=this.value?lmsusers.getReporteesList(lmsusers.reporteeView,this.value):lmsusers.getReporteesList(lmsusers.reporteeView)},reporteeView:function(e){var t,s,r={};$.each(e[1],(function(e,l){t=l.name.split(" ")[0],s=l.name.split(" ")[1],r[l.userId]=[l.employeeId,t,"",s]})),lmsusers.menuCallBack(r,lmsusers.inputvalue)},getReporteesList:function(e,t){lmsusers.filteruser.index=1;var s={method:"getSubordinatesList",mode:"repoorteesFilter",searchTxt:t,conreqcsr:csrfToken};null!=document.getElementById("designation_users").querySelector('[class="zp_Tglst ntxt"]')&&(s.Desgination=document.getElementById("designation_users").querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel")),$.post("/courseUsersAction.zp",s,e)},filterUser:function(e){if(0!=e.value){lmsusers.filterSearchUser=e;var t={method:"getSubordinatesList",user:e.value,startIndex:lmsusers.filteruser.index,conreqcsr:csrfToken};null!=document.getElementById("designation_users").querySelector('[class="zp_Tglst ntxt"]')&&(t.Desgination=document.getElementById("designation_users").querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel")),$.post("/courseUsersAction.zp",t,(function(e){var t;if(lmsusers.root.querySelector(".zp_slctlst").classList.add("DN"),lmsusers.subordinateView(e[1],1==lmsusers.filteruser.index?"new":"update"),(t=lmsusers.elem.querySelector('[_rel="usersfilternextpage"]'))&&t.remove(),e[1]&&25==e[1].length){if(t=lmsusers.elem.querySelector('[_crel = "filternextpage"]'))t.setAttribute("_rel","usersfilternextpage");else if(!lmsusers.elem.querySelector('[_rel="usersfilternextpage"]')&&"end"!=lmsusers.refer.index){var s='<div class="zp_memarw" _crel = "filternextpage" _rel="usersfilternextpage"><div class="zp_anc">'+ZPI18N.getString("zp.lms.loadmore")+"</div></div>";lmsusers.elem.innerHTML+=s}}else(t=lmsusers.elem.querySelector('[_rel="usersfilternextpage"]'))&&t.remove();lmsusers.filteruser.index=e[1].length>0?lmsusers.filteruser.index+25:"end"}))}else lmsusers.getSubordinatesList(),lmsusers.refer.index=1},subordinateView:function(e,t){if(lmsusers.selCnt=0,"new"==t&&(e.length>0?lmsnodata.clearNoData(document.getElementById("users")):lmsnodata.showNoData({mode:"general",container:document.getElementById("users"),module:"users",content:ZPI18N.getString("zp.lms.noSubordinates")})),$.each(e,(function(e,t){var s,r="",l='<div class="zp_CUlst"id="usersel_'+t.userId+'" data-id="myteamview"><i class="IC-tck" title="'+ZPI18N.getString("zp.lms.selectuser")+'"></i>',a="";null!=t.totalPotential&&null!=t.totalPotential[t.userId]&&(a=t.totalPotential[t.userId].potential),null==t.totalPotential?r="zp_prgcvr":a>75&&a<=100?r="zp_prgcvr zp_pg_100":a>50&&a<=75?r="zp_prgcvr zp_pg_75":a>25&&a<=50?r="zp_prgcvr zp_pg_50":a>0&&a<=25&&(r="zp_prgcvr zp_pg_25"),null!=t.totalPotential&&(s=1.8*a);var n=""!=r?"IC-tck":"";l+='<div class="ZP_photo"><div class="zp_prgcrcl"><div class="'+r+'"><div class="zp_PCrot"><div class="zp_PCmsk zp_Pful" style="transform: rotate('+s+'deg);"><div class="zp_PCfil" style="transform: rotate('+s+'deg);"></div></div><div class="zp_PCmsk zp_Phlf"><div class="zp_PCfil" style="transform: rotate('+s+'deg);"></div></div></div><div class="zp_prgper">',""==n?l+='<i class="'+n+'"></i>':null!=t.totalPotential&&(l+=a+"%"),l+="</div></div></div>",l+='<img src="'+t.photoPath+'"></div><h4 data-ttip="'+t.name+'"><i>'+t.employeeId+"</i>"+t.name+"</h4></div>",lmsusers.root.querySelector("#users").innerHTML+=l,lmsusers.userId=t.userId,lmsusers.data=t})),lmsusers.root.querySelectorAll(".zp_CUlst").length>0&&""==lms._page.container.querySelector("#designation_users").innerHTML){lmsusers.menuObj=lmsgroupmenu.initiate(lmsusers.root.querySelector("#designationUser"));var s=lmsusers.root.querySelector("#designation_users");lmsusers.designationFilterConstruction(s),s=lmsusers.root.querySelector("#sub_users"),lmsusers.reporteesFilterConstruction(s)}lmsusers.constructMenu=1,lmsusers.refer.index=e.length>0?lmsusers.refer.index+25:"end"},getSubordinatesList:function(e){if(null==e&&0==lmsusers.root.querySelectorAll("#users").length){lmsusers.root.innerHTML+='<div class="zp_cwrap" ><div class="zp_Lstwrap zp_Tusr" id="users"></div></div>'}lmsusers.elem=document.getElementById("users"),null==e&&0==lmsusers.root.querySelectorAll("#users").length&&lmsusers.elem.appendChild(lmsmodule.addLoading());var t={method:"getSubordinatesList",startIndex:lmsusers.refer.index,conreqcsr:csrfToken};$.post("/courseUsersAction.zp",t,(function(e){lmsusers.userData=e[1],lmsusers.subordinateView(e[1],1==lmsusers.refer.index?"new":"update");var t;lmsusers.refer.index;if((t=lmsusers.elem.querySelector('[_rel="usersnextpage"]'))&&t.remove(),e[1]&&25==e[1].length){if(t=lmsusers.elem.querySelector('[_crel = "nextpage"]'))t.setAttribute("_rel","usersnextpage");else if(!lmsusers.elem.querySelector('[_rel="usersnextpage"]')&&"end"!=lmsusers.refer.index){var s='<div class="zp_memarw" _crel = "nextpage" _rel="usersnextpage"><div class="zp_anc">'+ZPI18N.getString("zp.lms.loadmore")+"</div></div>";lmsusers.elem.innerHTML+=s}}else(t=lmsusers.elem.querySelector('[_rel="usersnextpage"]'))&&t.remove(),lmsusers.refer.index="end"}))},layoutConstruction:function(){var e='<div class="zp_frt zp_micn" id="header1"></div></div></div><div class="zp_slctlst zp_ALslct1"><div> <i class="IC-cbox zp_gclr" _rel="selsubUser" id="selsubUser"></i><span id="selCnt"></span><font _rel="selsubUser" id="selectAll">'+ZPI18N.getString("zp.selectall")+'</font></div><ul><li _rel="allUserSuggest" id="allUserSuggest">'+ZPI18N.getString("zp.lms.suggest")+"</li>";return e+='<li _rel="allUserEnroll" id="allUserEnroll">'+ZPI18N.getString("zp.lms.course.enroll")+"</li>",e+="</ul></div>"},selAlluser:function(e,t){if(1!=t&&lmsusers.root.querySelector(".zp_slctlst").classList.remove("DN"),(s=lmsusers.root.querySelector("#users").querySelectorAll(".zp_CUlst")).forEach((function(e){e.classList.remove("sel"),e.removeAttribute("mrel")})),2==t||lmsusers.root.querySelector("#selsubUser").classList.contains("zp_gclr")&&"selectAll"!=e.getAttribute("id")||"Deselect All"===document.getElementById("selectAll").innerHTML)lmsusers.root.querySelector("#selectAll").innerHTML=ZPI18N.getString("zp.selectall"),lmsusers.root.querySelector(".zp_slctlst").classList.add("DN");else{var s;lmsusers.root.querySelector("#users").querySelector(".zp_CUlst").classList.remove("sel"),lmsusers.root.querySelector("#users").querySelector(".zp_CUlst").removeAttribute("mrel");var r;(s=lmsusers.root.querySelector("#users").querySelectorAll(".zp_CUlst")).forEach((function(e){e.classList.toggle("sel"),e.setAttribute("mrel","myteamusersel")})),r=s.length,lmsusers.root.querySelector("#selCnt").textContent=r+" "+ZPI18N.getString("zp.lms.usersselected"),lmsusers.root.querySelector("#selectAll").innerHTML="Deselect All"}},infoCardClick:function(e){var t=e.target.closest('[class="zp_CUlst"]');if(null===e.target.closest('[class="IC-tck"]')&&null===t&&(t=e.target.closest('[data-id="myteamview"]')),t&&(t=t.getAttribute("id").split("_")[1]),"IC-tck"!=e.target.getAttribute("class")&&t||null===e.target.closest('[class="IC-tck"]'))lms.changeHash("ques","userinfo/"+t,"disable"),lmsusers.inforefer.index=1,lmsusers.inforefer.lpindex=1,lmsusers.getUserInfoDetails(t,lmsbase.openQHash());else{var s=e.target.closest('[class="IC-tck"]');if("zp_CUlst sel"==s.parentElement.getAttribute("class")?s.parentElement.setAttribute("class","zp_CUlst"):s.parentElement.setAttribute("class","zp_CUlst sel"),s.parentElement.setAttribute("mrel","myteamusersel"),"zp_CUlst sel"==s.parentElement.getAttribute("class"))lmsusers.root.querySelector(".zp_slctlst").classList.remove("DN"),lmsusers.selCnt=lmsusers.selCnt+1;else{var r=!1;lmsusers.root.querySelector("#users").querySelectorAll(".zp_CUlst").forEach((function(e){1==s.parentElement.classList.contains("zp_CUlst sel")&&(r=!0)})),r||lmsusers.selCnt<=0&&lmsusers.root.querySelector(".zp_slctlst").classList.add("DN");var l=lmsusers.root.querySelectorAll(".zp_CUlst.sel").length;lmsusers.selCnt=l-1}0===lmsusers.root.querySelectorAll(".zp_CUlst.sel").length&&(lmsusers.selCnt=0,s.parentElement.removeAttribute("mrel","myteamusersel"));var a=lmsusers.root.querySelector("#users").querySelectorAll(".sel").length;0==a?lmsusers.root.querySelector(".zp_slctlst").classList.add("DN"):(lmsusers.root.querySelector(".zp_slctlst").classList.remove("DN"),lmsusers.root.querySelector("#selsubUser").classList.add("zp_gclr")),lmsusers.root.querySelector("#selCnt").textContent=a+" "+ZPI18N.getString("zp.lms.usersselected")}},changeTitle:function(e){"zp_CUlst sel"==e.parentElement.getAttribute("class")?e.setAttribute("title","Select user"):e.setAttribute("title","Deselect user")},getUserInfoDetails:function(e,t,s){lmsusers.currentUserId=e,lmsreports.fday=lmsreports.getFirstDay(),lmsreports.fday=Calendar.formatDate(lmsreports.fday);var r={method:"getUserSkillCourseDetails",user:e,fday:lmsreports.fday,courseFilter:"progress",startIndex:lmsusers.inforefer.index,startPlan:lmsusers.inforefer.lpindex,conreqcsr:csrfToken};$.post("/courseUsersAction.zp",r,(function(s){$.each(s[1],(function(s,r){lmsusers.userDetailsInfoView(r.SkillList,r.activeCourseList,r.completedCourseList,r.activePlanList,t,r.userData,e)}))}))},userDetailsInfoView:function(e,t,s,r,l,a,n){if(1===lmsusers.inforefer.index&&1===lmsusers.inforefer.lpindex){var i="",o=0;lmsusers.activeCourseIndex=1,lmsusers.activeLearningPlanIndex=1,$.each(a,(function(e,t){i=t,lmsusers.userData[o].userId!==t.userId?o++:lmsusers.userData[o].userId===t.userId&&lmsusers.userData[o]}));var c='<div class="zp_pvhd" id="phead"><div class="zp_mark"><span>'+ZPI18N.getString("zp.lms.myteam")+'</span></div><div class="zp_micn"><ul><li id="closeGrid"><b class=""> <span><i _rel="closeGrid" class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></span></b></li></ul></div></div><div class="zp_pcnt" id="userinfoCourse"><div class="zp_CPcnt"><div class="zp_CPlt"><div class="ZP_photo">',d="",m="";null!=i.totalPotential&&null!=i.totalPotential[i.userId]&&(m=i.totalPotential[i.userId].potential),null==i.totalPotential?d="zp_prgcvr":m>75&&m<=100?d="zp_prgcvr zp_pg_100":m>50&&m<=75?d="zp_prgcvr zp_pg_75":m>25&&m<=50?d="zp_prgcvr zp_pg_50":m>0&&m<=25&&(d="zp_prgcvr zp_pg_25");var u=""!=d?"IC-tck":"";null!=i.totalPotential&&(skillPotentialPer=1.8*m),c+='<div class="zp_prgcrcl"><div class="'+d+'"><div class="zp_PCrot"><div class="zp_PCmsk zp_Pful" style="transform: rotate('+skillPotentialPer+'deg);"><div class="zp_PCfil" style="transform: rotate('+skillPotentialPer+'deg);"></div></div><div class="zp_PCmsk zp_Phlf"><div class="zp_PCfil" style="transform: rotate('+skillPotentialPer+'deg);"></div></div></div><div class="zp_prgper">',""==u?c+='<i class="'+u+'"></i>':null!=i.totalPotential&&(c+=m+"%"),c+='</div></div></div><img src="'+i.photoPath+'"></div>',c+="<h4><i>"+i.employeeId+"</i>"+i.name+"</h4>",null!=i.designName&&(c+="<p>"+i.desigName+"</p>"),c+='<div class="zp_Ctbl"><span _rel="courseSuggest" id="courseSuggest">'+ZPI18N.getString("zp.lms.course.suggest")+"</span>",c+='<span _rel="courseEnroll" id="courseEnroll">'+ZPI18N.getString("zp.lms.course.enroll")+'</span><span _rel="courseUnenroll" id="courseUnenroll" class="zp_rdclr">'+ZPI18N.getString("zp.lms.settings.Unenroll")+"</span>",c+="</div></div>",null!=e&&e.length>0&&(c+='<div class="zp_CPbx"> <div class="zp_Pttl">'+ZPI18N.getString("zp.lms.Skillset")+"</div>",$.each(e,(function(e,t){var s="",r="";t.hasOwnProperty("skillSetScore")?4==t.skillSetScore?(r="100%",s="zp_BRgrn"):3==t.skillSetScore?(r="75%",s="zp_BRgrn"):2==t.skillSetScore?(r="50%",s="zp_BRblu"):1==t.skillSetScore?(r="25%",s="zp_BRorg"):0==t.skillSetScore&&(r="0%"):r="0%",c+='<div class="zp_pbar" _rel="getCompetencycle" id="getCompetencycle" data-id="getCompetencyli"> <div class="zp_pbB '+s+'" style="width:'+r+';"></div><font>'+t.skillSetName+"</font><span>"+r+"</span> </div>"})),c+="</div>"),c+="</div>",null==t&&null==r||(c+='<div><div class="zp_CPbx"><div class="zp_Tabs"><ul class=""> <li class="sel" _rel="active_lms" id="active_lms">'+ZPI18N.getString("zp.lms.feedback.courses")+'</li><li _rel="competence_lms" id="competence_lms">'+ZPI18N.getString("zp.lms.feedback.Competency")+'</li></ul></div><div class="zp_navswap" id="active"></div>'),c+='<div class="zp_navswap" id="competen"></div></div></div></div></div>',l.innerHTML=c,0==t.length&&0==r.length&&lmsnodata.showNoData({mode:"general",container:document.getElementById("active"),module:"users",content:ZPI18N.getString("zp.lms.nodatafound")}),lmsusers.infoelem=document.getElementById("active");var p=lmsusers.sortBothCoursesAndLP(t,r);lmsusers.constructInfoBody(p),lmsusers.userId=n,lmsusers.userInfoPopup=lms._page.container.querySelector('[class="zp_pwrap zp_tab"]'),lmsbase.addListener(lmsusers.userInfoPopup,"click",lmsusers.clickPopUpHandler,!1)}else{p=lmsusers.sortBothCoursesAndLP(t,r);lmsusers.constructInfoBody(p)}var g=lmsusers.infoelem.querySelector('[_rel="usersinfonextpage"]');if(g&&g.remove(),t.length+r.length>=50){if(g=lmsusers.infoelem.querySelector('[_crel = "infonextpage"]'),!lmsusers.infoelem.querySelector('[_rel="usersinfonextpage"]')&&"end"!=lmsusers.inforefer.index&&"end"!=lmsusers.inforefer.lpindex){var f='<div class="zp_memarw" _crel = "infonextpage" _rel="usersinfonextpage"><div class="zp_anc">'+ZPI18N.getString("zp.lms.loadmore")+"</div></div>";lmsusers.infoelem.innerHTML+=f}lmsusers.inforefer.index=lmsusers.activeCourseIndex,lmsusers.inforefer.lpindex=lmsusers.activeLearningPlanIndex}else lmsusers.inforefer.index="end",lmsusers.inforefer.lpindex="end"},sortBothCoursesAndLP:function(e,t){for(var s=[],r=0,l=0;(r<e.length||l<t.length)&&s.length<50;){const a=null!=e[r]?e[r].enrolledTime:null,n=null!=t[l]?t[l].planInfo.enrolledTime:null;null==a||null!=n&&a<n?(s.push(lmsusers.reformatCoursesOrLPForListing("lp",t[l])),lmsusers.activeLearningPlanIndex++,l++):(s.push(lmsusers.reformatCoursesOrLPForListing("course",e[r])),lmsusers.activeCourseIndex++,r++)}return s},reformatCoursesOrLPForListing:function(e,t){if("lp"===e){var s={type:"lp"};return s.planId=t.planInfo.planId,s.planName=t.planInfo.planName,s.planImage=t.planInfo.image,s.planImageInfo=t.planInfo.lpImageInfo,s.isUserCompletedPlan=t.planInfo.isUserCompletedPlan,s.enrolledTime=t.planInfo.enrolledTime,s}var r={type:"course"};return r.courseId=t.courseId,r.courseName=t.courseName,r.courseImage=t.courseImage,r.courseImageInfo=t.courseImageInfo,r.isUsercanUnenroll=t.isUsercanUnenroll,r.courseState=t.courseState,r.showManagerEvaluation=t.showManagerEvaluation,r.isManagerEvaluationCompleted=t.isEvaluationCompleted,r.enrolledTime=t.enrolledTime,r.courseUserId=t.courseUserId,"batchId"in t&&(r.batchId=t.batchId),"batchName"in t&&(r.batchName=t.batchName),r},constructInfoBody:function(e){var t='<ul class="zp_CPlst">';lmsusers.unenrollCourses=[];for(var s=0;s<e.length;s++){var r=e[s];if("lp"===r.type){r.planImageInfo.additionalInfo={fileId:r.planId,type:8};var l=r.planImageInfo.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+r.planImage+".svg"):lmsfileaction.generateSourceURL(r.planImageInfo);t+='<li _rel = "learningPlanProgress" planid="'+r.planId+'"><div class="ZP_photo" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src='+l+"> </div><h4>"+r.planName+"</h4>",t+="<a>"+ZPI18N.getString("zp.lms.learningplan")+"</a>",t+='<font class="zp_ldot">'+(r.isUserCompletedPlan?ZPI18N.getString("zp.completed"):ZPI18N.getString("zp.lms.inprogress"))+"</font>"}else{var a={};r.courseImageInfo.additionalInfo={fileId:r.courseId,type:6};var n=r.courseImageInfo.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+r.courseImage+".svg"):lmsfileaction.generateSourceURL(r.courseImageInfo);t+='<li _rel = "courseProgress" rel="userCId_'+r.courseId+'"cid="'+r.courseId+'"'+(r.batchId?'bid="'+r.batchId+'"':"")+' courseUserId="'+r.courseUserId+'"><div class="ZP_photo" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src='+n+"> </div><h4>"+r.courseName+"</h4>",r.showManagerEvaluation&&(t+='<i class="IC-mngevl'+(r.isManagerEvaluationCompleted?' cmplt"':'"')+' _rel="managerEvaluation" courseId="'+r.courseId+'"'+(r.batchId?'batchId="'+r.batchId+'"':"")+"></i>"),t+="<a>"+ZPI18N.getString("zp.lms.course")+"</a>",r.courseState&&null!=r.courseState&null!=r.courseState&&(t+='<font class="zp_ldot">'+r.courseState+"</font>"),r.batchName&&null!=r.batchName&null!=r.batchName&&(t+='<a class="zp_ldot"  data-ttip="'+r.batchName+'">'+r.batchName+"</a>",t+="</li>"),r.courseState!=ZPI18N.getString("zp.completed")&&r.isUsercanUnenroll&&(a.courseId=r.courseId,a.courseName=r.courseName,lmsusers.unenrollCourses.push(a))}}t+="</ul>",document.getElementById("active").innerHTML+=t},userSuggestCourse:function(e,t){if("unenroll"==lmsusers.enrollMode)if(t){for(var s=[],r=0;r<lmsusers.unenrollCourses.length;r++)!isEmpty(lmsusers.unenrollCourses[r])&&lmsusers.unenrollCourses[r].courseName.toLowerCase().includes(t.toLowerCase())&&s.push(lmsusers.unenrollCourses[r]);lmsusers.menuCallBack.updateOptionList(function(e,t,s,r){for(var l={},a=0;a<e.length;a++)l[e[a][t]+"batch"+e[a][s]]=[e[a][r],""];return l}(s,"courseId","batchId","courseName"),lmsusers.menuCallBack.inputvalue),lmsusers.menuCallBack=null}else lmsusers.addSuggestCourse();else{"all"!==e&&(lmsusers.selectedUserarr=[],lmsusers.selectedUsers.userId=lmsusers.currentUserId,lmsusers.selectedUserarr.push(lmsusers.selectedUsers));var l=0;lms.settingData[0].selfData.isSelfManagerenroll&&lms.settingData[0].iltData.isIltManagerenroll?l=1:lms.settingData[0].iltData.isIltManagerenroll?l=2:lms.settingData[0].selfData.isSelfManagerenroll&&(l=3);var a={method:"getCoursesForSuggestUser",usersIds:JSON.stringify(lmsusers.selectedUserarr),viewFor:"enroll"==lmsusers.enrollMode?1:"unenroll"==lmsusers.enrollMode?2:0,mode:l,conreqcsr:csrfToken};t&&(a.searchtxt=t),$.post("/courseAction.zp",a,(function(e){if(e[1]&&null!=e[1])if(t){var s=e[1];lmsusers.menuCallBack.updateOptionList(function(e,t,s,r){for(var l={},a=0;a<e.length;a++)l[e[a][t]+"batch"+e[a][s]]=[e[a][r],""];return l}(s,"courseId","batchId","courseName"),lmsusers.menuCallBack.inputvalue),lmsusers.menuCallBack=null}else lmsusers.courseData=e[1],lmsusers.addSuggestCourse();else ZPeople.Message.showFailureMsg("Courses not found")}))}},addSuggestCourse:function(){var e="",t="";"suggest"===lmsusers.enrollMode?(e=ZPI18N.getString("zp.lms.suggestcourse"),t=ZPI18N.getString("zp.lms.suggest")):"enroll"===lmsusers.enrollMode?(e=ZPI18N.getString("zp.lms.enrollcourse"),t=ZPI18N.getString("zp.lms.course.enroll")):"unenroll"===lmsusers.enrollMode&&(e=ZPI18N.getString("zp.lms.unenrollfromcourse"),t=ZPI18N.getString("zp.lms.settings.Unenroll")),lmsusers.popup=lmsbase.showMaskLayer();var s='<div class="zp_popup" style="width:600px;"><div class="zp_Pohd"><font>'+e+'</font><i class="IC-cls" _rel="close" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></div><div class="zp_Pocnt" style="max-height:700px;"><div _rel="courseMenu">'+lmsformcomponents.htmlField({formComponentId:"courseIds",fieldType:25,emptyText:ZPI18N.getString("zp.lms.course.select")})+"</div>";"unenroll"===lmsusers.enrollMode&&(s+='<div id="" class="zp_Sm  "><label>'+ZPI18N.getString("zp.lms.approvals.addComment")+'</label><div><textarea id="unenrollcmnt" cols="30" rows="10" type="radio" class="zp_txtfocs"></textarea></div></div>'),s+='</div><div class="zp_btn"><button class="zpthm" _rel="add">'+t+"</button></div></div>",lmsusers.popup.innerHTML=s,lmsbase.addListener(lmsusers.popup,"click",lmsusers.clickActionPopup,!1);var r=lmsusers.popup.querySelector('[_rel="courseMenu"]');lmsusers.menuRef=lmsgroupmenu.initiate(r),lmsusers.menuRef.insertMenu({elem:r.querySelector(".zp_Sm"),type:"select",mode:"multi",allow_new:!1,menulist:lmsusers.menuAction})},updateUserSuggestCourse:function(e,t,s,r){var l=this.selCnt,a="enroll"==lmsusers.enrollMode?1:0,n=JSON.stringify(lmsusers.selectedUserarr),i={method:"updateUserSuggestCourse",suggestCourseId:e.toString(),suggestBatchId:t.toString(),usersIds:n,mode:"multiple",enrollType:a,conreqcsr:csrfToken};$.post("/courseUsersAction.zp",i,(function(t){if(1==t[1].registrationStatus){if("skillSuggest"==s&&(document.querySelector('[_screl="'+e[0]+'"]').innerHTML=ZPI18N.getString("zp.lms.course.Suggested"),document.querySelector('[_ecrel="'+e[0]+'"]')&&(document.querySelector('[_ecrel="'+e[0]+'"]').innerHTML=ZPI18N.getString("zp.lms.course.enroll"))),"skillEnroll"==s&&(document.querySelector('[_ecrel="'+e[0]+'"]')&&document.querySelector('[_ecrel="'+e[0]+'"]').remove(),document.querySelector('[_screl="'+e[0]+'"]')&&document.querySelector('[_screl="'+e[0]+'"]').remove(),document.querySelector('[rel="btn_'+e[0]+'"]').innerHTML+="<button>"+ZPI18N.getString("zp.lms.users.enrolled")+"</button>"),"enroll"==lmsusers.enrollMode?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.messages.EnrolledSuccess")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.suggestSent")),document.getElementById("active")&&"enroll"==lmsusers.enrollMode){document.getElementById("active").innerHTML="";var r=lmsusers.sortBothCoursesAndLP(t[1].activeCourseList[0].courseInfo,t[1].activeCourseList[0].planDetails);lmsusers.constructInfoBody(r)}}else ZPeople.Message.showFailureMsg(t[1].message);lmsusers.popupClose(),lmsusers.selectedUserarr=[],lmsusers.selectedUsers={},0!==l&&lmsusers.selAlluser(this,2),lmsusers.root.querySelector(".zp_slctlst.zp_ALslct1").classList.add("DN")}))},clickActionPopup:function(e){var t=e.target.getAttribute("_rel");"add"==t?lmsusers.getSelectedCourses():"close"==t&&lmsusers.popupClose()},menuAction:function(){if(lmsusers.menuCallBack=this,this.value){var e=0===document.getElementsByClassName("zp_CUlst sel").length?lmsusers.currentUserId:document.getElementsByClassName("zp_CUlst sel")[0].id;e&&(e=e.split("_")[1]),lmsusers.currentUserId||(lmsusers.currentUserId=e),lmsusers.userSuggestCourse(null,this.value)}else{var t="unenroll"==lmsusers.enrollMode?isEmpty(lmsusers.unenrollCourses)?[]:lmsusers.unenrollCourses:lmsusers.courseData;lmsusers.menuCallBack.updateOptionList(function(e,t,s,r){for(var l={},a=0;a<e.length;a++)!isEmpty(e[a])&&(l[e[a][t]+"batch"+e[a][s]]=[e[a][r],""]);return l}(t,"courseId","batchId","courseName"),lmsusers.menuCallBack.inputvalue),lmsusers.menuCallBack=null}},getSelectedCourses:function(){var e=lmsusers.popup.querySelectorAll("[_name=courseIds] [data-value]");if(e.length){var t,s=[],r=[];for(t=e.length-1;t>=0;t--)null!=e[t].getAttribute("data-value").split("batch")&&(s[t]=e[t].getAttribute("data-value").split("batch")[0],null!=e[t].getAttribute("data-value").split("batch")[1]&&"undefined"!=e[t].getAttribute("data-value").split("batch")[1]?r[t]=e[t].getAttribute("data-value").split("batch")[1]:r[t]=0);"unenroll"===lmsusers.enrollMode?lmsusers.updateUserUnenrolledCourse(s,r):lmsusers.updateUserSuggestCourse(s,r)}},updateUserUnenrolledCourse:function(e,t){var s=this.selCnt,r=(JSON.stringify(lmsusers.selectedUserarr),$("#unenrollcmnt").val()),l={method:"updateUserUnenrolledCourse",suggestCourseId:e.toString(),suggestBatchId:t.toString(),user:lmsusers.currentUserId,comment:r,mode:"multiple",conreqcsr:csrfToken};$.post("/courseUsersAction.zp",l,(function(t){if("Sucess"===t[1].registrationStatus){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.courseunenroll"));for(var r=0;r<e.length;r++){document.querySelector('[rel="userCId_'+e[r]+'"]')&&document.querySelector('[rel="userCId_'+e[r]+'"]').remove(),document.querySelector('[id="competence_lms"]')&&document.querySelector('[id="competence_lms"]').hasAttribute("class")&&"sel"==document.querySelector('[id="competence_lms"]').getAttribute("class")&&lmsusers.showCompetenceCourse("",lmsusers.userId);for(var l=0;l<lmsusers.unenrollCourses.length;l++)!isEmpty(lmsusers.unenrollCourses[l])&&lmsusers.unenrollCourses[l].courseId.includes(e[r])&&delete lmsusers.unenrollCourses[l]}lmsusers.popupClose(),lmsusers.selectedUserarr=[],lmsusers.selectedUsers={},0!==s&&lmsusers.selAlluser(this,2),lmsusers.root.querySelector(".zp_slctlst.zp_ALslct1").classList.add("DN")}else lmsusers.popupClose(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.adminerrormsg"))}))},showCompetenceCourse:function(e,t){lmsusers.userInfoPopup.querySelector("#competen").classList.remove("DN");var s={method:"getSkillBasedCourses",user:t,conreqcsr:csrfToken};$.post("/courseUsersAction.zp",s,(function(e){e[1]&&null!=e[1]&&lmsusers.viewCompetenceCourse(e[1],t)})),lmsusers.userInfoPopup.querySelector("#active").classList.add("DN"),lmsusers.userInfoPopup.querySelector("#active_lms").classList.remove("sel"),lmsusers.userInfoPopup.querySelector("#competence_lms").classList.add("sel")},viewCompetenceCourse:function(e,t){if(e.length>0){lmsusers.userInfoPopup.querySelector("#competen").innerHTML="";var s='<div class="">';$.each(e,(function(e,t){s+='<div class="zp_CPcat zp_CPshw"><div><span>'+t.skill+"</span><a></a></div>",s+='<ul class="zp_CPlst">',$.each(t[t.skill],(function(e,t){t.courseImageInfo.isSystemImage||(t.courseImageInfo.additionalInfo={fileId:t.courseId,type:6});var r=t.courseImageInfo.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+t.courseImage+".svg"):lmsfileaction.generateSourceURL(t.courseImageInfo);s+='<li> <div class="ZP_photo"><img src='+r+"></div><h4>"+t.courseName+" </h4>",null!=t.startDate&&(s+="<a>"+t.startDate+"</a>"),!t.isManagerenroll||"Self Paced Learning"!==t.courseType&&"zp.lms.settings.SelfPaced"!==t.courseType&&"Blended Learning"!==t.courseType&&"zp.lms.settings.InstructorLed"!==t.courseType?null!=t.courseState&&(s+='<div class="zp_btn"><button>'+t.courseState+"</button></li>"):null==t.courseState?(s+='<div class="zp_btn" rel="btn_'+t.courseId+'" id="suggestBtnskill"><button _rel="skillCourseSuggest" id="skillCourseSuggest" _screl="'+t.courseId+'" _brel="'+t.batchId+'">'+ZPI18N.getString("zp.lms.course.suggest")+"</button>",s+='<button _rel="skillCourseEnroll" id="skillCourseEnroll" _ecrel="'+t.courseId+'" _brel="'+t.batchId+'">'+ZPI18N.getString("zp.lms.course.enroll")+"</button>",s+="</div></li>"):"Suggested"===t.courseState?(s+='<div class="zp_btn" rel="btn_'+t.courseId+'" id="suggestBtnskill"><button id="skillCourseSuggest">'+t.courseState+"</button>",s+='<button _rel="skillCourseEnroll" id="skillCourseEnroll" _ecrel="'+t.courseId+'" _brel="'+t.batchId+'">'+ZPI18N.getString("zp.lms.course.enroll")+"</button>",s+="</li>"):s+='<div class="zp_btn"><button>'+t.courseState+"</button></li>"})),s+="</ul></div>"})),s+="</div>",lmsusers.userInfoPopup.querySelector("#competen").innerHTML+=s,lmsusers.userId=t}else lmsnodata.showNoData({mode:"general",container:document.getElementById("competen"),module:"users",content:ZPI18N.getString("zp.lms.noskillfound")})},showActive:function(){lmsusers.userInfoPopup.querySelector("#active").classList.remove("DN"),lmsusers.userInfoPopup.querySelector("#competen").classList.add("DN"),lmsusers.userInfoPopup.querySelector("#active_lms").classList.add("sel"),lmsusers.userInfoPopup.querySelector("#competence_lms").classList.remove("sel")},addFeedback:function(e,t,s){AddFeedback.init({courseId:e,batchId:t||void 0,feedbackFor:[lmsusers.currentUserId],role:AddFeedback.ROLE.MANAGER},lmsusers.addFeedbackCallback,s)},openManagerEvaluation:function(e,t,s){lmsmanagerevaluationView.viewEvaluationForManager(e,t,s)},openCourseProgress:function(e,t,s,r){for(var l=window.location.href.split("#")[0].split("/"),a="",n=0;n<l.length&&!l[n].includes("zp");n++)a+=l[n]+"/";r&&(a=a.replace("/training","")),a+=null!=t&&null!=t?"training#lms-managerview/course/"+e+"/batch/"+t+"/members?memberinfo/"+s:"training#lms-managerview/course/"+e+"/members?memberinfo/"+s,window.open(a)},openLPManagerView:function(e,t){for(var s=window.location.href.split("#")[0].split("/"),r="",l=0;l<s.length&&!s[l].includes("zp");l++)r+=s[l]+"/";r+="training#lms-managerview/learningplan/"+e+"/member/"+t,window.open(r)},clickHandler:function(e){var t=e.target,s=t.closest('[data-id="myteamview"]');s&&(lmsusers.changeTitle(t),lmsusers.infoCardClick(e,lmsusers.data));var r=t.closest('[_crel="nextpage"]');if(r&&lmsusers.getSubordinatesList(),(r=t.closest('[_crel="filternextpage"]'))&&lmsusers.filterUser(lmsusers.filterSearchUser),(r=t.closest('[_crel="designextpage"]'))&&lmsusers.filterDesignation(lmsusers.filterSearchdesig),"selsubUser"===(s=e.target.getAttribute("_rel")))lmsusers.selAlluser(t);else if("allUserSuggest"===s){lmsusers.selectedUserarr=[],lmsusers.selectedUsers={},lmsusers.root.querySelector("#users").querySelectorAll("[mrel=myteamusersel]").forEach((function(e){lmsusers.selectedUsers={};var t=e.getAttribute("id").split("usersel_")[1];lmsusers.selectedUsers.userId=t,lmsusers.selectedUserarr.push(lmsusers.selectedUsers)})),lmsusers.enrollMode="suggest",lmsusers.userSuggestCourse("all")}else if("allUserEnroll"===s){lmsusers.selectedUserarr=[],lmsusers.selectedUsers={},lmsusers.root.querySelector("#users").querySelectorAll("[mrel=myteamusersel]").forEach((function(e){lmsusers.selectedUsers={};var t=e.getAttribute("id").split("usersel_")[1];lmsusers.selectedUsers.userId=t,lmsusers.selectedUserarr.push(lmsusers.selectedUsers)})),lmsusers.enrollMode="enroll",lmsusers.userSuggestCourse("all")}else if("allUserUnenroll"===s){lmsusers.selectedUserarr=[],lmsusers.selectedUsers={},lmsusers.root.querySelector("#users").querySelectorAll("[mrel=myteamusersel]").forEach((function(e){lmsusers.selectedUsers={};var t=e.getAttribute("id").split("usersel_")[1];lmsusers.selectedUsers.userId=t,lmsusers.selectedUserarr.push(lmsusers.selectedUsers)})),lmsusers.enrollMode="unenroll",lmsusers.userSuggestCourse("all")}},clickPopUpHandler:function(e){var t=e.target,s=e.target.getAttribute("_rel");if("courseSuggest"===s)lmsusers.enrollMode="suggest",lmsusers.userSuggestCourse();else if("courseEnroll"===s)lmsusers.enrollMode="enroll",lmsusers.userSuggestCourse();else if("courseUnenroll"===s)lmsusers.enrollMode="unenroll",lmsusers.userSuggestCourse();else if(t.closest('[_crel="infonextpage"]'))lmsusers.getUserInfoDetails(lmsusers.currentUserId,null);else if("closeGrid"===s)lmsusers.closeGrid();else if("courseFeedBack"===s)lmsusers.enrollMode="feedback",lmsusers.addFeedback(t.getAttribute("courseId"),t.getAttribute("batchId"));else if("active_lms"===s)lmsusers.showActive(s);else if("competence_lms"===s)lmsusers.showCompetenceCourse(s,lmsusers.userId);else if("getCompetencycle"===s){lmsusers.showCompetenceCourse(s,lmsusers.userId);var r=lmsusers.userInfoPopup.querySelector("#userinfoCourse").scrollHeight;lmsusers.userInfoPopup.querySelector("#userinfoCourse").animate({scrollTop:r},500)}else if("skillCourseSuggest"===s){var l=e.target.getAttribute("_screl"),a=e.target.getAttribute("_brel");lmsusers.enrollMode="suggest",lmsusers.selectedUsers.userId=lmsusers.userId,lmsusers.selectedUserarr.push(lmsusers.selectedUsers);var n=[];(i=[]).push(l),null!=a&&"undefined"!=a&&n.push(a),lmsusers.updateUserSuggestCourse(i,n,"skillSuggest",s)}else if("skillCourseEnroll"===s){lmsusers.enrollMode="enroll";l=e.target.getAttribute("_ecrel"),a=e.target.getAttribute("_brel");lmsusers.selectedUsers.userId=lmsusers.userId,lmsusers.selectedUserarr.push(lmsusers.selectedUsers);var i;n=[];(i=[]).push(l),null!=a&&"undefined"!=a&&n.push(a),lmsusers.updateUserSuggestCourse(i,n,"skillEnroll",s)}else if("managerEvaluation"==s)lmsusers.openManagerEvaluation(t.getAttribute("courseId"),t.getAttribute("batchId"),lmsusers.userId);else if("courseProgress"==s||t.closest('[_rel="courseProgress"]')){var o=null==t.getAttribute("cid")?t.closest('[_rel="courseProgress"]').getAttribute("cid"):t.getAttribute("cid"),c=null==t.getAttribute("bid")?t.closest('[_rel="courseProgress"]').getAttribute("bid"):t.getAttribute("bid"),d=null==t.getAttribute("courseUserId")?t.closest('[_rel="courseProgress"]').getAttribute("courseUserId"):t.getAttribute("courseUserId");lmsusers.openCourseProgress(o,c,d,!1)}else if("learningPlanProgress"==s||t.closest('[_rel = "learningPlanProgress"')){var m=null==t.getAttribute("planid")?t.closest('[_rel="learningPlanProgress"]').getAttribute("planid"):t.getAttribute("planid");lmsusers.openLPManagerView(m,lmsusers.userId)}},resetFunction:function(){lmsusers.filterSearchUser&&(lmsusers.filterSearchUser=null),lmsusers.refer.index=1,lmsusers.filterConstruction("reset"),lmsusers.getSubordinatesList(),lmsusers.root.querySelector(".zp_slctlst.zp_ALslct1").classList.add("DN"),0!=lmsusers.root.querySelectorAll(".zp_CUlst.sel").length&&lmsusers.selAlluser(document.querySelector('[id="selectAll"]'),1)},reInitialise:function(){lmsusers.constructMenu=0,lmsusers.refer={index:1},lmsusers.selectedUsers={},lmsusers.selectedUserarr=[],lmsusers.root=lmsusers.currentUserId=lmsusers.popup=lmsusers.courseData=lmsusers.enrollMode=null},closeGrid:function(){lmsbase.removeQHash(),lmsbase.closeQHash(),lms.changeHash("hash","user","disable"),lmsusers.activeCourseIndex=1,lmsusers.activeLearningPlanIndex=1,document.getElementById("active").remove()},popupClose:function(){lmsusers.selCnt=0,lmsusers.popup.innerHTML="",lmsbase.hideMaskLayer(),lmsbase.removeListener(lmsusers.popup,"click",lmsusers.clickActionPopup,!1),lmsusers.popup=null,lmsgroupmenu.destroy(lmsusers.menuRef),lmsusers.menuRef=null},close:function(){lmsbase.removeListener(lmsusers.root,"click",lmsusers.clickHandler,!1),lmsbase.removeListener(lmsusers.root,"click",lmsusers.infoCardClick,!1),lmsusers.reInitialise()}},lmsTeam={selectedUsersArr:[],courseData:{},activeCourseIndex:1,activeLearningPlanIndex:1,selectedUsers:{},selectedUser:null,subTab:null,isFromUserCard:!1,currentUserId:null,refer:{index:1,baseUri:"",prevHash:""},userData:null,defaultValues:{tab:"reportees",subTab:"courses"},pageCallbacks:{reportees:function(){lmsMyTeam.initiate(lmsTeam.root,2)},courses:function(){lmsTeamCourses.initiate(lmsTeam.initObj)},skillset:function(){lmsTeam.constructSkillSetPage(Layout.Page.pageContWrapper.find("#lms").closest(".main-wrp"))},competency:function(){lmsMyTeam.teamUser.competencyPage(lmsTeam.initObj,!0)},assessment:function(){ZPAssessAPI.lms.renderTeamAssessments(Layout.Page.pageContWrapper.find("#lms")[0])},myassessment:function(){ZPAssessAPI.lms.renderMyDataAssessments(Layout.Page.pageContWrapper.find("#lms")[0])}},subTabPageCallBacks:{courses:function(){lmsMyTeam.teamUser.coursesPage()},competency:function(){lmsMyTeam.teamUser.competencyPage()},skillset:function(){lmsTeam.constructSkillSetPage($("#lms-teamuserview").closest(".main-wrp"),lmsMyTeam.teamUser.currentUserId,!0)},assessment:function(){ZPAssessAPI.lms.renderTeamMateAssessments(lmsMyTeam.teamUser.actDiv,lmsMyTeam.teamUser.currentUserId)}},afterLoadCallBack:function(){lms.hash.cur=window.location.hash},initCallBack:function(){ZPeople.Team.init(void 0,ZPeople.Team.erecno.lms?{usererec:ZPeople.Team.erecno.lms}:void 0)},hashChangeCallBack:function(){$.find("#lms-team_DESIGNATION").length>0&&ZPeopleComponents.select("#lms-team_DESIGNATION").destroy(),ZPeople.Team.initObj[ZPeople.Team.reporteePageMode]=!1},initiate:function(){lmsTeam.initObj=this,lmsTeam.hashMode(this),ZPeople.FireScroll.reset(),lmsbase.addListener(document,"keyup",lmsTeam.escapeHandler,!1)},hashMode:function(e){lmsTeam.reInitialise(e);var t=lmsTeam.isHashValid(e);lmsTeam.hashHandling(t)},reInitialise:function(e){lmsTeam.root=e.elem,lmsTeam.isSubTab(e)&&lmsMyTeam.teamUser.close(),lmsTeam.root.innerHTML=""},isSubTab:function(e){let t=e.hashObject;return"teamuser"==t.level2&&t.level3},isFromOrToUserCard:function(e){var t=e.hashObject;let s="teamuser"==t.level2&&Object.keys(t.level3).length>0;return lmsTeam.isFromUserCard||s},isHashValid:function(e){var t=e.hashObject;lmsTeam.defaultValues.tab=lms.hasReportee?"reportees":"courses";var s=""==t.level1||"reportees"==t.level1||"courses"==t.level1||"assessment"==t.level1||"skillset"==t.level1||"competency"==t.level1,r=this.isSubTab(e);if(r){var l=Object.keys(t.level3)[0].split("-")[0];s=""==l||"courses"==l||"assessment"==l||"skillset"==l||"competency"==l}return{valid:s,tab:t.level1||lmsTeam.defaultValues.tab,subTab:r?l||lmsTeam.defaultValues.subTab:void 0,module:"mycourses"==e.module?"mydata":e.module,userId:r?t.level3[l+"-userId"]:null}},hashHandling:function(e){e.valid?(lmsTeam.makeAndUpdateHash(e),lmsTeam.constructPage(e)):lmsTeam.revertHash()},revertHash:function(){lmsTeam.refer.prevHash?lms.changeHash("hash",lmsTeam.refer.prevHash):lms.changeHash("hash",lmsTeam.refer.baseUri+"team")},makeAndUpdateHash:function(e){var t=lmsTeam.refer,s="/"+e.tab;e.subTab&&(lmsTeam.subTab=e.subTab,s+="/teamuser/"+e.subTab+"-userId:"+e.userId);t.prevHash=t.baseUri+e.module+s,lms.changeHash("hash",t.prevHash)},constructPage:function(e){var t="mycourses"==lmsTeam.initObj.module&&"assessment"==lmsTeam.initObj.hashObject.level1?"myassessment":e.tab,s=e.subTab,r=e.userId;this.subTabPageCallBacks.hasOwnProperty(s)?(lmsMyTeam.teamUser.init(r),this.subTabPageCallBacks[s]()):this.pageCallbacks.hasOwnProperty(t)&&this.pageCallbacks[t]()},createServerSearchObjectForEnrollPopUp:function(e,t,s,r){var l={dataSource:{search:function(t){return new Promise((function(l,a){var n=e(t.query,t.pages,s,r);respObj={results:n,more:100==n.length},l(respObj)}))},paginated:!0},placeholder:ZPI18N.getString("zp.select"),dropdownList:{fitForElement:!0,isTextHTMLEncoded:!0},cacheData:!0,sort:!0,lazyLoading:!1,serverSearch:!0,showSearchField:!0,search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults")},dataMapping:{label:"name",value:"id"},isLabelHTMLEncoded:!0};ZPeopleComponents.select($(`#${t}`)).setAttributes(l)},createServerSearchObjectForPopUp:function(e,t,s,r,l){lmsbase.addListener(document.querySelector('[rel="'+t+'"'),"click",lmsTeam.clickPopupHandler,!1);resultData=[];let a={dataSource:{search:function(t){return new Promise((function(s,a){t.query,t.pages;var n=100*(t.pages-1),i=e(t.query,n,r,l);respObj={results:i,more:100==i.length},s(respObj)}))},paginated:!0},search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults"),delay:20,criteria:"startswith"},isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0,fitForElement:!0},serverSearch:!0,cacheData:!0,lazyLoading:!1,showSearchField:!0,placeholder:ZPI18N.getString("zp.select"),viewPerPage:100,dataMapping:{text:"name",value:"id",id:"batchId",id:"id"}};ZPeopleComponents.tokenfield("#"+s,a)},getDataForCourseSuggestion:function(e,t,s,r){var l=lmsTeam.getSelectedUsers(),a=0;lms.settingData[0].selfData.isSelfManagerenroll&&lms.settingData[0].iltData.isIltManagerenroll?a=1:lms.settingData[0].iltData.isIltManagerenroll?a=2:lms.settingData[0].selfData.isSelfManagerenroll&&(a=3);var n="enroll"==lmsTeam.enrollMode?1:"unenroll"==lmsTeam.enrollMode?2:0,i={method:"getCoursesForSuggestUser",usersIds:JSON.stringify(l),viewFor:n,mode:a,conreqcsr:csrfToken};e&&(i.searchtxt=e),s&&(i.isForCompetency=!0),r&&(i.skillId=r);var o=[],c={};return ZPeople.Request.sendAsyncPost("/courseAction.zp",i,(function(e){e[1]&&(lmsTeam.courseData=e[1],null!=lmsTeam.courseData?$.each(lmsTeam.courseData,(function(e,t){var s={};s.name=t.courseName;null!=t.batchId&&t.batchId;s.id=t.courseId,s.batchId=null!=t.batchId?t.batchId:0,o.push(s)})):(c.name=ZPI18N.getString("zp.nodatafound"),c.id="-1",o.push(c)))})),o},createDOMFromString:function(e){const t=document.createElement("div");return t.innerHTML=e,t.children[0]},courseCardConstruction:function(e,t){var s,r="";e.isFavourite&&(r="zpl_fav"),null==e.courseImage?(e.courseImage=s,s=Math.floor(Math.random()*Math.floor(44))+1):s=e.courseImage;var l=e.isSystem?lmsfileaction.generateSourceURL(e.courseImageInfo):ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+s+".svg"),a="zpl_Crh";e.isSystem||(a="zpl_Crh CBg"+e.bannerBGData.clrId);var n="1"==e.courseType?"PI_slf":"2"==e.courseType?"PI_ilt":"PI_emtrl",i="1"==e.courseType?ZPI18N.getString("zp.lms.settings.SelfPaced"):"2"==e.courseType?ZPI18N.getString("zp.lms.settings.InstructorLed"):ZPI18N.getString("zp.lms.settings.DigitalDownloads"),o='<div class="zpl_Cr" courseId="'+e.courseId+'" batchId="'+e.batchId+'" courseUserId= "'+(null!=e.courseUserId?e.courseUserId:"")+'"rel="Click" ><div style="background: url('+l+') right/cover" class="'+a+'"></div><div class="zpl_Crf">';if(o+=t&&e.showManagerEvaluation?'<div class="zpl_lnk" data-popup-open="viewbatch"><b>'+e.courseState+'</b></div><div class="zpl_lnk"><i class="PI_admin_prive" rel="OpenManagerEval" courseId="'+e.courseId+'" batchId="'+(null!=e.batchId?e.batchId:"")+'" onclick="teamCoursesHandlers[\'handleOpenManagerEval\'](event)"></i></div> ':'<div class="zpl_Tgclr"><a href="#">'+e.courseState+"</a></div>",o+='</div><i  class="PI_fav '+r+'" onclick="lmscourses.isFav(\''+e.courseId+'\' , event)" rel="favicon"></i><div class="zpl_Crc"><i class="'+n+'" data-ttip="'+i+'"></i><h4><i class=""></i>'+e.courseName+"</h4><p>"+(null!=e.description?e.description:"")+'</p><div class="zpl_Crp"><div><div class="ZPprobar progress " id="ZPprobar2803000036688553"><div class="progress-bar ZPprogrs PR" id="2803000036688553"></div></div></div></div></div></div></div></div>',!t)return o;$("#courseList").append(o)},getUserObject:function(e){return lmsMyTeam.usersData?lmsMyTeam.usersData.EmpDetails.filter((t=>t.ENO==e))[0]:[]},setTLTabParams:e=>{let t=Layout.Page.urlparam.userId;e.userErecno=t||lmsMyTeam.teamUser.currentUserId},updateUserDetail:function(){return'<div class="zpl_usrprfdv" name="header-profile">'+Layout.Page.Header.getUser(ZPeople.getUserDetailsById(Layout.Page.urlparam.userId),"#lms/team/reportees")+"</div>"},courseContent:function(e,t){if($("#courseList").html(""),e.length>0)lmsnodata.clearNoData($(lmsTeamCourses.root).find(".zpl_rgtcnt")[0]),$.each(e,(function(e,t){var s=teamCoursesHandlers.handleClick;lmscourses.tabName="Course Catalog";var r={container:$("#lms").find("#courseList")[0],state:{courseState:ZPI18N.getString("zp.view"),callback:s}};lmscourses.cardConstrct(t,r)}));else{var s=lmsTeamCourses.filterMode?lmsnodata.noDatav5["Course Catalog"].onFilter.title:lmsnodata.noDatav5["Course Catalog"].general.title;lmsnodata.showNoDataV5("zp_nd_desgn",s,"")}},escapeHandler:function(e){if(27==e.keyCode){var t=e.target,s=t.closest("[rel]")?t.closest("[rel]").getAttribute("rel"):"",r=!lmsTeamCourses.courseInfoPopUp||"SearchMembers"==s&&""!=e.target.value?s:"CancelCourseInfo";escapeHandlers.hasOwnProperty("handle"+r)&&escapeHandlers["handle"+r](e)}},close:function(){lmsTeam.subTab=null,lmsTeamCourses.courseInfoPopUp=null,$("#zp-contwrap-lms").removeClass("zpl_DNI"),lmsTeam.selectedUser=null,lmsMyTeam.filterInstance&&lmsMyTeam.filterInstance.closeFilter(),lmsTeam.root=null},updateUserSuggestCourse:function(e,t,s,r){var l=e.courseList,a=e.batchList,n="enroll"==lmsTeam.enrollMode?1:"unenroll"==lmsTeam.enrollMode?2:0,i={method:"updateUserSuggestCourse",suggestCourseId:l.toString(),suggestBatchId:a.toString(),usersIds:s,mode:"multiple",enrollType:n,conreqcsr:csrfToken};$.post("/courseUsersAction.zp",i,(function(e){let t=lmsTeam.PopUps.popUpConf[lmsTeam.enrollMode].popUpSelectElement;"enroll"==lmsTeam.enrollMode?ZPeopleComponents.select(t).destroy():ZPeopleComponents.tokenfield(t).destroy(),lmsTeam.PopUps.popUpConf[lmsTeam.enrollMode].popUp.remove(),1==e[1].registrationStatus?"enroll"==lmsTeam.enrollMode?(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.messages.EnrolledSuccess")),lmsMyTeam.teamUser.currentUserId&&lmsTeam.subTab?lmsTeam.subTabPageCallBacks[lmsTeam.subTab]():lmsTeam.pageCallbacks[lmsTeam.subTab]()):ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.suggestSent")):"enroll"==lmsTeam.enrollMode?ModuleComp.Msg.showWarningMsg(e[1].message):ModuleComp.Msg.showFailureMsg(e[1].message)}))},updateUserUnenrolledCourse:function(e,t){var s=e.courseList,r=e.batchList,l=(this.selCnt,$("#unenrollcmnt").val()),a={method:"updateUserUnenrolledCourse",suggestCourseId:s.toString(),suggestBatchId:r.toString(),user:t,comment:l,mode:"multiple",conreqcsr:csrfToken};$.post("/courseUsersAction.zp",a,(function(e){"Sucess"===e[1].registrationStatus?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.courseunenroll")),lmsMyTeam.teamUser.currentUserId&&lmsMyTeam.teamUser.getUserInfoDetails(lmsMyTeam.teamUser.currentUserId)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.adminerrormsg"))}))},saveUnEnroll:function(){var e,t,s;e=document.querySelector("#unEnrollCourses"),t=$('[_rel="unEnrollCourses_span"]'),s=document.querySelector('[rel="unEnrollCourse"]');var r=ZPeopleComponents.tokenfield(e).getAllValues(),l={};if(r.length>0){e.classList.remove("ztextbox__error"),t.hide();var a=[],n=[];for(var i in r)a.push(r[i].id),n.push(r[i].batchId);l.courseList=a,l.batchList=n,lmsTeam.updateUserUnenrolledCourse(l,lmsMyTeam.teamUser.currentUserId),ZPeopleComponents.tokenfield(e).destroy(),s.remove()}else e.classList.add("ztextbox__error"),t.show()},getSelectedUsers:function(){const e=lmsTeam.root.querySelectorAll(".zcheckbox__helper"),t=Array.from(e).filter((e=>e.checked));var s=[];if(lmsMyTeam.teamUser.currentUserId)(l={}).userId=lmsMyTeam.teamUser.currentUserId,s.push(l);else if(lmsTeam.selectedUser){(l={}).userId=lmsTeam.selectedUser,s.push(l)}else{const e=t.map((e=>e.getAttribute("rel")));for(var r=0;r<e.length;r++){var l;(l={}).userId=e[r],s.push(l)}}return s},saveSuggest:function(e){var t,s;t=lmsTeam.PopUps.popUpConf[e].popUpSelectElement,s=lmsTeam.PopUps.popUpConf[e].errorSpan;var r="enroll"==e?ZPeopleComponents.select(t)._optDatas:ZPeopleComponents.tokenfield(t).getAllValues(),l={};if(r&&r.length>0){t.removeClass("ztextbox__error"),s.hide();var a=[],n=[];for(var i in r)a.push(r[i].id),n.push(r[i].batchId);l.courseList=a,l.batchList=n,lmsTeam.updateUserSuggestCourse(l,1,JSON.stringify(lmsTeam.getSelectedUsers()))}else"enroll"!=lmsTeam.enrollMode&&t.classList.add("ztextbox__error"),s.show()},sortBothCoursesAndLP:function(e,t){for(var s=[],r=0,l=0;(r<e.length||l<t.length)&&s.length<50;){const a=null!=e[r]?e[r].enrolledTime:null,n=null!=t[l]?t[l].planInfo.enrolledTime:null;null==a||null!=n&&a<n?(s.push(lmsTeam.reformatCoursesOrLPForListing("lp",t[l])),lmsTeam.activeLearningPlanIndex++,l++):(s.push(lmsTeam.reformatCoursesOrLPForListing("course",e[r])),lmsTeam.activeCourseIndex++,r++)}return s},reformatCoursesOrLPForListing:function(e,t){return t.type="lp"===e?"lp":"course",t},constructSkillSetPage:function(e,t,s){Skillset.lms.loadSkillScore(e,t||erecno)}};lmsTeam.PopUps={currentPopUp:null,popupObj:{suggest:{relValue:"suggestCourse",title:ZPI18N.getString("zp.lms.suggestcourse"),description:ZPI18N.getString("zp.lms.suggestdesc"),buttonText:ZPI18N.getString("zp.lms.suggest"),closeTextRel:"CancelSuggestCourses",buttonTextRel:"SaveSuggestCourses",sections:[[{type:"label",text:ZPI18N.getString("zp.lms.choosecourse")},{type:"textarea",class:"tokenfieldId-js",rel:"suggestMenu",id:"suggestCourses",errorSpan:{placeholder:ZPI18N.getString("zp.lms.messages.coursenameempty")}}]]},unenroll:{relValue:"unenrollCourse",title:ZPI18N.getString("zp.lms.settings.Unenroll"),description:ZPI18N.getString("zp.lms.unenrolldesc"),buttonText:ZPI18N.getString("zp.lms.settings.Unenroll"),closeTextRel:"CancelUnEnrollCourses",buttonTextRel:"SaveUnEnrollCourses",sections:[[{type:"label",text:ZPI18N.getString("zp.lms.choosecourse")},{type:"textarea",class:"tokenfieldId-js",rel:"unEnrollMenu",id:"unEnrollCourses",errorSpan:{placeholder:ZPI18N.getString("zp.lms.messages.coursenameempty")}}],[{type:"label",text:ZPI18N.getString("zp.lms.messages.comments")},{type:"textarea",class:"ztextbox",id:"unenrollcmnt"}]]},enroll:{relValue:"enrollCourse",title:ZPI18N.getString("zp.lms.course.enroll"),description:ZPI18N.getString("zp.lms.enrolldesc"),buttonText:ZPI18N.getString("zp.lms.course.enroll"),closeTextRel:"CancelEnrollCourses",buttonTextRel:"SaveEnrollCourses",sections:[[{type:"label",text:ZPI18N.getString("zp.lms.choosecourse")},{type:"select",class:"select-js",rel:"enrollMenu",id:"enrollCourses",errorSpan:{placeholder:ZPI18N.getString("zp.lms.messages.coursenameempty")}}]]},unEnrollComment:{relValue:"unenrollCourseComment",title:ZPI18N.getString("zp.lms.settings.Unenroll"),buttonText:ZPI18N.getString("zp.lms.settings.Unenroll"),closeTextRel:"CancelUnEnrollCourse",buttonTextRel:"SaveUnEnrollCourse",sections:[[{type:"label",text:ZPI18N.getString("zp.lms.messages.comments")},{type:"textarea",class:"ztextbox",id:"unenrollcmnt"}]]}},popUpConf:{get enroll(){return{popUpSelectElement:$("#enrollCourses"),popUp:$("[rel=enrollCourse]"),errorSpan:$("[_rel=enrollCourses_span]")}},get suggest(){return{popUpSelectElement:$("#suggestCourses"),popUp:$("[rel=suggestCourse]"),errorSpan:$("[_rel=suggestCourses_span]")}}},createModal:function(e,t,s,r){var l=document.createElement("div");l.classList.add("zpl_mdl","zpl_mcenter","zpl_mopen"),l.setAttribute("data-modal-box",e.relValue),l.setAttribute("rel",e.relValue);var a=document.createElement("div");a.classList.add("zpl_minr");var n=lmsTeam.PopUps.createHeaderSection(e.title,e.description,e.closeTextRel),i=lmsTeam.PopUps.createContentSection(e.sections),o=lmsTeam.PopUps.createFooterSection(e.buttonText,e.buttonTextRel);return a.appendChild(n),a.appendChild(i),a.appendChild(o),l.appendChild(a),$(`[rel=${e.relValue}]`).remove(),t?t.appendChild(l):lmsTeam.root.appendChild(l),r&&lmsbase.addListener(l,"click",r,!1),lmsbase.addListener(document,"keyup",lmsTeam.PopUps.escapeHandler,!1),lmsTeam.PopUps.currentPopUp=l,l},createHeaderSection:function(e,t,s){var r=document.createElement("div");r.classList.add("zpl_mhder");var l=document.createElement("div"),a=document.createElement("h4");a.textContent=e;var n=document.createElement("p");n.textContent=t,l.appendChild(a),l.appendChild(n);var i=document.createElement("a");return i.classList.add("_cls","PI_cls"),i.setAttribute("rel",s),r.appendChild(l),r.appendChild(i),r},createFooterSection:function(e,t){var s=document.createElement("div");s.classList.add("zpl_mfoter");var r=document.createElement("button");return r.setAttribute("type","button"),r.classList.add("zlabel","zlabel--blue","zlabel--medium"),r.textContent=e,r.setAttribute("rel",t),s.appendChild(r),s},createSectionElement:function(e){var t=document.createElement("div");return t.classList.add("zpl_secn"),e.forEach((function(e){var s=lmsTeam.PopUps.createElementNode(e);t.appendChild(s)})),t},createContentSection:function(e){var t=document.createElement("div");t.classList.add("zpl_mcnt","zpl_fm");var s=document.createElement("form"),r=document.createElement("div");r.classList.add("zpl_crd");var l=document.createElement("div");return l.classList.add("zpl_crdcnt"),e.forEach((function(e){var t=lmsTeam.PopUps.createSectionElement(e);l.appendChild(t)})),r.appendChild(l),s.appendChild(r),t.appendChild(s),t},createElementNode:function(e){var t,s=document.createElement("div");return t=lmsTeam.PopUps.createAnyElement(e),s.appendChild(t),s},createTextareaElement:function(e){var t=document.createElement("textarea");if(t.classList.add(e.class),t.setAttribute("_rel",e.rel),t.id=e.id,e.placeholder){var s=document.createElement("span");s.setAttribute("_rel",e.id+"_span"),s.classList.add("ztextbox--error__label","ztextbox__error"),s.style.display="none",s.textContent=e.placeholder;var r=document.createElement("div");return r.appendChild(t),r.appendChild(s),r}return t},createAnyElement:function(e){let t=document.createElement(e.type);if($.each(Object.keys(e),(function(s,r){if("text"==r)return t.textContent=e.text,!0;"errorSpan"!=r&&t.setAttribute(r,e[r])})),e.errorSpan){let s=document.createElement("span");s.setAttribute("_rel",e.id+"_span"),s.classList.add("ztextbox--error__label","ztextbox__error"),s.style.display="none",s.textContent=e.errorSpan.placeholder;let r=document.createElement("div");return r.appendChild(t),r.appendChild(s),r}return t},escapeHandler:function(e){if(27==e.keyCode&&lmsTeam.PopUps.currentPopUp){let t=lmsTeam.PopUps.currentPopUp.getAttribute("rel"),s=lmsTeam.PopUps.popupObj[t.split("Course")[0]].closeTextRel;teamUserCardHandlers["handle"+s](e)}}};var lmsMyTeam={root:null,currentUserId:null,resArr:[],userData:{},usersData:{COUNT:{},EmpDetails:[],ModuleDetails:{userDetails:{}}},designObjs:{},mode:null,filterMode:!1,filterInstance:null,currentDesigId:null,searchText:null,employeeType:null,refer:{index:0},filterdesig:{index:1},VIEWS:{GRID:"grid",LIST:"list"},SUBORD:{DIRECT:"direct",ALL:"all"},lastRequestParams:{},currConf:{},CURRENT_SELECTED_USER:{},removeClass:function(e,t,s,r,l){$(e).find(t).find(s).on(r,(function(){$(this).siblings().removeClass(l),$(this).addClass(l)}))},initiate:function(e,t){if(-1==t);else{if(lmsMyTeam.CURRENT_SELECTED_USER={},lmsMyTeam.filterMode=!1,lmsMyTeam.resArr=[],lmsMyTeam.reInitialise(),lmsMyTeam.root=lmsusers.root=e,$(".zp_fpv").hide(),0!=t)var s=$(lmsMyTeam.root).find(".grpbtn").length>0?lmsMyTeam.getCurrentView():lmsMyTeam.VIEWS.GRID;else s=lmsMyTeam.VIEWS.LIST;lmsMyTeam.root.innerHTML="";var r=lmsMyTeam.getTopDiv(s);lmsMyTeam.root.innerHTML+=r,lmsMyTeam.root.querySelector(".grpbtn").querySelector("i[mode='"+s+"']").classList.contains("zpl_act")||lmsMyTeam.root.querySelector(".grpbtn").querySelector("i[mode='"+s+"']").classList.add("zpl_act"),$(lmsMyTeam.root).find(".zpl_brdcrmp").find(".subFilterIcn").remove(),$(lmsMyTeam.root).find(".zpl_brdcrmp").prepend(lmsMyTeam.constructTopNav(ZPeople.CURR_USER.usererec,ZPeople.CURR_USER.empid+" - <b>"+ZPeople.CURR_USER.name+"</b>",ZPeople.CURR_USER.avatar)),lmsMyTeam.setCurrentUser(ZPeople.CURR_USER.usererec,ZPeople.CURR_USER.name,ZPeople.CURR_USER.avatar),lmsMyTeam.getTeamUsers(),lmsMyTeam.removeClass(lmsMyTeam.root,".zpl_grpmnu","li","click","zpl_act"),lmsMyTeam.removeClass(lmsMyTeam.root,".grpbtn","i","click","zpl_act"),lmsbase.addListener(lmsMyTeam.root,"click",lmsMyTeam.myTeamHandler,!1),lmsbase.addListener(lmsMyTeam.root,"keydown",lmsMyTeam.myTeamHandler,!1),lmsMyTeam.setFilterInstance()}},getFilterObject:function(){let e=[];return e.push(lmsMyTeam.getDesignationFilterObject()),e},getDesignationFilterObject:function(){return{type:"select",id:"desigFil",encodeHTML:!0,label:ZPI18N.getString("zp.designation"),options:lmsMyTeam.filterConstructionByDesignation()}},getCurrentView:function(){return lmsMyTeam.root.querySelector(".grpbtn").querySelector(".zpl_act").getAttribute("mode")},getRequestParams:function(){let e={method:"getReporteeDetails",startIndex:lmsMyTeam.refer.index,needCount:!0,submode:"lms",conreqcsr:csrfToken},t={};return e.erecno=lmsMyTeam.CURRENT_SELECTED_USER.eno?lmsMyTeam.CURRENT_SELECTED_USER.eno:erecno,e.selectedReportees=lmsMyTeam.getCurrentViewMode()==lmsMyTeam.SUBORD.ALL?1:void 0,e.searchedTerm=lmsMyTeam.searchText?lmsMyTeam.searchText:void 0,t.DESIGNATION=lmsMyTeam.currentDesigId?lmsMyTeam.currentDesigId:void 0,e.filterValues=JSON.stringify(t),e},getProfileParam:()=>({mode:"reportees",employee:lmsMyTeam.CURRENT_SELECTED_USER.eno?lmsMyTeam.CURRENT_SELECTED_USER.eno:erecno}),setCurrentUser:(e,t,s)=>{void 0!==e&&void 0!==t&&void 0!==s&&(lmsMyTeam.CURRENT_SELECTED_USER.eno=e,lmsMyTeam.CURRENT_SELECTED_USER.name=t,lmsMyTeam.CURRENT_SELECTED_USER.img=s)},getCurrentViewMode:function(){return lmsMyTeam.root.querySelector(".zpl_grpmnu").querySelector(".zpl_act").getAttribute("type")},getDataforDesigFilter:function(e){var t=[],s={method:"getDesgination",conreqcsr:csrfToken,searchTxt:""==e?void 0:e};return ZPeople.Request.sendAsyncPost("/courseUsersAction.zp",s,(function(e){var s=e[1];for(var r in lmsMyTeam.designObjs=s,s){const e=s[r];t.push({label:r,value:e})}})),t},setFilterInstance:function(){lmsMyTeam.filterInstance=lmsfilterutil.getFilterInstance(lmsMyTeam.getFilterObject())},applyCallback:function(e){lmsMyTeam.disableMenu(),lmsMyTeam.resetIndex(),lmsMyTeam.resetEmpData();var t=e.appliedFilters;Object.keys(t).length?t.desigFil&&(lmsMyTeam.currentDesigId=t.desigFil.selectedvalues[0].value):lmsMyTeam.currentDesigId=null,lmsMyTeam.filterMode=0!=Object.keys(e.appliedFilters).length,lmsMyTeam.getTeamUsers()},resetCallback:function(){lmsMyTeam.currentDesigId=null,lmsMyTeam.filterMode=!1,lmsMyTeam.disableMenu(),lmsMyTeam.resetIndex(),lmsMyTeam.resetEmpData(),lmsMyTeam.getTeamUsers()},filterConstructionByDesignation:function(){return{dataSource:{search:function(e){return new Promise((function(t,s){var r=lmsMyTeam.getDataforDesigFilter(e.query);respObj={results:r,more:100==r.length},t(respObj)}))},paginated:!0},placeholder:ZPI18N.getString("zp.select"),dropdownList:{fitForElement:!0,isTextHTMLEncoded:!0},cacheData:!0,sort:!0,lazyLoading:!1,serverSearch:!0,showSearchField:!0,search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults")},isLabelHTMLEncoded:!0}},toggleClass:function(e,t){$(e).toggleClass(t)},getTopDiv:function(){return topDiv='<div class="zpl_btnmnu" id="headerTeam"><div class="zpl_lft"><div class="zpl_brdcrmp"></div></div><div class="search-cmn"> <i class="PI_lens"></i> <input type="text" class="ztextbox" id="searchBox" placeholder="'+ZPI18N.getString("zp.searchUser")+'" rel="SearchUser"> <i class="PI_cls" rel="ToggleSearch"></i> </div><div class="actn_ovrly" rel="suggestEnrollMulti"><div class="d-flexC"><button data-popup-open="alrtdetele" class="zlabel zlabel--blue zlabel--outline zlabel--medium" rel="Suggest">'+ZPI18N.getString("zp.lms.course.suggest")+'</button><button type="button" class="zlabel zlabel--blue zlabel--outline zlabel--medium" rel="Enroll">'+ZPI18N.getString("zp.lms.course.enroll")+'</button></div><div><i class="PI_cls" rel="CancelSuggestEnrollMulti"></i></div></div><div class="zpl_rgt"><ul class="zpl_grpmnu"> <li type="direct" rel="Direct" class="zpl_act"><span>'+ZPI18N.getString("zp.lms.direct")+'</span> <div class="zpl_tg"><span id="dcnt">0</span></div> </li> <li type="all" rel="All"><span>'+ZPI18N.getString("zp.lms.all")+'</span> <div class="zpl_tg"><span id="allcnt">0</span> </div></li> </ul><div class="grpbtn"><i class="PI_cardview" title="'+ZPI18N.getString("zp.gridview")+'" mode="'+lmsMyTeam.VIEWS.GRID+'" rel="GridListView"></i><i class="PI_listview" title="'+ZPI18N.getString("zp.listview")+'" mode="'+lmsMyTeam.VIEWS.LIST+'" rel="GridListView"></i></div><i class="zpl_ibg PI_lens" id="searchicon" rel="ToggleSearch"></i><i class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" rel="DesigFilter"></i></div></div><div class="zpl_rgtcnt zpl_mdltmvw" rel="viewContainer"><div _rel = "noDataContainer"></div><div class="zpl_emcrdlst" id="grid_view"></div><div id="list_view"></div></div>'},filterConstruction:function(){var e='<div id="lms-team-filter" class="zpl_fltr"><div><div class="zpl_fltrhd"><h5>Filter</h5><i class="PI_cls" title="'+ZPI18N.getString("zp.lms.close")+'" rel="CancelDesigFilter"></i></div></div><div class="zpl_fltrcnt"><div><div class="zpl_fltclps fltopn"><div id="field_container" class="zpl_fltrlst"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.Designation")+'</label></div><div><select id="desigFilter" style="display: none;"></select></div></div></div></div></div></div><div><button id="apl_filter" type="button" class="zlabel zlabel--blue zlabel--medium" rel="Apply">Apply</button><button type="button" class="zlabel zlabel--outline zlabel--medium" rel="Reset">Reset</button></div></div>';lmsTeam.root.appendChild(lmsTeam.createDOMFromString(e)),lmsMyTeam.createOptions()},createOptions:function(){lmsMyTeam.root.querySelector("#desigFilter")&&lmsMyTeam.filterConstructionByDesignation()},reInitialise:function(){lmsMyTeam.root=lmsMyTeam.currentUserId=null,lmsMyTeam.CURRENT_SELECTED_USER={},lmsMyTeam.resetIndex(),lmsMyTeam.resetEmpData(),lmsMyTeam.currentDesigId=null,lmsMyTeam.resetSearch()},getHierarchyLevel:function(e,t,s){$(lmsMyTeam.constructTopNav(e,t,s)).insertAfter($(lmsMyTeam.root).find('.zpl_brdcrmp [userid="'+lmsMyTeam.CURRENT_SELECTED_USER.eno+'"]')),lmsMyTeam.setCurrentUser(e,t,s),lmsMyTeam.resetIndex(),lmsMyTeam.resetEmpData(),lmsMyTeam.getTeamUsers()},getTeamUsers:function(){lmsMyTeam.lastRequestParams=lmsMyTeam.getRequestParams();var e=lmsMyTeam.getCurrentView(),t=$(lmsMyTeam.root);0==lmsMyTeam.refer.index&&t.find(`#${e}_view`).html(""),lmsMyTeam.removeNoData();let s=t.find("#zp_page_loading");s&&s.remove(),t.append(ZPeople.LOADING_HTML);var r=e==lmsMyTeam.VIEWS.GRID?lmsMyTeam.constructGridView:lmsMyTeam.constructListView;lmsMyTeam.getTeamUserList(lmsMyTeam.lastRequestParams,r)},getTeamUserList:function(e,t){$.post("/teamAction.zp",e,(function(e){var s=$(lmsMyTeam.root).find("[_rel=noDataContainer]");if(lmsMyTeam.showMenu(),$("#zp_page_loading").remove(),e.EmpData.EmpDetails.length>0||lmsMyTeam.refer.index>0)if(s.addClass("DNI"),$(`#${lmsMyTeam.getCurrentView()}_view`).removeClass("DNI"),lmsMyTeam.usersData.COUNT=e.EmpData.COUNT,lmsMyTeam.usersData.EmpDetails=[...lmsMyTeam.usersData.EmpDetails,...e.EmpData.EmpDetails],lmsMyTeam.usersData.ModuleDetails.userDetails={...lmsMyTeam.usersData.ModuleDetails.userDetails,...e.EmpData.ModuleDetails.userDetails},lmsMyTeam.setCount(e.EmpData.COUNT),t(e.EmpData),lmsMyTeam.refer.index=50==e.EmpData.EmpDetails.length?lmsMyTeam.refer.index+50:"end","end"==lmsMyTeam.refer.index)ZPeople.FireScroll.setParam("triggered",!0);else{ZPeople.FireScroll.setParam("triggered",!1),ZPeople.FireScroll.init(lmsMyTeam.loadMore,lms,null,!0);let e=$(lmsTeam.root);e.height()&&e.prop("scrollHeight")<=e.height()&&lmsMyTeam.loadMore()}else{s.removeClass("DNI"),$(`#${lmsMyTeam.getCurrentView()}_view`).addClass("DNI");var r=lmsnodata.noDatav5.teammatesNew.filter.title,l=lmsnodata.noDatav5.teammatesNew.filter.desc;lmsnodata.showNoDataV5("zp_nd_nodata1",r,l,s)}}))},setCount:function(e){let t=$(lmsMyTeam.root);t.find("#dcnt").text(e.DIRECT),t.find("#allcnt").text(e.ALL)},resetIndex:function(){lmsMyTeam.refer.index=0},resetEmpData:function(){lmsMyTeam.usersData={COUNT:{},EmpDetails:[],ModuleDetails:{userDetails:{}}}},resetSearch:function(){lmsMyTeam.searchText=null},loadMore:function(){lmsMyTeam.disableMenu(),lmsMyTeam.getTeamUsers()},constructTopNav:function(e,t,s){let r=t.match(/<b>(.*?)<\/b>/)[1];return 0==$(lmsMyTeam.root).find('.zpl_brdcrmp [userid="'+e+'"]').length?($(lmsMyTeam.root).find(".zpl_brdcrmp").find('div:not([userid="'+e+'"])').find(".zpl_emdts.zpl_ellipsis").hide(),$('<div class="subFilterIcn" userId="'+e+'" title="'+r+'"><span class="zpl_em"><div class="zpl_emimg CP"><img class="zpl_emimg" src="'+s+'"></div><div class="zpl_emdts zpl_ellipsis"> <div>'+t+"</div> </div></span></div>").on("click",(function(){e!=lmsMyTeam.CURRENT_SELECTED_USER.eno&&($("[userId="+e+"]").nextAll(".subFilterIcn").remove(),$(lmsMyTeam.root).find(".zpl_brdcrmp").find('div[userid="'+e+'"]').find(".zpl_emdts.zpl_ellipsis").show(),lmsMyTeam.setCurrentUser(e,t,s),lmsMyTeam.resetIndex(),lmsMyTeam.resetEmpData(),lmsMyTeam.getTeamUsers())}))):""},constructGridView:function(e){let t=lmsMyTeam.getCurrentView();var s=e.EmpDetails;let r="";$.each(s,(function(e,t){r+=lmsMyTeam.getGridViewHtml(t)})),$(lmsMyTeam.root).find(".zpl_mdltmvw").find("#"+t+"_view").append($(r))},getGradePage:function(e,t,s){for(var r=window.location.href.split("#")[0].split("/"),l="",a=0;a<r.length&&!r[a].includes("zp");a++)l+=r[a]+"/";l+=null==t||null==t?"training#lms-view/course/"+e+"/members?memberinfo/"+s:"lmsmanagerevaluation/courses/"+e+"/batch/"+t+"/members?memberinfo/"+s,window.open(l)},getGridViewHtml:function(e){let t=lmsMyTeam.getCurrentViewMode(),s='<div class="zpl_dfcrd zpl_tmusrcrd" userId="'+e.ENO+'" rel="Card">';return s+='<div class="zpl_emcrdcnt"><div class="zpl_em">',s+='<div class="zpl_emimg">',s+='<img src="'+e.EMPLOYEEPHOTO+'"></div>',s+='<div class="zpl_emdts zpl_ellipsis"">',s+="<div title="+ZSEC.Encoder.encodeForHTML(e.EMPLOYEENAME)+">"+ZSEC.Encoder.encodeForHTML(e.EMPLOYEEID)+" - <b>"+ZSEC.Encoder.encodeForHTML(e.EMPLOYEENAME)+"</b></div>",s+="<div><em>"+e.DESIGNATION+"</em></div>",s+="</div>",s+=`<div class="MLauto d-flexclm4 zpl_hvr zpl_hvrsw" rel="CommIcon"><i class="PI_pharw" uid=${e.ZUID} tabindex="0" chat_comm="true"></i>`,"direct"==t&&(s+=e.subAvilable?'<i class="PI_subordinates" title= "'+ZPI18N.getString("zp.reportees")+'" _rel = "icon" rel="SubOrdinates" erecno="'+e.ENO+'"></i>':""),s+="</div>",s+="</div>",s+="</div>",s+="</div>",s},constructListView:function(e){lmsMyTeam.constructListViewHeader(),lmsMyTeam.constructListViewHtml(e)},constructListViewHeader:function(){let e=lmsMyTeam.getCurrentView();var t='<div class="zpl_tblres"><table class="zpl_tbl">'+("<thead><tr><th>"+ZPI18N.getString("zp.employee")+"</th><th>"+ZPI18N.getString("zp.designation")+'</th></tr></thead><tbody rel="selectAllList"></tbody>')+"</table></div>";0==$(lmsMyTeam.root).find(".zpl_mdltmvw").find("#"+e+"_view").find("tbody").length&&$(lmsMyTeam.root).find(".zpl_mdltmvw").find("#"+e+"_view").html(t)},constructListViewHtml:function(e){let t=e.ModuleDetails.userDetails,s=e.EmpDetails,r=lmsMyTeam.getCurrentView(),l=lmsMyTeam.getCurrentViewMode(),a="";$.each(s,(function(e,s){let r=t[s.ENO];r&&(null!=r.potential&&r.potential),a+='<tr class="userlist" userid="'+s.ENO+'" data-id="myteamview" rel="List"><td><div class="zpl_em"><div class="zpl_emimg "><img src="'+s.EMPLOYEEPHOTO+'" ></div><div class="zpl_emdts zpl_ellipsis"><div title='+ZSEC.Encoder.encodeForHTML(s.EMPLOYEENAME)+"><em>"+ZSEC.Encoder.encodeForHTML(s.EMPLOYEEID)+" - </em><b>"+ZSEC.Encoder.encodeForHTML(s.EMPLOYEENAME)+"</b></div></div>","direct"==l&&(a+=s.subAvilable?'<div class="MLauto zpl_hvr zpl_hvrsw"> <i class="PI_subordinates" title="'+ZPI18N.getString("zp.reportees")+'" _rel="icon" rel="SubOrdinates" erecno="'+s.ENO+'"></i> </div>':""),a+="</div></td><td>"+s.DESIGNATION+"</td></tr>"})),$(lmsMyTeam.root).find(".zpl_mdltmvw").find("#"+r+"_view").find("tbody").append(a)},selectUsersForEnrollAndSuggest:function(e,t){if("all"==e){var s=lmsTeam.root.querySelector("[rel=selectAll]");s.checked=!s.checked,lmsTeam.root.querySelector("[rel=selectAllList]").querySelectorAll("[data-id=myteamview]").forEach((function(e){e.querySelector("[_rel=checkBox]").checked=s.checked})),1==s.checked?lmsTeam.root.querySelector("[rel=suggestEnrollMulti]").classList.add("opn"):lmsTeam.root.querySelector("[rel=suggestEnrollMulti]").classList.remove("opn")}else if("single"==e){var r=lmsTeam.root.querySelector('[rel="'+t+'"]');r.checked=!r.checked}const l=lmsTeam.root.querySelectorAll(".zcheckbox__helper"),a=Array.from(l).filter((e=>e.checked));a.length>0?lmsTeam.root.querySelector("[rel=suggestEnrollMulti]").classList.add("opn"):lmsTeam.root.querySelector("[rel=suggestEnrollMulti]").classList.remove("opn");const n=document.querySelectorAll(".zpl_hvr");a.length>1?n.forEach((e=>{e.classList.add("DNI")})):n.forEach((e=>{e.classList.remove("DNI")}))},constructDropDownsForCourses:function(e,t){var s;s="forCoursesTab"==e?["selfOrBlended"]:["courseOrLpFilter","sortByFilter","learnerStatusFilter"],lmsMyTeam.constructDropDowns(s,e,t)},constructDropDowns:function(e,t,s){for(var r=e.length,l=0;l<r;l++){var a={options:lmsMyTeam.getOptionsForFilter(e[l]),optionclick:s};if("forCoursesTab"==t){var n=document.querySelector("#selfOrBlended-listbox");n&&n.remove(),ZPeopleComponents.select(lmsTeam.root.querySelector("#"+e[l])).setAttributes(a)}else ZPeopleComponents.select(lmsMyTeam.teamUser.lmsTeamUserRoot.querySelector("#"+e[l])).destroy(),ZPeopleComponents.select(lmsMyTeam.teamUser.lmsTeamUserRoot.querySelector("#"+e[l])).setAttributes(a)}},getOptionsForFilter:function(e){var t=[];switch(e){case"courseOrLpFilter":t.push({label:ZPI18N.getString("zp.all"),value:"All"}),t.push({label:ZPI18N.getString("zp.lms.course"),value:"course"}),t.push({label:ZPI18N.getString("zp.lms.learningplan.learningpath"),value:"lp"});break;case"sortByFilter":t.push({label:ZPI18N.getString("zp.lms.AtoZ"),value:"asc"}),t.push({label:ZPI18N.getString("zp.lms.ZtoA"),value:"desc"});break;case"learnerStatusFilter":t.push({label:ZPI18N.getString("zp.lms.inprogress"),value:"In progress"}),t.push({label:ZPI18N.getString("zp.lms.content.Completed"),value:"Completed"});break;case"selfOrBlended":t.push({label:"All Course",value:"All"}),t.push({label:ZPI18N.getString("zp.lms.settings.SelfPaced"),value:ZPI18N.getString("zp.lms.settings.SelfPaced")}),t.push({label:ZPI18N.getString("zp.lms.settings.InstructorLed"),value:ZPI18N.getString("zp.ennterprise.blended")})}return t},infoCardClickTeam:function(e){lms.changeHash("hash","userinfo/"+e,"disable"),lmsTeam.getUserInfoDetails(e)},myTeamHandler:function(e){var t=e.target.closest("[rel]");t&&(t=t.getAttribute("rel")),myTeamHandlers.hasOwnProperty("handle"+t)&&myTeamHandlers["handle"+t](e)},disableMenu:function(){lmsMyTeam.root.querySelector(".zpl_rgt").classList.add("disabled")},showMenu:function(){lmsMyTeam.root.querySelector(".zpl_rgt").classList.remove("disabled")},removeNoData:function(){$("[_rel=noDataContainer]").html("")}};lmsMyTeam.teamUser={lmsTeamUserRoot:null,currentUserId:null,filterMode:!1,filterInstance:null,actDiv:null,init:function(e,t){lmsTeamUser=this,lmsMyTeam.teamUser.filterMode=!1,this.currentUserId=e,this.lmsTeamUserRoot=Layout.Page.pageContWrapper[0],this.actDiv=Layout.Page.pageContWrapper.find("#lms-teamuserview")[0],this.actDiv.innerHTML="",lmsMyTeam.teamUser.setFilterInstance(),lmsbase.addListener(lmsMyTeam.teamUser.lmsTeamUserRoot,"click",lmsMyTeam.teamUser.teamUserCardClickHandler,"false"),lmsbase.addListener(lmsMyTeam.teamUser.lmsTeamUserRoot,"keydown",lmsMyTeam.teamUser.teamUserCardClickHandler,"false")},layoutConstruction:function(){$("#lmsteamview").remove();var e=document.createElement("div");e.id="lmsteamview",e.classList.add("cont-wrap");var t=lmsMyTeam.teamUser.constructTeamUserBody(),s=lmsMyTeam.teamUser.constructTeamUserHeader();return e.appendChild(s),e.appendChild(t),e},constructTeamUserHeader:function(){lmsbase._role;const e=`<div class="zpl_cstmProfNav zpl_profIn">\n                            <div class="zpl_usrprfdv">\n                            <div class="zpl_bcknavi">\n                            <i class="zpl_ibg zpl_act PI_back" rel="BackButton"></i>\n                            </div>\n                            <div class="zpl_em" rel="EmpHeader"></div>\n                            </div>\n                            <ul class="zpl_tabpane" data-tab="lms_teamview_course" rel="Tabs">\n                            <li  title=${ZPI18N.getString("zp.lms.trainers.Courses")} rel="Courses"><a href="#lms/team/reportees/userinfo/courses-userId:${this.currentUserId}">${ZPI18N.getString("zp.lms.trainers.Courses")}</a></li>\n                            <li  title=${ZPI18N.getString("zp.lms.trainers.SkillSet")} class="" rel="Skillset"><a href="#lms/team/reportees/teamuser/skill${this.currentUserId}/skillset">${ZPI18N.getString("zp.lms.trainers.SkillSet")}</a></li>\n                            <li  title=${ZPI18N.getString("zp.lms.mark.Assesment")} class="" rel="Assessment"><a href="#lms/team/reportees/teamuser/${this.currentUserId}/assessment">${ZPI18N.getString("zp.lms.mark.Assesment")}</a></li>\n                            <li  title=${ZPI18N.getString("zp.lms.learningcompetency")} class="" rel="Competency"><a href="#lms/team/reportees/teamuser/${this.currentUserId}/competency">${ZPI18N.getString("zp.lms.learningcompetency")}</a></li>\n                            </ul>\n                            </div>`;return lmsTeam.createDOMFromString(e)},constructTeamUserBody:function(){const e=document.createElement("div");e.className="main-wrp";const t=e.appendChild(document.createElement("div"));t.className="zpl_container";const s=t.appendChild(document.createElement("div"));s.className="zpl_iwrpr";const r=s.appendChild(document.createElement("div"));r.className="zpl_iwrprrgt";const l=r.appendChild(document.createElement("div"));return l.className="zpl_act",l.id="lmsteamuser",lmsTeamUser.actDiv=l,e},setFilterInstance:function(){lmsMyTeam.teamUser.filterInstance=lmsfilterutil.getFilterInstance(lmsMyTeam.teamUser.getFilterObject(),$(lmsMyTeam.teamUser.actDiv))},getFilterObject:function(){let e=[];return e.push(lmsMyTeam.teamUser.getTypeFilterObject()),e.push(lmsMyTeam.teamUser.getSortByFilterObject()),e.push(lmsMyTeam.teamUser.getCourseStateFilterObject()),e},getTypeFilterObject:function(){let e=[{label:ZPI18N.getString("zp.lms.course"),value:"course"},{label:ZPI18N.getString("zp.lms.learningplan.learningpath"),value:"lp"}];return{type:"select",label:ZPI18N.getString("zp.type"),id:"typeFil",options:{options:e,placeholder:ZPI18N.getString("zp.select")}}},getSortByFilterObject:function(){let e=[{value:"asc",label:ZPI18N.getString("zp.lms.AtoZ")},{value:"desc",label:ZPI18N.getString("zp.lms.ZtoA")}];return{type:"select",label:ZPI18N.getString("zp.sortby"),id:"sortByFil",options:{options:e,placeholder:ZPI18N.getString("zp.select")}}},getCourseStateFilterObject:function(){var e=[{label:ZPI18N.getString("zp.lms.inprogress"),value:"In progress"},{label:ZPI18N.getString("zp.lms.content.Completed"),value:"Completed"}];return{type:"select",label:ZPI18N.getString("zp.state"),id:"courseStateFil",options:{options:e,placeholder:ZPI18N.getString("zp.select"),randomDataID:!1}}},applyCallBack:function(e){var t=e.appliedFilters;if(Object.keys(t).length){var s=t.typeFil?t.typeFil.selectedvalues[0].value:"All";if(t.sortByFil)var r=t.sortByFil.selectedvalues[0].value;if(t.courseStateFil)var l=t.courseStateFil.selectedvalues[0].value;var a="lp"==s&&"Completed"==l||("lp"!=s||"In progress"!=l)&&void 0,n=lmsMyTeam.teamUser.filterAndSortItems(lmsMyTeam.teamUser.courseAndLpData,null,l,s,a,r);lmsMyTeam.teamUser.filterMode=!0,lmsMyTeam.teamUser.constructCourses(void 0,n)}else lmsMyTeam.teamUser.filterMode=!1,lmsMyTeam.teamUser.constructCourses(lmsMyTeam.teamUser.courseAndLpData)},resetCallBack:function(){lmsMyTeam.teamUser.filterMode=!1,lmsMyTeam.teamUser.constructCourses(lmsMyTeam.teamUser.courseAndLpData)},filterAndSortItems:function(e,t,s,r,l,a,n){let i=e.activeCourseList,o=e.activePlanList;"All"==r&&(r=["course","lp"]);let c=[];if(r.includes("course")){let e=i.filter((e=>(!t||e.courseName.toLowerCase().includes(t.toLowerCase()))&&(!s||e.courseState===s)&&(!n||e.type===n)));c=c.concat(e)}if(r.includes("lp")){let e=o.filter((e=>(!t||e.planInfo.planName.toLowerCase().includes(t.toLowerCase()))&&(void 0===l||e.planInfo.isUserCompletedPlan===l)));c=c.concat(e)}return"asc"===a?c.sort(((e,t)=>(e.courseName||e.planInfo.planName||"").localeCompare(t.courseName||t.planInfo.planName||""))):"desc"===a&&c.sort(((e,t)=>(t.courseName||t.planInfo.planName||"").localeCompare(e.courseName||e.planInfo.planName||""))),c},coursesPage:function(){this.courseLayoutConstruction(),this.getUserInfoDetails(this.currentUserId)},setUserCardInfo:function(e){lmsreports.fday=lmsreports.getFirstDay(),lmsreports.fday=Calendar.formatDate(lmsreports.fday);var t={method:"getUserSkillCourseDetails",user:lmsMyTeam.teamUser.currentUserId,fday:lmsreports.fday,courseFilter:"progress",startIndex:lmsusers.inforefer.index,startPlan:1,conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/courseUsersAction.zp",t,(function(t){let s=t[1][0].userData[0];lmsMyTeam.teamUser.userData=t[1][0].userData[0];let r={EMPLOYEEPHOTO:s.photoPath,ENO:s.userId,EMPLOYEENAME:ZPeople.decodeTxt(s.name),EMPLOYEEID:s.employeeId,DESIGNATION:(0!==Object.keys(s.DepDes).length||s.DepDes.constructor!==Object)&&null!=s.DepDes.desigName?s.DepDes.desigName:""};lmsMyTeam.teamUser.teamUserCardHeaderConstruction(r,e)}))},filterItems:function(e){e.detail;var t=ZPeopleComponents.select($("#courseOrLpFilter")).getValue()?ZPeopleComponents.select($("#courseOrLpFilter")).getValue():"All",s=ZPeopleComponents.select($("#sortByFilter")).getValue()?ZPeopleComponents.select($("#sortByFilter")).getValue():null,r=ZPeopleComponents.select($("#learnerStatusFilter")).getValue()?ZPeopleComponents.select($("#learnerStatusFilter")).getValue():null,l="lp"==t&&"Completed"==r;lmsMyTeam.teamUser.filterAndSortItems(lmsMyTeam.teamUser.courseAndLpData,void 0,r,t,l,s);lmsMyTeam.teamUser.constructCourses(void 0,filteredItemsObject)},constructCourses:function(e,t){var s;if($("#lms-teamuserview").find("#courseList").html(""),t)s=t;else{lmsMyTeam.teamUser.courseAndLpData=e;var r=e.activeCourseList,l=e.activePlanList;s=lmsTeam.sortBothCoursesAndLP(r,l)}if(s.length>0){$("#lms-teamuserview").find("#courseList").addClass("zpl_crdgrid");let e=teamCoursesHandlers.handleOpenManagerEval,t=teamUserCardHandlers.handleClick;lmsnodata.clearNoData($("#lms-teamuserview").find("#courseList")[0]),$.each(s,(function(s,r){if("course"==r.type){lmscourses.tabName="Course Catalog";var l={container:$("#lms-teamuserview").find("#courseList")[0],state:{courseState:r.courseState,callback:t}};r.showManagerEvaluation&&(l.managerEvaluation=e),lmscourses.cardConstrct(r,l)}else lmslearningplan.layoutConstruction(r)}))}else{$("#lms-teamuserview").find("#courseList").removeClass("zpl_crdgrid");var a=lmsMyTeam.teamUser.filterMode?lmsnodata.noDatav5["Course Catalog"].onFilter.title:lmsnodata.noDatav5["Course Catalog"].general.title;lmsnodata.showNoDataV5("zp_nd_desgn",a,"",$("#lms-teamuserview").find("#courseList"))}},competencyPage:function(e,t){lmsMyTeam.teamUser.competencyLayoutConstruction(e?e.elem:e,t);var s=t?erecno:lmsMyTeam.teamUser.currentUserId,r=t?$("#lms").find(".zpl_rgtcnt"):$("#lms-teamuserview").find(".zpl_rgtcnt");t&&lmsbase.addListener(lmsTeam.root,"click",lmsMyTeam.myTeamHandler,!1),lmsMyTeam.teamUser.showCompetenceCourse(r,s,t)},destroyAllComponents:function(){for(var e=["courseOrLpFilter","sortByFilter","learnerStatusFilter"],t=0;t<e.length;t++){var s=document.querySelector("#"+e[t]+"-listbox");s&&s.remove()}},competencyLayoutConstruction:function(e,t){e=e||lmsMyTeam.teamUser.actDiv;var s='<div class="zpl_rgtcnt zpl_lmscmptncy" rel="competencyContainer" role="list"></div>';s=lmsTeam.createDOMFromString(s),e.appendChild(s)},showCompetenceCourse:function(e,t,s){var r={method:"getSkillBasedCourses",user:t,startIndex:1,conreqcsr:csrfToken};s&&(r.isForMyData=!0),e.append(ZPeople.LOADING_HTML),$.post("/courseUsersAction.zp",r,(function(t){t[1]&&t[1].length>0?(e.html(""),lmsMyTeam.teamUser.constructCompetency(t[1],s)):lmsnodata.showNoDataV5("zp_nd_fldupdt",lmsnodata.noDatav5.competencyNew.general.title,lmsnodata.noDatav5.competencyNew.general.desc,e)}))},getDataForCompetency:function(e,t){var s='<div id="collapsiblePanelId" class="collapsible">';$.each(e,(function(e,r){var l=r.skill;s+="<div><div><h4>"+l+"</h4></div>",r[l].length>0?s+='<div><div class="zpl_tblres"><table class="zpl_tbl zpl_nocrsor wd100_per"><thead><tr><th width="30%">'+ZPI18N.getString("zp.lms.course")+"</th><th>"+ZPI18N.getString("zp.date")+'</th><th width="400"></th></tr></thead><tbody>'+lmsMyTeam.teamUser.generateTableRows(r[l],t)+"</tbody></table></div></div></div>":s+="<div>"+ZPI18N.getString("zp.lms.nocoursestagged")+"</div></div>"})),s+="</div>";var r=lmsTeam.createDOMFromString(s);document.querySelector("[rel=competencyContainer]").appendChild(r),lmsMyTeam.teamUser.createCollapsiblePanels()},generateTableRows:function(e,t){var s="";if(0!=e.length)return e&&$.each(e,(function(e,r){var l=lmsTeamCourses.getInitials(r.courseName);if(s+='<tr><td><div class="zpl_em"><div class="zpl_emimg"><span class="zpl_pichr PC2">'+l+'</span></div><div class="zpl_emdts"><div title="'+r.courseName+'"><b>'+r.courseName+"</b></div></div></div></td><td><span>"+(r.enrolledDate?r.enrolledDate:"")+"</span></td><td>",r.courseState){var a="Suggested"==r.courseState?"ylwbglit":"grnbglit",n="Suggested"==r.courseState?"Suggested":"Enrolled",i="Suggested"==r.courseState&&r.isManagerenroll,o=t&&"Suggested"!=r.courseState||!0;s+='<div class="d-flexC flx_end">',s+=i?`<div class="zpl_hvr"><button id="addPolicy1" type="button" class="zlabel zlabel--blue zlabel--small zlabel--outline" rel="SingleEnroll" courseId=${r.courseId} batchId=${r.batchId}>${ZPI18N.getString("zp.lms.course.enroll")}</button></div>`:"",s+=o?`<div class="zpl_tg ${a}"><span>${n}</span></div>`:"",s+="</div>"}else s+='<div class="zpl_hvr"> ',"Enrolled"!=r.courseState&&(r.isManagerenroll||t)&&(s+=`<button id="addPolicy1" type="button" class="zlabel zlabel--blue zlabel--small zlabel--outline" rel="SingleEnroll" courseId=${r.courseId} batchId=${r.batchId}>${ZPI18N.getString("zp.lms.course.enroll")}</button>`),s+=t?"":`<button id="addPolicy1" type="button" class="zlabel zlabel--blue zlabel--small zlabel--outline" rel="SingleSuggest" courseId=${r.courseId} batchId=${r.batchId}>${ZPI18N.getString("zp.lms.suggest")}</button>`,s+="</div>";s+="</td></tr>"})),s},createCollapsiblePanels:function(){ZPeopleComponents.collapsiblepanels(document.querySelector("#collapsiblePanelId"),{toggleButtonPosition:"right",isActive:!0,className:"zpl_collapsepanel"})},constructCompetency:function(e,t){$.each(e,(function(e,s){lmsMyTeam.teamUser.constructSkillCard(s,t,e)}))},constructSkillCard:function(e,t,s){let r=t?"lms":"lms-teamuserview",l=document.createElement("div");l.className="zpl_crd",l.role="listitem",l.tabIndex=lmsConstants.TAB_INDEX.ACTIVE,l.ariaLabel=lmsMyTeam.teamUser.getLabelContent(s+1,e.skill);let a=document.createElement("div");a.className="zpl_crdcnt",a.tabIndex=lmsConstants.TAB_INDEX.ACTIVE,a.ariaLabel=ZPI18N.getString("zp.lms.proceed.list",[ZPI18N.getString("zp.competency")]);let n=document.createElement("div"),i=document.createElement("div");i.className="zpl_secn";let o=document.createElement("div"),c=lmsMyTeam.teamUser.competencyCourseCardConstruction(e,i);o.appendChild(c),i.appendChild(o),n.appendChild(i),a.appendChild(n),l.appendChild(lmsMyTeam.teamUser.constructCardHeader(e,t)),l.appendChild(a),$(`#${r}`).find("[rel=competencyContainer]")[0].appendChild(l)},getLabelContent:(e,t)=>`${ZPI18N.getString("zp.competency")} ${e}: ${t}`,constructCardHeader:function(e,t){let s=t?"myTeamHandlers['handleEnroll']":"teamUserCardHandlers['handleEnroll']",r=`<div class="zpl_crdhdr zpl_rgt"><div><h4>${e.skill}</h4></div><div>\n        <button class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="${s}(event,true)" skillId=${e.skillId}>${ZPI18N.getString("zp.lms.course.enroll")}</button>`;return r+=t?"":`<button class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="teamUserCardHandlers['handleSuggest'](event,true)"  skillId=${e.skillId}>${ZPI18N.getString("zp.lms.suggest")}</button>`,r+="</div></div>",lmsTeam.createDOMFromString(r)},competencyCourseCardConstruction:function(e,t){let s=document.createElement("div");return e[e.skill].length>0?(s.className="zpl_comptncy",s.tabIndex=0,s.ariaLabel=ZPI18N.getString("zp.lms.courses.related",[e[e.skill].length]),s.role="list",$.each(e[e.skill],(function(e,t){let r="In progress"==t.courseState?"ylw":"grn";t.courseImage.isSystemImage||(t.courseImageInfo.additionalInfo={fileId:t.courseId,type:6});var l=t.courseImageInfo.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+t.courseImage+".svg"):lmsfileaction.generateSourceURL(t.courseImageInfo);let a=document.createElement("div"),n=`<div class="zpl_em">\n            <div class="zpl_emimg">\n            <img src="${l}">\n             </div>\n            <div class="zpl_emdts zpl_ellipsis" style="">\n            <div><b title=${t.courseName}>${t.courseName}</b></div>\n            <div><span class="${r}">${t.courseState}</span></div>\n            </div>\n            </div>`;a.tabIndex=lmsConstants.TAB_INDEX.ACTIVE,a.ariaLabel=lmscourses.getCourseCardLabel(e+1,t.courseName,lmscourses.typeKeys.indexOf(t.courseType)+1),a.role="listitem",a.appendChild(lmsTeam.createDOMFromString(n)),s.appendChild(a)}))):(lmsnodata.showNoDataV5(null,ZPI18N.getString("zp.lms.course.nocoursefound"),ZPI18N.getString("zp.lms.nocoursestagged"),$(t)),$(t).find(".zpl_emptimg").remove()),s},getUserInfoDetails:function(e){lmsusers.currentUserId=e,lmsreports.fday=lmsreports.getFirstDay(),lmsreports.fday=Calendar.formatDate(lmsreports.fday),$("#lms-teamuserview").find("#courseList").append(ZPeople.LOADING_HTML);var t={method:"getUserSkillCourseDetails",user:e,fday:lmsreports.fday,courseFilter:"progress",startIndex:lmsusers.inforefer.index,startPlan:1,conreqcsr:csrfToken};$.post("/courseUsersAction.zp",t,(function(e){if(lmsMyTeam.teamUser.userData=e[1],e[1].error&&"permissionDenied"==e[1].error)return lmsnodata.showNoDataV5("zp_nd_permission",ZPI18N.getString("zp.nopermission"),"",$("#lms-teamuserview").find(".zpl_rgtcnt")),void $("[rel=teamCoursesHeader]").addClass("zpl_DNI");$("[rel=teamCoursesHeader]").removeClass("zpl_DNI"),$.each(e[1],(function(e,t){lmsMyTeam.teamUser.constructCourses(t)}))}))},courseLayoutConstruction:function(){lmsMyTeam.teamUser.actDiv.innerHTML='<div class="zpl_btnmnu" rel="teamCoursesHeader"><div class="zpl_lft"><select class="select-js" style="display: none;" id="courseOrLpFilter"></select><select class="select-js" style="display: none;" id="sortByFilter"></select><select class="select-js" style="display: none;" id="learnerStatusFilter"></select></div><div class="search-cmn"><i class="PI_lens"></i><input type="text" class="ztextbox" id="suggestFieldId" placeholder='+ZPI18N.getString("zp.searchdata")+' rel="SearchUserCourses"><i class="PI_cls" rel="ToggleSearchUserCourses"></i></div><div class="zpl_rgt"><button class="zlabel zlabel--blue zlabel--outline zlabel--medium" data-popup-open="suggest" rel="Suggest">'+ZPI18N.getString("zp.lms.course.suggest")+'</button><button class="zlabel zlabel--blue zlabel--outline zlabel--medium" data-popup-open="enroll" rel="Enroll">'+ZPI18N.getString("zp.lms.course.enroll")+'</button><button class="zlabel zlabel--red zlabel--outline zlabel--medium" data-popup-open="unenroll" rel="UnEnroll">'+ZPI18N.getString("zp.lms.settings.Unenroll")+'</button><i class="zpl_ibg PI_fltr" rel="TeamUserCardFilters"></i><i class="zpl_ibg PI_lens" rel="ToggleSearchUserCourses"></i></div></div><div class="zpl_rgtcnt"><div class="zpl_crdgrid" id="courseList" _rel="courseList"></div></div>'},teamUserCardHeaderConstruction:function(e,t){var s=$(t).find("[rel=EmpHeader]");const r=document.createElement("div");r.classList.add("zpl_emimg");const l=document.createElement("img");l.src=e.EMPLOYEEPHOTO,r.appendChild(l);const a=document.createElement("div");a.classList.add("zpl_emdts","zpl_ellipsis");const n=document.createElement("div");n.textContent=`${e.EMPLOYEEID} - `;const i=document.createElement("b");i.innerHTML=ZSEC.Encoder.encodeForHTML(e.EMPLOYEENAME),i.title=e.EMPLOYEENAME,n.appendChild(i);const o=document.createElement("div"),c=document.createElement("em");c.innerHTML=e.DESIGNATION,o.appendChild(c),a.appendChild(n),a.appendChild(o),s.append($(r)),s.append($(a))},destroyComponents:function(){var e=lmsMyTeam.teamUser.lmsTeamUserRoot,t=e.querySelector("#courseOrLpFilter"),s=e.querySelector("#sortByFilter"),r=e.querySelector("#learnerStatusFilter");t&&(ZPeopleComponents.select(t).destroy(),t.remove()),s&&(ZPeopleComponents.select(s).destroy(),s.remove()),r&&(ZPeopleComponents.select(r).destroy(),r.remove())},teamUserCardClickHandler:function(e){if(!e.key||"Enter"==e.key){var t=e.target,s=t.closest("[rel=lPlan]");if(s)s=s.getAttribute("rel"),teamUserCardHandlers["handle"+s](e);else{var r=t.closest("[rel]");r&&(r=r.getAttribute("rel")),teamUserCardHandlers.hasOwnProperty("handle"+r)&&teamUserCardHandlers["handle"+r](e)}}},close:function(){lmsMyTeam.teamUser.filterInstance&&lmsMyTeam.teamUser.filterInstance.closeFilter()}};var myTeamHandlers={handleCard:function(e,t){var s=e;lmsMyTeam.teamUser.currentUserId=s,window.location.href="#lms/team/reportees/teamuser/courses-userId:"+s},handleDirect:function(e){lmsMyTeam.disableMenu(),lmsMyTeam.resetIndex(),lmsMyTeam.resetEmpData(),ZPeople.FireScroll.reset(),lmsMyTeam.getTeamUsers()},handleAll:function(e){lmsMyTeam.disableMenu(),lmsMyTeam.resetIndex(),lmsMyTeam.resetEmpData(),ZPeople.FireScroll.reset(),lmsMyTeam.getTeamUsers()},handleSubOrdinates:function(e){let t=e.target.getAttribute("erecno"),s=lmsTeam.getUserObject(t);lmsMyTeam.getHierarchyLevel(t,`<b>${ZSEC.Encoder.encodeForHTML(s.EMPLOYEEID)} - ${ZSEC.Encoder.encodeForHTML(s.EMPLOYEENAME)}</b>`,s.EMPLOYEEPHOTO)},handleGridListView:function(){if(lmsMyTeam.usersData.EmpDetails.length>0){let e=lmsMyTeam.getCurrentView();$(lmsMyTeam.root).find("[rel=viewContainer]").children().addClass("DNI"),$(lmsMyTeam.root).find(`#${e}_view`).removeClass("DNI"),$(lmsMyTeam.root).find(`#${e}_view`).html(""),"grid"==e?lmsMyTeam.constructGridView(lmsMyTeam.usersData):lmsMyTeam.constructListView(lmsMyTeam.usersData)}},handleList:function(e){var t=e.target;lmsTeam.isFromUserCard=!1;var s=t.closest("[rel=List]"),r=null!=s?s.getAttribute("userid"):"";s&&"icon"!==t.getAttribute("_rel")&&"checkBox"!==s.getAttribute("_rel")&&(lmsMyTeam.teamUser.currentUserId=r,lms.changeHash("hash",lmsTeam.refer.baseUri+"team/reportees/teamuser/courses-userId:"+r,"disable"))},handleEnroll:function(e,t){var s=e.target;lmsTeam.enrollMode="enroll",s.closest("tr")&&(lmsTeam.selectedUser=s.closest("tr").getAttribute("userid")),lmsTeam.selectedUser=erecno,lmsTeam.PopUps.createModal(lmsTeam.PopUps.popupObj.enroll),lmsTeam.createServerSearchObjectForEnrollPopUp(lmsTeam.getDataForCourseSuggestion,"enrollCourses",t,t?s.getAttribute("skillId"):null)},handleSaveEnrollCourses:function(e){lmsTeam.subTab="competency",lmsTeam.saveSuggest("enroll")},handleSaveSuggestCourses:function(e){lmsTeam.saveSuggest("suggest")},handleSuggest:function(e){var t=e.target;lmsTeam.enrollMode="suggest",t.closest("tr")&&(lmsTeam.selectedUser=t.closest("tr").getAttribute("userid")),lmsTeam.PopUps.createModal(lmsTeam.PopUps.popupObj.suggest),lmsTeam.createServerSearchObjectForPopUp(lmsTeam.getDataForCourseSuggestion,"suggestCourse","suggestCourses")},handleDesigFilter:function(){lmsMyTeam.toggleClass(lmsMyTeam.root,"zpl_fltr_flt")},handleCancelSuggestEnrollMulti:function(){lmsTeam.root.querySelector("[rel=suggestEnrollMulti]").classList.remove("opn")},handleApply:function(e){var t=ZPeopleComponents.select(lmsMyTeam.root.querySelector("#desigFilter")).getValue();if(t){lmsMyTeam.resetIndex(),lmsMyTeam.resetEmpData(),lmsMyTeam.currentDesigId=t;var s=lmsMyTeam.designObjs;Object.keys(s).find((e=>s[e]===t));lmsMyTeam.constructAppliedFilter(),lmsMyTeam.getTeamUsers()}ZPeopleComponents.select($("#desigFilter")).destroy(),lmsMyTeam.root.querySelector("#lms-team-filter").remove()},handleReset:function(e){ZPeopleComponents.select(lmsMyTeam.root.querySelector("#desigFilter")).destroy(),lmsMyTeam.root.querySelector("#lms-team-filter").remove(),lmsMyTeam.getTeamUsers()},handleSearchUser:function(e){var t=e.target;if("Enter"===e.key||13===e.keyCode){e.preventDefault();var s=t.value;lmsMyTeam.disableMenu(),lmsMyTeam.resetIndex(),lmsMyTeam.resetEmpData(),lmsMyTeam.searchText=s,lmsMyTeam.getTeamUsers()}},handleToggleSearch:function(e){lmsMyTeam.currentDesigId=null,lmsMyTeam.filterInstance.clearBreadCrumbs();var t=searchBox.closest(".search-cmn");searchBox.value="",lmsMyTeam.toggleClass(t,"opn"),$("[rel=SearchUser]").focus(),t.className.includes("opn")||(lmsMyTeam.disableMenu(),lmsMyTeam.resetIndex(),lmsMyTeam.resetSearch(),lmsMyTeam.resetEmpData(),lmsMyTeam.getTeamUsers())},handleCancelSuggestCourses:function(e){ZPeopleComponents.tokenfield(document.querySelector('[id="suggestCourses"]')).destroy(),document.querySelector('[rel="suggestCourse"]').remove()},handleCancelEnrollCourses:function(e){ZPeopleComponents.select(document.querySelector('[id="enrollCourses"]')).destroy(),document.querySelector('[rel="enrollCourse"]').remove()},handleCancelSuggestEnrollMulti:function(e){var t=e.target.closest("[rel=SuggestEnrollMulti]");lmsMyTeam.toggleClass(t,"opn")},handleDesigFilter:function(){lmsMyTeam.filterInstance.constructFilter(),lmsMyTeam.filterInstance.setFilterCallbacks({callback:lmsMyTeam.applyCallback},{callback:lmsMyTeam.resetCallback},{callback:lmsMyTeam.applyCallback})},handleCancelDesigFilter:function(){ZPeopleComponents.select(lmsMyTeam.root.querySelector("#desigFilter")).destroy(),lmsMyTeam.root.querySelector("#lms-team-filter").remove()}},teamUserCardHandlers={handleBackButton:function(){lmsMyTeam.teamUser.destroyComponents(),$("#zp-contwrap-lms").removeClass("zpl_DNI"),$("#lmsteamview").remove(),lmsTeam.isFromUserCard=!0,lms.changeHash("hash",lmsTeam.refer.baseUri+"team/reportees"),lmsMyTeam.teamUser.currentUserId=null},handleSearchUserCourses:function(e){lmsMyTeam.teamUser.filterMode=!0;var t=e.target;if("Enter"===e.key||13===e.keyCode){e.preventDefault();var s=t.value,r=lmsMyTeam.teamUser.filterAndSortItems(lmsMyTeam.teamUser.courseAndLpData,s,null,"All",null,"asc",null);lmsMyTeam.teamUser.constructCourses(void 0,r)}},handleSingleSuggest:function(e){lmsTeam.enrollMode="suggest";var t=e.target,s={courseList:[t.getAttribute("courseId")],batchList:["undefined"!=t.getAttribute("batchId")?t.getAttribute("batchId"):0]},r=[{userId:lmsMyTeam.teamUser.currentUserId}];lmsTeam.updateUserSuggestCourse(s,2,JSON.stringify(r),e)},handleToggleSearchUserCourses:function(e){lmsMyTeam.teamUser.filterInstance.clearBreadCrumbs();var t=lmsMyTeam.teamUser.lmsTeamUserRoot.querySelector("[rel=SearchUserCourses]"),s=t.closest(".search-cmn");t.value="",lmsMyTeam.toggleClass(s,"opn"),s.className.includes("opn")||lmsMyTeam.teamUser.constructCourses(lmsMyTeam.teamUser.courseAndLpData),$(t).focus()},handleTeamUserCardFilters:function(){lmsMyTeam.teamUser.filterInstance.constructFilter(),lmsMyTeam.teamUser.filterInstance.setFilterCallbacks({callback:lmsMyTeam.teamUser.applyCallBack},{callback:lmsMyTeam.teamUser.resetCallBack},{callback:lmsMyTeam.teamUser.applyCallBack})},handleClick:function(e){lmsusers.openCourseProgress(e.courseId,e.batchId,e.courseUserId,!1)},handlelPlan:function(e){var t=e.target.getAttribute("id").split("_")[1];lmsusers.openLPManagerView(t,lmsMyTeam.teamUser.currentUserId)},handleEnroll:function(e,t){var s=e.target;lmsTeam.enrollMode="enroll",lmsTeam.PopUps.createModal(lmsTeam.PopUps.popupObj.enroll,lmsMyTeam.teamUser.lmsTeamUserRoot.querySelector("#lms-teamuserview"),teamUserCardHandlers.handleCancelEnrollCourses),lmsTeam.createServerSearchObjectForEnrollPopUp(lmsTeam.getDataForCourseSuggestion,"enrollCourses",t,t?s.getAttribute("skillId"):null)},handleSaveEnrollCourses:function(e){lmsTeam.saveSuggest("enroll")},handleSuggest:function(e,t){var s=e.target;lmsTeam.enrollMode="suggest",lmsTeam.PopUps.createModal(lmsTeam.PopUps.popupObj.suggest,lmsMyTeam.teamUser.lmsTeamUserRoot.querySelector("#lms-teamuserview"),teamUserCardHandlers.handleCancelSuggestCourses),lmsTeam.createServerSearchObjectForPopUp(lmsTeam.getDataForCourseSuggestion,"suggestCourse","suggestCourses",t,s.getAttribute("skillId"))},handleSaveSuggestCourses:function(e){lmsTeam.saveSuggest("suggest")},handleUnEnroll:function(e){e.target;lmsTeam.enrollMode="unenroll",lmsTeam.PopUps.createModal(lmsTeam.PopUps.popupObj.unenroll,lmsMyTeam.teamUser.lmsTeamUserRoot.querySelector("#lms-teamuserview"),teamUserCardHandlers.handleCancelUnEnrollCourses),lmsTeam.createServerSearchObjectForPopUp(lmsTeam.getDataForCourseSuggestion,"unEnrollCourse","unEnrollCourses")},handleCancelSuggestCourses:function(e){ZPeopleComponents.tokenfield(document.querySelector('[id="suggestCourses"]')).destroy(),document.querySelector('[rel="suggestCourse"]').remove(),lmsTeam.PopUps.currentPopUp=null},handleCancelEnrollCourses:function(e){ZPeopleComponents.select(document.querySelector('[id="enrollCourses"]')).destroy(),document.querySelector('[rel="enrollCourse"]').remove(),lmsTeam.PopUps.currentPopUp=null},handleSaveUnEnrollCourses:function(e){lmsTeam.saveUnEnroll()},handleCancelUnEnrollCourses:function(e){ZPeopleComponents.tokenfield(document.querySelector('[id="unEnrollCourses"]')).destroy(),document.querySelector('[rel="UnEnrollCourse"]').remove(),lmsTeam.PopUps.currentPopUp=null}},lmsTeamCourses={root:null,filterMode:!1,unEnrollObj:{},currentCourseId:null,initiate:function(e){lmsTeamCourses.root=e.elem,lmsTeamCourses.courseData=null,lmsTeamCourses.filterMode=!1,lmsTeamCourses.courseLayoutConstruction(),lmsTeamCourses.constructCourses(),lmsTeamCourses.root.focus(),lmsbase.addListener(lmsTeamCourses.root,"click",lmsTeamCourses.teamCoursesHandler,!1),lmsbase.addListener(lmsTeamCourses.root,"keydown",lmsTeamCourses.teamCoursesHandler,!1)},courseFilter:function(){var e=ZPeopleComponents.select(lmsTeamCourses.root.querySelector("#selfOrBlended")).getValue()?ZPeopleComponents.select(lmsTeamCourses.root.querySelector("#selfOrBlended")).getValue():void 0;"All"==e&&(e=void 0);var t={activeCourseList:lmsTeamCourses.courseData};lmsTeamCourses.filterMode=!0,t=lmsMyTeam.teamUser.filterAndSortItems(t,null,null,"course",null,"asc",e),lmsTeam.courseContent(t)},courseLayoutConstruction:function(){lmsTeamCourses.root.innerHTML='<div class="zpl_btnmnu"><div class="zpl_lft"><select class="select-js" style="display: none;" id="selfOrBlended"></select></div><div class="search-cmn"><i class="PI_lens"></i><input type="text" class="ztextbox" id="searchField" placeholder='+ZPI18N.getString("zp.searchdata")+' rel="SearchCourses"><i class="PI_cls" rel="ToggleSearchCourses"></i></div><div class="zpl_rgt"><i class="zpl_ibg PI_lens DNI" id="searchicon" rel="ToggleSearchCourses"></i></div></div><div class="zpl_rgtcnt" id="container"></div><div class="zpl_crdgrid" id="courseList" _rel="courseList"></div>'},constructCourses:function(e){var t={method:"getTeamCourses",user:erecno,startIndex:1,searchTxt:e,conreqcsr:csrfToken};$("#container").append('<div class="zpl_crdgrid" id="courseList"></div>'),$("#courseList").html(ZPeople.LOADING_HTML),$.post("/courseUsersAction.zp",t,(function(t){var s=t[1];if(lmsnodata.clearNoData(lmsTeamCourses.root.querySelector("#container")),$("#courseList").show(),s.length>0)e&&""!==e||(lmsTeamCourses.courseData=s),$(lmsTeamCourses.root).find(".zpl_btnmnu").removeClass("zpl_DNI"),lmsMyTeam.constructDropDownsForCourses("forCoursesTab",lmsTeamCourses.courseFilter),lmsTeam.courseContent(s),lmsbase.removeClass(lmsTeamCourses.root.querySelector("#searchicon"),"DNI");else{lmsTeamCourses.courseData||$(lmsTeamCourses.root).find(".zpl_btnmnu").addClass("zpl_DNI");var r=lmsTeamCourses.filterMode?lmsnodata.noDatav5["Course Catalog"].onFilter.title:lmsnodata.noDatav5["Course Catalog"].general.title;lmsnodata.showNoDataV5("zp_nd_desgn",r,""),$("#courseList").hide()}}))},teamCoursesHandler:function(e){if(27!=e.keyCode){var t=e.target.closest("[rel]");t&&(t=t.getAttribute("rel")),teamCoursesHandlers.hasOwnProperty("handle"+t)&&teamCoursesHandlers["handle"+t](e)}},constructCourseInfoPopUp:function(e){var t=lmsTeamCourses.constructCourseMembers(e);if(lmsTeamCourses.courseInfoPopUp)return $("[rel=CourseMembers]").html(""),void(t?($("[rel=CourseMembers]").append(t),lmsTeamCourses.constructPopOverElement()):lmsnodata.showNoDataV5("zp_nd_empprfl",ZPI18N.getString("zp.lms.noSubordinates"),"",$("[rel=CourseMembers]")));$("#courseInfoPopUp").remove();var s=e,r=document.createElement("div");r.className="zpl_mdl zpl_mmd zpl_mopen",r.id="courseInfoPopUp",lmsTeamCourses.courseInfoPopUp=r;var l=document.createElement("div");l.className="zpl_minr",e=e.length?s:(e=lmsTeamCourses.courseData).filter((e=>e.courseId==lmsTeamCourses.currentCourseId));var a=`<div class="zpl_mhder">${lmsTeamCourses.getCourseInfoHeader(e[0])}</div>`;a=lmsTeam.createDOMFromString(a);var n=`<div class="zpl_mcnt">${lmsTeamCourses.getCourseInfoBody()}</div>`;n=lmsTeam.createDOMFromString(n),l.append(a,n),r.appendChild(l),s!=e&&(e=[]),t?n.querySelector("[rel=CourseMembers]").appendChild(lmsTeam.createDOMFromString(t)):lmsnodata.showNoDataV5("zp_nd_empprfl",ZPI18N.getString("zp.lms.noSubordinates"),"",$(n.querySelector("[rel=CourseMembers]"))),lmsTeamCourses.root.appendChild(r),lmsTeamCourses.constructPopOverElement(),$("[rel=SearchMembers]").focus()},constructPopOverElement:function(){let e={forElement:$("#searchMemberIcon")};ZPeopleComponents.popover($("#searchMemberPopUp"),e)},getInitials:function(e){if(e&&""!=e){const t=e.split(/\s+/),s=t[0],r=t[t.length-1];return s.charAt(0).toUpperCase()+r.charAt(0).toUpperCase()}return"C"},getCourseInfoHeader:function(e){return`<div>\n                                <div class="zpl_em">\n                                <div class="zpl_emimg"><span class="zpl_pichr PC2">${lmsTeamCourses.getInitials(e.courseName)}</span></div>\n                                <div class="zpl_emdts">\n                                <div><b>${e.courseName}</b></div>\n                                <em>${e.type}</em>\n                                </div>\n                                </div>\n                                </div>\n                                <a class="_cls PI_cls" rel="CancelCourseInfo"></a>`},getCourseInfoBody:function(){return'<div class="zpl_crd">\n                          <div class="zpl_crdcnt">\n                          <div class="zpl_secn">\n                          <div rel="CourseMembers"></div>\n                         </div>\n                         </div>\n                         </div>'},getCourseMembers:function(e,t){var s={method:"getCourseProgress",courseId:e,batchId:0,startIndex:lmstrainers.inforefer.index,searchTxt:t,conreqcsr:csrfToken};lmsTeamCourses.currentCourseId=e,$.post("/courseUsersAction.zp",s,(function(e){lmsTeamCourses.constructCourseInfoPopUp(e[1])}))},roundPercentage:function(e){var t=parseFloat(e);return Math.round(t).toString()},constructCourseMembers:function(e){var t,s=e.isManagerCanUnEnroll,r=e.membersInfo.length>0&&e.membersInfo[0].showManagerEvaluation,l=e.membersInfo;return l.length>0&&(t=`<div class="zpl_tblres">\n            <table class="zpl_tbl wd100_per">\n            <thead>\n            <tr>\n            <th width="30%">\n            ${ZPI18N.getString("zp.name")}\n            <div class="zpl_icncnt">\n            <i id="searchtop-js" class="PI_lens" id="searchMemberIcon" rel="SearchMemberIcon"></i>\n            <div id="searchMemberPopUp">\n            <div class="zpl_search zpl_srchsml"><input id="empRoleSearch" rel="SearchMembers" placeholder="${ZPI18N.getString("zp.search")}" type="text" class="ztextbox w400">\n            <i class="PI_lens"></i>\n            <i class="PI_cls DIBI" rel="CloseSearch"></i>\n            </div>\n            </div></div>\n            </th>\n            <th>${ZPI18N.getString("zp.lms.joineddate")}</th>\n            <th>${ZPI18N.getString("zp.lms.progress")}</th>\n            <th width="120">${ZPI18N.getString("zp.lms.grade.overallgrade")}</th>\n            ${r||s?'<th width="150">':""}\n            <div class="text-center"></div>\n            </th>\n            </tr>\n            </thead>\n            <tbody>`,$.each(l,(function(e,r){var l=lmsTeamCourses.roundPercentage(r.completionPercentage);t+=`<tr>\n                <td><div class="zpl_em" ${r.learnerId}><div class="zpl_emimg"><span class="zpl_pichr PC2">${lmsTeamCourses.getInitials(r.learnerName)}</span></div><div class="zpl_emdts"><div><b>${r.learnerName}</b></div><em>${null!=r.batchName?r.batchName:""}</em></div></div></td>\n                <td><span>${r.enrolledDate}</span></td>\n                <td><div class="zpl_emprog w200"><span class="zpl_progtitle"><span>${l}% ${ZPI18N.getString("zp.completed")}</span></span><div class="zprogress" style="background:#DBDBDB;"><div class="zprogress__bar" style="background:#50C173; width: ${l}%;"></div></div></div> </td>\n                <td><div class="grn">${r.grade?r.grade:""}</div></td>\n                ${r.showManagerEvaluation||s?`<td><div class="text-center"><div class="zpl_hvr">${r.showManagerEvaluation?`<i class="PI_admin_prive" rel="OpenManagerEval" courseId=${r.courseId} batchId=${null!=r.batchId?r.batchId:""} erecno=${r.learnerId}></i>`:""}${s?`<button class="zlabel zlabel--red zlabel--outline zlabel--small" data-popup-open="unenroll" rel="UnEnrollUser" erecno=${r.learnerId} courseId=${r.courseId} batchId=${null!=r.batchId?r.batchId:""}>${ZPI18N.getString("zp.lms.settings.Unenroll")}</button></div></div>`:""}</td>`:""}\n                </tr>`})),t+="</tbody></table></div>"),t},openManagerEvaluation:function(e,t,s){lmsmanagerevaluationView.viewEvaluationForManager(e,t,s)}},teamCoursesHandlers={handleSearchCourses:function(e){var t=e.target;if("Enter"===e.key||13===e.keyCode){e.preventDefault();var s=t.value;lmsTeamCourses.filterMode=!0,lmsTeamCourses.constructCourses(s)}},handleSearchMemberIcon:function(){ZPeopleComponents.popover($("#searchMemberPopUp")).open()},handleCloseSearch:function(){ZPeopleComponents.popover($("#searchMemberPopUp")).close()},handleToggleSearchCourses:function(e){var t=lmsTeam.root.querySelector("[rel=SearchCourses]"),s=t.closest(".search-cmn");t.value="",lmsMyTeam.toggleClass(s,"opn"),$(t).focus(),s.className.includes("opn")||lmsTeamCourses.constructCourses()},handleSearchMembers:function(e){var t=e.target,s="Enter"===e.key||13===e.keyCode,r="Escape"==e.key||27==e.keyCode;if(s||r){e.preventDefault();var l=r?"":t.value;r&&(t.value=""),lmsTeamCourses.getCourseMembers(lmsTeamCourses.currentCourseId,l)}},handleClick:function(e){lmsTeamCourses.getCourseMembers(e.courseId)},handleCancelCourseInfo:function(){lmsTeamCourses.courseInfoPopUp.classList.remove("zpl_mopen"),lmsTeamCourses.courseInfoPopUp=null},handleOpenManagerEval:function(e){var t=e.target?e.target:null,s=t?t.getAttribute("courseId"):e.courseId,r=t?t.getAttribute("batchId")?t.getAttribute("batchId"):null:e.batchId,l=t&&t.getAttribute("erecno")?t.getAttribute("erecno"):lmsMyTeam.teamUser.currentUserId;lmsTeamCourses.openManagerEvaluation(s,r,l)},handleUnEnrollUser:function(e){var t=e.target,s=[t.getAttribute("courseId")],r=[t.getAttribute("batchId")],l=t.getAttribute("erecno"),a={courseList:s,batchList:r};lmsTeamCourses.unEnrollObj={actualSelectedVal:a,erecNo:l};var n=lmsTeamCourses.root;lmsTeam.PopUps.createModal(lmsTeam.PopUps.popupObj.unEnrollComment,n)},handleCancelUnEnrollCourse:function(){$("[rel=unenrollCourseComment]").remove()},handleSaveUnEnrollCourse:function(){lmsTeam.enrollMode="unenroll",lmsTeam.updateUserUnenrolledCourse(lmsTeamCourses.unEnrollObj.actualSelectedVal,lmsTeamCourses.unEnrollObj.erecNo),teamCoursesHandlers.handleCancelUnEnrollCourse(),lmsTeamCourses.getCourseMembers(lmsTeamCourses.currentCourseId)}};let escapeHandlers={handleSearchUser:function(e){myTeamHandlers.handleToggleSearch(e)},handleSearchCourses:function(e){teamCoursesHandlers.handleToggleSearchCourses(e)},handleSearchUserCourses:function(e){teamUserCardHandlers.handleToggleSearchUserCourses(e)},handleCancelCourseInfo:function(e){teamCoursesHandlers.handleCancelCourseInfo(e)}};var lmsUserSpace={constructSingleEnrollCard:function(e,t){ActionList.Card.removeCardloading();var s,r="courseEntity_"+t.entityId,l=$('<div class="zpl_msplst"></div>');s=`<div id=${r} courseId=${t.courseId} batchId=${t.batchId}>\n                <span class="PI_s_lms icn"></span>\n                <div class="zpl_msp-dts">\n                    <div class="zpl_msp-name">\n                        <div class="zpl_msp-title">\n                        ${t.courseName}\n                        </div>\n                    </div>\n                    <div>\n                        <em>${ZPI18N.getString("zp.lms.notification.COURSE_ENROLLED_NOTIFICATION_KEY.mail.reportee.subject.single")}</em>\n                    </div>\n                </div>                                  \n                <div class="zpl_msp-act">\n                    <div class="zpl_hvr">\n                    <a class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="lmscourses.getCourseOverView('${t.courseId}', '${t.batchId}', '${t.batchName}', '${t.isShared}', '${t.type}', '${t.courseType}', '${t.batchAdmin}',true);">View Course</a>\n                    </div>\n                </div>                                          \n            </div>\n        </div>`,l.append(s),e.append(l)},viewCourse:function(){var e=lmsUserSpace.courseData;lmscourses.getCourseOverView(e.courseId,e.batchId,e.batchName,e.isShared,e.type,e.courseType,e.batchAdmin,!0)},constructSingleResumeCard:function(e,t){lmsUserSpace.courseData=t,ActionList.Card.removeCardloading();t.entityId;var s,r=$('<div class="zpl_msplst" onclick="lmsUserSpace.viewCourse()"></div>');s=`  <div><span class="PI_s_lms icn"></span>\n                                    <div class="zpl_msp-dts">\n                                        <div class="zpl_msp-name">\n                                            <span class="zpl_msp-title">${t.courseName}</span>\n                                        </div>\n                                        <div>\n                                            <em>${null!=t.description?t.description:""}</em>\n                                        </div>\n                                    </div>\n                                    <div class="zpl_emprog w200">\n                                        <span class="zpl_progtitle">\n                                            <span>${t.completionPercentage}%</span>\n                                        </span>\n                                        <div class="zprogress">\n                                            <div class="zprogress__bar" style="width: ${t.completionPercentage}%;">\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="zpl_msp-act">\n                                        <div class="d-flexclmcap10 org">Resume</div>\n                                    </div>                                          \n                                </div>\n                           `,r.append(s),e.append(r)},constructSingleManagerEvalCard:function(e,t){ActionList.Card.removeCardloading();contentwrap.append('  <div class="zpl_msplst">\n                                    <div>\n                                        <span class="PI_s_lms icn"></span>\n                                        <div class="zpl_msp-dts">\n                                            <div class="zpl_msp-name">\n                                                <span class="zpl_msp-title">Introduction to Zoho People</span>\n                                                <span><em class="zpl_dots sm"></em><span>Manager Evaluation</span>\n                                            </span></div>\n                                            <div>\n                                                <em>Assignment is pending for the course</em>\n                                            </div>\n                                        </div>                                    \n                                        <div class="zpl_msp-act">\n                                            <div class="zpl_hvr">\n                                                <button class="zlabel zlabel--blue zlabel--medium zlabel--outline">View Assignment</button>\n                                            </div>\n                                        </div>                                          \n                                    </div>\n                                </div>\n                           '),e.append(contentwrap)}},lmsreports={type:[],s:[],k:0,studentsBars:[],trainerBars:[],coursesBars:[],fday:"",lday:"",hoursspentBar:[],reportsObj:[],elem:[],typeVar:{},reportType:1,menuObj:"",sectionIndex:1,mainTabs:"",prevReportType:1,prevFilterId:0,filterId:0,currentBar:0,_relem:"",reportId:[],headerObj:{getCoursesForType:ZPI18N.getString("zp.lms.reports.typeBasedCourse"),getcourseDepartment:ZPI18N.getString("zp.lms.reports.departmentBasedCourse"),getcourseLocation:"zp.lms.reports.locationBasedCourse",getCoursesForCategory:"zp.lms.reports.categoryBasedCourse",getCoursesForRating:"zp.lms.reports.ratingBasedCourses",getCourseMaterials:"zp.lms.reports.courseMat",gettrainerCategory:"zp.lms.reports.categoryBasedTrainers",gettrainerRating:"zp.lms.reports.ratingBasedTrainers",gettrainerLocation:"zp.lms.reports.locationBasedTrainers",getstudentCategory:"zp.lms.reports.categoryBasedLearners",getstudentLocation:"zp.lms.reports.locationBasedLearners",getstudentGrades:ZPI18N.getString("zp.lms.reports.gradeBasedLearners"),getLearnersBasedOnCourses:"zp.lms.reports.learners"},menuCache:{courses:null,timer:0},refObj:{},reference:{},I18NKey:{Courses:ZPI18N.getString("zp.lms.trainers.Courses"),Trainers:ZPI18N.getString("zp.lms.base.Trainers"),Leaners:ZPI18N.getString("zp.lms.learners")},initiate:function(){lmsreports.refObj={repCourse:[[ZPI18N.getString("zp.lms.type"),ZPI18N.getString("zp.lms.Location"),ZPI18N.getString("zp.lms.category"),ZPI18N.getString("zp.lms.rating"),ZPI18N.getString("zp.lms.materials")],["c1","c3","c4","c5","c6"]],repTrainer:[[ZPI18N.getString("zp.lms.category"),ZPI18N.getString("zp.lms.rating"),ZPI18N.getString("zp.lms.Location")],["t1","t2","t3"]],repLearner:[[ZPI18N.getString("zp.lms.category"),ZPI18N.getString("zp.lms.Location"),ZPI18N.getString("zp.lms.feedback.courses")],["l1","l2","l4"]]},lmsreports.reference={repCourse:[[ZPI18N.getString("zp.lms.reports.types"),ZPI18N.getString("zp.lms.reports.locations"),ZPI18N.getString("zp.lms.reports.categories"),ZPI18N.getString("zp.lms.reports.ratings"),ZPI18N.getString("zp.lms.reports.courses")]],repTrainer:[[ZPI18N.getString("zp.lms.reports.categories"),ZPI18N.getString("zp.lms.reports.ratings"),ZPI18N.getString("zp.lms.reports.locations")]],repLearner:[[ZPI18N.getString("zp.lms.reports.categories"),ZPI18N.getString("zp.lms.reports.locations"),ZPI18N.getString("zp.lms.reports.courses")]]},lmsreports.reinitiate(),lmsreports._relem=this.elem,lmsreports._relem.innerHTML="";var e='<div class="zp_header" id="headerposition"><div class="zp_hdtit"><h2><font>'+ZPI18N.getString("zp.lms.base.CourseReports")+"</font></h2></div>";lmsreports._relem.innerHTML=e,lmsbase.addClass(lmsreports._relem,"zp_Trpt"),lmsreports._relem.innerHTML+=lmsreports.headertabConstruction(),lmsreports.htmlConstruction(),lmsbase.addListener(lmsreports._relem,"click",lmsreports.handleMainTabs,!1)},reinitiate:function(){lmsreports.reportId=[],lmsreports.currentBar=0,lmsreports.reportType=1,lmsreports.sectionIndex=1},headertabConstruction:function(){return'<div class="zp_cwrap "><div class="zp_Lstwrap zp_Treport" _rel="outerlayer"><label class="zp_rpttab"><ul id ="MainTabs"> <li _rel = "1" _mode = "repCourse" class="sel">'+ZPI18N.getString("zp.lms.trainers.Courses")+'</li><li  _mode = "repTrainer" _rel = "2" class="">'+ZPI18N.getString("zp.lms.base.Trainers")+'</li><li _mode = "repLearner" _rel = "3">'+ZPI18N.getString("zp.lms.learners")+'</li></ul></label><div class="zp_rptcvr" id = "lmsreportssubtabs"></div>'},asyncConstruction:function(){var e="",t="",s=lmsreports.refObj.repCourse[0],r=lmsreports.refObj.repCourse[1];lmsreports._relem.querySelector('[class="zp_rptcvr"]').innerHTML="",e='<label class="zp_rptcnt"><div class="zp_rptsec"> <div>',e+='<ul id="lmsreportstabs">';for(var l=0;l<s.length;l++)0==l&&(t="sel"),e+='<li rel="'+r[l]+'" class="'+t+'"><h4>'+s[l]+'</h4><p _rel = "types"></p></li>',t="";e+='</ul><div><div class="zp_Rcat"><div _rel="reportsfter"></div></div><div id="lmsreport1"><div class="ctable "><div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div></div></div></div> </div>',lmsreports._relem.querySelector('[class="zp_rptcvr"]').innerHTML+=e,lmsreports.setBar(lmsreports.coursesBars[lmsreports.currentBar],lmsreports.coursesBars[lmsreports.currentBar+1],"getCoursesForType",null,null,ZPI18N.getString("zp.lms.coursetypereport"),ZPI18N.getString("zp.lms.settings.AllowedCourseType"),ZPI18N.getString("zp.lms.coursecount"),"coursesData","",!1,!0),lmsreports.setNumber("courses")},htmlConstruction:function(){lmsreports.getCoursesData(lmsreports.asyncConstruction)},viewFilter:function(e,t,s,r){var l=lmsreports._relem.querySelector('[id="lmsreportssubtabs"]');lmsreports.menuObj=lmsgroupmenu.initiate(l.querySelector('[_rel="reportsfter"]')),l.querySelector('[_rel="reportsfter"]').innerHTML='<div class="zp_Sm" _rel="filterRep">';var a=l.querySelector('[_rel="filterRep"]');lmsreports.createMenu(e,a,t,s,r)},getFirstDay:function(){var e=new Date,t=e.getDay(),s=e.getDate()-t+(0==t?-6:1);return new Date(e.setDate(s))},getLastDay:function(){var e=new Date,t=e.getDay(),s=e.getDate()-t+7;return new Date(e.setDate(s))},handleMainTabs:function(e,t,s){var r=e.target.closest('[id="lmsreportstabs"]');if(r)lmsreports.handleTabs(e);else if(r=e.target.closest('[id="MainTabs"]')){var l="";if(!t){var a=e.target.closest("ul").querySelector('[class="sel"]');if(!e.target.closest("li"))return;null!=a&&(a.className=""),e.target.closest("li").className="sel",s=e.target.closest("li").getAttribute("_mode")}if(s){var n=lmsreports._relem.querySelector('[class="zp_rptlst"]');n&&(lmsreports.startIdx="end",lmsreports.lastRequestParams=null,lmsreports.isScrollEventAdded=!1,lmsbase.removeListener(lmsreports._relem.querySelector('[_rel="outerlayer"]'),"scroll",lmsreports.scrollHandle,!1),n.parentNode.removeChild(n))}$(".zp_rptsec").html(""),l="<div>",l+='<ul id="lmsreportstabs">';for(var i=lmsreports.refObj[s][0],o=lmsreports.refObj[s][1],c=0;c<i.length;c++)l+=0==c?'<li rel="'+o[c]+'" class="sel"><h4>'+i[c]+'</h4><p _rel = "types"></p></li>':'<li rel="'+o[c]+'"><h4>'+i[c]+'</h4 ><p _rel = "types"></p></li>';l+='</ul><div><div class="zp_Rcat"><div _rel="reportsfter"></div></div><div id="lmsreport1"><div class="ctable "><div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div></div></div></div> </div>',lmsreports._relem.querySelector('[class="zp_rptsec"]').innerHTML+=l,lmsreports.currentBar=0,"repCourse"==s?(lmsreports.sectionIndex=1,0==lmsreports.coursesBars.length?lmsreports.getCoursesData(lmsreports.asyncConstruction):(lmsreports.setNumber("courses"),lmsreports.setBar(lmsreports.coursesBars[lmsreports.currentBar],lmsreports.coursesBars[lmsreports.currentBar+1],"getCoursesForType",null,null,ZPI18N.getString("zp.lms.coursetypereport"),ZPI18N.getString("zp.lms.settings.AllowedCourseType"),ZPI18N.getString("zp.lms.coursecount"),"coursesData","",!1,!0))):"repLearner"==s?(lmsreports.sectionIndex=3,0==lmsreports.studentsBars.length?lmsreports.getStudentData():(lmsreports.setNumber("students"),lmsreports.setBar(lmsreports.studentsBars[lmsreports.currentBar],lmsreports.studentsBars[lmsreports.currentBar+1],"getstudentCategory",null,null,ZPI18N.getString("zp.lms.studentcategoryreport"),ZPI18N.getString("zp.lms.course.categories"),ZPI18N.getString("zp.lms.learnercount"),"studentCategory","",!1,!0))):"repTrainer"==s&&(lmsreports.sectionIndex=2,0==lmsreports.trainerBars.length?lmsreports.trainerData(1):(lmsreports.setNumber("trainers"),lmsreports.setBar(lmsreports.trainerBars[lmsreports.currentBar],lmsreports.trainerBars[lmsreports.currentBar+1],"gettrainerCategory",null,null,ZPI18N.getString("zp.lms.trainercategoryreport"),ZPI18N.getString("zp.lms.course.categories"),ZPI18N.getString("zp.lms.trainercount"),"trainerCategory","",!1,!0)))}},handleTabs:function(e){var t=e.target,s=t.closest("li"),r=null;if(t.closest("ul")&&(r=t.closest("ul").querySelector('[class="sel"]')),null!=r&&(r.className=""),null!=s){s.className="sel";var l=s.getAttribute("rel");if(l){var a=lmsreports._relem.querySelector('[class="zp_rptlst"]');a&&(lmsreports.startIdx="end",lmsreports.lastRequestParams=null,lmsreports.isScrollEventAdded=!1,lmsbase.removeListener(lmsreports._relem.querySelector('[_rel="outerlayer"]'),"scroll",lmsreports.scrollHandle,!1),a.parentNode.removeChild(a))}"l1"==l?(lmsreports.currentBar=0,lmsreports._relem.querySelector("[_rel=reportsfter]").innerHTML="",lmsreports.setNumber("students"),lmsreports.setBar(lmsreports.studentsBars[0],lmsreports.studentsBars[1],"getstudentCategory",null,null,ZPI18N.getString("zp.lms.studentcategoryreport"),ZPI18N.getString("zp.lms.course.categories"),ZPI18N.getString("zp.lms.learnercount"),"studentCategory","",!1,!0)):"l2"==l?(lmsreports.currentBar=2,lmsreports._relem.querySelector("[_rel=reportsfter]").innerHTML="",lmsreports.setNumber("students"),lmsreports.setBar(lmsreports.studentsBars[2],lmsreports.studentsBars[3],"getstudentLocation",null,null,ZPI18N.getString("zp.lms.studentLocationreport"),ZPI18N.getString("zp.lms.locations"),ZPI18N.getString("zp.lms.learnercount"),"studentLocation","",!1,!0)):"l4"==l?(lmsreports.currentBar=4,params={method:"getLeanersFilterData",reportId:4},apiName="lmsReportsAction.zp",lmsreports.viewFilter(lmsreports.fetchCourses,[ZPI18N.getString("zp.lms.reports.allCourses")],params,apiName),lmsreports.setBar(lmsreports.studentsBars[4],null,"getLearnersBasedOnCourses",lmsreports.studentsBars[5],null,ZPI18N.getString("zp.lms.reports.leanersCourseProgressReport"),ZPI18N.getString("zp.lms.feedback.courses"),ZPI18N.getString("zp.lms.learnercount"),"studentCourses","multi",!0,!0,!0)):"t1"==l?(lmsreports.currentBar=0,lmsreports.setBar(lmsreports.trainerBars[0],lmsreports.trainerBars[1],"gettrainerCategory",null,null,ZPI18N.getString("zp.lms.trainercategoryreport"),ZPI18N.getString("zp.lms.course.categories"),ZPI18N.getString("zp.lms.trainercount"),"trainerCategory","",!1,!0)):"t2"==l?(lmsreports.currentBar=2,lmsreports.setBar(lmsreports.trainerBars[2],lmsreports.trainerBars[3],"gettrainerRating",null,null,ZPI18N.getString("zp.lms.trainerratingreport"),ZPI18N.getString("zp.lms.reports.rating"),ZPI18N.getString("zp.lms.trainercount"),"trainerRating","",!1,!1)):"t3"==l?(lmsreports.currentBar=4,lmsreports.setBar(lmsreports.trainerBars[4],lmsreports.trainerBars[5],"gettrainerLocation",null,null,ZPI18N.getString("zp.lms.trainerlocationreport"),ZPI18N.getString("zp.lms.locations"),ZPI18N.getString("zp.lms.trainercount"),"trainerLocation","",!1,!0)):"c1"==l?(lmsreports.currentBar=0,lmsreports.setBar(lmsreports.coursesBars[0],lmsreports.coursesBars[1],"getCoursesForType",null,null,ZPI18N.getString("zp.lms.coursetypereport"),ZPI18N.getString("zp.lms.settings.AllowedCourseType"),ZPI18N.getString("zp.lms.coursecount"),"coursesData","",!1,!0)):"c2"==l?(lmsreports.currentBar=2,lmsreports.setBar(lmsreports.coursesBars[2],lmsreports.coursesBars[3],"getcourseDepartment",null,null,ZPI18N.getString("zp.lms.coursedepartmentreport"),ZPI18N.getString("zp.lms.coursecount"),"departmentData",!1)):"c3"==l?(lmsreports.currentBar=2,lmsreports.setBar(lmsreports.coursesBars[2],lmsreports.coursesBars[3],"getcourseLocation",null,null,ZPI18N.getString("zp.lms.courselocationreport"),ZPI18N.getString("zp.lms.locations"),ZPI18N.getString("zp.lms.coursecount"),"locationData","",!1,!0)):"c4"==l?(lmsreports.currentBar=4,lmsreports.setBar(lmsreports.coursesBars[4],lmsreports.coursesBars[5],"getCoursesForCategory",null,null,ZPI18N.getString("zp.lms.courseCategoryReport"),ZPI18N.getString("zp.lms.course.categories"),ZPI18N.getString("zp.lms.coursecount"),"categoryData","",!1,!0)):"c5"==l?(lmsreports.currentBar=6,lmsreports.setBar(lmsreports.coursesBars[6],lmsreports.coursesBars[7],"getCoursesForRating",null,null,ZPI18N.getString("zp.lms.courseRatingReport"),ZPI18N.getString("zp.lms.reports.rating"),ZPI18N.getString("zp.lms.coursecount"),"ratingData","",!1,!1)):"c6"==l&&(lmsreports.currentBar=8,lmsreports.setBar(lmsreports.coursesBars[8],null,"getCourseMaterials",lmsreports.coursesBars[9],null,ZPI18N.getString("zp.lms.reports.courseMatReport"),ZPI18N.getString("zp.lms.feedback.courses"),ZPI18N.getString("zp.lms.reports.materialsCount"),"courseMaterials","multi",!0,!0,!1))}},fetchCourses:function(){currInstance=this,currInstance.value?(clearTimeout(lmsreports.menuCache.timer),lmsreports.menuCache.timer=setTimeout((function(){lmsreports.updateOptions(currInstance)}),1e3)):lmsreports.updateOptions(currInstance)},updateOptions:function(e){params={action:"fetchCourseList"},e.value&&(params.searchName=e.value),null==lmsreports.menuCache.courses||e.value?$.get("/messageAction.zp",params,(function(t){for(e.value||(menuObject={},menuObject[0]=["All Courses"],menuObject[1]=[ZPI18N.getString("zp.lms.thisweek")],menuObject[2]=[ZPI18N.getString("zp.lms.thismonth")],menuObject[3]=[ZPI18N.getString("zp.lms.threemonthsback")],menuObject[4]=[ZPI18N.getString("zp.lms.sixmonthsback")]),i=0;i<t.courses.length;i++)menuObject[t.courses[i].courseId]=[t.courses[i].courseName];e.updateOptionList(menuObject,e.value),!e.value&&(lmsreports.menuCache.courses=menuObject)})):e.updateOptionList(lmsreports.menuCache.courses,this.value)},getHeaderAndIndex:function(e,t,s,r,l){if(e){switch(e){case"inprogress":st=ZPI18N.getString("zp.lms.inprogress"),idx=1;break;case"completed":st=ZPI18N.getString("zp.lms.content.Completed"),idx=2;break;case"overdueCompleted":st=ZPI18N.getString("zp.lms.reports.overdueCompleted"),idx=3;break;case"overdue":st=ZPI18N.getString("zp.lms.overdue"),idx=4;break;case"filesCount":st=ZPI18N.getString("zp.lms.content.files"),idx=1;break;case"linksCount":st=ZPI18N.getString("zp.customlink"),idx=2;break;case"contentsCount":st=ZPI18N.getString("zp.lms.reports.contents"),idx=3;break;default:st="Default case",idx=-1}return t?"getLearnersBasedOnCourses"==r?ZPI18N.getString(lmsreports.headerObj[r],[l,st]):"getCourseMaterials"==r?ZPI18N.getString(lmsreports.headerObj[r],[st,l]):void 0:s?idx:st}},scrollHandle:function(){"end"!=lmsreports.startIdx&&this.scrollHeight-this.scrollTop-this.clientHeight<1&&lmsreports.getBarDetails(lmsreports.lastRequestParams.name,lmsreports.lastRequestParams.data,!1,lmsreports.lastRequestParams.seriesId,lmsreports.startIdx,null)},getBarDetails:function(e,t,s,r,l,a){if("gettrainerHoursSpent"!=e){var n={action:e,reportType:lmsreports.reportType,data:ZPeople.decodeTxt(t),startIdx:l,status:lmsreports.getHeaderAndIndex(r,!1,!0)};"getCourseMaterials"==e&&(delete n.data,-1!=t.indexOf("+")?(n.courseId=t.split("+")[0],n.batchId=t.split("+")[1]):n.courseId=t),$.get("/lmsReportsAction.zp",n,(function(t){var l=lmsreports._relem.querySelector('[class="zp_rptlst"]');l&&s&&l.parentNode.removeChild(l);var n={};null!=t[1]&&(n=t[1].Details);var o="";o="getcourseLocation"==e||"getCoursesForCategory"==e||"getCoursesForRating"==e||"gettrainerLocation"==e||"gettrainerRating"==e||"gettrainerCategory"==e||"getstudentLocation"==e||"getstudentCategory"==e?ZPI18N.getString(lmsreports.headerObj[e],[a]):"getLearnersBasedOnCourses"==e||"getCourseMaterials"==e?lmsreports.getHeaderAndIndex(r,!0,!1,e,a):lmsreports.headerObj[e];var c="";if(s&&(c='<label class="zp_rptlst" _rel="reportsList"><div><h5>'+o+'</h5><div _rel="exportOpts"></div></div><ul class="zp_CPlst">'),n)if("Courses"===t[1].type)for(i=0;i<n.length;i++){var d=n[i].courseImageInfo;d.additionalInfo={fileId:n[i].courseId,type:6},c+='<li><div class="ZP_photo"><img src='+(d.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+n[i].courseImage+".svg"):lmsfileaction.generateSourceURL(d))+"></div><h4>"+n[i].courseName+"</h4><span>"+n[i].type+"</span></li>"}else if("Students"===t[1].type)for(i=0;i<n.length;i++)c+='<li><div class="ZP_photo"><img src= '+n[i].photoPath+"></div><h4><i>"+n[i].employeeId+"</i>"+n[i].name+"</h4></li>";else if("Trainers"===t[1].type)for(i=0;i<n.length;i++)c+='<li><div class="ZP_photo"><img src='+n[i].trainerImage+"></div><h4><i>"+n[i].trainerEmployeeId+"</i>"+n[i].trainerName+" </h4></li>";else if("Course materials"===t[1].type)for(i=0;i<n.length;i++)c+="<li><h4>"+(n[i].fileName||n[i].linkName)+" </h4></li>";s?(c+="</ul></label>",$(".zp_rptsec").append(c)):$(".zp_CPlst").append(c),"getLearnersBasedOnCourses"==e&&(lmsreports.constructExport(lmsreports._relem.querySelector('[_rel="exportOpts"]')),lmsreports.isScrollEventAdded||50!=n.length?lmsreports.startIdx=50==n.length?lmsreports.startIdx+n.length:"end":(lmsbase.addListener(lmsreports._relem.querySelector('[_rel="outerlayer"]'),"scroll",lmsreports.scrollHandle,!1),lmsreports.startIdx=n.length,lmsreports.isScrollEventAdded=!0))}))}},constructExport:function(e){html='<div class="zp_dropbtn"><div _rel=menuEl><span _rel="1">'+ZPI18N.getString("zp.lms.reports.exportAsXLS")+'</span><i class="IC-adwn" _rel="addMenu"></i></div></div>',e.innerHTML=html,menuData={},menuData[2]=[ZPI18N.getString("zp.lms.reports.exportAsXLSX")],menuData[3]=[ZPI18N.getString("zp.lms.reports.exportAsCSV")],menuData[4]=[ZPI18N.getString("zp.lms.reports.exportAsTSV")],lmsbase.addListener(e,"click",(function(e){ele=e.target,_rel=ele.getAttribute("_rel"),1==_rel?lmsreports.exportData(1):"addMenu"==_rel&&lmsmenu.initiate({elem:ele.closest("[_rel=menuEl]"),width:"130px",type:"dropdown",arrowHead:!1,menulist:[menuData],eve:e}).on("click",(function(){lmsreports.exportData(this.value)})).bind()}))},exportData:function(e){"getLearnersBasedOnCourses"==lmsreports.lastRequestParams.name&&(name="exportLearnersBasedOnCourses");var t="lmsReportsAction.zp?action="+name+"&reportType="+lmsreports.reportType+"&data="+lmsreports.lastRequestParams.data+"&exportType="+e+"&status="+lmsreports.getHeaderAndIndex(lmsreports.lastRequestParams.seriesId,!1,!0),s=document.createElement("form");s.id="lmsformexport";var r=document.createElement("input");s.setAttribute("method","post"),s.setAttribute("action",t),s.setAttribute("target","exportresp"),r.setAttribute("type","hidden"),r.setAttribute("name","conreqcsr"),r.setAttribute("value",csrfToken),s.appendChild(r),document.body.appendChild(s),s.submit(),$("#lmsformexport").remove()},createMenu:function(e,t,s,r,l){lmsreports.menuObj.insertMenu({elem:t,type:"select",mode:"single",menulist:e,click:function(e){lmsreports.constructReportOnsearch(e,r,l)}}),lmsmenu.changeToSelectMenu(t,{},"single",null,s)},constructReportOnsearch:function(e,t,s){if(lmsreports.filterId=e.value,lmsreports.prevFilterId!=lmsreports.filterId){if(lmsreports.prevFilterId=e.value,relId=lmsreports._relem.querySelector("[id=lmsreportstabs]").querySelector(".sel").getAttribute("rel"),"0"==e.value&&"l4"==relId)return lmsreports.setBar(lmsreports.studentsBars[4],null,"getLearnersBasedOnCourses",lmsreports.studentsBars[5],null,ZPI18N.getString("zp.lms.reports.leanersCourseProgressReport"),ZPI18N.getString("zp.lms.feedback.courses"),ZPI18N.getString("zp.lms.learnercount"),"studentCourses","multi",!0,!0,!0),void(lmsreports._relem.querySelector("[rel="+relId+"]").querySelector("[_rel=types]").innerHTML=lmsreports.typeVar.student[3]+" "+lmsreports.reference.repLearner[0][2]);lmsreports._relem.querySelector("[id=lmsreport1]").innerHTML='<div class="ctable "><div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div></div>';var r=lmsreports._relem.querySelector("[_rel=reportsList]");r&&r.parentNode.removeChild(r),t.recordId=e.value,t.conreqcsr=csrfToken,$.post("/"+s,t,(function(e){"l4"==relId&&(colorArr={completed:"#00bd9e",inprogress:"#458bd6",overdue:"#e95b6d",overdueCompleted:"#faba59"},tempArr=[],lmsreports.setDataForMultipleBars(e[1].studentCourses,colorArr,tempArr,"","studentCourses"),lmsreports._relem.querySelector("[rel="+relId+"]").querySelector("[_rel=types]").innerHTML=Object.keys(e[1].studentCourses).length+" "+lmsreports.reference.repLearner[0][2],lmsreports.setBar(tempArr[0],null,"getLearnersBasedOnCourses",tempArr[1],null,ZPI18N.getString("zp.lms.reports.leanersCourseProgressReport"),ZPI18N.getString("zp.lms.feedback.courses"),ZPI18N.getString("zp.lms.learnercount"),"studentCourses","multi",!0,!0,!0))}))}},getStudentData:function(){var e={action:"getLearnersReports",reportType:lmsreports.reportType,repType:"adminReports"};$.get("/lmsReportsAction.zp",e,(function(e){lmsreports.studentsBars=[],lmsreports.typeVar.student=[],e[1].studentCategory&&(lmsreports.setData(e[1].studentCategory,lmsreports.studentsBars,"student","studentCategory"),lmsreports.setBar(lmsreports.studentsBars[lmsreports.currentBar],lmsreports.studentsBars[lmsreports.currentBar+1],"getstudentCategory",null,null,ZPI18N.getString("zp.lms.studentcategoryreport"),ZPI18N.getString("zp.lms.course.categories"),ZPI18N.getString("zp.lms.learnercount"),"studentCategory","",!1,!0)),e[1].studentLocation&&lmsreports.setData(e[1].studentLocation,lmsreports.studentsBars,"student","studentLocation"),e[1].studentGrade&&lmsreports.setData(e[1].studentGrade,lmsreports.studentsBars,"student","studentGrade"),e[1].studentCourses&&(colorArr={completed:"#00bd9e",inprogress:"#458bd6",overdue:"#e95b6d",overdueCompleted:"#faba59"},lmsreports.setDataForMultipleBars(e[1].studentCourses,colorArr,lmsreports.studentsBars,"student","studentCourses")),lmsreports.setNumber("students")}))},getCoursesData:function(e){var t={action:"getCoursesReports",reportType:lmsreports.reportType,repType:"adminReports"};$.get("/lmsReportsAction.zp",t,(function(t){lmsreports.coursesBars=[];lmsreports.typeVar.courses=[],t[1].courseData&&lmsreports.setData(t[1].courseData,lmsreports.coursesBars,"courses","coursesData"),t[1].locationData&&lmsreports.setData(t[1].locationData,lmsreports.coursesBars,"courses","locationData"),t[1].categoryCourses&&lmsreports.setData(t[1].categoryCourses,lmsreports.coursesBars,"courses","categoryData"),t[1].ratingCourses&&lmsreports.setData(t[1].ratingCourses,lmsreports.coursesBars,"courses","ratingData",1),t[1].courseMaterials&&(colorArr={filesCount:"#00bd9e",linksCount:"#458bd6",contentsCount:"#faba59"},lmsreports.setDataForMultipleBars(t[1].courseMaterials,colorArr,lmsreports.coursesBars,"courses","courseMaterials")),t[1].courseData&&e&&e()}))},trainerData:function(e){var t={action:"getTrainersReports",reportType:lmsreports.reportType,repType:"adminReports"};$.get("/lmsReportsAction.zp",t,(function(e){lmsreports.trainerBars=[],lmsreports.typeVar.trainer=[],e[1].trainerCategory&&(lmsreports.setData(e[1].trainerCategory,lmsreports.trainerBars,"trainer","trainerCategory"),lmsreports.setBar(lmsreports.trainerBars[lmsreports.currentBar],lmsreports.trainerBars[lmsreports.currentBar+1],"gettrainerCategory",null,null,ZPI18N.getString("zp.lms.coursetypereport"),ZPI18N.getString("zp.lms.course.categories"),ZPI18N.getString("zp.lms.coursecount"),"trainerCategory","",!1,!0)),e[1].trainerRating&&lmsreports.setData(e[1].trainerRating,lmsreports.trainerBars,"trainer","trainerRating",1),e[1].trainerLocation&&lmsreports.setData(e[1].trainerLocation,lmsreports.trainerBars,"trainer","trainerLocation"),lmsreports.setNumber("trainers")}))},setData:function(e,t,s,r,l){lmsreports.reportId[r]=[];var a=[],n=[],i=Object.keys(e);s&&lmsreports.typeVar[s].push(i.length),i.length<11&&(i.length=11);for(var o=0;o<i.length;o++){var c=null;null!=i[o]?(c=l?e[i[o]][0]:lmsform.changetoI18N(e[i[o]][0]),lmsreports.reportId[r][o]=i[o],a.push(c),n.push(e[i[o]][1])):(a.push(""),n.push(0))}t.push(a),t.push(n)},setDataForMultipleBars:function(e,t,s,r,l){lmsreports.reportId[l]=[];var a=[],n=[];keys=Object.keys(e),r&&lmsreports.typeVar[r].push(keys.length);for(var i=0;i<keys.length;i++){lmsreports.reportId[l][i]=keys[i],a.push(e[keys[i]][0]),yData=e[keys[i]][1],dataKeys=Object.keys(yData);for(var o=0;o<dataKeys.length;o++)0==i&&(obj={name:lmsreports.getHeaderAndIndex(dataKeys[o],!1,!1),color:t[dataKeys[o]],data:[],extra:{id:dataKeys[o]}},n.push(obj)),n[o].data.push(yData[dataKeys[o]])}s.push(a),s.push(n)},setNumber:function(e){var t=[],s=[],r=[];r=document.getElementById("lmsreportstabs").childNodes,"students"==e?(t=lmsreports.reference.repLearner[0],s=lmsreports.typeVar.student):"trainers"==e?(t=lmsreports.reference.repTrainer[0],s=lmsreports.typeVar.trainer):"courses"==e&&(t=lmsreports.reference.repCourse[0],s=lmsreports.typeVar.courses);for(var l=0;l<r.length;l++)null!=s[l]&&(r[l].querySelector('[_rel="types"]').innerHTML=s[l]+" "+t[l])},coursetype:function(e){var t=0;if(null==e)lmsreports.setBar();else{for(i=0;i<e.length;i++){var s=0,r={},l=e[i].typeId;for(t=0;t<lmsreports.type.length;t++)lmsreports.type[t].typeid==l&&(s=1);0==s&&(r.typeid=l,lmsreports.type.push(r))}lmsreports.getCoursesData(JSON.stringify(lmsreports.type),lmsreports.asyncConstruction),lmsreports.type=[]}},setBar:function(e,t,s,r,l,a,n,i,o,c,d,m,u){"gettrainerHoursSpent"==s&&(i="Hours");var p=0;if(null!=t)for(var g=0;g<t.length;g++)0!=t[g]&&(p=1);if(null!=r&&null!=r&&r.length>0?(barData=r,p=1):barData=[{name:i,data:t}],0==p){var f=document.getElementById("lmsreport1");lmsnodata.showNoData({mode:"ondelete",container:f,module:"Reports",content:ZPI18N.getString("zp.lms.course.noreport")})}else null!=l&&null!=l||(l="lmsreport1"),Highcharts.chart(l,{credits:{enabled:!1},exporting:{enabled:!1},chart:{type:"column"},title:{text:a,style:{color:"black",fontWeight:"bold",fontSize:"18px"}},subtitle:{},xAxis:{categories:e,type:"category",title:{text:n,style:{color:"black",fontWeight:"bold",fontSize:"14px"}},labels:{rotation:m?-60:0,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{allowDecimals:!1,min:0,title:{text:i,style:{color:"black",fontWeight:"bold",fontSize:"14px"}}},legend:{enabled:d},plotOptions:{column:{stacking:u?"normal":""},series:{point:{events:{click:function(){"multi"==c?(lmsreports.lastRequestParams={name:s,data:lmsreports.reportId[o][this.index],seriesId:this.series.options.extra.id},lmsreports.startIdx=0,lmsreports.isScrollEventAdded=!1,lmsreports.getBarDetails(s,lmsreports.reportId[o][this.index],!0,this.series.options.extra.id,0,this.category)):(lmsreports.startIdx=0,lmsreports.getBarDetails(s,lmsreports.reportId[o][this.index],!0,null,0,this.category))}}}}},series:barData})},close:function(){lmsreports.coursesBars=[],lmsreports.trainerBars=[],lmsreports.studentsBars=[],lmsreports._relem=null}};const lmsReports={moduleName:"LMS",Util:{RECORDIDS:[],XLABLES:[],generateChartData:function(e,t,s,r){var l=[],a=[],n=[],i=Object.keys(e);i.length<t&&(i.length=t);for(var o=0;o<i.length;o++){var c=null;if(null!=i[o])if(c=s?e[i[o]][0]:lmsform.changetoI18N(e[i[o]][0]),n[o]=i[o],l.push(c),"object"==typeof e[i[o]][1]){temp=e[i[o]][1],dataKeys=Object.keys(e[i[o]][1]);for(var d=0;d<dataKeys.length;d++)0==o&&(columnInfo=r(dataKeys[d]),obj={name:columnInfo.name,color:columnInfo.color,data:[],extra:{columnName:dataKeys[d]}},a.push(obj)),a[d].data.push(temp[dataKeys[d]])}else a.push(e[i[o]][1]);else l.push("")}return chartData={},chartData.xlabels=l,chartData.ydata=a,chartData.reportIds=n,chartData},constructExport:function(e){exportEl=e.elem,html='<button class="lt_btn multi_btn primary"><span _rel="1">'+e.opns[0]+'</span><i class="ddown" id="exportMenu"><div class="lt_dropdown md btm rht"><ul><li _rel="2"><a><i class="CR-exprt"></i>'+e.opns[1]+'</a><li><li _rel="3"><a><i class="CR-exprt"></i>'+e.opns[2]+'</a></li><li _rel="4"><a><i class="CR-exprt"></i>'+e.opns[3]+"</a></li></ul></div></i></button>",exportEl.html(html),exportEl.click((function(t){el=t.target,_rel=el.closest("[_rel]")?el.closest("[_rel]").getAttribute("_rel"):null,"exportMenu"==el.getAttribute("id")?!lmsbase.hasClass(el,"open")&&lmsbase.addClass(el,"open"):1!=_rel&&2!=_rel&&3!=_rel&&4!=_rel||e.exportCallback(_rel)}))},resetChartValues:function(e){ZPLite.Reports.LMS.Util.XLABLES[e]=[],ZPLite.Reports.LMS.Util.RECORDIDS[e]=[]},setXlabels:function(e,t){0==ZPLite.Reports.LMS.Util.XLABLES[e].length?ZPLite.Reports.LMS.Util.XLABLES[e]=t:ZPLite.Reports.LMS.Util.XLABLES[e]=ZPLite.Reports.LMS.Util.XLABLES[e].concat(t)},setRecordIds:function(e,t){0==ZPLite.Reports.LMS.Util.RECORDIDS[e].length?ZPLite.Reports.LMS.Util.RECORDIDS[e]=t:ZPLite.Reports.LMS.Util.RECORDIDS[e]=ZPLite.Reports.LMS.Util.RECORDIDS[e].concat(t)},getRecordId:function(e,t){return ZPLite.Reports.LMS.Util.RECORDIDS[e][t]},getXlabel:function(e,t){return ZPLite.Reports.LMS.Util.XLABLES[e][t]}},Filters:{cache:{},searchCache:{},openFilter:function(e,t){lmsbase.addClass(e.querySelector("[_rel=filterMenu]"),"open")},constuctFilter:function(e){var t=Layout.Page.container;switch(filterType=e.filterType,filterType){case"timePeriod":e.entity=filterType,optionsArr=ZPLite.Reports.LMS.Filters.getOptionsForFilter(e),timePeriodFilter='<div _rel=timeperiodFilter onclick="ZPLite.Reports.LMS.Filters.openFilter(this, event);"><div _rel=filterMenu class="ddown" ><a class="lt_btn line multi sm mw_180"><span class="ddtext" _rel="timeperiodFilterText">'+ZPI18N.getString("zp.lms.thismonth")+'</a><div class="lt_dropdown md btm rht" _rel="timeperiodFilterOptions"><ul><li _rel="all"><a>'+optionsArr[0]+'</a></li><li _rel="1"><a>'+optionsArr[1]+'</a></li><li _rel="2" class="sel"><a>'+optionsArr[2]+'</a></li><li _rel="3"><a>'+optionsArr[3]+'</a></li><li _rel="4"><a>'+optionsArr[4]+"</a></li></ul></div></div></div>",t.find(".fil").html(timePeriodFilter),t.find("div[_rel=timeperiodFilter]").data("value",2),t.find(".fil").find("[_rel=timeperiodFilterOptions]").click((function(t){e.onChangeCallback(t)}));break;case"employee":var s={entity:filterType,isSingle:!0};s.filterOnChangeCallback=e.onChangeCallback,s.text=ZPI18N.getString("zp.employee"),s.showSelectedOptionCount=!0,s.enableClear=!1,s.loadOptionsCallback=ZPLite.Reports.LMS.Filters.getOptionsForFilter,s.searchDtls={text:ZPI18N.getString("zp.search")},e.firescrollMode&&(s.firescrollDtls={mode:e.firescrollMode,maxFetchLimit:25}),ZPLite.Filters.init(e.elem,s)}},getOptionsForFilter:function(e,t,s){var r,l=e.entity,a=s+1,n=ZPLite.Reports.LMS.Filters.getOptionsFromCache(e);if(n.makeRequest)switch(l){case"timePeriod":return r=[ZPI18N.getString("zp.lms.reports.allCourses"),ZPI18N.getString("zp.lms.thisweek"),ZPI18N.getString("zp.lms.thismonth"),ZPI18N.getString("zp.lms.threemonthsback"),ZPI18N.getString("zp.lms.sixmonthsback")];case"employee":var i={mode:"SEARCH",isDef:!0,searchType:"emp",searchMode:"LMS_LEARNER_PROGRESS_REPORT",conreqcsr:csrfToken},o={employeeStatus:3,employeeStatusarr:[19,-2,18],incDateOfExit:!0};"myReports"===ZPLite.Reports.selectedTab?o.peopleLiteReportType="personalReport":"teamReports"===ZPLite.Reports.selectedTab?o.peopleLiteReportType="teamReport":o.peopleLiteReportType="orgReport",i.extraparam=JSON.stringify(o),t&&""!==t&&(i.key=encodeURIComponent(t)),i.start=a,ZPeople.Request.sendAsyncPost(ZPComponents.Search.URL,i,(function(e){return r=ZPLite.Reports.LMS.Filters.formatFilterData(ZPLite.Modules.Filters.getEmpMatchData(e,t),l),t&&""!==t?ZPLite.Reports.LMS.Filters.searchCache[l][t]?ZPLite.Reports.LMS.Filters.searchCache[l][t]=ZPLite.Reports.LMS.Filters.searchCache[l][t].concat(r):ZPLite.Reports.LMS.Filters.searchCache[l][t]=r:void 0!==ZPLite.Reports.LMS.Filters.cache[l]?ZPLite.Reports.LMS.Filters.cache[l]=ZPLite.Reports.LMS.Filters.cache[l].concat(r):ZPLite.Reports.LMS.Filters.cache[l]=r,r}))}else r=n.options;return r},getOptionsFromCache:function(){var e=filterData.filterType,t=filterData.searchText,s=filterData.startIdx,r=!0,l=[];if(t&&""!==t){if(void 0===ZPLite.Reports.LMS.Filters.searchCache[e]&&(ZPLite.Reports.LMS.Filters.searchCache[e]={}),void 0!==ZPLite.Reports.LMS.Filters.searchCache[e][t])if(0===ZPLite.Reports.LMS.Filters.searchCache[e][t].length)r=!1;else if(ZPLite.Reports.LMS.Filters.searchCache[e][t].length>s){for(var a=s;a<ZPLite.Reports.LMS.Filters.searchCache[e][t].length&&l.length<25;a++)l.push(ZPLite.Reports.LMS.Filters.searchCache[e][t][a]);r=!1}}else if(void 0!==ZPLite.Reports.LMS.Filters.cache[e])if(0===ZPLite.Reports.LMS.Filters.cache[e].length)r=!1;else if(ZPLite.Reports.LMS.Filters.cache[e].length>s){for(a=s;a<ZPLite.Reports.LMS.Filters.cache[e].length&&l.length<25;a++)l.push(ZPLite.Reports.LMS.Filters.cache[e][a]);r=!1}return{makeRequest:r,options:l}},formatFilterData:function(e,t){var s=[];if(e)for(var r in e){var l,a=e[r];"employee"===t&&((l={id:a[0]}).text=ZPeople.decodeTxt(ZPeople.escapeHtml(a[1]+" "+ZPeople.getUserDisplayName(a[2],a[3]))),""===a[6].trim()?""===a[5].trim()?l.photoUrl=ZPeople.getResourceURL(imageUrl+"user.png"):l.photoUrl=contactUrl+"/file?ID="+a[5]+"&fs=thumb":0==a[6].indexOf("/newhr/images/sampleemployeephotos/")?l.photoUrl=a[6]:l.photoUrl="viewPhoto?filename="+a[6]),s.push(l)}return s}},Export:{openExport:function(e){$(e).hasClass("open")?$(e).removeClass("open"):$(e).addClass("open")}},coursesTypeReport:{reportName:"COURSES_TYPE_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.coursesTypeReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.coursesTypeReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.coursesTypeReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#courseTypeReport").before(ZPeople.LOADING_HTML),e.find("#courseTypeReport").addClass("DN"),e.find("#courseTypeReportList").addClass("DN");var t={action:"getCourseTypeReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t,s){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].courseTypes).length){e.find("#courseTypeReport").removeClass("DN");var r=ZPLite.Reports.LMS.Util.generateChartData(t[1].courseTypes,5),l={};l.renderTo=e.find("#courseTypeReportChart").get(0),l.title=ZPI18N.getString("zp.lms.coursetypereport"),l.titleAlignment="center",l.spacingTop=10,l.spacingBottom=50,l.spacingLeft=50,l.spacingRight=50,l.pointWidth=50,l.enableLegend=!1,l.dataArray=[{name:ZPI18N.getString("zp.lms.coursecount"),color:"#579DE6",data:r.ydata}],l.xAxisTitle=ZPI18N.getString("zp.lms.settings.AllowedCourseType"),l.xAxisLabel=r.xlabels,l.xAsixLabelRotation=0,l.xAxisMaxPointsOnFocus=r.xlabels.length-1,l.yAxisTitle=ZPI18N.getString("zp.lms.coursecount"),l.allowDecimals=!1,l.cursor="pointer",l.events={click:function(t){ZPLite.Firescroll.reset(e.find("#courseTypeReport"),ZPLite.Reports.LMS.coursesTypeReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#courseTypeReport"),ZPLite.Reports.LMS.coursesTypeReport.Firescroll.mode,{maxFetchLimit:50,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.coursesTypeReport.Firescroll.mode),ZPLite.Reports.LMS.coursesTypeReport.constructListView(r.reportIds[t.point.x],startIdx)}}),ZPLite.Reports.LMS.coursesTypeReport.constructListView(r.reportIds[t.point.x],1)}},ZPLite.Reports.Util.constructColumnChart(l),ZPLite.Reports.LMS.coursesTypeReport.constructListView(r.reportIds[0],1),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#courseTypeReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t){var s=Layout.Page.container,r={action:"getCoursesForType",data:ZPeople.decodeTxt(e),startIdx:t,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",r,(function(r){if(void 0!==r&&r.length>0){s.find("#courseTypeReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.coursesTypeReport.Firescroll.mode,r[1].Details.length);var l="";if(1==t){var a='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.typeBasedCourse")+'</span></div><div id="exportEl"></div>';s.find("#courseTypeReportHeader").html(a),l='<table class="table table-hover"><tbody id="courseTypeReportTableBody">'}for(var n=0;n<r[1].Details.length;n++){data=r[1].Details[n];var i=data.courseImageInfo;i.additionalInfo={fileId:data.courseId,type:6},l+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+(i.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+data.courseImage+".svg"):lmsfileaction.generateSourceURL(i))+'><div class="ZPusrName"><span class="ellipsis W200 CP">'+data.courseName+"</span></div></td><td>"+data.type+"</td></tr>"}1==t?(l+="</tbody></table>",s.find("#courseTypeReportBody").html(l),exportObj={},exportObj.elem=s.find("#courseTypeReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=s.find("#courseTypeReport"),exportObj.exportCallback=function(t){ZPLite.Reports.LMS.coursesTypeReport.exportReport(t,e)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):s.find("#courseTypeReportTableBody").append(l)}}))},exportReport:function(e,t){var s="lmsReportsAction.zp?action=exportCourseTypes&data="+t+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab,r=document.createElement("form");r.id="lmsformexport";var l=document.createElement("input");r.setAttribute("method","post"),r.setAttribute("action",s),r.setAttribute("target","exportresp"),l.setAttribute("type","hidden"),l.setAttribute("name","conreqcsr"),l.setAttribute("value",csrfToken),r.appendChild(l),document.body.appendChild(r),r.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"COURSES_TYPE_REPORT_SCROLL"}},courseLocationReport:{reportName:"COURSE_LOCATION_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.courseLocationReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.courseLocationReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.courseLocationReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#courseLocationReport").before(ZPeople.LOADING_HTML),e.find("#courseLocationReport").addClass("DN"),e.find("#courseLocationReportList").addClass("DN");var t={action:"getCourseLocationReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t,s){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].locationBasedCourses).length){e.find("#courseLocationReport").removeClass("DN");var r=ZPLite.Reports.LMS.Util.generateChartData(t[1].locationBasedCourses,Object.keys(t[1].locationBasedCourses).length<=15?Object.keys(t[1].locationBasedCourses).length:15),l={};l.renderTo=e.find("#courseLocationReportChart").get(0),l.title=ZPI18N.getString("zp.lms.courselocationreport"),l.titleAlignment="center",l.spacingTop=10,l.spacingBottom=50,l.spacingLeft=50,l.spacingRight=50,l.enableLegend=!1,l.dataArray=[{name:ZPI18N.getString("zp.lms.coursecount"),color:"#579DE6",data:r.ydata}],l.xAxisTitle=ZPI18N.getString("zp.lms.locations"),l.xAxisLabel=r.xlabels,l.xAsixLabelRotation=-60,l.yAxisTitle=ZPI18N.getString("zp.lms.coursecount"),l.allowDecimals=!1,l.cursor="pointer",Object.keys(t[1].locationBasedCourses).length>10?(l.enableScroll=!0,l.xAxisMaxPointsOnFocus=9):l.xAxisMaxPointsOnFocus=Object.keys(t[1].locationBasedCourses).length-1,ZPLite.Reports.LMS.Util.resetChartValues(ZPLite.Reports.LMS.courseLocationReport.Firescroll.xmode),ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.courseLocationReport.Firescroll.xmode,r.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.courseLocationReport.Firescroll.xmode,r.reportIds),l.events={click:function(t){ZPLite.Firescroll.reset(e.find("#courseLocationReport"),ZPLite.Reports.LMS.courseLocationReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#courseLocationReport"),ZPLite.Reports.LMS.courseLocationReport.Firescroll.mode,{maxFetchLimit:50,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.courseLocationReport.Firescroll.mode),ZPLite.Reports.LMS.courseLocationReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.courseLocationReport.Firescroll.xmode,t.point.x),startIdx,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.courseLocationReport.Firescroll.xmode,t.point.x))}}),ZPLite.Reports.LMS.courseLocationReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.courseLocationReport.Firescroll.xmode,t.point.x),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.courseLocationReport.Firescroll.xmode,t.point.x))}},ZPLite.Reports.Util.constructColumnChart(l),r.reportIds.length>0&&ZPLite.Reports.LMS.courseLocationReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.courseLocationReport.Firescroll.xmode,0),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.courseLocationReport.Firescroll.xmode,0)),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#courseLocationReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t,s){var r=Layout.Page.container,l={action:"getcourseLocation",data:ZPeople.decodeTxt(e),startIdx:t,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",l,(function(l,a){if(void 0!==l&&l.length>0){r.find("#courseLocationReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.courseLocationReport.Firescroll.mode,l[1].Details.length);var n="";if(1==t){var i='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.locationBasedCourse",[s])+'</span></div><div id="exportEl"></div>';r.find("#courseLocationReportHeader").html(i),n='<table class="table table-hover"><tbody id="courseLocationReportTableBody">'}for(var o=0;o<l[1].Details.length;o++){data=l[1].Details[o];var c=data.courseImageInfo;c.additionalInfo={fileId:data.courseId,type:6},n+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+(c.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+data.courseImage+".svg"):lmsfileaction.generateSourceURL(c))+'><div class="ZPusrName"><span class="ellipsis W200 CP">'+data.courseName+"</span></div></td><td>"+data.type+"</td></tr>"}1==t?(n+="</tbody></table>",r.find("#courseLocationReportBody").html(n),exportObj={},exportObj.elem=r.find("#courseLocationReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=r.find("#courseLocationReport"),exportObj.exportCallback=function(s){ZPLite.Reports.LMS.courseLocationReport.exportReport(s,e,t)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):r.find("#courseLocationReportTableBody").append(n)}}))},exportReport:function(e,t,s){var r="lmsReportsAction.zp?action=exportLocationWiseCourses&data="+t+"&startIdx="+s+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab,l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",r),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"COURSE_LOCATION_REPORT_SCROLL",xmode:"COURSE_LOCATION_REPORT_X_SCROLL"}},courseCategoryReport:{reportName:"COURSE_CATEGORY_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.courseCategoryReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.courseCategoryReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.courseCategoryReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#courseCategoryReport").before(ZPeople.LOADING_HTML),e.find("#courseCategoryReport").addClass("DN"),e.find("#courseCategoryReportList").addClass("DN");var t={action:"getCourseCategoryReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t,s){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].categoryBasedCourses).length){e.find("#courseCategoryReport").removeClass("DN");var r=ZPLite.Reports.LMS.Util.generateChartData(t[1].categoryBasedCourses,Object.keys(t[1].categoryBasedCourses).length<=15?Object.keys(t[1].categoryBasedCourses).length:15),l={};l.renderTo=e.find("#courseCategoryReportChart").get(0),l.title=ZPI18N.getString("zp.lms.courseCategoryReport"),l.titleAlignment="center",l.spacingTop=10,l.spacingBottom=50,l.spacingLeft=50,l.spacingRight=50,l.enableLegend=!1,l.dataArray=[{name:ZPI18N.getString("zp.lms.coursecount"),color:"#579DE6",data:r.ydata}],l.xAxisTitle=ZPI18N.getString("zp.lms.course.categories"),l.xAxisLabel=r.xlabels,l.xAsixLabelRotation=-60,l.xAxisMaxPointsOnFocus=r.xlabels.length-1,l.yAxisTitle=ZPI18N.getString("zp.lms.coursecount"),l.allowDecimals=!1,l.cursor="pointer",Object.keys(t[1].categoryBasedCourses).length>20?(l.enableScroll=!0,l.xAxisMaxPointsOnFocus=19):l.xAxisMaxPointsOnFocus=Object.keys(t[1].categoryBasedCourses).length-1,l.fireScrollMode=ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,l.fireScrollCallback=ZPLite.Reports.LMS.courseCategoryReport.Firescroll.loadMoreData,ZPLite.Firescroll.reset(e.find("#courseCategoryReport"),ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode),ZPLite.Firescroll.init(e.find("#courseCategoryReport"),ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,{maxFetchLimit:30,callback:l.fireScrollCallback}),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,Object.keys(t[1].categoryBasedCourses).length),ZPLite.Reports.LMS.Util.resetChartValues(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode),ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,r.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,r.reportIds),l.events={click:function(t){ZPLite.Firescroll.reset(e.find("#courseCategoryReport"),ZPLite.Reports.LMS.courseCategoryReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#courseCategoryReport"),ZPLite.Reports.LMS.courseCategoryReport.Firescroll.mode,{maxFetchLimit:50,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.mode),ZPLite.Reports.LMS.courseCategoryReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,t.point.x),startIdx,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,t.point.x))}}),ZPLite.Reports.LMS.courseCategoryReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,t.point.x),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,t.point.x))}},ZPLite.Reports.Util.constructColumnChart(l),r.reportIds.length>0&&ZPLite.Reports.LMS.courseCategoryReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,0),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,0)),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#courseCategoryReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t,s){var r=Layout.Page.container,l={action:"getCoursesForCategory",data:ZPeople.decodeTxt(e),startIdx:t,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",l,(function(l){if(void 0!==l&&l.length>0){r.find("#courseCategoryReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.mode,l[1].Details.length);var a="";if(1==t){var n='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.categoryBasedCourse",[s])+'</span></div><div id="exportEl"></div>';r.find("#courseCategoryReportHeader").html(n),a='<table class="table table-hover"><tbody id="courseCategoryReportTableBody">'}for(var i=0;i<l[1].Details.length;i++){data=l[1].Details[i];var o=data.courseImageInfo;o.additionalInfo={fileId:data.courseId,type:6},a+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+(o.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+data.courseImage+".svg"):lmsfileaction.generateSourceURL(o))+'><div class="ZPusrName"><span class="ellipsis W200 CP">'+data.courseName+"</span></div></td><td>"+data.type+"</td></tr>"}1==t?(a+="</tbody></table>",r.find("#courseCategoryReportBody").html(a),exportObj={},exportObj.elem=r.find("#courseCategoryReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=r.find("#courseCategoryReport"),exportObj.exportCallback=function(s){ZPLite.Reports.LMS.courseCategoryReport.exportReport(s,e,t)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):r.find("#courseCategoryReportTableBody").append(a)}}))},exportReport:function(e,t,s){var r="lmsReportsAction.zp?action=exportCoursesByCategory&data="+t+"&startIdx="+s+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab,l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",r),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"COURSE_CATEGORY_REPORT_SCROLL",xmode:"COURSE_CATEGORY_REPORT_X_SCROLL",loadMoreData:function(){ZPLite.Firescroll.setActiveStatus(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,!1);var e={action:"getCourseCategoryReport",startIdx:ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode),repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",e,(function(e,t){if(void 0!==e&&e.length>0){var s=ZPLite.Reports.LMS.Util.generateChartData(e[1].categoryBasedCourses,Object.keys(e[1].categoryBasedCourses).length<=15?Object.keys(e[1].categoryBasedCourses).length:15);ZPLite.Reports.LMS.Util.setXlabels(s.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(s.reportIds);for(var r=Layout.Page.container.find("#courseCategoryReportChart").highcharts(),l=r.xAxis[0].categories,a=0;a<s.xlabels.length;a++)l.push(s.xlabels[a]),r.series[0].addPoint(s.ydata[0].data[a],!1,!1),r.series[1].addPoint(s.ydata[1].data[a],!1,!1),r.series[2].addPoint(s.ydata[2].data[a],!1,!1),r.series[3].addPoint(s.ydata[3].data[a],!1,!1);r.xAxis[0].setCategories(l,!1),r.redraw(),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.courseCategoryReport.Firescroll.xmode,Object.keys(e[1].categoryBasedCourses).length)}}))}}},courseRatingReport:{reportName:"COURSE_RATING_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.courseCategoryReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.courseRatingReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.courseRatingReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#courseRatingReport").before(ZPeople.LOADING_HTML),e.find("#courseRatingReport").addClass("DN"),e.find("#courseRatingReportList").addClass("DN");var t={action:"getCourseRatingReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t,s){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].ratingBasedCourses).length){e.find("#courseRatingReport").removeClass("DN");var r=ZPLite.Reports.LMS.Util.generateChartData(t[1].ratingBasedCourses,Object.keys(t[1].ratingBasedCourses).length,1),l={};l.renderTo=e.find("#courseRatingReportChart").get(0),l.title=ZPI18N.getString("zp.lms.courseRatingReport"),l.titleAlignment="center",l.spacingTop=10,l.spacingBottom=50,l.spacingLeft=50,l.spacingRight=50,l.pointWidth=50,l.enableLegend=!1,l.dataArray=[{name:ZPI18N.getString("zp.lms.coursecount"),color:"#579DE6",data:r.ydata}],l.xAxisTitle=ZPI18N.getString("zp.lms.reports.rating"),l.xAxisLabel=r.xlabels,l.xAsixLabelRotation=0,l.xAxisMaxPointsOnFocus=r.xlabels.length-1,l.yAxisTitle=ZPI18N.getString("zp.lms.coursecount"),l.allowDecimals=!1,l.cursor="pointer",l.events={click:function(t){ZPLite.Firescroll.reset(e.find("#courseRatingReport"),ZPLite.Reports.LMS.courseRatingReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#courseRatingReport"),ZPLite.Reports.LMS.courseRatingReport.Firescroll.mode,{maxFetchLimit:50,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.courseRatingReport.Firescroll.mode),ZPLite.Reports.LMS.courseRatingReport.constructListView(r.reportIds[t.point.x],startIdx,r.xlabels[t.point.x])}}),ZPLite.Reports.LMS.courseRatingReport.constructListView(r.reportIds[t.point.x],1,r.xlabels[t.point.x])}},ZPLite.Reports.Util.constructColumnChart(l),r.reportIds.length>0&&ZPLite.Reports.LMS.courseRatingReport.constructListView(r.reportIds[0],1,r.xlabels[0]),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#courseRatingReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t,s){var r=Layout.Page.container,l={action:"getCoursesForRating",data:ZPeople.decodeTxt(e),startIdx:t,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",l,(function(l){if(void 0!==l&&l.length>0){r.find("#courseRatingReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.courseRatingReport.Firescroll.mode,l[1].Details.length);var a="";if(1==t){var n='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.ratingBasedCourses",[s])+'</span></div><div id="exportEl"></div>';r.find("#courseRatingReportHeader").html(n),a='<table class="table table-hover"><tbody id="courseRatingReportTableBody">'}for(var i=0;i<l[1].Details.length;i++){data=l[1].Details[i];var o=data.courseImageInfo;o.additionalInfo={fileId:data.courseId,type:6},a+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+(o.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+data.courseImage+".svg"):lmsfileaction.generateSourceURL(o))+'><div class="ZPusrName"><span class="ellipsis W200 CP">'+data.courseName+"</span></div></td><td>"+data.type+"</td></tr>"}1==t?(a+="</tbody></table>",r.find("#courseRatingReportBody").html(a),exportObj={},exportObj.elem=r.find("#courseRatingReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=r.find("#courseRatingReport"),exportObj.exportCallback=function(s){ZPLite.Reports.LMS.courseRatingReport.exportReport(s,e,t)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):r.find("#courseRatingReportTableBody").append(a)}}))},exportReport:function(e,t,s){var r="lmsReportsAction.zp?action=exportCourseByRating&data="+t+"&startIdx="+s+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab,l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",r),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"COURSE_RATING_REPORT_SCROLL"}},courseMaterialsReport:{reportName:"COURSE_MATERIALS_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.courseMaterialsReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.courseMaterialsReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.courseMaterialsReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#courseMaterialsReport").before(ZPeople.LOADING_HTML),e.find("#courseMaterialsReport").addClass("DN"),e.find("#courseMaterialsReportList").addClass("DN");var t={action:"getCourseMaterialsReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t,s){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].courseMaterials).length){e.find("#courseMaterialsReport").removeClass("DN");var r=ZPLite.Reports.LMS.Util.generateChartData(t[1].courseMaterials,Object.keys(t[1].courseMaterials).length<=15?Object.keys(t[1].courseMaterials).length:15,!1,ZPLite.Reports.LMS.courseMaterialsReport.getColumnInfo),l={};l.renderTo=e.find("#courseMaterialsReportChart").get(0),l.title=ZPI18N.getString("zp.lms.reports.courseMatReport"),l.titleAlignment="center",l.spacingTop=10,l.spacingBottom=50,l.spacingLeft=50,l.spacingRight=50,l.enableLegend=!0,l.removeTooltip=!0,l.dataArray=r.ydata,l.xAxisTitle=ZPI18N.getString("zp.lms.feedback.courses"),l.xAxisLabel=r.xlabels,l.xAsixLabelRotation=-60,l.xAxisMaxPointsOnFocus=r.xlabels.length-1,l.yAxisTitle=ZPI18N.getString("zp.lms.reports.materialsCount"),l.allowDecimals=!1,l.cursor="pointer",Object.keys(t[1].courseMaterials).length>20?(l.enableScroll=!0,l.xAxisMaxPointsOnFocus=19):l.xAxisMaxPointsOnFocus=Object.keys(t[1].courseMaterials).length-1,l.fireScrollMode=ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,l.fireScrollCallback=ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.loadMoreData,ZPLite.Firescroll.reset(e.find("#courseMaterialsReport"),ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode),ZPLite.Firescroll.init(e.find("#courseMaterialsReport"),ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,{maxFetchLimit:30,callback:l.fireScrollCallback}),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,Object.keys(t[1].courseMaterials).length),ZPLite.Reports.LMS.Util.resetChartValues(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode),ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,r.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,r.reportIds),l.events={click:function(t){ZPLite.Firescroll.reset(e.find("#courseMaterialsReport"),ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#courseMaterialsReport"),ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.mode,{maxFetchLimit:25,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.mode),ZPLite.Reports.LMS.courseMaterialsReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,t.point.x),startIdx,t.point.series.options.extra.columnName,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,t.point.x))}}),ZPLite.Reports.LMS.courseMaterialsReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,t.point.x),1,t.point.series.options.extra.columnName,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,t.point.x))}},ZPLite.Reports.Util.constructColumnChart(l),r.reportIds.length>0&&ZPLite.Reports.LMS.courseMaterialsReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,0),1,"filesCount",ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,1)),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#courseMaterialsReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t,s,r){var l=Layout.Page.container;columnInfo=ZPLite.Reports.LMS.courseMaterialsReport.getColumnInfo(s);var a={action:"getCourseMaterials",status:columnInfo.index,startIdx:t,repType:ZPLite.Reports.selectedTab};-1!=e.indexOf("+")?(a.courseId=e.split("+")[0],a.batchId=e.split("+")[1]):a.courseId=e,$.get("/lmsReportsAction.zp",a,(function(e){if(void 0!==e&&e.length>0){l.find("#courseMaterialsReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.mode,e[1].Details.length);var s="";if(1==t){var n='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.courseMat",[columnInfo.name,r])+'</span></div><div id="exportEl"></div>';l.find("#courseMaterialsReportHeader").html(n),s='<table class="table table-hover"><tbody id="courseMaterialsReportTableBody">'}for(var i=0;i<e[1].Details.length;i++)data=e[1].Details[i],s+='<tr class="ZPLRow"><td class="fxdtd">'+(data.fileName||data.linkName)+"</td></tr>";1==t?(s+="</tbody></table>",l.find("#courseMaterialsReportBody").html(s),exportObj={},exportObj.elem=l.find("#courseMaterialsReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=l.find("#courseMaterialsReport"),exportObj.exportCallback=function(e){ZPLite.Reports.LMS.courseMaterialsReport.exportReport(e,a.courseId,a.batchId,a.status,t)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):l.find("#courseMaterialsReportTableBody").append(s)}}))},exportReport:function(e,t,s,r,l){var a="lmsReportsAction.zp?action=exportCourseMaterials&courseId="+t;null!=s&&(a+="&batchId="+s),a+="&status="+r+"&startIdx="+l+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab;var n=document.createElement("form");n.id="lmsformexport";var i=document.createElement("input");n.setAttribute("method","post"),n.setAttribute("action",a),n.setAttribute("target","exportresp"),i.setAttribute("type","hidden"),i.setAttribute("name","conreqcsr"),i.setAttribute("value",csrfToken),n.appendChild(i),document.body.appendChild(n),n.submit(),$("#lmsformexport").remove()},getColumnInfo:function(e){var t={};return"filesCount"==e?(t.name=ZPI18N.getString("zp.lms.content.files"),t.color="#00bd9e",t.index=1):"linksCount"==e?(t.name=ZPI18N.getString("zp.customlink"),t.color="#458bd6",t.index=2):"contentsCount"==e&&(t.name=ZPI18N.getString("zp.lms.reports.contents"),t.color="#faba59",t.index=3),t},Firescroll:{mode:"COURSE_MATERIALS_REPORT_SCROLL",xmode:"COURSE_MATERIALS_REPORT_X_SCROLL",loadMoreData:function(){ZPLite.Firescroll.setActiveStatus(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,!1);var e={action:"getCourseMaterialsReport",startIdx:ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode),repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",e,(function(e,t){if(void 0!==e&&e.length>0){var s=ZPLite.Reports.LMS.Util.generateChartData(e[1].courseMaterials,Object.keys(e[1].courseMaterials).length<=15?Object.keys(e[1].courseMaterials).length:15,!1,ZPLite.Reports.LMS.courseMaterialsReport.getColumnInfo);ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,s.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,s.reportIds);for(var r=Layout.Page.container.find("#courseMaterialsReportChart").highcharts(),l=r.xAxis[0].categories,a=0;a<s.xlabels.length;a++)l.push(s.xlabels[a]),r.series[0].addPoint(s.ydata[0].data[a],!1,!1),r.series[1].addPoint(s.ydata[1].data[a],!1,!1),r.series[2].addPoint(s.ydata[2].data[a],!1,!1),r.series[3].addPoint(s.ydata[3].data[a],!1,!1);r.xAxis[0].setCategories(l,!1),r.redraw()}ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.courseMaterialsReport.Firescroll.xmode,Object.keys(e[1].courseMaterials).length)}))}}},trainerCategoryReport:{reportName:"TRAINER_CATEGORY_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.trainerCategoryReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.trainerCategoryReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.trainerCategoryReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#trainerCategoryReport").before(ZPeople.LOADING_HTML),e.find("#trainerCategoryReport").addClass("DN"),e.find("#trainerCategoryReportList").addClass("DN");var t={action:"getTrainerCatgeoryReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].categoryBasedTrainers).length){e.find("#trainerCategoryReport").removeClass("DN");var s=ZPLite.Reports.LMS.Util.generateChartData(t[1].categoryBasedTrainers,Object.keys(t[1].categoryBasedTrainers).length<=15?Object.keys(t[1].categoryBasedTrainers).length:15),r={};r.renderTo=e.find("#trainerCategoryReportChart").get(0),r.title=ZPI18N.getString("zp.lms.trainercategoryreport"),r.titleAlignment="center",r.spacingTop=10,r.spacingBottom=50,r.spacingLeft=50,r.spacingRight=50,r.enableLegend=!1,r.dataArray=[{name:ZPI18N.getString("zp.lms.trainercount"),color:"#579DE6",data:s.ydata}],r.xAxisTitle=ZPI18N.getString("zp.lms.course.categories"),r.xAxisLabel=s.xlabels,r.xAsixLabelRotation=-60,r.yAxisTitle=ZPI18N.getString("zp.lms.trainercount"),r.allowDecimals=!1,r.cursor="pointer",Object.keys(t[1].categoryBasedTrainers).length>20?(r.enableScroll=!0,r.xAxisMaxPointsOnFocus=19):r.xAxisMaxPointsOnFocus=Object.keys(t[1].categoryBasedTrainers).length-1,r.fireScrollMode=ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,r.fireScrollCallback=ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.loadMoreData,ZPLite.Firescroll.reset(e.find("#trainerCategoryReport"),ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode),ZPLite.Firescroll.init(e.find("#trainerCategoryReport"),ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,{maxFetchLimit:30,callback:r.fireScrollCallback}),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,Object.keys(t[1].categoryBasedTrainers).length),ZPLite.Reports.LMS.Util.resetChartValues(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode),ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,s.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,s.reportIds),r.events={click:function(e){ZPLite.Reports.LMS.trainerCategoryReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,e.point.x),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,e.point.x))}},ZPLite.Reports.Util.constructColumnChart(r),s.reportIds.length>0&&ZPLite.Reports.LMS.trainerCategoryReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,0),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,0)),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#trainerCategoryReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t,s){var r=Layout.Page.container,l={action:"gettrainerCategory",data:ZPeople.decodeTxt(e),startIdx:t,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",l,(function(l,a){if(void 0!==l&&l.length>0){r.find("#trainerCategoryReportList").removeClass("DN");var n="";if(1==t){var i='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.categoryBasedTrainers",[s])+'</span></div><div id="exportEl"></div>';r.find("#trainerCategoryReportHeader").html(i),n='<table class="table table-hover"><tbody id="trainerCategoryReportTableBody">'}for(var o=0;o<l[1].Details.length;o++)data=l[1].Details[o],n+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+data.trainerImage+'><div class="ZPusrName"><span class="ellipsis W200 CP"><b>'+data.trainerEmployeeId+"</b>"+data.trainerName+"</span></div></td></tr>";1==t?(n+="</tbody></table>",r.find("#trainerCategoryReportBody").html(n),exportObj={},exportObj.elem=r.find("#trainerCategoryReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=r.find("#trainerCategoryReport"),exportObj.exportCallback=function(t){ZPLite.Reports.LMS.trainerCategoryReport.exportReport(t,e)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):r.find("#trainerCategoryReportTableBody").append(n)}}))},exportReport:function(e,t){var s="lmsReportsAction.zp?action=exportTrainersByCateogry&data="+t+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab,r=document.createElement("form");r.id="lmsformexport";var l=document.createElement("input");r.setAttribute("method","post"),r.setAttribute("action",s),r.setAttribute("target","exportresp"),l.setAttribute("type","hidden"),l.setAttribute("name","conreqcsr"),l.setAttribute("value",csrfToken),r.appendChild(l),document.body.appendChild(r),r.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"TRAINER_CATEGORY_REPORT_SCROLL",xmode:"TRAINER_CATEGORY_REPORT_X_SCROLL",loadMoreData:function(){ZPLite.Firescroll.setActiveStatus(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,!1);var e={action:"getTrainerCatgeoryReport",startIdx:ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode),repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",e,(function(e,t){if(void 0!==e&&e.length>0){var s=ZPLite.Reports.LMS.Util.generateChartData(e[1].categoryBasedTrainers,Object.keys(e[1].categoryBasedTrainers).length<=15?Object.keys(e[1].categoryBasedTrainers).length:15);ZPLite.Reports.LMS.Util.setXlabels(s.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(s.reportIds);for(var r=Layout.Page.container.find("#trainerCategoryReportChart").highcharts(),l=r.xAxis[0].categories,a=0;a<s.xlabels.length;a++)l.push(s.xlabels[a]),r.series[0].addPoint(s.ydata[0].data[a],!1,!1),r.series[1].addPoint(s.ydata[1].data[a],!1,!1),r.series[2].addPoint(s.ydata[2].data[a],!1,!1),r.series[3].addPoint(s.ydata[3].data[a],!1,!1);r.xAxis[0].setCategories(l,!1),r.redraw(),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.trainerCategoryReport.Firescroll.xmode,Object.keys(e[1].categoryBasedTrainers).length)}}))}}},trainerRatingReport:{reportName:"TRAINER_RATING_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.trainerRatingReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.trainerRatingReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.trainerRatingReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#trainerRatingReport").before(ZPeople.LOADING_HTML),e.find("#trainerRatingReport").addClass("DN"),e.find("#trainerRatingReportList").addClass("DN");var t={action:"getTrainerRatingReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t,s){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].ratingBasedTrainers).length){e.find("#trainerRatingReport").removeClass("DN");var r=ZPLite.Reports.LMS.Util.generateChartData(t[1].ratingBasedTrainers,Object.keys(t[1].ratingBasedTrainers).length,1),l={};l.renderTo=e.find("#trainerRatingReportChart").get(0),l.title=ZPI18N.getString("zp.lms.trainerratingreport"),l.titleAlignment="center",l.spacingTop=10,l.spacingBottom=50,l.spacingLeft=50,l.spacingRight=50,l.pointWidth=50,l.enableLegend=!1,l.dataArray=[{name:ZPI18N.getString("zp.lms.trainercount"),color:"#579DE6",data:r.ydata}],l.xAxisTitle=ZPI18N.getString("zp.lms.reports.rating"),l.xAxisLabel=r.xlabels,l.xAsixLabelRotation=0,l.xAxisMaxPointsOnFocus=r.xlabels.length-1,l.yAxisTitle=ZPI18N.getString("zp.lms.trainercount"),l.allowDecimals=!1,l.cursor="pointer",l.events={click:function(t){ZPLite.Firescroll.reset(e.find("#trainerRatingReport"),ZPLite.Reports.LMS.trainerRatingReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#trainerRatingReport"),ZPLite.Reports.LMS.trainerRatingReport.Firescroll.mode,{maxFetchLimit:50,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.trainerRatingReport.Firescroll.mode),ZPLite.Reports.LMS.trainerRatingReport.constructListView(r.reportIds[t.point.x],startIdx,r.xlabels[t.point.x])}}),ZPLite.Reports.LMS.trainerRatingReport.constructListView(r.reportIds[t.point.x],1,r.xlabels[t.point.x])}},ZPLite.Reports.Util.constructColumnChart(l),r.reportIds.length>0&&ZPLite.Reports.LMS.trainerRatingReport.constructListView(r.reportIds[0],1,r.xlabels[0]),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#trainerRatingReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t,s){var r=Layout.Page.container,l={action:"gettrainerRating",data:ZPeople.decodeTxt(e),startIdx:t,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",l,(function(l,a){if(void 0!==l&&l.length>0){r.find("#trainerRatingReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.trainerRatingReport.Firescroll.mode,l[1].Details.length);var n="";if(1==t){var i='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.ratingBasedTrainers",[s])+'</span></div><div id="exportEl"></div>';r.find("#trainerRatingReportHeader").html(i),n='<table class="table table-hover"><tbody id="trainerRatingReportTableBody">'}for(var o=0;o<l[1].Details.length;o++)data=l[1].Details[o],n+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+data.trainerImage+'><div class="ZPusrName"><span class="ellipsis W200 CP"><b>'+data.trainerEmployeeId+"</b>"+data.trainerName+"</span></div></td></tr>";1==t?(n+="</tbody></table>",r.find("#trainerRatingReportBody").html(n),exportObj={},exportObj.elem=r.find("#trainerRatingReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=r.find("#trainerRatingReport"),exportObj.exportCallback=function(s){ZPLite.Reports.LMS.trainerRatingReport.exportReport(s,e,t)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):r.find("#trainerRatingReportTableBody").append(n)}}))},exportReport:function(e,t,s){var r="lmsReportsAction.zp?action=exportTrainersByRating&data="+t+"&startIdx="+s+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab,l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",r),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"TRAINER_RATING_REPORT_SCROLL"}},trainerLocationReport:{reportName:"TRAINER_LOCATION_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.trainerLocationReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.trainerLocationReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.trainerLocationReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#trainerLocationReport").before(ZPeople.LOADING_HTML),e.find("#trainerLocationReport").addClass("DN"),e.find("#trainerLocationReportList").addClass("DN");var t={action:"getTrainerLocationReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t,s){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].locationBasedTrainers).length){e.find("#trainerLocationReport").removeClass("DN");var r=ZPLite.Reports.LMS.Util.generateChartData(t[1].locationBasedTrainers,Object.keys(t[1].locationBasedTrainers).length<=15?Object.keys(t[1].locationBasedTrainers).length:15),l={};l.renderTo=e.find("#trainerLocationReportChart").get(0),l.title=ZPI18N.getString("zp.lms.trainerlocationreport"),l.titleAlignment="center",l.spacingTop=10,l.spacingBottom=50,l.spacingLeft=50,l.spacingRight=50,l.enableLegend=!1,l.dataArray=[{name:ZPI18N.getString("zp.lms.trainercount"),color:"#579DE6",data:r.ydata}],l.xAxisTitle=ZPI18N.getString("zp.lms.locations"),l.xAxisLabel=r.xlabels,l.xAsixLabelRotation=-60,l.xAxisMaxPointsOnFocus=r.xlabels.length-1,l.yAxisTitle=ZPI18N.getString("zp.lms.trainercount"),l.allowDecimals=!1,l.cursor="pointer",Object.keys(t[1].locationBasedTrainers).length>20?(l.enableScroll=!0,l.xAxisMaxPointsOnFocus=19):l.xAxisMaxPointsOnFocus=Object.keys(t[1].locationBasedTrainers).length-1,l.fireScrollMode=!1,ZPLite.Reports.LMS.Util.resetChartValues(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.xmode),ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.xmode,r.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.xmode,r.reportIds),l.events={click:function(t){ZPLite.Firescroll.reset(e.find("#trainerLocationReport"),ZPLite.Reports.LMS.trainerLocationReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#trainerLocationReport"),ZPLite.Reports.LMS.trainerLocationReport.Firescroll.mode,{maxFetchLimit:50,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.mode),ZPLite.Reports.LMS.trainerLocationReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.xmode,t.point.x),startIdx,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.xmode,t.point.x))}}),ZPLite.Reports.LMS.trainerLocationReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.xmode,t.point.x),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.xmode,t.point.x))}},ZPLite.Reports.Util.constructColumnChart(l),r.reportIds.length>0&&ZPLite.Reports.LMS.trainerLocationReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.xmode,0),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.xmode,0)),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#trainerLocationReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t,s){var r=Layout.Page.container,l={action:"gettrainerLocation",data:ZPeople.decodeTxt(e),startIdx:t,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",l,(function(l){if(void 0!==l&&l.length>0){r.find("#trainerLocationReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.trainerLocationReport.Firescroll.mode,l[1].Details.length);var a="";if(1==t){var n='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.locationBasedTrainers",[s])+'</span></div><div id="exportEl"></div>';r.find("#trainerLocationReportHeader").html(n),a='<table class="table table-hover"><tbody id="trainerLocationReportTableBody">'}for(var i=0;i<l[1].Details.length;i++)data=l[1].Details[i],a+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+data.trainerImage+'><div class="ZPusrName"><span class="ellipsis W200 CP"><b>'+data.trainerEmployeeId+"</b>"+data.trainerName+"</span></div></td></tr>";1==t?(a+="</tbody></table>",r.find("#trainerLocationReportBody").html(a),exportObj={},exportObj.elem=r.find("#trainerLocationReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=r.find("#trainerLocationReport"),exportObj.exportCallback=function(s){ZPLite.Reports.LMS.trainerLocationReport.exportReport(s,e,t)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):r.find("#trainerLocationReportTableBody").append(a)}}))},exportReport:function(e,t,s){var r="lmsReportsAction.zp?action=exportTrainersByLocation&data="+t+"&startIdx="+s+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab,l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",r),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"TRAINER_LOCATION_REPORT_SCROLL",xmode:"TRAINER_LOCATION_REPORT_X_SCROLL"}},learnerCategoryReport:{reportName:"LEARNER_CATEGORY_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.learnerCategoryReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.learnerCategoryReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.learnerCategoryReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#learnerCategoryReport").before(ZPeople.LOADING_HTML),e.find("#learnerCategoryReport").addClass("DN"),e.find("#learnerCategoryReportList").addClass("DN");var t={action:"getLearnerCatgeoryReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].categoryBasedLearners).length){e.find("#learnerCategoryReport").removeClass("DN");var s=ZPLite.Reports.LMS.Util.generateChartData(t[1].categoryBasedLearners,Object.keys(t[1].categoryBasedLearners).length<=15?Object.keys(t[1].categoryBasedLearners).length:15),r={};r.renderTo=e.find("#learnerCategoryReportChart").get(0),r.title=ZPI18N.getString("zp.lms.studentcategoryreport"),r.titleAlignment="center",r.spacingTop=10,r.spacingBottom=50,r.spacingLeft=50,r.spacingRight=50,r.enableLegend=!1,r.dataArray=[{name:ZPI18N.getString("zp.lms.learnercount"),color:"#579DE6",data:s.ydata}],r.xAxisTitle=ZPI18N.getString("zp.lms.course.categories"),r.xAxisLabel=s.xlabels,r.xAsixLabelRotation=-60,r.yAxisTitle=ZPI18N.getString("zp.lms.learnercount"),r.allowDecimals=!1,r.cursor="pointer",Object.keys(t[1].categoryBasedLearners).length>20?(r.enableScroll=!0,r.xAxisMaxPointsOnFocus=19):r.xAxisMaxPointsOnFocus=Object.keys(t[1].categoryBasedLearners).length-1,r.fireScrollMode=ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,r.fireScrollCallback=ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.loadMoreData,ZPLite.Firescroll.reset(e.find("#learnerCategoryReport"),ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode),ZPLite.Firescroll.init(e.find("#learnerCategoryReport"),ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,{maxFetchLimit:30,callback:r.fireScrollCallback}),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,Object.keys(t[1].categoryBasedLearners).length),ZPLite.Reports.LMS.Util.resetChartValues(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode),ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,s.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,s.reportIds),r.events={click:function(t){ZPLite.Firescroll.reset(e.find("#learnerCategoryReport"),ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#learnerCategoryReport"),ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.mode,{maxFetchLimit:50,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.mode),ZPLite.Reports.LMS.learnerCategoryReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,t.point.x),startIdx,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,t.point.x))}}),ZPLite.Reports.LMS.learnerCategoryReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,t.point.x),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,t.point.x))}},ZPLite.Reports.Util.constructColumnChart(r),s.reportIds.length>0&&ZPLite.Reports.LMS.learnerCategoryReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,0),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,0)),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#learnerCategoryReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t,s){var r=Layout.Page.container,l={action:"getstudentCategory",data:ZPeople.decodeTxt(e),startIdx:t,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",l,(function(l){if(void 0!==l&&l.length>0){r.find("#learnerCategoryReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.mode,l[1].Details.length);var a="";if(1==t){var n='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.categoryBasedLearners",[s])+'</span></div><div id="exportEl"></div>';r.find("#learnerCategoryReportHeader").html(n),a='<table class="table table-hover"><tbody id="learnerCategoryReportTableBody">'}for(var i=0;i<l[1].Details.length;i++)data=l[1].Details[i],a+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+data.photoPath+'><div class="ZPusrName"><span class="ellipsis W200 CP"><b>'+data.employeeId+"</b>"+data.name+"</span></div></td></tr>";1==t?(a+="</tbody></table>",r.find("#learnerCategoryReportBody").html(a),exportObj={},exportObj.elem=r.find("#learnerCategoryReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=r.find("#learnerCategoryReport"),exportObj.exportCallback=function(s){ZPLite.Reports.LMS.learnerCategoryReport.exportReport(s,e,t)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):r.find("#learnerCategoryReportTableBody").append(a)}}))},exportReport:function(e,t,s){var r="lmsReportsAction.zp?action=exportLearnersByCategory&data="+t+"&startIdx="+s+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab,l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",r),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"LEARNER_CATEGORY_REPORT_SCROLL",xmode:"LEARNER_CATEGORY_REPORT_X_SCROLL",loadMoreData:function(){ZPLite.Firescroll.setActiveStatus(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,!1);var e={action:"getLearnerCatgeoryReport",startIdx:ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode),repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",e,(function(e){if(void 0!==e&&e.length>0){var t=ZPLite.Reports.LMS.Util.generateChartData(e[1].categoryBasedLearners,Object.keys(e[1].categoryBasedLearners).length<=15?Object.keys(e[1].categoryBasedLearners).length:15);ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,t.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,t.reportIds);for(var s=Layout.Page.container.find("#learnerCategoryReportChart").highcharts(),r=s.xAxis[0].categories,l=0;l<t.xlabels.length;l++)r.push(t.xlabels[l]),s.series[0].addPoint(t.ydata[0].data[l],!1,!1),s.series[1].addPoint(t.ydata[1].data[l],!1,!1),s.series[2].addPoint(t.ydata[2].data[l],!1,!1),s.series[3].addPoint(t.ydata[3].data[l],!1,!1);s.xAxis[0].setCategories(r,!1),s.redraw(),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.learnerCategoryReport.Firescroll.xmode,Object.keys(e[1].categoryBasedLearners).length)}}))}}},learnerLocationReport:{reportName:"LEARNER_LOCATION_REPORT",initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.learnerLocationReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.learnerLocationReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.LMS.learnerLocationReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#learnerLocationReport").before(ZPeople.LOADING_HTML),e.find("#learnerLocationReport").addClass("DN"),e.find("#learnerLocationReportList").addClass("DN");var t={action:"getLearnerLocationReport",repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t,s){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].locationBasedLearners).length){e.find("#learnerLocationReport").removeClass("DN");var r=ZPLite.Reports.LMS.Util.generateChartData(t[1].locationBasedLearners,Object.keys(t[1].locationBasedLearners).length<=15?Object.keys(t[1].locationBasedLearners).length:15),l={};l.renderTo=e.find("#learnerLocationReportChart").get(0),l.title=ZPI18N.getString("zp.lms.studentLocationreport"),l.titleAlignment="center",l.spacingTop=10,l.spacingBottom=50,l.spacingLeft=50,l.spacingRight=50,l.enableLegend=!1,l.dataArray=[{name:ZPI18N.getString("zp.lms.learnercount"),color:"#579DE6",data:r.ydata}],l.xAxisTitle=ZPI18N.getString("zp.lms.locations"),l.xAxisLabel=r.xlabels,l.yAxisTitle=ZPI18N.getString("zp.lms.learnercount"),l.allowDecimals=!1,l.cursor="pointer",l.xAsixLabelRotation=-60,Object.keys(t[1].locationBasedLearners).length>20?(l.enableScroll=!0,l.xAxisMaxPointsOnFocus=19):l.xAxisMaxPointsOnFocus=Object.keys(t[1].locationBasedLearners).length-1,l.fireScrollMode=!1,ZPLite.Reports.LMS.Util.resetChartValues(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.xmode),ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.xmode,r.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.xmode,r.reportIds),l.events={click:function(t){ZPLite.Firescroll.reset(e.find("#learnerLocationReport"),ZPLite.Reports.LMS.learnerLocationReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#learnerLocationReport"),ZPLite.Reports.LMS.learnerLocationReport.Firescroll.mode,{maxFetchLimit:50,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.mode),ZPLite.Reports.LMS.learnerLocationReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.xmode,t.point.x),startIdx,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.xmode,t.point.x))}}),ZPLite.Reports.LMS.learnerLocationReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.xmode,t.point.x),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.xmode,t.point.x))}},ZPLite.Reports.Util.constructColumnChart(l),r.reportIds.length>0&&ZPLite.Reports.LMS.learnerLocationReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.xmode,0),1,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.xmode,0)),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#learnerLocationReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},constructListView:function(e,t,s){var r=Layout.Page.container,l={action:"getstudentLocation",data:ZPeople.decodeTxt(e),startIdx:t,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",l,(function(l){if(void 0!==l&&l.length>0){r.find("#learnerLocationReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.learnerLocationReport.Firescroll.mode,l[1].Details.length);var a="";if(1==t){var n='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.locationBasedLearners",[s])+'</span></div><div id="exportEl"></div>';r.find("#learnerLocationReportHeader").html(n),a='<table class="table table-hover"><tbody id="learnerLocationReportTableBody">'}for(var i=0;i<l[1].Details.length;i++)data=l[1].Details[i],a+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+data.photoPath+'><div class="ZPusrName"><span class="ellipsis W200 CP"><b>'+data.employeeId+"</b>"+data.name+"</span></div></td></tr>";1==t?(a+="</tbody></table>",r.find("#learnerLocationReportBody").html(a),exportObj={},exportObj.elem=r.find("#learnerLocationReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=r.find("#learnerLocationReport"),exportObj.exportCallback=function(s){ZPLite.Reports.LMS.learnerLocationReport.exportReport(s,e,t)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):r.find("#learnerLocationReportTableBody").append(a)}}))},exportReport:function(e,t,s){var r="lmsReportsAction.zp?action=exportLearnersByLocation&data="+t+"&startIdx="+s+"&exportType="+e+"&repType="+ZPLite.Reports.selectedTab,l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",r),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"LEARNER_LOCATION_REPORT_SCROLL",xmode:"LEARNER_LOCATION_REPORT_X_SCROLL"}},learnerCourseProgressReport:{reportName:"LEARNER_COURSE_PROGRESS_REPORT",XLABLES:[],RECORDIDS:[],initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.learnerCourseProgressReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.learnerCourseProgressReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName),filterData={},filterData.filterType="timePeriod",filterData.onChangeCallback=ZPLite.Reports.LMS.learnerCourseProgressReport.onChangeCallback,ZPLite.Reports.LMS.Filters.constuctFilter(filterData),ZPLite.Reports.LMS.learnerCourseProgressReport.generateReport()},onChangeCallback:function(e){el=e.target,_rel=el.closest("[_rel]")?el.closest("[_rel]").getAttribute("_rel"):null;var t=Layout.Page.container;t.find(".fil").find("[_rel=timeperiodFilterText]").html("all"==_rel?optionsArr[0]:optionsArr[_rel]),t.find('[_rel="timeperiodFilterOptions"]').find(".sel")[0].className="",lmsbase.addClass(el.closest("[_rel]"),"sel"),t.find("div[_rel=timeperiodFilter]").data("value",_rel),lmsbase.removeClass(t.find('[_rel="filterMenu"]')[0],"open"),ZPLite.Reports.LMS.learnerCourseProgressReport.generateReport()},generateReport:function(){var e=Layout.Page.container;e.find(".ZPNdata").fadeOut(100).remove(),e.find("#learnerCourseProgressReport").before(ZPeople.LOADING_HTML),e.find("#learnerCourseProgressReport").addClass("DN"),e.find("#learnerCourseProgressReportList").addClass("DN"),filterParams=ZPLite.Reports.LMS.learnerCourseProgressReport.getFilterParams();var t={action:"getLearnerCourseProgressReport",timePeriodFilValue:filterParams.timePeriodVal,startIdx:0,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",t,(function(t,s){if(e.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==t&&t.length>0&&(!t[1].error||"permissionDenied"!=t[1].error)&&0!=Object.keys(t[1].courseLearners).length){if(e.find("#learnerCourseProgressReport").removeClass("DN"),0==Object.keys(t[1].courseLearners).length)return e.find("#learnerCourseProgressReportChart").html(ZPUtil.newNoDataHTML("CR-pa-goal-rpt")),void e.find("#learnerCourseProgressReportList").addClass("DN");var r=ZPLite.Reports.LMS.Util.generateChartData(t[1].courseLearners,Object.keys(t[1].courseLearners).length<=15?Object.keys(t[1].courseLearners).length:15,!1,ZPLite.Reports.LMS.learnerCourseProgressReport.getColumnInfo),l={};l.renderTo=e.find("#learnerCourseProgressReportChart").get(0),l.title=ZPI18N.getString("zp.lms.reports.leanersCourseProgressReport"),l.titleAlignment="center",l.spacingTop=10,l.spacingBottom=50,l.spacingLeft=50,l.spacingRight=50,l.enableLegend=!0,l.removeTooltip=!0,l.dataArray=r.ydata,l.xAxisTitle=ZPI18N.getString("zp.lms.feedback.courses"),l.xAxisLabel=r.xlabels,l.xAsixLabelRotation=-60,Object.keys(t[1].courseLearners).length>20?(l.enableScroll=!0,l.xAxisMaxPointsOnFocus=19):l.xAxisMaxPointsOnFocus=Object.keys(t[1].courseLearners).length-1,l.fireScrollMode=ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,l.fireScrollCallback=ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.loadMoreData,ZPLite.Firescroll.reset(e.find("#learnerCourseProgressReport"),ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode),ZPLite.Firescroll.init(e.find("#learnerCourseProgressReport"),ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,{maxFetchLimit:30,callback:l.fireScrollCallback}),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,Object.keys(t[1].courseLearners).length),l.stackingValue="normal",l.yAxisTitle=ZPI18N.getString("zp.lms.learnercount"),l.allowDecimals=!1,l.cursor="pointer",ZPLite.Reports.LMS.Util.resetChartValues(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode),ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,r.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,r.reportIds),l.events={click:function(t){ZPLite.Firescroll.reset(e.find("#learnerCourseProgressReport"),ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.mode),ZPLite.Firescroll.init(e.find("#learnerCourseProgressReport"),ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.mode,{maxFetchLimit:50,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.mode),ZPLite.Reports.LMS.learnerCourseProgressReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,t.point.x),startIdx,t.point.series.options.extra.columnName,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,t.point.x))}}),ZPLite.Reports.LMS.learnerCourseProgressReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,t.point.x),1,t.point.series.options.extra.columnName,ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,t.point.x))}},ZPLite.Reports.Util.constructColumnChart(l),r.reportIds.length>0&&ZPLite.Reports.LMS.learnerCourseProgressReport.constructListView(ZPLite.Reports.LMS.Util.getRecordId(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,0),1,"inprogress",ZPLite.Reports.LMS.Util.getXlabel(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,0)),window.onclick=function(t){if(el=t.target,"exportMenu"!=el.getAttribute("id")&&(null==el.closest('[_rel="timeperiodFilter"]')||null!=el.closest('[_rel="timeperiodFilterOptions"]'))){dropDowns=e.find("#exportEl").find(".ddown");for(var s=0;s<dropDowns.length;s++)dropDowns[s].classList.contains("open")&&dropDowns[s].classList.remove("open")}}}else e.find("#learnerCourseProgressReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},getFilterParams:function(){if(filterParams={},Layout.Page.container.find("div[_rel=timeperiodFilter]").length>0){var e=Layout.Page.container.find("div[_rel=timeperiodFilter]").data("value");filterParams.timePeriodVal=null!=e&&null!=e&&"all"!=e?e:void 0}return filterParams},constructListView:function(e,t,s,r){var l=Layout.Page.container;columnInfo=ZPLite.Reports.LMS.learnerCourseProgressReport.getColumnInfo(s);var a={action:"getLearnersBasedOnCourses",data:e,status:columnInfo.index,startIdx:t,repType:ZPLite.Reports.selectedTab,conreqcsr:csrfToken};$.get("/lmsReportsAction.zp",a,(function(s,a){if(void 0!==s&&s.length>0){if(0==(s[1].hasOwnProperty("Details")?s[1].Details.length:0))return void l.find("#learnerCourseProgressReportList").addClass("DN");l.find("#learnerCourseProgressReportList").removeClass("DN"),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.mode,s[1].Details.length);var n="";if(1==t){var i='<div><span class="title">'+ZPI18N.getString("zp.lms.reports.learners",[r,columnInfo.name])+'</span></div><div id="exportEl"></div>';l.find("#learnerCourseProgressReportHeader").html(i),n='<table class="table table-hover"><tbody id="learnerCourseProgressReportTableBody">'}for(var o=0;o<s[1].Details.length;o++)data=s[1].Details[o],n+='<tr class="ZPLRow"><td class="fxdtd"><img class="FL" src='+data.photoPath+'><div class="ZPusrName"><span class="ellipsis W200 CP"><b>'+data.employeeId+"</b>"+data.name+"</span></div></td></tr>";1==t?(n+="</tbody></table>",l.find("#learnerCourseProgressReportBody").html(n),exportObj={},exportObj.elem=l.find("#learnerCourseProgressReportHeader").find("#exportEl"),exportObj.opns={},exportObj.opns[0]=ZPI18N.getString("zp.lms.reports.exportAsXLS"),exportObj.opns[1]=ZPI18N.getString("zp.lms.reports.exportAsXLSX"),exportObj.opns[2]=ZPI18N.getString("zp.lms.reports.exportAsCSV"),exportObj.opns[3]=ZPI18N.getString("zp.lms.reports.exportAsTSV"),exportObj.baseEl=l.find("#learnerCourseProgressReport"),exportObj.exportCallback=function(t){ZPLite.Reports.LMS.learnerCourseProgressReport.exportReport(t,e,columnInfo.index)},ZPLite.Reports.LMS.Util.constructExport(exportObj)):l.find("#learnerCourseProgressReportTableBody").append(n)}}))},exportReport:function(e,t,s){var r="lmsReportsAction.zp?action=exportLearnersBasedOnCourses&data="+t+"&exportType="+e+"&status="+s+"&repType="+ZPLite.Reports.selectedTab,l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",r),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},getColumnInfo:function(e){var t={};return"inprogress"==e?(t.name=ZPI18N.getString("zp.lms.inprogress"),t.color="#458bd6",t.index=1):"completed"==e?(t.name=ZPI18N.getString("zp.lms.content.Completed"),t.color="#00bd9e",t.index=2):"overdueCompleted"==e?(t.name=ZPI18N.getString("zp.lms.reports.overdueCompleted"),t.color="#faba59",t.index=3):"overdue"==e&&(t.name=ZPI18N.getString("zp.lms.overdue"),t.color="#e95b6d",t.index=4),t},Firescroll:{mode:"LEARNER_COURSE_PROGRESS_REPORT_SCROLL",xmode:"LEARNER_COURSE_PROGRESS_REPORT_X_SCROLL",loadMoreData:function(){filterParams=ZPLite.Reports.LMS.learnerCourseProgressReport.getFilterParams(),ZPLite.Firescroll.setActiveStatus(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,!1);var e={action:"getLearnerCourseProgressReport",timePeriodFilValue:filterParams.timePeriodVal,startIdx:ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode),repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",e,(function(e,t){if(void 0!==e&&e.length>0){var s=ZPLite.Reports.LMS.Util.generateChartData(e[1].courseLearners,Object.keys(e[1].courseLearners).length<=15?Object.keys(e[1].courseLearners).length:15,!1,ZPLite.Reports.LMS.learnerCourseProgressReport.getColumnInfo);ZPLite.Reports.LMS.Util.setXlabels(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,s.xlabels),ZPLite.Reports.LMS.Util.setRecordIds(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,s.reportIds);for(var r=Layout.Page.container.find("#learnerCourseProgressReportChart").highcharts(),l=r.xAxis[0].categories,a=0;a<s.xlabels.length;a++)l.push(s.xlabels[a]),r.series[0].addPoint(s.ydata[0].data[a],!1,!1),r.series[1].addPoint(s.ydata[1].data[a],!1,!1),r.series[2].addPoint(s.ydata[2].data[a],!1,!1),r.series[3].addPoint(s.ydata[3].data[a],!1,!1);r.xAxis[0].setCategories(l,!1),r.redraw(),ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.learnerCourseProgressReport.Firescroll.xmode,Object.keys(e[1].courseLearners).length)}}))}}},learnerProgressReport:{reportName:"LEARNER_PROGRESS_REPORT",XLABLES:[],RECORDIDS:[],initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.learnerProgressReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.learnerProgressReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName);var e=Layout.Page.container;filterData={},filterData.elem=e.find('[name="employeeFilter"]'),filterData.filterType="employee",filterData.firescrollMode=!0,filterData.onChangeCallback=ZPLite.Reports.LMS.learnerProgressReport.onChangeCallback,ZPLite.Reports.LMS.Filters.constuctFilter(filterData),ZPLite.Firescroll.init(e.find("#learnerProgressReport"),ZPLite.Reports.LMS.learnerProgressReport.Firescroll.mode,{maxFetchLimit:25,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.learnerProgressReport.Firescroll.mode),ZPLite.Reports.LMS.learnerProgressReport.generateReport(startIdx)}});var t=ZPeople.getUserDetailsById(erecno);ZPLite.Filters.setValues(filterData.elem,[{id:erecno,text:ZPeople.decodeTxt(ZPeople.escapeHtml(t.empid+" "+t.name)),photoUrl:t.avatar}]),"myReports"==ZPLite.Reports.selectedTab?filterData.elem.off("click"):filterData.elem.on("click"),ZPLite.Reports.LMS.learnerProgressReport.generateReport(1)},onChangeCallback:function(e){var t=Layout.Page.container;ZPLite.Firescroll.reset(t.find("#learnerProgressReport"),ZPLite.Reports.LMS.learnerProgressReport.Firescroll.mode),ZPLite.Firescroll.init(t.find("#learnerProgressReport"),ZPLite.Reports.LMS.learnerProgressReport.Firescroll.mode,{maxFetchLimit:25,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.learnerProgressReport.Firescroll.mode),ZPLite.Reports.LMS.learnerProgressReport.generateReport(startIdx)}}),ZPLite.Reports.LMS.learnerProgressReport.generateReport(1)},generateReport:function(e){var t=Layout.Page.container;t.find(".ZPNdata").fadeOut(100).remove(),1==e&&(t.find("#learnerProgressReport").before(ZPeople.LOADING_HTML),t.find("#learnerProgressReport").addClass("DN")),filterParams=ZPLite.Reports.LMS.learnerProgressReport.getFilterParams();var s={action:"fetchLearnerProgress",userErecno:filterParams.employee,startIdx:e,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",s,(function(s,r){if(t.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==s&&s.length>0&&(!s[1].error||"permissionDenied"!=s[1].error)&&0!=s[1].learnerProgress.length){t.find("#learnerProgressReport").removeClass("DN"),learnerProgress=s[1].learnerProgress;var l="";for(ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.learnerProgressReport.Firescroll.mode,s[1].learnerProgress.length),idx=0;idx<learnerProgress.length;idx++){if(learner=learnerProgress[idx],grade="","1"==learner.gradeScale&&null!=learner.grade&&""!=learner.grade)grade=learner.grade;else if("2"==learner.gradeScale&&null!=learner.grade&&""!=learner.grade){var a="("+ZPI18N.getString("zp.lms.gradeBook.pass")+")";"0"==learner.gradeColor&&(a="("+ZPI18N.getString("zp.lms.gradeBook.fail")+")"),grade=learner.grade+a}else"3"==learner.gradeScale&&null!=learner.grade&&""!=learner.grade&&(grade=learner.grade+"(Points)");grade=lmsform.changetoI18N(grade),l+='<tr class="ZPLRow" courseId="'+learnerProgress[idx].courseId+'" batchId="'+learnerProgress[idx].batchId+'" onclick="ZPLite.Reports.LMS.learnerProgressReport.fetchEntityStatus(\''+learnerProgress[idx].courseName+"', '"+learnerProgress[idx].courseId+"', '"+learnerProgress[idx].batchId+"')\"><td>"+learnerProgress[idx].courseName+"</td><td>"+(0!=learnerProgress[idx].batchId?learnerProgress[idx].batchName:"-")+"</td><td>"+learnerProgress[idx].courseType+"</td><td>"+learnerProgress[idx].enrolledDate+"</td><td>"+learnerProgress[idx].completionStatus+"</td><td>"+learnerProgress[idx].completionPercentage+"</td><td>"+(""!=learnerProgress[idx].diffInDates?learnerProgress[idx].diffInDates:"-")+"</td><td>"+(""!=grade?grade:"-")+"</td><td>"+learnerProgress[idx].attendance+"</td><td>"+zplms.msToDHM(learnerProgress[idx].totalTimeSpent)+"</td></tr>"}1==e?t.find("#learnerProgressReportBody").html(l):t.find("#learnerProgressReportBody").append(l)}else t.find("#learnerProgressReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},fetchEntityStatus:function(e,t,s){let r={action:"fetchLearnerProgressByCourse",courseId:t,userErecno:filterParams.employee,batchId:s,repType:ZPLite.Reports.selectedTab};zplms.get("/lmsReportsAction.zp",r,(function(t){let s=t[1].entitiesStatus;ZPLite.Reports.LMS.learnerProgressReport.openModal(e,s)}))},openModal:function(e,t){document.getElementById("courseEntityModal")||document.body.insertAdjacentHTML("beforeend",'\n\t\t\t\t<div id="courseEntityModal" class="zpl_mdl zpl_mmd zpl_mopen" style="display:none;">\n\t\t\t\t\t<div class="zpl_minr"> \n\t\t\t\t\t\t<div class="zpl_mhder"> \n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<h4 id="modalTitle">Course Name</h4>\n\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t<a class="_cls PI_cls" onclick="ZPLite.Reports.LMS.learnerProgressReport.closeModal()"></a> \n\t\t\t\t\t\t</div> \n\t\t\t\t\t\t<div class="zpl_mcnt" id="modalContentArea">\n\t\t\t\t\t\t\t\x3c!-- Content injected dynamically --\x3e\n\t\t\t\t\t\t</div> \n\t\t\t\t\t\t<div class="zpl_mfoter"> \n\t\t\t\t\t\t\t<button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="ZPLite.Reports.LMS.learnerProgressReport.closeModal()">Cancel</button> \n\t\t\t\t\t\t</div> \n\t\t\t\t\t</div> \n\t\t\t\t</div>');const s=document.getElementById("courseEntityModal"),r=document.getElementById("modalTitle"),l=document.getElementById("modalContentArea");if(r.innerText=e,l.innerHTML="",0===t.length)l.innerHTML=`\n\t\t\t\t\t<div class="zpl_Emptydata">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class="zpl_emptimg zp_nd_nodata"></div>\n\t\t\t\t\t\t\t<h4>${ZPI18N.getString("zp.lms.reports.noEntities")}</h4>\n\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.lms.reports.noEntitiesDesc")}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;else{const e=`\n\t\t\t\t\t<div class="zpl_tblres"> \n\t\t\t\t\t\t<table class="zpl_tbl zpl_tblfxd"> \n\t\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.lms.entityName")}</th>\n\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.lms.totaltimespent")}</th>\n\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.lms.reports.entitytype")}</th>\n\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.status")}</th>\n\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.duration")}</th>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</thead> \n\t\t\t\t\t\t\t<tbody id="modalEntityBody"></tbody> \n\t\t\t\t\t\t</table> \n\t\t\t\t\t</div>`;l.innerHTML=e;const s=document.getElementById("modalEntityBody");t.forEach((e=>{const t=document.createElement("tr");t.innerHTML=`\n\t\t\t\t\t\t<td><span>${ZSEC.Encoder.encodeForHTML(e.entityName)}</span></td>\n\t\t\t\t\t\t<td><span>${zplms.msToDHM(e.totalTimeSpent)}</span></td>\n\t\t\t\t\t\t<td><span>${0==e.entityType?ZPI18N.getString("zp.file"):1==e.entityType?ZPI18N.getString("zp.link"):3==e.entityType?ZPI18N.getString("zp.lms.test.offlineTest"):4==e.entityType?ZPI18N.getString("zp.lms.test.onlineTest"):5==e.entityType?ZPI18N.getString("zp.lms.assignment"):6==e.entityType?ZPI18N.getString("zp.session"):7==e.entityType?ZPI18N.getString("zp.lms.scorm"):"Undefined entity"}</span></td>\n\t\t\t\t\t\t<td><span>${0==e.status?ZPI18N.getString("zp.chkinprogress"):ZPI18N.getString("zp.completed")}</span></td>\n\t\t\t\t\t\t<td><span>${e.entityDuration} minutes</span></td>`,s.appendChild(t)}))}s.style.display="block"},closeModal:function(){document.getElementById("courseEntityModal").style.display="none"},getFilterParams:function(){filterParams={};var e=ZPLite.Filters.getValues(Layout.Page.container.find('[name="employeeFilter"]'));return filterParams.employee=-1,void 0!==e&&e.length>0&&(filterParams.employee=e[0].id),filterParams},showExport:function(){mode="lms",ZP5Export.init(mode,{submitCallback:ZPLite.Reports.LMS.learnerProgressReport.exportReport})},exportReport:function(e,t,s){var r=1;"xls"==s?r=1:"xlsx"==s?r=2:"csv"==s?r=3:"tsv"==s&&(r=4),filterParams=ZPLite.Reports.LMS.learnerProgressReport.getFilterParams();t="lmsReportsAction.zp?action=exportLearnerProgress&userErecno="+filterParams.employee+"&exportType="+r+"&repType="+ZPLite.Reports.selectedTab;var l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",t),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"LEARNER_PROGRESS_REPORT_SCROLL"}},learningPlanProgressReport:{reportName:"LP_LEARNER_PROGRESS_REPORT",XLABLES:[],RECORDIDS:[],Firescroll:{mode:"LP_LEARNER_PROGRESS_REPORT_SCROLL"},initPage:function(){ZPLite.Reports.setCurrentModule(ZPLite.Reports.LMS.moduleName),ZPLite.Reports.setCurrentReport(ZPLite.Reports.LMS.learningPlanProgressReport.reportName);var e={isModuleDataNeeded:!0,callback:ZPLite.Reports.LMS.learningPlanProgressReport.init};ZPLite.Reports.initPage(e)},init:function(){ZPLite.Reports.Util.setAvailableReportsForModule(ZPLite.Reports.LMS.moduleName);var e=Layout.Page.container;filterData={},filterData.elem=e.find('[name="employeeFilter"]'),filterData.filterType="employee",filterData.firescrollMode=!0,filterData.onChangeCallback=ZPLite.Reports.LMS.learningPlanProgressReport.onChangeCallback,ZPLite.Reports.LMS.Filters.constuctFilter(filterData),ZPLite.Firescroll.init(e.find("#LPlearnerProgressReport"),ZPLite.Reports.LMS.learningPlanProgressReport.Firescroll.mode,{maxFetchLimit:25,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.learningPlanProgressReport.Firescroll.mode),ZPLite.Reports.LMS.learningPlanProgressReport.generateReport(startIdx)}});var t=ZPeople.getUserDetailsById(erecno);ZPLite.Filters.setValues(filterData.elem,[{id:erecno,text:ZPeople.decodeTxt(ZPeople.escapeHtml(t.empid+" "+t.name)),photoUrl:t.avatar}]),"myReports"==ZPLite.Reports.selectedTab?filterData.elem.off("click"):filterData.elem.on("click"),ZPLite.Reports.LMS.learningPlanProgressReport.generateReport(1)},onChangeCallback:function(e){var t=Layout.Page.container;ZPLite.Firescroll.reset(t.find("#LPlearnerProgressReport"),ZPLite.Reports.LMS.learningPlanProgressReport.Firescroll.mode),ZPLite.Firescroll.init(t.find("#LPlearnerProgressReport"),ZPLite.Reports.LMS.learningPlanProgressReport.Firescroll.mode,{maxFetchLimit:25,callback:function(){startIdx=ZPLite.Firescroll.getStartIndex(ZPLite.Reports.LMS.learningPlanProgressReport.Firescroll.mode),ZPLite.Reports.LMS.learningPlanProgressReport.generateReport(startIdx)}}),ZPLite.Reports.LMS.learningPlanProgressReport.generateReport(1)},generateReport:function(e){var t=Layout.Page.container;t.find(".ZPNdata").fadeOut(100).remove(),1==e&&(t.find("#LPlearnerProgressReport").before(ZPeople.LOADING_HTML),t.find("#LPlearnerProgressReport").addClass("DN")),filterParams=ZPLite.Reports.LMS.learningPlanProgressReport.getFilterParams();var s={action:"fetchLearningPlansByLearner",userErecno:filterParams.employee,startIndex:e,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",s,(function(s,r){if(t.find("[id=zp_page_loading]").fadeOut(200).remove(),void 0!==s&&s.length>0&&(!s[1].error||"permissionDenied"!=s[1].error)&&0!=s[1].length){t.find("#LPlearnerProgressReport").removeClass("DN"),learnerProgress=s[1];let r="";for(ZPLite.Firescroll.setFetchedCount(ZPLite.Reports.LMS.learningPlanProgressReport.Firescroll.mode,s[1].length),idx=0;idx<learnerProgress.length;idx++){learner=learnerProgress[idx];var l=0==learnerProgress[idx].planInfo.durationType?ZPI18N.getString("zp.lms.minutes"):1==learnerProgress[idx].planInfo.durationType?ZPI18N.getString("zp.lms.hours"):2==learnerProgress[idx].planInfo.durationType?ZPI18N.getString("zp.lms.days"):3==learnerProgress[idx].planInfo.durationType?ZPI18N.getString("zp.weeks"):4==learnerProgress[idx].planInfo.durationType?ZPI18N.getString("zp.lms.learningplan.months"):ZPI18N.getString("zp.lms.learningplan.years");r+='<tr class="ZPLRow" planId="'+learnerProgress[idx].planInfo.planId+'"><td><span class="d-flexC flexclmcap"><i class="PI_argt expnd" onclick="ZPLite.Reports.LMS.learningPlanProgressReport.togglePlanCoursesRow(this)"></i><span>'+learnerProgress[idx].planInfo.planName+"</span></span></td><td>"+learnerProgress[idx].planInfo.activeCourseCount+"</td><td>"+(!1===learnerProgress[idx].userInfo.isUserCompletedPlan?ZPI18N.getString("zp.lms.inprogress"):ZPI18N.getString("zp.lms.content.Completed"))+"</td><td>"+learnerProgress[idx].planInfo.duration+" "+(l||"")+"</td></tr>"}1==e?t.find("#LPlearnerProgressReportBody").html(r):t.find("#LPlearnerProgressReportBody").append(r)}else t.find("#LPlearnerProgressReport").before(ZPUtil.newNoDataHTML("CR-pa-goal-rpt","path4",ZPI18N.getString("zp.reports.noreports")))}))},togglePlanCoursesRow:function(e){const t=e.closest("tr"),s=t.getAttribute("planId"),r=t.nextElementSibling;if(document.querySelectorAll(".zpl_tblsubtbl").forEach((e=>{e.previousElementSibling?.querySelector(".PI_argt.expnd")?.classList.remove("expanded"),e.remove()})),r&&r.classList.contains("zpl_tblsubtbl"))e.classList.remove("expanded");else{var l={action:"fetchCourseOfLPByLearner",userErecno:filterParams.employee,planId:s,startIdx:0,repType:ZPLite.Reports.selectedTab};$.get("/lmsReportsAction.zp",l,(function(s){if(s&&s.length>0&&(!s[1].error||"permissionDenied"!=s[1].error)){const r=s[1];let l=r.map((e=>`\n\t\t\t\t\t\t<tr data-popup-open="course_entity" class="CP" onclick="ZPLite.Reports.LMS.learningPlanProgressReport.fetchEntityStatus('${e.courseName}','${e.courseId}','${e.batchId}')" >\n\t\t\t\t\t\t\t<td><span>${e.courseName}</span></td>\n\t\t\t\t\t\t\t<td><span>${null==e.batchName?"-":e.batchName}</span></td>\n\t\t\t\t\t\t\t<td><span>${e.courseType}</span></td>\n\t\t\t\t\t\t\t<td><span class="grn">${e.completionStatus}</span></td>\n\t\t\t\t\t\t\t<td><span>${e.completionPercentage}</span></td>\n\t\t\t\t\t\t\t<td><span>${zplms.msToDHM(e.totalTimeSpent)}</span></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t`)).join("");const a=document.createElement("tr");a.className="zpl_tblsubtbl",r.length<1?a.innerHTML=`\n\t\t\t\t\t\t\t<td colspan="7">\n\t\t\t\t\t\t\t\t<div class="zpl_Emptydata">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div class="zpl_emptimg zp_nd_nodata"></div>\n\t\t\t\t\t\t\t\t\t\t<h4>${ZPI18N.getString("zp.lms.course.coursenocourse")}</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t`:a.innerHTML=`\n\t\t\t\t\t\t<td colspan="7">\n\t\t\t\t\t\t\t<div class="zpl_tblsubtbl_cnt">\n\t\t\t\t\t\t\t\t<table class="wd100_per">\n\t\t\t\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.lms.course.coursename")}</th>\n\t\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.lms.batchname")}</th>\n\t\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.lms.courseType")}</th>\n\t\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.lms.reports.completionStatus")}</th>\n\t\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.lms.reports.completionPercentage")}</th>\n\t\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.time_taken")}</th>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t\t${l}\n\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t`,t.insertAdjacentElement("afterend",a),e.classList.add("expanded")}}))}},fetchEntityStatus:function(e,t,s){let r={action:"fetchLearnerProgressByCourse",courseId:t,userErecno:filterParams.employee,batchId:s,repType:ZPLite.Reports.selectedTab};zplms.get("/lmsReportsAction.zp",r,(function(t){let s=t[1].entitiesStatus;ZPLite.Reports.LMS.learnerProgressReport.openModal(e,s)}))},closeModal:function(){document.getElementById("courseEntityModal").style.display="none"},getFilterParams:function(){filterParams={};var e=ZPLite.Filters.getValues(Layout.Page.container.find('[name="employeeFilter"]'));return filterParams.employee=-1,void 0!==e&&e.length>0&&(filterParams.employee=e[0].id),filterParams},showExport:function(){mode="lms",ZP5Export.init(mode,{submitCallback:ZPLite.Reports.LMS.learningPlanProgressReport.exportReport})},exportReport:function(e,t,s){var r=1;"xls"==s?r=1:"xlsx"==s?r=2:"csv"==s?r=3:"tsv"==s&&(r=4),filterParams=ZPLite.Reports.LMS.learningPlanProgressReport.getFilterParams();t="lmsReportsAction.zp?action=exportLearningPlanProgress&userErecno="+filterParams.employee+"&exportType="+r+"&repType="+ZPLite.Reports.selectedTab;var l=document.createElement("form");l.id="lmsformexport";var a=document.createElement("input");l.setAttribute("method","post"),l.setAttribute("action",t),l.setAttribute("target","exportresp"),a.setAttribute("type","hidden"),a.setAttribute("name","conreqcsr"),a.setAttribute("value",csrfToken),l.appendChild(a),document.body.appendChild(l),l.submit(),$("#lmsformexport").remove()},Firescroll:{mode:"LP_LEARNER_PROGRESS_REPORT_SCROLL"}}};var lmswelcome={_node:null,skillset:null,categories:null,startIndex:0,initiate:function(){var e=this.elem.appendChild(document.createElement("div"));e.className="zp_Intsur",e.innerHTML="<ul>"+lmswelcome.firstPage()+lmswelcome.skillsList()+lmswelcome.categoriesList()+"</ul>",lmsbase.addListener(e,"click",lmswelcome.handle,!1),lmswelcome._node=e},handle:function(e){var t=e.target||e.srcElement;if("zpthm"==t.className){var s=parseInt(t.getAttribute("_rel"),10);if(1==s&&null==lmswelcome.skillset&&null==lmswelcome.categories&&lmswelcome.updateCategoryInfo("",""),1==s&&null!=lmswelcome.skillset)(r=lmswelcome._node.querySelectorAll(".zp_transfm"))[s].className="zp_transfm zp_tranpls",r[s-1].className="zp_transfm zp_tranmns",1==s&&lmswelcome.getSkillsets();else if(1==s&&0!=lmswelcome.categories.length||2==s&&0!=lmswelcome.categories.length){var r;s=2,(r=lmswelcome._node.querySelectorAll(".zp_transfm"))[s].className="zp_transfm zp_tranpls",r[s-1].className="zp_transfm zp_tranmns",2==s&&lmswelcome.updateCategories()}else lmswelcome.updateCategoryInfo("","",0)}else"active"==t.getAttribute("skey")&&("sel"==t.className?t.className="":t.className="sel",lmswelcome.updateCategoryInfo(t.textContent,t.getAttribute("catId")))},updateCategoryInfo:function(e,t,s){var r={textContent:e};zplms.patch("/lms/categories/"+t+"/favourite",r,(function(e){0==s&&lmswelcome.getCommonInfo()}))},getWelcomePageData:function(){zplms.get("/lms/welcome",null,(function(e){lmswelcome.skillset=e[1][0],lmswelcome.categories=e[1][1],lmswelcome.favCategories=e[1][2]}))},getCommonInfo:function(){zplms.get("/lms/info",null,(function(e){lmsbase._modHash[lmsbase._role].welcome=!e[1];lms.changeHash("hash","courses",1)}))},firstPage:function(){return src=ZPeople.getResourceURL(hrImageUrl+"intro1.png"),src1=ZPeople.getResourceURL(hrImageUrl+"intro3.png"),'<li class="zp_transfm zp_tranpls"><div class="zp_cntsur"><h3>'+ZPI18N.getString("zp.lms.welcome.welcomesg")+"</h3><p>"+ZPI18N.getString("zp.lms.welcome.welcomesgD")+'</p><div><ul class="zp_slctyp"><li><div><img src='+src+" /></div><h3>"+ZPI18N.getString("zp.lms.settings.selfpacedtraining")+"</h3></li><li><div><img src="+src1+" /></div><h3>"+ZPI18N.getString("zp.lms.settings.InstructorLed")+'</h3></li></ul></div></div><div class="zp_btn"><button class="zpthm" _rel="1" >'+ZPI18N.getString("zp.lms.notes.continue")+"</button></div></li>"},updateCategories:function(){var e=lmswelcome.categories,t="";for(i=0;i<e.length;i++)t+='<li skey="active" catId ='+e[i].catId+">"+lmsFormConstants.getValue(e[i].category)+"</li>";lmswelcome._node.querySelector('[class="zp_slctinpt"]').innerHTML=t},getSkillsets:function(){var e=lmswelcome.skillset,t="",s="";for(i=0;i<e.length;i++)4==e[i].skillSetScore?s="zp_prggrn":3==e[i].skillSetScore?s="zp_prgblu":2==e[i].skillSetScore?s="zp_prgorg":1==e[i].skillSetScore&&(s="zp_prgrd"),t+="<li><h5>"+e[i].skillSetName+'</h5><div class="'+s+'"><span>'+e[i].skillSetScore/4*100+"%</span></div></li>";lmswelcome._node.querySelector('[class="zp_sklprg"]').innerHTML=t},skillsList:function(){return'<li class="zp_transfm"><div class="zp_cntsur"><h3>'+ZPI18N.getString("zp.lms.welcome.skillset")+"</h3><p>"+ZPI18N.getString("zp.lms.welcome.skillsetD")+'</p><div><ul class="zp_sklprg"></ul></div></div><div class="zp_btn"><button class="zpthm" _rel="2" ">'+ZPI18N.getString("zp.continue")+"</button></div></li>"},categoriesList:function(){return'<li class="zp_transfm"><div class="zp_cntsur"><h3>'+ZPI18N.getString("zp.lms.pickfavcategory")+"</h3><p>"+ZPI18N.getString("zp.lms.welcome.favD")+'</p><div><ul class="zp_slctinpt"></ul></div></div><div class="zp_btn"><button class="zpthm" _rel="3">'+ZPI18N.getString("zp.continue")+"</button></div></li>"}},lmsmanagerevaluation={root:null,updateRubrics:function(e){var t=lmsmanagerevaluation.constructRubrics(e.eventInfo.rubrics),s=lmsmanagerevaluation.root.querySelector("[_rel=addRubrics]")?lmsmanagerevaluation.root.querySelector("[_rel=addRubrics]"):lmsmanagerevaluation.root.querySelector("[rubricsContainer]");s.parentElement.replaceChild(t,s)},constructRubrics:function(e){var t=document.createElement("div");if(t.setAttribute("rubricsContainer",""),null!=e)var s='<div class="zp_Tatch" rubricsId="'+e.rubricsId+'"><div class="zp_Ticn"><i class="IC-mre" _rel="rubricsMoreEl"></i></div><p class="drft">'+("published"==e.state?ZPI18N.getString("zp.published"):ZPI18N.getString("zp.draft"))+"</p><font><div><font>"+ZPI18N.getString("zp.lms.rubrics")+"</font><h4>"+ZSEC.Encoder.encodeForHTML(e.name)+"</h4><p>Score: <b>"+e.marks+" Points </b></div></font></div>";else s='<font _rel="addRubrics" class="zp_lnkblu"><p><i class="IC-plus"></i><span>'+ZPI18N.getString("zp.lms.rubrics.addRubrics")+"</span></p></font>";return t.innerHTML=s,t}},lmsmanagerevaluation_reqs={sendRequestToFetchSettingsData:function(e,t,s){var r="/lms/courses/"+e+"/settings/managerevaluation";zplms.get(r,null,t,s)},updateCourseManagerEvalutionSettings:function(e,t,s,r){var l="/lms/courses/"+e+"/settings/managerevaluation";zplms.put(l,{settingsData:JSON.stringify(t)},s,r)},createAchievement:function(e,t,s,r){var l="/lms/courses/"+e+"/settings/managerevaluation/achievements";zplms.post(l,{achievementData:JSON.stringify(t)},s,r)},updateAchievement:function(e,t,s,r,l){var a="/lms/courses/"+e+"/settings/managerevaluation/achievement/"+t;zplms.patch(a,{achievementData:JSON.stringify(s)},r,l)},deleteAchievement:function(e,t,s,r){var l="/lms/courses/"+e+"/settings/managerevaluation/achievement/"+t;zplms.delete(l,null,s,r)},fetchDataOfReportee:function(e,t,s,r,l){if(null!=t)var a="/lms/courses/"+e+"/batches/"+t+"/managerevaluation/reportee/"+s;else a="/lms/courses/"+e+"/managerevaluation/reportee/"+s;zplms.get(a,null,r,l)},fetchDataOfSelf:function(e,t,s,r){if(null!=t)var l="/lms/courses/"+e+"/batches/"+t+"/managerevaluation";else l="/lms/courses/"+e+"/managerevaluation";zplms.get(l,null,s,r)}};!function(e){function t(e,t,s){this.courseId=e,this.container=t,this.type=2,this.settingsData={},this.close_callback=s,lmsmanagerevaluation.root=t}function s(e){return{start:function(){e.construct()},alertAndClose:function(){e.alertAndClose()},forceClose:function(){e.close()}}}t.prototype.construct=function(){this.contructInitialView()},t.prototype.contructInitialView=function(){var e=document.createDocumentFragment(),t=document.createElement("header"),s="<h2>"+ZPI18N.getString("zp.lms.managerevaluation.ManagerEvaluation")+"</h2><p>"+ZPI18N.getString("zp.lms.managerevaluation.description")+"</p>";t.innerHTML=s,this.header=t,this.formContainer=document.createElement("div");var r=document.createElement("div");r.className="zp_btn",this.buttonContainer=r,e.appendChild(this.header),e.appendChild(this.formContainer),e.appendChild(this.buttonContainer),this.container.appendChild(e),zplms.addLoadingBar(this.formContainer),this.fetchDataAndPostRequestConstruction()},t.prototype.fetchDataAndPostRequestConstruction=function(){var e=this;this.sendRequestToFetchSettingsData((function(t){e.fetchDataSuccessCallback(t)}),(function(t){e.fetchDataFailureCallback(t)}))},t.prototype.sendRequestToFetchSettingsData=function(e,t){lmsmanagerevaluation_reqs.sendRequestToFetchSettingsData(this.courseId,e,t)},t.prototype.fetchDataSuccessCallback=function(e){this.evaluationType=e.settings.settings.evaluationType,this.gradeScale=e.settings.gradeSettings.type,this.achievements={};for(var t=0;t<e.settings.settings.achievements.length;t++)this.achievements[e.settings.settings.achievements[t].id]=e.settings.settings.achievements[t];this.postRequestConstruction(e.settings.settings),this.constructButtons()},t.prototype.fetchDataFailureCallback=function(e){ZPeople.Message.showFailureMsg(e.responseJSON.message)},t.prototype.postRequestConstruction=function(e){zplms.removeLoadingBar(this.formContainer);var t=this.formContainer;lmsform.initiate(0,!1,this.formContainer);var s='<div class="zp_Sm zp_nobr"><p class="zp_Cnte"><i class="IC-information"></i> '+ZPI18N.getString("zp.lms.managerevaluation.skinEvaluationOnNoManager")+' <a href="https://www.zoho.com/people/help/adminguide/lms/managers_eval.html" target="_blank">'+ZPI18N.getString("zp.learnmore")+'</a></p><div class="zp_Copn"><ul evaluationTypeNode><li _rel = "evalutionType_0"><i class="IC-rdo"></i><div><i class="IC-selfpace"></i></div><h4>'+ZPI18N.getString("zp.score")+'</h4></li><li _rel = "evalutionType_1"><i class="IC-rdo"></i><div><i class="IC-ilt"></i></div><h4>'+ZPI18N.getString("zp.lms.rubrics")+'</h4></li><li _rel = "evalutionType_2"><i class="IC-rdo"></i><div><i class="IC-emtrl"></i></div><h4>'+ZPI18N.getString("zp.lms.managerevaluation.noEvaluation")+"</h4></li></ul></div></div>";t.innerHTML=s,lmsbase.addClass(t.querySelector("[_rel=evalutionType_"+this.evaluationType+"]"),"sel");var r=this.formContainer.querySelector("[evaluationTypeNode]");r.removeAttribute("evaluationTypeNode"),currentInstance=this,lmsbase.addListener(r,"click",(function(e){eve=e||this.ev;var t=eve.target,s=t.getAttribute("_rel")||t.closest("[_rel]").getAttribute("_rel");"evalutionType_0"!=s&&"evalutionType_1"!=s&&"evalutionType_2"!=s||(lmsbase.removeClass(r.querySelector(".sel"),"sel"),lmsbase.addClass(r.querySelector('[_rel = "'+s+'"]'),"sel"),currentInstance.evaluationType!=s.split("_")[1]&&(currentInstance.evaluationType=parseInt(s.split("_")[1]),currentInstance.constructEvalutionFields(currentInstance.settingsData)))})),this.settingsData=e,this.constructEvalutionFields(e)},t.prototype.constructEvalutionFields=function(e){var t=this.formContainer;currentInstance=this;var s=t.querySelector("[_rel=evalutionFields]")||document.createElement("div");if(s.setAttribute("_rel","evalutionFields"),s.innerHTML="",2!=this.evaluationType){var r="";1!=this.gradeScale&&2!=this.gradeScale||(r='<div class="zp_STfld"><div>'+lmsformcomponents.labelName({displayName:"zp.lms.gradebook.gradeCategory"},"h4")+"<p>"+ZPI18N.getString("zp.lms.managerevaluation.managerEvaluationGradeDescription")+'</p></div><div class="zp_Sm" gradeCategoryMenu></div></div>'),r+='<div class="zp_STfld"><div><h4> '+ZPI18N.getString("zp.lms.managerevaluation.whenToStartEvaluation")+"</h4><p>"+ZPI18N.getString("zp.lms.managerevaluation.whenToInitiateDescription")+"</p></div>"+this.getWhenToInitiateField(e.openTimeType,e.openTimeDelayValue,e.openTimeDelayUnit)+"</div>",0==this.evaluationType&&(r+='<div class="zp_STfld"><div><h4> '+ZPI18N.getString("zp.score")+"</h4><p>"+ZPI18N.getString("zp.lms.managerevaluation.scoreDescription")+'</p></div><div class="zp_Sm zp_nbr"><div>'+lmsform.insertField({fieldType:lmsform.fieldtype.NUMBER,labelName:"marks",isMandatory:!0,maxLength:4,no_autofocus:!0},"","",0,{componentValue:e.marks||""})+"</div></div></div>"),r+='<div class="zp_Sm zp_nbr"><div>'+lmsform.insertField({fieldType:lmsform.fieldtype.CHECKBOX,labelName:"showEvaluationToReportee",displayName:ZPI18N.getString("zp.lms.managerevaluation.showEvaluationToLearner"),autofillvalue:e.showEvaluationToReportee?"true":"false"},"","","")+"</div></div>",r+="<div>",1==this.evaluationType&&(r+='<div class="zp_Ldtl"><p>'+ZPI18N.getString("zp.lms.rubrics")+"</p><span>"+ZPI18N.getString("zp.lms.managerevaluation.managerevaluationRubrics")+"</span>"+this.constructRubrics(e.rubrics).outerHTML+"</div>"),r+='<div achievementContainer class="zp_Ldtl"><p>'+ZPI18N.getString("zp.lms.managerevaluation.overallAchievement")+"</p><span>"+ZPI18N.getString("zp.lms.managerevaluation.overallAchievementDescription")+'</span><div><div class="zp_Scat">';for(var l=Object.keys(this.achievements),a=0;a<l.length;a++)r+=this.constructAchievement(this.achievements[l[a]]).outerHTML;if(r+='<a _rel="new"><i class="IC-plus"> '+ZPI18N.getString("zp.lms.managerevaluation.addAchievement")+"</i></a></div></div></div>",s.innerHTML=r,this.formContainer.appendChild(s),lmsformcomponents.bind(),1==this.gradeScale||2==this.gradeScale){var n=t.querySelector("[gradeCategoryMenu]");n.removeAttribute("gradeCategoryMenu");var i={};e.gradeCategory&&(i[e.gradeCategory.categoryId]=[e.gradeCategory.categoryName]),lmsform.Obj=lmsgroupmenu.initiate(n.parentElement),lmsform.Obj.insertMenu(lmscoursegrade.createGradeCategoryMenu(this.courseId,n,i,(function(){var e=this.getSelectedValue();currentInstance.gradeCategoryId=0==e?null:e})))}var o=this.formContainer.querySelector("[name=marks]");o&&(o.min="1",lmsbase.addListener(o,"input",lmsformcomponents.numberFun));var c=this.formContainer.querySelector("[whenToInitiateContainer]");c.removeAttribute("whenToInitiateContainer");var d=c.querySelectorAll('[name="openTimeType"][fieldName="radioChoice"]'),m=c.querySelector("[name=openTimeDelay]");m.min="1",m.maxLength=5,lmsbase.addListener(m,"input",lmsformcomponents.numberFun),this.openTimeDelayContainerNode=c.querySelector("[openTimeDelayContainer]"),this.openTimeDelayContainerNode.removeAttribute("openTimeDelayContainer"),this.whenToInitiateContainer=c,lmsbase.addListener(d[0],"click",(function(){m.blur()})),lmsbase.addListener(d[1],"click",(function(){m.focus()}));var u=this.formContainer.querySelector("[achievementContainer]");u.removeAttribute("achievementContainer"),lmsbase.addListener(u,"click",(function(e){eve=e||this.ev;var t=eve.target,s=t.getAttribute("_rel")||t.closest("[_rel]").getAttribute("_rel");"new"==s?currentInstance.constructAchievementPopup():"edit"==s?currentInstance.constructAchievementPopup(currentInstance.achievements[t.closest("[achievementid]").getAttribute("achievementid")]):"delete"==s&&currentInstance.alertAndDeleteAchievement(currentInstance.achievements[t.closest("[achievementid]").getAttribute("achievementid")])}));var p=this.formContainer.querySelector("[rubricsContainer]");p&&lmsbase.addListener(p.parentElement,"click",(function(e){eve=e||this.ev;var t=eve.target,s=t.getAttribute("_rel")||t.closest("[_rel]").getAttribute("_rel");if("addRubrics"==s){for(var r=window.location.href.split("#")[0].split("/"),l="",a=0;a<r.length&&!r[a].includes("training");a++)l+=r[a]+"/";l+="courses/"+lmscourses.currentCourseId+"/lmsrubrics",window.open(l)}else"rubricsMoreEl"==s&&(_m=[{edit:[ZPI18N.getString("zp.edit")]},{delete:[ZPI18N.getString("zp.delete")]}],lmsmenu.initiate({elem:t,width:"130px",type:"dropdown",arrowHead:!0,menulist:_m}).on("click",(function(){if("edit"==this.value){for(var e=window.location.href.split("#")[0].split("/"),s="",r=0;r<e.length&&!e[r].includes("training");r++)s+=e[r]+"/";s=domainUrl+"/";s+="courses/"+lmscourses.currentCourseId+"/lmsrubrics/"+t.closest("[rubricsid]").getAttribute("rubricsid"),window.open(s)}else if("delete"==this.value){var l=currentInstance.constructRubrics(null);currentInstance.formContainer.querySelector("[rubricsId]").parentElement.replaceChild(l,currentInstance.formContainer.querySelector("[rubricsId]"))}})).bind())})),this.form=$.extend({},lmsform)}},t.prototype.constructRubrics=function(e){var t=document.createElement("div");if(t.setAttribute("rubricsContainer",""),null!=e)var s='<div class="zp_Tatch" rubricsId="'+e.rubricsId+'"><div class="zp_Ticn">'+(e.isRubricsAttempted?"":'<i class="IC-mre" _rel="rubricsMoreEl"></i>')+'</div><p class="drft">'+("published"==e.state?ZPI18N.getString("zp.published"):ZPI18N.getString("zp.draft"))+"</p><font><div><font>"+ZPI18N.getString("zp.lms.rubrics")+"</font><h4>"+ZSEC.Encoder.encodeForHTML(e.name)+"</h4><p>Score: <b>"+e.marks+" Points </b></div></font></div>";else s='<font _rel="addRubrics" class="zp_lnkblu"><p><i class="IC-plus"></i><span>'+ZPI18N.getString("zp.lms.rubrics.addRubrics")+"</span></p></font>";return t.innerHTML=s,t},t.prototype.constructAchievement=function(e){var t=document.createElement("div");return t.setAttribute("achievementid",e.id),t.innerHTML="<label>"+ZSEC.Encoder.encodeForHTML(lmsform.changetoI18N(e.name))+"<p>"+e.minimum+"% to "+e.maximum+'%</p></label><font><i _rel="edit" class="IC-edit"></i><i _rel="delete" class="IC-trash"></i></font>',t},t.prototype.constructAchievementPopup=function(e){var t=lmsbase.showMaskLayer(),s='<div class="zp_popup" style="width:400px"><div class="zp_Pohd"><font>'+(e?ZPI18N.getString("zp.lms.managerevaluation.editAchievement"):ZPI18N.getString("zp.lms.managerevaluation.addAchievement"))+'</font><i closepopup class="IC-cls"></i></div><div class="zp_Pocnt" style="max-height:600px;"><div><div class="zp_Sm"><label>'+ZPI18N.getString("zp.name")+"</label>"+lmsform.insertField({fieldType:lmsform.fieldtype.TEXTFIELD,labelName:"name",isMandatory:!0,no_autofocus:!1,displayName:ZPI18N.getString("zp.name")},"","",0,{componentValue:e?lmsform.changetoI18N(e.name):""})+'</div><div class="zp_Sm zp_c5"><label>'+ZPI18N.getString("zp.lms.managerevaluation.minimumScore")+"</label>"+lmsform.insertField({fieldType:lmsform.fieldtype.NUMBER,labelName:"minimum",isMandatory:!0,maxLength:3,no_autofocus:!0,displayName:ZPI18N.getString("zp.lms.managerevaluation.minimumScore")},"","","zeroPossible",{componentValue:e?e.minimum:""})+'</div><div class="zp_Sm zp_c5"><label>'+ZPI18N.getString("zp.lms.managerevaluation.maximumScore")+"</label>"+lmsform.insertField({fieldType:lmsform.fieldtype.NUMBER,labelName:"maximum",isMandatory:!0,maxLength:3,no_autofocus:!0,displayName:ZPI18N.getString("zp.lms.managerevaluation.maximumScore")},"","",0,{componentValue:e?e.maximum:""})+'</div></div></div><div savebutton class="zp_btn"><button class="zpthm">'+ZPI18N.getString("zp.save")+"</button></div></div>";t.innerHTML=s;var r=t.querySelector("[closepopup]");r.removeAttribute("closepopup"),lmsbase.addListener(r,"click",(function(){lmsbase.hideMaskLayer()}));var l=t.querySelector("[savebutton]");l.removeAttribute("savebutton"),currentInstance=this;for(var a=t.querySelectorAll('[fieldname="numberId"]'),n=0;n<a.length;n++)a[n].min=0,a[n].max=100,lmsbase.addListener(a[n],"input",this.numberFun);lmsbase.addListener(l,"click",(function(){achievementData={};var s=t.querySelector('[name="name"]');achievementData.name=s.value;var r=t.querySelector('[name="minimum"]');achievementData.minimum=parseInt(r.value);var l=t.querySelector('[name="maximum"]');achievementData.maximum=parseInt(l.value);var a=currentInstance.achievements,n=!0,i=!0;if(achievementsArr=Object.keys(currentInstance.achievements),""==achievementData.name)return lmsform.setErrorClass(s.parentElement.parentElement),void lmsform.setErrorText(s.parentElement.parentElement,ZPI18N.getString("zp.lms.managerevaluation.achievementNameNotEmpty"));if(achievementData.name.indexOf("<")>-1||achievementData.name.indexOf(">")>-1)return lmsform.setErrorClass(s.parentElement.parentElement),void lmsform.setErrorText(s.parentElement.parentElement,ZPI18N.getString("zp.lms.forms.cannotinclude"));if(lmsform.removeErrorClass(s.parentElement.parentElement),lmsform.removeErrorText(s.parentElement.parentElement),""==r.value)return lmsform.setErrorClass(r.parentElement.parentElement),void lmsform.setErrorText(r.parentElement.parentElement,ZPI18N.getString("zp.lms.managerevaluation.minimumValueNotEmpty"));if(lmsform.removeErrorClass(r.parentElement.parentElement),lmsform.removeErrorText(r.parentElement.parentElement),""==l.value)return lmsform.setErrorClass(l.parentElement.parentElement),void lmsform.setErrorText(l.parentElement.parentElement,ZPI18N.getString("zp.lms.managerevaluation.maxValueNotEmpty"));if(lmsform.removeErrorClass(l.parentElement.parentElement),lmsform.removeErrorText(l.parentElement.parentElement),r.value==l.value)return lmsform.setErrorClass(r.parentElement.parentElement),void lmsform.setErrorText(r.parentElement.parentElement,ZPI18N.getString("zp.lms.managerevaluation.minMaxShouldBeDifferent"));lmsform.removeErrorClass(r.parentElement.parentElement),lmsform.removeErrorText(r.parentElement.parentElement),lmsform.removeErrorClass(l.parentElement.parentElement),lmsform.removeErrorText(l.parentElement.parentElement);for(var o=0;o<achievementsArr.length;o++)e&&a[achievementsArr[o]].id==e.id||(achievementData.minimum>=a[achievementsArr[o]].minimum&&achievementData.minimum<=a[achievementsArr[o]].maximum&&(n=!1),achievementData.maximum>=a[achievementsArr[o]].minimum&&achievementData.maximum<=a[achievementsArr[o]].maximum&&(i=!1),a[achievementsArr[o]].minimum>=achievementData.minimum&&a[achievementsArr[o]].maximum<=achievementData.maximum&&(n=!1,i=!1));return n?(lmsform.removeErrorClass(r.parentElement.parentElement),lmsform.removeErrorText(r.parentElement.parentElement),i?(lmsform.removeErrorClass(l.parentElement.parentElement),lmsform.removeErrorText(l.parentElement.parentElement),achievementData.minimum>achievementData.maximum?(lmsform.setErrorClass(r.parentElement.parentElement),void lmsform.setErrorText(r.parentElement.parentElement,ZPI18N.getString("zp.lms.managerevaluation.minShouldBeLessThanMax"))):(lmsform.removeErrorClass(r.parentElement.parentElement),lmsform.removeErrorText(r.parentElement.parentElement),lmsform.removeErrorClass(l.parentElement.parentElement),lmsform.removeErrorText(l.parentElement.parentElement),void(e&&e.id?lmsmanagerevaluation_reqs.updateAchievement(currentInstance.courseId,e.id,achievementData,(function(t){currentInstance.achievements[e.id]=t.achievement,currentInstance.updateAchievementSuccessCallback(currentInstance,t)}),currentInstance.updateAchievementFailureCallback):lmsmanagerevaluation_reqs.createAchievement(currentInstance.courseId,achievementData,(function(e){currentInstance.achievements[e.achievement.id]=e.achievement,currentInstance.createAchievementSuccessCallback(currentInstance,e)}),currentInstance.createAchievementFailureCallback)))):(lmsform.setErrorClass(l.parentElement.parentElement),void lmsform.setErrorText(l.parentElement.parentElement,ZPI18N.getString("zp.lms.managerevaluation.scoreExists")))):(lmsform.setErrorClass(r.parentElement.parentElement),void lmsform.setErrorText(r.parentElement.parentElement,ZPI18N.getString("zp.lms.managerevaluation.scoreExists")))}))},t.prototype.numberFun=function(e){var t=e.target,s=t.value.replace(/[\\A-Za-z!"$%^&\-\)\(*+_={};:'@#~,.\/<>\" "\?|`\]\[]/g,""),r=(t.min&&Number(t.min),t.max?Number(t.max):1/0);s>r&&(s=r),e.target.value=s;var l=t.getAttribute("formid"),a=lmsform.numberItems[l];a&&a._callback&&a._callback(t)},t.prototype.createAchievementSuccessCallback=function(e,t){var s=e.constructAchievement(t.achievement);e.formContainer.querySelector('[_rel="new"]').parentNode.insertBefore(s,e.formContainer.querySelector('[_rel="new"]')),lmsbase.hideMaskLayer(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.managerevaluation.achievementAddSuccess"))},t.prototype.createAchievementFailureCallback=function(e){lmsbase.hideMaskLayer(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.achievementAddFailure"))},t.prototype.updateAchievementSuccessCallback=function(e,t){var s=e.constructAchievement(t.achievement);achievementId=t.achievement.id,e.formContainer.querySelector('[achievementid="'+achievementId+'"]').parentNode.replaceChild(s,e.formContainer.querySelector('[achievementid="'+achievementId+'"]')),lmsbase.hideMaskLayer(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.managerevaluation.achievementUpdateSuccess"))},t.prototype.updateAchievementFailureCallback=function(e){lmsbase.hideMaskLayer(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.achievementUpdateFailure"))},t.prototype.alertAndDeleteAchievement=function(e){currentInstance=this,lmsnotify.show({header:ZPI18N.getString("zp.lms.managerevaluation.deleteAchievement"),body:ZPI18N.getString("zp.lms.managerevaluation.deleteAchievementDesc"),button_text:ZPI18N.getString("zp.confirm"),texttype:"negative",successCallback:function(){lmsmanagerevaluation_reqs.deleteAchievement(currentInstance.courseId,e.id,(function(t){delete currentInstance.achievements[e.id],currentInstance.achievementDeleteSuccessCallback(e.id,t)}),currentInstance.achievementDeleteFailureCallback)}})},t.prototype.achievementDeleteSuccessCallback=function(e,t){this.container.querySelector('[achievementId="'+e+'"]').parentNode.removeChild(this.container.querySelector('[achievementId="'+e+'"]')),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.managerevaluation.achievementDeleteSuccess"))},t.prototype.achievementDeleteFailureCallback=function(e){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.achievementDeleteFailure"))},t.prototype.constructButtons=function(){var e=document.createElement("button");e.className="zpthm",e.textContent=ZPI18N.getString("zp.save"),this.saveButtonNode=e,this.buttonContainer.appendChild(this.saveButtonNode);var t=this;lmsbase.addListener(e,"click",(function(){t.validateAndSave()}))},t.prototype.getWhenToInitiateField=function(e,t,s){var r={};r.fieldType=lmsform.fieldtype.NUMBER,r.autofillvalue=t||"",r.displayName="",r.labelName="openTimeDelay",r.no_autofocus=!0;var l={formComponentId:"timeUnitComp"};l.fieldType=lmsform.fieldtype.LOOKUP,l.displayType=lmsform.fieldtype.SELECT_DISPLYTYPE,l.Options=[{Value:ZPI18N.getString("zp.wfdays"),Id:"day"},{Value:ZPI18N.getString("zp.wftbaweeks"),Id:"week"},{Value:ZPI18N.getString("zp.wftbamonths"),Id:"month"}],l.OptionsAsLMSMenuFormatArray=[[ZPI18N.getString("zp.wfdays")],[ZPI18N.getString("zp.wftbaweeks")],[ZPI18N.getString("zp.wftbamonths")]],l.OptionsWithId=[{Value:ZPI18N.getString("zp.wfdays"),Id:"day"},{Value:ZPI18N.getString("zp.wftbaweeks"),Id:"week"},{Value:ZPI18N.getString("zp.wftbamonths"),Id:"month"}],l.autofillvalue="day"==s?ZPI18N.getString("zp.wfdays"):"week"==s?ZPI18N.getString("zp.wftbaweeks"):ZPI18N.getString("zp.wftbamonths"),l.displayName="",l.labelName="openTimeDelayUnit";var a=ZPI18N.getString("zp.lms.managerevaluation.deferredAfterCompletion").split("{0}"),n='<div whenToInitiateContainer class="zp_Sm zp_nobr zp_lp">';return n+="<div>",n+="<ul>",n+="<li>"+lmsformcomponents.getSimpleRadioButtonField({fieldType:lmsform.fieldtype.RADIO_OPTION,labelName:"openTimeType",displayName:ZPI18N.getString("zp.lms.managerevaluation.immediatelyAfterCompletion"),autofillvalue:0==e,value:0})+"</li>",n+="<li>",n+=lmsformcomponents.getSimpleRadioButtonField({fieldType:lmsform.fieldtype.RADIO_OPTION,labelName:"openTimeType",autofillvalue:1==e,value:1}),n+="<span>"+a[0]+"</span>",n+='<div class="zp_Smsub Smmax"><div class="zp_Sm" openTimeDelayContainer>'+lmsform.insertField(r,"","",0,void 0)+"</div></div>",n+='<div class="zp_Smsub Smmax90">'+lmsform.insertField(l,"","",1,void 0,"","zp_Sm",!0)+"</div>",n+="<span>"+a[1]+"</span>",n+="</li>",n+="</ul>",n+="</div>",n+="</div>"},t.prototype.setupRecordDataInUI=function(e){},t.prototype.getCurrentRecordDataInUI=function(){var e=lmsform;try{(lmsform=this.form).params={};var t=lmsform.formvalidate("",0,1);return t.gradeCategoryId=this.gradeCategoryId||void 0,t.openTimeDelay=1==t.openTimeType?t.openTimeDelay:void 0,t.marks=t.marks||void 0,t.evaluationType=this.evaluationType,t.rubricsId=this.rubricsId||this.container.querySelector("[rubricsId]")&&this.container.querySelector("[rubricsId]").getAttribute("rubricsId")||void 0,lmsform.params={},t}finally{lmsform=e}},t.prototype.validateAndSave=function(){var e=this.getCurrentRecordDataInUI();if(0==this.evaluationType){var t=this.formContainer.querySelector('[name="marks"]');if(null==e.marks)return lmsform.setErrorClass(t.closest(".zp_Sm")),void lmsform.setErrorText(t.parentElement.parentElement,ZPI18N.getString("zp.assessment.result.trainer.enter.marks"));lmsform.removeErrorClass(t.closest(".zp_Sm")),lmsform.removeErrorText(t.parentElement.parentElement)}else if(1==this.evaluationType&&null==e.rubricsId)return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.managerevaluation.rubricsCanNotBeEmpty"));for(var s=this.achievements,r=1;r<=100;){var l=!1;for(var a in s)r>=Number(s[a].minimum)&&r<=Number(s[a].maximum)&&(l=!0,r=Number(s[a].maximum)+1);if(!l)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.percentageMissing",[r]))}this.saveCurrentDataInUI()},t.prototype.saveCurrentDataInUI=function(){this.save(this.getCurrentRecordDataInUI())},t.prototype.save=function(e){this.disableSaveButton();var t=this;lmsmanagerevaluation_reqs.updateCourseManagerEvalutionSettings(this.courseId,e,(function(s){t.settingsData=s.settings,t.enableSaveButton(),t.saveSuccessCallback(e,s)}),(function(e){t.enableSaveButton(),t.saveFailureCallback(e)}))},t.prototype.saveSuccessCallback=function(e,t){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.managerevaluation.settingsUpdateSuccess"))},t.prototype.saveFailureCallback=function(e){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.settingsUpdateFailure"))},t.prototype.disableSaveButton=function(e){lmsbase.addClass(this.saveButtonNode,"disabled")},t.prototype.enableSaveButton=function(e){lmsbase.removeClass(this.saveButtonNode,"disabled")},t.prototype.hasAnyUnsavedChanges=function(){return 2==this.state&&!zplms.isObjectsSame(this.lastSavedRecordData,this.getCurrentRecordDataInUI())},t.prototype.alertAndClose=function(){this.hasAnyUnsavedChanges()&&this.alert(),this.close()},t.prototype.alert=function(){var e=this;lmsnotify.show({header:ZPI18N.getString("zp.lms.confirmChanges"),body:ZPI18N.getString("zp.lms.course.coursesettingsupdate"),button_text:ZPI18N.getString("zp.lms.saveCourse"),texttype:"negative",successCallback:function(){e.saveAllValidData()}})},t.prototype.saveAllValidData=function(){},t.prototype.close=function(){this.container.innerHTML="";var e=this.close_callback;e&&e()},e.createManagerEvalutionSettingsView=function(e,r,l){return new s(new t(e,r,l))}}(lmsmanagerevaluation),lmsmanagerevaluationView_reqs={fetchDataOfReportee:function(e,t,s,r,l){var a="";a=null!=t&&"null"!=t?"/lms/courses/"+e+"/batches/"+t+"/managerevaluation/reportee/"+s:"/lms/courses/"+e+"/managerevaluation/reportee/"+s,zplms.get(a,null,r,l)},fetchDataOfSelf:function(e,t,s,r){var l="";l=null!=t&&"null"!=t?"/lms/courses/"+e+"/batches/"+t+"/managerevaluation":"/lms/courses/"+e+"/managerevaluation",zplms.get(l,null,s,r)},saveManagerEvaluation:function(e,t,s,r,l,a){var n="";n=null!=t&&"null"!=t?"/lms/courses/"+e+"/batches/"+t+"/managerevaluation/reportee/"+s:"/lms/courses/"+e+"/managerevaluation/reportee/"+s,zplms.post(n,{evaluationData:JSON.stringify(r)},l,a)}},lmsmanagerevaluationView={userType:null,evaluationType:null,viewType:null,initiate:function(e){null!=e.reporteeId&&"null"!=e.reporteeId?lmsmanagerevaluationView.userType="manager":lmsmanagerevaluationView.userType="learner",lmsmanagerevaluationView.courseId=e.courseId,lmsmanagerevaluationView.batchId=e.batchId,lmsmanagerevaluationView.reporteeId=e.reporteeId,lmsmanagerevaluationView.fetchDataAndConstruct(e)},fetchDataAndConstruct:function(e){"learner"==lmsmanagerevaluationView.userType?lmsmanagerevaluationView_reqs.fetchDataOfSelf(e.courseId,e.batchId,(function(e){var t=e.evaluation;t.canUserViewEvaluation?(lmsmanagerevaluationView.viewType="result",lmsmanagerevaluationView.evaluationType=t.evaluationType,lmsmanagerevaluationView.construct(t)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.noPermissionForUser"))}),(function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.fetchEvaluationFailure"))})):lmsmanagerevaluationView_reqs.fetchDataOfReportee(e.courseId,e.batchId,e.reporteeId,(function(e){var t=e.evaluation;t.canUserEvaluate||t.hasUserCompleted?(lmsmanagerevaluationView.viewType=t.hasUserCompleted?"result":"edit",lmsmanagerevaluationView.evaluationType=t.evaluationType,lmsmanagerevaluationView.construct(t)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.noPermissionForUser"))}),(function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.fetchEvaluationFailure"))}))},construct:function(e){root=document.getElementById("lms");var t='<div class="zp_Npv zp_Minf"><div class="zp_nwrap">'+lmsmanagerevaluationView.constructHeader(e).outerHTML+'<div class="zp_ncnt"><div class="zp_nsplt">'+lmsmanagerevaluationView.constructBody(e).outerHTML+"</div></div></div></div>";root.innerHTML=t,lmsmanagerevaluationView.root=root,lmsbase.addListener(root,"click",lmsmanagerevaluationView.clickAction),root.querySelector("[_rel=score]").min=0,root.querySelector("[_rel=score]").max=e.totalMarks,lmsbase.addListener(root.querySelector("[_rel=score]"),"input",lmsformcomponents.numberFun),lmsbase.addListener(root.querySelector("[_rel=score]"),"focusout",lmsmanagerevaluationView.focusOut)},constructHeader:function(e){var t=document.createElement("div");lmsbase.addClass(t,"zp_npvhd");var s="";return"manager"==lmsmanagerevaluationView.userType?("result"==lmsmanagerevaluationView.viewType&&(s='<font class="zp_notinf bgylw cntrinf"><span><i class="IC-information"></i>'+ZPI18N.getString("zp.lms.managerevaluation.evaluationCanNotBeModified")+"</span></font>"),s+="<h4>"+ZPI18N.getString("zp.lms.managerevaluation.ManagerEvaluation")+'</h4><div class="zp_nttl profl">'+lmsmessages.getUserDP(e.userInfo).outerHTML+'<div class="zp_nhdr"><span>'+e.userInfo.name+"</span><font>"+(e.userInfo.DepDes.desigName?"<p><em>"+e.userInfo.DepDes.desigName+"</em></p>":"")+(e.userInfo.DepDes.depaName?'<p class="zp_ldot"><em>'+e.userInfo.DepDes.depaName+"</em></p>":"")+'</font><div class="zp_tgbx"><div><i class="IC-email"></i>'+e.userInfo.email+"</div></div>",s+='</div><div class="zp_nrgt"><div><font><p>'+ZPI18N.getString("zp.lms.base.CourseDetails")+'</p><b><i class="IC-cnt3"></i>'+ZSEC.Encoder.encodeForHTML(e.courseName)+'</b><b><i class="IC-ilt1"></i>'+e.courseOwner.name+'</b><a _rel="viewGrade" id="'+e.courseUserId+'">View grade</a></font></div></div></div>'):s='<div class="zp_nttl"><div class="zp_nhdr"><span>'+ZPI18N.getString("zp.lms.managerevaluation.ManagerEvaluation")+"</span><font><p><em>"+ZSEC.Encoder.encodeForHTML(e.courseName)+'</em></p></font></div><div class="zp_nrgt"><div><font><b><i class="IC-trainer"></i>'+e.managerInfo.name+"</b></font></div></div></div>",t.innerHTML=s,t},constructBody:function(e){var t=document.createElement("div");lmsbase.addClass(t,"zp_Rubscrl");var s=lmsmanagerevaluationView.constructScoreCard(e.marksObtained,e.totalMarks,e.achievements).outerHTML;return"rubric"==lmsmanagerevaluationView.evaluationType&&(s+=lmsmanagerevaluationView.constructRubrics(e.rubrics).outerHTML),(e.comment&&e.comment.length>0||"edit"==lmsmanagerevaluationView.viewType)&&(s+=lmsmanagerevaluationView.constructComment(e.comment).outerHTML),"edit"==lmsmanagerevaluationView.viewType&&(s+=lmsmanagerevaluationView.constructSave().outerHTML),t.innerHTML=s,t},constructScoreCard:function(e,t,s){lmsmanagerevaluationView.score="result"==lmsmanagerevaluationView.viewType?e:0,lmsmanagerevaluationView.totalMarks=t;var r=document.createElement("div");lmsbase.addClass(r,"zp_scrd");var l="<div>"+lmsmanagerevaluationView.constructScore(e,t).outerHTML+lmsmanagerevaluationView.constructAchievements(e,t,s).outerHTML+"</div>";return r.innerHTML=l,r},constructScore:function(e,t){var s=document.createElement("div");lmsbase.addClass(s,"zp_scr"),s.setAttribute("scoreEl","");var r="";return r="result"==lmsmanagerevaluationView.viewType||"rubric"==lmsmanagerevaluationView.evaluationType?"<div><h4>"+("learner"==lmsmanagerevaluationView.userType?ZPI18N.getString("zp.lms.managerevaluation.yourScore"):ZPI18N.getString("zp.score"))+'</h4><h2 _rel="score">'+("result"==lmsmanagerevaluationView.viewType?e:"0")+"<b>/"+t+"</b></h2><p>"+ZPI18N.getString("zp.percentage")+': <b _rel="percentage">'+(e/t*100).toFixed(2)+"%</b></p></div>":"<font><b>"+ZPI18N.getString("zp.lms.managerevaluation.scoreForLearner")+"</b><p>"+ZPI18N.getString("zp.lms.managerevaluation.postAssessmentForLearner")+'</p><div><input type="text" _rel="score"><span>/'+t+"</span></div></font>",s.innerHTML=r,s},constructAchievements:function(e,t,s){lmsmanagerevaluationView.achievements=s;var r=document.createElement("div");lmsbase.addClass(r,"zp_achv"),r.setAttribute("achievementEl","");for(var l="<h4>"+ZPI18N.getString("zp.lms.managerevaluation.overallAchievement")+"</h4><div>",a=Number(e/t*100),n=0;n<s.length;n++){var i=!1;null!=e&&a>=s[n].minimum&&a<=s[n].maximum&&(i=!0),l+="<div"+(i?' class="sel"':"")+"><b>"+ZSEC.Encoder.encodeForHTML(lmsform.changetoI18N(s[n].name))+"</b><p>"+s[n].minimum+"% to "+s[n].maximum+"%</p></div>"}return l+="</div>",r.innerHTML=l,r},constructRubrics:function(e){var t=document.createElement("div");lmsbase.addClass(t,"zp_Rubchs onlyvw"),html="";for(var s=0;s<e.rubric.length;s++){var r=e.rubric[s];html+=lmsmanagerevaluationView.constructRubric(r).outerHTML}t.innerHTML=html;var l={};for(s=0;s<e.rubric.length;s++)l[e.rubric[s].rubricId]=e.rubric[s];return lmsmanagerevaluationView.rubricObjs=l,lmsmanagerevaluationView.rubricsId=e.rubricsId,t},constructRubric:function(e){var t=document.createElement("div");t.setAttribute("rubricEl",""),t.setAttribute("rubricId",e.rubricId);var s='<h4><font><i class="IC-argt" _rel="openCloseView"></i><span>'+ZSEC.Encoder.encodeForHTML(e.name)+"</span></font></h4>"+lmsmanagerevaluationView.constructLevels(e.levels)+lmsmanagerevaluationView.constructCells(e.pointsType,e.criterias,e.levels,e.cells).outerHTML;return t.innerHTML=s,t},constructLevels:function(e){for(var t="<ul>",s=0;s<e.length;s++)t+="<li>"+ZSEC.Encoder.encodeForHTML(e[s].name)+"</li>";return t+="</ul>"},constructCells:function(e,t,s,r){for(var l=document.createElement("div"),a="",n="0",i=0;i<t.length;i++){for(var o=t[i].criteriaId,c="<div>",d=0;d<s.length;d++){var m=r[o][s[d].levelId];m.isSelected&&(n="fixed"==e?s[d].marks:m.marks),c+="<label"+(m.isSelected?' class="sel"':"")+' _rel="cell" levelId="'+s[d].levelId+'" cellId="'+m.cellId+'"><font>'+("fixed"==e?s[d].marks:m.marks)+" pts</font><p>"+(m.description?ZSEC.Encoder.encodeForHTML(m.description):"")+"</p></label>"}c+="</div>",a+='<div class="zp_Rub" criteriaId="'+t[i].criteriaId+'"><h4>'+ZSEC.Encoder.encodeForHTML(t[i].name)+'<font _rel="criteriaMark">'+("result"==lmsmanagerevaluationView.viewType?n:"0")+"/"+t[i].marks+"</font></h4>"+c+"</div>"}return l.innerHTML=a,l},constructComment:function(e){var t=document.createElement("div");lmsbase.addClass(t,"zp_scmt"),t.setAttribute("commentEl","");var s='<p class="zp_Pttl">'+ZPI18N.getString("zp.local.Comments")+"</p>";return"edit"==lmsmanagerevaluationView.viewType?s+='<textarea _rel="comment" cols="30" rows="10"></textarea>':s+="<span>"+ZSEC.Encoder.encodeForHTML(e)+"</span>",t.innerHTML=s,t},constructSave:function(){var e=document.createElement("div");return lmsbase.addClass(e,"zp_btn disabled"),e.setAttribute("_rel","save"),e.setAttribute("saveEl",""),e.innerHTML='<button class="zpthm">'+ZPI18N.getString("zp.save")+"</button>",e},clickAction:function(e){var t=e.target,s=t.getAttribute("_rel")||(t.closest("[_rel]")?t.closest("[_rel]").getAttribute("_rel"):null);if("save"==s)lmsmanagerevaluationView.saveAttemptOnConfirmation();else if("openCloseView"==s){var r=t.closest("[rubricEl]");lmsbase.hasClass(r,"Rubmax")?lmsbase.removeClass(r,"Rubmax"):lmsbase.addClass(r,"Rubmax")}else"cell"==s&&"result"!=lmsmanagerevaluationView.viewType?lmsmanagerevaluationView.selectCell(t):"viewGrade"==s&&lmsmanagerevaluationView.openGradePageForThatLearner(lmsmanagerevaluationView.courseId,lmsmanagerevaluationView.batchId,lmsmanagerevaluationView.reporteeId)},selectCell:function(e){for(var t=e.closest("[rubricId]").getAttribute("rubricId"),s=lmsmanagerevaluationView.rubricObjs[t].pointsType,r=e.closest("[criteriaId]").getAttribute("criteriaId"),l=e.getAttribute("levelId")||e.closest("[levelId]").getAttribute("levelId"),a=lmsmanagerevaluationView.rubricObjs[t].cells[r][l],n=(e="cell"==e.getAttribute("_rel")?e:e.closest("[_rel=cell]"),lmsmanagerevaluationView.rubricObjs[t].criterias),i=lmsmanagerevaluationView.rubricObjs[t].levels,o=null,c=0;c<n.length;c++)n[c].criteriaId==r&&(o=n[c]);var d=null;for(c=0;c<i.length;c++)i[c].levelId==l&&(d=i[c]);var m=0,u=e.closest("[criteriaId]").querySelector(".sel");if(u){lmsbase.removeClass(u,"sel");var p=u.getAttribute("levelId")||u.closest("[levelId]").getAttribute("levelId"),g=null;for(c=0;c<i.length;c++)i[c].levelId==p&&(g=i[c]);m="fixed"==s?g.marks:lmsmanagerevaluationView.rubricObjs[t].cells[r][p].marks}lmsbase.addClass(e,"sel"),e.closest("[criteriaId]").querySelector("[_rel=criteriaMark]").innerHTML=("fixed"==s?d.marks:a.marks)+"/"+o.marks,lmsmanagerevaluationView.score=lmsmanagerevaluationView.score-m+("fixed"==s?d.marks:a.marks),lmsmanagerevaluationView.root.querySelector("[_rel=score]").innerHTML=lmsmanagerevaluationView.score+"<b>/"+lmsmanagerevaluationView.totalMarks+"</b>",divEl=lmsmanagerevaluationView.constructAchievements(lmsmanagerevaluationView.score,lmsmanagerevaluationView.totalMarks,lmsmanagerevaluationView.achievements),lmsmanagerevaluationView.root.querySelector("[achievementEl]").parentElement.replaceChild(divEl,lmsmanagerevaluationView.root.querySelector("[achievementEl]"));for(var f=Object.keys(lmsmanagerevaluationView.rubricObjs),v=0,h=0,b=0;b<f.length;b++)h+=lmsmanagerevaluationView.rubricObjs[f[b]].criterias.length,v+=lmsmanagerevaluationView.root.querySelector("[rubricId='"+f[b]+"']").querySelectorAll(".sel").length;v==h&&lmsbase.removeClass(lmsmanagerevaluationView.root.querySelector("[_rel=save]"),"disabled")},saveAttemptOnConfirmation:function(){lmsnotify.show({header:ZPI18N.getString("zp.lms.managerevaluation.evaluationNotPossibleToBeModified"),body:ZPI18N.getString("zp.lms.managerevaluation.evaluationNotPossibleToBeModifiedDesc"),button_text:ZPI18N.getString("zp.confirm"),texttype:"positive",successCallback:function(){this.status&&lmsmanagerevaluationView.saveAttempt()}})},saveAttempt:function(){var e={},t=lmsmanagerevaluationView.root.querySelector("[_rel=score]");e.score="points"==lmsmanagerevaluationView.evaluationType?t.value:0,e.comment=lmsmanagerevaluationView.root.querySelector("[_rel=comment]").value;var s=lmsmanagerevaluationView.totalMarks;if("rubric"==lmsmanagerevaluationView.evaluationType){for(var r=[],l=lmsmanagerevaluationView.root.querySelectorAll("[rubricId]"),a=0;a<l.length;a++){for(var n=l[a].querySelectorAll(".sel"),i=[],o=0;o<n.length;o++)i.push(n[o].getAttribute("cellId"));r.push(i)}var c={};c.rubricsId=lmsmanagerevaluationView.rubricsId,c.cells=r,e.rubricsAttempt=c,e.score=lmsmanagerevaluationView.score,lmsmanagerevaluationView.root.querySelector('[_rel = "percentage"]').innerHTML=(e.score/s*100).toFixed(2)+"%"}lmsbase.addClass(lmsmanagerevaluationView.root.querySelector("[saveEl]"),"disabled"),lmsmanagerevaluationView_reqs.saveManagerEvaluation(lmsmanagerevaluationView.courseId,lmsmanagerevaluationView.batchId,lmsmanagerevaluationView.reporteeId,e,(function(e){var t=e.evaluation;if(lmsmanagerevaluationView.viewType="result","points"==lmsmanagerevaluationView.evaluationType){var s=lmsmanagerevaluationView.constructScore(t.marksObtained,t.settings.marks);lmsmanagerevaluationView.root.querySelector("[scoreEl]").parentElement.replaceChild(s,lmsmanagerevaluationView.root.querySelector("[scoreEl]"))}if(t.comment&&t.comment.length>0){s=lmsmanagerevaluationView.constructComment(t.comment);lmsmanagerevaluationView.root.querySelector("[commentEl]").parentElement.replaceChild(s,lmsmanagerevaluationView.root.querySelector("[commentEl]"))}else lmsmanagerevaluationView.root.querySelector("[commentEl]").parentElement.removeChild(lmsmanagerevaluationView.root.querySelector("[commentEl]"));lmsmanagerevaluationView.root.querySelector("[saveEl]").parentElement.removeChild(lmsmanagerevaluationView.root.querySelector("[saveEl]"))}),(function(){lmsbase.removeClass(lmsmanagerevaluationView.root.querySelector("[saveEl]"),"disabled"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.managerevaluation.unableToSaveEvaluation"))}))},focusOut:function(e){var t=e.target;if("score"==(t.getAttribute("_rel")||(t.closest("[_rel]")?t.closest("[_rel]").getAttribute("_rel"):null))){""!=t.value?lmsbase.removeClass(lmsmanagerevaluationView.root.querySelector("[_rel=save]"),"disabled"):lmsbase.addClass(lmsmanagerevaluationView.root.querySelector("[_rel=save]"),"disabled");var s=lmsmanagerevaluationView.constructAchievements(Number(t.value),lmsmanagerevaluationView.totalMarks,lmsmanagerevaluationView.achievements);lmsmanagerevaluationView.root.querySelector("[achievementEl]").parentElement.replaceChild(s,lmsmanagerevaluationView.root.querySelector("[achievementEl]"))}},viewEvaluationForLearner:function(e,t){for(var s=window.location.href.split("#")[0].split("/"),r="",l=0;l<s.length&&!s[l].includes("training");l++)r+=s[l]+"/";isEmpty(lmscourses.currentBatchId)?r+="lmsmanagerevaluation/courses/"+e:r+="lmsmanagerevaluation/courses/"+e+"/batches/"+t,window.open(r)},viewEvaluationForManager:function(e,t,s){for(var r=window.location.href.split("#")[0].split("/"),l="",a=0;a<r.length&&!r[a].includes("zp");a++)l+=r[a]+"/";l+=null==t||null==t?"lmsmanagerevaluation/courses/"+e+"/reportee/"+s:"lmsmanagerevaluation/courses/"+e+"/batches/"+t+"/reportee/"+s,window.open(l)},openGradePageForThatLearner:function(e,t,s){var r=document.querySelector('a[_rel="viewGrade"]'),l=null!=r?r.id:0,a=window.location.href,n=a.indexOf("/lmsmanagerevaluation");-1!==n&&(a=a.substring(0,n),a+=null!=t&&null!=t?"/training#lms-managerview/course/"+e+"/batch/"+t+"/members?memberinfo/"+l:"/training#lms-managerview/course/"+e+"/members?memberinfo/"+l,window.open(a))}};var lmssettings={commonSettingData:null,manualSettingData:null,iltSettingData:null,selfSettingData:null,commonTypeSettingData:null,isTrainerCreate:!1,isloaded:!1,getCategories:"",_relem:"",initiate:function(){lmssettings._relem=this.elem,lmssettings._relem.innerHTML="",lmssettings.getCategories="",lmssettings.getSettingsData(null,null,1);var e='<div class="zp_cwrap"><div class="zp_Lstwrap zp_Tsettings"><div class="zp_orgSet"><div class="zp_AClft" id="readorwritepage">'+lmssettings.getGeneralSetting()+'</div><div class="zp_ACrgt"><div class="zp_Attl" id="settingTab"><ul class="zp_CPmnu"><li class="sel"><a rel="general">'+ZPI18N.getString("zp.general")+'</a></li><li id="managecreation"><a rel="managecreation">'+ZPI18N.getString("zp.lms.settings.managecreation")+'</a></li><li id="gradeSettings"><a rel="lmsgradeSettings">Grading</a></li>'+(lms.notificationData.hasAnyNotification()?'<li style="display:none"><a rel="notifications">'+ZPI18N.getString("zp.lms.settings.Notifications")+"</a></li>":"")+'<li><a rel="featurepolicies">'+ZPI18N.getString("zp.lms.settings.FeaturePolicies")+'</a></li><li><a rel="categories">'+ZPI18N.getString("zp.categories")+"</a></li></ul></div></div></div></div></div>";lms._page.container.querySelector('[class="zp_content"]').innerHTML=e;var t=document.getElementById("settingTab");lmssettings.updateRoundButtons(),lmsbase.addListener(t,"click",lmssettings.getSettingTab,!1),lmssettings.bind("general"),lmssettings.fetchCategorys(),lms.iltSettingData.isIltenable||$("#ilttab").addClass("disbld"),lms.selfSettingData.isSelfenable||$("#selftab").addClass("disbld"),lms.manualSettingData.isManualenable||$("#manualtab").addClass("disbld")},getSettingsData:function(e,t,s){if(null==lmssettings.commonSettingData||t){var r={};1===s&&(r.isSettings="true"),zplms.get("/lms/settings",r,(function(t){$.each(t[1],(function(e,t){lmssettings.isloaded=!0,lmssettings.isTrainerCreate=t.isTrainerCreate,lmssettings.typebasedData=t,lms.typebasedData=t,null!=t.allType?(lmssettings.commonSettingData=t.commonSetting,lms.commonSettingData=t.commonSetting):(lms.selfSettingData=t.selfData,lms.iltSettingData=t.iltData,lms.manualSettingData=t.manualData,lms.lpSettingData=t.lpData,lmsgradetype.valueObj=t.gradeSetting,lmssettings.manualSettingData=t.manualData,lmssettings.iltSettingData=t.iltData,lmssettings.selfSettingData=t.selfData,lmssettings.lpSettingData=t.lpData),lmssettings.commonSettingData=t.commonSetting,lms.commonSettingData=t.commonSetting,lmssettings.getCategories=t.categoryData,lmssettings.savedConfigData=t.savedConfigData})),null!=e&&e()}))}},getSettingTab:function(e){try{var t=e.target.closest("li").childNodes[0].rel}catch(e){}if("notifications"==t||"featurepolicies"===t||"categories"===t||"general"==t||"lmsgradeSettings"==t||"managecreation"==t){e.target.closest("ul").querySelector('[class="sel"]').className="",e.target.closest("li").className="sel",$(".zp_AClft").html("");var s="general"===t?lmssettings.getGeneralSetting():"lmsgradeSettings"===t?lmsgradetype.initiate():"notifications"===t?lmssettings.getNotificationSetting():"featurepolicies"===t?lmssettings.getFeaturePolicySetting():"categories"===t?lmssettings.addCategories():"managecreation"===t?lmssettings.manageCreation:"";$(".zp_AClft").animate({scrollTop:"0px"},500),$(".zp_AClft").append(s),$("#allowedit").length&&(document.getElementById("allowedit").checked=!!lmssettings.manualSettingData.isAllowManualEdit),lmssettings.updateRoundButtons(t),lmssettings.bind(t),"managecreation"===t&&(lmssettings.menuConstruction("configopt"),lmssettings.configSettings(0))}},bind:function(e){"featurepolicies"===e&&(lmssettings.feedbackAppliedto(this,window.event,"feedbackappliedto","feedbackto"),lmssettings.reportsViewedBy(this,window.event,"reportsViewedBy","viewReports"),lmssettings.selectExportEmpComps(this,window.event,"selectExportEmpComps","exportEmpComp")),$('[name="checkBox"]').click((function(){lmssettings.checkBoxselect(this)}))},addCategories:function(e,t){1==t&&$(".zp_AClft").html(""),e=lmssettings.getCategories;var s='<div class="zp_setCont"><h5>'+ZPI18N.getString("zp.lms.course.categories")+'</h5><div class="zp_Scat"> <a id = "createCategory" onclick = lmssettings.createCategory()><i class="IC-plus"  ></i> '+ZPI18N.getString("zp.lms.settings.createcategory")+"</a>";if($.each(e,(function(e,t){s+="<div><label>"+lmsform.changetoI18N(t.categoryName)+'</label><div id="" class="zp_Sm"><div><input required="" onkeyUp = "lmssettings.editCategoryWithId(window.event,\''+t.categoryId+'\')"_rel="'+t.categoryId+'" placeholder=""  value = "'+lmsform.changetoI18N(t.categoryName)+'" type="text" ></div></div>',s+='<font><i class="IC-rename" id="catId_'+t.categoryId+'"></i>',"General"!==t.categoryName&&(s+='<i class="IC-trash" onclick = "lmssettings.deleteCategoryOnConfirmation(\''+t.categoryId+"')\"></i>"),s+="</font></div>",$(document).on("click","#catId_"+t.categoryId,(function(){lmssettings.editCategory(this,t.categoryId,lmsform.changetoI18N(t.categoryName))}))})),s+="</div></div>",1!=t)return s;$(".zp_AClft").append(s)},deleteCategoryOnConfirmation:function(e){lmsnotify.show({header:ZPI18N.getString("zp.lms.settings.deleteCategory"),body:ZPI18N.getString("zp.lms.settings.categorydeletepermenently"),button_text:ZPI18N.getString("zp.lms.delete"),texttype:"negative",successCallback:function(){this.status&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.categorydeletemsg")),lmssettings.deleteCategory(e))},cancelCallback:function(){}})},deleteCategory:function(e){zplms.delete("lms/settings/categories/"+e,null,(function(e){"success"==e[1][0]?lmssettings.fetchCategorys(1):ZPeople.Message.showFailureMsg(e[1][0])}))},editCategoryWithId:function(e,t){if(13==e.keyCode){var s=e.target.value;if(s.indexOf("<")>-1||s.indexOf(">")>-1)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));if(s.trim()){var r={data:s};zplms.patch("/lms/settings/categories/"+t,r,(function(e){"success"==e[1][0]?(lmssettings.fetchCategorys(1),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.categoryeditmsg"))):ZPeople.Message.showFailureMsg(e[1][0])}))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.validvalue"))}},editCategory:function(e,t,s){var r=e.parentNode.parentNode;r.className="zp_actin",r.setAttribute("_rel","editCategory")},createCategory:function(){$("#creatingNewCategory").remove();$('<div id="creatingNewCategory" onkeyup="lmssettings.createCategorys(event)" class = "zp_Sm"><div><input required = "" id = "creatingnewCat" placeholder = "" type = "text"></div></div>').insertAfter("#createCategory"),$("#creatingnewCat").focus()},createCategorys:function(e){if(13==e.keyCode){var t=e.target.value;if(t.indexOf("<")>-1||t.indexOf(">")>-1)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));else if(t.trim()){var s={data:t};zplms.post("/lms/settings/categories",s,(function(e){"success"==e[1][0]?(lmssettings.fetchCategorys(1),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.categoryaddedmsg"))):ZPeople.Message.showFailureMsg(e[1][0])}))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.validvalue"))}},fetchCategorys:function(e){zplms.get("/lms/settings/categories",null,(function(t){null!=t[1]&&(lmssettings.getCategories=t[1]),1==e&&lmssettings.addCategories(lmssettings.getCategories,1)}))},getGeneralSetting:function(){var e=[];return e.push(ZPI18N.getString("zp.lms.settings.instructorled")),e.push(ZPI18N.getString("zp.lms.settings.SelfPaced")),e.push(ZPI18N.getString("zp.lms.settings.DigitalDownloads")),'<div class="zp_setCont"><h5>'+ZPI18N.getString("zp.lms.settings")+'</h5><div class="zp_STbx"><header><h2>'+ZPI18N.getString("zp.general")+'</h2></header><div><div class="zp_Ldtl"><p>'+ZPI18N.getString("zp.lms.settings.AllowedCourseType")+"</p><span>"+ZPI18N.getString("zp.lms.settings.AllowedCourseTypemode")+'</span><div class="zp_Sm zp_lp zp_nbr p30"><div><ul id="trainingType"><li name="checkBox"><i class="IC-cbox" id="isilt"></i><h4>'+ZPI18N.getString("zp.lms.settings.InstructorLed")+"</h4><em>"+ZPI18N.getString("zp.lms.settings.iltdesc")+'</em></li><li name="checkBox"><i class="IC-cbox" id="isselfp"></i><h4>'+ZPI18N.getString("zp.lms.settings.SelfPaced")+"</h4><em>"+ZPI18N.getString("zp.lms.settings.selfpaceddesc")+'</em></li><li name="checkBox"><i class="IC-cbox" id="ismanual"></i><h4>'+ZPI18N.getString("zp.lms.settings.DigitalDownloads")+"</h4><em>"+ZPI18N.getString("zp.lms.settings.ematerialdesc")+'</em></li><li name="checkBox"><i class="IC-cbox" id="islp"></i><h4>'+ZPI18N.getString("zp.lms.learningplan")+"</h4><em>"+ZPI18N.getString("zp.lms.learningplan.enabledisabledesc")+'</em></li></ul></div></div></div><div class="zp_Ldtl"><p>'+ZPI18N.getString("zp.lms.settings.courseproperties")+"</p><span>"+ZPI18N.getString("zp.lms.settings.enablerequiredopt")+'</span><div class="zp_Sm zp_lp zp_nbr p30"><div><ul><li name="checkBox"><i class="IC-cbox" type="checkbox" id="publicUrl" _rel = "publicUrl"></i><h4>'+ZPI18N.getString("zp.lms.settings.AllowShareableUrl")+"</h4><em>"+ZPI18N.getString("zp.lms.settings.courseurldesc")+"</em></li>"+(lms.notificationData.hasAnyNotification()?'<li name="checkBox"><i class="IC-cbox" type="checkbox" _rel="allownotify" id="allownotify"></i><h4>'+ZPI18N.getString("zp.lms.settings.AllowNotifications")+"</h4><em>"+ZPI18N.getString("zp.lms.settings.notificationemailsdesc")+"</em></li>":"")+'</ul></div></div></div><div id="" class=" zp_Sm"></div><div class="zp_btn"><button class="zpthm" onclick="lmssettings.updateGeneralSetting()" >'+ZPI18N.getString("zp.save")+"</button></div></div></div></div></div>"},manageCreation:function(){return'<div class="zp_setCont" id="manageCreationSettings"><h5>'+ZPI18N.getString("zp.lms.settings.managecreation")+'</h5><div class="zp_STbx" id="configopts"><header><h3>'+ZPI18N.getString("zp.lms.settings.mctitle")+'</h3></header><div class="zp_Sm zp_c5" rel="configopt" id="configopt"></div><div class="zp_btn" id="configButtons"><button class="zpthm" onclick="lmssettings.configSave()">'+ZPI18N.getString("zp.save")+'</button><button class="zpactn" onclick="lmssettings.configSettingsReset(0)">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>"},menuConstruction:function(e){var t={},s=document.querySelector('[rel="'+e+'"]');if("configopt"===e){var r=[];r.push(ZPI18N.getString("zp.assessment.question.type.multiple")),t[0]=r;var l={};l[0]=t[0],lmssettings.createMenu(t,s,"configopts",l)}},configSettingsReset:function(e,t){if(0==e||1==e){for(var s=document.getElementsByClassName("zp_Ptitl"),r=0;r<s.length;r++)$(".zp_Ptitl").remove(),$(".zp_Prmsn").remove();0===e&&(document.getElementById("configopt").innerHTML="",lmssettings.menuConstruction("configopt"),lmssettings.configSettings(0))}else if(2==e){if(document.querySelector('[rel="configopt"]').querySelector('[class="zp_Tglst ntxt"]').innerText==ZPI18N.getString("zp.assessment.question.type.single")&&null!=lmssettings.savedConfigData[0])lmssettings.savedConfigData[0].isTrainerEnabled=!1;else if(document.querySelector('[rel="configopt"]').querySelector('[class="zp_Tglst ntxt"]').innerText==ZPI18N.getString("zp.assessment.question.type.multiple")&&null==lmssettings.savedConfigData[0]){var l=lmssettings.optType?"zp.lms.learningplan":lmssettings.optType?"zp.lms.settings.courseType.self":lmssettings.optType?"zp.lms.settings.courseType.ILT":"zp.lms.settings.courseType.manuals";lmssettings.savedConfigData[lms.settingData[0].courseTypeSettingIds[l]].isTrainerEnabled=!1}$(t.closest('[rel="newUser"]')).remove()}},configSave:function(){for(var e,t,s=document.querySelector('[rel="configopt"]').querySelector('[class="zp_Tglst ntxt"]').innerText==ZPI18N.getString("zp.assessment.question.type.single")?0:1,r=0==s?1:4,l={},a={},n={},i="",o={},c={},d={},m={},u={},p={},g=0;g<r;g++){if(e=4==r?"0"==g?lms.settingData[0].courseTypeSettingIds["zp.lms.learningplan"]:"1"==g?lms.settingData[0].courseTypeSettingIds["zp.lms.settings.courseType.self"]:"2"==g?lms.settingData[0].courseTypeSettingIds["zp.lms.settings.courseType.ILT"]:lms.settingData[0].courseTypeSettingIds["zp.lms.settings.courseType.manuals"]:0,i=document.querySelector('[rel="createOpt_'+g+'"]')&&"everyone"==document.querySelector('[rel="createOpt_'+g+'"]').querySelector('[class="IC-rdo zp_gclr"]').closest("li").getAttribute("rel")?0:1,a={},n={},0==s||1==s&&(0==g||1==g&&lms.selfSettingData.isSelfenable||2==g&&lms.iltSettingData.isIltenable||3==g&&lms.manualSettingData.isManualenable))if(o={},c={},d={},m={},u={},p={},1==i){if(1==i&&document.querySelector('[rel="createOpt_'+g+'"]')&&document.querySelector('[rel="createOpt_'+g+'"]').nextSibling&&document.querySelector('[rel="createOpt_'+g+'"]').nextSibling.querySelector('[rel="newUsers"]')){t=document.querySelector('[rel="createOpt_'+g+'"]').nextSibling.querySelector('[rel="newUsers"]').querySelectorAll('[rel="newUser"]');for(var f=0;f<t.length;f++)(3!=g&&0!=f||3==g)&&(v=JSON.parse(t[f].getAttribute("id").split("_")[1]),fCont=t[f].querySelector('[rel="fieldCon"]').innerText,fId=t[f].querySelector('[rel="userVal_'+v+'"]').querySelector('[class="zp_Tglst ntxt"]')?t[f].querySelector('[rel="userVal_'+v+'"]').querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel"):t[f].querySelector('[rel="userVal_'+v+'"]').getAttribute("_rel"),fVal=t[f].querySelector('[rel="userVal_'+v+'"]').innerText,null!=fId&&""!=fVal&&fVal!=ZPI18N.getString("zp.select")&&(fCont==ZPI18N.getString("zp.designation")?c[fId]=fVal:fCont==ZPI18N.getString("zp.department")?d[fId]=fVal:fCont==ZPI18N.getString("zp.group")?m[fId]=fVal:fCont==ZPI18N.getString("zp.role")?u[fId]=fVal:fCont==ZPI18N.getString("zp.user")&&(p[fId]=fVal)));o.desi=c,o.dept=d,o.group=m,o.role=u,o.user=p,a.users=o}}else 0==i&&(o.desi=c,o.dept=d,o.group=m,o.role=u,o.user=p,a.users=o);if(a.opt=i,n.create=a,a={},i=document.querySelector('[rel="shareOpt_'+g+'"]')?"allow"==document.querySelector('[rel="shareOpt_'+g+'"]').querySelector('[class="IC-rdo zp_gclr"]').closest("li").getAttribute("rel")?0:1:0,a.opt=i,n.share=a,a={},o={},c={},d={},m={},u={},p={},0==(i=document.querySelector('[rel="moderateOpt_'+g+'"]')&&"required"==document.querySelector('[rel="moderateOpt_'+g+'"]').querySelector('[class="IC-rdo zp_gclr"]').closest("li").getAttribute("rel")?0:1)){if(document.querySelector('[rel="moderateOpt_'+g+'"]')&&document.querySelector('[rel="moderateOpt_'+g+'"]').nextSibling&&document.querySelector('[rel="moderateOpt_'+g+'"]').nextSibling.querySelector('[rel="newUsers"]')){var v;t=document.querySelector('[rel="moderateOpt_'+g+'"]').nextSibling.querySelector('[rel="newUsers"]').querySelectorAll('[rel="newUser"]');for(f=0;f<t.length;f++)0!=f&&(v=JSON.parse(t[f].getAttribute("id").split("_")[1]),fCont=t[f].querySelector('[rel="fieldCon"]').innerText,fId=t[f].querySelector('[rel="userVal_'+v+'"]').querySelector('[class="zp_Tglst ntxt"]')?t[f].querySelector('[rel="userVal_'+v+'"]').querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel"):t[f].querySelector('[rel="userVal_'+v+'"]').getAttribute("_rel"),fVal=t[f].querySelector('[rel="userVal_'+v+'"]').innerText,null!=fId&&""!=fVal&&fVal!=ZPI18N.getString("zp.select")&&(fCont==ZPI18N.getString("zp.designation")?c[fId]=fVal:fCont==ZPI18N.getString("zp.department")?d[fId]=fVal:fCont==ZPI18N.getString("zp.group")?m[fId]=fVal:fCont==ZPI18N.getString("zp.role")?u[fId]=fVal:fCont==ZPI18N.getString("zp.user")&&(p[fId]=fVal)));o.desi=c,o.dept=d,o.group=m,o.role=u,o.user=p,a.users=o}}else 1==i&&(o.desi=c,o.dept=d,o.group=m,o.role=u,o.user=p,a.users=o);a.opt=i,n.moderate=a,l[e]=n}var h={configtype:s,settingIdsObj:JSON.stringify(l)};zplms.put("/lms/settings/permission",h,(function(e){"Success"==e[1].message?(lmssettings.savedConfigData=e[1].savedConfigData,lms.settingData[0].savedConfigData[0]=e[1].savedConfigData,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),document.getElementById("configopt").innerHTML="",lmssettings.menuConstruction("configopt"),lmssettings.configSettings(0)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))},configSettings:function(e){var t,s,r,l="",a="",n="",o="";for(lmssettings.configSettingsReset(1),4,i=0;i<4;i++)n=0==i?ZPI18N.getString("zp.lms.learningplan"):1==i?ZPI18N.getString("zp.lms.settings.SelfPaced"):2==i?ZPI18N.getString("zp.lms.settings.InstructorLed"):ZPI18N.getString("zp.lms.settings.DigitalDownloads"),o=1==i&&!lms.selfSettingData.isSelfenable||2==i&&!lms.iltSettingData.isIltenable?ZPI18N.getString("zp.lms.settings.mcmultitypetitle"):3!=i||lms.manualSettingData.isManualenable?0==i?ZPI18N.getString("zp.lms.settings.mcmultilptitle"):3==i?ZPI18N.getString("zp.lms.settings.mcmultidigitaltitle"):ZPI18N.getString("zp.lms.settings.mcmultititle"):ZPI18N.getString("zp.lms.settings.mcmultidigitaltypetitle"),t=0==i?lms.settingData[0].courseTypeSettingIds["zp.lms.learningplan"]:1==i?lms.settingData[0].courseTypeSettingIds["zp.lms.settings.courseType.self"]:2==i?lms.settingData[0].courseTypeSettingIds["zp.lms.settings.courseType.ILT"]:lms.settingData[0].courseTypeSettingIds["zp.lms.settings.courseType.manuals"],a=lmssettings.savedConfigData&&lmssettings.savedConfigData[t]&&lmssettings.savedConfigData[t].manageCreateOptions,s=lmssettings.savedConfigData[t],l+='<div class="zp_Ptitl"><font><h4>'+n+"</h4><p>"+o+'</p></font></div><div class="zp_Prmsn" rel="configFor" id="configFor_'+i+'">',(0==i||1==i&&lms.selfSettingData.isSelfenable||2==i&&lms.iltSettingData.isIltenable||3==i&&lms.manualSettingData.isManualenable)&&(l+='<div class="zp_STfld" rel="createOpt_'+i+'"><div><h4>'+ZPI18N.getString("zp.lms.create")+'</h4></div><div class="zp_Sm"><div class="zp_nobr"><ul rel="create_'+i+'"><li name="checkBox" rel="everyone">',l+='<i class="'+(a&&0==a.create||!s&&n==ZPI18N.getString("zp.lms.settings.DigitalDownloads")?"IC-rdo zp_gclr":"IC-rdo")+'"></i><span>'+ZPI18N.getString("zp.allusers")+'</span></li><li name="checkBox" rel="limitedusers">',l+='<i class="'+(a&&1==a.create||!s&&n!=ZPI18N.getString("zp.lms.settings.DigitalDownloads")?"IC-rdo zp_gclr":"IC-rdo")+'"></i><span>'+ZPI18N.getString("zp.lms.settings.limitedusers")+"</span></li></ul></div></div></div>",(a&&1==a.create||!s&&n!=ZPI18N.getString("zp.lms.settings.DigitalDownloads"))&&(0==i||3==i?(r=0==i?"isLP":"eMaterial",l+=lmssettings.constructApplicableUsers(s,"createOpt_"+i,0,r,4)):l+=lmssettings.constructApplicableUsers(s,"createOpt_"+i,0,null,4))),n!=ZPI18N.getString("zp.lms.learningplan")&&(l+='<div class="zp_STfld" rel="shareOpt_'+i+'"><div><h4>'+ZPI18N.getString("zp.lms.share")+'</h4></div><div class="zp_Sm zp_nobr"><div><ul rel="share_'+i+'"><li name="checkBox" rel="allow">',l+='<i class="'+(a&&0==a.share||!s?"IC-rdo zp_gclr":"IC-rdo")+'"></i><span>'+ZPI18N.getString("zp.ttallow")+'</span></li><li name="checkBox" rel="dontallow">',l+='<i class="'+(a&&1==a.share?"IC-rdo zp_gclr":"IC-rdo")+'"></i><span>'+ZPI18N.getString("zp.lms.settings.dontallow")+"</span></li></ul></div></div></div>"),n!=ZPI18N.getString("zp.lms.settings.DigitalDownloads")&&(l+='<div class="zp_STfld" rel="moderateOpt_'+i+'"><div><h4>'+ZPI18N.getString("zp.lms.settings.moderation")+'</h4></div><div class="zp_Sm zp_nobr"><div><ul rel="moderate_'+i+'"><li name="checkBox" rel="required">',l+='<i class="'+(a&&0==a.moderate?"IC-rdo zp_gclr":"IC-rdo")+'"></i><span>'+ZPI18N.getString("zp.lms.settings.required")+'</span></li><li name="checkBox" rel="notrequired">',l+='<i class="'+(a&&1==a.moderate||!s?"IC-rdo zp_gclr":"IC-rdo")+'"></i><span>'+ZPI18N.getString("zp.lms.settings.notrequired")+"</span></li></ul></div></div></div>"),a&&0==a.moderate&&(0==i||3==i?(r=0==i?"isLP":"eMaterial",l+=lmssettings.constructApplicableUsers(s,"moderateOpt_"+i,1,r,4)):l+=lmssettings.constructApplicableUsers(s,"moderateOpt_"+i,1,null,4)),l+="</div>";$(l).insertBefore($("#configButtons")),$('[name="checkBox"]').click((function(){if("everyone"!=this.getAttribute("rel")&&"notrequired"!=this.getAttribute("rel")||$(this.closest('[class="zp_STfld"]')).next()[0].getAttribute("class").startsWith("zp_Prusr")&&$(this.closest('[class="zp_STfld"]')).next().remove(),this.parentElement.querySelector('[class="IC-rdo zp_gclr"]').classList.remove("zp_gclr"),lmssettings.checkBoxselect(this),"limitedusers"==this.getAttribute("rel")&&0==$(this.closest('[class="zp_STfld"]')).next()[0].getAttribute("class").startsWith("zp_Prusr")||"required"==this.getAttribute("rel")&&0==$(this.closest('[class="zp_STfld"]')).next().length){var e="limitedusers"==this.getAttribute("rel")?0:1;if(lmssettings.savedConfigData){var t,s="",r={},l=this.closest("ul").getAttribute("rel").split("_")[1],a=null;if(document.querySelector('[rel="configopt"]').querySelector('[class="zp_Tglst ntxt"]').innerText==ZPI18N.getString("zp.assessment.question.type.single"))r=lmssettings.savedConfigData[0],t=1;else{var n=0==l?"zp.lms.learningplan":1==l?"zp.lms.settings.courseType.self":2==l?"zp.lms.settings.courseType.ILT":"zp.lms.settings.courseType.manuals";a=0==l?"isLP":3==l?"eMaterial":null,l=lms.settingData[0].courseTypeSettingIds[n],r=lmssettings.savedConfigData[l],t=4}if(0==e&&(lmssettings.savedConfigData[l]&&1==lmssettings.savedConfigData[l].manageCreateOptions.create||lmssettings.savedConfigData[n]&&1==lmssettings.savedConfigData[n].manageCreateOptions.create))s=lmssettings.constructApplicableUsers(r,"createOpt_"+this.closest("ul").getAttribute("rel").split("_")[1],0,a,t),$(s).insertAfter('[rel="createOpt_'+this.closest("ul").getAttribute("rel").split("_")[1]+'"]');else if(1==e&&(lmssettings.savedConfigData[l]&&0==lmssettings.savedConfigData[l].manageCreateOptions.moderate||lmssettings.savedConfigData[n]&&0==lmssettings.savedConfigData[n].manageCreateOptions.moderate))s=lmssettings.constructApplicableUsers(r,"moderateOpt_"+this.closest("ul").getAttribute("rel").split("_")[1],1,a,t),$(s).insertAfter('[rel="moderateOpt_'+this.closest("ul").getAttribute("rel").split("_")[1]+'"]');else{var i=0==e?"createOpt_1":"moderateOpt_1";s=lmssettings.constructApplicableUsers(r,i,e,a,t),$(this.closest('[class="zp_STfld"]')).after(s)}}else s=lmssettings.constructApplicableUsers(r,i,e),$(this.closest('[class="zp_STfld"]')).after(s)}}))},maxMinApplicableUsers:function(e){var t="minInfo"==e.getAttribute("rel")?"maxInfo":"minInfo",s=e.closest('[id="typeOpts"]').previousSibling.getAttribute("rel").split("_")[1],r="moderateOpt"==e.closest('[id="typeOpts"]').previousSibling.getAttribute("rel").split("_")[0]?1:0,l={},a=document.querySelector('[rel="configopt"]').querySelector('[class="zp_Tglst ntxt"]').innerText==ZPI18N.getString("zp.assessment.question.type.single")?1:4;1==a?l=lmssettings.savedConfigData[s]?lmssettings.savedConfigData[s]:{}:(sType=0==s?"zp.lms.learningplan":1==s?"zp.lms.settings.courseType.self":2==s?"zp.lms.settings.courseType.ILT":"zp.lms.settings.courseType.manuals",sType=lms.settingData[0].courseTypeSettingIds[sType],l=lmssettings.savedConfigData[sType]?lmssettings.savedConfigData[sType]:{});var n=isEmpty(l)||isEmpty(l.applicableUsers)?{}:0==r&&l.applicableUsers[r]?l.applicableUsers[r]:l.applicableUsers[r+1]?l.applicableUsers[r+1]:{},i=document.querySelector('[id="newUsers_'+r+'"]')?document.querySelector('[rel="newUsers"]').querySelectorAll('[rel="newUser"]').length+1:1;l.isTrainerEnabled=0==r?!isEmpty(l)&&l.isTrainerCanAdd:!isEmpty(l)&&l.isTrainerCanMod;var o='<i class="IC-minimize" rel="'+t+'" onclick="lmssettings.maxMinApplicableUsers(this)"></i><div class="zp_STapl">';if(1==a||4==a&&3!=s){o+='<p class="zp_cntinfo"><i class="IC-information"></i>';o+="<font>"+(0==r?1==a?ZPI18N.getString("zp.lms.settings.admintrainernote"):0==s?ZPI18N.getString("zp.lms.settings.admintrainerplannote"):ZPI18N.getString("zp.lms.settings.admintrainercoursenote"):1==a?ZPI18N.getString("zp.lms.settings.admintrainermodnote"):0==s?ZPI18N.getString("zp.lms.settings.admintrainermodplannote"):ZPI18N.getString("zp.lms.settings.admintrainermodcoursenote"))+"</font></p>"}if("minInfo"==e.getAttribute("rel")){if(o+='<div class="zp_flter "><div class="zp_fltcnt"><div class="zp_Mtfil" rel="newUsers" id="newUsers_'+r+'">',(1==a||4==a&&3!=s)&&(o+='<div rel="newUser" id="newUser_'+i+'"><label><b rel="fieldCon">'+ZPI18N.getString("zp.role")+"</b><span>"+ZPI18N.getString("zp.admin")+"</span></label></div>"),(1==a||4==a&&0!=s&&3!=s)&&l.isTrainerEnabled&&(o+='<div rel="newUser" id="newUser_'+(i+=1)+'"><label><b rel="fieldCon">'+ZPI18N.getString("zp.role")+'</b><span rel="userVal_'+i+'" _rel="2">'+ZPI18N.getString("zp.lms.trainer")+'</span></label><i class="IC-cls" onclick="lmssettings.configSettingsReset(2, this);"></i></div>'),lmssettings.savedConfigData)for(var c in i+=1,n)if(0!=Object.keys(JSON.parse(n[c])).length&&"type"!=c)for(var d in JSON.parse(n[c]))fieldVal="desi"==c?ZPI18N.getString("zp.designation"):"dept"==c?ZPI18N.getString("zp.department"):"role"==c?ZPI18N.getString("zp.role"):"group"==c?ZPI18N.getString("zp.group"):ZPI18N.getString("zp.user"),o+='<div rel="newUser" id="newUser_'+i+'"><label><b rel="fieldCon">'+fieldVal+'</b><span rel="userVal_'+i+'" _rel="'+d+'">'+JSON.parse(n[c])[d]+'</span></label><i class="IC-cls" onclick="lmssettings.configSettingsReset(2, this);"></i></div>',i++;o+='<button class="zp_fltbtn fill" rel="addsave" onclick="lmssettings.addUsers(this, null, '+r+')"><i class="IC-plus"></i>'+ZPI18N.getString("zp.add")+"</button></div></div></div>",e.closest('[id="typeOpts"]').classList.remove("max")}else if("maxInfo"==e.getAttribute("rel")){for(var c in o+='<div class="zp_mininfo">',(1==a||4==a&&3!=s)&&(n&&0!=Object.keys(n).length&&n.role&&0!=Object.keys(JSON.parse(n.role))?4==a&&0==s||!l.isTrainerEnabled?o+="<span><b>"+(Object.keys(JSON.parse(n.role)).length+1)+"</b><font>"+ZPI18N.getString("zp.role")+"</font></span>":l.isTrainerEnabled&&(o+="<span><b>"+(Object.keys(JSON.parse(n.role)).length+2)+"</b><font>"+ZPI18N.getString("zp.role")+"</font></span>"):!l.isTrainerEnabled||l.isTrainerEnabled&&4==a&&0==s?o+="<span><b>1</b><font>"+ZPI18N.getString("zp.role")+"</font></span>":o+="<span><b>2</b><font>"+ZPI18N.getString("zp.role")+"</font></span>"),n)0!=Object.keys(JSON.parse(n[c])).length&&"type"!=c&&(3!=s&&"role"!=c||3==s)&&(fieldVal="desi"==c?ZPI18N.getString("zp.designation"):"dept"==c?ZPI18N.getString("zp.department"):"role"==c?ZPI18N.getString("zp.role"):"group"==c?ZPI18N.getString("zp.group"):ZPI18N.getString("zp.user"),o+='<span rel="minFieldVal" _rcnt="'+Object.keys(JSON.parse(n[c])).length+'"><b>'+Object.keys(JSON.parse(n[c])).length+"</b><font>"+fieldVal+"</font></span>");o+='<button class="zp_fltbtn fill" rel="addsave" onclick="lmssettings.addUsers(this, 1,  '+r+')"><i class="IC-plus"></i>'+ZPI18N.getString("zp.add")+"</button></div>",e.closest('[id="typeOpts"]').classList.add("max")}o+="</div>",e.closest('[id="typeOpts"]').innerHTML=o},constructApplicableUsers:function(e,t,s,r,l){var a={},n=!1,i="",o="",c='<div class="zp_Prusr max" rel="'+s+'" id="typeOpts"><i class="IC-minimize" rel="minInfo" onclick="lmssettings.maxMinApplicableUsers(this)"></i><div class="zp_STapl">';if(a=0==s?e&&e.applicableUsers[0]?e.applicableUsers[0]:{}:e&&e.applicableUsers[2]?e.applicableUsers[2]:{},(1==l||4==l&&"eMaterial"!=r)&&(c+='<p class="zp_cntinfo"><i class="IC-information"></i>',0==s?(o=1==l?ZPI18N.getString("zp.lms.settings.admintrainernote"):"isLP"==r?ZPI18N.getString("zp.lms.settings.admintrainerplannote"):ZPI18N.getString("zp.lms.settings.admintrainercoursenote"),n=!isEmpty(e)&&e.isTrainerCanAdd):(o=1==l?ZPI18N.getString("zp.lms.settings.admintrainermodnote"):"isLP"==r?ZPI18N.getString("zp.lms.settings.admintrainermodplannote"):ZPI18N.getString("zp.lms.settings.admintrainermodcoursenote"),n=!isEmpty(e)&&e.isTrainerCanMod),c+="<font>"+o+"</font></p>"),c+='<div class="zp_mininfo">',"eMaterial"!=r&&(a&&0!=Object.keys(a).length&&a.role&&0!=Object.keys(JSON.parse(a.role))?"isLP"!=r&&n?n&&(c+="<span><b>"+(Object.keys(JSON.parse(a.role)).length+2)+"</b><font>"+ZPI18N.getString("zp.role")+"</font></span>"):c+="<span><b>"+(Object.keys(JSON.parse(a.role)).length+1)+"</b><font>"+ZPI18N.getString("zp.role")+"</font></span>":"isLP"!=r&&n?n&&(c+="<span><b>2</b><font>"+ZPI18N.getString("zp.role")+"</font></span>"):c+="<span><b>1</b><font>"+ZPI18N.getString("zp.role")+"</font></span>"),a&&0!=Object.keys(a).length)for(var d in a)0!=Object.keys(JSON.parse(a[d])).length&&"type"!=d&&"configType"!=d&&("eMaterial"!=r&&"role"!=d||"eMaterial"==r)&&(i="desi"==d?ZPI18N.getString("zp.designation"):"dept"==d?ZPI18N.getString("zp.department"):"role"==d?ZPI18N.getString("zp.role"):"group"==d?ZPI18N.getString("zp.group"):ZPI18N.getString("zp.user"),c+="<span><b>"+Object.keys(JSON.parse(a[d])).length+"</b><font>"+i+"</font></span>");return c+='<button class="zp_fltbtn fill" rel="addsave" onclick="lmssettings.addUsers(this, 1, '+s+')"><i class="IC-plus"></i>'+ZPI18N.getString("zp.add")+"</button></div></div></div>"},addUsers:function(e,t,s){if(t&&1==t){var r=e.closest('[id="typeOpts"]');lmssettings.maxMinApplicableUsers(e.closest('[id="typeOpts"]').querySelector('[rel="minInfo"]')),e=r.querySelector('[rel="addsave"]')}var l=e.closest('[id="newUsers_'+s+'"]').querySelectorAll('[rel="newUser"]'),a=0==l.length?0:JSON.parse(l[l.length-1].getAttribute("id").split("_")[1])+1,n='<div rel="newUser" id="newUser_'+a+'"><div class="fcs" rel="fVal"><label><i class="IC-users" rel="fieldId"></i><b rel="fieldCon">'+ZPI18N.getString("zp.select")+'</b></label><i class="IC-adwn" id="fieldVal" rel="fieldVal_'+a+'"></i></div><div class="zp_Sm" rel="userVal_'+a+'" id="userVal_'+a+'"></div><i class="IC-cls" onclick="lmssettings.configSettingsReset(2, this);"></i></div>';$(n).insertBefore($(e));var i=e.closest('[id="newUsers_'+s+'"]').querySelector('[rel="userVal_'+a+'"]'),o={},c=[];c.push("Select"),o[0]=c;var d={};d[0]=o[0],lmssettings.createMenu(o,i,"newUser_"+a,d,"newUser"),lmsbase.addListener(document.getElementById("configopts"),"click",lmssettings.clickPopupHandler,!1)},clickPopupHandler:function(e){var t=e.target;t.getAttribute("rel")&&t.closest('[rel="newUser"]')&&lmssettings.createFieldMenu(t,e)},createFieldMenu:function(e,t){lmsmenu.initiate({elem:e.closest('[rel="fVal"]'),width:"115px",type:"dropdown",arrowHead:!1,menulist:[{desi:[ZPI18N.getString("zp.designation")]},{dept:[ZPI18N.getString("zp.department")]},{group:[ZPI18N.getString("zp.group")]},{role:[ZPI18N.getString("zp.role")]},{users:[ZPI18N.getString("zp.user")]}],eve:t}).on("click",(function(){var e="desi"==this.value?ZPI18N.getString("zp.designation"):"dept"==this.value?ZPI18N.getString("zp.department"):"group"==this.value?ZPI18N.getString("zp.group"):"role"==this.value?ZPI18N.getString("zp.role"):ZPI18N.getString("zp.user");this.referObj.elem.querySelector('[rel="fieldCon"]').innerText=e;var t=$(this.referObj.elem.closest('[rel="newUser"]')).find("#userVal_"+this.referObj.elem.querySelector('[id="fieldVal"]').getAttribute("rel").split("_")[1]).find(".zp_Tglst");t.removeClass("ntxt"),t.html("")})).bind()},updateGeneralNotificationStatus:function(e){var t={allowNotify:"IC-cbox"==e.getAttribute("class")?1:0};zplms.put("/lms/settings/feature",t),lmssettings._relem.querySelector('[rel="notifications"]').parentNode.style.display="IC-cbox zp_gclr"==e.getAttribute("class")?"":"none"},copyUrl:function(e){var t="";1==e?(lmscourses.getCourseUrl(),t=lmscourses.getUrl):t=e;var s=document.createElement("TEXTAREA");document.body.appendChild(s),s.setAttribute("id","copyText"),document.getElementById("copyText").value=t,s.select(),document.execCommand("copy"),document.body.removeChild(s),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.copysuccess"))},updateRoundButtons:function(e){if($("#publicUrl").length&&$("#publicUrl").length&&lms.commonSettingData.allowPublishUrl&&document.getElementById("publicUrl").setAttribute("class","IC-cbox zp_gclr"),$("#courseedit").length&&$("#courseedit").length&&lms.commonSettingData.allowCourseEdit&&document.getElementById("courseedit").setAttribute("class","IC-cbox zp_gclr"),$("#allownotify").length){document.getElementById("allownotify");var t=lmssettings._relem.querySelector('[rel="notifications"]').parentNode;lms.commonSettingData.allowNotify&&(t.style.display="",document.getElementById("allownotify").setAttribute("class","IC-cbox zp_gclr"))}$("#isilt").length&&1==lms.iltSettingData.isIltenable&&document.getElementById("isilt").setAttribute("class","IC-cbox zp_gclr"),$("#ismanual").length&&1==lms.manualSettingData.isManualenable&&document.getElementById("ismanual").setAttribute("class","IC-cbox zp_gclr"),$("#isselfp").length&&1==lms.selfSettingData.isSelfenable&&document.getElementById("isselfp").setAttribute("class","IC-cbox zp_gclr"),$("#islp").length&&1==lms.lpSettingData.isLpEnable&&document.getElementById("islp").setAttribute("class","IC-cbox zp_gclr"),e&&$("#readorwritepage :input").attr("readOnly",!1)},checkBoxConstruction:function(e,t){var s="",r=[];null!=t&&(r=t.match(/[1-9]/g));for(var l=0,a="",n=0;n<e.length;n++)a="IC-cbox",null!=r&&r[l]==n+1&&(a="IC-cbox zp_gclr",l++),s+='<li name="checkBox"><i class="'+a+'" _rel="'+(n+1)+'"></i><span>'+e[n]+"</span></li>";return s},getCoursesSetting:function(e,t,s){var r='<div class="zp_setCont"><h5>'+ZPI18N.getString("zp.lms.settings")+'</h5><div class="zp_STbx"><header><h2>'+ZPI18N.getString("zp.lms.settings.Creation")+'</h2></header><div class="zp_STfld"><div><h4>'+ZPI18N.getString("zp.lms.settings.WhocanCreate")+"</h4><p>"+ZPI18N.getString("zp.lms.settings.WhocanCreateD")+'</p></div><div class="zp_Sm">';return array=[],array.push(ZPI18N.getString("zp.admin")),array.push(ZPI18N.getString("zp.lms.feedback.trainer")),r+='<ul id="whocancreate">'+lmssettings.checkBoxConstruction(array,ZPeople.decodeTxt(e.createBy))+"</ul></div></div>",s||(r+='<div class="zp_btn"><button class="zpthm" onclick="lmssettings.updateCourseBasedSettings(\''+e.settingId+"')\">"+ZPI18N.getString("zp.save")+"</button></div>"),r+="",1==s&&(r+='<div class="zp_btn"><button class="zpthm" onclick="lmssettings.updateCourseBasedSettings(\''+e.settingId+"')\">"+ZPI18N.getString("zp.save")+"</button></div>"),r+='<div class="zp_Sm "></div></div></div>'},radiobuttonConstruction:function(e,t,s){for(var r="",l=0;l<e.length;l++)r+='<li  onclick = "lmssettings.radioEvent(event,'+s+')"><i  _rel="'+(l+1)+'" class = "'+(l+1==t?"IC-rdo zp_gclr":"IC-rdo")+'" ></i><span>'+e[l]+"</span></li>";return r},radioEvent:function(e,t){if(t){var s=e.target.closest("ul").querySelector('[class="IC-rdo zp_gclr"]');s!=e.target&&null!=s?(s.setAttribute("class","IC-rdo"),(s=e.target.closest("li")).firstChild.setAttribute("class","IC-rdo zp_gclr")):null==s&&e.target.closest("i").setAttribute("class","IC-rdo zp_gclr")}},getManualSetting:function(){var e,t='<div class="zp_setCont"> <h5>'+ZPI18N.getString("zp.lms.settings")+'</h5><div class="zp_STbx"><header><h2>'+ZPI18N.getString("zp.lms.settings.Structure")+'</h2></header><div><div class="zp_Ldtl"><p>'+ZPI18N.getString("zp.lms.settings.AllowedCourseType")+"</p><span>"+ZPI18N.getString("zp.lms.settings.AllowedCourseTypemode")+"</span>";return(e=[]).push("Files"),e.push("Module"),e.push("Folder"),t+='<div class="zp_Sm "><ul id = "radioSelect"> '+lmssettings.radiobuttonConstruction(e,lmssettings.manualSettingData.manualStructure,lms.manualSettingData.isManualenable)+' </ul></div></div></div> <div class="zp_btn"><button class="zpthm" onclick="lmssettings.updateManualBasedSettings(\''+lms.manualSettingData.settingId+"')\">"+ZPI18N.getString("zp.save")+'</button></div></div><div class="zp_STbx"><header><h2>'+ZPI18N.getString("zp.lms.settings.Creation")+'</h2></header><div class="zp_STfld"><div><h4>'+ZPI18N.getString("zp.lms.settings.WhocanCreate")+"</h4><p>"+ZPI18N.getString("zp.lms.settings.WhocanCreateD")+'</p></div><div class="zp_Sm ">',(e=[]).push(ZPI18N.getString("zp.admin")),e.push(ZPI18N.getString("zp.lms.settings.TrainerM")),t+='<ul id="whoCreate">'+lmssettings.checkBoxConstruction(e,ZPeople.decodeTxt(lms.manualSettingData.createBy))+'</ul></div></div><div class="zp_STfld"><div><h4>'+ZPI18N.getString("zp.lms.settings.Whowillapprove")+"</h4><p>"+ZPI18N.getString("zp.lms.settings.WhowillapproveD")+'</p></div><div class="zp_Sm "><ul id="whoPublish">'+lmssettings.checkBoxConstruction(e,ZPeople.decodeTxt(lms.manualSettingData.publishBy))+'</ul></div></div><div class="zp_btn"><button class="zpthm" onclick="lmssettings.updateManualBasedSettings(\''+lms.manualSettingData.settingId+"')\"  >"+ZPI18N.getString("zp.save")+"</button></div></div></div></div>"},getNotificationSetting:function(){lms.notificationData.loadNotificationTemplates(lmsNotification.construct)},getFeaturePolicySetting:function(){lmssettings.commonSettingData.sessionFeedbackby;var e='<div class="zp_setCont"><h5>'+ZPI18N.getString("zp.lms.settings")+'</h5><div class="zp_STbx"><header><h2>'+ZPI18N.getString("zp.feedback")+'</h2></header><div class="zp_STfld" rel="createOpt_'+i+'"><div><h4>'+ZPI18N.getString("zp.lms.sessionfeedbackgivenby")+'</h4></div><div class="zp_Sm"><div class="zp_nobr"><ul id="sessionfeedback"><li  rel="anyone" onclick = "lmssettings.updateSessionFeedback(this,event)">';e+='<i class="'+("1"==lmssettings.commonSettingData.sessionFeedbackby?"IC-rdo zp_gclr":"IC-rdo")+'"  _rel="1"></i><span>'+ZPI18N.getString("zp.lms.alllearners")+'</span></li><li  rel="presentuser"  onclick = "lmssettings.updateSessionFeedback(this,event)">',e+='<i class="'+("2"==lmssettings.commonSettingData.sessionFeedbackby?"IC-rdo zp_gclr":"IC-rdo")+'"  _rel="2"></i><span>'+ZPI18N.getString("zp.lms.sessionattendees")+'</span></li></ul></div></div></div><div class="zp_STfld"><div><h4>'+ZPI18N.getString("zp.lms.settings.FeedbackAppliedFor")+"</h4><p>"+ZPI18N.getString("zp.lms.feedback.givenForTrainerOrcourseContent")+'</p></div><div class="zp_Sm " id="feedbackto"><div id="feedbackappliedto"></div></div></div><header><h2>'+ZPI18N.getString("zp.lms.settings.Discussions")+'</h2></header><div class="zp_STfld"><div><h4>'+ZPI18N.getString("zp.lms.settings.WhostartDiscussion")+"</h4><p>"+ZPI18N.getString("zp.lms.settings.whocanStartDiscussion")+"</p></div>";var t=[];return t.push(ZPI18N.getString("zp.lms.courseadmin")),t.push(ZPI18N.getString("zp.lms.feedback.trainer")),t.push(ZPI18N.getString("zp.lms.learner")),e+='<div class="zp_Sm" ><ul id="startDiscussionby">'+lmssettings.checkBoxConstruction(t,ZPeople.decodeTxt(lmssettings.commonSettingData.startDiscBy))+"</ul></div></div>\t<header><h2>"+ZPI18N.getString("zp.lms.base.CourseReports")+'</h2></header><div class="zp_STfld"><div><h4>'+ZPI18N.getString("zp.lms.settings.ViewReports")+"</h4><p>"+ZPI18N.getString("zp.lms.settings.whoViewTheReport")+'</p></div><div class="zp_Sm " id="viewReports"><div id="reportsViewedBy"></div></div></div><div class="zp_STfld"><div><h4>'+ZPI18N.getString("zp.lms.settings.exportEmployeeComponentsHeader")+"</h4><p>"+ZPI18N.getString("zp.lms.settings.exportEmployeeComponentsDesc")+'</p></div><div class="zp_Sm " id="exportEmpComp"><div id="selectExportEmpComps"></div></div></div><div class="zp_btn"><button class="zpthm" _rel = "discussion" onclick="lmssettings.updateFeaturePolicy(this)">'+ZPI18N.getString("zp.save")+"</button></div></div></div>"},updateSessionFeedback:function(e,t){$('[id="sessionfeedback"]').find(".IC-rdo").removeClass("zp_gclr"),$(e).find(".IC-rdo").addClass("zp_gclr")},updateGeneralSetting:function(){var e="IC-cbox zp_gclr"==document.getElementById("isilt").getAttribute("class")?1:0,t="IC-cbox zp_gclr"==document.getElementById("ismanual").getAttribute("class")?1:0,s="IC-cbox zp_gclr"==document.getElementById("isselfp").getAttribute("class")?1:0,r="IC-cbox zp_gclr"==document.getElementById("islp").getAttribute("class")?1:0;if(e||s||t||r){var l={};l[lms.iltSettingData.settingId]=e,l[lms.selfSettingData.settingId]=s,l[lms.manualSettingData.settingId]=t,l[lms.lpSettingData.settingId]=r;var a="";0!=$("#publicUrl").length&&(a="IC-cbox zp_gclr"==document.getElementById("publicUrl").getAttribute("class")?1:0);var n="";0!=$("#allownotify").length&&(n="IC-cbox zp_gclr"==document.getElementById("allownotify").getAttribute("class")?1:0);var i={method:"updateTypeBasedSettings",settingIdsObj:JSON.stringify(l),publishurl:a,allowNotify:n,conreqcsr:csrfToken};$.post("/lmssettingsAction.zp",i,(function(e){"Success"==e[1].message?(lms.typebasedData=null,lms.commonSettingData=null,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),lmssettings._relem.querySelector('[rel="notifications"]').parentNode.style.display=n?"":"none",$.each(e[1].settingsData,(function(e,t){lmssettings.isloaded=!0,lmssettings.isTrainerCreate=t.isTrainerCreate,lmssettings.typebasedData=t,lms.typebasedData=t,null!=t.allType?(lmssettings.commonSettingData=t.commonSetting,lms.commonSettingData=t.commonSetting):(lms.selfSettingData=t.selfData,lms.iltSettingData=t.iltData,lms.manualSettingData=t.manualData,lms.lpSettingData=t.lpData,lmsgradetype.valueObj=t.gradeSetting,lmssettings.manualSettingData=t.manualData,lmssettings.iltSettingData=t.iltData,lmssettings.selfSettingData=t.selfData,lmssettings.lpSettingData=t.lpData),lmssettings.commonSettingData=t.commonSetting,lms.commonSettingData=t.commonSetting,lmssettings.getCategories=t.categoryData}))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))})),lms.typebasedData=null}else lmssettings.updateRoundButtons(),lms.typebasedData=null,lms.commonSettingData=null,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.selatleast"))},updateManualBasedSettings:function(e){var t;t=document.getElementById("radioSelect").querySelector('[class="IC-rdo zp_gclr"]').getAttribute("_rel");for(var s=document.getElementById("whoCreate").querySelectorAll('[class="IC-cbox zp_gclr"]'),r=[],l=0;l<s.length;l++){(o={}).ids=s[l].getAttribute("_rel"),r.push(o)}var a=JSON.stringify(r),n=document.getElementById("whoPublish").querySelectorAll('[class="IC-cbox zp_gclr"]'),i=[];for(l=0;l<n.length;l++){var o;(o={}).ids=n[l].getAttribute("_rel"),i.push(o)}var c={settingId:e,courseCreateBy:a,manualStructure:t,publishBy:JSON.stringify(i),allowCourseEdit:""};zplms.put("/lms/settings/general",c,(function(e){"Success"==e[1].message?(lms.typebasedData=null,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),lmssettings.getSettingsData(null,!0)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))},updateCourseBasedSettings:function(e){var t=0,s=0,r=0;null!=document.getElementById("Attendance")&&0!==document.getElementById("Attendance")&&(t=document.getElementById("Attendance").value),null!=document.getElementById("Assesment")&&0!==document.getElementById("Assesment")&&(s=document.getElementById("Assesment").value),null!=document.getElementById("Trainer")&&0!==document.getElementById("Trainer")&&(r=document.getElementById("Trainer").value);var l=document.getElementById("whocancreate").querySelectorAll('[class="IC-cbox zp_gclr"]'),a=[];if(l.length>0){for(var n=0;n<l.length;n++){var i={};i.ids=l[n].getAttribute("_rel"),a.push(i)}var o={method:"updateTypeBasedSettings",settingId:e,courseCreateBy:JSON.stringify(a),courseCompletetime:"",courseNotify:"",Attendance:t,Assesment:s,Participation:0,allowCourseEdit:"",trainer:r,InternalMarks:0,conreqcsr:csrfToken};$.post("/lmssettingsAction.zp",o,(function(e){"Success"==e[1].message?(lms.typebasedData=null,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),lmssettings.getSettingsData(null,!0)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.selatleast"))},updateIltBasedSettings:function(){var e="",t="",s="",r="",l="",a="",n="";null!=document.getElementById("iltcourseCreate").childNodes[0].textContent&&(e=document.getElementById("iltcourseCreate").childNodes[0].childNodes[2].getAttribute("_rel")),null!=document.getElementById("iltenrollwhn").childNodes[0].textContent&&(t=document.getElementById("iltenrollwhn").childNodes[0].childNodes[2].getAttribute("_rel")),null!=document.getElementById("iltunenrollwhn").childNodes[0].textContent&&(s=document.getElementById("iltunenrollwhn").childNodes[0].childNodes[2].getAttribute("_rel")),null!=document.getElementById("iltcompletecourse").childNodes[0].textContent&&(r=document.getElementById("iltcompletecourse").childNodes[0].childNodes[2].getAttribute("_rel")),null!=document.getElementById("iltnotify").childNodes[0].textContent&&(l=document.getElementById("iltnotify").childNodes[0].childNodes[2].getAttribute("_rel")),""!=document.getElementById("iltAttendance").value&&(a=document.getElementById("iltAttendance").value),""!=document.getElementById("iltAssesment").value&&(n=document.getElementById("iltAssesment").value),""!=document.getElementById("iltTrainer").value&&(n=document.getElementById("iltTrainer").value);var i="";Layout.Page.container.find("#iltpublishBy").find("li").each((function(){$($(this).find(".IC-cbox")[0]).hasClass("zp_gclr")?i=1:$($(this).find(".IC-cbox")[1]).hasClass("zp_gclr")?i=2:$($(this).find(".IC-cbox")[2]).hasClass("zp_gclr")&&(i=3)}));var o="";Layout.Page.container.find("#iltenrollBy").find("li").each((function(){$($(this).find(".IC-cbox")[0]).hasClass("zp_gclr")?o=1:$($(this).find(".IC-cbox")[1]).hasClass("zp_gclr")?o=2:$($(this).find(".IC-cbox")[2]).hasClass("zp_gclr")?o=3:$($(this).find(".IC-cbox")[3]).hasClass("zp_gclr")&&(o=4)}));var c="";Layout.Page.container.find("#iltunenrollBy").find("li").each((function(){$($(this).find(".IC-cbox")[0]).hasClass("zp_gclr")?c=1:$($(this).find(".IC-cbox")[1]).hasClass("zp_gclr")?c=2:$($(this).find(".IC-cbox")[2]).hasClass("zp_gclr")?o=3:$($(this).find(".IC-cbox")[3]).hasClass("zp_gclr")&&(c=4)}));var d={type:2,courseCreateBy:e,courseEnrolltime:t,courseUnEnrolltime:s,courseCompletetime:r,courseNotify:l,publishBy:i,enrollBy:o,unenrollBy:c,attendance:a,assesment:n,trainer:"",participation:"",internalMarks:""};zplms.put("/lms/settings/general",d,(function(e){"Success"==e[1].message?(lms.typebasedData=null,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),lmssettings.getSettingsData(null,!0)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))}))},updateFeaturePolicy:function(e){var t="",s="",r="",l="";if(e&&("feedback"==e.getAttribute("_rel")||"discussion"==e.getAttribute("_rel"))){document.getElementById("feedbackgivenBy")&&(t=document.getElementById("feedbackgivenBy").childNodes[0].childNodes[2].getAttribute("_rel")),document.getElementById("whenfeedbackgiven")&&(s=document.getElementById("whenfeedbackgiven").childNodes[0].childNodes[2].getAttribute("_rel")),document.getElementById("feedbackappliedto")&&(r=document.getElementById("feedbackappliedto").childNodes[0].childNodes[2].getAttribute("_rel"));for(var a=document.getElementById("startDiscussionby").querySelectorAll('[class="IC-cbox zp_gclr"]'),n=[],i=0;i<a.length;i++){(e={}).ids=a[i].getAttribute("_rel"),n.push(e)}if(n=JSON.stringify(n),document.getElementById("reportsViewedBy")&&(l=document.getElementById("reportsViewedBy").childNodes[0].childNodes[2].getAttribute("_rel")),document.getElementById("selectExportEmpComps")){empCompElems=document.getElementById("selectExportEmpComps").querySelectorAll("[data-value]"),selectExportEmpCompIds=[];for(i=0;i<empCompElems.length;i++)selectExportEmpCompIds.push(empCompElems[i].getAttribute("data-value"))}}var o="";0!=$("#publicUrl").length&&(o="IC-cbox zp_gclr"==document.getElementById("publicUrl").getAttribute("class")?1:0);var c=document.getElementById("sessionfeedback").querySelector('[class="IC-rdo zp_gclr"]').getAttribute("_rel"),d="";if(0!=$("#allownotify").length)d="IC-cbox zp_gclr"==document.getElementById("allownotify").getAttribute("class")?1:0;else if(e.hasOwnProperty("_rel")&&"logoallowed"==e.getAttribute("_rel")){var m="";if(document.getElementById("logoallowed"))m=document.getElementById("logoallowed").querySelector('[class="IC-radio1x zp_gclr"]').getAttribute("_rel")}var u={feedbackgivenby:t,whencanfeedbackgiven:s,whocanstartdiscussion:n,publishurl:o,allowNotify:d,feedbackfor:r,allowCourseEdit:document.getElementById("courseedit")?"IC-cbox zp_gclr"==document.getElementById("courseedit").getAttribute("class")?1:0:"",logoallowed:m,discussionallowed:"",reportsfor:l,exportEmpComps:selectExportEmpCompIds?selectExportEmpCompIds.toString():void 0,sessionFeedback:c};zplms.put("/lms/settings/feature",u,(function(e){"Success"==e[1].message?(lms.typebasedData=null,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.settings.SavedSuccess")),lmssettings.getSettingsData((function(){oldVal=lmsbase._modHash[lmsbase._role].reports,reportsViewFr=lms.commonSettingData.reportsViewFr,hasPermission=(2==reportsViewFr||3==reportsViewFr)&&(isadmin||lms.isDataAdmin)||(1==reportsViewFr||3==reportsViewFr)&&1==lms.role,hasPermission=hasPermission&&isOldReports,oldVal!=hasPermission&&(lmsbase._modHash[lmsbase._role].reports=hasPermission,lmsbase.constructLHS())}),!0)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.Unabletosave"))})),""!=d&&(lms.commonSettingData.allowNotify=d,lmssettings._relem.querySelector('[rel="notifications"]').parentNode.style.display=d?"":"none")},getCourseCreateOptn:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.admin")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.lms.settings.TrainerM")),l[2]=n;[].push(ZPI18N.getString("zp.lms.feedback.manager"));var i=document.getElementById(s);lmssettings.createMenu(l,i,r)},getEnrollOptn:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.10daysbefore")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.lms.settings.oneweekbefore")),l[2]=n;var i=[];i.push(ZPI18N.getString("zp.lms.settings.anytime")),l[3]=i;var o=document.getElementById(s);lmssettings.createMenu(l,o,r)},getUnEnrollOptn:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.coursecompletion")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.lms.settings.anytime")),l[2]=n;var i=document.getElementById(s);lmssettings.createMenu(l,i,r)},getCompletecourseOptn:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.mandatorysession/filecompletion")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.lms.settings.trainershouldcomplete")),l[2]=n;var i=[];i.push(ZPI18N.getString("zp.lms.settings.coursecompletedate")),l[3]=i;var o=[];o.push(ZPI18N.getString("zp.lms.settings.assesmentcomplete")),l[4]=o;var c=[];c.push(ZPI18N.getString("zp.lms.settings.failedattempttimes")),l[5]=c;var d=document.getElementById(s);lmssettings.createMenu(l,d,r)},getNotifyOptn:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.coursecomplete")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.lms.settings.whenpublish")),l[2]=n;var i=document.getElementById(s);lmssettings.createMenu(l,i,r)},getAttendanceOptn:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.TrainerM")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.admin")),l[2]=n;var i=[];i.push(ZPI18N.getString("zp.lms.settings.learner")),l[3]=i;var o=[];o.push(ZPI18N.getString("zp.lms.feedback.manager")),l[4]=o;var c=document.getElementById(s);lmssettings.createMenu(l,c,r)},getFeebackgivenBy:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.learner")),l[3]=a;var n=[];n.push(ZPI18N.getString("zp.lms.feedback.manager")),l[4]=n;var i=[];i.push(ZPI18N.getString("zp.lms.bothLM")),l[5]=i;var o=document.getElementById(s);resObj={},resObj[lmssettings.commonSettingData.feedbackGivenBy]=l[ZPeople.decodeTxt(lmssettings.commonSettingData.feedbackGivenBy)],lmsmenu.changeToSelectMenu(o,resObj,"single",null,""),lmsbase.addClass(o,"disabled")},completionOfCourse:function(e,t,s,r,l){if(l){var a={},n=[];n.push(ZPI18N.getString("zp.lms.settings.trainer/courseadmincomplete")),a[1]=n;var i=[];i.push(ZPI18N.getString("zp.lms.settings.basedondate")),a[2]=i,resObj={},resObj[lms.iltSettingData.courseCompleteOn]=a[ZPeople.decodeTxt(lms.iltSettingData.courseCompleteOn)];var o=document.getElementById(s);lmssettings.createMenu(a,o,r,0==lms.iltSettingData.courseCompleteOn?{}:resObj)}else{a={};var c=[];c.push(ZPI18N.getString("zp.lms.settings.mandatoryFiles/Sessions")),a[1]=c;var d=[];d.push(ZPI18N.getString("zp.lms.settings.Selfcomplete")),a[2]=d,resObj={},resObj[lms.selfSettingData.courseCompleteOn]=a[ZPeople.decodeTxt(lms.selfSettingData.courseCompleteOn)];o=document.getElementById(s);lmssettings.createMenu(a,o,r,0==lms.selfSettingData.courseCompleteOn?{}:resObj)}},completionOfFile:function(e,t,s,r,l){var a={},n=[];n.push(ZPI18N.getString("zp.lms.settings.filecompletebyUser")),a[1]=n;var i=[];i.push(ZPI18N.getString("zp.lms.settings.fileopen")),a[2]=i;var o=document.getElementById(s);resObj={},l?(resObj[lms.iltSettingData.fileCompleteOn]=a[ZPeople.decodeTxt(lms.iltSettingData.fileCompleteOn)],lmssettings.createMenu(a,o,r,0==lms.iltSettingData.fileCompleteOn?{}:resObj)):(resObj[lms.selfSettingData.fileCompleteOn]=a[ZPeople.decodeTxt(lms.selfSettingData.fileCompleteOn)],lmssettings.createMenu(a,o,r,0==lms.selfSettingData.fileCompleteOn?{}:resObj))},getStartDiscussion:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.TrainerM")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.admin")),l[2]=n;var i=[];i.push(ZPI18N.getString("zp.lms.settings.learner")),l[3]=i;var o=[];o.push(ZPI18N.getString("zp.lms.feedback.manager")),l[4]=o;var c=document.getElementById(s);resObj={},resObj[lmssettings.commonSettingData.startDiscBy]=l[lmssettings.commonSettingData.startDiscBy],lmssettings.createMenu(l,c,r,0==lmssettings.commonSettingData.startDiscBy?{}:resObj)},discussionAllowed:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.TrainerM")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.admin")),l[2]=n;var i=[];i.push(ZPI18N.getString("zp.lms.settings.learner")),l[3]=i;var o=[];o.push(ZPI18N.getString("zp.lms.feedback.manager")),l[4]=o;var c=document.getElementById(s);resObj={},resObj[lmssettings.commonSettingData.discAllowedFr]=l[lmssettings.commonSettingData.discAllowedFr],lmssettings.createMenu(l,c,r,0==lmssettings.commonSettingData.discAllowedFr?{}:resObj)},reportsViewedBy:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.TrainerM")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.admin")),l[2]=n;var i=[];i.push(ZPI18N.getString("zp.lms.both")),l[3]=i;var o=document.getElementById(s);resObj={},resObj[lmssettings.commonSettingData.reportsViewFr]=l[lmssettings.commonSettingData.reportsViewFr],lmssettings.createMenu(l,o,r,0==lmssettings.commonSettingData.reportsViewFr?{}:resObj)},selectExportEmpComps:function(e,t,s,r){for(var l={},a={},n=0;null!=e.commonSettingData.exportEmpComps&&n<e.commonSettingData.exportEmpComps.length;n++)a[e.commonSettingData.exportEmpComps[n].compId]=[[""],[e.commonSettingData.exportEmpComps[n].displayName]];for(n=0;n<e.commonSettingData.empComponents.length;n++)l[e.commonSettingData.empComponents[n].compId]=[[e.commonSettingData.empComponents[n].displayName]];var i=document.getElementById(s);lmssettings.createMenu(l,i,r,a)},getWhenFeebackgiven:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.anytime")),l[1]=a;var n=document.getElementById(s);n.parentElement?n.parentElement.classList.add("disabled"):n.classList.add("disabled"),resObj={},resObj[lmssettings.commonSettingData.whenCanGivenFeeeback]=l[1],lmssettings.createMenu(l,n,r,0==lmssettings.commonSettingData.whenCanGivenFeeeback?{}:resObj)},feedbackAppliedto:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.TrainerM")),l[1]=a;var n=[];n.push(ZPI18N.getString("zp.lms.settings.course")),l[2]=n;var i=[];i.push(ZPI18N.getString("zp.lms.bothTC")),l[3]=i;var o=document.getElementById(s);resObj={},resObj[lmssettings.commonSettingData.feedbackFor]=l[ZPeople.decodeTxt(lmssettings.commonSettingData.feedbackFor)],lmssettings.createMenu(l,o,r,0==lmssettings.commonSettingData.feedbackFor?{}:resObj)},getStartDiscussion:function(e,t,s,r){var l={},a=[];a.push(ZPI18N.getString("zp.lms.settings.TrainerM")),l[1]=a;var n=document.getElementById(s);resObj={},resObj[lmssettings.commonSettingData.startDiscBy]=l[ZPeople.decodeTxt(lmssettings.commonSettingData.startDiscBy)],lmssettings.createMenu(l,n,r,0==lmssettings.commonSettingData.startDiscBy?{}:resObj)},createMenu:function(e,t,s,r,l){var a="";a=null==s?lmsgroupmenu.initiate(document.getElementById("formTest")):"newUser"==l?lmsgroupmenu.initiate(t.closest('[rel="newUsers"]').querySelector('[id="'+s+'"]')):lmsgroupmenu.initiate(document.getElementById(s)),"configopts"==s?a.insertMenu({elem:t,type:"select",mode:"single",allow_new:!1,menulist:e,click:lmssettings.configSettings}):"newUser"==l?a.insertMenu({elem:t,type:"select",mode:"single",allow_new:!1,menulist:lmssettings.fetchUsersList,click:""}):"exportEmpComp"==s?a.insertMenu({elem:t,type:"select",mode:"multi",allow_new:!1,menulist:e,click:""}):a.insertMenu({elem:t,type:"select",mode:"single",allow_new:!1,menulist:e}),"exportEmpComp"==s?lmsmenu.changeToSelectMenu(t,r,"multi",null,ZPI18N.getString("zp.select"),void 0,"noencode"):lmsmenu.changeToSelectMenu(t,r,"single",null,ZPI18N.getString("zp.select"));t=document.getElementById("readorwritepage");a.scrollContainer(t)},fetchUsersList:function(e){lmssettings.menuCallBack=this.updateOptionList,lmssettings.inputvalue=this.value,null!=this.value?lmssettings.fetchapplicableUserView(lmssettings.applicableUserView,this.value):lmssettings.fetchapplicableUserView(lmssettings.applicableUserView)},fetchapplicableUserView:function(e,t){lmssettings.type=document.querySelector('[rel="configopt"]').querySelector('[class="zp_Tglst ntxt"]').innerText==ZPI18N.getString("zp.assessment.question.type.single")?0:1,lmssettings.optType=event.target.closest('[rel="configFor"]').getAttribute("id").split("_")[1],lmssettings.opt=event.target.closest('[id="typeOpts"]').getAttribute("rel");var s=$(event.target.parentElement).closest(".zp_Sm").prev()[0].querySelector('[rel="fieldCon"]').innerText,r={type:s=s==ZPI18N.getString("zp.designation")?1:s==ZPI18N.getString("zp.department")?2:s==ZPI18N.getString("zp.role")?3:s==ZPI18N.getString("zp.lms.learningplan.skills")?4:s==ZPI18N.getString("zp.location")?5:s==ZPI18N.getString("zp.user")?6:s==ZPI18N.getString("zp.group")?7:0};t&&(r.searchTxt=t),zplms.get("/lms/learningplans/"+planId||"0/criteria",r,e)},applicableUserView:function(e){var t,s,r={},l=0,a=!1;if(0==lmssettings.type&&lmssettings.savedConfigData[0])s=0==lmssettings.opt?lmssettings.savedConfigData[0].applicableUsers[0]:lmssettings.savedConfigData[0].applicableUsers[2],a=0==lmssettings.opt?!!lmssettings.savedConfigData[0]&&lmssettings.savedConfigData[0].isTrainerCanAdd:!!lmssettings.savedConfigData[0]&&lmssettings.savedConfigData[0].isTrainerCanMod;else if(1==lmssettings.type&&!lmssettings.savedConfigData[0]){l=0==lmssettings.optType?"zp.lms.learningplan":1==lmssettings.optType?"zp.lms.settings.courseType.self":2==lmssettings.optType?"zp.lms.settings.courseType.ILT":"zp.lms.settings.courseType.manuals";var n=lmssettings.typebasedData.courseTypeSettingIds[l];s=0==lmssettings.opt?lmssettings.savedConfigData[n].applicableUsers[0]:lmssettings.savedConfigData[n].applicableUsers[2],a=0==lmssettings.opt?!!lmssettings.savedConfigData[n]&&lmssettings.savedConfigData[n].isTrainerCanAdd:!!lmssettings.savedConfigData[n]&&lmssettings.savedConfigData[n].isTrainerCanMod}t=lmssettings.checkUsrValSelected(e),e=t[0],Object.values(e[1]).forEach((function(n){var o=0;if(null!=s){var c=Object.keys(s);for(i=0;i<c.length;i++){var d=Object.keys(JSON.parse(s[String(c[i])]));for(j=0;j<d.length;j++)if(n==d[j]){o=1;break}if(1==o)break}}if(0==o){var m=Object.keys(e[1]).find((t=>e[1][t]===n));(m!=ZPI18N.getString("zp.admin")&&"zp.lms.settings.courseType.manuals"!=l||"zp.lms.settings.courseType.manuals"==l)&&(r[e[1][m]]=[m,""]),m!=ZPI18N.getString("zp.admin")||t[1]||a||0!=lmssettings.type&&(1!=lmssettings.type||0==lmssettings.optType||3==lmssettings.optType)||(r[2]=[ZPI18N.getString("zp.lms.trainer"),""])}})),lmssettings.menuCallBack(r,lmssettings.inputvalue)},checkUsrValSelected:function(e){var t={};t[0]=e,t[1]=!1;for(var s,r=0==lmssettings.type?document.querySelector('[rel="'+lmssettings.opt+'"]').querySelectorAll('[rel="newUser"]'):document.querySelector('[id="configFor_'+lmssettings.optType+'"]').querySelector('[rel="'+lmssettings.opt+'"]').querySelectorAll('[rel="newUser"]'),l=0;l<r.length;l++)if(r[l].hasAttribute("_ukey")&&(s=JSON.parse(r[l].getAttribute("id").split("_")[1]),fId=r[l].querySelector('[id="userVal_'+s+'"]').querySelector('[class="zp_Tglst ntxt"]')?r[l].querySelector('[id="userVal_'+s+'"]').querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel"):r[l].querySelector('[id="userVal_'+s+'"]').getAttribute("_rel"),fVal=r[l].querySelector('[id="userVal_'+s+'"]').innerText,"Trainer"==fVal&&(t[1]=!0),fVal!=ZPI18N.getString("zp.select")))for(let t in e[1])if(e[1][t]==fId){delete e[1][t];break}return t},checkBoxselect:function(e){$(e.querySelector("i")).hasClass("zp_gclr")?$(e.querySelector("i")).removeClass("zp_gclr"):$(e.querySelector("i")).addClass("zp_gclr")},approvalFromMail:function(e,t,s){if(0==s){var r={method:"getCourseInfoDetails",courseId:e,batchId:t,modeOfView:"fullGrid",courseFor:"moderateOverview",viewFor:"courseInfo",start:0,conreqcsr:csrfToken};$.post("/courseAction.zp",r,(function(e){null!=e[1]&&lmssettings.approvalFromMailHtml(e[1],t)}))}else if(1==s){r={isForCard:!0,planFor:"lpNotification"};zplms.get("/lms/learningplans/"+e,r,(function(e){null!=e[1]&&lmssettings.approvalLpFromMailHtml(e[1][0])}))}},approvalFromMailHtml:function(e,t){var s="",r="";null!=t&&0!=t?(s=1==e[0].isBatchPublished?ZPI18N.getString("zp.published"):3==e[0].isModerateStatus?ZPI18N.getString("zp.pending"):4==e[0].isModerateStatus?ZPI18N.getString("zp.approved"):5==e[0].isModerateStatus?ZPI18N.getString("zp.rejected"):ZPI18N.getString("zp.drafted"),r=5==e[0].isModerateStatus?"tl-reject":1==e[0].isBatchPublished||4==e[0].isModerateStatus?"tl-success":"tl-wait"):(s=1==e[0].isPublished?ZPI18N.getString("zp.published"):3==e[0].isPublished?ZPI18N.getString("zp.pending"):4==e[0].isPublished?ZPI18N.getString("zp.approved"):5==e[0].isPublished?ZPI18N.getString("zp.rejected"):ZPI18N.getString("zp.drafted"),r=5==e[0].isPublished?"tl-reject":1==e[0].isPublished||4==e[0].isPublished?"tl-success":"tl-wait"),$("#lms").show(),$("#lms").html("");var l='<div class="zp_CAinfcvr"><div><div class="zp_CAinfo"><h4>'+e[0].courseName+'</h4></div><div id="" class="zp_Sm "><div><textarea name="" id="" cols="30" rows="10" type="radio" placeholder="Add comment"></textarea></div></div><div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.approvals.aboutCourse")+'</div><div class="zp_CPdes">'+ZPFeeds.Activity.validateContent(ZPeople.decodeTxt(e[0].aboutCourse),!0)+'</div><a class="vwcrs" onclick="lmssettings.openPreview( \''+e[0].courseUrl+'\')"><i class="IC-replay"></i>'+ZPI18N.getString("zp.lms.settings.viewcourse")+'</a></div></div><div class="zp_APftr"><div class="zp_Pttl">'+ZPI18N.getString("zp.requestedby")+'</div><div class="tlouter"><div class="tlentry first"><div class="tlentry-inner"><div class="tllabel"><div class="profmin"><img src="'+e[0].courseOwnerInfo[0].photoPath+'" class="Usrimg FL"><span class="ssp-un"><span class="ZPbold">'+e[0].courseOwnerInfo[0].name+"</span>"+ZPI18N.getString("zp.lms.settings.courseapproval")+'</span></div></div></div></div><div class="tlentry '+r+'" rel="StatusClr"><div class="tlentry-inner"><div class="tllabel"><div class="stshead"><span class="wait" rel="requestStatus">'+s+'</span></div><div class="profmin"><img src="'+e[0].loginUserInfo[0].photoPath+'" class="Usrimg FL"><span class="ssp-un"><span>'+e[0].loginUserInfo[0].employeeId+" - </span>"+ZPI18N.getString("zp.you")+'<span class="ssp-mail">'+e[0].loginUserInfo[0].email+"</span></span></div>";3!=e[0].isPublished&&3!=e[0].isModerateStatus||(l+='<div class="ssp-postcmt" rel="commentDiv"><textarea id="commentInBox" class="form-control MB10" rows="3" style="margin-top: 0px; margin-bottom: 10px; height: 55px;" placeholder="Write a comment..."></textarea>',l+=null!=t&&0!=t?'<button class="btn btn-success btn-animate" name="approvalBtn" approvaltype="1" onclick="lmsapprovals.requestModApprveDeny(\''+e[0].courseId+"', '"+t+"', '"+e[0].courseOwnerId+"', false, 1)\">"+ZPI18N.getString("zp.approve")+'</button><button class="btn btn-danger" name="approvalBtn" approvaltype="0" onclick="lmsapprovals.requestModApprveDeny(\''+e[0].courseId+"', '"+t+"', '"+e[0].courseOwnerId+"', false, 0)\">"+ZPI18N.getString("zp.rejectall")+"</button>":'<button class="btn btn-success btn-animate" name="approvalBtn" approvaltype="1" onclick="lmsapprovals.requestModApprveDeny(\''+e[0].courseId+"', null, '"+e[0].courseOwnerId+"', false, 1)\">"+ZPI18N.getString("zp.approve")+'</button><button class="btn btn-danger" name="approvalBtn" approvaltype="0" onclick="lmsapprovals.requestModApprveDeny(\''+e[0].courseId+"', null, '"+e[0].courseOwnerId+"', false, 0)\">"+ZPI18N.getString("zp.rejectall")+"</button>",l+="</div>"),l+="</div></div></div></div></div></div>",$("#lms").append(l)},approvalLpFromMailHtml:function(e){var t=1==e.planInfo.publishState?ZPI18N.getString("zp.published"):3==e.planInfo.publishState?ZPI18N.getString("zp.pending"):4==e.planInfo.publishState?ZPI18N.getString("zp.approved"):5==e.planInfo.publishState?ZPI18N.getString("zp.rejected"):ZPI18N.getString("zp.drafted"),s=5==e.planInfo.publishState?"tl-reject":1==e.planInfo.publishState||4==e.planInfo.publishState?"tl-success":"tl-wait";$("#lms").show(),$("#lms").html("");var r="null"==e.planInfo.description?ZPI18N.getString("zp.lms.learningplan.enterdesc"):ZPeople.decodeTxt(e.planInfo.description),l='<div class="zp_CAinfcvr"><div><div class="zp_CAinfo"><h4>'+e.planInfo.planName+'</h4></div><div id="" class="zp_Sm "><div><textarea name="" id="" cols="30" rows="10" type="radio" placeholder="Add comment"></textarea></div></div><div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.learningplan.learningoutcomes")+'</div><div class="zp_CPdes">'+r+'</div><a class="vwcrs" onclick="lmssettings.openPreview( \''+e.planInfo.planUrl+'\')"><i class="IC-replay"></i>'+ZPI18N.getString("zp.lms.settings.viewplan")+'</a></div></div><div class="zp_APftr"><div class="zp_Pttl">'+ZPI18N.getString("zp.requestedby")+'</div><div class="tlouter"><div class="tlentry first"><div class="tlentry-inner"><div class="tllabel"><div class="profmin"><img src="'+e.planInfo.planOwnerNameImg+'" class="Usrimg FL"><span class="ssp-un"><span class="ZPbold">'+e.planInfo.planOwnerName+"</span>"+ZPI18N.getString("zp.lms.settings.planapproval")+'</span></div></div></div></div><div class="tlentry '+s+'" rel="StatusClr"><div class="tlentry-inner"><div class="tllabel"><div class="stshead"><span class="wait" rel="requestStatus">'+t+'</span></div><div class="profmin"><img src="'+e.planInfo.loginUserInfo[0].photoPath+'" class="Usrimg FL"><span class="ssp-un"><span>'+e.planInfo.loginUserInfo[0].employeeId+" - </span>"+ZPI18N.getString("zp.you")+'<span class="ssp-mail">'+e.planInfo.loginUserInfo[0].email+"</span></span></div>";3==e.planInfo.publishState&&(l+='<div class="ssp-postcmt" rel="commentDiv"><textarea id="commentInBox" class="form-control MB10" rows="3" style="margin-top: 0px; margin-bottom: 10px; height: 55px;" placeholder="Write a comment..."></textarea><button class="btn btn-success btn-animate" name="approvalBtn" approvaltype="1" onclick="lmsapprovals.requestLpModApprveDeny(\''+e.planInfo.planId+"', '"+e.planInfo.userId+"', false, 1)\">"+ZPI18N.getString("zp.approve")+'</button><button class="btn btn-danger" name="approvalBtn" approvaltype="0" onclick="lmsapprovals.requestLpModApprveDeny(\''+e.planInfo.planId+"', '"+e.planInfo.userId+"', false, 0)\">"+ZPI18N.getString("zp.rejectall")+"</button></div>"),$("#lms").append(l)},openPreview:function(e){window.open(e)}};const lmsNotification=function(){class e{constructor(e){this.constructGroup(e)}constructGroup(e){let s=document.createElement("div");s.classList.add("zp_STbx"),s.innerHTML=`<header>\n\t\t\t\t\t\t\t\t\t<h2> ${e.displayName} </h2>\n\t\t\t\t\t\t\t\t\t</header>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div class="zp_Sm zp_lp zp_nbr rgtbtn noticlps">\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>`;let r=document.createElement("ul");s.querySelector(".rgtbtn div").appendChild(r),e.notifications.forEach((e=>{r.appendChild(new t(e).toNode())})),this.groupContainer=s}toNode(){return this.groupContainer}}class t{constructor(e){this.constructNotification(e)}constructNotification(e){this.notificationData=e;let t=document.createElement("li");this.notificationContainer=t,t.innerHTML=`<h4> ${e.displayName} </h4>\n\t\t\t\t\t\t\t\t\t\t\t\t<em> ${e.description} </em>`;let r=lms_ui_switch.createSwitch();if(r.setCallback(this.notificationToggleCallback.bind(this)),t.insertBefore(r.toNode(),t.firstChild),e.status&&r.toggleOn(),e.templates&&e.templates.length>1){let r=document.createElement("ul");t.appendChild(r),!e.status&&lmsbase.addClass(r,"disabled"),t.appendChild(lmsdocument.createIcElement("IC-adwn")),e.templates.forEach((t=>r.appendChild(new s(t,e.displayName).toNode()))),lmsbase.addClass(t,"clps"),this.notificationClickHandler()}else e.templates&&1===e.templates.length&&e.templates.forEach((r=>new s(r,e.displayName,t)))}notificationClickHandler(){let e=this.notificationContainer,t=e.querySelector("ul");lmsbase.addListener(e,"click",(s=>{t.isEqualNode(s.target.closest("ul"))||t.contains(s.target)||s.target.closest("div.zp_SFswtch")?s.stopPropagation():lmsbase.hasClass(e,"clps")?lmsbase.removeClass(e,"clps"):lmsbase.addClass(e,"clps")}))}notificationToggleCallback(e){this.notificationData.status=!!e;let t=this.notificationData.notificationId,s=this.notificationContainer.querySelector("ul"),r=this;lmsNotification.updateNotificationStatus(t,e,(function(l){"success"===l[1].status?(s&&s.parentElement.isEqualNode(r.notificationContainer)&&(e?lmsbase.removeClass(s,"disabled"):lmsbase.addClass(s,"disabled")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.messages.statusUpdatedSuccess")),lms.notificationData.updateNotificationStatus(t,e)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.messages.unabletoUpdate"))}))}toNode(){return this.notificationContainer}}class s{constructor(e,t,s){this.templateData=e,this.popupTitle=t,s?(this.templateContainer=s,this.actionIconsContainer=this.getActionIcons(),s.appendChild(this.actionIconsContainer)):this.constructTemplate(e)}constructTemplate(e){let t=this,s=Object.values(e.role),r=document.createElement("li");this.templateContainer=r;let l=lms_ui_switch.createSwitch();e.isEnabled&&l.toggleOn(),l.setCallback((s=>t.toggleClickCallback(e,s)));let a=document.createElement("h4");a.textContent=s[0],r.appendChild(l.toNode()),r.appendChild(a),this.actionIconsContainer=this.getActionIcons(),r.appendChild(this.actionIconsContainer)}getActionIcons(){let e=document.createElement("div");e.classList.add("zp_micn");let t=lmsdocument.createIcUlElement({}),s=lmsdocument.createIcLiElement("IC-eye",ZPI18N.getString("zp.viewmmtemplate"));if(this.addViewListener(s),t.appendChild(s),!this.templateData.isSystem){let e=lmsdocument.createIcLiElement("IC-reset",ZPI18N.getString("zp.resettemplate"));this.addResetListener(e),t.insertBefore(e,s)}return e.append(t),e}addViewListener(e){let t=this;e&&lmsbase.addListener(e,"click",(e=>{let s=e.target.closest(".zp_micn li")||e.target;s.classList.add("disabled"),t.templateData.isSystem||t.templateData.contentInfo||!t.templateData.contentId?(!t.templateData.contentInfo&&(t.templateData.contentInfo={content:t.templateData.systemTemplate.message,embeds:{}}),t.openTemplate(s)):lmsfetchFile.fetchFile({contentId:t.templateData.contentId,isReplaceEmbedsInFile:!0,callback:e=>{t.templateData.contentInfo=e,t.openTemplate(s)}},{type:3},"edit")}))}addResetListener(e){let t=this;!t.templateData.isSystem&&e&&lmsbase.addListener(e,"click",(()=>{lmsnotify.show({header:ZPI18N.getString("zp.lms.notification.template.reset.title"),body:ZPI18N.getString("zp.lms.notification.template.reset.description"),button_text:ZPI18N.getString("zp.reset"),texttype:"negative",successCallback:()=>{t.contentSavedCallback({fileInfo:{contentId:t.templateData.contentId}},{message:{content:t.templateData.systemTemplate.message,embeds:{}},subject:t.templateData.systemTemplate.subject},!0),t.closeCallback(!0)},cancelCallback:()=>{}})}))}toggleClickCallback(e,t){lmsNotification.updateNotificationTemplateStatus(e.templateId,t,(s=>{s[0]&&(e.isEnabled=!!t,ZPeople.Message.showSuccessMsg("Template status updated successfully"))}))}openTemplate(e){this.removeOtherPopup(),e&&e.classList.remove("disabled"),this.emailEditor=lmsPopup.createEmailPopup(this.getInputDetails(),this.templateData.contentId?"edit":"add"),this.emailEditor.getRootContainer().classList.add("pad70"),this.emailEditor.getRootContainer().setAttribute("style","width : 800px; height :100%"),this.emailEditor.getBodyContainer().style="height: calc(100% - 190px)";let t=this.emailEditor.getSaveButton(),s=document.createElement("button");s.classList="zpthm",s.textContent=ZPI18N.getString("zp.preview"),t.insertAdjacentElement("afterEnd",s);let r=this.emailEditor.getFromContainer().querySelector(".IC-adwn");r&&r.remove(),r=this.emailEditor.getToContainer().querySelector(".IC-adwn"),r&&r.remove(),this.emailEditor.getToContainer().querySelector(".IC-cls1")&&$(this.emailEditor.getToContainer()).find(".IC-cls1").remove(),this.emailEditor.getFromContainer().classList.add("disabled"),this.emailEditor.getToContainer().classList.add("disabled"),this.emailEditor.getBodyContainer().firstChild.classList="zp_Cdis zp-post-cont",this.emailEditor.getSaveButton().classList.add("disabled"),this.emailEditor.setEditButton(),this.emailEditor.setEditCallback(this.editCallback.bind(this)),this.addResetButton(),lmsbase.addListener(s,"click",this.previewTemplate.bind(this))}previewTemplate(){let e=this.emailEditor;e.getRootContainer().classList.add("zp_dyn");let t=this.emailEditor.getSubjectValue(),s={title:this.popupTitle,description:t},r=lmsdocument.createIcElement("IC-back",ZPI18N.getString("zp.back"));lmsbase.addListener(r,"click",(function(){l.getRootContainer().remove(),e.getRootContainer().classList.remove("zp_dyn")}));let l=lmsPopup.createPopup(s);l.getCloseButton().remove(),l.getSaveButton().remove(),l.getHeader().appendChild(r),l.getRootContainer().classList.add("pad70"),l.getRootContainer().setAttribute("style","width : 800px; height :100%"),l.getBodyContainer().style="height: calc(100% - 190px)";let a=l.getBodyContainer(),n=this.replaceDollarToHTML(this.getMessageContent());a.innerHTML=`<div class="zp_Cdis">\n\t\t\t\t\t\t\t\t\t\t\t<div style="font-family: Helvetica Neue, Helvetica, Arial, sans-serif;\n\t\t\t\t\t\t\t\t\t\t\t\tfont-size: 15px; position: relative; margin: 0 -8px 0;">\n\t\t\t\t\t\t\t\t\t\t\t\t<div style="left: 0;right: 0; background-color: rgb(25,101,202); \n\t\t\t\t\t\t\t\t\t\t\t\t\tpadding-top: 6%;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div style="width:100%; max-width: 620px;box-sizing: border-box;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmargin: auto;overflow: hidden;position: relative; \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmargin-top: -24px;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div style="background: #fff;padding: 8% 6% 0; \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbox-sizing: border-box; ">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${this.getLogo()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src="${this.templateData.notificationImage}" \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle="max-width: 280px; width: 100%; margin: 0 auto;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisplay: block;padding: 0 0 24px;" alt="">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div style="width:100%; max-width: 620px;box-sizing: border-box;\n\t\t\t\t\t\t\t\t\t\t\t\t\tmargin: auto;overflow: hidden;position: relative; \n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbox-shadow: -2px 2px 2px -1px rgba(0, 0, 0, 0.09), \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t2px 2px 2px -1px rgba(0, 0, 0, 0.09); margin-bottom: 3%;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div style="padding: 2px 6% 30px;position: relative;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${n}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n            \t\t\t\t\t\t\t</div>`}getLogo(){return logo&&"null"!=logo?`<img src="/${portalname||"people"}/viewPhoto?filename=${logo}" \n\t\t\t\t\t\t\tstyle="top: -6px;left: 0;height: 40px;position: relative;" alt="../images/logo.png">`:`<a class="DB ${Layout.isPeoplePlus?"ZPPLogo":"ZPLogo"}" \n\t\t\t\t\t\t\tstyle="top: -6px;left: 0;height: 40px;position: relative;"></a>`}replaceDollarToHTML(e){if(this.templateData.dollarReplaceHTML){Object.keys(this.templateData.dollarReplaceHTML).forEach((t=>{e=e.replaceAll(t,this.templateData.dollarReplaceHTML[t])}))}return e}getMessageContent(){return this.editing?this.emailEditor.getMessageContent():this.templateData.contentInfo.content}getInputDetails(){let e=this,t=structuredClone(e.templateData.role);return Object.keys(t).forEach((e=>t[e]=["",t[e]])),{from:{type:"menu",selectedOption:{0:[zplms.encodeHTML(e.templateData.from)]},menulist:{}},to:{type:"menu",selectedOption:t,menulist:{}},fileName:this.templateData.notificationKey,title:this.popupTitle,subject:this.templateData.subject,contentId:this.templateData.contentId,editableContent:!1,additionalParams:{templateId:this.templateData.templateId},contentInfo:this.templateData.contentInfo,insertFields:this.templateData.insertDollarFields,afterEditorLoadCallback:this.addObserver.bind(e),contentChangedCallback:this.enableSaveButton.bind(this),closeCallback:e.closeCallback.bind(e),saveCallback:e.saveCallback.bind(e)}}saveCallback(){let e=this;this.emailEditor.getSaveButton().classList.add("disabled"),this.emailEditor.getMessageEditor().saveEditorContent({mode:this.templateData.contentId?"edit":"add",contentId:this.templateData.contentId,callback:(t,s)=>e.contentSavedCallback(t,e.emailEditor.getValue())})}contentSavedCallback(e,t,s){e&&(this.templateData.contentId=e.fileInfo.contentId,this.templateData.contentInfo=t.message);let r=this,l={templateId:this.templateData.templateId,isSystem:s||this.isSystem(t),subject:t.subject,contentId:e.fileInfo.contentId};lmsNotification.updateNotificationTemplate(l,(e=>{1===e[0]?r.successCallback(e,l,s):r.failureCallBack(e)}))}isSystem(e){let t=document.createElement("div");t.innerHTML=e.message,$(t).find("br").remove();let s=document.createElement("div");return s.innerHTML=this.templateData.systemTemplate.message,t.isEqualNode(s)&&this.templateData.systemTemplate.subject===e.subject}removeOtherPopup(){lmsbase.hideMaskLayer()}closeCallback(e){let t=this;this.emailEditor&&(!e&&t.editing&&this.isModified()?lmsnotify.show({header:ZPI18N.getString("zp.lms.card.warning.unsavedchanges.header"),button_text:ZPI18N.getString("zp.confirm"),texttype:"negative",successCallback:function(){t.emailEditor.closePopup(),t.emailEditor=void 0,t.editing=!1}}):(this.emailEditor.closePopup(),t.emailEditor=void 0,t.editing=!1))}editCallback(){this.editing=!0,this.emailEditor.getBodyContainer().firstChild.classList.remove("zp_Cdis"),this.emailEditor.convertToEditableMessage(),this.emailEditor.getEditButton().remove()}addObserver(){lmsbase.addListener(this.emailEditor.getSubjectContainer().querySelector("input"),"input",this.enableSaveButton.bind(this)),this.emailEditor.getEditorDocument().addEventListener("keyup",this.enableSaveButton.bind(this)),this.emailEditor.getEditorDocument().addEventListener("click",this.enableSaveButton.bind(this)),this.enableSaveButton()}enableSaveButton(){this.isModified()?this.emailEditor.getSaveButton().classList.remove("disabled"):this.emailEditor.getSaveButton().classList.add("disabled")}addResetButton(){this.templateData.isSystem||(this.emailEditor.setResetButton(),this.emailEditor.getResetButton().querySelector("[data-ttip]").setAttribute("data-ttip",ZPI18N.getString("zp.resettemplate")),this.addResetListener(this.emailEditor.getResetButton()))}successCallback(e,t,s){if(this.templateData.contentId=t.contentId,this.templateData.subject=t.subject,this.emailEditor&&(this.emailEditor.updateOnloadMessage(),this.enableSaveButton()),this.templateData.isSystem!=e[1].isSystem){this.templateData.isSystem=e[1].isSystem;let t=this.getActionIcons();this.templateContainer.replaceChild(t,this.actionIconsContainer),this.actionIconsContainer=t,this.addResetButton()}s?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.notification.template.restore.success")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.notification.template.update.success"))}failureCallBack(e){this.emailEditor&&this.enableSaveButton(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.notification.template.update.failed"))}isModified(){let e=document.createElement("div");e.innerHTML=this.emailEditor.getOnloadMessage();let t=document.createElement("div");return t.innerHTML=this.emailEditor.getMessageContent(),this.emailEditor.validateNull()&&(this.emailEditor.getSubjectValue()!==this.templateData.subject||!e.isEqualNode(t))}toNode(){return this.templateContainer}}return{construct(){let t=document.createElement("div");t.classList.add("zp_setCont");let s=document.createElement("h5");s.textContent=ZPI18N.getString("zp.notifications"),t.append(s),lms.notificationData.getNotificationGroups().forEach((s=>{t.appendChild(new e(s).toNode())})),$(".zp_AClft").append(t)},isNotificationEnabled:()=>orgNotificationEnabled&&lms.commonSettingData.allowNotify,updateNotificationTemplate(e,t){let s={subject:e.subject,contentId:e.contentId,isSystem:e.isSystem};zplms.put("/lms/settings/notifications/templates/"+e.templateId,s,t)}}}();var lmsapprovals={usersarr:[],usersobj:{},coursearr:[],courseObj:{},popUp:"",count:0,totcount:0,_contElem:null,_relem:"",initiate:function(){lmsapprovals._relem=this.elem,lmsapprovals._relem.innerHTML="",lmsapprovals.totcount=0;lmsapprovals._relem.innerHTML='<div class="zpl_rgtcnt" _rel="approvallist"><div class="zpl_crdlst zpl_trnlst" _rel="reqList"></div></div>';var e=lmsapprovals._relem.querySelector('[_rel="reqList"]');e.parentElement.appendChild(zplms.getLoadingBarElement()),zplms.get("/lms/moderation/users",null,(function(t){t[1].length>0&&null!=t[1]?(lmsnodata.clearNoData(e),lmsapprovals.removeLoading(e.parentElement),$.each(t[1],(function(e,t){t.isUserLpMod?lmsapprovals.usersView(t.users[0],null,t.date,!1,t):t.courses.length>0&&lmsapprovals.usersView(t.users[0],t.courses[0],t.date,t.isManagerenroll,t)})),lmsbase.addListener(lmsapprovals._relem,"click",lmsapprovals.clickHandler,!1)):(lmsapprovals.removeLoading(e.parentElement),new EmptyPages("zp_nd_approval",ZPI18N.getString("zp.lms.approvals"),ZPI18N.getString("zp.lms.approvalsDesc"),$(lmsapprovals._relem.querySelector('[_rel="reqList"]'))).show())}))},removeLoading:function(e){var t=e.querySelector('[_rel="loadbar"]');t&&t.remove()},clickHandler:function(e){var t=e.target,s=t.getAttribute("_rel"),r=t.closest('[class="zpl_catlst"]');switch(s){case"checkBox":lmsapprovals._markCBox(t);break;case"approve":case"deny":case"modcourseapprove":case"modcoursedeny":case"modlpapprove":case"modlpdeny":lmsapprovals._markApprove(r,s);break;case"multiApprove":lmsapprovals.multiApprove(1);break;case"multideny":lmsapprovals.multiApprove(0);break;case"courseView":var l=r.getAttribute("_crel"),a=r.getAttribute("_urel"),n=r.getAttribute("_rrel"),i=r.getAttribute("_brel");lmsapprovals.getCourseCard(l,i,a,null,n);break;case"planView":var o=r.getAttribute("_prel");a=r.getAttribute("_urel");lmsapprovals.getCourseCard(null,null,a,o);break;case"selAll":lmsapprovals.selectAll()}},selectAll:function(){var e=lmsapprovals._relem,t=e.querySelector('[_rel="selAll"]'),s=e.querySelector('[_rel="reqList"]').querySelectorAll('[_rel="checkBox"]');if("IC-cbox zp_gclr"===t.getAttribute("class")){lmsbase.removeClass(t,"zp_gclr");for(var r=0;r<s.length;r++)lmsbase.removeClass(s[r],"zp_gclr");lmsapprovals.totcount=0}else{lmsbase.addClass(t,"zp_gclr");for(r=0;r<s.length;r++)lmsbase.addClass(s[r],"zp_gclr");lmsapprovals.totcount=s.length}e.querySelector('[_rel="courseCount"]').innerHTML=lmsapprovals.totcount+" users selected"},_markCBox:function(e){var t=e.getAttribute("class");cElem=lmsapprovals._relem,hBar=cElem.querySelector('[_rel="headerBar"]'),tCount=cElem.querySelector('[_rel="reqList"]').childNodes,t="IC-cbox zp_gclr"==t?"IC-cbox":"IC-cbox zp_gclr",lmsapprovals.totcount="IC-cbox zp_gclr"==t?lmsapprovals.totcount+1:lmsapprovals.totcount-1,e.setAttribute("class",t),hBar.querySelector('[_rel="courseCount"]').innerHTML=lmsapprovals.totcount+" users selected",tCount.length==lmsapprovals.totcount?lmsbase.addClass(cElem.querySelector('[_rel="selAll"]'),"zp_gclr"):lmsbase.removeClass(cElem.querySelector('[_rel="selAll"]'),"zp_gclr"),lmsapprovals.totcount>0?lmsbase.removeClass(hBar,"DN"):lmsbase.addClass(hBar,"DN")},_markApprove:function(e,t){var s="modlpapprove"==t||"modlpdeny"==t?e.getAttribute("_prel"):e.getAttribute("_crel"),r=e.getAttribute("_brel"),l=e.getAttribute("_urel");lmsbase.addClass(lmsapprovals._relem.querySelector('[_rel="approvallist"]'),"zp_disbtn"),"approve"==t||"modcourseapprove"==t||"modlpapprove"==t?lmsapprovals.getSuccessMessage(s,l,r,t):lmsapprovals.denyApproval(s,l,r,t)},usersView:function(e,t,s,r,l){if(l.isUserLpMod){var a='<div class="zpl_catlst" data-popup-open="courseinfo" rel="'+e.userId+"_"+l.planId+'" _prel="'+l.planId+'" _urel="'+e.userId+'"><div class="d-flexC d-flexclmcap10" _rel="planView"><div class="flex-grow0 zpl_em" _rel="planView"><div class="zpl_emimg" _rel="planView"><img _rel="planView" src="'+e.photoPath+'"></div><div class="zpl_emdts" _rel="planView"><div _rel="planView"><em _rel="planView">'+e.employeeId+' - </em><b _rel="planView">'+e.name+'</b></div><div _rel="planView"><span _rel="planView"><em _rel="planView">'+ZPI18N.getString("zp.lms.approvals.publishplanreq")+'</em><a _rel="planView">'+l.planName+'</a><em _rel="planView"> on </em><date _rel="planView">'+s+"</date></span></div></div></div></div>";l.isUserLpMod&&(a+='<div class="zpl_catlstrgt"><div class="zpl_hvr"><div class="zlabel zlabel--blue zlabel--medium zlabel--outline" _rel="modlpapprove">'+ZPI18N.getString("zp.lms.approvals.Approve")+'</div><div class="zlabel zlabel--red zlabel--medium zlabel--outline" _rel="modlpdeny">'+ZPI18N.getString("zp.lms.approvals.Deny")+"</div></div></div>"),a+="</div>"}else{var n=t.courseId,i="";t.batchId&&(i=t.batchId);var o=0;l.isUserCourseMod?(requestFor=""!=i?ZPI18N.getString("zp.lms.approvals.publishIltreq"):ZPI18N.getString("zp.lms.approvals.publishreq"),o=1):requestFor=ZPI18N.getString("zp.lms.approvals.joinreq");a='<div class="zpl_catlst" data-popup-open="courseinfo" rel="'+e.userId+"_"+n+'" _crel="'+n+'" _brel="'+i+'" _urel="'+e.userId+'" _rrel="'+o+'"><div class="d-flexC d-flexclmcap10" _rel="courseView"><div class="flex-grow0 zpl_em" _rel="courseView"><div class="zpl_emimg" _rel="courseView"><img _rel="courseView" src="'+e.photoPath+'"></div><div class="zpl_emdts" _rel="courseView"><div _rel="courseView"><em _rel="courseView">'+e.employeeId+' - </em><b _rel="courseView">'+e.name+"</b></div>";a+=""==i?'<div _rel="courseView"><span _rel="courseView"><em _rel="courseView">'+requestFor+'</em><a _rel="courseView">'+t.courseName+'</a><em _rel="courseView"> on </em><date _rel="courseView">'+s+"</date></span></div>":'<div _rel="courseView"><span _rel="courseView"><em _rel="courseView">'+requestFor+'</em><a _rel="courseView">'+t.batchName+'</a><em _rel="courseView"> on </em><date _rel="courseView">'+s+"</date></span></div>",l.isLpTaggedCourse&&l.isUserEnroll&&(("Self Paced Learning"==t.type||"Blended Learning"==t.type||"zp.lms.settings.SelfPaced"==t.type||"zp.lms.settings.InstructorLed"==t.type)&&r||isadmin||lms.settingData[0].settingPermission.isDataAdmin)&&(a+='<div class="d-flexC d-flexclmcap5 red"><i class="PI_fil_alert"></i>'+ZPI18N.getString("zp.lms.approvals.lpcoursedeny")+"</div>"),a+="</div></div></div>";var c="";l.isUserEnroll&&(("Self Paced Learning"==t.type||"Blended Learning"==t.type||"zp.lms.settings.SelfPaced"==t.type||"zp.lms.settings.InstructorLed"==t.type)&&r||isadmin||lms.settingData[0].settingPermission.isDataAdmin)?l.isLpTaggedCourse?(c="isViaLPCourse",a+='<div class="zpl_catlstrgt"><div class="zpl_hvr"><div class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="lmsapprovals.requestDeny(\''+n+"', '"+e.userId+"', true, '"+i+"', '',  '"+c+"')\">"+ZPI18N.getString("zp.remove")+"</div></div></div>"):a+='<div class="zpl_catlstrgt"><div class="zpl_hvr"><div class="zlabel zlabel--blue zlabel--medium zlabel--outline" _rel="approve">'+ZPI18N.getString("zp.lms.approvals.Approve")+'</div><div class="zlabel zlabel--red zlabel--medium zlabel--outline" _rel="deny">'+ZPI18N.getString("zp.lms.approvals.Deny")+"</div></div></div>":l.isUserCourseMod&&(a+='<div class="zpl_catlstrgt"><div class="zpl_hvr"><div class="zlabel zlabel--blue zlabel--medium zlabel--outline" _rel="modcourseapprove">'+ZPI18N.getString("zp.lms.approvals.Approve")+'</div><div class="zlabel zlabel--red zlabel--medium zlabel--outline" _rel="modcoursedeny">'+ZPI18N.getString("zp.lms.approvals.Deny")+"</div></div></div>"),a+="</div>"}lmsapprovals._relem.querySelector('[_rel="reqList"]').innerHTML+=a},denyApproval:function(e,t,s,r){$(".zp_msk").html(""),$(".zp_msk").show(),lmsapprovals.mode=1;var l='<div data-modal-box="denymsg" class="zpl_mdl zpl_malrtmsg zpl_mopen" id="zp_popsvntn"><div class="zpl_minr"><a class="_cls PI_cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'" id="denyclose"></a><div class="zpl_mcnt"><div class="alert_contain"><i class="ico delete"></i><div class="cont"><h3>'+ZPI18N.getString("zp.lms.approvals.Denysuccess")+"</h3><p>"+ZPI18N.getString("zp.lms.approvals.conveymsg")+'</p></div><div class="zpl_secn"><div><textarea class="ztextbox" id="cmtToUsr" placeholder="'+ZPI18N.getString("zp.lms.approvals.writeMessage")+'" onclick="txtareaheight(this)"></textarea></div></div></div></div><div class="zpl_mfoter"><button type="button" class="zlabel zlabel--red zlabel--medium MR10" id="denybuttn">'+ZPI18N.getString("zp.lms.approvals.send")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" id="denycancel">'+ZPI18N.getString("zp.lms.cancel")+"</button></div></div></div>";lmsapprovals._relem.querySelector('[_rel="reqList"]').innerHTML+=l,$("#denybuttn").click((function(){"modcoursedeny"==r?lmsapprovals.requestModApprveDeny(e,s,t,!0,0):"modlpdeny"==r?lmsapprovals.requestLpModApprveDeny(e,t,!0,0):lmsapprovals.requestDeny(e,t,!0,s,"",r)})),$("#denycancel").click((function(){$('[id="zp_popsvntn"]').remove()})),$("#denyclose").click((function(){$('[id="zp_popsvntn"]').remove()}))},getCourseCard:function(e,t,s,r,l){lmsapprovals.userobj=ZPeople.getUserDetailsById(s),e&&null!=e?(lmscoursedetails.currentCourseData=null,lmsapprovals.requestFor=l,lmsapprovals.batchId=t,lmscourses.currentBatchId=t,document.querySelector('[rel="'+s+"_"+e+'"]')&&document.querySelector('[rel="'+s+"_"+e+'"]').classList.add("disabled"),lmscoursedetails.getCourseDetails(e,1,lmsapprovals.courseCardConstruction)):r&&null!=r&&(document.querySelector('[rel="'+s+"_"+r+'"]')&&document.querySelector('[rel="'+s+"_"+r+'"]').classList.add("disabled"),lmslearningplan.getLearningPlanDetails(r,!1,lmsapprovals.planCardConstruction))},courseCardConstruction:function(e){var t=lmsapprovals.userobj;null==e[1][0].courseLocation&&(e[1][0].courseLocation=""),document.querySelector('[rel="'+t.usererec+"_"+e[1][0].courseId+'"]')&&document.querySelector('[rel="'+t.usererec+"_"+e[1][0].courseId+'"]').classList.remove("disabled");let s=lmsbase.constructMaskv5("",!0);s.setAttribute("rel","approvePopup"),popup=s.appendChild(document.createElement("div")),popup.className="zpl_minr";var r='<div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.lms.approvals.requestinfo")+'</h4></div><a class="_cls PI_cls" onclick="lmsapprovals.closePreview()" id="" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></a></div><div class="zpl_mcnt"><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn M0I"><div><div class="zpl_em"><div class="zpl_emimg"><span class="zpl_pichr PI_book"></span></div><div class="zpl_emdts"><div><em>'+ZPI18N.getString("zp.lms.course.coursename")+"</em></div><div><b>"+e[1][0].courseName+'</b></div></div></div></div><div><div class="zpl_em"><div class="zpl_emimg"><span class="zpl_pichr PI_calendar"></span></div><div class="zpl_emdts"><div><em>'+ZPI18N.getString("zp.date")+"</em></div><div><b>12-10-2023</b></div></div></div></div>";e[1][0].courseLocation&&(r+='<div><div class="zpl_em"><div class="zpl_emimg"><span class="zpl_pichr PI_location"></span></div><div class="zpl_emdts"><div><em>'+ZPI18N.getString("zp.lms.batches.Location")+"</em></div><b>"+e[1][0].courseLocation+"</b></div></div></div>"),r+='<div><div class="zpl_em zpl_desc"><div class="zpl_emimg"><span class="zpl_pichr PI_info M0I"></span></div><div class="zpl_emdts"><div><em>'+ZPI18N.getString("zp.lms.approvals.aboutCourse")+"</em></div><div>"+ZPFeeds.Activity.validateContent(ZPeople.decodeTxt(e[1][0].aboutCourse),!0)+'</div></div></div></div></div><hr class="secnbtmline"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.approvals.Requestedby")+'</label></div><div><div class="zpl_em"><div class="zpl_emimg"><img src="'+t.avatar+'"></div><div class="zpl_emdts"><div><em>'+t.empid+" - </em><b>"+t.name+'</b></div></div></div></div></div><div class="zpl_secn"><div><textarea class="ztextbox" placeholder="Write your comments" id="commentInBox" placeholder="'+ZPI18N.getString("zp.lms.approvals.addComment")+'"></textarea></div>',0==lmsapprovals.requestFor&&(("1"==e[1][0].courseType||"2"==e[1][0].courseType)&&e[1][0].isMangercanenroll||isadmin||lms.settingData[0].settingPermission.isDataAdmin)?r+='<div><div class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick = lmsapprovals.requestApprove(\''+e[1][0].courseId+"','"+t.usererec+"',false)>"+ZPI18N.getString("zp.lms.approvals.Approve")+'</div><div class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick = lmsapprovals.requestDeny(\''+e[1][0].courseId+"','"+t.usererec+"',false)>"+ZPI18N.getString("zp.lms.approvals.Deny")+"</div></div>":1==lmsapprovals.requestFor&&(r+='<div><div class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="lmsapprovals.requestModApprveDeny(\''+e[1][0].courseId+"', '"+lmsapprovals.batchId+"', '"+t.usererec+"', false, 1)\">"+ZPI18N.getString("zp.lms.approvals.Approve")+'</div><div class="zlabel zlabel--red zlabel--medium zlabel--outline"  onclick="lmsapprovals.requestModApprveDeny(\''+e[1][0].courseId+"', '"+lmsapprovals.batchId+"', '"+t.usererec+"', false, 0)\">"+ZPI18N.getString("zp.lms.approvals.Deny")+"</div></div>"),r+="</div></div></div></div>",popup.innerHTML=r},planCardConstruction:function(e){var t=lmsapprovals.userobj;document.querySelector('[rel="'+e[1][0].planInfo.userId+"_"+e[1][0].planInfo.planId+'"]')&&document.querySelector('[rel="'+e[1][0].planInfo.userId+"_"+e[1][0].planInfo.planId+'"]').classList.remove("disabled");let s=lmsbase.constructMaskv5("",!0);s.setAttribute("rel","approvePopup"),popup=s.appendChild(document.createElement("div")),popup.className="zpl_minr";var r='<div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.lms.approvals.requestinfo")+'</h4></div><a class="_cls PI_cls" onclick="lmsapprovals.closePreview()" id="" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></a></div><div class="zpl_mcnt"><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn M0I"><div><div class="zpl_em"><div class="zpl_emimg"><span class="zpl_pichr PI_book"></span></div><div class="zpl_emdts"><div><em>'+ZPI18N.getString("zp.lms.dollar.value.plan.name")+"</em></div><div><b>"+e[1][0].planInfo.planName+"</b></div></div></div></div>";"null"!=e[1][0].planInfo.description&&(r+='<div><div class="zpl_em zpl_desc"><div class="zpl_emimg"><span class="zpl_pichr PI_info M0I"></span></div><div class="zpl_emdts"><div><em>'+ZPI18N.getString("zp.description")+"</em></div><div>"+ZPFeeds.Activity.validateContent(ZPeople.decodeTxt(e[1][0].planInfo.description),!0)+"</div></div></div></div>"),r+='</div><hr class="secnbtmline"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.lms.approvals.Requestedby")+'</label></div><div><div class="zpl_em"><div class="zpl_emimg"><img src="'+t.avatar+'"></div><div class="zpl_emdts"><div><em>'+e[1][0].planInfo.userEmployeeId+" - </em><b>"+e[1][0].planInfo.planOwnerName+'</b></div></div></div></div></div><div class="zpl_secn"><div><textarea class="ztextbox" placeholder="Write your comments" id="commentInBox" placeholder="'+ZPI18N.getString("zp.lms.approvals.addComment")+'"></textarea><div><div class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="lmsapprovals.requestLpModApprveDeny(\''+e[1][0].planInfo.planId+"','"+e[1][0].planInfo.userId+"', false, 1)\">"+ZPI18N.getString("zp.lms.approvals.Approve")+'</div><div class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="lmsapprovals.requestLpModApprveDeny(\''+e[1][0].planInfo.planId+"','"+e[1][0].planInfo.userId+"', false, 0)\">"+ZPI18N.getString("zp.lms.approvals.Deny")+"</div></div></div></div></div></div></div></div>",popup.innerHTML=r},getSuccessMessage:function(e,t,s,r,l,a){$(".zp_msk").html(""),$(".zp_msk").show(),lmsapprovals.mode=0;var n='<div data-modal-box="approvemsg" class="zpl_mdl zpl_malrtmsg zpl_mopen" id="zp_popsvntn"><div class="zpl_minr"><a class="_cls PI_cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'" id="approve_close"></a><div class="zpl_mcnt"><div class="alert_contain"><i class="ico success"></i><div class="cont"><h3>'+ZPI18N.getString("zp.lms.approvals.approvesuccess")+"</h3><p>"+ZPI18N.getString("zp.lms.approvals.conveymsg")+'</p></div><div class="zpl_secn"><div><textarea class="ztextbox" id="cmtToUsr" placeholder="'+ZPI18N.getString("zp.lms.approvals.writeMessage")+'"></textarea></div></div></div></div><div class="zpl_mfoter"><button type="button" class="zlabel zlabel--green zlabel--medium" id="approve_buttn">'+ZPI18N.getString("zp.lms.approvals.send")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" id="approve_cncel">'+ZPI18N.getString("zp.lms.approvals.nothanks")+"</button></div></div></div>";lmsapprovals._relem.querySelector('[_rel="reqList"]').innerHTML+=n,$("#approve_buttn").click((function(){"modcourseapprove"==r?lmsapprovals.requestModApprveDeny(e,s,t,!0,1):"modlpapprove"==r?lmsapprovals.requestLpModApprveDeny(e,t,!0,1):lmsapprovals.requestApprove(e,t,!0,s,r,l,a)})),$("#approve_cncel").click((function(){$('[id="zp_popsvntn"]').remove()})),$("#approve_close").click((function(){$('[id="zp_popsvntn"]').remove()}))},closePopUp:function(e){($('[rel="approvePopup"]')?$('[rel="approvePopup"]').remove():lmsapprovals.closePreview(),lmsapprovals._relem)&&(0==lmsapprovals._relem.querySelector('[_rel="reqList"]').querySelectorAll('[class="zpl_catlst"]').length&&new EmptyPages("zp_nd_approval",ZPI18N.getString("zp.lms.approvals"),ZPI18N.getString("zp.lms.approvalsDesc"),$(lmsapprovals._relem.querySelector('[_rel="reqList"]'))).show())},close:function(){lmsbase.closeMaskv5()},closePreview:function(){lmsbase.closeMaskv5(),document.querySelector('[rel="approvePopup"]')&&document.querySelector('[rel="approvePopup"]').remove()},requestApprove:function(e,t,s,r,l,a,n){var i=s?$("#cmtToUsr")[0].value:$("#commentInBox")[0].value;if(i.indexOf("<")>-1||i.indexOf(">")>-1)ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));else{lmsapprovals.mode=0;lmsapprovals._relem;var o={mode:lmsapprovals.mode,comment:i,courseId:e,batchId:r,user:t,modeOfadd:l};zplms.post("/lms/moderation/enrollment/approve",o,(function(i){1==i[1].status?("frommembers"==l?(lmscoursemembers.updateUserRow("active",a),lmsapprovals.closePopUp(e)):(lmsapprovals.totcount--,lmsapprovals.currentelem?lmsapprovals.currentelem.remove():document.querySelector('[_rel="reqList"]').querySelector('[rel="'+t+"_"+e+'"]').remove(),lmsapprovals.closePopUp(e),$("#zp_popsvntn").remove()),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.approvals.approvesuccessmsg"))):i[1].message==ZPI18N.getString("zp.lms.notapplicableusers")?lmsnotify.show({header:ZPI18N.getString("zp.lms.addmemberalert"),body:ZPI18N.getString("zp.lms.notapplicablemembers"),button_text:ZPI18N.getString("zp.confirm"),texttype:"negative",successCallback:function(){this.status&&lmsapprovals.updateAddReuest(e,t,s,r,l,a,n)},cancelCallback:function(){lmsapprovals.closePopUp(e)}}):(ZPeople.Message.showWarningMsg(i[1].message),lmsapprovals.closePopUp(e)),"frommembers"!==l&&lmsbase.removeClass(lmsapprovals._relem.querySelector('[_rel="approvallist"]'),"zp_disbtn")}))}},updateAddReuest:function(e,t,s,r,l,a,n){lmsapprovals.mode=0;lmsapprovals._relem;var i={mode:lmsapprovals.mode,comment:s?$("#cmtToUsr")[0].value:$("#commentInBox")[0].value,courseId:e,batchId:r,user:t,modeOfadd:"applicablemember"};zplms.post("/lms/moderation/enrollment/approve",i,(function(s){1==s[1].status?("frommembers"==l?(lmscoursemembers.updateUserRow("active",a),lmsapprovals.closePopUp(e)):(lmsapprovals.totcount--,lmsapprovals.currentelem?lmsapprovals.currentelem.remove():document.querySelector('[_rel="reqList"]').querySelector('[_crel="'+e+'"]')&&document.querySelector('[_rel="reqList"]').querySelector('[_urel="'+t+'"]').remove(),lmsapprovals._relem.querySelector('[_rel="courseCount"]').innerHTML=lmsapprovals.totcount+" users selected",lmsapprovals.closePopUp(e),$(".zp_pwrap").remove()),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.approvals.approvesuccessmsg"))):(ZPeople.Message.showWarningMsg(s[1].message),lmsapprovals.closePopUp(e)),"frommembers"!==l&&lmsbase.removeClass(lmsapprovals._relem.querySelector('[_rel="approvallist"]'),"zp_disbtn")}))},requestDeny:function(e,t,s,r,l,a){var n;if("isViaLPCourse"!==a&&(n=s?$("#cmtToUsr")[0].value:$("#commentInBox")[0].value),n.indexOf("<")>-1||n.indexOf(">")>-1)ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));else{lmsapprovals.mode=1;var i={courseId:e,mode:lmsapprovals.mode,user:t,batchId:r};"isViaLPCourse"!==a&&(i.comment=n),zplms.post("/lms/moderation/enrollment/deny",i,(function(s){s[1]?("frommembers"!==a&&(lmsapprovals.totcount--,l?l.remove():document.querySelector('[_rel="reqList"]').querySelector('[_crel="'+e+'"]')&&document.querySelector('[_rel="reqList"]').querySelector('[_urel="'+t+'"]').remove(),$("#zp_popsvntn").remove()),lmsapprovals.closePopUp(e)):(ZPeople.Message.showFailureMsg("You dont have permission to enroll"),lmsapprovals.closePopUp(e)),"frommembers"!==a&&lmsbase.removeClass(lmsapprovals._relem.querySelector('[_rel="approvallist"]'),"zp_disbtn")}))}},requestModApprveDeny:function(e,t,s,r,l){var a=r?$("#cmtToUsr")[0].value:$("#commentInBox")[0].value;if(a.indexOf("<")>-1||a.indexOf(">")>-1)ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));else if(a.length>50)ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.approvals.commentlimit"));else{var n={method:"requestModApproveReject",courseId:e,batchId:t,mode:l,comment:a,user:s};zplms.post("/lms/moderation/course/"+(1===l?"approve":"deny"),n,(function(s){if(1!=s[1]||document.querySelector('[_rel="reqList"]'))if(null!=s[1]&&document.querySelector('[_rel="reqList"]')){""!=t?document.querySelector('[_rel="reqList"]').querySelector('[_brel="'+t+'"]').remove():document.querySelector('[_rel="reqList"]').querySelector('[_crel="'+e+'"]').remove(),lmsapprovals.closePopUp(e),$("#zp_popsvntn").remove(),lmsbase.removeClass(lmsapprovals._relem.querySelector('[_rel="approvallist"]'),"zp_disbtn");n=0==l?ZPI18N.getString("zp.lms.approvals.Denysuccessmsg"):ZPI18N.getString("zp.lms.approvals.approvesuccessmsg");ZPeople.Message.showSuccessMsg(n)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.adminerrormsg")),lmsapprovals.closePopUp(e),lmsbase.removeClass(lmsapprovals._relem.querySelector('[_rel="approvallist"]'),"zp_disbtn");else{document.querySelector('[rel="commentDiv"]').remove();var r=0==l?ZPI18N.getString("zp.rejected"):ZPI18N.getString("zp.approved");document.querySelector('[rel="requestStatus"]').innerHTML=r;var a=0==l?"tl-reject":"tl-success";document.querySelector('[rel="StatusClr"]').classList.remove("tl-wait"),document.querySelector('[rel="StatusClr"]').classList.add(a);var n=0==l?ZPI18N.getString("zp.lms.approvals.Denysuccessmsg"):ZPI18N.getString("zp.lms.approvals.approvesuccessmsg");ZPeople.Message.showSuccessMsg(n)}}))}},requestLpModApprveDeny:function(e,t,s,r){var l=s?$("#cmtToUsr")[0].value:$("#commentInBox")[0].value;if(l.indexOf("<")>-1||l.indexOf(">")>-1)ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude"));else{var a={method:"requestLpModApproveReject",planId:e,mode:r,comment:l,user:t};zplms.post("/lms/moderation/lp/"+(1===r?"approve":"deny"),a,(function(t){if(1!=t[1]||document.querySelector('[_rel="reqList"]'))if(null!=t[1]){document.querySelector('[_rel="reqList"]').querySelector('[_prel="'+e+'"]').remove(),lmsapprovals.closePopUp(e),$("#zp_popsvntn").remove(),lmsbase.removeClass(lmsapprovals._relem.querySelector('[_rel="approvallist"]'),"zp_disbtn");a=0==r?ZPI18N.getString("zp.lms.approvals.Denysuccessmsg"):ZPI18N.getString("zp.lms.approvals.approvesuccessmsg");ZPeople.Message.showSuccessMsg(a)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.adminerrormsg")),lmsapprovals.closePopUp(e),lmsbase.removeClass(lmsapprovals._relem.querySelector('[_rel="approvallist"]'),"zp_disbtn");else{document.querySelector('[rel="commentDiv"]').remove();var s=0==r?ZPI18N.getString("zp.rejected"):ZPI18N.getString("zp.approved");document.querySelector('[rel="requestStatus"]').innerHTML=s;var l=0==r?"tl-reject":"tl-success";document.querySelector('[rel="StatusClr"]').classList.remove("tl-wait"),document.querySelector('[rel="StatusClr"]').classList.add(l);var a=0==r?ZPI18N.getString("zp.lms.approvals.Denysuccessmsg"):ZPI18N.getString("zp.lms.approvals.approvesuccessmsg");ZPeople.Message.showSuccessMsg(a)}}))}},selUser:function(e){$(e).hasClass("IC-cbox")?($(e).find(".IC-cbox").addClass("zp_gclr"),lmsapprovals.count++):($(e).find(".IC-cbox").removeClass("zp_gclr"),lmsapprovals.count--),$(".zp_slctlst").removeClass("DN"),$("#selAll").hasClass("IC-chk-box2")&&$("#selAll").find(".IC-cbox").removeClass("zp_gclr"),lmsapprovals.totcount==lmsapprovals.count&&$("#selAll").hasClass("IC-cbox")&&$("#selAll").find(".IC-cbox").addClass("zp_gclr"),$("#countSelects")[0].innerHTML=lmsapprovals.count+" "+ZPI18N.getString("zp.lms.approvals.userssel"),0==lmsapprovals.count&&$(".zp_slctlst").addClass("DN")},selectAllUsers:function(e){$(e).hasClass("IC-cbox")?($(e).find(".IC-cbox").addClass("zp_gclr"),$("#reqList").find(".IC-cbox").addClass("zp_gclr"),$("#reqList").find("b").each((function(){lmsapprovals.usersobj={};var e=$(this).attr("_selrel");lmsapprovals.usersobj.userId=e,lmsapprovals.usersarr.push(lmsapprovals.usersobj);var t=$(this).attr("_selco");lmsapprovals.coursearr.push(t),$("#countSelects")[0].innerHTML=lmsapprovals.totcount+ZPI18N.getString("zp.lms.approvals.userssel"),lmsapprovals.count=lmsapprovals.totcount}))):($(e).find(".IC-cbox").removeClass("zp_gclr"),$("#reqList").find(".IC-cbox").removeClass("zp_gclr"),lmsapprovals.usersobj={},lmsapprovals.usersarr=[],lmsapprovals.coursearr=[],$("#countSelects")[0].innerHTML="0 "+ZPI18N.getString("zp.lms.approvals.userssel"),lmsapprovals.count=0)},multiApprove:function(e){lmsapprovals.usersarr=[];var t=lmsapprovals._relem.querySelectorAll('[class="IC-cbox zp_gclr"]'),s="";lmsapprovals.coursearr=[];for(var r=0;r<t.length;r++)(s=t[r].closest('[class="zp_Lst"]'))&&(lmsapprovals.usersarr.push(s.getAttribute("_crel")),lmsapprovals.coursearr.push(s.getAttribute("_urel")));usersArr=JSON.stringify(lmsapprovals.usersarr),lmsapprovals.coursearr=JSON.stringify(lmsapprovals.coursearr);var l={method:"multiApprove",usersIds:usersArr,mode:e?1:4,courseIds:lmsapprovals.coursearr};zplms.post("/lmsApprovalAction.zp",l,(function(e){if("Success"==e[1].message){for(var t=e[1].courseIds,s=0;s<t.length;s++)lmsapprovals.totcount--,$("#divid_"+t[s].courseId).remove();$("#countSelects")[0].innerHTML="0 "+ZPI18N.getString("zp.lms.approvals.userssel"),lmsapprovals.count=0;document.getElementById("reqList");if(0==document.querySelectorAll('[id^="divid"]').length)new EmptyPages("zp_nd_approval",ZPI18N.getString("zp.lms.approvals"),ZPI18N.getString("zp.lms.approvalsDesc"),$(lmsapprovals._relem.querySelector('[_rel="reqList"]'))).show()}}))}},lmscourseconfig={selectCourseType:"",initialCourseName:"",initialCourseType:"",fileInfoContent:"",src:null,bannerBGData:{},typeObj:{0:!1,1:!1,2:!1},_abtCoursetemp:'<div><b><span class="size" style="font-size:24px">'+ZPI18N.getString("zp.lms.courseoverview.Whatwillilearn")+'</span></b><span class="size" style="font-size:24px"></span><br></div><div><span class="size" style="font-size:16px">'+ZPI18N.getString("zp.lms.course.courselearn")+'</span><br></div><div><br></div><div><br></div><div><b><span class="size" style="font-size:24px">'+ZPI18N.getString("zp.lms.courseoverview.ABOUTCOURSE")+'</span></b><span class="size" style="font-size:24px"></span><br></div><div><span class="size" style="font-size:16px">'+ZPI18N.getString("zp.lms.course.courseabout")+"</span><br></div><div><br></div>",uploadConfig:{multiple:!0,requiredFileTypes:"image",MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED:50,MAXSIZE:5242880,extension:"jpeg,jpg,png"},showMsk:function(){if($(".zp_msk").length>0)$(".zp_msk").show(),$(".zp_msk").html("");else{$(".zp_msk").remove();$(".main-wrp").append('<div class="zp_msk"></div>')}},showAddCourse:function(){if(lmscourseconfig.clearingVariables(),lmsform.currentFormId=lmsbase.courseFormId,!lmscourseconfig.showAddCourse.triggered)if(lmscourseconfig.showAddCourse.triggered=!0,null==lmscourses.formComponents){var e={formId:lmsbase.courseFormId,mode:"getFormComponents",conreqcsr:csrfToken};$.post("/formAction.zp",e,(function(e){lmscourseconfig.showAddCourse.triggered=!1,lmscourses.formComponents=e.message.formComponentDetails,lmscourses.courseFormComponents=e.message.formComponentDetails,lmscourseconfig.courseInitialFields(structuredClone(lmscourses.formComponents))}))}else lmscourseconfig.showAddCourse.triggered=!1,lmscourseconfig.courseInitialFields(structuredClone(lmscourses.formComponents))},clearingVariables:function(){lmscourses.currentCourseId="",lmscourses.selcourseType="",lmscourses.selcourseSysVal="",lmscourses.updateImage="",lmscourses.currentSectionindex=0,lmscourses.currentSectionId="",lmscourses.formComponents=null,lmsform.editDetails="",lmscourses.currentSectionName="",lmscourses.currentBatchName="",lmscourses.currentBatchId="",lmsbatches.batchData=null,lmscoursedetails.isBatchCreated=""},courseInitialFields:function(e){let t=lmsbase.constructMaskv5("zpl_mcenter").appendChild(document.createElement("div"));t.className="zpl_minr",t.id="formElem",$(t).append(`<div class="zpl_mhder">\n                            <div>\n                                <h4>${ZPI18N.getString("zp.lms.course.coursecreate")}</h4>\n                            </div>\n                            <a class="_cls PI_cls" data-ttip="${ZPI18N.getString("zp.lms.close")}" onclick="lmscourseconfig.closePopup()"></a>\n                        </div>\n                        <div class="zpl_mcnt zpl_fm">\n                        </div>`);let s=addCourseForm.initiate();addCourseForm.formId=lmsbase.courseFormId,$(s).append('<div class="zpl_crd"></div>'),$(t).find(".zpl_mcnt").append(s);let r=document.createElement("div");r.className="zpl_crdcnt";let l=lmsdocument.createElement("div",{class:"zpl_secn"});l.appendChild(addCourseForm.getLabel(e[0].column1[0])),l.appendChild(addCourseForm.insertField(e[0].column1[0],ZPI18N.getString("zp.lms.entercoursename"))),r.appendChild(l);var a=[],n=[];lmscourseconfig.typeObj={0:!1,1:!1,2:!1},(isadmin||lms.settingData[0].settingPermission.isDataAdmin||1==lms.role&&lms.settingData[0].selfData.isTrainerCanAdd||lms.settingData[0].savedConfigData.isUserCanAdd["zp.lms.settings.courseType.self"]||lms.settingData[0].savedConfigData.isUserCanAdd[0])&&lms.selfSettingData.isSelfenable&&(lmscourseconfig.typeObj[0]=!0),(isadmin||lms.settingData[0].settingPermission.isDataAdmin||1==lms.role&&lms.settingData[0].iltData.isTrainerCanAdd||lms.settingData[0].savedConfigData.isUserCanAdd["zp.lms.settings.courseType.ILT"]||lms.settingData[0].savedConfigData.isUserCanAdd[0])&&lms.iltSettingData.isIltenable&&(lmscourseconfig.typeObj[1]=!0),(lms.settingData[0].savedConfigData.isUserCanAdd[0]||1==lms.role&&lms.settingData[0].manualData.isTrainerCanAdd||lms.settingData[0].savedConfigData.isUserCanAdd["zp.lms.settings.courseType.manuals"])&&lms.manualSettingData.isManualenable&&(lmscourseconfig.typeObj[2]=!0),t.className+=0==lmscourseconfig.typeObj[0]&&1==lmscourseconfig.typeObj[1]?" zpl_DNI":"";for(var i=0;i<e[0].column1[1].OptionsWithId.length;i++)lmscourseconfig.typeObj[i]&&(n.push(e[0].column1[1].OptionsWithId[i]),a.push(e[0].column1[1].Options[i]));e[0].column1[1].Options=a,e[0].column1[1].OptionsWithId=n,e[0].column1[1].change=lmscourseconfig.handleTypeChangeTrigger,e[0].column1[1].selectedValue=n[0].Id;let o=lmsdocument.createElement("div",{class:"zpl_secn"});o.appendChild(addCourseForm.getLabel(e[0].column1[1])),o.appendChild(addCourseForm.insertField(e[0].column1[1])),r.appendChild(o),$(t).find(".zpl_crd").append(r),lmsform.formFtr=document.createElement("div"),lmsform.formFtr.className="zpl_mfoter",addCourseForm.setSubmitCallback(lmscourseconfig.initialCourseAddUpdateRecord,{zp_tableName:"P_LMSCourse"}),lmsform.formFtr.appendChild(addCourseForm.getSubmitField(ZPI18N.getString("zp.create"))),$(t).append(lmsform.formFtr),addCourseForm.bind(addCourseForm.formId),lmsbase.addListener(document,"keyup",lmscourseconfig.keyuphandler,!1)},handleTypeChangeTrigger:function(e){e.detail.selectedOptionsData[0].label!=ZPI18N.getString("zp.lms.settings.InstructorLed")||addCourseForm.formElem.querySelector("#batchFields")?addCourseForm.clearFields():lmscourseconfig.getBatchForm()},getBatchForm:function(){if(null==lmscourses.batchFormComponents){var e={formId:lmsbase.courseBatchId,mode:"getFormComponents",conreqcsr:csrfToken};$.post("/formAction.zp",e,(function(e){7e3===e.code&&(lmscourses.batchFormComponents=e.message.formComponentDetails,lmscourseconfig.batchInitialFields(structuredClone(lmscourses.batchFormComponents)),0==lmscourseconfig.typeObj[0]&&1==lmscourseconfig.typeObj[1]&&$("#formElem").removeClass("zpl_DNI"))}))}else lmscourseconfig.batchInitialFields(structuredClone(lmscourses.batchFormComponents)),0==lmscourseconfig.typeObj[0]&&1==lmscourseconfig.typeObj[1]&&$("#formElem").removeClass("zpl_DNI")},batchInitialFields:function(e){addCourseForm.formElem||lmscourseconfig.showAddCourse();let t=addCourseForm.formElem.querySelector(".zpl_crdcnt");addCourseForm.formId=lmsbase.courseBatchId,e[0].column1[6].isMandatory=!0,e[0].column1[14].isMandatory=!0,e[0].column1[6].displayName="Maximum";let s=lmsdocument.createElement("div",{class:"zpl_secn",id:"batchFields"});s.appendChild(addCourseForm.getLabel(e[0].column1[1])),s.appendChild(addCourseForm.insertField(e[0].column1[1],ZPI18N.getString("zp.lms.enterbatchname"))),t.appendChild(s);let r=lmsdocument.createElement("div",{class:"zpl_secnclm",id:"batchFields"}),l=lmsdocument.createElement("div",{class:"zpl_secn"});l.appendChild(addCourseForm.getLabel(e[0].column1[2])),l.appendChild(addCourseForm.insertField(e[0].column1[2])),r.appendChild(l);let a=lmsdocument.createElement("div",{class:"zpl_secn"});a.appendChild(addCourseForm.getLabel(e[0].column1[3])),a.appendChild(addCourseForm.insertField(e[0].column1[3],"",!0)),r.appendChild(a),t.appendChild(r);let n=lmsdocument.createElement("div",{class:"zpl_secn",id:"batchFields"});$(n).append(`<div>\n\t\t\t\t\t\t\t\t\t<h6>${ZPI18N.getString("zp.lms.batches.Capacity")}</h6>\n\t\t\t\t\t\t\t\t</div>`);let i=lmsdocument.createElement("div",{class:"zpl_secnclm",id:"batchCapacity"}),o=lmsdocument.createElement("div",{class:"zpl_secn"});o.appendChild(addCourseForm.getLabel(e[0].column1[14])),o.appendChild(addCourseForm.insertField(e[0].column1[14])),i.appendChild(o);let c=lmsdocument.createElement("div",{class:"zpl_secn"});c.appendChild(addCourseForm.getLabel(e[0].column1[6])),c.appendChild(addCourseForm.insertField(e[0].column1[6])),i.appendChild(c),n.appendChild(i),t.appendChild(n),addCourseForm.setSubmitCallback(lmscourseconfig.updateBatchDetails,{zp_tableName:"P_LMSCourseBatches",lms_Location:"",lms_cancelBatch:!1,lms_waitlistAllow:!1,lms_cancelAfter:""}),addCourseForm.bind(addCourseForm.formId),lmsbase.addListener(addCourseForm.formElem.querySelector("#batchCapacity"),"focusout",lmscourseconfig.validateBatchCapacity,!1)},validateBatchCapacity:function(e){let t=e.target,s="",r="";"lms_minCapacity"==t.getAttribute("name")?(s=t.value,r=addCourseForm.formElem.querySelector("[name='lms_batchCapacity']").value):(s=addCourseForm.formElem.querySelector("[name='lms_minCapacity']").value,r=t.value),""!=s&&""!=r&&s>r&&(addCourseForm.formElem.querySelector("[name='lms_batchCapacity']").value=s)},keyuphandler:function(e){27===e.keyCode&&lmscourseconfig.closePopup()},initialCourseAddUpdateRecord:function(e,t){e.lms_CourseType=lmscourses.formComponents[0].column1[1].OptionsWithId.filter((t=>t.Id==e.lms_CourseType))[0].Value,lmscourses.addCourse=!0,lmscourses.randomImage=Math.floor(Math.random()*Math.floor(44)),lmscourses.randomImage+=1,e.lms_CourseImage=lmscourses.randomImage,e.lms_CourseAdmin=erecno,e.lms_AboutCourse=lmscourseconfig._abtCoursetemp,lmscourseoverview.aboutCourse="";var s=ZPeople.decodeTxt(lmscourses.formComponents[5].column1[0].autofillvalue);if(e.lms_FileCompletedState=s,"Self Paced Learning"==e.lms_CourseType||"zp.lms.settings.SelfPaced"==e.lms_CourseType?e.lms_CourseCompletedState=ZPeople.decodeTxt(lmscourses.formComponents[5].column1[1].Options[1]):e.lms_CourseCompletedState=ZPeople.decodeTxt(lmscourses.formComponents[5].column1[1].Options[0]),""==e.lms_CourseType||null==e.lms_CourseType)return!1;e.lms_moduleCompletedState=ZPeople.decodeTxt(lmscourses.formComponents[5].column1[3].Options[0]),e.lms_Category=lms.defaultCategory.CategoryId,lmscourses.selcourseType=e.lms_CourseType,"Self Paced Learning"==e.lms_CourseType||"Self paced learning"==e.lms_CourseType||"zp.lms.settings.SelfPaced"==e.lms_CourseType?lmscourses.selcourseSysVal="1":"Blended Learning"==e.lms_CourseType||"Blended learning"==e.lms_CourseType||"zp.lms.settings.InstructorLed"==e.lms_CourseType?lmscourses.selcourseSysVal="2":"E-Material"!=e.lms_CourseType&&"E-Material"!=e.lms_CourseType&&"zp.lms.settings.DigitalDownloads"!=e.lms_CourseType||(lmscourses.selcourseSysVal="3");var r=[],l={ids:"1"};if(r.push(l),(l={}).ids="2",r.push(l),(l={}).ids="4",r.push(l),e.lms_WhoCanEnroll=JSON.stringify(r),e.lms_whounenroll=JSON.stringify(r),e.lms_CourseName.length>=100){var a=document.querySelector("[id='lms_msk'] button");a&&(a.style="pointer-events:all;opacity:1.0;"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.exceedmaxlength"))}else $.post("/addUpdateRecord.zp",e,(function(s){lmscoursedetails.currentCourseData=null,$.each(s,(function(s,r){7e3==r.code?(lmsformcomponents.onAllUploadsFinished(),lmscourses.currentCourseId=r.pkId,lmscourseconfig.closePopup(),lmscourses.startIndex=1,lmscoursedetails.disableComponentData=null,t?t.callback(t.params,r.pkId,e.lms_CourseType):(lmscourses.changeOverViewHash(r.pkId,"",e.lms_CourseType,"enable"),lmscourses.constructAddedCourseCard(r.pkId))):(lmsformcomponents.onAllUploadsFinished(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.course.courseaddnotsuccess")))}))}))},updateBatchDetails:function(e,t,s){e.lms_BatchCourseId=lmscourses.currentCourseId,e.courseId=lmscourses.currentCourseId,$.post("/addUpdateRecord.zp",e,(function(r){if("7000"==r[0].code){lmscourses.currentBatchId=r[0].pkId,lmscourses.currentBatchName=e.lms_BatchName,lmsbatches.editDetails=lmsbatches.params;var l=r[0].pkId;lmsbatches.currentBatchData[l]=r[0].batchDetails,lmscourses.currentBatchId=l,"addRecord"==e.zp_mode&&(lmscourses.changeOverViewHash(t,l,s,"2","enable"),lmscourses.constructAddedCourseCard(t,l))}else lmscourseconfig.closePopup(),"addRecord"==e.zp_mode?ZPeople.Message.showFailureMsg("Error while creating the batch"):ZPeople.Message.showFailureMsg("Error while editing the batch")}))},showAddCourseDetails:function(e,t,s){lmscourses.previousSectionIndex=0,lmscourses.currentCourseName=s,lmscourses.getCourseUrl(),"overview"!=e?(lmsform.submitCallback="",$(".zp_msk").hide(),$(".zp_popup").hide(),lmscourseconfig.getCourseDetails("addcourse")):""!=t&&null!=t?lmscourseconfig.getEditFormComponents(t,"initialEdit"):(lmscourses.currentCourseId="",lmscourseconfig.getCourseDetails("initialEdit"))},getEditFormComponents:function(e,t){var s={mode:"fetchSingleRecord",formId:lmsbase.courseFormId,recordId:e,courseId:lmscourses.currentCourseId,isApprovalEnabled:!1,conreqcsr:csrfToken};$.post("/formAction.zp",s,(function(s){lmsform.editDetails=s,lmscourseconfig.getCourseDetails(t,e)}))},getCourseDetails:function(e,t){if(lmsform.currentFormId=lmsbase.courseFormId,null==lmscourses.courseFormComponents){var s={formId:lmsbase.courseFormId,courseId:lmscourses.currentCourseId,mode:"getFormComponents",conreqcsr:csrfToken};$.post("/formAction.zp",s,(function(s){lmscourses.courseFormComponents=s.message.formComponentDetails,lmscourseconfig.getCourseConstructionDetails(e,t)}))}else lmscourseconfig.getCourseConstructionDetails(e,t)},getCourseConstructionDetails:function(e,t){if(lmscourses.getCourseUrl(),lmscourses.blendedFlag=0,lmscourses.selfFlag=0,"initialEdit"==e){var s="";lmsform.editDetails&&(s=lmsform.editDetails.message.recordDetails[0].column1),lmscourses.editValues=s,lmscourseconfig.constructSectionFields(lmscourses.courseFormComponents,s,t)}else lmscourseconfig.constructSectionFields(lmscourses.courseFormComponents,"",t)},getEditOrAddSectionFields:function(e,t,s,r,l){lmscourses.currentSectionindex=e,lmscourses.currentSectionId=t,lmscourses.currentSectionName=ZPeople.decodeTxt(s);var a="";null!=lmsform.editDetails&&""!=lmsform.editDetails&&(a=lmsform.editDetails.message.recordDetails[e].column1,lmscourses.editValues=lmsform.editDetails.message.recordDetails[lmscourses.previousSectionIndex].column1),ZPeople.decodeTxt(s)!=ZPI18N.getString("zp.lms.settings.learningobjectives")?lmscourseconfig.constructSectionFieldsAlert(lmscourses.courseFormComponents,lmscourses.editValues,l,a):lmscoursesetting.initiate()},close:function(){Layout.Page.container.find("#coursegradeview").addClass("DN")},orgInfo:function(e){var t=null;try{t=e.target.closest("li a").innerHTML}catch(e){return}if(null!=t&&null!=t&&0===Layout.Page.container.find("#coursegradeview").length){var s='<div class="zp_pv zp_qpv" id="coursegradeview"><div class="zp_pwrap zp_tab">';s+='<div class="zp_pvhd" id="phead"><div class="zp_mark"><span>'+ZPI18N.getString("zp.lms.orgpolicy")+" </span></div>",s+='<div class="zp_micn"><ul><li id="orgTabClose" onclick="lmscourseconfig.close();"><b class=""><span><i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'"></i></span></b></li></ul></div>',s+="</div>",s+='<div class="zp_pcnt" id=""><div class="zp_orgplcy"><div id="gradingOrg">',s+='<span class="IC-custom" ></span><h2>'+ZPI18N.getString("zp.lms.settings.Grading")+"</h2><ul>",s+="<li>"+ZPI18N.getString("zp.lms.settings.AttendanceM")+" "+lms.iltSettingData.attendanceMark+"% </li>",s+="<li>"+ZPI18N.getString("zp.lms.settings.AssessmentM")+" "+lms.iltSettingData.assesmentMark+"% </li>",s+="<li>"+ZPI18N.getString("zp.lms.course.trainermark")+" "+lms.iltSettingData.trainerMark+"% </li>",s+="</ul></div>";var r={3:ZPI18N.getString("zp.lms.settings.learner"),4:ZPI18N.getString("zp.lms.manager"),5:ZPI18N.getString("zp.lms.learnerandmanager")},l={1:ZPI18N.getString("zp.anytime"),2:ZPI18N.getString("zp.lms.afcoursecom")},a={1:ZPI18N.getString("zp.lms.feedback.trainer"),2:ZPI18N.getString("zp.lms.course"),3:ZPI18N.getString("zp.lms.course&tra")};s+='<div id="feedbackOrg"><span class="IC-country" ></span><h2>'+ZPI18N.getString("zp.lms.base.Feedback")+"</h2><ul>",s+="<li>"+ZPI18N.getString("zp.lms.settings.FeedbackGivenBy")+"- "+r[lms.commonSettingData.feedbackGivenBy]+"</li>",s+="<li>"+ZPI18N.getString("zp.lms.settings.WhenFeedbackGiven")+"- "+l[lms.commonSettingData.whenCanGivenFeeeback]+"</li>",s+="<li>"+ZPI18N.getString("zp.lms.settings.FeedbackAppliedFor")+"- "+a[lms.commonSettingData.feedbackFor]+"</li>",s+="</ul></div>",l={1:ZPI18N.getString("zp.lms.trainer"),2:ZPI18N.getString("zp.lms.admin"),3:ZPI18N.getString("zp.lms.trainerandAdmin"),4:ZPI18N.getString("zp.lms.feedback.manager")},s+='<div id="discussionOrg"><span class="IC-lnk" ></span><h2>'+ZPI18N.getString("zp.lms.base.Discussions")+"</h2><ul>";if(s+="<li>"+ZPI18N.getString("zp.lms.settings.WhostartDiscussion")+"- ",lms.commonSettingData.isCourseAdminStartDisc&&(s+=ZPI18N.getString("zp.lms.courseAdmin")+" "),lms.commonSettingData.isTrainerStartDisc&&(lms.commonSettingData.isCourseAdminStartDisc&&(s+=ZPI18N.getString("zp.lms.and")+" "),s+=ZPI18N.getString("zp.lms.feedback.trainer")),s+="</li>",s+="<li>"+ZPI18N.getString("zp.lms.settings.ViewReports")+"- "+l[lms.commonSettingData.reportsViewFr]+"</li>",s+="</ul></div>",lms.notificationData.hasAnyNotification()){s+='<div id="notificationOrg"><span class="IC-blog" ></span><h2>'+ZPI18N.getString("zp.lms.notificationwhen")+"</h2>",$("#lms").append(s);var n="<ul>";$.each(lms.notificationData.getAllNotifications(),(function(e,t){t.status&&(n+="<li>"+t.displayName+"</li>")})),n+="</ul>",n+="</div></div></div>",$("#notificationOrg").append(n)}if("Grading"==t)var i=document.getElementById("gradingOrg");else if("Feedback"==t)i=document.getElementById("feedbackOrg");else if("Discussion"==t)i=document.getElementById("discussionOrg");else if("Notifications"==t)i=document.getElementById("notificationOrg");i&&i.scrollIntoView()}else Layout.Page.container.find("#coursegradeview").removeClass("DN");$("#orgTabClose").click((function(){$("#coursegradeview").remove()}))},constructSectionFields:function(e,t,s){lmsform.editDetails.message.recordDetails[1].column1;null!=t&&""!=t||(t=[]);var r="",l="";""==lmscourses.currentSectionId?(l=e[0].sectionId,r=0):(r=lmscourses.currentSectionindex,l=lmscourses.currentSectionId),document.getElementById("section"+l)&&document.getElementById("section"+l).remove(),$("#section"+lmscourses.previousSectionId).remove(),$("#section"+lmscourses.sectionId).show(),lmsform.selectMenuArray=[],lmsform.picklist={};var a=document.getElementById("form");$("[_rel=batchpopup]").remove(),a=lmsform.initiate(1),mode="edit",a.innerHTML+=lmsformcomponents.hiddenField("zp_tableName","P_LMSCourse"),a.innerHTML+=lmsformcomponents.hiddenField("zp_formId",lmsbase.courseFormId),""!=s&&null!=s&&""!=lmscourses.currentCourseId?lms.changeHash("ques","addCourseInfo/"+lmscourses.currentCourseId,"disable"):lms.changeHash("ques","addCourseInfo","disable");var n=lmsbase.openQHash(2);if(null!=e)l=e[0].sectionId;document.getElementById("section"+l)&&document.getElementById("section"+l).remove(),lmscourses.currentSectionName!=ZPI18N.getString("zp.lms.settings.managebatches")&&(lmsform.currentFormId=lmsbase.courseFormId),document.createElement("div").className="";var i="";i=""==lmscourses.currentCourseId?ZPI18N.getString("zp.lms.course.coursecreate"):ZPI18N.getString("zp.lms.courseOptions"),$(a).append('<div class ="zp_AClft" id="section'+l+'" _rel="scrollElement"><h5>'+i+"</h5></div>"),lmscourses.previousSectionId=l,$("#zp_pcnt").append(a),n.appendChild(a),null==e&&(e=lmscourses.courseInfoData),""==lmscourses.currentSectionName&&(lmscourses.currentSectionName=ZPI18N.getString("zp.lms.settings.Basics")),null!=lmscourses.courseName&&lmscourses.courseName;var o='<div class="zp_ACrgt">';if(o+='<div class="zp_Attl"><ul class="zp_CPmnu" id="courseSec"></ul></div>',o+='</div><i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'" onclick="lmscourseconfig.closeQHash()"></i>',$(n).append(o),$.each(e,(function(e,r){var l="";""!=r.sectionName&&""==(l=ZPI18N.getString(r.sectionName))&&(l=r.sectionName);var a="";l!==ZPI18N.getString("zp.lms.permissions")||l===ZPI18N.getString("zp.lms.permissions")&&!0===lms.commonSettingData.allowCourseEdit?ZPeople.decodeTxt(sectionName)==ZPI18N.getString("zp.lms.settings.learningobjectives")?a+='<li id="sectionsList_'+r.sectionId+'" _srel="lmslearningObj"><a >'+l+"</a></li>":a+='<li id="sectionsList_'+r.sectionId+'"><a >'+l+"</a></li>":a+='<li class="disbld" id="sectionsList_'+r.sectionId+'"><a >'+l+"</a></li>",$("#courseSec").append(a);var n=document.querySelector('[id="courseSec"]');$("#sectionsList_"+r.sectionId).click((function(a){"sel"!=n.querySelector('[id="sectionsList_'+r.sectionId+'"]').getAttribute("class")&&null!=lmsform.editDetails&&""!=lmsform.editDetails&&(lmscourseconfig.closeAssessmentSettings(a),lmscourseconfig.closeFeedbackSettings(a),lmscourseconfig.closeManagerEvalutionSettings(a),l==ZPI18N.getString("zp.lms.settings.managebatches")&&"2"==lmscourses.selcourseSysVal?(lmscourses.selectSectionName="batch",lmscourses.isBatch=!0,lmscourseconfig.getEditOrAddSectionFields(e,r.sectionId,l,t,s)):l!==ZPI18N.getString("zp.lms.settings.managebatches")&&(lmscourses.selectSectionName="",$($("#courseSec").find("li")[2]).removeClass("disbld"),lmscourseconfig.getEditOrAddSectionFields(e,r.sectionId,l,t,s)))}))})),3!=lmscourses.selcourseSysVal){var c='<li id="sectionsList_gradeCategory" onclick = "lmscourseconfig.closeAssessmentSettings(event); lmscourseconfig.closeFeedbackSettings(event); lmscoursegrade.initiate();"><a>'+ZPI18N.getString("zp.lms.courseSetting.gradeconfiguration")+"</a></li>";$("#courseSec").append(c);c='<li id="sectionsList_courseCertificate" onclick = "lmscourseconfig.closeAssessmentSettings(event); lmscourseconfig.closeFeedbackSettings(event); lmscoursecertificate.initiate()"><a>'+ZPI18N.getString("zp.lms.certificate.Certificates")+"</a></li>";$("#courseSec").append(c);c='<li id="sectionsList_preCourseAssessemnt" ><a>'+ZPI18N.getString("zp.lms.preCourseRequirements.tabName")+"</a></li>";c+='<li id="sectionsList_postCourseAssessemnt" ><a>'+ZPI18N.getString("zp.lms.postCourseRequirements.tabName")+"</a></li>",c+='<li id="sectionsList_managerEvalution" ><a>'+ZPI18N.getString("zp.lms.managerevaluation.ManagerEvaluation")+"</a></li>",c+='<li id="sectionsList_Feedback" ><a>'+ZPI18N.getString("zp.feedback")+"</a></li>",c+='<li id="sectionsList_Cost" ><a>'+ZPI18N.getString("zp.local.Cost")+"</a></li>",c+='<li id="sectionsList_courseAdmins" ><a>'+ZPI18N.getString("zp.lms.courseadmin")+"</a></li>",$("#courseSec").append(c),lmsbase.addListener($("#courseSec #sectionsList_preCourseAssessemnt")[0],"click",(function(e){lmscourseconfig.initAssessmentSettings(0,e)})),lmsbase.addListener($("#courseSec #sectionsList_postCourseAssessemnt")[0],"click",(function(e){lmscourseconfig.initAssessmentSettings(1,e)})),lmsbase.addListener($("#courseSec #sectionsList_managerEvalution")[0],"click",(function(e){lmscourseconfig.initManagerEvalutionSettings(e)})),lmsbase.addListener($("#courseSec #sectionsList_Feedback")[0],"click",(function(e){lmscourseconfig.initFeedbackSettings(e)})),$("#sectionsList_Cost").click((function(){lmscourseconfig.constructCourseCost(event)})),lmsbase.addListener($("#courseSec #sectionsList_courseAdmins")[0],"click",(function(e){lmscourseconfig.initCourseAdminsSettings(e)}))}if($($("#courseSec").find("li")[lmscourses.previousSectionIndex]).removeClass("sel"),$($("#courseSec").find("li")[r]).addClass("sel"),document.getElementById("section"+l).innerHTML+='<div class="zp_STbx"></div>',lmscourses.currentSectionindex=lmscourses.previousSectionIndex,lmscourses.currentSectionName==ZPI18N.getString("zp.lms.settings.Basics")){null!=t[2]&&(lmscourses.isUnlimtcount=t[2].componentValue),null==e[r].column1[9].Options&&(e[r].column1[9].Options=e[r].column1[9].AddOptions),lmscourses.usersOptions=e[r].column1[9].Options;var d="";if(""!=lmscourseconfig.initialCourseName&&null==lmsform.editDetails||""==lmsform.editDetails){var m=e[r].column1[0].formComponentId;d={componentName:"lms_CourseName",componentType:"1",componentValue:lmscourseconfig.initialCourseName,displayName:"Course Admin",formComponentId:m,isEditable:!0}}else d=t[0];var u="";if(""!=lmscourseconfig.initialCourseType&&null==lmsform.editDetails||""==lmsform.editDetails){m=e[r].column1[1].formComponentId;u={componentName:"lms_CourseType",componentValue_ID:"",componentType:"25",componentValue:lmscourseconfig.initialCourseType,displayType:"102",displayName:"Training Type",formComponentId:m,isEditable:!0}}else u=t[1];$(".zp_STbx").html(""),lmscourses.previousSectionIndex=r;""!=lmscourses.currentCourseId&&2,null!=t[3]&&""!=t[3].componentValue||0!=e[r].column1[3].Options.length&&(t[3]={componentName:"lms_Category",componentType:26,componentValue:lmsFormConstants.getValue(lms.defaultCategory.CategoryName),componentValue_ID:lms.defaultCategory.CategoryId.toString(),displayName:"Category",displayType:100,formComponentId:e[r].column1[3].formComponentId,isEditable:!0}),lmsform.selectMenuArray[e[r].column1[3].formComponentId]=e[r].column1[3].Options,null!=d&&(lmscourses.currentCourseName=d.componentValue),null!=u&&(lmscourses.selcourseType=u.componentValue,"Self Paced Learning"==u.componentValue||"Self paced learning"==u.componentValue||"zp.lms.settings.SelfPaced"==u.componentValue?lmscourses.selcourseSysVal="1":"Blended Learning"==u.componentValue||"Blended learning"==u.componentValue||"zp.lms.settings.InstructorLed"==u.componentValue?lmscourses.selcourseSysVal="2":"E-Material"!=u.componentValue&&"E-Material"!=u.componentValue&&"zp.lms.settings.DigitalDownloads"!=u.componentValue||(lmscourses.selcourseSysVal="3"));var p="";""!=e[r].sectionName&&""==(p=ZPI18N.getString(e[r].sectionName))&&(p=e[r].sectionName);o='<header><h2 id="header_sec">'+p+"</h2></header>";u.displayName=u.componentValue,o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[0],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.CourseName")+'</p></div><div class="zp_Sm">'+lmsform.insertField(e[r].column1[0],"","","",d,"","",1)+"</div></div>",o+='<div class="zp_STfld zp_op6" id="courseTypeOpn"><div>'+lmsformcomponents.labelName(e[r].column1[1],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.TrainingType")+'</p></div><div class="zp_Sm zp_nobr"><div>'+lmsformcomponents.labelName(u,"span")+"</div></div></div>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[3],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.Category")+"</p></div>"+lmsform.insertField(e[r].column1[3],"","","",t[3],"","zp_Sm")+"</div>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[4],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.Duration")+'</p></div><div class="zp_Sm zp_cs4"><div>'+lmsform.insertField(e[r].column1[4],"","","",t[4])+"</div></div>"+lmsform.insertField(e[r].column1[5],"","","",t[5],"disabled","zp_Sm zp_cs4",1)+"</div>","3"!==lmscourses.selcourseSysVal&&(o+='<div class="zp_STfld" ><div>'+lmsformcomponents.labelName(e[r].column1[6],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.CourseCode")+'</p></div><div class="zp_Sm" _rel="courseCode">'+lmsform.insertField(e[r].column1[6],"","","",t[6])+"</div></div>"),e[r].column1[7].maxlength=250,o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[7],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.Description")+'</p></div><div class="zp_Sm">'+lmsform.insertField(e[r].column1[7],"","","",t[7])+"</div></div>";var g="";if(null==t[9]){var f="";$.each(lmscourses.usersOptions,(function(e,t){t.Id==erecno&&(f=[t.Value])}));m=e[r].column1[9].formComponentId;g={componentName:"lms_CourseAdmin",componentType:"26",componentValue:f,componentValue_ID:erecno,displayName:"Course Admin",displayType:"100",formComponentId:m,isEditable:!0,isMandatory:!0}}else{g=t[9];for(var v=0;v<lmscourses.usersOptions.length;v++)if(lmscourses.usersOptions[v].Id==t[9].componentValue_ID){t[9].componentValue=lmscourses.usersOptions[v].Value;break}}for(var h="",b=0;b<g.componentValue_ID.length;b++)h+=b==g.componentValue_ID.length-1?g.componentValue_ID[b]:g.componentValue_ID[b]+";";e[r].column1[9].isMandatory=!0,lmscourses.editCourseAdmin=h,null!=lmsform.editDetails&&""!=lmsform.editDetails&&lms.commonSettingData.allowPublishUrl&&(o+='<div><div class="zp_Ldtl"><p>'+ZPI18N.getString("zp.lms.settings.sharableurl")+"</p><span>"+ZPI18N.getString("zp.lms.course.sharableurl")+'</span><div id="" class=" zp_Sm"><div class="zp_urlcpy nobdr"><b id="courseUrl">'+lmscourses.getUrl+'</b><em onclick="lmssettings.copyUrl(1)">'+ZPI18N.getString("zp.lms.settings.copyurl")+"</em></div></div></div></div>"),o+='<div class="zp_btn">'+lmsform.insertField("submit",lmscourseconfig.updateCourseInfo,ZPI18N.getString("zp.lms.save"))+"</div>",$(".zp_STbx").append(o),"2"==lmscourses.selcourseSysVal&&$("#isAllowregister").show(),lms.selfSettingData.isSelfenable||$("#section"+l).find("[fieldval=1]").parent("li").remove(),lms.iltSettingData.isIltenable||$("#section"+l).find("[fieldval=2]").parent("li").remove(),lms.manualSettingData.isManualenable||$("#section"+l).find("[fieldval=3]").parent("li").remove()}else if(lmscourses.currentSectionName==ZPI18N.getString("zp.lms.settings.learningobjectives")){lmscourses.previousSectionIndex=r;var I=lmscourseconfig.getSkillOptions(e[r].column1[0]),y=lmscourseconfig.getSkillOptions(e[r].column1[3]);if(lmscourses.skillData&&0!=lmscourses.skillData.length)for(v=0;v<lmscourses.skillData.length;v++)t[0].componentValue_ID==lmscourses.skillData[v].skillsId&&(t[0].componentValue=lmscourses.skillData[v].skillsName),t[3].componentValue_ID==lmscourses.skillData[v].skillsId&&(t[3].componentValue=lmscourses.skillData[v].skillsName);e[r].column1[2].isMandatory=!0,$(".zp_STbx").html("");p="";""!=e[r].sectionName&&""==(p=ZPI18N.getString(e[r].sectionName))&&(p=e[r].sectionName);o='<header><h2 id="header_sec">'+p+"</h2></header>";"3"!==lmscourses.selcourseSysVal&&(o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[0],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.Prerequisites")+"</p></div>"+lmsform.insertField(I,"","","",t[0],"disabled","zp_Sm zp_cs4",1,ZPI18N.getString("zp.lms.Skill"))+" "+lmsform.insertField(e[r].column1[5],"","","",t[5],"disabled","zp_Sm zp_cs4",1,ZPI18N.getString("zp.lms.Levels"))+"</div>"),"3"!==lmscourses.selcourseSysVal&&(o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[3],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.Outcomes")+"</p></div>"+lmsform.insertField(y,"","","",t[3],"disabled","zp_Sm zp_cs4",1,ZPI18N.getString("zp.lms.Skill"))+" "+lmsform.insertField(e[r].column1[4],"","","",t[4],"disabled","zp_Sm zp_cs4",1,ZPI18N.getString("zp.lms.Levels"))+"</div>"),o+='<div class="zp_btn">'+lmsform.insertField("submit",lmscourseconfig.updateCourseInfo,ZPI18N.getString("zp.lms.save"))+"</div>",$(".zp_STbx").append(o)}else if(lmscourses.currentSectionName==ZPI18N.getString("zp.lms.settings.managebatches"))lmsform.currentFormId=lmsbase.courseBatchId,lmscourses.previousSectionIndex=r,lmsbatches.params="",lmsbatches.editDetails="",$(".zp_STbx").attr("id","coursebatch"),$("#coursebatch").removeClass("zp_STbx"),manageBatch.initiate(l);else if(lmscourses.currentSectionName==ZPI18N.getString("zp.lms.settings.applicableto")&&"3"!==lmscourses.selcourseSysVal){lmscourses.previousSectionIndex=r;p="";""!=e[r].sectionName&&""==(p=ZPI18N.getString(e[r].sectionName))&&(p=e[r].sectionName);o='<header><h2 id="header_sec">'+p+"</h2></header>";o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[0],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.Department")+"</p></div>"+lmsform.insertField(e[r].column1[0],"","",1,t[0],"disabled","zp_Sm")+"</div></div>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[1],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.Desgination")+"</p></div>"+lmsform.insertField(e[r].column1[1],"","",1,t[1],"disabled","zp_Sm")+"</div>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[2],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.Location")+"</p></div>"+lmsform.insertField(e[r].column1[2],"","",1,t[2],"disabled","zp_Sm")+"</div>",o+='<font class="zp_Fopt">'+ZPI18N.getString("zp.lms.course.OR")+"</font>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[3],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.SuggestUsers")+"</p></div>"+lmsform.insertField(e[r].column1[3],"","",1,t[3],"disabled","zp_Sm")+"</div>",o+='<div class="zp_btn">'+lmsform.insertField("submit",lmscourseconfig.updateCourseInfo,ZPI18N.getString("zp.lms.save"))+"</div>",lmscourseapplicable.editApplicableIds=[],lmscourseapplicable.getApplicableRules()}else if(lmscourses.currentSectionName==ZPI18N.getString("zp.lms.permissions")&&"3"!==lmscourses.selcourseSysVal){lmscourses.previousSectionIndex=r;var _=JSON.parse(JSON.stringify(e[r].column1));_[1].Options=[],_[1].OptionsWithId=[],_[0].Options=[],_[0].OptionsWithId=[];p="";""!=e[r].sectionName&&""==(p=ZPI18N.getString(e[r].sectionName))&&(p=e[r].sectionName);var S=lmscourses.selcourseSysVal;"2"!=lmscourses.selcourseSysVal?(lmscourses.blendedFlag||(_[1].Options.push(e[r].column1[1].Options[1]),_[1].Options.push(e[r].column1[1].Options[3]),_[1].OptionsWithId.push(e[r].column1[1].OptionsWithId[1]),_[1].OptionsWithId.push(e[r].column1[1].OptionsWithId[3])),""==t[0].componentValue&&(t[0].componentValue=e[r].column1[0].Options[parseInt(lms.selfSettingData.fileCompleteOn)-1]),""==t[1].componentValue&&(t[1].componentValue=e[r].column1[1].Options[parseInt(lms.selfSettingData.courseCompleteOn)-1])):(lmscourses.selfFlag||(_[1].Options.push(e[r].column1[1].Options[0]),_[1].Options.push(e[r].column1[1].Options[2]),_[1].OptionsWithId.push(e[r].column1[1].OptionsWithId[0]),_[1].OptionsWithId.push(e[r].column1[1].OptionsWithId[2])),""==t[0].componentValue&&(t[0].componentValue=e[r].column1[0].Options[parseInt(lms.iltSettingData.fileCompleteOn)-1]),""==t[1].componentValue&&(t[1].componentValue=e[r].column1[1].Options[parseInt(lms.iltSettingData.courseCompleteOn)-1])),"1"==S&&(t[1].componentValue_ID=e[r].column1[1].OptionsWithId[1].Id,t[1].componentValue=e[r].column1[1].OptionsWithId[1].Value),_[0].Options.push(e[r].column1[0].Options[0]),_[0].Options.push(e[r].column1[0].Options[1]),_[0].OptionsWithId.push(e[r].column1[0].OptionsWithId[0]),_[0].OptionsWithId.push(e[r].column1[0].OptionsWithId[1]),$(".zp_STbx").html("");o='<header><h2 id="header_sec">'+p+"</h2></header>";o+="<header><h2>"+ZPI18N.getString("zp.lms.settings.Enroll")+"</h2> </header>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[2],"h4")+"<p>"+ZPI18N.getString("zp.lms.settings.WhocanRegisterD")+"</p></div>",array=[],array.push(ZPI18N.getString("zp.admin")),array.push(ZPI18N.getString("zp.lms.courseadmin")),array.push(ZPI18N.getString("zp.lms.feedback.manager")),array.push(ZPI18N.getString("zp.lms.settings.learner")),o+='<div class="zp_Sm zp_nobr"><div><ul id="courseenroll">'+lmscourseconfig.checkBoxConstruction(array,ZPeople.decodeTxt(t[2].componentValue))+"</ul></div></div></div>",o+="<header><h2>"+ZPI18N.getString("zp.lms.settings.Unenroll")+"</h2> </header>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[4],"h4")+"<p>"+ZPI18N.getString("zp.lms.settings.WhocanUnregisterD")+"</p></div>",array=[],array.push(ZPI18N.getString("zp.admin")),array.push(ZPI18N.getString("zp.lms.courseadmin")),array.push(ZPI18N.getString("zp.lms.feedback.manager")),array.push(ZPI18N.getString("zp.lms.settings.learner")),o+='<div class="zp_Sm zp_nobr"><div><ul id="courseunenroll">'+lmscourseconfig.checkBoxConstruction(array,ZPeople.decodeTxt(t[5].componentValue))+"</ul></div></div></div>",o+="<header><h2>Completion</h2> </header>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(_[0],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.FileComplete")+"</p></div>"+lmsform.insertField(_[0],"","",1,t[0],"disabled","zp_Sm",1)+"</div>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(_[1],"h4")+"<p>"+ZPI18N.getString("zp.lms.course.batchCompleteon")+"</p></div>"+lmsform.insertField(_[1],"","",1,t[1],"disabled","zp_Sm"+("1"==S?" disabled":""),1)+"</div>",o+='<div class="zp_STfld"><div>'+lmsformcomponents.labelName(e[r].column1[3],"h4")+"<p>"+ZPI18N.getString("zp.lms.modulecompletedstate")+"</p></div>"+lmsform.insertField(e[r].column1[3],"","",1,t[4],"disabled","zp_Sm disabled",1)+"</div>","2"==lmscourses.selcourseSysVal&&(o+='<div><div class="zp_Ldtl"><p>'+ZPI18N.getString("zp.lms.course.AllowedSections")+"</p><span>"+ZPI18N.getString("zp.lms.course.AllowedSectionsD")+'</span><div class="zp_Sm "><ul id="coursetabsel">');for(v=0;v<lmscourses.componentTabs.length;v++)tabName=lmsform.changetoI18N(lmscourses.componentTabs[v].tabName),"2"!=lmscourses.selcourseSysVal||"Files"!=tabName&&"Sessions"!=tabName||(o+='<li  name="checkTab"><i class="IC-cbox zp_gclr" id="li_'+lmscourses.componentTabs[v].tabId+'" _rel="'+lmscourses.componentTabs[v].tabId+'"></i><span>'+tabName+"</span></li>");o+="</ul></div></div></div>",o+='<div class="zp_btn">'+lmsform.insertField("submit",lmscourseconfig.updateCourseInfo,ZPI18N.getString("zp.save"))+"</div>",$(".zp_STbx").append(o);var C=location.hash.split("?")[0].split("/");C.shift(),$('[name="checkBox"]').click((function(){lmssettings.checkBoxselect(this)})),$('[name="checkTab"]').click((function(){var e=this.querySelector("span").innerText;if("Overview"!=e){var t="",s=0;$("#coursetabsel").find("i.IC-cbox.zp_gclr").each((function(){if(this.nextSibling.innerText==e)return!1;t=this.nextSibling.innerText})),$(this.querySelector("i")).hasClass("zp_gclr")?(s=1,$(this.querySelector("i")).removeClass("zp_gclr")):(s=0,$(this.querySelector("i")).addClass("zp_gclr"));for(var r=document.getElementById("coursetabsel").querySelectorAll('[class="IC-cbox"]'),l=[],a=0;a<r.length;a++){var n={};n.ids=r[a].getAttribute("_rel")+"",l.push(n)}var i=JSON.stringify(l),o={method:"updateComponentTabs",courseId:lmscourses.currentCourseId,courseTabIds:i,conreqcsr:csrfToken};$.post("/courseAction.zp",o,(function(r){if(null!=r[1]){lmscoursedetails.disableComponentData=null;var l=C[C.length-1].toUpperCase();if(l.includes("ROLE")&&(l="FEEDBACK",C.pop()),e=e.toUpperCase(),l.includes(e)&&s)C.pop(),C.push(t.toLowerCase());else;}}))}else ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.courseoverview.overviewdisabled"))}));var P={method:"getDisabledComponentTabs",courseId:lmscourses.currentCourseId,conreqcsr:csrfToken};$.post("/courseAction.zp",P,(function(e){var t=e[1].DisabledTabs;if(lmscoursedetails.disableComponentData=e,0!=t.length)for(var s=0;s<t.length;s++)$("#li_"+t[s].ids).removeClass("zp_gclr")}))}else if(lmscourses.currentSectionName==ZPI18N.getString("zp.lms.settings.Branding")){p="";""!=e[r].sectionName&&""==(p=ZPI18N.getString(e[r].sectionName))&&(p=e[r].sectionName),lmscourses.previousSectionIndex=r;o='<header><h2 id="header_sec">'+p+"</h2></header>";var z,N=1;""!=lmscourses.updateImage&&(N=lmscourses.updateImage),lmscoursedetails.currentCourseData&&lmscoursedetails.currentCourseData[0].courseImageInfo.isSystemImage?z=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+N+".svg"):null===lmscoursedetails.currentCourseData||lmscoursedetails.currentCourseData[0].courseImageInfo.isSystemImage||(lmscoursedetails.currentCourseData[0].courseImageInfo.additionalInfo={fileId:lmscoursedetails.currentCourseData[0].courseId,type:6},z=lmsfileaction.generateSourceURL(lmscoursedetails.currentCourseData[0].courseImageInfo)),o+='<div><div class="zp_brnd">',o+='<div class="zp_BGupld" rel="courseImg" attachmentTab>',o+='<div class="zp_Bgupd"><div class="zp_cropimg" attachmentList><img src="'+z+'" alt="" id="brandingImage"></div></div>',o+='<div id="courseButtons"><h4>'+ZPI18N.getString("zp.lms.courseImage")+"</h4><p>"+ZPI18N.getString("zp.lms.course.courseimg")+"</p>",o+='<div class="zp_btn"><button class="zpthm" onclick="lmscourseconfig.getBrandingPopup();">'+ZPI18N.getString("zp.lms.SystemImage")+"</button>",o+='<button class="zpthm" _rel="attach" action="local" style="" class="btn" id="imgUpload">'+ZPI18N.getString("zp.lms.customImage")+"</button>",o+='</div><div class="zp_hint"><b>'+ZPI18N.getString("zp.note")+" :</b><span>"+ZPI18N.getString("zp.lms.course.courseimgnote")+"</span></div>",o+="</div></div>",lmscourseconfig.bannerBGData.clrId=lmscoursedetails.currentCourseData[0].bannerBGData.clrId,lmscourseconfig.bannerBGData.patternId=lmscoursedetails.currentCourseData[0].bannerBGData.patternId,o+='<div class="zp_BGupld"><div class="zp_Bgupd"><div class="zp_Phdr Cbg'+lmscourseconfig.bannerBGData.clrId+" Cpt"+lmscourseconfig.bannerBGData.patternId+' model" rel="clrPreview"><div class="ZP_img" style=""></div><div class="zp_PhdrDtl"><label class="zp_datlod"></label></div></div></div><div rel="bannerElem"><h4>'+ZPI18N.getString("zp.bgclr")+'</h4><div class="zp_Sm smbx bgsel" rel="clrElem"></div><h4>'+ZPI18N.getString("zp.lms.bgpattern")+'</h4><div class="zp_Sm smbx bgsel" rel="patternElem"></div></div></div>',null!=lmscourses.selcourseSysVal&&"3"!==lmscourses.selcourseSysVal&&(o+='<div class="zp_Attl">'+lmsformcomponents.labelName(e[r].column1[2])+lmsform.insertField(e[r].column1[2],"","","",t[2])+"</div>"),o+="</div></div>",o+='<div class="zp_btn">'+lmsform.insertField("submit",lmscourseconfig.updateCourseInfo,ZPI18N.getString("zp.lms.save"))+"</div>",$(".zp_STbx").append(o),lmscourseconfig.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="bannerElem"]')),lmscourseconfig.menuConstruction(document.querySelector('[rel="clrElem"]'),"clrElem"),lmscourseconfig.menuConstruction(document.querySelector('[rel="patternElem"]'),"patternElem",lmscourseconfig.bannerBGData.clrId);var T={method:"getLMSComponents",conreqcsr:csrfToken};$.post("/courseAction.zp",T,(function(e){lmscourses.previousSectionIndex=r,$.each(e[1],(function(e,t){var s="";1==t.compStatus&&(s="zp_gclr"),"Rating"!=t.compName&&"Feedback"!=t.compName&&"Grade"!=t.compName?$("#compList").append('<li><i class="IC-chk-box2 '+s+'"></i><span>'+t.compName+"</span></li>"):$("#shwlist").append('<li><i class="IC-chk-box2 '+s+'"></i><span>'+t.compName+"</span></li>")}))})),lmscourseconfig.invokeUploadManager()}lmsformcomponents.bind($(".zp_STbx")[0]),lmscourses.previousSectionId=l,lmscourses.smode&&lmscourses.currentCourseId&&lmscourses.getEditCourseDetails(lmscourses.currentCourseId),null!=lmscourses.selcourseSysVal&&"3"==lmscourses.selcourseSysVal?($($("#courseSec").find("li")[5]).addClass("disbld"),$($("#courseSec").find("li")[2]).addClass("disbld")):lms.commonSettingData.allowCourseEdit&&$($("#courseSec").find("li")[5]).removeClass("disbld"),""!=lmsform.editDetails&&null!=lmsform.editDetails||($($("#courseSec").find("li")[1]).addClass("disbld"),$($("#courseSec").find("li")[2]).addClass("disbld"),$($("#courseSec").find("li")[3]).addClass("disbld"),$($("#courseSec").find("li")[4]).addClass("disbld"),$($("#courseSec").find("li")[5]).addClass("disbld")),"1"!=lmscourses.selcourseSysVal&&"3"!=lmscourses.selcourseSysVal||($($("#courseSec").find("li")[2]).remove(),"3"==lmscourses.selcourseSysVal&&($($("#courseSec").find("li")[2]).remove(),$($("#courseSec").find("li")[1]).remove(),$($("#courseSec").find("li")[4]).remove(),$($("#courseSec").find("li")[2]).remove()))},getSkillOptions:function(e){var t=e;if(t.Options=[],t.OptionsWithId={},null!=lmscourses.skillData&&"no_skills"!=lmscourses.skillData[0].msg&&lmscourses.skillData.length>0)for(i=0;i<lmscourses.skillData.length;i++)t.OptionsWithId[i]={Id:lmscourses.skillData[i].skillsId,SysValue:i+1,Value:lmscourses.skillData[i].skillsName},t.Options[i]={Id:lmscourses.skillData[i].skillsId,Value:lmscourses.skillData[i].skillsName};return t.fieldType=26,t},menuConstruction:function(e,t,s){var r={},l={};if("clrElem"==t)(a=[]).push(ZPI18N.getString("zp.lms.yellow")),a.push("bgbx Cbg1"),r[1]=a,(n=[]).push(ZPI18N.getString("zp.lms.blue")),n.push("bgbx Cbg2"),r[2]=n,(i=[]).push(ZPI18N.getString("zp.lms.green")),i.push("bgbx Cbg3"),r[3]=i,(o=[]).push(ZPI18N.getString("zp.lms.red")),o.push("bgbx Cbg4"),r[4]=o,(c=[]).push(ZPI18N.getString("zp.lms.rose")),c.push("bgbx Cbg5"),r[5]=c,(d=[]).push(ZPI18N.getString("zp.lms.purple")),d.push("bgbx Cbg6"),r[6]=d,(m=[]).push(ZPI18N.getString("zp.lms.oceangreen")),m.push("bgbx Cbg7"),r[7]=m,(u=[]).push(ZPI18N.getString("zp.lms.lightblue")),u.push("bgbx Cbg8"),r[8]=u,(p=[]).push(ZPI18N.getString("zp.lms.brown")),p.push("bgbx Cbg9"),r[9]=p,(g=[]).push(ZPI18N.getString("zp.lms.grey")),g.push("bgbx Cbg10"),r[10]=g,l[0]=r[lmscourseconfig.bannerBGData.clrId],lmscourseconfig.createMenu(r,e,"clr_Menu",l,lmscourseconfig.clrOrPatternChange);else if("patternElem"==t){var a,n,i,o,c,d,m,u,p,g;(a=[]).push(ZPI18N.getString("zp.lms.hatch")),a.push("bgbx Cbg"+s+" Cpt1"),r[1]=a,(n=[]).push(ZPI18N.getString("zp.lms.wood")),n.push("bgbx Cbg"+s+" Cpt2"),r[2]=n,(i=[]).push(ZPI18N.getString("zp.lms.verticalwaves")),i.push("bgbx Cbg"+s+" Cpt3"),r[3]=i,(o=[]).push(ZPI18N.getString("zp.lms.checked")),o.push("bgbx Cbg"+s+" Cpt4"),r[4]=o,(c=[]).push(ZPI18N.getString("zp.lms.diagonalsquares")),c.push("bgbx Cbg"+s+" Cpt5"),r[5]=c,(d=[]).push(ZPI18N.getString("zp.lms.tiles")),d.push("bgbx Cbg"+s+" Cpt6"),r[6]=d,(m=[]).push(ZPI18N.getString("zp.lms.net")),m.push("bgbx Cbg"+s+" Cpt7"),r[7]=m,(u=[]).push(ZPI18N.getString("zp.lms.circles")),u.push("bgbx Cbg"+s+" Cpt8"),r[8]=u,(p=[]).push(ZPI18N.getString("zp.lms.horizontalwaves")),p.push("bgbx Cbg"+s+" Cpt9"),r[9]=p,(g=[]).push(ZPI18N.getString("zp.lms.fabricstyle")),g.push("bgbx Cbg"+s+" Cpt10"),r[10]=g,l[0]=r[lmscourseconfig.bannerBGData.patternId],lmscourseconfig.createMenu(r,e,"pattern_Menu",l,lmscourseconfig.clrOrPatternChange)}else if("courseAdminsElem"==t||"courseAdminsHTMLElem"==t&&lmscoursedetails.currentCourseData[0].courseAdmintabInfo[e.getAttribute("rel").split("_")[1]]){var f=[];f.push(ZPI18N.getString("zp.all")),r[0]=f;var v="";if("courseAdminsHTMLElem"==t){var h=JSON.parse(lmscoursedetails.currentCourseData[0].courseAdmintabInfo[e.getAttribute("rel").split("_")[1]].tabIds),b="",I=[],y=!0;h.includes("0")&&(b=b.concat(ZPI18N.getString("zp.all")),y=!1,v+="0|");for(var _=0;_<lmscourses.componentTabs.length;_++)f=[],("zp.lms.component.display_name.sessions"==lmscourses.componentTabs[_].tabName&&2==lmscourses.selcourseSysVal||"zp.lms.component.display_name.sessions"!=lmscourses.componentTabs[_].tabName&&"zp.lms.component.display_name.rating"!=lmscourses.componentTabs[_].tabName&&"zp.lms.component.display_name.grade"!=lmscourses.componentTabs[_].tabName)&&(f.push(lmsform.changetoI18N(lmscourses.componentTabs[_].tabName)),r[lmscourses.componentTabs[_].tabId]=f,h.includes(lmscourses.componentTabs[_].tabId)&&(h.includes("0")||(b=y?b.concat(lmsform.changetoI18N(lmscourses.componentTabs[_].tabName)):b.concat(", "+lmsform.changetoI18N(lmscourses.componentTabs[_].tabName)),y&&(y=!1)),v+=lmscourses.componentTabs[_].tabId+"|"));I[0]=b,l[v]=I,lmscourseconfig.createMenu(r,e,"courseadmins_Menu",l,lmscourseconfig.saveCourseAdmins)}else{for(_=0;_<lmscourses.componentTabs.length;_++)("zp.lms.component.display_name.sessions"==lmscourses.componentTabs[_].tabName&&2==lmscourses.selcourseSysVal||"zp.lms.component.display_name.sessions"!=lmscourses.componentTabs[_].tabName&&"zp.lms.component.display_name.rating"!=lmscourses.componentTabs[_].tabName&&"zp.lms.component.display_name.grade"!=lmscourses.componentTabs[_].tabName)&&((f=[]).push(lmsform.changetoI18N(lmscourses.componentTabs[_].tabName)),r[lmscourses.componentTabs[_].tabId]=f);l[0]=r[0],lmscourseconfig.createMenu(r,e,"courseadmins_Menu",l)}}},createMenu:function(e,t,s,r,l){"courseadmins_Menu"==s?(lmscourseconfig.menuObj.insertMenu({elem:t,type:"select",mode:"single",allow_new:!1,menutype:3,menulist:e,click:l}),lmsmenu.changeToSelectMenu(t,r,"single",null,r[0])):"sortElem"==s?(lmscourseconfig.menuObj.insertMenu({elem:t,type:"select",mode:"single",allow_new:!1,menulist:e,click:l}),lmsmenu.changeToSelectMenu(t,r,"single",null,r[0])):(lmscourseconfig.menuObj.insertMenu({elem:t,type:"select",mode:"single",menulist:e,click:l}),lmsmenu.changeToSelectMenu(t,r,"single",r[0][1],r[0][0]))},clrOrPatternChange:function(e,t,s,r){if(null!=e&&"clrElem"==e.referObj.elem.getAttribute("rel")||"clrElem"==t){null!=e&&"clrElem"==e.referObj.elem.getAttribute("rel")?s=e.value:(document.querySelector('[rel="clrPreview"]').classList.remove("Cpt"+lmscourseconfig.bannerBGData.patternId),document.querySelector('[rel="clrPreview"]').classList.add("Cpt"+r),lmscourseconfig.bannerBGData.patternId=r,lmscoursedetails.currentCourseData[0].bannerBGData.clrId=s,lmscoursedetails.currentCourseData[0].bannerBGData.patternId=r),document.querySelector('[rel="clrPreview"]').classList.remove("Cbg"+lmscourseconfig.bannerBGData.clrId),document.querySelector('[rel="clrPreview"]').classList.add("Cbg"+s),lmscourseconfig.bannerBGData.clrId=s,document.querySelector('[rel="bannerElem"]').innerHTML="";var l="<h4>"+ZPI18N.getString("zp.bgclr")+'</h4><div class="zp_Sm smbx bgsel" rel="clrElem"></div><h4>'+ZPI18N.getString("zp.lms.bgpattern")+'</h4><div class="zp_Sm smbx bgsel" rel="patternElem"></div>';$('[rel="bannerElem"]').append(l),lmscourseconfig.menuConstruction(document.querySelector('[rel="clrElem"]'),"clrElem"),lmscourseconfig.menuConstruction(document.querySelector('[rel="patternElem"]'),"patternElem",s)}else{document.querySelector('[rel="clrPreview"]').classList.remove("Cpt"+lmscourseconfig.bannerBGData.patternId),document.querySelector('[rel="clrPreview"]').classList.add("Cpt"+e.value),document.querySelector('[rel="patternElem"]').remove(),lmscourseconfig.bannerBGData.patternId=e.value;l='<div class="zp_Sm smbx bgsel" rel="patternElem"></div>';$('[rel="bannerElem"]').append(l),lmscourseconfig.menuConstruction(document.querySelector('[rel="patternElem"]'),"patternElem",lmscourseconfig.bannerBGData.clrId)}},courseTypeRadioSel:function(e,t,s){var r=0;if("radioChoiceStatic"!=s.target.getAttribute("fieldname")){try{s.target.closest("ul").querySelectorAll('[class="IC-rdo zp_gclr"]')[0].className="IC-rdo",b=s.target.closest("li").querySelector("i"),b.className="IC-rdo zp_gclr",r=b.getAttribute("fieldval")}catch(e){}2==r?$("#isAllowregister").show():$("#isAllowregister").hide()}},updateCourseInfo:function(e,t,s){if(e.lms_CourseCode)for(var r=Object.values(lms.courseCodes),l=Object.keys(lms.courseCodes),a=0;a<r.length;a++)if(e.lms_CourseCode==ZPeople.decodeTxt(r[a])&&lmscourses.currentCourseId!=l[a])return lmsformcomponents.onAllUploadsFinished(),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.course.coursecodepresent"));if(""!=e.lms_CourseName&&null!=e.lms_CourseName&&(lmscourses.currentCourseName=e.lms_CourseName),(""!=e.lms_StartDate&&null!=e.lms_StartDate||""!=e.lms_EndDate&&null!=e.lms_EndDate||"batch"==lmscourses.selectSectionName)&&""==e.lms_Trainer)return lmsformcomponents.onAllUploadsFinished(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.course.courseseltrainer")),!1;lmscourses.isUnlimtcount=e.lms_AllowUnlimitedRegistration,e.lms_CourseName=ZPeople.decodeTxt(lmscourses.currentCourseName);var n=lmscourses.editCourseAdmin;if(""==lmscourses.updateImage&&"Basics"==lmscourses.currentSectionName&&(e.lms_CourseImage=lmscourses.randomImage),lmscourses.currentCourseId&&(e.zp_mode="updateRecord",e.zp_recordId=lmscourses.currentCourseId),""!=e.lms_CourseAdmin&&null!=e.lms_CourseAdmin?lmscourses.editCourseAdmin=e.lms_CourseAdmin:lmscourses.editCourseAdmin=erecno,"[]"==e.lms_CourseIntroFiles&&delete e.lms_CourseIntroFiles,e.lms_CourseAdmin=lmscourses.editCourseAdmin,null==e.lms_CourseCode&&""==e.lms_CourseCode||(lmscourses.coursecode=e.lms_CourseCode),null!=e.lms_SkillsYouWillAcquire&&(""!=e.lms_SkillsYouWillAcquire||""!=e.lms_PrerequisiteSkills))if(e.lms_SkillsYouWillAcquire==e.lms_PrerequisiteSkills){if(e.lms_PreLevel>=e.lms_Level)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.acquireskillissue")),void lmsformcomponents.onAllUploadsFinished()}else $("#spanerror").remove();if(e.courseId=e.zp_recordId,document.getElementById("courseenroll")){var i=document.getElementById("courseenroll").querySelectorAll('[class="IC-cbox zp_gclr"]'),o=[];if(!(i.length>0))return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.selatleast"));for(a=0;a<i.length;a++){(u={}).ids=i[a].getAttribute("_rel"),o.push(u)}var c=JSON.stringify(o);e.lms_WhoCanEnroll=c}if(document.getElementById("courseunenroll")){var d=document.getElementById("courseunenroll").querySelectorAll('[class="IC-cbox zp_gclr"]'),m=[];if(!(d.length>0))return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.settings.selatleast"));for(a=0;a<d.length;a++){var u;(u={}).ids=d[a].getAttribute("_rel"),m.push(u)}var p=JSON.stringify(m);e.lms_whounenroll=p}var g={};document.querySelector('[rel="clrPreview"]')&&(g.clrId=lmscourseconfig.bannerBGData.clrId,g.patternId=lmscourseconfig.bannerBGData.patternId,e.lms_CourseColor=JSON.stringify(g)),$.post("/addUpdateRecord.zp",e,(function(r){$.each(r,(function(r,l){7e3==l.code?(lmsformcomponents.onAllUploadsFinished(),e.lms_CourseCode&&(lms.courseCodes[l.pkId]=e.lms_CourseCode),e.lms_CourseColor&&(lmscoursedetails.currentCourseData[0].bannerBGData=g),"Basics"==lmscourses.currentSectionName&&n!=lmscourses.editCourseAdmin&&lmsassignmentview.updateCourseAdmin(n,lmscourses.editCourseAdmin,lmscourses.courseOwner),lmscourses.currentCourseId=l.pkId,""==lmsform.editDetails||null==lmsform.editDetails?lmscourseconfig.getEditFormComponents(lmscourses.currentCourseId,"initialEdit"):lmscourseconfig.updateComponents(e,0,t,s),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.courseinfoadded")),"batch"==lmscourses.selectSectionName&&(lmsbatches.getAllBatches("forForm",lmscourses.currentSectionId),$(".zp_STbx").show(),$("#defaultBatchinfo").show())):(lmsformcomponents.onAllUploadsFinished(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.course.courseinfonotadded")))}))}))},updateComponents:function(e,t,s,r){var l=r?lmscourses.currentSectionindex:lmscourses.previousSectionIndex,a=lmsform.editDetails.message.recordDetails[l];$.each(a.column1,(function(t,r){var l=r.componentName;if(null!=e[l])if(26==r.componentType||"lms_PrerequisiteSkills"==r.componentName||"lms_SkillsYouWillAcquire"==r.componentName){if(100==r.displayType){var a="";r.componentValue=e[l],null!=lmsform.selectMenuArray[r.formComponentId]?a=lmsform.selectMenuArray[r.formComponentId][r.componentValue]:null!=lmscourses.singleSelectArray[r.formComponentId]&&1==s&&(a=lmscourses.singleSelectArray[r.formComponentId][r.componentValue]),null!=a?(r.componentValue=a[0].trim(),r.componentValue_ID=e[l]):(r.componentValue="",r.componentValue_ID="")}else if(102==r.displayType&&(r.componentValue=e[l],null==lmsform.selectMenuArray[r.formComponentId]&&(lmsform.selectMenuArray=lmscourses.multiSelectArray),null!=lmsform.selectMenuArray[r.formComponentId]&&""!=r.componentValue)){var n=r.componentValue.split(";");r.componentValue_ID=[];for(var i=0;i<n.length;i++){for(var o=0,c=0;c<r.componentValue_ID.length;c++)r.componentValue_ID[c]==n[i]&&(o=1);0==o&&r.componentValue_ID.push(n[i])}r.componentValue=[];for(var d=0;d<n.length;d++){a=lmsform.selectMenuArray[r.formComponentId][n[d]];r.componentValue.push([ZPeople.escapeHtml(a[0])])}}}else if(31==r.componentType){for(var m=[],u=lmsform.fileInfoContent[r.formComponentId].getAllFilesForSaving(),p=0;p<u.length;p++)m.push(u[p].fileInfo);r.componentValue=m}else 1==r.componentType?r.componentValue=ZPeople.escapeHtml(e[l]):r.componentValue=e[l]}))},alertConstructField:function(e,t,s,r){lmscourses.formParams=e,lmsnotify.show({header:ZPI18N.getString("zp.lms.confirmChanges"),body:ZPI18N.getString("zp.lms.course.coursesettingsupdate"),button_text:ZPI18N.getString("zp.lms.saveCourse"),texttype:"positive",successCallback:function(){this.status&&lmscourseconfig.saveCourse()},cancelCallback:function(){}}),lmscourseconfig.constructSectionFields(t,s,r)},saveCourse:function(){lmscourseconfig.updateCourseInfo(lmscourses.formParams,1,"saveAlert")},constructSectionFieldsAlert:function(e,t,s,r){var l=0,a=lmsform.formvalidate("",0);if(2==lmscourses.previousSectionIndex)return lmsbatches.saveAlertBatch(),void lmscourseconfig.constructSectionFields(e,r,s);for(var n=lmscourses.courseFormComponents[lmscourses.previousSectionIndex].column1,i=0;i<t.length;i++){var o=t[i].componentName;if(9==t[i].componentType&&(1==t[i].componentValue||"true"==t[i].componentValue?t[i].componentValue=!0:t[i].componentValue=!1),5==t[i].componentType&&null!=a[o]&&(0==t[i].componentValue&&(t[i].componentValue=""),a[o]=a[o]+"".replace(/^0+/,"")),a[o]==t[i].componentValue);else if(""==t[i].componentValue&&void 0!==n[i]&&31!=t[i].componentType)if(n[i].autofillvalue==a[o]||null==a[o]);else l=1;else if(null==a[o]);else if(10==t[i].componentType){var c=t[i].componentValue.split("/"),d=months[parseInt(c[0])-1];t[i].componentValue=c[1]+"-"+d+"-"+c[2],t[i].componentValue!=a[o]&&(l=1)}else if(26==t[i].componentType||25==t[i].componentType)if(102==t[i].displayType||26==t[i].componentType&&100==t[i].displayType||"lms_PrerequisiteSkills"==t[i].componentName||"lms_SkillsYouWillAcquire"==t[i].componentName){var m=a[o].split(";");if("string"==typeof t[i].componentValue_ID)if(m[0]==t[i].componentValue_ID);else l=1;else if(m.length!=t[i].componentValue_ID.length&&(l=1),!l)for(var u=0;u<m.length;u++){for(var p=0,g=0;g<m.length;g++)m[g]==t[i].componentValue_ID[u]&&(p=1);0==p&&(l=1)}}else if(lmsform.changetoI18N(ZPeople.decodeTxt(t[i].componentValue))==lmsform.changetoI18N(ZPeople.decodeTxt(a[o])));else l=1;else if(31==t[i].componentType){var f=a[t[i].componentName],v=f.substring(1,f.length-1).split(","),h=0;o=t[i].componentValue;if(""==v&&0==o.length);else{for(u=0;u<o.length;u++){if(!f.includes(o[u].contentId)){l=1;break}h+=1}h!=v.length/2&&(l=1)}}else{1!=t[i].componentType&&3!=t[i].componentType||ZPeople.decodeTxt(t[i].componentValue)!=a[o]?t[i].componentValue==a[o]?"":l=1:""}}l?(lmscourses.multiSelectArray=lmsform.selectMenuArray,lmscourses.singleSelectArray=lmsform.selectMenuArray,lmscourseconfig.alertConstructField(a,e,r,s),lmscourseconfig.fileInfoContent=lmsform.fileInfoContent):lmscourseconfig.constructSectionFields(e,r,s)},closeQHash:function(){lmscoursedetails.currentCourseData=null,lmscourseapplicable.applicableTOData={};var e=location.hash.split("?")[0].split("/");$(".cont-wrap").removeClass("zp_Pshw");var t=lmsbase._role;lmsbase._role="view",lmsbase.removeQHash();for(var s="",r=1;r<e.length;r++)s+=e[r],r!=e.length-1&&(s+="/");1==lmscourses.settingOpened?(lmsbase._role=t,lms.changeHash("hash",s,"disable")):lms.changeHash("hash",s,"disable","view"),lmscourses.settingOpened=0,lmsbase._role=t,lmscoursedetails.viewComponentData(lmscoursedetails.disableComponentData,"updateMode"),lmscourseconfig.assessmentSettings&&(lmscourseconfig.assessmentSettings=null),lmscourseconfig.feedbackSettings&&(lmscourseconfig.feedbackSettings=null),lmscourseconfig.managerEvalutionSettings&&(lmscourseconfig.managerEvalutionSettings=null)},getBrandingPopup:function(){if($(".zp_msk").length>0)$(".zp_msk").show();else{$(".zp_msk").remove();var e='<div class="zp_msk"></div>';$(".main-wrp").append(e)}$(".zp_popup").remove();e='<div class="zp_popup" id="zp_popfour" style="width: 70%"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.course.coursebgimgsel")+'</font> <i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'" onclick="lmscourseconfig.closeImagepopup()"></i></div>';for(e+='<div class="zp_Pocnt" style="max-height: 500px;"><ul class="zp_BGimg">',i=1;i<26;i++)e+='<li><div onclick="lmscourseconfig.selectimg(this)" id="selImg"><img src='+ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+i+".svg")+' alt=""><i class="IC-tck1"></i></div></li>';e+="</ul></div>",$(".zp_msk").append(e),$($(".zp_BGimg").find("div")[lmscourses.updateImage-1]).addClass("sel")},selectimg:function(e){lmscourseconfig.isCustomImg=!1,null!=lmscoursedetails.currentCourseData&&(lmscoursedetails.currentCourseData[0].isSystem=!1),$(".zp_BGimg").find(".sel").removeClass(),$(e).addClass("sel"),$(e).parent().find(".zp_Pocnt").addClass("zp_svbgpop"),$("#saveimg").removeClass("zp_dyn"),lmscourseconfig.updateCourseImage()},invokeUploadManager:function(e){e=e||[];var t=document.getElementById("imgUpload");dropElement=lmsbase.pageCont;var s={clickElement:t,dropElement,moduleName:lms.appname,multiple:lmscourseconfig.uploadConfig.multiple,MAXSIZE:lmscourseconfig.uploadConfig.MAXSIZE,MAX_NUMBER_OF_FILES_PER_UPLOAD:lmscourseconfig.uploadConfig.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED,SUPPORTED_SOURCES:lmsfileaction.SOURCE.LOCAL,callbackObject:lmscourseconfig.uploadConfig,SUPPORTED_FILE_EXTENSIONS:{image:".jpeg,.jpg,.png"},requiredFileTypes:"image",ACTION_ATTRIBUTE:"action",additionalInfo:{subModule:"courseImage"}},r={listElement:document.querySelector("[attachmentTab]"),MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED:lmscourseconfig.uploadConfig.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED,type:lmsuploadmanager.UPLOADMANAGER_TYPE.SINGLEIMAGEUPLOADMANAGER};lmscourseconfig.uploadHelperObject=lmsuploadmanager.initUploadManager(r,new lmsfileaction.upload(s)),lmscourseconfig.uploadHelperObject.attachCallback("getSingleAttachment",lmscourseconfig.getSingleAttachmentHTML),lmscourseconfig.uploadHelperObject.attachCallback("onbeforeupload",SingleImageUploadManager.onBeforeUpload),lmscourseconfig.uploadHelperObject.attachCallback("onafterupload",lmscourseconfig.onAfterUpload),lmscourseconfig.uploadHelperObject.attachCallback("getPreviewObject",lmsattachment.getPreviewObject),lmscourseconfig.uploadHelperObject.attachCallback("lightbox_src_callback",lmsattachment.lightbox_src_callback),lmscourseconfig.uploadHelperObject.attachCallback("lightbox_click_callback",lmsattachment.lightbox_click_callback),lmscourseconfig.uploadHelperObject.attachCallback("onMaximumUploadLimitReached",SingleImageUploadManager.onMaximumNumberOfUploadLimitReached),lmscourseconfig.uploadHelperObject.addSavedFiles(e),lmscourseconfig.uploadHelperObject.bind()},onAfterUpload:function(e,t,s,r){var l=lmsattachment.STATUS_CODE;s.fileInfo&&"selected image is inadequate"==s.fileInfo.msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.customImageErrorMsg")):s.code==l.FILESTOREDSUCCESSFULLY&&(SingleImageUploadManager.onAfterUpload(e,t,s,r),lmscourseconfig.fileInfo=s.fileInfo,lmscourseconfig.isCustomImg=!0,lmscourseconfig.cropImage())},getSingleAttachmentHTML:function(e){var t=e.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+e.imageID+".svg"):lmsfileaction.generateSourceURL(e,void 0,void 0,!0),s=document.createElement("div");return s.setAttribute("class","zp_popup pad30"),s.setAttribute("style","max-width:800px"),s.innerHTML='<div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.customImage")+'</font><i class="IC-cls" onclick="closepop()"></i></div><div class="zp_Pocnt" attachmentlist style="max-height:500px;" src="'+t+'"></div><div class="zp_btn"><button class="zpthm">'+ZPI18N.getString("zp.lms.savetheimage")+"</button></div>",s},cropImage:function(){if($(".zp_msk").length>0)$(".zp_msk").show();else{$(".zp_msk").remove();var e='<div class="zp_msk"></div>';$(".main-wrp").append(e)}$(".zp_popup").remove();var t=lmsfileaction.generateSourceURL(lmscourseconfig.fileInfo,void 0,void 0,!0),s='<div class="zp_popup pad30" rel="courseImgElem" style="max-width: 600px;"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.customImage")+'</font><i class="IC-cls" onclick="lmscourseconfig.closeImagepopup()"></i></div><div attachmentTab class="zp_Pocnt" style="max-height:600px;padding:0;min-width: 300px;display: flex;justify-content: center;"><div attachmentlist style="overflow: auto;"><img src="'+t+'" alt="" id="brandingCourseImage"></div></div><div class="zp_btn"><button class="zpthm" onclick="lmscourseconfig.updateCourseImage()">'+ZPI18N.getString("zp.lms.savetheimage")+"</button></div></div>";$(".zp_msk").append(s);e='<div class="zp_crpimg">';e+='<input type="hidden" name="x" id="xVal" /><input type="hidden" name="y" id="yVal" /><input type="hidden" name="width" id="width" /><input type="hidden" name="height" id="height"/></div>',$("#brandingCourseImage").append(e),$("#brandingCourseImage").Jcrop({onSelect:lmscourseconfig.getPosition,bgFade:!0,bgOpacity:.7,minSize:[250,100],aspectRatio:2.5,allowSelect:!1},(function(){var e=this;bounds=e.getBounds(),boundx=bounds[0],boundy=bounds[1],e.setSelect(lmscourseconfig.getDimensions(e))}))},getDimensions:function(e){var t=e.ui.holder,s=$(t).width(),r=$(t).height();if(s==r)return[0,0,s,r];if(s<r){var l=s;return[0,a=Math.round((r-s)/2),0,a+l]}if(s>r){var a;l=r;return[a=Math.round((s-r)/2),0,a+l,0]}return[Math.round(s/2-preview_width/2),Math.round(r/2-preview_height/2),Math.round(s/2+preview_width/2),Math.round(r/2+preview_height/2)]},getPosition:function(e){$("#brandingCourseImage").find("input#width").val(parseInt(e.w)),$("#brandingCourseImage").find("input#xVal").val(parseInt(e.x)),$("#brandingCourseImage").find("input#yVal").val(parseInt(e.y)),$("#brandingCourseImage").find("input#height").val(parseInt(e.h))},updateCourseImage:function(){var e="";$(".zp_BGimg").find(".sel").each((function(){1==$(this).hasClass("sel")&&(e=$(this).find("img").attr("src").split("cat")[1].split(".svg")[0].split(".")[0])}));var t={method:"updateCourseImage",courseInfoId:lmscourses.currentCourseInfoId,courseId:lmscourses.currentCourseId,isCustomImg:lmscourseconfig.isCustomImg,conreqcsr:csrfToken};lmscourseconfig.isCustomImg||(t.image=e),lmscourseconfig.isCustomImg&&(t.x=$("input#xVal").val(),t.y=$("input#yVal").val(),t.width=$("input#width").val(),t.height=$("input#height").val(),t.uploadFile=lmscourseconfig.fileInfo.contentId),$.post("/courseAction.zp",t,(function(t){null!=t[1]&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.coursebgimgupdated")),null==lmscoursedetails.currentCourseData||t[1][0].courseImageInfo.isSystemImage?($(".zp_popup").remove(),$(".zp_msk").hide(),$.each(t[1],(function(s,r){lmscoursedetails.currentCourseData[0].courseImageInfo=t[1][0].courseImageInfo,lmscourses.currentCourseInfoId=r.infoId,lmscourseconfig.isCustomImg||($("#brandingImage").attr("src",ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+e+".svg")),lmscourses.updateImage=e)}))):(lmscourseconfig.showuploadedPhoto(t[1]),null!=lmscoursedetails.currentCourseData&&(lmscoursedetails.currentCourseData[0].courseImageInfo=t[1][0].savedFileInfo,lmscoursedetails.currentCourseData[0].courseImageInfo.isSystemImage=!1)),lmscourseconfig.clrOrPatternChange(null,"clrElem",t[1][0].bannerBGData.clrId,t[1][0].bannerBGData.patternId))}))},showuploadedPhoto:function(e){if("Image updated successfully"===e[0].message){lmscourseconfig.fileInfo=e[0].savedFileInfo;var t={fileId:lmscourses.currentCourseId,type:"6"};lmscourseconfig.fileInfo.additionalInfo=t,lmscourseconfig.closeImagepopup(),$("#brandingImage").attr("src",lmsfileaction.generateSourceURL(lmscourseconfig.fileInfo,void 0,void 0,!0))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess"))},closeImagepopup:function(){$(".zp_popup").hide(),$(".zp_msk").hide()},closePopup:function(){addCourseForm.destroyCourseInitFields(),lmsbase.removeListener(document,"keyup",lmscourseconfig.keyuphandler,!1),lmsbase.closeMaskv5()},confirmAddCourse:function(){lmsform.updateSelectOptions()},checkBoxConstruction:function(e,t){var s="",r=[];null!=t&&(r=t.match(/[1-9]/g));for(var l=[],a=0;a<r.length;a++){l.push(r[a]),l.includes("2")||l.push("2")}var n=[];$.each(l,(function(e,t){-1==$.inArray(t,n)&&n.push(t)}));var i=0,o="",c="";for(a=0;a<e.length;a++)o="IC-cbox",c="",null!=n&&n[i]==a+1&&(o="IC-cbox zp_gclr",1!=n[i]&&2!=n[i]||(c="disabled"),i++),s+='<li name="checkBox" class="'+c+'"><i class="'+o+'" _rel="'+(a+1)+'"></i><span>'+e[a]+"</span></li>";return s},initAssessmentSettings:function(e,t){if(lmscourseconfig.closeFeedbackSettings(t),t.skipAction=!0,!lmsbase.hasClass(t.currentTarget,"sel")){this.assessmentSettings?this.assessmentSettings.alertAndClose():this.previousForm=$.extend({},lmsform),$("#courseSec li").removeClass("sel"),lmsbase.addClass(t.currentTarget,"sel");var s=lmsbase._contArr[4].querySelector(".zp_pwrap.zp_tab");$(".zp_AClft",s).addClass("zp_dyn"),$("form",s).addClass("zp_dyn");var r=document.createElement("div");r.className="zp_AClft",r.appendChild(document.createElement("h5")).innerHTML=ZPI18N.getString("zp.lms.courseOptions");var l=r.appendChild(document.createElement("div"));l.className="zp_STbx";var a=function(){r.parentNode.removeChild(r)};this.assessmentSettings=0==e?lmstest.createCoursePreAssessmentSettingsView(lmscourses.currentCourseId,l,a):lmstest.createCoursePostAssessmentSettingsView(lmscourses.currentCourseId,l,a),this.assessmentSettings.start(),s.insertBefore(r,s.firstChild)}},closeAssessmentSettings:function(e){if(!e.skipAction&&this.assessmentSettings){var t=lmsbase._contArr[4].querySelector(".zp_pwrap.zp_tab");$(".zp_AClft",t).removeClass("zp_dyn"),$("form",t).removeClass("zp_dyn"),this.previousForm&&(lmsform=this.previousForm,this.previousForm=null),this.assessmentSettings.alertAndClose(),this.assessmentSettings=null}},initManagerEvalutionSettings:function(e){if(!lmsbase.hasClass(e.currentTarget,"sel")){this.managerEvalutionSettings?this.managerEvalutionSettings.alertAndClose():this.previousForm=$.extend({},lmsform),$("#courseSec li").removeClass("sel"),lmsbase.addClass(e.currentTarget,"sel");var t=lmsbase._contArr[4].querySelector(".zp_pwrap.zp_tab");$(".zp_AClft",t).addClass("zp_dyn"),$("form",t).addClass("zp_dyn");var s=document.createElement("div");s.className="zp_AClft",s.setAttribute("managerevaluation",""),s.appendChild(document.createElement("h5")).innerHTML=ZPI18N.getString("zp.lms.courseOptions");var r=s.appendChild(document.createElement("div"));r.className="zp_STbx";this.managerEvalutionSettings=lmsmanagerevaluation.createManagerEvalutionSettingsView(lmscourses.currentCourseId,r,(function(){s.parentNode&&s.parentNode.removeChild(s)})),this.managerEvalutionSettings.start(),t.insertBefore(s,t.firstChild)}},closeManagerEvalutionSettings:function(e){if(!e.skipAction&&this.managerEvalutionSettings){var t=lmsbase._contArr[4].querySelector(".zp_pwrap.zp_tab");$(".zp_AClft",t).removeClass("zp_dyn"),$("form",t).removeClass("zp_dyn"),this.previousForm&&(lmsform=this.previousForm,this.previousForm=null),this.managerEvalutionSettings.alertAndClose(),this.managerEvalutionSettings=null}},onload:function(){var e=function(){lmsfeedback_survey_integration.addListener(lmsfeedback_survey_integration.EVENT_TYPE.TEMPLATE_ADDED,lmscourseconfig.onFeedbackTemplateAdded),lmsfeedback_survey_integration.addListener(lmsfeedback_survey_integration.EVENT_TYPE.TEMPLATE_EDITED,lmscourseconfig.onFeedbackTemplateEdited),lmsbase.removeListener(window,"DOMContentLoaded",e)};lmsbase.addListener(window,"DOMContentLoaded",e)}(),initFeedbackSettings:function(e){if(e.skipAction=!0,!lmsbase.hasClass(e.currentTarget,"sel")){this.feedbackSettings?this.feedbackSettings.alertAndClose():this.previousForm=$.extend({},lmsform),$("#courseSec li").removeClass("sel"),lmsbase.addClass(e.currentTarget,"sel");var t=lmsbase._contArr[4].querySelector(".zp_pwrap.zp_tab");$(".zp_AClft",t).addClass("zp_dyn"),$("form",t).addClass("zp_dyn");var s=document.createElement("div");s.className="zp_AClft",s.appendChild(document.createElement("h5")).innerHTML=ZPI18N.getString("zp.lms.courseOptions");var r=s.appendChild(document.createElement("div"));r.className="zp_STbx";this.feedbackSettings=lmsfeedback.createCourseFeedbackSettingsView(lmscourses.currentCourseId,r,(function(){s.parentNode.removeChild(s)})),this.feedbackSettings.start(),t.insertBefore(s,t.firstChild)}},closeFeedbackSettings:function(e){if(!e.skipAction&&this.feedbackSettings){var t=lmsbase._contArr[4].querySelector(".zp_pwrap.zp_tab");$(".zp_AClft",t).removeClass("zp_dyn"),$("form",t).removeClass("zp_dyn"),this.previousForm&&(lmsform=this.previousForm,this.previousForm=null),this.feedbackSettings.alertAndClose(),this.feedbackSettings=null}},onFeedbackTemplateAdded:function(e){lmscourseconfig.feedbackSettings&&lmscourseconfig.feedbackSettings.onTemplateAdded(e)},onFeedbackTemplateEdited:function(e){lmscourseconfig.feedbackSettings&&lmscourseconfig.feedbackSettings.onTemplateEdited(e)},expensecategory:"",totalexpensecost:"",constructCourseCost:function(e,t){lmscourseconfig.totalexpensecost=0,""!=e&&($("#courseSec li").removeClass("sel"),lmsbase.addClass(e.currentTarget,"sel"));var s="";if($(".zp_STbx").html(""),$("#coursecostouter").remove(),0==$("#coursecostouter").length){var r='<div id="coursecostouter"></div>';$(".zp_STbx").append(r)}"nodata"!=t?zplms.get("/lms/courses/"+lmscourses.currentCourseId+"/settings/expense",null,(function(e){if(lmscourseconfig.expensecategory=e[1].costCategoryDetails,0==(s=e[1].courseCostDetails).length){var t='<div class="ZPNdata zp_dyn" id="nocost" style="display: flex !important;"><div>';t+='<div class="nocost"></div>',t+="<label><h3>"+ZPI18N.getString("zp.lms.cost.trainingcost")+"</h3><p>"+ZPI18N.getString("zp.lms.cost.trainingcostdesc")+'</p><div class="zp_btn" onclick="lmscourseconfig.createCost()"><button class="zpthm">'+ZPI18N.getString("zp.lms.cost.addtrainingcost")+"</button></div></label>",t+="</div></div>",0==$("#nocost").length&&$("#coursecostouter").append(t)}else lmscourseconfig.createCost(s)})):(r+='<div class="ZPNdata zp_dyn" id="nocost" style="display: flex !important;"><div>',r+='<div class="nocost"></div>',r+="<label><h3>"+ZPI18N.getString("zp.lms.cost.trainingcost")+"</h3><p>"+ZPI18N.getString("zp.lms.cost.trainingcostdesc")+'</p><div class="zp_btn" onclick="lmscourseconfig.createCost()"><button class="zpthm">'+ZPI18N.getString("zp.lms.cost.addtrainingcost")+"</button></div></label>",r+="</div></div>",0==$("#nocost").length&&$("#coursecostouter").append(r))},createCost:function(e){lmscourses.courseCurrency=lmscoursedetails.currentCourseData[0].courseCurrency,""==lmscoursedetails.currentCourseData[0].courseCurrency&&(lmscourses.courseCurrency="202");var t="IC-cbox";1==lmscoursedetails.currentCourseData[0].isCostEnabled&&(t="IC-cbox zp_gclr"),$("#nocost").remove();var s='<div class="zp_trncst" rel="costfilter">';s+='<div class="zp_Sm zp_c3 mbt30" id="currencyfilter" rel="currencyfiltermenu"><h4>'+ZPI18N.getString("zp.lms.cost.chooseCurrency")+"</h4>",s+="</div>",s+='<div class="zp_Sm zp_lp zp_nbr mbt30"><div><ul><li onclick="lmscourseconfig.updateCostEnableDisable(this)"> <i class="'+t+'"></i> <span>'+ZPI18N.getString("zp.lms.costdisplay")+"</span> </li>",s+="</ul>",s+="</div>",s+="</div>",s+='<div class="zp_gradecnt"><div><div class="zp_Sgrd expns"><label><p>'+ZPI18N.getString("zp.lms.cost.expensecategory")+"</p><p>"+ZPI18N.getString("zp.formexpense")+"</p><p></p></label>",s+='<div><ul id="expenseUllist">',s+='<li class="zp_addexpn" id="expenseheader"><span  rel="menuexpense">',s+='<div class="zp_Sm smbx" id="expensecategory" rel="expensecategorymenu"></div>',s+="</span>",s+='<span><input type="text" value="0" class="zp_inpmrk" id="expenseamount"></input></span>',s+='<span><div class="zp_btn"><button class="zpthm" id="expenseaddbutton" onclick="lmscourseconfig.updateExpensedetails(event)">'+ZPI18N.getString("zp.add")+"</button></div></span></li>";var r=0;$.each(e,(function(e,t){s+=lmscourseconfig.getExpenselisthtml(t.catId,t.catName,t.expense);var l=parseInt(t.expense);r=parseInt(r)+l,lmscourseconfig.totalexpensecost=r}));var l="";""!=lmscourses.courseCurrency&&null!=lmscourses.courseCurrency&&(l=lmscourses.currencylistData[lmscourses.courseCurrency]);var a=l.slice(0,3);s+='<li class="zp_ttlexpn"><span><p>'+ZPI18N.getString("zp.total")+'</p></span><span><b id="totalexpensecost"><span id="currencyname">'+a+"</span>"+r+"</b></span> <span> </span></li>",s+="</ul></div>",s+="</div>",s+="</div></div>",$("#coursecostouter").append(s),lmscourseconfig.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="costfilter"]')),lmscourseconfig.createCurrencyfiltermenu(document.querySelector('[rel="currencyfiltermenu"]'),l),lmscourseconfig.expensemenuConstruction(document.querySelector('[rel="expensecategorymenu"]')),$("#expenseUllist").find("input").on("keyup keypress",(function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1}))},enableExpense:function(e,t){$("#expenseinput_"+t).show(),$("#catexpenseouter_"+t).hide()},createCurrencyfiltermenu:function(e,t,s){var r=lmscourses.currencylistData;ZPI18N.getString("zp.select");for(var l=Object.values(r),a=Object.keys(r),n={},i={},o=0;o<l.length;o++){var c=[];c.push(l[o]),i[a[o]]=c}[].push(i),n[0]=i[lmscourses.courseCurrency],lmscourseconfig.menuObj.insertMenu({elem:e,type:"select",mode:"single",menulist:i,click:lmscourseconfig.updateCurrencydetails}),lmsmenu.changeToSelectMenu(e,n,"single",null,ZPI18N.getString("zp.select"))},expensemenuConstruction:function(e,t){var s={};s[0]=[ZPI18N.getString("zp.select")],lmscourseconfig.createExpenseMenu(lmscourseconfig.expensecategory,e,"",s,lmscourseconfig.clrOrPatternChange)},createExpenseMenu:function(e,t,s,r,l){e=lmscourseconfig.expensecategory;var a={};a[0]=[ZPI18N.getString("zp.select")];for(var n=Object.keys(e),i=Object.values(e),o=0;o<n.length;o++)a[n[o]]=[i[o]];lmscourseconfig.menuObj.insertMenu({elem:t,type:"select",mode:"single",menulist:a}),lmsmenu.changeToSelectMenu(t,r,"single",null,ZPI18N.getString("zp.select"))},updateCurrencydetails:function(e){var t="";if("costupdate"!=e){t=$("#currencyfilter").find(".zp_Tglst").attr("_rel");var s=$("#expenseamount").val();lmscourseconfig.totalexpensecost=parseInt(lmscourseconfig.totalexpensecost)+parseInt(s),lmscoursedetails.currentCourseData[0].courseCurrency=t}""!=lmscoursedetails.currentCourseData[0].courseCurrency&&null!=lmscoursedetails.currentCourseData[0].courseCurrency||(t="202",lmscoursedetails.currentCourseData[0].courseCurrency=t),"nodata"==e&&(t="202",lmscoursedetails.currentCourseData[0].courseCurrency=t,s=0,lmscourseconfig.totalexpensecost=0);var r={currency:t,totalCost:lmscourseconfig.totalexpensecost,costMode:"currency"};zplms.patch("/lms/courses/"+lmscourses.currentCourseId+"/settings/expense",r,(function(s){if("costupdate"!=e){"nodata"!=e&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.currencies.sm.currupdsuccess")),lmscourses.courseCurrency=t;var r="";""!=lmscourses.courseCurrency&&null!=lmscourses.courseCurrency&&(r=lmscourses.currencylistData[lmscourses.courseCurrency]);var l=r.slice(0,3);$("#currencyname").text(l)}}))},updateCostEnableDisable:function(e){$(e).find("i").toggleClass("zp_gclr");var t=0;$(e).find("i").hasClass("zp_gclr")&&(t=1);var s={option:t};zplms.put("/lms/courses/"+lmscourses.currentCourseId+"/settings/expense",s,(function(e){"Success"==e[1].message&&(lmscoursedetails.currentCourseData[0].isCostEnabled=t,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.costdisplaysuccessmsg")))}))},updateExpensedetails:function(e,t,s,r){var l=$("#expensecategory").find(".zp_Tglst").attr("_rel"),a=$("#currencyfilter").find(".zp_Tglst").attr("_rel"),n=$("#expenseamount").val();if("catedit"==s&&(l=r,n=$(t).val()),(parseInt(n)<0||isNaN(n))&&(n=0),0!=l||"catedit"==s){lmscourseconfig.totalexpensecost=lmscourseconfig.totalexpensecost+parseInt(n);var i={expensecatId:l,expenseamount:n,currency:a,totalCost:lmscourseconfig.totalexpensecost};zplms.patch("/lms/courses/"+lmscourses.currentCourseId+"/settings/expense",i,(function(e){if("catedit"==s?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.cost.expenseedited")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.cost.expenseadded")),"catedit"!=s){var t=$("#expensecategory").find(".zp_Tglst").find("div").text(),a=lmscourseconfig.getExpenselisthtml(l,t,n);$("#expenseheader").after(a),delete lmscourseconfig.expensecategory[l]}else{$("#catexpenseouter_"+r).show(),$("#catexpense_"+r).val(n),$("#expensespan_"+r).text(n),$("#expenseinput_"+r).hide();var i=0;$("[id^=expensespan_]").each((function(){i+=parseInt($(this).text())})),lmscourseconfig.totalexpensecost=i}var o="";""!=lmscourses.courseCurrency&&null!=lmscourses.courseCurrency&&(o=lmscourses.currencylistData[lmscourses.courseCurrency]);var c='<span id="currencyname">'+o.slice(0,3)+"</span>"+lmscourseconfig.totalexpensecost;$("#totalexpensecost").html(""),$("#totalexpensecost").append(c),$("#expensecategory").find(".zp_Sms").remove(),lmscourseconfig.expensemenuConstruction(document.querySelector('[rel="expensecategorymenu"]')),$("#expenseamount").val("0"),lmscourseconfig.updateCurrencydetails("costupdate")}))}else ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.cost.selectexpense"))},getExpenselisthtml:function(e,t,s){var r='<li id="catli_'+e+'" _rel="catlistli"><span id><p>'+t+"</p></span>";return r+='<span id="catexpenseouter_'+e+'"><label class="zp_memfld"><span  id="expensespan_'+e+'" onclick="lmscourseconfig.enableExpense(this,\''+e+"')\">"+s+"</span></label> </span>",r+='<label class="zp_memfld zp_edtshw" id="expenseinput_'+e+'" style="display:none"><div><input class="zp_inpbrd" value="'+s+'" id="catexpense_'+e+"\" onfocusout=\"lmscourseconfig.updateExpensedetails(event,this,'catedit','"+e+"')\"></div></label>",r+='<span><i class="IC-delete"  id="'+e+'" onclick="lmscourseconfig.deleteCost(this)"></i></span></li>'},deleteCost:function(e){var t=$(e).attr("id"),s={expensecatId:t};lmsnotify.show({header:ZPI18N.getString("zp.lms.cost.deleteexpenseheader",["Expense"]),body:ZPI18N.getString("zp.lms.cost.deleteexpensesubject",["Expense"]),button_text:ZPI18N.getString("zp.lms.delete"),texttype:"negative",successCallback:function(){this.status&&zplms.delete("/lms/courses/"+lmscourses.currentCourseId+"/settings/expense",s,(function(e){var s=$("#catexpense_"+t).val(),r=lmscourseconfig.totalexpensecost-parseInt(s);lmscourseconfig.totalexpensecost=r;var l="";""!=lmscourses.courseCurrency&&null!=lmscourses.courseCurrency&&(l=lmscourses.currencylistData[lmscourses.courseCurrency]);var a='<span id="currencyname">'+l.slice(0,3)+"</span>"+lmscourseconfig.totalexpensecost;$("#totalexpensecost").html(""),$("#totalexpensecost").append(a),lmscourseconfig.updateCurrencydetails("costupdate"),$("#catli_"+t).remove(),0==$("[_rel=catlistli]").length&&($(".zp_STbx").html(""),lmscourseconfig.constructCourseCost("","nodata"),lmscourseconfig.updateCurrencydetails("nodata"))}))},cancelCallback:function(){}})},initCourseAdminsSettings:function(e,t){if(0==$('[id="courseadmins"]').length){""!=event&&(1!=t&&$("#courseSec li").removeClass("sel"),lmsbase.addClass(event.currentTarget,"sel")),$(".zp_STbx").html(""),$("#courseadmins").remove();$(".zp_STbx").append('<div id="courseadmins"></div>'),lmscourseconfig.constructCourseAdmins()}},constructCourseAdmins:function(){var e='<div class="zp_lstlrnr padlr0"><div class="zp_btn"><button class="zpthm " onclick="lmscourseconfig.addCAPopup()">'+ZPI18N.getString("zp.lms.course.addadmin")+'</button></div><div class="lsthdr"><div class="hdralgn"><div><span>'+ZPI18N.getString("zp.name")+' </span><i class="IC-l-ar-dwn" id="courseadmins_Sort"></i></div></div><div class="wdfld"><div><span>'+ZPI18N.getString("zp.lms.permissions")+'</span></div></div><div class="wdmdm"><div><span>'+ZPI18N.getString("zp.lms.course.visibility")+'</span></div></div><div class="wdsml"></div></div><div class="zp_lstusr"><div class="zp_usrcnt"><div class="zp_usrrw"><div class="zp_usrcvr" id="permissionRel"></div></div></div></div></div>';$("#courseadmins").append(e),lmscourseconfig.constructPermission(lmscoursedetails.currentCourseData[0]),$("#courseadmins_Sort").click((function(e){lmscourseconfig.sortingList(lmscoursedetails.currentCourseData[0].courseId,e)}))},sortingList:function(e,t){var s=[{atoz:[ZPI18N.getString("zp.lms.AtoZ")]},{ztoa:[ZPI18N.getString("zp.lms.ZtoA")]}];lmsmenu.initiate({elem:t.target,width:"130px",type:"dropdown",arrowHead:!0,menulist:s,eve:t}).on("click",(function(){lmscourseconfig.fetchSortingList(this.value,e)})).bind()},constructPermission:function(e){var t=e.courseAdminInfo,s=e.courseAdmintabInfo;$.each(t,(function(e,t){lmscoursedetails.currentCourseData[0].courseAdmintabInfo[t.userId]&&(index=document.querySelectorAll('[class="zp_usrdtl"]').length,isVisible=s[t.userId]?s[t.userId].isVisible:s,className="true"==isVisible?"IC-eye":"IC-eye2",isVisibleTT="true"==isVisible?ZPI18N.getString("zp.lms.course.courseadmindisablemsg"):ZPI18N.getString("zp.lms.course.courseadminenablemsg"),html='<div class="zp_usrdtl" rel="courseAdminsElems_'+t.userId+'"><div><div><div class="ZP_photo" title="name of the person" onclick="poptick(this)"><img src="'+t.photoPath+'"><i class="IC-tck1 attnd"></i></div><label class="zp_dtlalgn"><p>'+t.name+'</p></label></div></div><div class="wdfld"><div><div class="zp_Sm smbx mtp0" rel="courseAdminsElem_'+t.userId+'"></div></div></div><div class="wdmdm"><div><div class="zp_micn"><ul><li><b class=""><span><i class="'+className+'" _isVisible="'+isVisible+'" data-ttip="'+isVisibleTT+'" rel="'+t.userId+'" onclick="lmscourseconfig.saveCourseAdmins(this, 4)"></i></span></b></li></ul></div></div></div><div class="wdsml"><div><div class="zp_micn"><ul><li id=""><b class=""><span><i class="IC-delete" rel="'+t.userId+'" data-ttip="'+ZPI18N.getString("zp.lms.delete")+'" _rel="ca_delete" onclick="lmscourseconfig.saveCourseAdmins(this, 3)"></i></span></b></li></ul></div></div></div></div>',$("#courseadmins").append(html),lmscourseconfig.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="courseAdminsElems_'+t.userId+'"]')),lmscourseconfig.menuConstruction(document.querySelector('[rel="courseAdminsElem_'+t.userId+'"]'),"courseAdminsHTMLElem"))}))},addCAPopup:function(){$(".zp_msk").html("");var e='<div class="zp_popup pad70" id="courseadminspopup" style="width:800px"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.course.addcourseadmin")+"</font><span>"+ZPI18N.getString("zp.lms.course.addcourseadmindesc")+'</span><i class="IC-cls" onclick="lmscourseconfig.closeImagepopup()"></i></div><div class="zp_Pocnt" style="max-height:700px;" rel="courseAdminsElems"><div><div class="zp_Sm mtp0" rel="courseAdmins"><b>'+ZPI18N.getString("zp.lms.course.selectadmin")+'</b></div><div class="zp_Sm" rel="tabIds"><b>'+ZPI18N.getString("zp.perm")+'</b></div></div></div><div class="zp_btn"><button class="zpthm" onclick="lmscourseconfig.saveCourseAdmins(null, 1)">'+ZPI18N.getString("zp.add")+"</button></div></div>";$(".zp_msk").show(),$(".zp_msk").append(e),lmscourseconfig.menuObj=lmsgroupmenu.initiate(document.querySelector('[rel="courseAdminsElems"]')),lmscourseconfig.menuConstruction(document.querySelector('[rel="tabIds"]'),"courseAdminsElem"),lmscourseconfig.createCourseAdminMenu(document.querySelector('[rel="courseAdmins"]'))},createCourseAdminMenu:function(e){lmscourseconfig.menuObj.insertMenu({elem:e,type:"select",mode:"multi",allow_new:!1,menutype:1,menulist:lmscourseconfig.fetchUsers}),lmsmenu.changeToSelectMenu(e,{},"multi",null,ZPI18N.getString("zp.select"))},fetchUsers:function(e){lmscourseconfig.menuCallBack=this.updateOptionList,lmscourseconfig.inputvalue=this.value,null!=this.value?lmscourseconfig.fetchUsersList(lmscourseconfig.userView,this.value):lmscourseconfig.fetchUsersList(lmscourseconfig.userView)},fetchUsersList:function(e,t){var s={courseId:lmscourses.currentCourseId,type:6,mode:5};t&&(s.searchTxt=t),zplms.get("/lms/learningplans/"+lmscourses.currentCourseId+"/criteria",s,e)},userView:function(e){var t={};Object.keys(e[1]).forEach((function(s){t[e[1][s]]=[s,""]})),lmscourseconfig.menuCallBack(t,lmscourseconfig.inputvalue)},fetchSortingList:function(e,t){var s="atoz"==e?0:1,r={method:"getCourseAdminIds",courseId:t,isSort:!0,mode:s,conreqcsr:csrfToken};$.post("/courseAction.zp",r,(function(e){lmscoursedetails.currentCourseData[0].courseAdminInfo=e[1].courseAdminInfo,lmscoursedetails.currentCourseData[0].courseAdmintabInfo=e[1].courseAdmintabInfo,$("#courseadmins").remove(),lmscourseconfig.initCourseAdminsSettings(e[1]),0==s?(document.querySelector('[id="courseadmins_Sort"]').classList.remove("IC-l-ar-top"),document.querySelector('[id="courseadmins_Sort"]').classList.add("IC-l-ar-dwn")):(document.querySelector('[id="courseadmins_Sort"]').classList.remove("IC-l-ar-dwn"),document.querySelector('[id="courseadmins_Sort"]').classList.add("IC-l-ar-top"))}))},saveCourseAdmins:function(e,t){var s=[],r=[];if(1==t){if(null==document.querySelector('[rel="courseAdmins"]').querySelector('[class="zp_Tglst ntxt"]'))return void ZPeople.Message.showFailureMsg("At Least one user should be course admin");s=document.querySelector('[rel="tabIds"]').querySelector('[class="zp_Tglst ntxt"]').getAttribute("_rel").split("|");for(var l=document.querySelector('[rel="courseAdmins"]').querySelector('[class="zp_Tglst ntxt"]').querySelectorAll("[data-value]"),a=0;a<l.length;a++)r.push(l[a].getAttribute("data-value"))}else if(3==t||4==t){if((3==t||4==t)&&"true"==e.getAttribute("_isvisible")&&document.querySelectorAll('[_isvisible="true"]').length<2)return void ZPeople.Message.showFailureMsg("At Least one user should be visible");if(3==t&&document.querySelectorAll('[_rel="ca_delete"]').length<2)return void ZPeople.Message.showFailureMsg("At Least one user should be course admin");r.push(e.getAttribute("rel"))}else{for(a=0;a<e.value.split("|").length;a++)""==e.value.split("|")[a].trim()&&""==e.value.split("|")[a].trim()||s.push(e.value.split("|")[a].trim());r.push(e.referObj.elem.getAttribute("rel").split("_")[1]),t=0}if(0!=t||0==t&&s.length>0){var n={method:"addUpdateCourseAdmins",courseId:lmscourses.currentCourseId,tabIds:JSON.stringify(s),userIds:JSON.stringify(r),mode:t,conreqcsr:csrfToken};$.post("/courseAction.zp",n,(function(s){if(1==t&&"Added successfully"==s[1][0].msg)lmscoursedetails.currentCourseData[0].courseAdminInfo=s[1][0].courseAdminInfo,lmscoursedetails.currentCourseData[0].courseAdmintabInfo=s[1][0].courseAdmintabInfo,lmscourseconfig.popupClose(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.casuccessmsg")),$("#courseadmins").remove(),lmscourseconfig.initCourseAdminsSettings(s[1][0],1);else if(3==t&&"Deleted successfully"==s[1][0].msg){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.cadeletemsg"));for(var l=0;l<r.length;l++)document.querySelector('[rel="courseAdminsElems_'+r[l]+'"]').remove(),delete lmscoursedetails.currentCourseData[0].courseAdmintabInfo[r[l]]}else if(4==t&&"IsVisible updated successfully"==s[1][0].msg)for(l=0;l<r.length;l++)"true"==e.getAttribute("_isvisible")?(e.setAttribute("_isvisible","false"),e.classList.remove("IC-eye"),e.classList.add("IC-eye2"),e.setAttribute("data-ttip",ZPI18N.getString("zp.lms.course.makevisible")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.cavisiblesuccmsg"))):"false"==e.getAttribute("_isvisible")&&(e.setAttribute("_isvisible","true"),e.classList.remove("IC-eye2"),e.classList.add("IC-eye"),e.setAttribute("data-ttip",ZPI18N.getString("zp.lms.course.hidevisibility")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.course.cavisiblesuccmsg")));else"At Least one user should be visible"==s[1][0].msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.course.cavisiblemandmsg")):"At Least one user should be course admin"==s[1][0].msg&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.course.camandatory"))}))}else ZPeople.Message.showFailureMsg("Select atleaset one tab")},popupClose:function(){$(".zp_popup").hide(),$(".zp_msk").hide()}},lmsbatches={selectUser:{},selectUserArr:[],isNewBatch:!1,sectionId:"",editBatchId:"",prevBatchId:"",isdefault:!1,batchData:null,formComponents:null,editDetails:null,openMode:"",params:null,mode:"",flag:null,batchMode:0,currentBatchData:{},_noCurrBatch:!1,batchPopup:null,batchList:null,batchInfo:[],initiate:function(){lmsbatches.getWaitinglist()},getWaitinglist:function(e){var t={method:"getWaitListUsers",mode:"all",courseId:e,conreqcsr:csrfToken};$.post("/batchAction.zp",t,(function(e){lmsbatches.viewWaitLisUsers(e[1])}))},viewWaitLisUsers:function(e){var t='<div class="zp_msk"></div>';$(".main-wrp").append(t);t='<div class="zp_popup" id="zp_poptwel" style="width:600px"> <div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.batches.Member")+'</font> <i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'" onclick="lmsbatches.closePopup(event,this)"></i></div>';t+='<div class="zp_Pocnt" style="min-height: 500px; max-height: 500px;">',t+='<div class="zp_Cbtch"><font><i class="IC-argt zp_arwdr"></i><span>'+ZPI18N.getString("zp.lms.batces.Insterested")+'</span></font><div class="zp_CBshw"><div class="zp_Cjndslct">',t+='<font><i class="IC-cbox" onclick="lmsbatches.selectAllUser(this)"></i>'+ZPI18N.getString("zp.selectall")+'</font> <label class="" ><font id="assign_batch">'+ZPI18N.getString("zp.lms.batces.AssignBatch")+' <i class="IC-adwn"></i></font></label></div>',t+='<ul class="zp_CPlst zp_Cjndlst" id="allUser">',$.each(e,(function(e,s){null!=s.userId&&(t+='<li><i class="IC-cbox" onclick="lmsbatches.selectUser(this)" _user="'+s.userId+'"></i><div class="ZP_photo" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src="'+s.userImage+'"></div><h4>'+s.userName+'</h4> <span id="choose_Batch" _currentuser="'+s.userId+'"><p>'+ZPI18N.getString("zp.lms.batches.ChooseBatch")+'</p><i class="IC-adwn"></i></span></li>')})),t+="</ul></div></div>",$.each(e,(function(e,s){null!=s.batchName&&(t+='<div class="zp_Cbtch" ><font><i class="IC-argt" onclick="lmsbatches.getBatchUser(\''+s.batchId+"')\"></i><span>"+s.batchName+"<b>"+s.batchCount+'</b></span></font><div class="zp_CBshw zp_dyn"><div class="zp_Cjndslct">',t+='<font style="display:none" id="selAll"><i class="IC-cbox"></i>'+ZPI18N.getString("zp.selectall")+'</font><label class="zp_dyn"> <font>'+ZPI18N.getString("zp.lms.batces.AssignBatch")+'<i class="IC-adwn"></i></font><div class="zp_btn"><button class="zpthm">'+ZPI18N.getString("zp.delete")+"</button></div></label></div>",t+='<ul class="zp_CPlst zp_Cjndlst" id="batchUser_'+s.batchId+'"></div></div>')})),t+="</div>",$(".zp_msk").append(t),$("#assign_batch").click((function(){lmsbatches.batchList(event)})),$("#choose_Batch").click((function(){lmsbatches.batchList(event,this)}))},getBatchUser:function(e){var t={method:"getBatchUsers",batchId:e,conreqcsr:csrfToken};$.post("/batchAction.zp",t,(function(t){lmsbatches.batchUserview(t[1],e)}))},batchUserview:function(e,t){$("#batchUser_"+t).html(""),$("#selAll").show(""),$("#batchUser_"+t).parent(".zp_CBshw").removeClass("zp_dyn"),$.each(e,(function(e,s){row+='<li><i class="IC-cbox"  _user="'+s.userId+'"></i><div class="ZP_photo" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src="'+s.userImage+'"></div><h4>'+s.userName+'</h4><span id="chooseBatch_'+s.userId+'"><p>'+ZPI18N.getString("zp.lms.batches.choosebatches")+'</p><i class="IC-adwn"></i></span></li>',$("#batchUser_"+t).append(row),$("#chooseBatch_"+s.userId).click((function(e){lmsbatches.batchList(e,this,s.userId)}))})),$(".IC-cbox").click((function(){lmsbatches.selectUser(this)}))},batchList:function(e,t,s){var r="";r=null==s?$(t).attr("_currentuser"):s,lmsbatches.selectUser={},lmsbatches.selectUser.userId=r,lmsbatches.selectUserArr.push(lmsbatches.selectUser);var l={method:"getBatchWithCnt",courseId:lmscourses.currentCourseId,mode:"withCount",conreqcsr:csrfToken};$.post("/batchAction.zp",l,(function(t){lmsbatches.selectBatchMenu(t[1].batchData,e)}))},selectBatchMenu:function(e,t){var s={},r=[];$.each(e,(function(e,t){(s={})[t.batchId]=[t.batchName],r.push(s)})),lmsmenu.initiate({elem:t.target,width:"130px",type:"dropdown",arrowHead:!0,menulist:r,eve:t}).on("close",(function(){lmscourses.tempCourseId=null})).on("click",(function(){lmsbatches.assignBatch(this.value)})).bind()},selectUser:function(e){$(e).toggleClass("zp_gclr"),$("#allUser").find("i").each((function(){lmsbatches.selectUser={},1==$(this).hasClass("IC-cbox zp_gclr")&&(lmsbatches.selectUser.userId=$(this).attr("_user"),lmsbatches.selectUserArr.push(lmsbatches.selectUser))}))},selectAllUser:function(e){$(e).toggleClass("zp_gclr"),$("#allUser").find("i").toggleClass("zp_gclr"),$("#allUser").find("i").each((function(){lmsbatches.selectUser={},1==$(this).hasClass("IC-cbox zp_gclr")&&(lmsbatches.selectUser.userId=$(this).attr("_user"),lmsbatches.selectUserArr.push(lmsbatches.selectUser))}))},closePopup:function(){$(".zp_popup").hide(),$(".zp_msk").hide()},assignBatch:function(e){var t=JSON.stringify(lmsbatches.selectUserArr),s={method:"assignBatch",batchId:e,courseId:lmscourses.currentCourseId,usersIds:t,conreqcsr:csrfToken};$.post("/batchAction.zp",s,(function(e){}))},getPopupBatch:function(e,t,s,r,l){if(0==$(".zp_CBedt").length&&1!=s){$('<ul class="zp_CBedt" id="listofBatches"></ul>').insertBefore("#coursebatch")}if(lmsbatches.batchList=document.getElementById("listofBatches"),null==lmscoursedetails.allbatchData||"clone"==l){var a={method:"getBatchWithCnt",courseId:lmscourses.currentCourseId,conreqcsr:csrfToken};$.post("/batchAction.zp",a,(function(l){lmsbatches.batchData=l[1].batchData,"visit"!=e&&1!=s||lmsbatches.viewBatches(l[1].batchData,t,s,r)}))}else"visit"!=e&&1!=s||lmsbatches.viewBatches(lmscoursedetails.allbatchData,t,s,r)},getAllBatches:function(e,t,s,r){if(0==$(".zp_CBedt").length&&1!=s){$('<ul class="zp_CBedt" id="listofBatches"></ul>').insertBefore("#coursebatch")}if(lmsbatches.batchList=document.getElementById("listofBatches"),null==lmsbatches.batchData){var l={method:"getBatchWithCnt",courseId:lmscourses.currentCourseId,conreqcsr:csrfToken};$.post("/batchAction.zp",l,(function(e){lmsbatches.batchData=e[1].batchData,null!=e[1]&&""!=e[1]&&null!=e[1].batchData&&""!=e[1].batchData?($(".zp_STbx").hide(),lmsbatches.batchesListfrform(e[1].batchData,t)):lmsbatches.getAddHtml("add")}))}else null!=lmsbatches.batchData&&""!=lmsbatches.batchData?($(".zp_STbx").hide(),lmsbatches.batchesListfrform(lmsbatches.batchData,t)):lmsbatches.getAddHtml("add")},viewBatches:function(e,t,s,r){if(1!=s){$(".zp_msk").html(""),$(".zp_msk").show();var l='<div class="zp_popup" id="zp_popfrtn" style="width: 600px"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.batches.list")+'</font> <i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'" onclick="lmsbatches.closebatch(event,this)"></i></div>';l+='<div class="zp_Pocnt" style="max-height: 500px;" ><ul class="zp_CPlst zp_CSwtb">'}$.each(e,(function(e,r){if(lmsbatches.currentBatchData[r.batchId]=r,1!=s){var a="";if(r.batchId==t&&(a="sel"),l+='<li class="'+a+'" onclick="lmsbatches.visitBatch(\''+r.batchId+"')\"><h4>"+r.batchName+"</h4>",""!=r.startDate&&""!=r.endDate){var n="",i="";r.startDate&&(n=lmsmodule.getDateDisplayFormatWithoutTime(new Date(r.startDate.parseDate(lmsbase._userDForm)))),r.endDate&&(i=lmsmodule.getDateDisplayFormatWithoutTime(new Date(r.endDate.parseDate(lmsbase._userDForm)))),l+="<a>"+n+" To "+i+"</a> <span> "+r.batchCompleteState+" </span></li>"}}})),1!=s&&(l+="</ul></div></div>",$(".zp_msk").append(l)),1==s&&lmsmodule.cloneModule.constructEntityDate(r)},visitBatch:function(e){var t=lmsbatches.currentBatchData[e],s=t.batchName,r=(e=t.batchId,t.batchName);lmsmembers.availableCntdata=null,lmscourses.currentBatchId=e,lmscourses.currentBatchName=s,lmscourses.currentBatchAdmin=r,lmsbatches.closebatch();var l="course/"+lmscourses.currentCourseId+"/batch/"+e+"/"+lmscourses.selectedTab;lms.changeHash("hash",l,"enable","view"),lmscoursedetails.currentCourseData=null},closebatch:function(){$(".zp_msk").hide(),$(".zp_popup").hide()},completeBatch:function(e,t,s,r){r=r||{};var l="";if("Completed"==t||lmscoursedetails.isComplete)l=0,$('[_rel="markComplete"]').find("div").text(ZPI18N.getString("zp.lms.markasuncomplete")),lmscoursedetails.isComplete=!0;else{if(!r.endDateWarningNotRequired){var a=lms_pre_and_post_course_activities.getCurrentCourseInfo();if(a&&a.batchEndDateAsMillis&&Date.now()<a.batchEndDateAsMillis&&!a.batchEndDateNotReachedConfirmation)return void lmsnotify.show({header:ZPI18N.getString("zp.lms.batch.complete.enddate.warning.header"),body:ZPI18N.getString("zp.lms.batch.complete.enddate.warning.description",["<b>"+a.endDate+"</b>"]),button_text:ZPI18N.getString("zp.yes"),texttype:"negative",successCallback:function(){this.status&&(a.batchEndDateNotReachedConfirmation=!0,lmsbatches.completeBatch(e,t,s,{endDateWarningNotRequired:!0}))}})}l=1,$('[_rel="markComplete"]').find("div").text(ZPI18N.getString("zp.markascomplete")),lmscoursedetails.isComplete=!1}var n={method:"batchComplete",courseId:lmscourses.currentCourseId,batchId:lmscourses.currentBatchId,status:l,conreqcsr:csrfToken};$.post("/batchAction.zp",n,(function(e){"PENDING_ENTITIES"!=e[1].error?"Completed"==e[1].message?($('[_rel="markComplete"]').find("div").text("zp.lms.markasuncomplete"),lmscoursedetails.isComplete=!0,lmscoursedetails.currentCourseData=null,lmscoursedetails.initObj.mode="update",lmscoursedetails.initiate.call(lmscoursedetails.initObj)):($('[_rel="markComplete"]').find("div").text(ZPI18N.getString("zp.markascomplete")),lmscoursedetails.currentCourseData=null,lmscoursedetails.initObj.mode="update",lmscoursedetails.initiate.call(lmscoursedetails.initObj)):lmsmodule.constructUnmarkedEntitiesView(lmscourses.currentCourseId,lmscourses.currentBatchId)}))},batchesListfrform:function(e,t){lmsbatches.editBatchId="",$("#listofBatches").find("li").remove();for(var s='<li id="createNewbatch"><div class="zp_EBlst"> <span onclick="lmsbatches.getFormComponents(this,\'createNew\',\''+t+'\')"><i class="IC-plus"></i>'+ZPI18N.getString("zp.lms.batces.CreateBatch")+"</span></div></li>",r=e.length-1;r>=0;r--){data=e[r];var l="",a="";data.startDate&&(l=lmsmodule.getDateDisplayFormatWithoutTime(new Date(data.startDate.parseDate(lmsbase._userDForm)))),data.endDate&&(a=lmsmodule.getDateDisplayFormatWithoutTime(new Date(data.endDate.parseDate(lmsbase._userDForm)))),s+='<li id="batch_'+data.batchId+'"><div class="zp_EBlst"><div><label><h3>'+data.batchName+"</h3><b>( "+data.allowedRegistrations+" ) "+ZPI18N.getString("zp.lms.batches.Capacity")+"</b></label> <label><p>"+l+" - "+a+"</p><p>"+data.locationName+"</p></label></div>",s+='<font> <i class="IC-edit" onclick="lmsbatches.editBatch(this,\''+data.batchId+"','"+data.type+"','"+t+"')\"></i>",0===data.memberCount&&(s+='<i class="IC-trash" type="'+data.type+'" data-ttip="'+ZPI18N.getString("zp.lms.delete")+'" onclick="lmsbatches.deleteBatch(\''+data.batchId+"')\"></i>"),s+="</font></div></li>"}$("#listofBatches").append(s)},editBatch:function(e,t,s,r){lmssessions.getSessionList("new"),""!=lmsbatches.prevBatchId&&($("#batch_"+lmsbatches.prevBatchId).find(".zp_EBlst").show(),$("#batch_"+lmsbatches.prevBatchId).find(".zp_STbx").remove()),lmsbatches.prevBatchId=t,lmsbatches.editBatchId=t,$("#batch_"+t).show();var l={method:"getBatchDetails",courseId:lmscourses.currentCourseId,batchId:t,conreqcsr:csrfToken};$.post("/batchAction.zp",l,(function(s){lmsbatches.editDetails=s[1],lmsbatches.convertEditDetails(),lmsbatches.getNewBatchHtml(e,"edit",r,s[1],t)}))},deleteBatch:function(e){if("1"===Layout.Page.container.find("#batch_"+e).find(".IC-trash").attr("type"))ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.batches.systembatchcantsel"));else{var t={method:"getAvailableCntfrRegistration",courseId:lmscourses.currentCourseId,batchId:e,mode:"trainer",conreqcsr:csrfToken};$.post("/batchAction.zp",t,(function(t){var s="";if(null!=t[1]&&null!=t[1].memberCount&&0!=t[1].memberCount)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.members.MembersAvailable"));else{s=null!=t[1]&&t[1].isBatchPublished?ZPI18N.getString("zp.lms.batces.alreadypublished"):null!=t[1]&&null!=t[1].totalEntityCnt&&0!=t[1].totalEntityCnt?ZPI18N.getString("zp.lms.batches.batchEntity"):"Are you sure want to delete this batch?";var r=lmsbase.courseBatchId;lmsbatches.params={mode:"deleteRecords",recordIds:e,courseId:lmscourses.currentCourseId,formId:r,conreqcsr:csrfToken},lmsnotify.show({header:s,body:"This action will permanently delete the batch and cannot be undone.",button_text:"Delete Batch",texttype:"negative",successCallback:function(){this.status&&lmsbatches.confirmDeleteBatch()},cancelCallback:function(){}})}}))}},confirmDeleteBatch:function(){$.post("/formAction.zp",lmsbatches.params,(function(e){if(7e3==e.code){var t={method:"getBatchWithCnt",courseId:lmscourses.currentCourseId,conreqcsr:csrfToken};$.post("/batchAction.zp",t,(function(e){lmsbatches.batchesListfrform(e[1],lmsbatches.params.recordIds),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.batches.batchdel"))}))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.batches.batchnotdel"))}))},convertEditDetails:function(){var e={};void 0!==lmsbatches.editDetails&&(e.lms_BatchName=lmsbatches.editDetails.batchName,e.lms_BatchAdmin=lmsbatches.editDetails.batchAdminId,e.lms_Location=lmsbatches.editDetails.locationName,e.lms_batchStartDate=lmsbatches.editDetails.startDate,e.lms_batchEndDate=lmsbatches.editDetails.endDate,e.lms_batchCapacity=lmsbatches.editDetails.allowedRegistrations),lmsbatches.editDetails=e},getFormComponents:function(e,t,s,r,l){if(null==lmsbatches.formComponents){var a={formId:lmsbase.courseBatchId,courseId:lmscourses.currentCourseId,mode:"getFormComponents",conreqcsr:csrfToken};$.post("/formAction.zp",a,(function(a){7e3===a.code&&(lmsbatches.formComponents=a.message.formComponentDetails,lmsbatches.getNewBatch(e,t,s,r,l))}))}else lmsbatches.getNewBatch(e,t,s,r,l)},getNewBatchHtml:function(e,t,s,r,l){null==lmsbatches.formComponents?lmsbatches.getFormComponents(e,t,s,r,l):lmsbatches.getNewBatch(e,t,s,r,l)},getNewBatch:function(e,t,s,r,l){lmsform.currentFormId=lmsbase.courseBatchId;var a=lmsbatches.formComponents;if($("#coursebatch").removeClass("zp_STbx"),$("#coursebatch").html(""),$("#coursebatch").show(),""!=lmsbatches.prevBatchId&&($("#batch_"+lmsbatches.prevBatchId).find(".zp_EBlst").show(),$("#batch_"+lmsbatches.prevBatchId).find(".zp_STbx").remove()),"edit"==t)"DIV"==$("#createNewbatch")[0].nextSibling.tagName&&$("#createNewbatch")[0].nextSibling.remove();else if(null!=$("#createNewbatch")[0]&&"DIV"==$("#createNewbatch")[0].nextSibling.tagName)return;lmsbatches.sectionId=s,lmsbatches.isNewBatch=!0;if(r)({componentName:"lms_CourseAdmin",componentType:"26",componentValue:r.batchAdmin,componentValue_ID:n,displayName:"Course Admin",displayType:"100",formComponentId:o,isEditable:!0});else{var n,i="";$.each(lmscourses.usersOptions,(function(e,t){t.Id==erecno&&(i=t.Value,n=t.trainerId)}));var o="";({componentName:"lms_CourseAdmin",componentType:"26",componentValue:i,componentValue_ID:erecno,displayName:"Course Admin",displayType:"100",formComponentId:o,isEditable:!0})}$("#listnew").hide();i=a[0].column1[1];var c=a[0].column1[2],d=a[0].column1[3],m=(a[0].column1[4],a[0].column1[5]),u=a[0].column1[6],p=[],g="",f=[],v=[],h="",b=0;"edit"==t&&null!=r?(p={componentName:"lms_batchName",componentType:"1",componentValue:r.batchName,displayName:"Batch Name",isEditable:!0},g={componentName:"lms_batchSdate",componentType:"10",componentValue:r.startDate,displayName:"Batch Start Date",isEditable:!0},f={componentName:"lms_batchEdate",componentType:"10",componentValue:r.endDate,displayName:"Batch End Date",isEditable:!0},v={componentName:"lms_ILTLocation",componentType:"26",displayType:"100",componentValue_ID:r.locationId,componentValue:r.locationName,displayName:"Location",isEditable:!0,formComponentId:""},h={componentName:"lms_batchRegistrationCount",componentType:"1",componentValue:r.allowedRegistrations,displayName:"Capacity",isEditable:!0},b=1):(p={componentName:"lms_batchName",componentType:"1",componentValue:"Untitled",displayName:"Batch Name",isEditable:!0},h={componentName:"lms_batchRegistrationCount",componentType:"1",componentValue:30,displayName:"Capacity",isEditable:!0},b=0,lmsbatches.editDetails={lms_BatchName:"Untitled",batchAdminId:[],locationName:[],startDate:"",endDate:"",allowedRegistrations:""});var I='<div class="zp_STbx"><header><h2 id="header_sec">'+ZPI18N.getString("zp.lms.batches.Batches")+"</h2></header>";I+='<div class="zp_STfld"><div><h4 class="zp_mdt">'+ZPI18N.getString("zp.lms.batches.BatchName")+"</h4><p>"+ZPI18N.getString("zp.lms.batchnamedesc")+'<p></div><div class="zp_Sm">'+lmsform.insertField(i,"","","",p)+"</div></div>",I+='<div class="zp_STfld"><div><h4>'+ZPI18N.getString("zp.date")+"</h4><p>"+ZPI18N.getString("zp.lms.batchdatedesc")+'</div><div class="zp_Sm zp_cs4"><label>'+ZPI18N.getString("zp.lms.sessions.startdate")+"</label>"+lmsform.insertField(c,"","",0,g)+'</div><div class="zp_Sm zp_cs4"><label>'+ZPI18N.getString("zp.lms.batches.EndDate")+"</label>"+lmsform.insertField(d,"","",1,f)+"</div></div>",I+='<div class="zp_STfld"><div><h4>'+ZPI18N.getString("zp.lms.batches.Location")+"</h4><p>"+ZPI18N.getString("zp.lms.course.BLocation")+"</p></div>"+lmsform.insertField(m,"","","",v,"","zp_Sm")+"</div>",I+='<div class="zp_STfld"><div><h4 class="zp_mdt">'+ZPI18N.getString("zp.lms.batches.Capacity")+"</h4><p>"+ZPI18N.getString("zp.lms.course.RegistrationCount")+'</p></div><div class="zp_Sm">'+lmsform.insertField(u,"","","",h)+"</div></div>","edit"==t&&(I+=lmsformcomponents.hiddenField("zp_recordId",lmsbatches.editBatchId)),I+=lmsformcomponents.hiddenField("zp_tableName","P_LMSCourseBatches"),I+=lmsformcomponents.hiddenField("zp_formId",lmsbase.courseBatchId),I+='<div class="zp_btn">',""!==t&&(I+='<button class="zpactn zp_actn" id="cancleBatch" onclick="lmsbatches.close(\''+t+"');\">"+ZPI18N.getString("zp.lms.cancel")+"</button>"),I+=lmsform.insertField("submit",lmsbatches.updateBatchDetails,ZPI18N.getString("zp.lms.submit"),b)+"</div></div>","edit"==t?($("#batch_"+l).find(".zp_EBlst").hide(),$("#batch_"+l).append(I)):0==$(".zp_CBedt").length||"createNew"==t?(lmsbatches.editBatchId="",$("#createNewbatch").after(I)):$("#coursebatch").append(I),lmsformcomponents.bind(),$("#cancleBatch").click((function(){$("#sectionsList_"+lmscourses.currentSectionId).click()})),$("#create_batch").click((function(){$(this).hide(),lmsbatches.updateBatchDetails()}))},close:function(e){$("#batch_"+lmsbatches.prevBatchId).find(".zp_EBlst").show(),"createNew"==e?$("#listofBatches").find(".zp_STbx").remove():"edit"==e&&$("#batch_"+lmsbatches.prevBatchId).find(".zp_STbx").remove()},updateBatchDetails:function(e,t,s){if(lmsbatches.params=e,lmsbatches.mode=t,lmsbatches.flag=s,null!=lmssessions.sessionData&&null!=lmsbatches.editDetails&&(null!=lmsbatches.editDetails.lms_batchStartDate&&lmsbatches.editDetails.lms_batchStartDate!=e.lms_batchStartDate||null!=lmsbatches.editDetails.lms_batchEndDate&&lmsbatches.editDetails.lms_batchEndDate!=e.lms_batchEndDate)){var r=ZPeople.decodeTxt(lmssessions.sessionData[lmscourses.currentCourseId][0].sessionStartDate).parseDate(lmsbase._userDForm),l=ZPeople.decodeTxt(e.lms_batchStartDate).parseDate(lmsbase._userDForm),a=ZPeople.decodeTxt(e.lms_batchEndDate).parseDate(lmsbase._userDForm);l<=r&&r<=a||lmscoursedetails.currentCourseData[0].isBatchPublished?l<=r&&r<=a||!lmscoursedetails.currentCourseData[0].isBatchPublished?lmsbatches.confirmUpdateBatchDetails():ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.batces.batchalreadypublished")):lmsnotify.show({header:"Are you sure want to edit this batch?",body:ZPI18N.getString("zp.lms.batces.batchcantedit"),button_text:"Save Batch",texttype:"positive",successCallback:function(){this.status&&lmsbatches.confirmUpdateBatchDetails()},cancelCallback:function(){}})}else lmsbatches.confirmUpdateBatchDetails()},confirmUpdateBatchDetails:function(){var e="";""!=lmsbatches.editBatchId&&(e=lmsbatches.editBatchId),lmsbatches.params.lms_BatchCourseId=lmscourses.currentCourseId,lmsbatches.params.courseId=lmscourses.currentCourseId;var t={method:"getAvailableCntfrRegistration",courseId:lmscourses.currentCourseId,batchId:e,mode:"trainer",conreqcsr:csrfToken};$.post("/batchAction.zp",t,(function(e){"createNew"==lmsbatches.openMode||0==e[1].message||lmsbatches.params.lms_batchCapacity>=e[1].memberCount?$.post("/addUpdateRecord.zp",lmsbatches.params,(function(e){"7000"==e[0].code&&lmsbatches.flag?(lmsbatches.editDetails=lmsbatches.params,"addRecord"==lmsbatches.params.zp_mode?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.batces.csuccess")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.batches.batcheditedsucc"))):lmsbatches.flag&&("addRecord"==lmsbatches.params.zp_mode?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.batches.cannotadd")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.batches.cannotedit"))),"7000"!=e[0].code||lmsbatches.flag?lmsbatches.flag||ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.batches.cannotadd")):(lmsbatches.editDetails=lmsbatches.params,"addRecord"==lmsbatches.params.zp_mode?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.batces.csuccess")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.batches.batcheditedsucc")),lmsbatches.batchData=null,lmsbatches.getAllBatches(lmsbatches.mode,lmsbatches.sectionId),lmsmembers.availableCntdata=null)})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.cannotaddbatchcapcity"))}))},saveAlertBatch:function(){var e=lmsform.formvalidate("",0,1);if(lmsbatches.params=e,e.lms_BatchCourseId=lmscourses.currentCourseId,""!=lmsbatches.editDetails&&null!=e.lms_BatchName)for(var t in lmsbatches.editDetails)if(lmsbatches.editDetails[t]!=e[t])return void lmsnotify.show({header:"Are you sure want to save this batch?",body:ZPI18N.getString("zp.lms.course.coursesavereq"),button_text:"Save Batch",texttype:"positive",successCallback:function(){this.status&&lmsbatches.saveBatch()},cancelCallback:function(){}})},saveBatch:function(){lmsbatches.batchData=null,lmsbatches.updateBatchDetails(lmsbatches.params,"",1)}},lmscourseoverview={currentCourseInfoId:"",isCourseAdmin:"",startIndex:1,totalActivityCount:0,initiate:function(e){lmscourses.tabName;lmscourseoverview.startIndex=1,$.each(e,(function(e,t){lmscourseoverview.isCourseAdmin=t.isCourseAdmin,lmsbase.isCourseAdmin(t.courseType,t)||t.iscourseTrainer||t.isSharedCourse||!isadmin&&null!=t.isJoined&&1==t.isJoined||1==t.isUserGroupBased?lmscourseoverview.courseOverViewAfterJoin(t):lmscourseoverview.courseOverViewBeforeJoin(t)}))},courseOverViewBeforeJoin:function(e){if("courseDetails"==e.courseInfo){$(".zp_Tabs").remove(),$('[data-id="courseView"]').html("");lmscourses.tabName,e.isJoined;var t="";t=0!=e.introFiles.length?'<div class="zp_Cinf ">':'<div class="zp_Cinf">',t+='<div class="zp_CIlft">',lmscourseoverview.aboutCourse||(lmscourseoverview.aboutCourse=e.aboutCourse),""!=e.learn&&(t+='<div class="zp_ACinf sel" _rel = "learningOut" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+ZPI18N.getString("zp.lms.course.overview")+'"><div class="zp_CPdes" tabindex="0">',t+=ZPFeeds.Activity.validateContent(ZPeople.decodeTxt(lmscourseoverview.aboutCourse),!0)+"</p></div></div>"),t+="</div>",t+='<div class="zp_CIrgt">',0!=e.introFiles.length&&(t+='<div class="zp_CIvd" id="getIcon">',t+="</div>"),t+='<div class="zp_Ctbl"><ul><li>'+lmsfeedback.getStarHtml(e.courseRating,"",1,11).outerHTML+"</li>",e.totalArticleCnt>0&&(t+="<li><b>"+e.totalArticleCnt+"</b> "+ZPI18N.getString("zp.lms.materials")+"</li>"),""!=e.joinedCount&&null!=e.joinedCount&&(t+="<li><b>"+e.joinedCount+"</b> "+ZPI18N.getString("zp.lms.course.joined")+"</li>"),t+="</ul></div>",t+='<div class="zp_Ctbl"><ul class="zp_Cjnd" role="list">',"2"==e.courseType?e.allbatches.length>0&&(null==e.allbatches[0]||1!=e.allbatches[0].isCommonRequest&&4!=e.allbatches[0].stateType?$.each(e.allbatches,(function(s,r){5==e.stateType?(t+='<li> <div><i class="IC-time-duration"></i> <h4>'+r.batchName+"</h4> <font><p>"+r.startDate+" - "+r.endDate+"</p> ",null!=r.locationName&&(t+=r.locationName),t+="</font> <span><b>"+r.availableCount+"</b>  "+ZPI18N.getString("zp.lms.availableseats")+"</span></div>",t+="<p>"+r.courseState+"</p>",t+="</li>"):(t+='<li role="listitem" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+lmscourseoverview.getBatchListLabel(r,e.isJoined)+'"> <div><i class="IC-time-duration"></i> <h4>'+r.batchName+"</h4> <font><p>"+r.startDate+" - "+r.endDate+"</p>",null!=r.locationName&&(t+=r.locationName),t+="</font> <span><b>"+r.availableCount+"</b>  "+ZPI18N.getString("zp.lms.availableseats")+"</span></div>","Completed"==r.batchCompleteState?t+="<p>"+r.courseState+"</p>":0!=r.isWaitlistAllowed||0==r.availableCount||3!=r.stateType&&15!=r.stateType?3==r.stateType||15==r.stateType?("0"!=r.availableCount||1!=r.isWaitlistAllowed||3!=r.stateType&&15!=r.stateType)&&(0==r.availableCount||3!=r.stateType&&15!=r.stateType)?t+="<p>"+r.courseState+"</p>":t+='<p id="register_'+e.batchId+'" _batchrel="'+r.batchId+'">'+r.courseState+"</p>":t+="<p>"+r.courseState+"</p>":t+='<p id="register_'+r.batchId+'" _batchrel="'+r.batchId+'" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" role="button">'+r.courseState+"</p>",t+="</li>")})):4==e.allbatches[0].stateType?t+="<li><p>"+e.allbatches[0].courseState+"</p></li>":1==e.allbatches[0].isCommonRequest&&(t+="<li><label><h4>"+ZPI18N.getString("zp.lms.course.registrationclosed")+'</h4></label><p id="register_'+e.batchId+'" _batchrel="'+e.batchId+'">'+e.allbatches[0].courseState+"</p></li>")):lmsbase.isCourseAdmin(e.courseType,e,"join")?t+="<li><p>"+e.courseState+"</p></li>":t+='<li><p id="selfbasedregister_'+e.courseId+'" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" role="button">'+e.courseState+"</p></li>",t+="</ul></div>";var s=0;t+='<div id="coursefea"><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.course.coursefeatures")+'</div><div class="zp_grdwgt"><ul>',t+="<li>",null!=e.duration&&""!=e.duration&&(lmscoursedetails.isDuration=!0,s=1,t+='<li><font> <i class="IC-rou-clk"></i>'+ZPI18N.getString("zp.lms.duration")+"</font> <span>"+e.durationVal+" "+lmsFormConstants.getValue(e.durationType)+" <i></i></span></li>"),t+="</ul></div></div>",t+='<div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.content.Createdby")+'</div><ul class="zp_CPlst">',t+='<li><div class="ZP_photo" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src="'+e.courseOwnerInfo[0].photoPath+'"></div><h4><i>'+e.courseOwnerInfo[0].employeeId+"</i>"+e.courseOwnerInfo[0].name+"</h4><a>"+e.coursecreateddate+"</a></li></ul></div>",null!=e.trainers&&(t+='<div><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.base.Trainers")+'</div><ul class="zp_CPlst">',$.each(e.trainers,(function(e,s){t+='<li><div class="ZP_photo" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src="'+s.trainerImage+'"></div><h4><i>'+s.trainerEmployeeId+" </i>"+s.trainerName+"</h4> <a>"+s.trainerDesignation+"</a></li>"})),t+="</ul></div>"),1==e.isPublished&&"3"!==e.courseType&&(t+='<div class="zp_Ctbl" id="suggestFrnd"> <span onclick="">'+ZPI18N.getString("zp.lms.suggestAfriend")+"</span> </div>"),t+="</div>",t+="</div>",$('[data-id="courseView"]').append(t);var r=$("#getIcon"),l=e.introFiles;if(l&&l.length>0){r.append(lmscourseoverview.getIntroFilesHTMLBeforeJoin(l[0]));for(var a=0;a<l.length;a++)l[a].additionalInfo={fileId:l[a].resourceId,type:5};r.click((function(e){if(e.target.closest("[introfile]")){for(var t=0,s=[];t<l.length;t++)s.push(lmsattachment.getPreviewObject(l[t]));var r={allow:["fullmode"],autoplay:!0,useDashPlayer:!1,startIndex:0,items:s};zplightbox_introFiles.initiate(r).bind()}}))}0==s&&$("#coursefea").hide();null!=e.batchId&&""!=e.batchId&&e.batchId,"2"==e.courseType?1==e.isPublished&&$("[id^=register_]").click((function(){var t=$(this).attr("_batchrel");lmscourseoverview.courseOverviewRegister(e.courseId,t,this,e.type)})):1!=e.isPublished||3!=e.stateType&&15!=e.stateType||$("#selfbasedregister_"+e.courseId).click((function(){lmscourseoverview.courseOverviewRegister(e.courseId,"",this,e.type)})),"3"!==e.courseType&&$("#suggestFrnd").click((function(){lmscourses.shareCourse.showAddUserShareOrSuggest(e.courseId,"suggest")})),$("#waitListuser").click((function(){lmsbatches.getWaitinglist(e.courseId)}))}},courseOverViewAfterJoin:function(e){lmscourses.tabName,e.isJoined;$('[data-id="courseView"]').html("");var t='<div class="zp_Cinf zp_Cinfx">';t+='<div class="zp_CIlft">',t+='<div><div _rel = "editCoursedetails">',"<div><br /></div>"!=ZPeople.decodeTxt(e.aboutCourse)&&"<div><br /></div>"!=ZPeople.decodeTxt(lmscourseoverview.aboutCourse)||(lmscourseoverview.aboutCourse=lmscourseconfig._abtCoursetemp),lmscourseoverview.aboutCourse||(lmscourseoverview.aboutCourse=e.aboutCourse),lmscourseoverview.aboutCourse&&(t+='<div class="zp_ACinf sel" _rel = "learningOut" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+ZPI18N.getString("zp.lms.course.overview")+'"><div class="zp_CPdes" tabindex="0">',(isadmin||lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0]))&&(t+='<i  _rel= "icpen" class="IC-pen"></i>'),t+=ZPFeeds.Activity.validateContent(ZPeople.decodeTxt(lmscourseoverview.aboutCourse),!0)+"</p></div></div>"),t+="</div></div>",e.recentActivity.length>0&&(t+='<div><div class="zp_gy">',t+='<div class="zp_crAcvt">',t+='<div class=""><div><i class="IC-adit-his"></i><div class="zp_Pdtls"> <h4>'+ZPI18N.getString("zp.lms.recActivity")+"</h4></div></div></div>",$.each(e.recentActivity,(function(e,s){$.each(s,(function(e,r){var l="";if(lmscourseoverview.totalActivityCount="count"==e?r:null,null!=r.moduleName)if("content"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.content[0].name,t+='<div class=""><div><i class="IC-notes"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Fileadded")+" <em> "+r.Name+"</em></h4>";var a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("editableContent"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.editableContent[0].name,t+='<div class=""><div><i class="IC-cnt3"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Contentadded")+": <em> "+r.Name+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("link"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.link[0].name,t+='<div class=""><div><i class="IC-lnk"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Linkadded")+" <em> "+ZPeople.decodeTxt(r.Name)+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("test"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.test[0].name,t+='<div class=""><div><i class="'+(r.testType&&"1"==r.testType?"IC-OT":"IC-CT")+'"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview."+(r.testType&&"1"==r.testType?"online":"offline")+"Testadded")+"<em> "+ZPeople.decodeTxt(r.Name)+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("assignment"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.assignment[0].name,t+='<div class=""><div><i class="IC-assignment"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Assignmentadded")+" <em> "+ZPeople.decodeTxt(r.Name)+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("session"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.session[0].name,t+='<div class=""><div><i class="IC-adit-his"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Sessionadded")+" <em> "+ZPeople.decodeTxt(r.Name)+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("message"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):r.postedBy,t+='<div class=""><div>',t+='<div class="ZP_photo" title="'+r.Name+'"><img src="'+r.empPhoto+'"></div>',t+='<div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Discussionstarted")+"<em> "+r.Name+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("scorm"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.scorm[0].name,t+='<div class=""><div><i class="IC-ei-scorm"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.scormadded")+" <em> "+r.Name+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}}))})),t+="</div>",t+="</div></div>"),t+="</div>";var s,r=0,l=0,a=0;if(t+='<div class="zp_CIrgt" id="rghtData">',e.isUserGroupBased&&(lmscoursedetails.isUserJoined=e.isUserGroupBased),("3"!==e.courseType&&!e.isJoined||1==lms.role&&("1"==e.courseType&&lms.selfSettingData.isSelfenable&&lms.selfSettingData.isTrainerCanAdd||"2"==e.courseType&&lms.iltSettingData.isIltenable&&lms.iltSettingData.isTrainerCanAdd))&&(t+='<div class="zp_Ctbl"><ul class="zp_Cjnd" role="list">',null!=e.joinedCount||"2"==e.courseType&&null!=e.allbatches&&e.allbatches[0]&&e.allbatches.length>0?(r=1,null!=e.allbatches[0]&&(1==e.allbatches[0].isCommonRequest||null!=e.allbatches[0].stateType&&4==e.allbatches[0].stateType)?4==e.allbatches[0].stateType?t+='<li><p rel="coursestate">'+e.allbatches[0].courseState+"</p></li>":1==e.allbatches[0].isCommonRequest&&(t+="<li><label><h4>"+ZPI18N.getString("zp.lms.course.registrationclosed")+'</h4></label><p id="register_'+e.batchId+'" _batchrel="'+e.batchId+'" rel="coursestate">'+e.allbatches[0].courseState+"</p></li>"):$.each(e.allbatches,(function(s,r){e.isJoined?r.requestedBatchId==r.batchId&&(t+='<li role="listitem" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+lmscourseoverview.getBatchListLabel(r,e.isJoined)+'"> <div><i class="IC-time-duration"></i> <h4 title="'+r.batchName+'">'+r.batchName+"</h4> <font><p>"+r.startDate+" - "+r.endDate+"</p>",null!=r.locationName&&(t+=r.locationName),t+="</font> <span><b>"+r.availableCount+"</b>  "+ZPI18N.getString("zp.lms.availableseats")+"</span></div>",t+="<p>"+r.courseState+"</p>"):(t+='<li role="listitem" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+lmscourseoverview.getBatchListLabel(r)+'"> <div><i class="IC-time-duration"></i> <h4 title="'+r.batchName+'">'+r.batchName+"</h4> <font><p>"+r.startDate+" - "+r.endDate+"</p>",null!=r.locationName&&(t+=r.locationName),t+="</font>","Completed"!=r.batchCompleteState&&(t+="<span><b>"+r.availableCount+"</b>  "+ZPI18N.getString("zp.lms.availableseats")+"</span>"),t+="</div>",e.isJoined||lmsbase.isCourseAdmin(e.courseType,e,"join")?r.isBatchPublished&&0==r.isWaitlistAllowed&&""==r.availableCount?"Completed"==r.batchCompleteState?t+='<p rel="coursestate">'+ZPI18N.getString("zp.completed")+"</p>":t+='<p rel="coursestate">'+r.courseState+"</p>":r.isBatchPublished&&("0"==r.availableCount&&1==r.isWaitlistAllowed?t+='<p rel="coursestate">'+r.courseState+"</p>":0!=r.availableCount&&("Completed"==r.batchCompleteState?t+='<p rel="coursestate">'+ZPI18N.getString("zp.completed")+"</p>":t+='<p rel="coursestate">'+r.courseState+"</p>")):!r.isBatchPublished||0!=r.isWaitlistAllowed||0==r.availableCount||3!=r.stateType&&15!=r.stateType?r.isBatchPublished&&((3==r.stateType||15==r.stateType)&&("0"==r.availableCount&&1==r.isWaitlistAllowed||0!=r.availableCount)?t+='<p id="register_'+e.batchId+'" _batchrel="'+r.batchId+'" rel="coursestate">'+r.courseState+"</p>":t+='<p rel="coursestate">'+r.courseState+"</p>"):t+='<p id="register_'+r.batchId+'" _batchrel="'+r.batchId+'" rel="coursestate">'+r.courseState+"</p>",t+="</li>")}))):"1"==e.courseType&&(lmsbase.isCourseAdmin(e.courseType,e,"join")?t+='<li><p rel="coursestate">'+e.courseState+"</p></li>":t+='<li><p id="selfbasedregister_'+e.courseId+'" rel="coursestate">'+e.courseState+"</p></li>"),t+="</ul>",t+="</div>"),null!=e.introFiles&&e.introFiles.length&&(r=1,t+='<div><div class="zp_Pttl" id="intro_file">'+ZPI18N.getString("zp.lms.introfiles")+'</div><ul introfiles class="zp_Cfle" aria-labelledby="intro_file">',t+="</ul></div>"),null!=e.nextSession&&e.nextSession.startDateInMillis&&(l=1,s=e.nextSession.startTimeInMillis?ZPDateTime.getDateDisplayFormat(parseInt(e.nextSession.startDateInMillis)+parseInt(e.nextSession.startTimeInMillis)):ZPDateTime.getDateDisplayFormatWithoutTime(e.nextSession.startDateInMillis)),null!=s&&""!=s&&(t+='<div class="zp_CPinf" id="sessiondet"><ul>',null!=s&&""!=s&&(l=1,s.split(" ")[1]==ZPI18N.getString("zp.today")||s.split(" ")[1]==ZPI18N.getString("zp.yesterday")?t+=s?"<li><h5><p>"+ZPI18N.getString("zp.lms.sessions.upcomingSessions")+"</p><em>"+s+"</em></h5></li>":"":t+=s?"<li><h5><p>"+ZPI18N.getString("zp.lms.sessions.upcomingSessions")+"</p><em>"+e.nextSession.startDate+" "+s.split(" ")[3]+" "+s.split(" ")[4]+"</em></h5></li>":""),t+="</ul></div>"),t+='<div id="coursefea"><div class="zp_Pttl">'+ZPI18N.getString("zp.lms.course.coursefeatures")+'</div><div class="zp_grdwgt"><ul>',t+="<li>",null!=e.duration&&""!=e.duration&&(lmscoursedetails.isDuration=!0,a=1,t+='<li><font> <i class="IC-rou-clk"></i>'+ZPI18N.getString("zp.lms.duration")+"</font> <span>"+e.durationVal+" "+lmsFormConstants.getValue(e.durationType)+" <i></i></span></li>"),t+="</ul></div></div>",t+='<div tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+ZPI18N.getString("zp.lms.base.CourseDetails")+'"><div class="zp_Pttl" id="created_by">'+ZPI18N.getString("zp.lms.content.Createdby")+'</div><ul class="zp_CPlst" aria-labelledby="created_by">',t+='<li tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+e.courseOwnerInfo[0].name+'"><div class="ZP_photo" title="name of the person"><img src="'+e.courseOwnerInfo[0].photoPath+'"></div><h4 title="'+e.courseOwnerInfo[0].employeeId+"-"+e.courseOwnerInfo[0].name+'"><i>'+e.courseOwnerInfo[0].employeeId+"</i>"+e.courseOwnerInfo[0].name+"</h4><a>"+e.coursecreateddate+"</a></li></ul></div>",t+='<div><div class="zp_Pttl" id="course_admin">'+ZPI18N.getString("zp.lms.courseadmins")+'</div><ul class="zp_CPlst" aria-labelledby="course_admin">',e.courseAdminInfo&&($.each(e.courseAdminInfo,(function(e,s){3!=e&&(t+='<li tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+s.name+'"><div class="ZP_photo" title="name of the person"><img src="'+s.photoPath+'"></div><h4 title="'+s.employeeId+"-"+s.name+'"><i>'+s.employeeId+"</i>"+s.name+"</h4></li>")})),t+="</ul>",e.courseAdminInfo.length>3&&(t+='<div class="zp_anc" onclick="lmscourseoverview.openPopUp(\'courseAdmin\')">'+ZPI18N.getString("zp.lms.courseadminsviewlist")+"</div>"),t+="</div>"),r=1,null!=e.trainers&&(t+='<div><div class="zp_Pttl" id="trainer">'+ZPI18N.getString("zp.lms.trainers")+'</div><ul class="zp_CPlst" aria-labelledby="trainer">',e.trainers&&$.each(e.trainers,(function(e,s){r=1,e>2||(t+='<li tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+ZPI18N.getString("zp.local.Trainer")+" "+(e+1)+": "+s.trainerName+'"><div class="ZP_photo" title="'+ZPI18N.getString("zp.lms.trainers.nameofperson")+'"><img src="'+s.trainerImage+'"></div><h4 title="'+s.trainerEmployeeId+"-"+s.trainerName+'"><i>'+s.trainerEmployeeId+"</i>"+s.trainerName+"</h4> <a>"+s.trainerDesignation+"</a></li>")})),t+="</ul>",e.trainers.length>2&&(t+='<div class="zp_anc" onclick="lmscourseoverview.openPopUp(\'trainersview\')">'+ZPI18N.getString("zp.lms.trainersviewlist")+"</div>"),t+="</div>"),t+='<div class="zp_dyn" id="pre_course_activities_results"></div>',t+='<div class="zp_dyn" id="post_course_activities_results"></div>',1==e.isPublished&&"3"!==e.courseType&&(l=1,r=1,t+='<div class="zp_Ctbl" id="suggestFrnd"> <span onclick="">'+ZPI18N.getString("zp.lms.suggestAfriend")+"</span> </div>"),t+="</div>",t+="</div>",$('[data-id="courseView"]').append(t),null!=e.recentActivity){var n=document.querySelector(".zp_crAcvt");e.recentActivity.length-1==50&&lmscourseoverview.startIndex+50!=lmscourseoverview.totalActivityCount?"end"!=lmscourseoverview.startIndex&&(colRow='<div class="zp_memarw"  _crel = "nextpage"><div class="zp_anc" _rel="modnextPage">'+ZPI18N.getString("zp.lms.morerecords")+"</div></div>",n.innerHTML+=colRow,lmsbase.addListener(n.querySelector(".zp_memarw"),"click",lmscourseoverview.showMoreActivityData,!1)):lmscourseoverview.startIndex="end"}if(lmscourseoverview.editCourse=document.querySelector('[_rel="editCoursedetails"]'),lmscourseoverview.editCourse&&lmsbase.addListener(lmscourseoverview.editCourse,"click",lmscourseoverview.editCoursedetails,!1),"2"==e.courseType?1==e.isPublished&&$("[id^=register_]").click((function(){var t=$(this).attr("_batchrel");lmscourseoverview.courseOverviewRegister(e.courseId,t,this,e.type)})):1!=e.isPublished||3!=e.stateType&&15!=e.stateType||$("#selfbasedregister_"+e.courseId).click((function(){lmscourseoverview.courseOverviewRegister(e.courseId,"",this,e.type)})),null!=e.introFiles&&e.introFiles.length){var i=$("[introFiles]");$.each(e.introFiles,(function(e,t){i.append(lmscourseoverview.getIntroFilesHTMLAfterJoin(t))})),i.click((function(e){var t=e.target.closest("[introfile]");if(t){for(var s=0,r=[],l=t.parentNode.childNodes;s<l.length;s++){var a=l[s].previewObject?l[s].previewObject:l[s].previewObject=lmsattachment.getPreviewObject(l[s].fileInfo);r.push(a)}var n={allow:["fullmode"],autoplay:!0,useDashPlayer:!1,startIndex:0,items:r};zplightbox_introFiles.initiate(n).bind()}}))}if($("#waitListuser").click((function(){lmsbatches.getWaitinglist(e.courseId)})),"3"!==e.courseType&&$("#suggestFrnd").click((function(){lmscourses.shareCourse.showAddUserShareOrSuggest(e.courseId,"suggest")})),0==r?($("#rghtData").hide(),$("#coursefea").hide()):$("#rghtData").show(),0==l?$("#sessiondet").hide():$("#sessiondet").show(),0==a?$("#coursefea").hide():($("#rghtData").show(),$("#coursefea").show()),e.isJoined){var o=document.querySelector('[data-id="courseView"]');null!=e.post_course_activities_details&&o.insertBefore(lms_pre_and_post_course_activities.createPostCourseActivityView(e),o.firstChild)}lms_pre_and_post_course_activities_result.constructPreCourseActivitiesResultsView(e),lms_pre_and_post_course_activities_result.constructPostCourseActivitiesResultsView(e)},getBatchListLabel:function(e,t){var s;return s=isadmin||lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0])?`${e.batchName} ${ZPI18N.getString("zp.lms.batch.available")}, `:`${e.batchName} ${ZPI18N.getString("zp.lms.batch.batchavailable")}, `,s+=`${e.batchName} ${ZPI18N.getString("zp.starton")} ${e.startDate} ${ZPI18N.getString("zp.sto")} ${e.endDate}`,(!t||t&&"Completed"!==e.batchCompleteState)&&(s+=`, ${ZPI18N.getString("zp.lms.batch.availableseats")}: ${e.availableCount}`),s},openPopUp:function(e){$(".zp_msk").html("");var t="";"courseAdmin"===e?(t+='<div class="zp_popup" id="zp_popeight" style="width:600px"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.courseadminslist")+'</font><i class="IC-cls" onclick="lmscourseoverview.closePopUp()"></i></div><div class="zp_Pocnt" style="max-height:500px;"> <ul class="zp_CPlst">',$.each(lmscoursedetails.currentCourseData[0].courseAdminInfo,(function(e,s){t+='<li><div class="ZP_photo" title="name of the person"><img src="'+s.photoPath+'"></div><h4 title="'+s.employeeId+"-"+s.name+'"><i>'+s.employeeId+"</i>"+s.name+"</h4></li>"})),t+="</ul></div></div>"):"trainersview"===e&&(t+='<div class="zp_popup" id="zp_popeight" style="width:600px"><div class="zp_Pohd"><font>'+ZPI18N.getString("zp.lms.trainerslist")+'</font><i class="IC-cls" onclick="lmscourseoverview.closePopUp()"></i></div><div class="zp_Pocnt" style="max-height:500px;"> <ul class="zp_CPlst">',$.each(lmscoursedetails.currentCourseData[0].trainers,(function(e,s){t+='<li><div class="ZP_photo" title="name of the person"><img src="'+s.trainerImage+'"></div><h4 title="'+s.trainerEmployeeId+"-"+s.trainerName+'"><i>'+s.trainerEmployeeId+"</i>"+s.trainerName+"</h4></li>"})),t+="</ul></div></div>"),$(".zp_msk").append(t),$(".zp_msk").show()},closePopUp:function(){$(".zp_msk").hide()},editCoursedetails:function(e){var t=e.target;if("IC-argt"===t.getAttribute("class"))lmscourseoverview.aboutswitch(t);else if("IC-pen"==t.getAttribute("class")){var s=t.closest('[class="zp_ACinf sel"]');if(s){var r=s.getAttribute("_rel"),l={};"learningOut"==r?peopleeditor.initiate(l,"_learnOut",s):"aboutCourse"==r&&peopleeditor.initiate(l,"_aboutCourse",s)}}else"_learnOutsubmit"==t.getAttribute("_rel")?lmscourseoverview.submitCallback():"cancel"==t.getAttribute("_rel")&&lmscourseoverview.cancelCallback()},cancelCallback:function(){var e=lmscourseoverview.editCourse.querySelector('[_rel="learningOut"]');e.childNodes[0].remove();var t=document.createElement("div");t.setAttribute("class","zp_CPdes"),(isadmin||lmsbase.isCourseAdmin(lmscourses.selcourseSysVal,lmscoursedetails.currentCourseData[0]))&&(t.innerHTML+='<i  _rel= "icpen" class="IC-pen">'),t.innerHTML+=ZPeople.decodeTxt(lmscourseoverview.aboutCourse),e.appendChild(t);var s=lmscourseoverview.editCourse.querySelector('[_rel="icpen"]');s&&(s.style.display="block")},submitCallback:function(){var e={method:"updateCourseDetails"};e.learnOutcomes=peopleeditor.editor._learnOut.getContent(),e.conreqcsr=csrfToken;let t=ZPFeeds.removeTrailingEmptyDivs(e.learnOutcomes);t=ZPFeeds.getTextContent(t),t&&(e.learnOutcomes.length>5e3?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.leave.compensatory.descerror")):(e.courseId=lmscourses.currentCourseId,$.post("/courseAction.zp",e,(function(t){if("success"==t[1].message){var s=lmscourseoverview.editCourse.querySelector('[_rel="learningOut"]');s.childNodes[0].remove();var r=document.createElement("div");r.setAttribute("class","zp_CPdes"),"<div><br></div>"==e.learnOutcomes&&(e.learnOutcomes=lmscourseconfig._abtCoursetemp),r.innerHTML+='<i  _rel= "icpen" class="IC-pen">',r.innerHTML+=e.learnOutcomes,lmscourseoverview.aboutCourse=ZPeople.escapeHtml(e.learnOutcomes),s.appendChild(r),lmscourseoverview.editCourse.querySelector('[_rel="icpen"]').style.display="block"}else"failure"==t[1].message&&(ZPeople.Message.showFailureMsg("you don't have the permission"),lmscourseoverview.cancelCallback())}))))},aboutswitch:function(e){var t=e.closest("div");lmsbase.hasClass(t,"sel")?lmsbase.removeClass(t,"sel"):lmsbase.addClass(t,"sel")},courseOverviewRegister:function(e,t,s,r){var l="";""!=t&&null!=t&&(lmscourses.currentBatchId=t,l=t);var a={courseId:e,batchId:l,type:1};-1!==Layout.Page.hash.indexOf("/learningplan")&&(a.isFrom=1,lmslearningplan.addedPlanDetails.planInfo&&void 0!==lmslearningplan.addedPlanDetails.planInfo.planId&&(a.planId=lmslearningplan.addedPlanDetails.planInfo.planId)),zplms.post("lms/courses/users",a,(function(l){-1===Layout.Page.hash.indexOf("/learningplan")?1==l[1].registrationStatus?($(s).text(l[1].message),ZPeople.Message.showSuccessMsg(l[1].sucessmessage),"catalog"===lmscourses.currentPage&&lmscourses.changeOverViewHash(e,t,r,"disable","","mode"),lmscoursedetails.currentCourseData=null,lmscoursedetails.disableComponentData=null,lmscoursedetails.initiate(),lmscoursedetails.initObj.mode="update"):ZPeople.Message.showWarningMsg(l[1].message):1==l[1].registrationStatus?(document.querySelector('[id="course_'+e+'"]').querySelector('[rel="lpcourseadd"]').innerHTML='<span class="">'+ZPI18N.getString("zp.chkinprogress")+"</span>",document.querySelector('[_crel="course_'+e+'"]').setAttribute("_crel","course_"+e+"_"+lmscourses.currentBatchId)):ZPeople.Message.showWarningMsg(l[1].message)}))},getIntroFilesHTMLAfterJoin:function(e){e.fileType=lmsfileaction.getFileType(e.type,e.extension),e.additionalInfo={fileId:e.resourceId,type:5};var t=document.createElement("li");return t.setAttribute("introfile",""),t.setAttribute("tabindex",lmsConstants.TAB_INDEX.ACTIVE),t.setAttribute("role","link"),t.fileInfo=e,t.appendChild(lmsattachment.getDisplayIcon(e.fileType,1==e.sourceType?"ContentFile":"")),t.appendChild(document.createElement("a")).innerHTML=e.name,t},getIntroFilesHTMLBeforeJoin:function(e){e.fileType=lmsfileaction.getFileType(e.type,e.extension);var t=document.createElement("div");return t.setAttribute("class","CBg1"),t.setAttribute("introfile",""),t.fileInfo=e,t.appendChild(lmsattachment.getDisplayIcon(e.fileType,1==e.sourceType?"ContentFile":"")),t},introFileViewHtml:function(e,t,s,r){$(".zp_Cinf").hide(),$("body").addClass("zp_Tcfpv"),$(".zp_pwrap").find(".zp_Tmlft").remove();var l='<div class="zp_Tmlft"><div class="zp_CSttl"><i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.close")+'" onclick="lmscourseoverview.closeIntroFile()"></i></div>';if(l+='<div class="zp_CSdet">',l+='<iframe  style="display:none" id="lmscontentframe"  src=""  allowfullscreen=true  height="100%"  width="100%" ></iframe>',l+='<video style="display:none" height="100%" width="100%" controls autoplay src="" id="videoFrame"></video>',l+='<audio style="display:none" height="100%"  width="100%" controls autoplay src="" id="audioFrame"></audio>',l+="</div>",l+='<div class="zp_CSprog"><p><span>78%</span> '+ZPI18N.getString("zp.lms.course.coursecompleted")+'</p><div><div class="zp_detprogbar" style="width:78%"></div></div></div>',l+='<div class="zp_Tabs" id="ctabs"><ul><li class="sel" onclick="lmscontent.hidenotes(this)"> '+ZPI18N.getString("zp.lms.content.files")+" </li></ul></div>",l+="</div>",$(".zp_pwrap").append(l),null!=r){$('[data-id="courseOverviewPage"]').hide(),$('[data-id="introFileLst"]').remove();l='<div data-id="introFileLst">';$.each(r.introFiles,(function(e,t){l+='<div class="zp_Lst zp_drp" ><div>',l+='<div class="zp_Ldtl"><div class="zp_Tdts" onclick="lmscourseoverview.introFileViewHtml(\''+t.fileId+"','"+t.filePath+"')\"><h3><font>"+t.fileName+"</font></h3></div></div>",l+="</div></div>"})),l+="</div>",$('[data-id="courseView"]').append(l)}null==s&&(s="/viewFile?action=lms&filePath="+t,"undefined"!=contextPath&&"null"!=contextPath&&(s="/"+contextPath+s));var a=t.split(".").pop().toLowerCase();"mp3"==a||"Ogg"==a||"Wav"==a?($("#videoFrame").hide(),$("#audioFrame").show(),$("iframe#lmscontentframe").hide(),$("#audioFrame").attr("src",s)):"mp4"==a||"WebM"==a||"Ogg"==a?($("#videoFrame").show(),$("#audioFrame").hide(),$("iframe#lmscontentframe").hide(),$("#videoFrame").attr("src",s)):($("#videoFrame").hide(),$("#audioFrame").hide(),$("iframe#lmscontentframe").show(),$("iframe#lmscontentframe").attr("src",s))},closeIntroFile:function(){$(".zp_Cinf").show(),$("body").toggleClass("zp_Tcfpv"),$(".zp_Tmlft").html(""),$('[data-id="courseOverviewPage"]').show(),$('[data-id="introFileLst"]').hide()},addCourseInfo:function(){var e={formId:lmsbase.courseInfoFormId,mode:"getFormComponents",isPageMode:!1,formMode:"ADD",isPopUpMode:!0,containerId:"info_form"};ZPForm.isQuickAdd=!1,ZPForm.load(e)},editModule:function(e){var t={formId:lmsbase.courseInfoFormId,recordId:e,formMode:"EDIT",isPageMode:!1,isPopUpMode:!0,containerId:"info_form"};ZPForm.isQuickAdd=!1,ZPForm.load(t)},completeCourseCheck:function(){var e=lms.commonSettingData,t=lms.selfSettingData,s=lms.iltSettingData,r=lmscoursedetails.currentCourseData[0],l=lmscourses.selcourseSysVal;if(e.allowCourseEdit)return("2"!=r.coursecomplete||"1"!=l)&&("2"!=r.coursecomplete||"2"!=l);if("1"==l){if("1"==t.courseCompleteOn)return!1}else if("2"==s.courseCompleteOn)return!1;return!0},courseBannerMore:function(e,t,s,r,l,a,n,i){var o=[];if(lmscourses.previewType){if(!lmsbase.isCourseAdmin(i.courseType,i)&&i.isJoined&&"1"==lmscourses.selcourseSysVal&&lmscourseoverview.completeCourseCheck());}else{if(lmsbase.isCourseAdmin(i.courseType,i)){var c="";c=1==l?n?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable"):ZPI18N.getString("zp.delete");var d={};if("2"==lmscourses.selcourseSysVal&&1==l&&lmscourseoverview.completeCourseCheck(1)&&(d={markComplete:lmscoursedetails.isComplete?[ZPI18N.getString("zp.lms.markasuncomplete")]:[ZPI18N.getString("zp.markascomplete")],unpublish:[ZPI18N.getString("zp.lms.course.unpublish")]}),o=null!=lmscourses.coursecode&&""!=lmscourses.coursecode?"1"==lmscourses.selcourseSysVal&&lms.selfSettingData.isSelfUserCanShare||lms.iltSettingData.isIltUserCanShare&&"2"==lmscourses.selcourseSysVal||"3"==lmscourses.selcourseSysVal&&lms.manualSettingData.isManualUserCanShare&&(isadmin||lmscourseoverview.isCourseAdmin)?lmscourseoverview.isCourseSettingsEnabled()?[{preview:[ZPI18N.getString("zp.lms.courseoverview.preview")]},{edit:[ZPI18N.getString("zp.lms.setting")]},{share:[ZPI18N.getString("zp.lms.courseoverview.share")]},{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]},{copycode:[ZPI18N.getString("zp.lms.courseoverview.copycode")]},{del:[c]},d]:[{preview:[ZPI18N.getString("zp.lms.courseoverview.preview")]},{share:[ZPI18N.getString("zp.lms.courseoverview.share")]},{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]},{copycode:[ZPI18N.getString("zp.lms.courseoverview.copycode")]},{del:[c]},d]:lmscourseoverview.isCourseSettingsEnabled()?[{preview:[ZPI18N.getString("zp.lms.courseoverview.preview")]},{edit:[ZPI18N.getString("zp.lms.setting")]},{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]},{copycode:[ZPI18N.getString("zp.lms.courseoverview.copycode")]},{del:[c]},d]:[{preview:[ZPI18N.getString("zp.lms.courseoverview.preview")]},{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]},{copycode:[ZPI18N.getString("zp.lms.courseoverview.copycode")]},{del:[c]},d]:"1"==lmscourses.selcourseSysVal&&lms.selfSettingData.isSelfUserCanShare||lms.iltSettingData.isIltUserCanShare&&"2"==lmscourses.selcourseSysVal||"3"==lmscourses.selcourseSysVal&&lms.manualSettingData.isManualUserCanShare&&(isadmin||lmscourseoverview.isCourseAdmin)?lmscourseoverview.isCourseSettingsEnabled()?[{preview:[ZPI18N.getString("zp.lms.courseoverview.preview")]},{edit:[ZPI18N.getString("zp.lms.setting")]},{share:[ZPI18N.getString("zp.lms.courseoverview.share")]},{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]},{del:[c]},d]:[{preview:[ZPI18N.getString("zp.lms.courseoverview.preview")]},{share:[ZPI18N.getString("zp.lms.courseoverview.share")]},{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]},{del:[c]},d]:lmscourseoverview.isCourseSettingsEnabled()?[{preview:[ZPI18N.getString("zp.lms.courseoverview.preview")]},{edit:[ZPI18N.getString("zp.lms.setting")]},{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]},{del:[c]},d]:[{preview:[ZPI18N.getString("zp.lms.courseoverview.preview")]},{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]},{del:[c]},d],i.isJoined&&"1"==lmscourses.selcourseSysVal);}else if(o=null!=lmscourses.coursecode&&""!=lmscourses.coursecode?"1"==lmscourses.selcourseSysVal&&lmscoursedetails.currentCourseData[0].userCoursecompleteState?[{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]}]:[{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]},{copycode:[ZPI18N.getString("zp.lms.courseoverview.copycode")]}]:("1"==lmscourses.selcourseSysVal&&lmscoursedetails.currentCourseData[0].userCoursecompleteState,[{copyurl:[ZPI18N.getString("zp.lms.courseoverview.copycourseUrl")]}]),i.isJoined&&"1"==lmscourses.selcourseSysVal){lmscourseoverview.completeCourseCheck()}1===i.canGiveFeedback&&i.post_course_activities_details&&o.push({writeFeedback:[ZPI18N.getString("zp.lms.feedback.writefeedback")]})}for(var m=0;m<o.length;m++)o[m].copyurl&&!lms.commonSettingData.allowPublishUrl&&delete o[m];lmsmenu.initiate({elem:e,width:"160px",type:"dropdown",arrowHead:!0,menulist:o,eve:t}).on("click",(function(){"edit"==this.value?(lmsform.editDetails="",lmscourses.currentSectionindex=0,lmscourses.currentSectionId="",lmscourses.currentSectionName="",lmscourseconfig.showAddCourseDetails("overview",lmscourses.currentCourseId,s)):"del"!=this.value||0!=l&&3!=l&&4!=l&&5!=l&&"3"!=lmscourses.selcourseSysVal?"del"==this.value&&1==l?lmscourses.disableCourse(lmscourses.currentCourseId+"",c,"overview"):"copyurl"==this.value?lmssettings.copyUrl(1):"copycode"==this.value?lmssettings.copyUrl(lmscourses.coursecode):"share"==this.value?lmscourses.shareCourse.showAddUserShareOrSuggest(lmscourses.currentCourseId,"share",lmscourses.currentBatchId,lmscourses.selcourseSysVal):"isfav"==this.value?(lmscourses.isFav(lmscourses.currentCourseId,lmscoursedetails.isFav),lmscoursedetails.isFav=!lmscoursedetails.isFav):"markComplete"==this.value?lmsbatches.completeBatch(r,a,this):"preview"==this.value?lmscoursedetails.openPreview():"selfincomplete"==this.value?lmscourses.completCourse.userCourseInComplete():"selfcomplete"==this.value?lmscourses.completCourse.userCourseComplete(this):"writeFeedback"==this.value?2==i.canGiveFeedback?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.feedbackalredygiven")):lmsfeedback_v1.writeFeedback(i.courseId,i.batchId||null):"unpublish"==this.value&&lmscoursedetails.publishCourse(lmscoursedetails.currentCourseData[0]):lmscourses.deleteRecord(lmscourses.currentCourseId+"")})).bind()},isCourseSettingsEnabled:function(){return isEnabled=isadmin||lms.settingData[0].settingPermission.isDataAdmin||null!=lmscoursedetails.currentCourseData&&(lmscoursedetails.currentCourseData[0].isCourseOwner||lmscoursedetails.currentCourseData[0].courseAdmintabInfo[erecno]&&(JSON.parse(lmscoursedetails.currentCourseData[0].courseAdmintabInfo[erecno].tabIds).includes("0")||JSON.parse(lmscoursedetails.currentCourseData[0].courseAdmintabInfo[erecno].tabIds).includes(lmsbase.courseFormId)))},showMoreActivityData:function(e){lmscourseoverview.startIndex+=50;var t="",s=0;""!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&(s=lmscourses.currentBatchId);var r={method:"getCourseActivityDetails",courseId:lmscourses.currentCourseId,batchId:s,start:lmscourseoverview.startIndex,conreqcsr:csrfToken};$.post("/courseAction.zp",r,(function(e){var s;e&&($.each(e[1],(function(e,s){$.each(s,(function(e,r){var l="";if(null!=r.moduleName)if("content"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.content[0].name,t+='<div class=""><div><i class="IC-notes"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Fileadded")+" <em> "+r.Name+"</em></h4>";var a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("editableContent"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.editableContent[0].name,t+='<div class=""><div><i class="IC-cnt3"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Contentadded")+": <em> "+r.Name+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("link"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.link[0].name,t+='<div class=""><div><i class="IC-lnk"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Linkadded")+" <em> "+ZPeople.decodeTxt(r.Name)+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("test"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.test[0].name,t+='<div class=""><div><i class="'+(r.testType&&"1"==r.testType?"IC-OT":"IC-CT")+'"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview."+(r.testType&&"1"==r.testType?"online":"offline")+"Testadded")+"<em> "+ZPeople.decodeTxt(r.Name)+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("assignment"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.assignment[0].name,t+='<div class=""><div><i class="IC-assignment"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Assignmentadded")+" <em> "+ZPeople.decodeTxt(r.Name)+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("session"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.session[0].name,t+='<div class=""><div><i class="IC-adit-his"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Sessionadded")+" <em> "+ZPeople.decodeTxt(r.Name)+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("message"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):r.postedBy,t+='<div class=""><div>',t+='<div class="ZP_photo" title="'+r.Name+'"><img src="'+r.empPhoto+'"></div>',t+='<div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.Discussionstarted")+"<em> "+r.Name+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}else if("scorm"==r.moduleName){l=s.user===erecno?ZPI18N.getString("zp.you"):s.scorm[0].name,t+='<div class=""><div><i class="IC-notes"></i><div class="zp_Pdtls"><h4>',t+=s.user===erecno?l:"<em>"+l+"</em>",t+=" "+ZPI18N.getString("zp.lms.courseoverview.scormadded")+" <em> "+r.Name+"</em></h4>";a=ZPDateTime.getDateDisplayFormat(s.modifiedTime);t+="<span>"+a+"</span>",t+="</div></div></div>"}}))})),document.querySelector(".zp_crAcvt").innerHTML+=t,e[1].length-1==50&&lmscourseoverview.startIndex+50!=lmscourseoverview.totalActivityCount?((s=document.querySelector(".zp_crAcvt .zp_memarw"))&&s.remove(),"end"!=lmscourseoverview.startIndex&&(colRow='<div class="zp_memarw"  _crel = "nextpage"><div class="zp_anc" _rel="modnextPage">'+ZPI18N.getString("zp.lms.morerecords")+"</div></div>",document.querySelector(".zp_crAcvt").innerHTML+=colRow,lmsbase.addListener(document.querySelector(".zp_crAcvt .zp_memarw"),"click",lmscourseoverview.showMoreActivityData,!1))):((s=document.querySelector(".zp_crAcvt .zp_memarw"))&&s.remove(),lmscourseoverview.startIndex="end"))}))},changeOverViewHash:function(e,t,s,r,l,a){lmscourses.moduleName="",lmscoursedetails.isBatchCreated="",lmscourses.currentCourseId=e,lmscourses.currentBatchId=t;var n="";n="Digital downloads"==s?"course/"+e+"/digitaldownloads?addCourseInfo/"+e:null==r||"1"==r?"course/"+e+"/overview?addCourseInfo/"+e:""!=lmscourses.currentBatchId&&"undefined"!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId&&"null"!=lmscourses.currentBatchId&&null!=lmscourses.currentBatchId?"course/"+e+"/batch/"+lmscourses.currentBatchId+"/overview?addCourseInfo/"+e:"course/"+e+"/overview?addCourseInfo/"+e,lmsbatches.batchData=null,lmscourses.selectedTab="overview",lmscoursedetails.tabCallbackId=0,"disable"!=a&&lmscourses.openOverview(n)},getAssessmentNotificationElement:function(e){var t=document.createElement("div");t.className="zp_PNcnt",t.setAttribute(1==e.type?"PreCourseAssessmentNotify":"PostCourseAssessmentNotify",""),t.setAttribute("testId",e.testId),t.innerHTML='<i class="IC-bell-2"></i><div class="zp_PNcvr"><div><h4>'+e.testName+"</h4><p>"+ZPI18N.getString(e.isMandatory?"zp.lms.test.postTest.notificationCard.description.mandatory":"zp.lms.test.postTest.notificationCard.description.non_mandatory")+"</p>"+(e.startDate?"<font>"+ZPI18N.getString("zp.lms.test.testDateAndTime")+": <b>"+e.startDate+"</b></font>":"")+'</div></div><div class="zp_PNinf"><button viewInfo>'+ZPI18N.getString("zp.lms.viewinfo")+"</button>"+(e.canUserTakeAttempt?'<button takeTest class="sel">'+ZPI18N.getString("zp.lms.test.takeTest")+"</button>":"");var s=t.querySelector("[viewInfo]");if(s.removeAttribute("viewInfo"),lmsbase.addListener(s,"click",(function(t){t.skipAction=!0,lmstest.viewOnlineTestInfo(e,2)})),e.canUserTakeAttempt){var r=t.querySelector("[takeTest]");r.removeAttribute("takeTest"),lmsbase.addListener(r,"click",(function(t){t.skipAction=!0,lmstest.takeTest(e.assessmentId)}))}return t}},lms_pre_and_post_course_activities_result={onload:function(){var e=function(){lmstest.addListener(lmstest.EVENT_TYPE.ATTEMPT_COMPLETION,lms_pre_and_post_course_activities_result.onTestCompleted),lmstest.addListener(lmstest.EVENT_TYPE.TEST_SKIPPED,lms_pre_and_post_course_activities_result.onTestSkipped),lmsfeedback_v1.addListener(lmsfeedback_v1.EVENT_TYPE.FEEDBACK_COMPLETION,lms_pre_and_post_course_activities_result.onFeedbackCompleted),lmsfeedback_v1.addListener(lmsfeedback_v1.EVENT_TYPE.FEEDBACK_SKIPPED,lms_pre_and_post_course_activities_result.onFeedbackSkipped),lmsbase.removeListener(window,"DOMContentLoaded",e)};lmsbase.addListener(window,"DOMContentLoaded",e)}(),constructPreCourseActivitiesResultsView:function(e){if(lms_pre_and_post_course_activities.hasAnyPreCourseActivities(e)&&!lms_pre_and_post_course_activities.hasAnyPendingPreCourseActivities(e)){var t=document.getElementById("pre_course_activities_results");t.parentNode.replaceChild(lms_pre_and_post_course_activities_result.getPreCourseActivitiesResultsNode(e.pre_course_activities_details),t)}},constructPostCourseActivitiesResultsView:function(e){if(lms_pre_and_post_course_activities.hasAnyPostCourseActivities(e)&&!lms_pre_and_post_course_activities.hasAnyPendingPostCourseActivities(e)){var t=document.getElementById("post_course_activities_results");t.parentNode.replaceChild(lms_pre_and_post_course_activities_result.getPostCourseActivitiesResultsNode(e.post_course_activities_details),t)}},getCourseActivitiesResultsNode:function(e,t){var s=document.createElement("div"),r=s.appendChild(document.createElement("div"));r.className="zp_Pttl",r.textContent=t;var l=s.appendChild(document.createElement("div"));l.className="zp_grdwgt";var a=l.appendChild(document.createElement("ul"));a.setAttribute("container","listing");for(var n=e.entities,i=0;i<n.length;i++){var o=n[i];a.appendChild(this.getEntityNode(o))}return s},getPreCourseActivitiesResultsNode:function(e){var t=this.getCourseActivitiesResultsNode(e,ZPI18N.getString("zp.lms.preCourseRequirements.tabName"));return t.setAttribute("container","pre_course_activities_result"),t},getPostCourseActivitiesResultsNode:function(e){var t=this.getCourseActivitiesResultsNode(e,ZPI18N.getString("zp.lms.postCourseRequirements.tabName"));return t.setAttribute("container","post_course_activities_result"),t},getOnlineTestNode:function(e){var t=document.createElement("li");t.testInfo=e;var s='<font><i class="IC-OT"></i>'+e.testName+"</font>";if(s+="<span>"+(e.userMark?zplms.formatNumberForDisplaying(e.userMark):e.status)+"</span>",e.canUserTakeAttempt&&(s+='<span><i more class="IC-mre"></i></span>'),t.innerHTML=s,e.canUserTakeAttempt){var r=t.querySelector("[more]");r.removeAttribute("more"),lmsbase.addListener(r,"click",(function(t){lmsmenu.initiate({elem:r,width:"130px",type:"dropdown",arrowHead:!0,menulist:[{take:[ZPI18N.getString("zp.lms.test.takeTest")]}],eve:t}).on("click",(function(){"take"==this.value&&lmstest.takeTest(e.assessmentId)})).bind()}))}return t},getFeedbackNode:function(e){var t=document.createElement("li");t.feedbackInfo=e;var s='<font><i class="IC-OT"></i>'+ZPI18N.getString("zp.feedback")+"</font>";if(s+="<span>"+(e.hasUserCompleted&&e.marksObtained?zplms.formatNumberForDisplaying(e.marksObtained):e.status)+"</span>",e.canUserGiveFeedback&&(s+='<span><i more class="IC-mre"></i></span>'),t.innerHTML=s,e.canUserGiveFeedback){var r=t.querySelector("[more]");r.removeAttribute("more"),lmsbase.addListener(r,"click",(function(t){lmsmenu.initiate({elem:r,width:"130px",type:"dropdown",arrowHead:!0,menulist:[{take:[ZPI18N.getString("zp.lms.feedback.writefeedback")]}],eve:t}).on("click",(function(){"take"==this.value&&lmsfeedback_v1.writeFeedback(e.courseId,e.batchId)})).bind()}))}return t},getEvaluationNode:function(e){var t=document.createElement("li");t.evaluationInfo=e;var s='<font><i class="IC-OT"></i>'+ZPI18N.getString("zp.lms.managerevaluation.ManagerEvaluation")+"</font>";return s+="<span>"+(e.hasUserCompleted&&e.marksObtained?zplms.formatNumberForDisplaying(e.marksObtained):e.status)+"</span>",t.innerHTML=s,t},getEntityId:function(e){if(8==e.entityType||7==e.entityType)return e.testId},getEntityNode:function(e){var t;if(8==e.entityType?t=this.getOnlineTestNode(e):e.entityType==lmsfeedback.constants.ENTITY_TYPE?t=this.getFeedbackNode(e):11==e.entityType&&(t=this.getEvaluationNode(e)),t)if(t.entityInfo=e,e.entityType===lmsfeedback.constants.ENTITY_TYPE)t.setAttribute("courseId",e.courseId),e.batchId&&t.setAttribute("batchId",e.batchId),t.setAttribute("entityType","feedback");else t.setAttribute("entityId",this.getEntityId(e));return t},queryEntityNode:function(e,t){return 10===t.entityType?e.querySelector("[courseId='"+t.courseId+"'][entityType=feedback]"+(t.batchId?"[batchId='"+t.batchId+"']":"")):e.querySelector("[entityId='"+this.getEntityId(t)+"']")},onTestSkipped:function(e){lms_pre_and_post_course_activities_result.onTestCompleted(e)},onTestCompleted:function(e){var t,s=e.testInfo.testId;if(t=lms_pre_and_post_course_activities.getPreTestInfo(s)){for(var r in e.testInfo)t[r]=e.testInfo[r];lms_pre_and_post_course_activities_result.updatePreCourseActivityResult(t)}else if(t=lms_pre_and_post_course_activities.getPostTestInfo(s)){for(var r in e.testInfo)t[r]=e.testInfo[r];lms_pre_and_post_course_activities_result.updatePostCourseActivityResult(t)}},onFeedbackSkipped:function(e){lms_pre_and_post_course_activities_result.onFeedbackCompleted(e)},onFeedbackCompleted:function(e){var t=e.feedbackInfo;if(currentFeedbackInfo=lms_pre_and_post_course_activities.getFeedbackInfo(t.courseId,t.batchId)){for(var s in t)currentFeedbackInfo[s]=t[s];lms_pre_and_post_course_activities_result.updatePostCourseActivityResult(currentFeedbackInfo)}lmsMemberFeedback.onFeedbackShared(!0)},updatePreCourseActivityResult:function(e){var t=document.querySelector("#courseContainer [container='pre_course_activities_result']");if(t){var s=t.querySelector("[entityId='"+this.getEntityId(e)+"']");if(s&&s.parentNode)s.parentNode.replaceChild(lms_pre_and_post_course_activities_result.getEntityNode(e),s);else{var r=t.querySelector("[container='listing']");r&&r.appendChild(lms_pre_and_post_course_activities_result.getEntityNode(e))}}else{var l=lms_pre_and_post_course_activities.getPreCourseActivityInfo(),a=document.getElementById("pre_course_activities_results");l&&a&&a.parentNode&&a.parentNode.replaceChild(lms_pre_and_post_course_activities_result.getPreCourseActivitiesResultsNode(l),a)}},updatePostCourseActivityResult:function(e,t){var s=document.querySelector("#courseContainer [container='post_course_activities_result']");if(s){var r=this.queryEntityNode(s,e);if(r&&r.parentNode)r.parentNode.replaceChild(lms_pre_and_post_course_activities_result.getEntityNode(e),r);else{var l=s.querySelector("[container='listing']");l&&l.appendChild(lms_pre_and_post_course_activities_result.getEntityNode(e))}}},refreshPreCourseActivitiesResultsView:function(){var e=lms_pre_and_post_course_activities.getCurrentCourseInfo();e&&lms_pre_and_post_course_activities_result.constructPreCourseActivitiesResultsView(e)},refreshPostCourseActivitiesResultsView:function(){var e=lms_pre_and_post_course_activities.getCurrentCourseInfo();e&&lms_pre_and_post_course_activities_result.constructPostCourseActivitiesResultsView(e)}},lmsoverviewTab={overviewNewTab:function(){var e=window.location.href.split("#"),t=e[0].split("/");e[0]="",t[t.length-1]="lmscourse";for(var s=0;s<t.length;s++)s==t.length-1?e[0]+=t[s]:e[0]+=t[s]+"/";lmscourses.getUrl=e[0]+"#"+e[1],window.open(lmscourses.getUrl)}},lmsgradetype={valueObj:null,apival:[],upperBoundVal:null,gradeRange:null,_rootElem:null,initiate:function(){lmsgradetype.requestGradeSetting()},requestGradeSetting:function(){var e={method:"getGradeSetting"};e.conreqcsr=csrfToken,$.post("/gradeSettingAction.zp",e,(function(e){null!=e[0]?(lmsgradetype.valueObj=e[1],lmsgradetype.constructGradeSetting(lmsgradetype.valueObj)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.errorgradesetting"))}))},convertTheValues:function(){lmsgradetype.apival=[];var e=lmsgradetype.valueObj;e.minMark||(e.minMark=30),lmsgradetype.apival[0]={componentValue:e.noGrade},lmsgradetype.apival[1]={componentValue:e.passorfail},lmsgradetype.apival[2]={componentValue:e.letterGrade},lmsgradetype.apival[3]={componentValue:e.totalPoints},lmsgradetype.apival[4]={componentValue:e.minMark},lmsgradetype.apival[5]={componentValue:e.displayPercent}},constructGradeSetting:function(e){lmsgradetype.convertTheValues(e);var t=lmsformconvert.initiate(ZPI18N.getString("zp.lms.gradeSetting.nograde"),"nograde",lmsform.fieldtype.CHECKBOX,"1234",!1,"",ZPI18N.getString("zp.lms.gradeSetting.nogradenote")),s=lmsformconvert.initiate(ZPI18N.getString("zp.lms.gradeSetting.passfail"),"passorfail",lmsform.fieldtype.CHECKBOX,"1235",!1,"",ZPI18N.getString("zp.lms.gradeSetting.passfailnote")),r=lmsformconvert.initiate(ZPI18N.getString("zp.lms.gradeSetting.lettergrade"),"lettergrade",lmsform.fieldtype.CHECKBOX,"1236",!1,"",ZPI18N.getString("zp.lms.gradeSetting.lettergradenote")),l=lmsformconvert.initiate(ZPI18N.getString("zp.lms.gradeSetting.totalpoints"),"totalpoints",lmsform.fieldtype.CHECKBOX,"1237",!1,"",ZPI18N.getString("zp.lms.gradeSetting.totalpointsnote")),a=lmsformconvert.initiate(ZPI18N.getString("zp.lms.gradeSetting.minpassmark"),"minimummark",lmsform.fieldtype.NUMBER,"1238",!1),n=lmsformconvert.initiate(ZPI18N.getString("zp.lms.gradeSetting.displaypercentage"),"displayPercentage",lmsform.fieldtype.CHECKBOX,"1239",!1,"noHeader"),i=document.createElement("div");i.setAttribute("class","zp_setCont"),i.setAttribute("rel","gradeDiv"),i.innerHTML="<h5>"+ZPI18N.getString("zp.lms.grading")+"</h5>",lmsgradetype._rootElem=i;var o=document.createElement("div");o.setAttribute("class","zp_STbx"),o.innerHTML="<header><h2>"+ZPI18N.getString("zp.lms.gradeSetting.innergradingheader")+"</h2></header>",o.innerHTML+='<div class="zp_grdscl"><p>'+ZPI18N.getString("zp.lms.gradeSetting.gradingheadertxt")+"</p></div>",i.appendChild(o);var c=document.createElement("div");c.setAttribute("class","zp_Sm zp_lp zp_nbr"),c.innerHTML="<div>"+lmsform.insertField(t,"","","",lmsgradetype.apival[0])+"</div>";var d=document.createElement("div");d.setAttribute("class","zp_Sm zp_lp zp_nbr"),d.innerHTML="<div>"+lmsform.insertField(s,"","","",lmsgradetype.apival[1])+"</div>";var m=document.createElement("div");m.setAttribute("class","zp_Sm zp_lp zp_nbr"),m.innerHTML="<div>"+lmsform.insertField(l,"","","",lmsgradetype.apival[3])+"</div>";var u=document.createElement("div");u.setAttribute("class","zp_Sm zp_lp zp_nbr"),u.innerHTML="<div>"+lmsform.insertField(r,"","","",lmsgradetype.apival[2])+"</div>";var p="zp_gradecnt";0==lmsgradetype.valueObj.passorfail&&(p="zp_gradecnt zp_dyn");var g=document.createElement("div");g.setAttribute("class",p),g.setAttribute("_rel","hideElement1");var f=document.createElement("div");g.appendChild(f);var v=document.createElement("div");v.setAttribute("class","zp_grdscl"),v.innerHTML="<h4>"+ZPI18N.getString("zp.lms.gradeSetting.minpassmark")+"</h4>";var h=document.createElement("div");h.setAttribute("class","zp_Sm zp_cnum"),h.innerHTML+=lmsform.insertField(a,"","","",lmsgradetype.apival[4]),v.appendChild(h),v.innerHTML+="<span>%</span>";var b=document.createElement("div");b.setAttribute("class","zp_Sm zp_lp zp_nbr"),b.innerHTML="<div>"+lmsform.insertField(n,"","","",lmsgradetype.apival[5])+"</div>",f.appendChild(v),p="zp_gradecnt",0==lmsgradetype.valueObj.letterGrade&&(p="zp_gradecnt zp_dyn");var I=document.createElement("div");I.setAttribute("class",p),I.setAttribute("_rel","hideElement2");var y=document.createElement("div");I.appendChild(y);var _=document.createElement("div");_.innerHTML=ZPI18N.getString("zp.lms.gradeSetting.gradeScale"),y.appendChild(_);var S=document.createElement("div");S.setAttribute("class","zp_Sgrd"),S.innerHTML="<label><p>"+ZPI18N.getString("zp.lms.gradeSetting.grade")+"</p><p>"+ZPI18N.getString("zp.lms.gradeSetting.range")+"</p><p>"+ZPI18N.getString("zp.lms.gradeSetting.status")+"</p></label>",y.appendChild(S),S.appendChild(lmsgradetype.constructGradeRange()),lmsgradetype.gradeRange=S;var C=document.createElement("button");C.setAttribute("class","zpthm"),C.setAttribute("_rel","gradesaveButton"),C.innerHTML="Save";var P=document.createElement("div");P.setAttribute("class","zp_btn"),P.appendChild(C),o.appendChild(c),o.appendChild(d),o.appendChild(g),o.appendChild(m),o.appendChild(u),o.appendChild(I,lmsgradetype.apival[2]),o.appendChild(P),lmssettings._relem.querySelector('[class="zp_AClft"]').appendChild(i),lmsbase.addListener(i,"focusin",lmsgradetype.focusinHandler,!1),lmsbase.addListener(i,"focusout",lmsgradetype.focusoutHandler,!1),lmsbase.addListener(i,"click",lmsgradetype.clickHandler,!1),lmsbase.addListener(i,"input",lmsgradetype.inputHandler,!1)},focusinHandler:function(e){lmsgradetype.previousValue=e.target.value},focusoutHandler:function(e){par=e.target.closest("li");var t=e.target,s=t.getAttribute("_srel"),r=t.getAttribute("_rel");"lowerBound"==s?lmsgradetype.validateLowerBound(r,t,par):"upperBound"==s?lmsgradetype.validateUpperBound(r,t,par):"gradeMark"==s?lmsgradetype.validateGrade(r,t,par):null!=t&&t.getAttribute("required")},inputHandler:function(e){var t=e.target,s=t.getAttribute("_type"),r=t.getAttribute("name");if("num"==s||"minimummark"==r){var l=(a=t.value).replace(/[\\A-Za-z!"$%^&\-\)\(*+_={};:'@#~,.\/<>\" "\?|`\]\[]/g,"");a>100&&(l=lmsgradetype.previousValue),e.target.value=l}else if("text"==s){var a;l=(a=t.value).replace(/[\\!"$%^&\\)\(_={};:'@#~,.\/<>\" "\?|`\]\[]/g,"");e.target.value=l}},validateLowerBound:function(e,t,s){let r=s.nextElementSibling;var l,a=e.split("_"),n=t.value,i=null,o=null,c=lmsgradetype.gradeRange,d=(l=c.querySelector('[_rel="'+a[0]+'_upperBound"]')).value,m=c.querySelector('[_rel="'+a[0]+'_gradeMark"]').value;if(""==m)return t.value=lmsgradetype.previousValue,ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade")),!1;if(n==lmsgradetype.previousValue)return!1;if(null!=r&&(o=r.getAttribute("_gradeRatingId")),null==o)(n=parseInt(n))<(d=parseInt(d))&&""!=m.trim()?t.value=n:t.value=lmsgradetype.previousValue;else{i=c.querySelector('[_rel="'+o+'_upperBound"]');let e=c.querySelector('[_rel="'+o+'_lowerBound"]'),s=e.value;if(!(t.value&&t.value<parseInt(l.value)&&t.value>parseInt(e.value)))return t.value=lmsgradetype.previousValue,ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.range",[d,s])),!1;i.value=parseInt(t.value)-1}return!0},validateUpperBound:function(e,t,s){let r=s.previousElementSibling;var l=e.split("_"),a=t.value,n=null,i=null,o=lmsgradetype.gradeRange,c=null;if(""==o.querySelector('[_rel="'+l[0]+'_gradeMark"]').value)return t.value=lmsgradetype.previousValue,ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade")),!1;if(a==lmsgradetype.previousValue)return!1;if(null!=r&&(c=r.getAttribute("_gradeRatingId")),null!=c){n=o.querySelector('[_rel="'+l[0]+'_lowerBound"]'),i=o.querySelector('[_rel="'+c+'_lowerBound"]');let e=o.querySelector('[_rel="'+c+'_upperBound"]'),s=e.value,r=n.value;if(!(t.value&&t.value<parseInt(e.value)&&t.value>parseInt(n.value)))return t.value=lmsgradetype.previousValue,ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.range",[s,r])),!1;i.value=parseInt(t.value)+1}return!0},validateGrade:function(e,t,s){var r=s.parentElement.querySelectorAll('[_srel="gradeMark"]'),l=t.value;if(l==lmsgradetype.previousValue)return!1;if(""==l.trim())return t.value=lmsgradetype.previousValue,!1;var a=0;l=l.toLowerCase();for(var n=0;n<r.length;n++){if(r[n].value.toLowerCase()==l&&a++,a>1)return t.value=lmsgradetype.previousValue,ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.uniquegrade")),!1}return a<2&&(t.value=l),!0},clickHandler:function(e){var t=e.target.getAttribute("fieldName");if("checkBoxChoice"==t){var s=e.target.closest("li").firstChild;return"IC-cbox"==s.className?s.className="IC-cbox zp_gclr":s.className="IC-cbox",void lmsgradetype.hideshowdiv(s.className,e.target)}if("radioChoice"==t){for(var r=e.target.closest("ul").querySelectorAll('[class ^= "IC-rdo"]'),l=0;l<r.length;l++)r[l].className="IC-rdo";e.target.closest("li").querySelector('[class="IC-rdo"]').className="IC-rdo zp_gclr"}var a=e.target.getAttribute("_rel");"gradesaveButton"==a?lmsgradetype.requestTheserver()&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.gradeSetting.updategrade")):"coursegradesaveButton"==a?lmscoursegrade.requestTheserver():"gradeTypeDel"==a?lmsgradetype.valueObj.gradeRating.length<2?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.onegrade")):lmsgradetype.delGradeNotify(e):"addGradeTypeRel"==a&&lmsgradetype.addGrade(e),null!=e.target.closest('[_rel="addCourseCategory"]')&&lmscoursegrade.addCategoryRow("new"),"categoryDelete"==a&&lmscoursegrade.deleteCategory(e.target)},requestTheserver:function(){for(var e=lmssettings._relem.querySelectorAll('[fieldName="checkBoxChoice"]'),t={},s=0;s<e.length;s++)e[s].getAttribute("name")&&(t[e[s].getAttribute("name")]="IC-cbox zp_gclr"==e[s].className);var r=lmssettings._relem.querySelectorAll("[_req]");for(s=0;s<r.length;s++)null!=r[s].name&&(t[r[s].name]=r[s].value);return t.gradeSetting=lmsgradetype.constructGradeParams(),-1!==t.gradeSetting&&(""==t.minimummark&&(t.minimummark=30),zplms.put("/lms/settings/grade",t,(function(e){return null!=e[0]?(lmsgradetype.valueObj=e[1],document.querySelector('[rel="gradeDiv"]')&&document.querySelector('[rel="gradeDiv"]').remove(),lmsgradetype.constructGradeSetting(lmsgradetype.valueObj),!0):(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.gradeSetting.errorupdategrade")),!1)})),!0)},constructGradeParams:function(){for(var e=[],t={},s=document.querySelector('[_rel="gradesettings"]'),r=document.querySelector('[_rel="gradesettings"]').querySelectorAll("li"),l=0;l<r.length;l++)if(r[l].hasAttribute("_graderatingid")){var a=r[l].getAttribute("_graderatingid"),n=s.querySelector('[_rel="'+a+'_gradeMark"]').value,i=s.querySelector('[_rel="'+a+'_lowerBound"]').value,o=s.querySelector('[_rel="'+a+'_upperBound"]').value,c=s.querySelector('[_rel="'+a+'gradeStatus"]').querySelector('[_mode="single"]').getAttribute("_rel");if(!n.trim())return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade")),-1;t={gradeRatingId:a,gradeMark:i+"-"+o,gradeValue:n.toUpperCase(),gradeStatus:c},e.push(t)}return JSON.stringify(e)},hideshowdiv:function(e,t){var s=t.closest('[class="zp_Sm zp_lp zp_nbr"]'),r=s.querySelector('[fieldname="checkBoxChoice"]'),l=r.getAttribute("name");e=r.getAttribute("class"),"passorfail"==l?lmsgradetype.hideshowpassfail(e,s):"lettergrade"==l&&lmsgradetype.hideshowlettergrade(e,s)},hideshowpassfail:function(e,t){var s=lmsgradetype._rootElem.querySelector('[_rel="hideElement1"]');"IC-cbox zp_gclr"==e?lmsbase.removeClass(s,"zp_dyn"):lmsbase.addClass(s,"zp_dyn")},hideshowlettergrade:function(e,t){var s=lmsgradetype._rootElem.querySelector('[_rel="hideElement2"]');"IC-cbox zp_gclr"==e?lmsbase.removeClass(s,"zp_dyn"):lmsbase.addClass(s,"zp_dyn")},constructGradeRange:function(){var e=document.createElement("div");e.setAttribute("_rel","gradesettings");for(var t=lmsgradetype.valueObj.gradeRating,s=document.createElement("ul"),r=0;r<t.length;r++)s.appendChild(lmsgradetype.innerConstructGrade(t[r],t[r].gradeRatingId));r--;var l=document.createElement("li");return l.classList.add("notp"),l.innerHTML='<em _rel="addGradeTypeRel"> <i class = "IC-plus"></i>Add grade</em>',s.appendChild(l),e.appendChild(s),e},innerConstructGrade:function(e,t){var s=e.gradeValue.split("-");return lmsgradetype.constructliElem(e.usergrade,s[0],s[1],e.status,t)},constructliElem:function(e,t,s,r,l,a){var n=document.createElement("li");n.setAttribute("_gradeRatingId",l),2==a&&n.setAttribute("rel","newLetterGrade");var i=document.createElement("span");i.appendChild(lmsgradetype.constructTextField(ZPeople.escapeHtml(lmsform.changetoI18N(e)),"zp_inpmrk",l+"_gradeMark","gradeMark"));var o=document.createElement("span");o.appendChild(lmsgradetype.constructNumberField(t,"zp_inpmrk",l+"_lowerBound","lowerBound")),o.innerHTML+="<span>%</span><em>-</em> ",o.appendChild(lmsgradetype.constructNumberField(s,"zp_inpmrk",l+"_upperBound","upperBound")),o.innerHTML+="<span>%</span>";var c=document.createElement("span"),d={},m="zp_Sm zp_gfail";1==r?(d[1]=["Pass"],m="zp_Sm zp_gpass"):d[2]=["Fail"],100==s&&(m+=" disabled");var u=document.createElement("div");u.setAttribute("class",m),u.setAttribute("_rel",l+"gradeStatus"),u.innerHTML=lmsmenu.getSelectElement("12344",d,"single",null,{}),c.appendChild(u);var p={1:["Pass"],2:["Fail"]};lmscoursegrade.selectMenu(c,u,p,"no",lmsgradetype.selectMenuCall);var g=document.createElement("i");return g.classList.add("IC-delete"),g.setAttribute("_rel","gradeTypeDel"),c.appendChild(g),n.appendChild(i),n.appendChild(o),n.appendChild(c),n},selectMenuCall:function(e){var t=e.referObj;"1"==e.value?t.elem.setAttribute("class","zp_Sm zp_gpass"):t.elem.setAttribute("class","zp_Sm zp_gfail")},constructTextField:function(e,t,s,r){var l=document.createElement("input");return l.setAttribute("value",ZPeople.decodeTxt(e)),l.setAttribute("type","text"),l.setAttribute("class",t),l.setAttribute("_rel",s),l.setAttribute("_srel",r),l.setAttribute("_type","text"),l},constructNumberField:function(e,t,s,r){100==e&&(t+=" disabled");var l=document.createElement("input");return l.setAttribute("value",e),l.setAttribute("type","text"),l.setAttribute("class",t),l.setAttribute("_rel",s),l.setAttribute("_srel",r),l.setAttribute("_type","num"),l},delGradeNotify:function(e){lmsnotify.show({header:ZPI18N.getString("zp.lms.gradeSetting.lettergrade.deletelable"),body:"",button_text:ZPI18N.getString("zp.confirm"),texttype:"negative",successCallback:function(){this.status&&lmsgradetype.delGradeSetting(e)},cancelCallback:function(){}})},delGradeSetting:function(e){var t={},s=e.target.closest("li"),r=s.getAttribute("_gradeRatingId");if("undefined"==r||s.hasAttribute("rel"))ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.deletesuccess")),s.remove();else{var l=s.querySelector('[_rel = "'+r+'_upperBound"]').value,a=s.nextSibling,n=a.getAttribute("_gradeRatingId"),i=0,o="",c=1;if(null!=n)i=a.querySelector('[_rel="'+n+'_lowerBound"]').value,o=a.querySelector('[_rel="'+n+'_gradeMark"]').value,c=a.querySelector('[_rel="'+n+'gradeStatus"]').querySelector('[_mode="single"]').getAttribute("_rel");else n=0;var d={},m=[];d.method="deleteGradeType",d.gradeRatingId=r;t={gradeRatingId:n,gradeMark:i+"-"+l,gradeValue:o.toUpperCase(),gradeStatus:c};m.push(t),d.gradeSetting=JSON.stringify(m),d.conreqcsr=csrfToken,$.post("/gradeSettingAction.zp",d,(function(e){1==e[1].delStatus?(s.remove(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.deletesuccess")),lmsgradetype.valueObj.gradeRating=e[1].gradeRating,1==e[1].upStatus&&lmsgradetype.callBackGradeParams()):ZPeople.Message.showWarningMsg(e[1].message)}))}},addGrade:function(e){var t=e.target.closest("li"),s=t.parentNode,r=t.previousElementSibling,l=100,a="",n="1";if(null!=r&&(rel=r.querySelector('[_srel="lowerBound"]'),l=rel.value,rel=r.querySelector('[_srel="gradeMark"]'),a=rel.value,n=r.querySelector('[_mode="single"]').getAttribute("_rel")),0!==lmsgradetype.valueObj.gradeRating.length){if(""==a.trim())return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade"));if(0==parseInt(l))return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.toaddgrade"));l=parseInt(l)-1}var i=document.querySelectorAll('[rel="newLetterGrade"]').length+1,o=lmsgradetype.constructliElem("",0,l,n,i,2);t.remove(),s.appendChild(o),s.appendChild(t)},editGradeType:function(e){var t=e.target.closest("li"),s=e.target.getAttribute("_srel"),r=null,l={};"lowerBound"==s?r=t.nextElementSibling:"upperBound"==s&&(r=t.previousElementSibling);var a=t.getAttribute("_gradeRatingId"),n=t.querySelector('[_srel="gradeMark"]').value,i=t.querySelector('[_srel="lowerBound"]').value,o=t.querySelector('[_srel="upperBound"]').value,c=t.querySelector('[_rel="'+a+'gradeStatus"]').querySelector('[_mode="single"]').getAttribute("_rel"),d="",m=null;if(null!=r&&null!=(d=r.getAttribute("_gradeRatingId"))&&(m=r.querySelector('[_srel="lowerBound"]').value+"-"+r.querySelector('[_srel="upperBound"]').value),""!=n.trim()){var u=[];gradeObj={gradeRatingId:a,gradeValue:n.toUpperCase(),gradeMark:i+"-"+o,gradeStatus:c},otherGradeObj={gradeRatingId:d,gradeMark:m},u.push(gradeObj),u.push(otherGradeObj),l.method="editGradeType",l.gradeSetting=JSON.stringify(u),l.conreqcsr=csrfToken,$.post("/gradeSettingAction.zp",l,(function(e){0==e[1].status?ZPeople.Message.showWarningMsg("Error while update grade"):(lmsgradetype.valueObj.gradeRating=e[1].gradeRating,lmsgradetype.callBackGradeParams())}))}else ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.gradeSetting.lettergrade.emptygrade"))},callBackGradeParams:function(){for(var e=lmsgradetype.gradeRange,t=lmsgradetype.valueObj.gradeRating,s=0;s<t.length;s++){var r=t[s].gradeRatingId;gradeVal=t[s].gradeValue.split("-");var l=lmsform.changetoI18N(ZPeople.escapeHtml(t[s].usergrade));e.querySelector('[_rel="'+r+'_gradeMark"]').value=l,e.querySelector('[_rel="'+r+'_lowerBound"]').value=gradeVal[0],e.querySelector('[_rel="'+r+'_upperBound"]').value=gradeVal[1],"100"==gradeVal[1]&&e.querySelector('[_rel="'+r+'_upperBound"]').classList.add("disabled");var a=e.querySelector('[_rel="'+r+'gradeStatus"]'),n={},i="zp_Sm zp_gfail";1==t[s].status?(n[1]=["Pass"],i="zp_Sm zp_gpass"):n[2]=["Fail"],"100"==gradeVal[1]&&(e.querySelector('[_rel="'+r+'_upperBound"]').classList.add("disabled"),i+=" disabled"),a.setAttribute("class",i),a.innerHTML=lmsmenu.getSelectElement("12344",n,"single",null,{})}}},lmsformconvert={initiate:function(e,t,s,r,l,a,n){var i={};return i.displayName=e,i.labelName=t,i.fieldType=s,i.formComponentId=r,i.isMandatory=l,s==lmsform.fieldtype.CHECKBOX&&!a&&(i.headerlabel=!0),i.em=lmsform.fieldtype.CHECKBOX&&n?n:null,i}},lmscoursegrade={root:null,valElem:null,apiVal:[],catId:0,catRoot:null,deleteMode:0,gradeSetting:null,letterSelOption:null,gType:null,gradeWarning:!1,initiate:function(){this.gradeWarning=!1;var e=document.getElementById("courseSec");lmscoursegrade.addseltogradeconfig(e);var t={method:"getCourseGradeSetting",conreqcsr:csrfToken,courseId:lmscourses.currentCourseId};$.post("/gradeSettingAction.zp",t,(function(e){"permission denied"==e[1].message?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.assessment.error.nopermission")):(lmscoursegrade.valElem=e[1],lmscoursegrade.convertTheValues(e[1]),null!=e[0]&&lmscoursegrade.HTMLConstruction(e[1]))}))},addseltogradeconfig:function(e){var t=e.querySelector('[class="sel"]');lmsbase.removeClass(t,"sel");var s=e.querySelector('[id="sectionsList_gradeCategory"]');lmsbase.addClass(s,"sel");var r=document.querySelector('[class="zp_pwrap zp_tab"]');$("form",r).addClass("zp_dyn");var l=r.querySelector(".zp_AClft[_rel='gradeConfiguration']");l&&l.parentNode.removeChild(l)},convertTheValues:function(e){lmscoursegrade.apiVal=[];var t=e;lmscoursegrade.apiVal[0]={componentValue:t.gradeScale},lmscoursegrade.apiVal[1]={componentValue:t.showmygrade},lmscoursegrade.apiVal[2]={componentValue:t.nogradebook},lmscoursegrade.apiVal[3]={componentValue:t.showallgrade}},HTMLConstruction:function(e){lmsform.formref.remove(),$(".zp_AClft").remove();var t=document.createElement("div");t.setAttribute("class","zp_AClft"),t.setAttribute("_rel","gradeConfiguration"),t.innerHTML="<h5>"+ZPI18N.getString("zp.lms.courseSetting.gradeconfiguration")+"</h5>";var s=e.gradeRating;lmscoursegrade.gradeSetting=s,(0==s.letterGrade&&0==s.noGrade&&0==s.passorfail&&0==s.totalPoints||0==e.gradeScale&&0==s.noGrade||1==e.gradeScale&&0==s.letterGrade||2==e.gradeScale&&0==s.passorfail||3==e.gradeScale&&0==s.totalPoints)&&(e.gradeScale=4);var r=document.querySelector('[class="zp_pwrap zp_tab"]');r.insertBefore(t,r.firstChild);var l=document.createElement("div");l.setAttribute("class","zp_STbx"),l.innerHTML="<header><h2>"+ZPI18N.getString("zp.lms.courseSetting.innergradeconfiguration")+"</h2></header>",t.appendChild(l);var a={},n=document.createElement("div");n.setAttribute("class","zp_grdscl"),l.appendChild(n);var i=document.createElement("div");i.setAttribute("class","zp_Sm zp_c3"),i.setAttribute("_rel","courseGradetype"),lmscoursegrade.gType=i;var o=e.gradeRating,c={};1==o.noGrade&&(c[0]=[ZPI18N.getString("zp.lms.gradeSetting.nograde")]),1==o.letterGrade&&(c[1]=[ZPI18N.getString("zp.lms.gradeSetting.lettergrade")]),1==o.passorfail&&(c[2]=[ZPI18N.getString("zp.lms.gradeSetting.passfail")]),1==o.totalPoints&&(c[3]=[ZPI18N.getString("zp.lms.gradeSetting.totalpoints")]),lmscoursegrade.selectObj=c,0==e.gradeScale?a[0]=[ZPI18N.getString("zp.lms.gradeSetting.nograde")]:1==e.gradeScale?a[1]=[ZPI18N.getString("zp.lms.gradeSetting.lettergrade")]:2==e.gradeScale?a[2]=[ZPI18N.getString("zp.lms.gradeSetting.passfail")]:3==e.gradeScale?a[3]=[ZPI18N.getString("zp.lms.gradeSetting.totalpoints")]:4==e.gradeScale&&(a[4]=[ZPI18N.getString("zp.lms.course.select")]),1==e.gradeScale?(lmscoursegrade.tagType="lettergrade",lmscoursegrade.letterSelOption=!0):2==e.gradeScale?(lmscoursegrade.tagType="passorfail",lmscoursegrade.letterSelOption=!0):lmscoursegrade.letterSelOption=!1,i.innerHTML=lmsmenu.getSelectElement("12344",a,"single",null,{}),n.appendChild(i),lmscoursegrade.gradeType=n,lmscoursegrade.hideElementConstruction(l,e.gradeScale),lmscoursegrade.selectMenu(n,i,c,"no",lmscoursegrade.selectMenuCallback);var d=document.createElement("div");d.setAttribute("class","zp_grdcnt"),d.innerHTML+='<div class="zp_btn"><button _rel="coursegradesaveButton" class="zpthm">'+ZPI18N.getString("zp.save")+"</button></div>",l.appendChild(d),lmscoursegrade.root=t,lmsbase.addListener(l,"click",lmsgradetype.clickHandler,!1),1==e.gradeScale?lmscoursegrade.tagCategory("letterGrade"):2==e.gradeScale&&lmscoursegrade.tagCategory("passorfail")},inputHandler:function(e){var t=e.target.getAttribute("_srel");"category"==t?lmscoursegrade.validateNumber(e):"categoryName"==t&&lmscoursegrade.validateCategoryName(e)},focusinHandler:function(e){var t=e.target;"category"==t.getAttribute("_srel")&&(lmscoursegrade.previousCatValue=t.value)},focusoutHandler:function(e){var t=e.target,s=t.getAttribute("_srel");"category"==s?(lmscoursegrade.calculateTheCategory(t,e),lmscoursegrade.previousCatValue!=t.value&&lmscoursegrade.editTheCategory(t,0)):"categoryName"==s&&(lmscoursegrade.validateCategoryName(e),lmscoursegrade.editTheCategory(t,1))},editTheCategory:function(e,t){if(e.value.trim()){document.querySelector('[_rel="coursegradesaveButton"]').classList.contains("disabled")&&document.querySelector('[_rel="coursegradesaveButton"]').classList.remove("disabled");var s={method:"editGradeCategory"};s.conreqcsr=csrfToken,s.catId=e.getAttribute("_categoryId"),s.catValue=e.value,s.courseId=lmscourses.currentCourseId,s.mode=t,0==t&&lmscoursegrade.warnWhenGradeSettingsIsChanged(),$.post("/gradeSettingAction.zp",s,(function(e){if("permission denied"==e[1].message)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.assessment.error.nopermission"));else if(null==e[0])ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.courseSetting.unableupdatedCategory"));else for(var r=lmscoursegrade.valElem.categoryList,l=0;l<r.length;l++)r[l].categoryId==s.catId&&(0==t?r[l].percentage=s.catValue:r[l].categoryName=s.catValue)})).fail((function(e){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.entervalidinput"))}))}else document.querySelector('[_rel="coursegradesaveButton"]').classList.add("disabled")},addNewCourseCategory:function(e,t,s){var r={method:"addGradeCategory"};r.conreqcsr=csrfToken,r.catName=e,r.catValue=t,r.courseId=lmscourses.currentCourseId,lmscoursegrade.warnWhenGradeSettingsIsChanged(),$.post("/gradeSettingAction.zp",r,(function(e){if("permission denied"==e[1].msg)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.assessment.error.nopermission"));else if(null!=e[0]){var r={categoryId:e[1].catId,categoryName:"Category",percentage:t};lmscoursegrade.valElem.categoryList.push(r);var l=lmscoursegrade.catRoot,a=l.querySelector('[_rel="'+s+'textCategory"]'),n=l.querySelector('[_rel="'+s+'numberCategory"]');a.setAttribute("_categoryId",e[1].catId),n.setAttribute("_categoryId",e[1].catId),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.courseSetting.newcategoryadded"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.courseSetting.unablenewcategoryadded"))}))},calculateTheCategory:function(e,t){e.getAttribute("_rel");var s=lmscoursegrade.commonCalculateFun();parseInt(s)>100?(s=parseInt(s)-parseInt(e.value),e.value=100-parseInt(s),lmscoursegrade.catRoot.querySelector('[_rel="courseCategoryTotal"]').innerHTML="100%"):lmscoursegrade.catRoot.querySelector('[_rel="courseCategoryTotal"]').innerHTML=s+"%"},validateNumber:function(e){var t=e.target.value,s=t.replace(/[\\A-Za-z!"$%^&\-\)\(*+_={};:'@#~,.\/<>\" "\?|`\]\[]/g,"");0==t&&(s=""),e.target.value=s},validateCategoryName:function(e){let t=e.target.value,s=t.replace(/[\\!"$%^&\-\)\(*+_={};:'@#~,.\/<>\""\?|`\]\[]/g,"");0==t&&(s=""),e.target.value=s},validateCategoryPercentage:function(){var e=lmscoursegrade.commonCalculateFun();return e>100?0:100-e},calculateTotalMarks:function(){var e=lmscoursegrade.commonCalculateFun();lmscoursegrade.catRoot.querySelector('[_rel="courseCategoryTotal"]').innerHTML=e+"%"},commonCalculateFun:function(){for(var e=lmscoursegrade.catRoot.querySelectorAll('[_srel="category"]'),t="",s=0,r=0;r<e.length;r++)t=e[r],s+=parseInt(t.value.trim())||0;return s},selectMenu:function(e,t,s,r,l){lmsgroupmenu.initiate(e).insertMenu({elem:t,type:"select",mode:"single",menulist:s,click:r?l:""})},alertMessage:function(e){var t=ZPI18N.getString("zp.lms.courseSetting.alertCatgeory");lmsnotify.show({header:t,body:ZPI18N.getString("zp.lms.courseSetting.alertCatgeorybody"),button_text:"yes",texttype:"negative",successCallback:function(){lmscoursegrade.untaggedlettergrade(e)},cancelCallback:function(){lmscoursegrade.redothetagging(e)}})},redothetagging:function(e){var t={};"passorfail"==lmscoursegrade.tagType?t[2]=[ZPI18N.getString("zp.lms.gradeSetting.passfail")]:t[1]=[ZPI18N.getString("zp.lms.gradeSetting.lettergrade")],lmscoursegrade.gType.innerHTML="",lmscoursegrade.gType.innerHTML=lmsmenu.getSelectElement("12344",t,"single",null,{}),lmscoursegrade.selectMenu(lmscoursegrade.gradeType,lmscoursegrade.gType,lmscoursegrade.selectObj,"no",lmscoursegrade.selectMenuCallback);var s=lmscoursegrade.root.querySelector('[class="zp_gradecnt zp_grdmg"]');s.setAttribute("class","zp_gradecnt zp_grdmg zp_dyn"),(s="passorfail"==lmscoursegrade.tagType?lmscoursegrade.root.querySelector('[_rel="hidepassorfail"]'):lmscoursegrade.root.querySelector('[_rel="hideLetterGrade"]')).setAttribute("class","zp_gradecnt zp_grdmg")},untaggedlettergrade:function(e){var t=lmscoursegrade.root.querySelector('[class="zp_gradecnt zp_grdmg"]'),s="";t&&t.setAttribute("class","zp_gradecnt zp_grdmg zp_dyn"),"0"==e.value?(s="hideNoGrade",lmscoursegrade.letterSelOption=!1):"1"==e.value?(s="hideLetterGrade",lmscoursegrade.letterSelOption=!0,lmscoursegrade.tagType="lettergrade",lmscoursegrade.tagCategory("letterGrade")):"2"==e.value?(s="hidepassorfail",lmscoursegrade.letterSelOption=!0,lmscoursegrade.tagType="passorfail",lmscoursegrade.tagCategory("passorfail")):"3"==e.value&&(s="hideTotalPoints",lmscoursegrade.letterSelOption=!1),(t=lmscoursegrade.root.querySelector('[_rel="'+s+'"]')).setAttribute("class","zp_gradecnt zp_grdmg")},tagCategory:function(e){var t="",s="";"letterGrade"==e?(t="lettergradecategory",s="passfailcategory"):(s="lettergradecategory",t="passfailcategory");t="letterGrade"==e?"lettergradecategory":"passfailcategory";var r=lmscoursegrade.root.querySelector('[_rel="'+t+'"]');r.innerHTML="",lmscoursegrade.root.querySelector('[_rel="'+s+'"]').innerHTML="";var l=lmscoursegrade.categoryDivConstruction();r.appendChild(l),lmscoursegrade.catRoot=l,lmsbase.addListener(lmscoursegrade.catRoot,"input",lmscoursegrade.inputHandler,!1),lmsbase.addListener(lmscoursegrade.catRoot,"focusin",lmscoursegrade.focusinHandler,!1),lmsbase.addListener(lmscoursegrade.catRoot,"focusout",lmscoursegrade.focusoutHandler,!1)},selectMenuCallback:function(e){1!=e.value&&2!=e.value&&1==lmscoursegrade.letterSelOption?lmscoursegrade.alertMessage(e):lmscoursegrade.untaggedlettergrade(e)},hideElementConstruction:function(e,t){lmscoursegrade.hideNoGrade(e,t),lmscoursegrade.hideLetterGrade(e,t),lmscoursegrade.hidepassorfail(e,t),lmscoursegrade.hidetotalpoints(e,t)},hideNoGrade:function(e,t){var s=document.createElement("div"),r="zp_gradecnt zp_grdmg zp_dyn";0==t&&(r="zp_gradecnt zp_grdmg"),s.setAttribute("class",r),s.setAttribute("_rel","hideNoGrade");var l=document.createElement("div");s.appendChild(l);var a=document.createElement("div");a.setAttribute("class","zp_grdscl"),l.appendChild(a),e.appendChild(s)},hideLetterGrade:function(e,t){var s=document.createElement("div"),r="zp_gradecnt zp_grdmg zp_dyn";1==t&&(r="zp_gradecnt zp_grdmg"),s.setAttribute("class",r),s.setAttribute("_rel","hideLetterGrade"),e.appendChild(s);var l=document.createElement("div");s.appendChild(l);var a=document.createElement("div");a.setAttribute("class","zp_grdscl"),a.innerHTML="<p>"+ZPI18N.getString("zp.lms.courseSetting.lettergradetext")+"</p>",l.appendChild(a);l=document.createElement("div");s.appendChild(l),l.setAttribute("class","zp_Sgrd"),lmscoursegrade.letterCategorydiv=l,l.innerHTML="<label><p>"+ZPI18N.getString("zp.lms.courseSetting.gradecategory")+"</p><p>"+ZPI18N.getString("zp.lms.courseSetting.percentage")+"</p></label>",l.innerHTML+='<div _rel="lettergradecategory"></div>'},hidepassorfail:function(e,t){var s=lmscoursegrade.valElem.gradeRating,r=document.createElement("div"),l="zp_gradecnt zp_grdmg zp_dyn";2==t&&(l="zp_gradecnt zp_grdmg"),r.setAttribute("class",l),r.setAttribute("_rel","hidepassorfail");var a=document.createElement("div");r.appendChild(a);var n=document.createElement("div");n.setAttribute("class","zp_grdscl"),n.innerHTML="<p>"+ZPI18N.getString("zp.lms.courseSetting.passfailtext")+"</p><span><p>"+ZPI18N.getString("zp.lms.gradeSetting.minpassmark")+":</p><b>"+s.minMark+"</b> %</span>",a.appendChild(n);var i=document.createElement("div");i.setAttribute("class","zp_grdtxt"),a.appendChild(i),e.appendChild(r);var o=document.createElement("div");r.appendChild(o),o.setAttribute("class","zp_Sgrd"),lmscoursegrade.passCategorydiv=o,o.innerHTML="<label><p>"+ZPI18N.getString("zp.lms.courseSetting.gradecategory")+"</p><p>"+ZPI18N.getString("zp.lms.courseSetting.percentage")+"</p></label>",o.innerHTML+='<div _rel="passfailcategory"></div>'},hidetotalpoints:function(e,t){var s=document.createElement("div"),r="zp_gradecnt zp_grdmg zp_dyn";3==t&&(r="zp_gradecnt zp_grdmg"),s.setAttribute("class",r),s.setAttribute("_rel","hideTotalPoints");var l=document.createElement("div");s.appendChild(l);var a=document.createElement("div");a.setAttribute("class","zp_grdscl"),a.innerHTML="<p>"+ZPI18N.getString("zp.lms.courseSetting.totalpointstext")+"</p>",l.appendChild(a),e.appendChild(s)},categoryDivConstruction:function(e,t){var s=lmscoursegrade.valElem.categoryList,r=0,l=document.createElement("ul");if(0==s.length)lmscoursegrade.catId=0;else{lmscoursegrade.catId=s.length-1;for(var a=0;a<s.length;a++)l.appendChild(lmscoursegrade.appendCategoryRow(s[a].categoryName,s[a].percentage,a,s[a].categoryId)),r+=parseInt(s[a].percentage)}var n=document.createElement("li");n.setAttribute("class","notp"),n.innerHTML='<em _rel="addCourseCategory"><i class="IC-plus"></i>'+ZPI18N.getString("zp.addcategory")+"</em>",l.appendChild(n);var i=document.createElement("li");return i.setAttribute("class","zp_grdnt"),i.innerHTML+='<span><p><i class="IC-info1"></i>'+ZPI18N.getString("zp.lms.courseSetting.cannotexceed")+'</p></span><font><b _rel="courseCategoryTotal">'+r+"%</b></font>",l.appendChild(i),l},appendCategoryRow:function(e,t,s,r){var l=document.createElement("li");r=r||0;var a=document.createElement("span");a.appendChild(lmscoursegrade.tempInputtextField(e,s,r));var n=document.createElement("span");n.appendChild(lmscoursegrade.tempInputNumberField(t,s,r));var i=document.createElement("span");i.innerHTML="%",n.appendChild(i);var o=document.createElement("i");return o.setAttribute("class","IC-delete"),o.setAttribute("_rel","categoryDelete"),n.appendChild(o),l.appendChild(a),l.appendChild(n),l},addCategoryRow:function(e){var t=20;"new"==e&&(t=lmscoursegrade.validateCategoryPercentage());var s=lmscoursegrade.appendCategoryRow(ZPI18N.getString("zp.category"),t,parseInt(lmscoursegrade.catId)+1),r=lmscoursegrade.catRoot.querySelector('[class="notp"]');lmscoursegrade.catRoot.insertBefore(s,r),lmscoursegrade.catId=parseInt(lmscoursegrade.catId)+1,lmscoursegrade.calculateTotalMarks(),lmscoursegrade.addNewCourseCategory(ZPI18N.getString("zp.category"),parseInt(t),lmscoursegrade.catId)},deleteCategory:function(e){lmsnotify.show({header:ZPI18N.getString("zp.lms.courseSetting.deletecategoryheader"),body:ZPI18N.getString("zp.lms.courseSetting.deletecategorybody"),button_text:ZPI18N.getString("zp.lms.courseSetting.deletecategory"),texttype:"negative",successCallback:function(){this.status&&lmscoursegrade.confirmdeleteCategory(e)},cancelCallback:function(){}})},confirmdeleteCategory:function(e){var t=e.closest("span").querySelector('[_srel="category"]').getAttribute("_categoryid");if(t){var s={method:"deleteGradeCategory"};s.conreqcsr=csrfToken,s.catId=t,lmscoursegrade.warnWhenGradeSettingsIsChanged(),s.courseId=lmscourses.currentCourseId,$.post("/gradeSettingAction.zp",s,(function(s){if(1==s[1]){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.courseSetting.successdeletecategory")),e.closest("li").remove();var r=lmscoursegrade.commonCalculateFun();lmscoursegrade.catRoot.querySelector('[_rel="courseCategoryTotal"]').innerHTML=r+"%";for(var l=lmscoursegrade.valElem.categoryList,a=0;a<l.length;a++)l[a].categoryId==t&&lmscoursegrade.valElem.categoryList.splice(a,a+1)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.courseSetting.errordeletecategory"))})).fail((function(e){"permission denied"==JSON.parse(e.responseText)[1].msg&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.assessment.error.nopermission"))}))}},tempInputtextField:function(e,t,s){var r=document.createElement("input");return r.setAttribute("value",e),r.setAttribute("type","text"),r.setAttribute("_categoryId",s),r.setAttribute("_srel","categoryName"),r.setAttribute("_rel",t+"textCategory"),r},tempInputNumberField:function(e,t,s){var r=document.createElement("input");return r.setAttribute("value",e),r.setAttribute("class","zp_inpmrk"),r.setAttribute("type","text"),r.setAttribute("_categoryId",s),r.setAttribute("_srel","category"),r.setAttribute("_rel",t+"numberCategory"),r},requestTheserver:function(){var e={"Show only my grades":"showmygrade","Show both my grades and other learner grades ":"showallgrade","Do not show grades ":"shownograde"},t=lmscoursegrade.root.querySelectorAll('[fieldName="checkBoxChoice"]'),s={};s.courseId=lmscourses.currentCourseId;for(var r=0;r<t.length;r++)t[r].getAttribute("name")&&(s[t[r].getAttribute("name")]="IC-cbox zp_gclr"==t[r].className);var l=lmscoursegrade.root.querySelectorAll('[class="IC-rdo zp_gclr"]');for(r=0;r<l.length;r++)l[r].getAttribute("name")&&(s[e[l[r].getAttribute("value")]]=!0);for(l=lmscoursegrade.root.querySelectorAll('[class="IC-rdo"]'),r=0;r<l.length;r++)l[r].getAttribute("name")&&(s[e[l[r].getAttribute("value")]]=!1);var a=lmscoursegrade.root.querySelector('[_rel="courseGradetype"]').querySelector('[_mode="single"]').getAttribute("_rel");s.gradeScale=a,s.method="updateCourseGrade",s.conreqcsr=csrfToken;var n=lmscoursegrade.gradeSetting;lmscoursegrade.valElem.gradeScale!=s.gradeScale&&lmscoursegrade.warnWhenGradeSettingsIsChanged(),$.post("/gradeSettingAction.zp",s,(function(e){null!=e[0]?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.courseSetting.successcoursegrade")),lmscoursegrade.valElem.gradeScale=s.gradeScale,n.gradeScale!=s.gradeScale&&0!=s.gradeScale&&lmscoursegrade.requestRecalculate(s)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.courseSetting.errorcoursegrade"))})).fail((function(e){"permission denied"==JSON.parse(e.responseText)[1].msg&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.assessment.error.nopermission"))}))},requestRecalculate:function(e){var t={};t.courseId=lmscourses.currentCourseId,t.batchId=lmscourses.currentBatchId,t.method="recalculateGradeBook",t.mode=e.gradeScale,t.conreqcsr=csrfToken},getGradeCategory:function(e,t,s){var r={};r.courseId=e,r.method="getGradeCategory",r.searchText=t,r.conreqcsr=csrfToken,$.post("/gradeSettingAction.zp",r,(function(e){s(e[1])}))},isGradingEnabled:function(e,t){var s={};s.courseId=e,s.method="isGradingEnabled",s.conreqcsr=csrfToken,$.post("/gradeSettingAction.zp",s,t)},gradeConfiguration:function(e,t){if(1==lmscoursegrade.gradeSetting.gradeScale){var s,r,l=e.querySelector("[gradeCategoryMenu]");l.removeAttribute("gradeCategoryMenu"),lmsform.Obj.insertMenu((s={},r={},{elem:l,type:"select",mode:"single",menulist:function(){var e=this;s[e.value]?e.updateOptionList(s[e.value]):lmscoursegrade.getGradeCategory(t.courseId,e.value,(function(t){for(var l={0:[ZPI18N.getString("zp.select")]},a=t.length-1;a>=0;a--)l[t[a].categoryId]=[t[a].categoryName],r[t[a].categoryId]=t[a];s[e.value]=l,e.updateOptionList(l)}))},click:function(){t.gradeCategoryDetails=r[lmsmenu.getSelectOptions(this.elem)[0]]}}));var a={};this.gradeCategoryDetails&&(a[this.gradeCategoryDetails.categoryId]=[this.gradeCategoryDetails.categoryName]),lmsmenu.changeToSelectMenu(l,a,"single",null,ZPI18N.getString("zp.select"))}},createGradeCategoryMenu:function(e,t,s,r){var l={},a={};return lmsmenu.changeToSelectMenu(t,s||{},"single",null,ZPI18N.getString("zp.select")),{elem:t,type:"select",mode:"single",menulist:function(){var t=this;l[t.value]?t.updateOptionList(l[t.value]):lmscoursegrade.getGradeCategory(e,t.value,(function(e){for(var s={0:[ZPI18N.getString("zp.select")]},r=e.length-1;r>=0;r--)s[e[r].categoryId]=[e[r].categoryName],a[e[r].categoryId]=e[r];l[t.value]=s,t.updateOptionList(s)}))},click:function(){r&&(this.getSelectedValue=function(){return lmsmenu.getSelectOptions(this.elem)[0]},this.getSelectedData=function(){return a[this.getSelectedValue()]},r.call(this))}}},warnWhenGradeSettingsIsChanged:function(){lmscoursedetails.currentCourseData[0].doesAnyLearnerHaveGrade&&(this.gradeWarning||(this.gradeWarning=!0,lmsnotify.show({header:ZPI18N.getString("zp.lms.gradeSettings.edit.affectsGrades.warning.header"),body:ZPI18N.getString("zp.lms.gradeSettings.edit.affectsGrades.warning.body"),button_text:ZPI18N.getString("zp.ok"),texttype:"negative",successCallback:function(){},cancelCallback:function(){}}),$('[_rel="cancel"]',lmsnotify.elem).remove()))}},lmscalendarheader={type:1,root:null,curMonth:null,curYear:null,sessionData:{},initiate:function(){lmscalendarheader.root=this.elem,lmscalendarheader.type=1,lmscalendarheader.root.innerHTML=ZPeople.LOADING_HTML,lmscalendar.currentCourseId=null;var e=new Date;ZPCal.Calendar.preDayValue=0,ZPCal.Calendar.preWeekValue=0,ZPCal.Calendar.preMonthValue=0;let t=e.getDateBy(dateFmt);const s=`${ZPDateTime.days_long[e.getDay()]},&nbsp;${ZPDateTime.months_long[e.getMonth()]} ${e.getDate()}`,r=`\n            <div id="zp_lms_calendar_view">\n                <div class="zpl_btnmnu" id="cal_header">\n                    <div class="zpl_lft"></div>\n                    <div class="zpl_cntrdv" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" aria-label="${ZPI18N.getString("zp.wcag.periodselectiontext",[t+" - "+t])}">\n                        <button type="button" class="zlabel zlabel--outline zlabel--medium" _rel="today" data-toggle="tooltip" data-placement="bottom" title="${s}">${ZPI18N.getString("zp.today")}</button> \n                        <div class="zpl_inav">\n                            <i class="PI_alft" role="button" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" aria-label="${ZPI18N.getString("zp.wcag.changeprev",[ZPI18N.getString("zp.smallperiod")])}"></i> \n                            <i class="PI_monthly" title="${ZPI18N.getString("zp.calendarview")}" role="button" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" aria-label="${ZPI18N.getString("zp.selectdate")}"></i>\n                            <i class="PI_argt" role="button" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" aria-label="${ZPI18N.getString("zp.wcag.changeprev",[ZPI18N.getString("zp.smallperiod")])}"></i>\n                        </div>\n                        <div elem="dateNavigator" id="calmonth">\n                            <b>Aug-2023</b>\n                        </div>\n                    </div>\n                    <div class="zpl_rgt">\n                        <select id="courseFetch" tabindex="${lmsConstants.TAB_INDEX.INACTIVE}"></select>\n                    </div>\n                </div>\n                <div class="zpl_rgtcnt" id="cal_body">\n                    <div class="_dayvw">\n                        <div class="zpl_tblres zpl_DNI" id="weekviw"></div>\n                        <div class="zpl_calndrvw" id="monthcalendardiv"></div>\n                    </div>\n                </div>\n            </div>`;lmscalendarheader.root.innerHTML=r,lmsbase.addListener(document.querySelector('[id="cal_header"]'),"click",lmscalendarheader.clickHandler,!1),lmscalendarheader.menuObj=lmsgroupmenu.initiate(lmscalendarheader.root),ZPeopleComponents.select(settingsPage.container.find("#courseFetch")),settingsPage.container.find("#courseFetch").on("zselectchange",lmscalendarheader.getSessionForCourse);const l={dataSource:{search:function(e){return new Promise((function(t,s){let r=lmscalendarheader.getCourse(e.query);t({results:r,more:100==r.length})}))},paginated:!0},placeholder:ZPI18N.getString("zp.lms.feedback.courses"),dropdownList:{fitForElement:!0,isTextHTMLEncoded:!0},cacheData:!0,lazyLoading:!1,serverSearch:!0,showSearchField:!0,search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults")},isLabelHTMLEncoded:!0};ZPeopleComponents.select(settingsPage.container.find("#courseFetch")).setAttributes(l),lmscalendarheader.calendarDiv=document.getElementById("zp_lms_calendar_view"),ZPCal.Calendar.CURMODE="month",lmscalendarheader.monthCalendarView()},getSessionForCourse:function(e){e&&e.detail&&e.detail.selectedValue&&(lmscalendar.currentCourseId=e.detail.selectedValue),lmscalendarheader.getSession(e)},close:function(){lmsbase.closeMaskv5(),$("#courseFetch").length>0&&ZPeopleComponents.select($("#courseFetch")).destroy()},getCourse:function(e){let t=[];var s={courseType:lms.typeData[1].typeId};return e&&(s.searchTxt=e,s.isFromCalendar=!0),zplms.getAsync("/lms/courses/list",s,(function(e){"failure"!=e.status&&(t.push({label:ZPI18N.getString("zp.lms.course.allcourse"),value:0}),e.courses.forEach((e=>{t.push({label:e.courseName,value:e.courseId})})))}),!1,!1),t},fetchMenu:function(){lmscalendarheader.menuCallBack=this.updateOptionList,lmscalendarheader.inputvalue=this.value,lmscalendarheader.getCourse(lmscalendarheader.courselistener)},groupCalMenu:function(e){lmscalendarheader.menuObj.insertMenu({elem:e,type:"select",mode:"single",menulist:lmscalendarheader.fetchMenu,click:lmscalendarheader.clickActionCal}),lmsmenu.changeToSelectMenu(e,{},"single",null,ZPI18N.getString("zp.lms.feedback.courses"))},fetchCourses:function(e){lmscalendar.menuCallBack=this.updateOptionList,lmscalendar.inputvalue=this.value,3===lms.role?lmscourses.getCourseGridDetails("",lmscalendar.courselistener,"1","MyCourses"):lmscourses.getCourseGridDetails("",lmscalendar.courselistener,"1","Course Catalog")},clickActionCal:function(e){lmscalendar.currentCourseId=e.value;const t={curMonth:lmscalendarheader.curMonth,curYear:lmscalendarheader.curYear,courseId:e.value};lmscalendarheader.monthCalendarView(t.curMonth,t.curYear)},clickHandler:function(e){"today"==e.target.getAttribute("_rel")&&lmscalendarheader.monthCalendarView()},monthCalendarView:function(e,t){ZPCal.Calendar.CURMODE="month";let s=lmscalendarheader.root.querySelector('[class="PI_argt"]'),r=lmscalendarheader.root.querySelector('[class="PI_alft"]');s.click=ZPCal.Calendar.monthNavigation(1),r.click=ZPCal.Calendar.monthNavigation(-1),s.setAttribute("title",ZPI18N.getString("zp.calnextmonth")),r.setAttribute("title",ZPI18N.getString("zp.calprevmonth")),lmscalendarheader.populateMonthCalendar(e,t)},populateMonthCalendar:function(e,t){var s=Calendar.getCurrentDay().day.getMonth(),r=new NewCalendar.calObj;r.curYear=t||Calendar.getCurrentDay().day.getFullYear(),r.curMonth=e||s,lmscalendarheader.curMonth=r.curMonth,lmscalendarheader.curYear=r.curYear,r.curMonthDays=s,r.calcontId="monthcalendardiv",r.outerdivId="zp_lms_calendar_view",r.daysObj={empty:"zpcalempty",weekend:"zpcalweek",day:"zpcaldays",today:"zpcaltoday",leave:"zpcalholi"},r.divid="cal_body",r.callback=lmscalendarheader.getSession,r.mode="lmsmonth",r.tdonclick=null,r.totaldata=null,r.prearrow="PI_alft",r.nextarrow="PI_argt",r.dashboardClass="ZP-monthtable",r.datepickerClass="PI_monthly",ZPCal.Calendar.calendarObj=r,NewCalendar.initCalendar(r),document.getElementById("cal_body").style.display="block"},getSession:function(e){let t=!1;e&&e.detail&&e.detail.selectedValue?(e.curMonth=lmscalendar.hasOwnProperty("curMonth")&&null!=lmscalendar.curMonth&&null!=lmscalendar.curMonth?lmscalendar.curMonth:Calendar.getCurrentDay().day.getMonth(),e.curYear=lmscalendar.hasOwnProperty("curYear")&&null!=lmscalendar.curYear&&null!=lmscalendar.curYear?lmscalendar.curYear:Calendar.getCurrentDay().day.getFullYear()):(lmscalendar.curMonth=e.curMonth,lmscalendar.curYear=e.curYear),lmscalendarheader.curMonth=e.curMonth,lmscalendarheader.curYear=e.curYear;let s={month:e.curMonth,year:e.curYear};document.getElementById("cal_body").style.display="block";let r="lms/calendar";lmscalendar.currentCourseId&&0!=lmscalendar.currentCourseId&&(r+="/"+lmscalendar.currentCourseId),e&&e.detail&&e.detail.selectedValue&&(t=!0),http.get(r,s).then((e=>{lmscalendarheader.sessionData={},lmscalendarheader.constructLMSCalendar(e,s,t)})).catch((e=>{e&&e.message&&""!=e.message?ZPeople.Message.showFailureMsg(e.message):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.messages.unexpectederror"))}))},constructLMSCalendar:function(e,t,s){e&&e.hasOwnProperty("holidays")&&e.hasOwnProperty("sessionInfo")&&(s&&function(){let e=lmscalendarheader.calendarDiv.querySelectorAll('[class="zpl_crscal"]');e&&0!=e.length&&e.forEach((e=>{e&&e.remove()}));let t=lmscalendarheader.calendarDiv.querySelectorAll('[class^="zpl_shftdts zpl_holiBgbdr"]');t&&0!=t.length&&t.forEach((e=>{e&&e.remove()}))}(),lmscalendarheader.constructSessions(e.sessionInfo),lmscalendarheader.constructHolidays(e.holidays,t))},constructSessions:function(e){function t(e,t,s){const{courseName:r,sessionName:l}=e;return`<div class="jc${e.bannerBGData.clrId}" data-popup-open="calinfo" role="listitem" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" rel="${e.bannerBGData.clrId}" onclick="lmscalendarheader.constructViewCard('${e.sessionId}')">\n\t\t\t\t\t\t\t<p>${t} - ${s}</p>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<em>${ZPI18N.getString("zp.lms.course")}:</em>\n\t\t\t\t\t\t\t\t\t<b>${r}</b>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<em>${ZPI18N.getString("zp.session")}:</em>\n\t\t\t\t\t\t\t\t\t<b>${l}</b>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}0!=Object.keys(e).length&&Object.values(e).forEach((e=>{!function(e){if(0==e.length)return;e.forEach(((e,s)=>{!function(e){e.hasOwnProperty("sessionType")&&(e.typeOfSession=1==e.sessionType?ZPI18N.getString("zp.lms.classroom"):ZPI18N.getString("zp.lms.elearning"))}(e),lmscalendarheader.sessionData[e.sessionId]=e;let r=e.sessionStartDate.split("-");r[1]=r[1].replace(/^0+/,""),r[2]=r[2].replace(/^0+/,""),r=r[1]+"-"+r[2]+"-"+r[0];let l=e.sessionStartDate.parseDate("yyyy-mm-dd"),a=lmscalendarheader.calendarDiv.querySelector('[date="'+r+'"]');if(a.tabIndex=lmsConstants.TAB_INDEX.ACTIVE,a.ariaLabel=`${ZPDateTime.months_long[l.getMonth()]} ${l.getDate()}, ${ZPDateTime.days_long[l.getDay()]}`,0==s&&a){let s='<div class="zpl_crscal" date="'+r+'" role="list">';s+=t(e,e.sessionStartTime,e.sessionEndTime),s+="</div>",a.appendChild(lmsdocument.parseStringToDOMElement(s))}else if(a=lmscalendarheader.calendarDiv.querySelector('[date="'+r+'"]').querySelector('[date="'+r+'"]'),a){let s=t(e,e.sessionStartTime,e.sessionEndTime);a.appendChild(lmsdocument.parseStringToDOMElement(s))}}))}(e)}))},constructHolidays:function(e,t){0!=Object.keys(e).length&&Object.values(e).forEach((e=>{let s=function(e){var t=e.split("-"),s=t[1],r=t[2];"0"===s.charAt(0)&&(t[1]=s.replace(/^0+/,""));"0"===r.charAt(0)&&(t[2]=r.replace(/^0+/,""));return t[0]+"-"+t[1]+"-"+t[2]}(t.month+1+"-"+e.date+"-"+t.year),r=lmscalendarheader.calendarDiv.querySelector('[date="'+s+'" ]');r&&r.appendChild(lmsdocument.parseStringToDOMElement(e.txt))}))},constructViewCard:function(e){lmscalendar.getSessionDetails(lmscalendarheader.sessionData[e],1)}},lmsnotes={root:null,scrollElem:null,deleteNoteId:null,filterInstance:null,htmlConf:{type:"normal",header:!0,filter:!0,quickFilter:!1,quickAddButton:!1,attachScroll:!0,insertAddNote:!1,scrollQueryString:"[_rel = nlist]",headerClass:"zpl_btnmnu",headerId:"headerNotes",bodyClass:"zp_cwrap",filterId:"lmsFilter",filterClass:"zpl_fltr",headerHTML:'<div class="zpl_rgt"><button class="zlabel zlabel--blue zlabel--medium" _rel = "addnote">'+ZPI18N.getString("zp.lms.notes.addnote")+'</button><i class="zpl_ibg PI_lens" id="searchNote" title="'+ZPI18N.getString("zp.search")+'"></i><i class="zpl_ibg PI_fltr" _rel="Filter" title="'+ZPI18N.getString("zp.filter")+'" role="button" tabindex="'+lmsConstants.TAB_INDEX.ACTIVE+'" aria-label="'+ZPI18N.getString("zp.filter")+'"></i></div>',filterHTML:'<div class="zp_Lttl"></div>'},IdMappingToParam:{sortByFilter:"sortBy",favouriteFilter:"favourite"},_dim:null,_colr:["nc1","nc2","nc3","nc4"],_morelst:[{del:[ZPI18N.getString("zp.lms.delete")]}],_note_on_edit:!1,_note_on_edit_node:null,emptyNote:null,_refer:{entityType:0,entityId:void 0,courseId:void 0,moduleId:void 0,courseName:void 0,currentCourseId:void 0,currentCourseName:void 0,sortBy:"desc",index:1,baseUri:"",prevHash:"",quickNoteParams:null},menuCallBack:null,courseData:[],filterMode:!1,lastRequestParams:{},integ:!1,integrationType:void 0,appliedFilter:{},filterParams:{},uploadConfig:{multiple:!0,requiredFileTypes:"anysupportedfiles",MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED:10,MAXSIZE:10485760},initiate:function(){lmsnotes.reInitialise(),this.integ&&lmsnotes.integrationMode(this),lmsnotes.layoutConstruction(this),lmsnotes.fetchNotes(),ZPeople.FireScroll.reset(),lmsnotes.setFilterInstance()},integrationMode:function(e){lmsnotes.integ=!0,lmsnotes.integrationType=e.integrationType,lmsnotes._refer.baseUri=e.baseUri,lmsnotes._refer.courseId=e.courseId,lmsnotes._refer.batchId=e.batchId?e.batchId:void 0,lmsnotes._refer.moduleId=e.moduleId,lmsnotes._refer.courseName=e.courseName,lmsnotes._refer.entityId=e.entityId,lmsnotes._refer.entityType=e.entityType;var t=e.htmlConf,s=lmsnotes.htmlConf;for(var r in t)s[r]=t[r]},layoutConstruction:function(e){lmsbase.removeClass(e.elem,lmsfilter.showClass),e.elem.innerHTML="",lmsnotes.root=e.elem;const t=lmsnotes.root.closest(".zpl_iwrpr");t.tabIndex=lmsConstants.TAB_INDEX.ACTIVE,t.ariaLabel=ZPI18N.getString("zp.common.page.active",[ZPI18N.getString("zp.notes")]);var s=lmsnotes.htmlConf;if(s.header){var r=e.elem.appendChild(document.createElement("div"));r.className=s.headerClass,r.innerHTML=s.headerHTML,r.id=s.headerId;let t=lmsdocument.createElement("div",{class:"search-cmn",id:"noteSearchBox"});t.innerHTML=`<i class="PI_lens"></i>\n                            \t   <input required="" type="text" class="ztextbox" placeholder="${ZPI18N.getString("zp.search")}" id="searchNoteTitleBy" onkeyup="lmsnotes.searchNote(this,event)">\n                            \t   <i class="PI_cls" id="closeSearch" title="${ZPI18N.getString("zp.lms.close")}"></i>`,r.appendChild(t);let l=function(e){27==e.keyCode&&(lmsnotes.closeSearch(),lmsbase.removeListener(document,"keyup",l))};$("#searchNote").click((function(){$("#searchNoteTitleBy").val(""),$("#noteSearchBox").addClass("opn"),$("#searchNoteTitleBy").focus(),lmsbase.addListener(document,"keyup",l)})),$("#closeSearch").click((function(){lmsnotes.closeSearch(),lmsbase.removeListener(document,"keyup",l)}))}if(lmsbase.hide(document.querySelector('[_rel="fltr"]')),s.filter){var l=e.elem.appendChild(document.createElement("div"));l.id=s.filterId,l.className=s.filterClass,l.innerHTML=s.filterHTML}else if(s.quickFilter){var a=e.elem.appendChild(document.createElement("div"));a.className="zp_Lttl",a.setAttribute("_rel","quickFilter"),a.innerHTML=s.quickFilterHTML}if(e.integ){var n=e.elem.appendChild(document.createElement("div"));lmsbase.addClass(n,"zp_Tnote"),n.setAttribute("_rel","nlist"),n.style.width=n.style.height="100%",lmsnotes.scrollElem=n}else{(n=e.elem.appendChild(document.createElement("div"))).className="zpl_rgtcnt",n.style.position="relative",n.setAttribute("_rel","nlist"),n.role="list",n.ariaLabel=ZPI18N.getString("zp.wcag.proceedingto.list",[ZPI18N.getString("zp.notes")]),n.tabIndex=lmsConstants.TAB_INDEX.ACTIVE,lmsnotes.scrollElem=e.elem}if(s.quickAddButton){var i=n.appendChild(document.createElement("div"));i.style.display="none",i.className="zp_Note "+lmsnotes.getRandomColor()+" zp_Nnte",i.setAttribute("_rel","addnote"),i.setAttribute("quickAddButton",""),i.innerHTML='<div><i class="IC-add-r"></i>'+ZPI18N.getString("zp.lms.notes.addnewnote")+"</div>"}lmsbase.addListener(lmsnotes.root,"click",lmsnotes.noteHandle,!1),"quick"==s.type&&(lmsbase.addListener(lmsnotes.root,"paste",lmsnotes.pasteHandle,!1),lmsbase.addListener(lmsnotes.root,"drop",lmsnotes.pasteHandle,!1))},isHashValidAndWithFilter:function(e,t){var s=""==e.level1,r=s?!s:"discussion"==e.level1||"notes"==e.level1||"object"==typeof e.level1&&"object"==typeof e.level1.filter;s=s||r;var l=""==e.level2||null==e.level2,a=s&&l,n={valid:a,filterMode:r,hashObject:e};if(a&&r){var i=lmsnotes.validateAndParseFilterObj(e.level1.filter,t);n.valid=n.valid&&Boolean(i),n.fltrObj=i}return n},validityObjHandle:function(e){e.valid&&e.filterMode&&e.fltrObj&&e.fltrObj.items.courseId?(lmsnotes.tempData=e,lmsnotes.getCourse(lmsnotes.setCourseDataAndValidateCourse)):lmsnotes.hashHandling(e)},validateAndParseFilterObj:function(e,t){var s={items:{}};for(var r in e){if(!t[r]||t[r].integ)return!1;if(t[r].search){if(e[r]=e[r].toString(),""==e[r])return!1;s.srch=[e[r]]}else if("array"==t[r].type){for(var l="string"==typeof e[r]?[e[r]]:e[r],a={},n=0;n<l.length;n++){if(!("number"==t[r].datatype?l[n]>0&&l[n]<=0x8000000000000000:""!=l[n]))return!1;if(a[l[n]])l.splice(n,1),n--;else{var i=[t[r].name+" "+(n+1),""];a[l[n]]=i}}s.items[r]=a,e[r]=l}else{if("string"!=t[r].type)return!1;if(!t[r].validValues[e[r]])return!1;a={},i=[t[r].name[e[r]],""];a[e[r]]=i,s.items[r]=a}}return s},hashHandling:function(e){if(e.valid){var t={};if(lmsnotes.filterMode=e.filterMode,e.filterMode)lmsnotes.integ||lmsnotes.viewfilter("","addbar",e.fltrObj),t=e.hashObject.level1.filter;else lmsnotes.root.querySelector(".zp_header .zp_Tglst")&&lmsfilter.filterBar("clear");var s=lmsnotes.makeHash(t);s=s?"/filter:"+s:s,lmsnotes._refer.prevHash=lmsnotes._refer.baseUri+"notes"+s,lmsnotes.fetchNotes(t)}else lmsnotes.revertHash()},setFilterInstance:function(){lmsnotes.filterInstance=lmsfilterutil.getFilterInstance(lmsnotes.getFilterObject())},getFilterObject:function(){let e=[];return e.push(lmsnotes.getCourseNameFilterObject()),e.push(lmsnotes.getSortByFilterObject()),e.push(lmsnotes.getFavouriteFilterObject()),e},getSortByFilterObject:function(){let e=[{value:"desc",label:ZPI18N.getString("zp.lms.notes.recentmodified")},{value:"asc",label:ZPI18N.getString("zp.lms.notes.oldnotes")}];return{type:"select",label:ZPI18N.getString("zp.lms.sortby"),encodeHTML:!0,id:"sortByFil",options:{options:e,placeholder:ZPI18N.getString("zp.select")}}},getFavouriteFilterObject:function(){ZPI18N.getString("zp.lms.favourite");return{type:"checkbox",label:ZPI18N.getString("zp.lms.favourite"),encodeHTML:!0,id:"favFil"}},getCourseNameFilterObject:function(){let e={dataSource:{search:function(e){return new Promise((function(t,s){e.query,e.pages;var r=100*(e.pages-1),l=lmsnotes.getCourseDataForFilter(e.query,r);respObj={results:l,more:100==l.length},t(respObj)}))},paginated:!0},search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults"),delay:20,criteria:"startswith"},isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0,fitForElement:!0},serverSearch:!0,cacheData:!0,lazyLoading:!1,showSearchField:!0,placeholder:ZPI18N.getString("zp.select"),viewPerPage:100,dataMapping:{text:"label",value:"value",id:"value"}};return{type:"tokenfield",id:"courseFil",label:ZPI18N.getString("zp.lms.course.coursename"),encodeHTML:!0,options:e}},getCourseDataForFilter:function(e,t){let s=[];var r={method:"getCourseDetails",courseFor:"MyCourses",start:0,conreqcsr:csrfToken};return e&&""!=e&&(r.courseName=e),zplms.postAsync("/courseAction.zp",r,(function(e){let t=e[1][0].courseInfo;for(let e=0;e<t.length;e++){let r=t[e],l={};r.hasOwnProperty("suggestBy")&&r.hasOwnProperty("suggestCoursesList")||(l.label=r.courseName,l.value=r.courseId,s.push(l))}}),null,!1),s},closeSearch:function(){$("#noteSearchBox").removeClass("opn"),lmsnotes.filterMode=!1,lmsnotes.fetchNotes()},searchNote:function(e){var t=$(e).val();if(13===event.keyCode){let e={};e.title=t,e.startIndex=0,e.sortBy="desc",lmsnotes.filterMode=!0,lmsnotes.fetchNotes(e),lmsnotes.filterInstance.clearBreadCrumbs()}},fetchNotes:function(e,t){var s=e||{},r=lmsnotes._refer;if(s.sortBy=s.sortBy?s.sortBy:r.sortBy,lmsnotes.integ&&(s.courseId=r.courseId,s.moduleId=r.moduleId,s.batchId=r.batchId),!t){if(!lmsnotes.isRequestDuplicate(s,lmsnotes.lastRequestParams,["favourite","title","sortBy","courseId","courseIds"]))return;r.index=1}for(var l in s)s[l]instanceof Array?s[l]=s[l].toString():"string"==typeof s[l]&&(s[l]=s[l].trim());if(s.startIndex=r.index,1==s.startIndex){var a=lmsnotes.root.querySelector("[_rel=nlist]");a.innerHTML="",a.appendChild(lmsmessages.addLoading())}zplms.get("/lms/notes",s,(function(e){if(e[1]&&e[1].nopermission){var t=lmscoursedetails.componentUrl(lmscourses.currentCourseId);lms.changeHash("hash",t+"/overview")}else{var s=lmsnotes._refer.index;lmsnotes.listNotes(e.NoteArray,1==s?"new":"update")}}))},isRequestDuplicate:function(e,t,s,r,l){var a,n=!1;for(var i in s=s||e){if(prop=s instanceof Array?s[i]:i,a=!0,void 0!==e[prop]){if(void 0!==t[prop]){if(!n||r)if(e[prop]instanceof Array){if(e[prop].length>t[prop].length)var o=t[prop],c=e[prop];else o=e[prop],c=t[prop];for(var d={},m=0;m<o.length;m++)d[o[m]]=!0;for(m=0;m<c.length;m++)if(!d[c[m]]){a=!1;break}}else e[prop]!=t[prop]&&(a=!1)}else a=!1;l||(t[prop]=e[prop])}else void 0!==t[prop]&&(a=!1,l||delete t[prop]);if(a)r&&delete e[prop];else if(n=!0,!r&&l)break}return n},resetAppliedFilters:function(){lmsnotes.clearAppliedFilters(),lmsnotes.startIndex=1,lmsnotes.fetchNotes()},clearAppliedFilters:function(){$("#notesApplFil").remove(),lmsnotes.appliedFilter={}},closeFilters:function(e){e&&($("[fil='"+e+"']").remove(),delete lmsnotes.appliedFilter[e],$("#notesApplFil ul").children().length||$("#notesApplFil").remove(),delete lmsnotes.filterParams[lmsnotes.IdMappingToParam[e]],lmsnotes.fetchNotes(lmsnotes.filterParams))},destroyComponents:function(){ZPeopleComponents.tokenfield(lmsnotes.root.querySelector("#courseNameFilter")).destroy(),ZPeopleComponents.select(lmsnotes.root.querySelector("#favouriteFilter")).destroy(),ZPeopleComponents.select(lmsnotes.root.querySelector("#sortByFilter")).destroy(),lmsnotes.root.querySelector("#filterBody").remove(),lmsnotes.root.classList.remove("zpl_fltr_flt")},resetFilter:function(){lmsnotes.destroyComponents(),lmsnotes.fetchNotes()},cancelFilter:function(){lmsnotes.destroyComponents()},filterSortBy:function(){var e={options:[{label:ZPI18N.getString("zp.lms.notes.recentmodified"),value:"desc"},{label:ZPI18N.getString("zp.lms.notes.oldnotes"),value:"asc"}],placeholder:ZPI18N.getString("zp.lms.notes.sortby")};ZPeopleComponents.select(lmsnotes.root.querySelector("#sortByFilter")).setAttributes(e)},filterByFavourite:function(){var e={options:[{label:ZPI18N.getString("zp.lms.favourite"),value:"1"}],placeholder:"select"};ZPeopleComponents.select(lmsnotes.root.querySelector("#favouriteFilter")).setAttributes(e)},deleteMenu:function(){var e=document.createElement("div");e.id="deleteMenu";var t=document.createElement("ul");t.innerHTML="<li>Delete</li>",e.appendChild(t)},noteHandle:function(e){if(lmsnotes.isSelected())return!0;var t=e.target,s=t.getAttribute("_rel"),r=t.getAttribute("rel");if("fltr"==s)lmsnotes.viewfilter(t,"add",null);else if("addnote"==s)"quick"==lmsnotes.htmlConf.type?lmsnotes.quickAdd(t):lmsnotes.addNote();else if("Filter"==s)lmsnotes.filterInstance.constructFilter(),lmsnotes.filterInstance.setFilterCallbacks({callback:lmsnotes.applyCallBack},{callback:lmsnotes.resetCallBack},{callback:lmsnotes.applyCallBack});else if("reset"==r)lmsnotes.resetFilter();else if("cancel"==r)lmsnotes.cancelFilter();else if("color"==s||t.closest('[_rel = "col"]'))lmsnotes.colorMenu(e,t);else if("more"==s||t.closest('[_rel = "mor"]'))lmsnotes.moreMenu(e,t);else if("fav"==s)lmsnotes.triggerFav(e);else if("del"==s)lmsnotes.deleteNote(t.closest("[nteid]").getAttribute("nteid"));else if("attachmentIcon"==s||"attachmentCountSpan"==s){let e=t.closest("[note]");e&&lmsnotes.showAttachmentPopup(e)}else if("downloadAttachmentIcon"==s){let e=t.getAttribute("id");lmsfileaction.saveToLocal(e,0)}else{var l=null;if(l=t.closest("[_rel=quickFilter]"))lmsnotes.quickFilterMenu(e,l);else if(l=t.closest("[attachment]"))lmsnotes._note_on_edit||lmsattachment.init_LIGHTBOX(l);else if(l=t.closest("[note]"))if("quick"==lmsnotes.htmlConf.type){var a=null;"title"==s?lmsnotes.setListenerObject(l,{elem:t,nteid:l.getAttribute("nteid"),kind:"title"}):(a=t.closest("[_rel=text]"))&&lmsnotes.setListenerObject(l,{elem:a,nteid:l.getAttribute("nteid"),kind:"content"})}else"view"==l.getAttribute("ntemode")&&lmsnotes.editnote(l)}},onEnter:function(e){e.which||e.keyCode||e.charCode;13===e.keyCode&&lmsnotes._note_on_edit_node.querySelector("[_rel = text]").focus()},hoverHandle:function(e){var t=e.target;if("close"==t.getAttribute("_rel")){var s=t.closest("[note]");if(s){var r=lmsnotes.parseNoteObjFromElement(s);r.title||r.content||r.addAttachmentIds.length>0?t.setAttribute(lmstooltip._attrib,lmsnotes.isRequestDuplicate(r,lmsnotes.noteObj,["content","color","favourite","title"],!1,!0)?ZPI18N.getString("zp.lms.notes.save_close"):ZPI18N.getString("zp.close")):t.setAttribute(lmstooltip._attrib,ZPI18N.getString("zp.close"))}}},initNoteDIM:function(){var e=lmsnotes.root.querySelector("[_rel=nlist]").getBoundingClientRect().width,t=Math.floor(e/300),s=Array(t).fill(10),r=Math.floor((e-20)/t)-20;lmsnotes._dim={cols:s,size:r}},applyCallBack:function(e){var t={},s=e.appliedFilters;if(Object.keys(s).length){if(s.courseFil){var r=s.courseFil.selectedvalues,l=[];$.each(r,(function(e,t){l.push(t.value)})),t.courseIds=l}if(s.favFil&&(t.favourite=1),s.sortByFil){var a=s.sortByFil.selectedvalues[0].value;t.sortBy=a}}lmsnotes.fetchNotes(t),lmsnotes.filterMode=0!=Object.keys(s).length},resetCallBack:function(){lmsnotes.fetchNotes(),lmsnotes.filterMode=!1},insertNote:function(e){var t=lmsnotes._dim.cols,s=lmsnotes._dim.size,r=function(e){_node=0,_val=e[0];for(var t=1;t<e.length;t++)e[t]<_val&&(_val=e[t],_node=t);return _node}(t);e.style.left=20+r*(s+20)+"px",e.style.top=t[r]+"px",e.style.width=s+"px",t[r]+=20+e.getBoundingClientRect().height},listNotes:function(e,t){var s=lmsnotes.root.querySelector("[_rel=nlist]");if(lmsmessages.removeLoading(),"new"==t){var r=null;lmsnotes.htmlConf.quickAddButton&&(r=s.querySelector("[quickaddbutton]")),e.length>0?(lmsbase.show(document.querySelector('[_rel="fltr"]')),lmsnodata.clearNoData(s),r&&(r.style.display="")):lmsnotes.htmlConf.insertAddNote?lmsnotes._refer.index="end":(lmsnotes._refer.index="nodata",lmsnotes.filterMode?lmsnodata.showNoDataV5("zp_nd_file",lmsnodata.noDatav5.notesNew.filter.title,lmsnodata.noDatav5.notesNew.filter.desc,""):lmsnodata.showNoDataV5("zp_nd_file",lmsnodata.noDatav5.notesNew.general.title,lmsnodata.noDatav5.notesNew.general.desc)),r&&s.insertBefore(r,s.childNodes[0]),lmsnotes.htmlConf.insertAddNote&&"quick"==lmsnotes.htmlConf.type&&lmsnotes.quickAdd()}if("nodata"!=lmsnotes._refer.index&&"end"!=lmsnotes._refer.index){for(var l=document.createDocumentFragment(),a=[],n=0;n<e.length;n++){let t=lmsnotes.getnotecard(e[n],"view"),s=(e[n].noteId,l.appendChild(t));s.setAttribute("nteid",e[n].noteId),s.setAttribute("ntemode","view"),s.tabIndex=lmsConstants.TAB_INDEX.ACTIVE,s.role="listitem",s.ariaLabel=lmsnotes.getLabelContent(n+1,e[n].title),a[n]=s}if(s.appendChild(l),lmsnotes.integ&&"ContentView"==lmsnotes.integrationType||window.setTimeout((function(){"new"==t?lmsnotes.updateNotes():a.forEach(lmsnotes.insertNote)}),0),lmsnotes._refer.index=25==e.length?lmsnotes._refer.index+25:"end","end"==lmsnotes._refer.index)ZPeople.FireScroll.setParam("triggered",!0);else{ZPeople.FireScroll.setParam("triggered",!1),ZPeople.FireScroll.init(lmsnotes.loadMore,lms,null,!0);const e=$(lmsnotes.root);e.height()&&e.prop("scrollHeight")<=e.height()&&lmsnotes.fetchNotes(lmsnotes.lastRequestParams,!0)}}},getLabelContent:(e,t)=>`${ZPI18N.getString("zp.note")} ${e}: ${t}`,deleteCallBack:function(){let e=new DeleteAlertMessage;e.title=ZPI18N.getString("zp.lms.entitydelete",[ZPI18N.getString("zp.note")]),e.despcription=ZPI18N.getString("zp.lms.permenentlydelEntity",[ZPI18N.getString("zp.note")]),e.yesButtonText=ZPI18N.getString("zp.confirm"),e.cancelButtonText=ZPI18N.getString("zp.cancel"),e.callback=function(){lmsnotes.deleteRecord(lmsnotes.deleteNoteId,lmsnotes.deleteResponseHandler)},e.show()},loadMore:function(){lmsnotes.fetchNotes(lmsnotes.lastRequestParams,!0)},updateNotes:function(e){var t=function(){var e=lmsnotes.root.querySelectorAll("[nteid]");lmsnotes.initNoteDIM();for(var t=0;t<e.length;t++)lmsnotes.insertNote(e[t])};e?window.setTimeout(t,1e3):t()},getnotecard:function(e,t){var s=lmsnotes.htmlConf.type,r=e.color&&""!=e.color?parseInt(e.color,10):0,l=lmsnotes._colr[r],a=document.createElement("div");a.setAttribute("note",""),a.className="zpl_Note "+l;var n=a.appendChild(document.createElement("div")),i=n.appendChild(document.createElement("i"));i.className="PI_fav",i.setAttribute("_rel","fav"),1==e.favourite&&(i.className+=" zpl_fav");var o=n.appendChild(document.createElement("div"));o.className="zpl_Ndat",o.innerHTML="<span>"+new Date(parseInt(e.createdTimeInMillis,10)).getDateBy("dd MMM yyyy")+"</span>",lmsnotes.integ||(o.innerHTML+='<span class="zpl_ldot">'+(e.entityType>0?e.courseName:ZPI18N.getString("zp.general"))+"</span>");var c=n.appendChild(document.createElement("div"));c.className="zpl_Ntit",c.setAttribute("data-text",ZPI18N.getString("zp.lms.notes.titlefornote")),c.setAttribute("_rel","title"),c.setAttribute("contenteditable",!0),c.textContent=e.title;var d=document.createElement("div");d.className="zpl_Ncntn",d.setAttribute("_rel","enclosureDiv");var m=d.appendChild(document.createElement("div"));m.className="zpl_Ncnt",m.setAttribute("_rel","text"),m.innerHTML=e.content;const u=document.createElement("a");u.className="zpl_lnk thmbnl d-flexclmcap5",u.setAttribute("_rel","attachmentIconCont"),u.style.display="add"==t||0==e.attachments.length?"none":"";const p=document.createElement("i");p.className="PI_attach",p.setAttribute("_rel","attachmentIcon");const g=document.createElement("span");g.innerText="add"!=t?e.attachments.length:0,g.setAttribute("_rel","attachmentCountSpan"),u.appendChild(p),u.appendChild(g),d.appendChild(u);var f=document.createElement("div");if(lmsnotes.integ&&"ContentView"==lmsnotes.integrationType)e.attachments&&e.attachments.length&&(f.appendChild(ListingUploadManager.getAttachmentListHTMLForNotes(e.attachments,{onlyCount:!0})),d.appendChild(f));else if("view"==t){const t=ListingUploadManager.getAttachmentListHTMLForNotes(e.attachments,{});f.appendChild(t),d.appendChild(f);const s=d.querySelector('[_rel = "attachmentContainer"]');s&&(s.style.display="none")}else f.appendChild(ListingUploadManager.getAttachmentListHTMLForNotes(e.attachments)),d.appendChild(f);n.appendChild(d);var v=n.appendChild(document.createElement("div"));v.className="zpl_Nact",v.setAttribute("_rel","icons");var h='<div class="zpl_micn"><ul><li _rel="col"><b><span><i class="PI_palatte" _rel="color" _color="'+r+'" title='+ZPI18N.getString("zp.lms.notes.colors")+'></i></span></b></li><li _rel="att" style="display : none"><b><span><i class="PI_attach" _rel="attach" action="local" title='+ZPI18N.getString("zp.lms.messages.attach")+'></i></span></b></li><li _rel="mor"><b><span><i class="PI_more" _rel="more" title='+ZPI18N.getString("zp.more")+"></i></span></b></li>";return"quick"!=s&&(h+='<li _rel="clo"  style="display : none"><b class="cls"><span><i class="_cls PI_cls" _rel="close" title='+ZPI18N.getString("zp.close")+"></i></span></b></li>"),h+="</ul>",v.innerHTML=h,a},parseNoteObjFromElement:function(e){if(e){return{title:e.querySelector("[_rel=title]").textContent.trim(),content:e.querySelector("[_rel=text]").innerHTML,favourite:+Boolean(e.querySelector(".zp_fav")),color:e.querySelector("[_color]").getAttribute("_color"),addAttachmentIds:e.uploadHelperObject?this.getAddedAttachmentIds(e):[],removeAttachmentIds:e.uploadHelperObject?this.getRemovedAttachmentIds(e):[]}}},getAddedAttachmentIds:function(e){for(var t=e.uploadHelperObject.getUploadedFiles(),s=[],r=t.length-1;r>=0;r--)s.push(t[r].fileInfo.contentId);return s},getRemovedAttachmentIds:function(e){return lmsnotes.getAttachmentIds(e.uploadHelperObject.getDeletedFiles())},getAttachmentIds:function(e){for(var t=[],s=e.length-1;s>=0;s--)t.push(e[s].contentId);return t},hasAnyPendingUploads:function(e){return lmsnotes.getAttachmentIds(e.uploadHelperObject.hasAnyPendingUploads)},validateLength:function(e){titleHeight=lmsnotes._note_on_edit_node.querySelector("[_rel=title]").offsetHeight,contentTop=lmsnotes._note_on_edit_node.querySelector("[_rel=text]").parentNode.style.top,contentTop!=titleHeight+150+"px"&&(lmsnotes._note_on_edit_node.querySelector("[_rel=text]").parentNode.style.top=titleHeight+150+"px"),e.target.textContent.length>=256&&e.preventDefault()},editnote:function(e){var t=e.cloneNode(!0);const s=lmsbase.constructMaskv5("",!0,lmsnotes.saveNote);s.setAttribute("_rel","editNote"),lmsbase.addListener(s,"mousedown",lmsnotes.noteHandle,!1),lmsbase.addListener(s,"paste",lmsnotes.pasteHandle,!1),lmsbase.addListener(s,"drop",lmsnotes.pasteHandle,!1),lmsbase.addListener(s,"mouseover",lmsnotes.hoverHandle,!1),lmsbase.addListener(s,"input",lmsnotes.changeToSaving,!1),lmsbase.addListener(s,"input",lmsnotes.onNoteInput,!1),e.parentNode.replaceChild(t,e);var r=s.appendChild(e);r.style="",lmsbase.addListener(s.querySelector("[_rel=title]"),"keypress",lmsnotes.validateLength,!1),lmsbase.addListener(s.querySelector("[_rel=title]"),"keyup",lmsnotes.validateLength,!1),r.setAttribute("nteid",e.getAttribute("nteid")),r.setAttribute("ntemode","edit"),lmsnotes.chgeEditable(r);const l=document.createElement("div");l.className="zpl_atosv",l.setAttribute("_rel","saved");const a=document.createElement("div");a.className="zpl_atocnt svd",a.setAttribute("_rel","autoSaveCont");const n=document.createElement("i");n.className="PI_tick2",n.setAttribute("_rel","tickIcon");const i=document.createElement("span");if(i.setAttribute("_rel","saveText"),i.textContent=ZPI18N.getString("zp.saved"),a.appendChild(n),a.appendChild(i),l.appendChild(a),r.querySelector("[_rel=icons]").insertBefore(l,r.querySelector("[_rel=icons]").children[0]),lmsnotes._note_on_edit=!0,lmsnotes._note_on_edit_node=r,lmsnotes.noteObj=lmsnotes.parseNoteObjFromElement(e),lmsnotes.initialObj=lmsnotes.parseNoteObjFromElement(e),e.uploadHelperObject)e.uploadHelperObject.disableSoftKill();else{for(var o=e.querySelector("[attachmentList]").childNodes,c=[],d=0;d<o.length;d++)c[d]=o[d].fileInfo;lmsnotes.invokeUploadManager(e,c)}let m=lmsnotes._note_on_edit_node.querySelector("[_rel=title]").offsetHeight;lmsnotes._note_on_edit_node.querySelector("[_rel=text]").parentNode.style.top=m+150+"px";const u=lmsnotes._note_on_edit_node.querySelector("[attachmenttab]");u&&(u.style.display="");const p=lmsnotes._note_on_edit_node.querySelector('[_rel = "attachmentIconCont"]');p&&(p.style.display="none");const g=lmsnotes._note_on_edit_node.querySelector('[_rel = "close"]');lmsbase.addListener(g,"click",lmsbase.closeMaskv5,!1)},addNote:function(e){lmsnotes.addNotesParams=e||{};var t=lmsnotes.getRandomInt(0,3);const s=lmsbase.constructMaskv5("",!0,lmsnotes.saveNote);s.setAttribute("_rel","editNote"),lmsbase.addListener(s,"mousedown",lmsnotes.noteHandle,!1),lmsbase.addListener(s,"paste",lmsnotes.pasteHandle,!1),lmsbase.addListener(s,"drop",lmsnotes.pasteHandle,!1),lmsbase.addListener(s,"mouseover",lmsnotes.hoverHandle,!1),lmsbase.addListener(s,"input",lmsnotes.changeToSaving,!1),lmsbase.addListener(s,"input",lmsnotes.onNoteInput,!1);var r=s.appendChild(lmsnotes.getnotecard({content:"",title:"",color:t,createdTimeInMillis:(new Date).getTime(),entityType:lmsnotes.addNotesParams.entityType||lmsnotes._refer.entityType,courseName:lmsnotes.addNotesParams.courseName||lmsnotes._refer.courseName},"add"));r.querySelector("[_rel=mor]").style.display="none",r.style="",lmsbase.addListener(s.querySelector("[_rel=title]"),"keypress",lmsnotes.validateLength,!1),lmsbase.addListener(s.querySelector("[_rel=title]"),"keyup",lmsnotes.validateLength,!1),r.setAttribute("ntemode","create"),lmsnotes.chgeEditable(r),lmsnotes._note_on_edit=!0,lmsnotes._note_on_edit_node=r,titleHeight=lmsnotes._note_on_edit_node.querySelector("[_rel=title]").offsetHeight,lmsnotes._note_on_edit_node.querySelector("[_rel=text]").parentNode.style.top=titleHeight+150+"px";const l=lmsnotes._note_on_edit_node.querySelector('[_rel = "close"]');lmsbase.addListener(l,"click",lmsbase.closeMaskv5,!1),lmsnotes.invokeUploadManager(r),lmsnotes.noteObj=lmsnotes.parseNoteObjFromElement(r),lmsnotes.initialObj=lmsnotes.parseNoteObjFromElement(r)},chgeEditable:function(e){var t=e.querySelector("[_rel=title]");t.setAttribute("contenteditable","true"),t.onkeydown=lmsnotes.onEnter;var s=e.querySelector("[_rel=text]");e.querySelector("[_rel=att]").style.display="",e.querySelector("[_rel=clo]").style.display="",lmstinymce.initiate(s)},pasteHandle:function(e){e.preventDefault(),e.stopPropagation();var t=(e.clipboardData||e.dataTransfer).getData("text/plain");if(e.target.closest("[_rel=title]")){var s=e.target.textContent+t;s&&s.length>256&&(t=t.substr(0,256-e.target.textContent.length))}document.execCommand("insertText",!1,t)},resize:function(){lmsnotes.updateNotes()},onkeydown:function(e){var t=e.which||e.keyCode||e.charCode;lmsnotes._note_on_edit&&27==t&&("quick"==lmsnotes.htmlConf.type?lmsnotes.onblur():lmsnotes.saveNote())},triggerFav:function(e){var t,s=e.target,r=s.closest("[note]"),l=r.getAttribute("nteid"),a=r.getAttribute("ntemode");lmsnotes.filterMode&&lmsnotes.lastRequestParams.favourite&&"view"==a?(r.parentNode.removeChild(r),lmsnotes.isNoDataReq()||(lmsnotes.updateNotes(),lmsnotes.isLoadbarNeeded())):(s.className.indexOf("zpl_fav")>-1?(t=0,lmsbase.removeClass(s,"zpl_fav")):(lmsbase.addClass(s,"zpl_fav"),t=1),lmstooltip.showbubble(e)),!l||"view"!=a&&"edit"!=a&&"created_edit"!=a||lmsnotes.changefield({nteid:l,field:"favourite",value:t},lmsnotes.changeFieldResponseHandler)},changeColor:function(e,t,s){var r=e.getAttribute("nteid"),l=e.getAttribute("ntemode"),a=lmsnotes._colr.indexOf(t.className);e.className="zpl_Note "+t.className,e.querySelector("[_color]").setAttribute("_color",a),!r||"view"!=l&&"edit"!=l&&"created_edit"!=l||a==s||lmsnotes.changefield({nteid:r,field:"color",value:a},lmsnotes.changeFieldResponseHandler)},moreMenu:function(e,t){let s=t.closest("[note]"),r=s.getAttribute("nteid"),l=s.querySelector('[_rel = "mor"]');const a=Layout.Page.pageContWrapper.find('[_rel = "moreButton"]');a&&a.remove();const n=lmsdocument.createElement("div",{_rel:"moreButton",noteId:r||""}),i=document.querySelector('[_rel = "editNote"]');ZPeopleComponents.menu(n,{forElement:l,className:"zpl_drpdwn",appendTo:i||Layout.Page.pageContWrapper.find("#lms"),itemclick:lmsnotes.deleteCallBack,show:e=>{e.detail.forElement.addClass("zpl_act")},hide:e=>{e.detail.forElement.removeClass("zpl_act")},contentType:"icon-text"}),i&&ZPeopleComponents.menu(n).setAttribute("direction","bottom-right"),ZPeopleComponents.menu(n).addMenuItem({label:ZPI18N.getString("zp.lms.delete"),iconClass:"PI_delete",className:"red"}),lmsnotes.deleteNoteId=r,ZPeopleComponents.menu(n).show()},colorMenu:function(e,t){let s=t.closest("[note]"),r=s.getAttribute("nteid");const l=lmsdocument.createElement("div",{_rel:"colorMenu",noteId:r||""}),a=s.querySelector('[_rel = "col"]'),n=Layout.Page.pageContWrapper.find('[_rel = "colorMenu"]');n&&n.remove();const i=document.querySelector('[_rel = "editNote"]');let o=ZPeopleComponents.menu(l,{forElement:a,className:"zpl_drpdwn zpl_drpdwnic zpl_clrpckr",appendTo:i||Layout.Page.pageContWrapper.find("#lms"),itemclick:e=>{let t=e.detail,s=t.container[0].getAttribute("noteId");const r=lmsnotes._note_on_edit_node?lmsnotes._note_on_edit_node:lmsnotes.root.querySelector(`[nteid="${s}"]`),l=document.createElement("div");l.className=t.iconClass;let a=r.className.split(" ")[1],n=lmsnotes._colr.indexOf(a);lmsbase.hasClass(l,lmsnotes._colr.join("|"))&&(lmsnotes.changeColor(r,l,n),n=null)},contentType:"icon-text",show:e=>{e.detail.forElement.addClass("zpl_act")},hide:e=>{e.detail.forElement.removeClass("zpl_act")}});o.addMenuItem({iconClass:"nc1",className:"nc1",label:""}),o.addMenuItem({iconClass:"nc2",className:"nc2",label:""}),o.addMenuItem({iconClass:"nc3",className:"nc3",label:""}),o.addMenuItem({iconClass:"nc4",className:"nc4",label:""}),ZPeopleComponents.menu(l).show()},isSelected:function(){return""!=window.getSelection().toString()},chgeColor:function(e,t){e.getAttribute("ntemode");e.className="zp_Note "+lmsnotes._colr[t],e.querySelector("[_color]").setAttribute("_color",t)},changefield:function(e,t){var s={field:e.field};s[e.field]=e.value,zplms.put("/lms/notes/"+e.nteid,s,(function(s){_ncnode=lmsnotes._note_on_edit_node,"normal"==lmsnotes.htmlConf.type&&null!=_ncnode&&("color"==e.field?(lmsnotes.responseObj=s,lmsnotes.noteObj.color=e.value):"favourite"==e.field&&(lmsnotes.responseObj=s,lmsnotes.noteObj.favourite=e.value)),t(s,e),e=t=null}))},changeFieldResponseHandler:function(e,t){_ncnode=lmsnotes._note_on_edit_node,null!=t&&("favourite"==t.field?(lmsnotes.successMsg=t.value?ZPI18N.getString("zp.lms.addedtofavourites"):ZPI18N.getString("zp.lms.removedfromfavourites"),lmsnotes.failureMsg=t.value?ZPI18N.getString("zp.lms.unabletoaddtofavourites"):ZPI18N.getString("zp.lms.unabletoremovefromfavourites")):"color"==t.field?(lmsnotes.successMsg=ZPI18N.getString("zp.lms.notes.colorupdate-success"),lmsnotes.failureMsg=ZPI18N.getString("zp.lms.notes.colorupdate-fail")):(lmsnotes.successMsg=ZPI18N.getString("zp.lms.notes.updatenote-success"),lmsnotes.failureMsg=ZPI18N.getString("zp.lms.notes.updatenote-fail")),"success"==e.status?ModuleComp.Msg.showSuccessMsg(lmsnotes.successMsg):ModuleComp.Msg.showFailureMsg(lmsnotes.failureMsg),lmsnotes.successMsg=lmsnotes.failureMsg=null)},deleteNote:function(e,t){lmsbase.removeListener(document,"keyup",lmsnotes.onkeydown,!1),lmsnotify.show({header:ZPI18N.getString("zp.lms.entitydelete",["note"]),body:ZPI18N.getString("zp.lms.permenentlydelEntity",["Note"]),button_text:ZPI18N.getString("zp.delete"),texttype:"negative",successCallback:function(){this.status&&lmsnotes.deleteRecord(e,t)},cancelCallback:function(){lmsbase.addListener(document,"keyup",lmsnotes.onkeydown,!1)}})},deleteRecord:function(e,t){var s={courseId:lmsnotes._refer.courseId,moduleId:lmsnotes._refer.moduleId};if(zplms.delete("/lms/notes/"+e,s,t),lmsnotes._note_on_edit){if("quick"!=lmsnotes.htmlConf.type){var r=lmsbase.mask;r&&(lmsbase.removeListener(r,"mousedown",lmsnotes.noteHandle,!1),lmsbase.removeListener(r,"paste",lmsnotes.pasteHandle,!1),lmsbase.removeListener(r,"drop",lmsnotes.pasteHandle,!1),lmsbase.removeListener(r,"mouseover",lmsnotes.hoverHandle,!1),lmsnotes._note_on_edit_node.uploadHelperObject.kill(),lmsnotes._note_on_edit_node.uploadHelperObject=null,r.remove())}lmsnotes._note_on_edit=!1,lmsnotes._note_on_edit_node=null}},deleteResponseHandler:function(e){if("success"==e.status){var t=lmsnotes.root.querySelector("[nteid='"+e.noteId+"']");if(t&&t.parentNode.removeChild(t),0==e.noteCount){var s=lmsnotes.root.querySelector("[_rel=nlist]");lmsmodule.elem.querySelector("[id=noteCntCont_"+e.moduleId+"]").style.display="none",lmsnotes.filterMode||lmsbase.hide(document.querySelector('[_rel="fltr"]')),lmsnotes._refer.index="nodata",lmsnodata.showNoDataV5("zp_nd_file",ZPI18N.getString("zp.lms.nonotes"),ZPI18N.getString("zp.lms.nonotesdesc"));var r=document.createElement("div");r.style.display="none",r.className="zp_Note "+lmsnotes.getRandomColor()+" zp_Nnte",r.setAttribute("_rel","addnote"),r.setAttribute("quickAddButton",""),r.innerHTML='<div><i class="IC-add-r"></i>'+ZPI18N.getString("zp.lms.notes.addnewnote")+"</div>",s.insertBefore(r,s.childNodes[0])}else e.noteCount>0&&(lmsmodule.elem.querySelector("[id=noteCount_"+e.moduleId+"]").innerText=e.noteCount);0!=e.noteCount&&lmsnotes.isNoDataReq()||(lmsnotes.updateNotes(),lmsnotes.isLoadbarNeeded()),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.notes.deletenote-success"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.notes.deletenote-fail"));lmsnotes.params=null},isLoadbarNeeded:function(){return"end"!=lmsnotes._refer.index&&"nodata"!=lmsnotes._refer.index&&lmsnotes.scrollElem.scrollHeight<=lmsnotes.scrollElem.clientHeight&&(lmsnotes.fetchNotes(),!0)},isNoDataReq:function(){return!lmsnotes.root.querySelector("[_rel=nlist]").childNodes.length&&(lmsnotes.filterMode||lmsbase.hide(document.querySelector('[_rel="fltr"]')),lmsnotes._refer.index="nodata",lmsnodata.showNoDataV5("zp_nd_file",ZPI18N.getString("zp.lms.nonotes"),ZPI18N.getString("zp.lms.nonotesdesc")),!0)},confirmCancelUploadAndSave:function(){lmsnotes._note_on_edit_node.querySelector("[uploadId]")?ZPeople.BSModal.confirm(lmsnotes.saveNote,ZPI18N.getString("zp.lms.notes.savenote"),ZPI18N.getString("zp.lms.notes.uploadcancel")):lmsnotes.saveNote()},getNoteReqObj:function(){var e=lmsnotes._note_on_edit_node,t=e.getAttribute("ntemode"),s={_params:null,isEmptyNote:!0,checkProperties:null},r=e.querySelector("[_rel=title]"),l=lmstinymce.getcontent(),a=r.textContent.trim(),n=e.uploadHelperObject?e.uploadHelperObject.getAllFilesForSaving():[],i=!!e.uploadHelperObject&&e.uploadHelperObject.hasAnyPendingUploads(),o={content:l,title:a};if("create"==t){o.entityType=lmsnotes.addNotesParams.entityType||lmsnotes._refer.entityType,o.courseId=lmsnotes.addNotesParams.courseId||lmsnotes._refer.courseId||void 0,o.batchId=lmsnotes.addNotesParams.batchId||lmsnotes._refer.batchId||void 0,o.entityId=lmsnotes.addNotesParams.entityId||lmsnotes._refer.entityId||void 0;var c=e.querySelector("[_color]").getAttribute("_color"),d=e.querySelector("[_rel=fav]");o.color=c,o.favourite=d.className.indexOf("zp_fav")>-1?1:0,s.checkProperties=["content","color","favourite","title"]}else o.noteId=e.getAttribute("nteid"),o.action="editNote",s.checkProperties=["content","title"];return s._params=o,(""!=a||""!=l||n.length>0||i)&&(s.isEmptyNote=!1),s},closeNotePopup:function(){var e=lmsnotes.responseObj;_ncnode=lmsnotes._note_on_edit_node,_ntemde=_ncnode.getAttribute("ntemode");const t=lmsnotes._note_on_edit_node.querySelector("[attachmenttab");t&&(t.style.display="none");const s=lmsnotes._note_on_edit_node.querySelector('[_rel = "col"]');s&&s.classList.remove("zpl_act");const r=lmsnotes._note_on_edit_node.querySelector('[_rel = "mor"]');r&&r.classList.remove("zpl_act");var l=_ncnode.querySelector("[_rel=title]"),a=l.textContent.trim();if(lmsnotes.root&&("create"==_ntemde||"created_edit"==_ntemde&&lmsnotes.doesNoteSatisfyFilter(e)||"edit"==_ntemde)){_ncnode.setAttribute("ntemode","view"),l.textContent=a,_ncnode.style="";var n=lmsnotes.root.querySelector("[_rel=nlist]");if("create"==_ntemde||"created_edit"==_ntemde)if("nodata"==lmsnotes._refer.index){lmsnotes._refer.index="end";var i=n.querySelector("#emptPage");n.replaceChild(_ncnode,i)}else"normal"==lmsnotes.htmlConf.type&&lmsnotes.updateAttachmentCountInNotesFooter(_ncnode),lmsnotes.insertNote("desc"==lmsnotes.lastRequestParams.sortBy?n.insertBefore(_ncnode,n.childNodes[0]):"end"==lmsnotes._refer.index?n.appendChild(_ncnode):"");else{var o=_ncnode.getAttribute("nteid");ovrwte_nde=lmsnotes.root.querySelector("[nteid='"+o+"']"),_ncnode.style.left=ovrwte_nde.style.left,_ncnode.style.top=ovrwte_nde.style.top,_ncnode.style.width=ovrwte_nde.style.width,"normal"==lmsnotes.htmlConf.type&&lmsnotes.updateAttachmentCountInNotesFooter(_ncnode),n.replaceChild(_ncnode,ovrwte_nde)}lmsnotes.updateNotes()}},updateAttachmentCountInNotesFooter:function(e){const t=e.querySelector('[_rel = "attachmentIconCont"]');let s=lmsnotes._note_on_edit_node.uploadHelperObject.getAllFilesForSaving().length;if(t&&s>0){e.querySelector('[_rel = "attachmentCountSpan"]').innerText=s,t.style.display=""}else t.style.display="none"},cleanPopUp:function(){_ncnode=lmsnotes._note_on_edit_node,_ncnode.querySelector("[_rel=clo]").style.display="none",_ncnode.querySelector("[_rel=att]").style.display="none",_ncnode.querySelector("[_rel=mor]").style="";var e=_ncnode.querySelector('[_rel="saving"]')||_ncnode.querySelector('[_rel="saved"]');e&&_ncnode.querySelector('[_rel="icons"]').removeChild(e),lmsnotes.responseObj=null,lmsnotes._note_on_edit_node.querySelector("[_rel=title]").removeAttribute("contenteditable"),lmstinymce.remove(),lmsnotes._note_on_edit_node.querySelector("[_rel=text]").style.height=null,lmsnotes._note_on_edit=!1,lmsnotes._note_on_edit_node=null;const t=document.querySelector("#lmsFileUpload");t&&t.remove();let s=lmsbase.mask;s&&(lmsbase.removeListener(s,"mousedown",lmsnotes.noteHandle,!1),lmsbase.removeListener(s,"paste",lmsnotes.pasteHandle,!1),lmsbase.removeListener(s,"drop",lmsnotes.pasteHandle,!1),lmsbase.removeListener(s,"mouseover",lmsnotes.hoverHandle,!1))},saveNote:function(){var e=lmsnotes._note_on_edit_node,t=e.getAttribute("ntemode"),s=lmsnotes.getNoteReqObj();_params=s._params;var r=s.checkProperties;s.isEmptyNote||"create"!=t&&!lmsnotes.isRequestDuplicate(_params,lmsnotes.noteObj,r,!1)?(s.isEmptyNote||lmsnotes.closeNotePopup(),lmsnotes.cleanPopUp()):("create"==t||"created_edit"==t?(lmsnotes.successMsg=ZPI18N.getString("zp.lms.notes.addnote-success"),lmsnotes.failureMsg=ZPI18N.getString("zp.lms.notes.addnote-fail")):(lmsnotes.successMsg=ZPI18N.getString("zp.lms.notes.updatenote-success"),lmsnotes.failureMsg=ZPI18N.getString("zp.lms.notes.updatenote-fail")),zplms.post("/lms/notes",_params,(function(s){"success"==s.status?(lmsbase.show(document.querySelector('[_rel="fltr"]')),delete s.message,delete s.status,"create"==t&&e.setAttribute("nteid",s.noteId),lmsnotes.responseObj=s,lmsnotes.closeNotePopup(),ZPeople.Message.showSuccessMsg(lmsnotes.successMsg)):ZPeople.Message.showFailureMsg(lmsnotes.failureMsg),lmsnotes.successMsg=lmsnotes.failureMsg=null,lmsnotes.cleanPopUp()})))},autoSaveNote:function(){var e=lmsnotes._note_on_edit_node;if(e){var t=e.getAttribute("ntemode"),s=lmsnotes.getNoteReqObj(),r=s._params,l=s.checkProperties;s.isEmptyNote||"create"!=t&&!lmsnotes.isRequestDuplicate(r,lmsnotes.noteObj,l,!0)?lmsnotes.changeToSaved():r.noteId?zplms.patch("/lms/notes/"+r.noteId,r,(function(s){"success"==s.status&&(lmsnotes.changeToSaved(),lmsnotes.noteObj=lmsnotes.parseNoteObjFromElement(lmsnotes._note_on_edit_node),delete s.message,delete s.status,lmsnotes.responseObj=s,"create"==t&&(e.setAttribute("ntemode","created_edit"),e.setAttribute("nteid",s.noteId)))})):zplms.post("/lms/notes",r,(function(s){"success"==s.status&&(lmsnotes.changeToSaved(),lmsnotes.noteObj=lmsnotes.parseNoteObjFromElement(lmsnotes._note_on_edit_node),delete s.message,delete s.status,lmsnotes.responseObj=s,"create"==t&&(e.setAttribute("ntemode","created_edit"),e.setAttribute("nteid",s.noteId)))}))}},onNoteInput:function(){clearTimeout(lmsnotes._refer.timeInterval),lmsnotes._refer.timeInterval=setTimeout(lmsnotes.autoSaveNote,1e3)},changeToSaving:function(){_ncnode=lmsnotes._note_on_edit_node;var e=_ncnode.querySelector("[_rel=saved]");if(null!=e){const t=document.createElement("div");t.className="zpl_atoprg",t.setAttribute("_rel","progressBar");for(let e=0;e<5;e++){const e=document.createElement("div");t.appendChild(e)}const s=e.querySelector('[_rel = "tickIcon"]');s.className="";const r=e.querySelector('[_rel = "autoSaveCont"]');r&&(r.className="zpl_atocnt"),s.parentElement.insertBefore(t,s),e.querySelector('[_rel = "saveText"]').innerText="Saving",e.setAttribute("_rel","saving")}else if(null==(e=_ncnode.querySelector("[_rel=saving]"))){const e=document.createElement("div");e.className="zpl_atosv svd",e.setAttribute("_rel","saved");const t=document.createElement("div");t.className="zpl_atocnt",t.setAttribute("_rel","autoSaveCont");const s=document.createElement("i");s.className="PI_tick2",s.setAttribute("_rel","tickIcon");const r=document.createElement("span");r.setAttribute("_rel","saveText"),r.textContent=ZPI18N.getString("zp.saved"),t.appendChild(s),t.appendChild(r),e.appendChild(t),_ncnode.querySelector("[_rel=icons]").insertBefore(e,_ncnode.querySelector("[_rel=icons]").children[0])}},changeToSaved:function(){_ncnode=lmsnotes._note_on_edit_node;var e=_ncnode?_ncnode.querySelector("[_rel=saving]"):null;if(null!=e){const t=e.querySelector('[_rel = "autoSaveCont"]');t&&(t.className="zpl_atocnt svd");e.querySelector('[_rel = "tickIcon"]').className="PI_tick2";const s=e.querySelector('[_rel = "progressBar"]');s&&s.remove(),e.querySelector('[_rel = "saveText"]').innerText=ZPI18N.getString("zp.saved"),e.setAttribute("_rel","saved")}},doesNoteSatisfyFilter:function(e){var t=lmsnotes.lastRequestParams;if(t.title&&-1==e.title.indexOf(t.title))return!1;if(t.favourite&&e.favourite!=t.favourite)return!1;if(t.courseId){var s;for("string"==typeof t.courseId&&(t.courseId=[t.courseId]),s=0;s<t.courseId.length;s++)if(e.courseId==t.courseId[s])return!0;return!1}return!0},getCourse:function(e){if(lmsnotes.courseData.length>0)return e(lmsnotes.courseData);zplms.get("/lms/courses/list",null,(function(t){if("success"==t.status)return e(t.courses)}))},getCoursesForFilter:function(e){zplms.getAsync("/lms/courses/list",null,e,!1)},getCourses:function(e){if("success"==e.status){var t=e.courses;lmsfilemanager.courseNameFilterData=t}},setCourseDataAndValidateCourse:function(e){if(lmsnotes.courseData=e,!lmsnotes.courseDataForHash){var t={};e.forEach((function(e){t[e.courseId]=e.courseName})),lmsnotes.courseDataForHash=t}var s=function(e,t){for(prop in t){if(!e[prop])return!1;t[prop][0]=e[prop]}return!0}(lmsnotes.courseDataForHash,lmsnotes.tempData.fltrObj.items.courseId);lmsnotes.tempData.valid=lmsnotes.tempData.valid&&s,lmsnotes.hashHandling(lmsnotes.tempData),lmsnotes.tempData=null},courselistener:function(e){for(var t={},s=0;s<e.length;s++)t[e[s].courseId]=[e[s].courseName,""];lmsnotes.courseData=e,lmsnotes.menuCallBack(t,lmsnotes.inputvalue)},fetchMenu:function(){lmsnotes.menuCallBack=this.updateOptionList,lmsnotes.inputvalue=this.value,lmsnotes.getCourse(lmsnotes.courselistener)},makeHash:function(e){var t="";for(var s in e)t+=s+"="+e[s]+"&";return t=t.slice(0,t.length-1)},quickAdd:function(){var e=lmsnotes.root.querySelector("zpl_rgtcnt"),t=null;if(lmsnotes.emptyNote&&document.contains(lmsnotes.emptyNote))t=lmsnotes.emptyNote;else{var s=lmsnotes.getRandomInt(1,4),r=lmsnotes._refer,l=null;lmsnotes.htmlConf.quickAddButton&&((l=e.querySelector("[quickaddbutton]")).style.display="",s=parseInt(l.className.match(/[1-4]/gi),10)-1),"nodata"==r.index&&(r.index="end",lmsnodata.clearNoData(e),l&&e.insertBefore(l,e.childNodes[0]));var a={content:"",title:"",color:s,favourite:0,createdTimeInMillis:(new Date).getTime(),courseId:r.courseId||void 0,moduleId:r.moduleId||void 0,entityId:r.entityId||void 0,entityType:r.entityType||void 0};lmsnotes.emptyNote=t=e.insertBefore(lmsnotes.getnotecard(a),e.childNodes[l?1:0]),t.setAttribute("ntemode","view")}var n=t.querySelector("[_rel=text]");n.focus(),lmstinymce.initiate(n),lmsnotes.setListenerObject(t,{elem:n,kind:"content"})},setListenerObject:function(e,t){var s=t.elem;lmsnotes._note_on_edit_node=e,lmsnotes._note_on_edit=!0,lmsnotes.noteObj=lmsnotes.parseNoteObjFromElement(lmsnotes._note_on_edit_node),lmsnotes._refer.quickNotesParams=t,"title"==t.kind?s.setAttribute("contenteditable",!0):lmstinymce.initiate(s),s.focus(),lmsbase.addListener(s,"keypress",lmsnotes.quickNotevalidatelength,!1),lmsbase.addListener(s,"keyup",lmsnotes.quickNotevalidatelength,!1),lmsbase.addListener(s,"input",lmsnotes.oninput,!1),lmsbase.addListener(s,"blur",lmsnotes.onblur,!1)},quickNotevalidatelength:function(e){var t=lmsnotes._refer.quickNotesParams;"title"==t.kind&&t.elem.textContent.trim().length>=256&&e.preventDefault()},oninput:function(e){clearTimeout(lmsnotes._refer.quickNotesParams._intvl),lmsnotes._refer.quickNotesParams._intvl=setTimeout(lmsnotes.checkChanges,500)},onblur:function(){var e=lmsnotes._refer.quickNotesParams;clearTimeout(e._intvl),lmsnotes.checkChanges();var t=e.elem;lmsbase.removeListener(t,"input",lmsnotes.oninput,!1),lmsbase.removeListener(t,"blur",lmsnotes.onblur,!1),"title"==e.kind?t.removeAttribute("contenteditable"):lmstinymce.remove(),lmsnotes._refer.quickNotesParams=lmsnotes.noteObj=lmsnotes._note_on_edit_node=null,lmsnotes._note_on_edit=!1},saveQuickNote:function(){var e=lmsnotes._refer.quickNotesParams,t=lmsnotes._note_on_edit_node,s=lmsnotes.parseNoteObjFromElement(t),r=lmsnotes._refer;if(""!=s.title||""!=s.content){lmsnotes.emptyNote=null;var l=lmsnotes.root.querySelector("[quickaddbutton]");l&&(_color=parseInt(l.className.match(/[1-4]/gi),10)-1,l.className="zp_Note "+lmsnotes.getRandomColor(_color)+" zp_Nnte"),lmsnotes.isRequestDuplicate(s,lmsnotes.noteObj,["title","content","color","favourite"])&&(lmsnotes.noteObj=s,delete s.addAttachmentIds,delete s.removeAttachmentIds,s.courseId=r.courseId||void 0,s.batchId=r.batchId||void 0,s.moduleId=r.moduleId||void 0,s.entityId=r.entityId||void 0,s.entityType=r.entityType||void 0,zplms.post("/lms/notes",s,(function(s){"success"==s.status&&(lmsmodule.elem.querySelector("[id=noteCntCont_"+s.moduleId+"]").style.display="block",lmsmodule.elem.querySelector("[id=noteCount_"+s.moduleId+"]").innerText=s.noteCount,t.parentNode?(t.setAttribute("nteid",s.noteId),lmsnotes._refer.quickNotesParams&&(e.nteid=s.noteId)):lmsnotes.deleteNote(s.noteId)),t=null})))}else lmsnotes.emptyNote=t},checkChanges:function(){var e=lmsnotes._refer.quickNotesParams,t=lmsnotes._note_on_edit_node,s=e.nteid||t.getAttribute("nteid"),r=lmsnotes.noteObj;if("title"==e.kind){var l=e.elem.textContent.trim();l!=r.title&&(s?lmsnotes.changefield({nteid:s,field:"title",value:l},lmsnotes.changeFieldResponseHandlerOfQuickNotes):lmsnotes.saveQuickNote())}else if("content"==e.kind){var a=e.elem.innerHTML;a!=r.content&&(s?lmsnotes.changefield({nteid:s,field:"content",value:a},lmsnotes.changeFieldResponseHandlerOfQuickNotes):lmsnotes.saveQuickNote())}},quickFilterMenu:function(e,t){lmsmenu.initiate({elem:t.querySelector(".zp_Sm"),type:"select",mode:"single",allow_new:!1,menulist:lmsnotes.fetchMenu}).on("click",(function(e){var t;"all"==this.value?((t=lmsnotes._refer).currentCourseId=t.currentCourseName=null,lmsnotes.fetchNotes()):((t=lmsnotes._refer).currentCourseId=this.value,t.currentCourseName=this.content,lmsnotes.fetchNotes({courseId:this.value}))})).on("update",(function(e){this.options.all=[ZPI18N.getString("zp.lms.notes.recentnotes"),""]})).bind()},changeFieldResponseHandlerOfQuickNotes:function(e,t){"success"==e.status&&lmsnotes._refer.quickNotesParams&&(lmsnotes.noteObj[t.field]=t.value,"color"==t.field&&"favourite"==t.field||lmsnotes.changeFieldResponseHandler(e))},getRandomColor:function(e){return"nc"+lmsnotes.getRandomInt(1,4,e)},getRandomInt:function(e,t,s){var r=Math.floor(Math.random()*(t-e+1))+e;return r===s?r==t?--r:++r:r},revertHash:function(){lmsnotes._refer.prevHash?lms.changeHash("hash",lmsnotes._refer.prevHash,"disable"):lms.changeHash("hash",lmsnotes._refer.baseUri+"notes")},invokeUploadManager:function(e,t){t=t||[];var s=lmsnotes._note_on_edit_node.querySelector("[_rel=attach]"),r=lmsnotes._note_on_edit_node;lmsnotes._note_on_edit_node.querySelector("[attachmentList]").innerHTML="";var l={clickElement:s,dropElement:r,moduleName:lms.appname,multiple:lmsnotes.uploadConfig.multiple,MAXSIZE:lmsnotes.uploadConfig.MAXSIZE,MAX_NUMBER_OF_FILES_PER_UPLOAD:lmsnotes.uploadConfig.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED,SUPPORTED_SOURCES:lmsfileaction.SOURCE.LOCAL,callbackObject:{noteId:lmsnotes._note_on_edit_node.getAttribute("nteid"),noteElem:lmsnotes._note_on_edit_node,MAXSIZE:lmsnotes.uploadConfig.MAXSIZE},ACTION_ATTRIBUTE:"action"},a={listElement:lmsnotes._note_on_edit_node.querySelector("[attachmentTab]"),MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED:lmsnotes.uploadConfig.MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED};e.uploadHelperObject=lmsuploadmanager.initUploadManager(a,new lmsfileaction.upload(l)),e.uploadHelperObject.on("dropZoneEnter",lmsnotes.dropZoneEnter),e.uploadHelperObject.on("dropZoneExit",lmsnotes.dropZoneExit),e.uploadHelperObject.on("lazyloadAdditionalInfo",lmsnotes.lazyloadAdditionalInfo),e.uploadHelperObject.attachCallback("getSingleAttachment",AutoSave_ListingUploadManager.getSingleAttachmentHTMLForNotes),e.uploadHelperObject.attachCallback("onUploading",AutoSave_ListingUploadManager.uploadMonitor),e.uploadHelperObject.attachCallback("onAuthorisationFailure",AutoSave_ListingUploadManager.onAuthorisationFailure),e.uploadHelperObject.attachCallback("onFileTransferFailure",AutoSave_ListingUploadManager.onFileTranserFailure),e.uploadHelperObject.attachCallback("onVirusFound",AutoSave_ListingUploadManager.onVirusFound),e.uploadHelperObject.attachCallback("onFileStoredSuccessfully",AutoSave_ListingUploadManager.onFileStored),e.uploadHelperObject.attachCallback("getPreviewObject",lmsattachment.getPreviewObject),e.uploadHelperObject.attachCallback("lightbox_src_callback",lmsattachment.lightbox_src_callback),e.uploadHelperObject.attachCallback("lightbox_click_callback",lmsattachment.lightbox_click_callback),e.uploadHelperObject.attachCallback("onCleanUp",AutoSave_ListingUploadManager.onCleanUp),e.uploadHelperObject.attachCallback("onMaximumUploadLimitReached",AutoSave_ListingUploadManager.onMaximumNumberOfUploadLimitReached),e.uploadHelperObject.attachCallback("ondelete",lmsnotes.ondelete),e.uploadHelperObject.attachCallback("onkill",lmsnotes.ClearReferenceAfterKill),e.uploadHelperObject.addSavedFiles(t),e.uploadHelperObject.bind()},dropZoneEnter:function(e){e.querySelector("[_rel=text]").appendChild(lmsattachment.addDropZoneHTML())},dropZoneExit:function(e){var t=e.querySelector("[_rel=text]");lmsattachment.removeDropZoneHTML(t)},ondelete:function(e){var t=(a=lmsnotes._note_on_edit_node).getAttribute("nteid"),s=a.querySelector("[_rel=title]"),r=lmstinymce.getcontent(),l=s.textContent.trim();if(1==a.uploadHelperObject.getAllFilesForSaving().length&&""==l&&""==r){lmsbase.removeListener(document,"keyup",lmsnotes.onkeydown,!1);let e=new DeleteAlertMessage;return e.title=ZPI18N.getString("zp.lms.attachment.deletelastattachment"),e.despcription=ZPI18N.getString("zp.lms.notes.thiswilldeletenotespermanently"),e.yesButtonText=ZPI18N.getString("zp.confirm"),e.cancelButtonText=ZPI18N.getString("zp.cancel"),e.callback=function(){lmsnotes.deleteRecord(t,lmsnotes.deleteResponseHandler)},e.show(),!1}if(e.getFileInfo()){var a;t=(a=lmsnotes._note_on_edit_node).getAttribute("nteid");let s=new DeleteAlertMessage;return s.title=ZPI18N.getString("zp.lms.entitydelete",[ZPI18N.getString("zp.attachment")]),s.despcription=ZPI18N.getString("zp.lms.permenentlydelEntity",[ZPI18N.getString("zp.attachment")]),s.yesButtonText=ZPI18N.getString("zp.delete"),s.cancelButtonText=ZPI18N.getString("zp.cancel"),s.callback=function(){lmsnotes.deleteAttachment(e,t)},s.show(),!1}},deleteAttachment:function(e,t){zplms.delete("/lms/notes/"+t+"/attachments/"+e.getFileInfo().attachmentId,null,(function(t){"success"==t.status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.attachment.deletesuccess")),e.deleteThis()):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.attachment.deletefailure"))}))},createEmptyNote:function(e){lmsnotes._note_on_edit_node;var t=lmsnotes.getNoteReqObj()._params;zplms.post("/lms/notes/create",t,(function(t){if("success"==t.status){var s=lmsnotes._note_on_edit_node;e({subModule:"notes",noteId:t.noteId}),s.setAttribute("ntemode","created_edit"),s.setAttribute("nteid",t.noteId),delete t.message,delete t.status,lmsnotes.responseObj=t}}))},lazyloadAdditionalInfo:function(e){var t=lmsnotes._note_on_edit_node.getAttribute("ntemode"),s="create"==lmsnotes._note_on_edit_node.getAttribute("ntemode")?lmsnotes.createEmptyNote(e):lmsnotes._note_on_edit_node.getAttribute("nteid");"create"!=t&&e({subModule:"notes",noteId:s}),lmsbase.addListener(window,"beforeunload",lmsnotes.onReload,!1)},ClearReferenceAfterKill:function(e){e.noteElem.uploadHelperObject=null,lmsbase.removeListener(window,"beforeunload",lmsnotes.onReload,!1)},hasAnyPendingUploadsInAllNotes:function(){var e=lmsnotes.root.querySelectorAll("[note]");if(lmsnotes._note_on_edit_node&&lmsnotes._note_on_edit_node.uploadHelperObject.hasAnyPendingUploads())return!0;for(var t=0;t<e.length;t++)if(e[t].uploadHelperObject&&e[t].uploadHelperObject.hasAnyPendingUploads())return!0;return!1},viewfilter:function(e,t,s){lmsbase.addClass(e,"sel");var r=lmsnotes.root.querySelector(".zp_fltrs");lmsfilter.create(t,{target:r,container:"",items:[{name:"courseId",title:ZPI18N.getString("zp.lms.course.coursename"),datalist:lmsnotes.fetchMenu,mode:"multi",type:"select",emptyText:ZPI18N.getString("zp.select"),labelicon:""},{name:"favourite",title:ZPI18N.getString("zp.lms.favourite"),datalist:{1:[ZPI18N.getString("zp.lms.favourite"),""]},mode:"single",type:"select",emptyText:ZPI18N.getString("zp.select"),labelicon:""},{name:"sortBy",title:ZPI18N.getString("zp.lms.notes.sortby"),datalist:{desc:[ZPI18N.getString("zp.lms.notes.recentmodified"),""],asc:[ZPI18N.getString("zp.lms.notes.oldnotes"),""]},mode:"single",type:"select",emptyText:ZPI18N.getString("zp.select"),labelicon:""}],search:!0,selecteditems:s},!0).on("change",(function(){})).on("apply",(function(){_params=this.filterObject,_params.favourite&&(_params.favourite=_params.favourite[0]),_params.sortBy&&(_params.sortBy=_params.sortBy[0]),_params.searchStr&&_params.searchStr.length>0&&(_params.title=_params.searchStr.trim(),delete _params.searchStr);var e=lmsnotes.makeHash(_params);e&&(lmsnotes.filterMode=!0,lmsnotes._refer.prevHash=lmsnotes._refer.baseUri+"notes/filter:"+e,lms.changeHash("hash",lmsnotes._refer.prevHash,"disable"),lmsnotes.fetchNotes(_params))})).on("close",(function(){lmsbase.removeClass(e,"sel")})).on("clear",(function(){lmsnotes.filterMode&&(lmsnotes.filterMode=!1,lms.changeHash("hash","notes","disable"),lmsnotes.fetchNotes(),lmsnotes.root.querySelector(".zp_header .zp_Tglst")&&lmsfilter.filterBar("clear"))})).bind()},onReload:function(e){lmsnotes.root&&(lmsnotes.hasAnyPendingUploadsInAllNotes()||lmsnotes._note_on_edit_node&&lmsnotes.isRequestDuplicate(lmsnotes.parseNoteObjFromElement(lmsnotes._note_on_edit_node),lmsnotes.noteObj,["title","content"],!0,!0))&&(e.returnValue="Are you sure want to leave? Changes you made may not be saved ")},reInitialise:function(){lmsnotes.courseData=[],lmsnotes.courseDataForHash=null,lmsnotes._refer={entityType:0,entityId:void 0,courseId:void 0,moduleId:void 0,courseName:void 0,currentCourseId:void 0,currentCourseName:void 0,sortBy:"desc",index:1,baseUri:"",prevHash:"",quickNoteParams:null},lmsnotes.lastRequestParams={},lmsnotes.integ=!1,lmsnotes.integrationType=void 0,lmsnotes.filterMode=!1,lmsnotes.root=null,lmsnotes.scrollElem=null,lmsnotes._dim=null,lmsnotes._note_on_edit=!1,lmsnotes._note_on_edit_node=null,lmsnotes.emptyNote=null,lmsnotes.menuCallback=null;var e=lmsnotes.htmlConf;e.header=!0,e.filter=!0,e.bodyClass="zp_cwrap",e.type="normal",e.filter=!0,e.quickFilter=!1,e.quickAddButton=!1,e.insertAddNote=!1},close:function(){lmsbase.removeListener(lmsnotes.root,"click",lmsnotes.noteHandle,!1),lmsbase.removeListener(document,"keyup",lmsnotes.onkeydown,!1),lmsbase.closeMaskv5(),lmsnotes.reInitialise(),lmsnotes.filterInstance&&lmsnotes.filterInstance.closeFilter()},showAttachmentPopup:function(e){const t=lmsbase.constructMaskv5("",!0);t.className="zpl_mdl zpl_mcenter zpl_noteatch zpl_mopen",t.setAttribute("_rel","attachmentPopupCont");const s=document.createElement("div");s.className="zpl_minr",s.innerHTML='<div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.attachments")+'</h4></div><a class="_cls PI_cls" title = "'+ZPI18N.getString("zp.close")+'"_rel = "closeAttachmentPopup"></a></div></div>',t.appendChild(s);var r=document.createElement("div");r.className="zpl_mcnt zpl_fm",r.innerHTML='\n\t        <form>\n\t            <div class="zpl_crd">\n\t                <div class="zpl_crdcnt">\n\t                    <div class="zpl_secn">\n\t                        <div>\n\t                            <div class="zpl_atchd atsml" _rel="attachmentsContainer"></div>\n\t                        </div>\n\t                    </div>\n\t                </div>\n\t            </div>\n\t        </form>\n\t    ',s.appendChild(r);const l=e.querySelector("[attachmentList]").childNodes,a=t.querySelector('[_rel = "attachmentsContainer"]');for(let e=0;e<l.length;e++){let t=l[e].fileInfo,s=lmsattachment.getFileIcon(t.fileType),r=document.createElement("div");r.innerHTML=`\n\t\t                <div class="zpl_atchimg">\n\t\t                    <i class="${s}"></i>\n\t\t                </div>\n\t\t                <div class="zpl_atchdtl">\n\t\t                    <h4 title="${t.name}">${t.name}</h4>\n\t\t                    <p><span>${lmsfileaction.getFileSize(t.size)}</span></p>\n\t\t                </div>\n\t\t                <div class="zpl_atchicn">\n\t\t                    <i class="PI_downld" title="${ZPI18N.getString("zp.Download")}" _rel = "downloadAttachmentIcon" id="${t.contentId}"></i>\n\t\t                </div>\n\t\t        `,a.appendChild(r)}const n=t.querySelector('[_rel = "closeAttachmentPopup"]');lmsbase.addListener(n,"click",lmsbase.closeMaskv5,!1),lmsbase.addListener(t,"click",lmsnotes.noteHandle,!1)}},lmsattachment={STATUS_CODE:lmsfileaction.getStatusCodes(),ERRORS:lmsfileaction.getErrors(),infoTabTitle:ZPI18N.getString("zp.lms.info"),init_LIGHTBOX:function(e,t,s){if(e.fileInfo){for(var r=e.parentNode.childNodes,l=e.fileInfo.contentId,a=e.fileInfo.fileId,n=e.fileInfo.resourceId,i=0,o=[],c=0;i<r.length;i++)r[i].previewObject||(r[i].previewObject=lmsattachment.getPreviewObject(r[i].fileInfo,s)),o[i]=r[i].previewObject,(r[i].fileInfo.contentId==l&&r[i].fileInfo.fileId&&r[i].fileInfo.fileId==a||r[i].fileInfo.resourceId&&r[i].fileInfo.resourceId==n)&&(c=i);var d={allow:["download","info","fullmode"],autoplay:!0,useDashPlayer:!1};for(var m in t)d[m]=t[m];return d.startIndex=c,d.items=o,zplightbox.initiate(d).on("click",(function(e){lmsattachment.lightbox_click_callback.call(this,e,s)})).on("src_not_given",this.lightbox_src_callback).bind()}},getPreviewObject:function(e,t){e.extension=e.extension||lmsfileaction.getFileExtension(e.name);var s=e.fileType=e.fileType||lmsfileaction.getFileType(e.type,e.extension);return{name:e.name,type:s,src:e.previewURL||lmsfileaction.generateSourceURL(e,!1,t),kind:void 0===e.isDownloadable||e.isDownloadable?"DL":"NDL",callbackObj:e}},lightbox_click_callback:function(e,t){"info"==this.type?(zplightbox._layer._root.className="zpl_Lbx",zplightbox._layer._root.appendChild(lmsattachment.getInfoTabHTML(e),{encoded:this.encoded})):"download"==this.type&&lmsattachment.downloadFile(e,t)},getInfoTabHTML:function(e,t){const s=document.querySelector('[_rel = "infoCardPopup"]');s&&s.remove();var r=document.createElement("div");r.className="zpl_Lbx_drpmnu",r.setAttribute("_rel","infoCardPopup");var l=document.createElement("div");l.className="zpl_Lbxsld_hd",l.appendChild(document.createElement("div")).innerHTML="<h4>"+ZPI18N.getString("zp.lms.info")+"</h4>";var a=l.appendChild(document.createElement("div"));a.innerHTML='<a class = "_cls PI_cls"></a>',a.setAttribute("_rel","hideinfo");var n=document.createElement("div");n.className="zpl_Lbxsld_cnt";var i,o,c=n.appendChild(document.createElement("ul"));if(c.className="zpl_infodtl",(i=c.appendChild(document.createElement("li"))).appendChild(document.createElement("span")).textContent=ZPI18N.getString("zp.lms.coursename"),o=i.appendChild(document.createElement("em")),!t||t.encoded?o.innerHTML=e.name:o.textContent=e.name,(i=c.appendChild(document.createElement("li"))).appendChild(document.createElement("span")).textContent=ZPI18N.getString("zp.type"),(o=i.appendChild(document.createElement("em"))).textContent=1==e.sourceType?ZPI18N.getString("zp.lms.content.Content"):lmsattachment.getFileTypeString(e.fileType),e.ownerInfo){(i=c.appendChild(document.createElement("li"))).appendChild(document.createElement("span")).textContent=ZPI18N.getString("zp.lms.files.uploadedBy"),o=i.appendChild(document.createElement("em"));var d=erecno==e.ownerInfo.userId?ZPI18N.getString("zp.lms.messages.you"):e.ownerInfo.name||zplms.getUserDisplayName(e.ownerInfo.userId);!t||t.encoded?o.innerHTML=d:o.textContent=d,e.uploadedTime&&((o=o.appendChild(document.createElement("p"))).textContent=ZPI18N.getString("zp.lms.on")+" "+ZPDateTime.getDateDisplayFormat(e.uploadedTime))}if((i=c.appendChild(document.createElement("li"))).appendChild(document.createElement("span")).textContent=ZPI18N.getString("zp.lms.size"),(o=i.appendChild(document.createElement("em"))).textContent=lmsfileaction.getFileSize(e.size),e.hasOwnProperty("associatedCourses")){var m=document.createElement("hr");m.className="secnbtmline";const t=lmsfilemanager.getAssociatedCoursesHTML(e.associatedCourses);n.appendChild(m),n.appendChild(t)}return r.appendChild(l),r.appendChild(n),r},getFileTypeString:function(e){return"image"==e?ZPI18N.getString("zp.lms.image"):"video"==e?ZPI18N.getString("zp.lms.video"):"audio"==e?ZPI18N.getString("zp.lms.audio"):"document"==e?ZPI18N.getString("zp.lms.document"):"sheet"==e?ZPI18N.getString("zp.lms.sheet"):"presentation"==e?ZPI18N.getString("zp.lms.presentation"):"text/plain"==e?ZPI18N.getString("zp.lms.text/plain"):"text/table"==e?ZPI18N.getString("zp.lms.text/table"):"text/executable"==e?ZPI18N.getString("zp.lms.text/executable"):"pdf"==e?ZPI18N.getString("zp.lms.pdf"):"zip"==e?ZPI18N.getString("zp.lms.zip"):ZPI18N.getString("zp.lms.others")},lightbox_src_callback:function(e,t){var s=e.callbackObj,r="poster"==e.type?"thumbnail":s.fileType,l={contentId:s.contentId,fileType:r,previewId:e.previewId};("image"==l.type?l.width=l.height=600:"thumbnail"==l.type&&(l.width=l.height=150),"image"!=r&&"sheet"!=r)?t(lmsfileaction.generateSourceURL(l,s.additionalInfo),previewObj.previewId):lmsfileaction.setPreviewData(l,t)},downloadFile:function(e,t){if(e.isDownloadable)if(e.downloadURL)lmsfileaction._saveToLocal(e.downloadURL);else{var s=e.additionalInfo=e.additionalInfo||{fileId:e.contentId,type:0};lmsfileaction.saveToLocal(s.fileId,s.type,t)}},addDropZoneHTML:function(){var e=document.createElement("div");return e.className="zp_Add",e.contentEditable=!1,e.setAttribute("ondropzone",""),e.innerHTML="<div>"+ZPI18N.getString("zp.lms.dropyourfile")+"</div>",e},removeDropZoneHTML:function(e){var t=e.querySelector("[ondropzone]");t&&t.parentNode.removeChild(t)},getThumbnailIcon:function(e){var t=e.fileType=e.fileType||lmsfileaction.getFileType(e.type,e.extension);if("image"==t){var s=document.createElement("img");return s.src=lmsfileaction.generateSourceURL(e,!0),s.onerror=lmsattachment.onerror_thumbnail,s}return lmsattachment.getDisplayIcon(t,1==e.sourceType?"ContentFile":"")},onerror_thumbnail:function(){this.parentNode.replaceChild(lmsattachment.getDisplayIcon("image"),this)},getDisplayIcon:function(e,t){var s=document.createElement("i");return"image"==e?s.className="PI_ft_img":"video"==e?s.className="PI_ft_vdo":"audio"==e?s.className="PI_ft_mp3":"sheet"==e?s.className="PI_ft_xls":"document"==e?s.className="PI_ft_doc":"pdf"==e?s.className="PI_ft_pdf":"presentation"==e?s.className="PI_ft_ppt":e.startsWith("text")?s.className="ContentFile"==t?"PI_ft_txt":e.indexOf("executable")>-1?"PI_ft_code":e.indexOf("table")>-1?"PI_ft_xls":"PI_ft_txt":s.className="zip"==e?"PI_ft_zip":"PI_ft_unknwn",s},getFileIcon:function(e,t){return"image"==e?"PI_ft_img":"video"==e?"PI_ft_vdo":"audio"==e?"PI_ft_mp3":"sheet"==e?"PI_ft_xls":"document"==e?"PI_ft_doc":"pdf"==e?"PI_ft_pdf":"presentation"==e?"PI_ft_ppt":e.startsWith("text")?"ContentFile"==t?"PI_ft_txt":e.indexOf("executable")>-1?"PI_ft_code":e.indexOf("table")>-1?"PI_ft_xls":"PI_ft_txt":"zip"==e?"PI_ft_zip":"PI_ft_unknwn"},setThumbnail:function(e,t){var s=lmsfileaction.getThumbnail(thumbnailId,contentType);if(!s.hasAttribute("icon")){var r=attachment.querySelector("[icon]");attachment.replaceChild(s,r)}}},ListingUploadManager={getAttachmentHTML:function(e){var t=document.createElement("div");t.className="zpa_drop MXW500";var s='<label><i class="zei-attachment"></i></label><div><span>'+ZPI18N.getString("zp.lms.uploadfrom")+'<a _rel="local"><b> '+ZPI18N.getString("zp.files.desktop")+"</b></a>";return ZPeople.isChinaSetup?s+="</span>":s+=' or <a _rel="cloud"><b>'+ZPI18N.getString("zp.others")+"</b></a></span>",s+="<em> "+ZPI18N.getString("zp.lms.attachment.MaxfileSize")+lmsfileaction.getFileSize(e)+"</em></div>",t.innerHTML=s,t},getAttachmentListHTML:function(e,t){t=t||{};var s=document.createElement("div");if(s.className="attch_view",s.setAttribute("attachmentTab",""),t.no_title||(s.innerHTML="<h3>"+ZPI18N.getString("zp.attachment")+"</h3>"),s.style.display="none",t.onlyCount){if(e.length){s.style.display="";var r=s.appendChild(document.createElement("div"));r.className="zp_attachicn",r.innerHTML='<i class="IC-atch"></i><span>'+e.length+"</span>"}}else{var l=s.appendChild(document.createElement("div"));l.setAttribute("attachmentList",""),t.minimal&&(l.className="atch_vc"),e&&ListingUploadManager.constructAttachments(e,l)}return s},getAttachmentListHTMLForNotes:function(e,t){t=t||{};var s=document.createElement("div");if(s.setAttribute("attachmentTab",""),s.style.display="none",t.onlyCount){if(e.length){s.style.display="";var r=s.appendChild(document.createElement("div"));r.className="zp_attachicn",r.innerHTML='<i class="IC-atch"></i><span>'+e.length+"</span>"}}else{var l=s.appendChild(document.createElement("div"));if(l.setAttribute("attachmentList",""),l.className="zpl_atchd atsml",e){l.style.display="";for(var a=document.createDocumentFragment(),n=0;n<e.length;n++){const t=ListingUploadManager.getSingleAttachmentHTMLForNotes(e[n],lmsuploadmanager.ATTACHMENT_TYPE.SAVED);a.appendChild(t)}l.appendChild(a)}}return s},getSingleAttachmentHTMLForNotes:function(e,t,s,r){var l=lmsuploadmanager.ATTACHMENT_TYPE;const a=document.createElement("div");l.NEW==t&&lmsbase.addClass(a,"zpa_upld"),e.extension=e.extension||lmsfileaction.getFileExtension(e.name),e.fileType=lmsfileaction.getFileType(e.type,e.extension),l.SAVED==t?(a.fileInfo=e,e.name=e.name):l.ERROR==t&&(a.style.borderColor="red",a.setAttribute(lmstooltip._attrib,e.errors[lmsattachment.ERRORS.UNSUPPORTED_FILE_TYPE]?ZPI18N.getString("zp.lms.attachment.UnsupportedFile"):ZPI18N.getString("zp.lms.attachment.Maximumlimit",[lmsfileaction.getFileSize(s.MAXSIZE)])));const n=document.createElement("div");n.classList.add("zpl_atchimg"),n.setAttribute("icon_container",""),n.innerHTML=lmsattachment.getDisplayIcon(e.fileType,r&&1==r.sourceType?"ContentFile":"").outerHTML,a.appendChild(n);const i=document.createElement("div");i.classList.add("zpl_atchdtl");const o=document.createElement("h4");l.NEW==t||r&&r.not_encoded?(o.textContent=e.name,o.setAttribute("title",e.name)):(o.innerHTML=e.name,o.setAttribute("title",ZPeople.decodeTxt(e.name)));const c=document.createElement("ul");if(c.setAttribute("fileSizeAndUploadStatus",""),e.size>0){const t=document.createElement("p");t.innerHTML="<span>"+lmsfileaction.getFileSize(e.size)+"</span>",c.appendChild(t)}if(i.appendChild(o),i.appendChild(c),a.appendChild(i),!r||r.deleteButton){const e=document.createElement("div");e.classList.add("zpl_atchicn"),e.innerHTML='<i class="PI_delete" title="'+ZPI18N.getString("zp.lms.delete")+'" rel="delete"></i>',a.appendChild(e)}if(l.NEW==t){const e=document.createElement("div");e.classList.add("zpl_prgbr"),e.setAttribute("progressbar","");const t=document.createElement("div");t.setAttribute(lmstooltip._attrib,"Not started yet"),t.setAttribute("timeBar","");const s=document.createElement("div");s.setAttribute("percentBar",""),s.classList.add("zp_detprogbar"),t.appendChild(s),e.appendChild(t),a.appendChild(e)}r&&r.thumbnail&&l.SAVED==t&&a.querySelector("[icon_container]").appendChild(ListingUploadManager.getThumbnailHTML(e));return a},constructAttachments:function(e,t){if(e.length){t.parentNode.style.display="";for(var s=document.createDocumentFragment(),r=0;r<e.length;r++)s.appendChild(ListingUploadManager.getSingleAttachmentHTML(e[r],lmsuploadmanager.ATTACHMENT_TYPE.SAVED));t.appendChild(s)}},getThumbnailHTML:function(e){var t=document.createElement("img");return t.src=e.thumbnailURL,lmsbase.addListener(t,"error",(function(){this.parentNode.removeChild(this)})),t},getSingleAttachmentHTML:function(e,t,s,r){var l=lmsuploadmanager.ATTACHMENT_TYPE,a=document.createElement("div");a.className="zpa_drop MXW400",a.setAttribute("attachment",""),l.NEW==t&&lmsbase.addClass(a,"zpa_upld"),e.extension=e.extension||lmsfileaction.getFileExtension(e.name),e.fileType=lmsfileaction.getFileType(e.type,e.extension),l.SAVED==t?(a.fileInfo=e,e.name=e.name):l.ERROR==t&&(a.style.borderColor="red",a.setAttribute(lmstooltip._attrib,e.errors[lmsattachment.ERRORS.UNSUPPORTED_FILE_TYPE]?ZPI18N.getString("zp.lms.attachment.UnsupportedFile"):ZPI18N.getString("zp.lms.attachment.Maximumlimit",[lmsfileaction.getFileSize(s.MAXSIZE)])));var n=document.createElement("b");l.NEW==t||r&&r.not_encoded?n.textContent=e.name:n.innerHTML=e.name;var i="<label icon_container>"+lmsattachment.getDisplayIcon(e.fileType,r&&1==r.sourceType?"ContentFile":"").outerHTML+"</label>";(r&&!r.deleteButton||(i+='<i class="IC-cls" data-ttip="'+ZPI18N.getString("zp.lms.delete")+'" rel="delete"></i>'),i+="<div><h6>"+n.outerHTML+'<span class="gry" percentage></span></h6>',l.NEW==t&&(i+='<div progressBar class="zpPbar"><div timeBar '+lmstooltip._attrib+'="Not started yet" '+lmstooltip._name+'="timeBar"><div percentBar '+lmstooltip._name+'="percentBar" class="zp_detprogbar"></div></div></div>'),i+="<ul fileSizeAndUploadStatus>",e.size>0&&(i+="<li>"+lmsfileaction.getFileSize(e.size)+"</li>"),i+="</ul>",i+="</div>",a.innerHTML=i,r&&r.thumbnail&&l.SAVED==t)&&a.querySelector("[icon_container]").appendChild(ListingUploadManager.getThumbnailHTML(e));return a},onMaximumNumberOfUploadLimitReached:function(e,t){ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.messages.maxNoFies"))},onAuthorisationFailure:function(e,t,s,r){var l=s.error;t.querySelector("[fileSizeAndUploadStatus]").innerHTML='<li class="zpa_err-txt">'+l.errorMessage+"</li>",lmsbase.removeClass(t,"zpa_upld"),lmsbase.addClass(t,"zpa_err");var a=t.querySelector("[progressbar]");a.parentElement.removeChild(a)},uploadMonitor:function(e,t,s,r){var l=e.querySelector("[progressBar]");if(t.typeOfUpload&&"cloud"==t.typeOfUpload)lmsbase.addClass(e,"a_ldr");else if(l){var a=l.querySelector("[percentBar]");a&&(a.style.width=t.percentUploaded,lmstooltip.updateBubble({target:a}));var n=l.querySelector("[timeBar]");n&&(n.setAttribute(lmstooltip._attrib,t.remainingTime),lmstooltip.updateBubble({target:n}))}},onFileTranserFailure:function(e,t,s,r){t.querySelector("[fileSizeAndUploadStatus]").innerHTML='<li class="zpa_err-txt">'+s.message+"</li>",lmsbase.removeClass(t,"zpa_upld"),lmsbase.addClass(t,"zpa_err");var l=t.querySelector("[progressbar]");l.parentElement.removeChild(l)},onVirusFound:function(e,t,s,r){t.querySelector("[fileSizeAndUploadStatus]").innerHTML='<li class="zpa_err-txt">'+ZPI18N.getString("zp.lms.messages.virusfound")+"</li>",lmsbase.removeClass(t,"zpa_upld"),lmsbase.addClass(t,"zpa_err");var l=t.querySelector("[progressbar]");l.parentElement.removeChild(l)},onFileStored:function(e,t,s,r,l){s.fileInfo.fileType=lmsfileaction.getFileType(s.fileInfo.type,s.fileInfo.extension),s.fileInfo.ownerInfo={userId:erecno,name:ZPeople.getUserDetailsById(erecno).name,photoPath:ZPeople.getUserDetailsById(erecno).thumb},t.fileInfo=s.fileInfo;var a=t.querySelector("[progressBar]");if(lmsbase.removeClass(t,"zpa_upld"),s.typeOfUpload&&"cloud"==s.typeOfUpload){var n=document.createElement("li");n.textContent=lmsfileaction.getFileSize(s.fileInfo.size),a.parentNode.querySelector("[fileSizeAndUploadStatus]").innerHTML=n.outerHTML,a.parentNode.removeChild(a)}else a.parentNode.removeChild(a);l&&l.thumbnail&&t.querySelector("[icon_container]").appendChild(ListingUploadManager.getThumbnailHTML(s.fileInfo))},onCleanUp:function(e){e.removeAttribute(lmstooltip._attrib)}},InlineListingUploadManager={onFileStored:function(e,t,s,r){var l;s.fileInfo.fileType=lmsfileaction.getFileType(s.fileInfo.type,s.fileInfo.extension),s.fileInfo.ownerInfo={userId:erecno,name:ZPeople.getUserDetailsById(erecno).name,photoPath:ZPeople.getUserDetailsById(erecno).thumb},"image"==s.fileInfo.fileType?(l=document.createElement("img")).src=lmsfileaction.generateSourceURL(s.fileInfo,void 0,void 0,!0):"video"==s.fileInfo.fileType&&((l=document.createElement("video")).setAttribute("controls","true"),l.src=lmsfileaction.generateSourceURL(s.fileInfo,void 0,void 0,!0)),s.fileInfo.embedTag=l,lmseditor.embedInEditor(s.fileInfo)},onMaximumNumberOfUploadLimitReached:function(e,t){lmseditor.onFileUploadFailure(),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.messages.maxNoFies"))},onAuthorisationFailure:function(e,t,s,r){lmseditor.onFileUploadFailure(),ZPeople.Message.showFailureMsg(errorObject.errorMessage)},onFileTranserFailure:function(e,t,s,r){lmseditor.onFileUploadFailure(),ZPeople.Message.showFailureMsg(s.message)},onVirusFound:function(e,t,s,r){lmseditor.onFileUploadFailure(),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.messages.virusfound"))},onbeforeupload:function(e,t){e.hasErrors&&(failureMsg=e.errors[lmsattachment.ERRORS.UNSUPPORTED_FILE_TYPE]?ZPI18N.getString("zp.lms.attachment.UnsupportedFile"):ZPI18N.getString("zp.lms.attachment.Maximumlimit",[lmsfileaction.getFileSize(t.MAXSIZE)]),ZPeople.Message.showFailureMsg(failureMsg))}},SingleImageUploadManager={getSingleAttachmentHTML:function(e){e.previewURL=e.previewURL||lmsfileaction.generateSourceURL(e,void 0,void 0,!0);var t=document.createElement("div");return t.className="ZP_photo",t.innerHTML='<img src="'+e.previewURL+'"><p>'+ZPI18N.getString("zp.lms.changePhoto")+"</p>",t},onBeforeUpload:function(e,t,s,r){var l;s==lmsuploadmanager.ATTACHMENT_TYPE.NEW?(e.querySelector("[attachmentList]").appendChild(lmsdashboard.addLoading()),l="Image is uploading, it takes a while",5==r.version?ModuleComp.Msg.showSuccessMsg(l):ZPeople.Message.showSuccessMsg(l)):(l=t.errors[lmsattachment.ERRORS.UNSUPPORTED_FILE_TYPE]?ZPI18N.getString("zp.lms.unsupportedFiles"):ZPI18N.getString("zp.lms.fileexeededmax")+lmsfileaction.getFileSize(r.MAXSIZE),5==r.version?ModuleComp.Msg.showWarningMsg(l):ZPeople.Message.showWarningMsg(l))},onAfterUpload:function(e,t,s,r){var l=lmsattachment.STATUS_CODE;if(s.code==l.FILESTOREDSUCCESSFULLY)(a=e.querySelector("[loadbar]")).parentNode.removeChild(a),5==r.version?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.lms.imageuploadedsuccesfully")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.imageuploadedsuccesfully"));else if(s.code==l.AUTHORISATIONFAILURE){(a=e.querySelector("[loadbar]")).parentNode.removeChild(a),5==r.version?ModuleComp.Msg.showFailureMsg(s.error.message):ZPeople.Message.showFailureMsg(s.error.message)}else if(s.code==l.INVALIDMODULENAME||s.code==l.FILETRANSFERFAILURE||s.code==l.VIRUSFOUND){var a;(a=e.querySelector("[loadbar]")).parentNode.removeChild(a),5==r.version?ModuleComp.Msg.showFailureMsg(s.message):ZPeople.Message.showFailureMsg(s.message)}},onMaximumNumberOfUploadLimitReached:function(e,t){5==t.version?ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.lms.imagealreadyuploaded")):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.lms.imagealreadyuploaded"))}},AutoSave_ListingUploadManager=Object.create(ListingUploadManager);function getSingleAttachmentHTML(e,t,s,r){return lmsuploadmanager.ATTACHMENT_TYPE.NEW==t&&(r={deleteButton:!1}),Object.getPrototypeOf(AutoSave_ListingUploadManager).getSingleAttachmentHTMLForNotes(e,t,s,r)}function onFileStored(e,t,s,r){EnableClose(t),Object.getPrototypeOf(AutoSave_ListingUploadManager).onFileStored(e,t,s,r)}function onAuthorisationFailure(e,t,s,r){EnableClose(t),Object.getPrototypeOf(AutoSave_ListingUploadManager).onAuthorisationFailure(e,t,s,r)}function onFileTranserFailure(e,t,s,r){EnableClose(t),Object.getPrototypeOf(AutoSave_ListingUploadManager).onFileTranserFailure(e,t,s,r)}function onVirusFound(e,t,s,r){EnableClose(t),Object.getPrototypeOf(AutoSave_ListingUploadManager).onVirusFound(e,t,s,r)}function EnableClose(e){var t=document.createElement("i");lmsbase.addClass(t,"IC-cls"),t.setAttribute("data-ttip","Delete"),t.setAttribute("rel","delete"),e.insertBefore(t,e.querySelector("[rel= fileNameAndSize]"))}AutoSave_ListingUploadManager.getSingleAttachmentHTML=getSingleAttachmentHTML,AutoSave_ListingUploadManager.onFileStored=onFileStored,AutoSave_ListingUploadManager.onAuthorisationFailure=onAuthorisationFailure,AutoSave_ListingUploadManager.onFileTranserFailure=onFileTranserFailure,AutoSave_ListingUploadManager.onVirusFound=onVirusFound;var lmsfilemanager={root:null,scrollElem:null,htmlConf:{header:!0,filter:!0,attachScroll:!0,scrollQueryString:".zpl_rgtcnt",headerClass:"zpl_btnmnu",headerId:"headerContent",bodyClass:"zpl_rgtcnt",filterClass:"zpl_fltr",filterId:"lmsFilter",headerHTML:'<div class="zpl_rgt"><i class="zpl_ibg PI_lens" id="searchFile" title="'+ZPI18N.getString("zp.search")+'"></i><i class = "zpl_ibg PI_fltr" rel="Filter" title="'+ZPI18N.getString("zp.filter")+'"></i></div>',bodyHTML:'<div id="filesList" class= "zpl_cntlibgrid"></div><div id="resourcesList" class="zpl_cntlibgrid"></div></div>',filterHTML:'<div class="zp_Lttl"></div>'},refer:{currentTab:null,courseId:null,sortBy:"desc",index:1,baseUri:"",prevHash:""},filterInstance:null,initObj:null,filterMode:!1,defaultValues:{tab:"files"},IdMappingToParam:{sortByFilter:"sortby",typeFilter:"type"},filterParams:{},courseNameFilterData:{},appliedFilter:{},filterMode:!1,lastRequestParams:{},integ:!1,noDataObj:{files:{title:ZPI18N.getString("zp.lms.cm.nofiles"),desc:ZPI18N.getString("zp.lms.cm.nofilesdesc")},resources:{title:ZPI18N.getString("zp.lms.cm.noresources"),desc:ZPI18N.getString("zp.lms.cm.noresourcesdesc")}},initiate:function(){lmsfilemanager.initObj=this,lmsfilemanager.hashMode(this),ZPeople.FireScroll.reset(),lmsfilemanager.setFilterInstance()},hashMode:function(e){"add"==e.mode&&(lmsfilemanager.reInitialise(e),"integ"==e.type&&lmsfilemanager.integrationMode(),lmsfilemanager.layoutConstruction());var t=lmsfilemanager.isHashValidAndWithFilter(e.hashObject,{search:{search:!0},courseIds:{type:"array",datatype:"number",name:"course",integ:lmsfilemanager.integ},type:{type:"string",validValues:{images:!0,videos:!0,audios:!0,sheets:!0,presentations:!0,documents:!0,pdf:!0},name:{images:ZPI18N.getString("zp.lms.image"),videos:ZPI18N.getString("zp.lms.video"),audio:ZPI18N.getString("zp.lms.audio"),documents:ZPI18N.getString("zp.lms.document"),sheets:ZPI18N.getString("zp.lms.sheet"),presentation:ZPI18N.getString("zp.lms.presentation"),pdf:ZPI18N.getString("zp.lms.pdf")}},sortby:{type:"string",validValues:{asc:!0,desc:!0},name:{asc:ZPI18N.getString("zp.lms.oldfiles"),desc:ZPI18N.getString("zp.lms.Recentlyuploaded")}}});lmsfilemanager.validityObjHandle(t)},isHashValidAndWithFilter:function(e,t){var s=""==e.level1||"files"==e.level1||"resources"==e.level1,r="object"==typeof e.level2&&"object"==typeof e.level2.filter,l={valid:s,tab:e.level1||lmsfilemanager.defaultValues.tab,filterMode:r,paramsObject:r&&e.level2.filter};if(s&&r){var a=lmsnotes.validateAndParseFilterObj(l.paramsObject,t);l.valid=l.valid&&Boolean(a),l.filterObject=a}return l},validityObjHandle:function(e){e.valid&&e.filterMode&&e.fltrObj&&e.fltrObj.items.courseId?(lmsfilemanager.tempData=e,lmsnotes.getCourse(lmsfilemanager.setCourseDataAndValidateCourse)):lmsfilemanager.hashHandling(e)},hashHandling:function(e){if(e.valid){lmsfilemanager.switchTab(document.querySelector("[rel="+e.tab+"]")),lmsfilemanager.filterInstance&&lmsfilemanager.filterInstance.clearBreadCrumbs(),lmsfilemanager.filterMode=e.filterMode,e.filterMode&&(lmsfilemanager.integ||lmsfilemanager.viewFilter("addbar",e.filterObject)),lmsfilemanager.makeAndUpdateHash(e.paramsObject),lmsfilemanager.fetchFiles(e.paramsObject);const t=document.querySelector('[_rel = "lightBoxCont"]');t&&t.remove()}else lmsfilemanager.revertHash()},revertHash:function(){lmsfilemanager.refer.prevHash?lms.changeHash("hash",lmsfilemanager.refer.prevHash,"disable"):lms.changeHash("hash",lmsfilemanager.refer.baseUri+"contentmanager")},integrationMode:function(e){lmsfilemanager.integ=!0,lmsfilemanager.refer.baseUri=e.baseUri,lmsfilemanager.refer.courseId=e.courseId,lmsfilemanager.refer.courseName=e.courseName,lmsfilemanager.htmlConf.header=e.htmlConf.header,lmsfilemanager.htmlConf.filter=e.htmlConf.filter,lmsfilemanager.htmlConf.bodyClass=e.htmlConf.bodyClass},layoutConstruction:function(e){lmsfilemanager.root.innerHTML="";var t=lmsfilemanager.htmlConf;if(t.header){const e=lmsfilemanager.root.appendChild(document.createElement("div"));e.className=t.headerClass,e.innerHTML=t.headerHTML,e.id=t.headerId;let s=lmsdocument.createElement("div",{class:"search-cmn",id:"fileSearchBox"});s.innerHTML=`<i class="PI_lens"></i>\n                            \t   \t       <input required="" type="text" class="ztextbox" placeholder="${ZPI18N.getString("zp.search")}" id="searchFileNameBy" onkeyup="lmsfilemanager.searchFile(this,event)">\n                            \t   \t       <i class="PI_cls" id="closeSearch" title="${ZPI18N.getString("zp.lms.close")}"></i>`,e.appendChild(s);let r=function(e){27==e.keyCode&&(lmsfilemanager.closeSearch(),lmsbase.removeListener(document,"keyup",r))};$("#searchFile").click((function(){$("#searchFileNameBy").val(""),$("#fileSearchBox").addClass("opn"),$("#searchFileNameBy").focus(),lmsbase.addListener(document,"keyup",r)})),$("#closeSearch").click((function(){lmsfilemanager.closeSearch(),lmsbase.removeListener(document,"keyup",r)}))}var s=lmsfilemanager.root.appendChild(document.createElement("div"));if(s.className=t.bodyClass,s.innerHTML=t.bodyHTML,s.setAttribute("_rel","flist"),t.filter){var r=lmsfilemanager.root.appendChild(document.createElement("div"));r.id=t.filterId,r.className=t.filterClass,r.innerHTML=t.filterHTML}lmsbase.addListener(lmsfilemanager.root,"click",lmsfilemanager.clickHandle,!1),lmsbase.addListener(lmsfilemanager.root,"contextmenu",lmsfilemanager.moreMenu,!1)},switchTab:function(e){var t=lmsfilemanager.refer,s=e.getAttribute("rel");if(t.currentTab!=s){t.currentTab=s,$("#contentApplFil").remove(),lmsfilemanager.closeSearch();var r=lmsfilemanager.root.querySelector("#"+t.currentTab+"List");lmsnewsettings.switchTab(e),lmsfeedback.switchContainer(r),lmsfilemanager.root.querySelector("zpl_cstmProfNav")&&lmsfilter.filterBar("clear")}},selectTab:function(e){if(!lmsbase.hasClass(e,"sel")){var t=e.parentNode.querySelectorAll(".sel");return t.length&&Array.prototype.forEach.call(t,(function(e){lmsbase.removeClass(e,"sel")})),lmsbase.addClass(e,"sel"),!0}return!1},closeSearch:function(){$("#fileSearchBox").removeClass("opn"),lmsfilemanager.fetchFiles()},searchFile:function(e){var t=$(e).val();if(13===event.keyCode){let e={};e.search=t,e.startIndex=1,e.sortBy=!1,lmsfilemanager.fetchFiles(e),lmsfilemanager.filterInstance.clearBreadCrumbs()}},fetchFiles:function(e,t){var s=e||{},r=lmsfilemanager.refer;if(s.method="files"==r.currentTab?"getAllFilesList":"getAllResourcesList",s.sortby=s.sortby?s.sortby:r.sortby,s.sortby="asc"==s.sortby,r.courseId&&(s.courseIds=r.courseId),!t){if(!lmsnotes.isRequestDuplicate(s,lmsfilemanager.lastRequestParams,["method","search","sortby","type","courseIds"]))return;r.index=1}for(var l in s)s[l]instanceof Array?s[l]=s[l].toString():"string"==typeof s[l]&&(s[l]=s[l].trim());if(s.startIndex=r.index,s.conreqcsr=csrfToken,1==s.startIndex){const e=lmsfilemanager.root.querySelector("[_rel=flist]"),t=lmsfilemanager.root.querySelector("#"+lmsfilemanager.refer.currentTab+"List");t&&(t.innerHTML=""),e.appendChild(lmsmessages.addLoading())}$.post("/contentAction.zp",s,(function(e){lmsfilemanager.fetchFilesResponseHandler(e,s)}))},fetchFilesResponseHandler:function(e,t){lmsfilemanager.listFiles(e[1].filesArray||e[1].resourcesArray||[],1==lmsfilemanager.refer.index?"new":"update")},listFiles:function(e,t){var s=lmsfilemanager.root.querySelector("#"+lmsfilemanager.refer.currentTab+"List");$(s).addClass("zpl_cntlibgrid");const r=lmsfilemanager.root.querySelector('[_rel = "loadbar"]');if(r&&r.remove(),"new"==t)if(e.length>0)lmsbase.show(lmsfilemanager.root.querySelector('[rel="fltr"]')),lmsnodata.clearNoData(s);else{lmsfilemanager.filterMode&&lmsbase.show(lmsfilemanager.root.querySelector('[rel="fltr"]')),nodataTab=lmsfilemanager.refer.currentTab,$(s).removeClass("zpl_cntlibgrid");var l=lmsfilemanager.filterMode?lmsnodata.noDatav5.contentmgmtNew[nodataTab+"New"].filter.title:lmsnodata.noDatav5.contentmgmtNew[nodataTab+"New"].general.title,a=lmsfilemanager.filterMode?lmsnodata.noDatav5.contentmgmtNew[nodataTab+"New"].filter.desc:lmsnodata.noDatav5.contentmgmtNew[nodataTab+"New"].general.desc;lmsnodata.showNoDataV5("zp_nd_file",l,a,$(s))}for(var n=document.createDocumentFragment(),i=0;i<e.length;i++)n.appendChild(lmsfilemanager.getFileCard(e[i]));if(s.appendChild(n),lmsfilemanager.refer.index=25==e.length?lmsfilemanager.refer.index+25:"end","end"==lmsfilemanager.refer.index)ZPeople.FireScroll.setParam("triggered",!0);else{ZPeople.FireScroll.setParam("triggered",!1),ZPeople.FireScroll.init(lmsfilemanager.loadMore,"lms",null,!0);const e=$(lmsfilemanager.root);e.height()&&e.prop("scrollHeight")<=e.height()&&lmsfilemanager.fetchFiles(lmsfilemanager.lastRequestParams,!0)}},loadMore:function(){lmsfilemanager.fetchFiles(lmsfilemanager.lastRequestParams,!0)},setFilterInstance:function(){lmsfilemanager.filterInstance=lmsfilterutil.getFilterInstance(lmsfilemanager.getFilterObject())},getFilterObject:function(){let e=[];return e.push(lmsfilemanager.getCourseNameFilterObject()),e.push(lmsfilemanager.getFileTypeFilterObject()),e.push(lmsfilemanager.getSortByFilterObject()),e},getCourseNameFilterObject:function(){let e={dataSource:{search:function(e){return new Promise((function(t,s){var r=100*(e.pages-1),l=lmsfilemanager.getCourseDataForFilter(e.query,r);respObj={results:l,more:100==l.length},t(respObj)}))},paginated:!0},search:{searchIncrementsInCache:!1,showNoResultsMessage:ZPI18N.getString("zp.noresults"),delay:20,criteria:"startswith"},isLabelHTMLEncoded:!0,dropdownList:{isTextHTMLEncoded:!0,fitForElement:!0},serverSearch:!0,cacheData:!0,lazyLoading:!1,showSearchField:!0,placeholder:ZPI18N.getString("select"),viewPerPage:100,dataMapping:{text:"label",value:"value",id:"value"}};return{type:"tokenfield",id:"courseFil",label:ZPI18N.getString("zp.lms.course.coursename"),encodeHTML:!0,options:e}},getFileTypeFilterObject:function(){var e=[{label:ZPI18N.getString("zp.lms.image"),value:"images"},{label:ZPI18N.getString("zp.lms.video"),value:"videos"},{label:ZPI18N.getString("zp.lms.audio"),value:"audios"},{label:ZPI18N.getString("zp.lms.document"),value:"documents"},{label:ZPI18N.getString("zp.lms.presentation"),value:"presentations"},{label:ZPI18N.getString("zp.lms.sheet"),value:"sheets"},{label:ZPI18N.getString("zp.lms.text"),value:"text"},{label:ZPI18N.getString("zp.lms.pdf"),value:"pdfs"}];return{type:"select",label:ZPI18N.getString("zp.filetype"),id:"fileTypeFil",encodeHTML:!0,options:{options:e,placeholder:ZPI18N.getString("zp.select")}}},getSortByFilterObject:function(){let e=[{value:"desc",label:ZPI18N.getString("zp.lms.Recentlyuploaded")},{value:"asc",label:ZPI18N.getString("zp.lms.oldfiles")}];return{type:"select",label:ZPI18N.getString("zp.lms.sortby"),id:"sortByFil",encodeHTML:!0,options:{options:e,placeholder:ZPI18N.getString("zp.select")}}},clickHandle:function(e){var t=e.target,s=t.getAttribute("rel");if("files"==s||"resources"==s)lmsnewsettings.switchTab(t),lmsfilemanager.fetchFiles(),lmsfilemanager.makeAndUpdateHash();else if("fltr"==s)lmsfilemanager.viewFilter("add",null);else if("Filter"==s)lmsfilemanager.filterInstance.constructFilter(),lmsfilemanager.filterInstance.setFilterCallbacks({callback:lmsfilemanager.applyCallback},{callback:lmsfilemanager.resetFilter},{callback:lmsfilemanager.applyCallback});else if("reset"==s)lmsfilemanager.resetFilter();else if("cancel"==s)lmsfilemanager.resetFilter();else if("download"==s){var r=(l=t.closest("[rel=content]")).fileInfo;lmsfileaction.saveToLocal(r.additionalInfo.fileId,r.additionalInfo.type)}else{var l;if(l=t.closest("[rel=content]"))lmsattachment.init_LIGHTBOX(l)}},getCourseIds:function(){var e=[],t=document.querySelector("#courseNameFilter"),s=ZPeopleComponents.tokenfield(t).getAllValues();if(s.length>0)for(var r in s)e.push(s[r].id);return e},applyCallback:function(e){var t={},s=e.appliedFilters;if(Object.keys(s).length){if(s.courseFil){var r=s.courseFil.selectedvalues,l=[];$.each(r,(function(e,t){l.push(t.value)})),t.courseIds=l}if(s.fileTypeFil){var a=[];a.push(s.fileTypeFil.selectedvalues[0].value),t.type=a}if(s.sortByFil){var n=s.sortByFil.selectedvalues[0].value;t.sortby=n}}lmsfilemanager.filterMode=0!=Object.keys(e.appliedFilters).length,lmsfilemanager.fetchFiles(t)},resetAppliedFilters:function(){lmsfilemanager.clearAppliedFilters(),lmsfilemanager.startIndex=1,lmsfilemanager.fetchFiles()},clearAppliedFilters:function(){$("#contentApplFil").remove(),lmsfilemanager.appliedFilter={}},closeFilters:function(e){e&&($("[fil='"+e+"']").remove(),delete lmsfilemanager.appliedFilter[e],$("#contentApplFil ul").children().length||$("#contentApplFil").remove(),delete lmsfilemanager.filterParams[lmsfilemanager.IdMappingToParam[e]],lmsfilemanager.fetchFiles(lmsfilemanager.filterParams))},destroyComponents:function(){ZPeopleComponents.tokenfield(lmsfilemanager.root.querySelector("#courseNameFilter")).destroy(),ZPeopleComponents.select(lmsfilemanager.root.querySelector("#typeFilter")).destroy(),ZPeopleComponents.select(lmsfilemanager.root.querySelector("#sortByFilter")).destroy(),lmsfilemanager.root.querySelector("#filterBody").remove(),lmsfilemanager.root.classList.remove("zpl_fltr_flt")},resetFilter:function(){lmsfilemanager.filterMode=!1,lmsfilemanager.fetchFiles()},getCourseDataForFilter:function(e,t){let s=[];var r={method:"getAllCourseDetailsInAnOrg",conreqcsr:csrfToken};return e&&""!=e&&(r.search=e),zplms.postAsync("/contentAction.zp",r,(function(e){let t=e[1];for(let e=0;e<t.length;e++){let r=t[e],l={};l.label=r.courseName,l.value=r.courseId,s.push(l)}}),null,!1),s},listAssociatedCourses:function(e){"info"==this.type&&this.container.appendChild(lmsfilemanager.getAssociatedCoursesHTML(e.associatedCourses))},filterByType:function(){var e={options:[{label:ZPI18N.getString("zp.lms.image"),value:"images"},{label:ZPI18N.getString("zp.lms.video"),value:"videos"},{label:ZPI18N.getString("zp.lms.audio"),value:"audios"},{label:ZPI18N.getString("zp.lms.document"),value:"documents"},{label:ZPI18N.getString("zp.lms.presentation"),value:"presentations"},{label:ZPI18N.getString("zp.lms.sheet"),value:"sheets"},{label:ZPI18N.getString("zp.lms.text"),value:"text"},{label:ZPI18N.getString("zp.pdf"),value:"pdfs"}],placeholder:ZPI18N.getString("zp.type")};ZPeopleComponents.select(lmsfilemanager.root.querySelector("#typeFilter")).setAttributes(e)},filterSortBy:function(){var e={options:[{label:ZPI18N.getString("zp.lms.Recentlyuploaded"),value:"desc"},{label:ZPI18N.getString("zp.lms.oldfiles"),value:"asc"}],placeholder:ZPI18N.getString("zp.lms.sortby")};ZPeopleComponents.select(lmsfilemanager.root.querySelector("#sortByFilter")).setAttributes(e)},getAssociatedCoursesHTML:function(e){var t=document.createElement("div");if(t.className="zpl_secn",e.length){t.appendChild(document.createElement("div")).innerHTML="<h4>"+ZPI18N.getString("zp.lms.content.AssociatedCourses")+"</h4>";var s=t.appendChild(document.createElement("div"));s.className="zpl_Lbxcrs";for(var r=e.length-1;r>=0;r--)s.appendChild(lmsfilemanager.getCourseCard(e[r]))}else lmsnodata.showNoData({mode:"Associated_Course",container:t,module:"fileManager",content:ZPI18N.getString("zp.lms.fileisnotassociated")});return t},getCourseCard:function(e){const t=document.createElement("div");t.className="zpl_em";const s=t.appendChild(document.createElement("div"));s.className="zpl_emimg";var r=e.courseImageInfo;r.additionalInfo={fileId:e.courseId,type:6};var l=r.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+r.imageID+".svg"):lmsfileaction.generateSourceURL(r);s.innerHTML='<img src = "'+l+'"></img>',t.setAttribute("courseId",e.courseId),null!=e.batchId&&t.setAttribute("batchId",e.batchId),t.setAttribute("onclick","lmsfilemanager.getCourseOverview(this)");const a=t.appendChild(document.createElement("div"));a.className="zpl_emdts d-flexclm4",a.innerHTML="<div><b>"+e.courseName+"</b></div>";return a.appendChild(document.createElement("div")).appendChild(lmsfilemanager.getCourseFeedback(e.courseRating,!1,1,12)),t},getCourseFeedback:function(e,t,s,r){var l=!1;10*e%10>=5&&(l=Number(e.toString().charAt(0))+1);var a=document.createElement("div"),n=1;if(a.className=t||"zpl_str",s&&1==s)for(;n<=5;){a.appendChild(document.createElement("i")).className=(l==n?"PI_star-h":"PI_star")+(n<=e||l==n?" ylw":" gry"),n++}else for(var i=1;i<=e;i++){a.appendChild(document.createElement("div")).className="PI_star ylw"}return a},getCourseOverview:function(e){courseId=e.getAttribute("courseid"),batchId=e.getAttribute("batchId");if(null!=batchId)var t="course/"+courseId+"/batch/"+batchId+"/overview";else t="course/"+courseId+"/overview";lmscourses.openOverview(t)},makeAndUpdateHash:function(e){var t=lmsfilemanager.refer,s="/"+t.currentTab,r=lmsnotes.makeHash(e);r&&(s+="/filter:"+r),t.prevHash=t.baseUri+"contentmanager"+s,lms.changeHash("hash",t.prevHash,"disable")},getFileCard:function(e){e.fileType=lmsfileaction.getFileType(e.type,e.extension);var t={};e.fileId?(t.fileId=e.fileId,t.type=1):(t.fileId=e.resourceId,t.type=2),e.additionalInfo=t;var s=document.createElement("div");s.className="zpl_TAbx",s.setAttribute("rel","content"),s.fileInfo=e;var r=s.appendChild(document.createElement("div"));if(1==e.additionalInfo.type)r.appendChild(lmsattachment.getThumbnailIcon(e));else{var l=e.fileType=e.fileType||lmsfileaction.getFileType(e.type,e.extension);r.appendChild(lmsattachment.getDisplayIcon(l));var a=s.appendChild(document.createElement("i"));a.className="PI_downld",a.setAttribute("title",ZPI18N.getString("zp.Download")),a.setAttribute("rel","download")}return s.appendChild(document.createElement("span")).appendChild(document.createElement("font")).innerHTML=e.name,s},getAssociatedCoursesOfFile:function(e,t,s){var r={method:"getAssociatedCoursesOfFile",fileId:e,startIndex:t,conreqcsr:csrfToken};$.post("/contentAction.zp",r,s)},setCourseDataAndValidateCourse:function(e){if(lmsnotes.courseData=e||[],!lmsfilemanager.courseDataForHash){var t={};e.forEach((function(e){t[e.courseId]=e.cname})),lmsfilemanager.courseDataForHash=t}var s=function(e,t){for(prop in t){if(!e[prop])return!1;t[prop][0]=e[prop]}return!0}(lmsfilemanager.courseDataForHash,lmsfilemanager.tempData.fltrObj.items.courseId);lmsfilemanager.tempData.valid=lmsfilemanager.tempData.valid&&s,lmsfilemanager.hashHandling(lmsfilemanager.tempData),lmsfilemanager.tempData=null},viewFilter:function(e,t){var s=lmsfilemanager.root.querySelector("#lmsFilter");lmsfilter.create(e,{target:s,container:"",items:[{name:"courseIds",title:ZPI18N.getString("zp.lms.course.coursename"),datalist:lmsnotes.fetchMenu,mode:"multi",type:"select",emptyText:ZPI18N.getString("zp.lms.sall"),labelicon:"IC-tck"},{name:"type",title:ZPI18N.getString("zp.lms.type"),datalist:{images:[ZPI18N.getString("zp.lms.image"),""],videos:[ZPI18N.getString("zp.lms.video"),""],audios:[ZPI18N.getString("zp.lms.audio"),""],documents:[ZPI18N.getString("zp.lms.document"),""],presentations:[ZPI18N.getString("zp.lms.presentation"),""],sheets:[ZPI18N.getString("zp.lms.sheet"),""],text:[ZPI18N.getString("zp.lms.text"),""],pdfs:[ZPI18N.getString("zp.lms.pdf"),""]},mode:"single",type:"select",emptyText:ZPI18N.getString("zp.lms.any"),labelicon:"IC-tck"},{name:"sortby",title:ZPI18N.getString("zp.lms.notes.sortby"),datalist:{desc:[ZPI18N.getString("zp.lms.Recentlyuploaded"),""],asc:[ZPI18N.getString("zp.lms.oldfiles"),""]},mode:"single",type:"select",emptyText:ZPI18N.getString("zp.select"),labelicon:""}],search:!0,selecteditems:t},!0).on("apply",(function(){var e=this.filterObject;e.sortBy&&(e.sortBy=e.sortBy[0]),e.searchStr&&e.searchStr.length>0&&(e.search=e.searchStr.trim(),delete e.searchStr),isEmpty(e)||(lmsfilemanager.filterMode=!0,lmsfilemanager.makeAndUpdateHash(e),lmsfilemanager.fetchFiles(e))})).on("clear",(function(){lmsfilemanager.filterMode&&(lmsfilemanager.filterMode=!1,lmsfilemanager.fetchFiles())})).bind()},reInitialise:function(e){lmsfilemanager.refer={courseId:null,sortBy:"desc",index:1,baseUri:"",prevHash:""},lmsfilemanager.courseDataForHash=null,lmsfilemanager.lastRequestParams={},lmsfilemanager.integ=!1,lmsfilemanager.filterMode=!1,lmsfilemanager.root=e&&e.elem?e.elem:lmsfilemanager.initObj.elem,lmsfilemanager.scrollElem=null;var t=lmsfilemanager.htmlConf;t.header=!0,t.filter=!0,t.bodyClass="zpl_rgtcnt"},constructFilter:function(e,t){var s=document.createElement("div");s.innerHTML='<div class="zpl_fltrhd"><h5>Filter</h5><i class="PI_cls" title="Close" rel="cancel"></i></div>';var r=document.createElement("div");r.className="zpl_fltrcnt",r.id="filterBody",r.appendChild(lmsfilemanager.createFilterBody(e));var l=document.createElement("div");l.innerHTML='<button id="apl_filter" type="button" class="zlabel zlabel--blue zlabel--medium" rel="apply">Apply</button><button type="button" class="zlabel zlabel--outline zlabel--medium" rel="reset">Reset</button>';var a=t.root.querySelector("#lmsFilter");a.innerHTML="",a.appendChild(s),a.appendChild(r),a.appendChild(l),t.root.classList.add("zpl_fltr_flt"),lmsbase.addListener(a,"click",lmsfilemanager.filterHandler,!1),lmsfilemanager.createOptions(t,e)},createFilterBody:function(e){var t=document.createElement("div");return t.appendChild(lmsfilemanager.constructFields(e)),t},constructFields:function(e){var t=document.createElement("div");t.className="zpl_fltclps fltopn";var s=document.createElement("div");s.id="field_container",s.className="zpl_fltrlst";var r="";return $.each(e,(function(e,t){r+=`<div class="zpl_secn">\n\t\t<div><label>${t.label}</label></div><div>`,r+=t.type&&"token"==t.type?`<textarea  id=${t.id} class="tokenfieldId-js" style="display: none;"></textarea>`:`<select id="${t.id}" style="display: none;"></select>`,r+="</div></div>"})),s.innerHTML=r,t.appendChild(s),t},createOptions:function(e,t){$.each(t,(function(t,s){e.root.querySelector(`#${s.id}`)&&s.callback()}))},close:function(){const e=document.querySelector('[_rel = "lightBoxCont"]');e&&e.remove(),lmsfilemanager.reInitialise(),lmsfilemanager.filterInstance&&lmsfilemanager.filterInstance.closeFilter()}};const lmsfilterutil=function(){class e{constructor(){this.breadCrumbs=new t(this),this.breadCrumbs.appliedFilters={},this.dateRangeObject={dateRange:[]}}buildFilterBox(){this.encodeObject=[],this.decodeObject=[],this.initializeFilterBox(),this.filterBox.append(this.createFilterHeader()),this.filterBox.append(this.createFilterBody()),this.filterBox.append(this.createFilterFooter()),this.configureFilterFields(),this.attachFilterEvents(),!this.filterContainer.hasClass("zpl_fltr_flt")&&this.filterContainer.addClass("zpl_fltr_flt"),this.filterOpen=!0}initializeFilterBox(){if(0!=this.filterContainer.find(".zpl_fltr").length)return this.filterBox=this.filterContainer.find(".zpl_fltr"),void this.filterBox.empty();this.filterBox=$(lmsdocument.createElement("div",{class:"zpl_fltr",id:"lmsFilter"})),this.filterContainer.append(this.filterBox)}createFilterHeader(){return`<div>\n\t\t\t\t\t\t<div class="zpl_fltrhd">\n\t\t\t\t\t\t\t<h5>${ZPI18N.getString("zp.filter")}</h5>\n\t\t\t\t\t\t\t<i class="PI_cls" title="${ZPI18N.getString("zp.lms.close")}" rel='closeFilter'"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`}createFilterBody(){return`<div class="zpl_fltrcnt">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class="zpl_fltclps fltopn">\n\t\t\t\t\t\t\t\t<div class="zpl_fltrlst">\n\t\t\t\t\t\t\t\t\t${this.constructFilterFields()}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`}getFieldConstructMapping(){return{select:this.constructSelectField,tokenfield:this.constructTokenField,datefield:this.constructDateField,checkbox:this.constructCheckBox}}getFieldInitMapping(){return{select:this.initSelectField,tokenfield:this.initTokenField,datefield:this.initDateField,checkbox:this.initCheckBox}}getFieldDestroyMapping(){return{select:this.destroySelectField,tokenfield:this.destroyTokenField,datefield:this.destroyDateField}}getFieldResetMapping(){return{select:this.resetSelectField,tokenfield:this.resetTokenField,datefield:this.resetDateField,checkbox:this.resetCheckBox}}getFieldApplyMapping(){return{select:this.getAppliedSelectVal,tokenfield:this.getAppliedTokenfieldVal,datefield:this.getAppliedDateFieldval,checkbox:this.getAppliedCheckBoxVal}}getFieldOpenMapping(){return{select:this.openSelectField,tokenfield:this.openTokenField,datefield:this.openDateField}}getFieldDisableMapping(){return{select:this.disableSelectField,tokenfield:this.disableTokenField,datefield:this.disableDateField}}constructFilterFields(){let e="",t=this;return $.each(this.filterObject,(function(s,r){e+='<div class="zpl_secn">',"checkbox"!=r.type&&(e+=t.constructFieldLabel(r.label)),e+=t.getFieldConstructMapping()[r.type](r),e+="</div>"})),e}constructFieldLabel(e){return"<div><label>"+e+"</label></div>"}constructSelectField(e){return`<div><select id="${e.hasOwnProperty("id")?e.id:"lmsFilterSelect"}" rel="lmsFilterUtil" type="select" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" aria-label="${e.label}"></select></div>`}constructTokenField(e){return'<div><textarea class="tokenfieldId-js" id="'+(e.hasOwnProperty("id")?e.id:"lmsFilterTokenField")+'" rel="lmsFilterUtil" type="tokenfield"></textarea></div>'}constructDateField(e){return'<div><input id="'+(e.hasOwnProperty("id")?e.id:"lmsFilterDateField")+'" data-format="'+dateFmt+'" data-spin-buttons="none" data-calendar-icon="true" data-picker="true" rel="lmsFilterUtil" type="dateField"></input></div>'}constructCheckBox(e){return'<div><div class="zcheckbox"><input type="checkbox" id="'+(e.hasOwnProperty("id")?e.id:"lmsCheckBox")+'" class="zcheckbox__helper" value="" _rel="checkBox_'+e.id+'"></input><label class="zcheckbox__label" _rel="checkBox_'+e.id+'">'+e.label+"</label></div></div>"}createFilterFooter(){return`<div>\n\t\t\t\t\t\t<button type="button" class="zlabel zlabel--blue zlabel--medium" rel="applyFil">${ZPI18N.getString("zp.apply")}</button>\n\t\t\t\t\t\t<button type="button" class="zlabel zlabel--outline zlabel--medium" rel="resetFil">${ZPI18N.getString("zp.lms.reset")}</button>\n\t\t\t\t\t</div>`}configureFilterFields(){let e=this;$.each(this.filterObject,(function(t,s){e.getFieldInitMapping()[s.type].call(e,s)}))}initSelectField(e){let t=e.id;this.destroyInitializedFilter(t,e.type);let s=this.getSelectFieldOptions(e);if(ZPeopleComponents.select("#"+t).setAttributes(s),this.breadCrumbs.appliedFilters&&this.breadCrumbs.appliedFilters.hasOwnProperty(e.id)){let s=this.breadCrumbs.appliedFilters[e.id].selectedvalues;ZPeopleComponents.select("#"+t).setValue(s)}}getSelectFieldOptions(e){return e.hasOwnProperty("serverSearch")&&e.serverSearch&&e.hasOwnProperty("props")?e.props:e.options}initTokenField(e){let t=e.hasOwnProperty("id")?e.id:"lmsFilterSelect";this.destroyInitializedFilter(t,e.type);let s=e.hasOwnProperty("props")?e.props:e.options;if(ZPeopleComponents.tokenfield("#"+t,s),this.breadCrumbs.appliedFilters&&this.breadCrumbs.appliedFilters.hasOwnProperty(e.id)){let s=this.breadCrumbs.appliedFilters[e.id].selectedvalues;ZPeopleComponents.tokenfield("#"+t).setAttributes({values:s})}}initDateField(e){let t=e.id;if(this.destroyInitializedFilter(t,e.type),ZPeopleComponents.datefield("#"+t),(e.hasOwnProperty("validation")&&"dateFrom"==e.validation||"dateTo"==e.validation)&&(this.dateRangeValidation=!0,this.dateRangeObject[e.validation]=e),this.breadCrumbs.appliedFilters&&this.breadCrumbs.appliedFilters.hasOwnProperty(e.id)){let s=this.breadCrumbs.appliedFilters[e.id].selectedvalues;ZPeopleComponents.datefield("#"+t).setValue(s[0].value)}}initCheckBox(e){let t=e.id,s=this;$('[_rel="checkBox_'+t+'"]').off().on("click",(function(e){let t=s.filterBox.find("#"+this.getAttribute("_rel").split("_")[1])[0];t.checked=!t.checked})),this.breadCrumbs.appliedFilters&&this.breadCrumbs.appliedFilters.hasOwnProperty(e.id)&&(this.filterBox.find("#"+t)[0].checked=!0)}destroyInitializedFilter(e,t){this.isFilterFieldInitialized(e)&&this.getFieldDestroyMapping()[t](e)}isFilterFieldInitialized(e){return $("#"+e).length&&ZPeopleComponents.isComponent("#"+e)}destroySelectField(e){ZPeopleComponents.select("#"+e).destroy()}destroyTokenField(e){ZPeopleComponents.tokenfield("#"+e).destroy()}destroyDateField(e){ZPeopleComponents.datefield("#"+e).destroy()}attachFilterEvents(){lmsbase.addListener(this.filterBox.find('[rel="closeFilter"]')[0],"click",this.closeFilter.bind(this)),lmsbase.addListener(this.filterBox.find('[rel="applyFil"]')[0],"click",this.applyFilter.bind(this)),lmsbase.addListener(this.filterBox.find('[rel="resetFil"]')[0],"click",this.resetFilter.bind(this)),lmsbase.addListener(document,"keyup",this.closeFilter.bind(this))}setFilterCallbacks(e,t,s){this.applyCallbackObj=e,this.breadCrumbs.resetBreadCrumbsCallback=t,this.breadCrumbs.closeBreadCrumbsCallback=s}closeFilter(e){if(!this.filterOpen||e&&"keyup"==e.type&&27!=e.keyCode)return;let t=this;$.each(this.filterObject,(function(e,s){t.destroyInitializedFilter(s.id,s.type)})),this.filterBox.empty(),lmsbase.removeListener(document,"keyup",this.closeFilter.bind(this)),this.filterContainer.hasClass("zpl_fltr_flt")&&this.filterContainer.removeClass("zpl_fltr_flt"),this.filterOpen=!1}applyFilter(){if(this.dateRangeValidation&&!this.validateDateRange())return;this.breadCrumbs.clearBreadCrumbs();let e=this.getAppliedFilters();this.breadCrumbs.appliedFilters=e[0].appliedFilters,this.closeFilter(),this.hasAppliedFilters()&&this.breadCrumbs.constructAppliedFilter(),this.invokeCallback(e)}validateDateRange(){return this.showErrorFieldForDateRange(this.getInvalidDateRange())}showErrorFieldForDateRange(e){if(""==e)return!0;let t="";"dateFromInvalid"==e?(e="dateFrom",t=ZPI18N.getString("zp.fromDateToDateerror")):t="dateFrom"==e?ZPI18N.getString("zp.componentErrMsg.Invalid_invalidVal",[" from date"]):ZPI18N.getString("zp.componentErrMsg.Invalid_invalidVal",[" to date"]);let s=this.dateRangeObject.dateTo.id,r=this.dateRangeObject.dateFrom.id;$("#"+s).parent().find("#errorSpan").remove(),ZPeopleComponents.datefield("#"+s).setAttributes({className:""}),$("#"+r).parent().find("#errorSpan").remove(),ZPeopleComponents.datefield("#"+r).setAttributes({className:""});let l=this.dateRangeObject[e].id;return $("#"+l).parent().append('<span id="errorSpan" class="ztextbox--error__label">'+t+"</span>"),ZPeopleComponents.datefield("#"+l).setAttributes({className:"ztextbox__error"}),!1}getInvalidDateRange(){let e=this.getAppliedDateFieldval(this.dateRangeObject.dateFrom.id,this.dateRangeObject.dateFrom.label),t=this.getAppliedDateFieldval(this.dateRangeObject.dateTo.id,this.dateRangeObject.dateTo.label);return t&&""!=t.selectedvalues&&e&&""!=e.selectedvalues&&!this.isValidDateRange(e.selectedvalues[0].value,t.selectedvalues[0].value)?"dateFromInvalid":e&&""!=e.selectedvalues?t&&""!=t.selectedvalues?"":"dateTo":t&&""!=t.selectedvalues?e&&""!=e.selectedvalues?"":"dateFrom":""}isValidDateRange(e,t){return addCourseForm.parseDate(e)<addCourseForm.parseDate(t)||addCourseForm.parseDate(e).getTime()==addCourseForm.parseDate(t).getTime()}invokeCallback(e){this.applyCallbackObj&&this.applyCallbackObj.params&&""!=this.applyCallbackObj.params&&e.push(params),this.applyCallbackObj&&this.applyCallbackObj.callback(...e)}getAppliedFilters(){let e=this,t={};return $.each(this.filterObject,(function(s,r){let l=e.getFieldApplyMapping()[r.type].call(e,r.id,r.label);""!=l.selectedvalues&&(t[r.id]=l,"datefield"==r.type&&e.dateRangeValidation&&e.dateRangeObject.dateRange.push(r.id),r.hasOwnProperty("encodeHTML")&&r.encodeHTML&&e.encodeObject.push(r.id),(r.hasOwnProperty("options")&&r.options.hasOwnProperty("serverSearch")&&r.options.serverSearch||r.hasOwnProperty("props")&&r.props.hasOwnProperty("serverSearch")&&r.props.serverSearch)&&r.encodeHTML&&e.decodeObject.push(r.id))})),[{appliedFilters:t}]}getAppliedSelectVal(e,t){return this.isFilterFieldInitialized(e)?{label:t,selectedvalues:!ZPeopleComponents.select("#"+e).disabled&&ZPeopleComponents.select("#"+e)._optDatas?this.outputParser(ZPeopleComponents.select("#"+e)._optDatas):[""]}:{}}getAppliedTokenfieldVal(e,t){return this.isFilterFieldInitialized(e)?{label:t,selectedvalues:this.outputParser(ZPeopleComponents.tokenfield("#"+e).getAllValues())}:{}}getAppliedDateFieldval(e,t){return this.isFilterFieldInitialized(e)?{label:t,selectedvalues:!ZPeopleComponents.datefield("#"+e).disabled&&this.outputParser([ZPeopleComponents.datefield("#"+e).getValue().dateString],"date")}:{}}getAppliedCheckBoxVal(e,t){return 0==$("#"+e).length?{}:{label:t,selectedvalues:this.filterBox.find("#"+e)[0].checked?this.outputParser([t],"checkBox"):""}}outputParser(e,t){if(0==e.length)return"";if("date"==t)return e[0]?[{label:e[0],value:e[0]}]:"";if("checkBox"==t&&e[0])return[{label:e[0],value:e[0]}];for(const t of e)"name"in t&&(t.label=t.name,delete t.name),"id"in t&&(t.value=t.id,delete t.id);return e}hasAppliedFilters(){return 0!=Object.keys(this.breadCrumbs.appliedFilters)}resetFilter(){let e=this;$.each(this.filterObject,(function(t,s){e.getFieldResetMapping()[s.type].call(e,s.id)}))}resetSelectField(e){this.isFilterFieldInitialized(e)&&(ZPeopleComponents.select("#"+e).deselectAllOptions(),delete ZPeopleComponents.select("#"+e)._optDatas)}resetTokenField(e){this.isFilterFieldInitialized(e)&&ZPeopleComponents.tokenfield("#"+e).removeAllTokens()}resetDateField(e){this.isFilterFieldInitialized(e)&&ZPeopleComponents.datefield("#"+e).setValue()}resetCheckBox(e){this.filterBox.find("#"+e)[0].checked=!1}openFilter(e){let t=this.filterObject.find((t=>t.id==e)).type,s=this.getFieldOpenMapping()[t];s&&s.call(this,e)}openSelectField(e){this.isFilterFieldInitialized(e)&&ZPeopleComponents.select("#"+e).open()}openTokenField(e){this.isFilterFieldInitialized(e)&&ZPeopleComponents.tokenfield("#"+e).openDropdownList()}openDateField(e){this.isFilterFieldInitialized(e)&&ZPeopleComponents.datefield("#"+e).openPicker()}disableSelectField(e,t){this.isFilterFieldInitialized(e)&&(ZPeopleComponents.select("#"+e).disabled=t)}disableTokenField(e,t){this.isFilterFieldInitialized(e)&&(ZPeopleComponents.tokenfield("#"+e).disabled=t)}disableDateField(e,t){this.isFilterFieldInitialized(e)&&(ZPeopleComponents.datefield("#"+e).disabled=t)}getFilterBox(){return this.filterBox}clearBreadCrumbs(){this.breadCrumbs.clearBreadCrumbs()}resetBreadCrumbs(){this.breadCrumbs.resetBreadCrumbs()}showAllFilters(){let e=this;$.each(this.filterBox.find(".zpl_secn"),(function(t,s){$(s).show();let r=$(s).find("[rel='lmsFilterUtil']").attr("id"),l=$(s).find("[rel='lmsFilterUtil']").attr("type"),a=e.getFieldDisableMapping()[l];a&&a.call(e,r,!1)}))}hideFilter(e){let t=this.filterBox.find("#"+e).attr("type");this.filterBox.find("#"+e).closest(".zpl_secn").hide();let s=this.getFieldDisableMapping()[t];s&&s.call(this,e,!0)}hideAllFilters(e){let t=this;$.each(this.filterBox.find(".zpl_secn"),(function(s,r){let l=$(r).find("[rel='lmsFilterUtil']").attr("id");e.includes(l)||t.hideFilter(l)}))}}class t{constructor(e){this.filterBoxManager=e}constructAppliedFilter(){$("#lmsApplFil").remove();let e=lmsdocument.createElement("div",{class:"zpl_fltrvw",id:"lmsApplFil"}),t=document.createElement("div");$(e).append(t);let s=lmsdocument.createElement("ul",{class:"zpl_fltrvwlst"});t.appendChild(s),$(e).append(this.getBreadCrumbs(s));let r=`<div class="d-flexcap MLauto">\n                        \t<a class="zpl_link" _rel="resetFilter">${ZPI18N.getString("zp.reset")}</a>\n                      \t</div>`;$(e).append(r),lmsbase.addListener($(e).find('[_rel="resetFilter"]')[0],"click",this.resetBreadCrumbs.bind(this)),$(e).insertAfter(this.filterBoxManager.filterContainer.find(".zpl_btnmnu"))}getBreadCrumbs(e){let t=0,s=this,r=!1;$.each(this.appliedFilters,(function(l,a){return 4==t?($(e).append('<li class="zpl_mre" rel="showMoreFilter"><i class="PI_more"></i></li>'),lmsbase.addListener($(e).find(".zpl_mre")[0],"click",(function(){!s.filterBoxManager.filterOpen&&s.filterBoxManager.buildFilterBox()})),r=!0,!1):!!s.filterBoxManager.dateRangeObject.dateRange.includes(l)||(a.selectedvalues.length>1?s.getMultiBreadCrumb(l,a,e):s.getSingleBreadCrumb(l,a,e),s.attachBreadCrumbListeners(e,l),void t++)})),0==this.filterBoxManager.dateRangeObject.dateRange.length||r||(this.constructDateRange(e),this.attachBreadCrumbListeners(e,"dateRange"))}getSingleBreadCrumb(e,t,s){let r=t.selectedvalues[0].label,l="<li _rel="+t.selectedvalues[0].value+" fil="+e+' id="breadCrumb">';l+="<label>"+t.label+(t.label!=r?" :":"")+"</label>",t.label!=r&&(this.filterBoxManager.encodeObject.includes(e)&&(r=this.filterBoxManager.decodeObject.includes(e)?zplms.encodeHTML(ZPeople.decodeTxt(r)):zplms.encodeHTML(r)),l+='<span title="'+r+'">'+r+"</span>"),l+='<a class="PI_cls" _rel="closeFilter_'+e+'"></a>',l+="</li>",$(s).append(l)}getMultiBreadCrumb(e,t,s){let r=t.selectedvalues[0].label,l="<li _rel="+t.selectedvalues[0].value+" fil="+e+' id="breadCrumb">';l+="<label>"+t.label+(t.label!=r?" :":"")+"</label>",t.label!=r&&(this.filterBoxManager.encodeObject.includes(e)&&(r=this.filterBoxManager.decodeObject.includes(e)?zplms.encodeHTML(ZPeople.decodeTxt(r)):zplms.encodeHTML(r)),l+='<span title="'+r+'">'+r+"</span>"),t.selectedvalues.length>1&&(l+='<sub _rel="filterMenuMore_'+e+'" id="filterMore" _rel="filterMore" fil="'+e+'">+'+(t.selectedvalues.length-1)+"</sub>"),l+='<a class="PI_cls" _rel="closeFilter_'+e+'"></a>',l+="</li>",$(s).append(l),t.selectedvalues.length>1&&($(s).find("[_rel='filterMenuMore_"+e+"']").data("moreOptions",t.selectedvalues.slice(1)),$(s).find("[_rel='filterMenuMore_"+e+"']").off().on("click",this.constructSubBreadCrumbs.bind(this)))}constructDateRange(e){let t=ZPI18N.getString("zp.noofdaysrequested"),s=this.filterBoxManager.dateRangeObject.dateFrom.id,r=this.filterBoxManager.dateRangeObject.dateTo.id,l=this.appliedFilters[s].selectedvalues[0].value+" - "+this.appliedFilters[r].selectedvalues[0].value,a='<li fil="dateRange" id="breadCrumb" dateRangeIds="'+s+"_"+r+'">';a+="<label>"+t+" : </label>",a+='<span title="'+l+'">'+l+"</span>",a+='<a class="PI_cls" _rel="closeFilter_dateRange"></a>',a+="</li>",$(e).append(a)}constructSubBreadCrumbs(e){let t=e.target.getAttribute("fil"),s=this.filterBoxManager.encodeObject.includes(t),r=this.filterBoxManager.decodeObject.includes(t);$("#lmsFilterMoreMenu_"+t).remove();let l=$(e.target).data("moreOptions"),a='<div id="lmsFilterMoreMenu_'+t+'" class="zpl_drpdwn zpl_fltrvwlst zmenu zmenu--iconwithtext" data-type="list" data-content-type="icon-text" role="menu" tabindex="0" aria-hidden="true">';a+='<ul data-body="true" class="zmenu__body"/>',$.each(l,(function(e,t){a+='<li id="'+t.value+'" rel="breadCrumbMore" data-item-type="custom" class="zmenu__item zmenu__custom" role="menuitem">',s&&(t.label=r?zplms.encodeHTML(ZPeople.decodeTxt(t.label)):zplms.encodeHTML(t.label)),a+='<span title="'+t.label+'">'+t.label+"</span>",a+='<a class="PI_cls" id="closeFilter_'+t.value+'" rel="breadCrumbClose"></a>',a+="</li>"})),a+="</ul></div>",ZPeopleComponents.isComponent("#lmsFilterMoreMenu_"+t)&&ZPeopleComponents.menu("#lmsFilterMoreMenu_"+t).destroy(),this.filterBoxManager.filterContainer.append(a),ZPeopleComponents.menu("#lmsFilterMoreMenu_"+t,{forElement:"#"+e.target.getAttribute("id"),itemclick:this.subBreadCrumbClickHandle.bind(this)}).show()}attachBreadCrumbListeners(e,t){let s=this;lmsbase.addListener($(e).find('[fil="'+t+'"]')[0],"click",(function(e){if(e.target.hasAttribute("_rel")&&(e.target.getAttribute("_rel").includes("close")||e.target.getAttribute("_rel").includes("filterMenuMore")))return;!s.filterBoxManager.filterOpen&&s.filterBoxManager.buildFilterBox();let t=e.target.closest("#breadCrumb"),r=t.getAttribute("fil");if("dateRange"!=r)s.filterBoxManager.openFilter(r);else{let e=t.getAttribute("dateRangeIds").split("_");s.filterBoxManager.openFilter(e[0])}})),lmsbase.addListener($(e).find("[_rel='closeFilter_"+t+"']")[0],"click",(function(){s.closeBreadCrumb.call(s,t)}),!1)}subBreadCrumbClickHandle(e){let t=e.detail;if(t.originalEvent.target.hasAttribute("rel")&&"breadCrumbClose"==t.originalEvent.target.getAttribute("rel"))return this.removeSubBreadCrumb(t),void this.invokeBreadCrumbClose();!this.filterBoxManager.filterOpen&&this.filterBoxManager.buildFilterBox();let s=t.forElement.closest("#breadCrumb").attr("fil");this.filterBoxManager.openFilter(s)}invokeBreadCrumbClose(){if(this.closeBreadCrumbsCallback){let e=[{appliedFilters:this.appliedFilters},this.closeBreadCrumbsCallback.params||""];this.closeBreadCrumbsCallback.callback(...e)}}removeSubBreadCrumb(e){let t=e.menuitem.attr("id");ZPeopleComponents.menu(e.container).removeMenuItem("#"+t);let s=e.target,r=e.forElement.closest("#breadCrumb").attr("fil");if(this.appliedFilters[r].selectedvalues=this.appliedFilters[r].selectedvalues.filter((e=>e.value!=t)),1==s[0].textContent.split("+")[1])ZPeopleComponents.menu(e.container).destroy(),e.target.remove();else{let r=s[0].textContent.split("+")[1];s[0].textContent="+"+(r-1);let l=s.data("moreOptions").filter((e=>e.value!=t));e.target.data("moreOptions",l)}}closeBreadCrumb(e){e&&""!=e&&($("[fil='"+e+"']").remove(),"dateRange"!=e?this.appliedFilters&&delete this.appliedFilters[e]:(this.filterBoxManager.dateRangeObject.dateRange.forEach((e=>{this.appliedFilters.hasOwnProperty(e)&&delete this.appliedFilters[e]})),this.filterBoxManager.dateRangeObject.dateRange=[]),$("#lmsApplFil ul").children().length||$("#lmsApplFil").remove(),this.filterBoxManager.closeFilter(),this.invokeBreadCrumbClose(),0!=$("#lmsApplFil").find('[rel="showMoreFilter"]').length&&this.constructAppliedFilter())}resetBreadCrumbs(){if(this.clearBreadCrumbs(),this.filterBoxManager.closeFilter(),this.resetBreadCrumbsCallback){let e=[this.appliedFilters,this.resetBreadCrumbsCallback.params||""];this.resetBreadCrumbsCallback.callback(...e)}}clearBreadCrumbs(){$("#lmsApplFil").remove();let e=this;$.each(this.appliedFilters,(function(t){delete e.appliedFilters[t]})),this.filterBoxManager.dateRangeObject.dateRange=[]}}class s{constructor(e,t,s){this.filterBoxManager=e,this.filterBoxManager.filterObject=t,this.filterBoxManager.filterContainer=s||Layout.Page.container}constructFilter(){this.filterBoxManager.buildFilterBox()}getFilterBox(){return this.filterBoxManager.filterBox}setFilterCallbacks(e,t,s){this.filterBoxManager.setFilterCallbacks(e,t,s)}clearBreadCrumbs(){this.filterBoxManager.clearBreadCrumbs()}showAllFilters(){this.filterBoxManager.showAllFilters()}hideFilter(e){this.filterBoxManager.hideFilter(e)}hideAllFilters(e){this.filterBoxManager.hideAllFilters(e)}closeFilter(){this.filterBoxManager.closeFilter()}resetBreadCrumbs(){this.filterBoxManager.resetBreadCrumbs()}}return{getFilterInstance:function(t,r){return new s(new e,t,r)}}}();lmseditormanager={count:0,stack:{},cleanUpInterval:null,generateUkey:function(){return(new Date).getTime()+"_"+this.count++},initiate:function(e){if(e.getAttribute("_ukey")){t=e.getAttribute("_ukey");return this.stack[t].editor}var t=lmseditormanager.generateUkey(),s=new Editor(e);return this.stack[t]={elem:e,editor:s},e.setAttribute("_ukey",t),lmsbase.addListener(e,"mousedown",lmseditormanager.clickHandle),lmseditormanager.setInterval(),s},setInterval:function(){lmseditormanager.cleanUpInterval||(lmseditormanager.cleanUpInterval=window.setInterval(lmseditormanager.scheduleCleanUp,18e5))},scheduleCleanUp:function(){for(var e in lmseditormanager.stack)document.contains(lmseditormanager.stack[e].elem)||lmseditormanager.destroy(lmseditormanager.stack[e].editor);0==Object.keys(lmseditormanager.stack).length&&(window.clearInterval(lmseditormanager.cleanUpInterval),lmseditormanager.cleanUpInterval=null)},destroy:function(e){var t=e.rfr.elem,s=t.getAttribute("_ukey");t.removeAttribute("_ukey"),lmsbase.removeListener(t,"mousedown",lmseditormanager.clickHandle),delete this.stack[s]},clickHandle:function(e){var t=e.target.closest("[_ukey]").getAttribute("_ukey");lmseditormanager.stack[t].editor.clickHandle(e)}};var Editor=function(e){return this.rfr={},this.rfr.elem=e,this};Editor.prototype.insertEditor=function(e,t,s){refer=lmseditor.refer,elem=this.rfr.elem,this.rfr={elem,type:e.type,fileName:e.moduleName,editorHeight:e.editorHeight||refer.editorHeight,isMiniEditor:null!=e.isMiniEditor?e.isMiniEditor:refer.isMiniEditor,enableSubmit:null!=e.enableSubmit?e.enableSubmit:refer.enableSubmit,isToolbarTop:null!=e.isToolbarTop?e.isToolbarTop:refer.isToolbarTop,enableFontFamily:null!=e.enableFontFamily?e.enableFontFamily:refer.enableFontFamily,enableFontSize:null!=e.enableFontSize?e.enableFontSize:refer.enableFontSize,enableTable:null!=e.enableTable?e.enableTable:refer.enableTable,enableEmbeds:null!=e.enableEmbeds?e.enableEmbeds:refer.enableEmbeds,enableOnlyImageEmbeds:null!=e.enableOnlyImageEmbeds?e.enableOnlyImageEmbeds:refer.enableOnlyImageEmbeds,enableLink:null!=e.enableLink?e.enableLink:refer.enableLink,enableQuote:null!=e.enableQuote?e.enableQuote:refer.enableQuote,enableRemoveFormatting:null!=e.enableRemoveFormatting?e.enableRemoveFormatting:refer.enableRemoveFormatting,enableHorizontalRule:null!=e.enableHorizontalRule?e.enableHorizontalRule:refer.enableHorizontalRule,enableSmily:null!=e.enableSmily?e.enableSmily:refer.enableSmily,needEditorFocus:e.needEditorFocus,additionalParams:e.additionalParams,afterEditorLoadCallback:e.afterEditorLoadCallback,contentChangedCallback:e.contentChangedCallback},this.rfr.submitCallback=this.rfr.enableSubmit?e.submitCallback:null,this.rfr.embedSources={enableDeskTop:!e.embedSources||null==e.embedSources.enableDeskTop||e.embedSources.enableDeskTop,enableCloud:!e.embedSources||null==e.embedSources.enableCloud||e.embedSources.enableCloud,enableUrl:!e.embedSources||null==e.embedSources.enableUrl||e.embedSources.enableUrl},this.rfr.embedSources.enableDeskTop||this.rfr.embedSources.enableCloud||this.rfr.embedSources.enableUrl||(this.rfr.enableEmbeds=!1,this.rfr.enableOnlyImageEmbeds=!1),this.rfr.enableOnlyImageEmbeds&&(this.rfr.enableEmbeds=!1),e.enableInsertField&&(this.rfr.enableInsertField=e.enableInsertField,this.rfr.insertFields=e.insertFields),"add"==t?lmseditor.getEditor(this.rfr,"add"):"edit"==t&&null!=s&&lmseditor.getEditor(this.rfr,"edit",s)},Editor.prototype.clickHandle=function(e){var t=e.target;t.closest("[title]")&&t.closest("[title]").getAttribute("title");lmseditor.clickHandle(e,this.rfr)},Editor.prototype.isEmpty=function(){var e=this.rfr.zeEditor;return lmseditor.isEmpty(e)},Editor.prototype.saveEditorContent=function(e){lmseditorSave.saveContent(this,this.rfr,e)},Editor.prototype.getEditorContent=function(e){lmseditorSave.getEditorContent(this.rfr,e)},Editor.prototype.setContentInEditor=function(e){lmseditor.setContentInEditor(e,this.rfr)};var lmseditor={refer:{elem:null,type:1,fileName:null,editorHeight:void 0,isMiniEditor:!1,enableSubmit:!1,submitCallback:null,isToolbarTop:!0,enableFontFamily:!0,enableFontSize:!0,enableTable:!0,enableEmbeds:!0,enableOnlyImageEmbeds:!1,enableLink:!0,enableQuote:!0,enableRemoveFormatting:!0,enableHorizontalRule:!0,enableSmily:!0,embedSources:null},rfr_popup:{elem:null,url:null,embedTag:null,domain:null,embedType:null},uploadHelperObjects_stk:{},getEditor:function(e,t,s){var r=document.createElement("div");r.setAttribute("_rel","editor_container"),e.elem.innerHTML="",e.elem.appendChild(r),e.isMiniEditor&&"add"==t?lmseditor.getMiniEditor(e):lmseditor.insertEditor(e,t,s)},getMiniEditor:function(e){e.elem.querySelector("[_rel=editor_container]").innerHTML='<textarea class="form-control comps_bfr" _rel="miniEditor"></textarea>'},insertEditor:function(e,t,s){var r=lmseditor.getEditorContainer(e);lmseditor.getZEEditor(r.getAttribute("id"),e),"edit"==t&&(s.contentId&&!s.contentInfo?lmsfetchFile.fetchFile({contentId:s.contentId,callback:lmseditor.setContentInEditor,isReplaceEmbedsInFile:!0},e,"edit"):lmseditor.setContentInEditor(s.contentInfo,e,s.isEmbedsAlreadyReplaced))},clickHandle:function(e,t){var s=e.target,r=s.getAttribute("_rel");if("miniEditor"==r)lmseditor.insertEditor(t);else if("submit"==r)lmseditorSave.getEditorContent(t,(function(e){var s={};s.content=e.content,s.embedContentIds=e.embedIds.embedContentIds?e.embedIds.embedContentIds:void 0,s.embedUrlIds=e.embedIds.embedUrlIds?e.embedIds.embedUrlIds:void 0,t.submitCallback(s)}));else if(s.closest("[data-others]")){lmseditor.rfr_popup.refer=t;let e=s.closest("[data-others]").getAttribute("data-others");"url"==e&&lmseditor.getUrlPopup(),t.insertFields&&Object.keys(t.insertFields).indexOf(e)>-1&&t.zeEditor.insertHTML(e)}else("embedFile"!=s.getAttribute("title")&&"embedUrl"!=s.getAttribute("title")||"img"!=s.tagName.toLowerCase())&&"video"!=s.tagName.toLowerCase()&&"iframe"!=s.tagName.toLowerCase()||lmseditor.resizeElement(t.zeEditor,e.target)},getEditorContainer:function(e){var t='<div _rel="editor_cont" class="zp-fd-compose edtr_rply '+(e.isToolbarTop?'tlbarTop"':'"')+'><div class="zp-fd-composeCont"><div class="composeDesc-Cont"><div class="composeDesc-Wrap" id="editor"'+(e.editorHeight?' style="height:'+e.editorHeight:"")+'"></div></div></div>';return e.enableSubmit&&e.submitCallback&&(t+='<div class="zp-editor-foot"><div class="editor-foot-col"></div><div class="editor-foot-col"><div class="editor-post-bt"><div class="btn_filled btn-loading"><button class="btn_filled btn-loading" _rel="submit">'+ZPI18N.getString("zp.submit")+"</button></div></div></div></div>"),e.elem.querySelector("[_rel=editor_container]").innerHTML=t,e.elem.querySelector("[id=editor]")},getZEEditor:function(e,t){var s,r={id:e,mode:"richtext",allowTagsInsertHTML:["video"],avoidMoreOption:!0};let l=t.enableInsertField&&lmsdocument.createInsertFieldButton();ZE_Init.init([t.enableInsertField?[["custom_opt1","",l,lmseditor.showMenuForInsertField]]:"",[["bold",ZPI18N.getString("zp.bold"),"zei-bold"],["italic",ZPI18N.getString("zp.italic"),"zei-italic"],["underline",ZPI18N.getString("zp.underline"),"zei-underline"],["strikethrough",ZPI18N.getString("zp.strikethrough"),"zei-strike"]],t.enableFontFamily?[["fontfamily",ZPI18N.getString("zp.font"),"zei-fontfamily"]]:"",t.enableFontSize?[["fontsize",ZPI18N.getString("zp.fontsize"),"zei-arrow"]]:"",[["forecolor",ZPI18N.getString("zp.fontcolor"),"zei-textclr"],["backcolor",ZPI18N.getString("zp.bgclr"),"zei-bgclr"]],[["alignoptions",ZPI18N.getString("zp.fontstyleoptions"),"zei-textleft"],["listoptions",ZPI18N.getString("zp.listoptions"),"zei-unorder"],["indentoptions",ZPI18N.getString("zp.indentoptions"),"zei-outdent"]],t.enableTable?[["tableGrid",ZPI18N.getString("zp.inserttable"),"zei-table"]]:"",t.enableEmbeds?[["custom",ZPI18N.getString("zp.lms.editor.insertImageorVideo"),"IC-lnkimg",lmseditor.showMenuForEmbeds]]:"",t.enableOnlyImageEmbeds?[["custom",ZPI18N.getString("zp.insertimage"),"zei-image",lmseditor.showMenuForEmbeds]]:"",t.enableLink?[["link",ZPI18N.getString("zp.insertlink"),"zei-link"]]:"",t.enableQuote?[["quote",ZPI18N.getString("zp.insertquote"),"zei-quote"]]:"",t.enableRemoveFormatting?[["removeformat",ZPI18N.getString("zp.removeformatting"),"zei-removeformat"]]:"",t.enableHorizontalRule?[["inserthorizontalrule",ZPI18N.getString("zp.inserthorizontalrule"),"zei-line"]]:"",t.enableSmily?[["smiley",ZPI18N.getString("zp.insertsmiley"),"zei-smiley"]]:[]]),ZE_Init.needEditorFocus=null!=t.needEditorFocus?t.needEditorFocus:ZE_Init.needEditorFocus,t.contentChangedCallback&&(r.contentChanged=t.contentChangedCallback),s=ZE.create(r),lmsbase.addClass(s.editordiv,"Othr_edtr"),s.editordiv.id="inlineEditor",t.zeEditor=s,t.zeEditor.afterEditorLoad((function(){t.pastedFiles={imageFiles:[],videoFiles:[],iframeFiles:[]},lmsbase.addListener(t.zeEditor.doc.body,"click",(function(e){lmseditor.clickHandle(e,t)})),lmsbase.addListener(t.zeEditor.doc.body,"paste",(function(e){window.setTimeout(lmseditor.pasteHandle(e,t),1e5)}))}))},pasteHandle:function(e,t){var s=(e.clipboardData||e.dataTransfer).getData("text/html");s=DOMPurify.sanitize(s,{ADD_TAGS:t.zeEditor.initobj.allowTagsInsertHTML||[],ADD_ATTR:t.zeEditor.initobj.allowAttrsInsertHTML||[]});var r=document.createElement("div");for(r.innerHTML=s,imageFiles=r.getElementsByTagName("img"),imgidx=t.pastedFiles.imageFiles.length>0?t.pastedFiles.imageFiles.length:0,videoFiles=r.getElementsByTagName("video"),videoidx=t.pastedFiles.videoFiles.length>0?t.pastedFiles.videoFiles.length:0,iframeFiles=r.getElementsByTagName("iframe"),iframeidx=t.pastedFiles.iframeFiles.length>0?t.pastedFiles.iframeFiles.length:0,i=0;i<imageFiles.length;i++)t.pastedFiles.imageFiles[imgidx]=imageFiles[i],imgidx++;for(i=0;i<videoFiles.length;i++)t.pastedFiles.videoFiles[videoidx]=videoFiles[i],videoidx++;for(i=0;i<iframeFiles.length;i++)t.pastedFiles.iframeFiles[iframeidx]=iframeFiles[i],iframeidx++},handlePastedInlines:function(e,t){imageFiles=e.pastedFiles.imageFiles,videoFiles=e.pastedFiles.videoFiles,iframeFiles=e.pastedFiles.iframeFiles,embedFiles=[],embedUrls=[];for(var s=0;s<imageFiles.length;s++)"embedFile"==imageFiles[s].title&&imageFiles[s].id&&e.zeEditor.doc.body.querySelector('[id="'+imageFiles[s].id+'"]')?embedFiles.push(imageFiles[s].id):"embedUrl"==imageFiles[s].title&&imageFiles[s].id&&e.zeEditor.doc.body.querySelector('[id="'+imageFiles[s].id+'"]')&&embedUrls.push(imageFiles[s].id);for(s=0;s<videoFiles.length;s++)"embedFile"==videoFiles[s].title&&videoFiles[s].id&&e.zeEditor.doc.body.querySelector('[id="'+videoFiles[s].id+'"]')&&embedFiles.push(videoFiles[s].id);for(s=0;s<iframeFiles.length;s++)"embedUrl"==iframeFiles[s].title&&iframeFiles[s].id&&e.zeEditor.doc.body.querySelector('[id="'+iframeFiles[s].id+'"]')&&embedUrls.push(iframeFiles[s].id);embedFiles.length>0||embedUrls.length>0?(params={action:"copyInlineFilesAndUrls",embedContentIds:""!=embedFiles.toString()?embedFiles.toString():void 0,embedUrlIds:""!=embedUrls.toString()?embedUrls.toString():void 0,conreqcsr:csrfToken},$.post("/editorAction.zp",params,(function(s){if("success"==s.status){if(null!=s.embedFiles){embedFiles=s.embedFiles;for(var r=0;r<embedFiles.length;r++)e.zeEditor.doc.body.querySelector('[id="'+embedFiles[r].oldId+'"]').id=embedFiles[r].newId}if(null!=s.embedUrls){embedUrls=s.embedUrls;for(r=0;r<embedUrls.length;r++)e.zeEditor.doc.body.querySelector('[id="'+embedUrls[r].oldId+'"]').id=embedUrls[r].newId}lmseditorSave.getEditorContentAndEmbeds(e,t)}}))):lmseditorSave.getEditorContentAndEmbeds(e,t)},showMenuForEmbeds:function(e){var t=e.target,s=t.closest("[_ukey]").getAttribute("_ukey"),r=lmseditormanager.stack[s].editor.rfr,l=r.zeEditor,a=[];r.embedSources&&r.embedSources.enableDeskTop&&a.push({htm:ZPI18N.getString("zp.files.desktop"),datAttr:"local",clk:""}),r.embedSources&&r.embedSources.enableCloud&&a.push({htm:ZPI18N.getString("zp.files.cloud"),datAttr:"cloud",clk:""}),r.embedSources&&r.embedSources.enableUrl&&a.push({htm:ZPI18N.getString("zp.lms.editor.byurl"),datAttr:"url",clk:""});var n={type:"others",list:a};ZE.conDrop(n,l);var i=document.getElementById("ze_dropdown");i.setAttribute("_ukey",t.closest("[_ukey]").getAttribute("_ukey"));var o=t,c=ZE.getPos(o),d=l.toolbarobject.custom;ZE.addClass(d,"ze_dn"),ZE.addClass(d,"ze_Sel"),hideDropDown=function(){i&&(document.body.removeChild(i),ZE.removeClass(d,"ze_dn"),ZE._removeEvent(document,"mousedown",mouse_down),ZE._removeEvent(l.doc,"mousedown",mouse_down),ZE._removeEvent(l.doc,"keydown",mouse_down),ZE._removeEvent(i,"click",ul_click),i.removeAttribute("_ukey"))},mouse_down=function(e){if(i=document.getElementById("ze_dropdown"),e)for(_target=e.target;null!==_target&&_target!==i;_target=_target.parentNode);_target||hideDropDown()},ul_click=function(e){lmseditormanager.clickHandle(e),hideDropDown()},ZE._addEvent(document,"mousedown",mouse_down),ZE._addEvent(l.doc,"mousedown",mouse_down),ZE._addEvent(l.doc,"keydown",mouse_down),ZE._addEvent(i,"click",ul_click);var m=i.style;if(m.left=c.offsetLeft+"px",m.top=c.offsetTop+o.offsetHeight+"px",i.style.display="block",rectObj=document.body.getBoundingClientRect(),dropRectObj=i.getBoundingClientRect(),dropRectObj.height+dropRectObj.top>rectObj.height){var u=dropRectObj.height+dropRectObj.top-rectObj.height;i.firstChild.style.height=dropRectObj.height-u-50+"px"}lmseditor.invokeUploadManager(r)},showMenuForInsertField:function(e){let t=e.target,s=t.closest("[_ukey]").getAttribute("_ukey"),r=lmseditormanager.stack[s].editor.rfr,l=r.zeEditor,a=[],n=r.insertFields;Object.keys(n).forEach((function(e){a.push({htm:n[e],datAttr:e,clk:""})}));let i={type:"others",list:a};ZE.conDrop(i,l);let o=document.getElementById("ze_dropdown");o.setAttribute("_ukey",t.closest("[_ukey]").getAttribute("_ukey"));let c=t,d=ZE.getPos(c),m=l.toolbarobject.custom_opt1;ZE.addClass(m,"ze_dn"),ZE.addClass(m,"ze_Sel"),hideDropDown=function(){o&&(document.body.removeChild(o),ZE.removeClass(m,"ze_dn"),ZE._removeEvent(document,"mousedown",mouse_down),ZE._removeEvent(l.doc,"mousedown",mouse_down),ZE._removeEvent(l.doc,"keydown",mouse_down),ZE._removeEvent(o,"click",ul_click),o.removeAttribute("_ukey"))},mouse_down=function(e){if(o=document.getElementById("ze_dropdown"),e)for(_target=e.target;null!==_target&&_target!==o;_target=_target.parentNode);_target||hideDropDown()},ul_click=function(e){lmseditormanager.clickHandle(e),hideDropDown()},ZE._addEvent(document,"mousedown",mouse_down),ZE._addEvent(l.doc,"mousedown",mouse_down),ZE._addEvent(l.doc,"keydown",mouse_down),ZE._addEvent(o,"click",ul_click);var u=o.style;if(u.left=d.offsetLeft+"px",u.top=d.offsetTop+c.offsetHeight+"px",o.style.display="block",rectObj=document.body.getBoundingClientRect(),dropRectObj=o.getBoundingClientRect(),dropRectObj.height+dropRectObj.top>rectObj.height){var p=dropRectObj.height+dropRectObj.top-rectObj.height;o.firstChild.style.height=dropRectObj.height-p-50+"px"}lmseditor.invokeUploadManager(r)},invokeUploadManager:function(e){var t=document.querySelector('[id="ze_dropdown"]'),s=(new Date).getTime(),r={clickElement:t,moduleName:"lms",multiple:!1,MAXSIZE:1048576e3,SUPPORTED_FILE_EXTENSIONS:"ai,bmp,gif,jpeg,jpg,png,psd,ttf"+(e.enableOnlyImageEmbeds?"":",3g2,3gp,3gpp,avi,flv,m4v,mkv,mov,mp4,mpeg,mpg,ogv,vob,webm,webmv,wmv"),callbackObject:{_uid:s,canParentElementNull:!0},SUPPORTED_SOURCES:lmsfileaction.SOURCE.BOTH,additionalInfo:{submodule:"editor"},ACTION_ATTRIBUTE:"data-others"};r.requiredFileTypes=e.enableOnlyImageEmbeds?"image":"image,video";var l={MAXIMUM_NUMBER_OF_UPLOADS_ALLOWED:1,type:lmsuploadmanager.UPLOADMANAGER_TYPE.INLINELISTINGUPLOADMANAGER,listElement:t};lmseditor.uploadHelperObjects_stk[s]=lmsuploadmanager.initUploadManager(l,new lmsfileaction.upload(r)),lmseditor.uploadHelperObjects_stk[s].attachCallback("onbeforeupload",InlineListingUploadManager.onbeforeupload),lmseditor.uploadHelperObjects_stk[s].attachCallback("onFileStoredSuccessfully",InlineListingUploadManager.onFileStored),lmseditor.uploadHelperObjects_stk[s].attachCallback("onVirusFound",InlineListingUploadManager.onVirusFound),lmseditor.uploadHelperObjects_stk[s].attachCallback("onFileTransferFailure",InlineListingUploadManager.onFileTranserFailure),lmseditor.uploadHelperObjects_stk[s].attachCallback("onAuthorisationFailure",InlineListingUploadManager.onAuthorisationFailure),lmseditor.uploadHelperObjects_stk[s].attachCallback("onUploadsStart",lmseditor.onUploadsStart),lmseditor.uploadHelperObjects_stk[s].bind()},onUploadsStart:function(){var e=document.querySelector("[_rel=editor_container]"),t=document.createElement("div");t.className="zp-fd-mskcvr",t.setAttribute("_rel","loadbar"),t.innerHTML='<div><div class="ctable"><div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div></div></div>',lmsbase.removeClass(e.querySelector(".ze_Sel"),"ze_Sel"),e.querySelector("[_rel=editor_cont]").appendChild(t)},onFileUploadFailure:function(){document.querySelector("[_rel=loadbar]")&&document.querySelector("[_rel=loadbar]").parentElement.removeChild(document.querySelector("[_rel=loadbar]"))},isEmpty:function(e){var t=e.doc.body.querySelectorAll("[contentId]"),s=e.doc.body.querySelectorAll("[embedUrlId]"),r=ZPFeeds.getSmileysAndMentions(e.getContent(),ZPeople.isSearchAllowed);r=ZPFeeds.removeTrailingEmptyDivs(r);var l=ZPFeeds.getTextContent(r);return 0===(l=l.trim()).length&&0===$("<div>").append(r).find("img").length&&0==t.length&&0==s.length},embedInEditor:function(e){refer=lmseditor.rfr_popup.refer,editor=refer.zeEditor,(t=e.embedTag).style.display="none",e.contentId?t.setAttribute("title","embedFile"):t.setAttribute("title","embedUrl"),e.contentId?t.setAttribute("id",e.contentId):t.setAttribute("id",e.embedUrlId),lmseditor.isEmpty(editor)?editor.insertHTML(t.outerHTML):editor.pasteHTML(t.outerHTML);var t=e.contentId?editor.doc.querySelector('[id="'+e.contentId+'"]'):editor.doc.querySelector('[id="'+e.embedUrlId+'"]'),s=editor.editordiv.offsetWidth,r=parseInt(s*(1/3));r<400&&(r=400),"img"==t.tagName.toLowerCase()||"iframe"==t.tagName.toLowerCase()?t.onload=function(){lmseditor.resizeElementOnInsert(this,t.tagName.toLowerCase(),r);refer.elem.querySelector("[_rel=loadbar]")&&refer.elem.querySelector("[_rel=loadbar]").parentElement.removeChild(refer.elem.querySelector("[_rel=loadbar]")),t.style.display="",ZPFeeds.Editor.addRemovePlaceholder(editor,!1,!0,!1)}:"video"==t.tagName.toLowerCase()&&(t.onloadedmetadata=function(){lmseditor.resizeElementOnInsert(this,t.tagName.toLowerCase(),r);refer.elem.querySelector("[_rel=loadbar]")&&refer.elem.querySelector("[_rel=loadbar]").parentElement.removeChild(refer.elem.querySelector("[_rel=loadbar]")),t.style.display="",ZPFeeds.Editor.addRemovePlaceholder(editor,!1,!0,!1)})},resizeElementOnInsert:function(e,t,s,r){var l,a=e.videoHeight||e.width||e.naturalWidth,n=e.videoHeight||e.height||e.naturalHeight;return l=1,a<s&&"video"==t&&(n=a*(9/16)),a="100%"==a?s:a,n="100%"==n?r:n,s&&a>s&&(a/=l=a/s,"video"==t?n=a*(9/16):n/=l),r&&n>r&&(a/=l=n/r,n/=l),e.width=parseFloat(a).toFixed(0),e.height=parseFloat(n).toFixed(0),{width:parseFloat(a).toFixed(0),height:parseFloat(n).toFixed(0)}},embedFilesAndUrls:function(e,t,s,r){if(e.length>0)for(var l=0;l<e.length;l++){var a=e[l].getAttribute("id"),n="",i="";r.embedFiles&&r.embedFiles[a]?(n=lmsfileaction.generateSourceURL(r.embedFiles[a]),i="embedFile"):r.embedUrls&&r.embedUrls[a]&&(n=r.embedUrls[a].url,i="embedUrl"),embedTag=document.createElement("img"),embedTag.src=n,embedTag.setAttribute("id",a),embedTag.setAttribute("title",i),embedTag.width=e[l].getAttribute("width"),embedTag.height=e[l].getAttribute("height"),e[l].parentNode.replaceChild(embedTag,e[l])}if(t.length>0)for(l=0;l<t.length;l++)a=t[l].getAttribute("id"),embedTag=document.createElement("video"),embedTag.src=lmsfileaction.generateSourceURL(r.embedFiles[a]),embedTag.setAttribute("controls","true"),embedTag.setAttribute("id",a),embedTag.setAttribute("title","embedFile"),embedTag.width=t[l].getAttribute("width"),embedTag.height=t[l].getAttribute("height"),t[l].parentNode.replaceChild(embedTag,t[l]);if(s.length>0)for(l=0;l<s.length;l++){a=s[l].getAttribute("id"),embedTag=document.createElement("iframe");var o=document.createElement("div");o.innerHTML=r.embedUrls[a].url,n=o.querySelector("iframe").getAttribute("src"),embedTag.src=n,embedTag.setAttribute("id",a),embedTag.setAttribute("title","embedUrl"),embedTag.width=s[l].getAttribute("width"),embedTag.height=s[l].getAttribute("height"),s[l].parentNode.replaceChild(embedTag,s[l])}},setContentInEditor:function(e,t,s){var r=e.embeds,l=document.createElement("div");if(l.innerHTML=e.content,!s){var a=l.querySelectorAll("inlineimg"),n=l.querySelectorAll("inlinevideo"),i=l.querySelectorAll("embedvideo");lmseditor.embedFilesAndUrls(a,n,i,r)}t.zeEditor.doc?(t.zeEditor.setContent(l.innerHTML),lmseditor.validateContent(t.zeEditor.doc,1)):(content=lmseditor.validateGivenContent(l.innerHTML),t.zeEditor.setContent(content))},getUrlForm:function(){return lmseditor.rfr_popup.elem&&lmsbase.addClass(lmseditor.rfr_popup.elem.querySelector("[_rel=save]"),"disabled"),'<form><table class="ze_ptble"><tbody><tr><td>'+ZPI18N.getString("zp.lms.editor.url")+' </td><td><input _rel="text" type="text"></td></tr></tbody></table><p _rel="errMsg" class="ze_iiSnF"></p></form>'},getUrlPopup:function(){refer=lmseditor.rfr_popup.refer;var e=document.createElement("div");e.className="zep_PU zp_traPU",ZE.showOverlay(),e.innerHTML='<div class="zep_PUtt">'+ZPI18N.getString("zp.insertlink")+'<i _rel="close" class="zei-close"></i></div><div class="zep_PUcen" _rel="cont">'+lmseditor.getUrlForm()+'</div><div class="zep_PUbtm"><span _rel="cancel">'+ZPI18N.getString("zp.cancel")+'</span><span class="sel disabled" _rel="save">'+ZPI18N.getString("zp.insert")+"</span></div>",document.body.appendChild(e),lmseditor.rfr_popup.elem=e,ZE.setPosition(e,refer.elem),lmsbase.addListener(e,"click",lmseditor.popupClickHandle),lmsbase.addListener(e,"keydown",lmseditor.popupEscKey),lmsbase.addListener(e,"keyup",lmseditor.popupKeyupHandle)},popupKeyupHandle:function(e){lmseditor.hidePopupErrorMsg(),clearTimeout(lmseditor.rfr_popup.urlTimeout),lmseditor.rfr_popup.urlTimeout=setTimeout(lmseditor.fetchUrl,1e3,e)},popupClickHandle:function(e){var t=e.target.getAttribute("_rel");"save"==t?lmseditor.saveAndEmbedUrl():"cancel"==t?lmseditor.rfr_popup.embedTag?lmseditor.closePreview():lmseditor.closePopup():"close"==t&&lmseditor.closePopup()},popupEscKey:function(e){27==e.keyCode&&lmseditor.closePopup()},saveAndEmbedUrl:function(){if(rfr_popup=lmseditor.rfr_popup,lmseditor.rfr_popup.isFirstFetch)if(lmseditor.rfr_popup.isFirstFetch=!1,rfr_popup.url){var e={action:"addUrl",type:rfr_popup.embedType,domain:null!=rfr_popup.domain?rfr_popup.domain:void 0,url:rfr_popup.url,conreqcsr:csrfToken};$.post("/editorAction.zp",e,(function(e){"success"==e.status&&lmseditor.embedInEditor({embedTag:rfr_popup.embedTag,embedUrlId:e.embedUrlId}),lmseditor.closePopup()}))}else lmseditor.showPopupErrorMsg()},openPreview:function(){lmseditor.rfr_popup.isFirstFetch=!0,lmseditor.rfr_popup.elem.querySelector("[_rel=cont]").innerHTML='<div class="zp_tac">'+lmseditor.rfr_popup.embedTag.outerHTML+"</div>",(lmseditor.rfr_popup.elem.querySelector("[_rel=cont]").querySelector("img")||lmseditor.rfr_popup.elem.querySelector("[_rel=cont]").querySelector("iframe")).onload=function(){lmseditor.resizeElementOnInsert(this,580,500);lmsbase.removeClass(lmseditor.rfr_popup.elem.querySelector("[_rel=save]"),"disabled")}},closePreview:function(){lmseditor.rfr_popup.elem.querySelector("[_rel=cont]").innerHTML=lmseditor.getUrlForm(),lmseditor.rfr_popup.url=null,lmseditor.rfr_popup.embedTag=null,lmseditor.rfr_popup.domain=null,lmseditor.rfr_popup.embedType=null,lmseditor.rfr_popup.isFirstFetch=!1},disableSave:function(){rfr_popup=lmseditor.rfr_popup,rfr_popup.elem.querySelector("[_rel=save]").style.opacity=.5},enableSave:function(){rfr_popup=lmseditor.rfr_popup,rfr_popup.elem.querySelector("[_rel=save]").style.opacity=1},showPopupErrorMsg:function(){rfr_popup=lmseditor.rfr_popup,rfr_popup.elem.querySelector("[_rel=errMsg]").innerHTML='<span class="ze_popuperrmsg">'+ZPI18N.getString("zp.lms.editor.enterValidUrl")+"</span>"},hidePopupErrorMsg:function(){rfr_popup=lmseditor.rfr_popup,rfr_popup.elem.querySelector("[_rel=errMsg]").innerHTML=""},updateReferPopup:function(e,t){if(e[1]&&"success"===e[1].message){var s=document.createElement("div");s.innerHTML=e[1].html;var r=s.querySelector("iframe").getAttribute("src"),l=document.createElement("iframe");l.src=r,l.width=s.querySelector("iframe").getAttribute("width"),l.height=s.querySelector("iframe").getAttribute("height"),lmseditor.rfr_popup.embedType=1,lmseditor.rfr_popup.domain=t.mode,lmseditor.rfr_popup.url=t.link,lmseditor.rfr_popup.embedTag=l,lmseditor.openPreview()}else lmseditor.showPopupErrorMsg()},fetchUrl:function(e){var t=e.target.closest("[_rel=text]").parentNode.querySelector("[_rel=text]").value;if(""!=t)if(t.length>2048)lmseditor.showPopupErrorMsg();else{var s=document.createElement("img");s.src=t,s.onload=function(){s.style="max-height:500px;max-width: 580px;",lmseditor.rfr_popup.embedType=0,lmseditor.rfr_popup.embedTag=s,lmseditor.rfr_popup.url=t,lmseditor.openPreview()},s.onerror=function(){(s="",t.includes("soundcloud"))?lmseditor.showPopupErrorMsg():"Invalid"==lmscontent.fetchUrl(t,1,lmseditor.updateReferPopup)&&lmseditor.showPopupErrorMsg()}}},closePopup:function(){ZE.hideOverlay(),lmsbase.removeListener(lmseditor.rfr_popup.elem,"click",lmseditor.popupClickHandle),lmsbase.removeListener(lmseditor.rfr_popup.elem,"keydown",lmseditor.popupEscKey),lmsbase.removeListener(lmseditor.rfr_popup.elem,"keyup",lmseditor.popupKeyupHandle),document.body.removeChild(lmseditor.rfr_popup.elem),lmseditor.rfr_popup={elem:null,refer:null,url:null,embedTag:null,domain:null,embedType:null}},resizeElement:function(e,t){var s,r,l,a,n,i=document,o=(ZE.i18n,!1),c=e.doc,d=t,m=function(e){return parseFloat(e.style.height)},u=function(e){return parseFloat(e.style.width)},p=function(e){return parseFloat(e.style.top)},g=function(e){return parseFloat(e.style.left)},f=function(e,t){e.style.top=t+"px"},v=function(e,t){e.style.left=t+"px"},h=function(){return u(s)>18};s=c.createElement("div"),c.body.appendChild(s),s.className="enc";var b=(l=d.getBoundingClientRect()).left,I=l.top;e.win.scrollX?s.style.left=b+e.win.scrollX+"px":s.style.left=b+e.win.pageXOffset+"px",e.win.scrollY?s.style.top=l.top+e.win.scrollY+"px":s.style.top=l.top+e.win.pageYOffset+"px",s.style.height=l.height+"px",s.style.width=l.width+"px",e.win.scrollY?I+=e.win.scrollY:I+=e.win.pageYOffset,e.win.scrollX?b+=e.win.scrollX:b+=e.win.pageXOffset;var y=c.createElement("div");y.className="smallDiv",c.body.appendChild(y),y.style.top=I+"px",y.style.left=b+"px",y.style.cursor="nw-resize";var _=c.createElement("div");_.className="smallDiv",c.body.appendChild(_),_.style.top=I+"px",_.style.left=b+l.width-9+"px",_.style.cursor="ne-resize";var S=c.createElement("div");S.className="smallDiv",c.body.appendChild(S),S.style.top=I+l.height-9+"px",S.style.left=b+l.width-9+"px",S.style.cursor="se-resize";var C=c.createElement("div");C.className="smallDiv",c.body.appendChild(C),C.style.top=I+l.height-9+"px",C.style.left=b+"px",C.style.cursor="sw-resize";var P=function(e){var t,s=c.getElementById("ze_imgBlock");if(e)for(t=e.target;null!==t&&(t!==s&&t!==y&&t!==_&&t!==S&&t!==C&&t!==d);t=t.parentNode);t||N()},z=function(e){46===e.keyCode?removeImage():N()},N=function(){var e=c.getElementById("ze_imgBlock");e&&c.body.removeChild(e),ZE._removeEvent(c,"mousedown",P),ZE._removeEvent(i,"mousedown",P),ZE._removeEvent(c,"keydown",z),y&&(y.parentElement.removeChild(y),_.parentElement.removeChild(_),S.parentElement.removeChild(S),C.parentElement.removeChild(C),s.parentElement.removeChild(s))},T=function(t){r=this,o=!0,e._stopEvent(t),a=t.clientX,t.clientY,ZE._removeEvent(c,"mousedown",P),ZE._removeEvent(i,"mousedown",P),ZE._removeEvent(c,"keydown",z),ZE._addEvent(c,"mousemove",L),ZE._addEvent(c,"mouseup",k)},w=function(){o=!1,n(),d.height=parseFloat(s.style.height).toFixed(0),d.width=parseFloat(s.style.width).toFixed(0),d.style.width&&(d.style.width=""),d.style.height&&(d.style.height=""),ZE._removeEvent(y,"mousedown",T),ZE._removeEvent(_,"mousedown",T),ZE._removeEvent(S,"mousedown",T),ZE._removeEvent(C,"mousedown",T),y.parentElement.removeChild(y),_.parentElement.removeChild(_),S.parentElement.removeChild(S),C.parentElement.removeChild(C),s.parentElement.removeChild(s);var t=c.getElementById("ze_imgBlock");t&&c.body.removeChild(t),e.saveCurrentState()},M=function(t,r){if(o){if(r.clientX<=0||r.clientY<=0||r.clientX>e.editordiv.offsetWidth)return void w();g(s),p(s);var l,n,i,c,d,b,I,P,z=m(s),N=u(s);t===_?(l=0,n=0):t===S?(l=0,n=1):t===C?(l=1,n=0):(l=1,n=1),r.clientX<a?(i=a-r.clientX,0===l?h()&&(N/=c=N/(N-i),d=z-z/c,z/=c,ZE.setCss(s,"height",z+"px"),ZE.setCss(s,"width",N+"px"),0===n&&f(s,p(s)+d)):(b=N-N/(c=(N+i)/N),N+=N-N/c,I=z-z/c,z+=z-z/c,ZE.setCss(s,"height",z+"px"),ZE.setCss(s,"width",N+"px"),P=g(s),p(s),v(s,P-b),1===n&&f(s,p(s)-I))):(i=r.clientX-a,0===l?(N+=N-N/(c=(N+i)/N),z+=d=z-z/c,ZE.setCss(s,"height",z+"px"),ZE.setCss(s,"width",N+"px"),0===n&&f(s,p(s)-d)):h()&&(b=N-N/(c=N/(N-i)),N/=c,I=z-z/c,z/=c,ZE.setCss(s,"height",z+"px"),ZE.setCss(s,"width",N+"px"),P=g(s),v(s,P+b),1===n&&f(s,p(s)+I))),y.style.left=s.style.left,y.style.top=s.style.top,v(_,u(s)+g(s)-9),_.style.top=s.style.top,S.style.left=s.style.left,f(S,m(s)+p(s)-9),v(C,u(s)+g(s)-9),f(C,m(s)+p(s)-9),a=r.clientX,r.clientY}},L=function(e){M(r,e)},k=function(t){e._stopEvent(t),w()};n=function(){ZE._removeEvent(c,"mousemove",L),ZE._removeEvent(c,"mouseup",k)},ZE._addEvent(c,"mousedown",P),ZE._addEvent(i,"mousedown",P),ZE._addEvent(c,"keydown",z),ZE._addEvent(y,"mousedown",T),ZE._addEvent(_,"mousedown",T),ZE._addEvent(S,"mousedown",T),ZE._addEvent(C,"mousedown",T)},disableDownloadOptionOfInlineFiles:function(e,t){var s=t?e:e.contentDocument||e.contentWindow.document,r=s.querySelectorAll("img");if(null!=r&&r.length>0)for(i=0;i<r.length;i++)r[i].oncontextmenu=a;var l=s.querySelectorAll("video");if(null!=l&&l.length>0)for(i=0;i<l.length;i++)l[i].oncontextmenu=a;function a(){return!1}},getSmileys:function(e,t){ZPLoader.PATH.CSS?cssurl=ZPeople.getResourceURL(ZPLoader.PATH.CSS+"zp_css_2.css"):cssurl="/newhr/css/zpglobal.css";var s=document.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=cssurl;var r=t?e:e.contentDocument||e.contentWindow.document;return content=r.querySelector("body").innerHTML,null!=content.match(/:\b(smilenew|lol|sad|angry|tongueout|winknew|meh|shocked|worried|sleepy|lipssealed|neutral|like|dislike|claps|searching|tensed|dizzy|coolnew|yummy|idea|injured|sick|anxious|doubtful|tearofjoy|halo|grin|loveit|curious|thinking|relaxed|yuck|blush|upset|stressed|tired|bored|jealous|evil|facepalm|surprise|headache|namaste|super|birthday|feelingwarm|feelingcold|ontarget)\b:/gi)&&(r.head.appendChild(s),content=ZPFeeds.Activity.getSmileys(content),r.querySelector("body").innerHTML=content),content},validateContent:function(e,t){return content=lmseditor.getSmileys(e,t),lmseditor.disableDownloadOptionOfInlineFiles(e,t),content},validateGivenContent:function(e){return ZPFeeds.Activity.getSmileys(e)}},lmseditorSave={saveContent:function(e,t,s){e.getEditorContent((function(e){"add"==s.mode?lmseditorSave.createFile(e,t,s):"edit"==s.mode&&s.contentId&&lmseditorSave.editFile(e,t,s)}))},editFile:function(e,t,s){if(e){content=e.content,embedIds=e.embedIds;var r={action:"editFile",fileName:s.fileName,contentId:s.contentId,content,embedContentIds:embedIds.embedContentIds?embedIds.embedContentIds:void 0,embedUrlIds:embedIds.embedUrlIds?embedIds.embedUrlIds:void 0,type:t.type,conreqcsr:csrfToken};$.post("/editorAction.zp",r,(function(e){"success"==e.status&&s.callback(e,s)}))}},createFile:function(e,t,s){if(e){content=e.content,embedIds=e.embedIds;var r={action:"createFile",fileName:t.fileName||s.fileName,content,embedContentIds:embedIds.embedContentIds?embedIds.embedContentIds:void 0,embedUrlIds:embedIds.embedUrlIds?embedIds.embedUrlIds:void 0,type:t.type,additionalParams:JSON.stringify(t.additionalParams),conreqcsr:csrfToken};$.post("/editorAction.zp",r,(function(e){"success"==e.status&&s.callback(e,s)}))}},getEditorContent:function(e,t){lmseditor.handlePastedInlines(e,t)},getEditorContentAndEmbeds:function(e,t){var s=e.zeEditor.getContent(),r=ZPFeeds.getSmileysAndMentions(e.zeEditor.getContent(),ZPeople.isSearchAllowed);r=ZPFeeds.removeTrailingEmptyDivs(r);var l=ZPFeeds.getTextContent(r);l=l.trim(),sampleDiv=document.createElement("div"),sampleDiv.innerHTML=r;var a=lmseditorSave.getEmbedsInfo(sampleDiv);if(r=a.content,embedIds=a.embedIds,0===l.length&&0===$("<div>").append(r).find("img").length&&0==embedIds.embedContentIds.length&&0==embedIds.embedUrlIds.length)return e.zeEditor.setContent(""),void t(void 0);resObj={originalContent:s,content:r,embedIds},t(resObj)},getEmbedsInfo:function(e){var t=e.querySelectorAll("[title=embedFile]"),s=e.querySelectorAll("[title=embedUrl]"),r=[],l=[];if(t)for(var a=0;a<t.length;a++){r.push(t[a].getAttribute("id"));var n="";"img"==t[a].tagName.toLowerCase()?n=document.createElement("inlineimg"):"video"==t[a].tagName.toLowerCase()&&(n=document.createElement("inlinevideo")),n.id=t[a].getAttribute("id"),n.setAttribute("width",t[a].width),n.setAttribute("height",t[a].height),t[a].parentNode.replaceChild(n,t[a])}if(s)for(a=0;a<s.length;a++){l.push(s[a].getAttribute("id"));n="";"img"==s[a].tagName.toLowerCase()?n=document.createElement("inlineimg"):"iframe"==s[a].tagName.toLowerCase()&&(n=document.createElement("embedvideo")),n.id=s[a].getAttribute("id"),n.setAttribute("width",s[a].width),n.setAttribute("height",s[a].height),s[a].parentNode.replaceChild(n,s[a])}var i={embedContentIds:r.toString(),embedUrlIds:l.toString()};return{content:e.innerHTML,embedIds:i}}},lmsfetchFile={fetchFile:function(e,t,s){var r={action:"getFile",contentId:e.contentId,isReplaceEmbedsInFile:e.isReplaceEmbedsInFile,type:t.type,mode:"edit"==s?"edit":"view"};$.get("/editorAction.zp",r,(function(s){"success"==s.status&&(e.callback?e.callback(s.contentInfo,t,e.isReplaceEmbedsInFile):(e.fetchAsFile?callback=lmsfetchFile.fetchFileInElem:callback=lmsfetchFile.fetchContentInElem,callback(s.contentInfo,e.elem,e.isReplaceEmbedsInFile)))}))},fetchFileInElem:function(e,t,s){contentId=e.fileInfo.contentId;var r="editorAction.zp?action=viewFile&contentId="+contentId;t.innerHTML='<div _rel="editor_content" contentId='+contentId+'><iframe id="iframe" style="height:100%; width:100%" src='+r+"></div>",s||(t.querySelector("[id=iframe]").onload=function(){var s=t.querySelector("[id=iframe]").contentDocument||t.querySelector("[id=iframe]").contentWindow.document,r=s.body.querySelectorAll("inlineimg"),l=s.body.querySelectorAll("inlinevideo"),a=s.body.querySelectorAll("embedvideo");lmseditor.embedFilesAndUrls(r,l,a,e.embeds)})},fetchContentInElem:function(e,t,s){if(t.innerHTML='<div _rel="editor_content" contentId='+e.fileInfo.contentId+">"+e.content+"</div>",!s){var r=t.querySelector('[contentId="'+e.fileInfo.contentId+'"]'),l=r.body.querySelectorAll("inlineimg"),a=r.body.querySelectorAll("inlinevideo"),n=r.body.querySelectorAll("embedvideo");lmseditor.embedFilesAndUrls(l,a,n,e.embeds)}},generateSourceUrl:function(e){return e.additionalInfo=e.additionalInfo||{fileId:e.contentId,type:0},"editorAction.zp?action=viewFile&fileId="+e.additionalInfo.fileId+"&type="+e.additionalInfo.type},fetchEmbedsInElem:function(e,t){var s=e.body.querySelectorAll("inlineimg"),r=e.body.querySelectorAll("inlinevideo"),l=e.body.querySelectorAll("embedvideo");lmseditor.embedFilesAndUrls(s,r,l,t)}},DeleteFile={deleteFile:function(e){var t={action:"deleteFile",contentId:e.contentId,conreqcsr:csrfToken};$.post("/editorAction.zp",t,e.callback(resObj))}},ZPDatePicker={stack:{},count:0,template:{_HTML:'<div><div><i class="#py#" rel="PY"></i><i class="#pm#" rel="PM"></i><span>#HEADM# #HEADY#</span><i class="#nm#" rel="NM"></i><i class="#ny#" rel="NY"></i></div></div><div><div class="zp_wek">#wk<p#hgt#>#item#</p>wk#</div></div><div rel="DT" class="zp_dat">#dr<div>#dc<#tag#>#item#</#tag#>dc#</div>dr#</div>',_cont:{tag:"DIV",_class:"zp_calen"},_class:{sel:"i",selhgt:"p",hglt:"font",dis:"em",nor:"p"},_cust:{dysel:"zcal_sl",py:"IC-argt2",pm:"IC-alft",nm:"IC-argt",ny:"IC-alft2"}},initiate:function(e){var t=new ZCALdatepickr(e);return this.stack[t._cont]=t,t}},ZCALdatepickr=function(e){if(e=e||{},this._dform=e.dform,this._wkst=e.wkst&&/^[0-7]$/g.test(e.wkst)?e.wkst:0,this._tar="object"==typeof e.target?e.target:document.getElementById(e.target),this._select=e.select||[],this._monchge=[],this._yrchge=[],this._dtclk=[],this._curDate=e.curdate||(e.today?"range"==e.type?e.today.split(" - ")[0].parseDate(this._dform):e.today.parseDate(this._dform):new Date),"range"==e.type){var t=e.today.split(" - ");a1=t[0].parseDate(this._dform),a2=t[1]?t[1].parseDate(this._dform):a1,this._rangeStr=[a1,a2]}return this._cont=e._cont||(new Date).getTime()+"_"+ZPDatePicker.count++,this._tz=e.timezone||"",this._type=e.type||"date",this._sdate=null,this._edate=null,"range"!=e.type&&(e.range&&"[object String]"==Object.prototype.toString.call(e.range[0])?(this._sdate=e.range[0].parseDate(this._dform)||new Date(1947,8,15),this._edate=e.range[1].parseDate(this._dform)||new Date(2247,8,15)):e.range&&"[object Date]"==Object.prototype.toString.call(e.range[0])&&(this._sdate=e.range[0]||new Date(1947,8,15),this._edate=e.range[1]||new Date(2247,8,15))),e.refer?this._refer="object"==typeof e.refer?e.refer:document.getElementById(e.refer):this._tar&&(this._refer="input"==this._tar.tagName.toLowerCase()?this._tar:this._tar.getElementsByTagName("input")[0]),this};ZCALdatepickr.prototype.on=function(e,t){return"monthchge"==e&&"function"==typeof t?this._monchge.push(t):"yearchge"==e&&"function"==typeof t?this._yrchge.push(t):"dateclick"==e&&"function"==typeof t&&this._dtclk.push(t),this},ZCALdatepickr.prototype.updateselect=function(e){return this._r1||(this._select=e||this._select,document.getElementById(this._cont).innerHTML=this.calendar()),this},ZCALdatepickr.prototype.bind=function(){var e=this,t=ZPDatePicker.template._cont,s=document.createElement(t.tag);s.id=e._cont,s.className=t._class,s.style.height="272px";e.clearobj=function(){if(document.getElementById(e._cont)){ZCALremoveListener(s,"mousedown",l),ZCALremoveListener(s,"selectstart",ZCALprevDef),ZCALremoveListener(s,"dragstart",ZCALprevDef);s.parentNode.removeChild(s);null,"range"==this._type&&ZCALremoveListener(s,"mousemove",e.rgeSelect)}},e.clearvar=function(){e=s=t=null},e.changeSelection=function(t){e._rangeStr=t,document.getElementById(e._cont).innerHTML=e.calendar()},e.rgeSelect=function(t){new Array;_elem=t.target;var s=_elem.tagName.toLowerCase(),r=_elem.parentNode.parentNode.getAttribute("rel"),l=e._rangeStr;if("div"!=s&&"em"!=s&&r&&"DT"==r&&-1!=l[0]&&-1==l[1]){var a=new Date(e._curDate);a.setDate(parseInt(_elem.innerHTML,10)),e.tmprange=l[0]>a?[a,l[0]]:[l[0],a],document.getElementById(e._cont).innerHTML=e.calendar()}};var r=function(t,s,r){return"range"==e._type?{getDates:function(){return e._rangeStr}}:0==r?{getDates:function(){return[s,t]}}:{getDate:function(){return t}}},l=function(t){var l=(t=t||event).target||t.srcElement,a=l.getAttribute("rel"),n=l.parentNode.getAttribute("rel"),i=[],o=0,c=!0,d=new Date(e._curDate);if("em"==l.tagName.toLowerCase()||l.className.indexOf("zp_op5")>-1)return ZCALprevDef(t),!1;if("PY"==a||"PY"==n)i=e._yrchge,d.setYear(d.getFullYear()-1);else if("NY"==a||"NY"==n)i=e._yrchge,d.setYear(d.getFullYear()+1);else if("PM"==a||"PM"==n)i=e._monchge,d=ZCALchangeMonth(d,-1);else if("NM"==a||"NM"==n)d=ZCALchangeMonth(d,1),i=e._monchge;else if("DT"==l.parentNode.parentNode.getAttribute("rel")){o=1,i=e._dtclk;var m=parseInt(l.innerHTML,10);if(m){if(d.setMonth(d.getMonth()+("u"==l.tagName.toLowerCase()?m<15?1:-1:0)),d.setDate(m),"range"==e._type)if(o=0,-1==e._rangeStr[0]||-1!=e._rangeStr[1])e._rangeStr=[d,-1];else{var u=e._rangeStr[0];e._rangeStr[0]>d?e._rangeStr=[d,u]:e._rangeStr=[u,d]}}else c=!1}if(0==o){for(e._curDate=d;s.firstChild;)s.removeChild(s.firstChild);s.innerHTML=e.calendar("")}if(c)for(var p in i)i[p].call(r(d,e._curDate,o));ZCALprevDef(t)};return e._tar.appendChild(s),s.innerHTML=e.calendar(),ZCALaddListener(s,"mousedown",l),ZCALaddListener(s,"selectstart",ZCALprevDef),ZCALaddListener(s,"dragstart",ZCALprevDef),"range"==this._type&&ZCALaddListener(s,"mousemove",e.rgeSelect),this},ZCALdatepickr.prototype.changeDate=function(e){var t=document.getElementById(this._cont);for(this._curDate=e?e.parseDate(this._dform):this._curDate;t.firstChild;)t.removeChild(t.firstChild);return t.innerHTML=this.calendar(""),!0},ZCALdatepickr.prototype.calendar=function(e){var t=ZPDatePicker.template,s=t._HTML,r=(t._class,t._cust),l=s.indexOf("#wk"),a=s.indexOf("wk#"),n=s.indexOf("#dr"),i=s.indexOf("dr#"),o=s.substring(0,l).replace("#HEAD#",this._curDate.getDateBy("MMMM YYYY")).replace("#HEADM#",this._curDate.getDateBy("MMMM")).replace("#HEADY#",this._curDate.getDateBy("YYYY"));if(this._sdate&&this._edate){var c=this._sdate.getFullYear(),d=this._sdate.getMonth(),m=this._edate.getFullYear(),u=this._edate.getMonth(),p=this._curDate.getFullYear(),g=this._curDate.getMonth(),f=this._curDate.getDate();o=o.replace("#py#",r.py+(new Date(p-1,g,f)>=this._sdate?"":" zp_op5")).replace("#ny#",r.ny+(new Date(p+1,g,f)<=this._edate?"":" zp_op5")).replace("#pm#",r.pm+(new Date(p,g,1)>new Date(c,d,1)?"":" zp_op5")).replace("#nm#",r.nm+(new Date(p,g,1)<new Date(m,u,1)?"":" zp_op5"))}else o=o.replace("#py#",r.py).replace("#ny#",r.ny).replace("#pm#",r.pm).replace("#nm#",r.nm);return o+=this.weekrow(s.substring(l+3,a)),o+=s.substring(a+3,n),o+=this.daterow(s.substring(n+3,i)),o+=s.substring(i+3,s.length).replace("#tz#",this._tz)},ZCALdatepickr.prototype.weekrow=function(e){for(var t=new Date(this._curDate).getDay(),s=this._wkst,r=ZPDatePicker.template,l=0,a="";l<7;)a+=e.replace("#item#",Date.WEEKS_DAYS[2][s]).replace("#hgt#",s==t&&r._cust?" class="+r._cust.dysel:""),s=s<6?s+1:0,l++;return a},ZCALdatepickr.prototype.daterow=function(e){var t=e.indexOf("#dc"),s=e.indexOf("dc#"),r=e.substring(t+3,s),l=new Date(this._curDate),a=l.getDate(),n=l.getMonth(),i=l.getDaysOfMonth(),o="",c="",d="",m=",",u="[object Object]"==Object.prototype.toString.call(this._select);if(!u)for(var p=0;p<this._select.length;p++)m+=this._select[p]+",";var g=null,f=null,v=null,h=null;l.setDate(1);var b=l.getDay(),I=b-this._wkst+(b-this._wkst<0?7:0);if(l.setDate(l.getDate()-I),"range"==this._type){var y=this.tmprange?this.tmprange:this._rangeStr;g=y[0],f=-1==y[1]?y[0]:y[1],v=g.intoDays(),h=f.intoDays()}for(var _=ZPDatePicker.template._class,S=0;S<6;S++){d+=e.substring(0,t);for(var C=0;C<7;C++){o=l.getDate(),c=l.getMonth();var P=_.nor;if(c==n&&!this._sdate&&!this._edate||c==n&&this._sdate&&this._edate&&this._sdate<=l&&this._edate>=l)if((""!=m&&m.indexOf(","+o+",")>-1||u&&this._select.start<=o&&this._select.end>=o)&&(P=_.sel),g){var z=l.intoDays();g.diffTodays(l)>=0&&f.diffTodays(l)<=0&&(P=z==v&&z==h?"font":1==o||z==v?"sup":z==h||o==i?"label":"b")}else a==o&&_.hglt&&(P=P==_.sel?_.selhgt:_.hglt);else P=_.dis;d+=r.replace(/#tag#/g,P).replace("#item#",c==n?o:""),l.setDate(o+1)}d+=e.substring(s+3,e.length)}return this.tmprange=null,d},String.prototype.trim=function(){var e=this;return e=(e=e.replace(/^\s*(.*)/,"$1")).replace(/(.*?)\s*$/,"$1")},String.prototype.parseDate=function(e=dateFormat){var t=function(e,t){for(var s in t)if(e.toLowerCase().trim()==t[s].toLowerCase())return parseInt(s,10)+1;return!1};if(!e||""==e.trim())return!1;if(this&&""==this.trim())return!1;var s=this.match(/(\d+)|([a-zA-Z]+)/g),r=0,l={},a=e.toLowerCase().match(/([a-z]+)/g);if(3!=a.length||3!=s.length)return!1;for(var r in a)"d"==a[r]||"m"==a[r]?a[r]+=a[r]:"mmm"==a[r]?(s[r]=t(s[r],Date.MONTH_NAMES[1]),a[r]="mm"):"mmmm"==a[r]?(s[r]=t(s[r],Date.MONTH_NAMES[0]),a[r]="mm"):"yy"==a[r]&&(s[r]=s[r]>=70?1900+parseInt(s[r],10):2e3+parseInt(s[r],10),a[r]="yyyy"),l[a[r]]=s[r];return new Date(l.yyyy,l.mm-1,l.dd)},Date.prototype.diffTodays=function(e){return e=e||new Date,parseInt((e.getTime()-this.getTime())/864e5,10)},Date.prototype.intoDays=function(){return parseInt(this.getTime()/864e5,10)},Date.MONTH_NAMES=new Array(["January","February","March","April","May","June","July","August","September","October","November","December"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),Date.WEEKS_DAYS=new Array(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["S","M","T","W","T","F","S"]),ZCALtform=["am","pm"],Date.prototype.getDaysOfMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()};var ZCALaddListener=document.addEventListener?function(e,t,s,r){e.addEventListener(t,s,Boolean(r))}:function(e,t,s){e.attachEvent("on"+t,s)},ZCALremoveListener=document.removeEventListener?function(e,t,s,r){e.removeEventListener(t,s,Boolean(r))}:function(e,t,s){e.removeEventListener("on"+t,s)},ZCALprevDef=function(e){(e=e||event).stopPropagation?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1)};ZCALchangeMonth=function(e,t){var s=new Date(e.getFullYear(),e.getMonth()+t,1),r=e.getDate(),l=new Date(s.getFullYear(),s.getMonth()+1,0).getDate();return s.setDate(r<=l?r:l),s};var lmsdashboard={root:null,resizeConfig:{resizeTimer:null,timeInterval:1e3,onresizeCallbacks:[],resizedCallbacks:[]},events:{overall:{click:{elem:null,funcToBeCalled:"clickHandle"},scroll:{elem:null,funcToBeCalled:"scrollHandle"}},sessions:{click:{elem:null,funcToBeCalled:"sessionsClickHandle"},scroll:{elem:null,funcToBeCalled:"sessionsScrollHandle"},resize:{type:"resized",funcToBeCalled:"sessionsResizedHandle"}},activeCourse:{click:{elem:null,funcToBeCalled:"courseBoxesClickHandle"},scroll:{elem:null,funcToBeCalled:"activeCourseScrollHandle"}},topCourses:{click:{elem:null,funcToBeCalled:"courseBoxesClickHandle"}},topTrainers:{click:{elem:null,funcToBeCalled:"trainerBoxesClickHandle"}},learnersChart:{click:{elem:null,funcToBeCalled:"chartClickHandle"}},courseChart:{click:{elem:null,funcToBeCalled:"chartClickHandle"}}},layerData:{activeLearnersCount:0,totalTrainersCount:0,activeCourseCount:0,activeHours:"00.00",totalRoomsCount:0,totalCoursesCount:0,certificationCount:0,completedCoursesCount:0,pendingRequestsCount:0,courseChart:{},learnersChart:{}},layerConstants:{skillset:{colors:{0:"org",1:"blu",2:"grn"}},topCourses:{count:5},topLearners:{count:5},topTrainers:{count:5}},layerVariables:{sessions:{sessionsMode:"both",firstRequestTime:null,rightIndex:1,leftIndex:1,isRightIndexEnd:!1,isRightIndexEnd:!1,nxtSessionUpdater:null},activeCourse:{index:1},courseChart:{range:"1-week",chart:null,nodata:!1},learnersChart:{range:"1-week",chart:null,nodata:!1}},admin:{basicInfo:{subLayers:{quickStats:{entities:["totalTrainersCount","totalCoursesCount","activeLearnersCount","pendingRequestsCount"],requestType:{type:"group",subGroupName:"allStats",groupName:"basicInfo"}}}},moreInfo:{subLayers:{sessions:{requestType:{type:"group",groupName:"moreInfo"}},courseChart:{requestType:{type:"group",subGroupName:"allStats",groupName:"moreInfo"}},learnersChart:{requestType:{type:"group",groupName:"moreInfo"}},pendingRequests:{requestType:{type:"group",groupName:"moreInfo"}},importantFeeds:{requestType:{type:"group",groupName:"moreInfo"}},helpDocsAndVids:{requestType:{type:"group",groupName:"moreInfo"}}}},rightPane:{subLayers:{addCourseButton:{},topCourses:{requestType:{type:"group",groupName:"rightPane"}},topLearners:{requestType:{type:"group",groupName:"rightPane"}},topTrainers:{requestType:{type:"group",groupName:"rightPane"}}}}},learner:{basicInfo:{subLayers:{quickStats:{entities:["activeCourseCount","activeHours","completedCoursesCount","certificationCount","pendingRequestsCount"],requestType:{type:"group",groupName:"basicInfo"}}}},moreInfo:{subLayers:{sessions:{requestType:{type:"group",groupName:"moreInfo"}},importantFeeds:{requestType:{type:"group",groupName:"moreInfo"}},activeCourse:{requestType:{type:"group",groupName:"moreInfo"}},helpDocsAndVids:{requestType:{type:"group",groupName:"moreInfo"}}}},rightPane:{subLayers:{skillset:{requestType:{type:"group",groupName:"rightPane"}},activityFeeds:{requestType:{type:"group",groupName:"rightPane"}}}}},trainer:{basicInfo:{subLayers:{quickStats:{entities:["activeCourseCount","activeHours","completedCoursesCount","certificationCount","pendingRequestsCount"],requestType:{type:"group",groupName:"basicInfo"}}}},moreInfo:{subLayers:{sessions:{requestType:{type:"group",groupName:"moreInfo"}},importantFeeds:{requestType:{type:"group",groupName:"moreInfo"}},activeCourse:{requestType:{type:"group",groupName:"moreInfo"}},helpDocsAndVids:{requestType:{type:"group",groupName:"moreInfo"}}}},rightPane:{subLayers:{addCourseButton:{},skillset:{requestType:{type:"group",groupName:"rightPane"}},activityFeeds:{requestType:{type:"group",groupName:"rightPane"}}}}},requestGroups:{basicInfo:{group:{entityList:[]},subGroups:{},subLayers:[]},moreInfo:{group:{entityList:[]},subGroups:{},subLayers:[]},rightPane:{group:{entityList:[]},subGroups:{},subLayers:[]}},singleRequests:[],initiate:function(){"add"==this.mode&&(lmsdashboard.reInitialise(),lmsdashboard.layoutConstruction(this),lmsdashboard.constructDashBoard(),lmsdashboard.sendSingleRequests(),lmsdashboard.sendGroupRequests())},layoutConstruction:function(e){lmsdashboard.root=e.elem,e.elem.innerHTML="";var t=e.elem.appendChild(document.createElement("div"));t.className="zp_cwrap",t.innerHTML='<div class="zp_Lstwrap zp_Tdash"><div scrollElem><div class="zp_dashlft"><div layer="basicInfo" class="zp_CPinf"></div><div layer="moreInfo" class="zp_dshcnt"><div layer="rightPane" class="zp_dashrgt"></div></div></div></div></div>'},constructDashBoard:function(){var e,t=lmsdashboard[lmsbase._role];for(e in t)"basicInfo"==e?lmsdashboard.constructBasicInfo(t[e].subLayers,e):"moreInfo"==e?lmsdashboard.constructMoreInfo(t[e].subLayers,e):lmsdashboard.constructRightPane(t[e].subLayers,e)},constructBasicInfo:function(e,t){var s=lmsdashboard.root.querySelector("[layer='basicInfo']"),r=ZPeople.getUserDetailsById(erecno),l=document.createDocumentFragment(),a=document.createElement("h4");for(var n in a.innerHTML="Welcome<span>"+r.fname+" "+r.lname+"</span>",l.appendChild(a),e){if("quickStats"==n)var i=l.appendChild(lmsdashboard.getQuickStatsHTML());lmsdashboard.checkForEvents(i,n),lmsdashboard.checkRequestSingleOrGroup(e[n],n)}s.appendChild(l)},getQuickStatsHTML:function(){var e=document.createElement("ul");return e.className="zp_CPlst",e.setAttribute("subLayer","quickStats"),e.innerHTML=lmsdashboard.addLoading().outerHTML,e},getActiveCourseCountHTML:function(e){var t=document.createElement("li");return t.setAttribute("entityName","activeCourseCount"),t.innerHTML='<i class="IC-security zp_bclr"></i><p>'+ZPI18N.getString("zp.lms.trainers.ActiveCourses")+"</p><h5 data>"+(e||lmsdashboard.layerData.activeCourseCount)+"</h5>",t},getActiveHoursHTML:function(e){var t=document.createElement("li");return t.setAttribute("entityName","activeHours"),t.innerHTML='<i class="IC-time-duration zp_oclr"></i><p>'+ZPI18N.getString("zp.lms.trainers.ActiveHours")+"</p><h5 data>"+(e||lmsdashboard.layerData.activeHours)+"</h5>",t},getCompletedCoursesCountHTML:function(e){var t=document.createElement("li");return t.setAttribute("entityName","completedCoursesCount"),t.innerHTML='<i class="IC-cont-info zp_gclr"></i><p>'+ZPI18N.getString("zp.completed")+"</p><h5 data>"+(e||lmsdashboard.layerData.completedCoursesCount)+"</h5>",t},getCertificationCountHTML:function(e){var t=document.createElement("li");return t.setAttribute("entityName","certificationCount"),t.innerHTML='<i class="IC-perm zp_rclr"></i><p>'+ZPI18N.getString("zp.lms.certification")+"</p><h5 data>"+(e||lmsdashboard.layerData.certificationCount)+"</h5>",t},getTrainersCountHTML:function(e){var t=document.createElement("li");return t.setAttribute("entityName","trainersCount"),t.innerHTML='<i class="IC-security zp_bclr"></i><p>'+ZPI18N.getString("zp.lms.trainers.TotalTrainers")+"</p><h5 data>"+(e||lmsdashboard.layerData.totalTrainersCount)+"</h5>",t},getCoursesCountHTML:function(e){var t=document.createElement("li");return t.setAttribute("entityName","coursesCount"),t.innerHTML='<i class="IC-time-duration zp_oclr"></i><p>'+ZPI18N.getString("zp.lms.course.TotalCourses")+"</p><h5 data>"+(e||lmsdashboard.layerData.totalCoursesCount)+"</h5>",t},getLearnersCountHTML:function(e){var t=document.createElement("li");return t.setAttribute("entityName","learnersCount"),t.innerHTML='<i class="IC-cont-info zp_gclr"></i><p>'+ZPI18N.getString("zp.lms.course.activelearners")+"</p><h5 data>"+(e||lmsdashboard.layerData.activeLearnersCount)+"</h5>",t},getRoomsCountHTML:function(e){var t=document.createElement("li");return t.setAttribute("entityName","roomsCount"),t.innerHTML='<i class="IC-perm zp_rclr"></i><p>'+ZPI18N.getString("zp.lms.base.totalrooms")+"</p><h5 data>"+(e||lmsdashboard.layerData.totalRoomsCount)+"</h5>",t},getPendingRequestsCountHTML:function(e){var t=document.createElement("li");return t.setAttribute("entityName","pendingRequestsCount"),t.innerHTML='<i class="IC-perm zp_rclr"></i><p>'+ZPI18N.getString("zp.lms.base.PendingRequests")+"</p><h5 data>"+(e||lmsdashboard.layerData.pendingRequestsCount)+"</h5>",t},constructMoreInfo:function(e){var t=lmsdashboard.root.querySelector("[layer='moreInfo']"),s=document.createDocumentFragment();for(var r in e){if("learnersChart"==r)var l=s.appendChild(lmsdashboard.getLearnersChartHTML());else if("courseChart"==r)l=s.appendChild(lmsdashboard.getCourseChartHTML());else if("pendingRequests"==r)l=s.appendChild(lmsdashboard.getPendingRequestsHTML());else if("importantFeeds"==r)l=s.appendChild(lmsdashboard.getImportantFeedsHTML());else if("helpDocsAndVids"==r)l=s.appendChild(lmsdashboard.getHelpDocsAndVidsHTML());else if("sessions"==r)l=s.appendChild(lmsdashboard.getSessionsHTML());else if("activeCourse"==r)l=s.appendChild(lmsdashboard.getActiveCourseHTML());lmsdashboard.checkForEvents(l,r),lmsdashboard.checkRequestSingleOrGroup(e[r],r)}t.appendChild(s)},getLearnersChartHTML:function(){var e=lmsdashboard.layerVariables.learnersChart,t=document.createElement("div");return t.className="zp_dashbx zp_smbx",t.setAttribute("subLayer","learnersChart"),t.innerHTML='<ul class="zp_CPmnu"><li><p _rel="1-week" '+("1-week"==e.range?'class="zp_Tgclr"':"")+'>1 week</p></li><li><p _rel="1-month" '+("1-month"==e.range?'class="zp_Tgclr"':"")+'>1 Month</p></li><li><p _rel="3-month" '+("3-month"==e.range?'class="zp_Tgclr"':"")+">Quarter</p></li></ul><div chart>"+lmsdashboard.addLoading().outerHTML,t},getCourseChartHTML:function(){var e=lmsdashboard.layerVariables.courseChart,t=document.createElement("div");return t.className="zp_dashbx zp_smbx",t.setAttribute("subLayer","courseChart"),t.innerHTML='<ul class="zp_CPmnu"><li><p _rel="1-week" '+("1-week"==e.range?'class="zp_Tgclr"':"")+'>1 week</p></li><li><p _rel="1-month" '+("1-month"==e.range?'class="zp_Tgclr"':"")+'>1 Month</p></li><li><p _rel="3-month" '+("3-month"==e.range?'class="zp_Tgclr"':"")+">Quarter</p></li></ul><div chart>"+lmsdashboard.addLoading().outerHTML,t},getPendingRequestsHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx zp_smbx",e.setAttribute("subLayer","pendingRequests"),e.innerHTML='<div class="zp_Pttl">Pending Requests</div><div list class="zp_crAcvt"><div class="ZPNdata" _rel="nodata" style="display:block;">'+lmsnodata.getCommonNoData("No Pending Requests")+"</div></div></div>",e},getImportantFeedsHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx zp_smbx",e.setAttribute("subLayer","importantFeeds"),e.innerHTML='<div class="zp_Pttl">Important feeds</div><ul list class="zp_CPlst zp_fds"><div class="ZPNdata" _rel="nodata" style="display:block;">'+lmsnodata.getCommonNoData("No Feeds Available")+"</div></ul></div>",e},getHelpDocsAndVidsHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx",e.setAttribute("subLayer","helpDocsAndVids"),e.innerHTML='<div class="zp_Pttl">Help Docs and Videos</div><div><div class="ZPNdata" _rel="nodata" style="display:block;">'+lmsnodata.getCommonNoData("No Help Documents or Videos Found")+"</div><ul list></ul></div>",e},getSessionsHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx zp_dshssn",e.setAttribute("subLayer","sessions"),e.innerHTML='<div style="overflow:auto;" scrollElem><ul list>'+lmsdashboard.addLoading().outerHTML+'</ul></div><i id="leftButtonSessions" data-ttip="'+ZPI18N.getString("zp.previous")+'" _rel="leftButton" style="visibility:hidden;" class="IC-alft"></i><i id="rightButtonSessions" data-ttip="'+ZPI18N.getString("zp.lms.next")+'" _rel="rightButton" style="visibility:hidden;" class="IC-argt"></i>',e},getActiveCourseHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx zp_smbx",e.setAttribute("subLayer","activeCourse"),e.innerHTML='<div class="zp_Pttl">Active Course</div><ul class="zp_CPlst" list scrollElem>'+lmsdashboard.addLoading().outerHTML+"</ul>",e},constructRightPane:function(e){var t=lmsdashboard.root.querySelector("[layer='rightPane']"),s=document.createDocumentFragment();for(var r in e){if("topCourses"==r)var l=s.appendChild(lmsdashboard.getTopCoursesHTML());else if("topLearners"==r)l=s.appendChild(lmsdashboard.getTopLearnersHTML());else if("topTrainers"==r)l=s.appendChild(lmsdashboard.getTopTrainersHTML());else if("addCourseButton"==r)l=s.appendChild(lmsdashboard.getAddCourseButtonHTML());else if("skillset"==r)l=s.appendChild(lmsdashboard.getSkillsetHTML());else if("activityFeeds"==r)l=s.appendChild(lmsdashboard.getActivityFeedsHTML());lmsdashboard.checkForEvents(l,r),lmsdashboard.checkRequestSingleOrGroup(e[r],r)}t.appendChild(s)},getTopLearnersHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx",e.setAttribute("subLayer","topLearners"),e.innerHTML='<div class="zp_Pttl">TOP LEARNERS</div><ul list class="zp_CPlst"><div class="ZPNdata" _rel="nodata" style="display:block;">'+lmsnodata.getCommonNoData("No Learners Found")+"</div></ul>",e},getTopCoursesHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx",e.setAttribute("subLayer","topCourses"),e.innerHTML='<div class="zp_Pttl">TOP COURSES</div><ul list class="zp_CPlst">'+lmsdashboard.addLoading().outerHTML+"</ul>",e},getTopTrainersHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx",e.setAttribute("subLayer","topTrainers"),e.innerHTML='<div class="zp_Pttl">TOP TRAINERS</div><ul list class="zp_CPlst">'+lmsdashboard.addLoading().outerHTML+"</ul>",e},getSkillsetHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx zp_CPbx",e.setAttribute("subLayer","skillset"),e.innerHTML='<div class="zp_Pttl">'+ZPI18N.getString("zp.lms.Skillset")+"</div><div list>"+lmsdashboard.addLoading().outerHTML+"</div>",e},getActivityFeedsHTML:function(){var e=document.createElement("div");return e.className="zp_dashbx",e.setAttribute("subLayer","activityFeeds"),e.innerHTML='<div class="zp_Pttl">ACTIVITY FEEDS</div><div list class="zp_crAcvt"><div class="ZPNdata" _rel="nodata" style="display:block;">'+lmsnodata.getCommonNoData("No Activity Feeds Found")+"</div></div>",e},getAddCourseButtonHTML:function(){var e=document.createElement("font");return e.setAttribute("_rel","addCourseButton"),e.setAttribute("onclick","lmscourses.addCourse.showAddCourse()"),e.innerHTML='<i class="IC-plus"></i>Create New Course',e},getTopTrainersRowCard:function(e){var t=document.createElement("li");return t.setAttribute("trainerId",e.trainerId),t.innerHTML=lmsmessages.getUserDP(e,"trainerName","trainerImage")+"<h4>"+e.trainerName+"</h4>",t},getCourseRowCard:function(e){var t=document.createElement("li");return t.setAttribute("courseId",e.courseId),null!=e.batchId&&t.setAttribute("batchId",e.batchId),t.innerHTML=lmsdashboard.getCourseDP(e)+"<h4>"+e.courseName+"</h4>",t},getCourseDP:function(e){var t=e.courseImageInfo;return t.additionalInfo={fileId:e.courseId,type:6},'<div class="ZP_photo"><img src='+(t.isSystemImage?ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+t.imageID+".svg"):lmsfileaction.generateSourceURL(t))+"></div>"},getSkillsetRowCard:function(e){var t=lmsdashboard.layerConstants.skillset.colors,s=e.name.length%3,r=document.createElement("div");return r.className="zp_pbar",r.innerHTML='<div class="zp_pbB zp_BR'+t[s]+'" style="width:'+e.percentage+'%;"></div><font>'+e.name+"</font><span>"+e.percentage+"</span></div>",r},getSessionsColumnCard:function(e,t,s){var r=document.createElement("li");r.setAttribute("sessionId",e.sessionId),"upcomingSession"==t?(r.setAttribute("sessionStartTimeInMillis",e.sessionStartTimeInMillis),s&&(r.className="zp_nxtssn",r.setAttribute("nextSession",""),r.innerHTML+='<div class="zp_Pttl">Next session</div>')):e.isOngoingSession&&(r.innerHTML+='<div class="zp_Pttl">Ongoing session</div>');var l=ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+(e.courseName.length%10+1)+".svg");return r.innerHTML+='<img src="'+l+'"><label><span '+("pastSession"!=t||isadmin?"":'class="zp_bg'+(e.isPresent?"grn":"red"))+'">'+lmsdashboard.getSessionTimeString(e.sessionStartDateInMillis,e.sessionStartTimeInMillis)+"</span><h4>"+e.sessionName+"</h4><span>"+lmsdashboard.getSessionTimeString(e.sessionEndDateInMillis,e.sessionEndTimeInMillis)+"</span></label>",r},getSessionTimeString:function(e,t){return t?ZPDateTime.getDateDisplayFormat(e+t):ZPDateTime.getDateDisplayFormatWithoutTime(e)},getHelpDocsAndVidsColumnCard:function(e){if("video"==e.type){var t=document.createElement("li");return t.innerHTML='<div class="zp_CIvd"><video style="" height="100%" width="100%" controls=""><source src="'+e.videoSource+'"></video></div><p>'+e.name+"</p>",t}},checkRequestSingleOrGroup:function(e,t){var s=e.requestType;if(s)if("group"==s.type)lmsdashboard.requestGroups[s.groupName].group.entityList.push(t),e.entities&&(lmsdashboard.requestGroups[s.groupName].group[t]=e.entities.toString()),lmsdashboard.requestGroups[s.groupName].subLayers.push(t);else if("subgroup"==s.type){var r=lmsdashboard.requestGroups[s.groupName].subGroups;r[s.subGroupName]||(r[s.subGroupName]=[]),r[s.subGroupName].push(t),e.entities&&(lmsdashboard.requestGroups[s.groupName].group[t]=e.entities.toString()),lmsdashboard.requestGroups[s.groupName].subLayers.push(t)}else if("single"==s.type){var l={entityList:[t]};e.entities&&(l[t]=e.entities.toString()),lmsdashboard.singleRequests.push(l)}},sendSingleRequests:function(){for(var e=lmsdashboard.singleRequests,t=0;t<e.length;t++){var s=e[t];s.action="fetchWidgetData",lmsdashboard.prepareRequestAndSend(s,s.entityList)}e=[]},sendGroupRequests:function(){var e,t=lmsdashboard.requestGroups;for(e in t){var s=t[e].group,r=t[e].subGroups,l=s;for(var a in r)l.entityList.push(a),l[a]=r[a].toString();s.entityList.length>0&&(l.action="fetchWidgetData",lmsdashboard.prepareRequestAndSend(l,t[e].subLayers),t[e]={group:{entityList:[]},subGroups:{},subLayers:[]})}},prepareRequestAndSend:function(e,t){for(var s=0;s<t.length;s++)if("courseChart"==t[s]||"learnersChart"==t[s]){var r=lmsdashboard.layerVariables[t[s]],l=lmsdashboard.getDateRange(r.range);e.rangeStart=l.startTimeInMillis,e.rangeEnd=l.endTimeInMillis}else if("topCourses"==t[s]||"topLearners"==t[s]||"topTrainers"==t[s]){r=lmsdashboard.layerConstants[t[s]];e[t[s]+"Count"]=r.count}else if("sessions"==t[s]){r=lmsdashboard.layerVariables[t[s]];e.sessionsMode=r.sessionsMode,e.firstRequestTime=r.firstRequestTime||void 0,"both"==r.sessionsMode?e.startIndex=1:"pastSessions"==r.sessionsMode?e.startIndex=r.leftIndex:e.startIndex=r.rightIndex}e.entityList=e.entityList.toString(),lmsdashboard.sendRequest(e)},sendRequest:function(e){$.get("lmsDashboardAction.zp",e,lmsdashboard.responseHandler)},responseHandler:function(e){for(var t in e)"quickStats"==t?lmsdashboard.quickStatsResponseHandler(e[t]):"sessions"==t?lmsdashboard.listSessions(e[t]):"activeCourse"==t?lmsdashboard.listActiveCourses(e[t].activeCourse):"courseChart"==t?lmsdashboard.constructCourseChart(e[t]):"learnersChart"==t?lmsdashboard.constructLearnersChart(e[t]):"topCourses"==t?lmsdashboard.listTopCourses(e[t].courseArray):"topTrainers"==t?lmsdashboard.listTopTrainers(e[t].trainerArray):"skillset"==t&&lmsdashboard.listSkillset(e[t].skillsetArray)},quickStatsResponseHandler:function(e){var t=lmsdashboard.root.querySelector('[subLayer="quickStats"]');lmsdashboard.removeLoading(t);for(var s=lmsdashboard[lmsbase._role].basicInfo.subLayers.quickStats.entities,r=document.createDocumentFragment(),l=0;l<s.length;l++){var a=s[l];e[a]&&-1!=e[a][a]&&(lmsdashboard.layerData[a]=e[a][a],"totalTrainersCount"==a?r.appendChild(lmsdashboard.getTrainersCountHTML()):"totalCoursesCount"==a?r.appendChild(lmsdashboard.getCoursesCountHTML()):"activeLearnersCount"==a?r.appendChild(lmsdashboard.getLearnersCountHTML()):"totalRoomsCount"==a?r.appendChild(lmsdashboard.getRoomsCountHTML()):"activeCourseCount"==a?r.appendChild(lmsdashboard.getActiveCourseCountHTML()):"activeHours"==a?r.appendChild(lmsdashboard.getActiveHoursHTML()):"completedCoursesCount"==a?r.appendChild(lmsdashboard.getCompletedCoursesCountHTML()):"certificationCount"==a?r.appendChild(lmsdashboard.getCertificationCountHTML()):"pendingRequestsCount"==a&&r.appendChild(lmsdashboard.getPendingRequestsCountHTML()))}t.appendChild(r)},listTopCourses:function(e){var t=lmsdashboard.root.querySelector("[layer='rightPane'] [sublayer='topCourses'] [list]");if(lmsdashboard.removeLoading(t),e.length>0){for(var s=document.createDocumentFragment(),r=0;r<e.length;r++)s.appendChild(lmsdashboard.getCourseRowCard(e[r]));t.appendChild(s)}else lmsnodata.showNoData({mode:"topCourses",container:t,module:"dashboard",content:ZPI18N.getString("zp.lms.course.nocoursefound")})},listTopTrainers:function(e){var t=lmsdashboard.root.querySelector("[layer='rightPane'] [sublayer='topTrainers'] [list]");if(lmsdashboard.removeLoading(t),e.length>0){for(var s=document.createDocumentFragment(),r=0;r<e.length;r++)s.appendChild(lmsdashboard.getTopTrainersRowCard(e[r]));t.appendChild(s)}else lmsnodata.showNoData({mode:"topTrainers",container:t,module:"dashboard",content:ZPI18N.getString("zp.lms.trainers.noTrainersfound")})},listSkillset:function(e){var t=lmsdashboard.root.querySelector("[layer='rightPane'] [sublayer='skillset'] [list]");if(lmsdashboard.removeLoading(t),e.length>0){for(var s=document.createDocumentFragment(),r=0;r<e.length;r++)s.appendChild(lmsdashboard.getSkillsetRowCard(e[r]));t.appendChild(s)}else lmsnodata.showNoData({mode:"skillset",container:t,module:"dashboard",content:ZPI18N.getString("zp.lms.noskillsetfound")})},listSessions:function(e){var t=lmsdashboard.layerVariables.sessions,s=1==t.leftIndex&&1==t.rightIndex?"new":"update",r=lmsdashboard.root.querySelector("[layer='moreInfo'] [sublayer='sessions'] [list]");if("new"==s){if(null==t.firstRequestTime&&(t.firstRequestTime=e.firstRequestTime),0==e.pastSessions.length&&0==e.upcomingSessions.length)return lmsnodata.showNoData({mode:"sessions",container:r,module:"dashboard",content:ZPI18N.getString("zp.lms.youhavenosession")}),void(t.isRightIndexEnd=t.isLeftIndexEnd=!0);lmsnodata.clearNoData(r)}if(e.pastSessions){var l=e.pastSessions;lmsdashboard.removeLoading(r);var a=document.createDocumentFragment();for(o=l.length-1;o>=0;o--)a.appendChild(lmsdashboard.getSessionsColumnCard(l[o],"pastSession"));25==l.length?a.insertBefore(lmsdashboard.addLoading(),a.childNodes[0]):t.isLeftIndexEnd=!0,t.leftIndex+=l.length,r.insertBefore(a,r.childNodes[0])}if(e.upcomingSessions){var n=e.upcomingSessions;lmsdashboard.removeLoading(r,!0);a=document.createDocumentFragment();var i,o=0;for(1==t.rightIndex&&n[0]&&(i=lmsdashboard.getSessionsColumnCard(n[0],"upcomingSession",!0),a.appendChild(i),o=1);o<n.length;o++)a.appendChild(lmsdashboard.getSessionsColumnCard(n[o],"upcomingSession"));25==n.length?a.append(lmsdashboard.addLoading()):t.isRightIndexEnd=!0,t.rightIndex+=n.length,r.appendChild(a),"new"==s&&window.requestAnimationFrame((function(){window.requestAnimationFrame((function(){window.requestAnimationFrame((function(){var e=lmsdashboard.events.sessions.scroll.elem;if(e.clientWidth<e.scrollWidth){var t=lmsdashboard.root.querySelector("#rightButtonSessions"),s=lmsdashboard.root.querySelector("#leftButtonSessions");t.style.visibility="visible",s.style.visibility="visible";var r=lmsdashboard.root.querySelector("[layer='moreInfo'] [sublayer='sessions'] [list]");(r.querySelector("[nextSession]")||r.lastChild).scrollIntoView(!1)}}))}))}))}},listActiveCourses:function(e){var t=lmsdashboard.root.querySelector("[layer='moreInfo'] [sublayer='activeCourse'] [list]");lmsdashboard.removeLoading(t);var s=lmsdashboard.layerVariables.activeCourse;"new"==(1==s.index?"new":"update")&&(e.length>0?lmsnodata.clearNoData(t):lmsnodata.showNoData({mode:"activeCourse",container:t,module:"dashboard",content:ZPI18N.getString("zp.lms.course.nojoin")}));var r,l=document.createDocumentFragment();for(r=0;r<e.length;r++)l.appendChild(lmsdashboard.getCourseRowCard(e[r]));25==e.length?(l.appendChild(lmsdashboard.addLoading()),s.index+=25):s.index="end",t.appendChild(l)},constructCourseChart:function(e){var t=lmsdashboard.layerVariables.courseChart;lmsdashboard.layerData.courseChart[t.range]=e;var s=lmsdashboard.root.querySelector("[subLayer=courseChart] [chart]");"success"==e.status&&(e.completed||e.ongoing||e.upcoming)?(t.nodata=!1,t.chart=new Highcharts.chart({chart:{renderTo:s,type:"pie"},title:{text:"Quick stats of courses"},legend:{enabled:!1},credits:{enabled:!1},tooltip:{enabled:!0},exporting:{enabled:!1},plotOptions:{column:{pointPadding:.2,borderWidth:0,colorByPoint:!0},pie:{dataLabels:{enabled:!1,format:"{point.name} - {point.percentage:.2f} %"}},series:{allowPointSelect:!0,cursor:"pointer"}},xAxis:{title:{text:"Status"},categories:["completed","ongoing","upcoming"]},yAxis:{allowDecimals:!1,title:{text:"Number of Courses"}},series:[{name:"No. of Courses",data:[{name:"Completed",y:e.completed},{name:"Ongoing",y:e.ongoing},{name:"Upcoming",y:e.upcoming}]}]})):t.nodata||(lmsnodata.showNoData({mode:"courseChart",container:s,module:"dashboard",content:ZPI18N.getString("zp.lms.nodateAvailable")}),t.nodata=!0)},constructLearnersChart:function(e){var t=lmsdashboard.layerVariables.learnersChart;lmsdashboard.layerData.learnersChart[t.range]=e;var s=lmsdashboard.root.querySelector("[subLayer=learnersChart] [chart]");"success"==e.status&&(e.completed||e.inProgress||e.enrolled)?(t.nodata=!1,t.chart=new Highcharts.chart({chart:{renderTo:s,type:"pie"},title:{text:"Quick stats of learners"},legend:{enabled:!1},credits:{enabled:!1},tooltip:{enabled:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0,colorByPoint:!0},pie:{dataLabels:{enabled:!0,format:"{point.name} - {point.percentage:.2f} %"}},series:{allowPointSelect:!0,cursor:"pointer"}},xAxis:{title:{text:"Status"},categories:["completed","inProgress","enrolled"]},yAxis:{allowDecimals:!1,title:{text:"Head Counts"}},series:[{name:"Head Counts",data:[{name:"Completed",y:e.completed},{name:"InProgress",y:e.inProgress},{name:"Enrolled",y:e.enrolled}]}]})):t.nodata||lmsnodata.showNoData({mode:"learnersChart",container:s,module:"dashboard",content:ZPI18N.getString("zp.lms.nodateAvailable")})},checkForEvents:function(e,t){var s=lmsdashboard.events;s[t]&&lmsdashboard.addEveListeners(e,s[t])},addEveListeners:function(e,t){for(var s in t){if("click"==s)t[s].elem=e;else if("scroll"==s)t[s].elem=e.querySelector("[scrollElem]");else if("resize"==s){("onresize"==t[s].type?lmsdashboard.resizeConfig.onresizeCallbacks:lmsdashboard.resizeConfig.resizedCallbacks).push(lmsdashboard[t[s].funcToBeCalled]);continue}lmsbase.addListener(t[s].elem,s,lmsdashboard[t[s].funcToBeCalled],!1)}},removeAllEveListeners:function(){var e=lmsdashboard.events;for(var t in e)lmsdashboard.removeEveListeners(e[t])},removeEveListeners:function(e){for(var t in e)e[t].elem&&"resize"!=t&&(lmsbase.removeListener(e[t].elem,t,lmsdashboard[e[t].funcToBeCalled],!1),e[t].elem=null)},chartClickHandle:function(e){e.stopPropagation();var t=e.target,s=t.getAttribute("_rel"),r=t.closest("[sublayer]").getAttribute("subLayer"),l=lmsdashboard.layerVariables[r];if(("1-week"==s||"1-month"==s||"3-month"==s)&&l.range!=s)if(l.range=s,lmsbase.removeClass(t.parentNode.parentNode.querySelector(".zp_Tgclr"),"zp_Tgclr"),lmsbase.addClass(t,"zp_Tgclr"),lmsdashboard.layerData[r][l.range])"courseChart"==r?lmsdashboard.constructCourseChart(lmsdashboard.layerData[r][l.range]):lmsdashboard.constructLearnersChart(lmsdashboard.layerData[r][l.range]);else{var a={action:"fetchWidgetData",entityList:[r]};lmsdashboard.prepareRequestAndSend(a,a.entityList)}},courseBoxesClickHandle:function(e){e.stopPropagation();var t=e.target.closest("[courseId]");t&&lms.changeHash("hash","course/"+t.getAttribute("courseId")+"/overview")},trainerBoxesClickHandle:function(e){e.stopPropagation();var t=e.target.closest("[trainerId]");t&&lmstrainers.trainerInfoPopup(t.getAttribute("trainerId"))},sessionsClickHandle:function(e){e.stopPropagation();var t=e.target.getAttribute("_rel");if("leftButton"==t)(r=(s=lmsdashboard.layerVariables.sessions).rightIndex+s.leftIndex-2)&&((l=lmsdashboard.events.sessions.scroll.elem).scrollLeft-=l.scrollWidth/r);else if("rightButton"==t){var s,r,l;if(r=(s=lmsdashboard.layerVariables.sessions).rightIndex+s.leftIndex-2)(l=lmsdashboard.events.sessions.scroll.elem).scrollLeft+=l.scrollWidth/r}},sessionsScrollHandle:function(){var e=lmsdashboard.layerVariables.sessions;if(0==this.scrollLeft)if(e.isLeftIndexEnd){lmsdashboard.root.querySelector("#leftButtonSessions").style.visibility="hidden"}else{e.mode="pastSessions";var t={action:"fetchWidgetData",entityList:["sessions"]};lmsdashboard.prepareRequestAndSend(t,t.entityList)}else if(this.scrollLeft+this.clientWidth==this.scrollWidth)if(e.isRightIndexEnd){lmsdashboard.root.querySelector("#rightButtonSessions").style.visibility="hidden"}else{e.mode="upcomingSessions";t={action:"fetchWidgetData",entityList:["sessions"]};lmsdashboard.prepareRequestAndSend(t,t.entityList)}else{lmsdashboard.root.querySelector("#rightButtonSessions").style.visibility="visible",lmsdashboard.root.querySelector("#leftButtonSessions").style.visibility="visible"}},activeCourseScrollHandle:function(){var e=lmsdashboard.layerVariables.activeCourse;if("end"!=e.index&&this.scrollHeight-this.scrollTop-this.clientHeight<1){var t={action:"fetchWidgetData",entityList:"activeCourse",startIndex:e.index};lmsdashboard.sendRequest(t)}},resize:function(){var e=lmsdashboard.resizeConfig;window.clearTimeout(e.resizeTimer),e.resizeTimer=window.setTimeout(lmsdashboard.resized,e.timeInterval),lmsdashboard.onresize()},onresize:function(){for(var e=lmsdashboard.resizeConfig.onresizeCallbacks,t=0;t<e.length;t++)e[t]()},resized:function(){var e=lmsdashboard.resizeConfig;e.resizeTimer=null;for(var t=e.resizedCallbacks,s=0;s<t.length;s++)t[s]()},sessionsResizedHandle:function(){var e=lmsdashboard.events.sessions.scroll.elem,t=lmsdashboard.layerVariables.sessions,s=lmsdashboard.root.querySelector("#rightButtonSessions"),r=lmsdashboard.root.querySelector("#leftButtonSessions");e.scrollWidth<=e.clientWidth?(s.style.visibility="hidden",r.style.visibility="hidden"):(s.style.visibility=t.isRightIndexEnd&&e.scrollLeft+e.clientWidth==e.scrollWidth?"hidden":"visible",r.style.visibility=t.isLeftIndexEnd&&0==e.scrollLeft?"hidden":"visible")},getDateRange:function(e){var t=new Date,s=e.split("-");if("week"==s[1])(r=new Date(t.getTime())).setDate(t.getDate()-7*s[0]),(l=new Date(t.getTime())).setDate(t.getDate()+7*s[0]);else if("month"==s[1]){var r,l;(r=new Date(t.getTime())).setMonth(t.getMonth()-s[0]),(l=new Date(t.getTime())).setMonth(t.getMonth()+s[0])}return{startTimeInMillis:r.getTime(),endTimeInMillis:l.getTime()}},addLoading:function(){var e=document.createElement("div");return e.className="ctable",e.setAttribute("loadbar",""),e.innerHTML='<div class="ctcell"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div>',e},removeLoading:function(e,t){var s=e.querySelector("[loadbar]"+(t?":last-child":""));s&&s.parentNode.removeChild(s)},reInitialise:function(){lmsdashboard.root=null,lmsdashboard.events={overall:{click:{elem:null,funcToBeCalled:"clickHandle"},scroll:{elem:null,funcToBeCalled:"scrollHandle"}},sessions:{click:{elem:null,funcToBeCalled:"sessionsClickHandle"},scroll:{elem:null,funcToBeCalled:"sessionsScrollHandle"},resize:{type:"resized",funcToBeCalled:"sessionsResizedHandle"}},activeCourse:{click:{elem:null,funcToBeCalled:"courseBoxesClickHandle"},scroll:{elem:null,funcToBeCalled:"activeCourseScrollHandle"}},topCourses:{click:{elem:null,funcToBeCalled:"courseBoxesClickHandle"}},topTrainers:{click:{elem:null,funcToBeCalled:"trainerBoxesClickHandle"}},learnersChart:{click:{elem:null,funcToBeCalled:"chartClickHandle"}},courseChart:{click:{elem:null,funcToBeCalled:"chartClickHandle"}}},lmsdashboard.resizeConfig={resizeTimer:null,timeInterval:1e3,onresizeCallbacks:[],resizedCallbacks:[]},lmsdashboard.layerData={activeLearnersCount:0,totalTrainersCount:0,activeCourseCount:0,activeHours:"00.00",totalRoomsCount:0,totalCoursesCount:0,certificationCount:0,completedCoursesCount:0,pendingRequestsCount:0,courseChart:{},learnersChart:{}},lmsdashboard.layerConstants={skillset:{colors:{0:"org",1:"blu",2:"grn"}},topCourses:{count:5},topLearners:{count:5},topTrainers:{count:5}},lmsdashboard.layerVariables={sessions:{sessionsMode:"both",firstRequestTime:null,rightIndex:1,leftIndex:1,isRightIndexEnd:!1,isRightIndexEnd:!1,nxtSessionUpdater:null},activeCourse:{index:1},courseChart:{range:"1-week",chart:null,nodata:!1},learnersChart:{range:"1-week",chart:null,nodata:!1}},lmsdashboard.admin={basicInfo:{subLayers:{quickStats:{entities:["totalTrainersCount","totalCoursesCount","activeLearnersCount","pendingRequestsCount"],requestType:{type:"group",subGroupName:"allStats",groupName:"basicInfo"}}}},moreInfo:{subLayers:{sessions:{requestType:{type:"group",groupName:"moreInfo"}},courseChart:{requestType:{type:"group",subGroupName:"allStats",groupName:"moreInfo"}},learnersChart:{requestType:{type:"group",groupName:"moreInfo"}},pendingRequests:{requestType:{type:"group",groupName:"moreInfo"}},importantFeeds:{requestType:{type:"group",groupName:"moreInfo"}},helpDocsAndVids:{requestType:{type:"group",groupName:"moreInfo"}}}},rightPane:{subLayers:{addCourseButton:{},topCourses:{requestType:{type:"group",groupName:"rightPane"}},topLearners:{requestType:{type:"group",groupName:"rightPane"}},topTrainers:{requestType:{type:"group",groupName:"rightPane"}}}}},lmsdashboard.learner={basicInfo:{subLayers:{quickStats:{entities:["activeCourseCount","activeHours","completedCoursesCount","certificationCount","pendingRequestsCount"],requestType:{type:"group",groupName:"basicInfo"}}}},moreInfo:{subLayers:{sessions:{requestType:{type:"group",groupName:"moreInfo"}},importantFeeds:{requestType:{type:"group",groupName:"moreInfo"}},activeCourse:{requestType:{type:"group",groupName:"moreInfo"}},helpDocsAndVids:{requestType:{type:"group",groupName:"moreInfo"}}}},rightPane:{subLayers:{addCourseButton:{},skillset:{requestType:{type:"group",groupName:"rightPane"}},activityFeeds:{requestType:{type:"group",groupName:"rightPane"}}}}},lmsdashboard.trainer={basicInfo:{subLayers:{quickStats:{entities:["activeCourseCount","activeHours","completedCoursesCount","certificationCount","pendingRequestsCount"],requestType:{type:"group",groupName:"basicInfo"}}}},moreInfo:{subLayers:{sessions:{requestType:{type:"group",groupName:"moreInfo"}},importantFeeds:{requestType:{type:"group",groupName:"moreInfo"}},activeCourse:{requestType:{type:"group",groupName:"moreInfo"}},helpDocsAndVids:{requestType:{type:"group",groupName:"moreInfo"}}}},rightPane:{subLayers:{addCourseButton:{},skillset:{requestType:{type:"group",groupName:"rightPane"}},activityFeeds:{requestType:{type:"group",groupName:"rightPane"}}}}},lmsdashboard.requestGroups={basicInfo:{group:{entityList:[]},subGroups:{},subLayers:[]},moreInfo:{group:{entityList:[]},subGroups:{},subLayers:[]},rightPane:{group:{entityList:[]},subGroups:{},subLayers:[]}},lmsdashboard.singleRequests=[]},clearAllTimers:function(){window.clearTimeout(lmsdashboard.resizeConfig.resizeTimer)},releaseAllMemory:function(){lmsdashboard.root=null,lmsdashboard.events=lmsdashboard.resizeConfig=null,lmsdashboard.layerData=lmsdashboard.layerConstants=lmsdashboard.layerVariables=null,lmsdashboard.admin=lmsdashboard.trainer=lmsdashboard.learner=null,lmsdashboard.requestGroups=lmsdashboard.singleRequests=null},close:function(){lmsdashboard.clearAllTimers(),lmsdashboard.removeAllEveListeners(),lmsdashboard.releaseAllMemory()}},TimelyCalendar={PrevPosX:null,PrevPosY:null,currrentDate:new Date,curYear:(new Date).getFullYear(),curMonth:(new Date).getMonth(),curDate:(new Date).getDate(),weekfromdate:new Date,weektodate:new Date,monthfromdate:new Date,monthtodate:new Date,daydate:null,tmpMonth:null,tmpYear:null,leaveErecNo:null,daysObj:{empty:"",weekend:"Cl-wked",day:"zpcaldays",today:"Cl-today",leave:"zpcalholi"},calObj:function(){this.curYear=null,this.curMonth=null,this.calcontId=null,this.outerdivId=null,this.daysObj=null,this.divid=null,this.callback=null,this.mode=null,this.tdonclick=null,this.totaldata=null},jumpToSelectedDate:function(e){this.constructCalendar(e)},initCalendar:function(e){var t="";"/hr"===ZPeople.CONTEXT&&(-1!==Layout.Page.currentmode.indexOf("/calendarview")||-1!==Layout.Page.currentmode.indexOf("/views/calendar")||-1!==Layout.Page.currentmode.indexOf("/timelogscalendarview")?t="ZPcalmtp":-1!==Layout.Page.currentmode.indexOf("/dashboard/calendar")&&(t="ZPcalvw-dash"));var s=Layout.Page.container.find("#"+e.outerdivId);s.addClass(t);var r=TimelyCalendar.Template.getCalendarHTML(e.calcontId,!1,e);s.find("#"+e.divid).html(r);var l=e.prearrow,a=e.nextarrow;s.find("."+a).off("click"),s.find("."+a).on("click",(function(){TimelyCalendar.nextMonth(e)})),s.find("."+l).off("click"),s.find("."+l).on("click",(function(){TimelyCalendar.previousMonth(e)})),this.constructCalendar(e),s.find("#"+e.divid).show()},constructCalendar:function(e){this.clearOldvalues(e,3);var t=e.mode,s=TimelyCalendar.getCurrentUserErecno(t),r=new Date(e.curYear,e.curMonth),l=new Date(new Date(e.curYear,e.curMonth+1)-1),a={mode:"GET_WEEKEND_DEFINITION",fromDate:Calendar.formatDate(r),toDate:Calendar.formatDate(l),userErecNo:s,userLocation:ZPeople.getUserDetailsById(s).locId,conreqcsr:csrfToken};$.post("/commonAction.zp",a,(function(s){var r=Calendar.getFirstDayofMonth(e.curYear,e.curMonth);(r-=Number(weekstarts))<0&&(r+=7);var l=Calendar.daysInMonth(e.curYear,e.curMonth),a=Layout.Page.container.find("#"+e.outerdivId);a.find("#calmonth").html("<a href='javascript:;'>"+months[e.curMonth]+" "+e.curYear+"</a>"),a.find("#calmonthnew").html("<a href='javascript:;'>"+months[e.curMonth]+" "+e.curYear+"</a>");var n=e.curMonth;n++;var i=a.find(".zpmon");$(i[0]).html(e.curYear),a.find(".zpmonsel").hasClass("zpmon zpmonsel")?a.find(".zpmonsel").removeClass("zpmon zpmonsel"):a.find(".zpmonsel").addClass("zpmon zpmonsel"),$(i[n]).hasClass("zpmon zpmonsel")?$(i[n]).removeClass("zpmon zpmonsel"):$(i[n]).addClass("zpmon zpmonsel");var o="Total Hours";o=o.replace("<0>",months[e.curMonth]+" "+e.curYear),a.find("#caltotmont").html(o);var c=a.find("#"+e.divid).find(".ZPcalvw-box.ZPcalvw-month-view").find("#moncal_body").find("td.findday,td."+TimelyCalendar.daysObj.day+",td."+TimelyCalendar.daysObj.today+",td."+TimelyCalendar.daysObj.weekend+",td."+TimelyCalendar.daysObj.leave),d=!1,m=1,u=0,p=1;for("feedcalendar"===t&&c.removeAttr("date"),u=0;u<c.length;u++)if(u!=r||d||(d=!0),d&&m<=l){if(p=u%7==0?u/7:p,"addjobcalendar"===t)c[u].innerHTML=m,$(c[u]).attr("date",e.curMonth+1+"-"+m+"-"+e.curYear);else if("feedcalendar"===t)c[u].innerHTML='<div class="ZPcalvw-month-day"><span>'+m+'</span></div><a class="ZPcalvw-addbtn"><i class="PI_plus"></i></a>',$(c[u]).attr("date",e.curMonth+1+"-"+m+"-"+e.curYear);else if("leave"===t){e.curYear,e.curMonth;c[u].innerHTML='<div class="ZPcalvw-month-day"><span>'+m+'</span></div><a class="ZPcalvw-addbtn" title="'+ZPI18N.getString("zp.leave.apply")+'"><i class="PI_plus"></i></a>',$(c[u]).attr("date",e.curMonth+1+"-"+m+"-"+e.curYear)}else if("timesheet"===t){e.curYear,e.curMonth;Timetracker.util.allowAddingTimelogs()?c[u].innerHTML='<div class="ZPcalvw-month-day"><span>'+m+'</span></div><a class="ZPcalvw-addbtn" title="'+ZPI18N.getString("zp.logtime")+'"><i class="PI_plus"></i></a>':c[u].innerHTML='<div class="ZPcalvw-month-day"><span>'+m+"</span></div>",$(c[u]).attr("date",e.curMonth+1+"-"+m+"-"+e.curYear)}else if("dashboardcal"===t){e.curYear,e.curMonth;c[u].innerHTML='<div class="ZPcalvw-month-day"><span>'+m+'</span></div><a class="ZPcalvw-addbtn"><i class="PI_plus"></i></a>',$(c[u]).attr("date",e.curMonth+1+"-"+m+"-"+e.curYear)}else{e.curYear,e.curMonth;c[u].innerHTML='<div class="ZPcalvw-month-day ZPcalvw-month-daynot"><span>'+m+"</span></div>",$(c[u]).attr("date",e.curMonth+1+"-"+m+"-"+e.curYear)}var g=e.curYear+"-"+Attendance.disTwoDigit(e.curMonth+1)+"-"+Attendance.disTwoDigit(m);c[u].ldata=m,c[u].mdata=e.curMonth,c[u].ydata=e.curYear;var f="";m+""==curdate+""&&curmonth+""==e.curMonth+""?f=f+" "+TimelyCalendar.daysObj.today:$(c[u]).hasClass("zpcaltotal")||(f=f+" "+TimelyCalendar.daysObj.day),void 0!==s.weekendArray&&-1!==s.weekendArray.indexOf(g)&&(f=f+" "+TimelyCalendar.daysObj.weekend),c[u].className=f,m++,28==u&&$(Layout.Page.container.find("#"+e.outerdivId).find("#moncal_body").find("tbody").children().get(4)).show(),35==u&&$(Layout.Page.container.find("#"+e.outerdivId).find("#moncal_body").find("tbody").children().get(5)).show()}else c[u].className="findday",28==u&&$(Layout.Page.container.find("#"+e.outerdivId).find("#moncal_body").find("tbody").children().get(4)).hide(),35==u&&$(Layout.Page.container.find("#"+e.outerdivId).find("#moncal_body").find("tbody").children().get(5)).hide();$(c).find(".ZPcalvw-addbtn").on("click",(function(t){var s=$(this).parents("td").attr("date");ZPCal.Calendar.showAddpopUp(t,$(this),s,e)})),e.callback&&"function"==typeof e.callback&&e.callback(e),Layout.Page.container.find("#monthcalendarhead,#monthcalendarbody").removeClass("DN"),Layout.Page.container.find("#zp_page_loading").remove()}))},nextMonth:function(e){var t=e.curMonth,s=e.curYear;11==t?(e.curMonth=0,e.curYear=s+1):e.curMonth=t+1,this.constructCalendar(e)},previousMonth:function(e){var t=e.curMonth,s=e.curYear;0==t?(e.curMonth=11,e.curYear=s-1):e.curMonth=t-1,this.constructCalendar(e)},populateData:function(e,t){var s=Layout.Page.container.find("#"+e.outerdivId);s.find(".ZPcalvw-month-view").scrollTop(0);var r=s.find("#moncal_body").find("tr");e.totaldata?($.each(r,(function(e,t){var s=$(r.get(e)).find("td."+TimelyCalendar.daysObj.day+",td."+TimelyCalendar.daysObj.today+",td."+TimelyCalendar.daysObj.weekend+",td."+TimelyCalendar.daysObj.leave),l=$(r.get(e)).find("td.zpcaltotal");$.each(s,(function(e,t){$(s.get(e)).data("objval","0");var r=$(s.get(e)).children().children(":eq(0)").nextAll();$(r).remove()})),$(l.get(0)).data("objval","0")})),s.find(".zpcaltotal,.zpcaltxt,.zpcalgtotal,.zpcaltot").show()):($.each(r,(function(e,t){var s=$(r.get(e)).find("td."+TimelyCalendar.daysObj.day+",td."+TimelyCalendar.daysObj.today+",td."+TimelyCalendar.daysObj.weekend+",td."+TimelyCalendar.daysObj.leave);$.each(s,(function(e,t){$(s.get(e)).data("objval","0");var r=$(s.get(e)).children().children(":eq(0)").nextAll();$(r).remove()}))})),s.find(".zpcaltotal,.zpcaltxt,.zpcalgtotal,.zpcaltot").hide());var l=s.find("#moncal_body").find("td."+TimelyCalendar.daysObj.day+",td."+TimelyCalendar.daysObj.today+",td."+TimelyCalendar.daysObj.weekend+".td."+TimelyCalendar.daysObj.leave);if($.each(t,(function(t,s){if(e.totaldata&&$(l.get(s.date-1)).data("objval",s.objval),"1"==s.type)$(l.get(s.date-1)).addClass(TimelyCalendar.daysObj.leave),$(l.get(s.date-1)).removeClass(TimelyCalendar.daysObj.day);else if(""!==s.txt){var r=$(l.get(s.date-1));let e=s.txt;showNewTab&&LVUtil.Tab.isCalendar()&&s.recordid&&(e=$(e),e.hasClass("ZPcalvw-lk")&&e.attr("href",LVUtil.urls.setModeOfViewInUrl("/summary-mode:calendar/recordId")+":"+s.recordid)),$(r).find(".ZPcalvw-month-day").after(e)}})),e.totaldata){var a=0;$.each(r,(function(e,t){var s=$(r.get(e)).find("td."+TimelyCalendar.daysObj.day+",td."+TimelyCalendar.daysObj.today+",td."+TimelyCalendar.daysObj.weekend+",td."+TimelyCalendar.daysObj.leave),l=$(r.get(e)).find("td.zpcaltotal"),n=0;$.each(s,(function(e,t){var r=$(s.get(e)).data();r.objval?n+=Number(r.objval):$(s.get(e)).data("objval","")})),a+=n,$(l.get(0)).data("objval",n),$(l.get(0)).html('<div class="MT50" align="center">'+Calendar.minstohrs(n)+"</div>")}));var n=s.find("#calbody").find("td.zpcalgtotal");$(n.get(0)).html('<div class="MT50" align="center">'+Calendar.minstohrs(a)+"</div>")}ZPCal.Calendar.showAttInfoPopUp(e)},addPopHasHrs:null,calculateTop:function(e,t,s,r){if(!0===e)0!==$("#hoursdiv").length&&null!==$("#hoursdiv").height()||(t+=60,TimelyCalendar.addPopHasHrs=!1),null!==$("#timelog_hours_time").length&&0!==$("#timelog_hours_time").length||(t+=30);else if("none"!==Layout.Page.container.find("#hoursdiv").css("display")&&void 0!==Layout.Page.container.find("#hoursdiv").css("display")||"#mdialog"!==s.id||(t+=65),"#mdialogview"===s.id){t=s.posY-250+r}return t},cellPopPosition:function(e){var t,s,r,l=23,a=30,n=20,i=0,o=0;1==ZPCal.Calendar.isDashboardCal()&&"#mdialog"===e.id&&(l-=35,a+=25,n=0,i=60,o=15);ZPeople.isZPNewUI?($("#zp_maintabs").width(),$("#zp_dash_left_panel").width()):($("#zpeople_tabs_container").width(),$("#zp_dash_left_panel").width());var c=$(window).width(),d=$(window).height();e.posY+e.heightpop<=d?(s=e.posY,e.posX+e.widthpop<=c?(t=e.posX-24,s=s+l-o,r="ZPCmn-Arrow top lt gray"):(t=e.posX-e.widthpop-15,s=s-l-i-o,r="ZPCmn-Arrow right tp gray")):(s=e.posY-e.heightpop,e.posX+e.widthpop<=c?(t=e.posX-24,r="ZPCmn-Arrow bottom lt gray",(s=s-a+n)<=0&&(s=(s=e.posY)+l-o,r="ZPCmn-Arrow top lt gray")):(t=e.posX-e.widthpop-15,r="ZPCmn-Arrow right bm gray",(s=s+a-i)<=0&&(s=(s=e.posY)-l-i-o,r="ZPCmn-Arrow right tp gray"))),Layout.Page.container.find(e.id).css({left:t,top:s}),Layout.Page.container.find(e.id).addClass(r)},calPlusPosition:function(e){Layout.Page.container.find("#error_message").remove();var t=$(e).offset().left,s=$(e).offset().top;TimelyCalendar.removeArrowClasses("#mdialog"),Layout.Page.container.find("#calpluspop2").modal("show");var r=Layout.Page.container.find("#mdialog").width();Layout.Page.container.find("#mdialog").height();var l={id:"#mdialog"};l.widthpop=r,l.heightpop=335,l.posX=t,l.posY=s,TimelyCalendar.cellPopPosition(l)},bannerHtCalc:function(){return $("#peoplebanner").is(":visible")?$("#peoplebanner").height():0},removeArrowClasses:function(e){var t=Layout.Page.container.find(e);t.removeClass("ZPCmn-Arrow top lt gray"),t.removeClass("ZPCmn-Arrow left tp gray"),t.removeClass("ZPCmn-Arrow bottom lt gray"),t.removeClass("ZPCmn-Arrow right tp gray"),t.removeClass("ZPCmn-Arrow right bm gray")},commonPositionSet:function(e){null!=e.globalposX&&null!=e.globalposY&&(Layout.Page.container.find(e.id).css({left:e.globalposX+100,top:e.globalposY-100}),e.posY=e.globalposY-10,e.posX=e.globalposX,TimelyCalendar.cellPopPosition(e))},initWeekCalendar:function(e){Layout.Page.container.find("#"+e.divid).hide();var t=Layout.Page.container.find("#"+e.outerdivId),s='<div id="weekcal" class="ZPcalvw">'+TimelyCalendar.Template.getCalendarHTML(e.calcontId,!0,e)+"</div>";t.find("#"+e.divid).html(s);var r="";-1!==Layout.Page.currentmode.indexOf("/dashboard/calendar")&&(r="ZPcalvw-dash"),t.addClass(r);var l=e.prearrow,a=e.nextarrow;t.find("."+a).off("click"),t.find("."+a).on("click",(function(){TimelyCalendar.nextWeek(e)})),t.find("."+l).off("click"),t.find("."+l).on("click",(function(){TimelyCalendar.previousWeek(e)})),this.constructWeekCalendar(e)},constructWeekCalendar:function(e){this.clearOldvalues(e,2);var t=Layout.Page.container.find("#"+e.outerdivId),s=new Date(e.curWeek.from.getFullYear(),e.curWeek.from.getMonth(),e.curWeek.from.getDate()),r=new Date(e.curWeek.to.getFullYear(),e.curWeek.to.getMonth(),e.curWeek.to.getDate());t.find("#calmonth").html("<a href='javascript:;'>"+moment(s).format(dateFmt.toUpperCase())+"&nbsp;&nbsp;&nbsp;"+ZPI18N.getString("zp.sto")+"&nbsp;&nbsp;&nbsp;"+moment(r).format(dateFmt.toUpperCase())+"</a>"),t.find(".ZP-weekcol .ZP-calline").html(""),t.find(".ZP-topcol").html(""),t.find(".contenttxt").remove();var l=e.mode,a=TimelyCalendar.getCurrentUserErecno(l),n=e.curWeek.from;if(1==e.initweekend){var i={mode:"GET_WEEKEND_DEFINITION",fromDate:Calendar.formatDate(e.curWeek.from),toDate:Calendar.formatDate(e.curWeek.to),userErecNo:a,userLocation:ZPeople.getUserDetailsById(a).locId,conreqcsr:csrfToken};$.post("/commonAction.zp",i,(function(s){for(var r=0;r<7;r++){var l=new Date(n),a=l.getFullYear()+"-"+Attendance.disTwoDigit(l.getMonth()+1)+"-"+Attendance.disTwoDigit(l.getDate());void 0!==s.weekendArray&&-1!==s.weekendArray.indexOf(a)&&($(t.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[r+1]).addClass(TimelyCalendar.daysObj.weekend),$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[r+1]).addClass(TimelyCalendar.daysObj.weekend),$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[r+1]).addClass(TimelyCalendar.daysObj.weekend)),$(t.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[r+1]).html("<span><small>"+ZPDateTime.days[l.getDay()]+"</small>"+l.getDate()+"</span>"),curdate+""==l.getDate()+""&&curmonth+""==l.getMonth()+""&&($(t.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[r+1]).addClass("Cl-today"),$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[r+1]).addClass("Cl-today"),$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[r+1]).addClass("Cl-today")),$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[r+1]).attr("date",l.getMonth()+1+"-"+l.getDate()+"-"+l.getFullYear()),n.setDate(n.getDate()+1)}$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")).on("click",(function(t){ZPCal.Calendar.showAddpopUp(t,$(this),$(this).attr("date"),e)})),n.setDate(n.getDate()-7)}))}else{for(var o=0;o<7;o++){var c=new Date(n);$(t.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[o+1]).html("<span><small>"+ZPDateTime.days[c.getDay()]+"</small>"+c.getDate()+"</span>"),curdate+""==c.getDate()+""&&curmonth+""==c.getMonth()+""&&($(t.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[o+1]).addClass("Cl-today"),$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[o+1]).addClass("Cl-today"),$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[o+1]).addClass("Cl-today")),$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[o+1]).attr("date",c.getMonth()+1+"-"+c.getDate()+"-"+c.getFullYear()),n.setDate(n.getDate()+1)}$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")).on("click",(function(t){ZPCal.Calendar.showAddpopUp(t,$(this),$(this).attr("date"),e)})),n.setDate(n.getDate()-7)}e.callback&&"function"==typeof e.callback&&e.callback(e)},populateWeekCalendar:function(e,t){var s=Layout.Page.container.find("#"+e.outerdivId);s.find(".ZPcalvw-box-scroller").scrollTop(0);for(var r,l=e.curWeek.from,a=0;a<7;a++){var n=new Date(l),i=n.getFullYear()+"-"+Attendance.disTwoDigit(n.getMonth()+1)+"-"+Attendance.disTwoDigit(n.getDate());void 0!==e.weekendarray&&-1!==e.weekendarray.indexOf(i)&&($(s.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[a+1]).addClass(TimelyCalendar.daysObj.weekend),$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[a+1]).addClass(TimelyCalendar.daysObj.weekend),$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[a+1]).addClass(TimelyCalendar.daysObj.weekend),curdate+""==n.getDate()+""&&curmonth+""==n.getMonth()+""||$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[a+1]).find("#curr_time").remove()),curdate+""==n.getDate()+""&&curmonth+""==n.getMonth()+""&&(r=$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[a+1])),l.setDate(l.getDate()+1)}l.setDate(l.getDate()-7);for(var o=0;o<t.length;o++){var c=t[o];if(void 0!==c.jobs){var d="",m=1;for(var u in c.jobs){u=c.jobs[u];var p=Calendar.minstohrs(u.jobHrs).split(":");d+='<div class="ZPcalvw-box-label '+(m>2?"DN":"")+'"><div class="ZPcalvw-box-label-txt"> <span>'+u.jobName+"</span>"+(void 0!==p?" <span>"+p[0]+"h "+p[1]+"m</span>":"")+"</div> </div>",m++}$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti .ZPcalvw-box-daynoti-hd")[o+1]).find(".ZPcalvw-box-daynoti-box").prepend(d),void 0!==c.jobs&&Object.keys(c.jobs).length>2&&$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti .ZPcalvw-box-daynoti-hd")[o+1]).append('<div class="ZPcalvw-morebox"> <a class="ZPcalvw-morebtn" id="timlog_morebtn"><span>'+(Object.keys(c.jobs).length-2)+"</span>more</a> </div>"),$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[o+1]).prepend(c.txt)}else $(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[o+1]).prepend(c.txt);if($(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[o+1]).find(".ZPcalvw-box-main-wkdayltbox").length>0){var g=$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[o+1]).find(".ZPcalvw-box-main-wkdayltbox").children().length,f=2;1==g?f="":2==g?f=2:3==g?f=3:4==g?f=4:(5==g||g>5)&&(f=5),$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[o+1]).find(".ZPcalvw-box-main-wkdayltbox").addClass("ZPcalvw-box-col"+f)}void 0!==c.attHead&&$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti .ZPcalvw-box-daynoti-hd")[o+1]).append('<h6 class="ZPcalvwbox-head">'+c.attHead+"</h6>"),void 0!==c.isFullColor&&($(s.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[o+1]).addClass(c.isFullColor),$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[o+1]).addClass(c.isFullColor),$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[o+1]).addClass(c.isFullColor))}if(0==s.find("#timlog_morebtn").length?s.find("#showAllWkHdrbtn").addClass("DN"):s.find("#showAllWkHdrbtn").removeClass("DN"),s.find("#showAllWkHdrbtn").off("click").removeClass("active"),s.find("[id='timlog_morebtn']").on("click",(function(){TimelyCalendar.showHideWeekHeader(e,$(this))})),s.find("#showAllWkHdrbtn").on("click",(function(){TimelyCalendar.showAllWkHeader(e,$(this))})),s.find("#"+e.divid).show(),s.find(".ZPcalvw-box-scroller").css("top",Layout.Page.container.find(".ZPcalvw").height()+(ZPeople.isZPNewUI()?45:40)+"px"),ZPCal.checkIsToday(e,"2")&&void 0!==r&&r.length>0){var v=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),h=60*v.getUTCHours()*1.1667+1.1667*v.getUTCMinutes();r.find("#curr_time").html('<span class="DN">'+ZPDateTime.getDisplayTime(v,!Calendar.is12HrFormat())+"</span>"),r.find("#curr_time").on("mouseover",(function(e){e.stopPropagation(),TimelyCalendar.showCurrTime(r.find("#curr_time"))})),r.find("#curr_time").on("mouseleave",(function(e){e.stopPropagation(),TimelyCalendar.showCurrTime(r.find("#curr_time"))})),r.find("#curr_time").removeClass("DN"),r.find("#curr_time").css("top",h+"px"),this.setCurrTime(s,r),r.find("#curr_time").is(":visible")&&void 0!==r.find("#curr_time").offset()&&("selfservice/user/calendar"!==Layout.Page.currentmode?s.find(".ZPcalvw-box-scroller").animate({scrollTop:r.find("#curr_time").offset().top-400}):Layout.Page.parentContainer.find(".Scrcont").animate({scrollTop:r.find("#curr_time").offset().top-400}))}else r.find("#curr_time").addClass("DN")},showHideWeekHeader:function(e,t){var s=!1;if(t.parents(".ZPcalvw-box-tdbox").find("#showAllWkHdrbtn").hasClass("active")){Layout.Page.container.find("#"+e.outerdivId),t.parent().siblings();t.parent().hasClass("DN")&&(s=!0,t.parents(".ZPcalvw-box-tdbox").find("#showAllWkHdrbtn").removeClass("active"))}else t.parents(".ZPcalvw-box-tdbox").find("#showAllWkHdrbtn").addClass("active");1!=s?(t.parent().addClass("DN"),$(t.parent().siblings(".ZPcalvw-box-daynoti-box")[0]).children().removeClass("DN")):(t.parent().removeClass("DN"),t.siblings(".ZPcalvw-box-daynoti-box").children().addClass("DN"),$(t.siblings(".ZPcalvw-box-daynoti-box").children()[0]).removeClass("DN"),$(t.siblings(".ZPcalvw-box-daynoti-box").children()[1]).removeClass("DN")),Layout.Page.container.find(".ZPcalvw-box-scroller").css("top",Layout.Page.container.find(".ZPcalvw").height()+(ZPeople.isZPNewUI()?45:40)+"px")},showAllWkHeader:function(e,t){var s=Layout.Page.container.find("#"+e.outerdivId),r=t.parent().siblings(),l=!1;t.hasClass("active")&&(l=!0);for(var a=0;a<r.length;a++)l?(t.removeClass("active"),$(r[a]).find(".ZPcalvw-box-daynoti-box").children().addClass("DN"),$(r[a]).children(".ZPcalvw-morebox").removeClass("DN"),$($(r[a]).find(".ZPcalvw-box-daynoti-box").children()[0]).removeClass("DN"),$($(r[a]).find(".ZPcalvw-box-daynoti-box").children()[1]).removeClass("DN")):(t.addClass("active"),$(r[a]).find(".ZPcalvw-box-daynoti-box").children().removeClass("DN"),$(r[a]).children(".ZPcalvw-morebox").addClass("DN"));s.find(".ZPcalvw-box-scroller").css("top",Layout.Page.container.find(".ZPcalvw").height()+(ZPeople.isZPNewUI()?45:40)+"px")},setCurrTime:function(e,t){setInterval((function(){var s=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),r=60*s.getUTCHours()*1.1667+1.1667*s.getUTCMinutes();null==t&&(t=e),t.find("#curr_time").html("<span>"+ZPDateTime.getDisplayTime(s,!Calendar.is12HrFormat())+"</span>"),t.find("#curr_time").css("top",r+"px")}),1e4)},initDayCalendar:function(e){var t=Layout.Page.container.find("#"+e.outerdivId),s='<div id="weekcal" class="ZPcalvw">'+(s=TimelyCalendar.Template.getCalendarHTML(e.calcontId,!1,e))+"</div>";t.find("#"+e.divid).html(s);var r=e.prearrow,l=e.nextarrow;t.find("."+l).off("click"),t.find("."+l).on("click",(function(){TimelyCalendar.nextDay(e)})),t.find("."+r).off("click"),t.find("."+r).on("click",(function(){TimelyCalendar.previousDay(e)})),this.constructDayCalendar(e),$("#"+e.divid).show()},populateDayCalendar:function(e,t){for(var s=Layout.Page.container.find("#"+e.outerdivId),r=0;r<t.length;r++){var l=t[r];if($(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[r+1]).prepend(l.txt),$(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[r+1]).find(".ZPcalvw-box-main-wkdayltbox").length>0){var a=$($("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[r+1]).find(".ZPcalvw-box-main-wkdayltbox").children().length,n="";2==a?n=2:3==a?n=3:(4==a||a>4)&&(n=4),$($("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[r+1]).find(".ZPcalvw-box-main-wkdayltbox").addClass("ZPcalvw-box-col"+n)}}var i=e.dateObj,o=i.getFullYear()+"-"+Attendance.disTwoDigit(i.getMonth()+1)+"-"+Attendance.disTwoDigit(i.getDate());void 0!==e.weekendarray&&-1!==e.weekendarray.indexOf(o)?$($($(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).find(".ZPcalvw-box-bgcol")[0])).addClass(TimelyCalendar.daysObj.weekend):$($($(s.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).find(".ZPcalvw-box-bgcol")[0])).removeClass(TimelyCalendar.daysObj.weekend),s.find("#"+e.divid).show()},nextDay:function(e){var t=e.curMonth,s=e.curYear,r=e.curdate;1!==t?0==t||2==t||4==t||6==t||7==t||9==t||11==t?31===r?(e.curdate=1,e.curMonth=t+1):e.curdate=r+1:-1!==t?30===r?(e.curdate=1,e.curMonth=t+1):e.curdate=r+1:-1===t&&(28===r&&s%4==0?e.curdate=r+1:29===r?(e.curdate=1,e.curMonth=t+1):e.curdate=r+1):1==t?s%4==0?29==r?(e.curdate=1,e.curMonth=t+1):e.curdate=r+1:28==r?(e.curdate=1,e.curMonth=t+1):e.curdate=r+1:12==t&&(e.curMonth=0,e.curYear=s+1);var l=new Date;l.setFullYear(e.curYear,e.curMonth,e.curdate),e.curDay=l.getDay(),e.dateObj=l,this.constructDayCalendar(e)},previousDay:function(e){var t=e.curMonth,s=e.curYear,r=e.curdate;1===r?1==t||3==t||5==t||6==t||7==t||8==t||10==t?(e.curdate=31,e.curMonth=t-1):2==t?(e.curdate=s%4==0?29:28,e.curMonth=t-1):(e.curdate=30,e.curMonth=t-1):e.curdate=r-1,-1==e.curMonth&&(e.curMonth=11,e.curYear=s-1);var l=new Date;l.setFullYear(e.curYear,e.curMonth,e.curdate),e.curDay=l.getDay(),e.dateObj=l,this.constructDayCalendar(e)},constructDayCalendar:function(e){var t=Layout.Page.container.find("#"+e.outerdivId);t.find(".ZPcalvw-box-scroller").scrollTop(0),this.clearOldvalues(e,1);var s=new Date(e.dateObj.getFullYear(),e.dateObj.getMonth(),e.dateObj.getDate());if(t.find("#calmonth").html("<a href='javascript:;'>"+moment(s).format(dateFmt.toUpperCase())+"</a>"),t.find("#today_name").text(ZPDateTime.days_long[e.curDay]),$(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).on("click",(function(t){var s=e.curMonth+1+"-"+e.curdate+"-"+e.curYear;ZPCal.Calendar.showAddpopUp(t,$(this),s,e)})),1==e.initweekend){var r=Calendar.formatDate(e.dateObj),l=calendarObj.mode,a=TimelyCalendar.getCurrentUserErecno(l),n={mode:"GET_WEEKEND_DEFINITION",fromDate:r,toDate:r,userErecNo:a,userLocation:ZPeople.getUserDetailsById(a).locId,conreqcsr:csrfToken};$.post("/commonAction.zp",n,(function(s){var r=e.dateObj,l=r.getFullYear()+"-"+Attendance.disTwoDigit(r.getMonth()+1)+"-"+Attendance.disTwoDigit(r.getDate());void 0!==s.weekendArray&&-1!==s.weekendArray.indexOf(l)?$($($(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).find(".ZPcalvw-box-bgcol")[0])).addClass(TimelyCalendar.daysObj.weekend):$($($(t.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).find(".ZPcalvw-box-bgcol")[0])).removeClass(TimelyCalendar.daysObj.weekend)}))}if(e.callback&&"function"==typeof e.callback&&e.callback(e),t.find(".ZPcalvw-box-scroller").css("top",Layout.Page.container.find(".ZPcalvw").height()+(ZPeople.isZPNewUI()?45:40)+"px"),ZPCal.checkIsToday(e,"1")){var i=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),o=60*i.getUTCHours()*1.1667+1.1667*i.getUTCMinutes();t.find("#curr_time").html('<span class="DN">'+ZPDateTime.getDisplayTime(i,!Calendar.is12HrFormat())+"</span>"),t.find("#curr_time").on("mouseover",(function(e){e.stopPropagation(),TimelyCalendar.showCurrTime(t.find("#curr_time"))})),t.find("#curr_time").on("mouseleave",(function(e){e.stopPropagation(),TimelyCalendar.showCurrTime(t.find("#curr_time"))})),t.find("#curr_time").css("top",o+"px"),t.find("#curr_time").removeClass("DN"),this.setCurrTime(t),t.find("#curr_time").is(":visible")&&void 0!==t.find("#curr_time").offset()&&t.find(".ZPcalvw-box-scroller").animate({scrollTop:t.find("#curr_time").offset().top-400})}else t.find("#curr_time").addClass("DN")},showCurrTime:function(e){$(e).find("span").hasClass("DN")?$(e).find("span").removeClass("DN"):$(e).find("span").addClass("DN")},getCurrentUserErecno:function(e){return"leave"===e&&void 0!==Leave.View.SELECTED_USER.id?Leave.View.SELECTED_USER.id:"timesheet"===e?Timetracker.timelogs.tserecno:"attendance"===e&&null!==Attendance.Entry.erecno?Attendance.Entry.erecno:"bday"===e?ZPeople.CURR_USER.usererec:ZPCal.getCurrUser()},clearOldvalues:function(e,t,s){var r=Layout.Page.container.find("#"+e.outerdivId);if(1==t){var l=$(r.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td"));$.each(l,(function(e,t){$(l[e]).html("")}))}else if(2==t){l=$(r.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td"));$.each(l,(function(e,t){$(l[e]).html(""),$(l[e]).html('<div class="ZPcalvw-box-main-crnttime DN" id="curr_time"></div>'),$(l[e]).removeClass("Cl-today"),$(l[e]).removeClass("Cl-wked"),$(l[e]).removeClass("Cl-hlday")})),l=r.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti").find("td"),$.each(l,(function(e,t){$(l[e]).find(".ZPcalvw-box-daynoti-box").html(""),$(l[e]).find(".ZPcalvw-box-daynoti-box").siblings().remove(),$(l[e]).removeClass("Cl-today"),$(l[e]).removeClass("Cl-wked"),$(l[e]).removeClass("Cl-hlday")})),r.find("#weekcal .ZPcalvw-box-head").find(".Cl-today").removeClass("Cl-today"),r.find("#weekcal .ZPcalvw-box-head").find(".Cl-wked").removeClass("Cl-wked"),r.find("#weekcal .ZPcalvw-box-head").find(".Cl-hlday").removeClass("Cl-hlday")}else if(3==t){l=r.find("#"+e.divid).find(".ZPcalvw-box.ZPcalvw-month-view").find("#moncal_body").find("td.findday,td."+TimelyCalendar.daysObj.day+",td."+TimelyCalendar.daysObj.today+",td."+TimelyCalendar.daysObj.weekend+",td."+TimelyCalendar.daysObj.leave+",td.zpcaltotal");$.each(l,(function(e,t){1==s?($(l[e]).find("#timelog_div").remove(),$(l[e]).find(".ZPcalvw-month-item").remove(),$(l[e]).find(".zpl_shftdts").remove(),$(l[e]).hasClass("zpcaltotal")&&$(l[e]).html("")):$(l[e]).html("")}))}},inArray:function(e,t){for(var s in t){var r=t[s];if((r=r.toString())==e)return!0}return!1},toggleCalendar:function(e){"0"===e?(Layout.Page.container.find("#monthcal").removeClass("DN"),Layout.Page.container.find("#weekcal").addClass("DN")):"1"===e&&(Layout.Page.container.find("#monthcal").addClass("DN"),Layout.Page.container.find("#weekcal").removeClass("DN"))},getCurrentWeek:function(){var e=new Date(curyear,curmonth,curdate),t=e.getDay(),s=e.getDate();return t<weekstarts&&(s-=7),this.weekfromdate=new Date(curyear,curmonth,curdate),this.weekfromdate.setDate(s-t+weekstarts),this.weektodate=new Date(curyear,curmonth,curdate),this.weektodate.setDate(s-t+6+weekstarts),{from:this.weekfromdate,to:this.weektodate}},getNextWeek:function(e){return void 0!==e&&(this.weektodate=e.to,this.weekfromdate=e.from),this.weektodate.setDate(this.weektodate.getDate()+7),this.weekfromdate.setDate(this.weekfromdate.getDate()+7),{from:this.weekfromdate,to:this.weektodate}},getPreviousWeek:function(e){return void 0!==e&&(this.weektodate=e.to,this.weekfromdate=e.from),this.weektodate.setDate(this.weektodate.getDate()-7),this.weekfromdate.setDate(this.weekfromdate.getDate()-7),{from:this.weekfromdate,to:this.weektodate}},nextWeek:function(e){for(var t=new Array,s=e.curWeek.to,r=0;r<7;r++)s.setDate(s.getDate()+1),t.push(new Date(s));e.curWeek.from.setDate(e.curWeek.from.getDate()+7),e.curWeek.days=t,this.constructWeekCalendar(e)},previousWeek:function(e){var t=new Array,s=e.curWeek.from;s.setDate(s.getDate()-8);for(var r=0;r<7;r++)s.setDate(s.getDate()+1),t.push(new Date(s));e.curWeek.to.setDate(e.curWeek.to.getDate()-7),e.curWeek.from.setDate(e.curWeek.from.getDate()-6),e.curWeek.days=t,this.constructWeekCalendar(e)},getCurrentWeekdays:function(){var e=new Date(curyear,curmonth,curdate),t=e.getDay(),s=e.getDate();t<weekstarts&&(s-=7);var r=new Date(curyear,curmonth,curdate);r.setDate(s-t+weekstarts);var l=new Date(curyear,curmonth,curdate);l.setDate(s-t+6+weekstarts);var a={};a.days=new Array;var n=r;a.days.push(new Date(n));for(var i=0;i<6;i++)n.setDate(n.getDate()+1),a.days.push(new Date(n));return r.setDate(r.getDate()-6),a.weekfromdate=r,a.weektodate=l,a}};TimelyCalendar.Template={getSingleCalendar:function(e,t){var s=this.getOuter("singlecalendardiv",void 0,void 0!==e);return void 0!==e?"from"===e?s.find("#header").append(this.getNavigators(!1)):s.find("#header").append(this.getNavigators(!0,void 0,!0)):s.find("#header").append(this.getNavigators(!0,void 0,void 0,t)),s.find("#calbody").append(this.getDayHeader()).append(this.getDates()),s.find("#caltimeview").append(this.getTimeOption()),s},getDoubleCalendar:function(){var e=this.getOuter("doublecalendardiv",!0);e.find("#fromcalendar").find("#header").append(this.getNavigators(!1)),e.find("#tocalendar").find("#header").append(this.getNavigators(!0,!0));var t=this.getDayHeader(),s=this.getDates();return e.find("#fromcalendar").find("#calbody").append(t).append(s),e.find("#tocalendar").find("#calbody").append(t).append(s),e},getDayHeader:function(){var e='<tr class="dayslist">';for(var t in days)e+='<td class="name">'+days[t]+"</td>";return e+"</tr>"},getOuter:function(e,t,s){var r=$('<div class="ZPcalsha DN" id="'+e+'" style="position: absolute;"></div>'),l='<table class="ZPUsel" width="100%" cellspacing="0" cellpadding="0" border="0"><tbody id="header"></tbody><tbody id="calbody"></tbody><tbody id="moncalbody" class="mnthView"></tbody><tbody id="yearcalbody" class="yearView"></tbody><tfoot id="caltimeview"></tfoot></table>';return t?r.append('<div class="zpfcal" id="fromcalendar">'+l+'</div><div class="zpfcal" id="tocalendar">'+l+"</div>"):r.append('<div class="'+(!0!==s?"zpfcal":"")+'">'+l+"</div>"),r},getNavigators:function(e,t,s,r){return'<tr class="monnav calnav" id="cal_close"><td colspan="7">'+(e?'<div class="IC-cls gry S13 CP FR MR8" '+(s?' onclick="Calendar.hideDoubleCalendar();"></div>':'onclick="Calendar.hideSingleCalendar();"></div>')+(t?'<div class="IC-rfesh gry S16 CP FR MR10"></div>':""):"&nbsp;")+'</td></tr><tr class="monnav"><td colspan="7"><div class="IC-ar-lft gry S16 CP FL ML5"></div><span id="calmonth" box="1"></span><div class="IC-ar-rgt gry S16 CP FR MR5"></div></td></tr>'},getDates:function(){for(var e="",t=0;t<7;t++){e+='<tr class="datelist">';for(var s=0;s<7;s++)e+='<td class="day"><div class="zpflc"><span class="num">0</span></div></td>';e+="</tr>"}return e},getTimeOption:function(){var e='<tr class="monnav monnav1 DN"><td align="center" colspan="7"><input type="text"  id="hrs" class="form-control" placeholder="HH" maxlength="2"> : <input type="text"  class="form-control" id="minutes" placeholder="MM" maxlength="2"> : ';return"hh:mm a"===timeFormat?e+='<input type="text"  class="form-control" id="ampm" placeholder="AM" maxlength="2"></td>':e+='<input type="text"  class="form-control" id="seconds" placeholder="SS" maxlength="2"></td>',e+"</tr>"},getMonthlyCalendar:function(e,t){var s,r="";if(e){for(r+='<div class="ZPcalvw-cnt ZPcalvw-thtd"><div class="ZPcalvw-box zp-Week-view"><table>',r+='<thead class="ZPcalvw-box-head"><tr><td class="ZPcalvw-box-tdbox"><div class="ZPcalvw-box-headrow ZPcalvw-row"> <table> <thead> <tr>',s=0;s<8;s++)r+='<th class="ZPcalvw-box-dayheader '+(0==s?" W60":"")+'"></th>';for(r+="</tr></thead></table></div></td></tr></thead>",r+='<tbody class="ZPcalvw-box-body"><tr><td class="ZPcalvw-box-tdbox">',r+='<div class="ZPcalvw-box-daynoti ZPcalvw-row"> <table> <tbody> <tr>',s=0;s<8;s++)r+='<td class="ZPcalvw-box-daynoti-hd '+(0==s?" W60":"")+'">'+(0==s?' <a class="ZPcalvw-box-daynoti-close" id="showAllWkHdrbtn"> <i class="IC-ar-dwn"></i></a>':'<div class="ZPcalvw-box-daynoti-box"> </div>')+"</td>";for(r+="</tr></tbody></table></div>",r+='<div class="ZPcalvw-box-main ZPcalvw-box-scroller"><div class="ZPcalvw-box-mainbox">',r+='<div class="ZPcalvw-box-bg ZPcalvw-box-bg-timegd"><table><tbody><tr>',s=0;s<8;s++)r+='<td class="'+(0==s?" W60":"")+'"></td>';if(r+="</tr></tbody></table></div>",r+='<div class="ZPcalvw-box-main-slots"> <table> <tbody>',Calendar.is12HrFormat()){for(r+='<tr><td class=" W60"><span>12 '+ZPI18N.getString("zp.am")+"</span></td><td></td></tr>",s=1;s<12;s++)r+="<tr><td><span>"+s+"&nbsp;"+ZPI18N.getString("zp.am")+"</span></td><td></td></tr>";for(r+="<tr><td><span>12 "+ZPI18N.getString("zp.pm")+"</span></td><td></td></tr>",s=1;s<12;s++)r+="<tr><td><span>"+s+"&nbsp;"+ZPI18N.getString("zp.pm")+"</span></td><td></td></tr>"}else for(s=0;s<24;s++)r+="<tr><td><span>"+(s<10?"0"+s:s)+":00&nbsp;</span></td><td></td></tr>";r+="</tbody></table></div>",r+='<div class="ZPcalvw-box-main-wkdaylt"> <table> <tbody> <tr>';for(var l=0;l<8;l++)r+="<td "+(0==l?'class="W60':"")+'><td> <div class="ZPcalvw-box-main-wkdayltbox"></div></td></td>';r+="</tr></tbody></table></div>",r+="</td></tr></tbody>",r+="</div></div>"}else{r+='<div class="ZPcalvw-cnt ZPcalvw-thtd">',r+='<div class="ZPcalvw-month-hd ZPcalvw-row"> <table> <tbody><tr>';for(var a=weekstarts,n=0;n<days.length;n++)r+="<td><small>"+days[a]+"</small></td>",a=a>5?0:a+1;"timesheet"==t.mode&&(r+="<td><small>"+ZPI18N.getString("zp.totalhours")+"</small></td>"),r+="</tr> </tbody></table></div>",r+='<div class="ZPcalvw-box ZPcalvw-month-view"><table><tbody class="ZPcalvw-box-body"> <tr> <td class="ZPcalvw-box-tdbox"><div class="ZPcalvw-box-main"> <div class="ZPcalvw-box-mainbox ZPcalvw-row"> <table class="ZPcalvw-month-tb zpl_nocrsor" id="moncal_body"><tbody>';for(var i=0;i<6;i++){for(r+="<tr>",s=0;s<7;s++)r+='<td class="findday"></td>';"timesheet"===t.mode&&(r+='<td class="zpcaltotal"></td>'),r+="</tr>"}r+="</tbody></table></div></div></td></tr></tbody></table></div></div>"}return r},getDayCalendar:function(){var e='<div class="ZPcalvw-cnt ZPcalvw-thtd"> <div class="ZPcalvw-box ZPcalvw-today"><table class="ZPcalvw-today-maintb">';if(e+='<thead class="ZPcalvw-box-head"><tr><td class="ZPcalvw-box-tdbox"><div class="ZPcalvw-box-headrow ZPcalvw-box-today-head ZPcalvw-row"><table><thead><tr><th><span id="today_name">Thingal</span></th></tr></thead></table></div></td></tr></thead>',e+='<tbody class="ZPcalvw-box-body"><tr><td class="ZPcalvw-box-tdbox"><div class="ZPcalvw-box-main ZPcalvw-box-scroller"><div class="ZPcalvw-box-mainbox">',e+='<div class="ZPcalvw-box-bg ZPcalvw-box-bg-timegd"> <table> <tbody> <tr> <td class=" W60"></td> <td></td> </tr> </tbody> </table> </div>',e+='<div class="ZPcalvw-box-main-slots"><table><tbody>',Calendar.is12HrFormat()){e+='<tr><td style="width: 60px;"><span>12 '+ZPI18N.getString("zp.am")+"</span></td><td></td></tr>";for(var t=1;t<12;t++)e+="<tr><td><span>"+t+"&nbsp;"+ZPI18N.getString("zp.am")+"</span></td><td></td></tr>";e+="<tr><td><span>12 "+ZPI18N.getString("zp.pm")+"</span></td><td></td></tr>";for(var s=1;s<12;s++)e+="<tr><td><span>"+s+"&nbsp;"+ZPI18N.getString("zp.pm")+"</span></td><td></td></tr>"}else for(t=0;t<24;t++)e+="<tr><td><span>"+(t<10?"0"+t:t)+":00&nbsp;</span></td><td></td></tr>";return e+="</tbody></table></div>",e+='<div class="ZPcalvw-box-main-today"></div>',e+='<div class="ZPcalvw-box-main-crnttime posfl0 DN" id="curr_time"></div>',e+="</div></div></td></tr></tbody></table></div></div>"},getCalendarHTML:function(e,t,s){return"monthcalendardiv"===e?this.getMonthlyCalendar(t,s):"daycalendardiv"===e?this.getDayCalendar():"fromcalendar"===e?TimelyCalendar.Template.getSingleCalendar("from").html():"tocalendar"===e?TimelyCalendar.Template.getSingleCalendar("to").html():TimelyCalendar.Template.getSingleCalendar(void 0,s.weekselection).html()}};var lmsPlan={initiate(){ZPeople.FireScroll.reset(),planUI.Layout.clearElem(this.elem),planUI.Layout.initiate(this.elem),this.elem.append(planUI.Layout.constructHeaderContainer(),planUI.Layout.constructBodyContainer(),planUI.Layout.constructFilterContainer()),planUtil.Filter.registerFilterInstance(),planAction.PlanOps.fetchPlans()},close(){ZPeople.FireScroll.setParam("triggered",!0),planUtil.Filter.instance&&planUtil.Filter.instance.closeFilter(),lmsbase.closeMaskv5()}};const planUI=function(){return{Layout:{clearElem:function(e){e&&e.replaceChildren()},initiate:function(e){let t=e.closest(".zpl_iwrpr");t.tabIndex=lmsConstants.TAB_INDEX.ACTIVE,t.ariaLabel=ZPI18N.getString("zp.common.page.active",[ZPI18N.getString("zp.lms.learningplan.learningpath")])},constructHeaderContainer:function(){const e=lmsdocument.createElement("div",{class:"zpl_btnmnu",id:"planHdr"}),t=lmsdocument.createElement("div",{class:"zpl_rgt"});planUtil.Perm.isMyPlansView()&&planUtil.Perm.canAddLp()&&t.appendChild(function(){const e=lmsdocument.parseStringToDOMElement(`<div class="zpl_splitbtn">\n                                                                <div>\n                                                                    <button class="zlabel zlabel--blue zlabel--medium" tabindex="${lmsConstants.TAB_INDEX.INACTIVE}">\n                                                                        ${ZPI18N.getString("zp.lms.learningplan.addlearningplan")}\n                                                                    </button>\n                                                                </div>\n                                                            </div>`);return planEvents.setupAddLpEvent(e),e}());return e.appendChild(t),e},constructBodyContainer:function(){const e=lmsdocument.createElement("div",{class:"zpl_rgtcnt"});return e.appendChild(lmsdocument.createElement("div",{class:"zpl_crdgrid",id:"planList"})),e},constructFilterContainer:function(){return lmsdocument.createElement("div",{class:"zpl_fltr",id:"filterBox"})},renderLoadBar:function(){e(),t().appendChild(lmsdocument.parseStringToDOMElement(ZPeople.LOADING_HTML))},getContainer:t,getListCont:s,getHeaderCont:r,displayNoData:n},Card:{constructPlanTab:function(t,d){if(e(),planUtil.Perm.canAddLp()&&function(){i()||o()||r().querySelector(".zpl_rgt").append(function(){let e=lmsdocument.parseStringToDOMElement(`<i class="zpl_ibg PI_lens" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" aria-label="${ZPI18N.getString("zp.lens")}" title="${ZPI18N.getString("zp.search")}"></i>`);return planEvents.setupSearchIconEvent(e),e}(),function(){let e=lmsdocument.parseStringToDOMElement(`<i class="zpl_ibg PI_fltr" title="${ZPI18N.getString("zp.filter")}"></i>`);return planEvents.setupFilterEvent(e),e}())}(),!t.length)return n(d),void(!r().querySelector(".search-cmn")&&!c()&&!a()&&function(){if(planUtil.Perm.canAddLp())return;void(i()&&i().remove())&&o()&&o().remove()}());s().classList.add("zpl_crdgrid"),s().role="list",s().ariaLabel=ZPI18N.getString("zp.wcag.proceedingto.list",[ZPI18N.getString("zp.lms.learningplans")]),s().tabIndex=lmsConstants.TAB_INDEX.ACTIVE,function(e){e.forEach((e=>{const t=l(e);s().appendChild(t),planEvents.setupPlanCardEvents(e,t)}))}(t)},createPlanCard:l,removePlanCard:function(e){planUI.Layout.getListCont().querySelector(`#plan_${e}`)&&planUI.Layout.getListCont().querySelector(`#plan_${e}`).remove()}},Finder:{constructSearchBox:function(){let e=lmsdocument.parseStringToDOMElement(`<div class="search-cmn opn">\n                                                                            <i class="PI_lens"></i>\n                                                                            <input type="text" class="ztextbox" placeholder="${ZPI18N.getString("zp.search")}" autofocus/>\n                                                                            <i class="PI_cls" id="closeSearch" title="${ZPI18N.getString("zp.close")}"></i>\n                                                                        </div>`);r().append(e),planEvents.setupSearchInputEvent(e.querySelector("input")),planEvents.setupCloseSearchEvent(e.querySelector("#closeSearch"))},closeSearchBox:function(){r().querySelector(".search-cmn").remove()},isFilterApplied:c},Popup:{constructDisableMask:function(e,t){let s=lmsbase.constructMaskv5("zpl_mcenter",!0),r=t?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable");s.innerHTML=`<div class="zpl_minr">\n                            <div class="zpl_mhder">\n                        <div>\n                            <h4>${r+" "+ZPI18N.getString("zp.lms.learningplan")}</h4>\n                        </div>\n                        <a class="_cls PI_cls" title="${ZPI18N.getString("zp.lms.close")}" id="closeMask"></a>\n                    </div>\n                            <div class="zpl_mcnt zpl_fm">\n                        <form>\n                            <div class="zpl_crd">\n                                <div class="zpl_crdcnt">\n                                    <div class="zpl_secn">\n                                        <div><label>${ZPI18N.getString("zp.lms.messages.comments")}</label></div>\n                                        <div><textarea class="ztextbox" id="disableComment" placeholder="${ZPI18N.getString("zp.apprCmtMandatoryErr")}"></textarea></div>\n                                    </div>\n                                 </div>   \n                            </div>\n                        </form>\n                    </div>\n                            <div class="zpl_mfoter">\n                        <button class="zlabel zlabel--blue zlabel--medium" type="button" id="disablePlan">${r}</button>\n                    </div>\n                          </div>`,planEvents.setupDisableMaskEvents(e,s,t)}}};function e(){let e=t().querySelector("#zp_page_loading");e&&e.remove()}function t(){return lmsbase._refer.container}function s(){return t().querySelector("#planList")}function r(){return t().querySelector("#planHdr")}function l(e){const{planInfo:t={},userInfo:r={}}=e;let l=`<div class="zpl_Cr zpl_grpcrs" id="plan_${e.planId}" role="listitem" tabindex="${lmsConstants.TAB_INDEX.ACTIVE}" aria-label="${function(e){let t=s().childNodes.length+1;return`${ZPI18N.getString("zp.lms.learningplan")} ${t}: ${e}`}(t.planName)}">\n                                ${function(e,t){const s=function(e,t){if(t.isSystem)return null!=t.imageUrl?t.imageUrl:ZPeople.getResourceURL(hrImageUrl+"lmsbg/cat"+t.image+".svg");return t.additionalInfo={fileId:e,type:8},lmsfileaction.generateSourceURL(t)}(e,t.planImageInfo);let r=t.planImageInfo.isSystem?"CBg"+(t.planImageInfo.image%4+1):"";return`<div style="background: url('${s}') right/cover" class="zpl_Crh ${r}"></div>`}(e.planId,t)}\n                                ${planUtil.Perm.isPlanAdmin(t,r)?function(e,t){return`<i class="PI_more" id="planMore_${e}" title="${ZPI18N.getString("zp.lms.more")}"></i>\n                    ${function(e,t){const{publishState:s,disabled:r}=t,l=1==s?"true"==r?"PI_tick2":"PI_disable":"PI_delete",a=1==s?"true"==r?ZPI18N.getString("zp.enable"):ZPI18N.getString("zp.disable"):ZPI18N.getString("zp.delete");return`<div id="planMoreMenu_${e}" class="zpl_drpdwn" data-type="list" data-content-type="icon-text">\n                <li data-icon-class="${l}" class="${1==s?"true"!=r?"red":"":"red"}"> ${a} </li>\n            </div>`}(e,t)}`}(e.planId,t):""}\n                                ${function(e,t,s){return`<div class="zpl_Crc">\n                        <h4 title="${t.planName}">${t.planName}</h4>\n                        <label>\n                            <em>${(null!=t.activeCourseCount?t.activeCourseCount:0)+" "+ZPI18N.getString("zp.lms.trainers.Courses")}</em>\n                        </label>\n                        ${function(e,t,s){if(!planUtil.Perm.isPlanAdmin(t,s))return s.isUserJoinedPlan||s.isUserCompletedPlan?`<div> \n                                <div class="zpl_whtbg ${s.isUserCompletedPlan?"grn":"ylw"}">\n                                    ${s.isUserCompletedPlan?ZPI18N.getString("zp.completed"):ZPI18N.getString("zp.chkinprogress")}\n                                </div> \n                            </div>`:`<div>\n                                <button class="zlabel zlabel--blue zlabel--medium" id="enrollPlan_${e}">\n                                    ${ZPI18N.getString("zp.lms.course.coursejoinnow")}\n                                </button>\n                            </div>`;return""}(e,t,s)}\n                    </div>`}(e.planId,t,r)}\n                            </div>`;return lmsdocument.parseStringToDOMElement(l)}function a(){return planUI.Layout.getListCont().querySelector("[id ^= 'plan_']")}function n(e){if(a())return;s().classList.remove("zpl_crdgrid");let t=lmsnodata.noDatav5[planUtil.Perm.isMyPlansView()?"myPlans":"applicablePlans"][e];new EmptyPages("zp_nd_nolearning",t.title,t.desc,$(s())).show()}function i(){return r().querySelector(".PI_lens")}function o(){return r().querySelector(".PI_fltr")}function c(){return!!planUI.Layout.getContainer().querySelector("#lmsApplFil")}}(),planEvents={setupAddLpEvent:function(e){lmsbase.addListener(e,"click",(()=>{planAction.PlanOps.addLearningPlan()}))},setupPlanCardEvents:function(e,t){(function(e,t){lmsbase.addListener(t,"click",(()=>{planAction.PlanOps.navigateToPlanPage(e)}))})(e.planId,t),function(e,t){t.querySelector(`#enrollPlan_${e}`)&&lmsbase.addListener(t.querySelector(`#enrollPlan_${e}`),"click",(()=>{event.stopPropagation(),planAction.PlanOps.enrollPlan(e)}))}(e.planId,t),function(e,t){t.querySelector(`#planMore_${e}`)&&lmsbase.addListener(t.querySelector(`#planMore_${e}`),"click",(()=>{event.stopPropagation(),planAction.More_Menu.showMoreMenu(e)}))}(e.planId,t),planUtil.Perm.isPlanAdmin(e.planInfo,e.userInfo)&&function(e,t){planAction.More_Menu.destroyMoreMenu(e),ZPeopleComponents.menu($(`#planMoreMenu_${e}`),{forElement:planUI.Layout.getListCont().querySelector(`#planMore_${e}`),appendTo:planUI.Layout.getListCont(),itemclick:planAction.More_Menu.executeMoreMenuAction(e,t),show:e=>{e.detail.forElement.addClass("zpl_act")},hide:e=>{e.detail.forElement.removeClass("zpl_act")}})}(e.planId,e.planInfo)},setupSearchIconEvent:function(e){lmsbase.addListener(e,"click",planUI.Finder.constructSearchBox)},setupSearchInputEvent:function(e){lmsbase.addListener(e,"keyup",(e=>{if(13!=e.keyCode)return;const t=e.target;let s=t.value;t.getAttribute("data-prev")!=s.trim()&&(t.setAttribute("data-prev",s.trim()),planAction.Finder.searchPlans(s))}))},setupCloseSearchEvent:function(e){function t(e){"keyup"==e.type&&27!==e.keyCode||(planAction.Finder.closeSearch(),lmsbase.removeListener(document,"keyup",t))}lmsbase.addListener(e,"click",t),lmsbase.addListener(document,"keyup",t)},setupFilterEvent:function(e){lmsbase.addListener(e,"click",(()=>{planUtil.Filter.instance.constructFilter()}))},setupDisableMaskEvents:function(e,t,s){lmsbase.addListener(t.querySelector("#closeMask"),"click",lmsbase.closeMaskv5),lmsbase.addListener(t.querySelector("#disablePlan"),"click",(()=>{planAction.PlanOps.disablePlan(e,s)}))}},planAction=function(){return{PlanOps:{addLearningPlan:function(t){const s={planName:t||ZPI18N.getString("zp.lms.learningplan.untitled"),image:Math.floor(Math.random()*Math.floor(44))+1};planApi.addLearningPlan((t=>{e(t[1].planId);let r=function(e,t){return{planId:e,planInfo:{planImageInfo:{isSystem:!0,image:t.image},isPlanOwner:!0,publishState:!1,disabled:!1,planName:t.planName}}}(t[1].planId,s),l=planUI.Card.createPlanCard(r);planUI.Layout.getListCont().querySelector("#emptPage")&&(planUI.Layout.clearElem(planUI.Layout.getListCont()),planUI.Layout.getListCont().classList.add("zpl_crdgrid")),planUI.Layout.getListCont().prepend(l),planEvents.setupPlanCardEvents(r,l)}),s)},navigateToPlanPage:e,fetchPlans:t,disablePlan:function(e,t){let s=lmsbase.mask.querySelector("#disableComment").value;if(!function(){if(!lmsbase.mask)return!1;if(s.length>2048)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.exceedmaxlength")),!1;if(s.includes(">")||s.includes("<"))return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.lms.forms.cannotinclude")),!1;return!0}())return;planApi.disablePlan((s=>{1==s[1]?(planUI.Finder.isFilterApplied()?planUtil.Filter.instance.resetBreadCrumbs():(planUI.Card.removePlanCard(e),planUI.Layout.displayNoData(planUtil.Perm.getContext())),t?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.learningplan.planenable")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.learningplan.plandisable"))):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplan.plannotdisable"))}),e,{enabledisable:!t,enableDisableComment:s}),lmsbase.closeMaskv5()},enrollPlan:function(t){planApi.enrollPlan((s=>{"Enrolled successfully"==s[1].msg?(planUI.Layout.getListCont().querySelector(`#enrollPlan_${t}`).textContent=ZPI18N.getString("zp.lms.course.joined"),planUI.Layout.getListCont().querySelector(`#enrollPlan_${t}`).disabled=!0,e(t)):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.adminerrormsg"))}),t)}},Finder:{searchPlans:function(e){planUI.Layout.clearElem(planUI.Layout.getListCont()),t({search:e.trim()},"search")},filterPlans:function(e){let s=e.appliedFilters;if(planUI.Layout.clearElem(planUI.Layout.getListCont()),0==Object.keys(s).length)return planUtil.Filter.instance.clearBreadCrumbs(),void t();const r={};s.hasOwnProperty("sortByFil")&&(r.sortBy=1==s.sortByFil.selectedvalues[0].value?"asc":"desc");s.hasOwnProperty("stateFil")&&(r.state=JSON.stringify([s.stateFil.selectedvalues[0].value]));t(r,"filter")},resetFilter:function(){planUI.Layout.clearElem(planUI.Layout.getListCont()),t()},closeSearch:function(){const e=planUI.Layout.getHeaderCont().querySelector(".search-cmn input");if(planUI.Finder.closeSearchBox(),!e.hasAttribute("data-prev")||""==e.getAttribute("data-prev"))return!1;planUI.Layout.clearElem(planUI.Layout.getListCont()),t()}},More_Menu:{showMoreMenu:function(e){e&&ZPeopleComponents.menu($(`#planMoreMenu_${e}`)).show()},destroyMoreMenu:function(e){ZPeopleComponents.isComponent(`#planMoreMenu_${e}`)&&(ZPeopleComponents.menu($(`#planMoreMenu_${e}`)).destroy(),$(`#planMoreMenu_${e}`).remove())},executeMoreMenuAction:function(e,t){return()=>{if(1==t.publishState)planUI.Popup.constructDisableMask(e,"true"==t.disabled);else if(void 0!==e&&""!==e.trim()){let t=ZPI18N.getString("zp.lms.learningplan"),s=new DeleteAlertMessage;s.title=ZPI18N.getString("zp.lms.entitydelete",[t]),s.despcription=ZPI18N.getString("zp.lms.permenentlydelEntity",[t]),s.yesButtonText=ZPI18N.getString("zp.confirm"),s.cancelButtonText=ZPI18N.getString("zp.cancel"),s.callback=function(){!function(e){planApi.deletePlan((t=>{"Plan deleted successfully"==t[1].msg?(planUI.Card.removePlanCard(e),planUI.Layout.displayNoData(planUtil.Perm.getContext()),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.lms.learningplanmsg.plandel"))):"Plan can only be disabled after the publish"==t[1].msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.plandelpublishperm")):"Login user can't delete the plan"==t[1].msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.plandelnoperm")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.lms.learningplanmsg.plandelhavemem"))}),e)}(e)},s.show()}}}}};function e(e){e&&window.open(function(e){const t=window.location.href,[s,r]=t.split("#"),[l,a]=s.split("?"),n=l.split("/");n[n.length-1]="training";const i=n.join("/"),o=`lms-view/learningplan/${e}`;return`${a?`${i}?${a}`:i}#${o}`}(e))}function t(e={},s=planUtil.Perm.getContext()){planUI.Layout.renderLoadBar();function r(e){let s=e.fetchParams;s.hasOwnProperty("start")?s.start+=50:s.start=51,t(s,e.viewContext)}planUtil.Perm.getApiEndPoint(e)((t=>{if(planUtil.Perm.validatePlanResponse())if(planUI.Card.constructPlanTab(t,s),50==t.length){ZPeople.FireScroll.setParam("triggered",!1),ZPeople.FireScroll.init(r,"lms",{fetchParams:e,viewContext:s},!0);let t=$(lmsbase._refer.container);t.height()&&t.prop("scrollHeight")<=t.height()&&r({fetchParams:e,viewContext:s})}else ZPeople.FireScroll.setParam("triggered",!0)}),e)}}(),planApi=function(){return{getMyPlans:function(t,s){let r={planScope:"my",...s||{}};e(t,r)},getApplicablePlans:function(t,s){let r={planScope:"applicable",...s||{}};e(t,r)},getOrgPlans:function(t,s){let r={planScope:"organization",...s||{}};e(t,r)},getPlan:function(e,s,r){http.get(`lms/learningplans/${s}`,r).then((t=>{e(t)})).catch((e=>{t(e)}))},addLearningPlan:function(e,s){http.post("lms/learningplans",s).then((t=>{e(t)})).catch((e=>{t(e)}))},deletePlan:function(e,s){http.delete(`lms/learningplans/${s}`).then((t=>{e(t)})).catch((e=>{t(e)}))},disablePlan:function(e,s,r){http.patch(`lms/learningplans/${s}/${r.enabledisable?"disable":"enable"}`,r).then((t=>{e(t)})).catch((e=>{t(e)}))},enrollPlan:function(e,s){http.post(`lms/learningplans/${s}/enroll`).then((t=>{e(t)})).catch((e=>{e.message&&e.message[1]&&e.message[1].msg?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.adminerrormsg")):t(e)}))}};function e(e,s){http.get("lms/plans",s).then((t=>{e(t)})).catch((e=>{t(e)}))}function t(e){let t=ZPI18N.getString("zp.lms.messages.unexpectederror");e&&e.message&&null!=e.message&&null!=e.message&&(t=e.message.message&&""!=e.message.message?e.message.message:t),ZPeople.Message.showFailureMsg(t)}}(),planUtil=function(){return{Perm:{isMyPlansView:e,isPlanAdmin:function(e,t){return e.isPlanOwner||t&&t.isPlanAdmin},canAddLp:t,getContext:function(){return e()?t()?"hasAddPerm":"noAddPerm":"general"},getApiEndPoint:function(t){return e()?planApi.getMyPlans:t.hasOwnProperty("state")&&JSON.parse(t.state).length>0?planApi.getOrgPlans:planApi.getApplicablePlans},validatePlanResponse:function(){return window.location.hash.includes("plans")&&lmsbase._refer.hash.includes("plans")}},Filter:{registerFilterInstance:function(){this.instance=lmsfilterutil.getFilterInstance(function(){let s=[];return s.push(function(){let e=[{value:"1",label:ZPI18N.getString("zp.lms.AtoZ")},{value:"2",label:ZPI18N.getString("zp.lms.ZtoA")}];return{type:"select",label:ZPI18N.getString("zp.sortby"),id:"sortByFil",options:{options:e,placeholder:ZPI18N.getString("zp.select"),dropdownList:{fitForElement:!0}}}}()),r()&&s.push(function(){return{type:"select",label:ZPI18N.getString("zp.state"),id:"stateFil",options:{options:s(),placeholder:ZPI18N.getString("zp.all"),dropdownList:{fitForElement:!0}}};function s(){return e()?t()?r().concat(l()):l():r()}function r(){return[{value:"1",label:ZPI18N.getString("zp.drafted")},{value:"2",label:ZPI18N.getString("zp.lms.course.published")},{value:"3",label:ZPI18N.getString("zp.lms.disabled")}]}function l(){return[{value:"4",label:ZPI18N.getString("zp.inprogress")},{value:"5",label:ZPI18N.getString("zp.completed")}]}}()),s;function r(){return e()||isadmin||lms.settingData[0].settingPermission.isDataAdmin}}()),this.instance.setFilterCallbacks({callback:planAction.Finder.filterPlans},{callback:planAction.Finder.resetFilter},{callback:planAction.Finder.filterPlans})}}};function e(){return"mydata"==lmsbase._refer.module&&lmsbase._refer.hashObject&&"plans"==lmsbase._refer.hashObject.level1}function t(){return(isadmin||lms.settingData[0].settingPermission.isDataAdmin||lms.settingData[0].savedConfigData.isUserCanAdd[0])&&lms.lpSettingData.isLpEnable||lms.settingData[0].savedConfigData.isUserCanAdd.hasOwnProperty("zp.lms.learningplan")&&lms.lpSettingData.isLpEnable}}();