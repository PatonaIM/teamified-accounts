ZPApprovals={APPROVAL_POP_HEADER:'<div class="Icn grni"><i class="IC-tick whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.approve")+"</h4>",APPROVAL_POP:'<div class="form-group"><p class="text-center MB15">'+ZPI18N.getString("zp.wanttoapprove")+'</p><textarea id="approval_comment" placeholder="'+ZPI18N.getString("zp.yourcomments")+'" rows="4" class="form-control"></textarea></div></div>',APPROVAL_POP_FOOTER:'<div class="modal-footer"><button type="button" id="zp_modal_blubtn" name="bulk_appr_btn" class="btn btn-success">'+ZPI18N.getString("zp.approve")+'</button><button type="button" id="zp_modal_redbtn" name="bulk_appr_btn" class="btn btn-danger">'+ZPI18N.getString("zp.reject")+'</button><button id="zp_modal_cancelbtn" type="button" class="btn btn-default" data-dismiss="modal">'+ZPI18N.getString("zp.cancel")+"</button></div>",APPROVE_RECIDS:new Array,TOTAL_RECS:Number(0),APPROVAL_FORMLIST:void 0,TIMESHEET_RECORD_DTL:{},APPROVAL_DETAILS:{},initApprovalPage:function(){var filterCont=Layout.Page.container.find("#top_menuitem").empty(),filter='<div class="row" id="zp_approval_filter"> <div class="FR zp_micn">'+CommonTemplates.getIconMenuBar([{attributes:{onclick:"AdvancedFilter.showHidefilter()"},iconsList:[{class:"IC-filter-l"}]}])+"</div></div>";filter+='<div class="row DN" id="zp_approval_approve"><div class="col-md-8"><button type="button" class="btn btn-primary" onclick="ZPApprovals.viewApproveActionPopup()">'+ZPI18N.getString("zp.clicktoapprovereject")+'</button><button id="zp_approval_bulkforward" type="button" class="btn btn-default ML5" onclick="ZPReview.bulkForwardMyApprovalsFormPopUp()">'+ZPI18N.getString("zp.forward")+"</button></div></div>",filterCont.append(filter),ZPApprovals.APPROVAL_FORMLIST=void 0,Layout.Page.container.find("#page_content").attr("scroll","enabled"),ZPeople.FireScroll.init(ZPApprovals.approvalFireScrollAction)},initiateUsers:function(searchMode){var pageId=$("#"+Layout.Page.pageId),searchJson={id:"employeeApprovalCombo",inpFormat:"select",placeHolder:ZPI18N.getString("zp.allusers"),searchMode:searchMode,type:1,limit:10,searchType:"emp"};pageId.find("#empPhoto").attr("src",ZPeople.CURR_USER.avatar),searchJson.initialSelection=Task.initialUser(),searchJson.defaultOption=Task.getAllUserOption(),ZPComponents.Search.reset(searchJson,!0),ZPComponents.Search.create(searchJson)},approvalFireScrollAction:function(){var fireScrollProp=ZPeople.FireScroll.getFireScrollPropertie(),params=fireScrollProp.curParams;fireScrollProp.isFromWidget?(params.src="widget",params.sIndex=Layout.Page.container.find("#PENDING_APPROVALS").children("li").length+1):params.sIndex=fireScrollProp.count+1,ZPeople.Request.send("/approvalAction.zp",params,fireScrollProp.isFromWidget?ZPDashboard.Widget.constructApprDashBoardRow:ZPApprovals.approvalFireScrollCallback)},approvalFireScrollCallback:function(resultData,params){if(7e3===resultData.code){ZPApprovals.constructApprovalData(resultData,params);var rowCount=resultData.message.length;21===rowCount&&(ZPeople.FireScroll.reset(),rowCount-=1),ZPeople.FireScroll.increaseRecordCount(rowCount)}},getPendingCount:function(){ZPeople.Request.send("/approvalAction.zp",{mode:"PENDING_APPROVALS_COUNT"},function(result){var count=0;7e3==result.code&&result.message&&(count=result.message.count),$("#zp_pappr_count").html("<b>"+count+"</b>")})},approvalAction:function(){void 0==Layout.Page.urlparam.formId&&void 0==Layout.Page.urlparam.formLinkName||void 0==Layout.Page.urlparam.recordId?ZPApprovals.getReqOrAppr():void 0!=Layout.Page.urlparam.formLinkName?ZPApprovals.viewApprovalPopup(Layout.Page.urlparam.formLinkName,Layout.Page.urlparam.recordId,!0):ZPApprovals.viewApprovalPopup(Layout.Page.urlparam.formId,Layout.Page.urlparam.recordId,!1)},getStatusColor:function(status){switch(status){case zpconst.ApprovalStatus.CancellationPending:case zpconst.ApprovalStatus.Pending:return"blu";case zpconst.ApprovalStatus.Approved:return"grn";case zpconst.ApprovalStatus.Rejected:case zpconst.ApprovalStatus.Cancelled:return"red"}},getStatusText:function(status){switch(status){case zpconst.ApprovalStatus.CancellationPending:return ZPI18N.getString("zp.cancellationpending");case zpconst.ApprovalStatus.Pending:return ZPI18N.getString("zp.pending");case zpconst.ApprovalStatus.Approved:return ZPI18N.getString("zp.approved");case zpconst.ApprovalStatus.Rejected:return ZPI18N.getString("zp.rejected");case zpconst.ApprovalStatus.Cancelled:return ZPI18N.getString("zp.cancelled")}},showApprovalsEditMode:function(){var formId=Layout.Page.urlparam.formId?Layout.Page.urlparam.formId:ZPForm.CURRFORM_PARAM.formId;void 0==formId&&void 0!=Layout.Page.urlparam.formLinkName&&(formId=ZPUtil.Form_Link_Names.getFormLinkName(Layout.Page.urlparam.formLinkName,!1)),ZPApprovals.loadApprovalRecordByEdit(formId,Layout.Page.urlparam.recordId?Layout.Page.urlparam.recordId:ZPForm.CURRFORM_PARAM.recordId)},getReqOrAppr:function(callBackData){var params={};if(!($("#"+Layout.Page.pageId).find("#page_content").children().length>0)){if(-1!==Layout.Page.hash.indexOf("approvals/myapproval")){Layout.Page.container.find("#page_content").html(ZPeople.LOADING_HTML),params.action="myApprovals";var myApprovalsRecordOwner=ZPApprovals.Filter.getFilterValue("recordOwnerApprovalCombo");myApprovalsRecordOwner&&"0"!==myApprovalsRecordOwner?params.myApprRecOwner=myApprovalsRecordOwner:params.empStatus=ZPApprovals.Filter.getFilterValue("emp_status_filter")}else if(-1!==Layout.Page.hash.indexOf("approvals/myrequest"))Layout.Page.container.find("#page_content").html(ZPeople.LOADING_HTML),params.action="myRequests";else{if(-1===Layout.Page.hash.indexOf("home/dashboard/approvals"))return;Layout.Page.container.find("#zp_selfservice_myapprovalspage").empty().html(ZPeople.LOADING_HTML);params={action:"myApprovals"}}if(params.mode="VIEW_APPROVALS",params.approvalForm=ZPApprovals.Filter.getFilterValue("approval_formlist"),Layout.CustomizedUrl.isService()&&-1==Layout.Page.hash.indexOf("#approvals/myapproval")&&-1==Layout.Page.hash.indexOf("#approvals/myrequest")){var serviceName=Layout.Page.hash.split("/")[0].substring(1);params.serviceName=serviceName}params.approvalStatus=ZPApprovals.Filter.getFilterValue("approval_status_filter");var selectedEmp=ZPApprovals.Filter.getFilterValue("employeeApprovalCombo");(isadmin||isAdminProfile)&&void 0!==params.approvalForm&&selectedEmp&&(params.empErecNo=selectedEmp),ZPeople.Request.send("/approvalAction.zp",params,function(result){ZPApprovals.getApprovalsCallback(result,params),callBackData&&(callBackData.error||callBackData.errorMsg)&&ZPApprovals.constructApproveRejectError(callBackData,void 0,!0)})}},viewRequestedForm:function(obj,viewApprTimeLine){var tableName;obj=$(obj).parent().parent();var formId=Layout.Page.container.find(obj).attr("formId"),recordId=Layout.Page.container.find(obj).attr("recordId");tableName=Layout.Page.container.find(obj).attr("tableName"),ZPApprovals.viewApprTimeLine=viewApprTimeLine,ZPApprovals.setReqFormUrl(formId,recordId,tableName)},setReqFormUrl:function(formId,recordId,tableName){var mode;"P_TimesheetList"===tableName?mode="Timesheet":"P_TimesheetBudget"===tableName?mode="TimesheetBudget":"P_EmployeeLeave"===tableName?mode="Leave":"P_AttendanceReg"===tableName?mode="Attendance":"P_PermissionDetails"===tableName?mode="AttendancePermissions":"P_ShiftMappingForm"===tableName?mode="Shift":"P_AttendanceOD"===tableName?mode="AttendanceOD":"P_Compensatory"===tableName?mode="Compensatory":"P_LeaveGrant"===tableName?mode="LeaveGrant":"P_GoalSheet"==tableName?mode="Goal":"P_ReviewApprovalSheet"==tableName?mode="Review":"P_MultiRater_Approval"===tableName?mode="Rater":"P_Budget_Splitup"==tableName?mode="Reviewsheet":"dc_EmployeePhotoChanges"===tableName?mode="ProfilePic":0===tableName.indexOf("dc_")?mode="Transfer":tableName===Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME&&(mode=Compensation.CONSTANTS.SALARY_REVISION_PC_NAME);var url=Layout.Page.hash.split("-")[0];if(-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&void 0!=Layout.Page.urlparam.userId)url+="-userId:"+Layout.Page.urlparam.userId+"/formId:"+formId+"/recordId:"+recordId;else if("Timesheet"==mode||"TimesheetBudget"===mode||"Attendance"==mode||"AttendanceOD"==mode||"AttendancePermissions"==mode||"Leave"==mode||"Compensatory"==mode||"LeaveGrant"==mode||"Goal"==mode||"Rater"==mode||"Reviewsheet"==mode)url+="-formId:"+formId+"/recordId:"+recordId;else{var formlinkname=ZPUtil.Form_Link_Names.getFormLinkName(formId,!0),formnameString="-formLinkName:";void 0==formlinkname&&(formnameString="-formId:",formlinkname=formId),url+=formnameString+formlinkname+"/recordId:"+recordId}void 0!==mode&&(url+="/mode:"+mode),window.location.href=url},viewApprovalPopup:function(formId,recordId,isFormLinkName,mode){mode=void 0!=mode?mode:Layout.Page.urlparam.mode;Layout.Page.hash.split("-")[0];-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&void 0!=Layout.Page.urlparam.userId?Layout.Page.urlparam.userId:isFormLinkName&&("-formLinkName:"+formId+"/recordId:"+recordId,formId=ZPUtil.Form_Link_Names.getFormLinkName(formId,!1)),void 0!=mode&&"Timesheet"===mode?Timetracker.timesheet.getTimesheetDetails(formId,recordId,!0,ZPApprovals.closePopCallback):void 0!=mode&&"TimesheetBudget"===mode?Timetracker.Budget.getTimeLogsOfBudget(recordId,ZPApprovals.closePopCallback):void 0!=mode&&"Attendance"===mode?Attendance.Reg.getAttendanceRegDetails(formId,recordId,ZPApprovals.closePopCallback):void 0!=mode&&"AttendancePermissions"===mode?Attendance.Permissions.getPermissionApprovalDetails(formId,recordId,ZPApprovals.closePopCallback):void 0!=mode&&"Shift"===mode?AttendanceShift.getAttendanceShiftDetails(formId,recordId,ZPApprovals.closePopCallback):void 0!=mode&&"AttendanceOD"===mode?Attendance.OD.getAttendanceODDetails(formId,recordId,ZPApprovals.closePopCallback):void 0!=mode&&"Goal"===mode?Appraisal.constructmyapproval(recordId):void 0!=mode&&"Review"===mode?Appraisal.Reviewer.constructReviewApprovalSheet(recordId):void 0!=mode&&"Rater"===mode?Appraisal.MultiRater.newShowApprovalEntriesModal("approval",recordId,ZPApprovals.closePopCallback):void 0!=mode&&"Compensatory"===mode?Leave.Compensatory.RecordView.get(recordId):mode&&"LeaveGrant"===mode?ZPLTGrant.Record.view(recordId):void 0!=mode&&"Reviewsheet"===mode?Appraisal.showReviewSheetApprovalPage("approval",recordId,ZPApprovals.closePopCallback):void 0!=mode&&"Transfer"===mode?transfers.showTransferRecord({data:{transferId:formId,recordId:recordId}}):void 0!=mode&&"ProfilePic"===mode?transfers.showTransferRecord({data:{transferId:formId,recordId:recordId,isProfilePic:!0,isApprovalAction:!0}}):mode===Compensation.CONSTANTS.SALARY_REVISION_PC_NAME?Compensation.Revision.showRevisionRecord(recordId,formId,ZPApprovals.closePopCallback):ZPForm.loadApprovalRecordByMode(formId,recordId,"VIEW",mode)},loadApprovalRecordByEdit:function(formId,recordId){ZPApprovals.viewApprTimeLine=!1,ZPForm.loadApprovalRecordByMode(formId,recordId,"EDIT")},getApprovalDetails:function(isHighIndex){if(0===Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID).length){var modalProperty={id:"approvalpopup_"+ZPApprovals.RECORDID,type:1,headerHtml:"<h6>"+ZPI18N.getString("zp.apprTimeline")+'</h6><a data-dismiss="modal" class="close"> <i class="IC-cls red S14"></i> </a>',overwriteModalClass:!0,modalClass:ZPApprovals.MODAL_CLASS?ZPApprovals.MODAL_CLASS:"modal popRgtModel PopApModel",removeModalClass:"fade ZPmdl",deleteOnHide:!0,closeonEsc:!0,disableFooter:!0,bodyClass:"NomdlFoot PT0I",closeonEsc:!1};ZPeople.BSModal.show(ZPeople.BSModal.get(modalProperty))}var popup_body=Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID).find("#zp_modal_body");if(popup_body.children().remove(),(transfers.isTransfer||isHighIndex)&&Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID).css("z-index","1000"),popup_body.append(ZPeople.LOADING_HTML),void 0===ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]||ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].refresh){ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]=void 0;var params={formId:ZPApprovals.FORMID,recordId:ZPApprovals.RECORDID,method:"getApprovalDetails"};ZPeople.Request.send("/getApprovalDetails.zp",params,ZPApprovals.getApprovalDtlCallBack,void 0,ZPApprovals.showHideApprDetailsBtn)}else ZPApprovals.showApproverejectModal(ZPApprovals.FORMID,ZPApprovals.RECORDID);"P_EmployeeLeave"!==ZPForm.getTableName()||2!=ZPForm.LAYOUT.data("record").message.approvalStatus||ZPForm.isApprovalEnabled()||Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID).find("h6").text(ZPI18N.getString("zp.requestTimeline"))},showHideApprDetailsBtn:function(isDisable){isDisable?(Layout.Page.container.find("#showApprBtn").text(ZPI18N.getString("zp.loadingtxt")),Layout.Page.container.find("#showApprBtn").off("click")):ZPApprovals.addShowApprovalClick(Layout.Page.container.find("#headerApprovalBtn"),ZPApprovals.isRecordAdmin),Layout.Page.container.find("[name=apprRelBtn]").attr("disabled",void 0!=isDisable&&isDisable)},getApprovalDtlCallBack:function(apprData){if(apprData)if(apprData.errorMsg){var error_Msg=apprData.errorMsg;Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID).find("#zp_modal_body").html(CommonTemplates.noDataSVG("",!0,error_Msg,!1)),ZPApprovals.showHideApprDetailsBtn(!1)}else if(ZPApprovals.isTatRefresh){ZPApprovals.isTatRefresh=!1,ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]=apprData;var data={};data.approvalJson=apprData,ZPApprovals.approveRejectDtlCallBack(data,{})}else ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]=apprData,ZPApprovals.initApprovalSettings(apprData),ZPApprovals.showApproverejectModal(ZPApprovals.FORMID,ZPApprovals.RECORDID),apprData.currentApprovalStatus!=zpconst.ApprovalStatus.NoStatus&&apprData.currentApprovalStatus!=zpconst.ApprovalStatus.NotSubmitedd||ZPApprovals.showHideShowApproval(ZPForm.LAYOUT.find("#headerApprovalBtn"),void 0,ZPApprovals.isRecordAdmin,void 0,!0)},initApprovalSettings:function(approvalData){ZPApprovals.CURR_APPROVAL_SETTINGS={},approvalData.approvalSettingsDetails&&(ZPApprovals.CURR_APPROVAL_SETTINGS=approvalData.approvalSettingsDetails)},getApprovalSettings:function(formId){if(ZPApprovals.CURR_APPROVAL_SETTINGS&&ZPApprovals.CURR_APPROVAL_SETTINGS.formId==formId)return ZPApprovals.CURR_APPROVAL_SETTINGS},approveRejectDtlCallBack:function(apprData,params){if((apprData.error||apprData.errorMsg)&&(!params||"forwardApproval"!=params.method))return Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID).find(".ssp-postcmt #approver_comment").siblings().attr("disabled",!1),void ZPApprovals.constructApproveRejectError(apprData,Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID).find(".ssp-postcmt #approver_comment"));if(apprData&&apprData.approvalJson&&ZPApprovals.RECORDID&&ZPApprovals.FORMID){ZPApprovals.getApprovalDtlCallBack(apprData.approvalJson),Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID+" .modal-footer").addClass("zp_dyn");var recordStatus=apprData.approvalJson.currentApprovalStatus,otherDetails={};if("P_AttendanceReg"===ZPForm.getTableName()||"P_PermissionDetails"===ZPForm.getTableName()||"P_AttendanceOD"===ZPForm.getTableName())otherDetails.isfromAttendence=!0;else if("P_TimesheetList"===ZPForm.getTableName()){var responseData={};responseData.status=recordStatus,Timetracker.timesheet.setExtraJsonParamsApprovalHeader(responseData,otherDetails)}else if("P_ShiftMappingForm"===ZPForm.getTableName())otherDetails.isfromAttendenceShift=!0;else if("dc_EmployeePhotoChanges"===apprData.approvalJson.tableName){if(!$("#zp_profilephoto").is(":visible"))return void ZPApprovals.formListCallBack(ZPApprovals.RECORDID,recordStatus);otherDetails.isTransfer=!0,otherDetails.layout=$("#zp_profilephoto")}else ZPForm.getTableName()===Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME&&(statusString=ZPApprovals.getStatusText(recordStatus),Compensation.Revision.ChangeApprovalStatus(ZPApprovals.RECORDID,recordStatus,statusString),otherDetails.isFromSalaryRevision=!0);ZPApprovals.showApprovalHeader(recordStatus,apprData.approvalJson.isOwner,apprData.approvalJson.isPrimaryAppr,otherDetails,void 0,apprData.approvalJson.approvalAction),ZPApprovals.formListCallBack(ZPApprovals.RECORDID,recordStatus),ZPApprovals.SUCCESS_PKID=ZPApprovals.RECORDID,ZPApprovals.dashBoardCallBack(apprData.approvalJson.isPrimaryAppr),null!==ZPForm.LAYOUT&&ZPForm.Blueprint.getTransitions(ZPApprovals.FORMID,ZPApprovals.RECORDID,ZPForm.Permission.getViewPerm())}},constructApproveRejectError:function(approvalResult,siblingDiv,isBulkApproval){if(approvalResult&&approvalResult.error){var errors=approvalResult.error;if(isBulkApproval){var singleErr;ZPeople.Message.showFailureMsg(approvalResult.errorMsg);for(var i=0;i<errors.length;i++){singleErr=errors[i];var recordRow=Layout.Page.container.find("#zp_approval_bodycontent").find("[recordid="+singleErr.recordId+"]");!singleErr.actionStatus&&recordRow&&(recordRow.addClass("zp_err"),7328===singleErr.code&&(singleErr.errorMsg=ZPI18N.getString("zp.commentsrequirederrormsg")),$('<i class="IC-info popHover" data-toggle="popover" data-content="'+singleErr.errorMsg+'" data-popover="true" ></i>').insertAfter(recordRow.find("#zp_approval_approvereject")))}Layout.Page.container.find("#zp_approval_bodycontent").popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right",delay:{show:50,hide:50}}),setTimeout(function(){Layout.Page.container.find("#zp_approval_bodycontent").find("[recordid].zp_err").removeClass("zp_err")},3e3)}else if(siblingDiv&&(siblingDiv.siblings("#cmtErrMsg").remove(),1==errors.length))if(7052==errors[0].code){var editLink=errors[0].editLink,isEditAllowed=errors[0].isEditAllowed,errormessage=errors[0].errorMsg;isEditAllowed&&(errormessage+="Click <a href="+editLink+"><b>here</b></a> to edit record"),ZPeople.Message.showFailureMsg(errormessage)}else $(ZPApprovals.getMandatoryCommentErrHTML(errors[0].errorMsg)).insertAfter(siblingDiv)}else approvalResult&&approvalResult.errorMsg&&ZPeople.Message.showFailureMsg(approvalResult.errorMsg)},getMandatoryCommentErrHTML:function(errMsg){return'<div id="cmtErrMsg" class="ERR PB10">'+errMsg+"</div>"},dashBoardCallBack:function(recordStatus,isPrimaryAppr){if(-1!=Layout.Page.hash.indexOf("#home/dashboard")&&!isPrimaryAppr){var pendingCount=Layout.Page.container.find("#zp_pappr_count b");pendingCount.length>0&&pendingCount.text(pendingCount.text()-1),Layout.Page.container.find("#zp_appr_"+ZPApprovals.RECORDID).remove(),19==Layout.Page.container.find("#PENDING_APPROVALS").children("li").length&&ZPApprovals.approvalFireScrollAction()}},formListCallBack:function(recordId,recordStatus){if(ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID]&&ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID].record.message&&(ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID].record.message.approvalStatus=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].currentApprovalStatus,ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID].record.isPrimaryAppr=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].isPrimaryAppr,ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID].record.approvalDetails=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID],"dc_EmployeePhotoChanges"===ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID].tableName)){var userDtl=ZPeople.getUserDetailsById(ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID].record.message["DatachangeBaseRecord.ID"]);recordStatus===zpconst.ApprovalStatus.Approved&&(userDtl.avatarid=ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID].record.message["Photo.ID"],ZPeople.setPhotoURL("1",void 0,userDtl),$("img[empid="+userDtl.usererec+"], img[empid="+userDtl.id+"]").each(function(){var imgType=$(this).attr("imgtype");this.src="thumb"===imgType?userDtl.thumb:"original"===imgType?userDtl.originalphoto:"zpimg"===imgType?userDtl.zpeoplePhoto:userDtl.avatar})),"selfservice_user_profile"===Layout.Page.urlmode&&$("#selfservice"+(userDtl.usererec===erecno?"":"-id-"+userDtl.usererec)).find("#zp_profile_band .ZPprofileimg .sts-wait-approval").remove()}if(Layout.UrlConf.isForm()&&-1===Layout.Page.hash.indexOf("employee/transfer")&&-1===Layout.Page.hash.indexOf("salarydetails/revision/listview")&&(ZPForm.isApprovalStarted()||Layout.Page.container.find("#zp_addedit_record_"+ZPApprovals.FORMID).find("#zp_form_editin_singlerec").addClass("DN"),void 0!==ZPView.VIEW_CONTAINER&&ZPView.VIEW_CONTAINER.find("#zp_view_record_"+recordId).length>0)){var appr,thumbClass=recordStatus===zpconst.ApprovalStatus.Approved?"IC-like grn S21":recordStatus===zpconst.ApprovalStatus.Rejected?"IC-unlike red S21":recordStatus===zpconst.ApprovalStatus.Pending?"IC-pending org S18":recordStatus===zpconst.ApprovalStatus.Cancelled?"IC-rejected red S18":"CR-notsend gry S18";if(ZPView.VIEW_CONTAINER.find("#zp_view_record_"+recordId).find("td.ZPThumb").html('<i class="'+thumbClass+'"></i>'),ZPView.isApproverDetailsTobeShown&&ZPApprovals.APPROVAL_DETAILS[recordId])recordStatus!==zpconst.ApprovalStatus.Rejected&&recordStatus!==zpconst.ApprovalStatus.Approved||!ZPApprovals.APPROVAL_DETAILS[recordId].processed?recordStatus===zpconst.ApprovalStatus.Pending&&ZPApprovals.APPROVAL_DETAILS[recordId].current?appr=ZPApprovals.APPROVAL_DETAILS[recordId].current:recordStatus===zpconst.ApprovalStatus.Cancelled&&ZPApprovals.APPROVAL_DETAILS[recordId].processed&&(appr=ZPApprovals.APPROVAL_DETAILS[recordId].processed[0]).approvalStatus!=zpconst.ApprovalStatus.Cancelled&&(appr=ZPServices.getObjectFormArray(ZPApprovals.APPROVAL_DETAILS[recordId].processed,"approvalStatus",zpconst.ApprovalStatus.Cancelled,!1,!0)):appr=ZPApprovals.APPROVAL_DETAILS[recordId].processed[ZPApprovals.APPROVAL_DETAILS[recordId].processed.length-1],appr?(ZPView.VIEW_CONTAINER.find("#zp_view_record_"+recordId).find("td.approver div").tooltip("destroy"),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+recordId).find("td.approver").html('<div class="AprvImg" title="'+ZPeople.escapeHtml(appr.name)+'" data-toggle="tooltip" data-container="body" data-placement="top"><img src="'+ZPeople.User.getPhoto(appr.photo)+'"  height=44 class="Usrimg"></div>'),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+recordId).find("td.approvedtime").html(appr.approvedTime?appr.approvedTime:"")):(ZPView.VIEW_CONTAINER.find("#zp_view_record_"+recordId).find("td.approver").empty(),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+recordId).find("td.approvedtime").empty())}if(-1!=Layout.Page.hash.indexOf("#leavetracker/view-recordId"))Leave.View.List.refresh=!0;else if(-1!=Layout.Page.hash.indexOf("#leavetracker/compensatory/view-recordId"))Leave.Compensatory.refresh=!0;else if(LeaveRouter.urls.Grant.isView())ZPLTGrant.refreshList();else if(void 0!==Layout.Page.urlparam.MODE&&"Attendance"===Layout.Page.urlparam.MODE){var recRow=Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId);ZPApprovals.constructApproveOrReject(recRow,resultData.approvalJson.currentApprovalStatus)}else-1!==Layout.Page.hash.indexOf("#attendance/entry/tabularview")?Attendance.Entry.getList(Attendance.Entry.selectedView,Attendance.Entry.preMonth):-1===Layout.Page.hash.indexOf("/transfer/listview")&&-1===Layout.Page.hash.indexOf("employee/transfer")||transfers.updateApprovalStatus(recordId,recordStatus)},isApprovalStarted:function(){if(ZPForm.isApprovalEnabled()){var recordDtl=ZPForm.getSingleRecord(),isRecordAdmin=recordDtl.record.isRecordAdmin;if(7e3===recordDtl.record.code&&(recordDtl=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID],!(isRecordAdmin||ZPForm.CONF.approvalSettingsDetails.isEditAllow||recordDtl.isOwner||recordDtl.currentApprovalStatus===zpconst.ApprovalStatus.NotSubmitedd||recordDtl.currentApprovalStatus===zpconst.ApprovalStatus.NoStatus||ZPForm.isDraftrec)))return!1}return!0},showApproverejectModal:function(formId,recordId){var popup_body=Layout.Page.container.find("#approvalpopup_"+recordId).find("#zp_modal_body");if(popup_body.empty(),popup_body.append(ZPApprovals.constructApprovalPopUp(formId,recordId)),"dc_EmployeePhotoChanges"===ZPApprovals.APPROVAL_DETAILS[recordId].tableName&&($("#zp_profilephoto #closebutton").click(),Layout.Page.container.find("#approvalpopup_"+recordId).find(".modal-header").find("a.close").on("click",transfers.closeTransferPopUp)),ZPApprovals.APPROVAL_DETAILS[recordId].canSendApproval){var footer=ZPApprovals.getSendApprHTML();"APPROVER_CHOOSEN_BY_USER"===ZPForm.getApproverType()&&(footer=ZPApprovals.getApproverChoosenHTML()+footer);var modal=Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID).find(".modal-content");modal.append('<div class="modal-footer">'+footer+"</div>"),modal.find(".modal-footer #zp_form_chooseapprover").select2(),ZPApprovals.addSendApprClickEvent()}var currentApprStatus=ZPApprovals.APPROVAL_DETAILS[recordId].currentApprovalStatus;currentApprStatus!=zpconst.ApprovalStatus.NoStatus&&currentApprStatus!=zpconst.ApprovalStatus.NotSubmitedd||ZPApprovals.showHideApprDetailsBtn(!1),ZPApprovals.APPROVAL_DETAILS[recordId].commentsAllowed&&ZPApprovals.constructApprCmt(void 0===ZPApprovals.APPROVAL_DETAILS[recordId].comments?{}:ZPApprovals.APPROVAL_DETAILS[recordId].comments,recordId,!0),ZPApprovals.approverejectClick(recordId),popup_body.find("#sla_time").is(":visible")&&(void 0==ZPApprovals.sla_timer&&(ZPApprovals.sla_timer={}),ZPApprovals.showSLATimer())},constructApprCmt:function(data,recordId,isInit){if(data&&!(data.length<1)){data.actRecId=recordId,data.subBtnCallBack=ZPApprovals.postApprovalComment;for(var newJSON={subBtnName:"zp.comment"},comments=data.comments?data.comments:"",commentedZuids=[],cnt=0;cnt<comments.length;cnt++)comments[cnt].content=ZPFeeds.Activity.validateContent(comments[cnt].content,!1,data.departmentDts,data.groupDts),ZPUtil.checkIsExistInArray(commentedZuids,comments[cnt].commby)||commentedZuids.push(comments[cnt].commby);ZPeople.getUserDetailsByIds(commentedZuids,!0);var popup_body_cmt=Layout.Page.container.find("#approvalpopup_"+recordId).find("#comment_body");popup_body_cmt.attr("streamid",recordId),isInit?(newJSON.calback=function(){HRCase.Comments.showMoreComments(""+recordId,People.Approval.type,ZPApprovals.constructApprCmt)},ZPACommon.constructCmtRw(data,popup_body_cmt,newJSON)):(popup_body_cmt.empty(),ZPApprovals.APPROVAL_DETAILS[recordId].comments=data,ZPACommon.constructCmtRw(data,popup_body_cmt,newJSON),popup_body_cmt.find("#view_more_cmts").empty().append("<a totalcmts="+data.totalComments+">"+ZPI18N.getString("zp.viewingallcomments",[data.totalComments])+"</a>"))}},showSLATimer:function(){if(clearInterval(ZPApprovals.sla_timer),void 0==ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].timeRequested)ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].timeRequested=(new Date).getTime(),ZPApprovals.sla_timer=setInterval(ZPApprovals.setSLATimer,1e3);else{var sla_timer=Layout.Page.container.find("#sla_time"),slaTimeStr=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].current.nextTATTime,timeDiff=(new Date).getTime()-ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].timeRequested;if(-1!=slaTimeStr.indexOf(":")){var time=slaTimeStr.split(" : "),timeinsec=3600*time[0]+60*time[1]+parseInt(time[2])-Math.floor(timeDiff/1e3);if(timeinsec<0)ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].refresh=!0,ZPApprovals.getApprovalDetails();else{var hours=Math.floor(timeinsec/3600);timeinsec%=3600;var minutes=Math.floor(timeinsec/60);timeinsec%=60,sla_timer.html(SLA.getTimeIn2Digit(hours)+" : "+SLA.getTimeIn2Digit(minutes)+" : "+SLA.getTimeIn2Digit(timeinsec)),ZPApprovals.sla_timer=setInterval(ZPApprovals.setSLATimer,1e3)}}else timeDiff>36e5&&(ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].refresh=!0,ZPApprovals.getApprovalDetails())}},setSLATimer:function(){var sla_timer=Layout.Page.container.find("#sla_time"),slaTimeStr=sla_timer.html();if(void 0==slaTimeStr||"00 : 00 : 00"===slaTimeStr||-1==slaTimeStr.indexOf(":"))clearInterval(ZPApprovals.sla_timer);else{var time=slaTimeStr.split(" : "),timeinsec=3600*time[0]+60*time[1]+parseInt(time[2])-1;if(timeinsec>0){var hours=Math.floor(timeinsec/3600);timeinsec%=3600;var minutes=Math.floor(timeinsec/60);timeinsec%=60,sla_timer.html(SLA.getTimeIn2Digit(hours)+" : "+SLA.getTimeIn2Digit(minutes)+" : "+SLA.getTimeIn2Digit(timeinsec))}else sla_timer.prev().html(ZPI18N.getString("zp.escalated")),sla_timer.html("00 : 00 : 00"),clearInterval(SLA.timer),ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].refresh=!0,ZPApprovals.isTatRefresh=!0,setTimeout(function(){ZPApprovals.getApprovalDetails()},3e3)}},constructApprovalPopUp:function(formId,recordId){var apprData=ZPApprovals.APPROVAL_DETAILS[recordId],apprHtml="";if(void 0!==apprData){ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId]&&ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId].record.message&&"dc_EmployeePhotoChanges"===ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId].tableName&&(apprHtml+='<div class="prophoto-approval"><div><div class="photo"><img src="'+(""==ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId].record.message["Photo.PREVIOUS"]?ZPeople.getDefaultUserImagePath():-1===ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId].record.message["Photo.PREVIOUS"].indexOf("sampleemployeephotos")?"viewPhoto?filename="+ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId].record.message["Photo.PREVIOUS"].split("|")[1]:ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId].record.message["Photo.PREVIOUS"])+'"></div><div class="det"><span>'+ZPI18N.getString("zp.profilephoto.old")+'</span><p onclick="transfers.showProfilePic(this, '+formId+", "+recordId+')">'+ZPI18N.getString("zp.view")+'</p></div></div><div><div class="photo"><img src="'+(""==ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId].record.message.Photo?ZPeople.getDefaultUserImagePath():"viewPhoto?filename="+ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId].record.message.Photo.split("|")[1])+'"></div><div class="det"><span>'+ZPI18N.getString("zp.profilephoto.new")+'</span><p onclick="transfers.showProfilePic(this, '+formId+", "+recordId+')">'+ZPI18N.getString("zp.view")+"</p></div></div></div>"),apprHtml+='<div class="tlouter tlwid" id="'+recordId+'" formId="'+formId+'">';apprData.appList;var apprAct=apprData.approvalAction,isExtraLvlNeed=!1;if(1==apprAct)if(void 0!==apprData.current)isExtraLvlNeed=!0;else if(void 0!==apprData.processed&&apprData.processed.length>0){isExtraLvlNeed=2!=apprData.processed[apprData.processed.length-1].approvalStatus}if(apprHtml+=ZPApprovals.getSingleTimeLineEntryHTML(apprData.recordowner,apprData.approvalSubmissionTime,"recordowner",void 0,void 0,void 0,void 0,void 0,apprData.currentApprovalStatus,apprAct),void 0!==apprData.current||void 0!==apprData.processed&&apprData.processed.length>0||void 0!==apprData.pending){var mode;if(apprHtml+=ZPApprovals.constructApprovalPopupBody(apprData.processed,void 0,void 0,void 0,void 0,apprAct,isExtraLvlNeed),apprData.current)if(apprData.current.forward&&(apprHtml+=ZPApprovals.getSingleTimeLineEntryHTML(apprData.current.forward.initiator,apprData.current.forward.commentedTime,"forward",!0,!1,!1,apprData.current.forward.target,apprData.current.forward.comment)),apprData.current.delegatee)1==apprData.current.delegatee.Sub_Type&&(mode="dualRT"),apprHtml+=ZPApprovals.getSingleTimeLineEntryHTML(apprData.current,void 0,mode,!0,apprData.isPrimaryAppr,apprData.isSecondaryAppr,apprData.current.delegatee);else apprHtml+=ZPApprovals.getSingleTimeLineEntryHTML(apprData.current,void 0,void 0,!0,apprData.isPrimaryAppr,apprData.isSecondaryAppr,void 0,void 0,void 0,apprAct);if(apprHtml+=ZPApprovals.constructApprovalPopupBody(apprData.pending),1==apprAct){var finalTlLvl=apprData.processed[apprData.processed.length-1];1==finalTlLvl.approvalStatus&&(apprHtml+=ZPApprovals.getSingleTimeLineEntryHTML(void 0,finalTlLvl.approvedTime,"extraLevel",void 0,void 0,void 0,void 0,void 0,zpconst.ApprovalStatus.Cancelled,apprAct,!1))}}else if(apprData.systemApproved||void 0!=apprData.previewAutoApprovalType){var status,status_dtl,status_color,img_src=ZPeople.getResourceURL(imageUrl+"auto-app.jpg");if(apprData.currentApprovalStatus===zpconst.ApprovalStatus.Approved||apprData.previewAutoApprovalType===zpconst.ApprovalStatus.Approved?(status=ZPI18N.getString("zp.approved"),status_dtl=ZPI18N.getString("zp.systemapproved"),status_color=void 0!=apprData.previewAutoApprovalType?"":"tl-success"):(status=ZPI18N.getString("zp.rejected"),status_dtl=ZPI18N.getString("zp.systemrejected"),status_color=void 0!=apprData.previewAutoApprovalType?"":"tl-reject"),apprHtml+='<div class="tlentry '+status_color+'"><div class="tlentry-inner"><div class="tlicon"></div><div class="tllabel"><div class="stshead"><span class="sts">'+status+"</span>",apprData.systemApproved){var timeArr=apprData.systemApprovedTime.split(" ");apprHtml+='<div class="dat">'+timeArr[0]+'<span class="time">'+timeArr[1]+(timeArr.length>2?" "+timeArr[2]:"")+"</span></div>"}apprHtml+='</div><div class="profmin"><img src='+img_src+' class="Usrimg FL"><span class="ssp-un">'+status_dtl+"</span></div></div></div></div>"}return apprHtml+="</div>",apprData.commentsAllowed&&(apprHtml+='<div class="ZPFwhiDiv HA PR" id="comment_body" streamid='+recordId+"></div>"),apprHtml}return""},constructApprovalPopupBody:function(approvers,isCurrentAppr,isPrimaryApprover,isSecondaryApprover,delegatorDtls,apprAct,isExtraLvlNeed){var apprHtml="";return void 0!==approvers&&0!=approvers.length&&$.each(approvers,function(index,data){data.forward&&(apprHtml+=ZPApprovals.getSingleTimeLineEntryHTML(data.forward.initiator,data.forward.commentedTime,"forward",!0,!1,!1,data.forward.target,data.forward.comment,void 0,apprAct)),apprHtml+=ZPApprovals.getSingleTimeLineEntryHTML(data,data.approvedTime,void 0,isCurrentAppr,isPrimaryApprover,isSecondaryApprover,delegatorDtls,void 0,void 0,apprAct,isExtraLvlNeed)}),apprHtml},getSingleTimeLineEntryHTML:function(data,time,mode,isCurrentAppr,isPrimaryApprover,isSecondaryApprover,delegatorDtls,comment,approvalStatus,apprAct,isExtraLvlNeed){var apprHtml="",dateTimeHtml="";if(void 0!==data){var waitingMsg,isRecordOwnerHtml="recordowner"==mode,actionKey="",apprClass="",approver_comment="",secondaryAppr=void 0;if(time)dateTimeHtml='<div class="dat">'+(timeArr=time.split(" "))[0]+'<span class="time">'+timeArr[1]+(timeArr.length>2?" "+timeArr[2]:"")+"</span></div>";if(void 0!==data.approvalStatus){var commentIcon="";data.approvalStatus==zpconst.ApprovalStatus.Cancelled?(commentIcon=void 0!=isExtraLvlNeed&&isExtraLvlNeed?'<i class="IC-rejected MR10"></i>':'<i class="IC-rejected MR10 red"></i>',apprClass=void 0!=isExtraLvlNeed&&isExtraLvlNeed?"":"tl-reject",waitingMsg=void 0!=isExtraLvlNeed&&isExtraLvlNeed?ZPI18N.getString("zp.cancelinitiated"):ZPI18N.getString("zp.cancelled")):data.approvalStatus==zpconst.ApprovalStatus.Rejected?(apprClass="tl-reject",waitingMsg=1==apprAct?"Declined":ZPI18N.getString("zp.rejected")):(apprClass="tl-success",waitingMsg=1==apprAct?ZPI18N.getString("zp.accepted"):ZPI18N.getString("zp.approved")),approver_comment=ZPUtil.Validation.isEmpty(data.comment)?"":'<div class="tlaccept">'+commentIcon+data.comment+"</div>"}else isRecordOwnerHtml?apprClass+="first":"forward"==mode?(apprClass+="tl-review",waitingMsg=ZPI18N.getString("zp.forwarded"),secondaryAppr=delegatorDtls,actionKey="zp.forwarded",approver_comment=ZPUtil.Validation.isEmpty(comment)?"":'<div class="tlaccept">'+comment+"</div>"):(waitingMsg=ZPI18N.getString("zp.inqueue"),isCurrentAppr&&(waitingMsg=ZPI18N.getString("zp.pending"),apprClass+="tl-wait",(secondaryAppr=delegatorDtls)&&("dualRT"!=mode||isPrimaryApprover&&secondaryAppr.erecno==erecno)&&(secondaryAppr=data,data=delegatorDtls,"dualRT"!=mode&&(actionKey="zp.delegateeof"))));if(data.approverDtls&&data.approverDtls.erecno!==data.erecno&&(secondaryAppr=data.approverDtls,actionKey="zp.onbehalfof"),secondaryAppr&&(apprClass+=" tldelegate"),apprHtml+='<div class="tlentry '+apprClass+'"> <div class="tlentry-inner">',isRecordOwnerHtml?apprHtml+='<div class="tllabel">':(apprHtml+='<div class="tlicon"></div><div class="tllabel"><div class="stshead">',void 0!==data.approvalStatus?apprHtml+='<span class="sts">'+(waitingMsg||data.approvalStatusStr)+"</span>":(apprHtml+="<span class="+("forward"==mode?"sts":"wait")+">"+waitingMsg+"</span>",void 0!=data.nextTATTime&&(apprHtml+='<div class="progs" id ="sla_time">'+data.nextTATTime+"</div>")),secondaryAppr&&actionKey&&(apprHtml+="<em>"+ZPI18N.getString(actionKey)+"</em>"),apprHtml+=dateTimeHtml+"</div>"),apprHtml+=ZPApprovals.getApproverHTML(data,secondaryAppr,actionKey,isRecordOwnerHtml?dateTimeHtml:void 0,mode,approvalStatus,apprAct),isPrimaryApprover)apprHtml+=ZPApprovals.getCommentBoxHTML()+"</div></div></div>";else if(isSecondaryApprover){apprHtml+='<div class="tlmsg"><a onclick="ZPApprovals.showCommentBox(this)">'+(1==apprAct?ZPI18N.getString("zp.usercanaccept"):ZPI18N.getString("zp.usercanapprove"))+"</a></div>",apprHtml+="</div></div></div>"}else apprHtml+=approver_comment+"</div></div></div>"}else{var timeArr;if(time)dateTimeHtml='<div class="dat">'+(timeArr=time.split(" "))[0]+'<span class="time">'+timeArr[1]+(timeArr.length>2?" "+timeArr[2]:"")+"</span></div>";1==apprAct&&(apprHtml+='<div class="tlentry tl-reject"> <div class="tlentry-inner">',apprHtml+='<div class="tlicon"></div><div class="tllabel"><div class="stshead">',apprHtml+='<span class="sts">'+ZPI18N.getString("zp.cancelled")+"</span>"+dateTimeHtml+"</div></div></div></div>")}return apprHtml},getCommentBoxHTML:function(){var approvalDetails=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID],apprAct=approvalDetails.approvalAction,approveTxt=1==apprAct?ZPI18N.getString("zp.accept"):ZPI18N.getString("zp.approve"),approveAllTxt=1==apprAct?ZPI18N.getString("zp.acceptall"):ZPI18N.getString("zp.approveall"),rejectTxt=1==apprAct?ZPI18N.getString("zp.workflow.decline"):ZPI18N.getString("zp.reject");approvalDetails.hasOwnProperty("isfromTimesheet")&&approvalDetails.isfromTimesheet&&(rejectTxt=ZPI18N.getString("zp.rejectall"));var comemntBox='<div class="ssp-postcmt"><textarea id="approver_comment" class="form-control MB10" rows="3" style="margin-top: 0px; margin-bottom: 10px; height: 55px;" placeholder="'+ZPI18N.getString("zp.writeacomment")+'"></textarea> </span> <button class="btn btn-success btn-animate" name="approvalBtn" approvalType="1">'+approveTxt+"</button>";return comemntBox+=void 0!=approvalDetails.canApprAllLevels&&1==approvalDetails.canApprAllLevels?'<button class="btn btn-success-l" name="approvalBtn" approvalType="1" isapproveall="true">'+approveAllTxt+"</button>":"",comemntBox+='<button class="btn btn-danger" name="approvalBtn" approvalType="0">'+rejectTxt+"</button>",approvalDetails&&approvalDetails.canForwardApproval&&(comemntBox+='<button class="btn btn-delegate-l" name="approvalBtn" approvalType="2">'+ZPI18N.getString("zp.forward")+"</button>"),comemntBox+="</span></div>"},showCommentBox:function(getThis){$(getThis).closest(".tllabel").find(".ssp-postcmt").length<=0&&($(getThis).closest(".tllabel").append(ZPApprovals.getCommentBoxHTML()),ZPApprovals.approverejectClick($(getThis).closest(".tlouter.tlwid").attr("id")))},approverejectClick:function(recordId){$("#"+Layout.Page.pageId).find("#approvalpopup_"+recordId).find("[name='approvalBtn']").on("click",function(){var type=$(this).attr("approvalType");if(2==type){var levelDiv=$(this).closest(".tllabel");levelDiv.find(".ssp-postcmt").addClass("DN");var configuration={headerId:"forwardingDiv",selectId:"appr_delegate",primaryBtnText:ZPI18N.getString("zp.forward")};configuration.type=type,levelDiv.find("#"+configuration.headerId).length>0?levelDiv.find("#"+configuration.headerId).removeClass("DN"):(levelDiv.append(ZPReview.getForwardingHTML(configuration)),CommonTemplates.getSelectMenu(ZPReview.getForwardMenuProperty(),levelDiv.find("#"+configuration.headerId).find("#forwardCmt"),{id:"appr_forward_id",placeholder:ZPI18N.getString("zp.selectapprover")},{inputHeaderName:ZPI18N.getString("zp.forwardheader")})),levelDiv.find("#forwardingDiv").addClass("zp_delG")}else{var comment=$(this).siblings("#approver_comment").val(),isAllLevelApprove=!!isadmin&&$(this).attr("isapproveall"),formId=$(this).closest("#"+recordId).attr("formid");$(this).closest(".ssp-postcmt").find("[name='approvalBtn']").attr("disabled",!0);var apprAct=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].approvalAction;ZPForm.validateApprovalComment(type,comment,ZPApprovals.getApprovalSettings(formId),$(this).closest(".ssp-postcmt").find("#approver_comment"))?"P_AttendanceReg"==ZPForm.getTableName()?Attendance.Reg.appRejRegDetails(type,isAllLevelApprove,comment,ZPApprovals.RECORDID,apprAct):"P_ShiftMappingForm"==ZPForm.getTableName()?AttendanceShift.appRejShiftDetails(type,isAllLevelApprove,comment,ZPApprovals.RECORDID,apprAct):"P_AttendanceOD"==ZPForm.getTableName()?Attendance.OD.appRejODDetails(type,isAllLevelApprove,comment,ZPApprovals.RECORDID,apprAct):ZPForm.Record.approveReject(new Array(recordId),type,comment,isAllLevelApprove,ZPApprovals.approveRejectDtlCallBack,!0,formId):$(this).closest(".ssp-postcmt").find("[name='approvalBtn']").attr("disabled",!1)}})},getApproverHTML:function(primaryAppr,secondaryAppr,actionKey,recordOwnerDateHtml,mode,approvalStatus,apprAct){var isValidSecApprover=secondaryAppr&&secondaryAppr.erecno!==primaryAppr.erecno,dualRT=isValidSecApprover&&"dualRT"==mode?secondaryAppr:void 0,apprHtml='<div class="profmin'+("dualRT"==mode?" zp_dUaPr":"")+'">'+ZPApprovals.getApproverInfoHTML(primaryAppr,recordOwnerDateHtml,dualRT,approvalStatus,apprAct);return isValidSecApprover&&void 0==dualRT&&(apprHtml+='<div class="zp-approinfo">'+ZPApprovals.getApproverInfoHTML(secondaryAppr,recordOwnerDateHtml,void 0,void 0,apprAct)+"</div>"),apprHtml+="</div>"},getApproverInfoHTML:function(primaryAppr,recordOwnerDateHtml,dualRTAppr,approvalStatus,apprAct){var approver_mail="",approver_image="";void 0===primaryAppr.photo||""===primaryAppr.photo?approver_image='<span class="Usrimg FL">'+ZPeople.getShortName(primaryAppr.name)+"</span>":dualRTAppr?(approver_image='<img src="'+primaryAppr.photo+'" class="Usrimg FL img1">',approver_image+='<img src="'+dualRTAppr.photo+'" class="Usrimg FL img2" popup="user" empid="'+dualRTAppr.zuid+'">'):approver_image='<img src="'+primaryAppr.photo+'" class="Usrimg FL">';var approver_info=approver_image+'<span class="ssp-un">';return void 0==recordOwnerDateHtml&&void 0!==primaryAppr.employeeid&&(approver_info+="<span>"+primaryAppr.employeeid+" - </span>"),void 0!==primaryAppr.email&&""!==primaryAppr.email&&void 0!==primaryAppr.erecno?approver_mail=primaryAppr.email:void 0!==primaryAppr.approvertype&&"APPROVER_CHOOSEN_BY_USER"!=primaryAppr.type&&(approver_mail=primaryAppr.approvertype),void 0==recordOwnerDateHtml?approver_info+=primaryAppr.name+'<span class="ssp-mail">'+approver_mail+"</span>":(!approvalStatus||approvalStatus!=zpconst.ApprovalStatus.NoStatus&&approvalStatus!=zpconst.ApprovalStatus.NotSubmitedd?approvalStatus&&approvalStatus==zpconst.ApprovalStatus.Cancelled&&0==apprAct?primaryAppr.erecno==erecno?approver_info+=ZPI18N.getString("zp.cancelledrecordmytxt"):approver_info+=ZPI18N.getString("zp.cancelledrecordtxt",[primaryAppr.employeeid+" - "+primaryAppr.name]):primaryAppr.erecno==erecno?approver_info+=1==apprAct?ZPI18N.getString("zp.recordownercancelmytxt"):ZPI18N.getString("zp.recordownermytxt"):approver_info+=1==apprAct?ZPI18N.getString("zp.recordownercanceltxt",[primaryAppr.employeeid+" - "+primaryAppr.name]):ZPI18N.getString("zp.recordownertxt",[primaryAppr.employeeid+" - "+primaryAppr.name]):primaryAppr.erecno==erecno?approver_info+=ZPI18N.getString("zp.previewrecordownermytxt"):approver_info+=ZPI18N.getString("zp.previewrecordownertxt",[primaryAppr.employeeid+" - "+primaryAppr.name]),approver_info+=recordOwnerDateHtml),approver_info+="</span>"},closeForward:function(getThis){var levelDiv=$(getThis).closest(".tllabel");ZPReview.resetForward(levelDiv.find("[name=apprSelectionDiv]")),levelDiv.find(".ssp-postcmt").removeClass("DN"),levelDiv.find("[name=apprSelectionDiv]").addClass("DN")},isApprover:function(recordId){var apprData=ZPApprovals.APPROVAL_DETAILS[recordId];return!(!apprData||!apprData.current)&&(void 0==ZPeople.loggedInGroups&&Groups.getMyGroups(),apprData.current.erecno+""===ZPeople.CURR_USER.usererec||apprData.current.deptId+""===ZPeople.CURR_USER.deptId||apprData.current.roleId+""===ZPeople.CURR_USER.roleId||-1!=ZPeople.loggedInGroups.indexOf(apprData.current.groupId+""))},setApprRecordOwner:function(recordDtl){ZPForm.RecordApproval.CREATE_ERECNO=void 0,ZPForm.RecordApproval.OWNER_ERECNO=void 0,recordDtl&&recordDtl.message&&(ZPForm.RecordApproval.OWNER_ERECNO=recordDtl.message.ownerID,recordDtl.message.cAuditInfo&&recordDtl.message.cAuditInfo.cInfo&&recordDtl.message.cAuditInfo.cInfo.user&&recordDtl.message.cAuditInfo.cInfo.user.ERECNO&&(ZPForm.RecordApproval.CREATE_ERECNO=recordDtl.message.cAuditInfo.cInfo.user.ERECNO))},isApprRecordOwner:function(){return erecno==ZPForm.RecordApproval.CREATE_ERECNO||erecno==ZPForm.RecordApproval.OWNER_ERECNO},canViewApproval:function(recordId){if(ZPApprovals.APPROVAL_DETAILS[recordId]){var apprData=ZPApprovals.APPROVAL_DETAILS[recordId];return apprData.current||apprData.pending||apprData.processed}},closePopCallback:function(callBackRecordId,approvalStatus){if("Attendance"===Layout.Page.urlparam.mode||"AttendanceOD"===Layout.Page.urlparam.mode||"AttendancePermissions"===Layout.Page.urlparam.mode||"Goal"==Layout.Page.urlparam.mode||"Rater"==Layout.Page.urlparam.mode||"Review"==Layout.Page.urlparam.mode||"Reviewsheet"==Layout.Page.urlparam.mode||"TimesheetBudget"===Layout.Page.urlparam.mode)Appraisal.Goals.GOALSHEETAPPROVER=!1,ZPApprovals.reloadApprovalContent();else if(0!==Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId).length){var recRow=Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId),formId=Layout.Page.urlparam.formId;if(void 0==formId&&void 0!=Layout.Page.urlparam.formLinkName&&(formId=ZPUtil.Form_Link_Names.getFormLinkName(Layout.Page.urlparam.formLinkName,!1)),void 0!==Layout.Page.urlparam.mode&&"Timesheet"===Layout.Page.urlparam.mode)void 0!==approvalStatus&&""===approvalStatus?ZPApprovals.removeSingleRec(Layout.Page.urlparam.recordId):void 0!==approvalStatus&&"-1"===approvalStatus?ZPApprovals.reloadApprovalContent():void 0!==approvalStatus&&Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId).attr("status")!==approvalStatus&&ZPApprovals.constructApproveOrReject(recRow,approvalStatus,ZPApprovals.TIMESHEET_RECORD_DTL[Layout.Page.urlparam.recordId]);else if(!ZPUtil.Validation.isEmpty(callBackRecordId)&&ZPForm.SINGLE_RECORD_DTL[formId+"_"+callBackRecordId]&&7e3===ZPForm.SINGLE_RECORD_DTL[formId+"_"+callBackRecordId].record.code){var recDetail=ZPForm.SINGLE_RECORD_DTL[formId+"_"+callBackRecordId].record;if(recRow.attr("status")!==recDetail.message.approvalStatus+""||recRow.attr("status")==zpconst.ApprovalStatus.Pending){var apprDetails=recDetail.approvalDetails?recDetail.approvalDetails:ZPApprovals.APPROVAL_DETAILS[callBackRecordId];apprDetails&&ZPApprovals.constructApproveOrReject(recRow,apprDetails.currentApprovalStatus,apprDetails)}}}var url=Layout.Page.hash.split("-")[0];-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&void 0!=Layout.Page.urlparam.userId?url+="-userId:"+Layout.Page.urlparam.userId:"#home/dashboard"==Layout.Page.hash&&Layout.Page.container.find("#"+ZPDashboard.Widget.List.PAPP).find("li").off("click").on("click",function(){ZPDashboard.Widget.Actions.loadApprovalRecord($(this).attr("formid"),$(this).attr("recordid"),$(this).attr("tablename")),$(this).off("click")}),ZPApprovals.SUCCESS_PKID=void 0,window.location.hash=url,void 0===ZPApprovals.APPROVAL_FORMLIST&&ZPApprovals.reloadApprovalContent()},reloadApprovalContent:function(){-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&(Layout.Page.urlparam.formId=Layout.Page.urlparam.recordId=void 0),$("#"+Layout.Page.pageId).find("#page_content").empty()},removeSingleRec:function(recId){var recRow=Layout.Page.container.find("#zp_approval_rec_"+recId);recRow.addClass("DN"),"-1"===recRow.attr("status")&&-1!==Layout.Page.hash.indexOf("approvals/myapproval")&&(ZPApprovals.TOTAL_RECS-=1,0===ZPApprovals.TOTAL_RECS&&(Layout.Page.container.find("#zp_approval_header #zp_approval_check").attr("disabled",!0),Layout.Page.container.find("#zp_approval_header .checkbox").addClass("disabled"))),0===Layout.Page.container.find("tr[id^=zp_approval_rec_]").not(".DN").length&&Layout.Page.container.find("#page_content").empty().append(CommonTemplates.noDataSVG("",!0,ZPI18N.getString("zp.norec"),!1))},getApprovalsCallback:function(result,params){if(void 0===ZPApprovals.APPROVAL_FORMLIST)(formList=[]).push({id:"-1",value:ZPI18N.getString("zp.allforms"),isDefaultValue:!0}),$.each(result.formList,function(index,data){formList.push({id:data.formId,value:data.dispName})}),ZPApprovals.APPROVAL_FORMLIST=formList;else if(0===Layout.Page.container.find("#approval_formlist").length){var formList;(formList=Layout.Page.container.find("#approval_formlistcont").empty()).append(ZPApprovals.APPROVAL_FORMLIST);var formFilter=Layout.Page.container.find("#approval_formlist");$(formFilter).select2().on("change",function(e){ZPApprovals.resetApprovalPage()})}Layout.Page.container.find("#zp_selfservice_myapprovalspage").empty().append('<div id="page_content"></div>');var pageCont=Layout.Page.container.find("#page_content").empty();if(7024===result.code)pageCont.append(CommonTemplates.noDataSVG("",!0,ZPI18N.getString("zp.norec"),!1)),ZPeople.FireScroll.setRecordCount(0),ZPeople.FireScroll.setParam("curParams",params);else if(7e3===result.code){var approvalPageHeaderCheck="",myApproval=-1!==Layout.Page.hash.indexOf("approvals/myapproval"),approvalContent=(Layout.Page.hash.indexOf("approvals/myrequest"),"");myApproval&&(approvalPageHeaderCheck='<th><label class="checkbox"><input id="zp_approval_check" onclick="ZPApprovals.selectUnselectCheck(this, \'all\')" type="checkbox"><span></span></label></div></th>'),approvalContent='<div class="table-responsive"><table class="table table-hover">',approvalContent+='<thead id="zp_approval_header"><tr class="ZPLHRow">'+approvalPageHeaderCheck+'<th colspan="2">'+ZPI18N.getString("zp.message")+'</th><th width="140">'+ZPI18N.getString("zp.requestedon")+"</th><th>"+ZPI18N.getString("zp.status")+'</th></tr></thead><tbody id="zp_approval_bodycontent"></tbody></table></div>',pageCont.append(approvalContent),ZPApprovals.constructApprovalData(result,params),ZPApprovals.setFireScollCount(result,params,!1)}ZPApprovals.Filter.constructOptions()},setFireScollCount:function(result,params,isFromWidget){var rowCount=result.message.length;21==rowCount&&(ZPeople.FireScroll.reset(),rowCount-=1),ZPeople.FireScroll.setRecordCount(rowCount),ZPeople.FireScroll.setParam("curParams",params),ZPeople.FireScroll.setParam("isFromWidget",isFromWidget)},constructApprovalData:function(result,params){var colId,approvalContent="",pendingRecordCount=ZPApprovals.TOTAL_RECS,myApproval=-1!==Layout.Page.hash.indexOf("approvals/myapproval"),myRequest=-1!==Layout.Page.hash.indexOf("approvals/myrequest");colId=myApproval||-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")?"zp_approval_approvereject":"zp_approval_viewrequest";var resultDataLength=result.message.length;21==resultDataLength&&(resultDataLength-=1);for(var index=0;index<resultDataLength;index++){var data=result.message[index],statusType="",checkBoxAttr="",checkBoxClass="",approvalAction=data.approvalAction,isPrimaryAppr=data.isPrimaryAppr;if(data.approvalStatus===zpconst.ApprovalStatus.Pending||data.approvalStatus===zpconst.ApprovalStatus.CancellationPending)if(myApproval||-1!==Layout.Page.hash.indexOf("home/dashboard/approvals"))if(isPrimaryAppr){var btnText=1==approvalAction?ZPI18N.getString("zp.extenddecline"):ZPI18N.getString("zp.clicktoapprovereject");statusType='<button class="btn btn-default btn-sm" id="zp_approval_approvereject" type="button" onclick="ZPApprovals.viewRequestedForm(this, true)"',statusType+=data.recordImmutable?'disabled="disabled"':"",statusType+=">"+btnText+"</button>",pendingRecordCount+=1}else{isadmin?pendingRecordCount+=1:(checkBoxAttr="disabled=true",checkBoxClass="disabled"),statusType='<a id="'+colId+'" onclick="ZPApprovals.viewRequestedForm(this)"><span class="blk">'+(1==approvalAction?'<span class="org">'+ZPI18N.getString("zp.cancellationpending"):ZPI18N.getString("zp.pendingmessage"))+"</span></a>"}else myRequest&&(statusType='<button class="btn btn-default btn-sm" id="zp_approval_viewrequest" type="button" onclick="ZPApprovals.viewRequestedForm(this)">'+ZPI18N.getString("zp.waitforapproval")+"</button>");else if(1===data.approvalStatus)checkBoxAttr="disabled=true",checkBoxClass="disabled",statusType='<a id="'+colId+'" onclick="ZPApprovals.viewRequestedForm(this)"><span class="blk">'+ZPI18N.getString("zp.approvedmessage",new Array(data.approveRejectTime))+"</span></a>";else if(0===data.approvalStatus)checkBoxAttr="disabled=true",checkBoxClass="disabled",statusType='<a id="'+colId+'" onclick="ZPApprovals.viewRequestedForm(this)"><span class="blk">'+ZPI18N.getString("zp.rejectedmessage",new Array(data.approveRejectTime))+"</span></a>";else if(3===data.approvalStatus){checkBoxAttr="disabled=true",checkBoxClass="disabled";statusType='<a id="'+colId+'" onclick="ZPApprovals.viewRequestedForm(this)"><span class="blk">'+ZPI18N.getString("zp.approvedmessage",new Array(data.approveRejectTime))+"</span></a>"}else data.approvalStatus===zpconst.ApprovalStatus.Cancelled&&(checkBoxAttr="disabled=true",checkBoxClass="disabled",statusType='<a id="'+colId+'" onclick="ZPApprovals.viewRequestedForm(this)"><span class="blk">'+ZPI18N.getString("zp.approvalmessage",new Array("red",ZPI18N.getString("zp.cancelled"),data.approveRejectTime))+"</span></a>");var checkBoxText="",reqDetails="";myApproval?(reqDetails=ZPeople.CURR_USER.usererec==data.recordOwnerErecno?1==approvalAction?ZPI18N.getString("zp.youhavemadecancelrequest",["<a>"+data.formName+"</a>"]):ZPI18N.getString("zp.youhavemaderequest",["<a>"+data.formName+"</a>"]):1==approvalAction?ZPI18N.getString("zp.othershasmadecancelrequest",[ZPeople.decodeTxt(data.recordOwnerName),"<a>"+data.formName+"</a>"]):ZPI18N.getString("zp.othershasmaderequest",[ZPeople.decodeTxt(data.recordOwnerName),"<a>"+data.formName+"</a>"]),checkBoxText='<td width="10"><label class="checkbox '+checkBoxClass+'"><input type="checkbox" onclick="ZPApprovals.selectUnselectCheck(this, \'single\', \''+data.recordId+'\')" id="zp_approval_check" '+checkBoxAttr+"><span></span></label></td>"):reqDetails=ZPeople.CURR_USER.usererec==data.recordOwnerErecno&&data.addedByErcno==data.recordOwnerErecno?1==approvalAction?ZPI18N.getString("zp.youhavemadecancelrequest",["<a>"+data.formName+"</a>"]):ZPI18N.getString("zp.youhavemaderequest",["<a>"+data.formName+"</a>"]):ZPeople.CURR_USER.usererec==data.addedByErcno&&data.addedByErcno!=data.recordOwnerErecno?1==approvalAction?ZPI18N.getString("zp.youcancellationrequestforothers",["<span class='blk'>"+ZPeople.decodeTxt(data.recordOwnerName)+"</span>","<a>"+data.formName+"</a>"]):ZPI18N.getString("zp.yourequestforothers",["<span class='blk'>"+ZPeople.decodeTxt(data.recordOwnerName)+"</span>","<a>"+data.formName+"</a>"]):ZPeople.CURR_USER.usererec!=data.addedByErcno&&data.addedByErcno!=data.recordOwnerErecno&&ZPeople.CURR_USER.usererec!=data.recordOwnerErecno?1==approvalAction?ZPI18N.getString("zp.otherscancellationrequestforothers",[ZPeople.decodeTxt(data.addedByName),"<span class='blk'>"+ZPeople.decodeTxt(data.recordOwnerName)+"</span>","<a>"+data.formName+"</a>"]):ZPI18N.getString("zp.othersrequestforothers",[ZPeople.decodeTxt(data.addedByName),"<span class='blk'>"+ZPeople.decodeTxt(data.recordOwnerName)+"</span>","<a>"+data.formName+"</a>"]):ZPeople.CURR_USER.usererec!=data.recordOwnerErecno&&data.addedByErcno==data.recordOwnerErecno?1==approvalAction?ZPI18N.getString("zp.othershasmadecancelrequest",[ZPeople.decodeTxt(data.recordOwnerName),"<a>"+data.formName+"</a>"]):ZPI18N.getString("zp.othershasmaderequest",[ZPeople.decodeTxt(data.recordOwnerName),"<a>"+data.formName+"</a>"]):1==approvalAction?ZPI18N.getString("zp.otherscancellationrequestforyou",[ZPeople.decodeTxt(data.addedByName),"<a>"+data.formName+"</a>"]):ZPI18N.getString("zp.othersrequestforyou",[ZPeople.decodeTxt(data.addedByName),"<a>"+data.formName+"</a>"]),approvalContent+='<tr class="ZPLRow" id="zp_approval_rec_'+data.recordId+'" formDisplayName="'+data.formName+'" tableName="'+data.tableName+'" formId="'+data.formId+'" recordId="'+data.recordId+'" isPrimaryAppr="'+data.isPrimaryAppr+'" status="'+data.approvalStatus+'">'+checkBoxText+'<td width="40"><img src="'+data.employeePhotoUrl+'" class="FL"></td><td><span class="gry" onclick="ZPApprovals.viewRequestedForm(this)">'+reqDetails+"</span></td>",approvalContent+="<td>"+data.requestedOn+"</td><td>"+statusType+"</td>",approvalContent+="</tr>"}Layout.Page.container.find("#zp_approval_bodycontent").append(approvalContent),myApproval&&(0==pendingRecordCount?(Layout.Page.container.find("#zp_approval_header #zp_approval_check").attr("disabled",!0),Layout.Page.container.find("#zp_approval_header .checkbox").addClass("disabled")):ZPApprovals.TOTAL_RECS=pendingRecordCount)},resetApprovalPage:function(){$("#"+Layout.Page.pageId).find("#page_content").empty(),ZPApprovals.getReqOrAppr()},selectUnselectCheck:function(Obj,type,recId){var isSelect=$(Obj).is(":checked");if("all"===type)isSelect?Layout.Page.container.find("tr[id^=zp_approval_rec_]").each(function(){recId=$(this).attr("recordid"),0===$(this).find("#zp_approval_check").length||$(this).find("#zp_approval_check")[0].disabled||($(this).find("#zp_approval_check")[0].checked=!0,isNaN(recId)||ZPApprovals.APPROVE_RECIDS.push(recId))}):(ZPApprovals.APPROVE_RECIDS=new Array,Layout.Page.container.find("tr[id^=zp_approval_rec_]").find("[id=zp_approval_check]").prop("checked",!1));else if(!isNaN(recId)){if(isSelect)ZPApprovals.APPROVE_RECIDS.push(recId);else{var posOfEle=ZPApprovals.APPROVE_RECIDS.indexOf(recId);-1!==posOfEle&&ZPApprovals.APPROVE_RECIDS.splice(posOfEle,1)}if(-1!==Layout.Page.hash.indexOf("approvals/myapproval")){var totalRec=ZPApprovals.TOTAL_RECS,selRec=Layout.Page.container.find("tr[id^=zp_approval_rec_]").find("[id=zp_approval_check]:checked"),headerSel=Layout.Page.container.find("#zp_approval_header").find("#zp_approval_check");totalRec===selRec.length?headerSel[0].checked=!0:headerSel.is(":checked")&&(headerSel[0].checked=!1)}}var approveRecObj=Layout.Page.container.find("#zp_approval_approve");!approveRecObj.is(":visible")&&ZPApprovals.APPROVE_RECIDS.length>0?Layout.Page.container.find("#zp_approval_filter").fadeOut(200,function(){$(this).siblings("#zp_approval_approve").fadeIn(200)}):approveRecObj.is(":visible")&&0===ZPApprovals.APPROVE_RECIDS.length&&Layout.Page.container.find("#zp_approval_approve").fadeOut(200,function(){$(this).siblings("#zp_approval_filter").fadeIn(200)})},viewApproveActionPopup:function(formId){void 0==(formId=formId||ZPApprovals.Filter.getFilterValue("approval_formlist"))||"0"==formId||"-1"==formId||ZPApprovals.getApprovalSettings(formId)?ZPApprovals.constructApproveActionPopup(formId):ZPApprovals.fetchApprovalSettings(formId,!0,ZPApprovals.fetchApprovalSettingsCallBack)},fetchApprovalSettingsCallBack:function(data,params){ZPApprovals.initApprovalSettings({approvalSettingsDetails:data}),ZPApprovals.constructApproveActionPopup(params.formId)},fetchApprovalSettings:function(formId,isCommentNeeded,callback){var params={formId:formId,method:"fetchUserApprovalSettings",type:isCommentNeeded?"commentSettings":"allSettings",conreqcsr:csrfToken};ZPeople.Request.send("/fetchUserApprovalSettings.zp",params,function(data){callback&&"function"==typeof callback&&callback(data,params)})},constructApproveActionPopup:function(formId){var footer=$(ZPApprovals.APPROVAL_POP_FOOTER);if(isadmin&&footer.find("#zp_modal_all_appr_btn").length<1){var approveAllbtn='<button id="zp_modal_all_appr_btn" name="bulk_appr_btn" class="btn btn-success ZpaprvrBtn RsltA">'+ZPI18N.getString("zp.approveall")+"</button>";$(approveAllbtn).insertAfter(footer.find("#zp_modal_redbtn"))}var bulkApprovalCallBack=ZPApprovals.approveOrRejectAction;-1!=Layout.Page.hash.indexOf("performance/approval/myapprovals")?bulkApprovalCallBack=Appraisal.bulkApproveOrRejectAction:-1!==Layout.Page.hash.indexOf("performance/approval/multiraterapprovals")?bulkApprovalCallBack=Appraisal.MultiRater.bulkMRApproval:-1!==Layout.Page.hash.indexOf("timetracker/timesheet/myapprovals")?bulkApprovalCallBack=Timetracker.timesheet.multiSelectDeleteOrApprove:-1!==Layout.Page.hash.indexOf("performance/approval/hikeapprovals")?bulkApprovalCallBack=Appraisal.Budget.bulkBudgetApproval:-1!==Layout.Page.hash.indexOf("attendance/regularization/myapprovals")?bulkApprovalCallBack=Attendance.Reg.regApprAction:-1!==Layout.Page.hash.indexOf("attendance/shiftmapping/shiftmapapprovals")?bulkApprovalCallBack=AttendanceShift.shiftMapApprAction:-1!==Layout.Page.hash.indexOf("attendance/onduty/myapprovals")?bulkApprovalCallBack=Attendance.OD.ODApprAction:-1!==Layout.Page.hash.indexOf("attendance/permission/myapprovals")&&(bulkApprovalCallBack=AttPermissions.permissionApprAction),$("#"+Layout.Page.pageId).find('[name="bulk_appr_btn"]').attr("disabled",!1),footer.find('[name="bulk_appr_btn"]').on("click",function(){if(bulkApprovalCallBack&&"function"==typeof bulkApprovalCallBack){var type="zp_modal_blubtn"===this.id||"zp_modal_all_appr_btn"===this.id?1:0,comment=Layout.Page.container.find("#approval_comment").val();ZPForm.validateApprovalComment(type,comment,ZPApprovals.getApprovalSettings(formId),Layout.Page.container.find("#approval_comment"))&&($("#"+Layout.Page.pageId).find('[name="bulk_appr_btn"]').attr("disabled",!0),bulkApprovalCallBack(this))}}),ZPeople.BSModal.setup({id:"zp_approval_pop",type:2,header:ZPApprovals.APPROVAL_POP_HEADER,body:ZPApprovals.APPROVAL_POP,modalClass:"modal fade ZPmdl DelMdl in",footer:footer})},viewApproverCommentPopup:function(){var header='<div class="Icn grni"><i class="IC-tick whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.comment")+"</h4>",body=(ZPI18N.getString("zp.comment"),ZPI18N.getString("zp.cancel"),$('<div class="form-group"><div id="feed_container" streamid='+ZPApprovals.RECORDID+"></div></div></div>")),cmtData={};cmtData.actOwner=ZPeople.getUserDetailsById(erecno),cmtData.actRecId=ZPApprovals.RECORDID,cmtData.subBtnCallBack=ZPApprovals.postApprovalComment,cmtData.subBtnName="zp.comment",body.find("#feed_container").append(ZPFeeds.Construction.constructTextArea(!0,cmtData)),ZPeople.BSModal.setup({id:"zp_approval_comment_pop",type:1,header:header,body:body,modalClass:"modal fade ZPmdl modal-small in",disableFooter:!0}),body.find("#cmt_textarea").trigger("click")},postApprovalComment:function(editor){var pageId=$("#"+Layout.Page.pageId),content=ZPFeeds.getSmileysAndMentions(editor.getContent(),ZPeople.isSearchAllowed),messageText=ZPFeeds.getTextContent(content);if(0===messageText.length&&0===$("<div>").append(content).find("img").length)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.pleaseentervalidcomment")),editor.trigger("focus");else if(messageText.length>5e3)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.commentlengthwarning")),editor.trigger("focus");else if(ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]){var btnObj=Layout.Page.container.find("[streamid="+ZPApprovals.RECORDID+"] #postCommentBtn");btnObj.prop("disabled",!0),0===btnObj.find("#loader").length&&btnObj.append(ZPFeeds.MINILOADER);var params={actionType:"INVOKE_ACS",comment:content,conreqcsr:csrfToken,fdk:ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].fdk,messageText:messageText,statusType:People.Approval.type};ZPeople.Request.send("/feedActions.zp",params,function(data){if(200==JSON.parse(data).code){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.commentaddedsuccessfully"));var tempCmtObj=JSON.parse(data).commentObj[0],comActObj=new People.Comment(new Comment(tempCmtObj),!0);ZPApprovals.convertPostCommentObj(ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].comments,tempCmtObj);var actJson={};actJson.actRecId=tempCmtObj.actRecId,actJson.type=comActObj.type;var conObj=pageId.find("#approvalpopup_"+tempCmtObj.actRecId+" [streamid='"+tempCmtObj.actRecId+"']"),cmtContObj=$(conObj[0]).find("[actfdk='"+ZPUtil.escapeSelector(params.fdk)+"']");cmtContObj.removeClass("DN");var cmtObj=ZPFeeds.Construction.iterateComments(actJson,[comActObj],cmtContObj);cmtContObj.find("[commentId='"+comActObj.commentId+"']").length>0?cmtContObj.find("[commentId='"+comActObj.commentId+"']").replaceWith(cmtObj):cmtContObj.append(cmtObj),ZPFeeds.Comment.handleCommentCount(!1,params.fdk,comActObj.totalCmtCnt,!1,"comment_body"),editor.setContent(""),ZPFeeds.Comment.removeTextEditor(editor,tempCmtObj.actRecId)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.authorizedfailure"));btnObj.prop("disabled",!1),btnObj.find("#loader").remove()})}},convertPostCommentObj:function(cmtDataArr,postCmtData){postCmtData.commby=postCmtData.by,postCmtData.commat=postCmtData.at,postCmtData.content=postCmtData.contents,cmtDataArr.totalComments=postCmtData["ap.totalCmtCnt"],postCmtData.commentId=postCmtData["ap.commentId"],postCmtData.isHTML=postCmtData["ap.isHTML"],cmtDataArr.comments.push(postCmtData)},approveOrRejectAction:function(getThis){var approvalSettings,action="zp_modal_blubtn"===getThis.id||"zp_modal_all_appr_btn"===getThis.id?1:0,approvalComment=Layout.Page.container.find("#approval_comment").val(),callback=ZPApprovals.approveOrRejectActionCallback;"-1"!=Layout.Page.container.find("#approval_formlist").val()&&(approvalSettings=ZPApprovals.getApprovalSettings(Layout.Page.container.find("#approval_formlist").val())),ZPView.isApproverViewType(Layout.Page.urlparam.viewId)&&(callback=ZPApprovals.appOrRejforApproverViewCallback),ZPForm.validateApprovalComment(action,approvalComment,approvalSettings,Layout.Page.container.find("#zp_approval_pop #zp_modal_body #approval_comment"))?($("#"+Layout.Page.pageId).find('[name="bulk_appr_btn"]').attr("disabled",!0),ZPForm.Record.approveReject(ZPApprovals.APPROVE_RECIDS,action,approvalComment,"zp_modal_all_appr_btn"===getThis.id,callback)):$("#"+Layout.Page.pageId).find('[name="bulk_appr_btn"]').attr("disabled",!1)},approveOrRejectActionCallback:function(result,params){if("forwardMyApprovals"===params.method&&void 0!=result.successMsg&&ZPeople.Message.showSuccessMsg(result.successMsg),ZPeople.BSModal.hide(),$("#"+Layout.Page.pageId).find("#page_content").empty(),ZPApprovals.getReqOrAppr(result),ZPApprovals.APPROVE_RECIDS=[],Layout.Page.container.find("#zp_approval_approve").fadeOut(200,function(){$(this).siblings("#zp_approval_filter").fadeIn(200)}),-1!==Layout.Page.hash.indexOf("approvals/myapproval")){var selRec=0;Layout.Page.container.find("tr[id^=zp_approval_rec_]").find("#zp_approval_check").each(function(){this.disabled||(selRec+=1)}),ZPApprovals.TOTAL_RECS=selRec,0===selRec&&(Layout.Page.container.find("#zp_approval_header #zp_approval_check").attr("disabled",!0),Layout.Page.container.find("#zp_approval_header .checkbox").addClass("disabled"))}},appOrRejforApproverViewCallback:function(result){ZPeople.BSModal.hide(),ZPApprovals.APPROVE_RECIDS=[],ZPView.setViewPropertie("refreshStatus",!0),Layout.Page.container.find("#zp_view_record_delete").fadeOut(200,function(){$(this).siblings("#zp_views_formrecactions").fadeIn(200)}),result.hasOwnProperty("errorMsg")&&ZPeople.Message.showFailureMsg(result.errorMsg),ZPView.init()},constructApproveOrReject:function(recRow,approvalStatus,approvalResponse){0!==Layout.Page.container.find("#zp_approval_check").length&&(recRow.find("#zp_approval_check")[0].checked=!1),recRow.find("#zp_approval_check").attr("disabled",!0),recRow.find(".checkbox").addClass("disabled"),recRow.attr("status",approvalStatus);var apprRejMessage,approveBtnColumn=(-1!==Layout.Page.hash.indexOf("approvals/myrequest")?recRow.find("#zp_approval_viewrequest"):recRow.find("#zp_approval_approvereject")).parent().empty();if(approvalStatus==zpconst.ApprovalStatus.Approved){var apprRejDate=approvalResponse.processed[approvalResponse.processed.length-1].approvedTime;apprRejMessage='<a onclick="ZPApprovals.viewRequestedForm(this)"><span class="grn">'+ZPI18N.getString("zp.approved")+'</span> <span class="blk">'+ZPI18N.getString("zp.on",[""])+" "+apprRejDate+"</span>"}else if(approvalStatus==zpconst.ApprovalStatus.Rejected){apprRejDate=approvalResponse.processed[approvalResponse.processed.length-1].approvedTime;apprRejMessage='<a onclick="ZPApprovals.viewRequestedForm(this)"><span class="red">'+ZPI18N.getString("zp.rejected")+'</span> <span class="blk">'+ZPI18N.getString("zp.on",[""])+" "+apprRejDate+"</span>"}else approvalStatus==zpconst.ApprovalStatus.Pending&&-1===Layout.Page.hash.indexOf("approvals/myrequest")&&(apprRejMessage=approvalResponse.isPrimaryAppr?'<button class="btn btn-default btn-sm" id="zp_approval_approvereject" type="button" onclick="ZPApprovals.viewRequestedForm(this)">'+ZPI18N.getString("zp.clicktoapprovereject")+"</button>":'<a id="zp_approval_viewrequest" onclick="ZPApprovals.viewRequestedForm(this)"><span class="blk">'+ZPI18N.getString("zp.pendingmessage")+"</span></a>");approveBtnColumn.append(apprRejMessage),-1!==Layout.Page.hash.indexOf("approvals/myapproval")&&(ZPApprovals.TOTAL_RECS-=1,0===ZPApprovals.TOTAL_RECS&&(Layout.Page.container.find("#zp_approval_header #zp_approval_check").attr("disabled",!0),Layout.Page.container.find("#zp_approval_header .checkbox").addClass("disabled")))},showHideCancelBtn:function(recordStatus,isfromAttendence,isfromTimesheet,moreLayout,isRecordAdmin,approvalSettings){if((void 0==moreLayout&&null!=ZPForm.LAYOUT&&(moreLayout=ZPForm.LAYOUT.find("#ZP_Form_MoreOpt")),moreLayout)&&(moreLayout.find("#zp_appr_cancel").closest("li").remove(),((isadmin||isRecordAdmin)&&(recordStatus==zpconst.ApprovalStatus.Pending||recordStatus==zpconst.ApprovalStatus.Approved)||ZPApprovals.isApprRecordOwner()&&(recordStatus==zpconst.ApprovalStatus.Pending||approvalSettings&&approvalSettings.isCancelApprovedRec&&recordStatus==zpconst.ApprovalStatus.Approved))&&ZPApprovals.isModuleForm(ZPForm.getTableName(),isfromAttendence,isfromTimesheet)&&ZPApprovals.isRecordBaseUrl())){var cancelHTML='<li id="cancelBtn"><a onclick="ZPView.confirmCancelRecord()" id="zp_appr_cancel"><i class="IC-rejected"></i>'+ZPI18N.getString("zp.cancelrecord")+"</a></li>";moreLayout.find(".dropdown-menu").prepend(cancelHTML)}},showHideSendApprBtn:function(headerDiv,recordStatus,isRecordAdmin){headerDiv.siblings("#sendApprBtn").remove();var orgBasedPerm=!1;if(ZPForm.CURRFORM_PARAM.formId&&("444399000134373317"==ZPForm.CURRFORM_PARAM.formId||"100597000023832001"==ZPForm.CURRFORM_PARAM.formId||"387345000000035743"==ZPForm.CURRFORM_PARAM.formId||Layout.ISDEV)){var recordOwnerSubList=ZPUtil.getCommonElementsInArrays(ZPeople.SUB_USERLIST,ZPForm.RecordApproval.OWNER_ERECNO);orgBasedPerm=recordOwnerSubList&&recordOwnerSubList.length>0}if((recordStatus==zpconst.ApprovalStatus.NotSubmitedd||recordStatus==zpconst.ApprovalStatus.NoStatus)&&(ZPApprovals.isApprRecordOwner()||isadmin||isRecordAdmin||orgBasedPerm)){var sendForApprHTML=$(ZPApprovals.getSendApprHTML());return Layout.Page.container.find("#zp_appproval_container").length>0?Layout.Page.container.find("#zp_appproval_container").html(sendForApprHTML):sendForApprHTML.insertBefore(headerDiv),sendForApprHTML.on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).attr("disabled",!0),$(this).off("click"),ZPForm.RecordApproval.triggerApprovalManually(this)}),!0}return!1},getSendApprHTML:function(){return'<button class="btn btn-primary" id="sendApprBtn" name="apprRelBtn">'+ZPI18N.getString("zp.sendforapproval")+"</button>"},showHideShowApproval:function(headerDiv,recordStatus,isRecordAdmin,approvalSettings,isSlider){return isSlider||approvalSettings&&approvalSettings.isVerifySend&&(recordStatus==zpconst.ApprovalStatus.NotSubmitedd||recordStatus==zpconst.ApprovalStatus.NoStatus)&&(isadmin||isRecordAdmin||ZPApprovals.isApprRecordOwner()&&approvalSettings&&approvalSettings.isNotifyRecordOwner)?(headerDiv.find("#showApprBtn").removeClass("zp_dyn"),headerDiv.attr("class","zp-recordsts"),headerDiv.find("#zp_appproval_comment_btn").addClass("zp_dyn"),headerDiv.find(".msg").empty(),isSlider&&ZPApprovals.addSendApprClickEvent(),ZPApprovals.addShowApprovalClick(headerDiv,isRecordAdmin),!0):(headerDiv.find("#showApprBtn").addClass("zp_dyn"),headerDiv.addClass("zp_dyn"),headerDiv.find("#zp_appproval_comment_btn").removeClass("zp_dyn"),!1)},addShowApprovalClick:function(headerDiv,isRecordAdmin){headerDiv&&(headerDiv.find("#showApprBtn").text(ZPI18N.getString("zp.viewapprovers")),headerDiv.find("#showApprBtn").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).attr("disabled",!0),$(this).off("click"),ZPApprovals.showApproval(isRecordAdmin)}))},showApproval:function(isRecordAdmin){ZPApprovals.showHideApprDetailsBtn(!0),ZPApprovals.getApprovalDetails()},addSendApprClickEvent:function(getThis){(getThis?$(getThis):Layout.Page.container.find("#approvalpopup_"+ZPApprovals.RECORDID+" .modal-footer #sendApprBtn")).off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).attr("disabled",!0),$(this).off("click"),ZPForm.RecordApproval.triggerApprovalManually(this)})},getApproverChoosenHTML:function(){return'<div class="col-sm-6" id="zp_form_approver"><select id="zp_form_chooseapprover" name="zp_approverId">'+ZPeople.User.getEmployeeListFormatByType("option")+"</select></div>"},getModuleAdminFormList:function(){return["P_EmployeeSalary","P_Goals","P_MultiRater_Approval","P_Goalsheet","P_Budget","P_ReviewApprovalSheet",Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME]},isAdmin:function(baseTableName,others){return isadmin&&others&&ZPUtil.checkIsExistInArray(ZPApprovals.getModuleAdminFormList(),baseTableName)?others.isRecordAdmin:isadmin||others.isRecordAdmin},showApprovalHeader:function(recordStatus,isRecordApprover,isPrimaryAppr,others,apprData,apprAct){var formId=ZPApprovals.FORMID,recordId=ZPApprovals.RECORDID,layout=void 0!==(others=void 0!=others?others:{}).layout?others.layout:ZPForm.LAYOUT,headerBtn=layout.find("#headerApprovalBtn");void 0!==others.callback&&(ZPForm.RecordApproval.APPROVAL_CALLBACK=others.callback);var approvalSettings=others.approvalSettingsDetails?others.approvalSettingsDetails:ZPForm.CONF.approvalSettingsDetails?ZPForm.CONF.approvalSettingsDetails:ZPApprovals.getApprovalSettings(formId)?ZPApprovals.getApprovalSettings(formId):{};headerBtn.length<1&&others.moreLayout&&(headerBtn=$('<div class="zp-recordsts zp_dyn '+(others.className?others.className:"")+'" id="headerApprovalBtn"><span class="msg"></span><a id="zp_appproval_comment_btn" onclick="ZPApprovals.getApprovalDetails()">'+ZPI18N.getString("zp.view")+"</a></div>")).insertBefore(others.moreLayout),headerBtn.addClass("zp_dyn"),layout.find('[name="apprRelBtn"]').addClass("zp_dyn"),layout.find(".modal-footer").find("#zp_approval_resubmitbtn").addClass("DN");var headerClass="",headerMsg="";if(void 0!=recordStatus){ZPApprovals.showHideCancelBtn(recordStatus,others.isfromAttendence,others.isfromTimesheet,others.moreLayout,others.isRecordAdmin,approvalSettings);var isShowApproval=ZPApprovals.showHideShowApproval(headerBtn,recordStatus,others.isRecordAdmin,approvalSettings);if(ZPApprovals.showHideSendApprBtn(headerBtn,recordStatus,others.isRecordAdmin)||isShowApproval)return void("APPROVER_CHOOSEN_BY_USER"===ZPForm.getApproverType()&&(layout.find(".modal-footer #zp_appproval_container").find("#zp_form_approver").length>0?layout.find(".modal-footer #zp_appproval_container").find("#zp_form_approver").removeClass("DN"):(layout.find(".modal-footer #zp_appproval_container").prepend(ZPApprovals.getApproverChoosenHTML()),layout.find(".modal-footer #zp_appproval_container").find("#zp_form_chooseapprover").select2())));if(layout.find(".modal-footer").find("#zp_form_approver").addClass("DN"),headerBtn.find("span .CR-pending-cancel").remove(),recordStatus!=zpconst.ApprovalStatus.Draft&&(ZPApprovals.isAdmin(ZPForm.getTableName(),others)||isRecordApprover||isPrimaryAppr||ZPApprovals.canViewApproval(recordId)||!approvalSettings||approvalSettings.isNotifyRecordOwner)?headerBtn.find("#zp_appproval_comment_btn").removeClass("zp_dyn"):(headerBtn.find("#zp_appproval_comment_btn").addClass("zp_dyn"),headerBtn.find("#zp_appproval_comment_btn").off("click")),recordStatus==zpconst.ApprovalStatus.Approved)headerClass="success",headerMsg=ZPI18N.getString("zp.approved");else if(recordStatus==zpconst.ApprovalStatus.Pending)headerMsg=ZPI18N.getString("zp.approvalpending"),headerClass="wait";else if(recordStatus==zpconst.ApprovalStatus.CancellationPending){var cancelPendIcon='<i class="CR-pending-cancel org S20" data-toggle="tooltip" data-placement="bottom" data-original-title=\''+(headerMsg=ZPI18N.getString("zp.cancellationpending"))+'\'><i class="path1"></i><i class="path2"></i></i>'+headerMsg;headerBtn.find("span").html(cancelPendIcon)}else if(recordStatus==zpconst.ApprovalStatus.Draft)headerClass="draft",headerMsg=ZPI18N.getString("zp.draft");else if(recordStatus==zpconst.ApprovalStatus.Cancelled||recordStatus==zpconst.ApprovalStatus.Rejected){var tableName=ZPForm.getTableName();(ZPApprovals.isApprRecordOwner()||isadmin||others.isRecordAdmin)&&ZPApprovals.isModuleForm(tableName,others.isfromAttendence,others.isfromTimesheet)&&ZPApprovals.isRecordBaseUrl()&&ZPForm.Permission.isPermitted(ZPForm.Permission.getAddPerm())&&(layout.find(".modal-footer").find("#zp_approval_resubmitbtn").removeClass("DN"),layout.find(".modal-footer").find("#zp_approval_resubmitbtn").closest("div").attr("class","col-sm-12"),layout.find(".modal-footer").find("#zp_appproval_close").addClass("FR"),layout.find(".modal-footer").find("#zp_approval_resubmitbtn").off("click").on("click",function(){ZPForm.RecordApproval.onRecordResubmit()})),recordStatus==zpconst.ApprovalStatus.Rejected?(headerClass="reject",headerMsg=ZPI18N.getString("zp.rejected")):(headerClass="cancel",headerMsg=ZPI18N.getString("zp.cancelled"))}if((others.isfromAttendence||others.isfromAttendenceShift||others.isFromSalaryRevision)&&(headerClass+=" FR MR45I"),others.isTransfer&&(headerClass+=" empTstats"),""!==headerClass||recordStatus==zpconst.ApprovalStatus.CancellationPending){if(headerBtn.attr("class",(others.isProfilePic?"sts-pht ":"zp-recordsts ")+headerClass),recordStatus!=zpconst.ApprovalStatus.CancellationPending&&headerBtn.find("span").text(headerMsg),headerBtn.attr("name","appr_status_"+recordId),headerBtn.removeClass("zp_dyn"),isPrimaryAppr){var apprBtn=recordStatus==zpconst.ApprovalStatus.CancellationPending?ZPI18N.getString("zp.extenddecline"):ZPI18N.getString("zp.clicktoapprovereject");headerBtn.find("#zp_appproval_comment_btn").text(apprBtn)}else headerBtn.find("#zp_appproval_comment_btn").text(ZPI18N.getString("zp.view"));if("P_ShiftMappingForm"===ZPForm.getTableName()||"P_AttendanceReg"===ZPForm.getTableName()||"P_AttendanceOD"===ZPForm.getTableName()||"P_TimesheetList"===ZPForm.getTableName()||"P_PermissionDetails"===ZPForm.getTableName()){var appData=apprData;void 0==apprData&&(appData=ZPApprovals.APPROVAL_DETAILS[recordId]);var otherDtls={};"P_TimesheetList"===ZPForm.getTableName()&&(otherDtls.isfromTimesheet=!0),"P_ShiftMappingForm"===ZPForm.getTableName()&&(otherDtls.isfromAttendenceShift=!0),"P_AttendanceReg"!==ZPForm.getTableName()&&"P_AttendanceOD"!==ZPForm.getTableName()&&"P_PermissionDetails"!==ZPForm.getTableName()||(otherDtls.isfromAttendance=!0),ZPApprovals.showApprovalFooter(isPrimaryAppr,void 0!==appData&&void 0!==appData.current,appData,otherDtls)}else recordStatus==zpconst.ApprovalStatus.Rejected&&"P_EmployeeLeave"===ZPForm.getTableName()&&ZPForm.LAYOUT.find(".modal-footer").find("#zp_cancelleave_btn").remove();var followUpHTML;if(headerBtn.siblings("#zp_approval_followupbtn").remove(),(recordStatus==zpconst.ApprovalStatus.Pending||recordStatus==zpconst.ApprovalStatus.CancellationPending)&&!isPrimaryAppr&&!isadmin&&ZPApprovals.isApprRecordOwner())"P_AttendanceReg"===ZPForm.getTableName()||"P_AttendanceOD"===ZPForm.getTableName()||"P_PermissionDetails"===ZPForm.getTableName()||"P_ShiftMappingForm"===ZPForm.getTableName()?(followUpHTML=$('<a class="btn btn-default bt-sm FR MR10" id="zp_approval_followupbtn" name="apprRelBtn" recordid="'+recordId+'">'+ZPI18N.getString("zp.sendfollowup")+"</a>")).insertAfter(headerBtn):(followUpHTML=$('<a class="btn btn-default bt-sm MR10" id="zp_approval_followupbtn" name="apprRelBtn" recordid="'+recordId+'">'+ZPI18N.getString("zp.sendfollowup")+"</a>")).insertBefore(headerBtn),followUpHTML.on("click",function(e){e.stopPropagation(),e.preventDefault(),ZPeople.confirm(this,"zp.sendfollowuphdr","zp.sendfollowupdesc",ApprovalProcess.sendFollowupMail)});-1!==Layout.Page.hash.indexOf("approvals/myapproval")&&ZPApprovals.viewApprTimeLine&&!headerBtn.find("#zp_appproval_comment_btn").hasClass("zp_dyn")&&headerBtn.find("#zp_appproval_comment_btn").trigger("click")}}},showApprovalFooter:function(isPrimAppr,isCurrAppr,apprData,otherDtls){var isfromTimesheet=!!otherDtls.hasOwnProperty("isfromTimesheet")&&otherDtls.isfromTimesheet,footerId="ZPAtt_Reg_AppHierarchy";otherDtls.hasOwnProperty("isfromAttendenceShift")&&otherDtls.isfromAttendenceShift&&(footerId="ZPAtt_Shift_AppHierarchy");var layout=ZPForm.LAYOUT;isfromTimesheet&&(footerId="timesheet_view_create",(layout=Layout.Page.container).find("#zp_appproval_list").hide()),"P_PermissionDetails"===ZPForm.getTableName()&&(footerId="ZPAtt_Permission_AppHierarchy"),"P_AttendanceOD"===ZPForm.getTableName()&&(footerId="ZPAtt_OD_AppHierarchy");var footerBtn=layout.find("#"+footerId);if("P_PermissionDetails"===ZPForm.getTableName()||"P_AttendanceOD"===ZPForm.getTableName()||"P_ShiftMappingForm"===ZPForm.getTableName()||"P_AttendanceReg"===ZPForm.getTableName()){var apprAct=apprData.approvalAction,approveTxt=1==apprAct?ZPI18N.getString("zp.accept"):ZPI18N.getString("zp.approve"),rejectTxt=1==apprAct?ZPI18N.getString("zp.workflow.decline"):ZPI18N.getString("zp.rejectall");footerBtn.find("#zp_appproval_approve_btn").text(approveTxt),footerBtn.find("#zp_appproval_reject_btn").text(rejectTxt)}isPrimAppr||isadmin&&isCurrAppr||isfromTimesheet&&isCurrAppr?(ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]=apprData,footerBtn.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").show(),ZPApprovals.showApproveRejectBox("1",!0,footerBtn,ZPApprovals.FORMID),Layout.Page.container.find("[id=zp_approvereject_box]").find("i.CmtsBoxCls").trigger("click"),Layout.Page.container.find("[id=zp_approvereject_box]").find("i.CmtsBoxCls").on("click",function(){$(this).parent().addClass("DN");var approvalCont=$(this).siblings().find("#zp_form_approvalbtn_cont"),isAppInit=approvalCont.attr("init");Layout.Page.container.find("#zp_approvereject_box").hide(),Layout.Page.container.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").show(),"true"===isAppInit&&(approvalCont.removeAttr("init"),approvalCont.find("#zp_approval_confirm_btn").removeClass("MT20").addClass("MT53"),approvalCont.find("#zp_approval_reject_btn").remove(),$(this).parent().removeClass("RsltP"))})):(footerBtn.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn, #zp_approval_confirm_btn").off("click"),footerBtn.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").hide(),footerBtn.find("#zp_approvereject_box").addClass("DN"))},showApproveRejectBox:function(type,isInitial,footerBtn,formId){var currApprRejBox=footerBtn.find("#zp_approvereject_box").removeClass("DN");if(currApprRejBox.length>0&&!isInitial)currApprRejBox.attr("type",type),currApprRejBox.find("#zp_form_approvalbtn_cont #zp_approval_confirm_btn").removeClass("MT53").addClass("MT40"),currApprRejBox.find("#zp_form_approvalbtn_cont .checkbox").remove(),"1"===type?(currApprRejBox.addClass("RsltA").removeClass("RsltR"),currApprRejBox.find(".IC-ar-dwn").addClass("grn").removeClass("red"),currApprRejBox.find("#zp_approval_confirm_btn").addClass("btn-success").removeClass("btn-danger"),isadmin&&ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]&&ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].pending.length>0&&(currApprRejBox.find("#zp_form_approvalbtn_cont").prepend('<label class="checkbox PT25"><input type="checkbox"><span></span>'+ZPI18N.getString("zp.approveall")+"</label>"),currApprRejBox.find("#zp_form_approvalbtn_cont #zp_approval_confirm_btn").removeClass("MT53").addClass("MT12"))):(currApprRejBox.addClass("RsltR").removeClass("RsltA"),currApprRejBox.find(".IC-ar-dwn").addClass("red").removeClass("grn"),currApprRejBox.find("#zp_approval_confirm_btn").addClass("btn-danger").removeClass("btn-success")),currApprRejBox.find("#zp_approval_confirm_btn").html(ZPI18N.getString("zp.confirm"));else{var appRejBox=$('<div id="zp_approvereject_box" formId="'+formId+'"'+(isInitial?"":'type="'+type+'"')+'class="ZPAprvCmts pad top '+(isInitial?"RsltP":"1"===type?"RsltA":"RsltR")+' Bclr"><i class="IC-cls-1px CP CmtsBoxCls"></i><div class="darrow" style="left: 0px;"></div><div class="CmtBox"><div class="row"><div class="col-sm-10"><label>'+ZPI18N.getString("zp.comment")+'&nbsp;:</label><textarea id="zp_approval_comment" class="form-control" rows="3" placeholder="'+ZPI18N.getString("zp.approvalcommentplaceholder")+'"></textarea></div>'+(isInitial?'<div class="col-sm-2" id="zp_form_approvalbtn_cont" init="true"><button id="zp_approval_confirm_btn" class="btn DB btn-success MT20">'+ZPI18N.getString("zp.approve")+'</button><button id="zp_approval_reject_btn" class="btn DB btn-danger MT5" style="margin-left: 0px;">'+ZPI18N.getString("zp.reject")+"</button></div>":"")+"</div></div></div>");appRejBox.find(".IC-cls-1px").on("click",function(){$(this).parent().addClass("DN");var approvalCont=$(this).siblings().find("#zp_form_approvalbtn_cont"),isAppInit=approvalCont.attr("init");Layout.Page.container.find("#zp_approvereject_box").hide(),Layout.Page.container.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").show(),"true"===isAppInit&&(approvalCont.removeAttr("init"),approvalCont.find("#zp_approval_confirm_btn").removeClass("MT20").addClass("MT53"),approvalCont.find("#zp_approval_reject_btn").remove(),$(this).parent().removeClass("RsltP"))}),footerBtn.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").off("click").on("click",function(){ZPApprovals.showApproveRejectBox($(this).attr("approvaltype"),!1,footerBtn);$('<div id="zp_approvereject_box" '+(isInitial?"":'type="'+type+'"')+'class="ZPAprvCmts pad top '+(isInitial?"RsltP":"1"===type?"RsltA":"RsltR")+' Bclr"><i class="IC-cls-1px CP CmtsBoxCls"></i><div class="darrow" style="left: 0px;"></div><div class="CmtBox"><div class="row"><div class="col-sm-10"><label>'+ZPI18N.getString("zp.comment")+'&nbsp;:</label><textarea id="zp_approval_comment" class="form-control" rows="3" placeholder="'+ZPI18N.getString("zp.approvalcommentplaceholder")+'"></textarea></div>'+(isInitial?'<div class="col-sm-2" id="zp_form_approvalbtn_cont" init="true"><button id="zp_approval_confirm_btn" class="btn DB btn-success MT20">'+ZPI18N.getString("zp.approve")+'</button><button id="zp_approval_reject_btn" class="btn DB btn-danger MT5" style="margin-left: 0px;">'+ZPI18N.getString("zp.reject")+"</button></div>":"")+"</div></div></div>");Layout.Page.container.find("#zp_approvereject_box").show(),footerBtn.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").hide()}),appRejBox.find("#zp_approval_confirm_btn, #zp_approval_reject_btn").on("click",function(){var formId=footerBtn.find("#zp_approvereject_box").attr("formId"),type=footerBtn.find("#zp_approvereject_box").attr("type");void 0===type&&(type=$(this).hasClass("btn-success")?"1":"0");var apprAct=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].approvalAction,isAllLevelApprove=!1;footerBtn.find("#zp_form_approvalbtn_cont input").prop("checked")&&(isAllLevelApprove=!0),$(this).parent().find("button").addClass("disabled");var comment=footerBtn.find("#zp_approval_comment").val();ZPForm.validateApprovalComment(type,comment,ZPApprovals.getApprovalSettings(formId),footerBtn.find("#zp_approval_comment"))?("P_AttendanceReg"==ZPForm.getTableName()?(Attendance.Reg.appRejRegDetails(type,isAllLevelApprove,comment,ZPApprovals.RECORDID,apprAct),Layout.Page.container.find("#zp_approvereject_box").hide()):"P_PermissionDetails"==ZPForm.getTableName()?ZPForm.Record.approveReject(new Array(ZPApprovals.RECORDID),type,comment,isAllLevelApprove,Attendance.Permissions.approvalCallback,!0,formId):"P_AttendanceOD"==ZPForm.getTableName()?Attendance.OD.appRejODDetails(type,isAllLevelApprove,comment,ZPApprovals.RECORDID,apprAct):ZPForm.getTableName()==Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME&&ZPForm.Record.approveReject(new Array(ZPApprovals.RECORDID),type,comment,isAllLevelApprove,Compensation.Revision.approvalCallback,!0,formId),"P_ShiftMappingForm"==ZPForm.getTableName()&&(AttendanceShift.appRejShiftDetails(type,isAllLevelApprove,comment,ZPApprovals.RECORDID,apprAct),Layout.Page.container.find("#zp_approvereject_box").hide()),void 0!==ZPForm.RecordApproval.APPROVAL_CALLBACK&&"function"==typeof ZPForm.RecordApproval.APPROVAL_CALLBACK&&ZPForm.RecordApproval.APPROVAL_CALLBACK(type,comment,isAllLevelApprove)):appRejBox.find("#zp_approval_confirm_btn").removeClass("disabled")}),0==currApprRejBox.length?footerBtn.prepend(appRejBox):currApprRejBox.replaceWith(appRejBox)}},isRecordBaseUrl:function(){return-1==Layout.Page.hash.indexOf("approvals/myapproval")&&-1==Layout.Page.hash.indexOf("approvals/myrequest")&&-1==Layout.Page.hash.indexOf("home/dashboard")&&-1==Layout.Page.hash.indexOf("home/feeds/myfeed")&&-1==Layout.Page.hash.indexOf("dashboard/feeds")&&-1==Layout.Page.hash.indexOf("dashboard/approvals")&&-1==Layout.Page.hash.indexOf("admin/dataadministration/activityLog")},isModuleForm:function(tableName,isfromAttendence,isfromTimesheet){return"P_EmployeeLeave"!=tableName&&"P_Compensatory"!=tableName&&"P_LeaveGrant"!=tableName&&"P_Employee"!=tableName&&"P_Designation"!=tableName&&"P_Department"!=tableName&&"P_Goals"!=tableName&&"P_ReviewApprovalSheet"!=tableName&&"P_MultiRater"!==tableName&&"P_MultiRater_Approval"!==tableName&&"P_ShiftMappingForm"!==tableName&&"P_AttendanceOD"!==tableName&&"P_PermissionDetails"!==tableName&&!isfromAttendence&&!isfromTimesheet},getApprovalIcon:function(apprStatus,isApprovalEnabled,tableName){return-1!=[zpconst.ApprovalStatus.CancellationPending,zpconst.ApprovalStatus.Pending,zpconst.ApprovalStatus.Rejected,zpconst.ApprovalStatus.Approved,zpconst.ApprovalStatus.Cancelled].indexOf(apprStatus)||(-2===apprStatus||-3===apprStatus)&&ZPForm.isApprovalEnabled()||11!==apprStatus&&14!==apprStatus&&"P_MultiRater"===tableName?ZPApprovals.getIconHtml(apprStatus):""},getIconHtml:function(apprStatus){var iconHtml="";switch(apprStatus){case zpconst.ApprovalStatus.CancellationPending:iconHtml='<i class="CR-pending-cancel org S18" data-toggle="tooltip" data-placement="top" data-original-title="'+ZPI18N.getString("zp.cancellationpending")+'"><i class="path1"></i><i class="path2"></i></i>';break;case zpconst.ApprovalStatus.NotSubmitedd:case zpconst.ApprovalStatus.NoStatus:iconHtml='<i class="CR-notsend gry S18"  data-toggle="tooltip" data-placement="top" data-original-title="'+ZPI18N.getString("zp.notsentforapproval")+'"></i>';break;case zpconst.ApprovalStatus.Pending:iconHtml='<i class="IC-pending org S18" data-toggle="tooltip" data-placement="top" data-original-title="'+ZPI18N.getString("zp.approvalpending")+'"><i class="path1"></i><i class="path2"></i></i>';break;case zpconst.ApprovalStatus.Rejected:iconHtml='<i class="IC-unlike  red S21" data-toggle="tooltip" data-placement="top" data-original-title="'+ZPI18N.getString("zp.rejected")+'"></i>';break;case zpconst.ApprovalStatus.Approved:iconHtml='<i class="IC-like grn S21"  data-toggle="tooltip" data-placement="top" data-original-title="'+ZPI18N.getString("zp.approved")+'"></i>';break;case zpconst.ApprovalStatus.Cancelled:iconHtml='<i class="IC-rejected red S18"  data-toggle="tooltip" data-placement="top" data-original-title="'+ZPI18N.getString("zp.recordcancelled")+'"></i>';break;default:iconHtml='<i class="IC-draft gry S16"  data-toggle="tooltip" data-placement="top" data-original-title="'+ZPI18N.getString("zp.savedasdraft")+'"></i>'}return iconHtml}},ZPApprovals.Filter={constructOptions:function(){AdvancedFilter.constructFilter(ZPApprovals.Filter.getOptionProperties(),ZPApprovals.Filter.search)},getOptionProperties:function(){var filterArr=[];if(-1!=Layout.Page.hash.indexOf("approvals/myrequest"))(isadmin||isAdminProfile&&-1!==Layout.Page.hash.indexOf("approvals/myrequest"))&&filterArr.push({parentDiv:"employeeApprovalCombo",type:"select",menuProperties:ZPApprovals.Filter.getEmployeeOptionProperties(),title:ZPI18N.getString("zp.addedby")});else{isadmin&&filterArr.push({parentDiv:"employeeApprovalCombo",type:"select",menuProperties:ZPApprovals.Filter.getEmployeeOptionProperties(),title:ZPI18N.getString("zp.approver")}),filterArr.push({parentDiv:"recordOwnerApprovalCombo",type:"select",menuProperties:ZPApprovals.Filter.getEmployeeOptionProperties("MYAPPROVALS_RECORDOWNER"),title:ZPI18N.getString("zp.recordowner")});var emp_status_filter={parentDiv:"emp_status_filter",type:"select",menuProperties:ZPApprovals.Filter.getEmpStatusOptionProperties(),title:ZPI18N.getString("zp.employeestatus")}}return ZPApprovals.APPROVAL_FORMLIST&&filterArr.push({parentDiv:"approval_formlist",type:"select",menuProperties:ZPApprovals.Filter.getFormOptionProperties(),title:ZPI18N.getString("zp.forms")}),filterArr.push({parentDiv:"approval_status_filter",type:"select",menuProperties:ZPApprovals.Filter.getStatusOptionProperties(),title:ZPI18N.getString("zp.status")}),void 0!=emp_status_filter&&filterArr.push(emp_status_filter),filterArr},getStatusOptionProperties:function(){var approvalStatusOptions=[];return approvalStatusOptions.push({id:"all",value:ZPI18N.getString("zp.allstatus")}),approvalStatusOptions.push({id:"pending",value:ZPI18N.getString("zp.pending"),isDefaultValue:!0}),approvalStatusOptions.push({id:"approved",value:ZPI18N.getString("zp.approved")}),approvalStatusOptions.push({id:"rejected",value:ZPI18N.getString("zp.rejected")}),-1!=Layout.Page.hash.indexOf("approvals/myrequest")&&approvalStatusOptions.push({id:"cancelled",value:ZPI18N.getString("zp.cancelled")}),{id:"mainmenu",data:approvalStatusOptions,checkbox:!1,isMandatory:!0,retainDefaultValue:!0}},getEmpStatusOptionProperties:function(){var empStatusOptions=[];return empStatusOptions.push({id:zpconst.EmployeeStatus.all,value:ZPI18N.getString("zp.allrequest")}),empStatusOptions.push({id:zpconst.EmployeeStatus.activeemprecord,value:ZPI18N.getString("zp.activeemprequest"),isDefaultValue:!0}),empStatusOptions.push({id:zpconst.EmployeeStatus.exitemprecord,value:ZPI18N.getString("zp.exemprequest")}),{id:"mainmenu",data:empStatusOptions,checkbox:!1,isMandatory:!0,retainDefaultValue:!0}},getFormOptionProperties:function(){return{id:"mainmenu",data:ZPApprovals.APPROVAL_FORMLIST,checkbox:!1,isMandatory:!0,retainDefaultValue:!0}},getEmployeeOptionProperties:function(mode){var returnObj={checkbox:!1},searchMode="APPROVALS_MYAPPROVALS";return-1!==Layout.Page.hash.indexOf("approvals/myrequest")&&(searchMode="APPROVALS_MYREQUESTS"),"MYAPPROVALS_RECORDOWNER"==mode?(returnObj.defaultSelectText=ZPI18N.getString("zp.allusers"),returnObj.callback=function(liObj,srcObj){ZPApprovals.Filter.disableEmpStatusFilter(liObj,srcObj)},returnObj.callbackOnCancel=function(srcObj){ZPApprovals.Filter.enableEmpStatusFilter(srcObj)},searchMode="APPROVALS_MYAPPROVALS_RECORDOWNER"):returnObj.isMandatory=!0,returnObj.id=searchMode,returnObj.data=function(initObj){var empData=EmployeeDropdown.getEmpList($(initObj).val(),"emp",searchMode,[],{},!1);return"MYAPPROVALS_RECORDOWNER"!=mode&&empData.unshift({id:0,value:ZPI18N.getString("zp.allusers")}),empData},returnObj},disableEmpStatusFilter:function(liObj,srcObj){"recordOwnerApprovalCombo_input"==srcObj.attr("id")&&Layout.Page.container.find("#emp_status_filter").addClass("isDisabled")},enableEmpStatusFilter:function(srcObj){"recordOwnerApprovalCombo_input"==srcObj.attr("id")&&Layout.Page.container.find("#emp_status_filter").removeClass("isDisabled")},getFilterValue:function(inputId){var filterDiv=Layout.Page.container.find("#"+inputId+" input");if(filterDiv.length>0)return filterDiv.attr("selectedIds");switch(inputId){case"approval_formlist":return"-1";case"approval_status_filter":return"pending";case"emp_status_filter":return zpconst.EmployeeStatus.activeemprecord}},search:function(){ZPApprovals.Filter.resetApprovalFireScroll(),ZPApprovals.resetApprovalPage()},resetApprovalFireScroll:function(){var fireScrollProperty=ZPeople.FireScroll.getFireScrollPropertie();fireScrollProperty&&(fireScrollProperty.triggered=!0)}},ZPReview={getForwardMenuProperty:function(){return{id:"forwardList",data:function(searchObj){var searchVal=void 0==$(searchObj).val()?"":$(searchObj).val();return EmployeeDropdown.getEmpList(searchVal,"emp","DELEGATION_DELEGATOR",ZPReview.getNonValidForwardUsers(),void 0,!1,ZPeople.getUserDetailsById(erecno).reportingTo)},noDataText:ZPI18N.getString("zp.searchforward"),searchNotFoundText:ZPI18N.getString("zp.nomatchesfound")}},getNonValidForwardUsers:function(){var notEligibleForwardingUser=new Array;if(notEligibleForwardingUser.push(erecno),ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]){var apprDtl=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID];apprDtl.current&&(notEligibleForwardingUser.push(apprDtl.current.erecno),apprDtl.current.delegatee&&apprDtl.current.delegatee.erecno&&notEligibleForwardingUser.push(apprDtl.current.delegatee.erecno))}return notEligibleForwardingUser},showErrorMsg:function(divToAppend,errorMsg){divToAppend&&$('<div class="error-msg">'+errorMsg+"</div>").insertAfter(divToAppend)},getForwardingHTML:function(configuration){var html='<div class="tlaccept tlapprl" id="'+configuration.headerId+'" name="apprSelectionDiv">';return html+='<div id = "forwardCmt" class="MT5"></div>',html+='<textarea id="fwdCommentDiv" class="form-control MT10 MB15" zprows="3" name="appr_comment_text"></textarea>',html+='<button class="btn btn-delegate" approvalType="'+configuration.type+'"',html+='onclick="ZPReview.forwardValidation(this)"',html+=">"+configuration.primaryBtnText+'</button><button class="btn btn-default" onclick="ZPApprovals.closeForward(this)">'+ZPI18N.getString("zp.cancel")+"</button>",html+="</div>"},forwardValidation:function(getThis){var recordDtl,baseTable=ZPForm.getTableName(),parentDiv=$(getThis).closest("#forwardingDiv"),skipRecordValidation="P_Compensatory"==baseTable||"P_LeaveGrant"==baseTable||"P_AttendanceReg"==baseTable||"P_AttendanceOD"==baseTable||"P_ShiftMappingForm"==baseTable||"P_PermissionDetails"==baseTable;if(skipRecordValidation||(recordDtl=ZPForm.getSingleRecord().record),parentDiv.find(".error-msg").remove(),skipRecordValidation||7e3===recordDtl.code){var apprDtl=ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID];if((skipRecordValidation||recordDtl.message&&(recordDtl.message.approvalStatus==zpconst.ApprovalStatus.Pending||recordDtl.message.approvalStatus==zpconst.ApprovalStatus.CancellationPending))&&apprDtl&&apprDtl.current)if(apprDtl.canForwardApproval)if(skipRecordValidation||recordDtl.isRecordAdmin||apprDtl.isPrimaryAppr){var fwdErecno=parentDiv.find("#appr_forward_id").attr("selectedids");if(void 0!=fwdErecno)if(fwdErecno==apprDtl.current.erecno||void 0!=apprDtl.current.delegatee&&fwdErecno==apprDtl.current.delegatee.erecno)ZPReview.showErrorMsg(parentDiv.find("#fwdCommentDiv"),ZPI18N.getString("zp.apprfrwdcurrapprerr"));else{var comments=parentDiv.find("[name=appr_comment_text]").val();ZPUtil.Validation.isEmpty(comments)?ZPReview.showErrorMsg(parentDiv.find("#fwdCommentDiv"),ZPI18N.getString("zp.commentsrequirederrormsg")):comments.trim().length<=250?ZPReview.forwardApproval(fwdErecno,comments):ZPReview.showErrorMsg(parentDiv.find("#fwdCommentDiv"),ZPI18N.getString("zp.commentlenerr"))}else ZPReview.showErrorMsg(parentDiv.find("#fwdCommentDiv"),ZPI18N.getString("zp.selectapprover"))}else ZPReview.showErrorMsg(parentDiv.find("#fwdCommentDiv"),ZPI18N.getString("zp.ttpermdenied"));else ZPReview.showErrorMsg(parentDiv.find("#fwdCommentDiv"),ZPI18N.getString("zp.forwardonceerr"));else ZPReview.showErrorMsg(parentDiv.find("#fwdCommentDiv"),ZPI18N.getString("zp.recnopending"))}},forwardApproval:function(fwdErecno,comments){Layout.Page.container.find("#forwardingDiv .btn").attr("disabled",!0);var params={method:"forwardApproval",recordId:ZPApprovals.RECORDID,formId:ZPApprovals.FORMID,comment:comments,forwardErecno:fwdErecno};ZPeople.Request.send("/forwardApproval.zp",params,ZPReview.forwardApprovalCallBack,void 0,ZPReview.failureCallBack)},forwardApprovalCallBack:function(resultData,params){if(Layout.Page.container.find("#forwardingDiv .btn").attr("disabled",!1),7e3==resultData.code)ZPApprovals.approveRejectDtlCallBack(resultData,params);else{var parentDiv=Layout.Page.container.find("#forwardingDiv #fwdCommentDiv");resultData.errorMsg?ZPReview.showErrorMsg(parentDiv,resultData.errorMsg):resultData.message&&ZPReview.showErrorMsg(parentDiv,resultData.message)}},resetForward:function(forwardDiv){forwardDiv.find("#appr_forward_id").attr("selectedids",""),forwardDiv.find("#fwdCommentDiv").val(""),forwardDiv.find(".error-msg").remove()},failureCallBack:function(failureData,params){params.method,Layout.Page.container.find("#forwardingDiv .btn").attr("disabled",!1),failureData.hasOwnProperty("responseJSON")&&failureData.responseJSON.hasOwnProperty("error")&&failureData.responseJSON.error.trim().length>0&&ZPeople.Message.showFailureMsg(failureData.responseJSON.error)},bulkForward:function(empRecId,fwdErecno,comments){Layout.Page.container.find("#forwardingDiv .btn").attr("disabled",!0);var params={method:"bulkForwardApproval",empRecordId:empRecId,forwardErecno:fwdErecno};ZPeople.Request.send("/bulkForwardApproval.zp",params,ZPReview.bulkForwardApprovalCallBack,void 0,ZPReview.failureCallBack)},bulkForwardMyApprovals:function(){var params={method:"forwardMyApprovals",comment:$("#cnf_popup").find("#bulkforwardComment #approver_comment").val(),recordIds:JSON.stringify(ZPApprovals.APPROVE_RECIDS),forwardErecno:$("#cnf_popup").find("#forwardPopUp #forwardPopUpDropDown #delegId").attr("selectedIds")},callback=ZPApprovals.approveOrRejectActionCallback;CommonTemplates.Popup.closePopup(),ZPeople.Request.send("/forwardApproval.zp",params,callback,void 0,ZPReview.failureCallBack)},cancelForwardConfirmCallback:function(){Layout.Page.container.find("#forwardingDiv .btn").attr("disabled",!1),$("#cnf_popup").removeClass("DN")},bulkForwardApprovalCallBack:function(resultData,params){var isNeedUrlRefresh=!0;if(resultData)if(7e3==resultData.code)ZPeople.Message.showSuccessMsg("Forwarded all pending approvals");else{var errorMsg=resultData.errMsg?resultData.errMsg:resultData.message;7001==resultData.code||7400==resultData.code?(isNeedUrlRefresh=!1,$("#cnf_popup").find("#forwardPopUp").append("<div class='ERR'>"+errorMsg+"</span>")):ZPeople.Message.showFailureMsg(errorMsg)}isNeedUrlRefresh&&(CommonTemplates.Popup.closePopup(),window.location.href=window.location.href.replace(/\/showApprovalPopUp:(true|false)/,""))},isShowWarningForwardMyApproval:function(){var isShowWarningForwardMyApproval=!1;return-1!==Layout.Page.hash.indexOf("myapproval")&&$("#employeeApprovalCombo_input").attr("selectedIds")!=erecno&&void 0!=$("#employeeApprovalCombo_input").attr("selectedIds")&&Layout.Page.container.find("tr[id^=zp_approval_rec_][isprimaryappr=false]").length>0&&(isShowWarningForwardMyApproval=!0),isShowWarningForwardMyApproval},getBulkForwardMyApprovalsPopUpHTML:function(message){var popupBody='<div id="forwardPopUp" class="MT10"><p class="text-left ML10">'+message+"</p>";return ZPReview.isShowWarningForwardMyApproval()&&($("#cnf_popup").find("#bulkforwardwrng").removeClass("DN"),popupBody+='<div class="dvcheck PT10 clearfix" id="bulkforwardwrng"><p class="P10 tblinfocon table-bordered col-md-12 text-left">'+ZPI18N.getString("zp.bfwrdmyapprwrngmsg")+"</p></div>"),popupBody+='<div id="forwardPopUpDropDown"></div><div id="frwduserselecterr" class="ERR DN">'+ZPI18N.getString("zp.selectapprover")+"</span></div>",popupBody+='<div class="FL W100 MT20" id="bulkforwardComment"><textarea id="approver_comment" class="form-control MB10" rows="3" style="margin-top: 0px; margin-bottom: 10px; height: 80px;" placeholder="Write a comment..."></textarea></div><div id="frwdcommenterr" class="ERR text-left DN"></span></div></div>'},bulkForwardFormPopUp:function(message,showApprovalPopUp){void 0==message&&(message=ZPI18N.getString("zp.bulkforwardpopupcontent"));var popupBody=$('<div id="forwardPopUp" class="MT10"><p class="text-left ML10">'+message+'</p><div id="forwardPopUpDropDown"></div></div>');CommonTemplates.getSelectMenu(Delegation.Menu.getDelegMenuProperty(),popupBody.find("#forwardPopUpDropDown"),{id:"delegId",placeholder:ZPI18N.getString("zp.search")},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.selectapprover")}),CommonTemplates.Popup.showPopup(ZPI18N.getString("zp.bulkforwardpopupheader"),popupBody,ZPI18N.getString("zp.proceed")),$("#cnf_popup").find("#popup_confirm").off("click").on("click",function(event){$("#cnf_popup").find("#forwardPopUp .ERR").remove();var fwrdErecno=$("#cnf_popup").find("#forwardPopUp #forwardPopUpDropDown #delegId").attr("selectedIds");ZPUtil.Validation.isEmpty(fwrdErecno)?$("#cnf_popup").find("#forwardPopUp").append("<div class='ERR'>"+ZPI18N.getString("zp.selectapprover")+"</span>"):(ZPForm.CURRFORM_PARAM.forwardErecno=fwrdErecno,showApprovalPopUp?ZPReview.bulkForward(ZPForm.CURRFORM_PARAM.recordId,ZPForm.CURRFORM_PARAM.forwardErecno):(ZPForm.isSingleFiledEdit()&&!ZPForm.CURRFORM_PARAM.isSingleFieldModal?ZPForm.Field.Edit.callbackForSingleFieldEdit():(ZPForm.IS_SUBMITNEW=!1,ZPForm.Record.validateAndSubmit()),ZPForm.CURRFORM_PARAM.forwardErecno=void 0,CommonTemplates.Popup.closePopup()))})},bulkForwardMyApprovalsFormPopUp:function(){if(ZPApprovals.APPROVE_RECIDS.length>200)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.apprfrwdmaxrecordidlenerr"));else{message=ZPI18N.getString("zp.bfwrdmyapprpopmsg"),$("#cnf_popup").find("#bulkforwardwrng").addClass("DN");var popupBody=$(ZPReview.getBulkForwardMyApprovalsPopUpHTML(message));CommonTemplates.getSelectMenu(ZPReview.getForwardMenuProperty(),popupBody.find("#forwardPopUpDropDown"),{id:"delegId",placeholder:ZPI18N.getString("zp.search")},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.selectapprover")}),CommonTemplates.Popup.showPopup(ZPI18N.getString("zp.bfwrdmyapprpophead"),popupBody,ZPI18N.getString("zp.proceed")),$("#cnf_popup").find("#popup_confirm").off("click").on("click",function(event){var fwrdErecno=$("#cnf_popup").find("#forwardPopUp #forwardPopUpDropDown #delegId").attr("selectedIds"),fwrdComment=$("#cnf_popup").find("#bulkforwardComment #approver_comment").val();ZPUtil.Validation.isEmpty(fwrdErecno)?$("#cnf_popup").find("#frwduserselecterr").removeClass("DN"):ZPUtil.Validation.isEmpty(fwrdComment)?($("#cnf_popup").find("#frwdcommenterr").empty(),$("<p>"+ZPI18N.getString("zp.commentsrequirederrormsg")+"</p>").appendTo($("#cnf_popup").find("#frwdcommenterr")),$("#cnf_popup").find("#frwduserselecterr").addClass("DN"),$("#cnf_popup").find("#frwdcommenterr").removeClass("DN")):fwrdComment.length>250?($("#cnf_popup").find("#frwdcommenterr").empty(),$("<p>"+ZPI18N.getString("zp.commentlenerr")+"</p>").appendTo($("#cnf_popup").find("#frwdcommenterr")),$("#cnf_popup").find("#frwduserselecterr").addClass("DN"),$("#cnf_popup").find("#frwdcommenterr").removeClass("DN")):($("#cnf_popup").find("#frwduserselecterr").addClass("DN"),$("#cnf_popup").find("#frwdcommenterr").addClass("DN"),Layout.Page.container.find("#forwardingDiv .btn").attr("disabled",!0),ZPReview.isShowWarningForwardMyApproval()?($("#cnf_popup").addClass("DN"),ZPeople.confirm(this,"","zp.bfwrdmyapprconfirm",ZPReview.bulkForwardMyApprovals,"","","","","",ZPReview.cancelForwardConfirmCallback)):ZPReview.bulkForwardMyApprovals())})}}};var Announcement={};(Announcement={isInit:!1,REQUEST_URL:"/announcementAction.zp",START_INDEX:1,TABDISPNAMESMALL:ZPI18N.getString("zp.announcement").toLowerCase(),TABDISPNAME:ZPI18N.getString("zp.announcement"),ANN_LAST_SEARCHKEY:void 0,ANNOUNCMENT_LIST:{LIST:{},STICKY:{}},ISLIST_PAGE_INITIALISED:!1,HAS_NEXT:!1,LOCATIONS:{},CATEGORIES:{},EDITOR:void 0,editorList:{},IS_FILTER:!1,CURR_ANNOUNCEMENT:void 0,ISBACKTOLISTPAGE:!1,REMOVEDFILEIDS:[],URLCONTEXT:showNewTab?"home/organization/":"",getAnnouncementTabDisplayname:function(tabs){for(var ind=0;ind<tabs.length;ind++)if("announcements"===tabs[ind].tabName.toLowerCase())return"Announcements"!=tabs[ind].dispName&&(Announcement.TABDISPNAME=tabs[ind].dispName,Announcement.TABDISPNAMESMALL=tabs[ind].dispName.toLowerCase(),Announcement.TABSINDISPNAME=tabs[ind].dispName.toLowerCase()),!1},initAnnouncementPage:function(){Announcement.Layout=Layout.Page.container,ZPeople.isAnnouncementAllowed?(Announcement.createLayout(),Announcement.getLocationsAndCategories()):Announcement.Layout.html($(ZPUtil.noDataImg("zp_nd_permission",ZPI18N.getString("zp.permissiondenied"))).css("margin-top","20px"))},createLayout:()=>{if(!Announcement.isInit){Announcement.Layout.attr("scroll","enabled");let topBanner=$('<div class="zpl_btnmnu"><div class="zpl_rgt">'+(isAnnAdmin?'<button  class="addpost zlabel zlabel--blue zlabel--medium zbutton zbutton--medium zbutton--primary" data-popup-open="addcmonTemp" aria-haspopup="dialog">'+ZPI18N.getString("zp.addcomponents",[Announcement.TABDISPNAME])+"</button>":"")+'<i title="'+ZPI18N.getString("zp.search")+'" class="search zpl_ibg PI_lens" tabindex="0" role="button" aria-label="'+ZPI18N.getString("zp.search")+'" aria-haspopup="true"></i><i title="'+ZPI18N.getString("zp.filter")+'" class="filter zpl_ibg PI_fltr" tabindex="0" role="button" aria-haspopup="dialog" aria-label="'+ZPI18N.getString("zp.filter")+'"></i></div></div>'),listContainer=$('<div id="zp_announcement_list_div" class="zpl_rgtcnt"><div id="zp_announcement_list" class="zpl_anounce zpl_crdlst" role="list" aria-label="'+ZPI18N.getString("zp.proceedingtolistwcag",[ZPI18N.getString("zp.announcements")])+'"></div></div>'),searchBar=$('<div id="zpann_search" class="search-cmn"><i class="PI_lens"></i><input placeholder="'+ZPI18N.getString("zp.search")+" "+ZPeople.decodeTxt(Announcement.TABDISPNAME)+'" class="ztextbox"  id="zpann_search_box" ><i class="closesearch PI_cls"></i></div>'),filetr=$('<div id="zpann_filter" class="zpl_fltr"><div><div class="zpl_fltrhd"><h5>'+ZPI18N.getString("zp.filter")+'</h5><i class="close PI_cls"></i></div></div><div class="zpl_fltrcnt"><div><div class="zpl_fltclps fltopn"><div class="zpl_fltrlst"></div></div></div></div><div><button class="zlabel zlabel--blue zlabel--medium zbutton zbutton--medium zbutton--primary" id="userrefinesubmit" type="button" onclick="Announcement.filterAnnouncement(event)">'+ZPI18N.getString("zp.apply")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" id="userrefinereset" onclick="Announcement.resetFilter(event);">'+ZPI18N.getString("zp.reset")+"</button></div></div>");topBanner.find("i.search").on("click",function(){searchBar.addClass("opn"),searchBar.find("#zpann_search_box").focus()});let closeFunction=function(){searchBar.removeClass("opn"),Announcement.isRefreshNeed&&(Announcement.isRefreshNeed=!1,Announcement.getBackToListPage(),searchBar.find("#zpann_search_box").val(""))};searchBar.on("keyup",e=>{27==e.which&&closeFunction()}),searchBar.find(".closesearch").on("click",closeFunction),filetr.find(".close").on("click",function(){Announcement.Layout.removeClass("zpl_fltr_flt")}),topBanner.append(searchBar),topBanner.find("button.addpost").on("click",Announcement.getAddPageUrl),topBanner.find("i.filter").on("click",Announcement.Construction.constructFilter),Announcement.Layout.append(topBanner),Announcement.Layout.append(listContainer),Announcement.Layout.append(filetr),Announcement.isInit=!0}},getLocationsAndCategories:function(){isLocInit=0!==Object.keys(Announcement.LOCATIONS).length,isCatInit=0!==Object.keys(Announcement.CATEGORIES).length,isLocInit||isCatInit?isLocInit?isCatInit||Announcement.Categories.getCategories():Announcement.initLocation():$.ajax({type:"POST",async:!1,url:Announcement.REQUEST_URL,data:{mode:"GET_LOCATIONS_CATEGORIES",conreqcsr:csrfToken},success:function(data){void 0!==data.p_location&&$.each(data.p_location,function(key,value){Announcement.LOCATIONS[this.locationid]=this.locationname}),void 0!==data.categories&&$.each(data.categories,function(key,value){Announcement.CATEGORIES[this.category_id]=this.category_name}),void 0!==data.isEnabledNotify&&(Announcement.isEnabledNotify=data.isEnabledNotify)}})},initLocation:function(){if(0===Object.keys(Announcement.LOCATIONS).length){var locationListInit=void 0;void 0===ZPeople.Module.getData()||void 0===ZPeople.Module.getData().location_list_key?(void 0===locationListInit||locationListInit.length<=0)&&$.ajax({type:"POST",async:!1,url:"/commonAction.zp",data:{mode:"GET_ALL_LOCATIONS",conreqcsr:csrfToken},success:function(data){Announcement.handleLocationResponse(data)}}):(locationListInit=ZPeople.Module.getData(),Announcement.handleLocationResponse(locationListInit))}},addAnnouncement:function(){var message=Announcement.EDITOR.getContent();if(ZPFeeds.hasInValidContent(message))ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.unsupportedemojialert"));else{var error,addBtn=Layout.Page.container.find("#zpann_addbtn"),settObj=Layout.Page.container.find("#zpann_settings");addBtn.attr("disabled",!0),addBtn.append(ZPFeeds.MINILOADER);var subObj=Layout.Page.container.find("#zp_ann_subjectbox"),annoSubj=subObj.val();if(""===(annoSubj=annoSubj.trim())?error=ZPI18N.getString("zp.subjectemptymsg"):annoSubj.length>100&&(error=ZPI18N.getString("zp.subjectlenghtmsg")),error)return ZPeople.Message.showWarningMsg(error),addBtn.find("#loader").remove(),addBtn.attr("disabled",!1),void subObj.trigger("focus");message=ZPFeeds.getSmileysAndMentions(message,"true"),message=ZPFeeds.removeTrailingEmptyDivs(message),message=ZPFeeds.getAndChangeVideoTag(message);var messageText=ZPFeeds.getTextContent(message);if(0===messageText.length&&0===$("<div>").append(message).find("img").length&&0===$("<div>").append(message).find("inlinevideo").length?error=ZPI18N.getString("zp.emptymessage"):messageText.length>5e4&&(error=ZPI18N.getString("zp.lengthofmessage")),error)return ZPeople.Message.showWarningMsg(error),addBtn.find("#loader").remove(),void addBtn.attr("disabled",!1);var expiryDate=Layout.Page.container.find("#zpann_expiredate").val();if((expiryDate=expiryDate.trim()).length<=0)expiryDate=-1;else if(!Announcement.Util.validateDate(expiryDate))return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.expirydateerrmsg",[ZPI18N.getString("zp.expiry")])),addBtn.find("#loader").remove(),addBtn.attr("disabled",!1),void settObj.addClass("in");var annoLocation=Layout.Page.container.find("#zpann_location").val();if(null==annoLocation||0==annoLocation.length){if(annoLocation=void 0,!isAnnAdmin&&isOperationalRoleAdmin)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.selectLocationsTotag")),addBtn.find("#loader").remove(),addBtn.attr("disabled",!1),void settObj.addClass("in")}else annoLocation=JSON.stringify(annoLocation);var annoIsSticky=Layout.Page.container.find("#zp_is_sticky").is(":checked"),annoNotifyAll=Layout.Page.container.find("#zpann_notifyall").is(":checked"),annoNotifyLocEmp=Layout.Page.container.find("#zpann_notifylocemp").is(":checked"),isCommentDisable=Layout.Page.container.find("#zpann_cmtDisable").is(":checked"),emailList=Layout.Page.container.find("#zpann_notifyemaillist").val(),formatEmailAddress="";if(!ZPUtil.Validation.isEmpty(emailList))if(emailList=emailList.replace(/(^,)|(,$)/g,""),isValid=!0,(emailList=emailList.split(",")).length>0&&emailList.length<=50){for(var i=0;i<emailList.length;i++){if(!isValid)return isValid=!1,!1;emailList[i]=emailList[i].trim(),""!=emailList[i]&&(isValid=ZPUtil.Validation.isEmail(emailList[i].trim(),!0))}if(!isValid)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.validemail")),addBtn.find("#loader").remove(),addBtn.attr("disabled",!1),void settObj.addClass("in");for(var cnt=0;cnt<emailList.length;cnt++)formatEmailAddress+=emailList[cnt],emailList.length!==cnt&&(formatEmailAddress+=",");formatEmailAddress=formatEmailAddress.trim()}else if(emailList.length>50)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.emaillengthwar")),addBtn.find("#loader").remove(),addBtn.attr("disabled",!1),void settObj.addClass("in");var existFiles=void 0,attachedFile=Layout.Page.container.find(".filePrev");if(0!==attachedFile.length){existFiles=[];for(i=0;i<attachedFile.length;i++)"true"===$(attachedFile[i]).attr("existFile")&&existFiles.push($(attachedFile[i]).attr("fileId"))}existFiles=JSON.stringify(existFiles);var categories=Layout.Page.container.find("#zpann_categories").val();if(categories=null!=categories&&0!=categories.length?JSON.stringify(categories):void 0,void 0===error){var cont=Layout.Page.container.find("#ann_Editor");if(!UDS_UPLOAD_IS_ACTIVE&&parseInt(cont.find("#zp_dash_attachments").attr("attachcnt"))>0){var attachFile;void 0===Layout.Page.childUrlParam.annId?($("body").append($('<form enctype="multipart/form-data" action="announcementAction.zp?mode=ADD_ANNOUNCEMENT" id="zp_AttachFile" method="post" target="feedsuploadwindow" style="display: none;"><input type="hidden" name="conreqcsr" id="csrfno" value="'+csrfToken+'"/></form><iframe id="feedsuploadwindow" name="feedsuploadwindow" style="display:none;" ></iframe>')),attachFile=$("#zp_AttachFile")):($("body").append($('<form enctype="multipart/form-data" action="announcementAction.zp?mode=UPDATE_ANNOUNCEMENT" id="zp_AttachFile" method="post" target="feedsuploadwindow" style="display: none;"><input type="hidden" name="conreqcsr" id="csrfno" value="'+csrfToken+'"/></form><iframe id="feedsuploadwindow" name="feedsuploadwindow" style="display:none;" ></iframe>')),(attachFile=$("#zp_AttachFile")).append('<input type="hidden" name="id" value="'+Layout.Page.childUrlParam.annId+'"/>'),void 0!==existFiles&&(attachFile.append('<input type="hidden" name="existFiles"/>'),attachFile.find("[name='existFiles']").val(existFiles))),attachFile.append('<input type="hidden" name="subject" value=""/>'),$(attachFile.find("[name='subject']")[0]).val(annoSubj),attachFile.append('<input type="hidden" name="message" value=""/>'),$(attachFile.find("[name='message']")[0]).val(message),attachFile.append('<input type="hidden" name="messageText" value=""/>'),$(attachFile.find("[name='messageText']")[0]).val(messageText),void 0!==expiryDate&&attachFile.append('<input type="hidden" name="expiryDate" value="'+expiryDate+'"/>'),ZPUtil.Validation.isEmpty(annoLocation)||(attachFile.append('<input type="hidden" name="location"/>'),attachFile.find("[name='location']").val(annoLocation)),attachFile.append('<input type="hidden" name="isSticky" value="'+annoIsSticky+'"/>'),attachFile.append('<input type="hidden" name="notify" value="'+!(!annoNotifyAll&&!annoNotifyLocEmp)+'"/>'),attachFile.append('<input type="hidden" name="isCommentDisable" value="'+isCommentDisable+'"/>'),ZPUtil.Validation.isEmpty(categories)||(attachFile.append('<input type="hidden" name="categories"/>'),attachFile.find("[name='categories']").val(categories)),ZPUtil.Validation.isEmpty(formatEmailAddress)||attachFile.append('<input type="hidden" name="emailList" value="'+formatEmailAddress+'"/>'),attachFile.append(cont.find("#zp_dash_attachments").find("[type = 'file']")),attachFile.trigger("submit")}else{var params={subject:annoSubj,message:message,messageText:messageText,expiryDate:expiryDate,location:annoLocation,isSticky:annoIsSticky,notify:!(!annoNotifyAll&&!annoNotifyLocEmp),emailList:formatEmailAddress,isCommentDisable:isCommentDisable,categories:categories};if(parseInt(cont.find("#zp_dash_attachments").attr("attachcnt"))>0){var attachIds=[],fileObj=cont.find("#zp_dash_attachments").find("[type = 'file']");if(void 0!==fileObj&&fileObj.length>0)for(i=0;i<fileObj.length;i++){let attId=$(fileObj[i]).attr("udsfileId");null!=attId&&"null"!=attId&&attachIds.push(attId)}attachIds.length>0&&(params.attachIds=JSON.stringify(attachIds))}void 0===Layout.Page.childUrlParam.annId?(params.mode="ADD_ANNOUNCEMENT",ZPeople.Request.send(Announcement.REQUEST_URL,params,Announcement.addAnnouncementResponse)):(params.mode="UPDATE_ANNOUNCEMENT",params.id=Layout.Page.childUrlParam.annId,void 0!==existFiles&&(params.existFiles=existFiles),ZPeople.Request.send(Announcement.REQUEST_URL,params,Announcement.updateAnnouncementResponse))}}}},addAnnouncementResponse:function(data){"string"==typeof data&&(data=JSON.parse(data));var addObj=Layout.Page.container.find("#zpann_addbtn");if(addObj.attr("disabled",!1),addObj.find("#loader").remove(),200===data.code){if(window.onbeforeunload=null,Announcement.Construction.destroySelectZC(),$("#zp_annEditor_outercont").remove(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.announcementaddedsuccess",[Announcement.TABDISPNAME])),"home_feeds_announcements"===Layout.Page.urlmode)ZPFeeds.get(ZPeople.VIEWKEYS.Announcement),ZPeople.FireScroll.reset();else if("home/organization/dashboard"===Layout.Page.currentmode){var params={widget:"ANNOUNCEMENTS"};ZPeople.Request.send(ZPDashboard.Widget.URL+"getWidget",params,function(data){ZPDashboard.Widget.create(data[params.widget],params.widget)})}}else void 0!==data.error?ZPeople.Message.showFailureMsg(data.error):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.announcementaddedfailure",[Announcement.TABDISPNAME])),Layout.Page.container.find("#zpann_settings").addClass("in");Layout.Page.container.find("#ann_Editor").find("#zpann_addbtn").attr("disabled",!1).find("#loader").remove(),$("form#zp_AttachFile,iframe#feedsuploadwindow").remove(),200===data.code&&(Announcement.mergeAnnouncementLikeCommentData(data,{},{},void 0,{}),Announcement.appendAddorEditAnnouncement(data.announcementId),setTimeout(function(){Announcement.getBackPage(Layout.Page.hash)},200)),Layout.Page.container.find("#zp_dash_attachments").attr("attachcnt","0").addClass("DN").children("div,input").remove()},updateAnnouncementResponse:function(data,params){"string"==typeof data&&(data=JSON.parse(data));var addObj=Layout.Page.container.find("#zpann_addbtn");if(addObj.attr("disabled",!1),addObj.find("#loader").remove(),200===data.code){if(Announcement.Construction.destroySelectZC(),Layout.Page.container.find("#zp_annEditor_outercont").remove(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.announcementmodifiedsuccess",[Announcement.TABDISPNAME])),"feed"===Layout.Page.childUrlParam.page)return ZPFeeds.get(ZPeople.VIEWKEYS.Announcement),ZPeople.FireScroll.reset(),void(window.location.href="#home/feeds/announcements")}else void 0!==data.error?ZPeople.Message.showFailureMsg(data.error):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.announcementmodifiedfailure",[Announcement.TABDISPNAME])),Layout.Page.container.find("#zpann_settings").addClass("in");$("form#zp_AttachFile,iframe#feedsuploadwindow").remove(),200===data.code&&"feed"!==Layout.Page.childUrlParam.page&&(Announcement.checkListPageAlreadyLoaded()&&(Announcement.changeUpdatedAnnouncement(data),Announcement.appendAddorEditAnnouncement(data.announcementId)),setTimeout(function(){Announcement.getBackPage(Layout.Page.hash)},200)),Layout.Page.container.find("#zp_dash_attachments").attr("attachcnt","0").addClass("DN").children("div,input").remove()},enableDisableAnnouncement:async function(){var annoId=Layout.Page.childUrlParam.annId;if(void 0!==annoId){var data=await Announcement.getDataFromGlobalVariable(annoId);ZPeople.Request.send(Announcement.REQUEST_URL,{mode:"ENABLE_DISABLE_ANNOUNCEMENT",id:annoId},Announcement.afterEnableDisableAction,{data:data})}},afterEnableDisableAction:function(resultData,params,otherDetails){if(200===resultData.code){var data=otherDetails.data,annObj=$("#zp_announcement_list_div").find("div#zp_announcement_list").find("#zp_ann_row_"+params.id),modalObj=Layout.Page.container.find("#MediumView");if(0===resultData.status){Layout.Page.container.find("#enableDisableDiv").html('<span class="CR-ed-hide"></span>'+ZPI18N.getString("zp.disablepost")),data.isActive=!0,annObj.removeClass("disabled pauto"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.announcementenablesuccessful",[Announcement.TABDISPNAME]));var commentListObj=Layout.Page.container.find("#anno_detail").find("#comment_container").find("#comment_list");Announcement.Construction.constructCommentTextarea(commentListObj,Layout.Page.container),modalObj.find("#zp_ann_comments #bottomcont").append(isadmin||isAnnAdmin&&erecno===data.owner||isOperationalRoleAdmin&&Announcement.isLocationInAdminProfile(data.location,ZPeople.CURR_USER.locId)||void 0!==data.isCommentDisable&&1!==data.isCommentDisable?ZPFeeds.Construction.constructTextArea(!0,data):"").removeClass("zpl_fl wd100_per"),ZPFeeds.Like.registerLikeOptions(modalObj.find("#liketypecldiv"),data.announcementId,"Announcement",!0,!0)}else{Layout.Page.container.find("#enableDisableDiv").html('<span class="CR-ed-visible"></span>'+ZPI18N.getString("zp.enablepost")),data.isActive=!1,annObj.addClass("disabled pauto"),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.announcementdisablesuccessful",[Announcement.TABDISPNAME])),modalObj.find("#zp_ann_comments").find("#cmtpostcont").remove(),modalObj.find("#zp_ann_comments #bottomcont").addClass("zpl_fl wd100_per"),ZPFeeds.Like.unregisterLikeOptions(modalObj.find("#liketypecldiv"));for(var cmtCont=modalObj.find(".zp-cmt-uaction").find("[id='zpcmt_like_link']"),cnt=0;cnt<cmtCont.length;cnt++){var tempCont=$(cmtCont[0]);ZPFeeds.Like.unregisterLikeOptions(tempCont)}}}else void 0!==resultData.error?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.adminerrormsg")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.announcementmodifiedfailure",[Announcement.TABDISPNAME]))},DELETE_ANN_ID:void 0,deleteRecConfirm:function(){Announcement.DELETE_ANN_ID=Layout.Page.childUrlParam.annId;var alertDelete=new DeleteAlertMessage(ZPI18N.getString("zp.zpalert"),ZPI18N.getString("zp.deleteconfirmmessage"));alertDelete.yesButtonText=ZPI18N.getString("zp.confirm"),alertDelete.setCallback(Announcement.deleteAnnouncement),alertDelete.show()},hideBackDrop:function(){$($(".Ann_backdrop")[0]).remove()},deleteAnnouncement:function(){ZPeople.Request.send(Announcement.REQUEST_URL,{mode:"DELETE_ANNOUNCEMENT",id:Announcement.DELETE_ANN_ID},Announcement.afterDeleteAction)},afterDeleteAction:function(resultData,params){200===resultData.code?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.announcementdeletedsuccess",[Announcement.TABDISPNAME])),Layout.Page.container.find("#MediumView").removeClass("in"),Announcement.getBackPage(),Layout.Page.container.find("#zp_announcement_list_div").find("div#zp_announcement_list").find("#zp_ann_row_"+params.id).fadeOut(500,function(){$(this).remove();let listdiv=$("#zp_announcement_list_div").find("div#zp_announcement_list");0===listdiv.children().length&&(listdiv.addClass("DNI"),$("#zp_announcement_list_div").append(ZPUtil.noDataImg("zp_nd_faq",ZPI18N.getString("zp.noannouncements",[Announcement.TABDISPNAME]))))}),Announcement.Util.toggleViewAnnouncementDiv(),delete Announcement.ANNOUNCMENT_LIST.LIST[params.id]):void 0!==resultData.ACCESS_DENIED||void 0!==resultData.NOT_ADMIN?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.adminerrormsg")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.announcementdeletedfailure",[Announcement.TABDISPNAME]))},viewAnnouncementById:function(annoId){window.location.href="#"+Announcement.URLCONTEXT+"announcements/list/view-annId:"+annoId+"/page:feed"},getAnnouncementById:function(annoId,isDataReq){return new Promise((resolve,reject)=>{$.ajax({type:"POST",async:!0,url:Announcement.REQUEST_URL,data:{id:annoId,mode:"GET_ANNOUNCEMENTBY_ID",conreqcsr:csrfToken},success:function(data){Announcement.handleAnnouncementByIdResponse(data,{annoId:annoId},{isDataReq:isDataReq}),resolve()}})})},handleAnnouncementByIdResponse:function(data,params,otherDetails){var announcementList=data.announcementList;if(void 0!==announcementList&&announcementList.length>0){var likeDetail,commentsCnt=data.commentsCnt,likeCnt=data.annLikeCnt;void 0!==likeCnt&&(likeDetail=likeCnt,likeCnt=likeCnt.statusIds);var commentList=data.commentList;Announcement.cmtHasNext=data.hasNext;data=Announcement.mergeAnnouncementLikeCommentData(announcementList[0],commentsCnt,likeCnt,commentList,void 0,likeDetail,!0,data.isValid,data.hasNext);if(!0!==(!(void 0===otherDetails||!otherDetails.isDataReq)&&otherDetails.isDataReq)&&-1!==Layout.Page.hash.indexOf(Announcement.URLCONTEXT+"announcements/list/view")){var modalObj=Layout.Page.container.find("#MediumView");void 0!==data?Announcement.commonDetailedViewConstruction(data,modalObj):(Layout.Page.container.find("#back-btn")[0].onclick=function(){Announcement.getBackPage()},ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.announcementloadfailure",[Announcement.TABDISPNAME]))),$(".cboxElement").off("click"),$(".cboxElement").on("click",function(event){$(event.target).hasClass("filedwn")||ZPFeeds.registerAttPreview(event,this,Announcement.CURR_ANNOUNCEMENT)}),0===$("#zp_announcement_list").children().length&&(!Layout.Page.container.find(".PI_alft").hasClass("DNI")&&$(".PI_alft").addClass("DNI"),!Layout.Page.container.find(".PI_argt").hasClass("DNI")&&$(".PI_argt").addClass("DNI"),Layout.Page.container.find(".CR-miniview").addClass("DNI"),modalObj.hasClass("fullView")||modalObj.addClass("fullView")),Layout.Page.container.find("#animate_cont").find(".Hdr_Lft").removeClass("DN"),Layout.Page.container.find("#animate_cont").find(".Hdr_Rgt").removeClass("DN"),$(".zp_mdl-bdy").removeClass("DN"),Layout.Page.container.find("#animate_cont").find("#loading_animate").remove()}}else-1!==Layout.Page.hash.indexOf(Announcement.URLCONTEXT+"announcements/list/view")&&(data.error?ZPeople.Message.showFailureMsg(data.error):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.announcementloadfailure",[Announcement.TABDISPNAME])))},initAnnouncementListPage:function(isMore,isSearch){if(!0!==isMore){var parentObj=Layout.Page.container.find("#zp_announcement_list_div");parentObj.find("#nodataImg").remove(),0===Layout.Page.container.find("#zp_page_loading").length&&Layout.Page.container.append(ZPeople.LOADING_HTML),parentObj.find("div#zp_announcement_list").addClass("DNI"),Announcement.START_INDEX=1}else!0===isMore&&0===Layout.Page.container.find("div#zp_announcement_list").find("#zp_page_loading").length&&Layout.Page.container.find("div#zp_announcement_list").append(ZPeople.LOADING_HTML);var otherDetails={isSearch:isSearch,isMoreAnn:isMore},params={mode:"GETALL_ANNOUNCEMENTS",search:!0===isSearch?Announcement.ANN_LAST_SEARCHKEY:void 0,isSticky:!1,startIdx:Announcement.START_INDEX};ZPeople.Request.send(Announcement.REQUEST_URL,params,Announcement.constructAnnouncementListView,otherDetails,Announcement.failureCallBack)},failureCallBack:function(data,param,otherdtl){!0!==otherdtl.isMoreAnn?(Layout.Page.container.find("#zp_page_loading").length>0&&Layout.Page.container.find("#zp_page_loading").remove(),Layout.Page.container.find("#zp_announcement_list_div").find("#zp_announcement_list").removeClass("DNI")):!0===otherdtl.isMoreAnn&&0===Layout.Page.container.find("#zp_announcement_list_div").find("#zp_page_loading").length&&Layout.Page.container.find("#zp_announcement_list_div").find("#zp_page_loading").remove()},initFilterAnnouncement:function(isMore,isFromFilter,isSticky){0===Layout.Page.container.find("#zp_page_loading").length&&Layout.Page.container.append(ZPeople.LOADING_HTML);var otherDetails={};!0!==isMore?(Layout.Page.container.find("#zp_announcement_list_div").find("div#zp_announcement_list").html(""),Announcement.START_INDEX=1):otherDetails.isMoreAnn=isMore,!0===isFromFilter&&(otherDetails.isFilter=isFromFilter,isAnnAdmin&&Layout.Page.container.find("#zpann_add_button").removeClass("DN"));isSticky=Layout.Page.container.find("#filter_is_sticky").is(":checked");var location=Layout.Page.container.find("#zpann_filter").find("#loc").val();location=null!=location?JSON.stringify(location):void 0;var category=Layout.Page.container.find("#zpann_filter").find("#categories").val(),params={mode:"FILTER_ANNOUNCEMENT",location:location,categories:category=null!=category?JSON.stringify(category):void 0,enable:Layout.Page.container.find("#zpann_filter").find("#isenable").val(),startIdx:Announcement.START_INDEX,isSticky:isSticky,conreqcsr:csrfToken};ZPeople.Request.send(Announcement.REQUEST_URL,params,Announcement.constructAnnouncementListView,otherDetails)},filterAnnouncement:function(){var location=Layout.Page.container.find("#zpann_filter").find("#loc").val();location=null!=location?JSON.stringify(location):void 0,Announcement.START_INDEX=1;var category=Layout.Page.container.find("#zpann_filter").find("#categories").val();category=null!=category?JSON.stringify(category):void 0;var annoEnable=Layout.Page.container.find("#zpann_filter").find("#isenable").val(),isSticky=Layout.Page.container.find("#filter_is_sticky").is(":checked"),params={mode:"FILTER_ANNOUNCEMENT",location:location,categories:category,enable:annoEnable,startIdx:Announcement.START_INDEX,isSticky:isSticky,conreqcsr:csrfToken};ZPeople.Request.send(Announcement.REQUEST_URL,params,function(data){Announcement.IS_FILTER=!0;var otherDetails={isFilter:!0,isMoreAnn:!1};Layout.Page.container.find("#zp_announcement_list_div").find("div#zp_announcement_list").html(""),Announcement.constructAnnouncementListView(data,params,otherDetails)})},COMMENTEDITOR:null,addComment:function(container,Obj,c,btnObj){var annoId=Announcement.CURR_ANNOUNCEMENT;if(ZPFeeds.hasInValidContent(c.messgeTxt))ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.unsupportedemojialert"));else{if(Announcement.cmtEditor=container,0===btnObj.find("#loader").length&&btnObj.append(ZPFeeds.MINILOADER),btnObj.attr("disabled",!0),(0===c.messgeTxt.length&&0===$("<div>").append(c.content).find("img").length||c.messgeTxt.length>5e3)&&void 0==c.attachments)return c.messgeTxt.length>5e3&&ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.commentlengthwarning")),ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.COMMENTEDITOR,!1),void btnObj.attr("disabled",!1).find("#loader").remove();if(void 0!=c.attachments)$("body").append($('<form enctype="multipart/form-data" action="/announcementAction.zp?mode=ADD_ANNOUNCEMENT_COMMENT" id="zp_AttachFile" method="post" target="feedsuploadwindow" style="display: none;"><input type="hidden" name="conreqcsr" id="csrfno" value="'+csrfToken+'"/></form><iframe id="feedsuploadwindow" name="feedsuploadwindow" style="display:none;" ></iframe>')),$("#zp_AttachFile").append('<input type="hidden" name="id" value="'+annoId+'"/>'),$("#zp_AttachFile").append('<input type="hidden" name="comment" value="'+c.messgeTxt+'"/>'),$("#zp_AttachFile").append('<input type="hidden" name="html_content" value="'+c.content+'"/>'),$("#zp_AttachFile").append(c.attachments),$("#zp_AttachFile").trigger("submit");else{var otherDetails={actJson:Obj,editor:container};ZPeople.Request.send(Announcement.REQUEST_URL,{mode:"ADD_ANNOUNCEMENT_COMMENT",id:annoId,comment:c.messgeTxt,html_content:c.content},Announcement.handleAddCommentResponse,otherDetails)}}},handleAddCommentResponse:function(data,params,otherDetails){var annoId=Announcement.CURR_ANNOUNCEMENT;if(void 0!=otherDetails&&void 0!==otherDetails.container&&otherDetails.container,void 0!==Announcement.cmtEditor&&($(Announcement.cmtEditor.outerdiv).parents("#editor_container").find("#postCommentBtn").find("#loader").remove(),$(Announcement.cmtEditor.outerdiv).parents("#editor_container").find("#postCommentBtn").prop("disabled",!1)),200===data.code){var commentCnt,actJson,container,editor;if(Announcement.COMMENT_START_INDEX=Announcement.COMMENT_START_INDEX+1,void 0!==Announcement.ANNOUNCMENT_LIST.LIST[annoId]&&(Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentCount+=1,void 0===Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentList&&(Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentList=[]),Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentList[data.commentList.commentId]=data.commentList,Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentList[data.commentList.commentId].type=People.Announcement.type,commentCnt=Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentCount),void 0!=data.commentList.cmtattList){actJson={actRecId:Announcement.CURR_ANNOUNCEMENT,cmtattList:data.commentList.cmtattList,type:"Announcement"},container=Layout.Page.container.find("[streamId='"+Announcement.CURR_ANNOUNCEMENT+"']"),editor=Announcement.cmtEditor,!0===(dataCom=data.commentList).isHTML?(dataCom.content=ZPFeeds.Activity.validateContent(dataCom.content,!1),dataCom.content=ZPFeeds.Activity.getImgAndCBoxClass(dataCom.content,actJson.actRecId)):(dataCom.content=ZSEC.Encoder.encodeForHTML(dataCom.content),dataCom.content=ZPFeeds.Activity.filterTemplate(dataCom.content)),editor.setContent(""),ZPFeeds.Comment.removeTextEditor(editor,actJson.actRecId),$("form#zp_AttachFile,iframe#feedsuploadwindow").remove();var currContObj=ZPFeeds.getCurrentViewContainer(Announcement.CURR_ANNOUNCEMENT);currContObj.find("#cmtpostcont").find("#zp_dash_attachments").attr("attachcnt","0").addClass("DN").children("div").remove(),currContObj.find("#cmtpostcont").find("#zp_dash_attachments").children("input").remove()}else{var dataCom;actJson=otherDetails.actJson,!0===(dataCom=data.commentList).isHTML?(dataCom.content=ZPFeeds.Activity.validateContent(dataCom.content,!1),dataCom.content=ZPFeeds.Activity.getImgAndCBoxClass(dataCom.content,actJson.actRecId)):(dataCom.content=ZSEC.Encoder.encodeForHTML(dataCom.content),dataCom.content=ZPFeeds.Activity.filterTemplate(dataCom.content)),container=$("[streamId='"+actJson.actRecId+"']"),otherDetails.editor.setContent(""),ZPFeeds.Comment.removeTextEditor(otherDetails.editor,actJson.actRecId)}actJson.type=People.Announcement.type,ZPFeeds.Construction.constructComments(container,actJson,[data.commentList],!1),Announcement.updateAnnouncementViews("comment",commentCnt,annoId)}else $("#postCommentBtn").attr("disabled",!1),ZPeople.Message.showFailureMsg(data.error);$(".cboxElement").off("click"),$(".cboxElement").on("click",function(event){$(event.target).hasClass("filedwn")||ZPFeeds.registerAttPreview(event,this,Announcement.CURR_ANNOUNCEMENT)})},doLikeAction:function(Obj,liketype){var data=Announcement.ANNOUNCMENT_LIST.LIST[Announcement.CURR_ANNOUNCEMENT],params={actionType:"LIKE_UNLIKE_ACTIVITY",type:"Announcement",actId:data.announcementId};-1!=$(Obj).attr("action")&&void 0===liketype&&(liketype=0),liketype>=0&&liketype<=5?(params.like_type=liketype,1==data.isCurUserLike?data.userLikeType=liketype:(data.isCurUserLike=!0,data.likeCount=data.likeCount+1),$(Obj).attr("action","-1")):(params.like_type=-1,data.isCurUserLike=!1,data.userLikeType=0,data.likeCount=data.likeCount-1,$(Obj).attr("action","0")),ZPeople.Request.send(ZPFeeds.URL,params),Announcement.LikeActionforCurrUser(Obj,data,liketype)},LikeActionforCurrUser:function(Obj,data,liketype){var tempLikeDtl,container=$("#MediumView").find(".reviewsection");void 0!==data.likeDetail&&void 0!==data.likeDetail.statusIds&&void 0!==data.likeDetail.statusIds[data.announcementId]&&(tempLikeDtl=data.likeDetail.statusIds[data.announcementId]);if(void 0===liketype){if(void 0!==tempLikeDtl){var likedusrArr=(likeObj=tempLikeDtl)[0].toString().split(","),userIds=ZPUtil.removeDuplicatesFromArray(likedusrArr);if(-1!==likedusrArr.indexOf(erecno))delete(typeArr=likeObj[3])[userIds.indexOf(erecno)],delete userIds[userIds.indexOf(erecno)],typeArr=ZPFeeds.Like.refreshArr(typeArr),userIds=ZPFeeds.Like.refreshArr(userIds),likeObj[0]=userIds,likeObj[1]=parseInt(likeObj[1])-1,likeObj[3]=typeArr,Announcement.ANNOUNCMENT_LIST.LIST[Announcement.CURR_ANNOUNCEMENT].likeDetail.statusIds[data.announcementId]=likeObj}else{var likeDetail={},statusIds={},commentIds={},usrArr=[];(likeObj=[])[0]=[],likeObj[1]=0;var typeArr=[];likeObj[3]=typeArr,statusIds[data.announcementId]=likeObj,likeDetail.statusIds=statusIds,likeDetail.success=!0,likeDetail.commentIds=commentIds,likeDetail.likedUserDtls={},Announcement.ANNOUNCMENT_LIST.LIST[Announcement.CURR_ANNOUNCEMENT].likeDetail=likeDetail,!0}data.isCurUserLike=!1}else if(void 0!==tempLikeDtl){likedusrArr=(likeObj=tempLikeDtl)[0],userIds=ZPUtil.removeDuplicatesFromArray(likedusrArr),typeArr=likeObj[3];typeArr=ZPFeeds.Like.refreshArr(typeArr),-1!==userIds.indexOf(erecno)?typeArr.splice(userIds.indexOf(erecno),1,liketype+""):(likedusrArr.push(erecno),userIds=likedusrArr,typeArr.push(liketype+""),likeObj[1]=parseInt(likeObj[1])+1),likeObj[0]=userIds,likeObj[3]=typeArr,Announcement.ANNOUNCMENT_LIST.LIST[Announcement.CURR_ANNOUNCEMENT].likeDetail.statusIds[data.announcementId]=likeObj}else{likeDetail={},statusIds={},commentIds={};var likedUserDtls={},likeObj=[];(usrArr=[]).push(erecno),likeObj[0]=usrArr,likeObj[1]=1,(typeArr=[]).push(liketype+""),likeObj[3]=typeArr,statusIds[data.announcementId]=likeObj,likeDetail.statusIds=statusIds,likeDetail.success=!0,likeDetail.commentIds=commentIds,likedUserDtls.empName=ZPeople.CURR_USER.name,likeDetail.likedUserDtls={erecno:likedUserDtls},Announcement.ANNOUNCMENT_LIST.LIST[Announcement.CURR_ANNOUNCEMENT].likeDetail=likeDetail,!0}var likeDtl=(data=Announcement.ANNOUNCMENT_LIST.LIST[Announcement.CURR_ANNOUNCEMENT]).likeDetail.statusIds[data.announcementId];let likeContainer=$("#MediumView #anlike_container"),announcementRow=$("#zp_ann_row_"+data.announcementId+" #zp_like_count");if(announcementRow.html('<span id="like_cnt">'+likeDtl[1]+"</span>"),-1!==likeDtl[0].indexOf(erecno)){announcementRow.append(ZPFeeds.Like.getLikeIconHTML(liketype));var likeTypeObj=ZPFeeds.Like.getLikeTypeClass(likeDtl[3],likeDtl[0].indexOf(erecno));let likeDiv=container.find("#liketypecldiv");likeDiv.removeAttr("class").addClass(likeTypeObj.textclname+" zp_emjReact"),likeDiv.find(".recn_emj").remove(),likeDiv.prepend(ZPFeeds.Like.getLikeIconHTML(liketype,ZPFeeds.Like.getLikeClassObj(liketype))),likeDiv.find(".reactText").html(likeTypeObj.text),0==likeContainer.find('[empid="'+erecno+'"]').length&&$('<a empid="'+erecno+'" popup="user" ltype="0" isusrzuid="false" class="likers">'+ZPI18N.getString("zp.you")+"</a>").insertAfter(likeContainer.find("#liketypes")),likeContainer.find("#liketypes").html(ZPFeeds.Like.getListOfLikeHtml(likeDtl[3],likeDtl[0].indexOf(erecno))),data.isCurUserLike&&container.find("#liketypecldiv").attr("action","-1")}else{announcementRow.append('<i class="PI_like NM"></i>');let likeDiv=container.find("#liketypecldiv");likeDiv.removeAttr("class").addClass("zp-post-like"),likeDiv.find(".reactText").html(ZPI18N.getString("zp.like")),likeDiv.find(".recn_emj").remove(),likeContainer.find("#liketypes").html(ZPFeeds.Like.getListOfLikeHtml(likeDtl[3],likeDtl[0].indexOf(erecno))),likeContainer.find('[empid="'+erecno+'"]').remove(),container.find("#liketypecldiv").attr("action","0")}0==likeContainer.find("#liketypes").children().length?likeContainer.addClass("zpl_DNI"):likeContainer.removeClass("zpl_DNI"),setTimeout(function(){Announcement.updateAnnouncementViews("like",void 0,Layout.Page.childUrlParam.annId)},100)},enableDisableComment:function(){var id=Layout.Page.childUrlParam.annId;void 0!==id&&ZPeople.Request.send(Announcement.REQUEST_URL,{id:id,mode:"ENABLE_DISABLE_COMMENT"},function(resultData,otherDetails){if(200===resultData.code&&void 0!=resultData.state){var data;void 0!==Announcement.ANNOUNCMENT_LIST.LIST[otherDetails.id]&&(Announcement.ANNOUNCMENT_LIST.LIST[otherDetails.id].isCommentDisable=resultData.state,data=Announcement.ANNOUNCMENT_LIST.LIST[otherDetails.id]);let slider=$("#MediumView");if(data&&1==data.isCommentDisable){let cmdinfoMessage=ZPI18N.getString("zp.commentsdisabledforemployee");data.isActive&&(isadmin||isAnnAdmin&&erecno===data.owner||isOperationalRoleAdmin&&Announcement.isLocationInAdminProfile(data.location,ZPeople.CURR_USER.locId))||(slider.find("#zp_ann_comments").find("#cmtpostcont").remove(),cmdinfoMessage=ZPI18N.getString("zp.commentsdisabled"),slider.find("#zp_ann_comments #bottomcont").addClass("zpl_fl wd100_per")),slider.find("#cmtDisableAlert").addClass("post-alrt").html('<div class="MT20 zalertbanner zalertbanner--error" data-position="top-left" ><i class="PI_commentD zalertbanner__icon whi"></i><span class="zalertbanner__text">'+cmdinfoMessage+"</span></div>")}else slider.find("#cmtDisableAlert").removeClass("post-alrt").html(""),slider.find("#zp_ann_comments #bottomcont").removeClass("zpl_fl wd100_per");let msg=ZPI18N.getString(1===resultData.state?"zp.postcommentdisabledforemployee":"zp.postcommentenabled",[Announcement.TABDISPNAME]);ZPeople.Message.showSuccessMsg(msg)}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.sorryservererror"))},{id:id})},pinUnpinAnnouncement:function(){var id=Layout.Page.childUrlParam.annId;void 0!==id&&ZPeople.Request.send(Announcement.REQUEST_URL,{id:id,mode:"PIN_UNPIN_ANNOUNCEMENT"},function(resultData,otherDetails){200===resultData.code&&void 0!=resultData.isSticky?(void 0!==Announcement.ANNOUNCMENT_LIST.LIST[otherDetails.id]&&(Announcement.ANNOUNCMENT_LIST.LIST[otherDetails.id].isSticky=resultData.isSticky,Announcement.ANNOUNCMENT_LIST.LIST[otherDetails.id]),$("#pinUnpinDiv").html('<span class="'+(resultData.isSticky?"CR-ed-unpin":"CR-ed-pin")+'"></span>'+ZPI18N.getString(resultData.isSticky?"zp.unpin":"zp.pin")),resultData.isSticky?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.annpinned")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.annunpinned")),Announcement.resetFilter()):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.sorryservererror"))},{id:id})},delComment:function(type,Obj){Announcement.DELETEOBJ=Obj;var alertDelete=new DeleteAlertMessage(ZPI18N.getString("zp.zpalert"),ZPI18N.getString("zp.deleteconfirmmessage"));alertDelete.yesButtonText=ZPI18N.getString("zp.confirm"),alertDelete.setCallback(Announcement.delCommentAction),alertDelete.show()},delCommentAction:function(){var recordId=Announcement.DELETEOBJ.parent().siblings("#record_id").val(),type=Announcement.DELETEOBJ.parent().siblings("#type").val();ZPeople.Request.send(ZPFeeds.URL,{actionType:"DELETE_COMMENT",commentId:recordId,activityType:type},Announcement.handleDelComment)},handleDelComment:function(resultData,otherDetails){if(-1!==resultData.indexOf("success")){var commentCnt;ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.commentdeletedsuccess"));var commentId=otherDetails.commentId,annoId=Announcement.CURR_ANNOUNCEMENT;void 0!==Announcement.ANNOUNCMENT_LIST.LIST[annoId]&&Object.keys(Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentList).length>0&&(delete Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentList[commentId],commentCnt=Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentCount-=1),Announcement.COMMENT_START_INDEX=Announcement.COMMENT_START_INDEX-1,Announcement.DELETEOBJ.parents(".zp-cmtdiv").fadeOut(1e3,function(){var pCont=$(Announcement.DELETEOBJ).parents("#cmtlistcont");$(this).remove(),0==pCont.children().length&&pCont.addClass("DN"),Announcement.DELETEOBJ=null}),Announcement.updateAnnouncementViews("comment",commentCnt,annoId)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},refreshListViewAnnouncement:function(annoId){void 0!==annoId&&Announcement.updateAnnouncementViews("like",void 0,annoId)},updateAnnouncementViews:async function(type,count,annoId){switch(type){case"like":var tempLikeDtl;if(void 0!==(annObj=await Announcement.getDataFromGlobalVariable(annoId)).likeDetail&&void 0!==annObj.likeDetail.statusIds&&void 0!==annObj.likeDetail.statusIds[annoId]&&void 0!==(tempLikeDtl=annObj.likeDetail.statusIds[annoId])){var likedusrArr=tempLikeDtl[0].toString().split(","),annObj=(ZPUtil.removeDuplicatesFromArray(likedusrArr),$("#zp_announcement_list_div").find("div#zp_announcement_list").find("#zp_ann_row_"+annoId).find("#zp_like_count"));if(-1!==likedusrArr.indexOf(erecno)){var typeArr=tempLikeDtl[3];void 0!==typeArr&&"string"==typeof typeArr&&(typeArr=JSON.parse(typeArr));var likeType=typeArr[likedusrArr.indexOf(erecno)];ZPFeeds.Like.getLikeClassObj(likeType),annObj.find("#like_cnt").text(tempLikeDtl[1]),void 0!==likeType?(annObj.find("i").remove(),annObj.append(ZPFeeds.Like.getLikeIconHTML(likeType))):(annObj.find("i").remove(),annObj.append('<i class="IC-like NM"></i>'))}else annObj.find("#like_cnt").text(tempLikeDtl[1]),annObj.find("i").remove(),annObj.append('<i class="IC-like NM"></i>')}break;case"comment":(annObj=$("#zp_announcement_list_div").find("div#zp_announcement_list").find("#zp_ann_row_"+annoId).find("#zp_comment_count")).find("#zp_cmt_count").text(count),count>5?Layout.Page.container.find("#view_more_cmts").removeClass("DN"):Layout.Page.container.find("#view_more_cmts").addClass("DN"),Object.keys(Announcement.ANNOUNCMENT_LIST.LIST[Announcement.CURR_ANNOUNCEMENT].commentList).length===Announcement.ANNOUNCMENT_LIST.LIST[Announcement.CURR_ANNOUNCEMENT].commentCount&&Layout.Page.container.find("#view_more_cmts").html(ZPI18N.getString("zp.viewingallcomments",[Announcement.ANNOUNCMENT_LIST.LIST[annoId].commentCount]))}},getCommentsById:function(annoId,data,startIdx,is_More){var params={mode:"GET_ANNOUNCEMENT_COMMENTS",id:annoId,startIdx:startIdx};ZPeople.Request.send(Announcement.REQUEST_URL,params,Announcement.handlegetCommentsByIdResponse,{is_More:is_More})},handlegetCommentsByIdResponse:async function(resultData,params,otherDetails){Layout.Page.container.find("#loader").remove(),Layout.Page.container.find("#zp_page_loading").remove(),!0!==resultData.hasNext&&!0!==resultData.commenthasNext||(Announcement.COMMENT_START_INDEX+=30);var commentList=resultData.commentList,data=await Announcement.getDataFromGlobalVariable(params.id);if(void 0!==commentList)for(var i=0;i<commentList.length;i++){var dataCom=commentList[i];!0===dataCom.isHTML?(dataCom.content=ZPFeeds.Activity.validateContent(dataCom.content,!1),dataCom.content=ZPFeeds.Activity.getImgAndCBoxClass(dataCom.content,resultData.actRecId)):(dataCom.content=ZSEC.Encoder.encodeForHTML(dataCom.content),dataCom.content=ZPFeeds.Activity.filterTemplate(dataCom.content))}if(void 0===Announcement.ANNOUNCMENT_LIST.LIST[params.id].commentCount&&(Announcement.ANNOUNCMENT_LIST.LIST[params.id].commentCount=resultData.totalCmtCount),Layout.Page.container.find("#MediumView").find("#zplike_container").remove(),200===resultData.code){resultData.subBtnName="zp.post",resultData.type="Announcement",resultData.subBtnId="postCommentBtn",resultData.subBtnCallBack=Announcement.addComment,resultData.showMoreCallback=Announcement.getMoreComments,resultData.delBtnCallBack=Announcement.delComment,resultData.isCommentDisable=Announcement.ANNOUNCMENT_LIST.LIST[params.id].isCommentDisable,resultData.owner=Announcement.ANNOUNCMENT_LIST.LIST[params.id].owner,resultData.locationId=Announcement.ANNOUNCMENT_LIST.LIST[params.id].location,resultData.totalComments=Announcement.ANNOUNCMENT_LIST.LIST[params.id].commentCount;var arrLength=resultData.commentList.length;let tempcnt=resultData.totalComments;Layout.Page.container.find("#view_more_cmts").length>0&&(tempcnt=parseInt(Layout.Page.container.find("#view_more_cmts").attr("morecomments"))),tempcnt-=arrLength,resultData.hasNext||resultData.commenthasNext?resultData.viewallcomments=ZPI18N.getString("zp.viewallcomments",[tempcnt]):resultData.viewallcomments=ZPI18N.getString("zp.viewingallcomments",[resultData.totalComments]),void 0!==otherDetails&&otherDetails.isFirst&&(data.commentList={}),resultData.comments=resultData.commentList;for(i=0;i<resultData.comments.length;i++)(isadmin||_LOGGEDIN_ZUID==resultData.comments[i].commby)&&(resultData.comments[i].isDelete=!0),resultData.comments[i].type=People.Announcement.type;Object.keys(data.commentList).length,$.each(resultData.commentList,function(key,value){data.commentList[resultData.commentList[key].commentId]=resultData.commentList[key]}),data.likeDetail=void 0!=resultData.likeDetail?resultData.likeDetail:resultData.annLikeCnt,void 0!==otherDetails&&otherDetails.isFirst?($("#zp_ann_comments").html(ZPFeeds.Construction.bottomContainerConstruction(resultData)),!1===Announcement.ANNOUNCMENT_LIST.LIST[resultData.actRecId].isActive&&Layout.Page.container.find("#cmtpostcont").remove()):ZPFeeds.Construction.constructComments($("#zp_ann_comments"),resultData,resultData.comments,!0),Layout.Page.container.find("#view_more_cmts").attr("morecomments",tempcnt),Layout.Page.container.find("#view_more_cmts").find("a").text(resultData.viewallcomments),Layout.Page.container.find("#view_more_cmts").attr("disabled",!1),Layout.Page.container.find("#MediumView").find("#zplike_container").remove(),$(".cboxElement").off("click"),$(".cboxElement").on("click",function(event){$(event.target).hasClass("filedwn")||ZPFeeds.registerAttPreview(event,this,Announcement.CURR_ANNOUNCEMENT)}),void 0!==otherDetails&&otherDetails.is_More&&ZPFeeds.Like.iterateLikedUsers(data.likeDetail)}else ZPeople.Message.showFailureMsg(void 0!==resultData.error?resultData.error:ZPI18N.getString("zp.adminerrormsg"))},getAnnouncementPage:function(isFromSearch){if(ZPeople.isAnnouncementAllowed)if($("body").removeClass("zp_AnnWindw"),Announcement.Construction.destroySelectZC(),Layout.Page.container.find("#zp_annEditor_outercont").remove(),-1!==Layout.Page.hash.indexOf(Announcement.URLCONTEXT+"announcements/list/view"))Announcement.Construction.constructViewAnnouncementDiv();else if(-1!==Layout.Page.hash.indexOf(Announcement.URLCONTEXT+"announcements/list/new"))Announcement.Construction.constructAddOrEditAnnouncementPage();else if(-1!==Layout.Page.hash.indexOf(Announcement.URLCONTEXT+"announcements/list/edit"))Announcement.Construction.constructAddOrEditAnnouncementPage();else if(-1!==Layout.Page.hash.indexOf(Announcement.URLCONTEXT+"announcements/list")&&!Announcement.ISLIST_PAGE_INITIALISED){$("body").addClass("Ann_ViewCon");var cont=Layout.Page.container;cont.find("#back-btn").removeClass("DN"),cont.find("#zpann_filter").removeClass("TEbnd"),cont.find("#members_filter_icon").removeClass("blu ZPFilsel"),cont.find("#members_filter_icon").addClass("gry"),cont.find("#zpann_search").find("#zpann_search_box").off("keypress").on("keypress",function(event){13===event.keyCode&&Announcement.Util.searchAnnouncementByKey()}),Announcement.initAnnouncementListPage()}},getEditPageUrl:function(annoId){window.location.href="#"+Announcement.URLCONTEXT+"announcements/list/edit-annId:"+annoId},getMoreComments:function(isMore){var tempVar=Announcement.ANNOUNCMENT_LIST.LIST[Announcement.CURR_ANNOUNCEMENT].commentCount;if(!0===isMore&&tempVar>5){var cont=$("#zp_ann_comments");0==cont.find("#view_more_cmts").find("#loader").length&&(cont.find("#view_more_cmts").append(ZPFeeds.MINILOADER),cont.find("#view_more_cmts").attr("disabled",!0)),Announcement.getCommentsById(Announcement.CURR_ANNOUNCEMENT,null,Announcement.COMMENT_START_INDEX,isMore)}},resetFilter:function(){Layout.Page.container.find("#zpann_filter").find("#filter_is_sticky").prop("checked",!1),[{id:"categories"},{id:"loc"},{id:"isenable",defVal:"1"}].forEach(function(option){let selct=ZPeopleComponents.select($("#"+option.id));selct&&(option.defVal?selct.setValue(option.defVal):selct.deselectAllOptions())}),Announcement.IS_FILTER=!1,Announcement.ANN_LAST_SEARCHKEY=void 0,isAnnAdmin&&Layout.Page.container.find("#zpann_add_button").removeClass("DN"),Announcement.initAnnouncementListPage()},showOrHideFilter:function(isFilterSeach){var memberFilter=Layout.Page.container.find("#zpann_filter"),memberFilterIcon=Layout.Page.container.find("#members_filter_icon");Layout.Page.container.find("#zpann_search_box").val(""),memberFilter.removeClass("TEbnd");var pagewrapper=$("#wrapper").find("#page-wrapper");!0===isFilterSeach||memberFilterIcon.hasClass("gry")?(memberFilter.addClass("TEbnd"),memberFilterIcon.removeClass("gry"),memberFilterIcon.addClass("blu ZPFilsel"),pagewrapper.removeClass("DN")):(memberFilterIcon.addClass("gry"),memberFilterIcon.removeClass("blu ZPFilsel"),0==Layout.Page.container.find("#zpann_backbtn").length&&(Announcement.IS_FILTER=!1,Announcement.ANN_LAST_SEARCHKEY=void 0))},getAddPageUrl:function(){window.location.href="#"+Announcement.URLCONTEXT+"announcements/list/new"},getBackPage:function(hash){if($("body").removeClass("zp_AnnWindw"),!$("body").hasClass("Ann_ViewCon")&&$("body").addClass("Ann_ViewCon"),"home/organization/dashboard"!==Layout.Page.urlmode)return-1!==Layout.Page.hash.indexOf("#"+Announcement.URLCONTEXT+"announcements/list/view-annId")?window.location.href="#"+Announcement.URLCONTEXT+"announcements/list":-1!==Layout.Page.hash.indexOf("#"+Announcement.URLCONTEXT+"announcements/list/edit-annId")?window.location.href="#"+Announcement.URLCONTEXT+"announcements/list/view-annId:"+Layout.Page.childUrlParam.annId:window.location.href="#"+Announcement.URLCONTEXT+"announcements/list",!1},getBackToListPage:function(){Announcement.Util.toggleViewAnnouncementDiv(),Layout.Page.container.find("#zpann_search_box").val("");Layout.Page.currentmode;Announcement.ANN_LAST_SEARCHKEY=void 0,Announcement.IS_FILTER=!1,Announcement.initAnnouncementListPage(),Announcement.ISBACKTOLISTPAGE=!0,isAnnAdmin&&Layout.Page.container.find("#zpann_add_button").removeClass("DN")},getEditor:function(txtID){try{var initobject={id:txtID,mode:"richtext",editorheight:500,content:Layout.Page.container.find("#templatemailtextarea").val(),avoidDropDragHandle:!0,avoidMoreOption:!0,placeholder:ZPI18N.getString("zp.anneditorplacehldr"),needEditorFocus:!1};return ZPUtil.createZEEditor(initobject,!1,!1,!1,!0,!0)}catch(err){}},getMoreAnnouncements:function(){!0===Announcement.HAS_NEXT&&(Announcement.IS_FILTER?Announcement.initFilterAnnouncement(!0,!0):Announcement.initAnnouncementListPage(!0,void 0!==Announcement.ANN_LAST_SEARCHKEY))},getDataFromGlobalVariable:async function(annoId){var data=Announcement.ANNOUNCMENT_LIST.LIST[annoId];return void 0===data&&(await Announcement.getAnnouncementById(annoId),data=Announcement.ANNOUNCMENT_LIST.LIST[annoId]),data},getCommentJson:function(resultData){return resultData.subBtnName="zp.post",resultData.type="Announcement",resultData.subBtnId="postCommentBtn",resultData.subBtnCallBack=Announcement.addComment,resultData.totalComments=resultData.commentCount,resultData},setValuesForFields:function(isAddMode,data){if(isAddMode||void 0!==data){let selectedLoc,selectedCategories,timeValue="";void 0===data?(Layout.Page.container.find("#zpann_addedit_header").text(ZPI18N.getString("zp.addannouncement",[Announcement.TABDISPNAME])),Layout.Page.container.find("#zp_ann_subjectbox").val(void 0),Layout.Page.container.find("#zp_div_notifylocemp").hide(),Layout.Page.container.find("#ann_cus_mailtemp").hide(),Layout.Page.container.find("#zp_is_sticky")[0].checked=!1,Announcement.EDITOR.setContent(" "),Layout.Page.container.find("#zp_div_notifyall").show(),Layout.Page.container.find("#zpann_notifyother_div").addClass("DN"),Layout.Page.container.find("#zp_div_notifylocemp").find("#zpann_notifylocemp").prop("checked",!1),Layout.Page.container.find("#zp_div_notifyall").find("#zpann_notifyall").prop("checked",!1),Layout.Page.container.find("#ann_comment_Disable").find("#zpann_cmtDisable").prop("checked",!1),Layout.Page.container.find("#zpann_notifyemaillist").val("")):(Layout.Page.container.find("#zpann_addedit_header").text(ZPI18N.getString("zp.editannouncement",[Announcement.TABDISPNAME])),Layout.Page.container.find("#zp_ann_subjectbox").val($("<div>").html(data.subject).text()),void 0===data.isSticky||1!==data.isSticky&&!data.isSticky||(Layout.Page.container.find("#zp_is_sticky")[0].checked=!0),void 0===data.isCommentDisable||1!==data.isCommentDisable&&!data.isCommentDisable||(Layout.Page.container.find("#zpann_cmtDisable")[0].checked=!0),void 0!==data.expireDate&&-1!=data.expireDate&&(timeValue=Announcement.getTimevalue(data.expireDate)),dataCom=ZPFeeds.Activity.validateRawContent(data.message,!1),dataCom=ZPFeeds.getRawVideoTags(dataCom,data.announcementId,People.Announcement.type),Announcement.EDITOR.setContent(dataCom)),void 0===data||void 0===data.notifyOthersEmailIds||ZPUtil.Validation.isEmpty(data.notifyOthersEmailIds)?Layout.Page.container.find("#zpann_notifyemaillist").val(""):Layout.Page.container.find("#zpann_notifyemaillist").val(data.notifyOthersEmailIds),Layout.Page.container.find("#zp_ann_subjectbox").trigger("focus"),void 0!==data&&void 0!==data.isNotify?(1===data.isNotify?(Layout.Page.container.find("#zp_div_notifylocemp").find("#zpann_notifylocemp").prop("checked",!0),Layout.Page.container.find("#zp_div_notifyall").hide()):(Layout.Page.container.find("#zp_div_notifylocemp").hide(),Layout.Page.container.find("#zp_div_notifyall").find("#zpann_notifyall").prop("checked",!0)),Layout.Page.container.find("#ann_cus_mailtemp").show()):Layout.Page.container.find("#zp_div_notifylocemp").hide(),void 0!==data&&1===data.isCommentDisable?Layout.Page.container.find("#zpann_cmtDisable").prop("checked",!0):Layout.Page.container.find("#zpann_cmtDisable").prop("checked",!1),void 0!==data&&void 0!==data.location&&data.location.length>0&&(selectedLoc=data.location),void 0!==data&&void 0!==data.categories&&data.categories.length>0&&(selectedCategories=data.categories);let dateOptions={calendarIcon:!0,format:dateFmt+" "+("HH:mm"==timeFormat?"HH:mm:ss":"hh:mm tt"),picker:!0,spinButtons:"none",clearButton:"always",value:timeValue,pickerdateselect:Announcement.changeDate};ZPeopleComponents.datetimefield(Layout.Page.container.find("#zpann_expiredate"),dateOptions),Announcement.Construction.registerSelectZC("zpann_categories",Announcement.Construction.convertObjToArray(Announcement.CATEGORIES),selectedCategories,!0,Announcement.setAsEdited,isadmin?{id:"category_add_icon",isFooter:!0,innerHTML:'<button onclick="Announcement.Construction.constructCategoryBox()" class="zlabel zlabel--blue zlabel--outline zlabel--medium zpl_btncnt">'+ZPI18N.getString("zp.addcategory")+"</button>"}:void 0),Announcement.Construction.registerSelectZC("zpann_location",Announcement.Construction.convertObjToArray(Announcement.LOCATIONS),selectedLoc,!0,Announcement.hideAndShowLocationNotify);var notifyInpuDiv=Layout.Page.container.find("#zp_div_notifyall,#zp_div_notifylocemp,#zp_div_notifyothers");Announcement.isEnabledNotify?(notifyInpuDiv.removeClass("disabled"),notifyInpuDiv.find("input").prop("disabled",!1)):(notifyInpuDiv.addClass("disabled"),notifyInpuDiv.find("input").attr("disabled",!0)),Announcement.isEnabledNotify?Layout.Page.container.find("#notifyAltMsgDiv").addClass("DN"):Layout.Page.container.find("#notifyAltMsgDiv").removeClass("DN");var annObject=Layout.Page.container.find("#ann_Editor");annObject.find(".filePrev").remove(),annObject.find(".attachedContainer").children("input").remove(),annObject.find(".attachedContainer").attr("attachcnt",0),void 0!==data&&void 0!==data.attachDtls&&Announcement.Attachments.getEditPreviewForAttachment(annObject,data.attachDtls,!0,"Announcement")}},changeDate:function(event){let value=event.detail.valueString;$(event.target).val(value),$(event.target).trigger("change")},getTimevalue:datetime=>{let value="";if("HH:mm"==timeFormat){let dateObj=new Date(datetime);value=Calendar.formatDate(dateObj);let hrs=dateObj.getHours();return value+" "+Calendar.twoDig(hrs)+":"+Calendar.twoDig(dateObj.getMinutes())+":"+Calendar.twoDig(dateObj.getSeconds())}return Calendar.convertLongToDateTime(datetime)},hideAndShowLocationNotify:function(event){"zselectchange"==event.type&&Announcement.setAsEdited(),0==Layout.Page.container.find("#zpann_location").val().length?($("#zp_div_notifyall").show(),$("#zp_div_notifylocemp").hide(),$("#zp_div_notifylocemp").find("#zpann_notifylocemp").prop("checked",!1)):($("#zp_div_notifyall").hide(),$("#zp_div_notifylocemp").show(),$("#zp_div_notifyall").find("#zpann_notifyall").prop("checked",!1))},handleLocationResponse:function(data){"error"!==data.error&&$.each(data.location_list_key,function(key,value){Announcement.LOCATIONS[this.locationid]=this.locationname})},constructAnnouncementListView:function(data,params,otherDetails){if(200===data.code||!0===otherDetails.isSearch){var announcementList;Announcement.Layout.find("#zp_announcement_list_div").find("div#zp_announcement_list").removeClass("DNI"),!0!==otherDetails.isMoreAnn&&Announcement.Layout.find("#zp_announcement_list_div").find("div#zp_announcement_list").html(""),void 0===otherDetails.isSearch||!1===otherDetails.isSearch?(Announcement.ISLIST_PAGE_INITIALISED=!0,!0!==otherDetails.isFilter?void 0===Announcement.ANN_LAST_SEARCHKEY&&Announcement.Layout.find("#zpann_backbtn").addClass("DN"):(Announcement.Layout.find("#zpann_backbtn").removeClass("DN"),Announcement.Layout.find("#zpann_add_button").addClass("DN"))):(Announcement.Layout.find("#zpann_backbtn").removeClass("DN"),Announcement.Layout.find("#zpann_add_button").addClass("DN")),!0!==otherDetails.isSearch?announcementList=data.announcementList:(announcementList=[],void 0!==data.announcementList?$.each(data.announcementList,function(key,value){announcementList.push(value)}):(Layout.Page.container.find("#zpann_backbtn").addClass("DN"),$.each(data,function(key,value){announcementList.push(value)}))),Announcement.Layout.find("#zp_page_loading").remove();var commentsCnt,likeCnt,currData,parentObj=Announcement.Layout.find("#zp_announcement_list_div");if(!0!==otherDetails.isMoreAnn&&Layout.Page.container.find(".ZP-announcetable").find("#zp_page_loading").length>0?Announcement.Layout.find(".ZP-announcetable").find("#zp_page_loading").remove():!0===otherDetails.isMoreAnn&&Layout.Page.container.find("#zp_page_loading").length>0&&Announcement.Layout.find("#zp_page_loading").remove(),void 0!==announcementList&&announcementList.length>0)parentObj.find("#nodataImg").length>0&&parentObj.find("#nodataImg").remove(),!0===data.hasNext&&(Announcement.HAS_NEXT=!0,Announcement.START_INDEX=Announcement.START_INDEX+25,ZPeople.FireScroll.reset()),!0!==otherDetails.isSearch?(commentsCnt=data.commentsCnt,void 0!==(likeCnt=data.annLikeCnt)&&(likeDetail=likeCnt,likeCnt=likeCnt.statusIds)):(commentsCnt=this.commentsCnt,likeDetail=this.likeDetail,likeCnt=this.likeCnt),$.each(announcementList,function(){currData=!0!==otherDetails.isSearch?Announcement.mergeAnnouncementLikeCommentData(this,commentsCnt,likeCnt,void 0,likeDetail):this,parentObj.find("div#zp_announcement_list").append(Announcement.commonListViewConstruction(currData,void 0,currData.announcementId))});else 0===Object.keys(otherDetails).length||!0===otherDetails.isSearch&&!0!==otherDetails.isMoreAnn||!0===otherDetails.isFilter&&!0!==otherDetails.isMoreAnn?0===parentObj.find("#nodataImg").length&&parentObj.append(ZPUtil.noDataImg("zp_nd_faq",ZPI18N.getString("zp.noannouncements",[Announcement.TABDISPNAME]))):Object.keys(otherDetails).length>0&&void 0===otherDetails.isMoreAnn&&void 0===otherDetails.isSearch?0===parentObj.find("#nodataImg").length&&parentObj.append(ZPUtil.noDataImg("zp_nd_faq",ZPI18N.getString("zp.noannouncements",[Announcement.TABDISPNAME]))):(0===Object.keys(otherDetails).length||!0===otherDetails.isSearch&&1==otherDetails.isMoreAnn||!0===otherDetails.isFilter&&1==otherDetails.isMoreAnn)&&Announcement.Layout.find(".ZP-announcetable").find("#zp_page_loading").remove()}else 400===data.code&&(Layout.Page.container.find(".ZP-announcetable").find("#zp_page_loading").remove(),ZPeople.Message.showFailureMsg(data.error))},mergeAnnouncementLikeCommentData:function(data,commentsCnt,likeCnt,commentList,isUpdate,likeDetail,isget,isValid,hasNext){var annoId=data.announcementId;if(void 0!==commentsCnt){var countValue=commentsCnt[annoId];data.commentCount=void 0!==countValue?countValue:0}if(void 0!==likeCnt&&void 0!==likeCnt[annoId]&&void 0!==likeCnt[annoId][0]){var userIds=likeCnt[annoId][0].toString().split(",");if(userIds=ZPUtil.removeDuplicatesFromArray(userIds),likeCnt[annoId][0]=userIds,-1!==userIds.indexOf(erecno)){data.isCurUserLike=!0;var liketypeArr=[];void 0!==likeCnt[annoId][3]&&"string"==typeof likeCnt[annoId][3]?liketypeArr=JSON.parse(likeCnt[annoId][3]):(liketypeArr=likeCnt[annoId][3],data.userLikeType=liketypeArr[userIds.indexOf(erecno)])}else data.isCurUserLike=!1,data.userLikeType=0;data.likeDetail=likeDetail,data.likeCount=likeCnt[annoId][1]}else data.likeCount=0,data.isCurUserLike=!1,data.likeDetail={};return void 0!==commentList&&Object.keys(commentList).length>0?(data.commentList=commentList,data.likeDetail=likeDetail):data.commentList={},data.isValid=isValid,void 0!==hasNext&&(data.hasNext=hasNext),Announcement.ANNOUNCMENT_LIST.LIST[annoId]=data,data},commonListViewConstruction:function(currObj,empRow,annoId){if(void 0===currObj.attachDtls&&void 0===currObj.attachmentDtls||'<br><br><i class="IC-attach1"></i>',0===Layout.Page.container.find("div#zp_announcement_list").find("#zp_ann_row_"+annoId).length){var listData="<div "+(1===currObj.isSticky||currObj.isSticky?'isPinned="true"':"")+'class="zpl_catlst '+(1==currObj.isActive?"":"disabled pauto")+'" rel="ann_navig" id=zp_ann_row_'+annoId+' data-popup-open="announcementpopup" tabindex="0" aria-label="'+ZPI18N.getString("zp.wcag.announcementcardtitle",[1===currObj.isSticky||currObj.isSticky?ZPI18N.getString("zp.pinnedann",[ZPI18N.getString("zp.announcement")]):"",currObj.subject,void 0!==currObj.empName?currObj.empName:empRow.name,ZPDateTime.getDateDisplayFormat(currObj.publishDate)])+'" role="listitem" aria-hidden="true" aria-haspopup="true">';if((1===currObj.isSticky||currObj.isSticky)&&(listData+='<i class="PI_pin zpl_pinpost"></i>'),listData+='<span class="zpl_catlstimg"><img src="'+(void 0!=currObj.photo?currObj.photo:empRow.avatar)+'"></span>',listData+='<div><h5 id="zpann_subject">'+currObj.subject+'</h5><p class="meta_secondary"><span empid="'+currObj.owner+'">'+(void 0!==currObj.empName?currObj.empName:empRow.name)+'</span><span class="zpl_dots sm"></span><span class="ann_time">'+ZPDateTime.getDateDisplayFormat(currObj.publishDate)+"</span>",void 0!==currObj.categories){listData+='<span class="zpl_dots sm"></span> <span role="link">';for(var length=currObj.categories.length,i=0;i<length;i++)0!=i&&(listData+=", "),listData+=Announcement.CATEGORIES[currObj.categories[i]];listData+="</span>"}return listData+="</p></div>",listData+='<div class="zpl_reviewconinfo"><label class="zpl_hvremoj" title="'+ZPI18N.getString("zp.likes")+'" id="zp_like_count"><span id="like_cnt">'+(void 0!==currObj.likeCount&&currObj.likeCount>0?currObj.likeCount:0)+"</span>"+(!0===currObj.isCurUserLike?ZPFeeds.Like.getLikeIconHTML(currObj.userLikeType):'<i class="PI_like NM"></i>')+'</label><label class="zpl_hvr zpl_hvrsw" title="'+ZPI18N.getString("zp.local.Comments")+'" id="zp_comment_count"><span id="zp_cmt_count">'+(void 0!==currObj.commentCount&&currObj.commentCount>0?currObj.commentCount:0)+'</span><i class="PI_comment blu"></i></label></div></li>',(listData=$(listData)).on("click",function(){Announcement.getDetailPage(annoId,Layout.Page.childUrlParam.annId)}),listData.find(".reviewIconInfo").on("click",function(){Announcement.getDetailPage(annoId,Layout.Page.childUrlParam.annId)}),listData}},getDetailPage:function(annoId,prevAnnoId){0!==Layout.Page.container.find("#MediumView").length&&annoId===prevAnnoId||(Layout.Page.container.find("#animate_cont").find(".Hdr_Lft").addClass("DN"),Layout.Page.container.find("#animate_cont").find(".Hdr_Rgt").addClass("DN"),$(".zp_mdl-bdy").addClass("DN"),0===Layout.Page.container.find("#animate_cont").find("#loading_animate").length&&Layout.Page.container.find("#animate_cont").append(Announcement.Construction.constructAnimateContent()),void 0!==prevAnnoId&&Layout.Page.container.find("#zp_ann_row_"+prevAnnoId).removeClass("active"),Layout.Page.container.find("#zp_ann_row_"+annoId).addClass("active"),window.location.href="#"+Announcement.URLCONTEXT+"announcements/list/view-annId:"+annoId)},checkListPageAlreadyLoaded:function(){var initialized=!1;return(initialized=Announcement.ISLIST_PAGE_INITIALISED)&&0===Object.keys(Announcement.ANNOUNCMENT_LIST.LIST).length&&(initialized=!1),initialized},changeUpdatedAnnouncement:async function(data){var originaldata=await Announcement.getDataFromGlobalVariable(data.announcementId);void 0!==data.expireDate&&(originaldata.expireDate=data.expireDate),void 0!==data.isSticky&&(originaldata.isSticky=data.isSticky),void 0!==data.message&&(originaldata.message=data.message),void 0!==data.location?originaldata.location=data.location:delete originaldata.location,void 0!==data.categories?originaldata.categories=data.categories:delete originaldata.categories,void 0!==data.modifiedTime&&(originaldata.modifiedTime=data.modifiedTime),void 0!==data.owner&&(originaldata.owner=data.owner),void 0!==data.subject&&(originaldata.subject=data.subject),Announcement.ANNOUNCMENT_LIST.LIST[data.announcementId]=originaldata},appendAddorEditAnnouncement:async function(annoId){var data=await Announcement.getDataFromGlobalVariable(annoId);if(void 0!==data){var empRow=ZPeople.getUserDetailsById(data.owner);$("#zp_announcement_list_div").removeClass("DNI"),$("#zp_announcement_list_div").find("#nodataImg").remove();var appendObj=$("#zp_announcement_list_div").find("div#zp_announcement_list");appendObj.find("#zp_ann_row_"+annoId).length>0&&appendObj.find("#zp_ann_row_"+annoId).remove();let pinnedAn=appendObj.find('[isPinned="true"]');data.isSticky||1==data.isSticky||0==pinnedAn.length?appendObj.prepend(Announcement.commonListViewConstruction(data,empRow,data.announcementId)):pinnedAn.last().after(Announcement.commonListViewConstruction(data,empRow,data.announcementId))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.announcementloadfailure",[Announcement.TABDISPNAME]))},constructAnnouncementDetailedPage:function(){var annoId=Layout.Page.childUrlParam.annId;-1===Layout.Page.hash.indexOf("#"+Announcement.URLCONTEXT+"announcements/")&&(annoId=void 0,Layout.Page.childUrlParam={});var index=Layout.Page.container.find("#zp_ann_row_"+annoId).index();Announcement.CURR_ANNOUNCEMENT=annoId;var modalObj=Layout.Page.container.find("#MediumView");modalObj.hasClass("in")||($("body").addClass("Ann_ViewCon"),modalObj.addClass("in")),Announcement.ISLIST_PAGE_INITIALISED||(modalObj.addClass("fullView"),Layout.Page.container.find(".CR-miniview").addClass("DNI")),void 0!=$('[rel="ann_navig"]')[index+1]&&document.getElementById($($('[rel="ann_navig"]')[index+1]).attr("id")).scrollIntoView(!1),modalObj.trigger("focus"),0===Layout.Page.container.find("#MediumView").length&&Layout.Page.container.find("#detailed_view_holder").html(Announcement.Construction.constructInnerViewPage()),Announcement.Util.isPermitPrevAndNextButton($('[rel="ann_navig"]'),index),Announcement.getAnnouncementById(annoId)},commonDetailedViewConstruction:async function(data,container){if(Layout.Page.childUrlParam.annId!=data.announcementId)return;container.find("#ownerDtls").html(""),container.find("#contentWrap").html(""),container.find("#Antitle").html("");let contenWrap=container.find("#contentWrap");contenWrap.find("#animate_cont").remove();let more=ZPeopleComponents.menu($("#Ann_more_dropdown")),actionMenu={menuId:"Ann_more_dropdown",forElementId:"Ann_more",callback:()=>Announcement.viewMore,parentId:"MediumView",option:[{label:ZPI18N.getString("zp.copyposturl"),fieldType:"COPYURL",iconClass:"PI_cpy"}],contentType:"icon-text"};if(more&&(more.destroy(),$("body").append('<div id="Ann_more_dropdown"></div>')),Announcement.Util.isValidForAdminPermissions(data)){let cmdIcon="PI_commentD",lable=ZPI18N.getString("zp.disablecmt");1===data.isCommentDisable&&(cmdIcon="PI_comment",lable=ZPI18N.getString("zp.enablecmt")),actionMenu.option.push({label:ZPI18N.getString("zp.edit"),fieldType:"EDIT",iconClass:"PI_edt"},{label:data.isActive?ZPI18N.getString("zp.disablepost"):ZPI18N.getString("zp.enablepost"),fieldType:"EN-DIS_POST",itemValue:data.isActive,iconClass:data.isActive?"PI_eyecls":"PI_eye"},{fieldType:"EN-DIS_COMT",itemValue:1===data.isCommentDisable,itemType:"custom",innerHTML:'<div class="zmenu__iconcontainer"><i class="zmenu__icon '+cmdIcon+'">  </i></div><span class="zmenu__text">'+lable+'</span><i isinfo="true" data-popover="true" data-html="true" data-original-title="" class="PI_info zpl_icinfogry zpl_popovr-js '+(1===data.isCommentDisable?"zpl_DNI":"")+'" title="'+ZPI18N.getString("zp.postcommentdisabledinfomsg")+'"></i>'},{label:ZPI18N.getString(1===data.isSticky||data.isSticky?"zp.unpin":"zp.pin"),fieldType:"PIN-UNPIN_POST",itemValue:1===data.isSticky||data.isSticky,iconClass:1===data.isSticky||data.isSticky?"PI_unpin":"PI_pin"},{itemType:"separator"},{label:ZPI18N.getString("zp.delete"),fieldType:"DELETEPOST",iconClass:"PI_delete",className:"red"})}Announcement.Component.dropDownMenu(actionMenu);let postedUser=ZPeople.getUserDetailsById(data.owner);container.find("#ownerDtls").html('<div class="zpl_em"><div class="zpl_emimg"><img src="'+postedUser.avatar+'"></div><div class="zpl_emdts"><div><b title="'+postedUser.name+'">'+postedUser.name+"</b></div><em>"+(Announcement.Util.isEmpty(postedUser.designation)?"":postedUser.designation)+(Announcement.Util.isEmpty(postedUser.designation)||Announcement.Util.isEmpty(postedUser.deptName)?"":" - ")+(Announcement.Util.isEmpty(postedUser.deptName)?"":postedUser.deptName)+'</em><span class="zpl_dots sm"></span><span class="ann_time">'+ZPDateTime.getDateDisplayFormat(data.publishDate)+"</span></div></div>"),container.find("#Antitle").html(data.subject);var dataCom=ZPFeeds.getVideoTags(data.message,data.announcementId,People.Announcement.type);if(dataCom=ZPFeeds.Activity.validateContent(dataCom,void 0,void 0,void 0,void 0,!0),dataCom=ZPFeeds.Activity.getImgAndCBoxClass(dataCom,data.announcementId),contenWrap.append($('<div  class="zpl_secn"><div id="zpann_message_detail" class="zpl_mdannocemntEtr"></div></div>')),contenWrap.find("#zpann_message_detail").append(dataCom),contenWrap.attr("streamid",data.announcementId),void 0!=data.attachDtls&&0!=data.attachDtls.length){let attachments=$('<div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.attachments")+"</h5></div></div>");var attachContent=ZPFeeds.Activity.getAttachments(data.attachDtls,data.announcementId,void 0,"Announcement");attachments.append('<div class="zpl_atchd">'+(void 0!=attachContent.imgcontent?attachContent.imgcontent:"")+(void 0!=attachContent.filecontent?attachContent.filecontent:"")+"</div>"),contenWrap.append(attachments)}var postMessage="<div class='zpl_secn'><div><div class='postexp'><div><span>"+ZPI18N.getString("zp.expiry")+" :</span><b> "+(-1==data.expireDate?ZPI18N.getString("zp.nil"):ZPDateTime.getDateDisplayFormat(data.expireDate))+"</b></div><div><span>"+ZPI18N.getString("zp.location")+" :</span><div class='cust-labelTags'>",locs="";if(void 0!==data.location&&data.location.length>0)for(var cnt=0;cnt<data.location.length;cnt++)ZPUtil.Validation.isEmpty(data.location[cnt])||(postMessage+="<span class='label label-primary FL MR5'>"+Announcement.getLocationNameByID(data.location[cnt].trim())+"</span>",locs+=Announcement.getLocationNameByID(data.location[cnt].trim())+",");else postMessage+="<span class='label label-primary FL MR5'>"+ZPI18N.getString("zp.all")+"</span>",locs=ZPI18N.getString("zp.all");if(container.attr("aria-label",ZPI18N.getString("zp.wcag.announcementcardcontent",[data.messageText,"-1"!=data.expireDate?ZPDateTime.getDateDisplayFormat(data.expireDate):"Nil",locs,data.likeCount,data.commentCount])),postMessage+="<span class='clearfix'></span></div></div></div>",void 0!==data.categories&&data.categories.length>0){postMessage+='<div class="zp_catoLstn"><h5>'+ZPI18N.getString("zp.categories")+'</h5><ul class="ann_category">';for(cnt=0;cnt<data.categories.length;cnt++)postMessage+='<li class="clrBg'+(cnt+1)%7+'"><span class="textClr">'+Announcement.CATEGORIES[data.categories[cnt]]+"</span></li>";postMessage+="</ul></div></div>"}contenWrap.append(postMessage);let reactionData=ZPFeeds.Like.getLikeClassObj(data.userLikeType),commentSection=$('<div class="zpl_secn"><div class="com_cont"><ul class="zp-post-actions reviewsection zp-rActions"><li class="'+(data.isCurUserLike?"zp_emjReact "+reactionData.textclname:"zp-post-like")+'" id="liketypecldiv" type="0">'+(data.isCurUserLike?ZPFeeds.Like.getLikeIconHTML(data.userLikeType,reactionData):"")+'<span class="reactText"></span></li><li class="zp-post-comment" id="zp_comment_count"><span>'+ZPI18N.getString("zp.comment")+"</span></li></ul></div></div>");contenWrap.append(commentSection);let scrollDiv=container.find(".zpl_mcnt.zpl_fm.zp-fd-wrpr");commentSection.find("#zp_comment_count").on("click",function(){scrollDiv.animate({scrollTop:scrollDiv.prop("scrollHeight")},500),commentSection.find("#cmt_textarea").click()}),(commentSection=commentSection.find(".com_cont")).append('<div class="zpl_feedPost post_Shwmre wd100_per"><div class="feedPost_btmSecn"></div></div>');let commentwrap=commentSection.find(".feedPost_btmSecn");if(1==data.isActive&&ZPFeeds.Like.registerLikeOptions(commentSection.find("#liketypecldiv"),data.announcementId,"Announcement",!0,!0),contenWrap.append('<div class="zpl_secn"><div class="text-center"><div id="cmtDisableAlert"></div></div>'),1===data.isCommentDisable){let msg=isadmin||isAnnAdmin&&erecno===data.owner||isOperationalRoleAdmin&&Announcement.isLocationInAdminProfile(data.location,ZPeople.CURR_USER.locId)?ZPI18N.getString("zp.commentsdisabledforemployee"):ZPI18N.getString("zp.commentsdisabled");contenWrap.find("#cmtDisableAlert").addClass("post-alrt").html('<div class="MT20 zalertbanner zalertbanner--error" data-position="top-left" ><i class="PI_commentD zalertbanner__icon whi"></i><span class="zalertbanner__text">'+msg+"</span></div>")}else contenWrap.find("#cmtDisableAlert").removeClass("post-alrt").html("");commentwrap.append('<div id="zp_ann_comments"></div>'),commentwrap.find("#zp_ann_comments").html(ZPeople.LOADING_HTML);let commendData=Announcement.getCommentJson(data);if(commendData.actRecId=commendData.announcementId,0===commendData.commentCount&&(commendData.comments=[]),0==commendData.commentCount&&void 0!==container)commentwrap.find("#zp_ann_comments").find("#zp_page_loading").remove(),commendData.delBtnCallBack=Announcement.delComment,commentwrap.find("#zp_ann_comments").append(ZPFeeds.Construction.bottomContainerConstruction(commendData)),Layout.Page.container.find("#MediumView").find("#zplike_container").remove(),commendData.isActive&&(isadmin||isAnnAdmin&&erecno===commendData.owner||isOperationalRoleAdmin&&Announcement.isLocationInAdminProfile(commendData.location,ZPeople.CURR_USER.locId)||void 0!==commendData.isCommentDisable&&1!==commendData.isCommentDisable)&&commentwrap.find("#zp_ann_comments #bottomcont").append(ZPFeeds.Construction.constructTextArea(!0,commendData));else{var otherDetails={commentwrap:commentwrap.find("#zp_ann_comments"),isFirst:!0},params={id:commendData.actRecId};commendData.code=200,commendData.hasNext=Announcement.cmtHasNext,Announcement.COMMENT_START_INDEX=1,await Announcement.handlegetCommentsByIdResponse(JSON.parse(JSON.stringify(commendData)),params,otherDetails),commendData.isActive&&(isadmin||isAnnAdmin&&erecno===commendData.owner||isOperationalRoleAdmin&&Announcement.isLocationInAdminProfile(commendData.location,ZPeople.CURR_USER.locId)||void 0!==commendData.isCommentDisable&&1!==commendData.isCommentDisable)||commentwrap.find("#zp_ann_comments #bottomcont").addClass("zpl_fl wd100_per")}if(commentwrap.find("#bottomcont").prepend('<ul class="zp-fd-content zp-fd-likedlist zp-fd-Ereact" id="anlike_container"><li><div class="zp_emjReact" id="liketypes"></div></li></ul>'),void 0!==data.likeDetail&&void 0!==data.likeDetail.statusIds&&void 0!==data.likeDetail.statusIds[data.announcementId]){var likeDtl=data.likeDetail.statusIds[data.announcementId],likeTypeObj=ZPFeeds.Like.getLikeTypeClass(likeDtl[3],likeDtl[0].indexOf(erecno));if(contenWrap.find("#liketypecldiv").find(".reactText").html(likeTypeObj.text),commentSection.find("#anlike_container #liketypes").html(ZPFeeds.Like.getListOfLikeHtml(likeDtl[3],likeDtl[0].indexOf(erecno))),data.isCurUserLike&&contenWrap.find("#liketypecldiv").attr("action","-1"),data.likeDetail.likedUserDtls){let lkUserList="",likedUsers=data.likeDetail.likedUserDtls,keys=Object.keys(likedUsers),fullwidth=.7*commentSection.find("#anlike_container")[0].offsetWidth,lkUserWidth=0,vsblLikedUserCount=0,nameList=commentSection.find("#anlike_container li");data.isCurUserLike&&(lkUserList=$('<a empid="'+erecno+'" popup="user" ltype="'+data.userLikeType+'" isusrzuid="false" class="likers">'+ZPI18N.getString("zp.you")+"</a>"),nameList.append(lkUserList),lkUserWidth+=lkUserList[0].offsetWidth,vsblLikedUserCount++);for(let count=0;count<keys.length;count++){let key=keys[count];if(key!=erecno){if(vsblLikedUserCount++,lkUserList=$('<a empid="'+key+'" popup="user" isusrzuid="false" class="likers">'+likedUsers[key].empName+"</a>"),nameList.append(lkUserList),fullwidth<=(lkUserWidth+=lkUserList[0].offsetWidth)){fullwidth<lkUserWidth+70&&(lkUserList.remove(),vsblLikedUserCount--);break}}else count++}let totalLikedUserCount=data.likeDetail.statusIds[data.announcementId][1];if(totalLikedUserCount>vsblLikedUserCount){let more=$('<div class="zp-more-likes" id="moreLikers" count="4"><span> &amp; </span><span class="morelk">'+(totalLikedUserCount-vsblLikedUserCount)+" "+ZPI18N.getString("zp.more")+"</span></div>");nameList.append(more),more.find(".morelk").on("click",function(){Announcement.CURR_ANNOUNCEMENT;ZPFeeds.Like.getMoreLikedUsers(data.announcementId,!0,People.Announcement.type)})}}}else contenWrap.find("#liketypecldiv").find(".reactText").html(ZPI18N.getString("zp.like")),contenWrap.find("#anlike_container #liketypes").html(""),contenWrap.find("#liketypecldiv").attr("action","0"),contenWrap.find("#anlike_container").addClass("zpl_DNI");ZPFeeds.Like.iterateLikedUsers(commendData.likeDetail),$(".cboxElement").off("click"),$(".cboxElement").on("click",function(event){$(event.target).hasClass("filedwn")||ZPFeeds.registerAttPreview(event,this,Announcement.CURR_ANNOUNCEMENT)})},toogleTextareaHeight:function(Obj,isIn,container){isIn?($(Obj).css("height","60px"),$(container).find("#zpann_cmt_btn").removeClass("DN")):void 0!==$(Obj).val()&&""!==$(Obj).val()||($(Obj).css("height","36px"),$(container).find("#zpann_cmt_btn").addClass("DN"))},getLocationNameByID:function(locID){return void 0!==Announcement.LOCATIONS[locID]?Announcement.LOCATIONS[locID]:ZPI18N.getString("zp.all")},isLocationInAdminProfile:function(locationIds,empLoc){if(void 0!==locationIds&&"ALL"!==locationIds)for(var locationArr="string"==typeof locationIds?locationIds.split(","):locationIds,i=0;i<locationArr.length;i++)return!!ZPUtil.checkIsExistInArray(Announcement.Util.getDataAdminAllLoctions(),locationArr[i])||(void 0===empLoc||0!==empLoc.length&&empLoc!==locationArr[i]);return!1},hideOrShowAnnouncementSettings:function(Obj,childObj){Obj.hasClass("clos")?(Obj.removeClass("clos"),Obj.addClass("openn"),childObj.find("#zp_dash_attachments").length>0?childObj.find("#zp_dash_attachments").removeClass("DN"):childObj.find("#zpann_settings").length>0&&childObj.find("#zpann_settings").removeClass("DN")):(Obj.removeClass("openn"),Obj.addClass("clos"),childObj.find("#zp_dash_attachments").length>0?childObj.find("#zp_dash_attachments").addClass("DN"):childObj.find("#zpann_settings").length>0&&childObj.find("#zpann_settings").addClass("DN"))},viewMore:(event,data)=>{var selctedField=data.fieldType;if("COPYURL"==selctedField)ZPUtil.copytoClipboard();else if("EDIT"==selctedField)Announcement.getEditPageUrl(Layout.Page.childUrlParam.annId);else if("EN-DIS_POST"==selctedField){let id=data.menuitem.attr("id"),value=data.itemValue,menu=ZPeopleComponents.menu($("#Ann_more_dropdown"));Announcement.enableDisableAnnouncement(),menu.setMenuItemsAttribute(["#"+id],"label",value?ZPI18N.getString("zp.enablepost"):ZPI18N.getString("zp.disablepost")),menu.setMenuItemsAttribute(["#"+id],"itemValue",!value),$(data.menuitem).find(".zmenu__icon").toggleClass("PI_eye PI_eyecls")}else if("EN-DIS_COMT"==selctedField){let id=data.menuitem.attr("id"),value=data.itemValue,menu=ZPeopleComponents.menu($("#Ann_more_dropdown"));Announcement.enableDisableComment(),menu.setMenuItemsAttribute(["#"+id],"itemValue",!value),$(data.menuitem).find(".zmenu__icon").toggleClass("PI_comment PI_commentD"),$(data.menuitem).find(".zmenu__text").text(value?ZPI18N.getString("zp.disablecmt"):ZPI18N.getString("zp.enablecmt")),value?$(data.menuitem).find('[isinfo="true"]').removeClass("zpl_DNI"):$(data.menuitem).find('[isinfo="true"]').addClass("zpl_DNI")}else if("DELETEPOST"==selctedField)Announcement.deleteRecConfirm();else if("PIN-UNPIN_POST"==selctedField){let id=data.menuitem.attr("id"),value=data.itemValue,menu=ZPeopleComponents.menu($("#Ann_more_dropdown"));Announcement.pinUnpinAnnouncement(),menu.setMenuItemsAttribute(["#"+id],"label",value?ZPI18N.getString("zp.pin"):ZPI18N.getString("zp.unpin")),menu.setMenuItemsAttribute(["#"+id],"itemValue",!value),$(data.menuitem).find(".zmenu__icon").toggleClass("PI_pin PI_unpin")}},setAsEdited:()=>{-1!=window.location.hash.indexOf("home/organization/announcements/list/edit-annId")&&(Announcement.Construction.isEdited=!0,$('[fieldtype="annInput"]').off("change.annEdit"))}}).Categories={addCategory:function(category){if(void 0!==category&&ZPUtil.Validation.isEmpty(category))return Layout.Page.container.find("#catadd").find("#category_input").trigger("focus"),void Layout.Page.container.find("#catadd #category_error").show();if(void 0!==category&&category.trim().length>50)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.namelenghtwarn")),void Layout.Page.container.find("#catadd").find("#category_input").trigger("focus");Layout.Page.container.find("#catadd #category_error").hide(),Layout.Page.container.find("#cat_add_btn").append(ZPFeeds.MINILOADER);var param={category_name:category,mode:"ADD_CATEGORY"};ZPeople.Request.send(Announcement.REQUEST_URL,param,function(data,param){if(Layout.Page.container.find("#cat_add_btn").find("#loader").remove(),void 0!==data&&200===data.code){var catObj=Layout.Page.container.find("#catadd");catObj.find("#newComponent").remove(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.categoryaddsuccess")),Announcement.CATEGORIES[data.CATEGORY_ID]=data.CATEGORY_NAME,catObj.find("tbody").append('<tr class="cat_tr" categoryid="'+data.CATEGORY_ID+'"><td><span>'+data.CATEGORY_NAME+'</span></td><td class="option_td"><div class="zpl_hvr"><i class="PI_edt" onclick="Announcement.Categories.editCategory(this)"></i><i class="PI_delete" onclick="Announcement.Categories.deleteCategoryConfirm(this)"></i></div></td></tr>'),catObj.find("#category_input").val(""),catObj.find('[scroll="true"]').scrollTop(catObj.find('[scroll="true"]').height()),Announcement.Categories.refreshCategoryOption()}else data&&!ZPUtil.Validation.isEmpty(data.error)?ZPeople.Message.warning(data.error):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.categoryadderror"))})},updateCategory:function(category,category_id,inputObj){if(void 0!==category&&ZPUtil.Validation.isEmpty(category))inputObj.trigger("focus");else{if(void 0!==category&&category.trim().length>50)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.namelenghtwarn")),void Layout.Page.container.find("#catadd").find("#category_input").trigger("focus");var param={category_id:category_id,category_name:category,mode:"UPDATE_CATEGORY"};ZPeople.Request.send(Announcement.REQUEST_URL,param,function(data,param){if(void 0!==data&&200===data.code){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.categoryupdatesuccess")),Announcement.CATEGORIES[data.CATEGORY_ID]=data.CATEGORY_NAME;var catObj=Layout.Page.container.find("#catadd").find("[categoryid="+data.CATEGORY_ID+"]");catObj.removeClass("mv-edt"),catObj.find("#zp_catInput").parent(".iput").remove(),catObj.find(".ZPActIcn").remove(),catObj.find("span").html(data.CATEGORY_NAME),catObj.children().removeClass("DN"),Announcement.Categories.refreshCategoryOption()}else data&&!ZPUtil.Validation.isEmpty(data.error)?ZPeople.Message.warning(data.error):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.categoryupdateerror"))})}},deleteCategory:function(category_id){var param={category_id:category_id,mode:"DELETE_CATEGORY"};ZPeople.Request.send(Announcement.REQUEST_URL,param,function(data,otherDetails){if(void 0!==data&&200===data.code){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.categorydeletesuccess")),delete Announcement.CATEGORIES[param.category_id];var catObj=Layout.Page.container.find("#catadd").find("[categoryid="+otherDetails.category_id+"]");catObj.fadeOut(1e3,function(){catObj.remove()}),Announcement.Categories.refreshCategoryOption()}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.categorydeleteerror"))})},refreshCategoryOption:function(){Announcement.Categories.getCategories(),Announcement.Construction.registerSelectZC("zpann_categories",Announcement.Construction.convertObjToArray(Announcement.CATEGORIES),void 0,!0,void 0,isadmin?{id:"category_add_icon",isFooter:!0,innerHTML:'<button onclick="Announcement.Construction.constructCategoryBox()" class="zlabel zlabel--blue zlabel--outline zlabel--medium zpl_btncnt">'+ZPI18N.getString("zp.addcategory")+"</button>"}:void 0)},getCategories:function(){$.ajax({type:"POST",async:!1,url:"/announcementAction.zp",data:{mode:"GET_CATEGORIES",conreqcsr:csrfToken},success:function(resp){$.each(resp.categories,function(key,value){Announcement.CATEGORIES[this.category_id]=this.category_name})}})},constructCategoriesSelectBox:function(){var categoryHtml="";return $.each(Announcement.CATEGORIES,function(key,value){categoryHtml+="<option value="+key+">"+value+"</option>"}),categoryHtml},deleteCategoryConfirm:function(curObj){$(curObj).parents(".option_td").addClass("DN");let row=$(curObj).parents(".cat_tr");row.append('<td class="zpActbtn" id="zp_del_cat_conf"><div class="zpl_hvr zpl_hvrsw"><button class="zlabel zlabel--blue zlabel--small " id="del_cat_confirm">'+ZPI18N.getString("zp.confirm")+'</button><button id="del_cat_cancel" class="zlabel zlabel--small zlabel--outline">'+ZPI18N.getString("zp.cancel")+"</button></div></td>"),row.find("#del_cat_confirm").on("click",function(event){Announcement.Categories.deleteCategory(row.attr("categoryId"))}),row.find("#del_cat_cancel").on("click",function(event){row.children("td.option_td").removeClass("DN"),row.find("#zp_del_cat_conf").remove()})},editCategory:function(currObj){var Obj=$(currObj).parents(".cat_tr");Obj.children().addClass("DN"),Obj.append('<td class="iput"><input type="text" class="ztextbox" autofocus="autofocus" id="zp_catInput" value="'+ZPeople.escapeHtml(Obj.find("span").text())+'"></td><td class="ZPActIcn"><div class="zpl_hvr zpl_hvrsw"><i id="zpcat_edit" class="PI_tick grn"></i><i id="zpcat_cancel" class="PI_cls red"></i></div></td>'),Obj.find("#zp_catInput").trigger("focus"),Obj.find("#zpcat_edit").on("click",function(){Announcement.Categories.updateCategory(Obj.find("#zp_catInput").val(),Obj.attr("categoryId"),Obj.find("#zp_catInput"))}),Obj.find("#zpcat_cancel").on("click",function(){Obj.find(".iput").remove(),Obj.find(".ZPActIcn").remove(),Obj.children().removeClass("DN")})}},Announcement.Attachments={getAddPreviewForAttachment:function(formObj,file,isPost,input,dataUri){formObj.find("#zp_dash_attachments").find("#fd_loadtemplate").remove(),formObj.find("#zp_dash_attachments").attr("attachcnt",parseInt(formObj.find("#zp_dash_attachments").attr("attachcnt"))+1);parseInt($(input).attr("attachcnt"));var innerObj=void 0,index=file.name.lastIndexOf(".");let icnClass=ZPFeeds.Attachments.getIconClass(file.name.substring(index+1));(innerObj=$('<div class="filePrev" attachcnt="'+parseInt(formObj.find("#zp_dash_attachments").attr("attachcnt"))+'" ><div class="zpl_atchimg"><i class="'+icnClass+'"></i></div><div class="zpl_atchdtl"><h4 id="zp_fileName"></h4><p><span id="zp_fileSize"></span></p></div><div class="zpl_atchicn"><i id="zp_dashRemoveAttachment" class="PI_delete"></i></div></div>')).find("#zp_fileName").text(file.name),innerObj.find("#zp_fileSize").append(ZPUtil.formatBytes(file.size)),innerObj.find("#zp_dashRemoveAttachment").on("click",function(){ZPFeeds.Attachment.removeAttachment(this,!1,isPost,!0)}),formObj.find("#zp_dash_attachments").find("#"+$(input).attr("id")).append(input),formObj.find("#zp_dash_attachments").removeClass("DN").append(innerObj);parseInt(formObj.find("#zp_dash_attachments").attr("attachcnt")),formObj.find("#zp_dash_attachments").find("[existFile=true]").length;Announcement.Construction.hideShowAttachments("edit")},getEditPreviewForAttachment:function(cont,fileList,isPost,type,isAdd){for(var innerObj=void 0,i=0;i<fileList.length;i++){file=fileList[i];var index=file.fileName.lastIndexOf(".");let icnClass=ZPFeeds.Attachments.getIconClass(file.fileName.substring(index+1));(innerObj=$('<div class="filePrev" fileId="'+file.downloadFileId+'" existFile="true"  ><div class="zpl_atchimg"><i class="'+icnClass+'"></i></div><div class="zpl_atchdtl"><h4 id="zp_fileName"></h4><p><span id="zp_fileSize"></span></p></div><div class="zpl_atchicn"><i id="zp_dashRemoveAttachment" class="PI_delete"></i></div></div>')).find("#zp_fileName").text(file.fileName),innerObj.find("#zp_fileSize").append("string"==typeof file.fileSize?file.fileSize:ZPUtil.formatBytes(file.fileSize)),cont.find("#zp_dash_attachments").removeClass("DN").append(innerObj),Announcement.Construction.hideShowAttachments()}cont.find("#zp_dash_attachments").find("[id='zp_dashRemoveAttachment']").on("click",function(){ZPFeeds.Attachment.removeAttachment(this,!1,!0,!0)})}},Announcement.Construction={constructAddOrEditAnnouncementPage:async function(hash){if(Announcement.Construction.isEdited=!1,!isadmin&&!isAnnAdmin)return window.location.href="#"+Announcement.URLCONTEXT+"announcements/list",!1;$("body").addClass("zp_AnnWindw"),$("body").removeClass("Ann_ViewCon"),Announcement.Construction.constructAddEditHtml(hash);var annoId=Layout.Page.childUrlParam.annId;-1===Layout.Page.hash.indexOf("#"+Announcement.URLCONTEXT+"announcements/")&&(annoId=void 0,Layout.Page.childUrlParam={}),Announcement.CURR_ANNOUNCEMENT=annoId;var editorId,data,isAddMode=!1;void 0===annoId?(isAddMode=!0,editorId="zpann_textarea_"+!0):(editorId="zpann_textarea_"+annoId,await Announcement.getAnnouncementById(annoId),data=await Announcement.getDataFromGlobalVariable(annoId)),Layout.Page.container.find("#zpann_textarea").attr("id",editorId),Layout.Page.container.find("#zpann_expiredate").on("click",function(event){Calendar.setUpCalendar(event,this,1)}),Layout.Page.container.find("#user_id").html(ZPeople.CURR_USER.name),Layout.Page.container.find("#user_img_id").attr("src",ZPeople.CURR_USER.thumb),Announcement.EDITOR=Announcement.getEditor(editorId,annoId),Announcement.EDITOR.afterEditorLoad(function(){($(Announcement.EDITOR.iframe.contentDocument.body).on("dragenter",function(event){ZPFeeds.Attachment.dragOverAttachments(event,!0,"ann_Editor")}),$(Announcement.EDITOR.outerdiv).removeAttr("style"),$(Announcement.EDITOR.outerdiv).attr("style","height:500px"),setTimeout(function(){Layout.Page.container.find("#zp_ann_subjectbox").trigger("focus")},20),ZPUtil.Validation.isEmpty(Layout.Page.childUrlParam.annId))||$(Announcement.EDITOR.iframe.contentDocument.body).on("input",Announcement.setAsEdited)}),Layout.Page.container.find(".Zp-fd-plchldr").attr("tabIndex","0").on("dragenter",function(event){ZPFeeds.Attachment.dragOverAttachments(event,!0,"ann_Editor")}),window.onbeforeunload=function(event){if("<div><br></div>"!==Announcement.EDITOR.getContent())return event.returnValue=ZPI18N.getString("zp.unsavedchangesalert")},Layout.Page.container.popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right",delay:{show:50,hide:50}}),Announcement.setValuesForFields(isAddMode,data);var notifyInpuDiv=Layout.Page.container.find("#notifyDiv [name=notify]");Announcement.isEnabledNotify?notifyInpuDiv.removeClass("disabled gry"):notifyInpuDiv.addClass("disabled gry"),Announcement.isEnabledNotify?Layout.Page.container.find("#notifyAltMsgDiv").addClass("DN"):Layout.Page.container.find("#notifyAltMsgDiv").removeClass("DN"),ZPUtil.Validation.isEmpty(Layout.Page.childUrlParam.annId)||($('[fieldtype="annInput"]').off("input.annEdit change.annEdit"),$('[fieldtype="annInput"]').on("input.annEdit change.annEdit",Announcement.setAsEdited))},constructViewAnnouncementDiv:function(){var modalObj=Layout.Page.container.find("#MediumView");if(0===modalObj.length){let modal=$('<div  id="MediumView" class="zpl_mdl zpl_mmd zpl_mdanounceVw zpl_mopen" tabindex="0" role="dialog"><div class="zpl_minr"><div class="zpl_mhder"><div id="ownerDtls"></div><span class="zpl_mhderrgt"><a title="'+ZPI18N.getString("zp.automation.moreoptions")+'" id="Ann_more" class="PI_more zpl_btnic zpl_drpdwn-js"></a></span><a onclick="Announcement.Util.toggleViewAnnouncementDiv()" class="Ann_editorCls _cls PI_cls"></a></div><div class="zpl_mcnt zpl_fm zp-fd-wrpr"><div class="zpl_crd"><div class="zpl_crdhdr"><div><h2 id="Antitle"></h2></div></div><div id="contentWrap" class="zpl_crdcnt"></div></div></div></div></div>');modal.find("#contentWrap").html('<div class="zp_edtr-HdrInnr clearfix" id="animate_cont">'+Announcement.Construction.constructAnimateContent()+"</div>"),modal.find("#Ann_more").on("click",function(){let more=ZPeopleComponents.menu($("#Ann_more_dropdown"));more&&more.show()}),Layout.Page.container.append(modal),Announcement.ISLIST_PAGE_INITIALISED?(modalObj.removeClass("fullView"),setTimeout(function(){Announcement.constructAnnouncementDetailedPage()},50)):(modalObj.addClass("fullView"),$("body").addClass("Ann_ViewCon"),Announcement.constructAnnouncementDetailedPage()),setTimeout(function(){modalObj.addClass("zpl_mopen")},300)}else Announcement.constructAnnouncementDetailedPage()},constructAddEditHtml:function(hash){if(0==$("#zp_annEditor_outercont").length){let model=$('<div id="zp_annEditor_outercont" class="zpl_mdl zpl_mmd zpl_mdanounce zpl_mopen"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.announcement")+'</h4></div><a id="zp_ann_edtClose" class="_cls PI_cls"></a></div><div class="zpl_mcnt zpl_fm zp-fd-wrpr"><div class="zpl_crd"><div id="ann_Editor" class="zpl_crdcnt"></div></div></div><div class="zpl_mfoter"><button type="button" tabindex="0" class="zlabel zlabel--blue zlabel--medium zbutton zbutton--medium zbutton--primary" id="zpann_addbtn" onclick="Announcement.addAnnouncement()">'+ZPI18N.getString("zp.publish")+'</button><button aria-label="'+ZPI18N.getString("zp.wcag.cancel")+'" tabindex="0" type="close_mdl" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>"),editor=$('<div class="zpl_secn"><div class="zp-fd-compose" ><div class="zp-fd-composeCont"><div class="composeDesc-Cont"><a class="zp-fd-avatar" href=""><img class="zp-uimg" id="user_img_id" src=""></a><div id="zpann_textarea" class="composeDesc-Wrap"><div class="ZPDrfile DN"><div> <i class="IC-file1x"></i><span>Drag &amp; Drop files/add attachmentshere.</span><input type="file" class="ZPdfile DN"></div></div><div class="Ann_titleCont"><input id="zp_ann_subjectbox" fieldType="annInput" tabindex="0" class="composeCont-field" type="text" placeholder="'+ZPI18N.getString("zp.announcesubject",[Announcement.TABDISPNAMESMALL])+'" autocomplete="off" ondragover="ZPFeeds.Attachment.dragOverAttachments(event,true)"></div></div></div></div><div class="zp-fd-composeActions"></div></div></div>'),fileUpload=$('<div class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.attachments")+'</h5></div><div><div ondragover="Announcement.dragOverAttachments(event,true)" aria-label="'+ZPI18N.getString("zp.dropfilehere")+'" tabindex="0" class="zpl_upld"><div id="trag_attachment" class="zpl_fldrp"><h5><div class="zpl_flupld_img"></div>'+ZPI18N.getString("zp.draganddropfile")+' <a onclick="ZPFeeds.Attachment.createInput('+!1+',\'ann_Editor\');" class="zpl_lnk"><i class="PI_desktop"></i> '+ZPI18N.getString("zp.leave.operations.file.desktop")+"</a></div></div>"),files=$('<div id="zp_annAttachMents" class="zpl_secn"><div><h5>'+ZPI18N.getString("zp.attachmentfiles")+'</h5></div><div><div id="zp_dash_attachments" attachcnt="0" class="zpl_atchd" aria-label="'+ZPI18N.getString("zp.wcag.attachadded")+'"></div></div></div>'),settingHtml=$('<div class="zpl_crd"><div class="zpl_crdhdr" aria-label="'+ZPI18N.getString("zp.annpublishsetting")+'" tabindex="0"><div><h6>'+ZPI18N.getString("zp.annpublishsetting")+'</h6></div></div><div id="zpann_settings" class="zpl_crdcnt"></div></div>'),fieldcontainer=settingHtml.find("#zpann_settings");model.find("#ann_Editor").append(editor),model.find("#ann_Editor").append(fileUpload),model.find("#ann_Editor").append(files),model.find(".zpl_mcnt.zpl_fm.zp-fd-wrpr").append(settingHtml),fieldcontainer.append('<div class="zpl_secn" aria-label="'+ZPI18N.getString("zp.categories")+'" tabindex="0"><div><label>'+ZPI18N.getString("zp.categories")+'</label></div><div class="d-flexclmcap5"><select fieldType="annInput" id="zpann_categories" multiple="multiple" ></select></div></div>'),fieldcontainer.append('<div class="zpl_secn" aria-label="'+ZPI18N.getString("zp.expiry")+'" tabindex="0"><div><label>'+ZPI18N.getString("zp.expiry")+'</label></div><div><input fieldType="annInput" id="zpann_expiredate" type="text" caltype="page" autocomplete="off" class="ztextbox"></div></div>'),fieldcontainer.append('<div class="zpl_secn" aria-label="'+ZPI18N.getString("zp.locations")+'" tabindex="0"><div><label>'+ZPI18N.getString("zp.locations")+'</label></div><div><select fieldType="annInput" id="zpann_location" multiple="multiple"></select></div></div>'),fieldcontainer.append('<div class="zpl_secn"><div><div class="zcheckbox"><input fieldType="annInput" id="zpann_cmtDisable" type="checkbox" name="check" class="zcheckbox__helper"><label for="zpann_cmtDisable" class="zcheckbox__label"><span  class="zradiobutton__text">'+ZPI18N.getString("zp.disablecomments")+'</span><i data-placement="bottom" data-popover="true" data-html="true" data-original-title title="'+ZPI18N.getString("zp.disablecommentsmsg",[Announcement.TABDISPNAMESMALL])+'" class="PI_info zpl_icinfogry zpl_popovr-js"></i></label></div><div class="zcheckbox"><input fieldType="annInput" id="zp_is_sticky" type="checkbox" name="check" class="zcheckbox__helper"><label for="zp_is_sticky" class="zcheckbox__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.pin")+" "+Announcement.TABDISPNAMESMALL+'</span></label></div><div id="zp_div_notifyall" class="zcheckbox"><input fieldType="annInput" id="zpann_notifyall" type="checkbox" name="check" onchange="Announcement.Template.showHideannCustemp(this);" class="zcheckbox__helper"><label for="zpann_notifyall" class="zcheckbox__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.notifyall")+'</span></label></div><div id="zp_div_notifylocemp" class="zcheckbox"><input fieldType="annInput" onchange="Announcement.Template.showHideannCustemp(this);" id="zpann_notifylocemp" type="checkbox" name="check" class="zcheckbox__helper"><label for="zpann_notifylocemp" class="zcheckbox__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.notifylocemp")+'</span></label></div><div id="ann_cus_mailtemp" class="zcheckbox"><span><a  onclick="Announcement.Template.getAnnouncementTemplate();">'+ZPI18N.getString("zp.custmailtemp")+"</a></span></div></div></div>"),fieldcontainer.append('<div id="zp_div_notifyothers" class="zpl_secn"><div><label>'+ZPI18N.getString("zp.notifyothers")+'</label></div><div><textarea fieldType="annInput" id="zpann_notifyemaillist" class="ztextbox" placeholder="'+ZPI18N.getString("zp.multiplemailidseparationmsg")+'"></textarea></div></div>'),fieldcontainer.append('<div id="notifyAltMsgDiv" class="zpl_secn"><div><span>'+ZPI18N.getString("zp.neworgnotifyalertmsg")+"</span></div></div>"),Layout.Page.container.append(model),isadmin||Layout.Page.container.find("#category_add_icon").addClass("DN"),Layout.Page.container.find("#zp_annEditor_outercont").find("#zp_ann_edtClose,[type='close_mdl']").on("click",function(){if(Announcement.Construction.isEdited||ZPUtil.Validation.isEmpty(Layout.Page.childUrlParam.annId)&&"<div><br></div>"!==Announcement.EDITOR.getContent()){var alertInfo=new InfoAlertMessage(ZPI18N.getString("zp.zpalert"),ZPI18N.getString("zp.unsavedchangesalert"));alertInfo.yesButtonText=ZPI18N.getString("zp.confirm"),alertInfo.setCallback(function(){Announcement.Construction.destroySelectZC(),$("#zp_annEditor_outercont").remove(),window.onbeforeunload=null,Announcement.getBackPage(hash)}),alertInfo.show()}else Announcement.Construction.destroySelectZC(),$("#zp_annEditor_outercont").remove(),window.onbeforeunload=null,Announcement.getBackPage(hash)}),Layout.Page.container.find(".Ann_atchftr").find("#zpann_togglebtn").on("click",function(){Announcement.hideOrShowAnnouncementSettings($(this).find(".tglr_icn"),$(this).parent())})}Announcement.Construction.hideShowAttachments()},destroySelectZC:()=>{["zpann_categories","zpann_location"].forEach(function(id){let excomp=ZPeopleComponents.select($("#"+id));excomp&&excomp.destroy()})},registerSelectZC:(id,options,selected,isMulty,changeCallBack,footer)=>{let fldOption={dataMapping:{label:"lable",text:"lable",value:"value",id:"value"},dropdownList:{width:"259"},showSearchField:!0,search:{delay:200}};isMulty&&(fldOption.multiple=!0),changeCallBack&&(fldOption.change=changeCallBack),footer&&options.push(footer),options&&options.length>0&&(fldOption.options=options),selected&&(fldOption.selectedValue=selected),ZPeopleComponents.select($("#"+id),fldOption)},convertObjToArray:obj=>{let array=[];return $.each(obj,function(key,val){array.push({lable:ZPeople.decodeTxt(val),value:key})}),array},hideShowAttachments:type=>{"edit"==type&&Announcement.setAsEdited();let attachmentConatiner=Layout.Page.container.find("#zp_annAttachMents");attachmentConatiner.find("#zp_dash_attachments").children(".filePrev").length>0?attachmentConatiner.removeClass("DNI"):attachmentConatiner.addClass("DNI")},moveAttIconToLast:function(isRemoveOnly){Layout.Page.container.find("#zp_annEditor_outercont").find("#zp_dash_attachments").find(".Ann_atchbtn").remove(),!0!==isRemoveOnly&&Layout.Page.container.find("#zp_annEditor_outercont").find("#zp_dash_attachments").append('<div class="Ann_atchbtn" onclick="ZPFeeds.Attachment.createInput(false,\'ann_Editor\');"> <a class="IC-file1x" >'+ZPI18N.getString("zp.upload")+"</a> </div>")},constructCategoryBox:()=>{ZPeopleComponents.select(document.getElementById("zpann_categories")).close();let categoryHtml='<div id="catadd" class="zpl_mdl zpl_mcenter zpl_servcicn zpl_mopen" ><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.category")+'</h4></div><a id="category_close" class="_cls PI_cls"></a></div><div class="zpl_mcnt"><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn zpl_tblfxd"><div class="d-flexC flexclmcap"><input id="category_input"  placeholder="'+ZPI18N.getString("zp.addcatplacehldr")+'" value="" keyname="roleName" type="text" class="ztextbox"><button id="cat_add_btn" type="button" class="zlabel zlabel--blue zlabel--medium zbutton zbutton--medium zbutton--primary">'+ZPI18N.getString("zp.add")+'</button></div><div><div id="category_error" class="dverrormsg ztextbox--error__label" style="display:none;">'+ZPI18N.getString("zp.emptycategory")+'</div></div></div><div class="zpl_tblres mdl_maxhgt zpl_minhgt400" scroll="true" ><table class="zpl_tbl wd100_per"><tbody>';$.each(Announcement.CATEGORIES,function(key,value){categoryHtml+='<tr class="cat_tr" categoryId='+key+"><td><span>"+value+'</span></td><td class="option_td"><div class="zpl_hvr"><i class="PI_edt" onclick="Announcement.Categories.editCategory(this)"></i><i class="PI_delete" onclick="Announcement.Categories.deleteCategoryConfirm(this)"></i></div></td></tr>'}),categoryHtml+='</tbody></table></div></div></div></div><div class="zpl_mfoter">  <button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.cancel")+"</button> </div> </div> </div>",Layout.Page.container.append(categoryHtml),$("#category_input").focus(),Layout.Page.container.find("#cat_add_btn").on("click",function(){Announcement.Categories.addCategory(Layout.Page.container.find("#catadd").find("#category_input").val())}),Layout.Page.container.find("#catadd").find("#category_close,#sliderCancel").on("click",function(){Layout.Page.container.find("#catadd").remove()})},constructFilter:function(){if(Layout.Page.container.addClass("zpl_fltr_flt"),!Announcement.IS_FILTER){let status=[];var filterList=Layout.Page.container.find("#zpann_filter .zpl_fltrlst");Announcement.InitFilter||(filterList.empty(),filterList.append('<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.category")+'</label></div><div><select id="categories" multiple="multiple"></select></div></div>'),filterList.append('<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.location")+'</label></div><div><select id="loc" multiple="multiple"></select></div></div>'),(isadmin||isAnnAdmin)&&filterList.append('<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.status")+'</label></div><div><select id="isenable"></select></div></div>'),filterList.append('<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.type")+'</label></div><div><div class="zcheckbox"><input id="filter_is_sticky" type="checkbox" class="zcheckbox__helper"><label for="filter_is_sticky" class="zcheckbox__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.pinnedann",[Announcement.TABDISPNAME])+"</span></label></div></div></div>")),Announcement.Construction.registerSelectZC("categories",Announcement.Construction.convertObjToArray(Announcement.CATEGORIES),void 0,!0),Announcement.Construction.registerSelectZC("loc",Announcement.Construction.convertObjToArray(Announcement.LOCATIONS),void 0,!0),(isadmin||isAnnAdmin)&&(status.push({lable:ZPI18N.getString("zp.enabled"),value:"1"},{lable:ZPI18N.getString("zp.disabled"),value:"0"},{lable:ZPI18N.getString("zp.expired"),value:"-1"},{lable:ZPI18N.getString("zp.allstatus"),value:"2"}),Announcement.Construction.registerSelectZC("isenable",status,"1")),Announcement.InitFilter=!0}},constructInnerViewPage:function(){var innerHtml='<div class="main-media" id="anno_detail" streamId="'+Announcement.CURR_ANNOUNCEMENT+'">';return innerHtml+='<h3 class="Ann_title" id="zpann_subject_detail"></h3>',innerHtml+='<div class="media-posts Num-lists" id="zpann_message_detail">',innerHtml+="</div>",innerHtml+='<div class="media-comments" id="zp_ann_comments">',innerHtml+="</div>",innerHtml+="</div></div>"},constructAnimateContent:function(){var animateHtml='<div class="zp-fd-animate" id="loading_animate">';return animateHtml+='<div class="zp-fd-mask h-round"></div>',animateHtml+='<div class="zp-fd-mask h-top"></div>',animateHtml+='<div class="zp-fd-mask h-left"></div>',animateHtml+='<div class="zp-fd-mask h-right"></div>',animateHtml+='<div class="zp-fd-mask h-bottom"></div>',animateHtml+='<div class="zp-fd-mask sh-left"></div>',animateHtml+='<div class="zp-fd-mask sh-right"></div>',animateHtml+='<div class="zp-fd-mask sh-bottom"></div>',animateHtml+='<div class="zp-fd-mask cont-top"></div>',animateHtml+='<div class="zp-fd-mask cont-first-end"></div>',animateHtml+='<div class="zp-fd-mask cont-second-line"></div>',animateHtml+='<div class="zp-fd-mask cont-second-end"></div>',animateHtml+='<div class="zp-fd-mask cont-third-line"></div>',animateHtml+='<div class="zp-fd-mask cont-third-end"></div>',animateHtml+="</div>"},constructCommentTextarea:function(commentListObj,container){var textareaObj=$('<div class="ZPgrybg HA" id="textarear_container"> <div class="fcoms"> <div class="lft"><img src="'+ZPeople.CURR_USER.thumb+'"></div> <div class="rgt"><textarea class="ZPtxtarea form-control" id="zp_ann_textarea" placeholder="'+ZPI18N.getString("zp.writeacomment")+'" tabindex="0" aria-label="'+ZPI18N.getString("zp.wcag.writecomment")+'"></textarea><div class="text-right ZP-cmtbtn MT10 MB10 DN" id="zpann_cmt_btn" ><button class="btn btn-primary">'+ZPI18N.getString("zp.post")+"</button></div></div> </div> </div>");commentListObj.append(textareaObj),textareaObj.find("#zp_ann_textarea").focusin(function(){Announcement.toogleTextareaHeight(this,!0,container)}),textareaObj.find("#zp_ann_textarea").focusout(function(){Announcement.toogleTextareaHeight(this,!1,container)}),textareaObj.find("#zpann_cmt_btn").on("click",function(){Announcement.addComment(textareaObj.find("#zp_ann_textarea"),container)})},constructLocationList:function(){Layout.Page.container.find("#zpann_location").html(Announcement.Construction.constructLocationSelectBox()),Object.keys(Announcement.LOCATIONS).length>3?Layout.Page.container.find("#zpann_location").select2({placeholder:ZPI18N.getString("zp.alllocation"),maximumSelectionLength:5}).on("change",function(e){Announcement.hideAndShowLocationNotify()}):Layout.Page.container.find("#zpann_location").select2({placeholder:ZPI18N.getString("zp.alllocation"),maximumSelectionLength:5,minimumResultsForSearch:1/0}).on("change",function(e){Announcement.hideAndShowLocationNotify()})},constructLocationSelectBox:function(){var locationHtml="",oprAdminLoc=Announcement.Util.getDataAdminAllLoctions();return $.each(Announcement.LOCATIONS,function(key,value){(isAnnAdmin||ZPUtil.checkIsExistInArray(oprAdminLoc,key)||key==_LOGGEDIN_LOCID)&&(locationHtml+="<option value="+key+">"+value+"</option>")}),locationHtml}},Announcement.Util={toggleFullHalfAnnouncement:function(){var modalObj=Layout.Page.container.find("#MediumView");modalObj.hasClass("fullView")?modalObj.removeClass("fullView"):modalObj.addClass("fullView")},toggleViewAnnouncementDiv:function(nextSub){if(Layout.Page.container.find("#MediumView").removeClass("in"),$("body").toggleClass("Ann_ViewCon"),Layout.Page.container.find(".CR-miniview").removeClass("DNI"),Layout.Page.container.find("#zp_ann_row_"+Layout.Page.childUrlParam.annId).removeClass("active"),Layout.Page.container.find("#MediumView").remove(),"feed"!==Layout.Page.childUrlParam.page)window.location.href="#"+Announcement.URLCONTEXT+"announcements/list";else{if(!showNewTab)return void(window.location.href="#home/feeds/announcements");window.location.href="#"+Announcement.URLCONTEXT+"announcements/list"}},changesNeededForPrintPage:function(){var newWindow=window.open(),copyhead=$("head").clone(),body=Layout.Page.container.find("#MediumView").clone();body.find("#MediumClose").remove(),body.find("#cmtpostcont").remove(),body.find(".CR-miniview").remove(),body.find(".IC-ar-rgt-1").remove(),body.find(".IC-ar-lft-1").remove(),body.find("#zpann_filter").remove(),body.find("#zp_ann_listview_div").remove(),body.find("#moreDropdown").remove(),body.find(".ZPPhed").remove(),body.find(".zp-cmt-del").remove(),body.addClass("fullView");var newContent='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html>';newContent+=copyhead.html(),newContent+='<body onload="self.print()" style="overflow:scroll;width:1200px;background: #fff"><div class="zp-v4 ZPDark   TPink ZPsbarMini Ann_ViewCon">',newWindow.document.write(newContent+body[0].outerHTML+"</body>"),newWindow.document.close()},searchAnnouncementByKey:function(searchKey){searchKey=Layout.Page.container.find("#zpann_search_box").val().trim();ZPUtil.Validation.isEmpty(searchKey)?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.searchvaluesareempty")):(Announcement.ANN_LAST_SEARCHKEY=searchKey,Announcement.START_INDEX=1,Announcement.isRefreshNeed=!0,Announcement.initAnnouncementListPage(!1,!0))},isValidForAdminPermissions:function(currObj){return isadmin||isAnnAdmin&&erecno===currObj.owner||isOperationalRoleAdmin&&currObj.isProfOwner},validateDate:function(date){var expDate=moment(date,dateFmt.toUpperCase()+" "+timeFormat)._d,currDate=Calendar.currrentDate,validDt=!1;return expDate.getFullYear()>currDate.getFullYear()?validDt=!0:expDate.getFullYear()===currDate.getFullYear()&&(expDate.getMonth()>currDate.getMonth()?validDt=!0:expDate.getMonth()===currDate.getMonth()&&(expDate.getDate()>currDate.getDate()?validDt=!0:expDate.getDate()===currDate.getDate()&&expDate.getTime()>currDate.getTime()&&(validDt=!0))),validDt},movePrevAndNextAnnouncements:function(isNext){var annoId=Layout.Page.childUrlParam.annId,ind=Layout.Page.container.find("#zp_ann_row_"+annoId).index();if(isNext?ind+=1:ind-=1,void 0!=$('[rel="ann_navig"]')[ind]){var newAnnId=$($('[rel="ann_navig"]')[ind]).attr("id").split("_")[3];Announcement.getDetailPage(newAnnId,annoId)}},isPermitPrevAndNextButton:function(relObj,ind){var left=Layout.Page.container.find(".PI_alft"),right=Layout.Page.container.find(".PI_argt");left.removeClass("DNI"),right.removeClass("DNI"),Announcement.ISLIST_PAGE_INITIALISED?(0===ind&&left.addClass("DNI"),ind+1===relObj.length&&right.addClass("DNI")):(left.addClass("DNI"),right.addClass("DNI"))},getDataAdminAllLoctions:function(){if(isOperationalRoleAdmin&&null!=operationalRoleAdminDetails&&operationalRoleAdminDetails.length>0)for(var i=0;i<operationalRoleAdminDetails.length;i++){var tempObj=operationalRoleAdminDetails[i];if(void 0===tempObj.Department&&void 0!==tempObj.Location)return tempObj.Location}},isEmpty:function(value){if(void 0===value||null===value)return!0;if("object"==jQuery.type(value)){if(jQuery.isEmptyObject(value))return!0}else if(""===value.trim()||"-Select-"===value.trim()||"-"===value.trim())return!0;return!1}},Announcement.Dashboard={getAnnouncementList:function(){if("undefined"!=typeof ZPDashboard){Announcement.getLocationsAndCategories();ZPeople.Request.send(ZPDashboard.Widget.URL+"getWidget",{widget:"ANNOUNCEMENTS"},ZPDashboard.Widget.construct)}}},Announcement.Template={Modal:void 0,isTemplateAvail:!1,ANN_TEMPLATE:"",TEMPLATEID:void 0,showHideannCustemp:function(Obj){Layout.Page.container.find("#zpann_notifyall").is(":checked")||Layout.Page.container.find("#zpann_notifylocemp").is(":checked")?Layout.Page.container.find("#ann_cus_mailtemp").show():Layout.Page.container.find("#ann_cus_mailtemp").hide()},getAnnouncementTemplate:function(){(isadmin||isAnnAdmin)&&(Announcement.Template.isTemplateAvail?Announcement.Template.constructModal():Layout.PageUtil.loadFiles(["mailtemplatev5.min.js"],function(){ZPeople.Request.send(Announcement.REQUEST_URL,{mode:"GET_ANNTEMPLATES"},function(data){200===data.code&&data.template?(Announcement.Template.isTemplateAvail=!0,$.each(data.template,function(i,obj){Announcement.Template.ANN_TEMPLATE=obj,Announcement.Template.TEMPLATEID=i})):Announcement.Template.isTemplateAvail=!1,Announcement.Template.constructModal()})}))},constructModal:function(){if(Announcement.Template.Modal=Layout.Page.container.find("#announcementMailTemplate"),0==Announcement.Template.Modal.length){var annTemplateModal='<div id="announcementMailTemplate"  class="zpl_mdl zpl_mopen"><div class="zpl_minr">';annTemplateModal+='<div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.mailtemplate")+'</h4></div><a class="_cls PI_cls" onclick="Announcement.Template.hideMailTemplate();"> </a></div>',annTemplateModal+='<div class="zpl_mcnt zpl_fm"><form class="form-horizontal pad"><div id="msgTemplate" style="display:none"></div>\t<div class="zpl_crd" id="ma_message"><div class="zpl_crdcnt"><div class="zpl_secn"><div><div class="zpl_msgedtr" id="msgEditor"></div></div></div></div></div></form></div>',annTemplateModal+='<div class="zpl_mfoter"><button type="button" class="zlabel zlabel--blue zlabel--medium zbutton zbutton--medium zbutton--primary" onclick="Announcement.Template.saveMailTemplate(this);">'+ZPI18N.getString("zp.save")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Announcement.Template.hideMailTemplate();">'+ZPI18N.getString("zp.cancel")+"</button></div>",annTemplateModal+="</div></div>",Layout.Page.container.append(annTemplateModal),Announcement.Template.Modal=Layout.Page.container.find("#announcementMailTemplate");var defaultVal="";defaultVal=Announcement.Template.isTemplateAvail?Announcement.Template.ANN_TEMPLATE:Announcement.Template.getDefaultMailTemplate(),Announcement.Template.Modal.find("#msgTemplate").html('<div class="row"><div class="msgpreview-outer"><div class="msgpreview clearfix"><div id="tempViewCont" class="P10">'+defaultVal+"</div></div></div></div>");var content=Announcement.Template.Modal.find("#tempViewCont").html();ZPA_Editor.initiateEditor("announcementMailTemplate",void 0,content)}else Announcement.Template.Modal.find("#msgTemplate").html('<div class="row"><div class="msgpreview-outer"><div class="msgpreview clearfix"><div id="tempViewCont" class="P10">'+defaultVal+"</div></div></div></div>")},getDefaultMailTemplate:function(){for(var logoCnt="",i=0;i<176;i++)logoCnt+="&nbsp;";return(logoCnt+="${Company_Logo}<br><br>")+"<br><br><h3>${Announcement_Subject}</h3><br><br>${Announcement_Message}<br><br><span>${Announcement_Locations}</span><br><br><span>${Announcement_ExpiryDate}</span><br>"},hideMailTemplate:function(){Announcement.Template.Modal.remove()},getAnnouncementSysFields:function(){var fieldObj={System_Fields:{},System_Fields:{System_Fields:{}}},sysFields=fieldObj.System_Fields;return sysFields.System_Fields.Company_Logo=ZPI18N.getString("zp.companylogo"),sysFields.System_Fields.Announcement_Subject=Announcement.TABDISPNAME+" "+ZPI18N.getString("zp.subject"),sysFields.System_Fields.Announcement_Message=Announcement.TABDISPNAME+" "+ZPI18N.getString("zp.message"),sysFields.System_Fields.Announcement_Categories=Announcement.TABDISPNAME+" "+ZPI18N.getString("zp.categories"),sysFields.System_Fields.Announcement_Locations=Announcement.TABDISPNAME+" "+ZPI18N.getString("zp.locations"),sysFields.System_Fields.Announcement_ExpiryDate=Announcement.TABDISPNAME+" "+ZPI18N.getString("zp.expirydate"),sysFields.System_Fields.Announcement_Link=Announcement.TABDISPNAME+" "+ZPI18N.getString("zp.linkurl"),fieldObj},saveMailTemplate:function(obj){if(isadmin||isAnnAdmin){var temp_parent=$(obj).closest("#announcementMailTemplate");temp_parent.find(".btn-primary").attr("disabled",!0);var temphtml=editor.getContent();if("<div><br></div>"===temphtml)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.abstemplateempty"));var params={mode:"SAVE_ANNTEMPLATE",temphtml:temphtml};void 0!==Announcement.Template.TEMPLATEID&&(params.id=Announcement.Template.TEMPLATEID),ZPeople.Request.send(Announcement.REQUEST_URL,params,function(data){200===data.code&&data.template?(Announcement.Template.isTemplateAvail=!0,Announcement.Template.ANN_TEMPLATE=data.template,Announcement.Template.TEMPLATEID=data.templateId,Announcement.Template.constructModal()):isTemplateAvail=!1,temp_parent.find(".btn-primary").attr("disabled",!1),Announcement.Template.hideMailTemplate()})}},resetTemplate:function(){(isadmin||isAnnAdmin)&&Announcement.Template.isTemplateAvail&&ZPeople.Request.send(Announcement.REQUEST_URL,{mode:"RESET_ANNTEMPLATE"},function(data){200==data.code&&(Announcement.Template.isTemplateAvail=!1,Announcement.Template.ANN_TEMPLATE="",Announcement.Template.TEMPLATEID=void 0,Announcement.Template.constructModal())})}},Announcement.Schedule={scheduleAnnouncement:function(){var scheduleTime=Layout.Page.container.find("#zpann_scheduletime").val();if((scheduleTime=expiryDate.trim()).length>0){if(!Announcement.Util.validateDate(scheduleTime))return void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.expirydateerrmsg",[ZPI18N.getString("zp.schedule")]));Announcement.addAnnouncement(!0,scheduleTime)}}},Announcement.Draft={saveAsDraft:function(){Announcement.addAnnouncement(!0)}},Announcement.Preview={sendContentForPreview:function(){var subObj=Layout.Page.container.find("#zp_ann_subjectbox"),annoSubj=subObj.val(),error=void 0;if(""===(annoSubj=annoSubj.trim())?error=ZPI18N.getString("zp.subjectemptymsg"):annoSubj.length>100&&(error=ZPI18N.getString("zp.subjectlenghtmsg")),error)return ZPeople.Message.showWarningMsg(error),addBtn.find("#loader").remove(),addBtn.attr("disabled",!1),void subObj.trigger("focus");var message=Announcement.EDITOR.getContent();message=ZPFeeds.getSmileysAndMentions(message,"true"),message=ZPFeeds.removeTrailingEmptyDivs(message),message=ZPFeeds.getAndChangeVideoTag(message);var messageText=ZPFeeds.getTextContent(message);if(0===messageText.length&&0===$("<div>").append(message).find("img").length&&0===$("<div>").append(message).find("inlinevideo").length?error=ZPI18N.getString("zp.emptymessage"):messageText.length>5e4&&(error=ZPI18N.getString("zp.lengthofmessage")),error)return ZPeople.Message.showWarningMsg(error),addBtn.find("#loader").remove(),void addBtn.attr("disabled",!1);var params={mode:"PREVIEW_ANNOUNCEMENT",subject:annoSubj,message:message,messageText:messageText};ZPeople.Request.send(Announcement.REQUEST_URL,params,Announcement.Preview.handlePreviewResponse)},handlePreviewResponse:function(data){if(data&&200==data.code){var modalObj=Layout.Page.container.find("#MediumView");if(modalObj.length>0&&(Layout.Page.container.find("#MediumView").remove(),$("body").find("#ann_view_backdrop").remove()),0===modalObj.length){var outerHtml='<div class="zp_mdl mdl_Rgt mdl_Rgt-Md Ann_Viewpop " id="MediumView" tabindex="0" aria-hidden="false" style="display: block;z-index:1032 !important;"><div class="zp_mdl-dlg"><i class="IC-ar-rgt-1 Ann_switch DN" onclick="Announcement.Util.movePrevAndNextAnnouncements(true)"></i><i class="IC-ar-lft-1 Ann_switch DN" onclick="Announcement.Util.movePrevAndNextAnnouncements(false)"></i><div class="zp_mdl-cnt">';outerHtml+='<div class="zp_mdl-hdr"><span class="ann_fv CR-fullview" onclick="Announcement.Util.toggleFullHalfAnnouncement()" ></span><span class="ann_mv CR-miniview DN" onclick="Announcement.Util.toggleFullHalfAnnouncement()" ></span>',outerHtml+='<a class="Ann_editorCls IC-cls" id="MediumClose" onclick="Announcement.Preview.close()" aria-label="Close" data-dismiss="modal"></a>',outerHtml+='<div class="zp_edtr-Hdr clearfix">',outerHtml+='<div class="zp_edtr-HdrInnr clearfix" id="animate_cont">',outerHtml+=Announcement.Construction.constructAnimateContent(),outerHtml+='<div class="Hdr_Lft "><a class="avatarMdm" id="owner_thumb" ></a><div class="Usr_dtls clearfix" id="owner_name"></div></div>',outerHtml+="</div>",outerHtml+="</div>",outerHtml+="</div>",outerHtml+="</div>",outerHtml+="</div>",outerHtml+='<div class="zp_mdl-bdy Nomdlfoot DN">',outerHtml+='<div class="cont-wrp" id="detailed_view_holder">'+Announcement.Construction.constructInnerViewPage(),outerHtml+="</div></div></div></div></div></div>",Layout.Page.container.append(outerHtml),(modalObj=Layout.Page.container.find("#MediumView")).find("#anno_detail").find("#zp_page_loading").length>0&&modalObj.find("#anno_detail").find("#zp_page_loading").remove(),modalObj.find("#zpann_subject_detail").append(data.subject);var empRow=ZPeople.getUserDetailsById(data.owner);modalObj.find("#owner_name").html('<a class="Usr_name" href="#home/dashboard/profile-userId:'+empRow.usererec+'">'+empRow.name+'</a><div class="Usr_pstDT">'+ZPDateTime.getDateDisplayFormat(data.publishDate)+"</div>"),modalObj.find("#owner_thumb").html('<img src="'+empRow.thumb+'" class="media-object Usrimg">');var dataCom=ZPFeeds.getVideoTags(data.message,data.announcementId,People.Announcement.type);dataCom=ZPFeeds.Activity.validateContent(dataCom,void 0,void 0,void 0,void 0,!0),dataCom=ZPFeeds.Activity.getImgAndCBoxClass(dataCom,data.announcementId),modalObj.find("#zpann_message_detail").append(dataCom),$("body").addClass("Ann_ViewCon"),setTimeout(function(){modalObj.addClass("in"),$("body").append('<div class="modal-backdrop in" id="ann_view_backdrop"></div>')},300),modalObj.find("#animate_cont").find(".Hdr_Lft").removeClass("DN"),modalObj.find("#animate_cont").find(".Hdr_Rgt").removeClass("DN"),modalObj.find(".zp_mdl-bdy").removeClass("DN"),modalObj.find("#animate_cont").find("#loading_animate").remove()}}},close:function(){Layout.Page.container.find("#MediumView").removeClass("in"),$("body").find("#ann_view_backdrop").remove(),$("body").toggleClass("Ann_ViewCon"),Layout.Page.container.find(".CR-miniview").removeClass("DNI"),Layout.Page.container.find("#MediumView").remove()}},Announcement.Component={dropDownMenu:function(menuObect){(comp=ZPeopleComponents.menu($("#"+menuObect.menuId)))&&(comp.destroy(),$("#"+menuObect.menuId).remove());let menu=$('<div id="'+menuObect.menuId+'"></div>');var comp;(comp=ZPeopleComponents.menu($("#"+menuObect.menuId)))&&comp.destroy();let options={hide:(event,data)=>{$(data.forElement).removeClass("zpl_act")},show:(event,data)=>{$(data.forElement).addClass("zpl_act")},forElement:$("#"+menuObect.forElementId),contentType:"icon-text",className:"zpl_drpdwn",itemclick:menuObect.callback(),appendTo:menuObect.parentId};$("body").append(menu);var menuList=ZPeopleComponents.menu($("#"+menuObect.menuId),options);menuObect.option.forEach(function(menuOption,indx){menuList.addMenuItem(menuOption)})}},Announcement.dragOverAttachments=function(event,isPost){var inpObj;var dragObj=Layout.Page.container.find("#ann_Editor"),appndObj=dragObj.find("#trag_attachment");ZPFeeds.Attachment.createInput(!isPost,"ann_Editor",!0),(inpObj=dragObj.find("#zp_dash_attachments").find("input:last").clone()).removeClass("DN");var dragLayer=$('<div class="ZPDrfile zpl_fupld-dragholder" id="ZP_DragDropLayer"><div><i class="IC-file1x"></i><span>'+ZPI18N.getString("zp.dropfiletoattach")+"</span></div></div>");0===dragObj.find("#ZP_DragDropLayer").length&&(parseInt(dragObj.find("#zp_dash_attachments").attr("attachcnt"))+1<=10?($(inpObj).on("change",function(){$(this).addClass("DN"),ZPFeeds.Attachment.onDragFileSelect(this,isPost,"ann_Editor")}),dragLayer.on("dragleave",function(){ZPFeeds.Attachment.dragLeaveAttachments(isPost,"ann_Editor",dragObj)}),dragLayer.append(inpObj),appndObj.append(dragLayer)):ZPFeeds.Attachment.onFileSelect())};var ZPFeeds={};(ZPFeeds={URL:"/feedActions.zp",SINGLEPOP:!1,POPUP_INTERVAL:null,HIDE_DETAIL_POPUP:!0,POSTEDITOR:null,FEEDS_POSTEDITOR:{},COMMENTEDITOR:null,MENTION_DATA:{},ISPROCESS_FINISH:!0,SEARCH_KEY:void 0,INITIALIZED:!1,CURRENTWALL:void 0,CURRENT_EDITOR:null,ISMODALEDITOROBJ:null,LOADER_IMG:'<div class="zp-fd-box zp-fd-loading" id="zp_page_loading"> <div class="zp-fd-animate"> <div class="zp-fd-mask h-round"></div> <div class="zp-fd-mask h-top"></div> <div class="zp-fd-mask h-left"></div> <div class="zp-fd-mask h-right"></div> <div class="zp-fd-mask h-bottom"></div> <div class="zp-fd-mask sh-left"></div> <div class="zp-fd-mask sh-right"></div> <div class="zp-fd-mask sh-bottom"></div> <div class="zp-fd-mask cont-top"></div> <div class="zp-fd-mask cont-first-end"></div> <div class="zp-fd-mask cont-second-line"></div> <div class="zp-fd-mask cont-second-end"></div> <div class="zp-fd-mask cont-third-line"></div> <div class="zp-fd-mask cont-third-end"></div> </div> </div>',MINILOADER:'<i id="loader" class="zbutton__icon zbutton--loader "><svg class="zbutton__svg zbutton__loader zeffects--rotate" width="100%" height="100%"> <circle class="circle__track" cx="8px" cy="8px" r="8px"></circle> <circle class="circle__load" cx="8px" cy="8px" r="8px"></circle> </svg></i>',FEEDS_FILTER_ARR:["ALL","Status","Announcement","Approval","MailAlert"],FEEDS_FILTER_OBJ:{ALL:"zp.all",Status:"zp.status",Announcement:"zp.announcement",Approval:"zp.approvals",HrCase:"zp.cases",Feedback:"zp.feedback",JobSchedule:"zp.jobschedule",AddSchedule:"zp.jobs",MailAlert:"zp.mailalert",FileCabinet:"zp.files",Holiday:"zp.holidays",Shift:"zp.shifts",Leave:"zp.leave",Survey:"zp.survey.feed.filter.name"},GROUPS_DETS_ARR:[],DEPTS_DETS_ARR:[],LoadFiles:["compensation.common.min.js","fileshome.min.js","onduty.min.js","permission.min.js","empShiftMapping.min.js","shiftRequest.min.js","regularization.min.js","groupsv5.min.js","casesv5.min.js","casesfiles.min.js","ee_operation.min.js"],uploadCallBack:function(uploadedFileInfo,currentFileObj){var fileInfo=uploadedFileInfo.fileInfo;if(0!=Object.keys(fileInfo).length&&0!=Object.keys(currentFileObj).length){if("ann_Editor"!==currentFileObj.containerId&&0==$(currentFileObj.formObj).find("#zp_dash_attachments").find("[fileCode='"+fileInfo.fileCode+"']").length)return;var progressDiv=$(currentFileObj.formObj).find("#zp_dash_attachments").find("[data-progressjs='"+fileInfo.fileCode+"']");0!=progressDiv.length&&(progressJs("div[data-progressjs='"+fileInfo.fileCode+"']").end(),progressDiv.parent().removeClass(),progressDiv.parent().addClass("zpfilepro"),progressDiv[0].style.width="100%");var file=currentFileObj.file;if(ZPUtil.isAllowedFormatForImage(file.name)){var reader=new FileReader;reader.onload=function(event){var dataUri=event.target.result;"ann_Editor"===currentFileObj.containerId?Announcement.Attachments.getAddPreviewForAttachment(currentFileObj.formObj,file,currentFileObj.isPost,currentFileObj.input,dataUri):($(currentFileObj.formObj).find("#zp_dash_attachments").find("[fileCode='"+fileInfo.fileCode+"']").remove(),ZPFeeds.Attachment.getPreviewForAttachment(currentFileObj.formObj,file,currentFileObj.isPost,currentFileObj.input,dataUri))},reader.onerror=function(event){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.filecouldnotberead"))},reader.readAsDataURL(file)}else"ann_Editor"===currentFileObj.containerId?Announcement.Attachments.getAddPreviewForAttachment(currentFileObj.formObj,file,currentFileObj.isPost,currentFileObj.input,void 0):($(currentFileObj.formObj).find("#zp_dash_attachments").find("[fileCode='"+fileInfo.fileCode+"']").remove(),ZPFeeds.Attachment.getPreviewForAttachment(currentFileObj.formObj,file,currentFileObj.isPost,currentFileObj.input,void 0));$(currentFileObj.input).attr("udsfileId",fileInfo.fileId)}else if("Failure"==uploadedFileInfo.status){var antivirus=!1,error=!1;"Virus Found"==uploadedFileInfo.message?antivirus=!0:"An error occured in the File Transfer"==uploadedFileInfo.message&&(error=!0),ZPFeeds.failureCallBack(fileInfo,antivirus,error,currentFileObj)}},failureCallBack:function(fileInfo,antivirus,error,currentFileObj){var errMsg=ZPI18N.getString("zp.reuploadfile");if(antivirus?errMsg=ZPI18N.getString("zp.virusfile"):error&&(errMsg=ZPI18N.getString("zp.fileuploaderror")),ZPeople.Message.showWarningMsg(errMsg),0!=Object.keys(currentFileObj).length&&"ann_Editor"!==currentFileObj.containerId){var dashAttachCont=$(currentFileObj.formObj).find("#zp_dash_attachments");void 0!==fileInfo?dashAttachCont.find("[fileCode='"+fileInfo.fileCode+"']").remove():dashAttachCont.find("#fd_loadtemplate").remove(),$(currentFileObj.input).remove(),0==dashAttachCont.find("[type=file]").length&&(dashAttachCont.addClass("DN"),dashAttachCont.addClass("DN").attr("attachcnt",0),dashAttachCont.attr("removedinp",0))}},checkAndInitFeeds:function(){0==$("#home-feeds").length&&(null==ZPeople.CURRENT_VIEWKEY&&(ZPeople.CURRENT_VIEWKEY=ZPeople.VIEWKEYS.ALL),AcsApi.initStream("People",ZPeople.CURRENT_VIEWKEY,10))},getLoaderImage:function(count){var loader="";if(void 0!==count&&count>0)for(var i=0;i<count;i++)loader+=ZPFeeds.LOADER_IMG;else loader=ZPFeeds.LOADER_IMG;return loader},triggerScrollDuty:function(){if("allFeeds"===ZPFeeds.getFeedType()){var h=Layout.Page.container.find(".Scrcont").find("#zp_dash_feedspost_container").find("#editor_container").length>0?240:110;Layout.Page.container.find(".Scrcont").scrollTop()>h?(Layout.Page.container.find(".Scrcont").addClass("zp-fd-scroll-fxdhd"),0==Layout.Page.container.find("#zp_feeds_views").find("#zp_gototop").length&&Layout.Page.container.find("#zp_feeds_views").append($('<div class="scrltop CP" id="zp_gototop" data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.backtotop")+'"></div>').on("click",function(){ZPFeeds.gotoTop()}))):(Layout.Page.container.find(".Scrcont").removeClass("zp-fd-scroll-fxdhd"),Layout.Page.container.find("#zp_feeds_views").find("#zp_gototop").remove())}},gotoTop:function(){Layout.Page.container.find("#zp_feeds_views").find("#zp_gototop").tooltip("destroy"),Layout.Page.container.find(".Scrcont").animate({scrollTop:0},500)},feedsSharedViewSubscription:function(mode,id,erecno){if(!0===isadmin&&void 0!==id&&void 0!==erecno&&void 0!==mode){var params={erecno:erecno,actionType:"FEEDS_SUBSCRIPTION"};"ZUID"===mode?params.zuid=id:"ZSOID"===mode&&(params.zsoid=id),params.mode=mode,ZPeople.Request.send("/feedActions.zp",params)}else ZPeople.Request.send("/feedActions.zp",{})},getNameByIdInArray:function(list,key){if(void 0!=list)return list[key]},get:function(viewKey){ZPFeeds.isFilter&&(viewKey=ZPeople.CURRENT_VIEWKEY),ZPFeeds.isFilter=!1,Layout.Page.container.find("#zp_dash_feedspost_container").removeClass("DN"),Layout.Page.container.find(".grpList").addClass("DN"),$("body").removeClass("zp_AnnWindw"),Layout.Page.container.find("#zp_annEditor_outercont").remove();var isSingleFeed=!1;ZPFeeds.POSTEDITOR=ZPFeeds.FEEDS_POSTEDITOR[window.location.hash.slice(1)],void 0!==Layout.Page.urlparam["feeds-view"]?(isSingleFeed=!0,ZPFeeds.Activity.viewSingleFeed(Layout.Page.urlparam["feeds-view"]),Layout.Page.container.find("#zp_postTextarea").attr("placeholder",ZPI18N.getString("zp.typeattomention",[""]))):"group"===ZPFeeds.getFeedType()?(ZPeople.CURRENT_VIEWKEY=ZPeople.Module.getData().keys[Layout.Page.urlparam.group],ZPFeeds.CURRENTWALL=Layout.Page.urlparam.group,Layout.Page.container.find("#zp_postTextarea").attr("placeholder",ZPI18N.getString("zp.typeattomention",[""])),ZPFeeds.Groups.appendGrpDets(ZPFeeds.CURRENTWALL)):-1!=Layout.Page.hash.indexOf("projectdashboard/feeds")?(ZPeople.CURRENT_VIEWKEY=Timetracker.projectDashboard.projectDtls.projectFeedsKey,ZPFeeds.CURRENTWALL=Layout.Page.urlparam.id,Layout.Page.container.find("#zp_postTextarea").attr("placeholder",ZPI18N.getString("zp.typeattomention",[""]))):"department"===ZPFeeds.getFeedType()?(ZPFeeds.CURRENTWALL=_LOGGEDIN_DEPID,ZPeople.CURRENT_VIEWKEY=ZPeople.Module.getData().keys.department,Layout.Page.container.find("#zp_postTextarea").attr("placeholder",ZPI18N.getString("zp.writeamsgtodept"))):"home/feeds/announcements"===Layout.Page.currentmode?(isAnnAdmin||Layout.Page.container.find("#zp_dash_feedspost_container").addClass("DN"),Layout.Page.container.find("#zp_postTextarea").attr("placeholder",ZPI18N.getString("zp.addannounceplchdr",[ZPeople.decodeTxt(Announcement.TABDISPNAME)])),ZPFeeds.CURRENTWALL=erecno,ZPeople.CURRENT_VIEWKEY=ZPeople.Module.getData().keys.announcements):ZPUtil.Validation.isEmpty(viewKey)&&(ZPeople.CURRENT_VIEWKEY=ZPeople.VIEWKEYS.ALL,ZPFeeds.CURRENTWALL=erecno,Layout.Page.container.find(".zp-fd-scroll").find("#zp_feeds_filters").length>0&&(Layout.Page.container.find("#zp_feeds_filters").find("li").removeClass("active"),Layout.Page.container.find("#zp_feeds_filters").find("li[ftype='ALL']").addClass("active")),Layout.Page.container.find("#zp_postTextarea").attr("placeholder",ZPI18N.getString("zp.typeattomention",[""]))),ZPFeeds.POSTEDITOR&&null!=ZPFeeds.POSTEDITOR&&$(ZPFeeds.POSTEDITOR.editordiv).find(".Zp-fd-plchldr").attr("data-text",Layout.Page.container.find("#zp_postTextarea").attr("placeholder")),Layout.Page.container.find("#zp_postTextarea").data("needWallChange")&&ZPFeeds.changeFeedsPostedWall(),ZPFeeds.showHideFeedFilters(),isAnnAdmin&&ZPFeeds.Announcements.addRemoveAnnBody(),0==Layout.Page.container.find(".zp-fd-scroll").find("#zp_feeds_filters").length&&(ZPFeeds.constructFeedFilters(),Layout.Page.container.find("#zp_feeds_filters").find("li[ftype='ALL']").addClass("active")),Layout.Page.container.find(".Scrcont").removeClass("zp-fd-scroll-fxdhd"),Layout.Page.container.find("[scroll=enabled]").on("scroll",function(){ZPFeeds.triggerScrollDuty()}),ZPFeeds.Like.FEEDSLOADED=!1,Layout.Page.container.find("#zp_feeds_views").html($('<div class="ZPwf MB15" id="'+ZPeople.CURRENT_VIEWKEY+'">'+ZPFeeds.getLoaderImage(2)+"</div>")),ZPUtil.Validation.isEmpty(ZPeople.CURRENT_VIEWKEY)||0!=isSingleFeed||(AcsApi.initStream("People",ZPeople.CURRENT_VIEWKEY,10),ZPeople.Request.send("/feedActions.zp",{viewKey:ZPeople.CURRENT_VIEWKEY,count:10,actionType:"GET_LIKED_USERS",isActivity:0},ZPFeeds.Like.handleGetLikedUsersResponse)),$(document).off("click.grpHeader").on("click.grpHeader",'[fieldType="grpHeader"]',function(){Group.editUsers($(this).attr("grpId"))})},changeFeedsPostedWall:function(){Layout.Page.currentmode===ZPFeeds.getFeedsMode()&&Layout.Page.container.find("#zp_postTextarea").length>0?Layout.Page.container.find("#zp_postTextarea").data("postWall",erecno):Layout.Page.container.find("#zp_postTextarea").length>0&&Layout.Page.container.find("#zp_postTextarea").data("postWall",ZPFeeds.CURRENTWALL)},showHideFeedFilters:function(){Layout.Page.currentmode===ZPFeeds.getFeedsMode()?Layout.Page.container.find(".zp-fd-allcat-con").removeClass("DN"):Layout.Page.container.find(".zp-fd-allcat-con").addClass("DN")},getAndChangeVideoTag:function(message){var statuscontent=message,tempDiv=$("<div></div>");tempDiv=tempDiv.html(message);var matchContent=$(tempDiv).find("[embedvideo=true]");if(void 0!==matchContent[0])for(i=0;i<matchContent.length;i++){var searchStr=matchContent[i].outerHTML,replaceStr="<inlinevideo ",obj=$(matchContent[i].attributes);for(k=0;k<obj.length;k++){var temp=obj[k];"mode"==temp.nodeName||"accesskey"==temp.nodeName||"width"==temp.nodeName||"height"==temp.nodeName?replaceStr+=" "+temp.nodeName+'="'+temp.nodeValue+'"':"src"==temp.nodeName&&(replaceStr+=' href="'+temp.nodeValue+'"')}void 0!==(replaceStr+="></inlinevideo>")&&(statuscontent=statuscontent.replace(searchStr,replaceStr))}return statuscontent},getRawVideoTags:function(message,activityId,actType){var statuscontent=message,tempDiv=$("<div></div>");tempDiv=tempDiv.html(message);var matchContent=$(tempDiv).find("inlinevideo");if(void 0!==matchContent[0])for(i=0;i<matchContent.length;i++){var accesskey,searchStr=matchContent[i].outerHTML,isurlmode=!1,obj=$(matchContent[i].attributes);for(j=0;j<obj.length;j++){"mode"==(temp=obj[j]).nodeName&&"urlmode"==temp.nodeValue?isurlmode=!0:"accesskey"==temp.nodeName&&(accesskey=temp.nodeValue)}var replaceStr=isurlmode?"<iframe embedvideo='true' frameborder='0' allowfullscreen='' ":'<video embedvideo="true" controls ';for(k=0;k<obj.length;k++){var temp;"width"!=(temp=obj[k]).nodeName&&"height"!=temp.nodeName&&"href"!=temp.nodeName&&"accesskey"!=temp.nodeName&&"mode"!=temp.nodeName||("href"==temp.nodeName?replaceStr+=' src="'+(isurlmode?temp.nodeValue:ZPFeeds.constructUDSDownloadUrl(accesskey,activityId,actType))+'"':replaceStr+=" "+temp.nodeName+'="'+temp.nodeValue+'"')}void 0!==(replaceStr+=isurlmode?"></iframe>":"></video>")&&(statuscontent=statuscontent.replace(searchStr,replaceStr))}return statuscontent},getVideoTags:function(message,activityId,actType){var statuscontent=message,tempDiv=$("<div></div>");tempDiv=tempDiv.html(message);var matchContent=$(tempDiv).find("inlinevideo");if(void 0!==matchContent[0])for(i=0;i<matchContent.length;i++){var accesskey,searchStr=matchContent[i].outerHTML,isurlmode=!1,obj=$(matchContent[i].attributes);for(j=0;j<obj.length;j++){"mode"==(temp=obj[j]).nodeName&&"urlmode"==temp.nodeValue?isurlmode=!0:"accesskey"==temp.nodeName&&(accesskey=temp.nodeValue)}var replaceStr='<div class="zp_annVid zp_annVidWH" onclick="ZPFeeds.showEmbedVideo(this, \''+isurlmode+"')\" ",iframe=isurlmode?"<iframe id='extraframe' style='width: 100% !important;"+("announcements"===ZPTabs.currMainTab?"height:360px !important;":"height:300px !important;")+"' class='zp_annVidWH DNI' frameborder='0' allowfullscreen='' ":'<video preload="metadata" controls style="width: 100% !important;'+("announcements"===ZPTabs.currMainTab?"height:360px !important;":"height:300px !important;")+'"',bkground="";for(k=0;k<obj.length;k++){var temp;"width"!=(temp=obj[k]).nodeName&&"height"!=temp.nodeName&&"href"!=temp.nodeName&&"accesskey"!=temp.nodeName&&"mode"!=temp.nodeName||("href"==temp.nodeName?iframe+=isurlmode?' src="'+temp.nodeValue+'"':' src="'+ZPFeeds.constructUDSDownloadUrl(accesskey,activityId,actType)+'"':isurlmode&&"accesskey"==temp.nodeName?bkground="background-image: url('"+temp.nodeValue+"');":"width"==temp.nodeName||"height"==temp.nodeName?replaceStr+=" "+temp.nodeName+'="'+temp.nodeValue+'"':(iframe+=" "+temp.nodeName+'="'+temp.nodeValue+'"',replaceStr+=" "+temp.nodeName+'="'+temp.nodeValue+'"'))}void 0!==(replaceStr+='  style="'+bkground+";width: 100% !important;"+("announcements"===ZPTabs.currMainTab?"height:360px !important;":"height:300px !important;")+'"><div class="zp_ann-vdicn" style="z-index:1"> <i class="IC-getstart"></i></div>'+iframe+" "+(isurlmode?'"></iframe>':"></video>")+"</div>")&&(statuscontent=statuscontent.replace(searchStr,replaceStr))}return statuscontent},constructUDSDownloadUrl:function(key,activityId,actType,isadd){var downloadurl;if(UDS_UPLOAD_IS_ACTIVE){var currentTime=(new Date).getTime(),eventid=_LOGGEDIN_ZUID+"_"+currentTime,obj={fileId:key,portalId:_LOGGEDIN_ACCZSOID,extraDtls:{fileId:key,actId:activityId,actType:actType,isadd:isadd},mode:"Feeds"};downloadurl=UDS_DOWNLOAD_URL+"/webdownload?x-service="+UDS_DOWNLOAD_SERVICE_CODE+"&event-id="+eventid+"&x-cli-msg="+encodeURIComponent(JSON.stringify(obj))}else downloadurl="/downloadAttachment?",downloadurl+=isadd?"recId="+erecno+"&isadd=true&downloadId="+key:"recId="+activityId+"&downloadId="+key+"&acttype="+actType+"&type=true";return downloadurl},showEmbedVideo:function(obj,isurlmode){var iframe;if((iframe="true"==isurlmode?$(obj).find("iframe"):$(obj).find("video")).length>0){$(obj).find(".zp_ann-vdicn").remove();var src=iframe.attr("src");iframe.removeClass("DNI"),"true"==isurlmode?(src+="&autoplay=true",iframe.attr("allow","autoplay")):iframe.attr("autoplay",!0),iframe.attr("src",src)}$(obj).find(".zp_ann-vdicn").remove()},getSmileysAndMentions:function(statusmsg,isMentions){var matchContent,statuscontent=statusmsg,isSmileysParse=!1,tempDiv=$("<div></div>");if(tempDiv=tempDiv.html(statusmsg),"true"===isMentions?matchContent=$(tempDiv).find("a[name='mentions']"):(isSmileysParse=!0,matchContent=$(tempDiv).find("img[id='smileys']")),void 0!==matchContent[0])for(i=0;i<matchContent.length;i++){var replaceStr,searchStr=matchContent[i].outerHTML;void 0!==(replaceStr="true"===isMentions?$(matchContent[i]).attr("href"):$(matchContent[i]).attr("name"))&&(statuscontent=statuscontent.replace(searchStr,replaceStr))}return isSmileysParse||(statuscontent=ZPFeeds.getSmileysAndMentions(statuscontent,"false")),statuscontent},removeTrailingEmptyDivs:function(content){for(var tempDiv=$("<div></div>"),divCnt=(tempDiv=tempDiv.html(content)).find("div").length;divCnt>1;divCnt--)if(void 0!==$(tempDiv).find("div")[divCnt-1]){if(0!==tempDiv.find("div")[divCnt-1].innerHTML.replace("<br>","").replace("&nbsp;","").trim().length)break;tempDiv.find("div")[divCnt-1].remove()}return tempDiv[0].innerHTML},registerTextareaToEditor:function(textareaObj){textareaObj.on("click",function(){var clickObj=Layout.Page.container.find("#zp_postEditor").children("#zpEditor");if("home/feeds/announcements"!==Layout.Page.currentmode){if(textareaObj.parent("#edtCont").addClass("DNI"),0===clickObj.length){var actJson={};void 0===actJson.subBtnName&&(actJson.subBtnName="zp.feeds.post"),actJson.divId="zp_postEditor",actJson.subBtnId="submitbtn",actJson.parentCon="editor_container",actJson.isActivity=!0,actJson.isavatarnded=!0,actJson.isTitleNeeded=!0,actJson.placeholder=textareaObj.find("#zp_postTextarea").attr("placeholder"),Layout.Page.container.find("#zp_dash_feedspost_container").append(ZPFeeds.Editor.getEditorContainer(actJson)),Layout.Page.container.find("#editor_container").find("#submitbtn").on("click",function(){ZPFeeds.Activity.postStatus()}),ZPFeeds.FEEDS_POSTEDITOR[window.location.hash.slice(1)]=ZPFeeds.Editor.getEditor("zp_postEditor","Status"),ZPFeeds.POSTEDITOR=ZPFeeds.FEEDS_POSTEDITOR[window.location.hash.slice(1)],isAnnAdmin&&ZPFeeds.Announcements.addRemoveAnnBody()}else null!==ZPFeeds.POSTEDITOR?(clickObj.removeClass("DN"),ZPFeeds.POSTEDITOR=ZPFeeds.Editor.editorList.zp_postEditor):ZPFeeds.POSTEDITOR=ZPFeeds.FEEDS_POSTEDITOR[window.location.hash.slice(1)];ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.POSTEDITOR,!1),ZPFeeds.changeFeedsPostedWall()}else Announcement.Construction.constructAddOrEditAnnouncementPage(Layout.Page.hash)})},registerappendTitleCont:function(editor){$(editor.outerdiv).find(".Ann_titStatus").off("click"),$(editor.outerdiv).find(".Ann_titStatus").on("click",function(){ZPFeeds.appendTitleCont(editor)})},appendTitleCont:function(editor,isRemove){var titleIcon=$(editor.outerdiv).find(".Ann_titStatus");if(titleIcon.length>0){titleIcon.tooltip("destroy");var currhgt=$(editor.outerdiv).height();titleIcon.find("span").hasClass("zei-rem-title")||1==isRemove?($(editor.outerdiv).find(".Ann_titleCont").remove(),currhgt=currhgt-50<=150?150:currhgt-50,$(editor.outerdiv).css("cssText","height:"+currhgt+"px !important"),titleIcon.find("span").removeClass("zei-rem-title").addClass("zei-add-title"),titleIcon.attr("title",ZPI18N.getString("zp.addtitle")),ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.POSTEDITOR,!1)):(currhgt=currhgt+50>=490?490:currhgt+50,$(editor.outerdiv).css("cssText","height:"+currhgt+"px !important"),titleIcon.find("span").removeClass("zei-add-title").addClass("zei-rem-title"),titleIcon.attr("title",ZPI18N.getString("zp.removetitle")),$(editor.outerdiv).find(".Ann_titStatus").after('<div class="Ann_titleCont"> <input class="composeCont-field" id="zpfd_sts_title" type="text" tabindex="0" placeholder="'+ZPI18N.getString("zp.addtitlehere")+'" autocomplete="off">  </div>'),$(editor.outerdiv).find("#zpfd_sts_title").trigger("focus"))}},hideTextEditor:function(){Layout.Page.container.find("#zp_postEditor").animate({height:"150px"})},removeShowMore:function(Obj){var recordId=$(Obj).parents("#actOuterCont").attr("streamid");ZPFeeds.getCurrentViewContainer().find("[streamid='"+recordId+"']").length>0&&($(Obj).parents(".zp-fd-content").removeClass("zp-fd-shwmore"),$(Obj).parents(".zp-cmt-udt").removeClass("zp-fd-shwmore"),$(Obj).parents("#zpfd_msgcont").find(".zp-fd-shwlink").remove(),$(Obj).parents(".zp-cmt-udt").find(".zp-fd-shwlink").remove(),$(Obj).parents(".zp-mailcont").find(".zp-fd-shwlink").remove())},getMoreFeeds:function(){if(AcsApi.isMoreAvailable(ZPeople.CURRENT_VIEWKEY)&&void 0===Layout.Page.urlparam["feeds-view"]){var feedContainer=$("[id='"+ZPUtil.escapeSelector(ZPeople.CURRENT_VIEWKEY)+"']");0==Layout.Page.container.find("#zp_page_loading").length&&feedContainer.append(ZPeople.LOADING_HTML),ZPFeeds.Like.FEEDSLOADED=!1,AcsApi.showMore("People",ZPeople.CURRENT_VIEWKEY,5),ZPeople.Request.send("/feedActions.zp",{viewKey:ZPeople.CURRENT_VIEWKEY,count:5,actionType:"GET_LIKED_USERS",morekey:ZPFeeds.CURRENT_MOREKEY,isActivity:0},ZPFeeds.Like.handleGetLikedUsersResponse)}else ZPeople.FireScroll.reset()},toggleFeedsViewPage:function(Obj){for(var siblings=$(Obj).siblings(),cnt=0;cnt<$(Obj).siblings().length;cnt++)$(siblings[cnt]).length>0&&$(siblings[cnt]).removeClass("active");if($(Obj).length>0){$(Obj).addClass("active");var actType=$(Obj).attr("ftype");if(void 0!==ZPeople.VIEWKEYS[actType]&&ZPeople.CURRENT_VIEWKEY!==ZPeople.VIEWKEYS[actType]){var feedsViewContainer=Layout.Page.container.find("#zp_feeds_views").find("#"+ZPUtil.escapeSelector(ZPeople.CURRENT_VIEWKEY+""));feedsViewContainer.html(),feedsViewContainer.attr("id",ZPeople.VIEWKEYS[actType]),ZPeople.CURRENT_VIEWKEY=ZPeople.VIEWKEYS[actType],void 0!==Layout.Page.urlparam["feeds-view"]?(ZPFeeds.isFilter=!0,window.location.href="#"+ZPFeeds.getFeedUrl()):ZPFeeds.get(ZPeople.CURRENT_VIEWKEY),ZPeople.FireScroll.reset()}}},DELETEOBJ:null,deleteConfirm:function(type,Obj){this.DELETEOBJ=Obj;var alertDelete=new DeleteAlertMessage(ZPI18N.getString("zp.zpalert"),ZPI18N.getString("zp.deleteconfirmmessage"));alertDelete.yesButtonText=ZPI18N.getString("zp.confirm"),"activity"===type?alertDelete.setCallback(ZPFeeds.Activity.deleteActivity):alertDelete.setCallback(ZPFeeds.Comment.deleteComment),alertDelete.show()},replaceUserDetails:function(string){try{for(var matcher,re=new RegExp("zpu[[(user|erecno)]+(#|:).+?]zpu","g"),userZuidList=[],userErecList=[];null!==(matcher=re.exec(string));){var id=(matchStr=matcher[0]).substring(matchStr.indexOf(":")+1,matchStr.length-4);"user"===matchStr.substring(4,matchStr.indexOf(":"))?-1===userZuidList.indexOf(id)&&userZuidList.push(id):-1===userErecList.indexOf(id)&&userErecList.push(id)}for(var userZuidDataList=ZPeople.getUserDetailsByIds(userZuidList,!0),userErecDataList=ZPeople.getUserDetailsByIds(userErecList,!1);null!==(matcher=re.exec(string));){var matchStr,userDtl;id=(matchStr=matcher[0]).substring(matchStr.indexOf(":")+1,matchStr.length-4);userDtl="user"===matchStr.substring(4,matchStr.indexOf(":"))?ZPeople.getUserDetailsByIdInList(id,userZuidDataList):ZPeople.getUserDetailsByIdInList(id,userErecDataList),string=string.replace(matchStr,userDtl.name)}}catch(e){}return string},getCurrentEditor:function(id){return ZPFeeds.CURRENT_EDITOR=void 0===id?Layout.Page.container.find("#zp_postEditor"):ZPFeeds.getCurrentViewContainer(id).find(".composeDesc-Wrap"),ZPFeeds.CURRENT_EDITOR},getCurrentViewContainer:function(id){var feedObj;return id&&null!=ZPFeeds.ISMODALEDITOROBJ&&0!=$("body").has(ZPFeeds.ISMODALEDITOROBJ).length?feedObj=ZPFeeds.ISMODALEDITOROBJ.find("[streamid="+id+"]"):ZPFeeds.SINGLEPOP?(ZPFeeds.ISMODALEDITOROBJ=null,feedObj=$("#zpntfn_detail_modal")):void 0===id?(ZPFeeds.ISMODALEDITOROBJ=null,feedObj=Layout.Page.container.find("[id="+ZPUtil.escapeSelector(ZPeople.CURRENT_VIEWKEY)+"]")):"myspace"!=Layout.Page.pageId&&"dep_space"!=Layout.Page.pageId||-1!==Layout.Page.hash.indexOf("#home/myspace/overview-kra")?(ZPFeeds.ISMODALEDITOROBJ=null,feedObj=Layout.Page.container.find("[streamid="+id+"]")):(ZPFeeds.ISMODALEDITOROBJ=null,feedObj=Layout.Page.container.find("[id="+ZPUtil.escapeSelector(ZPeople.CURRENT_VIEWKEY)+"]").find("[streamid="+id+"]")),feedObj},showFormByEditMode:function(){ZPFeeds.viewCompleteDetailsForm("EDIT")},viewCompleteDetailsForm:function(mode,Obj){let container=Layout.Page.container;0!=$("#page-wrapper #zpntfn_modal").length&&(container=$("body #modal_Container")),"viewcompleteDtls"!=$(Obj).attr("id")&&(Obj=$(Obj).parents("#actOuterCont").find("#viewcompleteDtls"));var formId=$(Obj).find("input#formId").val();formId=void 0===formId?ZPForm.CURRFORM_PARAM.formId:formId;var recordId=$(Obj).find("input#recordId").val();recordId=void 0===recordId?ZPForm.CURRFORM_PARAM.recordId:recordId;var tableName=$(Obj).find("input#tableName").val();if("P_TimesheetList"===(tableName=void 0===tableName?ZPForm.getTableName():tableName))Layout.PageUtil.loadFiles(["timetracker5_0.1.min.js","timely.1.min.js"],()=>{Timetracker.timesheet.getTimesheetDetails(formId,recordId,!0)});else if("P_TimesheetBudget"===tableName)Timetracker.Budget.getTimeLogsOfBudget(recordId,ZPApprovals.closePopCallback);else if("P_AttendanceReg"===tableName)Layout.PageUtil.loadFiles(["regularization.min.js","timely.1.min.js"],()=>{regularization_operation.getAttendanceRegDetails(formId,recordId,Att_Common_Operations.approvalCloseCallBack),Layout.Page.container.find("#ZPAtt_Reg_Details").addClass("zpl_ntzindx")});else if("P_PermissionDetails"===tableName)Layout.PageUtil.loadFiles(["permission.min.js","timely.1.min.js"],()=>{permission.getPermissionApprovalDetails(formId,recordId,Att_Common_Operations.approvalCloseCallBack),Layout.Page.container.find("#ZPAtt_Permission_Details").addClass("zpl_ntzindx")});else if("P_ShiftMappingForm"===tableName)Layout.PageUtil.loadFiles(["shiftRequest.min.js","empShiftMapping.min.js","timely.1.min.js"],()=>{shiftRequest.getAttendanceShiftDetails(formId,recordId,Att_Common_Operations.approvalCloseCallBack),Layout.Page.container.find("#ZPAtt_Shift_Details").addClass("zpl_ntzindx")});else if("P_AutoShiftAssignForm"===tableName)Layout.PageUtil.loadFiles(["autoassignshiftRequest.min.js","empShiftMapping.min.js","timely.1.min.js"],()=>{AutoAssignShiftRequest.getAttendanceShiftDetails(formId,recordId,Att_Common_Operations.approvalCloseCallBack),Layout.Page.container.find("#ZPAtt_Auto_Assign_Shift").addClass("zpl_ntzindx")});else if("P_AttendanceOD"===tableName)Layout.PageUtil.loadFiles(["onduty.min.js","timely.1.min.js"],()=>{onduty.getAttendanceODDetails(formId,recordId,Att_Common_Operations.approvalCloseCallBack),Layout.Page.container.find("#ZPAtt_OD_Details").addClass("zpl_ntzindx")});else if("P_MultiRater_Approval"===tableName)Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>MR.Approval.showApprovalEntriesModal("feed",recordId,ApprovalList.closePopCallback));else if("P_GoalSheet"===tableName)Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>Goals.Approval.initGoalSheetApproval(recordId));else if("P_ReviewApprovalSheet"===tableName)Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>{ApprReview.Approval.constructReviewApprovalSheet(recordId),AppraisalConfig.isReviewApprover=!0});else if("P_Objectives"===tableName)Layout.PageUtil.loadFiles(["okr.com.min.js"],()=>OKRApproval.openObjectiveApproval(recordId));else if("P_KeyResult_CheckIn"===tableName)Layout.PageUtil.loadFiles(["okr.com.min.js"],()=>OKRApproval.openCheckInApproval(recordId));else if("P_ObjectiveAlign"===tableName)Layout.PageUtil.loadFiles(["okr.com.min.js"],()=>OKRApproval.openObjectiveAlignApproval(recordId));else if("P_EmployeeLeave"===tableName){(new LeaveForm).view(recordId)}else if("P_Compensatory"===tableName)LeaveCompensatory.RecordView.get(recordId);else if("P_LeaveGrant"===tableName)LeaveGrant.RecordView.get(recordId);else if("P_Budget_Splitup"===tableName)Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>BudgetReviewSheet.showReviewSheetApprovalPage("feed",recordId,ApprovalList.closePopCallback));else if(tableName===Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME)Layout.PageUtil.loadFiles(["compensation.common.min.js"],()=>{Compensation.SalRevision.Operations.showSalRevisionRecord(recordId,formId,ZPApprovals.closePopCallback)});else if("P_Resignation"===tableName)Layout.PageUtil.loadFiles(["offboarding_common.min.js","offboarding_operations.min.js","offboarding_feedback.min.js"],()=>{Offboarding.View.loadApprovalRecord(recordId)});else if("dc_EmployeePhotoChanges"===tableName)transfers.showTransferRecord({data:{transferId:formId,recordId:recordId,isProfilePic:!0}});else if(0===tableName.indexOf("dc_"))transfers.showTransferRecord({data:{transferId:formId,recordId:recordId}});else if("P_EmployeeTransfer"==tableName)TransferListView.singleRecordCallBack(recordId,!0);else{var params={formId:formId,recordId:recordId,disableUrlTrack:!0,parent:Profile.CURR_COMPONENT,isEmbed:!0};params.formMode=mode,params.editCallback=ZPFeeds.showFormByEditMode,"P_EmployeeLeave"===tableName?(params.fieldFormat=["Employee_ID","Leavetype","From","To","TeamEmailID","Reasonforleave"],params.disableSingleEdit=!0):"P_Compensatory"===tableName?(params.onloadCallback=Leave.Compensatory.loadExtraInfo,params.disableSingleEdit=!0):"P_Goals"===tableName&&(params.disableSingleEdit=!0);let form=ZP5Form._toForm(params);form.setFormContainer(container),form.init()}Layout.Page.container.find("#zp_view_record_"+formId).addClass("zpl_ntzindx")},registerDetailPopup:function(contentObj,isDashWidget){"true"!==ZPeople.isSearchAllowed||ZPFeeds.SINGLEPOP||(contentObj.onmouseenter=function(event){var Obj=contentObj;ZPFeeds.POPUPDETAIL_INTERVAL=setInterval(function(){ZPFeeds.showPopup(Obj,event,isDashWidget),ZPFeeds.handlePopupShowHide($(Obj).attr("popup"),event,"img")},500)},contentObj.onclick=function(event){null!==ZPFeeds.POPUPDETAIL_INTERVAL&&clearInterval(ZPFeeds.POPUPDETAIL_INTERVAL),ZPFeeds.hideDetailPopup(),ZPFeeds.handlePopupShowHide($(this).attr("popup"),event,"img")},contentObj.onmouseleave=function(event){null!==ZPFeeds.POPUPDETAIL_INTERVAL&&clearInterval(ZPFeeds.POPUPDETAIL_INTERVAL),ZPFeeds.hideDetailPopup(),ZPFeeds.handlePopupShowHide($(this).attr("popup"),event,"img")})},hideDetailPopup:function(){ZPFeeds.HIDE_DETAIL_POPUP&&($("body").find("#zp_feeds_popup").fadeOut(25,function(){$("body").find("#zp_feeds_popup").remove()}),clearInterval(ZPFeeds.POPUP_INTERVAL)),Layout.Page.container.find("#zp_feeds_popup").on("click",function(){$("body").find("#zp_feeds_popup").remove(),clearInterval(ZPFeeds.POPUP_INTERVAL)})},handlePopupShowHide:function(attr,event,tagType){"user"!==attr&&"group"!==attr&&"dept"!==attr&&"img"!==tagType||("mouseenter"===event.type?ZPFeeds.HIDE_DETAIL_POPUP=!1:ZPFeeds.HIDE_DETAIL_POPUP=!0)},getUserProfileSwitch:function(userDetail,module){switch(module){case"pms":return"onclick=\"PMSUserwiseSearch.redirect('"+userDetail.usererec+"','"+!0+"')\"";default:return"onclick=\"ZPeople.getUserPage('"+userDetail.usererec+"')\""}},showPopup:function(Obj,event,isDashWidget){var id,popupName=$(Obj).attr("popup"),empid=void 0,grpId=void 0,deptId=void 0,module=void 0;if("user"==popupName?(id=empid=$(Obj).attr("empid"),module=void 0!==$(Obj).attr("module")?$(Obj).attr("module"):module):"group"==popupName?id=grpId=$(Obj).attr("grpId"):"dept"==popupName&&(id=deptId=$(Obj).attr("deptId")),$("[iid='"+id+"_fdpop']").length>0&&$("[iid='"+id+"_fdpop']").remove(),!ZPUtil.Validation.isEmpty(empid)&&"-1"!==empid||!ZPUtil.Validation.isEmpty(grpId)&&"-1"!==grpId||!ZPUtil.Validation.isEmpty(deptId)&&"-1"!==deptId){var isZuid=null,userDetail=null;if("user"==popupName&&(isZuid=void 0===$(Obj).attr("isusrzuid")||!("false"==$(Obj).attr("isusrzuid")||!$(Obj).attr("isusrzuid")),userDetail=ZPFeeds.getUserDetails(empid,!1,isZuid),"true"===isDashWidget&&$(Obj).parent().hasClass("sel")||void 0===userDetail||userDetail.isDeleted))return void ZPFeeds.hideDetailPopup();var popuphtml=$('<div id="zp_feeds_popup" id="'+id+'_fdpop" class=""></div>');if("user"==popupName){let statusId="userpopup_"+userDetail.usererec;popuphtml.css("background-image","url("+userDetail.avatar+")"),popuphtml.addClass("zpl_calencrd");popuphtml.append("<div "+ZPFeeds.getUserProfileSwitch(userDetail,module)+'" class="CP"><img src="'+userDetail.avatar+'"></div><div class="zpl_dfcrd zpl_emcrd"><div class="zpl_emcrdcnt"><div class="zpl_em"><div class="zpl_emdts"><div class="CP" '+ZPFeeds.getUserProfileSwitch(userDetail,module)+"><span><em>"+userDetail.empid+"</em> - <b>"+userDetail.name+'</b></span></div><div><span id="att_status_'+statusId+'"></span><em class="zpl_dots sm DNI" id="checkInBuildingIN_Dot"></em><span class="DNI" id="checkInBuildingIN_Span"><i class="PI_building zpl_fh5 tooltip-js" id="checkInBuildingIN_Icon"></i><span class="zpl_ellipsis zpl_pl2" id="checkInBuildingIN_Label"></span></span></div></div></div><div class="zpl_emrole"><em>'+(ZPUtil.Validation.isEmpty(userDetail.designation)?"":userDetail.designation)+'</em><em class="txttrim">'+(ZPUtil.Validation.isEmpty(userDetail.deptName)?"":userDetail.deptName)+'</em><span><em class="txttrim">'+(ZPUtil.Validation.isEmpty(userDetail.email)?"":userDetail.email)+'</em><i title="'+ZPI18N.getString("zp.copymail")+'" class="PI_cpy" onclick="ZPUtil.copytoClipboard(\''+userDetail.email+"','"+ZPI18N.getString("zp.copyemailmessage")+'\')"></i></span></div></div><div class="zpl_actn_btn">'+("true"==ZPeople.isSearchAllowed?'<a title="'+ZPI18N.getString("zp.viewprofile")+'" class="zpl_btnfloat PI_eye" '+ZPFeeds.getUserProfileSwitch(userDetail,module)+"></a>":"")+(userDetail.id!==_LOGGEDIN_ZUID&&"true"==ZPeople.ISCHAT?'<a title="'+ZPI18N.getString("zp.chatsettings.chat")+'" class="zpl_btnfloat PI_chat" onclick="ZPeople.initUserChat(event,\''+userDetail.id+'\')"></a><a title="'+ZPI18N.getString("zp.chatsettings.videocall")+'" onclick="ZPeople.initUserVideoCall(event,\''+userDetail.id+'\')" class="zpl_btnfloat PI_video1"></a><a title="'+ZPI18N.getString("zp.chatsettings.audiocall")+'" onclick="ZPeople.initUserAudioCall(event,\''+userDetail.id+'\')" class="zpl_btnfloat PI_frm_phone"></a>':"")+"</div></div>");let obj=$(Obj);(new Date).getTime()-(obj.data("fetched_time")?obj.data("fetched_time"):0)>6e4?ZPeople.Request.send("/commonAction.zp",{mode:"USERSTATUS",userIds:JSON.stringify([userDetail.usererec])},function(response){response=response.attStatus[userDetail.usererec],ZPFeeds.updateStatus(response,popuphtml,statusId),obj.data("fetched_time",(new Date).getTime()),obj.data("status",response)}):ZPFeeds.updateStatus(obj.data("status"),popuphtml,statusId)}else if("group"==popupName){if($("body").find("#zp_feeds_popup").length>0)return;var grpDets=ZPFeeds.isPopupEmpDetailsFound(ZPFeeds.GROUPS_DETS_ARR,grpId);if(null==grpDets&&ZPeople.Request.sendAsyncPost(ZPFeeds.URL,{actionType:"GET_POPUP_GRPDETAILS",grpId:grpId},function(result){grpDets=result.grpDets;var obj={};obj[grpId]=grpDets,ZPFeeds.GROUPS_DETS_ARR.push(obj)}),void 0==grpDets||null==grpDets)return;popuphtml.addClass("zp-cpro");let groupPopup='<div class="zp-cpro-img"> <div class="zp-cpro-imgfilter"></div>';groupPopup+='<div class="zp-cpro-imground"><span style="text-align:center;">'+ZPeople.getShortName(ZPeople.decodeTxt(grpDets.name))+"</span></div></div>",groupPopup+='<div class="zp-cpro-cont"><span class="zp-cpro-name"><a fieldType=\'grpHeader\' grpId=\''+grpId+"' target=_blank>"+grpDets.name+"</a></span>"+(""!==grpDets.emailalias&&null!==grpDets.emailalias&&void 0!==grpDets.emailalias?"<span>"+grpDets.emailalias+"</span>":""),groupPopup+='<div class="zp-cpro-mrimg" id="grpMemImg"><span>'+ZPFeeds.addEmpDetsToPopup(grpDets.memberList,grpDets.memberCount)+"</span>  </div> </div>",popuphtml.append(groupPopup)}else if("dept"==popupName){if($("body").find("#zp_feeds_popup").length>0||"false"==ZPeople.isDeptDataAllowed&&!isadmin)return;var deptDets=ZPFeeds.isPopupEmpDetailsFound(ZPFeeds.DEPTS_DETS_ARR,deptId);if(null==deptDets&&ZPeople.Request.sendAsyncPost(ZPFeeds.URL,{actionType:"GET_POPUP_DEPTDETAILS",deptId:deptId},function(result){deptDets=result.deptDets;var obj={};obj[deptId]=deptDets,ZPFeeds.DEPTS_DETS_ARR.push(obj)}),void 0==deptDets||null==deptDets)return;popuphtml.addClass("zp-cpro");let depPopUp='<div class="zp-cpro-img"> <div class="zp-cpro-imgfilter"></div>';depPopUp+='<div class="zp-cpro-imground"><span style="text-align:center;">'+ZPeople.getShortName(ZPeople.decodeTxt(deptDets.name))+"</span></div></div>",depPopUp+='<div class="zp-cpro-cont"><span class="zp-cpro-name"><a href="#home/organization/departmentdirectory-deptId:'+deptId+'" target=_blank>'+deptDets.name+"</a></span>"+(null!==deptDets.emailalias&&""!==deptDets.emailalias&&void 0!==deptDets.emailalias?"<span>"+deptDets.emailalias+"</span>":""),depPopUp+='<div class="zp-cpro-mrimg" id="deptMemImg"><span>'+ZPFeeds.addEmpDetsToPopup(deptDets.list,deptDets.count)+"</span>  </div> </div>",popuphtml.append(depPopUp)}$("body").append(popuphtml);var winHei=window.innerHeight,winWid=window.innerWidth,posTop=$(Obj).offset().top+20,posLeft=$(Obj).offset().left,popHei=popuphtml.height()+30,popWid=popuphtml.width()+30;popHei<posTop?(winHei-posTop<popHei&&((posTop-=popHei)<300&&(posTop="A"!==$(Obj).prop("tagName")?posTop-40:posTop-20),"A"!==$(Obj).prop("tagName")?posTop-=10:posTop-=20),posTop+=posTop<25?$(Obj).height():$(Obj).height()/2,$("body").find("#zp_feeds_popup").css("top",posTop+"px")):(posTop<50?($(Obj).prop("tagName"),posTop-=20):posTop="A"!==$(Obj).prop("tagName")?posTop+30:posTop+20,$("body").find("#zp_feeds_popup").css("top",($(Obj).prop("tagName"),posTop+"px"))),posLeft+popWid>winWid?posLeft=posLeft+($(Obj).width()/2+30)-popWid:posLeft-=30,$("body").find("#zp_feeds_popup").css("left",posLeft+"px"),$("body").find("#zp_feeds_popup").css("transform","translate3d(0, 0, 0)"),$("body").find("#zp_feeds_popup").fadeIn("50",function(){$("body").find("#zp_feeds_popup").css({opacity:"1",visibility:"visible"})}),ZPFeeds.HIDE_DETAIL_POPUP=!1,$("body").find("#zp_feeds_popup").mouseenter(function(){ZPFeeds.HIDE_DETAIL_POPUP=!1}),$("body").find("#zp_feeds_popup").on("click",function(){ZPFeeds.HIDE_DETAIL_POPUP=!0}),$("body").find("#zp_feeds_popup").mouseleave(function(){ZPFeeds.HIDE_DETAIL_POPUP=!0})}null!==ZPFeeds.POPUPDETAIL_INTERVAL&&clearInterval(ZPFeeds.POPUPDETAIL_INTERVAL),ZPFeeds.POPUP_INTERVAL=setInterval(function(){ZPFeeds.hideDetailPopup()},500)},updateStatus:(result,container,userId)=>{if(!result)return;let statusId="att_status_"+userId;if(void 0!=result.leaveAttStat){var leaveAttStat=ZPeople.decodeTxt(result.leaveAttStat),colourClass=Attendance.setClassToShowStatus(result.colourCode);Attendance.isLeaveAvail(result.colourCode)&&(leaveAttStat=result.leaveAttStat),void 0!=result.checkInBuilding&&""!=result.checkInBuilding&&(container.find("#checkInBuildingIN_Dot").removeClass("DNI"),container.find("#checkInBuildingIN_Span").removeClass("DNI"),container.find("#checkInBuildingIN_Span").attr("class",colourClass),container.find("#checkInBuildingIN_Icon").attr("title",result.checkInBuilding),container.find("#checkInBuildingIN_Label").html(result.checkInBuilding),container.find("#checkInBuildingIN_Label").attr("title",result.checkInBuilding)),container.find("#"+statusId).attr("class",colourClass+" zpl_dib zpl_ellipsis100 zpl_va-top").html(leaveAttStat)}else if(void 0!==result.attStatus){colourClass=result.attStatus.isLeave?"org":result.attStatus.allowtoCheckin?"red":"grn";var attStatus=result.attStatus.isLeave?ZPI18N.getString("zp.leave"):result.attStatus.allowtoCheckin?ZPI18N.getString("zp.out"):ZPI18N.getString("zp.in");container.find("#"+statusId).attr("class",colourClass+" zpl_dib zpl_ellipsis100 zpl_va-top").html(attStatus)}},isPopupEmpDetailsFound:function(memberDetails,id){for(i in memberDetails){var det=memberDetails[i];for(key in det)if(key==id)return det[key]}},addEmpDetsToPopup:function(eList,totalCount){var empDiv="";if(void 0===eList||null===eList)return empDiv;for(var i=0;i<eList.length;i++){if(i>=5){empDiv+='<a style="cursor:default">'+parseInt(totalCount-5)+"+</a>";break}empDiv+='<img src="'+eList[i].photo+'">'}return empDiv},setCommentedUserDetails:function(comments){if(void 0!==comments&&comments.length>0){var comentOwnerrArr=[];$.each(comments,function(){!ZPUtil.Validation.isEmpty(this.commby+"")&&ZPUtil.Validation.isNumber(this.commby+"")&&-1===comentOwnerrArr.indexOf(this.commby+"")&&comentOwnerrArr.push(this.commby+"")});var userlist=ZPeople.getUserDetailsByIds(comentOwnerrArr,!0);$.each(comments,function(){this.commentOwnDtl=ZPeople.getUserDetailsByIdInList(this.commby,userlist),void 0==this.commentOwnDtl&&(this.commentOwnDtl=ZPFeeds.setDummyUser()),void 0===this.rawcontent&&(this.rawcontent=this.content),this.content=ZPFeeds.Activity.getMentions(this.content,!1,!0)})}},setDummyUser:function(){var json={};return json.avatar=ZPeople.getDefaultUserImagePath(),json.thumb=ZPeople.getDefaultUserImagePath(),json.name=ZPI18N.getString("zp.user"),json.id=-1,json},getTextContent:function(status){var content=status;return ZPUtil.Validation.isEmpty(content)||(content=$("<div></div>").append(content).text().trim()),content},registerAttPreview:function(event,Obj,actId){event.preventDefault(),ZPFeeds.removeShowMore(Obj),ZPFeedsColorBox.viewImgsandFiles(Obj)},postAction:function(param,isPost){var mode=isPost?"status":"comment";if(!UDS_UPLOAD_IS_ACTIVE&&param.attachCnt>0&&(isPost||!isPost&&("Status"===param.type||"Collaboration"===param.type||param.type===People.HrCase.type||param.type===People.Announcement.type))){var action=isPost?"postUserStatus.zp":"feedActions.zp?actionType=INVOKE_ACS";$("body").find('[id="zp_AttachFile"]').remove(),$("body").append($('<form enctype="multipart/form-data" action="'+action+'" id="zp_AttachFile" method="post" target="feedsuploadwindow" style="display: none;"><input type="hidden" name="conreqcsr" id="csrfno" value="'+csrfToken+'"/><input type="hidden" name="'+mode+'" value=""/><input type="hidden" name="messageText" value=""/></form><iframe id="feedsuploadwindow" name="feedsuploadwindow" style="display:none;" ></iframe>'));var formObj=$("#zp_AttachFile");isPost?(void 0!==param.statusId&&formObj.append('<input type="hidden" name="statusId" value="'+param.statusId+'"/>'),void 0!==param.postedWall&&formObj.append('<input type="hidden" name="postedWall" value="'+param.postedWall+'"/>'),void 0!==param.CURRENTURL&&(formObj.append('<input type="hidden" name="linkURL" value="'+param.CURRENTURL+'"/>'),formObj.append('<input type="hidden" name="linkFormation" value="'+param.linkFormation+'"/>')),void 0!==param.title&&formObj.append('<input type="hidden" name="title" value="'+param.title+'"/>')):(formObj.append('<input type="hidden" name="fdk" value="'+param.fdk+'"/>'),formObj.append('<input type="hidden" name="statusType" value="'+param.type+'"/>'),param.type===People.HrCase.type&&null!=param.btnType&&formObj.append('<input type="hidden" name="btnType" value="'+param.btnType+'"/>'),void 0!==param.commentId&&formObj.append('<input type="hidden" name="commentId" value="'+param.commentId+'"/>')),formObj.find("[name='"+mode+"']").val(param.content),formObj.find("[name='messageText']").val(param.messageText),formObj.append($(param.curConObj).find("#zp_dash_attachments").find("[type = 'file']")),param.existFiles&&formObj.append('<input type="hidden" name="existFiles" value='+param.existFiles+"/>"),formObj.trigger("submit")}else{var params={statusType:param.type,messageText:param.messageText},url=isPost?"/postUserStatus.zp":"/feedActions.zp";if(params[mode]=param.content,null!=param.btnType&&(params.btnType=param.btnType),param.existFiles&&(params.existFiles=param.existFiles),isPost?(void 0!==param.CURRENTURL&&(params.linkFormation=param.linkFormation,params.linkURL=param.CURRENTURL),void 0!==param.statusId&&(params.statusId=param.statusId),void 0!==param.title&&(params.title=param.title),param.isForProject&&(params.isForProject=param.isForProject),param.postedWall&&(params.postedWall=param.postedWall)):(params.fdk=param.fdk,params.actionType="INVOKE_ACS",void 0!==param.commentId&&(params.commentId=param.commentId)),param.attachCnt>0){var attachIds=[],attachmentContId="caseView"==$(param.curConObj).attr("id")?"cseAttchLst":"zp_dash_attachments",fileObj=$(param.curConObj).find("#"+attachmentContId).find("[type = 'file']");if(void 0!==fileObj&&fileObj.length>0)for(var i=0;i<fileObj.length;i++)attachIds.push($(fileObj[i]).attr("udsfileId"));attachIds.length>0&&(params.attachIds=JSON.stringify(attachIds))}ZPeople.Request.send(url,params,param.callBack,param.actRecId)}},initPageComponents:function(element){ZPeople.isMyspace()||-1!=window.location.hash.indexOf("home/team/space-messages")||window.location.hash.indexOf("home/team/space-group")?element.append('<div class="zp-fd-wrpr"><div class="zp-fd-scroll"><div  id="zp_dash_feedspost_container"><div class="zp-fd-composeCont" id="edtCont"><a class="zp-fd-avatar"><img elem="profilePhoto" empid = '+erecno+'  class="zp-uimg" id="zpfd_editthumb" src="'+ZPeople.CURR_USER.thumb+'"></a><textarea class="form-control comps_bfr" id="zp_postTextarea" ondragover="ZPFeeds.Attachment.dragOverAttachments(event,true)" tabindex="0" placeholder=""></textarea></div></div><div class="zp-fd-allcat-con"><ul class="zp-fd-allcat" id="zp_feeds_filters"></ul></div><div id="zp_feeds_views"></div></div> <div class="zp-fd-con grpList DNI" id="grpList"><div class="zp-fd-fxd" style="top: 100px;"> <div class="cr_main grpHeader"><div class="ZPCusDrs grpMore DN"><a data-toggle="dropdown" aria-expanded="true"> <i class="PI_more"></i> </a><ul class="dropdown-menu ZPCmn-Arrow top rt gray"><li onclick="ZPFeeds.Groups.handleGrpOptSwitch(this)" id="edit"><a class="filters">'+ZPI18N.getString("zp.edit")+'</a></li></ul></div><div class="cr_img" id="grpImg" data-letters=""></div><h5 class="cr_main_T" id="grpTitle"></h5><h6 class="cr_main_Tsub"><span id="grpCnt"> </span> '+ZPI18N.getString("zp.members")+'</h6></div><div class="cr_main_usrs grpMembers"><ul class="ZPuserDiv curr"></ul><ul class="ZPuserDiv more DNI"></ul></div><div class="cr_main_usrs cr_main_usrs-A grpAdmins"><h6>'+ZPI18N.getString("zp.groupadmins")+'</h6> <ul class="ZPuserDiv curr"></ul><ul class="ZPuserDiv more DNI"></ul></div><div class="cr_main_usrs-D"><div class="zp-post-cont"><h6 id="grpDescHeader">'+ZPI18N.getString("zp.description")+'</h6><p class="grpDescr"></p></div></div></div> </div>'):Layout.Page.container.append('<div class="Scrcont zp-fdbg" scroll="enabled"><div class="zp-fd-wrpr"><div class="zp-fd-scroll"><div  id="zp_dash_feedspost_container"><div class="zp-fd-composeCont" id="edtCont"><a class="zp-fd-avatar"><img elem="profilePhoto" empid = '+erecno+' class="zp-uimg" id="zpfd_editthumb" src="'+ZPeople.CURR_USER.thumb+'"></a><textarea class="form-control comps_bfr" id="zp_postTextarea" ondragover="ZPFeeds.Attachment.dragOverAttachments(event,true)" placeholder=""></textarea></div></div><div class="zp-fd-allcat-con"><ul class="zp-fd-allcat" id="zp_feeds_filters"></ul></div><div id="zp_feeds_views"></div></div> <div class="zp-fd-con grpList DN" id="grpList"><div class="zp-fd-fxd"> <div class="cr_main grpHeader"><div class="ZPCusDrs grpMore DN"><a data-toggle="dropdown" aria-expanded="true"> <i class="PI_more"></i> </a><ul class="dropdown-menu ZPCmn-Arrow top rt gray"><li onclick="ZPFeeds.Groups.handleGrpOptSwitch(this)" id="edit"><a class="filters">'+ZPI18N.getString("zp.edit")+'</a></li></ul></div><div class="cr_img" id="grpImg" data-letters=""></div><h5 class="cr_main_T" id="grpTitle"></h5><h6 class="cr_main_Tsub"><span id="grpCnt"> </span> '+ZPI18N.getString("zp.members")+'</h6></div><div class="cr_main_usrs grpMembers"><ul class="ZPuserDiv curr"></ul><ul class="ZPuserDiv more DNI"></ul></div><div class="cr_main_usrs cr_main_usrs-A grpAdmins"><h6>'+ZPI18N.getString("zp.groupadmins")+'</h6> <ul class="ZPuserDiv curr"></ul><ul class="ZPuserDiv more DNI"></ul></div><div class="cr_main_usrs-D"><div class="zp-post-cont"><h6 id="grpDescHeader">'+ZPI18N.getString("zp.description")+'</h6><p class="grpDescr"></p></div></div></div> </div></div>'),ZPeople.CURRENT_VIEWKEY=ZPeople.VIEWKEYS.ALL,ZPFeeds.registerTextareaToEditor(Layout.Page.container.find("#zp_postTextarea")),Announcement.getLocationsAndCategories(),ZPeople.isMyspace()&&!ZPFeeds.isFilterInited&&(ZPFeeds.isFilterInited=!0,ZPTabs.ACTIVE_TABARR.forEach(function(tab){switch(tab){case"hrcase":ZPFeeds.FEEDS_FILTER_ARR.push("HrCase");break;case"files":ZPFeeds.FEEDS_FILTER_ARR.push("FileCabinet");break;case"timetracker":ZPFeeds.FEEDS_FILTER_ARR.push("AddSchedule","JobSchedule");break;case"leavetracker":ZPFeeds.FEEDS_FILTER_ARR.push("Holiday","Leave");break;case"attendance":ZPFeeds.FEEDS_FILTER_ARR.push("Shift");break;case"employeeengagement":ZDOMEEAPI.api.getAnsweredSurveys(),ZPFeeds.FEEDS_FILTER_ARR.push("Survey")}})),ZPFeeds.constructFeedFilters(),Layout.Page.container.find("#zp_feeds_filters").find("li[ftype='ALL']").addClass("active")},constructFeedFilters:function(){Layout.Page.container.find("#zp_feeds_filters").html("");var filterObj=Layout.Page.container.find("#zp_feeds_filters"),cnt=0,moreObj=$('<li class="seltick ZPCusDrs" id="more_filters"> <a data-toggle="dropdown"> <i class="PI_more"></i> </a> <ul class="dropdown-menu ZPCmn-Arrow top gray"> </ul> </li>');let moreOptions=moreObj.find("ul");$.each(ZPFeeds.FEEDS_FILTER_ARR,function(index){var filter_name="Holiday"==ZPFeeds.FEEDS_FILTER_ARR[index]?holiday_disName:ZPI18N.getString(ZPFeeds.FEEDS_FILTER_OBJ[ZPFeeds.FEEDS_FILTER_ARR[index]]);"Feedback"==ZPFeeds.FEEDS_FILTER_ARR[index]&&(filter_name=ZPFeeds.PMS.FormUtil.FeedbackName),"HrCase"==ZPFeeds.FEEDS_FILTER_ARR[index]&&$.each(ZPTabs.TAB_JSON,function(index,value){"HRCase"==value.name&&(filter_name=ZPeople.escapeHtml(value.disName))}),cnt<6?(filterObj.append('<li class="fdfilter" ftype="'+ZPFeeds.FEEDS_FILTER_ARR[index]+'"><a href="javascript:;">'+filter_name+"</a></li>"),cnt++):moreOptions.append('<li ftype="'+ZPFeeds.FEEDS_FILTER_ARR[index]+'"><a href="javascript:;" class="filters">'+filter_name+"</a></li>")}),filterObj.children("li.fdfilter").on("click",function(){ZPFeeds.toggleFeedsViewPage(this)}),0!=moreOptions.children().length&&filterObj.append(moreObj),filterObj.find("li#more_filters").find("ul").children("li").on("click",function(){ZPFeeds.updateFilterArray(this)})},updateFilterArray:function(Obj){var type=$(Obj).attr("ftype");ZPFeeds.FEEDS_FILTER_ARR.splice(ZPFeeds.FEEDS_FILTER_ARR.indexOf(type),1),ZPFeeds.FEEDS_FILTER_ARR.splice(5,0,type),ZPFeeds.constructFeedFilters(),ZPFeeds.toggleFeedsViewPage(Layout.Page.container.find("#zp_feeds_filters").find("li[ftype='"+type+"']"))},setFeedEditorHeight:function(Obj,isPost){var currObj=ZPFeeds.CURRENT_EDITOR,dfHgt=150,allowance=90;isPost?ZPFeeds.CURRENT_EDITOR.find("#zpfd_sts_title").length>0?(dfHgt=200,allowance=140):(dfHgt=150,allowance=90):(dfHgt=120,allowance=80);var h=Obj.scrollHeight+allowance>=dfHgt?Obj.scrollHeight+allowance:dfHgt;h>490&&(h=490),currObj.css("cssText","height:"+h+"px !important")},getContentJson:function(editor,actJson){var content=ZPFeeds.getSmileysAndMentions(editor.getContent(),ZPeople.isSearchAllowed);return{content:content=ZPFeeds.removeTrailingEmptyDivs(content),messgeTxt:ZPFeeds.getTextContent(content),attachments:ZPFeeds.getAttachmentsFromContainer(editor,actJson)}},getAttachmentsFromContainer:function(editor,actJson){var attObj,curConObj=ZPFeeds.getCurrentViewContainer(actJson.actRecId);return 0!=parseInt(curConObj.find("#zp_dash_attachments").attr("attachcnt"))&&(attObj=$(curConObj).find("#zp_dash_attachments").find("[type = 'file']")),$(curConObj).find("#zp_dash_attachments").attr("attachcnt","0"),$(curConObj).find("#zp_dash_attachments").children("input").remove(),attObj},getFeedsMode:function(mode){switch(mode){case"department":return"home/team/space";default:return"home/myspace/overview"}},getFeedUrl:view=>{switch(view){case"department":return"home/team/space-messages";case"group":return"home/team/space-group";default:return"home/myspace/overview-feeds"}},getFeedType:()=>{switch(Layout.Page.hash.slice(1).split(":")[0]){case"home/feeds/department":case"home/team/space-messages":return"department";case"home/feeds/myfeed":case"home/myspace/overview-feeds":return"allFeeds";case"home/feeds/group-Id":case"organization/groups/groupmembers-groupid":case"home/team/space-group":return"group"}},redirect:()=>{Layout.Page.urlparam.view?window.location.hash=ZPFeeds.getFeedUrl()+"-view:"+Layout.Page.urlparam.view:"department"==ZPFeeds.getFeedType()?window.location.hash=ZPFeeds.getFeedUrl("department"):"group"==ZPFeeds.getFeedType()?window.location.hash=ZPFeeds.getFeedUrl("group")+":"+(Layout.Page.urlparam.id?Layout.Page.urlparam.id:Layout.Page.urlparam.groupid):window.location.hash=ZPFeeds.getFeedUrl()},hasInValidContent:content=>{return/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1FAFF}\u{1F1E6}-\u{1F1FF}]/u.test(content)}}).Customization={USER_CUSTOBJ:null,WIDGET_CUST_MODAL:null,getUserFdSettings:function(){if(null==ZPFeeds.Customization.USER_CUSTOBJ){ZPeople.Request.send(ZPFeeds.URL,{actionType:"GET_FEEDSUSERSETTING"},function(data){data.success&&(ZPFeeds.Customization.USER_CUSTOBJ=data.custJson,ZPFeeds.Customization.show())})}else ZPFeeds.Customization.show()},show:function(){if(0===Layout.Page.container.find("#zp_dashcutomization_pop").length){var custHtml='<div class="tab-content">';custHtml+='<ul class="PR15 PL15 tab-pane fade active in" id="zp_feeds_notif_custo"><li class="ZPFCrow" lname="FEEDS_MENTION_MAIL_NOTIFICATION"><label class="btnactive FR"> <input class="cmn-toggle-small cmn-toggle-round-small" type="checkbox" checked="true"> <span class="M0"></span> </label><span>'+ZPI18N.getString("zp.notifymentionmessage")+'</span></li><li class="ZPFCrow" lname="FEEDS_DEPT_MSG_MAIL_NOTIFICATION"><label class="btnactive FR"> <input class="cmn-toggle-small cmn-toggle-round-small" type="checkbox" checked="true"> <span class="M0"></span> </label><span>'+ZPI18N.getString("zp.notifydeptgrpmessage",[ZPI18N.getString("zp.sdepartment")])+'</span></li><li class="ZPFCrow" lname="FEEDS_GROUP_MSG_MAIL_NOTIFICATION"><label class="btnactive FR"> <input class="cmn-toggle-small cmn-toggle-round-small" type="checkbox" checked="true"> <span class="M0"></span> </label><span>'+ZPI18N.getString("zp.notifydeptgrpmessage",[ZPI18N.getString("zp.sgroup")])+"</span></div></li></ul>",ZPFeeds.Customization.WIDGET_CUST_MODAL=ZPeople.BSModal.get({id:"zp_dashcutomization_pop",type:2,header:ZPI18N.getString("zp.emailnotification"),body:custHtml,modalClass:"popRgtModel",buttonValue:ZPI18N.getString("zp.update"),successCallback:ZPFeeds.Customization.update})}$.each(ZPFeeds.Customization.USER_CUSTOBJ,function(key,value){ZPFeeds.Customization.WIDGET_CUST_MODAL.find("[lname = '"+key+"']").length>0&&(ZPFeeds.Customization.WIDGET_CUST_MODAL.find("[lname = '"+key+"']").find("input")[0].checked=!!value)}),ZPeople.BSModal.show(ZPFeeds.Customization.WIDGET_CUST_MODAL)},update:function(modal){var isChanged=!1,custJson={};if(modal.find("input[type=checkbox]").each(function(){var lName=$(this).parent().parent().attr("lname"),isChecked=$(this).is(":checked");ZPFeeds.Customization.USER_CUSTOBJ[lName]!==isChecked&&(isChanged=!0,ZPFeeds.Customization.USER_CUSTOBJ[lName]=isChecked,custJson[lName]=isChecked)}),isChanged){var params={actionType:"UPDATE_FEEDSUSERSETTING",custJson:JSON.stringify(custJson)};ZPeople.Request.send(ZPFeeds.URL,params,ZPFeeds.Customization.updateResp)}else ZPeople.BSModal.hide()},updateResp:function(data,params){-1!==data.indexOf("success")?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatedsuccessfully")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")),ZPeople.BSModal.hide()}},ZPFeeds.Announcements={addRemoveAnnBody:function(isadd){void 0===isadd&&(isadd="home/feeds/announcements"===Layout.Page.currentmode),Layout.Page.container.find("#zp_dash_feedspost_container").find("#editor_container").length>0&&(isadd?(Layout.Page.container.find("#edtCont").removeClass("DNI"),Layout.Page.container.find("#zp_dash_feedspost_container").find("#editor_container").addClass("DNI")):Layout.Page.container.find("#zp_dash_feedspost_container").find("#editor_container").length>0&&(Layout.Page.container.find("#zp_dash_feedspost_container").find("#editor_container").removeClass("DNI"),Layout.Page.container.find("#edtCont").addClass("DNI")))}},ZPFeeds.Attachment={onFileSelect:function(isPost,input,containerId){if(void 0!==input){var file=input.files[0];if(void 0!==file&&file.size>0&&file.size<5242880){var formObj;formObj=!0===isPost?"ann_Editor"===containerId?Layout.Page.container.find("#ann_Editor"):Layout.Page.container.find("#editor_container"):ZPFeeds.getCurrentViewContainer(containerId);var extn=file.type.split("/")[1];if(UDS_UPLOAD_IS_ACTIVE)ZPFeeds.Attachment.upload(formObj,file,isPost,input,containerId,ZPFeeds.uploadCallBack,ZPFeeds.failureCallBack);else if(!ZPFeeds.SINGLEPOP&&ZPUtil.Validation.isImage("/"+extn)){var reader=new FileReader;reader.onload=function(event){var dataUri=event.target.result;"ann_Editor"===containerId?Announcement.Attachments.getAddPreviewForAttachment(formObj,file,isPost,input,dataUri):ZPFeeds.Attachment.getPreviewForAttachment(formObj,file,isPost,input,dataUri)},reader.onerror=function(event){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.filecouldnotberead"))},reader.readAsDataURL(file)}else"ann_Editor"===containerId?Announcement.Attachments.getAddPreviewForAttachment(formObj,file,isPost,input,void 0):ZPFeeds.Attachment.getPreviewForAttachment(formObj,file,isPost,input,void 0)}else 0===file.size?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.emptyfilewarning")):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.feedfilesizewarning")),$(input).remove()}},upload:(formObj,file,isPost,input,containerId,successCallback,failureCallback)=>{let currentFileObj={};currentFileObj.formObj=formObj,currentFileObj.file=file,currentFileObj.isPost=isPost,currentFileObj.input=input,currentFileObj.containerId=containerId;var fileCode=(new Date).getTime()+""+erecno;currentFileObj.fileCode=fileCode;var xhr=new XMLHttpRequest,udsUploadApi=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload";xhr.open("post",udsUploadApi,!0),xhr.setRequestHeader("x-assured-response",!0),void 0!=ZPeople.zaid&&xhr.setRequestHeader("x-cli-zaid",ZPeople.zaid),xhr.setRequestHeader("x-streammode","1"),xhr.setRequestHeader("x-fclient-version","2"),xhr.setRequestHeader("x-service",UDS_UPLOAD_SERVICE_CODE),xhr.setRequestHeader("app-info",JSON.stringify({portalId:_LOGGEDIN_ACCZSOID,moduleName:"Feeds"}));var params=JSON.stringify({fileName:encodeURIComponent(file.name),contentType:file.type,fileSize:file.size,fileCode:fileCode});if(xhr.setRequestHeader("file-info",params),xhr.setRequestHeader("upload-id",fileCode),xhr.withCredentials=!0,xhr.onreadystatechange=function(oEvent){if(4==xhr.readyState){var responseObj,isAntivirus=!0;200===xhr.status?(responseObj=JSON.parse(xhr.response),successCallback(responseObj,currentFileObj)):("object"==typeof xhr.response&&"Virus Found"==responseObj.message&&(isAntivirus=!1),failureCallback(JSON.parse(params),isAntivirus,xhr.response,currentFileObj))}},xhr.send(file),"ann_Editor"!==containerId){var dashAttachCont=formObj.find("#zp_dash_attachments");dashAttachCont.removeClass("DN"),dashAttachCont.append('<div class="attachedFile uploadingFile" id="fd_loadtemplate" fileCode="'+fileCode+'"> <div class="uploadBar"> <p>Uploading...</p> <div class="zpfilepro"> <div data-progressjs="'+fileCode+'" style="width: 0%"></div> </div> </div><i class="IC-formcustom fileType"></i><i class="icon-close IC-cls-1px" id="zp_dashremoveupload"></i></div>'),dashAttachCont.find("#zp_dashremoveupload").on("click",function(){$(input).remove(),0==dashAttachCont.find("[type=file]").length&&(dashAttachCont.addClass("DN"),dashAttachCont.addClass("DN").attr("attachcnt",0),dashAttachCont.attr("removedinp",0)),dashAttachCont.find("[fileCode='"+fileCode+"']").remove()}),progressJs("div[data-progressjs='"+fileCode+"']").autoIncrease(8,10)}},getPreviewForAttachment:function(formObj,file,isPost,input,dataUri){formObj.find("#zp_dash_attachments").attr("attachcnt",parseInt(formObj.find("#zp_dash_attachments").attr("attachcnt"))+1);var attachCnt=parseInt($(input).attr("attachcnt")),innerObj=void 0;ZPFeeds.SINGLEPOP?innerObj=$('<span id="zp_fileName"></span>').text(file.name):(innerObj=$(file.type.startsWith("image")&&!file.type.endsWith("/svg+xml")?'<a class="attImage"><img id="file_upload_'+attachCnt+'" src="'+dataUri+'"></a> ':'<div class="uploadBar"><p id="zp_fileName"></p></div><i class="IC-formcustom fileType"></i>')).find("#zp_fileName").text(file.name),ZPFeeds.SINGLEPOP||innerObj.find("#zp_fileName").append("<br>"+ZPUtil.formatBytes(file.size));var Obj=$('<div class="'+(ZPFeeds.SINGLEPOP?"attachedFiletxt PR":"attachedFile")+'" style="z-index:1;" attachcnt='+attachCnt+'><i class="icon-close IC-cls-1px"  id="zp_dashRemoveAttachment"></i></div>');Obj.prepend(innerObj),Obj.find("#zp_dashRemoveAttachment").on("click",function(){ZPFeeds.Attachment.removeAttachment(this,!1,isPost)}),formObj.find("#zp_dash_attachments").find("#"+$(input).attr("id")).append(input),formObj.find("#zp_dash_attachments").removeClass("DN").append(Obj)},getEditPreviewForAttachment:function(cont,fileList,actRecId){for(var innerObj=void 0,i=0;i<fileList.length;i++){file=fileList[i],(innerObj=$('<div class="attachedFile"  fileId="'+file.downloadFileId+'" existFile="true" style="z-index:1;">'+(ZPUtil.Validation.isImage(file.fileExtn)&&!file.fileExtn.endsWith("/svg+xml")?'<a class="attImage"><img src="/downloadAttachment?recId='+actRecId+"&fileId="+(void 0!==file.zpeopleId?file.zpeopleId:file.fileId)+'"></a> ':'<div class="uploadBar"><p id="zp_fileName"></p></div><i class="IC-formcustom fileType"></i>')+'<i class="icon-close IC-cls-1px"  id="zp_dashRemoveAttachment"></i></div>')).find("#zp_fileName").html(file.fileName+"<br>"+("string"==typeof file.fileSize?file.fileSize:ZPUtil.formatBytes(file.fileSize))),cont.find("#zp_dash_attachments").removeClass("DN").append(innerObj)}cont.find("#zp_dash_attachments").find("[id='zp_dashRemoveAttachment']").on("click",function(){ZPFeeds.Attachment.removeAttachment(this,!1,!0,!0)})},removeAttachment:function(Obj,link,isPost,isFromAnn,editor){let filedClass=isFromAnn?".filePrev":".attachedFile";if(void 0!==$(Obj).parent(filedClass).attr("existFile")){$(Obj).parent(filedClass).remove();var attcnt=Layout.Page.container.find("#ann_Editor").find("#zp_dash_attachments").find("[existfile='true']").length;Announcement.Construction.hideShowAttachments()}else if(!1!==link)editor.initobj.linkFormation=2,$(Obj).parents("#zp_dash_linkattachment").addClass("DN").children().remove();else{var attachObj,attachcnt=parseInt($(Obj).parents(filedClass).attr("attachcnt"));if((attachObj=isPost?Layout.Page.container.find("#zp_dash_attachments"):void 0!=$(Obj).parents("#bottomcont").parent().attr("streamid")?ZPFeeds.getCurrentViewContainer($(Obj).parents("#bottomcont").parent().attr("streamid")).find("#zp_dash_attachments"):ZPFeeds.getCurrentViewContainer($(Obj).parents("#anno_detail").attr("streamid")).find("#zp_dash_attachments")).find("input[attachcnt = '"+attachcnt+"']").remove(),0===attachObj.find("[type=file]").length)0!==$(Obj).parents("#zp_dash_attachments").find(filedClass).length?($(Obj).parents("#zp_dash_attachments").attr("attachcnt",0),1!=isFromAnn&&$(Obj).parents("#zp_dash_attachments").addClass("DN")):$(Obj).parents("#zp_dash_attachments").addClass("DN").attr("attachcnt",0),$(Obj).parents("#zp_dash_attachments").attr("removedinp",0),attachObj.children("input").remove();else{for(attachObj.attr("attachcnt",parseInt(attachObj.attr("attachcnt")-1)),attcnt=(attachcnt=parseInt(attachcnt))+1;attcnt<=10-attachcnt+attachcnt;attcnt++){var curAttCnt=attcnt-1;attachObj.find("input[attachcnt = '"+attcnt+"']").attr("id","zp_attachments_"+curAttCnt),attachObj.find("input[attachcnt = '"+attcnt+"']").attr("name","file_upload_"+curAttCnt),attachObj.find("[attachcnt = '"+attcnt+"']").attr("attachcnt",curAttCnt)}attachObj.attr("removedinp",attachObj.find("[type=file]").length+1)}isFromAnn?($(Obj).parents(".filePrev").remove(),Announcement.Construction.hideShowAttachments("edit")):$(Obj).parent().remove()}},dragOverAttachments:function(event,isPost,recordId){var dragObj,inpObj,appndObj;if(recordId=isPost&&"ann_Editor"!==recordId?"editor_container":recordId,isPost)if("ann_Editor"!==recordId){if(Layout.Page.container.find("#zp_postTextarea").trigger("click"),Layout.Page.container.find("#ann_Editor").length>0)return void ZPFeeds.Attachment.dragOverAttachments(event,!0,"ann_Editor");appndObj=(dragObj=Layout.Page.container.find("#zp_dash_feedspost_container")).find(".composeDesc-Wrap")}else appndObj=(dragObj=Layout.Page.container.find("#"+recordId)).find(".ze");else 0==(dragObj=ZPFeeds.getCurrentViewContainer(recordId)).find("#cmtpostcont").find(".composeDesc-Wrap").find(".ze").length&&dragObj.find("#cmt_textarea").trigger("click"),appndObj=dragObj.find("#cmtpostcont").find(".composeDesc-Wrap");ZPFeeds.Attachment.createInput(!isPost,recordId,!0),(inpObj=dragObj.find("#zp_dash_attachments").find("input:last").clone()).removeClass("DN");var dragLayer=$('<div class="ZPDrfile" id="ZP_DragDropLayer"><div><i class="IC-file1x"></i><span>'+ZPI18N.getString("zp.dropfiletoattach")+"</span></div></div>");0===dragObj.find("#ZP_DragDropLayer").length&&(parseInt(dragObj.find("#zp_dash_attachments").attr("attachcnt"))+1<=10?($(inpObj).on("change",function(){$(this).addClass("DN"),ZPFeeds.Attachment.onDragFileSelect(this,isPost,recordId)}),dragLayer.on("dragleave",function(){ZPFeeds.Attachment.dragLeaveAttachments(isPost,recordId,dragObj)}),dragLayer.append(inpObj),appndObj.append(dragLayer)):ZPFeeds.Attachment.onFileSelect())},onDragFileSelect:function(Obj,isPost,recordId){var currObj,dragLayer=(currObj=isPost?Layout.Page.container.find("ann_Editor"!==recordId?"#zp_dash_feedspost_container":"#ann_Editor"):ZPFeeds.getCurrentViewContainer(recordId)).find("#ZP_DragDropLayer");currObj.find("#zp_dash_attachments").find("#"+dragLayer.find("input").attr("id"));currObj.find("#zp_dash_attachments").find("#"+dragLayer.find("input").attr("id")).replaceWith(dragLayer.find("input")),dragLayer.remove(),ZPFeeds.Attachment.onFileSelect(isPost,Obj,recordId)},dragLeaveAttachments:function(isPost,recordId,dragObj){recordId=isPost&&"ann_Editor"!==recordId?"editor_container":recordId,currObj=isPost?Layout.Page.container.find("ann_Editor"!==recordId?"#zp_dash_feedspost_container":"#ann_Editor"):ZPFeeds.getCurrentViewContainer(recordId),currObj.find("#ZP_DragDropLayer").remove(),dragObj.find("#zp_dash_attachments").find("input:last").remove()},createInput:function(isComment,containerId,isDrag){var formObj,isPost=!1;"false"===isComment||!1===isComment?(isPost=!0,formObj=Layout.Page.container.find("#"+containerId)):formObj=ZPFeeds.getCurrentViewContainer(containerId);var attachCnt=parseInt(formObj.find("#zp_dash_attachments").attr("attachcnt"))+1,removedInp=formObj.find("#zp_dash_attachments").attr("removedinp");void 0!==removedInp&&"0"!=removedInp&&(attachCnt=parseInt(removedInp),formObj.find("#zp_dash_attachments").attr("removedinp","0"));var existAttachedFileCnt=$("[existFile=true]").length;attachCnt+existAttachedFileCnt<=10?0===formObj.find("#zp_dash_attachments").find("#zp_attachments_"+attachCnt).length?(formObj.find("#zp_dash_attachments").append($('<input type="file" class="ZPdfile '+(isDrag?"DN":"DNI")+'" id="zp_attachments_'+attachCnt+'" type="file" attachcnt="'+attachCnt+'" name="file_upload_'+attachCnt+'" >').on("change",function(){attachCnt<=10?ZPFeeds.Attachment.onFileSelect(isPost,this,containerId):ZPFeeds.Attachment.onFileSelect()})),!0!==isDrag&&formObj.find("#zp_dash_attachments").find("#zp_attachments_"+attachCnt).trigger("click")):isDrag||formObj.find("#zp_dash_attachments").find("#zp_attachments_"+attachCnt).trigger("click"):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.maximumfilesreached"))}},ZPFeeds.URLinfo={CURRENTURL:"",checkURLStatus:function(url,editor){null!=editor&&void 0!==editor&&editor.initobj.CURRENTURL!==url&&(0===Layout.Page.container.find("#zp_dash_feedspost_container").find("#zp_dash_linkattachment").find("#zp_page_loading").length&&Layout.Page.container.find("#zp_dash_feedspost_container").find("#zp_dash_linkattachment").removeClass("DN").html(ZPeople.LOADING_HTML),editor.initobj.CURRENTURL=url,editor.initobj.linkFormation=0,ZPeople.Request.send("/feedActions.zp",{actionType:"GET_URLINFO",link:url.trim()},ZPFeeds.URLinfo.handleURLResponse,{editor:editor}))},handleURLResponse:function(data,params,otherDtl){var editor=void 0!==otherDtl&&void 0!==otherDtl.editor?otherDtl.editor:void 0,linkCont=$(editor.outerdiv).parents("#editor_container").find("#zp_dash_linkattachment");200===data.code?(linkCont.removeClass("DN"),linkCont.html(ZPFeeds.Activity.getHTMLforLinkStream(data,!0,editor))):(editor.initobj.CURRENTURL="",linkCont.html("").addClass("DN"))},removeThumbnail:function(Obj,editor){$(Obj).prop("checked")?(editor.initobj.linkFormation=1,$(Obj).parents(".noImgCb").prev().css("visibility","hidden")):(editor.initobj.linkFormation=0,$(Obj).parents(".noImgCb").prev().css("visibility",""))}},ZPFeeds.Groups={CURRUSER_GROUPS:{},getMyGroups:function(){ZPeople.Request.send("/group/list",{mode:"getMyGroups",method:"listGroup"},ZPFeeds.Groups.initGroupList)},initGroupList:function(data){var groupIdArr=[];$.each(data,function(){groupIdArr.push(this.groupId),ZPFeeds.Groups.CURRUSER_GROUPS[this.groupId]=this}),_LOGGEDIN_GROUPID=groupIdArr},checkIsMyGroup:function(grpFollowers,IdsArr){if(grpFollowers+="",!ZPUtil.Validation.isEmpty(grpFollowers))for(var grpIds=grpFollowers.split(","),cnt=0;cnt<grpIds.length;cnt++)if(void 0!==IdsArr){if(!ZPUtil.Validation.isEmpty(grpIds[cnt])&&"null"!==grpIds[cnt]&&-1!==IdsArr.indexOf(grpIds[cnt]))return!0}else if(!ZPUtil.Validation.isEmpty(grpIds[cnt])&&"null"!==grpIds[cnt]&&void 0!==ZPFeeds.Groups.CURRUSER_GROUPS[grpIds[cnt]])return!0;return!1},GRP_ADMIN_DET:[],appendGrpDets:function(grpId){let groupsHdr=$("#dep_space_contentWrap #groupTbs");groupsHdr.find("#EditGroup").empty();let groupDtls=groupsHdr.find("#group_details");groupDtls.empty();var grpDiv=Layout.Page.container.find(".grpList");ZPeople.Request.sendAsyncPost("/group/member/list",{method:"listGroupMembers",groupId:grpId},function(grpDet){grpDet.isGroupAdmin&&groupsHdr.find("#EditGroup").html($('<a id="edit">'+ZPI18N.getString("zp.edit")+"</a>").on("click",function(){ZPFeeds.Groups.handleGrpOptSwitch(this)}));var grpMem=grpDet.memberList;null!=grpMem&&void 0!=grpMem&&groupDtls.html(ZPFeeds.Groups.constructGroupMember(grpMem,grpDet.memberCount,grpId)),grpDiv.find(".grpHeader").find("#grpImg").attr("data-letters",ZPeople.getShortName(ZPeople.decodeTxt(grpDet.name))),grpDet.isGroupAdmin?grpDiv.find(".grpHeader").find(".grpMore").removeClass("DN"):grpDiv.find(".grpHeader").find(".grpMore").addClass("DN"),grpDiv.find(".grpHeader").find("#grpTitle").html(""),grpDiv.find(".grpHeader").find("#grpTitle").append("<a onclick=\"Group.editUsers('"+grpId+"')\" >"+grpDet.name+"</a>"),grpDiv.find(".grpHeader").find("#grpCnt").text(grpDet.memberCount),grpDiv.find(".grpMembers ul").empty(),grpDiv.find(".grpAdmins ul").empty(),grpDiv.find("#grpDescHeader").removeClass("DNI"),grpDiv.find(".grpDescr").text(""),grpDiv.find(".grpMembers ul.more").addClass("DNI"),grpDiv.find(".grpMembers ul.curr li:last-child").addClass("DNI"),grpDiv.find(".grpMembers ul.curr").find("#zp_groups_deptListViewall").removeClass("DNI"),grpDiv.find(".grpAdmins ul.more").addClass("DNI"),grpDiv.find(".grpAdmins ul.curr li:last-child").addClass("DNI"),grpDiv.find(".grpAdmins ul.curr").find("#zp_groups_deptListViewall").removeClass("DNI"),grpDiv.find(".grpDescr").html(grpDet.description.replace(/\n/g,"<br />")),0==grpDet.description.length&&grpDiv.find("#grpDescHeader").addClass("DNI"),ZPFeeds.Groups.GRP_ADMIN_DET=[],Layout.Page.container.find(".grpList").removeClass("DN")})},constructGroupMember:(memberList,memberCount,groupId)=>{let listSize=memberList.length,grpmembers=$('<div class="zpl_avatarimg"></div>');for(let index=0;index<listSize;index++){if(index>=listSize||4==index){grpmembers.append($('<span field="viewgrpmber" class="zpl_totaltxt">+'+(memberCount-index)+"</span>"));break}let userObj=memberList[index];grpmembers.append('<div field="viewgrpmber" empId="'+userObj.ZUID+'" class="zpl_em"><div class="zpl_emimg"><img src="'+userObj.photo+'"></div></div>')}return grpmembers.find('[field="viewgrpmber"]').on("click",function(){Group.editUsers(groupId)}),grpmembers},removeShowMore:function(Obj){$(Obj).parents(".cr_main_usrs-D").removeClass("zp-fd-shwmore"),$(Obj).parents(".zp-post-cont").find(".zp-fd-shwlink").remove()},addGrpMembers:function(grpMemDet,isMember){for(var grpMemLen=grpMemDet.length,grpDiv=Layout.Page.container.find(".grpList"),className=isMember?"grpMembers":"grpAdmins",i=0;i<grpMemLen;i++)i<10?9==i?(i+1!=grpMemLen&&grpDiv.find("."+className+" ul.curr").append("<li id='zp_groups_deptListViewall' onclick='ZPFeeds.Groups.showMoreGrpMem(this)'><div class='mor' ><div class='PI_more gry'></div></div></li>"),grpDiv.find("."+className+" ul.curr").append("<li class='"+(i+1!=grpMemLen?"PR DNI":"PR")+"' popup='user' empid="+grpMemDet[i].ZUID+">  <img src="+grpMemDet[i].photo+"></li>")):grpDiv.find("."+className+" ul.curr").append("<li class='PR' popup='user' empid="+grpMemDet[i].ZUID+"><img src="+grpMemDet[i].photo+"></li>"):(grpDiv.find("."+className+" ul.more").append("<li class='PR' popup='user' empid="+grpMemDet[i].ZUID+"><img src="+grpMemDet[i].photo+"></li>"),i==grpMemLen-1&&grpDiv.find("."+className+" ul.more").append("<li id='zp_groups_deptListClose' onclick='ZPFeeds.Groups.hideMoreGrpMem(this)'><div class='mor'><div class='IC-cls gry'></div></div></li>")),isMember&&"admin"===grpMemDet[i].roleType&&ZPFeeds.Groups.GRP_ADMIN_DET.push(grpMemDet[i])},showMoreGrpMem:function(obj){var clsName=-1!=$(obj).parent().parent().attr("class").indexOf("grpMembers")?"grpMembers":"grpAdmins",grpDiv=Layout.Page.container.find(".grpList");grpDiv.find("."+clsName+" ul.curr li:last-child").removeClass("DNI"),grpDiv.find("."+clsName+" ul.curr").find("#zp_groups_deptListViewall").addClass("DNI"),grpDiv.find("."+clsName+" ul.more").removeClass("DNI")},hideMoreGrpMem:function(obj){var clsName=-1!=$(obj).parent().parent().attr("class").indexOf("grpMembers")?"grpMembers":"grpAdmins",grpDiv=Layout.Page.container.find(".grpList");grpDiv.find("."+clsName+" ul.more").addClass("DNI"),grpDiv.find("."+clsName+" ul.curr li:last-child").addClass("DNI"),grpDiv.find("."+clsName+" ul.curr").find("#zp_groups_deptListViewall").removeClass("DNI")},handleGrpOptSwitch:function(obj){var id=$(obj).attr("id");window.opener=null;let grouId=Layout.Page.urlparam.group;"edit"===id&&grouId&&Group.openEditGroup(grouId)}},ZPFeeds.Projects={PROJECT_LIST:{},PM_PROJECT_LIST:void 0,getProjectDetailsByIds:function(projectIds){projectIds&&projectIds.length>0&&ZPeople.Request.sendAsyncPost("/timesheetDispAction.zp",{mode:"getProjectNameByIds",projectIds:JSON.stringify(projectIds)},function(response){var responseObj=1===response.res?response.resObj:{};$.each(projectIds,function(index,projectId){responseObj[projectId]?ZPFeeds.Projects.PROJECT_LIST[projectId]=responseObj[projectId]:ZPFeeds.Projects.PROJECT_LIST[projectId]="-"})})},getProjectName:function(projectId){return void 0===ZPFeeds.Projects.PROJECT_LIST[projectId]&&ZPFeeds.Projects.getProjectDetailsByIds(new Array(projectId)),ZPFeeds.Projects.PROJECT_LIST[projectId]},getPMList:function(){ZPeople.Request.sendAsyncPost("/timesheetDispAction.zp",{mode:"getPMProjectIds"},function(response){response&&response.result&&(ZPFeeds.Projects.PM_PROJECT_LIST=response.result)})},isLoginUserPM:function(currApprProjectId){return!!currApprProjectId&&(void 0===ZPFeeds.Projects.PM_PROJECT_LIST?(ZPFeeds.Projects.getPMList(),ZPUtil.checkIsExistInArray(ZPFeeds.Projects.PM_PROJECT_LIST,currApprProjectId)):ZPUtil.checkIsExistInArray(ZPFeeds.Projects.PM_PROJECT_LIST,currApprProjectId))}},ZPFeeds.Notifications={LoadFiles:[],MOREKEY:void 0,MAPPED_OBJECT:null,initComponents:function(){ZPeople.Request.send("/feedActions.zp",{actionType:"GET_BADGE_COUNT"},People.Uns.handleCount),$("#zp_feeds_notifications").on("click",function(){Layout.PageUtil.loadFiles(ZPFeeds.Notifications.LoadFiles,()=>{ZPFeeds.Notifications.getNotificationsList()})})},getNotificationsList:function(){var notiModal=$("#zpntfn_modal");if(notiModal.is("hidden")&&(notiModal.remove(),$("#zpntfn_detail_modal").remove()),0===$("#zpntfn_modal").length){var modal=$('<div class="zpl_mdl zpl_msm zpl_mnoti zpl_mopen" id="zpntfn_modal"><div class="zpl_minr"><div class="zpl_mhder"><div class="d-flexclmcap5"><h4>'+ZPI18N.getString("zp.notifications")+'</h4><a class="zpl_link zpl_mrkred DN"  onclick="ZPFeeds.Notifications.markAllAsRead();" id="zpntfn_markread">'+ZPI18N.getString("zp.markallasread")+'</a></div><a class="_cls PI_cls" onclick="ZPFeeds.Notifications.getNotificationsList()"></a></div><div id="zp_modal_body" class="zpl_mcnt" scroll="enabled">'+ZPeople.LOADING_HTML+'<div id="zp_feedntfn_listcont"><div class="zpl_mnotimain" id="zp_feedntfn_listdiv"></div></div></div></div></div>');$("#page-wrapper").append(modal),ZPeople.FireScroll.init(ZPFeeds.Notifications.getMoreNotifications,"zpntfn_modal",{mode:"ntfn_fs"}),Layout.PageUtil.loadFiles(ZPFeeds.LoadFiles,ZPFeeds.Notifications.get)}else $("#zpntfn_modal").remove(),$("#zpntfn_detail_modal").remove(),ZPFeeds.SINGLEPOP=!1;$("#zpntfn_modal").off("click"),$("#zpntfn_modal").on("click",function(event){"zpntfn_modal"==event.target.id&&$("#zpntfn_modal").length>0&&$("#zpntfn_modal").remove()})},markAllAsRead:function(){0!==People.NTFN_CNT&&(People.NTFN_CNT=0,$("#zp_feedntfn_listdiv").children().removeClass("zpl_unread"),$("#zpntfn_modal").find("#zpntfn_markread").addClass("DN"),ZPeople.Request.send("/feedActions.zp",{actionType:"RESET_BADGE_COUNT"},People.Uns.handleCount))},removeDetailDiv:function(){var modal=$("#zpntfn_detail_modal");modal.remove(),ZPFeeds.SINGLEPOP=!1,$("#zp_feedntfn_listdiv").find(".zpl_act").removeClass("zpl_act"),setTimeout(function(){$(modal).remove()},500)},get:function(morekey){var params={ntfnCha:"UNS",count:15,morekey:morekey,actionType:"GET_NOTIFICATION_LIST",lastNtfnTime:People.Uns.LAST_NTFN_TIME};ZPeople.Request.send("/feedActions.zp",params,ZPFeeds.Notifications.handleNtfnResponse,void 0===morekey?{renderType:"pre"}:{renderType:"more"})},handleNtfnResponse:function(data,params,otherDtls){$("#zpntfn_modal").find("#zp_page_loading").remove(),"failure"!==data&&(People.Uns.LAST_NTFN_TIME=data.lastNotificationTime,People.NTFN_CNT>0&&0==data.ntfnlist&&void 0==params.morekey&&ZPFeeds.Notifications.markAllAsRead()),AcsApi.handleCallBack("getntfnlist",data,otherDtls)},getMoreNotifications:function(){if(AcsApi.isMoreAvailable(ZPFeeds.Notifications.MOREKEY)){var params={ntfnCha:"UNS",count:10,morekey:ZPFeeds.Notifications.MOREKEY,actionType:"GET_NOTIFICATION_LIST"};ZPeople.Request.send("/feedActions.zp",params,ZPFeeds.Notifications.handleNtfnResponse,{renderType:"more"})}},getUserName:function(userDtl){if(void 0!==userDtl)return userDtl.name},singleFeed:function(Obj){var fdk=$(Obj).find("#actfdk").val(),skey=$(Obj).find("#actskey").val();skey=ZPUtil.Validation.isEmpty(skey)||"undefined"==skey?void 0:skey;var subKeys=$(Obj).data("subkeys"),isLike=$(Obj).find("#isLike").val();isLike=ZPUtil.Validation.isEmpty(isLike)||"undefined"==isLike?"false":isLike;var mapObj,cmtfdk=$(Obj).find("#cmtfdk").val();if(cmtfdk=ZPUtil.Validation.isEmpty(cmtfdk)||"undefined"==cmtfdk?void 0:cmtfdk,0===$("#zpntfn_detail_modal").length){var modal=$('<div class="zpl_mdl zpl_msec zpl_mnotidetal zpl_mopen" id="zpntfn_detail_modal"><div class="zpl_minr"><div class="zpl_mhder"><div></div><a class="_cls PI_argt" onclick="ZPFeeds.Notifications.removeDetailDiv()"></a></div><div class="zpl_mcnt"><div class="zp-fd-wrpr" id="zp_modal_body"><div id=\'zp_page_loading\'>'+ZPeople.LOADING_HTML+"</div></div></div></div></div>");$("#page-wrapper").append(modal),$("#zpntfn_detail_modal").off("click"),$("#zpntfn_detail_modal").on("click",function(event){"zpntfn_detail_modal"==event.target.id&&$("#zpntfn_detail_modal").length>0&&($("#zpntfn_detail_modal").remove(),$("#zp_feedntfn_listdiv").find(".zpl_act").removeClass("zpl_act"),ZPFeeds.SINGLEPOP=!1)})}else $("#zp_feedntfn_listdiv").find(".zpl_act").removeClass("zpl_act"),$("#zpntfn_detail_modal").find("#zp_modal_body").html("<div id='zp_page_loading'>"+ZPeople.LOADING_HTML+"</div>");if(void 0!==mapObj&&mapObj.length>0){var actKey=$(Obj).find("#ntfn_actkey").val(),isComment=!1;if(fdk!==ZPFeeds.Notifications.MAPPED_OBJECT){ZPFeeds.Notifications.MAPPED_OBJECT=fdk;var finalColor="#FFF",scrollheight=Layout.Page.container.find('[scroll="enabled"]').scrollTop(),topPos=mapObj.position().top;scrollheight>0?topPos=scrollheight+topPos:topPos-=scrollheight,mapObj.find("#"+ZPUtil.escapeSelector(actKey)).length>0&&(isComment=!0,topPos+=(mapObj=mapObj.find("#"+ZPUtil.escapeSelector(actKey))).position().top,finalColor="#f6f7f8"),Layout.Page.container.find("[scroll=enabled]").animate({scrollTop:topPos-100},500),isComment||(mapObj=mapObj.find("#activity_right_content")),mapObj.css("background-color","#fffcf0"),mapObj.animate({backgroundColor:finalColor},2e3,function(){$(this).removeAttr("style")})}else{finalColor="#FFF";mapObj.find("#"+ZPUtil.escapeSelector(actKey)).length>0&&(isComment=!0,topPos+=(mapObj=mapObj.find("#"+ZPUtil.escapeSelector(actKey))).position().top,finalColor="#f6f7f8"),isComment||(mapObj=mapObj.find("#activity_right_content")),mapObj.css("background-color","#fffcf0"),mapObj.animate({backgroundColor:finalColor},5e3,function(){$(this).removeAttr("style")})}}else{var isread=!1;$(Obj).hasClass("zpl_unread")&&(isread=!0);var params={actionType:"GET_SINGLE_FEED",fdk:fdk,viewKey:ZPeople.VIEWKEYS.ALL};$(Obj).addClass("zpl_act"),$(Obj).removeClass("zpl_unread"),ZPeople.Request.send(ZPFeeds.URL,params,ZPFeeds.Notifications.showNTFNFeed,{fdk:fdk,skey:skey,isRead:isread,subKeys:subKeys,isLike:isLike,cmtfdk:cmtfdk})}},handleNtfnRead:function(data,params,others){1==data.success&&(People.NTFN_CNT=People.NTFN_CNT-others,People.NTFN_CNT>=0?People.Uns.handleCount(People.NTFN_CNT):People.Uns.handleCount(0))},showNTFNFeed:function(data,params,otherDtl){if(data.success){var modal=$("#zpntfn_detail_modal");if("true"==data.actJson.deleted)modal.find("#zp_modal_body").html('<div class="zpl_crd zpl_nodata" id="zp_feeds_nodata"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"> <div> <div class="zpl_emptimg zp_nd_faq"></div> <h4>'+ZPI18N.getString("zp.activitygotdeleted")+"</h4> </div> </div> </div> </div>");else{ZPFeeds.SINGLEPOP=!0;var actActObj=new Activity(data.actJson),activity=new People.Activity(actActObj);activity.type===People.Survey.type?$.when(ZDOMEEAPI.api.getAnsweredSurveys()).then(function(){ZPFeeds.Notifications.handleNTFNFeed(activity,otherDtl)}):(ZPFeeds.Notifications.handleNTFNFeed(activity,otherDtl),void 0!==data.likedUsrs&&Object.keys(data.likedUsrs).length>0&&ZPFeeds.Like.iterateLikedUsers(data.likedUsrs))}}else"PERMISSION_DENIED"===data.message?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.permdenied")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")),ZPFeeds.Notifications.removeDetailDiv();if(1==otherDtl.isRead){params={actionType:"MARK_NOTIFICATION_ASREAD",fdk:"undefined"!==otherDtl.fdk?otherDtl.fdk:void 0,skey:"undefined"!==otherDtl.skey?otherDtl.skey:void 0,isRead:otherDtl.isRead,cmtfdk:"undefined"!==otherDtl.cmtfdk?otherDtl.cmtfdk:void 0};var others={cnt:1};void 0!==otherDtl.subKeys&&"undefined"!==otherDtl.subKeys&&(params.subKeys=JSON.stringify(otherDtl.subKeys),others.cnt=otherDtl.subKeys.length+1),"undefined"!==otherDtl.isLike?params.isLike=otherDtl.isLike:params.isLike=!1,ZPeople.Request.send(ZPFeeds.URL,params,ZPFeeds.Notifications.handleNtfnRead,others.cnt)}$(".modal-backdrop.in").off("click"),$(".modal-backdrop.in").on("click",function(){$("#zpntfn_detail_modal").length>0?$("#zpntfn_detail_modal").remove():$("#zpntfn_modal").length>0&&$("#zpntfn_modal").remove()})},handleNTFNFeed:function(activity,otherDtl){activity.page="ntfn",ZPFeeds.setCommentedUserDetails(activity.comments);var actContObj=ZPFeeds.Construction.constructFeedsTemplates(activity);$("#zpntfn_detail_modal").find("#zp_modal_body").html(""),$("#zpntfn_detail_modal").find("#zp_modal_body").append(actContObj),$(".cboxElement").off("click"),$(".cboxElement").on("click",function(event){$(event.target).hasClass("filedwn")||ZPFeeds.registerAttPreview(event,this,activity.actRecId)});var bodyObj=$("#zpntfn_detail_modal").find("#zp_modal_body");if(void 0!==otherDtl.cmtfdk){var mapObj=bodyObj.find("#cmtlistcont").find("#"+otherDtl.cmtfdk);if(mapObj.length>0){var scrollheight=bodyObj.scrollTop(),topPos=mapObj.position().top;scrollheight>0?topPos=scrollheight+topPos:topPos-=scrollheight,bodyObj.animate({scrollTop:topPos-100},500),mapObj.css("background-color","#fffcf0"),mapObj.animate({backgroundColor:"#FFF"},2e3,function(){$(this).removeAttr("style")})}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.commentgotdeleted"))}},closeDetailDiv:function(){$("#zp_feedntfn_listdiv").find(".zpl_act").removeClass("zpl_act")}},ZPFeeds.Like={FEEDSLOADED:!1,FEEDSLIKEDATA:void 0,HIDE_LIKE_POPUP:!1,LIKEPOP_INTERVAL:null,POP_INTERVAL:null,isLikeAllowed:function(type,isEmoji){return 1!=isEmoji||"Approval"!==type},registerLikeOptions:function(tempObj,actRecId,type,isComment,isFromAnn){void 0!==tempObj&&$(tempObj).length>0&&(tempObj=$(tempObj)[0],!ZPeople.onBoardingStatus&&ZPFeeds.Like.isLikeAllowed(type,!0)&&(tempObj.onmouseenter=function(event){ZPFeeds.Like.LIKEPOP_INTERVAL=setTimeout(function(){ZPFeeds.Like.getLikeOptions($(tempObj),actRecId,type,isComment,isFromAnn)},350)},tempObj.onmouseleave=function(event){ZPFeeds.Like.HIDE_LIKE_POPUP=!0,clearInterval(ZPFeeds.Like.LIKEPOP_INTERVAL),setTimeout(function(){ZPFeeds.Like.hideDetailPopup()},100)}),tempObj.onclick=function(event){event.stopPropagation(),ZPFeeds.Like.HIDE_LIKE_POPUP=!0,clearInterval(ZPFeeds.Like.LIKEPOP_INTERVAL),isFromAnn?Announcement.doLikeAction($(tempObj)):ZPFeeds.Like.doLikeAction($(tempObj),actRecId,type,isComment),ZPFeeds.Like.hideDetailPopup()})},unregisterLikeOptions:function(tempObj){void 0!==tempObj&&$(tempObj).length>0&&((tempObj=$(tempObj)[0]).onmouseenter=void 0,tempObj.onmouseleave=void 0,tempObj.onclick=void 0)},hideDetailPopup:function(){ZPFeeds.Like.HIDE_LIKE_POPUP&&($("#liketypediv").removeClass("zp_emjShw"),setTimeout(function(){$("#liketypediv").remove()},100))},handlePopupShowHide:function(event){"mouseenter"===event.type?ZPFeeds.Like.HIDE_LIKE_POPUP=!1:ZPFeeds.Like.HIDE_LIKE_POPUP=!0},getLikeOptions:function(Obj,actRecId,type,isComment,isFromAnn){if(0==$(Obj).find("#liketypediv").length){var likehtml=$('<div class="zp_emjCon zp_emjShw" id="liketypediv"><ul class="zp_emjList clearfix zp_anim"><li class="emj_aniItm" type="0"><i class="zpl_like"></i></li><li class="emj_aniItm" type="1"><i class="zpl_love"></i></li><li class="emj_aniItm" type="2"><i class="zpl_haha"></i></li><li class="emj_aniItm" type="3"><i class="zpl_wow"></i></li><li class="emj_aniItm" type="4"><i class="zpl_sad"></i></li><li class="emj_aniItm" type="5"><i class="zpl_angry"></i></li></ul> </div>');$(Obj).find("span").length>0?$(Obj).find("span").after(likehtml):$(Obj).append(likehtml),setTimeout(function(){$(Obj).find("#liketypediv").addClass("zp_emjShw")},100),$(Obj).find("#liketypediv").find("li.emj_aniItm").on("click",function(event){clearInterval(ZPFeeds.Like.LIKEPOP_INTERVAL),ZPFeeds.Like.HIDE_LIKE_POPUP=!0,event.stopPropagation(),!0!==isFromAnn?ZPFeeds.Like.doLikeAction(Obj,actRecId,type,isComment,$(this).attr("type")):Announcement.doLikeAction(Obj,$(this).attr("type")),$(Obj).find("#liketypediv").remove(),ZPFeeds.Like.hideDetailPopup()}),ZPFeeds.Like.HIDE_LIKE_POPUP=!1,$(Obj).find("#liketypediv").mouseenter(function(){ZPFeeds.Like.HIDE_LIKE_POPUP=!1,clearInterval(ZPFeeds.Like.LIKEPOP_INTERVAL)}),$(Obj).find("#liketypediv").mouseleave(function(){ZPFeeds.Like.HIDE_LIKE_POPUP=!0,clearInterval(ZPFeeds.Like.LIKEPOP_INTERVAL)})}},removeLikeOptions:function(){$("#liketypediv").removeClass("zp_emjShw"),setTimeout(function(){$("#liketypediv").remove()},300)},handleGetLikedUsersResponse:function(data,params,otherDetails){if(void 0!==data&&!0===data.success)if(ZPFeeds.Like.FEEDSLOADED)ZPFeeds.Like.FEEDSLOADED=!0,ZPFeeds.Like.iterateLikedUsers(data);else if(ZPFeeds.Like.FEEDSLIKEDATA=data,!0===ZPFeeds.Like.FEEDSLOADED&&void 0!==otherDetails&&!0===otherDetails.isMoreComments){var likeData=ZPFeeds.Like.FEEDSLIKEDATA;ZPFeeds.Like.FEEDSLIKEDATA=void 0,ZPFeeds.Like.iterateLikedUsers(likeData)}},doLikeAction:function(Obj,actId,type,isComment,liketype){if(!ZPUtil.Validation.isEmpty(actId)&&!ZPUtil.Validation.isEmpty(type)){var params={actionType:"LIKE_UNLIKE_ACTIVITY",type:type,actId:actId};-1!=$(Obj).attr("action")&&void 0===liketype&&(liketype=0),params.like_type=liketype>=0&&liketype<=5?liketype:-1,!0===isComment&&(params.cmtId=$(Obj).parents("[commentid]").attr("commentid")),type===People.Status.type&&ZPeople.onBoardingStatus?ZPOnboarding.Feeds.likeActivityResponse(!isComment,$(Obj)):type===People.Task.type?TaskCommon.likeActionforCurrUser(!isComment,$(Obj),liketype):(type==People.Approval.type&&ZPApprovals.RECORDID&&(ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].refresh=!0),ZPFeeds.Like.LikeActionforCurrUser(!isComment,$(Obj),liketype)),ZPeople.Request.send(ZPFeeds.URL,params)}},LikeActionforCurrUser:function(isActivity,Obj,liketype){var recordId,curActContainer,likeDtl,likedUserDtls;void 0!==liketype&&(liketype=parseInt(liketype)),isActivity?(recordId=Obj.parents("div#actOuterCont").attr("streamid"),container=$.find("[streamid='"+recordId+"']")):(recordId=Obj.parents("div.zp-cmtdiv").attr("commentId"),container=$.find("[commentid='"+recordId+"']"));for(var isSelfRemove=!1,isRemove=!1,objCnt=0;objCnt<container.length;objCnt++){var likeData=(curActContainer=$(container[objCnt])).data("likeData");if(void 0===(likedUserDtls=curActContainer.data("likedUserDtls"))&&(likedUserDtls={}),void 0===likeData&&(likeData=[]),-1==Obj.attr("action")&&void 0===liketype){if(void 0===likeData[0])isRemove=!0,likeData[0]="",likeData[1]=0,likeData[3]=[];else if(void 0!==likeData[0]){var userIds=likeData[0],temp=ZPFeeds.Like.removeDupFromArray(userIds.toString().split(",")),typeArr=likeData[3];typeArr=ZPFeeds.Like.refreshArr(typeArr),-1!==temp.indexOf(erecno)&&(delete typeArr[userIds.indexOf(erecno)],delete temp[temp.indexOf(erecno)],temp=ZPFeeds.Like.refreshArr(temp),typeArr=ZPFeeds.Like.refreshArr(typeArr),0==temp.length?isRemove=!0:isSelfRemove=!0,likeData[0]=temp.join(),likeData[1]=parseInt(likeData[1])-1,likeData[3]=typeArr)}}else{if(void 0===likeData[0])likeData[0]=erecno,likeData[1]=1,likeData[3]=[liketype+""],likedUserDtls[erecno]={empName:ZPeople.CURR_USER.name};else if(void 0!==likeData[0]){userIds=likeData[0],typeArr=likeData[3];typeArr=ZPFeeds.Like.refreshArr(typeArr),-1!==(temp=ZPFeeds.Like.removeDupFromArray(userIds.toString().split(","))).indexOf(erecno)?typeArr.splice(temp.indexOf(erecno),1,liketype+""):(temp.unshift(erecno),typeArr.unshift(liketype+""),likeData[1]=parseInt(likeData[1])+1),likeData[0]=temp.join(),likeData[3]=typeArr,likedUserDtls[erecno]={empName:ZPeople.CURR_USER.name}}curActContainer.data("likeData",likeData)}likeDtl=likeData}isRemove?ZPFeeds.Like.refreshLikeContainer(recordId,isActivity,isSelfRemove):(isSelfRemove&&ZPFeeds.Like.refreshLikeContainer(recordId,isActivity,isSelfRemove),ZPFeeds.Like.constructLikedUsers(recordId,likeDtl,isActivity,likedUserDtls))},refreshArr:function(array){var newArr=[];if(void 0!==array&&array.length>0){for(var i=0;i<array.length;i++){var val=array[i];void 0!==val&&""!=(val+="").trim()&&newArr.push(val+"")}return newArr}return newArr},refreshLikeContainer:function(recordId,isActivity,isSelfremove){var curActContainer;container=isActivity?$.find("[streamid='"+recordId+"']"):$.find("[commentid='"+recordId+"']");for(var objCnt=0;objCnt<container.length;objCnt++)(curActContainer=$(container[objCnt])).removeData("likeData"),curActContainer.removeData("likedUserDtls"),isActivity?(curActContainer.find("#zplike_link").removeAttr("class").addClass("zp-post-like"),curActContainer.find("#zplike_link").attr("action","0"),curActContainer.find("#zplike_link").find("span").text(ZPI18N.getString("zp.like")),curActContainer.find("#zplike_link").find("i").remove(),curActContainer.find("#bottomcont").find("#zplike_container").html("").addClass("DN")):(curActContainer.find("#zpcmt_like_link").attr("action","0"),curActContainer.find("#zpcmt_like_link").text(ZPI18N.getString("zp.like")),curActContainer.find("#zpcmt_like_link").parents(".zp-cmt-uaction").removeAttr("class").addClass("zp-cmt-uaction "),isSelfremove||curActContainer.find("#cmt_liked_usrs").length>0&&curActContainer.find("#cmt_liked_usrs").remove())},iterateLikedUsers:function(data){void 0!==data&&(void 0!==data.moreKey&&(ZPFeeds.CURRENT_MOREKEY=data.moreKey),void 0!==data.statusIds&&Object.keys(data.statusIds).length>0&&$.each(data.statusIds,function(key,value){value.length>0?ZPeople.onBoardingStatus?ZPOnboarding.Feeds.constructLikersName(key,value,!0,data.likedUserDtls):ZPFeeds.Like.constructLikedUsers(key,value,!0,data.likedUserDtls):ZPeople.onBoardingStatus||ZPFeeds.Like.constructEmptyLikedUsers(key,!0)}),void 0!==data.commentIds&&Object.keys(data.commentIds).length>0&&$.each(data.commentIds,function(key,value){value.length>0?ZPeople.onBoardingStatus?ZPOnboarding.Feeds.constructLikersName(key,value,!1,data.likedUserDtls):ZPFeeds.Like.constructLikedUsers(key,value,!1,data.likedUserDtls):ZPeople.onBoardingStatus||ZPFeeds.Like.constructEmptyLikedUsers(key,!1)}))},removeDupFromArray:function(array){for(var uniqueVals=[],arrCnt=0;arrCnt<array.length;arrCnt++){var id=array[arrCnt].trim().toString();""!==id&&-1===uniqueVals.indexOf(id)&&id!==erecno&&uniqueVals.push(id)}return-1!==array.indexOf(erecno)&&uniqueVals.unshift(erecno),uniqueVals},constructEmptyLikedUsers:function(recordId,isActivity){var container,curActContainer;container=isActivity?$.find("[streamid='"+recordId+"']"):$.find("[commentid='"+recordId+"']");for(var objCnt=0;objCnt<container.length;objCnt++)curActContainer=$(container[objCnt]),isActivity?curActContainer.find("#zplike_container").html("").addClass("DN"):curActContainer.find("#cmt_liked_usrs").length>0&&(curActContainer.find("#cmt_liked_usrs")[0].previousSibling.remove(),curActContainer.find("#cmt_liked_usrs").remove())},constructLikedUsers:function(recordId,likersdtl,isActivity,likedUserDtls){var container;if(void 0!==likersdtl){var likedusrArr=likersdtl[0].toString().split(","),userIds=ZPFeeds.Like.removeDupFromArray(likedusrArr),likersCnt=likersdtl[1];container=isActivity?$.find("[streamid='"+recordId+"']"):$.find("[commentid='"+recordId+"']");for(var curActContainer,morelikers=function(){return ZPFeeds.Like.getMoreLikedUsers(recordId,isActivity)},objCnt=0;objCnt<container.length;objCnt++){var usrDtl;if((curActContainer=$(container[objCnt])).data("likeData",likersdtl),curActContainer.data("likedUserDtls",likedUserDtls),isActivity&&(curActContainer.find("#zplike_container").removeClass("DN"),curActContainer.find("#zplike_container").addClass("zp-fd-Ereact"),curActContainer.find("#zplike_container").html('<li><div class="zp_emjReact" id="liketypes">'+ZPFeeds.Like.getListOfLikeHtml(likersdtl[3],likedusrArr.indexOf(erecno))+"</div></li>")),userIds.length>0&&curActContainer.length>0)if(isActivity){for(var Obj="",usrCnt=0;usrCnt<userIds.length;usrCnt++){usrDtl=likedUserDtls[userIds[usrCnt]];var currUsrLikeObj=ZPFeeds.Like.getLikeTypeClass(likersdtl[3],likedusrArr.indexOf(userIds[usrCnt]));if(Obj+="<a "+("true"===ZPeople.isSearchAllowed?' empid="'+userIds[usrCnt]+'"':"")+' popup="user" ltype="'+currUsrLikeObj.type+'" isusrzuid="false" class="'+(usrCnt>2?"DNI":"likers")+'"> '+(userIds[usrCnt]!==erecno?usrDtl.empName:ZPI18N.getString("zp.you"))+"</a>",userIds[usrCnt]===erecno&&(curActContainer.find("#zplike_link").removeAttr("class"),curActContainer.find("#zplike_link").attr("action","-1").addClass(currUsrLikeObj.textclname),curActContainer.find("#zplike_link").find("span").text(currUsrLikeObj.text),curActContainer.find("#zplike_link").find("span").before(ZPFeeds.Like.getLikeIconHTML(currUsrLikeObj.type))),userIds.length>2&&2===usrCnt&&likersCnt-3!=0){usrDtl=likedUserDtls[userIds[usrCnt+=1]],currUsrLikeObj=ZPFeeds.Like.getLikeTypeClass(likersdtl[3],likedusrArr.indexOf(userIds[usrCnt])),Obj+="<a "+("true"===ZPeople.isSearchAllowed?' empid="'+userIds[usrCnt]+'"':"")+' popup="user" ltype="'+currUsrLikeObj.type+'" isusrzuid="false" class="DNI"> '+(userIds[usrCnt]!==erecno?usrDtl.empName:ZPI18N.getString("zp.you"))+"</a>",Obj+='<div class="zp-more-likes"  id="moreLikers" count="'+likersCnt+'"><span> & </span><span>'+(likersCnt-3)+" "+ZPI18N.getString("zp.smore")+"</span></div>";break}}Obj=$(Obj),curActContainer.find("#bottomcont").find("#zplike_container").removeClass("DN"),curActContainer.find("#bottomcont").find("#zplike_container").find("li").append(Obj),curActContainer.find("#bottomcont").find("#zplike_container").find("li").find("#moreLikers").click(morelikers),curActContainer.find("#bottomcont").find("#zplike_container").find("li").find("#liketypes").click(morelikers)}else{Obj=$('<li data-toggle="tooltip" data-placement="top" data-html="true" data-container="body" class="cmtReact" id="cmt_liked_usrs" count='+likersCnt+'> <div class="zp_emjReact"  id="liketypes">'+ZPFeeds.Like.getListOfLikeHtml(likersdtl[3],likedusrArr.indexOf(erecno))+'</div> <span id="countdiv">'+likersCnt+"</span> </li>").click(morelikers);var likeObj="<div class='liked-list'>";for(usrCnt=0;usrCnt<userIds.length;usrCnt++){usrDtl=likedUserDtls[userIds[usrCnt]];currUsrLikeObj=ZPFeeds.Like.getLikeTypeClass(likersdtl[3],likedusrArr.indexOf(userIds[usrCnt]));if(likeObj+="<span"+(usrCnt>10?' class="DN"':"")+' empid="'+userIds[usrCnt]+'" ltype="'+currUsrLikeObj.type+'">'+usrDtl.empName+"</span>",userIds[usrCnt]===erecno&&(curActContainer.find("#zpcmt_like_link").attr("action","-1"),curActContainer.find("#zpcmt_like_link").text(currUsrLikeObj.text),curActContainer.find("#zpcmt_like_link").parents(".zp-cmt-uaction").removeAttr("class").addClass("zp-cmt-uaction "+currUsrLikeObj.textclname)),userIds.length>9&&9===usrCnt&&likersCnt>10){likersCnt-=10,likeObj+="<span id='morelikers'>"+ZPI18N.getString("zp.and",[""])+" "+likersCnt+" "+ZPI18N.getString("zp.smore")+"</span>";break}likeObj+="<br>"}likeObj+="</div>",(Obj=Obj.attr("title",likeObj)).ztooltip({innerHTML:likeObj,displayType:"callout",isMessageHTMLEncoded:!0}),curActContainer.find("#cmt_liked_usrs").length>0&&curActContainer.find("#cmt_liked_usrs").remove(),curActContainer.find("#zpcmt_like_link").after(Obj)}}}},getListOfLikeHtml:function(typeArr,currUserIndex){var html="";if(void 0!==typeArr){var uniqArr=[];-1!==currUserIndex&&uniqArr.unshift(typeArr[currUserIndex]);for(var i=0;i<typeArr.length;i++)-1===uniqArr.indexOf(typeArr[i])&&uniqArr.length<3&&uniqArr.push(typeArr[i]);for(var j=0;j<uniqArr.length;j++)html+='<span class="recn_emj zp_smlBg" itype="'+uniqArr[j]+'">'+ZPFeeds.Like.getLikeIconHTML(uniqArr[j])+"</span>"}return html},getLikeIconHTML:function(type,likeObj,extraclass){return void 0===likeObj&&(likeObj=ZPFeeds.Like.getLikeClassObj(type)),'<i class="recn_emj '+likeObj.classname+" "+(void 0!==extraclass?extraclass:"")+'"></i>'},getLikeTypeClass:function(typeArr,userIndex){void 0!==typeArr&&"string"==typeof typeArr&&(typeArr=JSON.parse(typeArr));var liketype=0;typeArr.length>0&&(liketype=typeArr[userIndex]);var likeObj=ZPFeeds.Like.getLikeClassObj(liketype);return likeObj.type=liketype,likeObj},getLikeClassObj:function(type,classname){var likeObj={};return"0"==type||"LikeImg"==classname?(likeObj.classname="zpl_like",likeObj.textclname="LikeImg",likeObj.text=ZPI18N.getString("zp.liked"),likeObj.type="0"):"1"==type||"LoveImg"==classname?(likeObj.classname="zpl_love",likeObj.textclname="LoveImg",likeObj.text=ZPI18N.getString("zp.love"),likeObj.type="1"):"2"==type||"HahaImg"==classname?(likeObj.classname="zpl_haha",likeObj.textclname="HahaImg",likeObj.text=ZPI18N.getString("zp.haha"),likeObj.type="2"):"3"==type||"WowImg"==classname?(likeObj.classname="zpl_wow",likeObj.textclname="WowImg",likeObj.text=ZPI18N.getString("zp.wow"),likeObj.type="3"):"4"==type||"SadImg"==classname?(likeObj.classname="zpl_sad",likeObj.textclname="SadImg",likeObj.text=ZPI18N.getString("zp.sad"),likeObj.type="4"):"5"==type||"AngryImg"==classname?(likeObj.classname="zpl_angry",likeObj.textclname="AngryImg",likeObj.text=ZPI18N.getString("zp.angry"),likeObj.type="5"):(likeObj.classname="zp-post-like",likeObj.textclname="",likeObj.text=ZPI18N.getString("zp.like"),likeObj.type="0"),likeObj},getMoreLikedUsers:function(id,isActivity,acttype){var actId=isActivity?id:void 0,cmtId=isActivity?void 0:id;ZPeople.Request.send("/feedActions.zp",{actId:actId,cmtId:cmtId,actionType:"GETALL_LIKED_USERS",activityType:acttype},ZPFeeds.Like.showAllLikedUsers,{isActivity:isActivity})},showAllLikedUsers:function(data,params,otherdetails){void 0!=data.likedUserDtls&&((otherdetails.isActivity?$("[streamid="+params.actId+"]"):$("[commentid="+params.cmtId+"]")).find("[id=cmt_liked_usrs]").tooltip("destroy"),$.each(otherdetails.isActivity?data.statusIds:data.commentIds,function(key,value){var userIds=value[0].toString().split(","),typeArr=value[3];void 0!==typeArr&&"string"==typeof typeArr&&(typeArr=JSON.parse(typeArr));for(var bodyHtml=$('<ul class="zp_MemLst">'+ZPFeeds.Like.getLikeTypeBodyHTML(userIds,typeArr,data.likedUserDtls)+" </ul>"),headerHtml='<li class="active" htype="All">'+ZPI18N.getString("zp.all")+"<span>"+bodyHtml.find("li").length+"</span></li>",i=0;i<6;i++)bodyHtml.find("li[type='"+i+"']").length>0&&(headerHtml+='<li htype="'+i+'">'+ZPFeeds.Like.getLikeIconHTML(i,void 0,"zp_Emj")+"<span>"+bodyHtml.find("li[type='"+i+"']").length+"</span></li>");var html=$('<div class="zp_midlPop zp_PopView zp_rlPopup" id="zpfeeds_like_modal"> <div class="clearfix zp_scrlPopCon"> <div class="zp_PopOutrCon"> <div class="zp_PopInnrCon"> <a class="zp_PopCls IC-cls" id="closeicon"></a> <div class="zp_Pophdr"> <span>'+(otherdetails.isActivity?ZPI18N.getString("zp.peoplewhohavelikedthispost"):ZPI18N.getString("zp.peoplewhohavelikedthiscomment"))+'</span> <ul class="reactLstPop"></ul> </div> <div class="zp_Popcontainer" id="bodycont"></div><div id="dummydiv" class="DNI"></div> </div> </div> </div> </div>');html.find(".reactLstPop").html(headerHtml),html.find("#bodycont").html(bodyHtml),html.find("#dummydiv").html(html.find("#bodycont").find(".zp_MemLst").clone()),html.find("#closeicon").on("click",function(){$("body").find("#zpfeeds_like_modal").removeClass("open"),setTimeout(function(){$("body").find("#zpfeeds_like_modal").remove()},50)}),html.find(".reactLstPop").find("li").on("click",function(){$("body").find("#zpfeeds_like_modal").find(".zp_Popcontainer").html(ZPeople.LOADING_HTML);var likeModal=$("body").find("#zpfeeds_like_modal");$(this).siblings().removeClass("active");var activeHdr=$(this).attr("htype");$(this).parent().find("li[htype='"+activeHdr+"']").addClass("active");var bodyHtml="";if("All"!==activeHdr){(bodyHtml=$('<ul class="zp_MemLst"></ul>')).html(likeModal.find("#dummydiv").find("[type='"+activeHdr+"']").clone());var classObj=ZPFeeds.Like.getLikeClassObj(activeHdr);bodyHtml.find("i."+classObj.classname).remove()}else bodyHtml=likeModal.find("#dummydiv").children().clone();likeModal.find(".zp_Popcontainer").html(bodyHtml)}),$("body").append(html),setTimeout(function(){$("body").find("#zpfeeds_like_modal").addClass("open")},50)}))},removeLikeModal:function(){$("body").find("#zpfeeds_like_modal").removeClass("open"),setTimeout(function(){$("body").find("#zpfeeds_like_modal").remove()},50)},getLikeTypeBodyHTML:function(userIds,typeArr,userDtls,type){for(var bodyHtml="",likeType=0,usrCnt=0;usrCnt<userIds.length;usrCnt++)void 0===type&&(likeType=typeArr[usrCnt]),bodyHtml+='<li type="'+likeType+'" > <a href="javascript:;" '+("true"===ZPeople.isSearchAllowed?"onclick=\"ZPFeeds.Like.removeLikeModal();ZPeople.getUserPage('"+userIds[usrCnt]+"');\"":"")+'><span class="zp_avtr">'+(void 0===type?ZPFeeds.Like.getLikeIconHTML(likeType):"")+'<img class="zp-uimg" src="'+userDtls[userIds[usrCnt]].empPhoto+'"> </span> <span>'+userDtls[userIds[usrCnt]].empName+"</span> </a> </li>";return bodyHtml},handleLikeNtfn:function(data){ZPFeeds.Like.iterateLikedUsers(data)},handleLoadedFeedLikeDatas:function(isActivity,recordId){var likeObj;void 0!==ZPFeeds.Like.FEEDSLIKEDATA&&(!0===isActivity&&void 0!==ZPFeeds.Like.FEEDSLIKEDATA.statusIds&&Object.keys(ZPFeeds.Like.FEEDSLIKEDATA.statusIds).length>0?likeObj=ZPFeeds.Like.FEEDSLIKEDATA.statusIds[recordId]:void 0!==ZPFeeds.Like.FEEDSLIKEDATA.commentIds&&Object.keys(ZPFeeds.Like.FEEDSLIKEDATA.commentIds).length>0&&(likeObj=ZPFeeds.Like.FEEDSLIKEDATA.commentIds[recordId]),void 0!==likeObj&&ZPFeeds.Like.constructLikedUsers(recordId,likeObj,isActivity,ZPFeeds.Like.FEEDSLIKEDATA.likedUserDtls))},loadLikeWithStoredData:function(){if(ZPFeeds.Like.FEEDSLOADED=!0,void 0!==ZPFeeds.Like.FEEDSLIKEDATA){var data=ZPFeeds.Like.FEEDSLIKEDATA;ZPFeeds.Like.FEEDSLIKEDATA=void 0,ZPFeeds.Like.iterateLikedUsers(data)}}},ZPFeeds.Activity={linkFormation:0,DEPTNAMES:{},GROUPSNAMES:{},checkReqNeeded:function(actType,activityObj){return!(actType!=People.Status.type&&actType!=People.Feedback.type||!activityObj.ap_seemore)||(!(actType!=People.HrCase.type||!activityObj.seemoredesc)||actType==People.Training.type)},getActivity:function(renderType,viewkey,activityObj,append,activityObj){if(void 0!=activityObj){let actRecId=activityObj.actRecId,actType=activityObj.type,isReqNeeded=ZPFeeds.Activity.checkReqNeeded(actType,activityObj);if(null!=actRecId&&void 0!=actType&&isReqNeeded){var params={actionType:"GET_ACTIVITY",actRecId:actRecId,actType:actType,viewKey:ZPeople.CURRENT_VIEWKEY,fdk:activityObj.fdk,hasSeemore:activityObj.ap_seemore};ZPeople.Request.sendAsyncPost("/feedActions.zp",params,function(resultObj){if("false"!==resultObj.success){let fContent=resultObj.content;if(void 0!==fContent){if(!ZPUtil.Validation.isEmpty(fContent))for(var m,re=new RegExp("zp[[a-z]+(#|:).+?]zp","g");null!==(m=re.exec(fContent));){var source=m[0].split("zp[")[1].slice(0,-3),mentionId=source.split(":")[1];"peopleuser"===source.split(":")[0]&&People.pushFeedsUserList(mentionId)}actType==People.Status.type?(!0===activityObj.isHTML?(activityObj.content=ZPFeeds.Activity.validateContent(fContent,!1,activityObj.menDeptDetails,activityObj.menGrpDetails),activityObj.content=ZPFeeds.Activity.getImgAndCBoxClass(activityObj.content,activityObj.actRecId)):activityObj.content=ZPFeeds.Activity.filterTemplate(activityObj.content),activityObj.content=ZPFeeds.Activity.getMentions(activityObj.content,!1,activityObj.menDeptDetails,activityObj.menGrpDetails)):actType==People.HrCase.type?activityObj.desc=fContent:actType==People.Training.type&&(activityObj.content=fContent)}}})}ZPFeeds.Activity.constructActivityList(renderType,viewkey,activityObj,append)}},constructFeed:function(renderType,viewkey,activityObj,append){"push"==renderType?ZPFeeds.Activity.getActivity(renderType,viewkey,activityObj,append,activityObj):ZPFeeds.Activity.constructActivityList(renderType,viewkey,activityObj,append)},constructActivityList:function(renderType,viewkey,activityObj,append){try{if(ZPeople.onBoardingStatus&&("initstream"==renderType||"autocorrect"==renderType||activityObj.actRecId!=ZPOnboarding.onBoardingDetails.FEED_ID))return void("autocorrect"==renderType&&ZPOnboarding.constructFeeds(activityObj));if(null===Layout.Page.container&&!ZPeople.onBoardingStatus||"singlefeed"!==renderType&&void 0!==Layout.Page.urlparam["feeds-view"]&&0===Layout.Page.container.find("#"+ZPUtil.escapeSelector(activityObj.fdk)).length)return;if(activityObj.type===People.FeedbackRequest.type)return;var feedContainer;if(feedContainer=void 0!==viewkey&&ZPeople.CURRENT_VIEWKEY!==viewkey?$("[id='"+ZPUtil.escapeSelector(viewkey)+"']"):$("[id='"+ZPUtil.escapeSelector(ZPeople.CURRENT_VIEWKEY)+"']"),Layout.Page.container.find("#zp_page_loading").length>0&&Layout.Page.container.find("[id=zp_page_loading]").remove(),"initstream"!==renderType&&0==feedContainer.length&&(feedContainer=$("[id='"+ZPUtil.escapeSelector(ZPeople.VIEWKEYS.ALL)+"']")),feedContainer.length>0){var type=activityObj.type,actRecId=activityObj.actRecId,fdk=activityObj.fdk,isCommented=ZPFeeds.Comment.isCommented(activityObj);if("push"===renderType&&isCommented&&$("[streamId='"+actRecId+"']").length>0){var comment=[];comment.push(activityObj.comments[activityObj.comments.length-1]);for(var cmtContObj=$("[streamId='"+actRecId+"']"),objCnt=0;objCnt<cmtContObj.length;objCnt++)$(cmtContObj[objCnt]),ZPFeeds.Construction.constructComments(cmtContObj,activityObj,comment,!1);ZPFeeds.Comment.handleCommentCount(!1,fdk,activityObj.totalComments)}else{ZPFeeds.setCommentedUserDetails(activityObj.comments);var activityContObj=ZPFeeds.Construction.constructFeedsTemplates(activityObj,renderType);if(void 0!==activityContObj)if(feedContainer.find("#zp_feeds_nodata").length>0&&feedContainer.find("#zp_feeds_nodata").remove(),feedContainer.find("[streamid='"+actRecId+"']").length>0){var likeDtl=feedContainer.find("[streamid='"+actRecId+"']").data();$(feedContainer.find("[streamid='"+actRecId+"']")).replaceWith(activityContObj.data({likeData:likeDtl.likeData,likedUserDtls:likeDtl.likedUserDtls})),"autocorrect"!==renderType&&"Edit"!==renderType||(likeDtl.likeData?ZPFeeds.Like.constructLikedUsers(actRecId,likeDtl.likeData,!0,likeDtl.likedUserDtls):ZPeople.Request.send("/feedActions.zp",{viewKey:viewkey,count:1,actionType:"GET_LIKED_USERS",isActivity:0},ZPFeeds.Like.handleGetLikedUsersResponse))}else append?(feedContainer.append(activityContObj),void 0!==ZPFeeds.Like.FEEDSLIKEDATA&&ZPFeeds.Like.handleLoadedFeedLikeDatas(!0,activityObj.actRecId)):feedContainer.prepend(activityContObj)}if(void 0===Layout.Page.urlparam["feeds-view"]){if("Status"==type&&feedContainer.find("[streamid='"+actRecId+"']").length>0)(height=(Obj=feedContainer.find("[streamid='"+actRecId+"']").find("#middcontainer")).height())>400&&height-400>50&&(Obj.addClass("zp-fd-shwmore"),Obj.find("#zpfd_msgcont").length>0&&Obj.find("#zpfd_msgcont").append('<a class="zp-fd-shwlink">'+ZPI18N.getString("zp.fdseemore")+"</a>"));if(activityObj.comments.length>0)for(var cnt=0;cnt<activityObj.comments.length;cnt++){var Obj,height,commentId=activityObj.comments[cnt].commentId;if(feedContainer.find("[streamid='"+actRecId+"']").find("[commentid='"+commentId+"']").length>0)(height=(Obj=feedContainer.find("[streamid='"+actRecId+"']").find("[commentid='"+commentId+"']").find(".zp-cmt-udt")).height())>300&&height-300>50&&(Obj.addClass("zp-fd-shwmore"),Obj.append('<a class="zp-fd-shwlink">'+ZPI18N.getString("zp.fdseemore")+"</a>"))}$(".zp-fd-shwlink").off("click"),$(".zp-fd-shwlink").on("click",function(){ZPFeeds.removeShowMore(this)})}$(".cboxElement").off("click"),$(".cboxElement").on("click",function(event){$(event.target).hasClass("filedwn")||ZPFeeds.registerAttPreview(event,this,actRecId)}),"showmore"===renderType&&ZPeople.FireScroll.reset()}}catch(e){}},postStatus:function(){var curConObj=Layout.Page.container.find("#zp_dash_feedspost_container"),loaderObj=Layout.Page.container.find("#zp_dash_feedspost_container").find("#editor_container").find("#submitbtn");if(ZPFeeds.hasInValidContent(ZPFeeds.POSTEDITOR.getContent()))ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.unsupportedemojialert"));else{0===loaderObj.find("#loader").length&&loaderObj.append(ZPFeeds.MINILOADER),loaderObj.attr("disabled",!0);var content=ZPFeeds.getSmileysAndMentions(ZPFeeds.POSTEDITOR.getContent(),ZPeople.isSearchAllowed);content=ZPFeeds.removeTrailingEmptyDivs(content);var messageText=ZPFeeds.getTextContent(content),attachCnt=parseInt(curConObj.find("#zp_dash_attachments").attr("attachcnt")),title=curConObj.find("#zpfd_sts_title").val();if(ZPUtil.Validation.isEmpty(title)&&(title=void 0),0===messageText.length&&0===$("<div>").append(content).find("img").length&&0===attachCnt||messageText.length>15e3)return messageText.length>15e3&&ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.statuslengthwarning")),ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.POSTEDITOR,!1),void loaderObj.attr("disabled",!1).find("#loader").remove();var param={postedWall:Layout.Page.container.find("#zp_postTextarea").data("postWall"),callBack:ZPFeeds.Activity.handleStatusResponse,content:content,messageText:messageText,curConObj:curConObj,attachCnt:attachCnt,title:title,linkFormation:ZPFeeds.POSTEDITOR.initobj.linkFormation,CURRENTURL:ZPFeeds.POSTEDITOR.initobj.CURRENTURL};ZPFeeds.postAction(param,!0)}},handleStatusResponse:function(resultData){if("string"==typeof resultData&&(resultData=JSON.parse(resultData)),!0===resultData.success){if(ZPFeeds.POSTEDITOR.setContent(""),ZPFeeds.POSTEDITOR.initobj.linkFormation=0,ZPFeeds.POSTEDITOR.initobj.CURRENTURL="",$(ZPFeeds.POSTEDITOR.outerdiv).find("#zpfd_sts_title").val(""),ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.POSTEDITOR,!0),ZPFeeds.appendTitleCont(ZPFeeds.POSTEDITOR,!0),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.statuspostedsuccess")),void 0===resultData.message){var viewkey,actObj=new People.Activity(new Activity(resultData.activityObj),!0);-1!=Layout.Page.hash.indexOf("projectdashboard/feeds")?viewKey=Timetracker.projectDashboard.projectDtls.projectFeedsKey:viewkey=ZPeople.CURRENT_VIEWKEY===ZPeople.VIEWKEYS.ALL?ZPeople.CURRENT_VIEWKEY:ZPeople.VIEWKEYS.Status,ZPFeeds.Activity.constructActivityList("push",viewkey,actObj,!1)}}else ZPeople.Message.showFailureMsg(resultData.message?resultData.message:ZPI18N.getString("zp.unabletoprocess")),ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.POSTEDITOR,!1);Layout.Page.container.find("#zp_dash_feedspost_container").find("#editor_container").find("#submitbtn").attr("disabled",!1).find("#loader").remove(),$("form#zp_AttachFile,iframe#feedsuploadwindow").remove(),Layout.Page.container.find("#zp_dash_feedspost_container").find("#zp_dash_attachments").attr("attachcnt","0").addClass("DN").children("div,input").remove(),Layout.Page.container.find("#zp_dash_feedspost_container").find("#zp_dash_linkattachment").html("").addClass("DN"),ZPFeeds.hideTextEditor()},removeThumbnail:function(Obj){$(Obj).prop("checked")?(ZPFeeds.Activity.linkFormation=1,$(Obj).parents(".noImgCb").prev().css("visibility","hidden")):(ZPFeeds.Activity.linkFormation=0,$(Obj).parents(".noImgCb").prev().css("visibility",""))},deleteActivity:function(){var activityId=ZPFeeds.DELETEOBJ.parents("#actOuterCont").attr("streamid"),params={actionType:"DELETE_ACTIVITY",activityType:ZPFeeds.DELETEOBJ.parent().siblings("#type").val(),activityId:activityId};ZPeople.Request.send(ZPFeeds.URL,params,ZPFeeds.Activity.deleteActivityCallback)},deleteActivityByFdk:function(fdk){var params={actionType:"DELETE_ACTIVITY_BYFDK",fdk:fdk};ZPeople.Request.send(ZPFeeds.URL,params,ZPFeeds.Activity.deleteActivityCallback)},deleteActivityCallback:function(resultData,params){"success"===resultData&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.activitydeleted")),Layout.Page.container.find('[streamid="'+params.activityId+'"]').fadeOut(1e3,function(){$(this).remove()}),params.activityType===People.Feedback.type&&ZPFeeds.PMS.Feedback.isPAFeedBackTab()&&FeedBack.onFeedBackDeleteCallBack()),ZPFeeds.DELETEOBJ=null},getTitle:function(acsActObj,activityObj,recordURL){var recordOwner=acsActObj.getAdditionalProperty("activityOwner"),type=acsActObj.getType(),recordOwnerDtl=ZPFeeds.getUserDetails(recordOwner,!1,!0),titlekey="",params=new Array;if(type===People.Shift.type)if(acsActObj.getAdditionalProperty("isFromAutoShiftAssignment"))ZPFeeds.latestObj=acsActObj,titlekey="hrms.shift.autoshiftchange";else if(acsActObj.getAdditionalProperty("breakViolatedShiftCoreHr"))ZPFeeds.latestObj=acsActObj,acsActObj.getAdditionalProperty("violetedEmployeeZuid")?titlekey="hrms.break.violated.shiftCore.self":acsActObj.getAdditionalProperty("violetedEmployeeName")&&(titlekey="hrms.break.violated.shiftCore",params[0]=acsActObj.getAdditionalProperty("violetedEmployeeName"));else if(acsActObj.getAdditionalProperty("shiftDetails"))acsActObj.getASUsers()!==_LOGGEDIN_ZUID?(params[0]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(acsActObj.getASUsers(),!1,!0),"dtl_pop"),titlekey="hrms.shift.shiftchangecommented"):(params[0]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop"),titlekey=acsActObj.getAdditionalProperty("shiftDetails").conflictList?"hrms.shift.shiftchangedby":"hrms.shift.newshiftaddedby");else{var reminderType=acsActObj.getAdditionalProperty("reminderType");acsActObj.getASUsers()!==_LOGGEDIN_ZUID?(params[0]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(acsActObj.getASUsers(),!1,!0),"dtl_pop"),titlekey=acsActObj.getAdditionalProperty("repManJson")?"hrms.attRemind.repManCommented":"8"==reminderType||"9"==reminderType?"hrms.attRemind.outNotifyCommentedby":"hrms.attRemind.inNotifyCommentedby"):acsActObj.getAdditionalProperty("repManJson")?titlekey=10==reminderType?"hrms.attRemind.notifyRepTitle":"hrms.attendance.notifyRM.EarlyOutTitle":66==reminderType?(titlekey="hrms.attendance.notifyRM.LateInTitle",acsActObj.getAdditionalProperty("lateEmpName")?params[0]=acsActObj.getAdditionalProperty("lateEmpName"):params[0]=ZPI18N.getString("zp.employee")):titlekey="6"==reminderType||"7"==reminderType?"hrms.attRemind.notifyUserInTitle":"hrms.attRemind.notifyUserOutTitle"}else if(type===People.XoxodayNotify.type)titlekey="hrms.feeds.xoxoday.message";else if(type===People.Status.type){titlekey="";var postedWall=activityObj.postedWall,statusType=(recordOwnerDtl=ZPFeeds.getUserDetails(activityObj.recordOwner,!1,!0),parseInt(acsActObj.getAdditionalProperty("statusType"))),wallType=(params=new Array,3);if("allFeeds"===ZPFeeds.getFeedType()?wallType=1:"department"===ZPFeeds.getFeedType()?wallType=2:"timetracker/scheduler/projectdashboard"===Layout.Page.currentmode?wallType=4:"home/feeds/organization"===Layout.Page.currentmode&&(wallType=5),ZPFeeds.SINGLEPOP&&(wallType=1),void 0===postedWall){statusType=parseInt(acsActObj.getAdditionalProperty("statusType"));if(recordOwner===_LOGGEDIN_ZUID)if(1===statusType){if(void 0!==(privateMsgOwners=acsActObj.getAdditionalProperty("privateMsgOwners"))){var userID=(users=privateMsgOwners.split(","))[0]+"",argVal=(userDtl=ZPFeeds.getUserDetails(userID,!1,!0)).name;users.length>1&&(argVal+=" and "+(users.length-1)+" other(s)"),params[1]=argVal}titlekey="hrms.status.haveprivatemsg"}else titlekey=2===statusType?"hrms.status.haveteamorgstatus":"hrms.status.haveuserstatus";else{params[0]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop");var privateMsgOwners=acsActObj.getAdditionalProperty("privateMsgOwners");1===statusType&&void 0!==privateMsgOwners&&-1!==privateMsgOwners.split(",").indexOf(_LOGGEDIN_ZUID)?titlekey="hrms.status.hasprivatemsg":2===statusType?recordOwnerDtl.deptId!==_LOGGEDIN_DEPID&&acsActObj.getAdditionalProperty("postedDept")!==_LOGGEDIN_DEPID?(params[1]="<a popup='dept' class='zphvr-cpro' href='#home/organization/departmentdirectory-deptId:"+recordOwnerDtl.deptId+"' deptId='"+recordOwnerDtl.deptId+"'>"+recordOwnerDtl.deptName+"</a>",titlekey="hrms.status.hasuserstatusinotherwall"):titlekey="hrms.status.hasteamstatus":titlekey="hrms.status.otherhasuserstatus"}}else{privateMsgOwners=acsActObj.getAdditionalProperty("privateMsgOwners");if(recordOwnerDtl.id===ZPeople.CURR_USER.id||recordOwnerDtl.usererec===erecno){if(1===wallType)if(titlekey="hrms.status.haveuserstatus",2===statusType||3===statusType||ZPUtil.Validation.isEmpty(privateMsgOwners)){if(2===statusType||3===statusType){if(titlekey="hrms.status.haveotherstatus",postedWall===ZPeople.CURR_USER.deptId&&(titlekey="hrms.status.haveteamstatus"),2===statusType)params[1]='<a href="#home/organization/departmentdirectory-deptId:'+postedWall+'" target="_blank">'+acsActObj.getAdditionalProperty("postedWallName")+"</a>";else void 0===(name=acsActObj.getAdditionalProperty("postedWallName"))&&void 0!==ZPFeeds.Groups.CURRUSER_GROUPS[postedWall]&&(name=ZPFeeds.Groups.CURRUSER_GROUPS[postedWall].name),params[1]='<a fieldType="grpHeader"  target="_blank" popup="group" grpId='+postedWall+">"+name+"</a>"}}else-1===(users=privateMsgOwners.split(",")).indexOf(ZPeople.CURR_USER.id)&&1===users.length&&(titlekey="hrms.status.haveprivatemsg");else 2===wallType?titlekey=(ZPeople.CURR_USER.deptId,"hrms.status.haveuserstatus"):3===wallType&&(titlekey=(ZPFeeds.Groups.CURRUSER_GROUPS[postedWall],"hrms.status.haveuserstatus"));if(7===statusType)if(4===wallType)titlekey="hrms.status.haveuserstatus";else"-"!==(name=ZPFeeds.Projects.getProjectName(postedWall))&&(params[1]='<a href="#timetracker/mydata/projectdashboard/performance-id:'+postedWall+'" target="_blank">'+name+"</a> "+AcsApi.localizeString("hrms.general.project")),titlekey="hrms.status.haveotherstatus";else 8===statusType&&(titlekey="hrms.status.hasorgstatus")}else{var users;if(params[0]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop"),1===wallType){if(titlekey="hrms.status.hasuserstatus",2===statusType||3===statusType||ZPUtil.Validation.isEmpty(privateMsgOwners))2!==statusType&&3!==statusType||(titlekey="hrms.status.hasotherstatus",postedWall===ZPeople.CURR_USER.deptId?titlekey="hrms.status.hasteamstatus":void 0!==ZPFeeds.Groups.CURRUSER_GROUPS[postedWall]&&(titlekey="hrms.status.hasotherstatus"),2===statusType?params[1]='<a href="#home/organization/departmentdirectory-deptId:'+postedWall+'" target="_blank">'+acsActObj.getAdditionalProperty("postedWallName")+"</a>":(name=void 0===name&&void 0!==ZPFeeds.Groups.CURRUSER_GROUPS[postedWall]?ZPFeeds.Groups.CURRUSER_GROUPS[postedWall].name:acsActObj.getAdditionalProperty("postedWallName"),params[1]='<a fieldType="grpHeader" grpId="'+postedWall+'" target="_blank">'+name+"</a>"));else if(-1!==(users=privateMsgOwners.split(",")).indexOf(ZPeople.CURR_USER.id)&&1===users.length)titlekey="hrms.status.hasprivatemsg";else if(!ZPUtil.Validation.isEmpty(users[0])&&1===users.length){var userDtl=ZPFeeds.getUserDetails(users[0],!1,!0);params[1]='<a popup="user" empid="'+userDtl.id+'" href=" #home/user/profile-id:'+userDtl.usererec+' target="_blank">'+userDtl.name+"</a>",titlekey="hrms.status.othersprvmsg"}}else if(2===wallType||3===wallType){var name;if(titlekey="hrms.status.hasuserstatus",void 0===ZPFeeds.Groups.CURRUSER_GROUPS[postedWall]&&postedWall!==ZPeople.CURR_USER.deptId)if(titlekey="hrms.status.hasotherstatus",2===statusType)params[1]='<a href="#home/organization/departmentdirectory-deptId:'+postedWall+'" target="_blank">'+acsActObj.getAdditionalProperty("postedWallName")+"</a>";else void 0===(name=acsActObj.getAdditionalProperty("postedWallName"))&&void 0!==ZPFeeds.Groups.CURRUSER_GROUPS[postedWall]&&(name=ZPFeeds.Groups.CURRUSER_GROUPS[postedWall].name),void 0!==name?params[1]='<a fieldType="grpHeader" grpId="'+postedWall+'" target="_blank">'+name+"</a>":titlekey="hrms.status.hasuserstatus"}if(7===statusType)if(4===wallType)titlekey="hrms.status.hasuserstatus";else"-"!==(name=ZPFeeds.Projects.getProjectName(postedWall))&&(params[1]='<a href="#timetracker/mydata/projectdashboard/performance-id:'+postedWall+'" target="_blank">'+name+"</a> "+AcsApi.localizeString("hrms.general.project")),titlekey="hrms.status.hasotherstatus";else 8===statusType&&(titlekey="hrms.status.hasotherorgstatus")}}}else if(type===People.FileCabinet.type){var fileType=acsActObj.getAdditionalProperty("fileType"),isEdit=acsActObj.getAdditionalProperty("isEdit"),compdisname=ZPI18N.getString("zp.organizationfiles"),hrfiledisname=ZPI18N.getString("zp.newemployeefiles");if(null==ZPFeeds.HRFILEDISNAME&&null==ZPFeeds.COMPDISNAME){var tabsarr=ZPTabs.TAB_JSON;$.each(tabsarr,function(key,value){if("Files"==value.name){var subtabs=value.subtabs;$.each(subtabs,function(tabkey,tabvalue){var url=tabvalue.tabURL;void 0!=url?"files/companyfile/listview"==url&&(compdisname=tabvalue.displayName):"HRFiles"==tabvalue.tabName&&(hrfiledisname=tabvalue.displayName)})}}),ZPFeeds.HRFILEDISNAME=hrfiledisname,ZPFeeds.COMPDISNAME=compdisname}else null!=ZPFeeds.HRFILEDISNAME&&null!=ZPFeeds.COMPDISNAME&&(compdisname=ZPFeeds.COMPDISNAME,hrfiledisname=ZPFeeds.HRFILEDISNAME);recordOwner===_LOGGEDIN_ZUID?"0"===fileType?(params[0]=hrfiledisname,titlekey="hrms.files.addednewfilesown",fileType=0):(params[0]=compdisname,titlekey="hrms.files.addednewfilesown",fileType=1):(params[0]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop"),"0"===fileType?(params[1]=hrfiledisname,titlekey="true"==isEdit?"hrms.files.editednewfiles":"hrms.files.addednewfiles",fileType=0):(params[1]=compdisname,titlekey="true"==isEdit?"hrms.files.editednewfiles":"hrms.files.addednewfiles",fileType=1))}else if(type===People.Holiday.type){params[0]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop"),params[1]=acsActObj.getAdditionalProperty("holiday_displayname");var tempkey=acsActObj.getAdditionalProperty("holiday_action_type");"added"===tempkey?titlekey=recordOwner===_LOGGEDIN_ZUID?"hrms.feeds.ntfn.holiday.recordaddedowner":"hrms.feeds.ntfn.holiday.recordadded":"deleted"===tempkey?titlekey=recordOwner===_LOGGEDIN_ZUID?"hrms.feeds.ntfn.holiday.recorddeletedowner":"hrms.feeds.ntfn.holiday.recorddeleted":"edited"===tempkey?titlekey=recordOwner===_LOGGEDIN_ZUID?"hrms.feeds.ntfn.holiday.recordeditedowner":"hrms.feeds.ntfn.holiday.recordedited":"removed"===tempkey&&(titlekey=recordOwner===_LOGGEDIN_ZUID?"hrms.feeds.ntfn.holiday.recordremovedowner":"hrms.feeds.ntfn.holiday.recordremoved")}else if(type===People.Reminder.type)params[0]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop"),params[1]=acsActObj.getAdditionalProperty("reminderName"),titlekey=recordOwner===_LOGGEDIN_ZUID?"hrms.feeds.ntfn.reminder.triggeredowner":"hrms.feeds.ntfn.reminder.triggered";else if(type===People.JobSchedule.type){var startDate=acsActObj.getAdditionalProperty("startDate"),endDate=acsActObj.getAdditionalProperty("endDate");if(void 0===startDate&&void 0===endDate){var jobSchdDetails=acsActObj.getAdditionalProperty("jobSchdDetails");$.each(jobSchdDetails,function(index,dtlObj){var parsedDate=Calendar.parseDate(dtlObj.workDate,uidateFormat);(void 0===startDate||parsedDate.getTime()<startDate.getTime())&&(startDate=parsedDate),(void 0===endDate||parsedDate.getTime()>endDate.getTime())&&(endDate=parsedDate)}),startDate=Calendar.formatDate(startDate),endDate=Calendar.formatDate(endDate)}acsActObj.getASUsers()!==_LOGGEDIN_ZUID?(params[0]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(acsActObj.getASUsers(),!1,!0),"dtl_pop"),titlekey="hrms.jobschedule.jobschdcommented"):acsActObj.getAOwner()===_LOGGEDIN_ZUID?(titlekey="hrms.jobschedule.newschedulepublished",params[0]=startDate===endDate?ZPI18N.getString("zp.day")+" "+startDate:ZPI18N.getString("zp.period")+" "+startDate+" - "+endDate):(titlekey="hrms.jobschedule.newschedulepublishedby",params[0]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop"),params[1]=startDate===endDate?ZPI18N.getString("zp.day")+" "+startDate:ZPI18N.getString("zp.period")+" "+startDate+" - "+endDate)}else if(type===People.AddSchedule.type){params[0]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop");var isReopend=acsActObj.getAdditionalProperty("isReopened"),isCompleted=acsActObj.getAdditionalProperty("isCompleted");titlekey=recordOwner===_LOGGEDIN_ZUID?isCompleted?"hrms.feeds.ntfn.job.completed":isReopend?"hrms.feeds.ntfn.job.youreopened":"hrms.feeds.ntfn.job.addedowner":isCompleted?"hrms.feeds.ntfn.job.completedotheres":isReopend?"hrms.feeds.ntfn.job.reopened":"hrms.feeds.ntfn.job.added"}else if(type===People.AddProject.type){params[0]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop");isReopend=acsActObj.getAdditionalProperty("isReopened"),isCompleted=acsActObj.getAdditionalProperty("isCompleted");titlekey=recordOwner===_LOGGEDIN_ZUID?isCompleted?"hrms.feeds.ntfn.project.completed":isReopend?"hrms.feeds.ntfn.project.youreopened":"hrms.feeds.ntfn.project.addedowner":isCompleted?"hrms.feeds.ntfn.project.completedotheres":isReopend?"hrms.feeds.ntfn.project.reopened":"hrms.feeds.ntfn.project.added"}else if(type===People.Collaboration.type){var asUser=acsActObj.getASUsers();params[0]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(asUser,!1,!0),"dtl_pop"),params[1]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop");type=acsActObj.getAdditionalProperty("type");recordOwner===_LOGGEDIN_ZUID?"5"===type?titlekey="hrms.feeds.bdayrecordownerpostedonwall":"6"===type?titlekey="hrms.feeds.newjoineerecordownerpostedonwall":"8"===type?titlekey="hrms.feeds.workanniversaryrecordownerpostedonwall":"9"===type&&(titlekey="hrms.feeds.weddanniversaryrecordownerpostedonwall"):"5"===type?titlekey=asUser+""==_LOGGEDIN_ZUID+""?"hrms.feeds.bdaypostedonwall":"hrms.feeds.bdayotherspostedonwall":"6"===type?titlekey=asUser+""==_LOGGEDIN_ZUID+""?"hrms.feeds.newjoineepostedonwall":"hrms.feeds.newjoineeotherspostedonwall":"8"===type?titlekey=asUser+""==_LOGGEDIN_ZUID+""?"hrms.feeds.workanniversarypostedonwall":"hrms.feeds.workanniversaryotherspostedonwall":"9"===type&&(titlekey=asUser+""==_LOGGEDIN_ZUID+""?"hrms.feeds.weddanniversarypostedonwall":"hrms.feeds.weddanniversaryotherspostedonwall")}else if(type===People.Feedback.type){var feedBackToUser=acsActObj.getAdditionalProperty("feedBackToUser"),postedUserId=acsActObj.getAdditionalProperty("postedUserId");void 0!==acsActObj.getAdditionalProperty("fdbktypeName")&&acsActObj.getAdditionalProperty("fdbktypeName"),params[0]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(feedBackToUser,!1,!0),"dtl_pop"),params[2]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(postedUserId,!1),"dtl_pop"),params[1]=ZPFeeds.PMS.FormUtil.FeedbackName,void 0!==acsActObj.getAdditionalProperty("isAnonymous")&&"true"==acsActObj.getAdditionalProperty("isAnonymous")?titlekey=feedBackToUser+""==_LOGGEDIN_ZUID+""?"hrms.feeds.feedback.gotanonymousfb":"hrms.feeds.feedback.othergotanonymousfb":postedUserId+""==_LOGGEDIN_ZUID+""?titlekey="hrms.feeds.feedback.youhavegotafeedback":feedBackToUser+""==_LOGGEDIN_ZUID+""?(params[0]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(postedUserId,!1,!0),"dtl_pop"),params[1]=ZPFeeds.PMS.FormUtil.FeedbackName,titlekey="hrms.feeds.feedback.gotafeedback"):titlekey="hrms.feeds.feedback.gotafeedbackothere"}else if(type===People.EmpAcceptance.type){feedBackToUser=acsActObj.getAdditionalProperty("appraisee");params[0]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(feedBackToUser,!1,!0),"dtl_pop"),params[1]=acsActObj.getAdditionalProperty("appraisalname"),titlekey="hrms.feeds.employeesharedfeedback"}else if(type===People.Announcement.type){var owner=activityObj.actOwner?activityObj.actOwner:ZPFeeds.getUserDetails(),isModified=acsActObj.getAdditionalProperty("isEdit");owner.id!==_LOGGEDIN_ZUID?(params[0]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(owner.id,!1,!0),"dtl_pop"),titlekey="false"===isModified?"hrms.announcement.announcementpostedothers":"hrms.announcement.announcementmodifiedothers"):titlekey="false"===isModified?"hrms.announcement.announcementpostedyou":"hrms.announcement.announcementmodifiedyou"}else if(type===People.Leave.type){owner=activityObj.actOwner?activityObj.actOwner:ZPFeeds.getUserDetails();titlekey=acsActObj.getAdditionalProperty("subject")?acsActObj.getAdditionalProperty("subject"):"hrms.feeds.leave.cancell",params[0]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(owner.id,!1,!0),"dtl_pop"),owner.id==_LOGGEDIN_ZUID&&(params[0]="",titlekey+=".you");recordURL='<a class="ZP-Leave-"'+acsActObj.getAdditionalProperty("actRecId")+" >"+ZPeople.escapeHtml(acsActObj.getAdditionalProperty("formName")?acsActObj.getAdditionalProperty("formName"):"Leave")+"</a>";params[1]=recordURL}else if(type===People.Approval.type){ZPFeeds.Activity.getApproverDetails(acsActObj,activityObj);var action=acsActObj.getAdditionalProperty("action"),tableName=(acsActObj.getAdditionalProperty("approvalAction"),acsActObj.getAdditionalProperty("tableName")),approvalType=acsActObj.getAdditionalProperty("approvalType");if(params[0]="P_EmployeeLeave"===tableName?acsActObj.getAdditionalProperty("leaveTypeName"):acsActObj.getAdditionalProperty("formDispName"),params[1]=ZPFeeds.Activity.getUsersLinkName(recordOwnerDtl,"dtl_pop"),void 0!==activityObj.otheruser){var mode="dtl_pop";void 0!==activityObj.isFromSLA&&activityObj.isFromSLA&&(activityObj.otheruser.text=ZPI18N.getString("zp.systemdetect"),mode="pln_txt"),params[2]=ZPFeeds.Activity.getUsersLinkName(activityObj.otheruser,mode)}params[3]=activityObj.apprRejStr,params[4]="P_EmployeeLeave"===tableName||"P_TimesheetList"===tableName?ZPI18N.getString("zp.a"):ZPI18N.getString("zp.anapproval"),params[5]="javascript:;",params[6]='ZPFeeds.viewCompleteDetailsForm("VIEW",this)',params[7]="P_EmployeeLeave"===tableName||"P_TimesheetList"===tableName?"":ZPI18N.getString("zp.form").toLowerCase(),activityObj.approvalTitle,"NEXT_LEVEL_APPROVAL"===approvalType?"youhave"==activityObj.apprStr?titlekey=recordOwner==_LOGGEDIN_ZUID?void 0==activityObj.newApprTitle?"hrms.approval.youapprraised":"hrms.approval.youapprraisedandwait":void 0===activityObj.newApprTitle?"hrms.approval.youapprovedotherrequest":11==action&&"waitingforyou"===activityObj.newApprTitle?"hrms.approval.cancel.youapprovedotherrequestwait":11==action&&"waitingforappr"===activityObj.newApprTitle?"hrms.approval.cancel.youapprovedotherrequestwait":"hrms.approval.youapprovedotherrequestwait":"otherhave"==activityObj.apprStr?void 0===activityObj.apprRejStr?void 0===activityObj.newApprTitle&&(titlekey=11==action?"hrms.approval.cancel.otherapprovedotherrequest":"hrms.approval.otherapprovedotherrequest"):titlekey=void 0===activityObj.newApprTitle?recordOwner==_LOGGEDIN_ZUID?11==action?"hrms.approval.cancel.approvedyourrequest":"hrms.approval.approvedyourrequest":11==action?"hrms.approval.cancel.otherapprovedotherrequest":"hrms.approval.otherapprovedotherrequest":"waitingforyou"===activityObj.newApprTitle?recordOwner==_LOGGEDIN_ZUID?11==action?"hrms.approval.cancel.otherapprovedyourrequestwaityou":"hrms.approval.otherapprovedyourrequestwaityou":11==action?"hrms.approval.cancel.otherapprovedotherrequestwaityou":"hrms.approval.otherapprovedotherrequestwaityou":recordOwner==_LOGGEDIN_ZUID?11==action?"hrms.approval.cancel.approvedyourrequestandwait":"hrms.approval.approvedyourrequestandwait":11==action?"hrms.approval.cancel.otherapprovedotherrequestwait":"hrms.approval.otherapprovedotherrequestwait":"system"==activityObj.apprStr?titlekey=recordOwner==_LOGGEDIN_ZUID?"hrms.approval.cancel.urreqautoapproved":"hrms.approval.cancel.autoapprovehis":void 0===activityObj.apprRejStr&&(titlekey=void 0===activityObj.newApprTitle?recordOwner==_LOGGEDIN_ZUID?"hrms.approval.youapprraised":"hrms.approval.otherapprraised":recordOwner==_LOGGEDIN_ZUID?"hrms.approval.youapprraisedandwait":"waitingforyou"==activityObj.newApprTitle?11==action?"hrms.approval.cancel.otherapprraisedandwaityou":"hrms.approval.otherapprraisedandwaityou":11==action?"hrms.approval.cancel.otherapprraisedandwait":"hrms.approval.otherapprraisedandwait"):void 0===activityObj.apprRejStr?void 0===activityObj.newApprTitle?acsActObj.getAdditionalProperty("actionInitiated")&&acsActObj.getAdditionalProperty("actionInitiated")!=recordOwner?(params[8]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(acsActObj.getAdditionalProperty("actionInitiated"),!1,!0),"dtl_pop"),titlekey=acsActObj.getAdditionalProperty("actionInitiated")==_LOGGEDIN_ZUID?11==action?"hrms.approval.cancel.otherapprraisedandwait":"hrms.approval.youaddothers":recordOwner==_LOGGEDIN_ZUID?11==action?"hrms.approval.cancel.otherapprraisedandwait":"hrms.approval.otheraddedyours":11==action?"hrms.approval.cancel.otherapprraisedandwait":"hrms.approval.otheradded"):titlekey=recordOwner==_LOGGEDIN_ZUID?"hrms.approval.youapprraised":"hrms.approval.otherapprraised":acsActObj.getAdditionalProperty("actionInitiated")&&acsActObj.getAdditionalProperty("actionInitiated")!=recordOwner?(params[8]=ZPFeeds.Activity.getUsersLinkName(ZPFeeds.getUserDetails(acsActObj.getAdditionalProperty("actionInitiated"),!1,!0),"dtl_pop"),titlekey=acsActObj.getAdditionalProperty("actionInitiated")==_LOGGEDIN_ZUID?11==action?"hrms.approval.cancel.otherapprraisedandwait":"hrms.approval.youaddedotherssandwait":recordOwner==_LOGGEDIN_ZUID?11==action?"hrms.approval.cancel.otherapprraisedandwait":"hrms.approval.otheraddedyoursandwait":11==action?"hrms.approval.cancel.otherapprraisedandwait":"hrms.approval.otheraddedandwait"):titlekey=recordOwner==_LOGGEDIN_ZUID?11==action?"hrms.approval.cancel.yourapprraisedbyotherandwait":"hrms.approval.youapprraisedandwait":"waitingforyou"==activityObj.newApprTitle?11==action?"hrms.approval.cancel.otherapprraisedandwaityou":"hrms.approval.otherapprraisedandwaityou":11==action?"hrms.approval.cancel.otherapprraisedandwait":"hrms.approval.otherapprraisedandwait":titlekey="youhave"===activityObj.apprStr?void 0===activityObj.newApprTitle?11==action?"hrms.approval.cancel.youapprovedotherrequest":"hrms.approval.youapprovedotherrequest":"waitingforyou"==activityObj.newApprTitle?"hrms.approval.youapprraised":"hrms.approval.youapprraisedandwait":void 0!==activityObj.newApprTitle?"waitingforyou"==activityObj.newApprTitle?"hrms.approval.otherapprraisedandwaityou":"hrms.approval.otherapprraisedandwait":"hrms.approval.otherapprraised"}if(acsActObj.getAdditionalProperty("isPhotoTransfer")){params[0]=ZPI18N.getString("zp.photochange");let recordId=acsActObj.getAdditionalProperty("actRecId");params[6]=`ProfilePictureTransfer.photoTransferModel("${recordId}")`}return AcsApi.localizeString(titlekey,params)},getApproverDetails:function(activityObj,peopleActObj){var userApprDtl=activityObj.getAdditionalProperty("userApprDtl"),apprType=activityObj.getAdditionalProperty("currentApproverType"),action=activityObj.getAdditionalProperty("action");activityObj.getAdditionalProperty("approvalAction");peopleActObj.isCurrApprover=!1,void 0==ZPeople.loggedInGroups&&void 0!==apprType&&"group"==apprType&&Groups.getMyGroups();var currApproverId=activityObj.getAdditionalProperty("currApproverId"),delegateeId=activityObj.getAdditionalProperty("delegateeId"),delegateeSubType=activityObj.getAdditionalProperty("DelegateeSubType");!ZPUtil.Validation.isEmpty(currApproverId)&&currApproverId.split("_").length>1&&(currApproverId=currApproverId.split("_")[1]),(currApproverId===_LOGGEDIN_ZUID||currApproverId===erecno||delegateeId==erecno||currApproverId===_LOGGEDIN_DEPID||currApproverId===_LOGGEDIN_ROLEID||void 0!=ZPeople.loggedInGroups&&-1!=ZPeople.loggedInGroups.indexOf(currApproverId)||ZPFeeds.Projects.isLoginUserPM(currApproverId))&&(peopleActObj.isCurrApprover=!0);for(var approvalStr,approvalTitle,newApprTitle,apprStr,isApprovalCompleted=activityObj.getAdditionalProperty("isApprovalCompleted"),appList=new Array,userAppLen=userApprDtl.length,penApprCnt=0,i=0;i<userAppLen;i++){var apprDtl={},approverDtl=userApprDtl[i];if(approverDtl.isApproved||approverDtl.isRejected){apprDtl.isCurrent=!1,peopleActObj.apprRejStr=(approverDtl.isApproved?ZPI18N.getString("zp.approved"):ZPI18N.getString("zp.rejected")).toLowerCase(),"11"==action&&(peopleActObj.apprRejStr=(approverDtl.isApproved?ZPI18N.getString("zp.accepted").toLowerCase():ZPI18N.getString("zp.declined")).toLowerCase());var approvalUserDtl=ZPeople.CURR_USER;peopleActObj.isFromSLA=!1;var dispName=approvalUserDtl.name,apprPhoto=approvalUserDtl.thumb;approverDtl.approverZUID+""===ZPeople.CURR_USER.id?(approvalStr=ZPI18N.getString("zp.youhave",new Array(peopleActObj.apprRejStr)),apprStr="youhave",peopleActObj.otheruser=void 0):(void 0!==approverDtl.approverZUID?(approvalStr=ZPI18N.getString("zp.otherhave",new Array(approvalUserDtl.name,peopleActObj.apprRejStr)),dispName=(approvalUserDtl=ZPFeeds.getUserDetails(approverDtl.approverZUID,!1,!0)).name,apprPhoto=approvalUserDtl.thumb):(approvalStr=ZPI18N.getString("zp.systemhas",new Array(peopleActObj.apprRejStr)),peopleActObj.isFromSLA=!0,dispName=ZPI18N.getString("zp.systemdetect"),apprPhoto=ZPeople.getResourceURL(imageUrl+"home/auto-app.jpg")),apprStr="otherhave",peopleActObj.otheruser=approvalUserDtl),apprDtl.displayName=dispName,apprDtl.photo=apprPhoto,apprDtl.deptName=approvalUserDtl.deptName,apprDtl.id=approvalUserDtl.id,apprDtl.desName=approvalUserDtl.designation,apprDtl.deptName=approvalUserDtl.deptName,apprDtl.email=approvalUserDtl.email,apprDtl.approvalTime=ZPDateTime.getDateDisplayFormat(approverDtl.approvedTime),apprDtl.isApproved=approverDtl.isApproved,apprDtl.isRejected=approverDtl.isRejected,apprDtl.erecno=approverDtl.erecno,isApprovalCompleted&&userAppLen-1===i&&(apprDtl.isCurrent=!0)}else{apprDtl.isCurrent=0===penApprCnt,penApprCnt++;var currApprDtl=void 0;!apprDtl.isCurrent||ZPUtil.Validation.isEmpty(delegateeId)||!ZPUtil.Validation.isEmpty(delegateeSubType)&&"2"!=delegateeSubType?ZPUtil.Validation.isEmpty(approverDtl.erecno)||(currApprDtl=ZPFeeds.getUserDetails(approverDtl.erecno,!1)):currApprDtl=ZPFeeds.getUserDetails(delegateeId,!1),void 0!==currApprDtl&&(currApprDtl.id===currApproverId||currApprDtl.usererec+""===currApproverId||apprDtl.isCurrent&&!ZPUtil.Validation.isEmpty(delegateeId))?(apprDtl.displayName=currApprDtl.name,apprDtl.deptName=currApprDtl.deptName,apprDtl.photo=currApprDtl.thumb,apprDtl.id=currApprDtl.id,apprDtl.desName=currApprDtl.designation,apprDtl.deptName=currApprDtl.deptName,apprDtl.email=currApprDtl.email,apprDtl.erecno=approverDtl.erecno,peopleActObj.isCurrApprover&&(apprDtl.isCurrApprover=peopleActObj.isCurrApprover)):(apprDtl.currentApprType=activityObj.getAdditionalProperty("currentApproverType"),apprDtl.displayName=approverDtl.displayName,apprDtl.photo=approverDtl.displayPhoto,apprDtl.id=approverDtl.id,apprDtl.desName=approverDtl.designation,apprDtl.deptName=approverDtl.deptName,apprDtl.email=approverDtl.email,apprDtl.erecno=approverDtl.erecno)}(apprDtl.isCurrent||isApprovalCompleted&&i===userAppLen-1)&&(peopleActObj.currentApprDtl=apprDtl),appList[i]=apprDtl,0!==i||isApprovalCompleted||(peopleActObj.isCurrApprover?(approvalTitle=ZPI18N.getString("zp.waitingforyou"),newApprTitle="waitingforyou"):(approvalTitle=ZPI18N.getString("zp.waitingforappr"),newApprTitle="waitingforappr"))}isApprovalCompleted?0==userAppLen&&(peopleActObj.apprStr="system"):(void 0===approvalTitle&&(approvalTitle=ZPI18N.getString("zp.waitingforfurtherapp"),newApprTitle="waitingforfurtherapp"),approvalTitle=ZPI18N.getString("zp.and",[""])+"&nbsp;"+approvalTitle+"."),peopleActObj.approvalTitle=approvalTitle,peopleActObj.newApprTitle=newApprTitle,peopleActObj.isApprovalCompleted=isApprovalCompleted,peopleActObj.appList=appList,void 0!==apprStr&&(peopleActObj.apprStr=apprStr),void 0!==approvalStr&&(peopleActObj.approvalStr=approvalStr)},getRecordUrl:function(recordFormId,recordId,tableName,type){return type===People.Announcement.type?"#"+Announcement.URLCONTEXT+"announcements/list/view-annId:"+recordId:"P_EmployeeLeave"===tableName?"#leavetracker/leavedetails-formId:"+recordFormId+"/recordId:"+recordId:"P_Employee"===tableName?"#employees/profile-"+recordId:"P_Holiday"===tableName?"#leavetracker/holidaydetails-recordId:"+recordId:"P_TimesheetList"===tableName?"#timetracker/timesheets/timesheetlist-formId:"+recordFormId+"/recordId:"+recordId:"P_Department"===tableName?"#organization/department/view-formId:"+recordFormId+"/recordId:"+recordId:"#form/view-formId:"+recordFormId+"/recordId:"+recordId},getUsersLinkName:function(userDtl,mode){return void 0!==userDtl.isFromSLA?ZPI18N.getString("zp.systemdetect"):void 0!==userDtl.usererec?"dtl_pop"===mode?"<a  href='javascript:;' class='zphvr-cpro zp-post-uname' empid = '"+userDtl.id+"' popup='user'>"+userDtl.name+"</a>":"pln_txt"===mode?userDtl.text:"<a class='zp-post-uname' href= '#home/user/profile-id:"+userDtl.usererec+"'>"+userDtl.name+"</a>":"<a class='zp-post-uname' href='javascript:;'>"+userDtl.name+"</a>"},filterTemplate:function(content,dontdoNonTags){try{var tempContent=content,newDiv=$("#dummy_for_content_filter");0===newDiv.length&&(newDiv=$("<div/>",{id:"dummy_for_content_filter",style:"display:none;"}),$("body").append(newDiv));var dummyContent=newDiv.html(tempContent),urlTags={};if(dummyContent.find("a, img").each(function(index){urlTags["tagreplacer"+index]=this,$(this).replaceWith(`<pre id='tagreplaceholder${index}'></pre>`),urlTags.index=index}),!0!==dontdoNonTags){var nonAtagHTML=newDiv.html(),urlArr={},index=0;nonAtagHTML.replace(/(\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,function(url){urlArr[index]=url,nonAtagHTML=nonAtagHTML.replace(url,`<a href="$${index}'" target="_blank">##${index}</a>`),index++}),Object.keys(urlArr).forEach(function(key){nonAtagHTML=(nonAtagHTML=nonAtagHTML.replace("$"+key,urlArr[key])).replace("##"+key,urlArr[key])})}for(i=0;i<=urlTags.index;i++)nonAtagHTML.filter("#tagreplaceholder"+i).replaceWith(urlTags["tagreplacer"+i]);return nonAtagHTML.find("a").attr("target","_blank"),tempContent=nonAtagHTML,newDiv.remove(),tempContent}catch(e){return $("#dummy_for_content_filter").remove(),content}},getRawMentions:function(content,isEncoded,deptDetails,grpDetails,isAllowedToGet){if(void 0===content||null===content||""===content.trim())return"";isAllowedToGet=void 0===isAllowedToGet;var regex,deptArr=[],grpArr=[],returnCont=content;if(regex=!0===isEncoded?/zp+&#x5b;+(peopleuser|department|group)+&#x3a;+[0-9]+&#x5d;+zp/gi:/zp\[(peopleuser|department|group)+(#|:).+?\]zp/gi,returnCont=returnCont.replace(regex,function(match,contents,offset,s){var id,userLink;!0===isEncoded?id=match.split("&#x3a;")[1].split("&#x5d;")[0]:id=match.split("zp[")[1].slice(0,-3).split(":")[1];if("peopleuser"===contents){var disDtl=ZPFeeds.getUserDetails(id,void 0,!0);void 0!==disDtl&&(userLink='<a name="mentions" href="'+match+'" class="ze_mention">'+disDtl.name+"</a>")}else if("department"===contents){void 0!==(name=deptDetails?deptDetails[id]:ZPFeeds.getNameByIdInArray(ZPFeeds.Activity.DEPTNAMES,id))?userLink='<a name="mentions" href="'+match+'" class="ze_mention">'+name+"</a>":deptArr.push(id)}else if("group"===contents){var name;void 0!==(name=grpDetails?grpDetails[id]:ZPFeeds.getNameByIdInArray(ZPFeeds.Activity.GROUPSNAMES,id))?userLink='<a name="mentions" href="'+match+'" class="ze_mention">'+name+"</a>":grpArr.push(id)}else userLink=match;return userLink}),isAllowedToGet&&(deptArr.length>0||grpArr.length>0)){var params={actionType:"GETDEPTANDGRPDETAILS"};deptArr.length>0&&(params.deptIds=JSON.stringify(deptArr)),grpArr.length>0&&(params.grpIds=JSON.stringify(grpArr)),ZPeople.Request.sendAsyncPost(ZPFeeds.URL,params,function(response){if(void 0!==params.deptIds){var deptDtls=response.deptDtls;0!==Object.keys(deptDtls).length&&$.each(deptDtls,function(key,value){ZPFeeds.Activity.DEPTNAMES[key]=value})}if(void 0!==params.grpIds){var grpDtls=response.grpDtls;0!==Object.keys(grpDtls).length&&$.each(grpDtls,function(key,value){ZPFeeds.Activity.GROUPSNAMES[key]=value})}returnCont=ZPFeeds.Activity.getRawMentions(content,isEncoded,void 0,void 0,!1)})}return returnCont},getMentions:function(content,isEncoded,deptDetails,grpDetails,isAllowedToGet){if(void 0===content||null===content||""===content.trim())return"";isAllowedToGet=void 0===isAllowedToGet;var regex,deptArr=[],grpArr=[],returnCont=content;if(regex=!0===isEncoded?/zp+&#x5b;+(peopleuser|department|group)+&#x3a;+[0-9]+&#x5d;+zp/gi:/zp\[(peopleuser|department|group)+(#|:).+?\]zp/gi,returnCont=returnCont.replace(regex,function(match,contents,offset,s){var id,userLink;!0===isEncoded?id=match.split("&#x3a;")[1].split("&#x5d;")[0]:id=match.split("zp[")[1].slice(0,-3).split(":")[1];if("peopleuser"===contents){var disDtl=ZPFeeds.getUserDetails(id,void 0,!0);void 0!==disDtl&&(userLink="@<a class='zphvr-cpro' "+(ZPFeeds.SINGLEPOP?"":"popup='user'")+" empid='"+disDtl.id+"' "+(void 0!==disDtl.id?"href='#home/user/profile-id:"+disDtl.usererec:"href='javascript:;'")+"' >"+disDtl.name+"</a>")}else if("department"===contents){void 0!==(name=deptDetails?deptDetails[id]:ZPFeeds.getNameByIdInArray(ZPFeeds.Activity.DEPTNAMES,id))?userLink="@<a class='zphvr-cpro' popup='dept' href='#home/organization/departmentdirectory-deptId:"+id+"' deptId='"+id+"'>"+name+"</a>":deptArr.push(id)}else if("group"===contents){var name;void 0!==(name=grpDetails?grpDetails[id]:ZPFeeds.getNameByIdInArray(ZPFeeds.Activity.GROUPSNAMES,id))?userLink="@<a class='zphvr-cpro' popup='group' fieldType='grpHeader'  grpId='"+id+"'>"+name+"</a>":grpArr.push(id)}else userLink=match;return userLink}),isAllowedToGet&&(deptArr.length>0||grpArr.length>0)){var params={actionType:"GETDEPTANDGRPDETAILS"};deptArr.length>0&&(params.deptIds=JSON.stringify(deptArr)),grpArr.length>0&&(params.grpIds=JSON.stringify(grpArr)),ZPeople.Request.sendAsyncPost(ZPFeeds.URL,params,function(response){if(void 0!==params.deptIds){var deptDtls=response.deptDtls;0!==Object.keys(deptDtls).length&&$.each(deptDtls,function(key,value){ZPFeeds.Activity.DEPTNAMES[key]=value})}if(void 0!==params.grpIds){var grpDtls=response.grpDtls;0!==Object.keys(grpDtls).length&&$.each(grpDtls,function(key,value){ZPFeeds.Activity.GROUPSNAMES[key]=value})}returnCont=ZPFeeds.Activity.getMentions(content,isEncoded,void 0,void 0,!1)})}return returnCont},getSmileys:function(content){var statuscontent=content,matchedsmiles=statuscontent.match(/:\b(smilenew|lol|sad|angry|tongueout|winknew|meh|shocked|worried|sleepy|lipssealed|neutral|like|dislike|claps|searching|tensed|dizzy|coolnew|yummy|idea|injured|sick|anxious|doubtful|tearofjoy|halo|grin|loveit|curious|thinking|relaxed|yuck|blush|upset|stressed|tired|bored|jealous|evil|facepalm|surprise|headache|namaste|super|birthday|feelingwarm|feelingcold|ontarget)\b:/gi);if(null!==matchedsmiles)for(i=0;i<matchedsmiles.length;i++){var searchStr=matchedsmiles[i],replacestr=searchStr.substr(1,searchStr.length-2);statuscontent=statuscontent.replace(searchStr,"<span class='zcoemoji-"+replacestr+"'></span>")}return statuscontent},validateRawContent:function(content,isEncoded,deptDtls,grpDtls){if(ZPUtil.Validation.isEmpty(content)||0===ZPFeeds.getTextContent(content).length&&0===$("<div>").append(content).find("img").length&&0===$("<div>").append(content).find("inlinevideo").length)return"";var statusCont=content;return statusCont=ZPFeeds.Activity.getRawMentions(statusCont,isEncoded,deptDtls,grpDtls),statusCont=ZPFeeds.Activity.getRawSmileys(statusCont)},getRawSmileys:function(content){var statuscontent=content,matchedsmiles=statuscontent.match(/:\b(smilenew|lol|sad|angry|tongueout|winknew|meh|shocked|worried|sleepy|lipssealed|neutral|like|dislike|claps|searching|tensed|dizzy|coolnew|yummy|idea|injured|sick|anxious|doubtful|tearofjoy|halo|grin|loveit|curious|thinking|relaxed|yuck|blush|upset|stressed|tired|bored|jealous|evil|facepalm|surprise|headache|namaste|super|birthday|feelingwarm|feelingcold|ontarget)\b:/gi);if(null!==matchedsmiles)for(i=0;i<matchedsmiles.length;i++){var searchStr=matchedsmiles[i],replacestr=searchStr.substr(1,searchStr.length-2);statuscontent=statuscontent.replace(searchStr,"<img id='smileys' src='"+ZPeople.getResourceURL(newUIImageUrl+"spacer.gif")+"' class='zcoemoji-"+replacestr+"' STYLE='background-image: url("+ZPeople.getResourceURL(newUIImageUrl+"smileys-2X.png")+"); vertical-align: middle; width: 24px; height: 24px; display: inline-block; background-size: 240px; overflow: hidden; vertical-align: middle; background-position:"+ZPFeeds.Editor.getSmileyCss(replacestr)+"' name=':"+replacestr+":'>")}return statuscontent},validateContent:function(content,isEncoded,deptDtls,grpDtls,contructedObj,dontdoNonTags){if(ZPUtil.Validation.isEmpty(content)||0===ZPFeeds.getTextContent(content).length&&0===$("<div>").append(content).find("img").length&&0===$("<div>").append(content).find("inlinevideo").length)return content;var statusCont=content;return statusCont=ZPFeeds.Activity.getMentions(statusCont,isEncoded,deptDtls,grpDtls),statusCont=ZPFeeds.Activity.filterTemplate(statusCont,dontdoNonTags),statusCont=ZPFeeds.Activity.getSmileys(statusCont)},getImgAndCBoxClass:function(statusCont,id){var tempdiv=$("<div>").html(statusCont),images=tempdiv.find("img");if(images.length>0){for(var i=0;i<images.length;i++)$(images[i]).addClass("cboxElement CP"),$(images[i]).attr("href",$(images[i]).attr("src")),$(images[i]).attr("rel",id);statusCont=tempdiv.html()}return statusCont},getAttachContent:function(attachArr,statusId,commentId,type){var extn,attachObj={},imgContent="",fileContent="",fileCnt=0,viewUrl=null;if(void 0!==attachArr&&attachArr.length>0){var typeHtml=void 0!==type?"&type="+type+"&acttype="+type:"";fileContent+='<div class="clearfix">';for(var attCnt=0;attCnt<attachArr.length;attCnt++)if(extn=attachArr[attCnt].fileExtn,!ZPUtil.Validation.isImage(extn)){var n=attachArr[attCnt].fileName.lastIndexOf("."),res=attachArr[attCnt].fileName.substring(n+1);viewUrl=ZPFeeds.Activity.getFileViewUrl(res,attachArr[attCnt].downloadFileId,type,statusId),res="xlsx"===res||"xls"===res?"xls-new":"docx"===res||"doc"===res?"doc":"zip"===res||"tar.gz"===res?"zip":"mp3"===res?"mp3":"ppt"===res?"ppt":"pdf"===res?"pdf":"file";var downloadUrl=attachArr[attCnt].downloadFileId;void 0!==downloadUrl&&(downloadUrl="downloadAttachment?recId="+statusId+"&fileId="+downloadUrl+typeHtml),fileContent+='<div class="attachedFile filePosts"><div class="fileInfo cboxElement" fieldtitle="'+attachArr[attCnt].fileName+'" title="'+attachArr[attCnt].fileName+'" rel="'+(void 0===commentId?statusId:commentId)+'" downloadUrl="'+downloadUrl+'" file=true viewUrl="'+viewUrl+'"><i class="IC-'+res+' fileType"></i><div class="fileNameAndSize"><label class="fileName CP" purpose="fileName">'+attachArr[attCnt].fileName+'</label><span class="CP" purpose="fileSize">'+attachArr[attCnt].fileSize+'</span></div></div><span><a href="downloadAttachment?recId='+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+'"><i class="IC-imprt filedwn"></i></a></span></div>',fileCnt++}fileContent+="</div>";var imgCnt=attachArr.length-fileCnt;if(attachObj.imgcontent=void 0,imgCnt>0){var cnt=0,maxHeight1=0,maxHeight2=0;for(attCnt=0;attCnt<attachArr.length;attCnt++)if(extn=attachArr[attCnt].fileExtn.toLowerCase(),void 0!==attachArr[attCnt].fileUploadId?attachArr[attCnt].filePath:"downloadAttachment?recId="+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml,ZPUtil.Validation.isImage(extn)){if("gif"===extn.substring(extn.length,extn.length-3)&&!0,1===imgCnt){var dimensions=ZPFeeds.Activity.getWidthAndHeight(parseInt(attachArr[attCnt].actWidth),parseInt(attachArr[attCnt].actHeight));imgContent+="<li class='zp-fdimg' style='height:"+(dimensions.height+6)+"px; width:"+(dimensions.width+6)+"px;'><a  title='"+attachArr[attCnt].fileName+"' class='cboxElement' rel='"+(void 0===commentId?statusId:commentId)+"' href='downloadAttachment?recId="+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+"' downloadUrl='downloadAttachment?recId="+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+"'><img src=downloadAttachment?recId="+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+" ></a></li>"}else{var isMaxHeight2=!1;(imgCnt>=5||2===imgCnt)&&cnt<2?(isMaxHeight2=!0,maxHeight2=300):maxHeight1=141,imgContent+="<li class='zp-fdimg' style='height:"+(isMaxHeight2?maxHeight2:maxHeight1)+"px; "+(imgCnt>5&&cnt>4||imgCnt<6&&imgCnt>5&&cnt>4?"display:none;":"")+"'><a title='"+attachArr[attCnt].fileName+"' class='feedCoverImage cboxElement' rel='"+(void 0===commentId?statusId:commentId)+"'  href='downloadAttachment?recId="+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+"' downloadUrl='downloadAttachment?recId="+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+"' style='background-image:url(downloadAttachment?recId="+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+");'>"+(imgCnt>5&&4===cnt||imgCnt<5&&imgCnt>4&&3===cnt?"<span class='plusLink'>+"+(imgCnt>5&&4===cnt?parseInt(imgCnt-5):imgCnt<6&&imgCnt>4&&3===cnt?parseInt(imgCnt-4):"")+"</span>":"")+"</a></li>"}cnt++}attachObj.imgcontent='<ul class="zp-feeds-imgs '+(2===imgCnt?"zp-five-imgs":imgCnt>2&&imgCnt<5?"zp-four-imgs":imgCnt>=5?"zp-five-imgs":"")+'">'+imgContent+"</ul>"}return attachObj.filecontent=void 0,0!==fileCnt&&(attachObj.filecontent=fileContent),attachObj}},getAttachments:function(attachArr,statusId,commentId,type){var extn,attachObj={},imgContent="",fileContent="",fileCnt=0,viewUrl=null;if(void 0!==attachArr&&attachArr.length>0){var typeHtml=void 0!==type?"&type="+type+"&acttype="+type:"";fileContent+="";for(var attCnt=0;attCnt<attachArr.length;attCnt++)if(extn=attachArr[attCnt].fileExtn,!ZPUtil.Validation.isImage(extn)){var n=attachArr[attCnt].fileName.lastIndexOf("."),res=attachArr[attCnt].fileName.substring(n+1);let icnClass=ZPFeeds.Attachments.getIconClass(res);viewUrl=ZPFeeds.Activity.getFileViewUrl(res,attachArr[attCnt].downloadFileId,type,statusId);var downloadUrl=attachArr[attCnt].downloadFileId;void 0!==downloadUrl&&(downloadUrl="downloadAttachment?recId="+statusId+"&fileId="+downloadUrl+typeHtml),fileContent+='<div class="filePrev cboxElement" rel="'+(void 0===commentId?statusId:commentId)+'" fieldtitle="'+attachArr[attCnt].fileName+'" downloadUrl="'+downloadUrl+'" file=true viewUrl="'+viewUrl+'" viewUrl="'+viewUrl+'"><div class="zpl_atchimg"><i class="'+icnClass+'"></i></div><div class="fileNameAndSize zpl_atchdtl"><h4 class="fileName CP">'+attachArr[attCnt].fileName+'</h4><p><span purpose="fileSize">'+attachArr[attCnt].fileSize+'</span></p></div><div class="zpl_atchicn"><span><a href="downloadAttachment?recId='+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+'"><i class="IC-imprt filedwn"></i></a></span></div></div>',fileCnt++}var imgCnt=attachArr.length-fileCnt;if(attachObj.imgcontent=void 0,imgCnt>0){for(attCnt=0;attCnt<attachArr.length;attCnt++)if(extn=attachArr[attCnt].fileExtn.toLowerCase(),void 0!==attachArr[attCnt].fileUploadId?attachArr[attCnt].filePath:"downloadAttachment?recId="+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml,ZPUtil.Validation.isImage(extn)){var isGif=!1;"gif"===extn.substring(extn.length,extn.length-3)&&(isGif=!0),imgContent+='<div fieldtitle="'+attachArr[attCnt].fileName+'" href="downloadAttachment?recId='+statusId+"&fileId="+(isGif?attachArr[attCnt].downloadFileId:attachArr[attCnt].thumbId)+typeHtml+'" class="filePrev cboxElement" rel="'+(void 0===commentId?statusId:commentId)+'" downloadUrl="downloadAttachment?recId='+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+'"><div class="zpl_atchimg"><img src="downloadAttachment?recId='+statusId+"&fileId="+(isGif?attachArr[attCnt].downloadFileId:attachArr[attCnt].thumbId)+typeHtml+'" alt=""></div><div class="fileNameAndSize zpl_atchdtl"><h4 class="fileName CP">'+attachArr[attCnt].fileName+'</h4><p><span purpose="fileSize">'+attachArr[attCnt].fileSize+'</span></p></div><div class="zpl_atchicn"><span><a href="downloadAttachment?recId='+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+'" downloadUrl="downloadAttachment?recId='+statusId+"&fileId="+attachArr[attCnt].downloadFileId+typeHtml+'"><i class="IC-imprt filedwn"></i></a></span></div></div>',0}attachObj.imgcontent=imgContent}return attachObj.filecontent=void 0,0!==fileCnt&&(attachObj.filecontent=fileContent),attachObj}},getWidthAndHeight:function(actualwidth,actualheight){var dimension={},width=0,height=0,percentdiff=0;return actualwidth>394||actualheight>394?(width=(percentdiff=actualwidth>actualheight?394/actualwidth*100:394/actualheight*100)/100*actualwidth,height=percentdiff/100*actualheight):(width=actualwidth,height=actualheight),dimension.width=Math.round(width),dimension.height=Math.round(height),dimension},getFileViewUrl:function(extn,fId,type,actRecId){var viewUrl=null;return extn=extn.toLowerCase(),-1!==$.inArray(extn,["xls","xlsx","sxc","ods","csv","tsv","doc","docx","sxw","odt","rtf","ppt","pptx","pps","odp","sxi"])?viewUrl="downloadAttachment?recId="+actRecId+"&fileId="+fId+"&mode=view&acttype="+type+"&type=false":-1!==$.inArray(extn,["pdf","html","htm","txt","java","js","xml","c","cpp","h","sh","swift","vb","json","css","svg","properties","ics"])&&(viewUrl="downloadAttachment?recId="+actRecId+"&fileId="+fId+"&mode=view&acttype="+type+"&type=true"),viewUrl},getHTMLforLinkStream:function(content,isResp,editor){if(200===content.code){var htmlContent;if(htmlContent=-1===content.linktype.indexOf("image")&&-1===content.linktype.indexOf("photo")&&void 0===content.embedUrl?'<div class="zp-link-feedsmall MT20 clearfix">':'<div class="zp-link-feedsmall zp-link-feedbig MT20 clearfix">',void 0!==content.embedUrl?htmlContent+='<div class="zp-link-imgleft"><a class="zp-linkimg left"  embedUrl="'+content.embedUrl+'" style="background-image: url('+content.thumbnailurl+');"><div class="zp_ann-vdicn" onclick="ZPFeeds.Activity.loadIframeforembedVideo(this)"> <i class="IC-getstart"></i></div></a></div>':-1===content.linktype.indexOf("image")&&-1===content.linktype.indexOf("photo")?htmlContent+='<div class="zp-link-imgleft">'+(void 0!==content.thumbnailurl?'<a class="zp-linkimg left" target="_blank"  href='+content.url+' style="background-image: url('+content.thumbnailurl+');"></a>'+(!0===isResp?'<div class="noImgCb"><label class="checkbox"><input type="checkbox" id="noImgChkBox"  name="chk3"><span>No image</span></label></div>':""):"")+"</div>":htmlContent+="<div>"+(void 0!==content.thumbnailurl?'<a class="zp-linkimg left" target="_blank" href='+content.thumbnailurl+' style="background-image: url('+content.thumbnailurl+');"></a>'+(!0===isResp?'<div class="noImgCb"><label class="checkbox"><input type="checkbox" id="noImgChkBox" name="chk3"><span>No image</span></label></div>':""):"")+"</div>",htmlContent+='<div class="zp-link-feedcont '+(void 0===content.thumbnailurl?" noImage":"")+'">',void 0!==content.title&&content.title.trim().length>0&&(htmlContent+='<a class="zp-link-feedurl" target="_blank" href="'+content.url+'">'+content.title+"</a>"),void 0!==content.description){var description=$("<div>").html(content.description).text();description.length>0&&description.length<150?(description=description.slice(0,200),description+="..."):description=content.url,htmlContent+='<div class="zp-link-feedesc">'+description+"</div>"}return void 0!==content.domainname&&(htmlContent+='<a target="_blank"  href='+content.url+'><label class="zp-weburl" >'+content.domainname+"</label></a>"),!0===isResp&&(htmlContent+='<i class="icon-close IC-cls-1px" id="linkcloseIcon"></i>'),htmlContent+="</div></div>",1==isResp&&((htmlContent=$(htmlContent)).find("#noImgChkBox").on("change",function(){ZPFeeds.URLinfo.removeThumbnail(this,editor)}),htmlContent.find("#linkcloseIcon").on("click",function(){ZPFeeds.Attachment.removeAttachment(this,content.url,void 0,void 0,editor)})),htmlContent}},loadIframeforembedVideo:function(Obj){$(Obj).addClass("DNI").parent().addClass("DN"),$(Obj).after('<iframe width="100%" height="270px" allow="autoplay" src="'+$(Obj).parent().attr("embedurl")+'" frameborder="0" allowfullscreen=""></iframe>')},getAssignedUserList:function(assUser,actOwner,actObj){if(void 0!==assUser&&""!==assUser.trim()){var list=assUser.split(",");list=ZPUtil.removeDuplicatesFromArray(list);var imageList=new Array,pos=0,maxLen=list.length>11?11:list.length;for(i=0;i<maxLen;i++)if(actOwner!==list[i]){var userDtl=void 0;if(void 0!==list[i]&&""!==list[i].trim()&&(userDtl=ZPFeeds.getUserDetails(list[i])),void 0!==userDtl){var imgDtl={};imgDtl.userimage=userDtl.thumb,imgDtl.id=userDtl.id,imgDtl.erecno=userDtl.usererec,imageList[pos]=imgDtl,pos++}if(10===pos)break}actObj.assignedUsers=imageList,actObj.isMoreOpt=list.length>9}else actObj.assignedUsers=void 0,actObj.isMoreOpt=!1},showApproverDetail:function(Obj,actRecId,index){var feedObj=ZPFeeds.getCurrentViewContainer().find("[streamid='"+actRecId+"']"),feedData=feedObj.data("activityObj");if(void 0!==feedData){var apprObj=feedData.appList[index],currentApprDtl=feedData.currentApprDtl,approverhtml="";if(apprObj.isCurrent||apprObj.isApproved||apprObj.isRejected){apprObj.isCurrent&&!feedData.isApprovalCompleted?"role"===currentApprDtl.currentApprType?approverhtml+="<div>"+ZPI18N.getString("zp.role")+" : "+ZSEC.Encoder.encodeForHTML(apprObj.displayName)+"</div>":"department"===currentApprDtl.currentApprType?approverhtml+="<div>"+ZPI18N.getString("zp.department")+" : "+ZSEC.Encoder.encodeForHTML(apprObj.displayName)+"</div>":"group"===currentApprDtl.currentApprType?approverhtml+="<div>"+ZPI18N.getString("zp.group")+" : "+ZSEC.Encoder.encodeForHTML(apprObj.displayName)+"</div>":apprObj.displayName&&(approverhtml+="<a>"+apprObj.displayName+"</a>"):(approverhtml+="<a>"+apprObj.displayName+"</a>",void 0!==apprObj.deptName&&(approverhtml+="<div>"+ZPI18N.getString("zp.department")+" : "+apprObj.deptName+"</div>"),apprObj.approvalTime&&(approverhtml+='<div class="aptim">'+apprObj.approvalTime+"</div>")),apprObj.isCurrent?feedObj.find("#approveRejectBox").removeClass("DN"):feedObj.find("#approveRejectBox").addClass("DN"),feedObj.find("#zp_feeds_approverdetails").html(approverhtml);var className=apprObj.isApproved?"zpagsel":apprObj.isRejected?"zparsel":"zpasel";$(Obj).attr("class",className),$(Obj).siblings(".zparsel").attr("class","zparej"),$(Obj).siblings(".zpagsel").attr("class","zpaapp"),$(Obj).siblings(".zpasel").attr("class","zpanor")}}},ConvertJSONArrToStr:function(Jarr){var array=Jarr.toString().split(","),content="";for(var i in array)i!=array.length-1?content+=array[i]+",":content+=array[i];return content},getFileSharedDetails:function(activityObj,peopleActObj){var sharedTo=activityObj.getAdditionalProperty("sharedTo");if(peopleActObj.isGroupShared=!0,peopleActObj.sharedDisplayName=ZPI18N.getString("zp.all"),peopleActObj.sharedClass="IC-usr-grp gry S20","NONE"===sharedTo)peopleActObj.sharedToNone=!0;else if(peopleActObj.sharedToNone=!1,"LOCATION"===sharedTo&&(peopleActObj.sharedClass="IC-loca","#multipleLocations#"!=activityObj.getAdditionalProperty("locationName")?peopleActObj.sharedDisplayName=ZPFeeds.Activity.ConvertJSONArrToStr(activityObj.getAdditionalProperty("locationName")):peopleActObj.sharedDisplayName=ZPI18N.getString("zp.notifymultiplelocations")),"ROLE"===sharedTo&&(peopleActObj.sharedClass="IC-usr-fill S18","#multipleRoles#"!=activityObj.getAdditionalProperty("roleName")?peopleActObj.sharedDisplayName=ZPFeeds.Activity.ConvertJSONArrToStr(activityObj.getAdditionalProperty("roleName")):peopleActObj.sharedDisplayName=ZPI18N.getString("zp.notifymultipleroles")),"REPORTING_TO_ONLY"===sharedTo||"REPORTING_TO"===sharedTo||"OWNER"===sharedTo){peopleActObj.isGroupShared=!1;var reportingTo=activityObj.getAdditionalProperty("reportingTo"),dualreportingTo=activityObj.getAdditionalProperty("dualreportingTo"),userDtl={};if(void 0!==reportingTo){var reportingToDtl=ZPFeeds.getUserDetails(reportingTo,!0);userDtl.reportingToErec=reportingToDtl.usererec,userDtl.reportingToImg=reportingToDtl.avatar}if(void 0!==dualreportingTo){var dualreportingToDtl=ZPFeeds.getUserDetails(dualreportingTo,!0);userDtl.dualReportingToErec=dualreportingToDtl.usererec,userDtl.dualReportingToImg=dualreportingToDtl.avatar}var fileOwner=activityObj.getAdditionalProperty("fileOwner");if(void 0!==fileOwner){var fileOwnerDtl=ZPFeeds.getUserDetails(fileOwner,!0);userDtl.fileOwnerErec=fileOwnerDtl.usererec,userDtl.fileOwnerImg=fileOwnerDtl.avatar}void 0===fileOwner&&void 0===reportingTo||(peopleActObj.isGroupShared=!1,peopleActObj.sharedUserDtl=userDtl)}},handleDelete:function(fdk){Layout.Page.container.find("input#"+ZPUtil.escapeSelector(fdk)).parents("#actOuterCont").fadeOut(1e3,function(){$(this).remove(),0===Layout.Page.container.find("#"+ZPUtil.escapeSelector(ZPeople.CURRENT_VIEWKEY)).find("div").length&&People._View.nodata(ZPeople.CURRENT_VIEWKEY)})},showApproveRejectOpt:function(Obj,type,actRecId,dfaid,tableName){var parentObj=$(Obj).parent().parent();if(0===parentObj.siblings("#zp_feeds_approvereject_container").length){parentObj.after('<div class="ZPacbg PR" id="zp_feeds_approvereject_container"><div class="ZPacuarr" style="right: '+("1"===type?"75px;":"25px;")+'"></div><div id="zp_feeds_approverreject" class="'+("1"===type?"ZPgrn":"ZPred")+'"><div class="clf"><textarea id="zp_feeds_approvereject_comment" placeholder="'+ZPI18N.getString("zp.writeacomment")+'" class="tarea"></textarea></div><div class="crg"><input type="button" value="'+ZPI18N.getString("zp.submit")+'" id="zp_feeds_submit_approval" class="tbut"></div></div></div>');var approvalObj=parentObj.siblings("#zp_feeds_approvereject_container").find("#zp_feeds_submit_approval");approvalObj.length>0&&(approvalObj[0].onclick=function(){approvalObj.attr("disabled",!0);var feedObj=ZPFeeds.getCurrentViewContainer().find("[streamid='"+actRecId+"']"),feedData=feedObj.data("activityObj"),type=feedObj.find("#zp_feeds_approverreject").hasClass("ZPgrn")?"1":"0",comment=feedObj.find("#zp_feeds_approvereject_comment").val();if("P_TimesheetList"===tableName){var recordId=actRecId;Timetracker.timesheet.timesheetApproval(dfaid,type,recordId,comment,feedObj)}else if("P_MultiRater_Approval"===tableName){recordId=actRecId;ZPFeeds.PMS.Approval.mrApproveRejectSubmitFromFeed(recordId,type,comment)}else if("P_Budget_Splitup"===tableName){recordId=actRecId;ZPFeeds.PMS.Approval.approveRejectReviewSheetFromFeed(recordId,type,comment)}else{var recIds=new Array(actRecId),formId=feedData.formId;ZP5Form.Record.approveReject(recIds,type,comment,!1,ZP5Form.RecordApproval.handleApproveRejectResponse,!0,formId)}})}else"1"===type?(parentObj.siblings("#zp_feeds_approvereject_container").find(".ZPacuarr").css("right","75px"),parentObj.siblings("#zp_feeds_approvereject_container").find("#zp_feeds_approverreject").removeClass("ZPred").addClass("ZPgrn")):(parentObj.siblings("#zp_feeds_approvereject_container").find(".ZPacuarr").css("right","25px"),parentObj.siblings("#zp_feeds_approvereject_container").find("#zp_feeds_approverreject").removeClass("ZPgrn").addClass("ZPred"));parentObj.siblings("#zp_feeds_approvereject_container").find("textarea").trigger("focus")},viewSingleFeed:function(fdk){var params={actionType:"VIEW_SINGLE_FEED",activityKey:fdk,viewKey:ZPeople.CURRENT_VIEWKEY};ZPeople.Request.send("/feedActions.zp",params,ZPFeeds.Activity.success)},success:function(resultObj){if("false"!==resultObj.success){var activity=resultObj.activity,activityObj=new People.Activity(new Activity(activity));ZPFeeds.Activity.constructActivityList("singlefeed",ZPeople.CURRENT_VIEWKEY,activityObj,!0,!0),void 0!==Layout.Page.urlparam.formview&&activityObj.type===People.Approval.type&&$("[streamid='"+activityObj.actRecId+"']").find("#middcontainer").find("#viewcompleteDtls").trigger("click"),void 0!==resultObj.likedUsrs&&Object.keys(resultObj.likedUsrs).length>0&&ZPFeeds.Like.iterateLikedUsers(resultObj.likedUsrs)}else{var currViewObj=Layout.Page.container.find("#"+ZPUtil.escapeSelector(ZPeople.CURRENT_VIEWKEY)),msg=ZPI18N.getString("zp.nofeedsyet");"deleted"===resultObj.status?msg=ZPI18N.getString("zp.activitygotdeleted"):"PermissionDenied"===resultObj.status?msg=ZPI18N.getString("zp.announcementpermissiondenied"):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")),0===currViewObj.find("#zp_feeds_nodata").length&&currViewObj.html('<div class="zp-fd-box zpl_crd zpl_nodata" id="zp_feeds_nodata"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"> <div> <div class="zpl_emptimg zp_nd_faq"></div> <h4>'+msg+"</h4> </div> </div> </div> </div>")}}},ZPFeeds.Editor={editorList:{},Last_SearchType:"emp",resultObj:{},getSmileyCss:function(smileyname){return ZPFeeds.Editor.Smileys_List[":"+smileyname+":"]},getSmileyHTML:function(className,value){return"<img id='smileys' src='"+ZPeople.getResourceURL(newUIImageUrl+"spacer.gif")+"' class='"+className+"' STYLE='background-image: url("+ZPeople.getResourceURL(newUIImageUrl+"smileys-2X.png")+"); vertical-align: middle; width: 24px; height: 24px; display: inline-block; background-size: 240px; overflow: hidden; vertical-align: middle; background-position:"+ZPFeeds.Editor.getEditorSmileyCss(value)+"' name='"+value+"'></img>"},getEditorSmileyCss:function(value){return ZPFeeds.Editor.Smileys_List[value]},Smileys_List:{":smilenew:":"0 0;",":lol:":"-24px 0;",":sad:":"-168px -24px;",":angry:":"-72px -48px;",":tongueout:":" -48px -24px;",":winknew:":"-24px -24px;",":meh:":" -192px -72px;",":shocked:":"-168px 0;",":worried:":"-24px -48px;",":sleepy:":"-168px -48px;",":lipssealed:":"-216px -72px;",":neutral:":" -168px -72px;",":like:":" 0 -120px;",":dislike:":"-24px -120px;",":claps:":"-168px -120px; ",":searching:":"-216px 0;",":ontarget:":"-24px -168px;",":tensed:":"-96px -48px;",":dizzy:":"-72px -72px;",":coolnew:":"-96px 0;",":yummy:":"-120px -24px;",":idea:":"0 -24px; ",":injured:":"-144px -72px;",":sick:":"-120px -72px;",":anxious:":"0 -48px;",":doubtful:":"-24px -72px;",":tearofjoy:":"-48px 0;",":halo:":"-96px -24px;",":grin:":"-72px 0;",":curious:":"-144px 0;",":thinking:":"-192px 0;",":relaxed:":"-72px -24px;",":yuck:":"-144px -24px;",":blush:":"-192px -24px;",":upset:":"-216px -24px;",":stressed:":"-48px -48px;",":tired:":"-120px -48px;",":bored:":"-144px -48px;",":jealous:":"-192px -48px;",":evil:":"-216px -48px;",":facepalm:":"0 -72px;",":surprise:":"-48px -72px;",":headache:":"-96px -72px;",":namaste:":"-48px -120px;",":super:":"-72px -120px;",":birthday:":"0 -216px;",":feelingwarm:":"0 -96px;",":feelingcold:":"-24px -96px;",":loveit:":"-120px 0;"},getEditorContainer:function(actJson,isEdit){var editorHtml='<div class="zp-fd-compose '+(actJson.isActivity?"":"edtr_rply")+" "+(1==actJson.isTopBar?"tlbarTop":"")+(1==isEdit?"edtr_edt":"")+'" id="editor_container"><div class="zp-fd-composeCont"> <div class="composeDesc-Cont">';return actJson.isavatarnded&&(editorHtml+='<a class="zp-fd-avatar"> <img class="zp-uimg" src="'+ZPeople.CURR_USER.thumb+'"> </a>'),editorHtml+='<div class="composeDesc-Wrap" id="'+actJson.divId+'">',actJson.isTitleNeeded&&(editorHtml+='<div class="Ann_titStatus clearfix" data-toggle="tooltip" data-placement="right" data-html="true" title="'+ZPI18N.getString("zp.addtitle")+'">'+(1==actJson.avoidTitleIcon?"":'<span class="zei-add-title"></span>')+"</div>"),editorHtml+="</div>",editorHtml+="</div></div>",!(!actJson.isAttachNeeded||1!=actJson.isAttachNeeded)||(!0!==actJson.isActivity&&actJson.type!==People.Status.type&&actJson.type!==People.Collaboration.type&&actJson.type!==People.HrCase.type&&actJson.type!==People.Announcement.type||(editorHtml+='<div class="attachedContainer clearfix DN" id="zp_dash_attachments" attachcnt="0"><p>'+ZPI18N.getString("zp.draganddropatthere")+'</p></div><div class="DN" id="zp_dash_linkattachment"></div>'),editorHtml+='<div class="zp-fd-composeActions">',editorHtml+='<div class="zp-editor-foot">',editorHtml+='<div class="editor-foot-col">'+(!0===actJson.isActivity||actJson.type===People.Status.type||actJson.type===People.Collaboration.type||actJson.type===People.HrCase.type||actJson.type===People.Announcement.type?'<div class="editor-atchment" onclick="ZPFeeds.Attachment.createInput(\''+(!0!==actJson.isActivity)+"', '"+(!0!==actJson.isActivity?actJson.actRecId:actJson.parentCon)+'\')" > <i class="zei-attachment"></i> </div>':""),void 0!==actJson.isAnonymousChkBoxNeeded&&!0===actJson.isAnonymousChkBoxNeeded&&ZPFeeds.PMS.Feedback.isPAFeedBackTab()&&(editorHtml+='<div class="zcheckbox"><input type="checkbox" name="check" id="zp_anonymfb" class="zcheckbox__helper"><label for="zp_anonymfb" class="zcheckbox__label">'+ZPI18N.getString("zp.anonymous")+"</label></div>"),!0!==actJson.isActivity&&actJson.type===People.HrCase.type&&(editorHtml+='<ul class="zp_casesBtn" name="cases_custBtn"></ul>'),editorHtml+="</div>",editorHtml+='<div class="editor-foot-col"><div class="editor-post-bt"> ',!0!==actJson.isActivity&&!0!==actJson.cancelnotneeded&&(editorHtml+='<button class="zlabel zlabel--outline zlabel--medium" id="zp_editor_cancelbtn">'+ZPI18N.getString("zp.cancel")+"</button>"),editorHtml+='<button class="zlabel zlabel--blue zlabel--medium zbutton zbutton--medium zbutton--primary" id="'+actJson.subBtnId+'">'+ZPI18N.getString(actJson.subBtnName)+"</button>",ZPUtil.Validation.isEmpty(actJson.custBtnId)||ZPUtil.Validation.isEmpty(actJson.custBtnName)||(editorHtml+='<button class="zlabel zlabel--blue zlabel--medium zbutton zbutton--medium zbutton--primary" id="'+actJson.custBtnId+'">'+ZPI18N.getString(actJson.custBtnName)+"</button> "),editorHtml+="</div> </div> </div> </div>",editorHtml+="</div></div>"),editorHtml+="</div>",Layout.Page.container.find("#zp_postTextarea").data("needWallChange",!0===actJson.isActivity),editorHtml},getExtraParams:function(params){return void 0!==ZE.mentionedjson&&ZE.mentionedjson.editor.initobj.searchCri,params},editorInlineImgUpload:function(fileinput,isurlmode,url){if(isurlmode)ZPeople.Request.send("/feedActions.zp",{actionType:"GET_URLINFO",link:url.trim()},ZPFeeds.Editor.videoUploadCallBack);else{var file=fileinput.files[0];if(UDS_UPLOAD_IS_ACTIVE){var fileCode=(new Date).getTime()+""+erecno,xhr=new XMLHttpRequest,udsUploadApi=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload";xhr.open("post",udsUploadApi,!0),xhr.setRequestHeader("x-assured-response",!0),void 0!=ZPeople.zaid&&xhr.setRequestHeader("x-cli-zaid",ZPeople.zaid),xhr.setRequestHeader("x-streammode","1"),xhr.setRequestHeader("x-fclient-version","2"),xhr.setRequestHeader("x-service",UDS_UPLOAD_SERVICE_CODE),xhr.setRequestHeader("app-info",JSON.stringify({portalId:_LOGGEDIN_ACCZSOID,moduleName:"Feeds"}));var params=JSON.stringify({fileName:encodeURIComponent(file.name),contentType:file.type,fileSize:file.size,fileCode:fileCode});xhr.setRequestHeader("file-info",params),xhr.setRequestHeader("upload-id",fileCode),xhr.withCredentials=!0,xhr.onreadystatechange=function(oEvent){var responseObj;4==xhr.readyState&&(200===xhr.status?(responseObj=JSON.parse(xhr.response),ZPFeeds.Editor.videoUploadCallBack(responseObj,!1)):ZPFeeds.Editor.videoFailureCallBack(JSON.parse(params),void 0,void 0))},xhr.send(file)}else void 0!==file&&file.size>0&&file.size<5242880&&($(fileinput).attr("name","file_upload"),$(fileinput).removeAttr("disabled"),$("body").append($('<form enctype="multipart/form-data" action="/feedActions.zp?actionType=ADD_ATTACHMENT" id="zp_AttachFile" method="post" target="feedsuploadwindow" style="display: none;"><input type="hidden" name="conreqcsr" id="csrfno" value="'+csrfToken+'"/><input type="hidden" name="activityType" value="Announcement"/></form><iframe id="feedsuploadwindow" name="feedsuploadwindow" style="display:none;" ></iframe>')),formObj=$("body").find("#zp_AttachFile"),formObj.append($(fileinput)),formObj.trigger("submit"))}},videoUploadCallBack:function(uploadedFileInfo,isurlmode){var videourl="";if(isurlmode)200==uploadedFileInfo.code&&void 0!=uploadedFileInfo.embedUrl&&""!=uploadedFileInfo.embedUrl.trim()?(videourl=ZPeople.decodeTxt(uploadedFileInfo.embedUrl),ZE.prototype.previewVideo(videourl,isurlmode,ZPeople.decodeTxt(uploadedFileInfo.thumbnailurl))):ZE.prototype.previewVideo(void 0,isurlmode);else if(UDS_UPLOAD_IS_ACTIVE){var fileInfo=uploadedFileInfo.fileInfo;if(0!=Object.keys(fileInfo).length)ZE.prototype.previewVideo(ZPFeeds.constructUDSDownloadUrl(fileInfo.fileId,void 0,void 0,!0),isurlmode,fileInfo.fileId);else if("Failure"==uploadedFileInfo.status){var antivirus=!1,error=!1;"Virus Found"==uploadedFileInfo.message?antivirus=!0:"An error occured in the File Transfer"==uploadedFileInfo.message&&(error=!0),ZPFeeds.Editor.videoFailureCallBack(fileInfo,antivirus,error),ZE.prototype.previewVideo(void 0,isurlmode,"")}}else if($("form#zp_AttachFile,iframe#feedsuploadwindow").remove(),1==uploadedFileInfo.success){var fileId=uploadedFileInfo.attachmentIds;ZE.prototype.previewVideo(ZPFeeds.constructUDSDownloadUrl(fileId,void 0,void 0,!0),isurlmode,fileId)}else ZPFeeds.Editor.videoFailureCallBack(void 0,!1,!0)},videoFailureCallBack:function(fileInfo,antivirus,error){var errMsg=ZPI18N.getString("zp.reuploadfile");antivirus?errMsg=ZPI18N.getString("zp.virusfile"):error&&(errMsg=ZPI18N.getString("zp.fileuploaderror")),ZPeople.Message.showWarningMsg(errMsg)},getEditor:function(txtID,type,initObj,actJson){try{var initobject={id:txtID,mode:"richtext",isMiniEditor:!1,avoidDropHandle:!0,avoidMoreOption:!0,searchEntity:["emp","dept","grp"]},isPost=!1;if("zp_postEditor"===txtID||"zp_noteEditor"===txtID){isPost=!0,initobject.editorheight="150";var _editorId="zp_noteEditor"===txtID?"zp_noteEditor":"zp_postEditor";Layout.Page.container.find("#"+_editorId).css("height",initobject.editorheight+"px"),initobject.placeholder=Layout.Page.container.find("#zp_postTextarea").attr("placeholder"),initobject.afterEditorLoadCallback=ZPFeeds.registerappendTitleCont,initobject.currentContainer=Layout.Page.container}else void 0===initObj&&(initobject.editorheight=actJson.editorheight?actJson.editorheight:"120",-1==Layout.Page.currentmode.indexOf("home/feeds/")?initobject.currentContainer=ZPFeeds.getCurrentViewContainer(actJson.actRecId):void 0===actJson.currentcontainer?initobject.currentContainer=ZPFeeds.getCurrentViewContainer():initobject.currentContainer=actJson.currentcontainer,initobject.currentContainer.find("#"+ZPUtil.escapeSelector(txtID)).css("height",initobject.editorheight+"px"),initobject.placeholder=ZPI18N.getString("zp.writeacomment"));if(void 0!==initObj&&(initobject.currentContainer=initObj.currentContainer,initobject.editorheight=initObj.editorheight,initobject.isMiniEditor=initObj.isMiniEditor,initobject.placeholder=void 0!==initObj.placeholder?initObj.placeholder:void 0,void 0!==initObj.extraParamCallback&&(initobject.extraParamCallback=initObj.extraParamCallback),void 0!==initObj.afterEditorLoadCallback&&(initobject.afterEditorLoadCallback=initObj.afterEditorLoadCallback)),"Feedback"!==type&&(void 0!==initObj&&1!=initObj.isMentionsEnabled||void 0!=actJson&&actJson.noneedMentioninEdit||(initobject.handleAutoFill=!0,initobject.getAutofillElements=function(){})),"HrCase"===type){var isAllowedPerm=CaseViewPage.toCheckFeedEditorCustomeBtnPerm(actJson);zpEditor=ZPUtil.initiateZEEditor(initobject,type,isAllowedPerm.isAgent,isAllowedPerm.isComment,isAllowedPerm.isEscalatorUser)}else zpEditor="HRCaseNote"===type||"BulkUpdateEdit"===type||"Assessment"===type||"Survey"===type||"Survey_Template"===type?ZPUtil.initiateZEEditor(initobject,type):ZPUtil.createZEEditor(initobject,!0,!1);return zpEditor.afterEditorLoad(function(){$(zpEditor.editordiv).attr("id","zpEditor"),void 0!==initObj&&!0===initObj.isOtherEditor?$(zpEditor.editordiv).addClass("Othr_edtr"):"HrCase"!==type&&"HRCaseNote"!==type&&"BulkUpdateEdit"!==type&&"Assessment"===type&&$(zpEditor.editordiv).removeClass("Othr_edtr"),void 0!==initObj&&1==initObj.isTopBar&&$(zpEditor.editordiv).addClass("tlbarTop"),void 0!==initobject.afterEditorLoadCallback&&ZPUtil.Validation.isFunction(initobject.afterEditorLoadCallback)&&initobject.afterEditorLoadCallback(zpEditor);var bodyObj=$(zpEditor.iframe.contentDocument.body);bodyObj.on("keyup",function(){ZPFeeds.getCurrentEditor(void 0!==actJson?actJson.actRecId:void 0),(actJson&&actJson.hasOwnProperty("isAutogrowEnabled")||void 0!==initObj)&&(actJson&&actJson.hasOwnProperty("isAutogrowEnabled")||!0!==initObj.isAutogrowEnabled)||ZPFeeds.setFeedEditorHeight(this,isPost)}),bodyObj.on("keydown",function(){ZPFeeds.getCurrentEditor(void 0!==actJson?actJson.actRecId:void 0),(actJson&&actJson.hasOwnProperty("isAutogrowEnabled")||void 0!==initObj)&&(actJson&&actJson.hasOwnProperty("isAutogrowEnabled")||!0!==initObj.isAutogrowEnabled)||ZPFeeds.setFeedEditorHeight(this,isPost)}),"Status"!==type&&"Collaboration"!==type&&isPost||(bodyObj.on("dragenter",function(event){ZPFeeds.getCurrentEditor(void 0!==actJson?actJson.actRecId:void 0),ZPFeeds.Attachment.dragOverAttachments(event,isPost,void 0!==actJson?actJson.actRecId:void 0)}),$(zpEditor.editordiv).find(".Zp-fd-plchldr").on("dragenter",function(event){ZPFeeds.getCurrentEditor(void 0!==actJson?actJson.actRecId:void 0),ZPFeeds.Attachment.dragOverAttachments(event,isPost,void 0!==actJson?actJson.actRecId:void 0)}))}),ZPFeeds.Editor.editorList[txtID]=zpEditor,ZPFeeds.Editor.editorList[txtID]}catch(err){}},getUserlistResponse:function(result,json){var searchType=json.searchType,searchEntities=json.searchEntity;if(ZPFeeds.ISPROCESS_FINISH=!0,void 0===result)return searchType;if(ZPFeeds.SEARCH_KEY===json.currText)if(result.length>5&&"emp"===searchType)ZPFeeds.Editor.resultObj[searchType]=result;else if(result.length<5)if(ZPFeeds.Editor.resultObj[searchType]=result,searchEntities.indexOf(searchType)+1<searchEntities.length){var entitytype=searchEntities.indexOf(searchType);ZPFeeds.Editor.getMentionedDatas(searchEntities[entitytype],json)}else ZPFeeds.Editor.Last_SearchType=void 0;else ZPFeeds.Editor.resultObj[searchType]=result,ZPFeeds.ISPROCESS_FINISH=!0;else ZPFeeds.Editor.Last_SearchType=void 0,ZPFeeds.Editor.getMentionedDatas(searchEntities[0],json);ZPFeeds.MENTION_DATA=[];var typeArr=searchEntities;for(i=0;i<typeArr.length;i++){var Obj=ZPFeeds.Editor.resultObj[typeArr[i]];if(void 0!==Obj)for(j=0;j<Obj.length;j++)Obj[j].searchType=typeArr[i]}return ZPFeeds.MENTION_DATA=(void 0!==ZPFeeds.Editor.resultObj.emp?ZPFeeds.Editor.resultObj.emp:[]).concat(void 0!==ZPFeeds.Editor.resultObj.dept?ZPFeeds.Editor.resultObj.dept:[]).concat(void 0!==ZPFeeds.Editor.resultObj.grp?ZPFeeds.Editor.resultObj.grp:[]),searchType},getMentionedDatas:function(searchtype,json){if(!0===ZPFeeds.ISPROCESS_FINISH){ZPFeeds.ISPROCESS_FINISH=!1;var searchEntities=json.searchEntity;if(void 0!=searchEntities&&0!=searchEntities.length||(searchEntities=["emp"]),void 0===ZPFeeds.Editor.Last_SearchType)searchtype=searchEntities[0];else{var entitytype=searchEntities.indexOf(searchtype);-1!==entitytype&&entitytype+1<searchEntities.length?searchtype=searchEntities[entitytype+1]:(searchtype=searchEntities[0],ZPFeeds.MENTION_DATA={})}var limit=void 0!==ZPFeeds.MENTION_DATA&&ZPFeeds.MENTION_DATA.length>0&&ZPFeeds.MENTION_DATA.length<10?10-ZPFeeds.MENTION_DATA.length:10;!ZPFeeds.ISPROCESS_FINISH&&void 0!==searchtype&&(1==searchEntities.length||searchEntities.indexOf(searchtype)<=searchEntities.length-1)?(ZPFeeds.Editor.Last_SearchType=searchtype,json.searchType=searchtype,json.currText=ZPFeeds.SEARCH_KEY,ZPComponents.Search.get(ZPFeeds.SEARCH_KEY,{currText:ZPFeeds.SEARCH_KEY,type:0,limit:limit,respfun:ZE.getUserListResponse,searchType:searchtype,searchMode:"FEEDS",anchorNode:ZE.mentionedjson.anchorNode,pos:ZE.mentionedjson.pos,editor:ZE.mentionedjson.editor,searchEntity:searchEntities,extraParamCallback:json.extraParamCallback,initObj:json})):ZPFeeds.ISPROCESS_FINISH=!0}},getfocusOnEditor:function(editor,isBlur,time){setTimeout(function(){ZPFeeds.Editor.addRemovePlaceholder(editor,isBlur)},void 0!==time?time:50)},addRemovePlaceholder:function(editor,isBlur,isSuddenFocus,focusnotneeded){if(void 0!==editor&&null!=editor){var message=editor.getContent();1==isBlur&&ZPFeeds.Editor.checkIsEmpty(message)&&($(editor.editordiv).find(".Zp-fd-plchldr").removeClass("DNI"),$(editor.editordiv).find(".ze_area").addClass("DNI")),0==isBlur&&($(editor.editordiv).find(".Zp-fd-plchldr").addClass("DNI"),$(editor.editordiv).find(".ze_area").removeClass("DNI"),void 0!==editor.squireInstance&&1!=focusnotneeded&&(1==isSuddenFocus?editor.squireInstance.focus():setTimeout(function(){editor.squireInstance.focus()},50)))}},checkIsEmpty:function(content){var tempdiv=$("<div></div>").append(content);return 0==ZPFeeds.getTextContent(content).length&&0===tempdiv.find("img").length&&0===tempdiv.find("table").length&&0===tempdiv.find("blockquote").length&&0===tempdiv.find("blockquote").length&&0===tempdiv.find("ul").length&&0===tempdiv.find("ol").length&&0===tempdiv.find("hr").length&&0===tempdiv.find("video").length&&0===tempdiv.find("iframe").length}},ZPFeeds.Construction={constructFeedsTemplates:function(actJson,renderType){var type=actJson.type;actJson.actOwner||(actJson.actOwner=ZPFeeds.getUserDetails());var actOwner=actJson.actOwner;actJson.owner=actOwner.usererec;let headerExtraCls="";type===People.Feedback.type&&(headerExtraCls=actJson.leftFbColour);var actOuterObj='<div class="zp-fd-box '+headerExtraCls+'" streamid="'+actJson.actRecId+'" id="actOuterCont">';if(actJson.isSystemImage?actOuterObj+='<div class="zp-fd-uimg"><img empid="'+actOwner.usererec+'" elem ="profilePhoto" class="zp-uimg" popup="system" src="'+ZPeople.getResourceURL(imageUrl+"home/auto-app.jpg")+'"></div>':actOuterObj+='<div class="zp-fd-uimg"><img elem ="profilePhoto" class="zp-uimg" popup="user" empid="'+actOwner.usererec+'" src="'+actOwner.thumb+'"></div>',actOuterObj+='<div class="zp-fd-content" id="middcontainer">',!ZPFeeds.SINGLEPOP){var editHtml=type!==People.Status.type&&type!==People.Announcement.type||erecno!==actJson.actOwner.usererec||ZPeople.onBoardingStatus?"":'<li  id="zp_fd_edit"> <a> <span class="CR-ed-pen"></span>'+ZPI18N.getString("zp.edit")+"</a> </li>",deleHtml=!0===actJson.isDeleteAllowed&&type!==People.Announcement.type?'<li id="act_del_icon"> <a class="zp-pst_del"><span class="CR-ed-delete"></span>'+ZPI18N.getString("zp.delete")+"</a> </li>":"";actOuterObj+='<div class="zp-fd-pstedt seltick ZPCusDrs"> <a data-toggle="dropdown"> <i class="PI_more"></i> </a> <ul class="dropdown-menu ZPCmn-Arrow top gray"><li id="copyposturl"><a> <span class="CR-ed-link"></span>'+ZPI18N.getString("zp.copyposturl")+"</a> </li>"+editHtml+deleHtml+'</ul><input type="hidden" id="type" value="'+type+'"/><input type="hidden" id="actrecid" value="'+actJson.actRecId+'"/><input type="hidden" id="'+actJson.fdk+'" value=""/></div>'}let fbExtraCls="",fbExtraCls2="";if(type===People.Feedback.type&&(fbExtraCls="flex-1",fbExtraCls2="zpl_fedbckcrd"),actOuterObj+='<div class="zp-post-udt '+fbExtraCls2+'"><div class="zp-post-head '+fbExtraCls+'">'+(type===People.Survey.type?"":actJson.title)+'<span class="zp-pdate"><a style="color:#999;" href="/'+(portalName&&null!=portalName&&""!=portalName?portalName+ZPeople.CONTEXT:ZPeople.CONTEXT)+"#"+ZPFeeds.getFeedUrl()+"-view:"+actJson.fdk+'" target="_blank">'+actJson.postedTime+"</a></span></div>",type===People.Feedback.type&&(actOuterObj+='<div class="zpl_fedbcktag zpl_tg '+actJson.fbTypeInfoCol+'" title="'+actJson.fdbktypeName+'"><span class="d-flexC"><i class="'+actJson.fbImageType+'"></i>&nbsp;'+actJson.fdbktypeName+"</span></div>"),actOuterObj+="</div>",actOuterObj+=ZPFeeds.Construction.constructBodyContent(actJson),type===People.FeedbackRequest.type?actOuterObj=actOuterObj:(actOuterObj+='<ul class="zp-post-actions zp-rActions">',actOuterObj=ZPFeeds.Construction.getLikesForAllowedTypes(type,actOuterObj),actOuterObj=ZPFeeds.Construction.getCommentForAllowedTypes(type,actJson,actOuterObj)),type===People.Announcement.type&&(actOuterObj+='<li class="zp-post-full" id="zp_fd_viewlink" ><span>'+ZPI18N.getString("zp.viewfullpost")+"</span></li>"),actOuterObj+="</ul></div></div>",actOuterObj+="</div>",actOuterObj=$(actOuterObj),type===People.Survey.type&&actJson.survey){let $cont=actOuterObj.find("div.zp-fd-zmail"),$head=actOuterObj.find("div.zp-post-head"),$span=$head.find("span");$head.prop("style","word-break:break-word");let headerContent=actJson.owner==erecno?ZPI18N.getString("zp.survey.feed.header.survey.name",[actJson.title]):ZPI18N.getString("zp.survey.feed.survey.name",[ZPeople.decodeTxt(ZPFeeds.getUserDetails(actJson.owner).name),actJson.title]);$head.html(ZDOMEEAPI.api.constructTextNode(headerContent)).append($span),$cont.append(ZDOMEEAPI.api.constructSurveyFeed(actJson.survey))}return"Edit"!==renderType?type!==People.MailAlert.type&&type!==People.FileCabinet.type&&type!==People.AppraisalCycle.type&&actOuterObj.append(ZPFeeds.Construction.bottomContainerConstruction(actJson)):type!==People.MailAlert.type&&type!==People.FileCabinet.type&&type!==People.AppraisalCycle.type&&actOuterObj.append($($("[streamid='"+actJson.actRecId+"']")[0]).find("#bottomcont").clone(!0)),ZPFeeds.Construction.addExtraEvents(actOuterObj,actJson),actOuterObj},getLikesForAllowedTypes:function(type,actOuterObj){return type!==People.Status.type&&type!==People.Collaboration.type&&type!==People.Announcement.type||(actOuterObj+='<li class="zp-post-like" id="zplike_link" type="0"><span class="reactText">'+ZPI18N.getString("zp.like")+"</span></li>"),actOuterObj},getCommentForAllowedTypes:function(type,actJson,actOuterObj){var isAllowed=!1;return(type!==People.MailAlert.type&&type!==People.FileCabinet.type&&type!==People.Training.type&&type!==People.Survey.type&&type!=People.AppraisalCycle.type||type===People.Feedback.type&&"true"!=!actJson.isAnonymous&&1!=actJson.isAnonymous)&&(isAllowed=!0,type==People.Shift.type&&void 0!==actJson.shiftActualOwner&&actJson.shiftActualOwner!==actJson.actOwner.usererec&&"hrms.shift.shiftchanged"!=actJson.title&&"hrms.shift.newshiftadded"!=actJson.title&&(isAllowed=!1),type!==People.Announcement.type||isadmin||isAnnAdmin&&erecno===actJson.actOwner.usererec||isOperationalRoleAdmin&&Announcement.isLocationInAdminProfile(actJson.locationId,ZPeople.CURR_USER.locId)||0===actJson.isCommentDisable||(isAllowed=!1),type===People.XoxodayNotify.type&&(isAllowed=!1)),isAllowed&&(actOuterObj+='<li class="zp-post-comment" id="zpcomment_link"><span>'+ZPI18N.getString("zp.comment")+"</span></li>"),actOuterObj},addExtraEvents:function(actOuterObj,actJson){var type=actJson.type;if(actOuterObj.find("#act_del_icon").on("click",function(){ZPFeeds.deleteConfirm("activity",$(this))}),actOuterObj.find("[purpose='edithislink']").on("click",function(event){var isActivity=!0,recId=$(event.target).parents("#actOuterCont").attr("streamid");"zpcmt_editlink"===event.target.id&&(isActivity=!1,recId=$(event.target).parents(".zp-cmtdiv").attr("commentid")),ZPFeeds.Edit.getEditedHistory(recId,isActivity)}),actOuterObj.find("#copyposturl").on("click",function(){ZPUtil.copytoClipboard(window.location.origin+"/"+(portalName&&null!=portalName&&""!=portalName?portalName+ZPeople.CONTEXT:ZPeople.CONTEXT)+"#"+ZPFeeds.getFeedUrl()+"-view:"+actJson.fdk)}),actOuterObj.find("#zp_fd_edit").on("click",function(){type==People.Announcement.type?window.location.href="#"+Announcement.URLCONTEXT+"announcements/list/edit-annId:"+actJson.actRecId+"/page:feed":type!=People.Status.type&&type!=People.Collaboration.type||ZPFeeds.Edit.initEdit(actJson.actRecId,!0,actJson)}),actOuterObj.find("#zp_fd_viewlink").on("click",function(){type==People.Announcement.type&&(window.location.href="#"+Announcement.URLCONTEXT+"announcements/list/view-annId:"+actJson.actRecId+"/page:feed")}),ZPFeeds.Like.registerLikeOptions(actOuterObj.find("#zplike_link"),actJson.actRecId,type,!1),actOuterObj.find("#zpcomment_link").on("click",function(){type===People.Feedback.type?actOuterObj.find("#cmtlistcont").children().length>0?void 0!==actOuterObj.find("#cmtlistcont").attr("style")&&""!==actOuterObj.find("#cmtlistcont").attr("style")?(actOuterObj.find("#cmtlistcont").removeAttr("style"),actOuterObj.find("#cmtpostcont").removeAttr("style"),ZPFeeds.Comment.showNewCommentBox(actJson)):(actOuterObj.find("#cmtlistcont").attr("style","display: none;"),actOuterObj.find("#cmtpostcont").attr("style","display: none;")):void 0!==actOuterObj.find("#cmtpostcont")[0]?void 0!==actOuterObj.find("#cmtpostcont").attr("style")?(actOuterObj.find("#cmtpostcont").removeAttr("style"),ZPFeeds.Comment.showNewCommentBox(actJson)):actOuterObj.find("#cmtpostcont").attr("style","display: none;"):ZPFeeds.Comment.showNewCommentBox(actJson):ZPFeeds.Comment.showNewCommentBox(actJson)}),type===People.Feedback.type)actOuterObj.find("#user_feedback_response").find("#happy, #unhappy").on("click",function(){ZPFeeds.PMS.Feedback.updateUserFeedbackResponse(this,actJson.actRecId)});else if(type===People.Approval.type)actOuterObj.find(".zp-aprvsteps").find(".zp-actimg").on("click",function(){ZPFeeds.Construction.showApproverejectModal(actJson)}),actOuterObj.find("#middcontainer").find("#viewcompleteDtls").on("click",function(){actJson.hasOwnProperty("isPhotoTransfer")&&actJson.isPhotoTransfer?ProfilePictureTransfer.photoTransferModel(actJson.actRecId):ZPFeeds.viewCompleteDetailsForm("VIEW",this)}),actOuterObj.data("activityObj",actJson);else if(type===People.FileCabinet.type)actOuterObj.find("#middcontainer").find("#zpfd_filename").on("click",function(){FilesHome.Activity.fetchDataForPreview(actJson.actRecId)});else if(type===People.Leave.type)actOuterObj.find("[class*='ZP-Leave-']").on("click",function(){new LeaveForm({isFromFeeds:!0}).view(actJson.actRecId)});else if(type==People.Training.type){if($(actOuterObj).on("click",function(eve){"A"==eve.target.tagName&&""!=eve.target.href&&(document.getElementById("zpntfn_detail_modal")&&$("#zpntfn_detail_modal").remove(),document.getElementById("zpntfn_modal")&&$("#zpntfn_modal").remove())}),"COURSE_COMPLETED_NOTIFICATION_KEY"==actJson.LMSNotificationKey||"SESSION_COMPLETED_NOTIFICATION_KEY"==actJson.LMSNotificationKey||"COURSE_FEEDBACK_PENDING_NOTIFICATION_KEY"==actJson.LMSNotificationKey){var initObj={courseId:actJson.courseId,batchId:actJson.batchId,role:actJson.role};"2"==actJson.role&&(initObj.feedbackFor=actJson.feedbackFor),"SESSION_COMPLETED_NOTIFICATION_KEY"==actJson.LMSNotificationKey&&(initObj.sessionId=actJson.sessionId),$(actOuterObj).find("[writeFeedback]").removeAttr("writeFeedback").on("click",function(){lmsbase.isMaskLayerConstructed()||lmsbase.createMaskLayer(),AddFeedback.init(initObj)})}if("COURSE_COMPLETED_NOTIFICATION_KEY"==actJson.LMSNotificationKey){var testInfo={testId:actJson.testId,assessmentId:actJson.assessmentId};$(actOuterObj).find("[takeTest]").removeAttr("takeTest").on("click",function(){lmstest.takeTest(testInfo.assessmentId)})}}else if(type==People.HrCase.type){var casesFeedObj=new CasesFeeds(actJson.actRecId,actOuterObj);actOuterObj.find("div.btn-pickup").find("button[caseid]").on("click",function(ev){casesFeedObj.pickupHRCase(this)}),actOuterObj.find("a[name=feed_priority]").on("click",function(ev){casesFeedObj.changePriority(this)}),actOuterObj.find("a[name=status]").on("click",function(ev){casesFeedObj.changeStatus(this)}),actOuterObj.find("a[name=cgyName]").on("click",function(ev){casesFeedObj.changeCategory(this)})}},bottomContainerConstruction:function(actJson,moreDetails){var bottomContainer='<div class="'+(moreDetails&&moreDetails.removeGray?"":"zp-fd-bottom")+'" id="bottomcont">';if(bottomContainer+='<ul class="zp-fd-content zp-fd-likedlist DN" id="zplike_container"></ul>',bottomContainer+='<div class="zp-fd-content zp-fd-tcmts '+(!ZPFeeds.SINGLEPOP&&actJson.totalComments>3?"":"DN")+'" id="view_more_cmts"><a totalcmts='+actJson.totalComments+">"+(void 0!==actJson.viewallcomments?actJson.viewallcomments:"")+"</a>"+("myspace"===Layout.Page.pageId||"dep_space"===Layout.Page.pageId||ZPFeeds.SINGLEPOP?'<input type="hidden" id="cmt_morekey" value="'+actJson.cmt_morekey+'"/><input type="hidden" id="cmt_skey" value="'+actJson.cmt_skey+'"/><input type="hidden" id="act_type" value="'+actJson.type+'"/><input type="hidden" id="act_fdk" value="'+actJson.fdk+'"/>':"")+"</div>",bottomContainer+="</div>",(bottomContainer=$(bottomContainer)).append('<div class="zp-fd-content zp-fd-cmtlist DN" id="cmtlistcont" actfdk="'+actJson.fdk+'"></div>'),actJson.totalComments>0){bottomContainer.find("#cmtlistcont").removeClass("DN");var comments=actJson.comments;comments.length>0&&(ZPFeeds.Construction.constructComments(bottomContainer,actJson,comments),(actJson.type!==People.Announcement.type||isadmin||isAnnAdmin&&erecno===actJson.owner||isOperationalRoleAdmin&&Announcement.isLocationInAdminProfile(actJson.locationId,ZPeople.CURR_USER.locId)||0===actJson.isCommentDisable)&&bottomContainer.append(ZPFeeds.Construction.constructTextArea(!0,actJson)))}return People.Feedback.type===actJson.type&&ZPFeeds.PMS.Feedback.isPAFeedBackTab()&&void 0!==actJson.isFbModulePage&&actJson.isFbModulePage&&(bottomContainer.find("#cmtlistcont").attr("style","display: none;"),bottomContainer.find("#cmtpostcont").attr("style","display: none;")),bottomContainer.find("#view_more_cmts").find("a").on("click",function(){void 0!==actJson.showMoreCallback?actJson.showMoreCallback(actJson.hasNext):ZPFeeds.Comment.getMoreComments(this)}),bottomContainer.find(".cboxElement").off("click"),bottomContainer.find(".cboxElement").on("click",function(event){$(event.target).hasClass("filedwn")||ZPFeeds.registerAttPreview(event,this,actJson.actRecId)}),bottomContainer},constructTextArea:function(isDisplay,actJson){var textareaObj=$('<div class="zp-fd-content zp-fd-cmtbox '+(!1===isDisplay?" DN":"")+'" id="cmtpostcont"><div class="zp-cmt-uimg" ><img class="zp-usimg" src="'+ZPeople.applyPortalName(ZPeople.CURR_USER.thumb)+'"></div><div class="zp-cmt-typebox" id="comment_cont"><textarea class="form-control zp-ctarea" id="cmt_textarea" ondragover="ZPFeeds.Attachment.dragOverAttachments(event,false,\''+actJson.actRecId+'\')" placeholder="'+ZPI18N.getString("zp.writeacomment")+'"></textarea></div></div>');return textareaObj.find("#cmt_textarea").on("click",function(){ZPFeeds.Comment.showNewCommentBox(actJson,this)}),textareaObj},constructComments:function(cmtContObj,actJson,comments,isPrepend){(cmtContObj=cmtContObj.find("#cmtlistcont")).removeClass("DN"),void 0!==actJson.cmore&&cmtContObj.siblings("#view_more_cmts").find("#cmt_morekey").val(actJson.cmore),ZPFeeds.setCommentedUserDetails(comments),cmtObj=ZPFeeds.Construction.iterateComments(actJson,comments,cmtContObj),!0===isPrepend?cmtContObj.prepend(cmtObj):1===comments.length&&cmtContObj.find("[commentId='"+comments[0].commentId+"']").length>0?cmtContObj.find("[commentId='"+comments[0].commentId+"']").replaceWith(cmtObj):cmtContObj.append(cmtObj)},isAdminDeleteAllowed:function(type,actJson){return!(null==type||!isadmin||type!=People.Announcement.type&&type!=People.Status.type&&type!=People.Collaboration.type)},iterateComments:function(actJson,comments){for(var commentId,cmtObj="",type=actJson.type,cnt=0;cnt<comments.length;cnt++){commentId=comments[cnt].commentId,comments[cnt].cmtattObj=void 0;var attachIdsList=comments[cnt].cmtattList;void 0===attachIdsList||type!==People.Status.type&&type!==People.Collaboration.type&&type!=People.HrCase.type&&type!=People.Announcement.type||(comments[cnt].cmtattObj=ZPFeeds.Activity.getAttachContent(attachIdsList,actJson.actRecId,comments[cnt].commentId,type)),cmtObj+='<div class="zp-cmtdiv" commentid="'+commentId+'" id="'+comments[cnt].cfdk+'" comments="'+actJson.totalComments+'"> ';var editHtml=type===People.MailAlert.type||type===People.HrCase.type||type===People.Task.type||type===People.Approval.type&&void 0!=comments[cnt].isSystemComment&&comments[cnt].isSystemComment?"":void 0!==comments[cnt].isApproverComment&&1==comments[cnt].isApproverComment||comments[cnt].commentOwnDtl.id!=ZPeople.CURR_USER.id||ZPeople.onBoardingStatus?"":'<li  id="zp_fd_cmtedit"> <a> <span class="CR-ed-pen"></span>'+ZPI18N.getString("zp.edit")+"</a> </li>",deleHtml=ZPFeeds.SINGLEPOP||comments[cnt].commentOwnDtl.id!=ZPeople.CURR_USER.id&&!0!==comments[cnt].isDelete?"":'<li id="cmt_del_icon"> <a class="zp-pst_del"><span class="CR-ed-delete"></span>'+ZPI18N.getString("zp.delete")+"</a> </li>";type==People.HrCase.type?("true"!=comments[cnt].isAllowedtoDelete||"true"==comments[cnt].isAllowedtoDelete&&!CasesCommon.isCaseAdmin(actJson.hr_categoryId)&&comments[cnt].commentOwnDtl.id!=ZPeople.CURR_USER.id)&&(deleHtml=""):type==People.Approval.type&&(comments[cnt].isSystemComment||!comments[cnt].isSystemComment&&comments[cnt].commentOwnDtl.id!=ZPeople.CURR_USER.id)&&(deleHtml=""),""!==deleHtml&&(cmtObj+='<div class="zp-fd-pstedt seltick ZPCusDrs"> <a data-toggle="dropdown" aria-expanded="false"> <i class="PI_more"></i> </a> <ul class="dropdown-menu ZPCmn-Arrow top gray">'+editHtml+deleHtml+'</ul><input type="hidden" id="type" value="'+type+'"/><input type="hidden" id="record_id" value="'+comments[cnt].commentId+'"/> </div>'),comments[cnt].isFromSLA||void 0!=comments[cnt].isSystemComment&&comments[cnt].isSystemComment?cmtObj+='<div class="zp-cmt-uimg"> <img class="zp-usimg zphvr-cpro" src="'+ZPeople.getResourceURL(imageUrl+"home/auto-app.jpg")+'"> ':type==People.EmpAcceptance.type&&void 0!=comments[cnt].isReviewerComment&&1==comments[cnt].isReviewerComment?cmtObj+='<div class="zp-cmt-uimg"> <img class="zp-usimg zphvr-cpro" src="'+ZPeople.getResourceURL(imageUrl+"user.png")+'"> ':cmtObj+='<div class="zp-cmt-uimg" popup="user" empid="'+comments[cnt].commentOwnDtl.id+'"> <img class="zp-usimg zphvr-cpro" src="'+ZPeople.applyPortalName(comments[cnt].commentOwnDtl.thumb)+'"> ',cmtObj+=(void 0!==comments[cnt].isApproverComment&&1==comments[cnt].isApproverComment?void 0!=comments[cnt].isSystemComment&&comments[cnt].isSystemComment?"":"Approved"==comments[cnt].approvalStatus?'<div class="zpcmt-apr"></div>':"Rejected"==comments[cnt].approvalStatus?'<div class="zpcmt-rej"></div>':"":"")+"</div>",type==People.EmpAcceptance.type&&void 0!=comments[cnt].isReviewerComment&&1==comments[cnt].isReviewerComment?cmtObj+='<div class="zp-cmt-content" id="zp_fd_cmteditcont"></div><div id="cmtCont" class="zp-cmt-content"><a class="zp-cmt-uname zphvr-cpro">'+ZPI18N.getString("zp.reviewer")+'</a><div class="zp-cmt-udt">'+comments[cnt].content+'</div> <div class="zp-cmt-uaction"> <ul><li class="zpcmt-date">'+ZPDateTime.getDateDisplayFormat(comments[cnt].commat)+"</li>":cmtObj+='<div class="zp-cmt-content" id="zp_fd_cmteditcont"></div><div id="cmtCont" class="zp-cmt-content">'+(comments[cnt].isFromSLA||void 0!=comments[cnt].isSystemComment&&comments[cnt].isSystemComment?'<a class="zp-cmt-uname zphvr-cpro">System</a>':'<a class="zp-cmt-uname zphvr-cpro" popup="user" empid="'+comments[cnt].commentOwnDtl.id+'">'+comments[cnt].commentOwnDtl.name+"</a>")+'<div class="zp-cmt-udt">'+comments[cnt].content+(void 0!==comments[cnt].cmtattObj?(ZPUtil.Validation.isEmpty(comments[cnt].cmtattObj.imgcontent)?"":comments[cnt].cmtattObj.imgcontent)+""+(ZPUtil.Validation.isEmpty(comments[cnt].cmtattObj.filecontent)?"":comments[cnt].cmtattObj.filecontent):"")+'</div> <div class="zp-cmt-uaction"> <ul><li class="zpcmt-date">'+ZPDateTime.getDateDisplayFormat(comments[cnt].commat)+"</li>",type===People.Status.type&&ZPeople.onBoardingStatus?cmtObj+='<span class="FR"><i class="OB-harte" id="zpcmt_like_link" action="0"></i></span><div name="comData"><input type="hidden" id="type" value="'+type+'"><input type="hidden" id="record_id" value="'+commentId+'"></div></div></div></div>':ZPFeeds.Like.isLikeAllowed(type)&&(cmtObj+='<li class="zpcmt-like reactText" id="zpcmt_like_link" action="0">'+ZPI18N.getString("zp.like")+"</li>"),cmtObj+="</ul></div> </div> </div></div>"}(cmtObj=$(cmtObj)).find("[name^=sharefaq]").off("click").on("click",function(e){var arr=$(this).attr("name").split("sharefaq"),faqViewObj=new CasesFaqView(arr[1]);faqViewObj.$pageDiv=$("body #modal_Container"),faqViewObj.init()});var isAllowed=!0;if(type==People.Announcement.type&&void 0!==actJson.isActive&&!0!==actJson.isActive&&(isAllowed=!1),isAllowed){var templikeObj=cmtObj.find("[id='zpcmt_like_link']");if(void 0!==templikeObj&&templikeObj.length>0)for(var i=0;i<templikeObj.length;i++)ZPFeeds.Like.registerLikeOptions(templikeObj[i],actJson.actRecId,actJson.type,!0)}return cmtObj.find("#cmt_del_icon").on("click",function(){void 0!==actJson.delBtnCallBack?actJson.delBtnCallBack("comment",$(this)):ZPFeeds.deleteConfirm("comment",$(this))}),cmtObj.find("#zp_fd_cmtedit").on("click",function(){type!==People.MailAlert.type&&type!==People.HrCase.type&&(actJson.comments=comments,ZPFeeds.Edit.initEdit($(this).parents(".zp-cmtdiv").attr("commentid"),!1,actJson))}),cmtObj},constructBodyContent:function(actObj){var bodyObj,type=actObj.type,params=new Array;if(type===People.Status.type||type===People.Collaboration.type||type===People.KRA.type||type===People.Goal.type||type===People.Approval.type||type===People.HrCase.type||type===People.JobSchedule.type||type===People.AddProject.type||type===People.AddSchedule.type||type===People.FileCabinet.type||type===People.Holiday.type||type===People.Training.type||type===People.Leave.type||type===People.XoxodayNotify.type)bodyObj='<div class="zp-post-cont" id="zpfd_msgcont">';else if(type===People.Announcement.type||type===People.MailAlert.type||type===People.Survey.type||type===People.AppraisalCycle.type)bodyObj='<div class="zp-fd-zmail">';else if(type===People.Shift.type){if(actObj.shifdetails)bodyObj=actObj.shifdetails.hasOwnProperty("conflictList")?'<div class="shift-dt">':'<div class="zp-post-cont">';else bodyObj='<div class="zp-post-cont">'}else type===People.Feedback.type&&(bodyObj="<div>");if(type===People.Status.type||type===People.Collaboration.type){if(type===People.Status.type&&void 0!==actObj.actTitle&&(bodyObj+="<h3><b>"+actObj.actTitle+"</b></h3>"),bodyObj+=actObj.content,type===People.Status.type){if(void 0!==actObj.actAttObj){var actAttObj=actObj.actAttObj;void 0!==actAttObj.imgcontent&&(bodyObj+=actAttObj.imgcontent),void 0!==actAttObj.filecontent&&(bodyObj+=actAttObj.filecontent)}void 0!==actObj.linkStream&&(bodyObj+=actObj.linkStream)}}else if(type===People.Announcement.type){if(bodyObj+='<div class="zp-mailic"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"home/fd-ann.svg")+'"></div><div class="zp-mailcont" onclick="Announcement.viewAnnouncementById(\''+actObj.actRecId+'\')"><h3><b class="CP">'+ZPeople.escapeHtml(actObj.subject)+"</b></h3>"+actObj.content+"</div>",bodyObj+='<div class="zp_catoLstn">',void 0!==actObj.categories&&actObj.categories.length>0){bodyObj+='<ul class="ann_category">';for(var clsclr=1,i=0;i<actObj.categories.length;i++)void 0!==Announcement.CATEGORIES[actObj.categories[i]]&&(bodyObj+='<li class="clrBg'+(0!=(clsclr=(i+1)%7)?clsclr:clsclr+1)+'"><span class="textClr">'+Announcement.CATEGORIES[actObj.categories[i]]+"</span></li>");bodyObj+="</ul>"}bodyObj+='<div class="postexp">',void 0!==actObj.expireDate&&isadmin&&(bodyObj+="<div><span>"+ZPI18N.getString("zp.expiry")+":</span><b>"+(-1==actObj.expireDate?ZPI18N.getString("zp.nil"):ZPDateTime.getDateDisplayFormat(actObj.expireDate))+"</b></div>"),void 0!==actObj.announceTo&&(bodyObj+="<div><span>"+ZPI18N.getString("zp.location")+':</span> <div class="cust-labelTags">'+actObj.announceTo+'<span class="clearfix"></span></div> </div>'),bodyObj+="</div></div>"}else if(type===People.MailAlert.type)bodyObj+='<div class="zp-mailic"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"home/fd-mail.svg")+'"></div><div class="zp-mailcont"><p>'+ZPI18N.getString("zp.from")+' : <a href="mailto:'+actObj.fromAddr+'">'+actObj.fromAddr+"</a></p>"+actObj.content+"<p>"+ZPFeeds.Construction.constructToccUsers(actObj)+"</div>";else if(type===People.AddProject.type||type===People.AddSchedule.type||type===People.FileCabinet.type||type===People.Holiday.type)bodyObj+=ZPFeeds.Construction.constructTableTypeActvities(actObj),type!==People.FileCabinet.type&&type!==People.Holiday.type||(bodyObj+=ZPFeeds.Construction.constructToccUsers(actObj));else if(type===People.Feedback.type){actObj.fbImageType;var fdbktypeName=actObj.fdbktypeName,fdbackstatus=1,fdbackstatusStr="";void 0!=actObj.happyTitle&&""!=actObj.happyTitle?(fdbackstatusStr=actObj.happyTitle,fdbackstatus=0):void 0!=actObj.showHappyLink&&1==actObj.showHappyLink&&(params[0]=ZPFeeds.PMS.FormUtil.FeedbackName,fdbackstatusStr=AcsApi.localizeString("hrms.feeds.feedback.likethisfeedback",params));void 0!=fdbktypeName&&""!=fdbktypeName&&'title="'+fdbktypeName+'"',bodyObj+='<div class="zp-post-cont"> <p>'+actObj.content+"</p>"+(""!=fdbackstatusStr?'<div class="revw-type CP" id="user_feedback_response"><i class="IC-smly-happy"></i><span id="happy" status="'+fdbackstatus+'">'+fdbackstatusStr+"</span></div>":"")+"</div>"}else type===People.Shift.type?bodyObj+=actObj.shiftTable:type===People.JobSchedule.type?bodyObj+=actObj.jobScheduleHtml:type===People.KRA.type||type===People.Goal.type?bodyObj+=ZPFeeds.Construction.constructTableTypeActvities(actObj):type===People.Approval.type?("P_EmployeeLeave"===actObj.tableName&&(bodyObj+=ZPFeeds.Construction.constructTableTypeActvities(actObj)),!0===actObj.isAllowedToViewMail&&(bodyObj+='<div class="zp-fd-zmail"><div class="zp-mailic"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"home/fd-mail.svg")+'"></div><div class="zp-mailcont"><p>'+ZPeople.escapeHtml(actObj.mailtitle)+"</p><p>"+ZPI18N.getString("zp.from")+': <a href="mailto:'+actObj.fromAddr+'">'+actObj.fromAddr+"</a></p>"+actObj.message+" "+ZPFeeds.Construction.constructToccUsers(actObj)+"</div></div>"),bodyObj+='<a class="btn_lined btn btn-detail" href="javascript:;" id="viewcompleteDtls">'+("P_EmployeeLeave"===actObj.tableName?ZPI18N.getString("zp.leavedetails"):ZPI18N.getString("zp.viewcompletedetails")),void 0!==actObj.formId&&(bodyObj+='<input type="hidden" id="formId" value="'+actObj.formId+'">'),void 0!==actObj.actRecId&&(bodyObj+='<input type="hidden" id="recordId" value="'+actObj.actRecId+'">'),void 0!==actObj.tableName&&(bodyObj+='<input type="hidden" id="tableName" value="'+actObj.tableName+'">'),bodyObj+="</a>",bodyObj+=ZPFeeds.Construction.constructApprovers(actObj)):type===People.HrCase.type?bodyObj+=ZPFeeds.Construction.constructTableTypeActvities(actObj):type===People.EmpAcceptance.type?bodyObj=void 0!=actObj.accType?'<div class="zp-post-cont"><div class="ZPFcont"><strong >"'+actObj.accType+'"</strong><span class="DB">'+(null!=actObj.feedback&&void 0!=actObj.feedback?actObj.feedback:"")+"</span></div>":'<div class="zp-post-cont"><div class="ZPFcont"></div>':type===People.Leave.type?bodyObj+=ZPFeeds.Construction.constructTableTypeActvities(actObj):type===People.AppraisalCycle.type&&(bodyObj+='<div class="zp-mailic"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"home/fd-mail.svg")+'"></div><div class="zp-mailcont"><p>'+ZPI18N.getString("zp.from")+' : <a href="mailto:'+actObj.fromAddr+'">'+actObj.fromAddr+"</a></p>"+actObj.content+"<p></div>");if(type===People.Status.type&&ZPeople.onBoardingStatus&&(bodyObj+='<span class="FR"><i class="OB-harte" id="like_link" action="0"></i></span>'),bodyObj+="</div>",type===People.Announcement.type&&(void 0!=actObj.actAttObj&&void 0!=actObj.actAttObj.imgcontent&&(bodyObj+=actObj.actAttObj.imgcontent),void 0!=actObj.actAttObj&&void 0!=actObj.actAttObj.filecontent&&(bodyObj+=actObj.actAttObj.filecontent)),type===People.Training.type&&(bodyObj+=actObj.content),type===People.XoxodayNotify.type){actObj.erecno,actObj.content;bodyObj='<div class="zp-feed-table "><table class="table"><tbody><tr><th width="150">   <div class = "reward_icon"></div> <div style="margin-left: 50px; margin-top:5px">'+actObj.content+'<br><br><a id="rdmPtsBtn" class="btn btn-default btn_hover" onclick="ZPeople.getUserPage(\''+actObj.erecno+"')\"> <b>View details</b></a>  </div></th></tr></tbody></table></div>"}return type===People.FeedbackRequest.type&&(bodyObj='<div class="zp-fd-zmail"><div class="zp-mailic"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"home/fd-mail.svg")+'"></div><div class="zp-mailcont">'+ZSEC.Encoder.encodeForHTML(actObj.content)+"<p></p></div></div>"),bodyObj},constructToccUsers:function(actObj){var type=actObj.type,Obj="";if(void 0!=actObj.assignedUsers&&actObj.assignedUsers.length>0&&"6"!=actObj.ap_mailAlertType){var assigntitle=ZPI18N.getString("zp.toorcc");type===People.AddProject.type?assigntitle=ZPI18N.getString("zp.assignees"):type===People.AddSchedule.type&&(assigntitle=ZPI18N.getString("zp.assignto",new Array(""))),Obj='<div class="zp-mail-cc"><div class="mail-cc-title">'+assigntitle+'</div><ul class="zp-fd-cclist">',$.each(actObj.assignedUsers,function(index,data){Obj+='<li><img class="zp-usimg zphvr-cpro" empid="'+data.erecno+'" elem="profilePhoto" popup="user" src="'+ZPeople.applyPortalName(data.userimage)+'"></li>'}),void 0!==actObj.isMoreOpt&&!0===actObj.isMoreOpt&&(Obj+='<li style="padding-left: 13px; position: relative;top: 2px;"> &nbsp;&amp;&nbsp;'+ZPI18N.getString("zp.smore")+"</li>"),Obj+="</ul></div>"}return Obj},constructTableTypeActvities:function(actJson,extraClass){var type=actJson.type,tableObj='<div class="zp-feed-table '+(ZPUtil.Validation.isEmpty(extraClass)?"":extraClass)+'"><table class="table"><tbody>',dtlObj={};if(type===People.AddProject.type)ZPUtil.Validation.isEmpty(actJson.projectName)||(dtlObj.projectname=actJson.projectName),ZPUtil.Validation.isEmpty(actJson.clientName)||(dtlObj.clientname=actJson.clientName);else if(type===People.AddSchedule.type)ZPUtil.Validation.isEmpty(actJson.jobName)||(dtlObj.jobname=actJson.jobName),ZPUtil.Validation.isEmpty(actJson.projectName)||(dtlObj.projectname=actJson.projectName),ZPUtil.Validation.isEmpty(actJson.clientName)||(dtlObj.clientname=actJson.clientName);else if(type===People.KRA.type)ZPUtil.Validation.isEmpty(actJson.kraName)||(dtlObj.KraName=actJson.kraName),void 0!==actJson.description&&(dtlObj.description=actJson.description),void 0!==actJson.weightage&&void 0!=actJson.showWeightage&&1==actJson.showWeightage&&(dtlObj.weightage=actJson.weightage),void 0!==actJson.assignTo&&(dtlObj.employee='<div class="zp-fd-user"> <div class="dpcnt"> <img class="zp-usimg FL zphvr-cpro" src="'+actJson.assignTo.thumb+'" empid="'+actJson.assignTo.id+'" popup="user"></div> <div class="zp-fd-uname">'+actJson.assignTo.name+"</div> </div>");else if(type===People.Goal.type)ZPUtil.Validation.isEmpty(actJson.goalName)||(dtlObj.goalname='<div class="CP" onclick="ZPFeeds.PMS.FormUtil.viewGoalsByRecordId(\''+actJson.actRecId+"');\">"+ZSEC.Encoder.encodeForHTML(actJson.goalName)+"</div>"),void 0!==actJson.assignTo&&Object.keys(actJson.assignTo).length>0&&(dtlObj.assignedto='<div class="zp-fd-user"> <div class="dpcnt"> <img class="zp-usimg FL zphvr-cpro" src="'+actJson.assignTo.thumb+'" empid="'+actJson.assignTo.id+'" popup="user"></div> <div class="zp-fd-uname">'+actJson.assignTo.name+"</div> </div>"),void 0!==actJson.postedUserId&&Object.keys(actJson.postedUserId).length>0&&(dtlObj.assignedby='<div class="zp-fd-user"> <div class="dpcnt"><img class="zp-usimg FL zphvr-cpro" src="'+actJson.postedUserId.thumb+'" empid="'+actJson.postedUserId.id+'" popup="user"></div> <div class="zp-fd-uname">'+actJson.postedUserId.name+"</div> </div>");else if(type===People.Holiday.type){ZPUtil.Validation.isEmpty(actJson.holidayName)||(dtlObj.name=actJson.holidayName);var hClass=void 0!=actJson.holiday_classification?actJson.holiday_classification.name:void 0;actJson.isRH&&(void 0!=hClass||(ZPI18N.getString("zp.restricted"),ZPI18N.getString("zp.holiday"))),void 0!==hClass&&""!==hClass.trim()&&(dtlObj.classification=ZPeople.decodeTxt(hClass)),ZPUtil.Validation.isEmpty(actJson.holidayDate)||(dtlObj.date=actJson.holidayDate),ZPUtil.Validation.isEmpty(actJson.locations)||(dtlObj.feedlocations=actJson.locations)}else if(type===People.Leave.type)ZPUtil.Validation.isEmpty(actJson.leaveTypeName)||(dtlObj.name=actJson.leaveTypeName),ZPUtil.Validation.isEmpty(actJson.fromDate)||ZPUtil.Validation.isEmpty(actJson.toDate)||(dtlObj.date='<a class="ZP-Leave-'+actJson.actRecId+'" >'+Calendar.formatDate(Calendar.parseDate(actJson.fromDate,"%y-%m-%d"),uidateFormat)+'</a>  &nbsp; to &nbsp;  <a  class="ZP-Leave-'+actJson.actRecId+'" >'+Calendar.formatDate(Calendar.parseDate(actJson.toDate,"%y-%m-%d"),uidateFormat)+"</a>"),ZPUtil.Validation.isEmpty(actJson.daysTaken)||("true"===actJson.isDayBased?dtlObj.numofdays=actJson.daysTaken:dtlObj.numofhours=actJson.daysTaken),actJson.leaveCancelled&&(dtlObj.status='<i class="IC-rejected red S18 MR5"></i> '+ZPI18N.getString("zp.cancelled"),ZPUtil.Validation.isEmpty(actJson.cancelReason)||(dtlObj.reason=actJson.cancelReason));else if(type===People.FileCabinet.type){if(void 0!==actJson.catName&&(dtlObj.filecategory=actJson.catName),!ZPUtil.Validation.isEmpty(actJson.fileName))if("0"===actJson.fileType){var download="";("0"===actJson.fileConfident&&void 0!=actJson.sharedUserDtl&&void 0!=actJson.sharedUserDtl.fileOwnerErec&&actJson.sharedUserDtl.fileOwnerErec===erecno||void 0!=actJson.sharedUserDtl&&(void 0!=actJson.sharedUserDtl.reportingToErec&&actJson.sharedUserDtl.reportingToErec===erecno||void 0!=actJson.sharedUserDtl.dualReportingToErec&&actJson.sharedUserDtl.dualReportingToErec===erecno)&&"1"===actJson.isreportingTo||"0"===actJson.fileConfident&&void 0!=actJson.sharedTo&&"ROLE"==actJson.sharedTo)&&(download=void 0!=actJson.filePath&&(actJson.filePath.indexOf(workDriveUrl)>-1||actJson.filePath.indexOf(writerUrl)>-1||actJson.filePath.indexOf(sheetUrl)>-1||actJson.filePath.indexOf(showUrl)>-1||"1"==actJson.uploadSource)?'<a><div class="IC-imprt blu ficpo" style="cursor:pointer" onclick=window.open("'+actJson.filePath+'")></div></a>':'<div class="IC-imprt blu ficpo" style="cursor:pointer" onclick=Files.downloadFilecabinet(\'html\',"'+actJson.actRecId+'","'+encodeURIComponent(actJson.filePath)+'","'+encodeURIComponent(actJson.fileName)+'")></div>'),void 0!=actJson.filePath&&(actJson.filePath.indexOf(workDriveUrl)>-1||actJson.filePath.indexOf(writerUrl)>-1||actJson.filePath.indexOf(sheetUrl)>-1||actJson.filePath.indexOf(showUrl)>-1||"1"==actJson.uploadSource)?download+='<a onclick=window.open("'+actJson.filePath+'") ">'+ZPeople.escapeHtml(actJson.fileName)+"</a>":download+='<a href="javascript:;" id="zpfd_filename">'+ZPeople.escapeHtml(actJson.fileName)+"</a>",dtlObj.filename=download}else void 0!=actJson.filePath&&(actJson.filePath.indexOf(workDriveUrl)>-1||actJson.filePath.indexOf(writerUrl)>-1||actJson.filePath.indexOf(sheetUrl)>-1||actJson.filePath.indexOf(showUrl)>-1||"1"==actJson.uploadSource)?dtlObj.filename=(void 0!==actJson.isConfidential&&!0!==actJson.isConfidential?'<a><div class="IC-imprt blu ficpo" style="cursor:pointer" onclick=window.open("'+actJson.filePath+'")></div></a>':"")+'<a onclick=window.open("'+actJson.filePath+'") >'+ZPeople.escapeHtml(actJson.fileName)+"</a>":dtlObj.filename=(void 0!==actJson.isConfidential&&!0!==actJson.isConfidential?'<a><div class="IC-imprt blu ficpo" style="cursor:pointer" onclick="window.open(\'/people/download?fileId='+actJson.actRecId+"');\"></div></a>":"")+'<a href="javascript:;" id="zpfd_filename">'+ZPeople.escapeHtml(actJson.fileName)+"</a>";ZPUtil.Validation.isEmpty(actJson.fileDescription)||(dtlObj.description=actJson.fileDescription)}else if(type===People.Approval.type)ZPUtil.Validation.isEmpty(actJson.fromDate)||ZPUtil.Validation.isEmpty(actJson.toDate)||(dtlObj.date='<a href="'+actJson.recordURL+'" target="_blank">'+actJson.fromDate+'</a>  &nbsp; to &nbsp;  <a href="'+actJson.recordURL+'" target="_blank">'+actJson.toDate+"</a>"),actJson.isRH&&(dtlObj.type=ZPI18N.getString("zp.restricted")+" "+ZPI18N.getString("zp.holiday")),ZPUtil.Validation.isEmpty(actJson.leaveReason)||(dtlObj.reason=actJson.leaveReason),ZPUtil.Validation.isEmpty(actJson.daysTaken)||("true"===actJson.isDayBased?dtlObj.numofdays=actJson.daysTaken:dtlObj.numofhours=actJson.daysTaken);else if(type===People.HrCase.type){var permissionObj=CaseViewPage.toCheckFeedEditorCustomeBtnPerm(actJson);if(ZPUtil.Validation.isEmpty(actJson.subject)||(dtlObj.subject=actJson.subject),""!==actJson.agentID?dtlObj.agent='<div class="zp-fd-user"><div class="dpcnt"> <img class="zp-usimg FL zphvr-cpro" src="'+actJson.agentDts.thumb+'" empid="'+actJson.agentDts.id+'" popup="user"></div><div class="zp-fd-uname">'+actJson.agentDts.name+"</div>":ZPUtil.Validation.isEmpty(actJson.agentDtsInShort)||ZPUtil.Validation.isEmpty(actJson.agentDts)||(dtlObj.agent='<div class="zp-fd-user"><div class="dpcnt">'+actJson.agentDtsInShort+'</div><div class="zp-fd-uname">'+actJson.agentDts+"</div>"+("true"===actJson.pickupIcon?'<div class="btn-pickup"><button class="btn_filled" caseid="'+actJson.actRecId+'" >'+ZPI18N.getString("zp.pick")+"</button></div> ":"")+"</div> </div>"),ZPUtil.Validation.isEmpty(actJson.desc)||"<div><br /></div>"===actJson.desc||(dtlObj.description='<div class="fdscrl">'+ZPFeeds.Activity.getSmileys(actJson.desc)+(actJson.seemoredesc?' <a onclick="HRCaseDropdown.feedsShowMoreDesc(this)" name="seemorecasedesc">'+ZPI18N.getString("zp.fdseemore")+"</a>":"")+"</div>"),ZPUtil.Validation.isEmpty(actJson.statusString)||(!permissionObj.isAgent&&"true"!=actJson.isAgent||"Cancelled"==actJson.statusString?dtlObj.status="<span>"+actJson.statusString+"</span>":dtlObj.status='<a class="zp-dpwn-ar" name="status" >'+actJson.statusString+'</a><div id="cst_'+actJson.actRecId+'"></div>'),ZPUtil.Validation.isEmpty(actJson.priorityString)||(!permissionObj.isAgent&&"true"!=actJson.isAgent||actJson.status===CasesCommon.COMPLETED_SID||actJson.status===CasesCommon.CANCELLED_SID?dtlObj.priority="<span>"+actJson.priorityString+"</span>":dtlObj.priority='<a class="zp-dpwn-ar" name="feed_priority">'+actJson.priorityString+'</a><div id="cpr_'+actJson.actRecId+'"></div>'),!ZPUtil.Validation.isEmpty(actJson.categoryName)){var subCategory=ZPUtil.Validation.isEmpty(actJson.hr_subcategoryId)?"":" - "+actJson.hr_subcategoryName,subCategoryId=ZPUtil.Validation.isEmpty(actJson.hr_subcategoryId)?"":actJson.hr_subcategoryId;!permissionObj.isAgent&&"true"!=actJson.isAgent||actJson.status===CasesCommon.COMPLETED_SID||actJson.status===CasesCommon.CANCELLED_SID?dtlObj.category='<span name="cgyName" subCategoryId="'+subCategoryId+'" cgeId="'+actJson.hr_categoryId+'">'+actJson.categoryName+subCategory+"</span>":dtlObj.category='<a class="zp-fdedit" name="cgyName" cgeId="'+actJson.hr_categoryId+'" subCategoryId="'+subCategoryId+'" >'+actJson.categoryName+subCategory+"</a>"}}else type===People.Training.type&&(ZPUtil.Validation.isEmpty(actJson.programName)||(dtlObj.program=actJson.programName),ZPUtil.Validation.isEmpty(actJson.programVenue)||(dtlObj.venue=actJson.programVenue),ZPUtil.Validation.isEmpty(actJson.programStartdate)||(dtlObj.rpstartdateandtime=actJson.programStartdate));return $.each(dtlObj,function(key,value){tableObj+='<tr><th width="150">'+ZPI18N.getString(("KraName"===key?"zp.local.":"zp.")+key)+"</th><td>",type===People.FileCabinet.type&&("filename"===key||"filecategory"===key)||type===People.Approval.type&&("date"===key||"reason"===key)||type===People.KRA.type&&"employee"===key||type===People.Goal.type&&("assignedto"===key||"assignedby"===key||"goalname"===key)||type===People.HrCase.type&&("description"===key||"agent"===key||"category"===key||"status"===key||"priority"===key)||type===People.AddProject.type&&"projectmanager"===key||type===People.Holiday.type&&"feedlocations"===key||type===People.Leave.type&&("date"===key||"status"===key)?tableObj+=value:tableObj+=ZPeople.escapeHtml(value),tableObj+="</td></tr>"}),tableObj+="</tbody></table></div>",type===People.HrCase.type&&actJson.hasOwnProperty("fileObj")&&(tableObj+='<div  id="filesAttch"  class="clearfix zp_Alst" >'+actJson.fileObj+"</div>"),type===People.AddProject.type&&actJson.hasOwnProperty("projectId")&&(tableObj+='<a class="btn_lined btn btn-detail" href="#timetracker/mydata/projectdashboard/performance-id:'+actJson.projectId+'" id="viewProjectBtn">'+ZPI18N.getString("zp.viewproject")+"</a>"),type===People.AddSchedule.type&&actJson.hasOwnProperty("jobId")&&(tableObj+='<a class="btn_lined btn btn-detail" onclick="Timetracker.jobs.Operations.formAddEditView(undefined ,\''+actJson.jobId+'\', true);" id="viewJobBtn">'+ZPI18N.getString("zp.viewjob")+"</a>"),tableObj},viewFields:function(fileid,isconfid,filename,filepath,filetype,fileExtn){var data={};data.fileID=fileid,data.fileConfident=isconfid,data.fileName=filename,data.filePath=filepath,data.fileExtn=fileExtn,data.fileType=filetype,data.allowDownload=!0,Files.viewFile(data,"feed")},constructApprovers:function(actJson){var aprClass="zpagsel",apprObj='<div class="ZPFa clearfix"><div class="ZPwf">';if(actJson.isAutoApproveReject)aprClass="1"==actJson.autoApproveReject?"zpagsel ML10":"zparsel",apprObj+='<div class="'+(void 0!==aprClass?aprClass:"")+'"><img src="'+ZPeople.getResourceURL(imageUrl+"home/auto-app.jpg")+'"></div>';else{var approvers=actJson.appList,count=0;approvers.length>0&&$.each(approvers,function(key,value){actJson.isCurrApprover&&actJson.isApprovalCompleted?aprClass=value.isApproved?"zpagsel":value.isRejected?"zparsel":aprClass:actJson.isCurrApprover&&!actJson.isApprovalCompleted?aprClass=1==value.isCurrApprover?value.isApproved?"zpaapp":value.isRejected?"zparej":"zpasel":void 0!==value.isApproved&&void 0!==value.isRejected?value.isApproved?"zpaapp":value.isRejected?"zparej":"zpasel":"zpanor":(aprClass=void 0!==value.isApproved&&void 0!==value.isRejected?value.isApproved?"zpaapp":value.isRejected?"zparej":"zpasel":1==value.isCurrent?"zpasel":"zpanor",1==approvers.length&&1==actJson.isApprovalCompleted&&(aprClass=1==value.isApproved?"zpagsel":1==value.isRejected?"zparsel":"zpasel")),apprObj+="<div onclick=\"ZPFeeds.Activity.showApproverDetail(this, '"+actJson.actRecId+"', '"+count+'\')" class="'+(void 0!==aprClass?aprClass:"")+'">',void 0===actJson.currentApprType&&(apprObj+='<img elem="profilePhoto" empid = "'+value.erecno+'" src="'+value.photo+'">'),apprObj+="</div>",count++})}if(apprObj+="</div>",apprObj+='<div class="ZPFabox">',actJson.isAutoApproveReject)apprObj+='<div class="FL MT35" id="zp_feeds_approverdetails"><a>'+("1"==actJson.autoApproveReject?ZPI18N.getString("zp.systemapproved"):ZPI18N.getString("zp.systemrejected"))+'</a><div class="aptim">'+(void 0!==actJson.systemApprovedTime?actJson.systemApprovedTime:"")+"</div></div>";else{var currentApprDtl=actJson.currentApprDtl;apprObj+='<div class="FL MT35" id="zp_feeds_approverdetails">',apprObj+=void 0==currentApprDtl.currentApprType?"<a>"+currentApprDtl.displayName+"</a>":"",apprObj+="department"==currentApprDtl.currentApprType&&void 0!=currentApprDtl.deptName&&""!==currentApprDtl.deptName?ZPI18N.getString("zp.department")+":&nbsp;:&nbsp;"+("department"==currentApprDtl.currentApprType?ZSEC.Encoder.encodeForHTML(currentApprDtl.displayName):currentApprDtl.deptName):"role"==currentApprDtl.currentApprType?ZPI18N.getString("zp.role")+":&nbsp;:&nbsp;"+ZSEC.Encoder.encodeForHTML(currentApprDtl.displayName):"group"==currentApprDtl.currentApprType?ZPI18N.getString("zp.group")+"&nbsp;:&nbsp;"+ZSEC.Encoder.encodeForHTML(currentApprDtl.displayName):"",currentApprDtl.isApproved||currentApprDtl.isRejected?apprObj+='<div class="aptim">'+(void 0!==currentApprDtl.approvalTime?currentApprDtl.approvalTime:"")+"</div></div>":actJson.isCurrApprover&&!actJson.isApprovalCompleted?apprObj+='</div><div class="FR MT35"> <div class="ZPapproveBx FL MR10" onclick="ZPFeeds.Activity.showApproveRejectOpt(this, \'1\', \''+actJson.actRecId+"', '"+actJson.dataforapprovalid+"', '"+actJson.tableName+'\');"> <i title="'+ZPI18N.getString("zp.approve")+'" class="IC-tick grn S20"></i> </div> <div class="ZPrejectBx FL"  onclick="ZPFeeds.Activity.showApproveRejectOpt(this, \'0\', \''+actJson.actRecId+"', '"+actJson.dataforapprovalid+"', '"+actJson.tableName+'\');"> <i title="'+ZPI18N.getString("zp.reject")+'" class="IC-cls-1px red S22"></i> </div> </div>':apprObj+="</div>"}return apprObj+="</div></div>"},showApproverejectModal:function(actJson){var recordId=actJson.actRecId;if(0===Layout.Page.container.find("#approvalpopup_"+recordId).length){var bodyHtml=ZPFeeds.Construction.constructApprovalPopUp(actJson),modal=ZPeople.BSModal.get({id:"approvalpopup_"+recordId,type:1,headerHtml:'<a data-dismiss="modal" class="close"> <i class="IC-cls red S14"></i> </a>',body:bodyHtml,disableFooter:!0,deleteOnHide:!0,overwriteModalClass:!0,modalClass:"popRgtModel ZPsecModal PopSmModel",removeModalClass:"fade ZPmdl",deleteOnHide:!0,bodyClass:"NomdlFoot PT0I"});ZPeople.BSModal.show(modal)}},constructApprovalPopUp:function(actJson){if(void 0!==actJson){var apprHtml='<div class="tlouter" id="'+actJson.actRecId+'" formId="'+actJson.formId+'">',apprs=actJson.appList;if(void 0!==apprs&&apprs.length>0){var apprClass,apprText,isCurrent=!1;$.each(apprs,function(index,data){!0===data.isCurrent&&(isCurrent=!0),void 0!==data.isApproved&&void 0!==data.isRejected?!0===data.isApproved?(apprClass="bg-success",apprText="Approved"):!0===data.isRejected&&(apprClass="bg-progress",apprText="Rejected"):(apprClass="bg-wait",apprText=""),apprHtml+='<div class="tlentry"> <div class="tlentry-inner"> <div class="tlicon '+apprClass+'"> <i class="entypo-suitcase"></i> </div> <div class="tllabel"> <div class="stshead">',void 0!==data.isApproved&&void 0!==data.isRejected?apprHtml+='<span class="sts">'+apprText+'</span> <span class="dat">'+data.approvalTime+"</span>":apprHtml+='<span class="wait">Waiting for Approval</span>',apprHtml+='</div> <div class="profmin"> <img src="'+data.photo+'" class="Usrimg"> <span class="ssp-un">'+data.displayName+(ZPUtil.Validation.isEmpty(data.extn)?"":"<span>"+data.extn+"</span>")+' <span class="ssp-des">',1==isCurrent&&void 0==data.isApproved&&void 0==data.isRejected?apprHtml+='<textarea class="form-control MB10" rows="3" style="margin-top: 0px; margin-bottom: 10px; height: 55px;" placeholder="write your comment"></textarea> </span> <button class="btn btn-success" onclick="ZPFeeds.Construction.approveReject(this,true);">Approve</button> <button class="btn btn-default" onclick="ZPFeeds.Construction.approveReject(this,false);">Reject</button></span>':apprHtml+=(ZPUtil.Validation.isEmpty(data.desName)?"":data.desName)+""+(ZPUtil.Validation.isEmpty(data.desName)||ZPUtil.Validation.isEmpty(data.deptName)?"":" - ")+(ZPUtil.Validation.isEmpty(data.deptName)?"":data.deptName)+'</span> <span class="ssp-mail">'+(ZPUtil.Validation.isEmpty(data.email)?"":'<a href="mailto:'+data.email+'">'+data.email+"</a>")+"</span></span></div></div></div></div>"})}return apprHtml+="</div>"}return""},approveReject:function(Obj,isApprove){$(Obj).attr("disabled",!0);var recordId=new Array($(Obj).parents(".tlouter").attr("id")),formId=$(Obj).parents(".tlouter").attr("formId"),type="0",comment=$(Obj).siblings(".ssp-des").find("textarea").val();1==isApprove&&(type="1"),ZPeople.BSModal.hide(Layout.Page.container.find("[id^=approvalpopup_]").attr("id")),ZP5Form.Record.approveReject(recordId,type,comment,ZP5Form.RecordApproval.handleApproveRejectResponse,!0,formId)}},ZPFeeds.Comment={COMMENTED:!1,deleteComment:function(){var recordId=ZPFeeds.DELETEOBJ.parent().siblings("#record_id").val(),type=ZPFeeds.DELETEOBJ.parent().siblings("#type").val();ZPeople.Request.send(ZPFeeds.URL,{actionType:"DELETE_COMMENT",commentId:recordId,activityType:type},ZPFeeds.Comment.handleDeleteComment,{recId:recordId})},handleDeleteComment:function(resultData,params){if(-1!==resultData.indexOf("success")){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.commentdeletedsuccess"));let comd=ZPFeeds.DELETEOBJ.parents('[commentid="'+params.commentId+'"]');comd.fadeOut(1e3,function(){comd.remove()})}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"));ZPFeeds.DELETEOBJ=null},handleDelete:function(fdk,cfdk){var tempObj=Layout.Page.container.find("[id="+ZPUtil.escapeSelector(cfdk)+"]").parent("#cmtlistcont"),totalCmd=tempObj.attr("comments");if(tempObj.attr("comments",parseInt(totalCmd)-1),tempObj.find("[id="+ZPUtil.escapeSelector(cfdk)+"]").fadeOut(500,function(){$(this).remove(),0==tempObj.children().length&&tempObj.addClass("DN"),isNaN(totalCmd)||ZPFeeds.Comment.handleCommentCount(!0,fdk,parseInt(totalCmd)-1)}),(tempObj=$("[id="+ZPUtil.escapeSelector(cfdk)+"]").parent("#cmtlistcont")).length>0)for(var i=0;i<tempObj.length;i++){var tObj=tempObj[i];if(0===tObj.parents("#zp_feeds_views").length){totalCmd=tObj.attr("comments");tObj.attr("comments",parseInt(totalCmd)-1),tObj.find("[id="+ZPUtil.escapeSelector(cfdk)+"]").remove(),0==tObj.children().length&&tObj.addClass("DN"),isNaN(totalCmd)||ZPFeeds.Comment.handleCommentCount(!0,fdk,parseInt(totalCmd)-1)}}},isCommented:function(acsObj){var commentObj=ZPFeeds.getCurrentViewContainer().find("#"+ZPUtil.escapeSelector(acsObj.fdk)).find("#comment_feed"),existCmdCnt=commentObj.attr("comments");return existCmdCnt=isNaN(existCmdCnt)?0:parseInt(existCmdCnt),commentObj.attr("comments",existCmdCnt+1),acsObj.totalComments>existCmdCnt},getMoreComments:function(Obj,isDelete){$(Obj).off("click");var moreKey=$(Obj).siblings("#cmt_morekey").val(),sKey=$(Obj).siblings("#cmt_skey").val(),type=$(Obj).siblings("#act_type").val(),actFdk=$(Obj).siblings("#act_fdk").val(),cmdCnt=$(Obj).attr("totalcmts");$(Obj).append('<span class="loader-inner line-scale ML5I" id="loader"><div></div><div></div><div></div></span>'),ZPFeeds.Like.FEEDSLOADED=!1,!0===isDelete&&(cmdCnt=3),AcsApi.getComments(ZPeople.CURRENT_VIEWKEY,sKey,actFdk,moreKey,cmdCnt,type),ZPeople.Request.send(ZPFeeds.URL,{viewKey:ZPeople.CURRENT_VIEWKEY,count:cmdCnt,actionType:"GET_LIKED_USERS",morekey:moreKey,isActivity:1,skey:sKey,fdk:actFdk},ZPFeeds.Like.handleGetLikedUsersResponse,{isMoreComments:!0})},showMoreComments:function(fdk,commentarr,totalCnt,cmore){if(commentarr.length>0){var currCont=ZPFeeds.getCurrentViewContainer(),escapedFDK=ZPUtil.escapeSelector(fdk),actObj=currCont.find("div[actFdk='"+escapedFDK+"']").parents("#actOuterCont");actObj.find("#view_more_cmts").find("a").find("#zp_miniloader").remove();var actRecId=actObj.attr("streamid"),actJson={type:commentarr[0].type,actRecId:actRecId};ZPFeeds.Construction.constructComments(actObj,actJson,commentarr,!0),ZPFeeds.Comment.handleCommentCount(!1,fdk,totalCnt,!0),$(".cboxElement").off("click"),$(".cboxElement").on("click",function(event){$(event.target).hasClass("filedwn")||ZPFeeds.registerAttPreview(event,this,actRecId)}),ZPFeeds.Like.loadLikeWithStoredData()}},handleCommentCount:function(isDelete,fdk,totalCnt,isView,outerId){for(var escapedFDK=ZPUtil.escapeSelector(fdk),actObj=$("div[actFdk='"+escapedFDK+"']").parents("#"+(outerId||"actOuterCont")),objCnt=0;objCnt<actObj.length;objCnt++){var key,currActObj=$(actObj[objCnt]),moreCmtObj=currActObj.find("#view_more_cmts");key=0!=totalCnt&&!0!==isView?"zp.viewallcomments":"zp.viewingallcomments",moreCmtObj.find("a").attr("totalcmts",totalCnt).text(ZPI18N.getString(key,[totalCnt])),!0===isDelete&&0===currActObj.find("#cmtlistcont").children().length&&totalCnt>0&&ZPFeeds.Comment.getMoreComments(moreCmtObj,isDelete),parseInt(totalCnt)>3||parseInt(totalCnt)!==currActObj.find("#cmtlistcont").children().length?moreCmtObj.removeClass("DN"):moreCmtObj.addClass("DN")}},showNewCommentBox:function(actJson,Obj){ZPFeeds.ISMODALEDITOROBJ=null,void 0!==Obj&&$(Obj).parents(".zpl_mdl.zpl_mopen").length>0&&(ZPFeeds.Comment.removeTextEditor(null!=ZPFeeds.CURRENT_EDITOR&&void 0!==ZPFeeds.CURRENT_EDITOR[0]?ZPFeeds.Editor.editorList[ZPFeeds.CURRENT_EDITOR[0].id]:null,actJson.actRecId,!0),ZPFeeds.ISMODALEDITOROBJ=$(Obj).parents(".zpl_mdl.zpl_mopen"));var actobj=ZPFeeds.getCurrentViewContainer(actJson.actRecId);0===actobj.find("#cmtpostcont").length&&(0===actobj.find("#bottomcont").length&&actobj.append('<div class="zp-fd-bottom" id="bottomcont"></div>'),actobj.find("#bottomcont").append(ZPFeeds.Construction.constructTextArea(!0,actJson)),actobj.find("#bottomcont").find("#cmt_textarea").on("click",function(){ZPFeeds.Comment.showNewCommentBox(actJson)})),ZPFeeds.Comment.getNewEditor(actJson)},getNewEditor:function(actJson){ZPFeeds.Comment.removeTextEditor(null!=ZPFeeds.CURRENT_EDITOR&&void 0!==ZPFeeds.CURRENT_EDITOR[0]?ZPFeeds.Editor.editorList[ZPFeeds.CURRENT_EDITOR[0].id]:null,actJson.actRecId);var url=Layout.Page.hash,actobj=ZPFeeds.getCurrentViewContainer(actJson.actRecId),commentCont=actobj.find("#comment_cont");commentCont.find("#cmt_textarea").addClass("DNI");let editorDivId="cmt_editordiv_"+actJson.fdk;if(null!=ZPFeeds.ISMODALEDITOROBJ&&0!=$("body").has(ZPFeeds.ISMODALEDITOROBJ).length&&(editorDivId="popup_cmt_editordiv_"+actJson.fdk),0===commentCont.find("#zpEditor").length){if(void 0===actJson.subBtnName&&(actJson.subBtnName="zp.feeds.post"),actJson.divId=editorDivId,actJson.subBtnId="postCommentBtn",actJson.type===People.HrCase.type){var isAllowedPerm=CaseViewPage.toCheckFeedEditorCustomeBtnPerm(actJson);actJson.subBtnName="zp.reply",actJson.status===CasesCommon.COMPLETED_SID||actJson.status===CasesCommon.CANCELLED_SID?actJson.customeButton=!1:isAllowedPerm.isAgent||isAllowedPerm.isEscalatorUser?(actJson.customeButton=!0,actJson.custBtnName="zp.replyClose",actJson.custBtnId="customeBtn"):actJson.customeButton=!1}actJson.currentcontainer=actobj,commentCont.append(ZPFeeds.Editor.getEditorContainer(actJson));var editor=ZPFeeds.Editor.getEditor(editorDivId,actJson.type,void 0,actJson);if((ZPFeeds.SINGLEPOP||-1!==Layout.Page.currentmode.indexOf("home/myspace/overview")||-1!==Layout.Page.currentmode.indexOf("home/team/space")||-1!==url.indexOf("#hrcase/agent/list/view")||-1!==url.indexOf("#performance/myreview/feedback")||-1!==url.indexOf("#performance/myteam/feedback")||-1!==url.indexOf("#performance/myreview/kra")||-1!==url.indexOf("#performance/myteam/kra")||-1!==url.indexOf("#performance/myreview/goals")||-1!==url.indexOf("#performance/myteam/goals")||-1!==url.indexOf("#performance/myreview/myratings")||-1!==url.indexOf("#performance/myteam/userlisting")||-1!==url.indexOf("#hrcase/myrequest/view")||-1!==url.indexOf("#hrcase/agent/unmanaged/view")||-1!==url.indexOf("#hrcase/agent/allcases/view")||-1!==url.indexOf("#hrcase/agent/escalation/view")||-1!==url.indexOf("#hrcase/agent/unassigned/view")||-1!==url.indexOf("#hrcase/watchlist/view")||-1!==url.indexOf("#hrcase/reports/requestedvsclosed")||-1!==url.indexOf("#hrcase/reports/overallreport")||-1!==url.indexOf("#home/dashboard")||-1!==url.indexOf("#hrcase/agent/opencases/view")||-1!==url.indexOf("#timetracker/scheduler/projectdashboard")||-1!==url.indexOf("/projectdashboard/")||-1!==url.indexOf("#hrcase/reports/escalationreport")||-1!==url.indexOf("#performance/myteamuser/feedback")||-1!==url.indexOf("#performance/appraisaluser/feedback")||-1!==url.indexOf("#operations/performance/user/feedback")||-1!==url.indexOf("#performance/myteamuser/kra")||-1!==url.indexOf("#performance/appraisaluser/kra")||-1!==url.indexOf("#operations/performance/user/kra")||-1!==url.indexOf("#performance/myteamuser/goals")||-1!==url.indexOf("#performance/appraisaluser/goals")||-1!==url.indexOf("#operations/performance/user/goals")||-1!==url.indexOf("#performance/myreview/selfappraisal")||-1!==url.indexOf("#performance/myteam/allkra")||-1!==url.indexOf("home/user/feedback")||-1!==url.indexOf("operations/approvals/allapproval")||-1!==url.indexOf("performance/approval")||-1!==url.indexOf("#home/myspace/overview-approval")||-1!=url.indexOf("home/myspace/overview-kra"))&&(ZPFeeds.COMMENTEDITOR=editor),commentCont.find("#postCommentBtn").on("click",function(){void 0===actJson.subBtnCallBack?("Goal"!==actJson.type&&"KRA"!==actJson.type||!actJson.isCreateActivity||(commentsView.initCreateActivity(actJson),actJson.isCreateActivity=!1),ZPFeeds.Comment.post(actJson.fdk,actJson.type,actJson.actRecId,!1,$(this))):actJson.subBtnCallBack(editor,actJson,ZPFeeds.getContentJson(editor,actJson),$(this))}),commentCont.find("#zp_editor_cancelbtn").on("click",function(){ZPFeeds.Comment.removeTextEditor(editor,actJson.actRecId,!0)}),void 0!==actJson.custBtnId&&commentCont.find("#"+actJson.custBtnId).on("click",function(){void 0===actJson.custBtnCallBack?ZPFeeds.Comment.post(actJson.fdk,actJson.type,actJson.actRecId,!0,$(this)):actJson.custBtnCallBack(editor,actJson,ZPFeeds.getContentJson(editor,actJson))}),actJson.type===People.HrCase.type){if(actJson.customeButton){var btnhtml="",isBtnRqd=!1;(isAllowedPerm=CaseViewPage.toCheckFeedEditorCustomeBtnPerm(actJson)).isAgent?(isBtnRqd=!0,btnhtml+='<li id="addfaqbtn"><b title="'+ZPI18N.getString("zp.addfaqbtn")+'"><span>'+ZPI18N.getString("zp.addfaqbtn")+'</span></b></li><li id="attachfaqbtn"><b title="'+ZPI18N.getString("zp.attachfaq")+'"><span>'+ZPI18N.getString("zp.attachfaq")+"</span></b></li>"):isAllowedPerm.isEscalatorUser&&(isBtnRqd=!0,btnhtml+='<li id="attachfaqbtn"><b title="'+ZPI18N.getString("zp.attachfaq")+'"><span>'+ZPI18N.getString("zp.attachfaq")+"</span></b></li>"),isBtnRqd&&commentCont.find("[name=cases_custBtn]").length<1&&(commentCont.find(".ze_SCmb").append('<font></font><ul class="zp_casesBtn" name="cases_custBtn"></ul>'),isAllowedPerm.isAgent?btnhtml='<li id="addfaqbtn"><button class="zlabel zlabel--blue zlabel--small ">'+ZPI18N.getString("zp.addfaqbtn")+'</button></li><li id="attachfaqbtn"><button class="zlabel zlabel--blue zlabel--small ">'+ZPI18N.getString("zp.attachfaq")+"</button></li>":isAllowedPerm.isEscalatorUser&&(btnhtml='<li id="addfaqbtn"><button class="zlabel zlabel--blue zlabel--small ">'+ZPI18N.getString("zp.addfaqbtn")+"</button></li>")),commentCont.find("[name=cases_custBtn]").append(btnhtml)}else commentCont.find("[name=cases_custBtn]").remove();commentCont.find("[name=cases_custBtn]").find("#addfaqbtn").on("click",function(ev){CasesFAQ.addFAQ(ev,void 0,actJson.hr_categoryId)}),commentCont.find("[name=cases_custBtn]").find("#attachfaqbtn").on("click",function(){CasesFAQ.showShareFAQSlider(this,actJson.actRecId)})}}else{commentCont.find("#editor_container").removeClass("DN"),void 0!==(editor=ZPFeeds.Editor.editorList[editorDivId])&&(ZPFeeds.COMMENTEDITOR=editor)}ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.COMMENTEDITOR,!1)},post:function(fdk,type,actRecId,custBtn,btnObj){var curConObj=ZPFeeds.getCurrentViewContainer(actRecId);let editorDivId="cmt_editordiv_"+fdk;null!=ZPFeeds.ISMODALEDITOROBJ&&0!=$("body").has(ZPFeeds.ISMODALEDITOROBJ).length&&(editorDivId="popup_cmt_editordiv_"+fdk);let comendEditor=ZPFeeds.Editor.editorList[editorDivId];if(ZPFeeds.hasInValidContent(comendEditor.getContent()))ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.unsupportedemojialert"));else{0===btnObj.find("#loader").length&&btnObj.append(ZPFeeds.MINILOADER),btnObj.attr("disabled",!0);var content=ZPFeeds.getSmileysAndMentions(comendEditor.getContent(),ZPeople.isSearchAllowed);content=ZPFeeds.removeTrailingEmptyDivs(content);var messageText=ZPFeeds.getTextContent(content),attachCnt=parseInt(curConObj.find("#zp_dash_attachments").attr("attachcnt"));if(0===messageText.length&&0===$("<div>").append(content).find("img").length&&0===attachCnt||messageText.length>5e3)return messageText.length>5e3&&ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.commentlengthwarning")),ZPFeeds.Editor.getfocusOnEditor(comendEditor,!1),void btnObj.attr("disabled",!1).find("#loader").remove();ZPFeeds.Comment.COMMENTED=!0;var params={type:type,fdk:fdk,callBack:ZPFeeds.Comment.handleCommentResponse,content:content,messageText:messageText,curConObj:curConObj,attachCnt:attachCnt,actRecId:actRecId};custBtn&&(params.btnType="5"),ZPFeeds.postAction(params,!1)}},handleCommentResponse:function(data,params,actRecId){let editorDivId="cmt_editordiv_"+params.fdk;null!=ZPFeeds.ISMODALEDITOROBJ&&0!=$("body").has(ZPFeeds.ISMODALEDITOROBJ).length&&(editorDivId="popup_cmt_editordiv_"+params.fdk);let comendEditor=ZPFeeds.Editor.editorList[editorDivId];if("string"==typeof data&&(data=JSON.parse(data)),400===data.code){var err_msg=data.hasOwnProperty("desc")?data.desc:ZPI18N.getString("zp.unabletoprocess");ZPeople.Message.showFailureMsg(err_msg),void 0===params.commentId&&(Layout.Page.container.find("#editor_container").find("#postCommentBtn").attr("disabled",!1),ZPFeeds.Editor.getfocusOnEditor(comendEditor,!1),Layout.Page.container.find("#editor_container").find("#postCommentBtn").find("#loader").remove())}else{if($("form#zp_AttachFile,iframe#feedsuploadwindow").remove(),void 0!==params.commentId?ZPFeeds.Edit.cancelEdit(void 0,params.commentId,!1):null!=params.btnType&&CaseViewPage.feedReplyNCloseCallback(data,comendEditor,editorDivId),void 0!==data.commentObj&&data.commentObj.length>0){for(var tempCmtObj,i=0;i<data.commentObj.length;i++){tempCmtObj=data.commentObj[i];var currContObj=ZPFeeds.getCurrentViewContainer(tempCmtObj.actRecId);currContObj.find("#loader").parents("button").attr("disabled",!1),currContObj.find("#loader").remove();for(var conObj=$("[streamid='"+tempCmtObj.actRecId+"']"),comActObj=new People.Comment(new Comment(tempCmtObj),!0),escapeFDK=ZPUtil.escapeSelector(params.fdk),likeDtl=$(currContObj.find("[commentId='"+comActObj.commentId+"']")).data(),objCnt=0;objCnt<conObj.length;objCnt++){var cmtContObj=$(conObj[objCnt]).find("[actfdk='"+escapeFDK+"']");cmtContObj.removeClass("DN");var actJson={};actJson.actRecId=tempCmtObj.actRecId,actJson.type=comActObj.type,actJson.fdk=params.fdk;var cmtObj=ZPFeeds.Construction.iterateComments(actJson,[comActObj],cmtContObj);cmtContObj.find("[commentId='"+comActObj.commentId+"']").length>0?cmtContObj.find("[commentId='"+comActObj.commentId+"']").replaceWith(cmtObj):cmtContObj.append(cmtObj)}void 0===params.commentId?(ZPFeeds.Comment.handleCommentCount(!1,params.fdk,comActObj.totalCmtCnt),currContObj.find("#cmtpostcont").find("#zp_dash_attachments").attr("attachcnt","0").addClass("DN").children("div").remove(),currContObj.find("#cmtpostcont").find("#zp_dash_attachments").children("input").remove()):ZPFeeds.Like.constructLikedUsers(comActObj.commentId,likeDtl.likeData,!1,likeDtl.likedUserDtls)}void 0===params.commentId&&(null!==comendEditor&&void 0!=comendEditor&&(comendEditor.setContent(""),ZPFeeds.Editor.getfocusOnEditor(comendEditor,!0)),ZPFeeds.Comment.removeTextEditor(comendEditor,tempCmtObj.actRecId),ZPFeeds.COMMENTEDITOR=null);var url=Layout.Page.hash;null==params.statusType||"Feedback"!=params.statusType||Layout.Page.container.find("[streamid="+actRecId+"] [actfdk="+params.fdk+"]").is(":visible")||Layout.Page.container.find("[streamid="+actRecId+"] [actfdk="+params.fdk+"]").show(),null==params.statusType||"Goal"!=params.statusType||-1===url.indexOf("#performance/myreview/goals")&&-1===url.indexOf("#performance/myteamuser/goals")&&-1===url.indexOf("#performance/appraisaluser/goals")&&-1===url.indexOf("#operations/performance/user/goals")&&-1===url.indexOf("#performance/myreview/kra")&&-1===url.indexOf("#performance/myteamuser/kra")&&-1===url.indexOf("#performance/appraisaluser/kra")&&-1===url.indexOf("#operations/performance/user/kra")&&-1===url.indexOf("#performance/myteam/goals")&&-1===url.indexOf("#selfservice/user/kra")&&-1===url.indexOf("#selfservice/user/goals")&&-1===url.indexOf("#performance/myteam/allkra")&&-1===url.indexOf("#home/myspace/overview-approval")&&-1===url.indexOf("#operations/approvals/allapproval")&&-1===url.indexOf("#performance/approval")&&-1===url.indexOf("#home/myspace/overview-actionlist")&&-1==url.indexOf("home/myspace/overview-kra")?null==params.statusType||"KRA"!=params.statusType||-1===url.indexOf("#performance/myreview/kra")&&-1===url.indexOf("#performance/myteamuser/kra")&&-1===url.indexOf("#performance/appraisaluser/kra")&&-1===url.indexOf("#operations/performance/user/kra")&&-1===url.indexOf("#performance/myteam/kra")&&-1===url.indexOf("#selfservice/user/kra")&&-1===url.indexOf("#performance/myteam/allkra")&&-1===url.indexOf("#home/myspace/overview-approval")&&-1===url.indexOf("#operations/approvals/allapproval")&&-1===url.indexOf("#performance/approval")&&-1===url.indexOf("#home/myspace/overview-actionlist")&&-1==url.indexOf("home/myspace/overview-kra")||commentsView.initCommentView(actRecId,!0,"Kra",!0):commentsView.initCommentView(actRecId,!0,"goal",!0)}$(".cboxElement").off("click"),$(".cboxElement").on("click",function(event){$(event.target).hasClass("filedwn")||ZPFeeds.registerAttPreview(event,this,actRecId)})}},removeTextEditor:function(editor,recordId,isHide){if(null!==editor&&void 0!==editor){var commentString=editor.getContent(),isAllowed=!1;if(1==isHide?(editor.setContent(""),isAllowed=!0):""===$(commentString).text().trim()&&0===$(commentString).find("img").length&&(isAllowed=!0),isAllowed){var editorObj=ZPFeeds.getCurrentViewContainer(void 0!==recordId?recordId:void 0).find("#cmtpostcont").find("[id='zpEditor']");editorObj.parents("#comment_cont").find("textarea").removeClass("DNI"),editorObj.parents("#editor_container").addClass("DN")}}}},ZPFeeds.Edit={initEdit:function(streamId,isActivity,actJson,curObj){void 0!==streamId&&(isActivity?ZPFeeds.Edit.initeditActivity(actJson):ZPFeeds.Edit.initeditComment(actJson,streamId))},initeditActivity:function(actJson){ZPFeeds.ISMODALEDITOROBJ=null;var actCont=Layout.Page.container.find("[streamid='"+actJson.actRecId+"']");if(0==actCont.find("#middcontainer").find("#zp_fd_editcont").length){actCont.find(".zp-post-cont").addClass("DN"),actCont.find(".zp-post-cont").after('<div class="zp-fd-PstEdt" id="zp_fd_editcont"></div>'),actJson.subBtnName="zp.update",actJson.divId="zp_fd_editor_"+actJson.actRecId,actJson.subBtnId="submitbtn",actJson.parentCon="editor_container",actJson.isTitleNeeded=!0,actCont.find("#zp_fd_editcont").append(ZPFeeds.Editor.getEditorContainer(actJson,!0)),actCont.find("#zp_fd_editcont").find("#zp_editor_cancelbtn").on("click",function(){ZPFeeds.Edit.cancelEdit(this,actJson.actRecId,!0)});var editor=ZPFeeds.Editor.getEditor("zp_fd_editor_"+actJson.actRecId,actJson.type,void 0,actJson);void 0!==actJson.actTitle&&(ZPFeeds.appendTitleCont(editor),$(editor.outerdiv).find("#zpfd_sts_title").val(actJson.actTitle));var content=ZPFeeds.Activity.validateRawContent(actJson.rawcontent,!1);editor.setContent(content),void 0!==actJson.linkStream&&(editor.initobj.CURRENTURL=ZPeople.decodeTxt(actJson.linkstreamdata.url),editor.initobj.linkFormation=void 0!==actJson.linkstreamdata.linkFormation?actJson.linkstreamdata.linkFormation:0,ZPFeeds.URLinfo.handleURLResponse(actJson.linkstreamdata,void 0,{editor:editor}));var cont=actCont.find("#middcontainer").find("#editor_container");void 0!==actJson.attachments&&ZPFeeds.Attachment.getEditPreviewForAttachment(cont,actJson.attachments,actJson.actRecId),cont.find("#submitbtn").on("click",function(){$(this).attr("disabled",!0),ZPFeeds.Edit.editActivity(editor,actJson,actCont)}),ZPFeeds.registerappendTitleCont(editor)}},editActivity:function(editor,actJson,actCont){var content=ZPFeeds.getSmileysAndMentions(editor.getContent(),ZPeople.isSearchAllowed);content=ZPFeeds.removeTrailingEmptyDivs(content);var messageText=ZPFeeds.getTextContent(content),attachCnt=parseInt(actCont.find("#zp_dash_attachments").attr("attachcnt")),title=actCont.find("#zpfd_sts_title").val();if(ZPUtil.Validation.isEmpty(title)&&(title=void 0),0===messageText.length&&0===$("<div>").append(content).find("img").length&&0===attachCnt||messageText.length>15e3)return messageText.length>15e3&&ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.statuslengthwarning")),void ZPFeeds.Editor.getfocusOnEditor(editor,!1);var existFiles=void 0,attachedFile=actCont.find("#zp_dash_attachments").find(".attachedFile");if(0!==attachedFile.length){existFiles=[];for(var i=0;i<attachedFile.length;i++)"true"===$(attachedFile[i]).attr("existFile")&&existFiles.push($(attachedFile[i]).attr("fileid"))}existFiles=JSON.stringify(existFiles);var param={callBack:ZPFeeds.Edit.editActivityResponse,content:content,messageText:messageText,curConObj:actCont,attachCnt:attachCnt,title:title,statusId:actJson.actRecId,type:actJson.type,linkFormation:editor.initobj.linkFormation,CURRENTURL:editor.initobj.CURRENTURL,existFiles:existFiles};"timetracker/scheduler/projectdashboard"===Layout.Page.currentmode&&(param.isForProject=!0),ZPFeeds.postAction(param,!0)},editActivityResponse:function(resultData,params){"string"==typeof resultData&&(resultData=JSON.parse(resultData));var editor=ZPFeeds.Editor.editorList["zp_fd_editor_"+params.statusId];if(!0===resultData.success){if(void 0===resultData.message){var viewkey,actObj=new People.Activity(new Activity(resultData.activityObj),!0);"timetracker/scheduler/projectdashboard"===Layout.Page.currentmode?viewKey=Timetracker.projectDashboard.projectDtls.projectFeedsKey:viewkey=ZPeople.CURRENT_VIEWKEY===ZPeople.VIEWKEYS.ALL?ZPeople.CURRENT_VIEWKEY:ZPeople.VIEWKEYS.Status,ZPFeeds.Activity.constructActivityList("Edit",viewkey,actObj,!1)}}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")),ZPFeeds.Editor.getfocusOnEditor(editor,!1);$("form#zp_AttachFile,iframe#feedsuploadwindow").remove(),ZPFeeds.Edit.cancelEdit(void 0,params.statusId,!0)},cancelEdit:function(Obj,id,isActivity){var actCont;void 0!==id&&(actCont=isActivity?Layout.Page.container.find("[streamid='"+id+"']").find("#middcontainer"):Layout.Page.container.find("[commentid='"+id+"']")),actCont.find("#zp_fd_editcont").remove(),delete ZPFeeds.Editor.editorList["zp_fd_editor_"+id],void 0!==actCont&&actCont.length>0&&(isActivity?actCont.find(".zp-post-cont").removeClass("DN"):(actCont.find("#zp_fd_cmteditcont").addClass("DN"),actCont.find("#cmtCont").removeClass("DN"),actCont.find(".zp-fd-pstedt").removeClass("DN")))},getCommentFromActivity:function(actJson,commentId){if(void 0!==actJson&&void 0!==actJson.comments&&actJson.comments.length>0)for(var cmtArr=actJson.comments,i=0;i<cmtArr.length;i++)if(cmtArr[i].commentId==commentId)return cmtArr[i]},initeditComment:function(actJson,cmtId){var tempJson=Object.assign({},actJson),cmtPCont=Layout.Page.container.find("[commentid='"+cmtId+"']"),actCont=cmtPCont.find("#zp_fd_cmteditcont");if(ZPFeeds.ISMODALEDITOROBJ=null,void 0!=cmtPCont&&$(cmtPCont).parents(".zpl_mdl.zpl_mopen").length>0&&(ZPFeeds.Comment.removeTextEditor(null!=ZPFeeds.CURRENT_EDITOR&&void 0!==ZPFeeds.CURRENT_EDITOR[0]?ZPFeeds.Editor.editorList[ZPFeeds.CURRENT_EDITOR[0].id]:null,actJson.actRecId,!0),ZPFeeds.ISMODALEDITOROBJ=$(cmtPCont).parents(".zpl_mdl.zpl_mopen")),0==actCont.find("#zp_fd_editcont").length){cmtPCont.find("#cmtCont").addClass("DN"),cmtPCont.find(".zp-fd-pstedt").addClass("DN"),actCont.removeClass("DN"),actCont.html('<div class="zp-fd-PstEdt" id="zp_fd_editcont"></div>'),tempJson.subBtnName="zp.update",tempJson.divId="zp_fd_editor_"+cmtId,tempJson.subBtnId="submitbtn",tempJson.parentCon="editor_container",tempJson.isTitleNeeded=!1,tempJson.avoidTitleIcon=!0,tempJson.noneedMentioninEdit=!0,actCont.find("#zp_fd_editcont").append(ZPFeeds.Editor.getEditorContainer(tempJson,!0)),actCont.find("#zp_fd_editcont").find("#zp_editor_cancelbtn").on("click",function(){ZPFeeds.Edit.cancelEdit(this,cmtId,!1)});var editor=ZPFeeds.Editor.getEditor("zp_fd_editor_"+cmtId,tempJson.type,void 0,tempJson),cmtObj=ZPFeeds.Edit.getCommentFromActivity(tempJson,cmtId),content=ZPFeeds.Activity.validateRawContent(cmtObj.rawcontent,!1);editor.setContent(content);var cont=actCont.find("#editor_container");void 0!==cmtObj.attachments&&ZPFeeds.Attachment.getEditPreviewForAttachment(cont,cmtObj.attachments,actJson.actRecId),cont.find("#submitbtn").on("click",function(){ZPFeeds.hasInValidContent(editor.getContent())?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.unsupportedemojialert")):($(this).attr("disabled",!0),ZPFeeds.Edit.editComment(editor,cmtId,actJson,cmtPCont))})}},editComment:function(editor,cmtId,actJson,actCont){var content=ZPFeeds.getSmileysAndMentions(editor.getContent(),ZPeople.isSearchAllowed);content=ZPFeeds.removeTrailingEmptyDivs(content);var messageText=ZPFeeds.getTextContent(content),attachCnt=parseInt(actCont.find("#zp_dash_attachments").attr("attachcnt"));if(0===messageText.length&&0===$("<div>").append(content).find("img").length&&0===attachCnt||messageText.length>5e3)return messageText.length>5e3&&ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.commentlengthwarning")),void ZPFeeds.Editor.getfocusOnEditor(editor,!1);var existFiles=void 0,attachedFile=actCont.find("#zp_dash_attachments").find(".attachedFile");if(0!==attachedFile.length){existFiles=[];for(var i=0;i<attachedFile.length;i++)"true"===$(attachedFile[i]).attr("existFile")&&existFiles.push($(attachedFile[i]).attr("fileid"))}existFiles=JSON.stringify(existFiles);var param={callBack:ZPFeeds.Comment.handleCommentResponse,fdk:actJson.fdk,content:content,messageText:messageText,curConObj:actCont,attachCnt:attachCnt,actRecId:actJson.actRecId,type:actJson.type,existFiles:existFiles,commentId:cmtId};ZPFeeds.postAction(param,!1)},getEditedHistory:function(recordId,isActivity){var params={actionType:"GET_FEEDSHISTORYBYID"};void 0!==recordId&&(isActivity?params.actId=recordId:params.cmtId=recordId,ZPeople.Request.send("/feedActions.zp",params,ZPFeeds.Edit.handleEditHistoryResp))},handleEditHistoryResp:function(data){if(!0===data.success){var history;history="string"==typeof data.history?JSON.parse(data.history):data.history;for(var bodyhtml="",i=0;i<history.length;i++)content=ZPFeeds.Activity.validateContent(history[i].content,!1),bodyhtml+='<div class="tlouter tltime"><div class="tlentry"><div class="tlentry-inner"><div class="tltime"><span class="date">'+(0==i?"Original":i+1===history.length?"Current":ZPDateTime.getDateDisplayFormat(history[i].time))+'</span></div><div class="tlicon"></div><div class="tllabel">'+(void 0!==history[i].title?history[i].title:"")+content+"</div></div></div></div>";var modal=Layout.Page.container.find("#zpfeededithistory");0===modal.length&&(modal=ZPeople.BSModal.get({id:"zpfeededithistory",type:2,header:ZPI18N.getString("zp.history"),body:bodyhtml,modalClass:"popRgtModel",deleteOnHide:!0,disableFooter:!0})),ZPeople.BSModal.show(modal)}}},ZPFeeds.Attachments={getIconClass:extention=>ZPUtil.Validation.isImage(extention)?"PI_image gry6":"xlsx"===extention||"xls"===extention?"PI_ft_xls":"docx"===extention||"doc"===extention?"PI_ft_doc":"zip"===extention||"tar.gz"===extention?"PI_ft_zip":"mp3"===extention?"PI_ft_mp3":"ppt"===extention?"PI_ft_ppt":"pdf"===extention?"PI_ft_pdf":"mp4"===extention?"PI_ft_vdo":"txt"===extention?"PI_ft_txt":"PI_ft_unknwn"},ZPFeeds.getUserDetails=((id,isCheck,isZuids)=>{let user=ZPeople.getUserDetailsById(id,isCheck,isZuids);return user&&!user.notFound||(user={id:"-1",name:ZPI18N.getString("zp.user"),avatar:ZPeople.getResourceURL(imageUrl+"user.png"),thumb:ZPeople.getResourceURL(imageUrl+"user.png")}),user}),ZPFeeds.PMS={PERFORMANCE_CONFIG_URL:"/performanceConfig.zp",FormUtil:{goalFormDtl:[],kraUsrformDtl:[],FeedbackName:ZPI18N.getString("zp.feedback"),getformDetails:function(mode){let formName="";if("goal"===mode&&0==ZPFeeds.PMS.FormUtil.goalFormDtl.length?formName="goalForm":"kraUserform"==mode&&0==ZPFeeds.PMS.FormUtil.kraUsrformDtl.length&&(formName="krauser_form"),""!=formName){let params={mode:"getformdetails",formName:formName,conreqcsr:csrfToken};$.ajax({type:"POST",async:!1,url:ZPFeeds.PMS.PERFORMANCE_CONFIG_URL,data:params,success:function(resultData){void 0!=resultData&&("goal"===mode?ZPFeeds.PMS.FormUtil.goalFormDtl=resultData:"kraUserform"==mode&&(ZPFeeds.PMS.FormUtil.kraUsrformDtl=resultData))}})}},viewGoalsByRecordId:function(recordId){ZPFeeds.PMS.FormUtil.getformDetails("goal");var params={formId:ZPFeeds.PMS.FormUtil.goalFormDtl.formId,tableName:ZPFeeds.PMS.FormUtil.goalFormDtl.formtableName,isEmbed:!0,recordId:recordId,disableSingleEdit:!0,formMode:"VIEW",isrelfieldsingelrecview:!1,activityChkforGoal:!0};ZP5Form.GOALVIEW_APPRAISALCFS=void 0,ZP5Form.load(params)}},Feedback:{feedbackViewkey:null,feedBackTypeDtl:null,isPAFeedBackTab:function(){return-1!==Layout.Page.currentmode.indexOf("performance/myreview/feedback")||-1!==Layout.Page.currentmode.indexOf("performance/myteamuser/feedback")||-1!==Layout.Page.currentmode.indexOf("performance/appraisaluser/feedback")||-1!==Layout.Page.currentmode.indexOf("operations/performance/user/feedback")||-1!==Layout.Page.currentmode.indexOf("performance/appraisaluser/feedback")||-1!==Layout.Page.currentmode.indexOf("home/user/feedback")},updateUserFeedbackResponse:function(obj,feedbackId){$(obj).off("click");let params={mode:"updateFeedbackHappyStatus",feedbackId:feedbackId,status:$(obj).attr("status"),conreqcsr:csrfToken},curFbDiv=$(obj).closest("[id=actOuterCont]");$.post(ZPFeeds.PMS.PERFORMANCE_CONFIG_URL,params,function(resultData){void 0!==params.status&&"1"===params.status&&("undefined"!=typeof AppraisalConfig&&void 0!==AppraisalConfig.formUtil&&void 0!==AppraisalConfig.formUtil.feedbackdispName&&(ZPFeeds.PMS.FormUtil.FeedbackName=AppraisalConfig.formUtil.feedbackdispName),$(curFbDiv).find("#user_feedback_response span").attr("status","0"),$(curFbDiv).find("#user_feedback_response span").html(AcsApi.localizeString("hrms.feeds.feedback.youlikedfb",["",ZPFeeds.PMS.FormUtil.FeedbackName])))})},init:function(container){ZPeople.CURRENT_VIEWKEY=ZPeople.VIEWKEYS.Feedback,ZPFeeds.PMS.Feedback.feedbackViewkey=ZPeople.VIEWKEYS.Feedback,ZPFeeds.Like.FEEDSLOADED=!1,$("[name=pmsModuleFeedback]").remove(),$(container).html('<div class="zpl_container"><div class="zpl_iwrpr"><div class="zpl_iwrprrgt"><div class="zpl_act"><div class="zpl_rgtcnt"><div class="zpl_fedbckcrd" id="feedback_feeds_outer"><div class="zp-fd-wrpr" id="'+ZPeople.CURRENT_VIEWKEY+'">'+ZPFeeds.getLoaderImage(2)+"</div></div></div></div></div></div></div>"),ZPUtil.Validation.isEmpty(ZPeople.CURRENT_VIEWKEY)||(AcsApi.initStream("People",ZPeople.CURRENT_VIEWKEY,10),ZPeople.Request.send("/feedActions.zp",{viewKey:ZPeople.CURRENT_VIEWKEY,count:10,actionType:"GET_LIKED_USERS",isActivity:0},ZPFeeds.Like.handleGetLikedUsersResponse))},getAllFeedbacks:function(){if(null===ZPFeeds.PMS.Feedback.feedBackTypeDtl){ZPFeeds.PMS.Feedback.feedBackTypeDtl={};let params={mode:"getfeedbackTypeList"};ZPeople.Request.sendAsyncPost(ZPFeeds.PMS.PERFORMANCE_CONFIG_URL,params,function(resultData){if(void 0!==resultData)for(let fbtypeDtl of resultData)ZPFeeds.PMS.Feedback.feedBackTypeDtl[fbtypeDtl.typeId]=fbtypeDtl})}},getFeedbacTypeDetailBytId:function(id){return ZPFeeds.PMS.Feedback.getAllFeedbacks(),ZPFeeds.PMS.Feedback.feedBackTypeDtl[id]}},Approval:{mrApproveRejectSubmitFromFeed:function(mrApprID,type,comment){var params={mode:"approveRejectFromFeed",approveStatus:type,approverComment:comment,multiraterApprovalId:mrApprID};ZPeople.Request.send(ZPFeeds.PMS.PERFORMANCE_CONFIG_URL,params,ZPFeeds.PMS.Approval.mrApproveRejectSubmitFromFeedCallback)},mrApproveRejectSubmitFromFeedCallback:function(resultData){void 0!=resultData.isError&&resultData.isError&&void 0==resultData.msg||ApprovalHome.updateApprovalCount()},approveRejectReviewSheetFromFeed:function(reviewSheetID,type,comment){var params={mode:"appRejSummarySheetFromFeed",approveStatus:type,approverCommment:comment,summaryID:reviewSheetID};ZPeople.Request.send(ZPFeeds.PMS.PERFORMANCE_CONFIG_URL,params,ZPFeeds.PMS.Approval.approveRejectReviewSheetFromFeedresponseCallback)},approveRejectReviewSheetFromFeedresponseCallback:function(resultData,params){void 0!=resultData.isError&&resultData.isError&&void 0!=resultData.msg?(ZPeople.Message.failure(resultData.msg),$('[streamid="'+params.summaryID+'"]').find("[id=zp_feeds_submit_approval]").attr("disabled",!1)):ApprovalHome.updateApprovalCount()}},feedbackReq:{loadJS:function(obj,isRej){Layout.PageUtil.loadFiles(["pms.feedbackReq.min.js"],()=>PMSFeedbackRequest.redirectToSingleFeeds(obj,isRej))}}};var People={FEEDS_USERLIST:[],NTFN_CNT:0,pushFeedsUserList:function(id){!ZPUtil.Validation.isEmpty(id)&&ZPUtil.Validation.isNumber(id)&&-1===People.FEEDS_USERLIST.indexOf(id)&&People.FEEDS_USERLIST.push(id)},onAcsConnect:function(){ZPeople.onBoardingStatus||(People.NTFN_CNT=0,ZPeople.Request.send("/feedActions.zp",{actionType:"GET_BADGE_COUNT"},People.Uns.handleCount))}};People.Uns={LAST_NTFN_TIME:void 0,handleBadge:function(ureadUns,smsg){var count=0;void 0!==ureadUns["UNS@"+_LOGGEDIN_ZSOID]&&(count=parseInt(ureadUns["UNS@"+_LOGGEDIN_ZSOID]),People.Uns.handleCount(count))},handleCount:function(count){People.NTFN_CNT=count,People.Uns.showNtfnCount()},showNtfnCount:function(){var title=page_title;People.NTFN_CNT>0?(title="("+People.NTFN_CNT+") "+page_title,$("#zp_feeds_ntfn_count").removeClass("DNI"),$("#zpntfn_modal").find("#zpntfn_markread").removeClass("DN"),$("#zp_feeds_ntfn_count").html(People.NTFN_CNT>99?"99+":People.NTFN_CNT)):(People.NTFN_CNT=0,$("#zp_feeds_ntfn_count").addClass("DNI"),$("#zpntfn_modal").find("#zpntfn_markread").addClass("DN")),document.title=title,ZPeople.TITLE=title,ZPUnifieduiUtil.showNotificationCount(People.NTFN_CNT)},renderNotificationList:function(renderType,list,nfchannel,badge,morekey,lbrtime){try{People.NTFN_CNT>0?$("#zpntfn_modal").find("#zpntfn_markread").removeClass("DN"):$("#zpntfn_modal").find("#zpntfn_markread").addClass("DN"),(0===list.length||list.length>0)&&$("#zp_feedntfn_listcont").next().remove();var ntfnListObj=$("#zpntfn_modal #zp_feedntfn_listdiv");if(0==ntfnListObj.length&&($("#zpntfn_modal").find("#zp_modal_body").prepend('<div class="Noti-main" id="zp_feedntfn_listdiv"></div>'),ntfnListObj=$("#zpntfn_modal #zp_feedntfn_listdiv")),"pre"==renderType&&ntfnListObj.html(""),list.length>0){for(var ntfnList=$("<div></div>"),nftnCnt=0;nftnCnt<list.length;nftnCnt++)try{let ntfn=list[nftnCnt]._ntfn,isread=ntfn.isRead,isSurvey=!1,isFbReq=!1,fdk=ntfn.fdk,skey=ntfn.skey,commentFDK=ntfn.commentFDK,isLike=ntfn.isLike,titleObj=ntfn.titleObj,photo=void 0,title=void 0;titleObj&&void 0!==titleObj.title&&(title=titleObj.title,"systemApproval"==titleObj.imageType||"shiftReminder"==titleObj.imageType?photo=ZPeople.getResourceURL(imageUrl+"auto-app.jpg"):"survey"==titleObj.imageType?(isSurvey=!0,photo=ZPeople.getResourceURL(newUIImageUrl+"enpsH.svg")):photo=titleObj.photo),isFbReq=void 0!=titleObj.feedType&&titleObj.feedType==People.FeedbackRequest.type&&void 0!=titleObj.status&&"-1"==titleObj.status;let $ntfnCont,time=ZPDateTime.getDateDisplayFormat(ntfn.time);if(isFbReq?($ntfnCont=$('<div class="zpl_em '+("false"==isread&&titleObj.isNotGiven?" zpl_unread":titleObj.isNotGiven?"":"zpl_declined")+' flex-dirC"><input type="hidden" value="'+fdk+'" id="actfdk"/><input type="hidden" value="'+skey+'" id="actskey"/><input type="hidden" value="'+titleObj.empFor+'" id="reqFor"/><input type="hidden" value="'+isLike+'" id="isLike"/><div class="d-flexclmcap12"><div class="zpl_emimg"><img class="zpl_emimg" src="'+photo+'"></div><div class="zpl_emdts"><div><b>'+title+"</b><div><em>"+ZSEC.Encoder.encodeForHTML(titleObj.bodyContent)+"</em></div></div></div></div>"+(titleObj.isNotGiven?'<div class="d-flexC j-cnt-btwen"><div></div><div id="fbtn"></div><div> <em>'+time+"</em> </div> </div> ":"")+"</div>"),titleObj.reqFBEnable&&$ntfnCont.find("#fbtn").append('<div data-popup-open="pmsReqFeedbackedit" class="zlabel zlabel--blue zlabel--outline zlabel--small" onclick="ZPFeeds.PMS.feedbackReq.loadJS(this,false)">'+ZPI18N.getString("zp.provide",[""])+'</div><div class="zlabel zlabel--red zlabel--outline zlabel--small" onclick="ZPFeeds.PMS.feedbackReq.loadJS(this,'+!0+')">'+ZPI18N.getString("zp.workflow.decline")+"</div>")):$ntfnCont=$(' <div class="zpl_em  '+("false"==isread?" zpl_unread":"")+'" data-target="#zpntfn_detail_modal" purpose="ntfn"><input type="hidden" value="'+fdk+'" id="actfdk"/><input type="hidden" value="'+skey+'" id="actskey"/><input type="hidden" value="'+commentFDK+'" id="cmtfdk"/><input type="hidden" value="'+isLike+'" id="isLike"/><div class="zpl_emimg"><img src="'+photo+'"></div><div class="zpl_emdts"><div>'+(isSurvey?ZSEC.Encoder.encodeForHTML(title):ZPeople.decodeTxt(ZPeople.escapeHtml(title)))+"</div><em>"+time+"</em></div></div>"),isSurvey){let $cont=$ntfnCont.find("div.Noti-cont"),$span=$cont.find("span");$cont.html(ZDOMEEAPI.api.constructTextNode(title)).append($span)}ntfnList.append($ntfnCont.data("subkeys",ntfn.subkeys))}catch(ex){}ntfnList.find(".zpl_em[purpose='ntfn']").on("click",function(){return $(this).hasClass("zpl_act")?ZPFeeds.Notifications.removeDetailDiv():ZPFeeds.Notifications.singleFeed($(this))}),$("#zpntfn_modal").find("#zp_modal_body").find("#zp_nodatantfn").remove(),ntfnListObj.append(ntfnList.children())}else 0===ntfnListObj.children("div.zpl_em").length&&($("#zpntfn_modal").find("#zpntfn_markread").addClass("DN"),$("#zpntfn_modal").find("#zp_modal_body").html('<div id="zp_nodatantfn" class="zpl_crd zpl_nodata"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"> <div> <div class="zpl_emptimg zp_nd_nodata"></div> <h4>'+ZPI18N.getString("zp.nonotificationfound")+"</h4> <p></p> </div> </div> </div> </div>"));ZPFeeds.Notifications.MOREKEY=morekey,void 0!==ZPFeeds.Notifications.MOREKEY&&AcsApi.isMoreAvailable(ZPFeeds.Notifications.MOREKEY)?(void 0!==morekey&&ntfnListObj.children("div.zpl_em").length<=15&&list.length>0&&ZPFeeds.Notifications.get(morekey),ZPeople.FireScroll.reset("ntfn_fs")):0===ntfnListObj.children("div.zpl_em").length&&$("#zpntfn_modal").find("#zp_modal_body").html('<div id="zp_nodatantfn" class="zpl_crd zpl_nodata"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"> <div> <div class="zpl_emptimg zp_nd_nodata"></div> <h4>'+ZPI18N.getString("zp.nonotificationfound")+"</h4> <p></p> </div> </div> </div> </div>")}catch(e){}}},People._View={init:function(viewkey){},initShowMore:function(viewkey){},nodata:function(viewkey){var currViewObj=Layout.Page.container.find("#"+ZPUtil.escapeSelector(ZPeople.CURRENT_VIEWKEY));ZPFeeds.PMS.Feedback.feedbackViewkey!==ZPeople.CURRENT_VIEWKEY||"#home/myspace/overview-feedback"!==Layout.Page.hash&&!Layout.Page.hash.includes("performance")&&"#home/personal/myspace-feedback"!==Layout.Page.hash?0===currViewObj.find("#zp_feeds_nodata").length&&currViewObj.html('<div class="text-center MT50" id="zp_feeds_nodata" ><div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_faq"></div><h4>'+ZPI18N.getString("zp.nofeedsyet")+"</h4></div></div></div>"):currViewObj.html('<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_nodata"></div><h4>'+ZPI18N.getString("zp.nofeedbackyet",new Array(AppraisalConfig.formUtil.feedbackdispName))+"</h4></div></div></div></div>")},completedShowMore:function(viewkey,size){ZPFeeds.Like.loadLikeWithStoredData()},completed:function(viewkey,size){ZPFeeds.Like.loadLikeWithStoredData()}},People.Activity=function(activityObj){try{if(this.recordOwner=activityObj.getAdditionalProperty("activityOwner"),void 0!==this.recordOwner){this.cmore=activityObj.getCMore(),this.isHTML=activityObj.getAdditionalProperty("isHTML"),this.type=activityObj.getType(),People.pushFeedsUserList(this.recordOwner);var feedBackToUser=activityObj.getAdditionalProperty("feedBackToUser"),postedWall=activityObj.getAdditionalProperty("postedWall");this.postedWall=postedWall;var postedUserId=activityObj.getAdditionalProperty("postedUserId");if(this.likedUsers=activityObj.getAdditionalProperty("likedUsers"),this.actRecId=activityObj.getAdditionalProperty("actRecId"),this.fdk=activityObj.getFDK(),People.pushFeedsUserList(feedBackToUser),People.pushFeedsUserList(postedUserId),this.comments=activityObj.getComments(),this.content=activityObj.getContent(),this.type===People.Status.type){var actTitle=activityObj.getAdditionalProperty("actTitle");this.ap_seemore=activityObj.getAdditionalProperty("seemore"),void 0!==actTitle&&(this.actTitle=ZPeople.escapeHtml(actTitle));var attachIds=activityObj.getAdditionalProperty("attachIds");this.linkStream=void 0,this.actAttObj=void 0,this.rawcontent=this.content,!0===this.isHTML?(this.menDeptDetails=activityObj.getAdditionalProperty("menDeptDetails"),this.menGrpDetails=activityObj.getAdditionalProperty("menGrpDetails"),this.content=ZPFeeds.Activity.validateContent(this.content,!1,activityObj.getAdditionalProperty("menDeptDetails"),activityObj.getAdditionalProperty("menGrpDetails")),this.content=ZPFeeds.Activity.getImgAndCBoxClass(this.content,this.actRecId)):this.content=ZPFeeds.Activity.filterTemplate(this.content),void 0!==attachIds&&""!==attachIds&&(this.attachments=attachIds,this.actAttObj=ZPFeeds.Activity.getAttachContent(attachIds,this.actRecId,void 0,this.type));var linkstreamdata=activityObj.getAdditionalProperty("linkStream");void 0!==linkstreamdata&&Object.keys(linkstreamdata).length>0&&(this.linkStream=ZPFeeds.Activity.getHTMLforLinkStream(linkstreamdata),this.linkstreamdata=linkstreamdata);var privateMsgOwners=activityObj.getAdditionalProperty("privateMsgOwners");if(void 0!==privateMsgOwners){var userID=privateMsgOwners.split(",")[0]+"";People.pushFeedsUserList(userID)}}else if(this.type===People.Collaboration.type)People.pushFeedsUserList(activityObj.getASUsers());else if(this.type!==People.MailAlert.type&&this.type!==People.AddSchedule.type&&this.type!==People.AddProject.type&&this.type!==People.Approval.type||ZPUtil.Validation.isEmpty(activityObj.getASUsers()))this.type===People.FileCabinet.type?People.pushFeedsUserList(activityObj.getAdditionalProperty("reportingTo")):this.type===People.Goal.type?(People.pushFeedsUserList(activityObj.getAdditionalProperty("postedUserId")),People.pushFeedsUserList(activityObj.getAdditionalProperty("assignedToUser"))):this.type===People.KRA.type?(People.pushFeedsUserList(activityObj.getAdditionalProperty("postedUserId")),People.pushFeedsUserList(activityObj.getAdditionalProperty("assignedToUser"))):this.type===People.EmpAcceptance.type?People.pushFeedsUserList(activityObj.getAdditionalProperty("assignedToUser")):this.type===People.AppraisalCycle.type&&People.pushFeedsUserList(activityObj.getASUsers());else for(var list=activityObj.getASUsers().split(","),maxLen=list.length>11?11:list.length,i=0;i<maxLen;i++)People.pushFeedsUserList(list[i]);if(!ZPUtil.Validation.isEmpty(this.content))for(var m,re=new RegExp("zp[[a-z]+(#|:).+?]zp","g");null!==(m=re.exec(this.content));){var source=m[0].split("zp[")[1].slice(0,-3),mentionId=source.split(":")[1];"peopleuser"===source.split(":")[0]&&People.pushFeedsUserList(mentionId)}this.type!==People.Feedback.type&&(this.content=ZPFeeds.Activity.getMentions(this.content,!1,activityObj.getAdditionalProperty("menDeptDetails"),activityObj.getAdditionalProperty("menGrpDetails"))),this.type!==People.MailAlert.type&&this.type!==People.Reminder.type||(this.content=ZPFeeds.Activity.filterTemplate(this.content,!1));var userDataList=ZPeople.getUserDetailsByIds(People.FEEDS_USERLIST,!0);People.FEEDS_USERLIST=[];var actionOwner=activityObj.getAOwner();if(this.actOwner=this.recordOwner!==_LOGGEDIN_ZUID?ZPeople.getUserDetailsByIdInList(this.recordOwner,userDataList):ZPeople.CURR_USER,this.tableName=activityObj.getAdditionalProperty("tableName"),this.formId=activityObj.getAdditionalProperty("formId"),this.recordURL=ZPFeeds.Activity.getRecordUrl(this.formId,this.actRecId,this.tableName,this.type),this.digestFDK=activityObj.getAdditionalProperty("digestFDK"),this.title=ZPFeeds.Activity.getTitle(activityObj,this),this.postedTime=ZPDateTime.getDateDisplayFormat(activityObj.getTime()),this.type!==People.Status.type&&this.type!==People.Collaboration.type&&this.type!==People.Announcement.type||(this.isactEdited=!1,1==activityObj.getAdditionalProperty("isActEdited")&&(this.isactEdited=!0),actionOwner==_LOGGEDIN_ZUID||actionOwner==erecno||isadmin?this.isDeleteAllowed=!0:this.isDeleteAllowed=!1),this.type===People.XoxodayNotify.type&&(this.title=ZPI18N.getString("zp.notiftitle"),this.erecno=activityObj.getAdditionalProperty("recErecNo")),this.type===People.Shift.type)this.isCommentDisabled=activityObj.getAdditionalProperty("isCommentDisabled"),activityObj.getAdditionalProperty("breakViolatedShiftCoreHr")?(this.isSystemImage=!0,this.shiftTable=AttendanceShift.contructBreakViolatedMessge(activityObj)):activityObj.getAdditionalProperty("shiftDetails")?(Attendance.timeFormatIs12hr=!1,"hh:mm a"===timeFormat&&(Attendance.timeFormatIs12hr=!0),this.shifdetails=activityObj.getAdditionalProperty("shiftDetails"),this.shiftTable=AttendanceShift.constructTableForFeeds(this.shifdetails),activityObj.getAdditionalProperty("isFromAutoShiftAssignment")&&(this.isSystemImage=!0)):(this.shiftTable=AttendanceShift.consFeedsForAttMissNotification(activityObj),activityObj.getAdditionalProperty("actualOwner")&&(this.shiftActualOwner=activityObj.getAdditionalProperty("actualOwner")),this.isSystemImage=!0);else if(this.type===People.Approval.type){if("P_EmployeeLeave"===this.tableName){this.isDayBased=activityObj.getAdditionalProperty("isDayBased");var fromDate=activityObj.getAdditionalProperty("fromDate"),toDate=activityObj.getAdditionalProperty("toDate");-1!==fromDate.indexOf("|")&&-1!==toDate.indexOf("|")?(fromDate=fromDate.split("|"),this.fromDate=Calendar.formatDate(new Date(fromDate[2],fromDate[1],fromDate[0])),toDate=toDate.split("|"),this.toDate=Calendar.formatDate(new Date(toDate[2],toDate[1],toDate[0]))):(this.fromDate=Calendar.convertLongToDate(fromDate),this.toDate=Calendar.convertLongToDate(toDate)),this.leaveReason=ZPeople.checkHTML(activityObj.getAdditionalProperty("reason"))?ZPeople.escapeHtml(activityObj.getAdditionalProperty("reason")):activityObj.getAdditionalProperty("reason"),this.daysTaken=activityObj.getAdditionalProperty("daysTaken")}else"P_ReviewSheetApproval"!==this.tableName&&"P_GoalSheet"!==this.tableName&&"P_Goal"!==this.tableName&&"P_MultiRater_Approval"!==this.tableName&&"P_Budget_Splitup"!==this.tableName||(this.noneedMentioninEdit=!0);this.isPhotoTransfer=activityObj.getAdditionalProperty("isPhotoTransfer"),this.dataforapprovalid=activityObj.getAdditionalProperty("dataforappid"),this.isAutoApproveReject=activityObj.getAdditionalProperty("isAutoApproveReject"),this.mailtitle=activityObj.getAdditionalProperty("title"),this.action=activityObj.getAdditionalProperty("action"),this.approvalAction=activityObj.getAdditionalProperty("approvalAction"),this.fromAddr=activityObj.getAdditionalProperty("fromAddr"),this.message=activityObj.getAdditionalProperty("message"),this.message=ZPFeeds.Activity.filterTemplate(this.message),this.isAllowedToViewMail=void 0==activityObj.getAdditionalProperty("isAllowedToViewMail")||activityObj.getAdditionalProperty("isAllowedToViewMail"),this.toOrCcMembers=activityObj.getAdditionalProperty("toOrCcMembers"),void 0!=this.toOrCcMembers&&-1===this.toOrCcMembers.indexOf(_LOGGEDIN_ZUID)&&(this.isAllowedToViewMail=!1),this.assignedUsers=[],ZPFeeds.Activity.getAssignedUserList(activityObj.getASUsers(),activityObj.getAOwner(),this),this.isAutoApproveReject&&(this.autoApproveReject=activityObj.getAdditionalProperty("autoApproveReject"),this.systemApprovedTime=this.postedTime)}else if(this.type===People.Leave.type)this.subject=activityObj.getAdditionalProperty("subject"),this.leaveTypeName=activityObj.getAdditionalProperty("leaveTypeName"),this.fromDate=activityObj.getAdditionalProperty("fromDate"),this.toDate=activityObj.getAdditionalProperty("toDate"),this.daysTaken=activityObj.getAdditionalProperty("daysTaken"),this.isDayBased=activityObj.getAdditionalProperty("isDayBased"),this.formName=activityObj.getAdditionalProperty("formName"),this.leaveCancelled=activityObj.getAdditionalProperty("leaveCancelled"),this.leaveCancelled&&(this.cancelReason=activityObj.getAdditionalProperty("cancelReason"));else if(this.type===People.Holiday.type){this.holidayDate=activityObj.getAdditionalProperty("holiday_date"),this.holidayName=activityObj.getAdditionalProperty("holiday_name"),this.holiday_displayname=activityObj.getAdditionalProperty("holiday_displayname"),this.isRH=activityObj.getAdditionalProperty("isRH"),this.holiday_classification=activityObj.getAdditionalProperty("holiday_classification"),this.locations="";var holidayLocList=activityObj.getAdditionalProperty("holiday_location");if(void 0!=holidayLocList&&holidayLocList.length>0)for(var k=0;k<holidayLocList.length;k++)""!==this.locations.trim()&&(this.locations+=","),this.locations+=" "+holidayLocList[k];void 0!==activityObj.getAdditionalProperty("holiday_remarks")&&(this.description=activityObj.getAdditionalProperty("holiday_remarks")),this.holidayType=activityObj.getAdditionalProperty("holiday_action_type")}else if(this.type===People.MailAlert.type)this.title=ZSEC.Encoder.encodeForHTML(activityObj.getAdditionalProperty("mail_subject")),this.fromAddr=activityObj.getAdditionalProperty("fromAddr"),this.ap_mailAlertType=activityObj.getAdditionalProperty("mailAlertType"),ZPFeeds.Activity.getAssignedUserList(activityObj.getASUsers(),activityObj.getAOwner(),this);else if(this.type===People.FileCabinet.type){this.uploadSource=activityObj.getAdditionalProperty("uploadSource"),this.fileName=activityObj.getAdditionalProperty("fileName"),this.catName=ZPFeeds.Activity.ConvertJSONArrToStr(activityObj.getAdditionalProperty("fileCategory")),this.fileDescription=activityObj.getAdditionalProperty("fileDescription"),this.fileType=activityObj.getAdditionalProperty("fileType"),this.filePath=activityObj.getAdditionalProperty("filePath"),this.fileExtn=activityObj.getAdditionalProperty("fileExtn");var isConfidential=activityObj.getAdditionalProperty("isConfidential");this.allowDownload=activityObj.getAdditionalProperty("allowDownload"),this.isreportingTo=activityObj.getAdditionalProperty("isreportingTo"),this.fileConfident=activityObj.getAdditionalProperty("fileConfident"),void 0===isConfidential||isadmin||!0!==isConfidential?this.isConfidential=!1:this.isConfidential=!0,this.sharedTo=activityObj.getAdditionalProperty("sharedTo"),ZPFeeds.Activity.getFileSharedDetails(activityObj,this)}else if(this.type===People.Announcement.type){this.content=ZPFeeds.Activity.validateContent(this.content,!1,activityObj.getAdditionalProperty("menDeptDetails"),activityObj.getAdditionalProperty("menGrpDetails"),void 0,!0),this.content=ZPFeeds.Activity.getImgAndCBoxClass(this.content,this.actRecId),this.content=ZPFeeds.getVideoTags(this.content,this.actRecId,People.Announcement.type),this.subject=activityObj.getAdditionalProperty("subject");var announceTo=activityObj.getAdditionalProperty("announceTo");if(this.locationId=activityObj.getAdditionalProperty("locationId"),this.isCommentDisable=activityObj.getAdditionalProperty("isCommentDisable"),void 0===this.isCommentDisable&&(this.isCommentDisable=0),this.categories=activityObj.getAdditionalProperty("categories"),this.expireDate=activityObj.getAdditionalProperty("expireDate"),this.announceClass="ZPgrp",void 0!==(attachIds=activityObj.getAdditionalProperty("attachIds"))&&""!==attachIds&&(this.attachments=attachIds,this.actAttObj=ZPFeeds.Activity.getAttachContent(attachIds,this.actRecId,void 0,this.type)),"ALL_LOCATIONS"===announceTo)announceTo='<span class="label label-primary FL MR5">'+ZPI18N.getString("zp.all")+"</span>";else if(-1!==announceTo.indexOf(",")){this.announceClass="ZPloca",announceTo=announceTo.split(",");var announceObj="";for(i=0;i<announceTo.length;i++)announceObj+='<span class="label label-primary FL MR5">'+announceTo[i]+"</span>";announceTo=announceObj}else{this.announceClass="ZPloca",announceTo=announceObj='<span class="label label-primary FL MR5">'+announceTo+"</span>"}this.announceTo=announceTo}else if(this.type===People.JobSchedule.type)this.jobScheduleHtml='<a class="btn_lined btn btn-detail" href="#timetracker/mydata/jobschedule/list" id="viewJobScheduleBtn">'+ZPI18N.getString("zp.viewjobschedule")+"</a>";else if(this.type===People.AddSchedule.type)this.jobName=activityObj.getAdditionalProperty("jobName"),void 0!==activityObj.getAdditionalProperty("jobId")&&null!==activityObj.getAdditionalProperty("jobId")&&(this.jobId=activityObj.getAdditionalProperty("jobId")),void 0!==activityObj.getAdditionalProperty("projectName")&&null!==activityObj.getAdditionalProperty("projectName")&&(this.projectName=activityObj.getAdditionalProperty("projectName")),void 0!==activityObj.getAdditionalProperty("clientName")&&null!==activityObj.getAdditionalProperty("clientName")&&(this.clientName=activityObj.getAdditionalProperty("clientName")),this.isCompleted=activityObj.getAdditionalProperty("isCompleted"),this.isCompleted&&(this.addJobComMesg=AcsApi.localizeString("hrms.feeds.ntfn.job.message.completed"));else if(this.type===People.AddProject.type)this.projectName=activityObj.getAdditionalProperty("projectName"),void 0!==activityObj.getAdditionalProperty("projectId")&&null!==activityObj.getAdditionalProperty("projectId")&&(this.projectId=activityObj.getAdditionalProperty("projectId")),void 0!==activityObj.getAdditionalProperty("clientName")&&null!==activityObj.getAdditionalProperty("clientName")&&(this.clientName=activityObj.getAdditionalProperty("clientName")),this.isCompleted=activityObj.getAdditionalProperty("isCompleted"),this.isCompleted&&(this.addProjectComMesg=AcsApi.localizeString("hrms.feeds.ntfn.project.message.completed"));else if(this.type===People.Feedback.type){this.isDeleteAllowed=!1,this.showHappyLink=!1,this.isUserHappy=activityObj.getAdditionalProperty("isUserHappy");var imageType=activityObj.getAdditionalProperty("imageType"),feedbackTypeId=activityObj.getAdditionalProperty("feedbackTypeId"),fdbktypeName="";if(this.isAnonymous="false",void 0==activityObj.getAdditionalProperty("isAnonymous")||1!=activityObj.getAdditionalProperty("isAnonymous")&&"true"!=activityObj.getAdditionalProperty("isAnonymous")||(this.isAnonymous=activityObj.getAdditionalProperty("isAnonymous"),this.actOwner={name:"Anonymous User",thumb:ZPeople.getResourceURL(imageUrl+"user.png")},(void 0!=this.isAnonymous&&1==this.isAnonymous||"true"==this.isAnonymous)&&(this.actOwner.thumb=ZPeople.getResourceURL(imageUrl+"user.png"))),void 0!=activityObj.getAdditionalProperty("fdbktypeName"))fdbktypeName=activityObj.getAdditionalProperty("fdbktypeName"),this.fdbktypeName=fdbktypeName;else{let fbTypeDtl=ZPFeeds.PMS.Feedback.getFeedbacTypeDetailBytId(feedbackTypeId);void 0!==fbTypeDtl&&(this.fdbktypeName=fbTypeDtl.typeName)}if("false"!=this.isAnonymous&&0!=this.isAnonymous||this.actOwner.id+""!=_LOGGEDIN_ZUID+""||(this.isDeleteAllowed=!0),this.happyTitle="",void 0!==this.isUserHappy){var params=new Array;void 0!=activityObj.getAdditionalProperty("isAnonymous")?(params[0]=ZPFeeds.Activity.getUsersLinkName(ZPeople.getUserDetailsByIdInList(feedBackToUser,userDataList)),params[1]=ZPFeeds.PMS.FormUtil.FeedbackName,feedBackToUser+""==_LOGGEDIN_ZUID+""?this.happyTitle=AcsApi.localizeString("hrms.feeds.feedback.youlikedfb",params):this.happyTitle=AcsApi.localizeString("hrms.feeds.feedback.otherslikeanonymfb",params)):(params[0]=ZPFeeds.Activity.getUsersLinkName(ZPeople.getUserDetailsByIdInList(feedBackToUser,userDataList)),params[1]=ZPFeeds.PMS.FormUtil.FeedbackName,params[2]=ZPFeeds.Activity.getUsersLinkName(ZPeople.getUserDetailsByIdInList(postedUserId,userDataList)),feedBackToUser+""==_LOGGEDIN_ZUID+""?this.happyTitle=AcsApi.localizeString("hrms.feeds.feedback.youlikedfb",params):this.happyTitle=AcsApi.localizeString("hrms.feeds.feedback.gotafeedbacklike",params))}else feedBackToUser+""==_LOGGEDIN_ZUID+""&&(this.showHappyLink=!0);var feedbackDts={"-1":{icon:"PI_comment blu",col:"blu"},0:{icon:"PI_like grn",col:"grn"},1:{icon:"PI_unlike red",col:"red"},2:{icon:"PI_star_line org",col:"org"},3:{icon:"PI_eye gry6",col:"gry"},4:{icon:"PI_award ylw",col:"ylw"}};let fbColour=feedbackDts[imageType].col;this.leftFbColour="2"===imageType||"-1"===imageType?fbColour+"bdr":fbColour+"bdr1",this.fbTypeInfoCol=fbColour+"bdrbglit",this.fbImageType=feedbackDts[imageType].icon,this.fbTypeCol=fbColour,this.content=ZPUtil.checkLineBreaksInContent(activityObj.getContent()).replace(/\n/g,"<br />")}else if(this.type===People.HrCase.type){$.isEmptyObject(CasesCommon.STATUS)&&CasesCommon.getStatusList(),$.isEmptyObject(CasesCommon.PRIORITY)&&CasesCommon.getPriorityList(),this.fileArr=activityObj.getAdditionalProperty("fileObject"),void 0!=this.fileArr&&(this.fileObj=CasesFilesCommon.getAttachments(this.actRecId,this.fileArr)),this.reqID=activityObj.getAdditionalProperty("hr_case_requestor"),this.recordOwnerID=activityObj.getAdditionalProperty("hr_case_requestor");var requestorData=ZPFeeds.getUserDetails(this.reqID),reqZUID=requestorData.id;this.actOwner=requestorData;var cgyName=activityObj.getAdditionalProperty("hr_catelog_type");if(this.categoryName=activityObj.getAdditionalProperty("hr_catelog_type"),reqZUID!==_LOGGEDIN_ZUID){var reqN=requestorData.name;this.title=ZPI18N.getString("zp.hrcasefeedheaderwithname",['<a  popup="user" empid="'+reqZUID+'">'+reqN+"</a>",activityObj.getAdditionalProperty("autonum"),'<span id="cgeNameHeader">'+cgyName+"</span>"])}else this.title=ZPI18N.getString("zp.hrcasefeedheader",[activityObj.getAdditionalProperty("autonum"),'<span id="cgeNameHeader">'+cgyName+"</span>"]);if(this.agentID=activityObj.getAdditionalProperty("hr_case_agent"),""==this.agentID?(this.agentDts=activityObj.getAdditionalProperty("hr_case_agentDetail"),this.agentDtsInShort=ZPeople.getShortName(activityObj.getAdditionalProperty("hr_case_agentDetail"))):(this.agentDts=ZPFeeds.getUserDetails(this.agentID),this.agentID==erecno||this.reqID==erecno?this.closeOptn="true":this.closeOptn="false"),this.subject=activityObj.getAdditionalProperty("hr_case_query"),this.desc=activityObj.getAdditionalProperty("hr_case_desc"),this.seemoredesc=!1,this.hr_categoryId=activityObj.getAdditionalProperty("hr_categoryId"),this.hr_subcategoryId=activityObj.getAdditionalProperty("hr_subcategoryId"),this.hr_subcategoryName=activityObj.getAdditionalProperty("hr_subcategoryName"),this.status=activityObj.getAdditionalProperty("hr_case_status"),this.closeButton="false",this.statusString=CasesCommon.STATUS[this.status],this.priority=activityObj.getAdditionalProperty("hr_case_priority"),!$.isEmptyObject(CasesCommon.PRIORITY)){var _priorityString="";$.each(CasesCommon.PRIORITY,function(key,value){if(key===activityObj.getAdditionalProperty("hr_case_priority"))return _priorityString=value,!1}),this.priorityString=_priorityString}if(5!=this.status&&6!=this.status||(this.closeButton="true"),this.agentVID=activityObj.getAdditionalProperty("hr_case_agentValueId"),this.agentTID=activityObj.getAdditionalProperty("hr_case_agentTypeId"),1==this.agentTID&&this.agentVID==erecno)this.agentvalue="true",this.isAgent="true";else if(2==this.agentTID&&this.agentVID==_LOGGEDIN_DEPID)this.agentvalue="true",this.isAgent="true",""!=this.agentID&&(this.agentID==erecno?this.isAgent="true":this.isAgent="false");else if(3==this.agentTID||4==this.agentTID){var agentV="false",isAgent="false",agentId=this.agentID;$.each(ZPeople.loggedInGroups,function(k,grpId){if(activityObj.getAdditionalProperty("hr_case_agentValueId")===grpId&&(agentV="true",isAgent="true",""!=agentId))return isAgent=agentId==erecno?"true":"false"}),this.isAgent=isAgent,this.agentvalue=agentV}else this.agentvalue="false";this.pickupIcon="false",""==this.agentID&&"true"==this.agentvalue&&"false"==this.closeButton&&(this.pickupIcon="true"),this.isDeleteAllowed=!1}else if(this.type===People.Goal.type){this.goalName=activityObj.getAdditionalProperty("goalName");var postederec=activityObj.getAdditionalProperty("postedUserId"),assignTo=activityObj.getAdditionalProperty("assignedToUser");this.assignTo=ZPFeeds.getUserDetails(assignTo),ZPFeeds.PMS.FormUtil.getformDetails("goal"),this.title=ZPFeeds.PMS.FormUtil.goalFormDtl.formDispname+" "+ZPI18N.getString("zp.Details"),this.postedUserId=ZPFeeds.getUserDetails(postederec),this.postedTime=ZPDateTime.getDateDisplayFormat(activityObj.getAdditionalProperty("postedTime"))}else if(this.type===People.KRA.type){this.kraName=activityObj.getAdditionalProperty("kraName"),this.description=activityObj.getAdditionalProperty("description"),this.weightage=activityObj.getAdditionalProperty("weightage"),this.showWeightage=activityObj.getAdditionalProperty("showWeightage");postederec=activityObj.getAdditionalProperty("postedUserId"),assignTo=activityObj.getAdditionalProperty("assignedToUser");ZPFeeds.PMS.FormUtil.getformDetails("kraUserform"),this.assignTo=ZPFeeds.getUserDetails(assignTo),this.postedUserId=ZPFeeds.getUserDetails(postederec),this.title=ZPFeeds.PMS.FormUtil.kraUsrformDtl.formDispname+" "+ZPI18N.getString("zp.Details"),this.postedTime=ZPDateTime.getDateDisplayFormat(activityObj.getAdditionalProperty("postedTime"))}else this.type===People.Training.type?(this.LMSNotificationKey=activityObj.getAdditionalProperty("LMSNotificationKey"),this.title=activityObj.getAdditionalProperty("feedTitle"),"COURSE_COMPLETED_NOTIFICATION_KEY"!=this.LMSNotificationKey&&"SESSION_COMPLETED_NOTIFICATION_KEY"!=this.LMSNotificationKey&&"COURSE_FEEDBACK_PENDING_NOTIFICATION_KEY"!=this.LMSNotificationKey||(this.courseId=activityObj.getAdditionalProperty("courseId"),this.batchId=activityObj.getAdditionalProperty("batchId"),this.role=activityObj.getAdditionalProperty("role"),"2"==this.role&&(this.feedbackFor=activityObj.getAdditionalProperty("feedbackFor")),"SESSION_COMPLETED_NOTIFICATION_KEY"==this.LMSNotificationKey&&(this.sessionId=activityObj.getAdditionalProperty("sessionId"))),"COURSE_COMPLETED_NOTIFICATION_KEY"==this.LMSNotificationKey&&(this.testId=activityObj.getAdditionalProperty("testId"),this.assessmentId=activityObj.getAdditionalProperty("assessmentId"))):this.type===People.EmpAcceptance.type?(this.feedback=activityObj.getAdditionalProperty("feedback"),this.appraisee=ZPFeeds.getUserDetails(activityObj.getAdditionalProperty("appraisee")).name,this.appraisalname=activityObj.getAdditionalProperty("appraisalname"),this.acceptancestatus=activityObj.getAdditionalProperty("acceptancestatus"),this.accType=activityObj.getAdditionalProperty("accType"),this.isfeed=activityObj.getAdditionalProperty("isfeed")):this.type===People.Survey.type?(this.surveyId=this.actRecId,this.title=activityObj.getAdditionalProperty("feedTitle"),this.survey=activityObj.getAdditionalProperty("SURVEYDATA")):this.type===People.AppraisalCycle.type?(this.title=activityObj.getAdditionalProperty("subject"),this.fromAddr=activityObj.getAdditionalProperty("fromAddr"),this.toAddr=activityObj.getAdditionalProperty("toAddr")):this.type===People.FeedbackRequest.type&&(this.title=activityObj.getAdditionalProperty("subject"));var totalComments=parseInt(activityObj.getTotalComments());isNaN(totalComments)&&(totalComments=0),this.viewallcomments=ZPI18N.getString("zp.viewallcomments",[totalComments]),this.totalComments=totalComments,this.cmt_skey=activityObj.getSkey(),this.cmt_morekey=activityObj.getCMore(),this.page="default"}}catch(e){People.FEEDS_USERLIST=[]}},People.Comment=function(commentObj,isInstantUpdate){try{if(this.commby=commentObj.getPostedBy(),!0!==isInstantUpdate||this.commby===_LOGGEDIN_ZUID&&!0===isInstantUpdate){if(this.type=commentObj.getAdditionalProperty("activityType"),this.isHTML=commentObj.getAdditionalProperty("isHTML"),People.pushFeedsUserList(this.commby),this.commat=commentObj.getAt(),this.likedUsers=commentObj.getAdditionalProperty("likedUsers"),this.content=commentObj.getContent(),this.rawcontent=this.content,this.commentId=commentObj.getAdditionalProperty("commentId"),!0===this.isHTML?(this.content=ZPFeeds.Activity.getImgAndCBoxClass(this.content,this.commentId),this.content=ZPFeeds.Activity.validateContent(this.content,!1,commentObj.getAdditionalProperty("menDeptDetails"),commentObj.getAdditionalProperty("menGrpDetails"))):(this.type!==People.Status.type&&this.type!==People.HrCase.type||(this.content=ZPFeeds.Activity.getMentions(this.content,!1,commentObj.getAdditionalProperty("menDeptDetails"),commentObj.getAdditionalProperty("menGrpDetails")),this.content=ZPFeeds.Activity.getMentions(this.content,!0,commentObj.getAdditionalProperty("menDeptDetails"),commentObj.getAdditionalProperty("menGrpDetails"))),this.content=ZPFeeds.Activity.filterTemplate(this.content,!1)),this.cmtattList=commentObj.getAdditionalProperty("attachIds"),this.attachments=this.cmtattList,this.cfdk=commentObj.getCFDK(),this.approvalStatus=commentObj.getAdditionalProperty("approvalStatus"),this.isApproverComment=commentObj.getAdditionalProperty("isApproverComment"),this.isFromSLA=commentObj.getAdditionalProperty("isFromSLA"),this.isSystemComment=commentObj.getAdditionalProperty("isSystemComment"),this.isAllowedtoDelete=commentObj.getAdditionalProperty("isAllowedtoDelete"),this.lastPublished=commentObj.getAdditionalProperty("lastPublished"),!0===isInstantUpdate&&(this.totalCmtCnt=commentObj.getAdditionalProperty("totalCmtCnt"),this.commentOwnDtl=ZPFeeds.getUserDetails(this.commby)),this.isDelete=!1,!ZPUtil.Validation.isEmpty(this.content))for(var m,re=new RegExp("zp[[a-z]+(#|:).+?]zp","g");null!==(m=re.exec(this.content));){var source=m[0].split("zp[")[1].slice(0,-3),mentionId=source.split(":")[1];"peopleuser"===source.split(":")[0]&&People.pushFeedsUserList(mentionId)}this.type!==People.Status.type&&this.type!==People.Collaboration.type&&this.type!==People.Announcement.type||(this.isactEdited=!1,1==commentObj.getAdditionalProperty("isCmtEdited")&&(this.isactEdited=!0)),this.type===People.EmpAcceptance.type&&(this.isReviewerComment=commentObj.getAdditionalProperty("isReviewerComment")),!0==!this.isApproverComment&&this.commby===_LOGGEDIN_ZUID+""&&(this.isDelete=!0),this.type===People.HrCase.type&&"false"===this.isAllowedtoDelete&&(this.isDelete=!1),ZPFeeds.Construction.isAdminDeleteAllowed(this.type)&&(this.isDelete=!0)}}catch(e){}},People.Handler={handleDelete:function(deltype,fdk,cfdk){"activity"===deltype?ZPFeeds.Activity.handleDelete(fdk):"comment"===deltype&&ZPFeeds.Comment.handleDelete(fdk,cfdk)}},People.Shift={type:"Shift",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Status={type:"Status",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Approval={type:"Approval",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){ZPFeeds.SINGLEPOP&&ZPFeeds.Notifications.handleNTFNFeed(activityObj)},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.MailAlert={type:"MailAlert",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Announcement={type:"Announcement",render:function(renderType,viewkey,activityObj,append){(void 0===activityObj.expireDate||-1===activityObj.expireDate||activityObj.expireDate>Date.now())&&ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Reminder={type:"Reminder",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.JobSchedule={type:"JobSchedule",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.AddProject={type:"AddProject",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.AddSchedule={type:"AddSchedule",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.FileCabinet={type:"FileCabinet",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Holiday={type:"Holiday",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Collaboration={type:"Collaboration",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Feedback={type:"Feedback",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.FeedbackRequest={type:"FeedbackRequest",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.HrCase={type:"HrCase",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Task={type:"Task",render:function(renderType,viewkey,activityObj,append){},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Goal={type:"Goal",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.KRA={type:"KRA",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.Training={type:"Training",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.EmpAcceptance={type:"EmpAcceptance",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderComments:function(viewkey,fdk,cmore,commentarr,tccount,att){ZPFeeds.Comment.showMoreComments(fdk,commentarr,tccount,cmore)},renderNotification:function(viewkey,activityObj,isPush){},updatePoll:function(viewkey,pollObj){},invokeAction:function(viewkey,action,fdk,value,formObj){AcsApi.invoke("People",viewkey,fdk,this.type,action,value,formObj)},handleAction:function(viewkey,action,fdk,data){},handleActionError:function(viewkey,action,fdk,aae){},handleDelete:function(deltype,viewkey,fdk,cfdk){People.Handler.handleDelete(deltype,fdk,cfdk)}},People.XoxodayNotify={type:"XoxodayNotify",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)},renderNotification:function(viewkey,activityObj,isPush){}},People.Leave={type:"Leave",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)}},People.Survey={type:"Survey",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)}},People.AppraisalCycle={type:"AppraisalCycle",render:function(renderType,viewkey,activityObj,append){ZPFeeds.Activity.constructFeed(renderType,viewkey,activityObj,append)}};var ZPFeedsColorBox={relationalId:"",cBoxIdx:0,req:null,viewImgsandFiles:function(obj){var isFile=$(obj).attr("file"),index=0,extn="",title=$(obj).attr("title");void 0==title&&(title=$(obj).attr("fieldtitle")),isFile&&(index=title.lastIndexOf("."),extn=(extn=title.substring(index+1)).toLowerCase());var downloadUrl=$(obj).attr("downloadurl"),viewUrl=$(obj).attr("viewUrl");let fileViewContainer=$('<div id="feedsColorBox" class="zpl_Lbx" style="display: block; height: 100%;" rel="comp_img"><div class="zpl_Lbx_hdr"><div class="zpl_info trns"></div><div class="zpl_Lbx_ttl"><h6>'+(void 0!==title?ZPeople.escapeHtml(title):"")+'</h6></div><div class="zpl_Lbx_cls" id="cBoxClose" onclick="ZPFeedsColorBox.closeColorBox(this);"><span ><i class="PI_cls"></i><em>esc</em></span></div></div><div class="zpl_Lbx_ftr"><div class="zpl_Lbx_act">'+(void 0!==downloadUrl?'<a href="'+downloadUrl+'" class="txtdecorationnone"><i class="PI_downld"></i></a>':"")+"</div></div></div>");var isPrev=!1,isNxt=!1;ZPFeedsColorBox.relationalId=$(obj).attr("rel");for(var relObj=$('[rel="'+ZPFeedsColorBox.relationalId+'"]'),relLen=relObj.length,i=0;i<relLen;i++){var url=relObj[i].attributes.downloadurl;if(void 0!==url&&null!==url&&url.nodeValue===$(obj)[0].attributes.downloadurl.nodeValue||relObj[i]===$(obj)[0]){ZPFeedsColorBox.cBoxIdx=i,0!==ZPFeedsColorBox.cBoxIdx&&(isPrev=!0),ZPFeedsColorBox.cBoxIdx+1!==relLen&&(isNxt=!0);break}}fileViewContainer.append('<div class="zpl_Lbx_bdy zpl_Lbximg">'+(isPrev?'<i class="PI_alft" onclick="ZPFeedsColorBox.loadPrevNextObject(this,false)"> </i>':"")+(isNxt?'<i class="PI_argt" onclick="ZPFeedsColorBox.loadPrevNextObject(this,true)"></i>':"")+'<div class="zpl_Lbx_pv '+(void 0!==isFile&&isFile?"":"cbxImg")+'" >'+ZPeople.LOADING_HTML+"</div> </div>"),$("body").find("#feedsColorBox").remove(),$("body").append(fileViewContainer),isFile?-1!==$.inArray(extn,["xls","xlsx","sxc","ods","csv","tsv","doc","docx","sxw","odt","rtf","ppt","pptx","pps","odp","sxi"])?ZPFeedsColorBox.req=$.ajax({url:viewUrl,success:function(resp){void 0===resp.url||null===resp.url||0!==resp.url.indexOf("http")?(fileViewContainer.find("#zp_page_loading").remove(),fileViewContainer.find(".zpl_Lbx_pv").append("<div class='errmsg'><span class='red'>"+ZPI18N.getString("zp.fileviewerror")+"<a href="+downloadUrl+"> "+ZPI18N.getString("zp.Download")+".</a></span></div>")):(fileViewContainer.find(".zpl_Lbx_bdy").append("<iframe src='"+resp.url+"' id='cBoxIframe' scrolling='auto' style='border: none; margin: 0pt;' frameborder='0' height='100%' width='100%'></iframe>"),fileViewContainer.find("#zp_page_loading").remove())}}):-1!==$.inArray(extn,["pdf","html","htm","txt","java","js","xml","c","cpp","h","sh","swift","vb","json","css","svg","properties","ics"])?(fileViewContainer.find(".zpl_Lbx_bdy").append("<iframe id='cBoxIframe' src='"+viewUrl+"' class='DNI' scrolling='auto' style='border: none; margin: 0pt;' frameborder='0' height='100%' width='100%'></iframe>"),fileViewContainer.find("#cBoxIframe").on("load",function(){fileViewContainer.find("#zp_page_loading").remove(),fileViewContainer.find("#cBoxIframe").removeClass("DNI")})):(ZPFeedsColorBox.req&&4!==ZPFeedsColorBox.req.readystate&&(ZPFeedsColorBox.req.abort(),ZPFeedsColorBox.req=null),setTimeout(function(){fileViewContainer.find("#zp_page_loading").remove(),fileViewContainer.find(".zpl_Lbx_pv").append("<div class='errmsg'><span class='red'>"+ZPI18N.getString("zp.fileviewerror")+"<a href="+downloadUrl+" > "+ZPI18N.getString("zp.Download")+".</a></span></div>")},300)):($('<img src="'+$(obj).attr("href")+'" id="imgViewer" onclick="ZPFeedsColorBox.imgZoomInOut(this);" >').appendTo(".cbxImg").hide(),setTimeout(function(){fileViewContainer.find("#zp_page_loading").remove(),fileViewContainer.find("#imgViewer").fadeIn("fast")},300))},loadPrevNextObject:function(obj,isNext){isNext?ZPFeedsColorBox.viewImgsandFiles($('[rel="'+ZPFeedsColorBox.relationalId+'"]')[ZPFeedsColorBox.cBoxIdx+1]):ZPFeedsColorBox.viewImgsandFiles($('[rel="'+ZPFeedsColorBox.relationalId+'"]')[ZPFeedsColorBox.cBoxIdx-1])},closeColorBox:function(Obj){$("#feedsColorBox").fadeOut("fast"),ZPFeedsColorBox.relationalId="",ZPFeedsColorBox.cBoxIdx=0,ZPFeedsColorBox.req=null}},ReportInteg=new function(){this.saveView=function(){Layout.Page.container.find("#saveRepBtn").addClass("disabled"),setTimeout(function(){Layout.Page.container.find("#saveRepBtn").removeClass("disabled")},1e4);ReportBuilder.getXMLConfigDetails()},this.saveXMLData=function(xmlData){var searchElem=Layout.Page.container;if(""==xmlData)return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.reports.emptyView")),searchElem.find("#saveRepBtn").removeClass("disabled"),!1;var map={};"false"==searchElem.find("#isNew").val()?(map.ZPREPORTID=searchElem.find("#zpReportId").val(),map.formId=searchElem.find("#formId").val()):(map.ZPREPORTNAME=searchElem.find("#ZPREPORTNAME").val(),map.ZPREPORTTYPE=searchElem.find("#ZPREPORTTYPE").val(),map.formId=searchElem.find("#formidval option:selected").attr("value"),map.formName=searchElem.find("#formName").val()),map.ZRCONFIGXML=xmlData.data,map.ISCLONE=!1,searchElem.find("iframe").parent().hide().parent().append(ZPeople.LOADING_HTML),ZPeople.Request.send("/integrations/analytics/saveReport",map,ReportInteg.handleSaveResponse,{},ReportBuilder.handleErrorResponse)},this.handleSaveResponse=function(response){var searchElem=Layout.Page.container,responseJson=response[1];if(ReportBuilder.removeLoadingHTML(),searchElem.find("#saveRepBtn").removeClass("disabled"),searchElem.find("iframe").parent().show(),void 0==responseJson||void 0==responseJson.msg){ReportBuilder.formList.status=!0,ReportBuilder.saveReportResponse=responseJson,ReportBuilder.formList.forms[1]=responseJson.formsList,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reports.savereportsuccess"));var serviceName=ReportBuilder.getServiceName(),newHash=void 0!==serviceName&&"analytics"!==serviceName?"#reports/analytics/"+ReportBuilder.getServiceName():"#reports/analytics";window.location.href=newHash+"/listReport"}else ZPeople.Message.showFailureMsg(responseJson.msg)}},ReportBuilder=new function(){this.reportsList={},this.reportNames={status:!1,names:{}},this.formList={status:!1,forms:{}},this.createReport=function(isEdit,zpReportId,formId){var searchElem=Layout.Page.container,map={};if(isEdit)ReportBuilder.prependLoadingHTML(),map.isNew=!1,map.ZPREPORTID=zpReportId,map.formId=formId;else{if(!this.validateForm("#ZPREPORTNAME","#ZPREPORTTYPE"))return;searchElem.find("#firstStep #reportForm").hide(),ReportBuilder.prependLoadingHTML("#firstStep"),searchElem.find("#createNewRep").addClass("disabled"),map.formId=searchElem.find("#formidval option:selected").attr("value"),map.formName=searchElem.find("#formidval option:selected").attr("formName"),map.tableName=searchElem.find("#formidval option:selected").attr("tableName"),searchElem.find("#formName").val(map.formName),map.isNew=!0,map.ZPREPORTTYPE=searchElem.find("#ZPREPORTTYPE  option:selected").attr("value"),map.ZPREPORTNAME=searchElem.find("#ZPREPORTNAME").val()}searchElem.find("#saveRepBtn").addClass("disabled"),ZPeople.Request.send("/integrations/analytics/getReportsEditor",map,this.handleSaveResponse,{},ReportBuilder.handleErrorResponse)},this.getReportsList=function(obj){Layout.Page.container.find("#listTab, #noReportsDiv").css("display","none"),ReportBuilder.prependLoadingHTML();var map={};map.formId=$(obj).val(),map.serviceName="analytics"===ReportBuilder.getServiceName()?void 0:ReportBuilder.getServiceName(),ZPeople.Request.send("/integrations/analytics/getListsView",map,ReportBuilder.listReports,{},ReportBuilder.handleErrorResponse)},this.listReports=function(map,params){ReportBuilder.reportsList=map[1],map=map[1];var searchElem=Layout.Page.container;ReportBuilder.removeLoadingHTML(),searchElem.find("#listTab").html(""),isadmin||ReportBuilder.modulePerm?searchElem.find("#listTab").append('<table class="table table_fixed"><thead><tr><th width="20%" style="text-align:center">'+ZPI18N.getString("zp.reports.reportname")+'</th><th width="20%" style="text-align:center">'+ZPI18N.getString("zp.reports.formname")+'</th><th width="12%" style="text-align:center">'+ZPI18N.getString("zp.reports.reporttype")+'</th><th width="15%" style="text-align:center">'+ZPI18N.getString("zp.createdon")+'</th><th width="13%" style="text-align:center">'+ZPI18N.getString("zp.reports.createdby")+'</th><th width="5%" style="text-align:center">'+ZPI18N.getString("zp.share")+'</th><th width="15%" style="text-align:center">'+ZPI18N.getString("zp.actions")+"</th></tr></thead></table>"):searchElem.find("#listTab").append('<table class="table table_fixed"><thead><tr><th style="text-align:center">'+ZPI18N.getString("zp.reports.reportname")+'</th><th style="text-align:center">'+ZPI18N.getString("zp.reports.formname")+'</th><th width="120" style="text-align:center">'+ZPI18N.getString("zp.reports.reporttype")+'</th><th width="210"  style="text-align:center">'+ZPI18N.getString("zp.createdon")+'</th><th  style="text-align:center">'+ZPI18N.getString("zp.reports.createdby")+"</th></tr></thead></table>"),void 0!=map&&map.length>0&&(searchElem.find("#listTab").show(),searchElem.find("#createAnalyticsReport").show(),searchElem.find("#noReportsDiv").hide(),searchElem.find("#listTab table").append("<tbody>"),$.each(map,function(key,value){var conRep=[],zprepId=(value.ZRREPORTID,value.ZPREPORTID),formId=value.ZPREPORTPARENTID,isShare=value.ISREPORTSHARE,reportType=1==value.ZPREPORTTYPE?ZPI18N.getString("zp.reports.chart"):ZPI18N.getString("zp.reports.summary");("Case"!==value.TABLENAME||isadmin)&&(conRep.push("<tr class='ZPLRow' id='tr"+zprepId+"'>"),conRep.push("<td id='viewRep"+zprepId+"' class='CP ZPRName' onclick=\"ReportBuilder.viewReport('"+zprepId+"','"+formId+"');\" onmouseover='ReportBuilder.onMouseOverTitleFunction()'>"+value.ZPREPORTDISPLAYNAME+"</td>"),conRep.push("<td class='CP' onclick=\"ReportBuilder.viewReport('"+zprepId+"','"+formId+"');\" onmouseover='ReportBuilder.onMouseOverTitleFunction()'>"+value.TABLENAME+"</td>"),conRep.push("<td>"+reportType+"</td>"),conRep.push("<td onmouseover='ReportBuilder.onMouseOverTitleFunction()'>"+value.CREATEDON+"</td>"),conRep.push("<td onmouseover='ReportBuilder.onMouseOverTitleFunction()'>"+value.CREATEDBY+"</td>"),(isadmin||ReportBuilder.modulePerm)&&(conRep.push('<td><div style="text-align:Center;">'+(isShare?'<a class="CR-share" onclick=\'ReportBuilder.showShareModal("'+zprepId+'", "'+formId+'", "'+value.CUSTOMUSERLISTSHARE+"\")'></a>":"")+"</div></td>"),conRep.push('<td class="text-right P0I"><div id="action_button" class="over-display">'),conRep.push('<i class="IC-pen S14 gry FR MR8 ML8 CP" onclick=\'ReportBuilder.editReport("'+zprepId+'","'+formId+"\");'></i>"),conRep.push('<i class="IC-clone S14 gry FR MR8 ML8 CP" title="Clone" onclick=\'ReportBuilder.clonePopup("'+zprepId+'","'+formId+'","'+value.TABLENAME+'","'+value.ZPREPORTTYPE+'", "'+value.ZPREPORTDISPLAYNAME+"\");'></i>"),conRep.push('<i onclick=\'ReportBuilder.showHideConfirmDeleteButtons(this,"action_confirm_button","table-responsive ZPjobsTbl");\' class="IC-delete S14 gry FR MR8 ML8 CP"></i></div>'),conRep.push('<div style="display: none;" id="action_confirm_button" class="over-display-btn"><button onclick=\'ReportBuilder.deleteReport("'+zprepId+'");\' class="btn btn-danger btn-sm FR ML2 MR2" type="button">'+ZPI18N.getString("zp.confirm")+"</button>"),conRep.push('<button onclick=\'ReportBuilder.showHideConfirmDeleteButtons(this,"action_button","table-responsive ZPjobsTbl");\' class="btn btn-default btn-sm FR ML2 MR2" type="button">'+ZPI18N.getString("zp.cancel")+"</button></div></td>")),conRep.push("</tr>"),conRep.join(""),searchElem.find("#listTab tbody").append(conRep.join("")))}),searchElem.find("#listTab").find("table").append("</tbody>"),0==ReportBuilder.reportNames.status&&0==params.formId&&void 0===params.serviceName&&ReportBuilder.saveAllReportNamesCallback([1,map])),void 0!=map&&$.isEmptyObject(map)&&ReportBuilder.showNoReportsFound(),ReportBuilder.isInitLoad=!1},this.onMouseOverTitleFunction=function(){let elementToCheck=event.target;event.target.offsetWidth<event.target.scrollWidth&&!$(elementToCheck).attr("title")&&($(elementToCheck).addClass("tooltip-js"),$(elementToCheck).attr("title",$(event.target).text()),$(elementToCheck).attr("data-title-position","auto"),$(elementToCheck).attr("data-title-display-type","box")),elementToCheck.removeAttribute("onmouseover")},this.inprogressClone={},this.currentClone="",this.clonePopup=function(zpReportId,formId,formName,reportType,parentName){void 0!=document.querySelector("#tabquick-push-popup")&&document.querySelector("#tabquick-push-popup").remove();var popupTab=new Tab("quick-push-popup",function(){ReportBuilder.clonePopupHTML(zpReportId,reportType)},function(){ReportBuilder.cloneReport(zpReportId,formId,formName)});let popup=new popupModal(ZPI18N.getString("zp.reports.clone"),popupTab);popup.save=ZPI18N.getString("zp.save"),popup.cancel=ZPI18N.getString("zp.cancel"),ReportBuilder.currentClone=zpReportId,popup.construct(),Object.keys(ReportBuilder.inprogressClone).includes(zpReportId)?(Layout.Page.container.find("#sliderSbt").addClass("disabled"),Layout.Page.container.find("#ZPREPORTNAMEQP").addClass("disabled"),document.querySelector("#ZPREPORTNAMEQP").value=zpReportId==ReportBuilder.currentClone?ReportBuilder.inprogressClone[zpReportId]:""):(document.querySelector("#ZPREPORTNAMEQP").value=ReportBuilder.getCloneName(parentName),Layout.Page.container.find("#ZPREPORTNAMEQP").select(),Layout.Page.container.find("#ZPREPORTNAMEQP").focus())},this.clonePopupHTML=function(zpReportId,reportType){var html=`<div id="cl${zpReportId}" class="form-group" style="margin-block-start:15px;">`+'<div class="col-xs-3" style="padding:1% 1px; inline-size: 20%;"><label>'+ZPI18N.getString("zp.reports.reportname")+'</label></div><div class="col-xs-9"><input type="text" class="form-control" id="ZPREPORTNAMEQP"><input type="hidden" id="ZPREPORTTYPEQP" value="'+reportType+'" ></div></div>';Layout.Page.container.find("#cardquick-push-popup").html(html)},this.cloneReport=function(zpReportId,formId,formName){var map={};if(map.ZPREPORTID=zpReportId,map.formId=formId,!this.validateForm("#ZPREPORTNAMEQP","#ZPREPORTTYPEQP"))return;Layout.Page.container.find("#sliderSbt").addClass("disabled");let zpReportName=Layout.Page.container.find("#ZPREPORTNAMEQP").val();ReportBuilder.inprogressClone[zpReportId]=zpReportName,map.ZPREPORTNAME=zpReportName,map.ISCLONE=!0,map.formName=formName,ZPeople.Request.send("/integrations/analytics/saveReport",map,function(response){ReportBuilder.handleCloneReport(response,zpReportId)},{},ReportBuilder.handleErrorResponse)},this.getCloneName=function(formName){var zpReportName=formName+"_clone";let names=[];document.querySelectorAll(".ZPRName").forEach(value=>{names.push(value.innerHTML)});let i=1,temp=zpReportName;for(;names.includes(zpReportName);)zpReportName=temp,zpReportName+=i,i++;return zpReportName},this.handleCloneReport=function(response,zpReportId){ReportInteg.handleSaveResponse(response),ReportBuilder.listViewCallback(),zpReportId==ReportBuilder.currentClone&&void 0!==Layout.Page.container.find("#sliderSbt")&&(Layout.Page.container.find("#sliderSbt").removeClass("disabled"),Layout.Page.container.find("#sliderCancel").trigger("click")),delete ReportBuilder.inprogressClone[zpReportId]},this.getFormsList=function(id){if(0==Layout.Page.container.find("#"+id+" option").length){var map={};0==ReportBuilder.formList.status?ZPeople.Request.send("/integrations/analytics/getFormsList",map,ReportBuilder.handleFormsListResponse,id,ReportBuilder.handleErrorResponse):ReportBuilder.handleFormsListResponse(ReportBuilder.formList.forms,map,id)}},this.handleFormsListResponse=function(response,params,id){if(void 0!=response){if(response=response[1],void 0!=id&&void 0!=response){var serviceName=ReportBuilder.getServiceName(),searchElem=Layout.Page.container;$.each(response,function(key,val){return-1!=val.tableName.indexOf("P_AppraisalConfiguration")||-1!=val.tableName.indexOf("P_AppraiseeList")||-1!=val.tableName.indexOf("P_EmployeeSalary")||-1!=val.tableName.indexOf("P_Rating")||-1!=val.tableName.indexOf("P_SelfAppraisal")||-1!=val.tableName.indexOf("P_PerformanceAppraisal")||-1!=val.tableName.indexOf("P_Skills")||-1!=val.tableName.indexOf("P_UserSkillMap")||-1!=val.tableName.indexOf("P_ReviewApprovalSheet")||-1!=val.tableName.indexOf("P_GoalSheet")||-1!=val.tableName.indexOf("P_MultiRater_Approval")||-1!=val.tableName.indexOf("P_MultiRater")||-1!=val.tableName.indexOf("P_Budget")||-1!=val.tableName.indexOf("P_Budget_Splitup")||-1!=val.tableName.indexOf("P_Salary_Increment")||-1!=val.tableName.indexOf("P_Salary_Band")||-1!=val.tableName.indexOf("P_Goals")||-1!=val.tableName.indexOf("P_ExtendReview")||-1!=val.tableName.indexOf("P_PerfAppraisal")||-1!=val.tableName.indexOf("P_AttendanceForm")||-1!=val.tableName.indexOf("P_AttendanceReg")||(void 0!==serviceName&&"analytics"!==serviceName&&serviceName.toLowerCase()!==val.tabName.toLowerCase()||(void 0!==serviceName&&"analytics"!==serviceName&&serviceName.toLowerCase()==val.tabName.toLowerCase()&&-1!=val.tableName.indexOf("ATTENDANCE_SUMMARY_REPORT")&&-1!=val.tableName.indexOf("ATTENDANCE_USER_REPORT")||void searchElem.find("#"+id).append("<option value='"+val.formId+"' formName='"+val.dispName+"' tableName='"+val.tableName+"'>"+val.dispName+"</option>")))}),"formidval"==id?void 0===serviceName?searchElem.find("#formidval").val(searchElem.find("#formidval option[tableName='P_Employee']").val()).trigger("change"):searchElem.find("#formidval").val(searchElem.find("#formidval option:first").val()).trigger("change"):"reportFormsList"==id&&(searchElem.find("#reportFormsList").prepend("<option value='0'>"+ZPI18N.getString("zp.allforms")+"</option>"),searchElem.find("#reportFormsList").val("0").trigger("change"))}0==ReportBuilder.formList.status&&(ReportBuilder.formList.forms=[1,response],ReportBuilder.formList.status=!0)}},this.viewReport=function(zpReportId,formId){var hash=window.location.hash;$("#zp-contwrap-reports-"+hash.split("/")[1]+"-analytics #dashboards_list").slideUp();var serviceName=ReportBuilder.getServiceName(),newHash=void 0!==serviceName&&"analytics"!==serviceName?"#reports/analytics/"+ReportBuilder.getServiceName()+"/":"#reports/analytics/";window.location.href=newHash+"view-zprepId:"+zpReportId+"/formId:"+formId},this.editReport=function(zpReportId,formId){var serviceName=ReportBuilder.getServiceName(),newHash=void 0!==serviceName&&"analytics"!==serviceName?"#reports/analytics/"+ReportBuilder.getServiceName()+"/":"#reports/analytics/";window.location.href=newHash+"edit-zprepId:"+zpReportId+"/formId:"+formId},this.showEditReport=function(zpReportId){if((isadmin||ReportBuilder.modulePerm)&&ReportBuilder.isIntegEnabled){Layout.Page.container.find("#reportTitle").html(""),void 0===zpReportId&&(zpReportId=Layout.Page.urlparam.zprepId);var formId=Layout.Page.urlparam.formId;Layout.Page.container.find(".well").show(),Layout.Page.container.find(".Scrcont").html("").append('<div style="margin-top:-4px;"><iframe name="reportFrame" id="dbFrame" width="100%" height="100%" src=""></iframe></div>'),ReportBuilder.createReport(!0,zpReportId,formId)}},this.showReport=function(zpReportId,hasExport,hasvud){if(ReportBuilder.isIntegEnabled){var searchElem=Layout.Page.container,serviceName=ReportBuilder.getServiceName();serviceName=void 0===serviceName?"analytics":serviceName,searchElem.find("#viewReportTitle").html("");var map={};void 0===zpReportId&&(zpReportId=Layout.Page.urlparam.zprepId),map.formId=Layout.Page.urlparam.formId,map.ZPREPORTID=zpReportId,searchElem.find(".page_cont").show(),searchElem.find(".adv_cont").html("").append('<div style="margin-top:-4px;"><form id="iframeUrl" method="post" target="'+serviceName+zpReportId+'"></form><iframe id="viewDbFrame" name="'+serviceName+zpReportId+'" width="100%" height="100%" style="position:absolute;top:0;left:0;bottom:0;right:0"></iframe></div>'),ReportBuilder.prependLoadingHTML(),ZPeople.Request.send("/integrations/analytics/showReport",map,ReportBuilder.handleSaveResponse,{},ReportBuilder.handleErrorResponse)}},this.deleteReport=function(zpReportId){var map={};map.ZPREPORTID=zpReportId,ZPeople.Request.send("/integrations/analytics/deleteReport",map,this.handleSaveResponse,{},ReportBuilder.handleErrorResponse)},this.resetDeleteReportButton=function(modal){var row="#tr"+modal.data("extraDetails").repId;Layout.Page.container.find(row).find("#action_button i.IC-delete").trigger("click")},this.handleSaveResponse=function(response){var searchElem=Layout.Page.container,mode=(response=response[1]).mode;if("del"==mode){var repId=response.REPID,row="#tr"+repId;if(response.hasOwnProperty("reportSchedulers"))return ZPeople.BSModal.get({id:"reportDeleteAlert",type:3,header:ZPI18N.getString("zp.alert"),closeOnSubmit:!0,removeModalClass:"DelMdl",iconParenClass:"orgbgi",iconClass:"IC-alert",bodyClass:"dvExecutescript",buttonValue:ZPI18N.getString("zp.close"),successCallback:ReportBuilder.resetDeleteReportButton,extraDetails:{repId:repId}}),searchElem.find("#reportDeleteAlert .modal-body").html('<div class="row"><div class="col-md-12"><div id="reportDeleteAlertBody" class="dvinfo"><p>'+ZPI18N.getString("zp.reports.deleterelatedreportschedulers")+' <a href="'+reportSchedulerHash+'" rel="noreferrer" target = "_blank">'+ZPI18N.getString("zp.here")+"</a> "+ZPI18N.getString("zp.and",[" "])+ZPI18N.getString("zp.tryagain")+".</p></div></div></div>"),$.each(response.reportSchedulers,function(index,scheduleObj){searchElem.find("#reportDeleteAlertBody").append("<p>"+(index+1)+". "+scheduleObj.schedulerName+"</p>")}),searchElem.find("#reportDeleteAlert #zp_modal_blubtn").siblings().remove(),void searchElem.find("#reportDeleteAlert").modal("show");searchElem.find("#listTab "+row).remove(),0==searchElem.find("#listTab tbody tr").length&&searchElem.find("#listTab tbody").remove(),0==searchElem.find("#listTab table tbody").length&&(searchElem.find("#createAnalyticsReport").hide(),searchElem.find("#listTab").hide(),ReportBuilder.showNoReportsFound()),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reports.deletereportsuccess")),1==ReportBuilder.reportNames.status&&delete ReportBuilder.reportNames.names[repId]}else{var url=response.editorUrl;if("view"==mode)searchElem.find("#viewReportTitle").html(response.ZPREPORTNAME),(isadmin||ReportBuilder.modulePerm)&&"0"==response.showRegen?document.getElementById("analytics_regen").innerHTML='<a class="lt_btn" id="reschReps" onclick="ReportBuilder.reScheduleReport()"><span>'+ZPI18N.getString("zp.reports.regeneratereport")+"</span></a>":(isadmin||ReportBuilder.modulePerm)&&"1"==response.showRegen?document.getElementById("analytics_regen").innerHTML='<a class="lt_btn disabled" id="" onclick=""><span>'+ZPI18N.getString("zp.reports.regeneratedreport")+"</span></a>":document.getElementById("analytics_regen").innerHTML="",ReportBuilder.makePostCallForViewReport(url),searchElem.find("#reschReps").removeClass("disabled");else{var isNew=response.isNew;searchElem.find("#dbFrame")[0].style.height=$(window).height()-181+"px",isNew?(ReportBuilder.prependLoadingHTML("#secondStep"),searchElem.find("#resultDiv").css("display","block"),searchElem.find("#add_reportDiv").css("display","none"),searchElem.find("#reportTitle").html(response.ZPREPORTNAME)):(searchElem.find("#reportTitle").append("<span>"+response.ZPREPORTNAME+'</span><span id="editReportTitle"><i class="IC-pen gry zpedt MT3"></i></span>'),searchElem.find("#editReportTitle").off("click").on("click",function(){ReportBuilder.getFormsList(),ReportBuilder.saveAllReportNames(),searchElem.find("#newReportTitle").val(searchElem.find("#reportTitle span")[0].innerText),searchElem.find("#showTitleDiv").css("display","none"),searchElem.find("#editTitleDiv").css("display","block")}),searchElem.find("#renameCancel").off("click").on("click",function(){searchElem.find("#showTitleDiv").css("display","block"),searchElem.find("#editTitleDiv").css("display","none"),searchElem.find("#newReportTitle").val("")}),searchElem.find("#renameSubmit").off("click").on("click",function(){ReportBuilder.renameReport()})),searchElem.find("#dbFrame").attr("src",url),isNew||(searchElem.find("#zpReportName").val(response.ZPREPORTNAME),searchElem.find("#reportType").val(response.ZPREPORTTYPE),searchElem.find("#formId").val(response.ZPREPORTPARENTID),searchElem.find("#zpReportId").val(response.ZPREPORTID)),searchElem.find("#isNew").val(response.isNew)}searchElem.find("iframe").one("load",function(){ReportBuilder.removeLoadingHTML(),searchElem.find("#saveRepBtn").removeClass("disabled")})}},this.makePostCallForViewReport=function(url){var baseUrl=url.split("?")[0]+"?",queryStringParams=url.split("?")[1].split("&"),criteriaString="";for(var index in queryStringParams){var queryStringParam=queryStringParams[index];if(void 0!=queryStringParam&&""!=queryStringParam&&-1==queryStringParam.indexOf("ZOHO_CRITERIA")&&-1==queryStringParam.indexOf("CRITERIA"))baseUrl=baseUrl+queryStringParam+"&";else if(void 0!=queryStringParam&&(-1!=queryStringParam.indexOf("ZOHO_CRITERIA")||-1!=queryStringParam.indexOf("CRITERIA"))){var criteriaParam=-1!=queryStringParam.indexOf("ZOHO_CRITERIA")?"ZOHO_CRITERIA":"CRITERIA";criteriaString=queryStringParam}}baseUrl=baseUrl.substring(0,baseUrl.length-1),Layout.Page.container.find("#iframeUrl").html(""),Layout.Page.container.find("#iframeUrl").attr("action",baseUrl),""!=criteriaString&&Layout.Page.container.find("#iframeUrl").append("<input type='hidden' name='"+criteriaParam+"' id='"+criteriaParam+"' value='"+criteriaString.substring(criteriaString.indexOf("=")+1)+"'/>"),Layout.Page.container.find("#iframeUrl").trigger("submit")},this.showShareModal=function(zpRepId,formId,customReportShare){ReportBuilder.constructModalOutline();var map={};map.ZPREPORTID=zpRepId,map.formId=formId,map.CUSTOMUSERLISTSHARE=customReportShare,ZPeople.Request.send("/integrations/analytics/getReportSharedDetails",map,ReportBuilder.fillModalData,{},ReportBuilder.handleErrorResponse)},this.hideShareModal=function(zpRepId,formId,mode){var searchElem=Layout.Page.container;searchElem.find("#shareRepModal").modal("hide"),searchElem.find("#shareRepModal #shareModalTitle").text("").siblings("div").remove(),searchElem.find("#shareRepModal .modal-body").html(""),searchElem.find("#shareRepModal .modal-footer").addClass("DN"),searchElem.find("#shareRepBtn").addClass("disabled")},this.showEditShareModal=function(){var searchElem=Layout.Page.container;searchElem.find("#shareRepModal #shareModalTitle").siblings("div").remove(),searchElem.find("#shareRepModal .modal-body").html("").append(ZPeople.LOADING_HTML);var response=ReportBuilder.response[1][0];ReportBuilder.constructEditModal(response)},this.constructModalOutline=function(){if(0==Layout.Page.container.find("#shareRepModal").length){var modal='<div class="modal popRgtModel" id="shareRepModal" data-keyboard="false"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h6 class="addPopTitle FL" id="shareModalTitle"></h6><button aria-label="Close" data-dismiss="modal" class="close" type="button" onclick="ReportBuilder.hideShareModal()"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div><div class="modal-body"></div><div class="modal-footer text-left DN"><div class="label-message PPAltmsg label-note"><div class="MB10"><b>Notes:</b></div> <p><span>1.</span>'+ZPI18N.getString("zp.reports.shareNote1")+" </p><p><span>2.</span>"+ZPI18N.getString("zp.reports.shareNote2")+" </p> <p><span>3.</span>"+ZPI18N.getString("zp.reports.shareNote3")+"</p> <p><span>4.</span>"+ZPI18N.getString("zp.reports.shareNote4")+'</p></div><button class="btn btn-primary btn-md MR10 disabled" type="button" id="shareRepBtn" onclick="ReportBuilder.sendReqToShareRep()">'+ZPI18N.getString("zp.submit")+'</button><button class="btn btn-default btn-md" type="button" data-dismiss="modal" onclick="ReportBuilder.hideShareModal()">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div></div>";Layout.Page.container.append(modal)}Layout.Page.container.find("#shareRepModal").modal("show").find(".modal-body").html(ZPeople.LOADING_HTML)},this.fillModalData=function(response){Layout.Page.container;(response=(response=response[1])[0]).RPEMPLST||response.RPDEPLST||response.RPROLELST||response.RPLOCLST?ReportBuilder.constructViewModal(response):ReportBuilder.constructEditModal(response)},this.constructViewModal=function(response){var searchElem=Layout.Page.container;searchElem.find("#shareRepModal").find(".modal-body").append('<form role="form" class="form-horizontal pad  ZPviw DN"><div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.reports.reportname")+'</label><div class="col-sm-6 PT5" id="sharedRepName"></div></div><div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.owner")+'</label><div class="col-sm-6 PT5" id="sharedRepOwner"></div></div><div class="form-group OP4"><div class="col-sm-offset-3 col-sm-6"><div class="checkbox DIB MBI5"><input id="exportReport" type="checkbox"><span>'+ZPI18N.getString("zp.reports.exportdata")+'</span></div></div></div><div class="form-group OP4"><div class="col-sm-offset-3 col-sm-6"><div class="checkbox DIB MBI5"><input id="viewReportUD" type="checkbox" onclick="ReportBuilder.checkVUD(this)"><span>'+ZPI18N.getString("zp.reports.viewunderlyingdata")+'</span></div></div></div><div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.reports.viewsharetitle")+'</label><div class="col-sm-6"><div class="input-group DBI"><div class="form-control input-lbltags" id="viewTags"></div></div></div></div></form>'),searchElem.find("#shareModalTitle").text(ZPI18N.getString("zp.reports.viewsharetitle")),searchElem.find("#shareModalTitle").after('<div class="FR MR25 MT5"><span class="FL MR10"><i class="IC-pen S18 gry CP" onclick="ReportBuilder.showEditShareModal()"></i></span></div><div class="clearfix"></div>'),searchElem.find("#sharedRepName").text(response.ZPREPORTDISPLAYNAME),searchElem.find("#sharedRepOwner").text(response.OWNERNAME),searchElem.find("#exportReport").prop("checked",response.HASEXPORT),searchElem.find("#viewReportUD").prop("checked",response.HASVUD),ReportBuilder.fillViewModeTags(response),ReportBuilder.response=[1,[response]],searchElem.find("#zp_page_loading").remove(),searchElem.find(".modal").find("form").removeClass("DN")},this.constructEditModal=function(response){var searchElem=Layout.Page.container;searchElem.find("#shareRepModal").find(".modal-body").append('<form role="form" class="form-horizontal pad DN"><div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.reports.reportname")+'</label><div class="col-sm-6 PT5" id="shareRepName"></div></div><div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.owner")+'</label><div class="col-sm-6 PT5" id="shareRepOwner"></div></div><div class="form-group"><div class="col-sm-offset-3 col-sm-6"><label class="checkbox DIB MBI5"><input id="exportReport" type="checkbox"><span>'+ZPI18N.getString("zp.reports.exportdata")+'</span></label></div></div><div class="form-group"><div class="col-sm-offset-3 col-sm-6"><label class="checkbox DIB MBI5"><input id="viewReportUD" type="checkbox" onclick="ReportBuilder.checkVUD(this)"><span>'+ZPI18N.getString("zp.reports.viewunderlyingdata")+'</span></label></div></div><div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.reports.addeditsharetitle")+'</label><div class="col-sm-6"><div id="shareTo"></div></div></div></form>'),searchElem.find("#shareModalTitle").text(ZPI18N.getString("zp.reports.addeditsharetitle")),searchElem.find("#shareRepName").text(response.ZPREPORTDISPLAYNAME),searchElem.find("#shareRepOwner").text(response.OWNERNAME),searchElem.find("#exportReport").prop("checked",response.HASEXPORT),searchElem.find("#viewReportUD").prop("checked",response.HASVUD),searchElem.find("#shareRepModal").find(".modal-footer").removeClass("DN"),searchElem.find("#shareRepBtn").removeClass("disabled"),void 0==response.usersLst||null==response.usersLst?searchElem.find("#shareTo").append(ZPPickList.initComponent([ZPPickList.CONSTANTS.USERS,ZPPickList.CONSTANTS.DEPARTMENTS,ZPPickList.CONSTANTS.ROLES,ZPPickList.CONSTANTS.LOCATIONS],!1)):searchElem.find("#shareTo").append(ZPPickList.initComponent([ZPPickList.CONSTANTS.USERS],!1,void 0,void 0,response.usersLst)),searchElem.find("#pickListComp").find("div.dropdown-menu").addClass("ZPSchPoP"),ReportBuilder.fillOptionsEditMode(response),ReportBuilder.response=[1,[response]],searchElem.find("#zp_page_loading").remove(),searchElem.find(".modal").find("form").removeClass("DN")},this.checkVUD=function(data){data.checked&&(data.checked=!1,FrameworkCommon.showDeleteAlert(ZPI18N.getString("zp.reports.viewunderlyingdata"),ZPI18N.getString("zp.reports.vudconfirmmessage"),{callback:()=>{data.checked=!0}}))},this.fillViewModeTags=function(data){var lists=[data.RPEMPLST,data.RPDEPLST,data.RPROLELST,data.RPLOCLST],tagNames=[ZPI18N.getString("zp.users"),ZPI18N.getString("zp.departments"),ZPI18N.getString("zp.roles"),ZPI18N.getString("zp.locations")],tags="";$.each(lists,function(key,value){if(void 0!=value){var list=value,labels="";$.each(list,function(innerKey,innerValue){labels+='<span class="label label-primary FL MR5">'+innerValue.name+"</span>"}),tags+='<div class="appltagh"><p data-target="#'+key+'Labels" data-toggle="collapse"><i class="S12 IC-mini" onclick=\'$(this).toggleClass("IC-mini IC-expnd")\'></i>'+tagNames[key]+'</p><div class="clearfix"></div></div><div class="cust-labelTags MT3 panel-collapse collapse in" id="'+key+'Labels">'+labels+'<span class="clearfix"></span></div>'}}),Layout.Page.container.find("#viewTags").append(tags)},this.fillOptionsEditMode=function(data){var idList=ReportBuilder.getIdsFromList(data.RPEMPLST);ZPPickList.setSelectedUsers(idList);idList=ReportBuilder.getIdsFromList(data.RPDEPLST);ZPPickList.setSelectedDepartments(idList);idList=ReportBuilder.getIdsFromList(data.RPROLELST);ZPPickList.setSelectedRoles(idList);idList=ReportBuilder.getIdsFromList(data.RPLOCLST);ZPPickList.setSelectedLocations(idList)},this.getIdsFromList=function(list){if(void 0!=list){var idList=[];return $.each(list,function(key,value){idList.push(value.id)}),idList}return[]},this.sendReqToShareRep=function(){Layout.Page.container.find("#shareRepBtn").addClass("disabled");var shareTo={users:ZPPickList.getSelectedUsers(),depts:ZPPickList.getSelectedDepartments(),roles:ZPPickList.getSelectedRoles(),locs:ZPPickList.getSelectedLocations()},map={};map.shareList=JSON.stringify(shareTo),map.ZPREPORTID=ReportBuilder.response[1][0].ZPREPORTID,map.HASEXPORT=Layout.Page.container.find("#exportReport").prop("checked"),map.HASVUD=Layout.Page.container.find("#viewReportUD").prop("checked"),ZPeople.Request.send("/integrations/analytics/shareReportToUsers",map,ReportBuilder.handleShareReportResponse,{},ReportBuilder.handleErrorResponse)},this.handleShareReportResponse=function(response){Layout.Page.container;void 0!=(response=response[1])&&"success"==response.status&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reports.sharereportsuccess")),ReportBuilder.hideShareModal())},this.renameReport=function(){var searchElem=Layout.Page.container,oldRepName=searchElem.find("#reportTitle span")[0].innerText,newRepName=searchElem.find("#newReportTitle").val();if(oldRepName==newRepName)return searchElem.find("#newReportTitle").trigger("focus"),void ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.reports.reportnamenotchanged"));if(0!=ReportBuilder.validateForm("#newReportTitle")&&oldRepName!=newRepName){var map={};map.ZPREPORTNAME=newRepName,map.formId=searchElem.find("#formId").val(),map.ZPREPORTID=searchElem.find("#zpReportId").val(),ZPeople.Request.send("/integrations/analytics/renameReport",map,this.handleRenameReport,{},ReportBuilder.handleErrorResponse)}},this.handleRenameReport=function(response){response=response[1];var searchElem=Layout.Page.container;searchElem.find("#reportTitle").find("span")[0].innerHTML=response.ZPREPORTNAME,searchElem.find("#showTitleDiv").css("display","block"),searchElem.find("#editTitleDiv").css("display","none"),searchElem.find("#newReportTitle").val(""),1==$("#reports-list").length&&($("#viewRep"+response.ZPREPORTID)[0].innerHTML=response.ZPREPORTNAME),1==ReportBuilder.reportNames.status&&(ReportBuilder.reportNames.names[response.ZPREPORTID]=response.ZPREPORTNAME),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reports.renamereportsuccess"))},this.prependLoadingHTML=function(id){void 0!=id?Layout.Page.container.find(".Scrcont"+id).prepend(ZPeople.LOADING_HTML):Layout.Page.container.find(".Scrcont").prepend(ZPeople.LOADING_HTML)},this.removeLoadingHTML=function(){Layout.Page.container.find(".Scrcont").find("#zp_page_loading").remove()},this.getXMLConfigDetails=function(){Layout.Page.container.find("#dbFrame")[0].contentWindow.postMessage("xmlConfig","*")},this.showHideConfirmDeleteButtons=function(obj,toggleId,divClass){var searchElem=Layout.Page.container;searchElem.find("."+divClass).css("overflow-x","hidden"),$(obj).parent().toggle("drop",{direction:"right"},200,function(){$(obj).parent().siblings("#"+toggleId).toggle("drop",200),searchElem.find("."+divClass).css("overflow-x","")})},this.validateForm=function(nameId,typeId){var searchElem=Layout.Page.container;if(searchElem.find(nameId).val().length>85)return searchElem.find(nameId).trigger("focus"),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.reports.reportnamelimit")),!1;if(""==searchElem.find(nameId).val())return searchElem.find(nameId).trigger("focus"),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.reports.reportnameempty")),!1;if(null!=typeId&&0==searchElem.find(typeId).val())return ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.reports.selectreporttype")),!1;var status=!0,newRepName=searchElem.find(nameId).val().toLowerCase().trim(),formNames=ReportBuilder.formList.forms[1];return $.each(formNames,function(key,value){if(newRepName==value.zrTableName.toLowerCase().trim())return searchElem.find(nameId).trigger("focus"),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.reports.repnamesameasformname")),status=!1,!1}),1==ReportBuilder.reportNames.status&&$.each(ReportBuilder.reportNames.names,function(repId,repName){if(newRepName==repName.toLowerCase().trim())return searchElem.find(nameId).trigger("focus"),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.reports.repnameexists")),status=!1,!1}),status},this.getBackPageForAnalytics=function(){window.location.hash;var searchElem=Layout.Page.container;-1!==window.location.href.indexOf("#reports/create")||-1!==window.location.href.indexOf("#analytics/create")||-1!==window.location.href.indexOf("/analytics/create")?0==searchElem.find("#add_reportDiv").length||"block"==searchElem.find("#add_reportDiv").css("display")?window.location.href=window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/list":ReportBuilder.resetCreateReportIframePage():-1===window.location.href.indexOf("#reports/view")&&-1===window.location.href.indexOf("#analytics/view")&&-1===window.location.href.indexOf("#reports/edit")&&-1===window.location.href.indexOf("#analytics/edit")&&-1===window.location.href.indexOf("/analytics/edit")&&-1===window.location.href.indexOf("/analytics/view")||(window.location.hash.substring(0,window.location.hash.lastIndexOf("/")).indexOf("-")>-1?window.location.href=window.location.hash.substring(0,window.location.hash.lastIndexOf("-")).substring(0,window.location.hash.substring(0,window.location.hash.lastIndexOf("-")).lastIndexOf("/"))+"/list":window.location.href=window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/list")},this.getBackPage=function(){window.location.hash;var searchElem=Layout.Page.container,serviceName=ReportBuilder.getServiceName(),subUrl=void 0!==serviceName&&"analytics"!==serviceName?"#reports/analytics/"+ReportBuilder.getServiceName():"#reports/analytics";-1!==window.location.href.indexOf(subUrl+"/createReport")?0==searchElem.find("#add_reportDiv").length||"block"==searchElem.find("#add_reportDiv").css("display")?window.location.href=window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/listReport":ReportBuilder.resetCreateReportIframePage():-1===window.location.href.indexOf(subUrl+"/view")&&-1===window.location.href.indexOf(subUrl+"/edit")||(window.location.hash.substring(0,window.location.hash.lastIndexOf("/")).indexOf("-")>-1?window.location.href=window.location.hash.substring(0,window.location.hash.lastIndexOf("-")).substring(0,window.location.hash.substring(0,window.location.hash.lastIndexOf("-")).lastIndexOf("/"))+"/listReport":window.location.href=window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/listReport")},this.showNoReportsFound=function(){var searchElem=Layout.Page.container,buttonHtml=isadmin||ReportBuilder.modulePerm?'<button class="lt_btn primary" onclick="ReportBuilder.setHashForCreateReport()">'+ZPI18N.getString("zp.reports.createreport")+"</button>":void 0;searchElem.find("#noReportsDiv").show().html(ZPUtil.newNoDataHTML("CR-nodata-rpt",8,ZPI18N.getString("zp.reports.noreportscreated"),void 0,void 0,buttonHtml))},this.regenerateReport=function(){var map={};map.formId=window.location.hash.split("/")[2].split(":")[1],ZPeople.Request.send("/integrations/analytics/regenerateReport",map,this.regenerateReportResponse,{},ReportBuilder.handleErrorResponse)},this.reScheduleReport=function(){var map={};window.location.hash.split("/").forEach(function(hash){let params=hash.split(":");"formId"==params[0]?map.formId=params[1]:"view-zprepId"==params[0]&&(map.ZPREPORTID=params[1])}),document.getElementById("analytics_regen").innerHTML='<a class="lt_btn disabled" id="" onclick=""><span>'+ZPI18N.getString("zp.reports.regeneratedreport")+"</span></a>",ZPeople.Request.send("/integrations/analytics/regenReports",map,this.regenerateReportResponse,{},ReportBuilder.handleErrorResponse)},this.regenerateReportResponse=function(response){response=response[1],ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reports.reschedulesuccess"))},this.saveAllReportNames=function(){if(0==ReportBuilder.reportNames.status){var map={formId:0};ZPeople.Request.send("/integrations/analytics/getListsView",map,ReportBuilder.saveAllReportNamesCallback)}},this.saveAllReportNamesCallback=function(response){1==response[0]&&void 0!=(response=response[1])&&($.each(response,function(key,value){ReportBuilder.reportNames.names[value.ZPREPORTID]=value.ZPREPORTDISPLAYNAME}),ReportBuilder.reportNames.status=!0)},this.showRequestError=function(result,params,otherDetails){var searchElem=Layout.Page.container;searchElem.find("#zp_page_loading").remove(),searchElem.find("#firstStep #reportForm").css("display","block"),searchElem.find("#createNewRep").removeClass("disabled"),ZPeople.Message.showFailureMsg(result.responseJSON.error)},this.handleErrorResponse=function(result,params,otherDetails){var searchElem=Layout.Page.container;if(void 0!=result.responseJSON[0]&&1!=result.responseJSON[0]&&void 0!=result.responseJSON[1].msg){ReportBuilder.removeLoadingHTML(),ZPeople.Message.showFailureMsg(result.responseJSON[1].msg);var responseStatus=result.responseJSON[1].errorCode;7546==responseStatus?($("#page-wrapper").removeClass(),searchElem.find(".well").hide(),searchElem.find(".Scrcont").html(ZPUtil.newNoDataHTML("CR-noperm",5,ZPI18N.getString("zp.reports.reportsintegdisabled"),void 0,"noPermissionSvg"))):7547==responseStatus?($("#page-wrapper").removeClass(),searchElem.find(".well").hide(),searchElem.find(".Scrcont").html(ZPUtil.newNoDataHTML("CR-noperm",5,ZPI18N.getString("zp.reports.nopermission"),void 0,"noPermissionSvg"))):7548==responseStatus?($("#page-wrapper").removeClass("Abar1"),searchElem.find(".well.ZPAct").hide(),searchElem.find(".Scrcont").html(ZPUtil.newNoDataHTML("CR-noperm",5,ZPI18N.getString("zp.reports.reportscountexceeded",[ZPeople.peopleSupportEmail]),void 0,"noPermissionSvg"))):7549==responseStatus?searchElem.find(".Scrcont").html(ZPUtil.newNoDataHTML("CR-noperm",5,ZPI18N.getString("zp.reports.nodatainview"),void 0,"noPermissionSvg")):7550==responseStatus&&($("#page-wrapper").removeClass(),searchElem.find(".well").hide(),searchElem.find(".Scrcont").html(ZPUtil.newNoDataHTML("CR-noperm",5,ZPI18N.getString("zp.reports.reportdoesnotexist"),void 0,"noPermissionSvg")))}else void 0!=result.responseJSON.error&&(ReportBuilder.removeLoadingHTML(),ZPeople.Message.showFailureMsg(result.responseJSON.error));var repPageName=ReportBuilder.getReportsPageName();"create"===repPageName&&"none"!=searchElem.find("#add_reportDiv").css("display")?(searchElem.find("#firstStep #reportForm").show(),searchElem.find("#createNewRep").removeClass("disabled")):("create"===repPageName&&"none"!=searchElem.find("resultDiv").css("display")||"edit"===repPageName)&&(searchElem.find("iframe").parent().show(),searchElem.find("#saveRepBtn").removeClass("disabled"))},this.listViewCallback=function(){var searchElem=Layout.Page.container;if(!isOldReports){var hash=ReportBuilder.getServiceName();$("#zp-contwrap-reports-analytics"+(void 0!==hash&&"analytics"!==hash?"-"+hash:"")+" #"+hash).addClass("sel").siblings().removeClass("sel"),void 0!==hash&&"analytics"!==hash||$("#zp-contwrap-reports-analytics #analytics").addClass("sel").siblings().removeClass("sel")}if(void 0!=ReportBuilder.saveReportResponse&&""!=ReportBuilder.saveReportResponse){searchElem.find("#createAnalyticsReport").show();var newRow,responseJson=ReportBuilder.saveReportResponse,mode=responseJson.mode,selFormId=searchElem.find("#reportFormsList").select2("data")[0].id,reportType=1==responseJson.ZPREPORTTYPE?ZPI18N.getString("zp.reports.chart"):ZPI18N.getString("zp.reports.summary");if(newRow="<tr class='ZPLRow' id='tr"+responseJson.ZPREPORTID+"'><td id='viewRep"+responseJson.ZPREPORTID+"' class='CP ZPRName' onclick=\"ReportBuilder.viewReport('"+responseJson.ZPREPORTID+"','"+responseJson.ZPREPORTPARENTID+"');\"> onmouseover='ReportBuilder.onMouseOverTitleFunction()'"+responseJson.ZPREPORTNAME+"</td><td class='CP' onclick=\"ReportBuilder.viewReport('"+responseJson.ZPREPORTID+"','"+responseJson.ZPREPORTPARENTID+"');\" onmouseover='ReportBuilder.onMouseOverTitleFunction()'>"+responseJson.FORMNAME+"</td><td>"+reportType+"</td><td onmouseover='ReportBuilder.onMouseOverTitleFunction()'>"+responseJson.CREATEDON+"</td><td onmouseover='ReportBuilder.onMouseOverTitleFunction()'>"+responseJson.CREATEDBY+"</td>"+(responseJson.ISREPORTSHARE?'<td><div style="text-align:Center;"><a class="CR-share" data-toggle="modal" onclick=\'ReportBuilder.showShareModal("'+responseJson.ZPREPORTID+'", "'+responseJson.ZPREPORTPARENTID+'", "'+responseJson.CUSTOMUSERLISTSHARE+"\")'></a></div></td>":"<td><div></div></td>")+'<td class="text-right P0I"><div id="action_button" class="over-display"><i class="IC-pen S14 gry FR MR8 ML8 CP" onclick=\'ReportBuilder.editReport("'+responseJson.ZPREPORTID+'","'+responseJson.ZPREPORTPARENTID+'","'+responseJson.CUSTOMUSERLISTSHARE+'");\'></i><i class="IC-clone S14 gry FR MR8 ML8 CP" title="Clone" onclick=\'ReportBuilder.clonePopup("'+responseJson.ZPREPORTID+'","'+responseJson.ZPREPORTPARENTID+'","'+responseJson.FORMNAME+'","'+responseJson.ZPREPORTTYPE+'","'+responseJson.ZPREPORTNAME+'");\'></i><i onclick=\'ReportBuilder.showHideConfirmDeleteButtons(this,"action_confirm_button","table-responsive ZPjobsTbl");\' class="IC-delete S14 gry FR MR8 ML8 CP"></i></div><div style="display: none;" id="action_confirm_button" class="over-display-btn"><button onclick=\'ReportBuilder.deleteReport("'+responseJson.ZPREPORTID+'");\' class="btn btn-danger btn-sm FR ML2 MR2" type="button">'+ZPI18N.getString("zp.confirm")+'</button><button onclick=\'ReportBuilder.showHideConfirmDeleteButtons(this,"action_button","table-responsive ZPjobsTbl");\' class="btn btn-default btn-sm FR ML2 MR2" type="button">'+ZPI18N.getString("zp.cancel")+"</button></div></td></tr>","edit"==mode||selFormId!=responseJson.ZPREPORTPARENTID&&0!=selFormId||("block"==searchElem.find("#noReportsDiv").css("display")&&(searchElem.find("#noReportsDiv").hide(),searchElem.find("#listTab").show()),0==searchElem.find("tbody tr").length?(newtbody="<tbody>"+newRow+"</tbody>",searchElem.find("table").append(newtbody)):searchElem.find("tbody").prepend(newRow)),"#analytics/list"!==window.location.hash&&$("#analytics-list.main-wrp").length>0){var anMainTab=$("#analytics-list.main-wrp");selFormId=anMainTab.find("#reportFormsList").select2("data").id,"edit"==mode||selFormId!=responseJson.ZPREPORTPARENTID&&0!=selFormId||("block"==anMainTab.find("#noReportsDiv").css("display")&&(anMainTab.find("#noReportsDiv").hide(),anMainTab.find("#listTab").show()),0==anMainTab.find("tbody tr").length?(newtbody="<tbody>"+newRow+"</tbody>",anMainTab.find("table").append(newtbody)):anMainTab.find("tbody").prepend(newRow))}"edit"!=mode&&1==ReportBuilder.reportNames.status&&(ReportBuilder.reportNames.names[responseJson.ZPREPORTID]=responseJson.ZPREPORTNAME),ReportBuilder.saveReportResponse=""}!ReportBuilder.isInitLoad&&ReportBuilder.reportNames.status&&($.each(searchElem.find("tbody tr"),function(index,rowObj){var repId=rowObj.id.substr(2);void 0===ReportBuilder.reportNames.names[repId]&&searchElem.find(rowObj).remove(),searchElem.find("#"+rowObj.id+" td:first").html()!==ReportBuilder.reportNames.names[repId]&&searchElem.find("#"+rowObj.id+" td:first").html(ReportBuilder.reportNames.names[repId])}),0==searchElem.find("tbody tr").length&&ReportBuilder.showNoReportsFound())},this.resetCreateReportFormPage=function(){ZPLite.Reports.Analytics.initAnalytics(),Layout.Page.container.find("#ZPREPORTTYPE, #formidval").select2(),ReportBuilder.getFormsList("formidval"),ReportBuilder.saveAllReportNames();var searchElem=Layout.Page.container;searchElem.find("#ZPREPORTNAME").val(""),searchElem.find("#ZPREPORTTYPE").val("0").select2(),document.querySelectorAll("#advAnalytics span.select2[style]").forEach(dom=>{dom.removeAttribute("style")}),void 0===ReportBuilder.getServiceName()?searchElem.find("#formidval").val(searchElem.find("#formidval option[tableName='P_Employee']").val()).trigger("change"):searchElem.find("#formidval").val(searchElem.find("#formidval option:first").val()).trigger("change")},this.resetCreateReportIframePage=function(){var searchElem=Layout.Page.container;searchElem.find("#reportTitle").text(""),searchElem.find("#dbFrame").attr("src",""),searchElem.find("#createNewRep").removeClass("disabled"),searchElem.find("#firstStep #reportForm").show(),searchElem.find("#add_reportDiv").css("display","block"),searchElem.find("#resultDiv").css("display","none")},this.resetCreateReportPage=function(){ReportBuilder.resetCreateReportFormPage(),ReportBuilder.resetCreateReportIframePage()},this.getServiceName=function(){var hashFirstPart=window.location.hash.split("/")[2];if(Layout.UrlConf.SERVICE_MODULE.indexOf(hashFirstPart)||"organization"===hashFirstPart||"timetracker"===hashFirstPart||"hrcase"===hashFirstPart||"attendance"===hashFirstPart||"task"===hashFirstPart||"leavetracker"===hashFirstPart||"lms"===hashFirstPart)return void 0===hashFirstPart||"listReport"!==hashFirstPart&&"createReport"!==hashFirstPart&&"view"!==hashFirstPart.slice(0,4)&&"edit"!==hashFirstPart.slice(0,4)?hashFirstPart:"analytics"},this.getServiceNameForAnalytics=function(){var hashFirstPart=window.location.hash.split("/")[0].substring(1);if(Layout.UrlConf.isServiceMode||"organization"===hashFirstPart||"timetracker"===hashFirstPart||"hrcase"===hashFirstPart||"attendance"===hashFirstPart||"task"===hashFirstPart||"leavetracker"===hashFirstPart||"lms"===hashFirstPart)return hashFirstPart},this.setHashForCreateReport=function(){window.location.href=window.location.hash.substring(0,window.location.hash.lastIndexOf("/"))+"/createReport"},this.getReportsPageName=function(){return-1!=window.location.href.indexOf("#reports/create")||-1!=window.location.href.indexOf("#analytics/create")||-1!=window.location.href.indexOf("/analytics/create")?"create":-1!=window.location.href.indexOf("#reports/edit")||-1!=window.location.href.indexOf("#analytics/edit")||-1!=window.location.href.indexOf("/analytics/edit")?"edit":void 0},this.changeAnalyticsDatabaseOwner=function(){ZPeople.BSModal.confirm(ReportBuilder.changeAnalyticsOwner,ZPI18N.getString("zp.confim"),ZPI18N.getString("zp.reports.confirmanalyticsdatabaseownerchange"),ZPI18N.getString("zp.confirm"),null,ZPI18N.getString("zp.cancel"))},this.changeAnalyticsOwner=function(){ZPeople.Request.send("/integrations/analytics/changeAnalyticsDatabaseOwner",{},ReportBuilder.changeAnalyticsOwnerResponse)},this.changeAnalyticsOwnerResponse=function(response,params){var message,code=null;$.each(response,function(index,categoriesObj){code=categoriesObj.code,message=categoriesObj.message}),6918===code?ZPeople.Message.showSuccessMsg(message):6917===code?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.reports.scheduleaddedalready")):6916===code?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reports.analyticsdbownerchangesuccessfulnotificationmailcontent")):6915===code?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.reports.erroroccuredwhilechanginganalyticsdbowner")):void 0!==response.message?ZPeople.Message.showFailureMsg(response.message):void 0!==message?ZPeople.Message.showFailureMsg(message):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},this.getReportsSearchList=function(map,response){(map={formId:"0"}).serviceName="analytics"===ReportBuilder.getServiceName()?void 0:ReportBuilder.getServiceName(),ZPeople.Request.send("/integrations/analytics/getListsView",map,function(map,params){ReportBuilder.reportsSearchList=map[1]})},this.search=function(thisObj,event){if(27!==event.keyCode&&40!==event.keyCode&&38!==event.keyCode){var subTabs=[];8===event.keyCode?(ReportBuilder.getReportsSearchList(),subTabs=ReportBuilder.reportsSearchList):subTabs=ReportBuilder.reportsList;var value=$(thisObj).val(),subResults=[],searchResults=[];searchResults.push("");var lists=[];if(lists.push(""),lists.push(subTabs),ZPSetupCommon.isEmpty(value)){var map={formId:"0"};map.serviceName="analytics"===ReportBuilder.getServiceName()?void 0:ReportBuilder.getServiceName(),ZPeople.Request.send("/integrations/analytics/getListsView",map,ReportBuilder.listReports,{},ReportBuilder.handleErrorResponse)}else{var valueUpperCase=value.toUpperCase();$.each(subTabs,function(index,tabs){tabs.ZPREPORTDISPLAYNAME.toUpperCase().indexOf(valueUpperCase)>-1&&subResults.push(tabs)}),searchResults.push(subResults),ReportBuilder.listReports(searchResults)}}},this.executeAdAnSearch=function(thisObj,event,isAnalytics){if(27!==event.keyCode&&40!==event.keyCode&&38!==event.keyCode){var searchObj,subTabs=[];if(ZPLite.Reports.Analytics.isDbCustomize)subTabs=ZPLite.Reports.reportsJSON.advanalytics.modules,searchObj=$("#dvRecipient");else if(ZPLite.Reports.reportsJSON.advanalytics&&!isAnalytics)subTabs=ZPLite.Reports.reportsJSON.advanalytics.modules,searchObj=$("#dashboards_list_ad");else{subTabs=ReportBuilder.reportsList;var service="analytics"===window.location.hash.split("/")[1]?"":window.location.hash.split("/")[1]+"-";searchObj=$("#"+("zp-contwrap-reports-"+service+"analytics")+" #dashboards_list")}var value=$(thisObj).val(),searchHtml={sub:[]},customHtml="",srchRes="";if(ZPSetupCommon.isEmpty(value)&&ZPLite.Reports.Analytics.isDbCustomize)return;if(ZPSetupCommon.isEmpty(value))searchObj.slideUp();else{var valueUpperCase=value.toUpperCase();if($.each(subTabs,function(index,tabs){if(isAnalytics){var dispName=tabs.ZPREPORTDISPLAYNAME,zprepId=tabs.ZPREPORTID,formId=tabs.ZPREPORTPARENTID,dispNameUppercase=dispName.toUpperCase();new RegExp("("+value+")","gi");if(dispNameUppercase.indexOf(valueUpperCase)>-1){var srchidx=dispNameUppercase.indexOf(valueUpperCase);searchHtml.sub.push({rep:"<p><a onclick='ReportBuilder.viewReport(\""+zprepId+'", "'+formId+"\");'>"+dispName+"</p>",srchidx:srchidx})}}else{dispNameUppercase=(dispName=tabs.displayName).toUpperCase(),new RegExp("("+value+")","gi");tabs.hasOwnProperty("formArr")&&tabs.formArr.length>0&&!isAnalytics&&$.each(tabs.formArr,function(cnt,subTabsObj){var srchidx,subTabDispName=subTabsObj.displayName,subTabURL=subTabsObj.zrRepId,id=ZPLite.Reports.convertSlashTo_(subTabURL),subTabDispNameUpperCase=subTabDispName.toUpperCase();if((subTabDispNameUpperCase.indexOf(valueUpperCase)>-1||dispNameUppercase.indexOf(valueUpperCase)>-1)&&subTabDispNameUpperCase.indexOf(valueUpperCase)>-1){var url=reportsIntegUrl+"/ZDBDataSheetView.cc?OBJID="+subTabURL;if(srchidx=subTabDispNameUpperCase.indexOf(valueUpperCase),searchHtml.sub.push({rep:'<p><a onclick="ZPLite.Reports.List.loadAdvAnalytics(this)" href="'+url+'" target="advAnFrame" name="'+ZSEC.Encoder.encodeForHTMLAttribute(subTabsObj.displayName)+'">'+ZSEC.Encoder.encodeForHTML(subTabsObj.displayName)+"</p>",srchidx:srchidx}),ZPLite.Reports.Analytics.isDbCustomize){id=subTabsObj.displayName.replace(/ /g,"_");customHtml+='<li class="list-group-item " id="'+id+'" onclick ="ReportBuilder.handleSelectButton(this)"><span>"'+ZSEC.Encoder.encodeForHTML(subTabsObj.displayName)+'"</span> </li>'}}})}}),ZPLite.Reports.Analytics.isDbCustomize)return void searchObj.html(customHtml);0==searchHtml.sub.length?srchRes='<div> <h5 class="noData">'+ZPI18N.getString("zp.noresults")+"</h5> </div>":(searchHtml.sub.sort(function(i,j){return i.srchidx-j.srchidx}),$.each(searchHtml.sub,function(i,j){srchRes+=j.rep}),srchRes="<div>"+srchRes+"</div>"),searchObj.html(srchRes),searchObj.slideDown()}}},this.addDashboards=function(thisObj){var popoverHtml="";return 0==$(".popover-content").length?(ZPLite.Reports.Analytics.isDbCustomize=!0,popoverHtml+='<div class="tabvertical tabselect"><div class="dvPopsearch shwchk"><div class="inputsearch"><input class="form-control" type="search" placeholder="Search dashboards" onkeyup="ReportBuilder.executeAdAnSearch(this,event, false)"></div></div><div class="rhttablst"><ul class="list-group ulRecipient MT5" role="tablist" id="dvRecipient">',$.each(ZPLite.Reports.List.module,function(index,dashboardObj){id=ZSEC.Encoder.encodeForHTMLAttribute(dashboardObj.displayName.replace(/ /g,"_")),"adminPins"===thisObj.id&&dashboardObj.isAdminPin||"myPins"===thisObj.id&&dashboardObj.isMyPin?popoverHtml+='<li class="list-group-item sel" id="'+id+`" onclick ="ReportBuilder.handleSelectButton(this)"><span>${ZSEC.Encoder.encodeForHTML(dashboardObj.displayName)}</span> </li>`:popoverHtml+='<li class="list-group-item" id="'+id+`" onclick ="ReportBuilder.handleSelectButton(this)"><span>${ZSEC.Encoder.encodeForHTML(dashboardObj.displayName)}</span> </li>`}),ZPLite.Reports.List.isVisible=!0,popoverHtml+="</ul>",popoverHtml+='</div><div class="popover-footer text-right"><a class="btn btn-default" style="margin-right: 3px;">Close</a><a id ="saveBtn" onclick=\'ReportBuilder.savePinnedDashboards(this, "'+thisObj.id+'");\' class="btn btn-primary">Save</a></div></div> </div></div>'):$("#"+thisObj.id).popover("hide"),popoverHtml},this.collapsibleFunc=function(thisObj){$(thisObj).parents().eq(1).hasClass("open")?$($(thisObj).parents().eq(1)).removeClass("open"):$($(thisObj).parents().eq(1)).addClass("open")},this.handleSelectButton=function(thisObj){$(thisObj).hasClass("sel")?$(thisObj).removeClass("sel"):$(thisObj).addClass("sel")},this.getPinnedDashboards=function(isAdminPin){var pinnedDashboardsArr=[];return $(".list-group-item").each(function(ind){var pinnedDashboardsObj={};dbId=ZPLite.Reports.List.module[ind].dbId,pinnedDashboardsObj.id=ZPLite.Reports.List.module[ind].zrRepId,pinnedDashboardsObj.isPinned=$($(".list-group-item")[ind]).hasClass("sel"),pinnedDashboardsObj.isAdminPin=isAdminPin,pinnedDashboardsArr.push(pinnedDashboardsObj)}),pinnedDashboardsArr},this.savePinnedDashboards=function(thisObj,id){$("#saveBtn").addClass("disabled");var isAdminPin="adminPins"==id,currDiv=isAdminPin?"adminsDiv":"myDiv",params={pinnedDashboards:JSON.stringify(ReportBuilder.getPinnedDashboards(isAdminPin))};ZPeople.Request.send("/integrations/advAnalytics/savePinnedDashboards",params,function(response){if(void 0!==response&&1===response[0]){ZPLite.Reports.List.module=response[1],$("#saveBtn").removeClass("disabled"),$("#"+id).popover("hide");var bodyHtml=ZPLite.Reports.Analytics.populateDashboards(id);let currentElement=document.getElementById(currDiv),nextSibling=currentElement.nextSibling;for(;nextSibling&&"head"!==nextSibling.className;)nextSibling.parentNode.removeChild(nextSibling),nextSibling=currentElement.nextElementSibling;currentElement.insertAdjacentHTML("afterend",bodyHtml)}})}};const EnterEventKeyCode=13,EscEventKeyCode=27;var ZPSearch={};(ZPSearch={KEY:null,backUrl:"",timeOutId:void 0,init:()=>{$("#zpeople_search_box").on("keyup",ZPSearch.keyUpOnSearchBox),$("#zpeople_search_box").on("focus",function(){$("body").addClass("zpl_searchsw"),0===$("#searchdiv").find("#zp_ziasearch").length&&$("#zpeople_search_box").after("<span class='zpl_gseracr' id ='zp_ziasearch' onclick='ZPSearch.ziaSearch()'><span> "+ZPI18N.getString("zp.ziasearch")+"</span><i class='PI_redirect'></i></span>"),0===$("body").find(".zp-backdrop").length&&$("body").append("<div class='zp-backdrop'></div>"),ZPSearch.animateSearchBox(!0)}),$("#zpeople_search_box").on("click",function(){$("body").hasClass("zpl_searchsw")||($("body").addClass("zpl_searchsw"),0===$("#searchdiv").find("#zp_ziasearch").length&&$("#zpeople_search_box").after("<span class='zpl_gseracr' id ='zp_ziasearch' onclick='ZPSearch.ziaSearch()'><span> "+ZPI18N.getString("zp.ziasearch")+"</span><i class='PI_redirect'></i></span>"))}),$("#zpeople_search_icon").on("click",function(){$("#zpeople_search").removeClass("DN"),document.getElementById("zpeople_search_box").click(),document.getElementById("zpeople_search_box").focus()}),$("#zpeople_search_box").on("blur",ZPSearch.blurOnSearchBox),$(document).on("keyup",ZPSearch.keyUpOnDocument),$("#zpeople_search").on("click",function(event){var Obj=$(event.target);"gblsearchFld"!=Obj.attr("id")&&"zpeople_search_box"!==Obj.attr("id")&&"zpeople_search_icon"!==Obj.attr("id")&&0===Obj.parents("#zpeople_search_list").length&&"zp_search_dtlclose"!==Obj.attr("id")&&0===Obj.parents("#zp_search_dtlclose").length&&"zpeople_search_icon"!=Obj.parent().attr("id")&&ZPSearch.closeSearch(Obj)})},blurOnSearchBox:function(){""===$(this).val()&&(ZPSearch.removeSearchPopUp(),$("#zpeople_search_list").remove())},keyUpOnSearchBox:function(event){clearTimeout(ZPSearch.timeOutId),ZPSearch.removeSearchPopUp(),""===$(this).val()&&$("#zpeople_search_list").remove(),ZPSearch.timeOutId=setTimeout(function(){ZPSearch.show(event,"#zpeople_search_box")},500)},escKeyUpEvent:function(event){ZPSearch.animateSearchBox(!1),$("#zpeople_search_box").val(""),$("body").removeClass("zpl_searchsw"),ZPSearch.removeZIAIcon(),$("body").find(".zp-backdrop").remove()},keyUpOnDocument:function(event){27===event.keyCode&&($("#zpeople_search").find(".zppop-srcnt").find("#zp_search_dtlcard").length>0?ZPSearch.removeSearchPopUp():ZPSearch.escKeyUpEvent(event))},closeSearch:function(Obj){ZPSearch.animateSearchBox(!1),$("body").removeClass("zpl_searchsw"),ZPSearch.removeZIAIcon(),$("body").find(".zp-backdrop").remove(),!Obj||"zpeople_search_pico"!==Obj.attr("id")&&"zp_search_close"!==Obj.attr("id")||($("#zpeople_search_box").val(""),$("#zpeople_search_list").remove()),showNewTab&&$("#zpeople_search").addClass("DN")},animateSearchBox:isfocus=>{!0===isfocus?""!==$("#zpeople_search_box").val()&&setTimeout(function(){$("#zpeople_search_list").removeClass("DNI")},380):$("#zpeople_search_list").addClass("DNI")},removeSearchPopUp:()=>{let searchList=$("#zpeople_search #zpeople_search_list");searchList.removeClass("zpl_act"),searchList.find("#zpsearch_more").removeClass("zpl_morshrink"),setTimeout(function(){searchList.find("#zp_search_dtlcard").remove()},100)},ziaSearch:()=>{null!=ZPSearch.KEY?zgssearch.search(ZPSearch.KEY):zgssearch.search()},removeZIAIcon:()=>{$("#searchdiv").find(".zpSrAcr").remove()},show:(event,input)=>{var key=$(input).val();if(ZPUtil.Validation.isEmpty(key))ZPSearch.KEY=null;else{var searchTerm=encodeURIComponent(key);if(ZPSearch.KEY!=searchTerm&&(ZPSearch.KEY=searchTerm),13===event.keyCode)return $("#zpeople_search_box").trigger("blur"),$(document).trigger("click"),ZPSearch.Page.setSearchTab(),-1==window.location.hash.indexOf("home/search")&&-1==window.location.hash.indexOf("home/user/")&&(ZPSearch.backUrl=window.location.hash),void(window.location.href="#home/search-searchStr:"+ZPSearch.KEY);key.length>=2&&ZPSearch.sendSearchReq()}},sendSearchReq:()=>{ZPeople.Request.send("/v5/search/employee",{mode:"USER_SEARCH",searchStr:ZPSearch.KEY,isQuickSearch:"true"},ZPSearch.construct)},construct:(data,params)=>{if(ZPSearch.KEY==params.searchStr){var isAllowed=!0;if((void 0!==Layout.Page.urlparam.searchStr&&Layout.Page.urlparam.searchStr===ZPSearch.KEY||ZPUtil.Validation.isEmpty($("#zpeople_search_box").val()))&&(isAllowed=!1,$("#zpeople_search_list").is(":visible")&&$("#zpeople_search_list").addClass("DNI")),void 0!==data.result&&data.result.length>0&&isAllowed&&$("body").hasClass("zpl_searchsw")){var searchUl=$("#zpeople_search_list");0===searchUl.length&&(searchUl=$('<div class="zpl_gserchlst" id="zpeople_search_list"><div id="zpsearch_actions" class="zpl_actn_btn"></div><div class="zpl_emcnt"><div class="zpl_glbsrc"></div></div></div>'),$("#zpeople_search").find("#searchdiv").append(searchUl));var listHtml='<div class="zpl_emlst">';searchUl.removeClass("DNI"),$.each(data.result,function(){var attStatus="";if(this.leaveAttStat){var leaveAttStat=ZPeople.decodeTxt(this.leaveAttStat),colourClass=Attendance.setClassToShowStatus(this.colourCode);Attendance.isLeaveAvail(this.colourCode)&&(leaveAttStat=this.leaveAttStat),attStatus='<em class="zpl_dots sm"></em><span id="zp_attinout" class="'+colourClass+'">'+leaveAttStat+"</span>"}listHtml+='<div class="zpl_em" id="'+this.eno+'"><div class="zpl_emimg"><img src="'+this.photo+'"></div><div class="zpl_emdts"><div><em>'+this.eid+'</em> - <b class="zpl_ellipsis">'+this.name+"</b>"+attStatus+'</div><div class="zpl_gserchdept"><span class="zpl_depart"><i class="PI_dept"></i><em id="dept_name" class="zpl_ellipsis">'+(ZPUtil.Validation.isEmpty(this.dpname)?"":this.dpname)+"</em></span>"+(ZPUtil.Validation.isEmpty(this.mobile)?"":'<span><i class="PI_phone"></i><em>'+this.mobile+"</em></span>")+(ZPUtil.Validation.isEmpty(this.extn)?"":' <span><i class="PI_frm_phone"></i><em>'+this.extn+"</em></span>")+"</div></div></div>"}),listHtml+="</div>",searchUl.find(".zpl_glbsrc").html(listHtml),$("#zpeople_search").find("#zpeople_search_list").find(".zppop-seme.text-center").remove(),data.result.length>9&&(searchUl.find(".zpl_glbsrc").append('<a class="zpl_gseemore" id="zpsearch_more">'+ZPI18N.getString("zp.seemore")+"</a>"),searchUl.find("#zpsearch_more").on("click",function(){$(document).trigger("click"),window.location.href="#home/search-searchStr:"+ZPSearch.KEY})),$("#zpeople_search_list").removeClass("DNI"),ZPUnifieduiUtil.isLoadedInOneZohoIFrame&&($("#zpeople_search_list").css("visibility","visible"),$("#zpeople_search_list").css("top",ZPUnifieduiUtil.getSearchPositionObj().top),$("#zpeople_search_list").css("left",ZPUnifieduiUtil.getSearchPositionObj().left),$("#zpeople_search_list").css("width",ZPUnifieduiUtil.getSearchPositionObj().width),$("#zpeople_search_list").css("z-index","1101")),$(searchUl).find(".zpl_glbsrc").find("div.zpl_em").on("click",function(){ZPSearch.getEmpDtl($(this).attr("id"))})}else $("#zpeople_search_list").addClass("DNI"),$("#zpeople_search_list").find(".zppop-srbox").html("")}},getEmpDtl:id=>{let cardList=$("#zpeople_search #zpeople_search_list"),actionBtncont=cardList.find("#zpsearch_actions"),usercard=cardList.find("#zp_search_dtlcard");actionBtncont.empty(),actionBtncont.html('<a data-title-position="right" title="'+ZPI18N.getString("zp.close")+'" class="_cls PI_cls" id="zp_search_dtlclose"></a>'),actionBtncont.find("#zp_search_dtlclose").on("click",function(){ZPSearch.removeSearchPopUp()}),0===usercard.length?(usercard=$('<div class="zpl_gpopprivw" id="zp_search_dtlcard" empid="loader"><div class="Lodcont"> <div class="ctable"> <div class="ctcell"> <div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div> </div> </div> </div> </div>'),$("#zpeople_search .zpl_glbsrc").after(usercard)):usercard.html('<div class="Lodcont"> <div class="ctable"> <div class="ctcell"> <div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div> </div> </div> </div> '),cardList.addClass("zpl_act"),cardList.find("#zpsearch_more").addClass("zpl_morshrink"),0!==usercard.length&&usercard.attr("id")==id||ZPeople.Request.send("/userprofile/ssAction",{userId:id,MODE:"GET_SEARCH_EMPDETAILS_BYID"},ZPSearch.showEmpDtlCard)},showEmpDtlCard:(empDtl,params)=>{if(1==empDtl.success){empDtl=empDtl.empDtl;ZPeople.currentSearchName=empDtl.name;var searchUl=$("#zpeople_search");if(searchUl.find(".zppop-srcnt").find("#zp_search_dtlcard").attr("empid")!=params.userId){let actionBtncont=searchUl.find("#zpsearch_actions");if(empDtl.zuid&&empDtl.zuid!==_LOGGEDIN_ZUID&&"true"==ZPeople.ISCHAT&&actionBtncont.append($('<a title="'+ZPI18N.getString("zp.chatsettings.chat")+'" id="zpsearchchat" data-title-position="right" class="zpl_btnfloat PI_cliq" onclick="ZPeople.initUserChat(event,\''+empDtl.zuid+'\')"></a><a title="'+ZPI18N.getString("zp.chatsettings.audiocall")+'" onclick="ZPeople.initUserAudioCall(event,\''+empDtl.zuid+'\')" data-title-position="right" class="zpl_btnfloat PI_frm_phone"></a><a title="'+ZPI18N.getString("zp.chatsettings.videocall")+'" data-title-position="right" onclick="ZPeople.initUserVideoCall(event,\''+empDtl.zuid+'\')" class="zpl_btnfloat PI_video1"></a>')),empDtl.zuid!==_LOGGEDIN_ZUID&&void 0!==empDtl.isFav&&actionBtncont.append($('<a empid="'+empDtl.erecno+'" data-title-position="right" class="zpl_btnfloat PI_star_line '+(empDtl.isFav?"org":"")+'" title="'+(empDtl.isFav?ZPI18N.getString("zp.unmarkfromfavorites"):ZPI18N.getString("zp.markasfavorite"))+'" id="zpsearch_setasfav"></a>')),!ZPUtil.Validation.isEmpty(empDtl.tags)){empDtl.tags=empDtl.tags.split(",");for(var tags='<div class="zpl_privwtag" id="zppop_tag"><h6>'+ZPI18N.getString("zp.tags")+"</h6>",i=0;i<empDtl.tags.length;i++)tags+='<div class="zpl_tg"><span>'+empDtl.tags[i]+"</span></div>";tags+="</div>",empDtl.tags=tags}searchUl.find(".zpl_glbsrc").find("#zp_search_dtlcard").attr("empid",empDtl.empid);var attStatus="";let isYetToCheckin=!1;if(empDtl.leaveAttStat){isYetToCheckin=empDtl.leaveAttStat==ZPI18N.getString("zp.yetToCheckIn");var leaveAttStat=ZPeople.decodeTxt(empDtl.leaveAttStat),colourClass=Attendance.setClassToShowStatus(empDtl.colourCode);Attendance.isLeaveAvail(empDtl.colourCode)&&(leaveAttStat=empDtl.leaveAttStat),attStatus='<div class="zpl_flex-center zpl_w-100"><span class="'+colourClass+' zpl_nowrap">'+leaveAttStat+"</span>",void 0!=empDtl.checkInBuilding&&""!=empDtl.checkInBuilding&&(attStatus+='<em class="zpl_dots"></em><div class="'+colourClass+' zpl_ellipsis zpl_flexgap2">',attStatus+='<i class="PI_building '+colourClass+' tooltip-js" title="'+empDtl.checkInBuilding+'"></i>',attStatus+='<span class="zpl_ellipsis" title="'+empDtl.checkInBuilding+'">'+empDtl.checkInBuilding+"</span></div>"),attStatus+="</div>"}let dtlObj=$('<div><div class="zpl_gpopprivw_box"><div class="zpl_privwem"><div class="zpl_em"><div class="zpl_emimg"><img  src="'+(ZPUtil.Validation.isEmpty(empDtl.photo)?ZPeople.getDefaultUserImagePath():empDtl.photo)+'"></div><div class="zpl_emdts"><div class="CP zpl_privwname"><em>'+empDtl.empid+'</em> - <b clickAttr="username">'+empDtl.name+"</b></div><div><em>"+(empDtl.desiName?empDtl.desiName+" - ":"")+"</em>"+(ZPUtil.Validation.isEmpty(empDtl.deptName)?"":'<a class="zpl_privwdept" clickAttr="dept_name" deptId="'+empDtl.deptId+'">'+empDtl.deptName+"</a>")+"</div><div>"+(ZPUtil.Validation.isEmpty(empDtl.email)?"":'<a href="mailto:'+empDtl.email+'">'+empDtl.email+"</a>")+"</div>"+attStatus+ZPSearch.getPredictAttHtml(empDtl,isYetToCheckin)+'</div></div><div class="zpl_gpopprivwtab"><div class="zpl_gpopprivw_actband"><div><ul class="zpl_tabpane"><li class="zpl_act"><a id="zpprofileTab" >'+ZPI18N.getString("zp.profile")+'</a></li><li class=""><a id="zporgTab" >'+ZPI18N.getString("zp.orgstructure")+'</a></li></ul></div></div><div class="zpl_tabcnt" id="tabheader"><div  id="zpprofileDiv" class=""><div class="zpl_privwlocatn"><ul class="zpl_privwlocatn_lst">'+(ZPUtil.Validation.isEmpty(empDtl.extn)?"":'<li><i class="PI_work_mob"><i class="path1"></i><i class="path2"></i></i>'+empDtl.extn+"</li>")+(ZPUtil.Validation.isEmpty(empDtl.mobile)?"":'<li><i class="PI_mobile"><i class="path1"></i><i class="path2"></i></i>'+empDtl.mobile+"</li>")+'<li><i class="PI_seat_loca"><i class="path1"></i><i class="path2"></i></i>'+(ZPUtil.Validation.isEmpty(empDtl.workLoc)?"-":empDtl.workLoc)+'</li><li><i class="PI_work_loca"><i class="path1"></i><i class="path2"></i></i>'+(ZPUtil.Validation.isEmpty(empDtl.location)?"-":empDtl.location)+'</li><li><i class="PI_shift"><i class="path1"></i><i class="path2"></i></i>'+(ZPUtil.Validation.isEmpty(empDtl.shiftName)?"-":empDtl.shiftName+` (${empDtl.startTime} - ${empDtl.endTime})`)+'</li><li><i class="PI_time"><i class="path1"></i><i class="path2"></i></i>'+(ZPUtil.Validation.isEmpty(empDtl.timezone)?"-":empDtl.timezone)+'</li><li><i class="PI_work_mob"><i class="path1"></i><i class="path2"></i></i>'+(ZPUtil.Validation.isEmpty(empDtl.workPhone)?"-":empDtl.workPhone)+'</li></ul></div></div></div></div></div></div><div class="zpl_gpopprivw_btn"><button class="view_profile zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.viewprofile")+"</button></div></div>");dtlObj.find(".zpl_emimg").on("click",function(){$("body").removeClass("zpl_searchsw")});let dtlsCont=dtlObj.find(".zpl_gpopprivw_box");void 0!==empDtl.reportingto&&dtlsCont.append($('<div class="zpl_privwreport"><h6>'+ZPI18N.getString("zp.reportingto")+'</h6><div class="zpl_em"><div class="zpl_emimg"><img src="'+(ZPUtil.Validation.isEmpty(empDtl.reportingto.photo)?ZPeople.getDefaultUserImagePath():empDtl.reportingto.photo)+'"></div><div class="zpl_emdts zpl_ellipsis"><div class="CP zpl_privwname"><span empId='+empDtl.reportingto.erecno+' class="mentor">'+empDtl.reportingto.empid+" - <b>"+empDtl.reportingto.name+"</b></span></div>"+(ZPUtil.Validation.isEmpty(empDtl.reportingto.desiName)?"":'<div class="zpl_ellipsis"><em>'+empDtl.reportingto.desiName+"</em></div>")+"</div></div></div>")),void 0!==empDtl.secondaryRepoTo&&dtlsCont.append($('<div class="zpl_privwreport"><h6>'+(void 0==ZPeople.secondaryReportToDispName||""==ZPeople.secondaryReportToDispName.trim()?ZPI18N.getString("zp.SecondLevelReportingto"):ZPeople.secondaryReportToDispName)+'</h6><div class="zpl_em"><div class="zpl_emimg"><img src="'+(ZPUtil.Validation.isEmpty(empDtl.secondaryRepoTo.photo)?ZPeople.getDefaultUserImagePath():empDtl.secondaryRepoTo.photo)+'"></div><div class="zpl_emdts zpl_ellipsis"><div class="CP zpl_privwname"><span empId='+empDtl.secondaryRepoTo.erecno+' class="mentor">'+empDtl.secondaryRepoTo.empid+" - <b>"+empDtl.secondaryRepoTo.name+"</b></span></div>"+(ZPUtil.Validation.isEmpty(empDtl.secondaryRepoTo.desiName)?"":'<div class="zpl_ellipsis"><em>'+empDtl.secondaryRepoTo.desiName+"</em></div>")+"</div></div></div>")),ZPUtil.Validation.isEmpty(empDtl.tags)||dtlsCont.append(empDtl.tags),actionBtncont.find("[id='zpsearch_setasfav']").on("click",ZPSearch.setAsFav),dtlObj.find("[clickAttr='dept_name']").on("click",function(){let depId=$(this).attr("deptId");ZPUtil.Validation.isEmpty(depId)||($("body").removeClass("zpl_searchsw"),ZPSearch.removeSearchPopUp(),window.location.href="#home/organization/departmentdirectory-deptId:"+$(this).attr("deptId"))}),dtlObj.find(".view_profile,.zpl_emimg").on("click",function(){ZPSearch.removeSearchPopUp(),$("body").removeClass("zpl_searchsw"),ZPeople.getUserPage(""+empDtl.erecno)}),dtlObj.find("span.mentor").on("click",function(event){var empId=$(event.currentTarget).attr("empId");$("body").removeClass("zpl_searchsw"),ZPSearch.removeSearchPopUp(),ZPeople.getUserPage(empId)}),dtlObj.find("[clickAttr='username']").on("click",function(event){ZPSearch.removeSearchPopUp(),$("body").removeClass("zpl_searchsw"),ZPSearch.setSearchedUserProfile(empDtl)}),empDtl.isOrgStructureEnabled&&(dtlObj.find("#zporgTab").on("click",function(){ZPSearch.showOrgStructureData(empDtl,!1)}),dtlObj.find("#zpprofileTab").on("click",function(){ZPSearch.showOrgStructureData()})),searchUl.find(".zpl_emcnt .zpl_gpopprivw").html(dtlObj),empDtl.isOrgStructureEnabled?ZPSearch.showOrgStructureData(empDtl,!0):searchUl.find("#zporgTab").parent().hide()}}},getPredictAttHtml:(empDetails,isYetToCheckin)=>{let html="";if(empDetails.attpredictions){var predictTime=isYetToCheckin?empDetails.attpredictions.intime:empDetails.attpredictions.outtime;predictTime&&(html='<div class="zpl_chknprdict"><i class="PI_prediction"></i>',html+="<span>"+(isYetToCheckin?ZPI18N.getString("zp.predict.att.predict.checkIn"):ZPI18N.getString("zp.predict.att.predict.checkOut"))+" "+predictTime+"</span></div>")}return html},showOrgStructureData:(empDetails,isOnload)=>{var searchUl=$("#zpeople_search");if(void 0!=empDetails)if(isOnload){var orgstructureHtml='<div id="zporgDiv" class="DN"><ul class="zpl_privworg">',isValuePresent=!1,elementName=empDetails.leName;if(void 0!=elementName){var elementDispName=ZPI18N.getString("zp.addlegalentity");ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")&&(elementDispName=ZPeople.orgStructureDispNameMap.entity),orgstructureHtml+='<li><span class="PI_compname zpl_icnbx icn zpl_seclr10" id = '+empDetails.leId+"></span><em>"+elementDispName+'</em><span class="txttrim" title="'+elementName+'">'+elementName+"</span></li>",isValuePresent=!0}if(void 0!=(elementName=empDetails.buName)){elementDispName=ZPI18N.getString("zp.addbusinessunit");ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")&&(elementDispName=ZPeople.orgStructureDispNameMap.unit),orgstructureHtml+='<li><span class="PI_bnsunit zpl_icnbx icn zpl_seclr4" id = '+empDetails.buId+"></span><em>"+elementDispName+'</em><span class="txttrim" title="'+elementName+'">'+elementName+"</span></li>",isValuePresent=!0}if(void 0!=(elementName=empDetails.divName)){elementDispName=ZPI18N.getString("zp.adddivision");ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(elementDispName=ZPeople.orgStructureDispNameMap.division),orgstructureHtml+='<li><span class="PI_division zpl_icnbx icn zpl_seclr6" id = '+empDetails.divId+"></span><em>"+elementDispName+'</em><span class="txttrim" title="'+elementName+'">'+elementName+"</span></li>",isValuePresent=!0}if(void 0!=(elementName=empDetails.deptName)){elementDispName=ZPI18N.getString("zp.department");ZPeople.orgStructureDispNameMap.hasOwnProperty("department")&&(elementDispName=ZPeople.orgStructureDispNameMap.department),orgstructureHtml+='<li><span class="PI_dept zpl_icnbx icn zpl_seclr3" id = '+empDetails.deptId+"></span><em>"+elementDispName+'</em><span class="txttrim" title="'+elementName+'">'+elementName+"</span></li>",isValuePresent=!0}orgstructureHtml+="</ul></div>",isValuePresent?$(searchUl).find("#tabheader").append(orgstructureHtml):searchUl.find("#zporgTab").parent().hide()}else $(searchUl).find("#zpprofileDiv").addClass("DN"),$(searchUl).find("#zppop_tag").addClass("DN"),$(searchUl).find("#zpprofileTab").parent().removeClass("zpl_act"),$(searchUl).find("#zporgTab").parent().addClass("zpl_act"),$(searchUl).find("#zporgDiv").removeClass("DN");else $(searchUl).find("#zpprofileDiv").removeClass("DN"),$(searchUl).find("#zppop_tag").removeClass("DN"),$(searchUl).find("#zpprofileTab").parent().addClass("zpl_act"),$(searchUl).find("#zporgTab").parent().removeClass("zpl_act"),$(searchUl).find("#zporgDiv").addClass("DN")},setAsFav:event=>{let Obj=$(event.target);Obj.css({"pointer-events":"none","background-color":"var(--thmgrybg3)"});var userid=Obj.attr("empid"),params={};let isfav=!1;var title,successMsg;$(Obj).hasClass("org")?(params.mode="removemyFavorites",isfav=!0):params.mode="markasFav",params.erecnos=userid,ZPeople.Request.send("/favouriteaction.zp",params,function(data,param){!!data[0].isFav?($(Obj).addClass("org"),successMsg="zp.addedasfavoritemsgsuccess",title=ZPI18N.getString("zp.unmarkfromfavorites")):($(Obj).removeClass("org"),successMsg="zp.removedfromfavoritemsgsuccess",title=ZPI18N.getString("zp.markasfavorite")),$(Obj).attr("title",title),ZPeople.Message.showSuccessMsg(ZPI18N.getString(successMsg)),Obj.removeAttr("style")},void 0,()=>{ZPeople.Message.failure(ZPI18N.getString(isfav?"zp.lms.unabletoremovefromfavourites":"zp.lms.unabletoaddtofavourites")),Obj.removeAttr("style")})},setSearchedUserProfile:userData=>{ZPeople.currentSearchName=ZPeople.decodeTxt(userData.name);var erecNo=userData.eno?userData.eno:userData.erecno;ZPeople.getUserPage(erecNo)}}).Page={isInit:!1,show:()=>{if(ZPSearch.Page.setSearchTab(),!ZPSearch.Page.isInit){let container=$(ZPSearch.Component.PageWrap);ZPSearch.Page.container=container,Layout.Page.container.html(ZPSearch.Page.container);let wrap=ZPSearch.Page.container.find(".inner_main");wrap.append(ZPSearch.Component.pageFilterCOntainer(Layout.Page.pageId)),wrap.append(ZPSearch.Component.listContainer),ZPSearch.Page.isInit=!0,ZPeople.FireScroll.init(ZPSearch.Page.getUserList)}if(ZPSearch.Page.searchStr!=Layout.Page.urlparam.searchStr?(ZPSearch.Page.isNeedRefresh=!0,ZPSearch.Page.reloadFilter=!0):"true"==Layout.Page.urlparam.isFilterSearch&&(ZPSearch.Page.isNeedRefresh=!0,ZPSearch.Page.reloadFilter=!1),ZPSearch.Filter.creatBreadCrumb(Layout.Page.urlparam),ZPSearch.Page.isNeedRefresh){ZPSearch.Page.isNeedRefresh=!1;let listContainer=ZPSearch.Page.container.find("#userlist_cont");listContainer.empty(),listContainer.parent().addClass("zpl_Emptydata"),listContainer.append(ZPeople.LOADING_HTML),ZPSearch.Page.startInd=0,ZPSearch.Page.getUserList(ZPSearch.Page.reloadFilter)}else"#home/search"==window.location.hash&&(ZPSearch.Filter.setNodata(!0,!0),$("#zpeople_search_box").val(""),$("#zpeople_search_icon").click());ZPSearch.Page.searchStr=Layout.Page.urlparam.searchStr},getUserList:isInit=>{ZPeople.FireScroll.getFireScrollPropertie().triggered=!0,0==ZPSearch.Page.container.find("#zp_page_loading").length&&$(ZPeople.LOADING_HTML).insertAfter(ZPSearch.Page.container.find(".zpsearch_contwrap"));var params={};isInit&&(params.isInit=!0),0!=ZPSearch.Page.startInd&&(params.start=ZPSearch.Page.startInd),params.start>=50&&(params.ismore=!0),(params=ZPSearch.Page.UserSearchCallback(params)).mode="USER_SEARCH",ZPeople.Request.send("/v5/search/employee",params,ZPSearch.Page.construct)},construct:(data,param)=>{let pageContainer=ZPSearch.Page.container;pageContainer.find("#zp_page_loading").remove(),void 0==param.start&&(void 0==data.totalCount||0==data.totalCount?pageContainer.find("span#searchResultCount").empty():pageContainer.find("span#searchResultCount").html("<b>"+data.totalCount+" </b>  <label>"+ZPI18N.getString("zp.employeesFound")+" </label> "));let option=[];param.ismore&&data.refineSearchDtls&&data.refineSearchDtls.depList&&(option=data.refineSearchDtls.depList,ZPSearch.Filter.addFilterOption(option,"user_search_department")),param.ismore&&data.refineSearchDtls&&data.refineSearchDtls.designList&&(option=data.refineSearchDtls.designList,ZPSearch.Filter.addFilterOption(option,"user_search_designation"));let listContainer=pageContainer.find("#userlist_cont");ZPSearch.Page.startInd=data.nxtsrt,listContainer.parent().removeClass("zpl_Emptydata"),"#home/search"==window.location.hash?(ZPSearch.Filter.setNodata(!0,!0),$("#zpeople_search_box").val(""),$("#zpeople_search_icon").click(),ZPSearch.Filter.setValueForFilter(),pageContainer.find("span#searchResultCount").empty()):param.ismore||"NO_DATA"!==data.message&&void 0!==data.result&&0!=data.result.length?(ZPSearch.Page.container.find(".fltr_icn").removeClass("DNI"),param.ismore||ZPSearch.Filter.createFilter(data),ZPSearch.Filter.setValueForFilter(),$.each(data.result,function(ind,info){let usercard=UserWidget.Components.getUserCard(info,ZPSearch.setSearchedUserProfile,void 0,info,"status",data.isFavoriteAllowed);listContainer.append(usercard);var userNameContainer=usercard.find(".user_dtls");0!=userNameContainer.length&&(userNameContainer[0].scrollWidth>userNameContainer[0].clientWidth||userNameContainer[0].scrollHeight>userNameContainer[0].clientHeight)&&userNameContainer.attr("title",info.name);var des=usercard.find(".desname");0!=des.length&&(des[0].scrollWidth>des[0].clientWidth||des[0].scrollHeight>des[0].clientHeight)&&des.attr("title",info.desname);var dep=usercard.find(".depname");0!=dep.length&&(dep[0].scrollWidth>dep[0].clientWidth||dep[0].scrollHeight>dep[0].clientHeight)&&dep.attr("title",info.dpname),dep.on("click",function(){window.location.href="#home/organization/departmentdirectory-deptId:"+$(this).attr("deptId")});var mailid=usercard.find(".epmail");0!=mailid.length&&(mailid[0].scrollWidth>mailid[0].clientWidth||mailid[0].scrollHeight>mailid[0].clientHeight)&&mailid.attr("title",info.email)})):(ZPSearch.Filter.setNodata(param.isInit),ZPSearch.Filter.setValueForFilter()),data.nxtsrt?ZPeople.FireScroll.getFireScrollPropertie().triggered=!1:ZPeople.FireScroll.getFireScrollPropertie().triggered=!0},UserSearchCallback:function(params){var searchString="";return void 0!==Layout.Page.urlparam.searchStr&&(searchString=Layout.Page.urlparam.searchStr,params.searchStr=Layout.Page.urlparam.searchStr,$("#zpeople_search_box").val(decodeURIComponent(searchString))),void 0!==Layout.Page.urlparam.isFilterSearch&&(ZPSearch.userSearchIsNew=!0),ZPSearch.userSearchIsNew&&(ZPSearch.userSearchIsNew=!1,void 0!==Layout.Page.urlparam.searchStr&&(params.searchStr=Layout.Page.urlparam.searchStr),void 0!==Layout.Page.urlparam.department&&(params.department=Layout.Page.urlparam.department),void 0!==Layout.Page.urlparam.title&&(params.title=Layout.Page.urlparam.title),void 0!==Layout.Page.urlparam.nickname&&(params.nickname=Layout.Page.urlparam.nickname),void 0!==Layout.Page.urlparam.aboutme&&(params.aboutme=Layout.Page.urlparam.aboutme),void 0!==Layout.Page.urlparam.expertise&&(params.expertise=Layout.Page.urlparam.expertise),void 0!==Layout.Page.urlparam.tags&&(params.tags=Layout.Page.urlparam.tags),void 0!==Layout.Page.urlparam.isFilterSearch&&(params.isFilterSearch=Layout.Page.urlparam.isFilterSearch)),params},setSearchTab:()=>{if(isadmin||"true"==ZPeople.isSearchAllowed){var tabContainer=$(ZPNewTabs.TabObjList.home),tab=tabContainer.find("#zp_t_home_search");if(0==tab.length){ZPNewTabs.TabsContainer.home?ZPNewTabs.TabsContainer.home.zp_t_home_search="#home/search":(ZPNewTabs.TabsContainer.home={},ZPNewTabs.TabsContainer.home.zp_t_home_search="#home/search");var moreIcn=tabContainer.find("#topTab-more-li");tabContainer.find(".zpl_act").removeClass("zpl_act");let tabli=$('<li tab="true" class="zpl_act"><a href="#home/search" id="zp_t_home_search">'+ZPI18N.getString("zp.searchresult")+"</a></li>").on("click",function(){tabli.addClass("zpl_act").siblings().removeClass("zpl_act")});0==moreIcn.length?ZPUnifieduiUtil.isLoadedInOneZohoIFrame?ZPNewTabs.UnifiedTabObjList.home&&(ZPNewTabs.UnifiedTabObjList.home.find(obj=>"zp_t_home_search"===obj.key)||ZPNewTabs.UnifiedTabObjList.home.push({label:ZPI18N.getString("zp.searchresult"),key:"zp_t_home_search"}),ZPNewTabs.TabsContainer.home.zp_t_home_search=window.location.hash,ZPUnifieduiUtil.constructTopTab(ZPNewTabs.UnifiedTabObjList.home),ZPUnifieduiUtil.selectTab("zp_t_home_search")):tabContainer.append(tabli):moreIcn.before(tabli),tab=tabContainer.find("#zp_t_home_search")}tab.attr("href",window.location.hash),ZPNewTabs.registerResize("topTab",$("#top-tab-cont"),"zpl_act",100,"top_right_menu")}return!0}},ZPSearch.Filter={show:()=>{ZPSearch.Filter.setValueForFilter(),ZPSearch.Page.container.find(".inner_main").addClass("zpl_fltr_flt")},close:()=>{ZPSearch.Page.container.find(".inner_main").removeClass("zpl_fltr_flt")},reset:()=>{["user_search_department","user_search_designation","user_search_nickname","user_search_aboutme","user_search_userexpertise","user_search_usertags"].forEach(function(fieldid){var selectComponent=$("#"+fieldid);"select"==selectComponent.attr("field")?(selectComponent=ZPeopleComponents.select(selectComponent)).setValue(-1):$("#"+fieldid).val("")})},createFilter:result=>{if(0==ZPSearch.Page.container.find("#filter_wrap").length){let wrap=ZPSearch.Page.container.find(".inner_main");wrap.append(ZPSearch.Component.filterContainer),wrap.find("#filter_wrap .close_fltr").on("click",ZPSearch.Filter.close)}ZPSearch.Filter.destryExistField([]);let fieldContainer=ZPSearch.Page.container.find("#filter_wrap #filter_list");void 0===result.refineSearchDtls&&(result.refineSearchDtls={}),result.department=ZPSearch.Filter.undefinedToEmpty(result.department),result.title=ZPSearch.Filter.undefinedToEmpty(result.title),result.nickname=ZPSearch.Filter.undefinedToEmpty(result.nickname),result.aboutme=ZPSearch.Filter.undefinedToEmpty(result.aboutme),result.expertise=ZPSearch.Filter.undefinedToEmpty(result.expertise),result.tags=ZPSearch.Filter.undefinedToEmpty(result.tags);let data=[],fieldId="",fieldDisName="",pageId="user_search";ZPSearch.Filter.destryExistField([pageId+"_department",pageId+"_designation"]),fieldContainer.empty(),fieldId=pageId+"_department",fieldDisName=ZPI18N.getString("zp.department"),result.refineSearchDtls.depList&&(data=result.refineSearchDtls.depList),ZPSearch.Filter.createField(fieldDisName,fieldId,data,fieldContainer,"select"),fieldId=pageId+"_designation",fieldDisName=ZPI18N.getString("zp.designation"),data=[],result.refineSearchDtls.designList&&(data=result.refineSearchDtls.designList),ZPSearch.Filter.createField(fieldDisName,fieldId,data,fieldContainer,"select"),fieldId=pageId+"_nickname",ZPSearch.Filter.createField(ZPI18N.getString("zp.nickname"),fieldId,result.nickname,fieldContainer,"inputTxt"),fieldId=pageId+"_aboutme",ZPSearch.Filter.createField(ZPI18N.getString("zp.aboutme"),fieldId,result.aboutme,fieldContainer,"inputTxt"),fieldId=pageId+"_userexpertise",ZPSearch.Filter.createField(ZPI18N.getString("zp.expertise"),fieldId,result.aboutme,fieldContainer,"inputTxt"),fieldId=pageId+"_usertags",ZPSearch.Filter.createField(ZPI18N.getString("zp.tags"),fieldId,result.aboutme,fieldContainer,"inputTxt")},createField:(fieldDisName,fieldId,value,container,fieldType)=>{if("select"==fieldType){let field=(fieldHtml=$(`\n\t\t\t\t<div class="zpl_secn">\n\t\t\t\t<div><label>${fieldDisName}</label></div>\n\t\t\t\t<div><select id="${fieldId}" field="select"></select></div>\n\t\t\t\t</div>\n\t\t\t\t`)).find("#"+fieldId);var option=[],defaultValue=-1;option.push({FName:ZPI18N.getString("zp.automation.none"),FValue:-1}),value.forEach(function(fieldValue){option.push({FName:fieldValue,FValue:fieldValue}),("user_search_department"==fieldId&&fieldValue==Layout.Page.urlparam.department||"user_search_designationt"==fieldId&&fieldValue==Layout.Page.urlparam.title)&&(defaultValue=fieldValue)}),select=$(fieldHtml),container.append(fieldHtml),ZPeopleComponents.select(field,{dataMapping:{label:"FName",text:"FName",value:"FValue"},dropdownList:{fitForElement:!0},showSearchField:!0,search:{delay:100}});var selectComponent=ZPeopleComponents.select(container.find("#"+fieldId));selectComponent.removeAllOptions(),option&&option.length>0&&selectComponent.addOption(option),selectComponent.setValue(defaultValue)}else if("inputTxt"==fieldType){var fieldHtml=$(`\n\t\t\t\t<div class="zpl_secn">\n\t\t\t\t<div><label>${fieldDisName}</label></div>\n\t\t\t\t<div><input value="${value}" type="text" id="${fieldId}" class="ztextbox"></div>\n\t\t\t\t</div>\n\t\t\t\t`);$("#"+fieldId).remove(),container.append(fieldHtml)}},destryExistField:fielsArr=>{"object"==typeof fielsArr&&$.each(fielsArr,function(index,fieldId){var existFld=ZPeopleComponents.select(document.getElementById(fieldId));existFld&&existFld.destroy()})},undefinedToEmpty:function(value){return void 0===value&&(value=""),value},doFilter:function(){ZPSearch.Filter.close();var filterObj={},deptName=$("#user_search_department").val(),designation=$("#user_search_designation").val(),nickName=$("#user_search_nickname").val(),aboutMe=$("#user_search_aboutme").val(),expertise=$("#user_search_userexpertise").val(),tags=$("#user_search_usertags").val(),url="home/search-";let isFilterSearch=!1;url+="searchStr:"+Layout.Page.urlparam.searchStr,filterObj.searchStr=Layout.Page.urlparam.searchStr,ZPSearch.Validation.isNotEmpty(deptName)&&"-1"!==deptName&&(url+="/department:"+encodeURIComponent(deptName),isFilterSearch=!0,filterObj.department=encodeURIComponent(deptName)),ZPSearch.Validation.isNotEmpty(designation)&&"-1"!==designation&&(url+="/title:"+encodeURIComponent(designation),filterObj.title=encodeURIComponent(designation),isFilterSearch=!0),ZPSearch.Validation.isNotEmpty(nickName)&&(url+="/nickname:"+encodeURIComponent(nickName),filterObj.nickname=encodeURIComponent(nickName),isFilterSearch=!0),ZPSearch.Validation.isNotEmpty(aboutMe)&&(url+="/aboutme:"+encodeURIComponent(aboutMe),filterObj.aboutme=encodeURIComponent(aboutMe),isFilterSearch=!0),ZPSearch.Validation.isNotEmpty(expertise)&&(url+="/expertise:"+encodeURIComponent(expertise),filterObj.expertise=encodeURIComponent(expertise),isFilterSearch=!0),ZPSearch.Validation.isNotEmpty(tags)&&(url+="/tags:"+encodeURIComponent(tags),filterObj.tags=encodeURIComponent(tags),isFilterSearch=!0),isFilterSearch?url+="/isFilterSearch:true":ZPSearch.Page.isNeedRefresh=!0,ZPSearch.Filter.creatBreadCrumb(filterObj),window.location.hash=url,ZPSearch.Filter.setValueForFilter()},creatBreadCrumb:filterObj=>{var BreadcrumbList=ZPSearch.Page.container.find("#breadcrumblist"),wrapEle=ZPSearch.Page.container.find("#filetrWrap"),maxWidth=.7*wrapEle.width();BreadcrumbList.empty();var nextEle=wrapEle.find("#breadcrumbclearwrap");nextEle.empty();var fieldArray=[];let id="",name="",value="";return ZPSearch.Validation.isNotEmpty(filterObj.searchStr)&&(id="user_search_term",value=ZSEC.Encoder.encodeForHTML(decodeURIComponent(filterObj.searchStr)),name=ZPI18N.getString("zp.searchterm"),fieldArray.push({id:id,value:value,name:name})),ZPSearch.Validation.isNotEmpty(filterObj.department)&&(id="user_search_department",value=ZSEC.Encoder.encodeForHTML(decodeURIComponent(filterObj.department)),name=ZPI18N.getString("zp.department"),fieldArray.push({id:id,value:value,name:name})),ZPSearch.Validation.isNotEmpty(filterObj.title)&&(id="user_search_designation",value=ZSEC.Encoder.encodeForHTML(decodeURIComponent(filterObj.title)),name=ZPI18N.getString("zp.designation"),fieldArray.push({id:id,value:value,name:name})),ZPSearch.Validation.isNotEmpty(filterObj.nickname)&&(id="user_search_nickname",value=ZSEC.Encoder.encodeForHTML(decodeURIComponent(filterObj.nickname)),name=ZPI18N.getString("zp.nickname"),fieldArray.push({id:id,value:value,name:name})),ZPSearch.Validation.isNotEmpty(filterObj.aboutme)&&(id="user_search_aboutme",value=ZSEC.Encoder.encodeForHTML(decodeURIComponent(filterObj.aboutme)),name=ZPI18N.getString("zp.aboutme"),fieldArray.push({id:id,value:value,name:name})),ZPSearch.Validation.isNotEmpty(filterObj.expertise)&&(id="user_search_userexpertise",value=ZSEC.Encoder.encodeForHTML(decodeURIComponent(filterObj.expertise)),name=ZPI18N.getString("zp.expertise"),fieldArray.push({id:id,value:value,name:name})),ZPSearch.Validation.isNotEmpty(filterObj.tags)&&(id="user_search_usertags",value=ZSEC.Encoder.encodeForHTML(decodeURIComponent(filterObj.tags)),name=ZPI18N.getString("zp.tags"),fieldArray.push({id:id,value:value,name:name})),0!=fieldArray.length&&(nextEle.append(ZPSearch.Component.clearAll()),nextEle.length>0&&(maxWidth-=nextEle.width()),ZPSearch.Filter.addFilterBreadcrumb(BreadcrumbList,fieldArray,maxWidth),ZPSearch.userSearchIsNew=!0,!0)},setValueForFilter:()=>{[{id:"user_search_department",paramId:"department"},{id:"user_search_designation",paramId:"title"},{id:"user_search_nickname",paramId:"nickname"},{id:"user_search_aboutme",paramId:"aboutme"},{id:"user_search_userexpertise",paramId:"expertise"},{id:"user_search_usertags",paramId:"tags"}].forEach(function(fieldObj){let id=fieldObj.id,value=Layout.Page.urlparam[fieldObj.paramId];var selectComponent=$("#"+id);"select"==selectComponent.attr("field")?(selectComponent=ZPeopleComponents.select(selectComponent)).setValue(value?decodeURIComponent(value):-1):$("#"+id).val(value?decodeURIComponent(value):"")})},addFilterOption:(data,id)=>{let comp=ZPeopleComponents.select($("#"+id)),option=[];if(comp){let componentOption=comp.getOptions();data.forEach(function(fieldValue){componentOption.some(obj=>obj.FValue===fieldValue)||option.push({FName:fieldValue,FValue:fieldValue})}),option.length>0&&comp.addOption(option,"after")}},setNodata:(isHide,isEmptySearch)=>{let listContainer=ZPSearch.Page.container.find("#userlist_cont");isHide&&ZPSearch.Page.container.find(".fltr_icn").addClass("DNI"),isEmptySearch?listContainer.html('<div class="zpl_Empdatafxd zpl_crd"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"><div> <div class="zpl_emptimg zp_nd_usridmap"></div> <h4>'+ZPI18N.getString("zp.begintypingtosearchemployee")+"</h4></div></div></div></div>"):listContainer.html('<div class="zpl_Empdatafxd zpl_crd"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_qcklnk"></div> <h4>'+ZPI18N.getString("zp.nousersfound")+"</h4></div></div></div></div>")},clearFilter:()=>{ZPSearch.Filter.reset(),window.location.hash="#home/search"},clear:(event,data)=>{if(data&&data.fieldId)"select"==(selectComponent=$("#"+data.fieldId)).attr("field")?(selectComponent=ZPeopleComponents.select(selectComponent)).setValue(-1):$("#"+data.fieldId).val("");else if(event&&"cancelfilter"==$(event.target).attr("field")){let id=$(event.target).attr("fieldId");var selectComponent;if("select"==(selectComponent=$("#"+id)).attr("field")?(selectComponent=ZPeopleComponents.select(selectComponent)).setValue(-1):$("#"+id).val(""),"user_search_term"==id&&(Layout.Page.urlparam.searchStr=""),1==ZPSearch.Page.container.find("#breadcrumblist li").length)return void ZPSearch.Filter.clearFilter()}ZPSearch.Filter.doFilter()},addFilterBreadcrumb:(BreadcrumbList,fieldArray,maxWidth)=>{let option=[];if(fieldArray.forEach(function(field){if(maxWidth>=BreadcrumbList[0].offsetWidth){let filterfield=ZPSearch.Component.BreadcrumbList(field.id,field.name,field.value,ZPSearch.Filter.clear);BreadcrumbList.append(filterfield)}else option.push({label:field.name+" : "+field.value,description:field.value,contentType:"icon-text",itemType:"custom",innerHTML:"<label>"+field.name+" :</label><span>"+field.value+'</span><a field="cancelfilter" class="PI_cls"></a>',fieldId:field.id})}),option.length>0){var menucomp=ZPeopleComponents.menu($("#more_userfilter"));menucomp&&(menucomp.destroy(),$("#more_userfilter").remove());let moreli=$('<li id="filter_moreicn"><i class="PI_more d-flex"></i></li>').on("click",function(){ZPeopleComponents.menu($("#more_userfilter")).show()});BreadcrumbList.append(moreli);let menu=$('<div id="more_userfilter"></div>');$(menu).insertAfter(BreadcrumbList);let actionMenu={menu:menu,forElement:moreli,callback:()=>ZPSearch.Filter.clear,parentId:"filetrWrap",itemType:"custom",option:option};ZPSearch.Component.dropDownMenu(actionMenu)}}},ZPSearch.Validation={isNotEmpty:function(value){return void 0!==value&&""!==value.trim()}},ZPSearch.Component={PageWrap:'<div class="zpl_container"><div class="zpl_iwrpr"><div class="zpl_iwrprrgt"><div scroll="enabled" class="inner_main zpl_act zpl_tblfxd"></div></div></div></div>',pageFilterCOntainer:pageId=>{var container=$('<div class="zpl_btnmnu"> <div class="zpl_lft"> <div> <span id="searchResultCount"> </span>  </div> </div> <div class="zpl_rgt"><i class="fltr_icn zpl_ibg PI_fltr"></i></div></div><div id="filetrWrap" class="zpl_fltrvw"><div id="breadcrumblist_parent"><ul id="breadcrumblist" class="zpl_fltrvwlst"></ul></div><div id="breadcrumbclearwrap" class="d-flexcap MLauto"></div>');return container.find(".fltr_icn").on("click",ZPSearch.Filter.show),container},BreadcrumbList:(id,name,value,closecallback)=>{let list=$('<li id="'+id+'_Brcmlist"><label>'+name+" :</label><span>"+value+'</span><a field="cancelfilter" fieldId="'+id+'" class="PI_cls close"></a></li>');return list.find(".close").on("click",closecallback),list},dropDownMenu:function(menuObect){let menuList=ZPeopleComponents.menu($(menuObect.menu),{forElement:$(menuObect.forElement),className:"zpl_drprosts zpl_fltrvwlst zpl_drpdwn",itemclick:menuObect.callback(),appendTo:menuObect.parentId});menuObect.option.forEach(function(menuOption,indx){menuList.addMenuItem(menuOption)})},listContainer:'<div  class="zpl_rgtcnt zpsearch_contwrap"><div id="userlist_cont" class="zpl_flks_crdlst zpl_emcrdlst"></div></div>',filterContainer:'<div id="filter_wrap" class="zpl_fltr"><div><div class="zpl_fltrhd"><h5>'+ZPI18N.getString("zp.filter")+'</h5><i class="close_fltr PI_cls"></i></div></div><div class="zpl_fltrcnt"><div><div class="zpl_fltclps fltopn"><div id="filter_list" class="zpl_fltrlst"></div></div></div></div><div><button id="addPolicy1" type="button" class="zlabel zlabel--blue zlabel--medium" onclick="ZPSearch.Filter.doFilter()">'+ZPI18N.getString("zp.apply")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="ZPSearch.Filter.reset()">'+ZPI18N.getString("zp.reset")+"</button></div></div>",clearAll:()=>$('<a field="cancelAllfilter" class="red">'+ZPI18N.getString("zp.clearAll")+"</a>").on("click",ZPSearch.Filter.clearFilter)};var ZPEncrypt={};ZPEncrypt.Encryption={getIframeUrl:async function(url){return"undefined"!=typeof isPayloadEncryptionEnabled&&isPayloadEncryptionEnabled&&(url.startsWith("/")||url.includes("viewFile"))&&!url.includes("pdfViewer.zp")&&await $.ajax({type:"GET",url:url,xhrFields:{responseType:"blob"},success:function(data,status,xhr){var blob=new Blob([data],{type:xhr.getResponseHeader("Content-Type")});if(url=window.URL.createObjectURL(blob),xhr.getResponseHeader("Content-Disposition")&&(xhr.getResponseHeader("Content-Disposition").includes(".zip")||xhr.getResponseHeader("Content-Disposition").includes(".odf")||xhr.getResponseHeader("Content-Disposition").includes(".ics"))){var a=document.createElement("a");a.href=url,a.download=decodeURIComponent(xhr.getResponseHeader("Content-Disposition").split("=")[1]).replaceAll("+"," "),document.body.appendChild(a),a.click(),url=""}}}),url}};