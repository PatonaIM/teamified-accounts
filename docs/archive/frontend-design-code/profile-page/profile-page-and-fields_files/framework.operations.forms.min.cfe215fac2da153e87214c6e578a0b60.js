var ZP5Form={};(ZP5Form={FORMSOBJ:{},isDomainPresent:!1,addUserDirect:!0,autoGenPwd:!0,EMPID_DETAILS:{},PROFILE:!1,IS_RESUBMIT:!1,RESUBMIT_RECORDID:null,EMP_FORMID:void 0,URL:"/formAction.zp",MODE:"ADD",IS_MIN:{},FORMSCLASSOBJ:{},CURR_FORM_OPERATIONS:{},ALLOWED_OPTIONS_TO_UPDATE_FIELD:["EditOptions","AddOptions","OptionsWithId","Options"],ACTIVE_FORM_KEY:void 0,MessageKeys:{Success:{ADD_RECORD:0,UPDATE_RECORD:1,ADD_DRAFT:2,NO_MOD_UPDATE_REC:3}},MODEL:Object.freeze({FULL:0,SLIDER:1,NO_MODEL:2,SINGLE_FIELD_EDIT:3,PRINT:4,SLIDER_SMALL:5,SLIDER_MEDIUM:6,SLIDER_LARGE:7}),FORM_BODY_CONTAINER:'<div class="zpl_iwrpr" id="formBodyContainer"></div>',PREVIEW_FOOTER:'<div class="MRauto" id="RSFooter"></div><div class="MLauto" id="LSFooter"><button tab-nav="FormCreation" id="zp_forms_prev_btn" acttype="0" class="zlabel zlabel--outline zlabel--medium zpl_DNI">'+ZPI18N.getString("zp.previous")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium zpl_DNI" acttype="1"  id="zp_forms_next_btn">'+ZPI18N.getString("zp.next")+"</button></div>",FOOTER:'<div class="zpl_mfoter zpl_btnsplt"><div class="MRauto" id="RSFooter"><button class="zlabel zlabel--outline zlabel--medium zpl_DNI" id="zp_forms_draft_btn">'+ZPI18N.getString("zp.savedraftbtn")+'</button><button type="button" class="zlabel zlabel--blue zlabel--medium zpl_DNI" id="zp_forms_add_btn">'+ZPI18N.getString("zp.submit")+'</button><button type="button" class="zlabel zlabel--blue zlabel--medium zpl_DNI" id="zp_forms_addnew_btn">'+ZPI18N.getString("zp.submitNew")+'</button><button class="zlabel zlabel--outline zlabel--medium zpl_DNI" id="zp_forms_savedraft_btn">'+ZPI18N.getString("zp.savedraftbtn")+'</button><button id="zp_form_cancel_close_btn" class="zlabel zlabel--outline zlabel--medium"  name="closeBtn">'+ZPI18N.getString("zp.cancel")+'</button></div><div class="MLauto" id="LSFooter"><button tab-nav="FormCreation" id="zp_forms_prev_btn" acttype="0" class="zlabel zlabel--outline zlabel--medium zpl_DNI">'+ZPI18N.getString("zp.previous")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium zpl_DNI" acttype="1"  id="zp_forms_next_btn">'+ZPI18N.getString("zp.next")+"</button></div></div>",EMBED_FOOTER:'<div class="zpl_mfoter zpl_btnsplt"><div class="MRauto" id="RSFooter"><button type="button" class="zlabel zlabel--blue zlabel--medium zpl_DNI" id="zp_forms_add_btn">'+ZPI18N.getString("zp.submit")+'</button></div><div class="MLauto" id="LSFooter"><button tab-nav="FormCreation" id="zp_forms_prev_btn" acttype="0" class="zlabel zlabel--outline zlabel--medium zpl_DNI">'+ZPI18N.getString("zp.previous")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium zpl_DNI" acttype="1"  id="zp_forms_next_btn">'+ZPI18N.getString("zp.next")+"</button></div></div>",FORM_OUTER_TEMPLATE:'<div class="zpl_mdl zpl_mfull zpl_mopen" role="dialog" data-keyboard="false"><div class="zpl_minr" id="headerParent"><div class="zpl_mcnt" id="zp_form_outer_container"></div></div><iframe name="zp_form_response" frameborder="0" style="height: 0px;width: 0px; display: none;"></iframe></div>',FORM_HEADER_TEMPLATE:'<div class="zpl_mhder" id="zp_form_header"><div><h4 id="zp_form_header_name"></h4><div class="zpl_em zpl_DNI" id="employeeheadername"></div><div class="zbadges zbadges--blue zpl_DNI" id="edit_draft_class">'+ZPI18N.getString("zp.draft")+'</div><div class="zbadges zbadges--green zpl_DNI" id="sample_data_badge">'+ZPI18N.getString("zp.sampledata")+'</div></div><span class="zpl_mhderrgt"><div id="headerApprovalBtn"></div><a class="PI_edt zpl_btnic zpl_DNI" id="zp_form_editin_singlerec" '+ComponentsCommon.getTooltipHtml(ZPI18N.getString("zp.edit"),{displayType:"box"})+'></a><a id="zp_form_createinfo" class="PI_info zpl_btnic zpl_DNI" data-menu-id="recordInfo"></a><a class="PI_more zpl_btnic zpl_drpdwn-js zpl_DNI" data-menu-id="frmMore" id="ZP_Form_MoreOpt" '+ComponentsCommon.getTooltipHtml(ZPI18N.getString("zp.more"),{displayType:"box"})+'></a></span><a class="_cls PI_cls zpl_DNI" name="closeBtn"></a></div>',EMBED_FORM_OUTER:'<div class="zpfrm-continer"><nav class="navbar navbar-fixed-top"><div class="navbar-header ZPwf"><div class="ZPHeadLft" id="embicon"></div></div></nav><div class="zpcont-wrapper" id="zp_form_outer_container"></div><div class="zpact"><div class="text-center MT5"><button id="zp_forms_add_btn" class="btn btn-primary MR10" onclick=" ZP5Form.IS_SUBMITNEW=false;ZP5Form.Record.validateAndSubmit();">'+ZPI18N.getString("zp.submit")+"</button></div></div></div>",EMBED_FORM_SUCCESS_PAGE:'<div class="zpl_thmIntro text-center flex-dirC"><div class="zpl_thmImgCon"><div class="zpl_tqImg zp_img_tq zp_nd_template"></div></div><div class="thmIntro_cnt"tabindex="0"><h2 class="thmIntro_ttl">'+ZPI18N.getString("zp.dataaddedsuccess")+'</h2><div class="thmIntro_desc"><div>'+ZPI18N.getString("zp.dataaddedsuccessdesc")+"</div></div></div></div>",UNIQUE_FIELDS_RECORD_ERROR:'<div class="zpl_info redbglit" id="errorHead"><div class="d-flexC"><i class="PI_fil_alert red"></i><span id="errorTxt"></span><i class="PI_cls d-flexclmrgt CP" onclick="ZP5Form.uniqueErrorClose()"></i></div></div>',TEMPLATE_DATA:{},APPROVERHTML:{},ISAPPROVAL:!1,ISBLUEPRINT:!1,USER_EMPLOYEEPERM:null,FIELD_RULE_DETAILS:{},USER_ADMIN_LOCATIONS:[],USER_ISADMIN:!1,draftstatus:4,editdraftstatus:5,primLkpType:null,isFieldsChange:!1,isRefreshNeeded:!1,primLkpId:null,primLkpVal:null,primLkpChangeRestrictedForms:["P_Employee","P_Department","P_Designation","P_Location","P_Streams","P_EmployeeHealthData","P_EmployeeLeave","P_TimesheetJobsList","P_TimesheetJob","P_EmployeeJobs","P_Timesheet","P_SelfAppraisal","P_PerformanceAppraisal","P_Goals","P_VaccinationStatus"],COUNTRY_STATES:{},HistoryFields:{},isOrgValuePresent:{},time_Field_Prop:{},divisionOptions:{},months:["zp.jan","zp.feb","zp.mar","zp.apr","zp.may","zp.jun","zp.jul","zp.aug","zp.sep","zp.oct","zp.nov","zp.dec"],skipReadOnlyFieldsTable:["P_EmployeeLeave","P_EmployeeSalary","P_SelfAppraisal","P_PerformanceAppraisal","P_Goals","P_ClientDetails","P_TimesheetJobsList","P_TimesheetJob","P_EmployeeJobs","P_Timesheet","P_KRA_User","P_MultiRater","P_Task"],PreviewSupportedFileTypes:["tif","pdf","docx","doc","rtf","odt","pptx","ppt","xls","xlsx","xlsm","sxc","ods","csv","tsv","odp","sxi","jpg","jpeg","gif","png","txt"],orgStrutureElementChildMap:{},CUSTOMIZABLE_SYS_FORMS:["P_Asset","P_Benefit","P_Disciplinary","P_Ada","P_Fmla","P_Irca","P_Eeo","P_Vets","P_Osha","P_ApplyTraining","P_Separation","P_FeedbackTraining","P_TravelInitiate","P_ExpenseDetails","P_AddressProof","P_BonafideRequest","P_ExperienceLetter"],LOOKUP_DATA:{},NO_DATA:{SERVER_ERROR:0,LOCATION_DISABLED:1,NO_EDITABLE_FIELDS:2,NO_FIELDS:3,NO_PERMISSION:4},DROPDOWN_TYPE_FIELDS:[FormConstants.FieldType.BLOODGROUP,FormConstants.FieldType.GENDER,FormConstants.FieldType.COUNTRY,FormConstants.FieldType.STATES,FormConstants.FieldType.NEW_COUNTRY,FormConstants.FieldType.NEW_BLOODGROUP,FormConstants.FieldType.NEW_GENDER,FormConstants.FieldType.ADDRESS],DROPDOWN_DISPLAY_FIELDS:[FormConstants.FieldType.SELECT_DISPLYTYPE,FormConstants.FieldType.MULTISELECT_DISPLYTYPE],dependencyFiles:()=>["fileupload.min.js"],getForm:function(formId){if(void 0!=formId)return void 0!=ZP5Form.FORMSOBJ[formId]?ZP5Form.FORMSOBJ[formId]:(ZP5Form.FORMSOBJ[formId]=new FormsCache(formId).toInstance(),ZP5Form.FORMSOBJ[formId])},getFormsOperation:function(formId){return new FormsOperations(formId)},getCurrFormsOperation:function(){return void 0!=ZP5Form.CURR_FORM_OPERATION?ZP5Form.CURR_FORM_OPERATION:new FormsOperations},updateFormMode:function(){-1!==Layout.Page.hash.indexOf("/edit")?ZP5Form.setEditMode():-1!==Layout.Page.hash.indexOf("/view")?ZP5Form.setViewMode():ZP5Form.setAddMode()},getFormClassObj:function(){return ZP5Form.FORMSCLASSOBJ[ZP5Form.ACTIVE_FORM_KEY]},getCurrentFormId:function(){return ZP5Form.getFormClassObj()?ZP5Form.getFormClassObj().getFormId():ZP5Views.CURR_VIEWPARAMS.formId},removeFormClassObj:function(formsObj){let key=formsObj.formLayoutKey;delete ZP5Form.FORMSCLASSOBJ[key]},getLayout:function(){return this.getFormClassObj().LAYOUT},getFieldLayout:function(){return this.getFormClassObj().FIELD_LAYOUT},getFormCurrMode:function(){return this.getFormClassObj().mode},getFormObjectKey:function(formClassObj,formId,mode){let id="zp_addedit_record_"+formId;return formClassObj.PRINT?id="zp_print_record_"+formId:formClassObj.isSingleFieldModal?id="zp_singlefieldedit_record_"+formId:formClassObj.isfromrelfieldedit?id="zp_relfieledit_record_"+formId:formClassObj.isrelfieldsingelrecview?id="zp_relfielsingle_record_"+formId:formClassObj.getParams().isProfileView?id="zp_profile_record_"+formId:"VIEW"==mode?id="zp_view_record_"+formId:(formClassObj.isQuickAdd||formClassObj.isrelformrelfields)&&(id="zp_quickadd_record_"+formId),id},formsCallback:function(modulekey){let niceurlsplit=settingsUrlProps.niceUrl.split("/"),mode=niceurlsplit[niceurlsplit.length-1],formid=settingsUrlProps.urlParamsArr.formId;if(void 0==formid&&-1!==settingsUrlProps.niceUrl.indexOf("home/team/employee")&&(formid=ZPeople.EMP_FORMID),"view"==mode||"edit"==mode||"add"==mode){let params={formId:formid};if(void 0!=modulekey&&(params.moduleKey=modulekey),ZP5Form.IS_RESUBMIT){params.formMode="EDIT",params.recordId=ZP5Form.RESUBMIT_RECORDID,ZP5Form._toForm(params).setResubmit().init(),ZP5Form.IS_RESUBMIT=!1}else mode=mode.toUpperCase(),params.formMode=mode,params.recordId=settingsUrlProps.urlParamsArr.recordId,ZP5Form.load(params)}else ZPView.CURR_VIEWPARAMS=null,ZPView.init(),void 0!=ZPView.VIEW_CONTAINER&&ZPView.VIEW_CONTAINER.parent().parent().removeClass("filter-wrap"),ZP5Form.addRecentlyUsed()},closeCallback:function(){for(;void 0!=ZP5Form.ACTIVE_FORM_KEY;){let formClassObj=ZP5Form.getFormClassObj();formClassObj.layoutRevertChanges(formClassObj)}},formDataMask:function(){let formClassObj=ZP5Form.getFormClassObj(),fieldLayout=ZP5Form.getFieldLayout();if(formClassObj.PRINT)fieldLayout.find("[mask^=star]").toggleClass("zpl_DNI",!0),fieldLayout.find("[mask^=value]").toggleClass("zpl_DNI",!1),fieldLayout.find("[mask^=hdr_]").remove();else{let formMask=!formClassObj.isFormMasked();formClassObj.setFormMasked(formMask),fieldLayout.find("[mask=star]").each((index,element)=>{$(element).toggleClass("zpl_DNI",!formMask)}),fieldLayout.find("[mask=value]").each((index,element)=>{$(element).toggleClass("zpl_DNI",formMask)}),fieldLayout.find("[mask^=hdr_]").each((index,element)=>{("true"==$(element).attr("masked")&&!formMask||"false"==$(element).attr("masked")&&formMask)&&$(element).trigger("click")})}},gridDataMask:function(tabularRowHtml,isFromView){tabularRowHtml.find("[mask^=hdr_]").on("click",function(){let maskAttribute=$(this).attr("mask"),isMasked="true"==$(this).attr("masked"),position=maskAttribute.split("_")[1];$(this).attr("masked",!isMasked).toggleClass("PI_eye",!isMasked).toggleClass("PI_eyecls",isMasked),tabularRowHtml.find("[mask=value_"+position+"]").toggleClass("zpl_DNI",!isMasked),tabularRowHtml.find("[mask=star_"+position+"]").toggleClass("zpl_DNI",isMasked);let sortEleId=isFromView?"#viewSorting":"[elem=sorticn]";$(this).closest("th").find(sortEleId).toggleClass("zpl_DNI",!isMasked)})},getRecordType:function(){var viewType=FormConstants.Permission.VAL.ALL_DATA,singleRecDtl=ZP5Form.getSingleRecord();return void 0!==singleRecDtl&&void 0!==singleRecDtl.record&&void 0!=singleRecDtl.record&&(viewType=singleRecDtl.record.viewType),viewType},openPrintForm:function(){let formclasobj=ZP5Form.getFormClassObj(),params=formclasobj.getParams(),formLayoutKey=formclasobj.formLayoutKey;params.PRINT=!0,params.isPageMode=!0;let forms=new Forms(params);forms.setHeader(FormsCommon.getPrintHeaderHtml()),forms.setFormModel(ZP5Form.MODEL.PRINT),forms.init(),void 0!=params.formId&&(ZPFRulesNew.Evaluation.LAYOUT=forms.LAYOUT,ZPFRulesNew.Evaluation.evaluateRulesForAllFields(!1)),formclasobj.moduleHandler.handlePrint(forms.LAYOUT,params);let formId=formclasobj.getFormId(),isApproval=ZP5Form.isApprovalEnabled(formId),newWindow=FormsCommon.constructPrintForm(forms.LAYOUT.prop("outerHTML"),formId,formclasobj.getRecordId(),{isApproval:isApproval});isApproval&&(ZP5Form.ISAPPROVAL=!1),ZP5Form.PRINT=!1,ZP5Form.removeFormClassObj(ZP5Form.getFormClassObj()),ZP5Form.ACTIVE_FORM_KEY=formLayoutKey,newWindow.document.close()},constructFieldDataParams:function(params){ZP5Form.EMPID_DETAILS={};let formClassObj=ZP5Form.getFormClassObj(),currparams=formClassObj.getParams();params.subMode=currparams.mode,formClassObj.isFormCustomPreview()&&(isadmin||isTabCustomAdmin)&&(formClassObj.isRoleBasedPreview?(params.roleId=formClassObj.roleId,params.isRoleBased=!0):(params.roleId="-1",params.isRoleBased=!0)),ZPUtil.Validation.isEmpty(currparams.recordId)||(params.recordId=currparams.recordId),currparams.isProfile&&(params.isProfile=currparams.isProfile)},updateUserDetails:function(userDtl,name,value,cmpid){switch(name){case"EmployeeID":userDtl.empid=value;break;case"LastName":userDtl.lname=value,userDtl.name=ZPeople.getUserDisplayName(userDtl.fname,userDtl.lname);break;case"FirstName":userDtl.fname=value,userDtl.name=ZPeople.getUserDisplayName(userDtl.fname,userDtl.lname);break;case"Department":userDtl.deptName=value,userDtl.deptId=cmpid;break;case"Reporting_To":userDtl.reportingTo=value;break;case"Work_location":userDtl.workLoc=value;break;case"LocationName":userDtl.location=value,userDtl.locId=cmpid;break;case"Mobile":userDtl.mobile=value;break;case"Work_phone":userDtl.workPhone=value;break;case"Extension":userDtl.extension=value;break;case"Role":userDtl.roleName=value,userDtl.roleId=cmpid;break;case"Designation":userDtl.designation=value,userDtl.desiId=cmpid}},showForm:function(mode,formid,recId,invite,props){let formContainer,isDisableUrlTrack=!1;var tableName;void 0!=props&&(isDisableUrlTrack=props.isDisableUrlTrack,formContainer=props.formContainer);let formId=formid;if(void 0===formId&&(formId=Layout.Page.urlparam.formId),void 0!=ZP5Form.getFormsOperation(formId).getFormsDetailsMap()&&(tableName=ZP5Form.getFormsOperation(formId).getFormsDetailsMap().tableName),"P_TimesheetJobsList"!==tableName&&"P_TimesheetJob"!==tableName&&"P_ClientDetails"!==tableName)if("P_EmployeeSalaryTemplate"!=tableName&&"P_SalaryRevision"!=tableName)if(isWebForm)webFormStateHandler(mode,recId);else{ZP5Form.isFromInvite=invite,void 0==formId&&(formId=ZP5Views.CURR_VIEWPARAMS.formId);var formlinkname=ZPUtil.Form_Link_Names.getFormLinkName(formId,!0);if(mode=void 0===mode?"add":mode,isDisableUrlTrack){let form=ZP5Form._toForm({formId:formId,formMode:mode.toUpperCase(),recordId:recId,disableUrlTrack:!0});return void 0!=formContainer&&form.setFormContainer(formContainer),void form.init()}if("yes"==ZP5Form.isFromInvite){let formnameString="-formLinkName:";formlinkname||(formnameString="-formId:",formlinkname=formId),window.location.href=urlFormConf.getUrlFromMode(mode)+formnameString+formlinkname+"/invite"}else window.location.href=ZP5Form.getFormActionUrl(mode,formId,formlinkname,recId,!1)}else Compensation.Utils.showSingleRecord(recId);else Timetracker.forms.showForm(mode,recId)},getFormActionUrl(mode,formId,formLinkName,recId,needWebForm){if(needWebForm)return ZPeople.getWebFormUrl(mode,formId,formLinkName,recId);{let formActUrl=urlFormConf.getUrlFromMode(mode);return"edit"===mode?(void 0===recId&&void 0!==Layout.Page.childUrlParam.recordId&&(recId=Layout.Page.childUrlParam.recordId),"admin/organization/locations/edit"!=formActUrl?formActUrl+="-recordId:"+recId:formActUrl=formActUrl+"/"+recId):"view"===mode&&void 0!==recId&&void 0!==formId&&(formActUrl+="-recordId:"+recId),formActUrl}},_toForm:function(params,isRefreshNeeded){let form=new Forms(params,isRefreshNeeded);return form=ZP5Form.setModuleBasedFormProps(form)},setModuleBasedFormProps:function(form){return form},load:function(params,isPreviewForm){ZP5Form._toForm(params).setPreviewForm(isPreviewForm).init()},showPreview:function(thisObj){var currVal=$(thisObj).val();if(""!=currVal){var emailId=currVal+"@"+$($("select#domainListing")).val();ZP5Form.LAYOUT.find("[name=EmailID]").val(emailId)}else""==currVal&&ZP5Form.LAYOUT.find("[name=EmailID]").val("")},toggPwdForAUD:function(setPwdOrCancel){var pageId=Layout.Page.container;void 0!=setPwdOrCancel?(ZP5Form.autoGenPwd=!1,pageId.find("div#tempPwd").removeClass("hide"),pageId.find("div#pwdParent").addClass("hide")):(ZP5Form.autoGenPwd=!0,pageId.find("div#tempPwd").addClass("hide"),pageId.find("div#pwdParent").removeClass("hide"))},showPreviewdom:function(thisObj){if(""!=ZP5Form.LAYOUT.find("[name=domainEmail]").val()){var currVal=$(thisObj).val(),emailId=ZP5Form.LAYOUT.find("[name=EmailID]").val().split("@")[0]+"@"+currVal;ZP5Form.LAYOUT.find("[name=EmailID]").val(emailId)}},populateFields:function(formComp){let fcmap={};return $.each(formComp.formComponentDetails,function(){void 0!==this.column1&&this.column1.length>0&&$.each(this.column1,function(index){fcmap[this.formComponentId]=this}),void 0!==this.column2&&this.column2.length>0&&(this.hasField=!0,$.each(this.column2,function(index){fcmap[this.formComponentId]=this}))}),fcmap},formatFields:function(formComp,tableName,isSingleFieldModal,singleFieldModalFields,formId){var isCol1Empty=!0,isCol2Empty=!0,noField=!0,hasFieldEditPerm=!1,hasEditableField=!1,isColumnHasField=0;let isOperationalRoleAdmin=void 0!=formId?ZP5Form.getFormsOperation(formId).isOperationalRoleAdmin():ZP5Form.getCurrFormsOperation().isOperationalRoleAdmin(),formClassObj=ZP5Form.getFormClassObj(),isUserAllowedToField=void 0!=formClassObj&&formClassObj.moduleHandler.isUserAllowedToField();$.each(formComp.formComponentDetails,function(ind){var secObj=this;void 0!==secObj.column1&&secObj.column1.length>0&&(secObj.hasField=!0,isCol1Empty&&(isCol1Empty=!1),noField=!1,$.each(secObj.column1,function(){this.fieldType!=FormConstants.FieldType.SCRIPT&&this.fieldType!=FormConstants.FieldType.AUTONUMBER&&this.fieldType!=FormConstants.FieldType.PLAIN_TEXT&&(0!==this.editperm||isOperationalRoleAdmin||isUserAllowedToField||0!=this.allowedRoleIdsForEdit.length)?(hasFieldEditPerm=!0,secObj.isFieldEditable=!0,this.isFieldDependent=ZP5Form.isFieldDependent(formComp.dependntFieldMappings,this.formComponentId)):this.fieldType==FormConstants.FieldType.PLAIN_TEXT&&(0!==this.viewperm||isOperationalRoleAdmin||isUserAllowedToField||0!=this.allowedRoleIdsForView.length)&&(secObj.isFieldEditable=!0,this.editperm=this.viewperm,this.allowedRoleIdsForEdit=this.allowedRoleIdsForView),0!=isColumnHasField||-1!=ZP5Form.skipReadOnlyFieldsTable.indexOf(tableName)&&this.isReadOnly||(isColumnHasField+=1),this.fieldType==FormConstants.FieldType.PLAIN_TEXT||this.fieldType==FormConstants.FieldType.SCRIPT||this.fieldType==FormConstants.FieldType.AUTONUMBER||this.isReadOnly||(hasEditableField=!0),this.fieldType===FormConstants.FieldType.LOOKUP&&(formComp.hasLookUp=!0),isSingleFieldModal&&-1===singleFieldModalFields.indexOf(this.formComponentId)?this.isNonDependentField=!0:this.isNonDependentField=!1})),void 0!==secObj.column2&&secObj.column2.length>0&&(secObj.hasField=!0,isCol2Empty&&(isCol2Empty=!1),noField=!1,$.each(secObj.column2,function(){this.fieldType!=FormConstants.FieldType.SCRIPT&&this.fieldType!=FormConstants.FieldType.AUTONUMBER&&this.fieldType!=FormConstants.FieldType.PLAIN_TEXT&&(0!==this.editperm||isOperationalRoleAdmin||isUserAllowedToField||0!=this.allowedRoleIdsForEdit.length)?(hasFieldEditPerm=!0,secObj.isFieldEditable=!0,this.isFieldDependent=ZP5Form.isFieldDependent(formComp.dependntFieldMappings,this.formComponentId)):this.fieldType==FormConstants.FieldType.PLAIN_TEXT&&(0!==this.viewperm||isOperationalRoleAdmin||isUserAllowedToField||0!=this.allowedRoleIdsForView.length)&&(secObj.isFieldEditable=!0,this.editperm=this.viewperm,this.allowedRoleIdsForEdit=this.allowedRoleIdsForView),isColumnHasField<2&&(-1==ZP5Form.skipReadOnlyFieldsTable.indexOf(tableName)||!this.isReadOnly)&&(isColumnHasField+=1),this.fieldType==FormConstants.FieldType.PLAIN_TEXT||this.fieldType==FormConstants.FieldType.SCRIPT||this.fieldType==FormConstants.FieldType.AUTONUMBER||this.isReadOnly||(hasEditableField=!0),this.fieldType===FormConstants.FieldType.LOOKUP&&(formComp.hasLookUp=!0),isSingleFieldModal&&-1===singleFieldModalFields.indexOf(this.formComponentId)?this.isNonDependentField=!0:this.isNonDependentField=!1}))}),(isCol2Empty||isCol1Empty||2!=isColumnHasField)&&(formComp.singleColumn=!0),formComp.hasEditableField=hasEditableField,formComp.isFieldEditable=hasFieldEditPerm,formComp.noField=noField},showNoData:function(message,type,container){let messageDesc="",template="zp_nd_nodata";if(isWebForm&&($("#zpinitloading").remove(),webFormModeChanged&&ZP5Form.getFormClassObj().isEditMode()&&type!=ZP5Form.NO_DATA.NO_PERMISSION||(container=$("#page-wrapper"))),void 0!=type)switch(type){case ZP5Form.NO_DATA.SERVER_ERROR:message=ZPI18N.getString("zp.sorryservererror"),template="zp_nd_nodata1";break;case ZP5Form.NO_DATA.LOCATION_DISABLED:message=ZPI18N.getString("zp.requestuserlocation"),messageDesc=ZPI18N.getString("zp.blockedlocation"),template="zp_nd_template";break;case ZP5Form.NO_DATA.NO_EDITABLE_FIELDS:message=ZPI18N.getString("zp.noeditablefields");break;case ZP5Form.NO_DATA.NO_FIELDS:message=ZPI18N.getString("zp.nofieldspresent");break;case ZP5Form.NO_DATA.NO_PERMISSION:""!=message&&void 0!=message||(message=ZPI18N.getString("zp.accessdeniedcontactadmin")),template="zp_nd_permission"}if(void 0!=message&&""!=message||(message=ZPI18N.getString("zp.norec")),void 0!=container&&null!=container)new EmptyPages(template,message,messageDesc,container).show();else{if(container=ZP5Form.getLayout(),!ZP5Form.getFormClassObj().isFormCustomPreview()){let formNoDataHtml='<div class="zpl_mmnu"><div class="zpl_mmnurgt"><div class="zpl_act"><div class="zpl_iwrpr"><div class="zpl_iwrprrgt zpl_crdwthful p0"><div class="zpl_act" id="noDataFormContainer"></div></div></div></div></div></div>';container.find("#zp_form_outer_container").html(formNoDataHtml),container=container.find("#noDataFormContainer")}container.html(""),new EmptyPages(template,message,messageDesc,container).show()}},showFormError:function(message,isFieldEditable,noField,mode,code){let type=noField?ZP5Form.NO_DATA.NO_FIELDS:isFieldEditable||"VIEW"==mode?void 0===message||7040==code?ZP5Form.NO_DATA.NO_PERMISSION:void 0:ZP5Form.NO_DATA.NO_EDITABLE_FIELDS;type==ZP5Form.NO_DATA.NO_EDITABLE_FIELDS&&ZP5Form.getLayout().find("#headerParent").find("#orgstructuremodel").remove(),ZP5Form.showNoData(message,type)},showErrMsg:function(message){ZP5Form.showNoData(message,ZP5Form.NO_DATA.NO_PERMISSION)},rolechange:function(obj){let formObj=ZP5Form.getFormClassObj();var roleId=$(obj).attr("value"),roleName=$(obj).find("span").text();FormCustomNew.container.find("#rolepreviewbtn").text(ZPI18N.getString("zp.showingas")+" "+roleName);var json={formId:ZP5Form.getFormClassObj().getFormsProperties().getFormId(),formMode:"ADD"};formObj.isAdminRedirect=!1,formObj.isRoleBasedPreview=!0,"-1"==roleId?(formObj.isAdminRedirect=!0,json.roleId=formObj.roleId=-1):json.roleId=formObj.roleId=roleId,formObj.isFormCustomPreview()&&FrameworkCommon.hide(formObj.FOOTER),formObj.refreshPage(json),formObj._loadingpage()},prevNextSection:function(Obj){var acttype=$(Obj).attr("acttype"),currObj=ZP5Form.getLayout().find("#zp_form_section_list").children(".zpl_act");"1"===acttype?currObj.nextAll(":visible:first").trigger("click"):currObj.prevAll(":visible:first").trigger("click")},showSection:function(LAYOUT,sectionId){if(void 0===sectionId){var firstSec=LAYOUT.find("[id^=zp_section_field_top_]:first");if(0===firstSec.length)return;sectionId=firstSec.attr("id").split("_").pop()}LAYOUT.find("[id=zp_section_field_top_"+sectionId+"]").each(function(){$(this).addClass("zpl_act")})},setDivisionOptions:function(options){$.each(options,function(index,value){var optionId=value.Id,childskipIds=[],childskipIdTypes=[];if(void 0==ZP5Form.divisionOptions[optionId]?ZP5Form.divisionOptions[optionId]={}:void 0!=ZP5Form.divisionOptions[optionId].skipList&&(childskipIds=ZP5Form.divisionOptions[optionId].skipList,childskipIdTypes=ZP5Form.divisionOptions[optionId].skipIdTypesList),void 0==ZP5Form.divisionOptions[optionId].skipList?(ZP5Form.divisionOptions[optionId].skipList=[],ZP5Form.divisionOptions[optionId].skipIdTypesList=[]):(childskipIds=ZP5Form.divisionOptions[optionId].skipList,childskipIdTypes=ZP5Form.divisionOptions[optionId].skipIdTypesList),"null"!=value.parentDivId){var parentId=value.parentDivId;if(!ZPUtil.checkIsExistInArray(childskipIds,parentId)){childskipIds.push(parentId),childskipIdTypes.push(1),ZP5Form.divisionOptions[optionId].skipList=childskipIds,ZP5Form.divisionOptions[optionId].skipIdTypesList=childskipIdTypes,void 0==ZP5Form.divisionOptions[parentId]&&(ZP5Form.divisionOptions[parentId]={});var skipIds=[],skipIdTypes=[];if(void 0==ZP5Form.divisionOptions[parentId].skipList?(ZP5Form.divisionOptions[parentId].skipList=[],ZP5Form.divisionOptions[parentId].skipIdTypesList=[]):(skipIds=ZP5Form.divisionOptions[parentId].skipList,skipIdTypes=ZP5Form.divisionOptions[parentId].skipIdTypesList),ZPUtil.checkIsExistInArray(skipIds,optionId)||(skipIds.push(optionId),skipIdTypes.push(0)),ZP5Form.divisionOptions[parentId].skipList=skipIds,ZP5Form.divisionOptions[parentId].skipIdTypesList=skipIdTypes,skipIds.length>0)for(var skipIndex=0;skipIndex<skipIds.length;skipIndex++){var currSkipId=skipIds[skipIndex];if(1==skipIdTypes[skipIndex]){var currSkipIdSkipList=ZP5Form.divisionOptions[currSkipId].skipList,currSkipIdSkipTypeList=ZP5Form.divisionOptions[currSkipId].skipIdTypesList;ZPUtil.checkIsExistInArray(currSkipIdSkipList,optionId)||(currSkipIdSkipList.push(optionId),currSkipIdSkipTypeList.push(0)),ZPUtil.checkIsExistInArray(childskipIds,currSkipId)||(childskipIds.push(currSkipId),childskipIdTypes.push(1))}else{currSkipIdSkipList=ZP5Form.divisionOptions[currSkipId].skipList,currSkipIdSkipTypeList=ZP5Form.divisionOptions[currSkipId].skipIdTypesList;ZPUtil.checkIsExistInArray(currSkipIdSkipList,parentId)||(currSkipIdSkipList.push(parentId),currSkipIdSkipTypeList.push(1))}ZP5Form.divisionOptions[currSkipId].skipList=currSkipIdSkipList,ZP5Form.divisionOptions[currSkipId].skipIdTypesList=currSkipIdSkipTypeList}ZP5Form.divisionOptions[optionId].skipList=childskipIds,ZP5Form.divisionOptions[optionId].skipIdTypesList=childskipIdTypes}}})},changeDivisionOptions:function(fcid){var skipIds=[],componentMap=ZP5Form.getFormClassObj().getSingleFieldData(fcid),selectedValues=(ZP5Form.select2.getKey(fcid,null),ZPeopleComponents.tokenfield(ZP5Form.getFieldLayout().find("select[id=zp_field_"+fcid+"]")).getAllValues()),isFieldDependent=componentMap.isdependentdivision,options=componentMap.Options;return!isFieldDependent&&void 0!=options&&options.length>0&&0===Object.keys(ZP5Form.divisionOptions).length&&ZP5Form.setDivisionOptions(options),$.each(selectedValues,function(index,value){void 0!=ZP5Form.divisionOptions[value]&&void 0!=ZP5Form.divisionOptions[value].skipList&&$.each(ZP5Form.divisionOptions[value].skipList,function(index1,value1){skipIds.push(value1)})}),skipIds},handleOrgStructureFieldChange:function(clickedObj){var fcId=clickedObj.id.split("_").pop(),fieldProperty=ZP5Form.getFormClassObj().getSingleFieldData(fcId);let fieldcontainer=ZP5Form.getFieldLayout();var selectedValue=$(fieldcontainer.find("input[fieldtype='26'][name='"+fieldProperty.labelName+"']")).val();if(fieldProperty.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE){selectOptions=ZPeopleComponents.tokenfield(fieldcontainer.find("input[fieldtype='26'][name='"+fieldProperty.labelName+"']")).getAllValues();let i=0;for(;selectOptions[i];){let option=selectOptions[i];""===selectedValue||void 0===selectedValue?selectedValue+=option.id:selectedValue=selectedValue+","+option.id,i++}}if(selectedValue.toString(),"-Select-"!=selectedValue){var parentEntityId="",parentUnitId="",key=fcId+"_"+selectedValue;fieldProperty.labelName==ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName())&&(key="",$(fieldcontainer.find("input[fieldtype='26'][name='"+ZP5Form.getEntityLabel(ZP5Form.getCurrFormsOperation().getTableName())+"']")).parent().is(":visible")&&(parentEntityId=$(fieldcontainer.find("input[fieldtype='26'][name='"+ZP5Form.getEntityLabel(ZP5Form.getCurrFormsOperation().getTableName())+"']")).val(),key+=parentEntityId),$(fieldcontainer.find("input[fieldtype='26'][name='Business_unit']")).parent().is(":visible")&&(""!=(parentUnitId=$(fieldcontainer.find("input[fieldtype='26'][name='Business_unit']")).val()).trim()?key=key+"_"+parentUnitId:key+=parentUnitId),key=""==key.trim?fcId+"_"+selectedValue:key+"_"+fcId+"_"+selectedValue);var childMap={};if(ZP5Form.orgStrutureElementChildMap.hasOwnProperty(key))childMap=ZP5Form.orgStrutureElementChildMap[key],ZP5Form.alterOrgStrutureElements(childMap,fieldProperty);else{var params={method:"getChildMap"};params.labelName=fieldProperty.labelName,params.value=selectedValue,fieldProperty.labelName==ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName())&&(""!=parentEntityId.trim()&&(params.parentEntityId=parentEntityId),""!=parentUnitId.trim()&&(params.parentUnitId=parentUnitId)),ZPeople.Request.send("/organizationStructure.zp",params,function(resultData){resultData.success?(delete resultData.success,ZP5Form.orgStrutureElementChildMap[key]=resultData,ZP5Form.alterOrgStrutureElements(resultData,fieldProperty)):ZP5Form.alterOrgStrutureElements(void 0,fieldProperty)})}}else ZP5Form.alterOrgStrutureElements(void 0,fieldProperty)},handleOrgStructureFieldInViewMode:function(){var params={method:"getChildMap"},key="";if(ZPeople.orgStructureTagMap.entity)(entityValueMap=ZP5Form.getFieldValueFromLabelName(ZP5Form.getEntityLabel(ZP5Form.getCurrFormsOperation().getTableName()))).hasOwnProperty("value")&&""!=entityValueMap.value.trim()&&(key=entityValueMap.fcid+"_"+entityValueMap.value),params.labelName=ZP5Form.getEntityLabel(ZP5Form.getCurrFormsOperation().getTableName()),params.value=entityValueMap.value;else if(ZPeople.orgStructureTagMap.unit){(unitValueMap=ZP5Form.getFieldValueFromLabelName("Business_unit")).hasOwnProperty("value")&&""!=unitValueMap.value.trim()&&(key=unitValueMap.fcid+"_"+unitValueMap.value),params.labelName="Business_unit",params.value=unitValueMap.value}else if(ZPeople.orgStructureTagMap.division){var unitValueMap,entityValueMap,divValueMap=ZP5Form.getFieldValueFromLabelName(ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName()));divValueMap.hasOwnProperty("value")&&""!=divValueMap.value.trim()&&(key=divValueMap.fcid+"_"+divValueMap.value),(unitValueMap=ZP5Form.getFieldValueFromLabelName("Business_unit")).hasOwnProperty("value")&&""!=unitValueMap.value.trim()&&(params.parentUnitId=unitValueMap.value),(entityValueMap=ZP5Form.getFieldValueFromLabelName(ZP5Form.getEntityLabel(ZP5Form.getCurrFormsOperation().getTableName()))).hasOwnProperty("value")&&""!=entityValueMap.value.trim()&&(params.parentEntityId=entityValueMap.fcid+"_"+entityValueMap.value),params.labelName=ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName()),params.value=divValueMap.value}""==key.trim()||ZP5Form.orgStrutureElementChildMap.hasOwnProperty(key)?""!=key.trim()&&ZP5Form.alterOrgStrutureElementsInViewMode(ZP5Form.orgStrutureElementChildMap[key],params.labelName):ZPeople.Request.send("/organizationStructure.zp",params,function(resultData){resultData.success&&(delete resultData.success,ZP5Form.orgStrutureElementChildMap[key]=resultData,ZP5Form.alterOrgStrutureElementsInViewMode(resultData,params.labelName))})},getFieldValueFromLabelName:function(labelName){var record=ZP5Form.getSingleRecord().record.message.recordDetails,value="",fcid="";void 0!=record&&$.each(record,function(index1,value1){var column1=value1.column1;if(void 0!=column1&&($.each(column1,function(index2,value2){if(value2.componentName==labelName)return value=value2.componentValue_ID+"",fcid=value2.formComponentId,!1}),""!=fcid.trim()))return!1;var column2=value1.column2;return(void 0==column2||($.each(column2,function(index3,value3){if(value3.componentName==labelName)return value=value3.componentValue_ID+"",fcid=value3.formComponentId,!1}),""==fcid.trim()))&&void 0});var elementMap={};return""!=fcid.trim()&&(elementMap.value=value,elementMap.fcid=fcid),elementMap},alterOrgStrutureElementsInViewMode:function(childMap,labelName){let layoutcontainer=ZP5Form.getLayout(),fiedContainer=ZP5Form.getFieldLayout();if(ZP5Form.isOrgValuePresent.deptPresent&&(layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgdept").removeClass("DN"),layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgdept").next().removeClass("DN")),ZP5Form.isOrgValuePresent.divFieldPresent&&(layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgdivi").removeClass("DN"),layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgdivi").next().removeClass("DN")),ZP5Form.isOrgValuePresent.unitFieldPresent&&(layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgunit").removeClass("DN"),layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgunit").next().removeClass("DN")),ZPeople.orgStructureTagMap.department&&childMap.hasOwnProperty("department")&&!childMap.department){var deptFcid=ZP5Form.getFieldValueFromLabelName(ZP5Form.getDepartmentLabel(ZP5Form.getCurrFormsOperation().getTableName())).fcid;$(fiedContainer.find("#zp_field_outer_"+deptFcid)).parent().addClass("DN"),layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgdept").addClass("DN"),layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgdept").next().addClass("DN")}if(ZPeople.orgStructureTagMap.division&&childMap.hasOwnProperty("division")&&!childMap.division){var divFcid=ZP5Form.getFieldValueFromLabelName(ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName())).fcid;$(fiedContainer.find("#zp_field_outer_"+divFcid)).parent().addClass("DN"),layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgdivi").addClass("DN"),layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgdivi").next().addClass("DN")}if(ZPeople.orgStructureTagMap.unit&&childMap.hasOwnProperty("unit")&&!childMap.unit){var unitFcid=ZP5Form.getFieldValueFromLabelName("Business_unit").fcid;$(fiedContainer.find("#zp_field_outer_"+unitFcid)).parent().addClass("DN"),layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgunit").addClass("DN"),layoutcontainer.find("#headerParent").find("#orgstructuremodel").find("#orgunit").next().addClass("DN")}},alterOrgStrutureElements:function(childMap,fieldProp){let LAYOUT=ZP5Form.getFieldLayout();if(void 0==childMap){var labelName=fieldProp.labelName;if(ZPeople.orgStructureTagMap.department){$(LAYOUT.find("input[fieldtype='26'][name='"+ZP5Form.getDepartmentLabel(ZP5Form.getCurrFormsOperation().getTableName())+"']")).parent().parent().parent().show();let selectOptions=ZP5Form.getFormClassObj().getSelect2FieldOptions(fieldProp.formComponentId,LAYOUT.find("input[fieldtype='26'][name='"+ZP5Form.getDepartmentLabel(ZP5Form.getCurrFormsOperation().getTableName())+"']"),fieldProp);ZPeopleComponents.select(LAYOUT.find("input[fieldtype='26'][name='"+ZP5Form.getDepartmentLabel(ZP5Form.getCurrFormsOperation().getTableName())+"']"),selectOptions).setValue("-Select-")}if(("Business_unit"==labelName||labelName==ZP5Form.getEntityLabel(ZP5Form.getCurrFormsOperation().getTableName()))&&ZPeople.orgStructureTagMap.division){let Field=LAYOUT.find("[fieldtype='26'][name="+ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName())+"]");$(Field).parent().parent().parent().show();let isToken="tokenfield"===Field.attr("zcomponentname"),selectOptions=ZP5Form.getFormClassObj().getSelect2FieldOptions(fieldProp.formComponentId,LAYOUT.find("input[fieldtype='26'][name="+ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName())+"]"),fieldProp);isToken?ZPeopleComponents.tokenfield(Field).removeAllTokens():ZPeopleComponents.select(Field,selectOptions).setValue("-Select-")}if(labelName==ZP5Form.getEntityLabel(ZP5Form.getCurrFormsOperation().getTableName())&&ZPeople.orgStructureTagMap.unit){$(LAYOUT.find("input[fieldtype='26'][name='Business_unit']")).parent().parent().parent().show();let selectOptions=ZP5Form.getFormClassObj().getSelect2FieldOptions(fieldProp.formComponentId,LAYOUT.find("input[fieldtype='26'][name='Business_unit']"),fieldProp);ZPeopleComponents.select(LAYOUT.find("input[fieldtype='26'][name='Business_unit']"),selectOptions).setValue("-Select-")}}else{if(childMap.hasOwnProperty("unit")){let field=LAYOUT.find("input[fieldtype='26'][name='Business_unit']");if(0!=field.length)if(childMap.unit){$(field).parent().parent().parent().show();let selectOptions=ZP5Form.getFormClassObj().getSelect2FieldOptions(fieldProp.formComponentId,field,fieldProp);ZPeopleComponents.select(field,selectOptions).setValue("-Select-")}else ZPeopleComponents.select(field).setValue("-Select-"),$(field).parent().parent().parent().hide()}if(childMap.hasOwnProperty("division")){let Field=LAYOUT.find("[fieldtype='26'][name="+ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName())+"]");if(0!=Field.length){let isToken="tokenfield"===Field.attr("zcomponentname");if(childMap.division){if($(Field).parent().parent().parent().show(),!isToken){let selectOptions=ZP5Form.getFormClassObj().getSelect2FieldOptions(fieldProp.formComponentId,Field,fieldProp);ZPeopleComponents.select(Field,selectOptions).setValue("-Select-")}}else isToken||ZPeopleComponents.select(Field).setValue("-Select-"),$(Field).parent().parent().parent().hide();isToken&&ZPeopleComponents.tokenfield(Field).removeAllTokens()}}if(childMap.hasOwnProperty("department")){let field=LAYOUT.find("[fieldtype='26'][name="+ZP5Form.getDepartmentLabel(ZP5Form.getCurrFormsOperation().getTableName())+"]");if(0!=field.length)if(childMap.department){$(field).parent().parent().parent().show();let selectOptions=ZP5Form.getFormClassObj().getSelect2FieldOptions(fieldProp.formComponentId,field,fieldProp);ZPeopleComponents.select(field,selectOptions).setValue("-Select-")}else ZPeople.orgStructureTagMap.department&&($(field).parent().parent().parent().hide(),ZPeopleComponents.select(field).setValue("-Select-"))}}},isFieldDependent:function(mappings,fcid){return void 0!=mappings[fcid]},getToolTipHtml:function(fcid,description,descriptionType,viewType,row,isInfoAllowed,infoObj){let toolTip,infoHtml="";if(""!==(toolTip=void 0!==description&&""!==description.trim()?description:""))if(void 0!=descriptionType&&descriptionType==FormConstants.ToolTip.INFO_ICON||"MASSUPDATE"==viewType){if(isInfoAllowed){let contentPosition="right",id="infoTooltip_"+(void 0!=row?fcid+"_"+row:fcid+"_1");switch(viewType){case"TABULAR-GRID":infoHtml=`<span elem='viewToolTip'><i class="PI_info" id="${id}"></i></span>`;break;case"MASSUPDATE":infoHtml=`<span class="PI_info" id="${id}"></span>`,contentPosition="auto";break;default:infoHtml=`<i class="PI_info" id="${id}"></i>`}void 0!=infoHtml&&(infoObj.addToolTipId(id),infoObj.getContainer().append(`<div class="wauto" style="max-width: 300px;" id="${id}_content" for-element="#${id}" position="${contentPosition}">${toolTip.replaceAll("\n","<br>")}</div>`))}toolTip=""}else toolTip='placeholder="'+toolTip+'"';return{infoHtml:infoHtml,toolTip:toolTip}},addMultiLineTooltip:function(){let multiLineElement=event.target,id=multiLineElement.id,formClassObj=ZP5Form.getFormClassObj();(multiLineElement.offsetWidth<multiLineElement.scrollWidth||multiLineElement.scrollHeight>multiLineElement.clientHeight)&&($(multiLineElement).removeAttr("onmouseover"),formClassObj.getInfoToolTipObj().addPopoverId(id),formClassObj.getInfoToolTipObj().getContainer().append(`<div id="${id}_content" for-element="#${id}"><div class="zpl_w300 zpl_maxhgt300 zpl_oya zpl_pa4"><p>${multiLineElement.innerHTML}</p></div></div>`),formClassObj.getInfoToolTipObj().constructTooltips(),$(multiLineElement).trigger("mouseover"))},getMultiLineTooltipId:function(fcid,row,formClassObj,isPrint){if(!isPrint){let id="multiLinepopover_"+(void 0!=row?fcid+"_"+row:fcid+"_1");return formClassObj.getParams().isProfileView&&(id+="_profile_"+formClassObj.getRecordId()),id}return""},formulaConstruction:function(formId){if(void 0==ZP5Form.getFormsOperation(formId).getFormsDetailsMap()||void 0==ZP5Form.getFormsOperation(formId).getFormsDetailsMap().formulaList)return!1;if(0==$("body").find("script[id="+formId+"]").length){var formLabelName=ZP5Form.getFormsOperation(formId).getFormsDetailsMap().formName,formFormulaFuncList="<script id="+formId+">formulaUtil['"+formLabelName+"']={",formulaSecList=ZP5Form.getFormsOperation(formId).getFormsDetailsMap().formulaList;null!=formulaSecList&&void 0!=formulaSecList&&$.each(formulaSecList,function(secId,formulaList){null!=formulaList&&void 0!=formulaList&&$.each(formulaList,function(formulaFcId,formulaData){if(void 0==ZP5Form.getFormClassObj().getSingleFieldData(formulaFcId))return!0;var formulaLabelName=ZP5Form.getFormClassObj().getSingleFieldData(formulaFcId).labelName,formula=formulaData.Formula,parser=formulaData.Parser;"P_Employee"==formLabelName&&"Experience"==formulaLabelName&&(formula="GetExperience('Month',Dateofjoining,Dateofexit)",parser="Dateofjoining, Dateofexit");var fieldsList=parser.split(", "),formulaFunc=formulaLabelName+":function(formulaValObj){";for(i=0;i<fieldsList.length;i++){var field=fieldsList[i];""!=field&&(formulaFunc=formulaFunc+"var "+field+" = formulaValObj."+field+";")}formFormulaFuncList+=formulaFunc+="return "+formula+";},"})}),formFormulaFuncList+="}<\/script>",$("body").append(formFormulaFuncList)}},convertValuetoDataType:function(value,fieldType){if(null!=fieldType&&void 0!=fieldType&&null!=value&&void 0!=value)switch(fieldType){case FormConstants.FieldType.NUMBER:return parseInt(value);case FormConstants.FieldType.DECIMAL:case FormConstants.FieldType.CURRENCY:return parseFloat(value);case FormConstants.FieldType.EMAIL_ADDRESS:case FormConstants.FieldType.URL:case FormConstants.FieldType.TEXT:case FormConstants.FieldType.PICKLIST:return"-Select-"===value?"":value;case FormConstants.FieldType.DATE_TIME:if(value.trim().length<2)return"";var dateObj=Calendar.parseDate(value,uidateFormat,!0);if(Calendar.is12HrFormat()){var hrs=dateObj.getHours(),ampm=value.split(" ")[2];"AM"==ampm&&12==hrs?dateObj.setHours(0):"PM"==ampm&&hrs<12&&dateObj.setHours(hrs+12)}return value=dateObj.getTime();case FormConstants.FieldType.DATE:return value.trim().length<2?"":value=(value=Calendar.parseDate(value,uidateFormat)).getTime()}return""},delay:function(callback,ms){var timer=0;return function(){var context=this,args=arguments;clearTimeout(timer),timer=setTimeout(function(){callback.apply(context,args)},ms||0)}},getFcidFromLabelName:function(fieldLabelName){var fieldfcId,fieldsMap=ZP5Form.getFormClassObj().getFormsProperties().getFieldData();return $.each(fieldsMap,function(fieldId,fieldInfo){if(fieldInfo.labelName==fieldLabelName)return fieldfcId=fieldId,!1}),fieldfcId},getFieldValues:function(section,fields,fieldValues,rowno){let tableName=ZP5Form.getCurrFormsOperation().getTableName(),fieldcontainer=ZP5Form.getFieldLayout();$.each(section,function(){if(ZPUtil.checkIsExistInArray(fields,this.formComponentId)){var formField=$(fieldcontainer.find(":input[name="+this.labelName+"]"));if(formField.length>1)if(null!=rowno&&void 0!=rowno)formField=$(fieldcontainer.find(":input[name="+this.labelName+"]")[rowno]);else if(this.isTabular)return;let value;if(0===formField.length){var id=ZP5Form.Field.getFieldValueData(this.formComponentId);if(void 0!=id&&("object"==typeof(value=id.componentValue_ID)&&value.length>0&&null!=rowno&&void 0!=rowno&&(value=value[rowno]),("P_Employee"==tableName||"P_Candidate"==tableName)&&this.labelName==ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName()))){var valueString="";return value.length>0&&($.each(value,function(index1,value1){valueString=""==valueString.trim()?value1:valueString+","+value1}),""!=valueString.trim()&&(value=valueString)),void(fieldValues[this.formComponentId]=value)}}else{var returnObj=ZP5Form.Validation.validateField(ZP5Form.getFormClassObj(),{errorList:[]},this,formField,!1);void 0!==returnObj&&0==returnObj.result.errorList.length&&(value=returnObj.value)}void 0!=value&&("P_Employee"!=tableName&&"P_Candidate"!=tableName||this.labelName!=ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName())?Array.isArray(value)?fieldValues[this.formComponentId]=value.join(";"):fieldValues[this.formComponentId]=value:fieldValues[this.formComponentId]=value.replace(/;/g,","))}})},setTime:function(ele){var value=Layout.Page.container.find(ele).attr("value");Layout.Page.container.find(ele).parent().parent().siblings("input").val(value)},toggleSection:function(Obj){let formClassObj=ZP5Form.getFormClassObj(),container=formClassObj.LAYOUT,footer=formClassObj.FOOTER;var sectionId=$(Obj).attr("secid");container.find("#zp_form_section_list").children(":visible").length>1?(footer.find("#zp_forms_next_btn").removeClass("zpl_DNI"),0===$(Obj).nextAll(":visible").length?footer.find("#zp_forms_next_btn").addClass("zpl_DNI"):footer.find("#zp_forms_next_btn").removeClass("zpl_DNI"),0===$(Obj).prevAll(":visible").length?footer.find("#zp_forms_prev_btn").addClass("zpl_DNI"):footer.find("#zp_forms_prev_btn").removeClass("zpl_DNI")):footer.find("#zp_forms_prev_btn, #zp_forms_next_btn").addClass("zpl_DNI"),$(Obj).addClass("zpl_act").siblings().removeClass("zpl_act"),container.find("#zp_section_field_top_"+sectionId).siblings("[id^=zp_section_field_top_]").removeClass("zpl_act"),ZP5Form.showSection(container,sectionId)},getSingleRecord:function(formId,recordId){if(void 0===formId||void 0===recordId){let formclassOBj=ZP5Form.getFormClassObj().getFormsProperties();formId=formclassOBj.getFormId(),recordId=formclassOBj.getRecordId()}return ZP5Form.getForm(formId).getRecordDetails(recordId)},clearRecordCache:function(formId,recordId){return ZP5Form.getForm(formId).clearRecordCache(recordId)},handleRecordValueChange:function(formId,recordIds){let formClassObj=ZP5Form.getFormClassObj();$.each(recordIds,function(ind,recordId){void 0!=ZP5Form.getFormsOperation(formId).getRecordDetails(recordId)&&(ZP5Form.getFormsOperation(formId).updateRecordDetails(recordId,"refresh",!0),void 0!=formClassObj&&formId==formClassObj.getFormsProperties().getFormId()&&recordId==formClassObj.getFormsProperties().getRecordId()&&formClassObj.isViewMode()&&!formClassObj.isSingleFiledEdit()&&formClassObj.refreshPage(formClassObj.getParams()))})},isApprover:function(){if("P_Goals"==ZP5Form.getCurrFormsOperation().getTableName()&&AppraisalConfig.GOALSHEETAPPROVER)return!0;let formclassOBj=ZP5Form.getFormClassObj().getFormsProperties();if(formId=formclassOBj.getFormId(),recordId=formclassOBj.getRecordId(),ZP5Form.isApprovalEnabled(formId)){var recordDtl=ZP5Form.getSingleRecord(formId,recordId);if(7e3===recordDtl.record.code&&recordDtl.record.isPrimaryAppr)return recordDtl.record.isPrimaryAppr}return!1},isApprovalStarted:function(formId,recordId){if(ZP5Form.isApprovalEnabled(formId)){var recordDtl=ZP5Form.getSingleRecord(formId,recordId),isRecordAdmin=recordDtl.record.isRecordAdmin;if(7e3===recordDtl.record.code){var currentStatus=recordDtl.record.message.approvalStatus;if(!(isRecordAdmin||ZP5Form.getFormsOperation(formId).getFormsDetailsMap().approvalSettingsDetails.isEditAllow||recordDtl.record.isPrimaryAppr||currentStatus===zpconst.ApprovalStatus.NotSubmitedd||currentStatus===zpconst.ApprovalStatus.NoStatus||ZP5Form.getFormClassObj().isDraftrec))return!1}}return!0},isTaskOwnerCanEdit:function(formId){return ZP5Form.isApprovalEnabled(formId)?!!ZP5Form.getFormsOperation(formId).getFormsDetailsMap().approvalSettingsDetails.isEditAllow&&ZP5Form.getSingleRecord().record.isTaskOwner:ZP5Form.getSingleRecord().record.isTaskOwner},getRecordOwnerList:function(){var singlerecObj=ZP5Form.getSingleRecord();if(void 0!==singlerecObj&&void 0!==singlerecObj.record){var recDtl=singlerecObj.record;if(7e3===recDtl.code)return recDtl.message.ownerID}return[]},isRefresh:function(){var record=ZP5Form.getSingleRecord();return!(void 0!==record&&!record.refresh)},setSingleRecordDetail:function(resultData,formId,recordId){ZP5Form.getFormsOperation(formId).setRecordDetails(recordId,{record:resultData,refresh:!1})},getSectionComponent:function(resultObject,sectionId){var secComp;return $.each(resultObject,function(){if(this.sectionId===sectionId)return secComp=this,!1}),secComp},expandTabluarSection:function(obj,isExpand){let layOut=ZP5Form.getLayout();var secId=$(obj).attr("secid"),tableobjParent=layOut.find("#zp_section_fields_"+secId),tableobj=$(tableobjParent).find("table");isExpand&&$.each($(tableobj).find("tr"),function(){$(this).removeClass("DN")}),$(obj).remove(),tableobjParent.find("table").removeClass("hidetbl-lst")},constructDownloadLink:function(obj){var downloadURL="";if(UDS_DOWNLOAD_IS_ACTIVE){var currentTime=(new Date).getTime(),eventid=_LOGGEDIN_ZUID+"_"+currentTime;obj.portalId=_LOGGEDIN_ACCZSOID,obj.mode="FORMS",obj.hasOwnProperty("impId")?eventid+="_"+obj.impId:(obj.hasOwnProperty("original")||(obj.original="true"),eventid+="_"+obj.recordId+"_"+obj.fcId),void 0!=ZPeople.zaid&&(obj.zaid=ZPeople.zaid);var myJson=JSON.stringify(obj);downloadURL=UDS_DOWNLOAD_URL+"/webdownload?x-service="+UDS_DOWNLOAD_SERVICE_CODE+"&event-id="+eventid+"&x-cli-msg="+encodeURIComponent(myJson),void 0!=ZPeople.zaid&&(downloadURL+="&x-cli-zaid="+ZPeople.zaid)}else{for(var key in obj.hasOwnProperty("original")||(obj.original="true"),obj)downloadURL+="&"+key+"="+obj[key];downloadURL="null"!=contextPath?"/"+contextPath+"/download?"+downloadURL.substring(1):"/download?"+downloadURL.substring(1)}return downloadURL},onDesktopUpload:function(event){"fileuploadinput"!=$(event.target).attr("elem")&&$(event.target).closest("[name='fileuploadelem']").find("[elem=fileuploadinput]").trigger("click")},uploadViaXHRs:function(ele){for(var fileStore=ele.files,i=0;i<fileStore.length;i++)ZP5Form.uploadFileByXHR(fileStore[i],ele)},uploadFileByXHR:function(file,obj){var fieldId=obj.getAttribute("id");obj=ZP5Form.getFieldLayout().find(`#${fieldId}`)[0];var fcId=fieldId.substring(fieldId.lastIndexOf("_")+1),formC=ZP5Form.Field.getFieldComponent(fcId),fieldType=parseInt(obj.getAttribute("fieldType"));if(!(file.size>formC.maxSizeBytes||file.size<=0||fieldType===FormConstants.FieldType.IMAGE&&!ZP5Form.FILEUPLOAD_IMAGES.isAllowedFormatForImage(file.name))){var xhr=new XMLHttpRequest,tableName=ZP5Form.getCurrFormsOperation().getTableName(),fieldName=obj.getAttribute("name"),rowNum=$(obj).closest('[id="zp_tabular_row"]').attr("row");void 0==rowNum&&(rowNum=void 0==(rowNum=$(obj).closest('[isgrid="false"]').attr("row"))?"1":rowNum);var uploadId=(new Date).getTime()+"_"+_LOGGEDIN_ZUID+"_"+fcId;xhr.upload.uploadId=uploadId;var udsUploadApi=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload";xhr.open("post",udsUploadApi,!0),xhr.setRequestHeader("x-assured-response",!0),void 0!=ZPeople.zaid&&xhr.setRequestHeader("x-cli-zaid",ZPeople.zaid),xhr.setRequestHeader("x-streammode","1"),xhr.setRequestHeader("x-fclient-version","2");var params={portalId:_LOGGEDIN_ACCZSOID,moduleName:"Forms",rowNum:rowNum,fcId:fcId,fieldName:fieldName,fieldType:fieldType,formTableName:tableName,zaid:ZPeople.zaid};ZP5Form.getFormClassObj().moduleHandler.loadFileUploadParams(fieldName,params),params=JSON.stringify(params),xhr.setRequestHeader("app-info",params),xhr.setRequestHeader("file-info",JSON.stringify({fileName:encodeURIComponent(file.name),contentType:file.type,fileSize:file.size})),xhr.setRequestHeader("upload-id",uploadId),xhr.withCredentials=!0,xhr.onreadystatechange=function(oEvent){if(4==xhr.readyState)if(200===xhr.status){var responseObj=JSON.parse(xhr.response);ZP5Form.uploadCallBack(responseObj)}else ZP5Form.failureCallBack(JSON.parse(params),!1,JSON.parse(xhr.getResponseHeader("x-error")))},ZP5Form.Field.removeFileUploadDoc(fieldName,rowNum),xhr.send(file)}},uploadCallBack:function(uploadedFileInfo){this.uploadedFileInfo=uploadedFileInfo;let fieldContainer=ZP5Form.getFieldLayout();if(uploadedFileInfo.fileInfo){var fileInfo=uploadedFileInfo.fileInfo,progressDiv=fieldContainer.find("div[data-progressjs='"+fileInfo.fcId+fileInfo.rowNum+"']");0!=progressDiv.length&&($(progressDiv).closest("[folabel="+fileInfo.fieldName+"]").find("[id=afterUpload]").find("[restoreoptionenabled=true]").removeClass("DNI"),fieldContainer.find("[folabel="+fileInfo.fieldName+"]").find(".zpl_fldrp.ztextbox__error").removeClass("ztextbox__error"),$(progressDiv).closest("[folabel="+fileInfo.fieldName+"]").find('[id="error_message"]').remove(),$(progressDiv).closest(".zp-err").removeClass("zp-err"),progressJs("div[data-progressjs='"+fileInfo.fcId+fileInfo.rowNum+"']").end(),progressDiv.parent().removeClass(),progressDiv.parent().parent().parent().removeClass(),progressDiv[0].style.width="100%",ZP5Form.Field.removeFileUploadDoc(fileInfo.fieldName,fileInfo.rowNum),$(fieldContainer.find("[name="+fileInfo.fieldName+"]")[fileInfo.rowNum-1]).val(""),$(fieldContainer.find("[name="+fileInfo.fieldName+"]")[fileInfo.rowNum-1]).parent().find("#filename").val(fileInfo.fileId),ZP5Form.getFormClassObj().moduleHandler.notifyUploadSuccess(uploadedFileInfo))}else if("Failure"==uploadedFileInfo.status){var antivirus=!1,error=!1;"Virus Found"==uploadedFileInfo.message?antivirus=!0:"An error occured in the File Transfer"==uploadedFileInfo.message&&(error=!0),ZP5Form.failureCallBack(uploadedFileInfo,antivirus,error)}},failureCallBack:function(uploadedFileInfo,antivirus,error){var progressDiv=ZP5Form.getFieldLayout().find("div[data-progressjs='"+uploadedFileInfo.fcId+uploadedFileInfo.rowNum+"']");0!=progressDiv.length&&($(progressDiv).closest("[folabel="+uploadedFileInfo.fieldName+"]").find('[id="error_message"]').remove(),$(progressDiv).closest(".zp-err").removeClass("zp-err"),progressJs("div[data-progressjs='"+uploadedFileInfo.fcId+uploadedFileInfo.rowNum+"']").kill(),ZP5Form.Field.removeFileUploadDoc(uploadedFileInfo.fieldName,uploadedFileInfo.rowNum),setTimeout(function(){$(progressDiv).closest("[folabel="+uploadedFileInfo.fieldName+"]").find("[id=afterUpload]").find("[restoreoptionenabled=true]").removeClass("DNI"),progressDiv.parent().parent().parent().addClass("zpl_flerr");var errorCode,errors={};null==error&&void 0==error||(errorCode=error.hasOwnProperty("errorCode")?error.errorCode:null),antivirus?(progressDiv.parent().parent().siblings(".zpl_atchdtl").children('p[elem="file-info"]').children("[isFileSize=true]").after('<a class="zpl_retry" elem="fileUpload_reupload" onclick="ZP5Form.Field.toggleFileFieldDisplay(this, \''+uploadedFileInfo.fieldName+'\')"><i class="PI_reload"></i>'+ZPI18N.getString("zp.reupload")+"</a>"),errors[uploadedFileInfo.fieldName]=ZPI18N.getString("zp.virusfile")):(progressDiv.parent().parent().siblings(".zpl_atchdtl").children('p[elem="file-info"]').children("[isFileSize=true]").after('<a class="zpl_retry" elem="fileUpload_retry" onclick="ZP5Form.Field.reUploadFile(this, \''+uploadedFileInfo.fieldName+'\')"><i class="PI_refresh"></i>'+ZPI18N.getString("zp.retry")+"</a>"),errors[uploadedFileInfo.fieldName]=100===errorCode?ZPI18N.getString("zp.maxuploadfilesize",[error.fieldSize]):ZPI18N.getString("zp.reuploadfile")),errors.row=uploadedFileInfo.rowNum,ZP5Form.Field.markFieldAsError(uploadedFileInfo.fieldName,errors)},1e3))},markSectionError:function(sectionId){let container=ZP5Form.getLayout(),fieldContainer=ZP5Form.getFieldLayout(),sectionIds=sectionId?"#zp_form_section_"+sectionId:"[id^=zp_form_section_]";container.find("#zp_form_section_list").find(sectionIds).each(function(){var secId=$(this).attr("secid");void 0!==secId&&(0!==fieldContainer.find("#zp_section_fields_"+secId).find("[id=error_message]").length?0===$(this).find(".IC-info, .IC-rou-tik").length?$(this).append('<i class="PI_info red"></i>').addClass("err"):$(this).find(".IC-rou-tik").length>0&&$(this).addClass("err").find(".IC-rou-tik").removeClass("IC-rou-tik").attr("class","PI_info red"):0===$(this).find(".IC-info, .IC-rou-tik").length?$(this).append('<i class="PI_tick grn"></i>').removeClass("err"):$(this).find(".IC-info").length>0&&$(this).removeClass("err").find(".IC-info").removeClass("IC-info").attr("class","PI_tick grn"))})},isFormPage:function(){var result=!1;return(0===Layout.Page.hash.indexOf("#form/")||Layout.Page.modulemode&&0===Layout.Page.hash.indexOf("#home/form/")||0===Layout.Page.hash.indexOf("#organization/employee")||0===Layout.Page.hash.indexOf("#organization/department")||0===Layout.Page.hash.indexOf("#leavetracker/views/form"))&&(result=!0),result},isApprovalEnabled:function(formId){if(void 0!=ZP5Form.getFormClassObj()&&void 0!==ZP5Form.getFormClassObj().getParams().isApprovalEnabled)return ZP5Form.getFormClassObj().getParams().isApprovalEnabled;let approvalSetDetails=ZP5Form.getFormsOperation(formId).getFormsDetailsMap().approvalSettingsDetails;return void 0!==approvalSetDetails&&void 0!==approvalSetDetails.isApprovalEnabled&&approvalSetDetails.isApprovalEnabled},isAllowedToEdit:function(mode,formId,fcids,isMassUpdate){var apprNotEditStatus=[zpconst.ApprovalStatus.Cancelled,zpconst.ApprovalStatus.Revoked,ZP5Form.draftstatus,zpconst.ApprovalStatus.NoStatus,zpconst.ApprovalStatus.NotSubmitedd];if(ZP5Form.isApprovalEnabled(formId)&&ZP5Form.getFormsOperation(formId).getFormsDetailsMap().approvalSettingsDetails.isEditAllow&&(isMassUpdate||"ADD"!=mode&&!ZPUtil.checkIsExistInArray(apprNotEditStatus,ZP5Form.getSingleRecord().record.message.approvalStatus))){if(void 0==fcids&&"EDIT"==mode)return!0;var fcvList=ZP5Form.getFormsOperation(formId).getFormsDetailsMap().approvalSettingsDetails.fieldValueChange.fcList;if(fcids.length>0&&0===fcvList.length)return!0;for(var index=0;index<fcvList.length;index++)if(ZPUtil.checkIsExistInArray(fcids,fcvList[index].fcId))return!0}return!1},validateApprovalComment:function(type,comment,approvalSettings,commentBoxObj){return!ZP5Form.isMandatoryApprovalComment(type,approvalSettings)||(Layout.Page.container.find("#cmtErrMsg").remove(),!ZPUtil.Validation.isEmpty(comment)||($(ZPApprovals.getMandatoryCommentErrHTML(ZPI18N.getString("zp.apprCmtMandatoryErr"))).insertAfter(commentBoxObj),!1))},isMandatoryApprovalComment:function(type,approvalSettings){return approvalSettings&&(type==zpconst.ApprovalStatus.Approved&&1==approvalSettings.isApprMandatory||type==zpconst.ApprovalStatus.Rejected&&1==approvalSettings.isRejMandatory)},getLookupRefreshStatus:function(fcid,refFormId){var lookUpData=ZP5Form.LOOKUP_DATA[refFormId],refresh=!1;return void 0!==lookUpData&&(refresh=lookUpData.refresh,void 0!==lookUpData.updatedFcIds&&-1!==lookUpData.updatedFcIds.indexOf(fcid)&&(refresh=!1)),refresh},uniqueErrorClose:function(){ZP5Form.getLayout().find("#errorHead").fadeOut(1e3)},loadApprovalRecordByMode:function(formId,recordId,mode,formName){var params={formId:formId,recordId:recordId,formMode:void 0!==mode?mode:"VIEW",isPageMode:!1,isEditDisabled:!0,disableUrlTrack:!0,editCallback:ZPApprovals.loadApprovalRecordByEdit,modalCloseCallback:ZPApprovals.closePopCallback};if(void 0!=formName&&"Leave"===formName){var leaveForm=new LeaveForm;params.fieldFormat=["Employee_ID","Leavetype","From","To","TeamEmailID","Reasonforleave"],params.onloadCallback=leaveForm.onload,params.editCallback=leaveForm.switchToEdit,params.disableSingleEdit=!0,params.isLeave=!0}else void 0!=formName&&"Compensatory"===formName&&(params.onloadCallback=LeaveCompensatory.loadExtraInfo,params.disableSingleEdit=!0);ZP5Form.load(params)},constructSingleFieldRecordDetails:function(singledet){let recordMap={};if(void 0!=singledet&&7e3==singledet.record.code){var recordDetails=singledet.record.message.recordDetails;$.each(recordDetails,function(){this.isTabular&&this.isGridType?recordMap[this.sectionId]=this:(void 0!=this.column1&&$.each(this.column1,function(ind,fieldData){recordMap[this.formComponentId]=this}),void 0!=this.column2&&$.each(this.column2,function(ind,fieldData){recordMap[this.formComponentId]=this}))}),ZP5Form.getFormClassObj().setSingleFieldRecordDetails(recordMap)}},checkGridSectionFieldEditable:function(secObj){var isEditable=!1;return $.each(secObj.isEditable,function(value){if(secObj.isEditable[value])return isEditable=!0,!1}),isEditable},checkSectionFieldEditable:function(secObj){var isEditable=!1;return void 0!==secObj.column1&&secObj.column1.length>0&&$.each(secObj.column1,function(){if(this.isEditable)return isEditable=!0,!1}),void 0!==secObj.column2&&secObj.column2.length>0&&!isEditable&&$.each(secObj.column2,function(){if(this.isEditable)return isEditable=!0,!1}),isEditable},constructSelect2Options:function(fcid,elem,selectObj,term,page){let formClassObj=ZP5Form.getFormClassObj(),currparams=formClassObj.getParams();var results=[],tabularelement="",fieldDataMap=ZP5Form.getFormClassObj().getSingleFieldData(fcid);fieldDataMap.isTabular&&!fieldDataMap.isGridType?tabularelement=$(elem).closest('[istabular=true][name="sections_obj"]'):fieldDataMap.isTabular&&fieldDataMap.isGridType&&(tabularelement=$(elem).closest('tr[id="zp_tabular_row"]'));var row=null;void 0!=tabularelement&&tabularelement.length>0&&(row=parseInt($(tabularelement).attr("row"))-1),key=ZP5Form.select2.getKey(fcid,row),1==page&&parseInt(fieldDataMap.displayType)===FormConstants.FieldType.SELECT_DISPLYTYPE&&""==term&&results.push({id:"-Select-",text:ZPI18N.getString("zp.select")});var isRefresh=ZP5Form.getLookupRefreshStatus(fcid,fieldDataMap.referredFormId)||formClassObj.moduleHandler.isRefreshLookup();ZP5Form.select2.OPTIONS[key]&&!isRefresh||(ZP5Form.select2.OPTIONS[key]={});var isDirectFetch=isRefresh||fieldDataMap.dependentFiledList&&fieldDataMap.dependentFiledList.length>0,isnew=!0;if(currparams.lookupValue&&"Employee_ID"===fieldDataMap.labelName)if(-1!=Layout.Page.hash.indexOf("selfservice/leave/list")||-1!=Layout.Page.hash.indexOf("selfservice/user/calendar")){var user_detail=ZPeople.getUserDetailsById(ZPDashboard.getUserId(currparams.lookupValue));results.push({id:currparams.lookupValue,text:ZPeople.decodeTxt(user_detail.name+",&nbsp;"+user_detail.empid)})}else"attendance-entry-summary"!==Layout.Page.pageId&&"selfservice-user-attendance"!==Layout.Page.container[0].id||null===Attendance.Entry.erecno?results.push({id:ZPDashboard.getUserId(),text:ZPeople.decodeTxt(ZPeople.getUserDetailsById(ZPDashboard.getUserId()).name+",&nbsp;"+ZPeople.getUserDetailsById(ZPDashboard.getUserId()).empid)}):results.push({id:ZPDashboard.getUserId(Attendance.Entry.erecno),text:ZPeople.decodeTxt(ZPeople.getUserDetailsById(ZPDashboard.getUserId(Attendance.Entry.erecno)).name+",&nbsp;"+ZPeople.getUserDetailsById(ZPDashboard.getUserId(Attendance.Entry.erecno)).empid)});else if(ZP5Form.select2.OPTIONS[key][term]&&0==ZP5Form.select2.OPTIONS[key][term].length)isnew=!1;else if(ZP5Form.select2.OPTIONS[key][term]&&ZP5Form.select2.OPTIONS[key][term].length>0&&ZP5Form.select2.OPTIONS[key][term].length>200*(page-1)){var skipIds=[],parentElement=$(elem).parent();for(formClassObj.isSingleFiledEdit()&&!formClassObj.isSingleFieldModal&&(parentElement=$(parentElement).parent()),void 0!=$(parentElement).attr("isspecialhandling")&&"true"==$(parentElement).attr("isspecialhandling")&&(skipIds=ZP5Form.changeDivisionOptions(fcid)),i=200*(page-1);i<200*page&&i<ZP5Form.select2.OPTIONS[key][term].length;i++)(0==skipIds.length||skipIds.length>0&&!ZPUtil.checkIsExistInArray(skipIds,ZP5Form.select2.OPTIONS[key][term][i].id))&&results.push(ZP5Form.select2.OPTIONS[key][term][i]);isnew=!1}else{if(isDirectFetch||1!=page||""!=term||fieldDataMap.isPrimaryLookup)return results=ZP5Form.select2.getOptions(fcid,term,page,key,!1,row,selectObj),void(isRefresh&&(lookUpData=ZP5Form.LOOKUP_DATA[fieldDataMap.referredFormId],void 0!=lookUpData&&(lookUpData.updatedFcIds||(lookUpData.updatedFcIds=[]),lookUpData.updatedFcIds.push(fcid))));$.each(fieldDataMap.Options,function(ind,val){if(results.push({id:val.Id,text:ZPeople.decodeTxt(val.Value)}),ZP5Form.select2.ALL_OPTIONS[fcid+"_"+val.Id]=val.Value,199==ind)return!1})}if(isnew){skipIds=[],parentElement=$(elem).parent();if(formClassObj.isSingleFiledEdit()&&!formClassObj.isSingleFieldModal)parentElement=$(parentElement).parent();void 0!=$(parentElement).attr("isspecialhandling")&&"true"==$(parentElement).attr("isspecialhandling")&&(skipIds=ZP5Form.changeDivisionOptions(fcid));var removeIndexArray=[];ZP5Form.select2.OPTIONS[key][term]||(ZP5Form.select2.OPTIONS[key][term]=[]),$.each(results,function(ind,value){"-Select-"!=value.id&&ZP5Form.select2.OPTIONS[key][term].push(value),skipIds.length>0&&ZPUtil.checkIsExistInArray(skipIds,value.id)&&removeIndexArray.push(ind)}),removeIndexArray.length>0&&$.each(removeIndexArray,function(index1,value1){results.splice(value1-index1,1)})}selectObj({results:results,more:results.length>=200})},getSelectOptionsAttr:function(elem,id,attrname,optionvalues,isTokenField){let selectelem=void 0==elem?"#"+id:elem,selectOptions=[];selectOptions=isTokenField?ZPeopleComponents.tokenfield(selectelem).getAttribute("data"):ZPeopleComponents.select(selectelem).getOptions();let attr=[],i=0;for(;selectOptions[i];){let val=selectOptions[i].id;if(-1!=optionvalues.indexOf(val)&&attr.push(selectOptions[i][attrname]),optionvalues.length==attr.length)break;i++}return attr},constructNonDropdownOptions(formClassObj,fieldComponent,newOptions,newCheckedValues,skipDomConstruction,relatedFieldDetails,isFromQuickAdd){let fieldOuterEle=formClassObj.FIELD_LAYOUT.find("#zp_field_outer_"+fieldComponent.formComponentId),checkedValue=[],inputElem=fieldOuterEle.find('input[id^="optid_'+fieldComponent.formComponentId+'"]:checked');if($.each(inputElem,function(key,value){checkedValue.push($(value).val())}),newCheckedValues&&checkedValue.push(...newCheckedValues),!skipDomConstruction){fieldOuterEle.children("[quickaddbtn!='true']").remove();let key,isRefresh=!0;!isFromQuickAdd&&fieldComponent.isPrimary&&(formClassObj.isEditMode()||formClassObj.isSingleFiledEdit())?(key="EditOptions",isRefresh=!1):key="Options";for(let index in newOptions)fieldComponent[key].push({Id:newOptions[index].Id,Value:newOptions[index].Value});if(isRefresh&&(formClassObj.FormOperations.updateFormComponentDataValues(fieldComponent.formComponentId,key,fieldComponent[key]),formClassObj.refreshFieldData()),null!=formClassObj.getSingleFieldEditFcid()){fieldOuterEle.append($("<span>"+ZP5Form.Field.getFieldValueData(fieldComponent.formComponentId).componentValue+"</span>")),fieldOuterEle.find("> span").hide();let htmlData=$('<div id="zp_fieldedit_comp"></div>');if(htmlData.append(formClassObj.createField(fieldComponent,fieldComponent.formComponentId)),formClassObj.isViewMode()){let quickaddhtml='<div class="zpl_hvr">'+ZP5Form.Field.isQuickAddForm(fieldComponent,fieldComponent.isTabular,!0)+'<i id="zp_formedit_submit" class="PI_tick grn"></i><i id="zp_formedit_cancel" class="PI_cls red"></i></div>';htmlData.append(quickaddhtml)}fieldOuterEle.append(htmlData),htmlData.find("#zp_formedit_submit").one("click",()=>{formClassObj.callbackForSingleFieldEdit()}),htmlData.find("#zp_formedit_cancel").on("click",()=>{formClassObj.cancel()})}else fieldOuterEle.prepend(formClassObj.createField(fieldComponent,fieldComponent.formComponentId));(null!=formClassObj.getSingleFieldEditFcid()||isFromQuickAdd)&&formClassObj.registerFieldChangeFun(fieldOuterEle)}if($.each(fieldOuterEle.find("input"),function(key,value){-1!==$.inArray($(value).val(),checkedValue)?$(value).prop("checked",!0):$(value).prop("checked",!1)}),fieldComponent.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE&&"true"===fieldOuterEle.attr("relateddata")){let inputElem=fieldOuterEle.find('input[id^="optid_"]:checked');if(relatedFieldDetails){let params={recordId:inputElem.val(),fcId:fieldComponent.formComponentId};formClassObj.relatedFieldsResponse(relatedFieldDetails,params,inputElem)}}return fieldOuterEle.find("input")},updateQuickaddResponse:function(quickAddFormObj,resultData,params){let succObj=resultData[0],lookupfcid=quickAddFormObj.lookupfcid;ZP5Form.updateLookUpRefreshOpt(params.zp_formId);let formClassObj=ZP5Form.getFormClassObj(),fieldComponent=formClassObj.getSingleFieldData(lookupfcid),fieldContainer=ZP5Form.getFieldLayout();if(succObj.lkpDetails.lookupValue.length>0&&"null"!=succObj.lkpDetails.lookupValue&&Object.keys(succObj.lkpDetails).length>0)if(fieldComponent.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE||fieldComponent.displayType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE){let newOptions=[{Id:succObj.pkId,Value:succObj.lkpDetails.lookupValue}];ZP5Form.constructNonDropdownOptions(formClassObj,fieldComponent,newOptions,[succObj.pkId],!1,succObj.relfieldDet,!0)}else{fieldComponent.Options.push({Id:succObj.pkId,Value:succObj.lkpDetails.lookupValue});let inisel={id:succObj.pkId,text:ZPeople.decodeTxt(succObj.lkpDetails.lookupValue)};if(ZP5Form.select2.ALL_OPTIONS[succObj.lkpDetails.lookupID+"_"+succObj.pkId]=succObj.lkpDetails.lookupValue,0!=fieldContainer.find("#zp_field_"+lookupfcid).length){let selectOptions=ZP5Form.getFormClassObj().getSelect2FieldOptions(fieldComponent.formComponentId,fieldContainer.find("#zp_field_"+lookupfcid),fieldComponent);if(fieldComponent.displayType==FormConstants.FieldType.SELECT_DISPLYTYPE)ZPeopleComponents.select(fieldContainer.find("#zp_field_"+lookupfcid)).destroy(),ZPeopleComponents.select(fieldContainer.find("#zp_field_"+lookupfcid),selectOptions).setValue(inisel);else{let multiSelectField=ZPeopleComponents.tokenfield(fieldContainer.find("[zcomponentname]")[0]),values=Object.assign([],multiSelectField.getAllValues());values.push(inisel),ZPeopleComponents.tokenfield(fieldContainer.find("#zp_field_"+lookupfcid)).destroy(),ZPeopleComponents.tokenfield(fieldContainer.find("#zp_field_"+lookupfcid),selectOptions).setAttribute("values",values)}}}let fldResponseFun=formClassObj.getParams().responseFldFunctions;void 0!==fldResponseFun&&void 0!==fldResponseFun[fieldComponent.labelName]&&"function"==typeof fldResponseFun[formCompData.labelName]&&fldResponseFun[fieldComponent.labelName](resultData,params,lookupfcid),ZPFRulesNew.Evaluation.LAYOUT=ZP5Form.getLayout(),$.each(ZP5Form.FIELD_RULE_DETAILS[params.formId],function(i,rule){-1!=$.inArray(succObj.lkpDetails.lookupID,rule.fieldElms)&&(rule.isExecuted=!1)}),ZPFRulesNew.Evaluation.evaluateRules(ZP5Form.Field.getFieldComponent(succObj.lkpDetails.lookupID),!1)},dateFieldChangeCallback:function(event){let value=event.detail.value;$(event.target).val(value),$(event.target).trigger("change")},constructmultipagerelfields:function(formId){let layoutContainer=ZP5Form.getLayout();layoutContainer.find("#relatedformcolp").length<=0&&(ZP5Form.getRelatedFieldInnerHtml(formId,ZP5Form.relformComp,layoutContainer,!0),ZPeopleComponents.collapsiblepanels("#relatedformcolp",{beforepanelexpand:event=>{let formProp=ZP5Form.getFormClassObj().getFormsProperties();ZP5Form.RelatedForms.constructRelatedFormContent(event.target,formProp.getFormId(),formProp.getRecordId())},className:"custom-theme-class",collapseIconLabel:ZPI18N.getString("zp.show"),expandIconLabel:ZPI18N.getString("zp.hide")})),ZP5Form.showSection(layoutContainer,formId)},getRelatedFieldInnerHtml:function(formId,formComp,layout,isPageMode){let fieldHtml='<div class="zpl_crd"><div class="zpl_crdhdr"><div><h4 relformhead="true">'+ZPI18N.getString("zp.relatedforms")+"</h4></div></div>";fieldHtml+='<div class="zpl_crdcnt">';let tst="<div id='relatedformcolp' class='zpl_colpanls' data-toggle-button-position='right'>",innerHtml="",isTaskAvailable=ZP5Form.getSingleRecord().record.message.isTaskAvailable,isEsignAvailable=!!(void 0!=ZP5Form.getSingleRecord().record.esignPerm&&ZP5Form.getSingleRecord().record.esignPerm.length>0&&ZP5Form.getSingleRecord().record.esignPerm[0].hasOwnProperty("esignmodule"));if(!formComp.relatedFields.map(obj=>obj.group).includes("Esign")&&void 0!=ZP5Form.getSingleRecord().record.esignPerm&&ZP5Form.getSingleRecord().record.esignPerm.length>0){var objEsign={};objEsign.group=ZP5Form.getSingleRecord().record.esignPerm[0].group,objEsign.title=ZP5Form.getSingleRecord().record.esignPerm[0].title,isEsignAvailable&&(objEsign.esignmodule=ZP5Form.getSingleRecord().record.esignPerm[0].esignmodule),formComp.relatedFields.push(objEsign)}$.each(formComp.relatedFields,function(index){var relatedfield=formComp.relatedFields[index],listName="";if(relatedfield.methodName="ZP5Form.RelatedForms.loadRelatedFormAddRecordPage(this)","P_Workplace_Readiness"===ZP5Form.getCurrFormsOperation().getTableName())relatedfield.addPerm=0;else if(void 0!=relatedfield.group&&"Esign"==relatedfield.group){if(isWebForm)return;listName="esign_doc_list";var recordId=[];recordId.push(settingsUrlProps.urlParamsArr.recordId),2!=relatedfield.esignmodule&&4!=relatedfield.esignmodule&&6!=relatedfield.esignmodule||(Zsign.ESIGN_FORMS_RECORD_IDS=recordId,relatedfield.methodName="Zsign.sendForSignDocs('"+formId+"','"+recordId+"')")}else"P_Task"==relatedfield.tableName&&"-1"==relatedfield.viewId&&(relatedfield.methodName="ZP5ViewsCommon.RelatedTask.addPopup('zp_dash_rfdata_"+relatedfield.formCompid+"')");("-1"!=relatedfield.formCompid||isTaskAvailable)&&(innerHtml+='<div id="zp_dash_rfdata_'+relatedfield.formCompid+'" listName="'+listName+'" name="relatedformheader"  class="zpl_collapsepanel" isContentHTMLEncoded="true" data-is-active="false" fcid="'+relatedfield.formCompid+'" viewId="'+relatedfield.viewId+'" formId="'+relatedfield.formId+'" tableName="'+relatedfield.tableName+'" linkedFcid="'+relatedfield.linked_fcid+'" order="'+relatedfield.order+'">',innerHtml+='<div class="zpl_collapseheader"><div class="zpl_tgsprt"><h5>'+relatedfield.title+'</h5></div><div class="zpl_collaspeactions">',void 0!=relatedfield.group&&"Esign"==relatedfield.group?void 0!=relatedfield.esignmodule&&ZP5Form.getFormClassObj().isRecordAdmin()&&(innerHtml+='<div class="zpl_hvr zpl_hvrsw"><i class="PI_plus" onclick='+relatedfield.methodName+"></i></div>"):(relatedfield.isOperationalRoleAdmin||0!=relatedfield.addPerm&&(4!=relatedfield.addPerm||ZPeople.getSubUsers().length>0))&&(innerHtml+='<div class="zpl_hvr zpl_hvrsw"><i class="PI_plus" onclick='+relatedfield.methodName+"></i></div>"),innerHtml+="</div></div>",innerHtml+='<div class="zpl_collapsecontent"></div>',innerHtml+="</div>")}),""!=innerHtml&&(fieldHtml+=(tst+=innerHtml+"</div>")+"</div></div>",isPageMode?layout.find("#zp_section_field_top_"+formId).html(fieldHtml):layout.find("#sectionsparent").append($(fieldHtml)))},getTokenElemValues:function(elem){let value=[],returnedData=ZPeopleComponents.tokenfield(elem).getAllValues();if(void 0!=returnedData&&0!=returnedData.length)for(let index in returnedData){let valObj=returnedData[index];value.push(valObj.id)}return value},getTokenElemValuesAsString:function(elem){let value="",returnedData=ZPeopleComponents.tokenfield(elem).getAllValues();if(void 0!=returnedData&&0!=returnedData.length)for(let index in returnedData){let valObj=returnedData[index];0!=index&&(value+=";"),value+=valObj.id}return value},formulaRevaluateOnsingleEditFromCal:function(details){let fcId=details.target.attr("id");fcId=fcId.substr(fcId.lastIndexOf("_")+1),ZP5Form.formulaRevaluateOnsingleEdit(void 0,fcId)},formulaRevaluateOnsingleEdit:function(formId,fcId,rowNum,isCancel){if(void 0==formId&&(formId=ZP5Form.getFormClassObj().getFormsProperties().getFormId()),void 0==ZP5Form.getFormsOperation(formId).getFormsDetailsMap()||void 0==ZP5Form.getFormsOperation(formId).getFormsDetailsMap().formulaList)return!1;let container=ZP5Form.getFieldLayout(),formClassObj=ZP5Form.getFormClassObj();var formulaEdited=!1;"object"==typeof fcId&&($(fcId).closest('[id^="zp_field_outer_"]').find("input").each(function(){this.removeAttribute("selected")}),fcId.setAttribute("selected","true"),fcId=(fcId=$(fcId).closest('[id^="zp_field_outer_"]').attr("id")).substr(fcId.lastIndexOf("_")+1));if(null!=fcId&&void 0!=fcId||(fcId=formClassObj.getSingleFieldEditFcid()),void 0==formClassObj.getSingleFieldData(fcId))return!1;null!=rowNum&&void 0!=rowNum||(rowNum="1");var formLabelName=ZP5Form.getFormsOperation(formId).getFormsDetailsMap().formName,secObj=container.find("#zp_field_outer_"+fcId).closest("div[isgrid]"),secId=secObj.attr("id");secId=secId.substr(secId.lastIndexOf("_")+1);var istabular=secObj.attr("istabular"),isgrid=secObj.attr("isgrid");secObj="true"==istabular?"true"==isgrid?container.find("div[id=zp_section_fields_"+secId+"]").find("[id=zp_tabular_row][row="+rowNum+"]"):container.find("div[secid="+secId+"][row="+rowNum+"][isgrid=false]"):container;var editedLabelName=formClassObj.getSingleFieldData(fcId).labelName,formulaSecList=ZP5Form.getFormsOperation(formId).getFormsDetailsMap().formulaList;$.each(formulaSecList,function(fSecId,formulaList){var isTabularSec=container.find("#zp_section_fields_"+fSecId).attr("istabular");("true"==istabular&&secId==fSecId||"false"==istabular&&"false"==isTabularSec)&&null!=formulaList&&void 0!=formulaList&&$.each(formulaList,function(formulaFcId,formulaData){var parser=formulaData.Parser;if(void 0==formClassObj.getSingleFieldData(formulaFcId))return!0;var formulaLabelName=formClassObj.getSingleFieldData(formulaFcId).labelName;if(-1!=parser.split(", ").indexOf(editedLabelName)||formulaData.IsDynamic&&!isCancel){var formulaValObj=[],fieldsList=parser.split(", ");fieldsList.includes("_experience")&&(fieldsList=(parser="Dateofjoining, Dateofexit").split(", "));var formulaDataType=formulaData.DataType;for(i=0;parser.length>0&&i<fieldsList.length;i++){var fieldLabelName=fieldsList[i],fieldfcId=ZP5Form.getFcidFromLabelName(fieldLabelName);if(void 0==fieldfcId||void 0==formClassObj.getSingleFieldData(fieldfcId))return!0;var compValue,fieldType=formClassObj.getSingleFieldData(fieldfcId).fieldType,skipValueConvertion=!1;if(formClassObj.isSingleFiledEdit()&&0==$("#singleFieldEditModal").length&&fcId!=fieldfcId||isCancel)compValue=fieldType==FormConstants.FieldType.PICKLIST||fieldType==FormConstants.FieldType.CURRENCY||fieldType==FormConstants.FieldType.DECIMAL||fieldType==FormConstants.FieldType.NUMBER?decodeHTML(formClassObj.getSingleFieldRecordDetails(fieldfcId).componentValue):secObj.find("[folabel="+fieldLabelName+"]").find("span:first").text();else{var inputElem=secObj.find(":input[name="+fieldLabelName+"]");if(formClassObj.isAddMode()&&"AddedTime"==fieldLabelName)compValue=(new Date).getTime(),skipValueConvertion=!0;else if(0!=inputElem.length||formClassObj.isAddMode())if(fieldType==FormConstants.FieldType.PICKLIST&&inputElem.length>1)compValue=0!=secObj.find(":input[name="+fieldLabelName+"][selected]").length?secObj.find(":input[name="+fieldLabelName+"][selected]").attr("value"):0!=secObj.find(":input[name="+fieldLabelName+"][checked]").length?secObj.find(":input[name="+fieldLabelName+"][checked]").attr("value"):formClassObj.isAddMode()?"":ZPeople.decodeTxt(ZP5Form.Field.getFieldValueData(fieldfcId).componentValue);else{let formField=secObj.find(":input[name="+fieldLabelName+"]");if(compValue=formField.val(),void 0!=formField.attr("zcomponentname")){let componentname=formField.attr("zcomponentname");if("datefield"==componentname||"datetimefield"==componentname){let fieldComp=ZPeopleComponents[componentname](formField);compValue=void 0==(compValue=fieldComp.getValue())||void 0==compValue.dateObject?"":fieldComp.formatDate(compValue.dateObject,fieldComp.getAttribute("format"))}else compValue="tokenfield"==componentname?ZP5Form.getTokenElemValuesAsString(formField):void 0==(compValue=ZPeopleComponents[componentname](formField).getValue())?"":compValue}}else if(1==$("#singleFieldEditModal").length)compValue=fieldType==FormConstants.FieldType.PICKLIST||fieldType==FormConstants.FieldType.CURRENCY||fieldType==FormConstants.FieldType.DECIMAL||fieldType==FormConstants.FieldType.NUMBER?decodeHTML(formClassObj.getSingleFieldRecordDetails(fieldfcId).componentValue):$("[folabel="+fieldLabelName+"]").find("span").text();else if("false"==isTabularSec)compValue=fieldType==FormConstants.FieldType.CURRENCY||fieldType==FormConstants.FieldType.DECIMAL||fieldType==FormConstants.FieldType.NUMBER?decodeHTML(formClassObj.getSingleFieldRecordDetails(fieldfcId).componentValue):secObj.find("[folabel="+fieldLabelName+"]").find("span").text();else{let rowId=secObj.attr("rowId");if(!rowId||fieldType!=FormConstants.FieldType.CURRENCY&&fieldType!=FormConstants.FieldType.DECIMAL&&fieldType!=FormConstants.FieldType.NUMBER)compValue=secObj.find("[folabel="+fieldLabelName+"]").text();else if("true"==isgrid){let sectionObj=formClassObj.getSingleFieldRecordDetails(secObj.attr("secid"));compValue=decodeHTML(sectionObj.datarows[sectionObj.recordIdArray.indexOf(rowId)][sectionObj.formComponentIds.indexOf(fieldfcId)])}else{let recordIndex,singleRecDtl=ZP5Form.getSingleRecord();$.each(singleRecDtl.record.message.recordDetails,function(index,sectionObj){if(sectionObj.sectionId==secObj.attr("secid"))return recordIndex=sectionObj.recordIdArray.indexOf(rowId),!1});let fieldObj=formClassObj.getSingleFieldRecordDetails(fieldfcId);compValue=decodeHTML(fieldObj.componentValue[recordIndex])}}}if(!skipValueConvertion){if(void 0===compValue||0==compValue.trim().length||"-"==compValue)if(compValue="0",fieldType==FormConstants.FieldType.TEXT||fieldType==FormConstants.FieldType.EMAIL_ADDRESS||fieldType==FormConstants.FieldType.URL||fieldType==FormConstants.FieldType.PICKLIST)compValue="";else if((fieldType==FormConstants.FieldType.DATE_TIME||fieldType==FormConstants.FieldType.DATE)&&!formulaData.IsDateEmptyUsed){var formulaObj=secObj.find("[folabel="+formulaLabelName+"]");return $(formulaObj).empty(),"STRING"==formulaDataType?$(formulaObj).append("<span></span>").text(""):$(formulaObj).append("<span></span>").text("0"),!0}compValue=ZP5Form.convertValuetoDataType(compValue,fieldType)}formulaValObj[fieldLabelName]=compValue}var result=formulaUtil[formLabelName][formulaLabelName](formulaValObj);if("DECIMAL"!=formulaDataType&&"BIGINT"!=formulaDataType||!isNaN(result)&&result!=1/0||(result=0),"P_Employee"==formLabelName&&("Age"==formulaLabelName||"Experience"==formulaLabelName))if(0!=result){var totalMonths=result,displayType=formulaData.DisplayType,arg1=result=parseInt(parseInt(totalMonths)/12);result=0==result?"":ZPI18N.getString("zp.yearsValue",[arg1]),0==displayType&&(totalMonths=parseInt(totalMonths)%12,""!=result&&0!=totalMonths?result=ZPI18N.getString("zp.yearsAndMonths",[arg1,totalMonths]):0!=totalMonths&&(result=ZPI18N.getString("zp.monthsValue",[totalMonths])))}else result="";"DECIMAL"==formulaDataType?(result=result.toFixed(2),-1==(result+="").indexOf(".")?result+=".00":result.length-result.indexOf(".")>3?result=result.substr(0,result.indexOf(".")+3):result.length-result.indexOf(".")<3&&(result+="0")):"BIGINT"==formulaDataType?result+="":"TIMESTAMP"==formulaDataType?result=dateTimefuncs.convertLongToDateTime(result):"DATE"==formulaDataType?result=dateTimefuncs.convertLongToDate(result):"TIME"==formulaDataType&&(result=dateTimefuncs.convertLongToTime(result));formulaObj=secObj.find("[folabel="+formulaLabelName+"]");$(formulaObj).empty(),$(formulaObj).append("<span></span>").text(result),formulaEdited=!0}})}),formulaEdited&&!formClassObj.isEmbedForm&&void 0!=formClassObj.getFormsProperties().getRecordId()&&ZP5Form.refreshRecord(formClassObj.getFormsProperties().getRecordId(),formClassObj.getFormsProperties().getRecordId())},isRecordApprover:function(formId,recordId){return ZP5Form.isApprovalEnabled(formId)&&void 0!=ZP5Form.getSingleRecord().record.isRecordApprover&&ZP5Form.getSingleRecord().record.isRecordApprover},updateLookUpRefreshOpt(formId){void 0===formId&&(formId=ZP5Form.getFormClassObj().getFormsProperties().getFormId()),ZP5Form.LOOKUP_DATA[formId]={refresh:!0}},componentsSearch:function(fieldType,fcid,elem,tableName,prop){return params=>new Promise((search,reject)=>{let startint=void 0==params.pages?1:params.pages,searchtxt=params.query;if(fieldType==FormConstants.FieldType.LOOKUP)ZP5Form.constructSelect2Options(fcid,elem,search,searchtxt,startint);else{if("P_Location"==tableName&&!prop.isAddressField){var countryEle=settingsPage.container.find('[name="Country"]');countryEle.length>0&&(prop.countryCode=countryEle.find('[value="'+ZPeopleComponents.select(countryEle).getValue()+'"]').attr("id"),prop.displayName=ZPI18N.getString("zp.select"))}ZP5Form.AddressField.select2.constructSelect2Options(search,searchtxt,prop)}})},refreshRecord:function(formId,recordId){ZP5Form.getFormsOperation(formId).updateRecordDetails(recordId,"refresh",!0)},isEmbedForm:function(){let formClassObj=ZP5Form.getFormClassObj();return void 0!=formClassObj&&formClassObj.isEmbedForm},getFormModelClass:function(formModel){let oClass="zpl_mdl zpl_mopen";switch(void 0==formModel?ZP5Form.MODEL.FULL:formModel){case ZP5Form.MODEL.FULL:return oClass+" zpl_mfull";case ZP5Form.MODEL.SINGLE_FIELD_EDIT:return oClass+" zpl_mmd zpl_mcenter";case ZP5Form.MODEL.PRINT:return oClass+" zpl_mfull zpl_mprint";case ZP5Form.MODEL.NO_MODEL:return"";case ZP5Form.MODEL.SLIDER:return oClass;case ZP5Form.MODEL.SLIDER_SMALL:return oClass+" zpl_msm";case ZP5Form.MODEL.SLIDER_MEDIUM:return oClass+" zpl_mmd";case ZP5Form.MODEL.SLIDER_LARGE:return oClass+" zpl_mlg";default:return""}},getFormComponents:function(params,successCallback,failureCallback){ZPeople.Request.send(ZP5Form.URL,params,data=>{successCallback(data,params)},void 0,data=>{void 0!=failureCallback&&failureCallback(data,params)})}}).Employee={isNonUser:function(){var singleRecDtl=ZP5Form.getSingleRecord();return void 0!==singleRecDtl&&void 0!==singleRecDtl.record&&singleRecDtl.record.isDummyEmployee},isAllowedToeditPendingUserMail:function(){var singleRecDtl=ZP5Form.getSingleRecord();return void 0!==singleRecDtl&&void 0!==singleRecDtl.record&&singleRecDtl.record.isAllowedToeditPendingUserMail},isAllowedToEditEmailId:function(){var singleRecDtl=ZP5Form.getSingleRecord();return void 0!==singleRecDtl&&void 0!==singleRecDtl.record&&singleRecDtl.record.isAllowedToeditEmailId},isExistingMobileUser:function(){var singleRecDtl=ZP5Form.getSingleRecord();return void 0!==singleRecDtl&&void 0!==singleRecDtl.record&&singleRecDtl.record.isExistingMobileUser}},ZP5Form.Field={Edit:{},FORM_LOOKUP_RELDATA:null,getIsSelected:function(optVal,selVal,fieldType){var attribute="";return optVal===selVal&&(attribute="select"===fieldType?'selected="selected"':'checked="checked"'),attribute},markFieldAsError:function(labelName,Obj){let fieldContainer=ZP5Form.getFieldLayout();var fieldObj=fieldContainer.find("[folabel="+labelName+"]");if(fieldObj.length>0){void 0!==Obj.row&&(0==(fieldObj=fieldContainer.find("[istabular=true]").find("[row="+Obj.row+"]").find("[folabel="+labelName+"]")).length&&(fieldObj=fieldContainer.find("[istabular=true][row="+Obj.row+"]").find("[folabel="+labelName+"]")),0==fieldObj.length&&(fieldObj=fieldContainer.find("[folabel="+labelName+"]")));var fieldType=fieldObj.attr("fieldtype");if(0!==fieldObj.children("#error_message").length)fieldObj.children("#error_message").html(Obj[labelName]);else{var errorCont="<span id='error_message' class='ztextbox--error__label'>"+Obj[labelName]+"</ span>";fieldObj.find(".zpcal").length>0?(fieldObj.find(".zpcal").append(errorCont),fieldObj.find(".zpcal").css("position","P_EmployeeLeave"==ZP5Form.getCurrFormsOperation().getTableName()&&"From"==labelName?"inherit":"")):"P_EmployeeLeave"==ZP5Form.getCurrFormsOperation().getTableName()&&"Leavetype"==labelName?$(fieldObj.find("div")[0]).append(errorCont):fieldObj.append(errorCont),(fieldType==FormConstants.FieldType.FILE_UPLOAD||fieldType==FormConstants.FieldType.IMAGE||void 0==fieldType&&fieldContainer.find(fieldObj).find(".zpl_fldrp").length>0)&&fieldContainer.find(fieldObj).find(".zpl_fldrp").addClass("ztextbox__error"),void 0!=Obj.row?fieldObj.find("[id^='zp_field_']").addClass("ztextbox__error"):void 0!=Obj.fieldInputObj?Obj.fieldInputObj.addClass("ztextbox__error"):fieldObj.find("[id^='zp_field_']").addClass("ztextbox__error")}}else ZPeople.Message.failure(ZPeople.decodeTxt(Obj[labelName]))},getNoValueString:function(value){return void 0!==value&&""!==value.trim()||(value="-"),value},getStringForNewLine:function(value){var returnArray=[];ZP5Form.Field.getArrayForNewLine(value,returnArray);for(var returnString="",i=0;i<returnArray.length;i++)returnString=""==returnString?returnArray[i].trim():returnString+"<br>"+returnArray[i].trim();return returnString},getArrayForNewLine:function(value,returnArray){var regexResult=/\n/.exec(value);if(null==regexResult)returnArray.push(value);else{var breakString=value.substring(0,regexResult.index);returnArray.push(breakString),value=value.substring(regexResult.index+1,value.length),ZP5Form.Field.getArrayForNewLine(value,returnArray)}},isMandatory:function(tableName,isMandatory,labelName,mode){if("P_Employee"===tableName&&"ADD"!=mode&&("EmailID"===labelName||"LastName"===labelName&&isMandatory))isMandatory=!ZP5Form.Employee.isNonUser();else if("P_EmployeeLeave"===tableName&&"Daystaken"===labelName)return!1;return isMandatory},getAddressChildMandatory:function(formCompObj){let mandatory={},containsChildMandatory=!1,columnArrayLen=FormConstants.AddressField.COLUMNAMEARRAY.length;formCompObj.isMandatory&&$.each(FormConstants.AddressField.COLUMNAMEARRAY,function(index,value){return!(containsChildMandatory=formCompObj.childFcObj[value].ismandatory)});for(let addressColumnIndex=0;addressColumnIndex<columnArrayLen;addressColumnIndex++){if(1==addressColumnIndex)continue;let column=FormConstants.AddressField.COLUMNAMEARRAY[addressColumnIndex];mandatory[column]=formCompObj.isMandatory&&(!containsChildMandatory||formCompObj.childFcObj[column].ismandatory)||"ADDRESS1"==column}return mandatory},getPrimaryLookupHtml:function(obj){return ZP5Form.getFormClassObj().moduleHandler.isFieldIconNeed()&&obj.isPrimary?'<b class="PI_key ML5" iskey="true"></b>':""},getEphiHtml:function(obj){return ZP5Form.getFormClassObj().moduleHandler.isFieldIconNeed()&&obj.isEphi?'<b elem="fieldIcon" class="zpl_ephi CPD" '+ComponentsCommon.getTooltipHtml(ZPI18N.getString("zp.ephitooltip"),{position:"bottom"})+">"+FormConstants.TEXTS.EPHI+"</b>":""},isQuickAddForm:function(obj,isTabular,isFromSingleFieldEdit){let formClassObj=ZP5Form.getFormClassObj();if(!obj.isquickaddallowed||isTabular||formClassObj.isEmbedForm||formClassObj.isFromSelfService||void 0!=obj.dependentFiledList&&0!=obj.dependentFiledList.length||void 0!=obj.isFieldDependent&&obj.isFieldDependent||formClassObj.isRoleBasedPreview&&(!formClassObj.isRoleBasedPreview||"-1"!=formClassObj.roleId)||formClassObj.isQuickAdd||!formClassObj.moduleHandler.isQuickAddAllowed(obj))return"";var ispre=!0;if((formClassObj.isRoleBasedPreview||formClassObj.getFormsProperties().getIsPreviewForm())&&(ispre=!1),obj.fieldType!=FormConstants.FieldType.LOOKUP||ZP5Form.isrelformrelfields||formClassObj.isfromrelfieldedit||formClassObj.isrelfieldsingelrecview||void 0===obj.refTableName||"P_Location"===obj.refTableName&&ZP5Form.getCurrFormsOperation().isOperationalRoleAdmin()||"P_Employee"===obj.refTableName||"AppriasalConfiguration"==obj.labelName||"Rating"==obj.labelName||"Role"==obj.labelName||"P_Streams"==obj.refTableName||"P_EmployeeHealthData"==obj.refTableName||"P_VaccinationStatus"==obj.refTableName||"P_Groups"==obj.refTableName||!(formClassObj.isRecordAdmin()||"-1"==ZP5Form.roleId||"P_TimesheetJobsList"==formClassObj.tableName&&"ClientId"==obj.labelName&&formClassObj.moduleHandler.isTTCustAdminForSpecificAction()||"P_Timesheet"==formClassObj.tableName&&("Project"==obj.labelName&&Timetracker.util.checkAddProjectPermVar||"JobId"==obj.labelName&&Timetracker.util.checkAddJobPermVar))){if(obj.fieldType===FormConstants.FieldType.PICKLIST&&formClassObj.isRecordAdmin()){var quickaddHtml='<i class="PI_plus" elem="quickAdd" buttonname="addicon" fcid="'+obj.formComponentId+'" '+(ispre?"onclick='ZP5Form.PicklistQuickAdd.createQuickAddPopup(this)'":"")+"></i>";return isFromSingleFieldEdit?quickaddHtml:'<div class="zpl_hvr" quickaddbtn="true">'+quickaddHtml+"</div>"}return""}var fcid=obj.formComponentId;return isFromSingleFieldEdit?'<i class="PI_plus" elem="quickAdd" fcid="'+fcid+'" onclick="ZP5Form.Field.quickFormFields(this)"></i>':'<div class="zpl_hvr" quickaddbtn="true"><i class="PI_plus" fcid="'+fcid+'" '+(ispre?"onclick='ZP5Form.Field.quickFormFields(this)'":"")+"></i></div>"},quickFormFields:function(obj){var params={formMode:"ADD"},fcID=$(obj).attr("fcid");obj.hasOwnProperty("isFromProjects")&&(fcID=obj.fcID,params.ttSelectAddData=obj);var fieldCompon=ZP5Form.Field.getFieldComponent(fcID);params.formId=fieldCompon.referredFormId,params.tableName=fieldCompon.refTableName;let form=ZP5Form._toForm(params);void 0!=ZP5Form.getFormClassObj().getFormsProperties().getFormContainer()&&form.setFormContainer(ZP5Form.getFormClassObj().getFormsProperties().getFormContainer()),form.setReffcid(fieldCompon.referredfcId).setBaseFormDOMId(ZP5Form.getFormClassObj().formLayoutKey).setDisplayFields(fieldCompon.displayFields).setLookupfcid(fcID).setisQuickAdd(!0).setInitialParams(ZP5Form.getFormClassObj().moduleHandler.getInitialParams()).init()},getFieldComponent:function(formCompId,formId){return ZP5Form.getFormClassObj().getSingleFieldData(formCompId)?ZP5Form.getFormClassObj().getSingleFieldData(formCompId):(void 0!==(formDtl=void 0==formId?ZP5Form.getCurrFormsOperation().getFormComponentData():ZP5Form.getFormsOperation(formId).getFormComponentData())&&$.each(formDtl.message.formComponentDetails,function(){return!(this.column1.length>0&&void 0!==(formComp=ZP5Form.Field.getFieldObjFromList(this.column1,formCompId)))&&(!(void 0===formComp&&this.column2.length>0&&void 0!==(formComp=ZP5Form.Field.getFieldObjFromList(this.column2,formCompId)))&&void 0)}),formComp);var formDtl,formComp},getFieldComponentByLabel:function(label,formId){var formComp,formDtl=ZP5Form.getFormsOperation(formId).getFormComponentData();return void 0!==formDtl&&$.each(formDtl.message.formComponentDetails,function(){return!(this.column1.length>0&&void 0!==(formComp=ZP5Form.Field.getFieldCompFromListBylabel(this.column1,label)))&&(!(void 0===formComp&&this.column2.length>0&&void 0!==(formComp=ZP5Form.Field.getFieldCompFromListBylabel(this.column2,label)))&&void 0)}),formComp},getFieldValueDataByLabel:function(label){var formComp,singleRecDtl=ZP5Form.getSingleRecord();if(void 0!==singleRecDtl&&void 0!==singleRecDtl.record){var recData=singleRecDtl.record;$.each(recData.message.recordDetails,function(){return!(void 0!==this.column1&&this.column1.length>0&&void 0!==(formComp=ZP5Form.Field.getFieldObjFromListBylabel(this.column1,label)))&&(!(void 0===formComp&&void 0!==this.column2&&this.column2.length>0&&void 0!==(formComp=ZP5Form.Field.getFieldObjFromListBylabel(this.column2,label)))&&void 0)})}return formComp},getFieldValueData:function(formCompId,formId,recordId){var formComp,singleRecDtl=ZP5Form.getSingleRecord(formId,recordId);if(void 0!==singleRecDtl&&void 0!==singleRecDtl.record){var recData=singleRecDtl.record;$.each(recData.message.recordDetails,function(){return!(void 0!==this.column1&&this.column1.length>0&&void 0!==(formComp=ZP5Form.Field.getFieldObjFromList(this.column1,formCompId)))&&(!(void 0===formComp&&void 0!==this.column2&&this.column2.length>0&&void 0!==(formComp=ZP5Form.Field.getFieldObjFromList(this.column2,formCompId)))&&void 0)})}return formComp},getFieldObjFromList:function(list,formCompId){var formComp;return $.each(list,function(){if(this.formComponentId==formCompId)return formComp=this,!1}),formComp},getFieldObjFromListBylabel:function(list,label){var formComp;return $.each(list,function(){if(this.componentName===label)return formComp=this,!1}),formComp},getFieldCompFromListBylabel:function(list,label){for(var formComp,listIndex=0;listIndex<list.length;listIndex++){var currField=list[listIndex];if(currField.labelName===label){formComp=currField;break}}return formComp},getMultiSelectValue:function(opts,value){var returnVal="";if(void 0!==opts&&opts.length>0)for(var i=0;i<opts.length;i++){var optObj=opts[i];"object"==typeof optObj&&ZPUtil.checkIsExistInArray(value,optObj.Id)?returnVal+=(""!==returnVal?",":"")+optObj.Value:ZPUtil.checkIsExistInArray(value,optObj)&&(returnVal+=(""!==returnVal?",":"")+optObj)}return""===returnVal.trim()?"-":returnVal},getMultiSelectLookupValue:function(opts,value,presentIds,presentvals,fcid){var returnVal=[];if(void 0!=value&&value.length>0)for(val in value){var temp="";for(val1 in presentIds)presentIds[val1]==value[val]&&(temp=presentvals[val1]);""==temp&&"-"==(temp=ZP5Form.Field.getLookUpOptValue(opts,value[val],fcid))&&(temp=""),returnVal.push(temp)}return returnVal},getLookUpOptValue:function(opts,valueId,fcid){if(ZP5Form.select2.ALL_OPTIONS[fcid+"_"+valueId])return ZP5Form.select2.ALL_OPTIONS[fcid+"_"+valueId];if(void 0!==opts&&opts.length>0)for(var i=0;i<opts.length;i++){var optObj=opts[i];if("object"==typeof optObj&&optObj.Id===valueId)return optObj.Value;if(optObj===valueId)return optObj}return"-"},toggleFileUpload:function(Obj,isAfterUpload,uploadLabel){$(Obj).closest("#zp_form_fileuploadfield").siblings().find("[id='beforeUpload']").removeClass("ztextbox__error"),$(Obj).closest("[folabel]").removeClass("ztextbox__error"),isAfterUpload?((Obj=$(Obj).closest("[folabel="+uploadLabel+"]").find("[id=zp_form_fileuploadfield]").find("[isrestore=true]")).removeClass("DNI"),$(Obj).parents("[folabel="+uploadLabel+"]").find("[class=ztextbox--error__label]").remove()):$(Obj).closest("#zp_form_fileuploadfield").parent().siblings("[class='ztextbox--error__label']").remove();var isRestore=!1,labelName=$(Obj).closest("#zp_form_fileuploadfield").siblings().find("input[type=file]").attr("name");"true"===$(Obj).attr("change")?ZP5Form.getFormClassObj().iscancelmsgact=!0:(isRestore=!0,ZP5Form.Field.removeFileUploadDoc(labelName));var fileNameObj=$(Obj).closest("#zp_form_fileuploadfield").siblings().find("#filename");if(isRestore)if($(fileNameObj).closest("div[folabel="+labelName+"]").attr("fieldtype")==FormConstants.FieldType.MULTI_FILE_UPLOAD){filepath=$(Obj).siblings().attr("filepath"),fileValue=fileNameObj.val();(fileValue=JSON.parse(fileValue)).push(filepath),fileNameObj.val(JSON.stringify(fileValue)),$(Obj).siblings().attr("ishide",!1)}else{$(fileNameObj).closest("[folabel="+labelName+"]").find("#afterUpload").empty();fileValue=fileNameObj.data("fileValue");ZPUtil.Validation.isEmpty(fileValue)||fileNameObj.val(fileValue)}else{var fileValue=fileNameObj.val();if($(fileNameObj).closest("div[folabel="+labelName+"]").attr("fieldtype")==FormConstants.FieldType.MULTI_FILE_UPLOAD){fileValue=JSON.parse(fileValue);var filepath=$(Obj).siblings().attr("filepath"),index=fileValue.indexOf(filepath);index>-1&&fileValue.splice(index,1),fileNameObj.val(JSON.stringify(fileValue)),$(fileNameObj).closest("div[folabel="+labelName+"]").find("#beforeUpload").removeClass("DNI"),$(fileNameObj).closest("div[folabel="+labelName+"]").find("p[elem=pre-info]").removeClass("DNI"),$(fileNameObj).closest("div[folabel="+labelName+"]").find("#beforeUpload").parent().removeClass("DNI")}else ZPUtil.Validation.isEmpty(fileValue)||fileNameObj.data("fileValue",fileValue),fileNameObj.val(""),$(fileNameObj).closest("[folabel="+labelName+"]").find("#beforeUpload").removeClass("DNI"),$(fileNameObj).closest("div[folabel="+labelName+"]").find("p[elem=pre-info]").removeClass("DNI"),$(fileNameObj).closest("[folabel="+labelName+"]").find("#afterUpload").addClass("DNI")}$(fileNameObj).closest("div[folabel="+labelName+"]").attr("fieldtype")==FormConstants.FieldType.MULTI_FILE_UPLOAD?$(Obj).siblings().attr("ishide","true"):$(Obj).closest("#zp_form_fileuploadfield").children().toggleClass("DNI").parent().siblings().toggleClass("DNI")},removeFileUploadDoc:function(labelName,rowNum){let fieldContainer=ZP5Form.getLayout();void 0!=rowNum?fieldContainer.find("[name=zp_form_fileupload]").find("input[name="+labelName+"][row="+rowNum+"]").remove():fieldContainer.find("[name=zp_form_fileupload]").find("input[name="+labelName+"]").remove();let uploadedFiles=ZP5Form.getFormClassObj().getUploadedFiles(),isRemoved=!1;$.each(uploadedFiles.cloudUpload,function(index,docObj){if(docObj.labelName==labelName&&(void 0==rowNum||docObj.rowNum==rowNum))return uploadedFiles.cloudUpload.splice(index,1),isRemoved=!0,!1}),isRemoved||$.each(uploadedFiles.wdUpload,function(index,docObj){if(docObj.labelName==labelName&&(void 0==rowNum||docObj.rowNum==rowNum))return uploadedFiles.wdUpload.splice(index,1),!1})},toggleFileFieldDisplay:function(obj,labelName){var rowNum;if("true"==$(obj).closest("[istabular]").attr("istabular")&&(rowNum="true"==$(obj).closest("[isgrid]").attr("isgrid")?$(obj).closest('[id="zp_tabular_row"]').attr("row"):$(obj).closest('[isgrid="false"]').attr("row")),$(obj).closest("div[folabel="+labelName+"]").attr("fieldtype")==FormConstants.FieldType.MULTI_FILE_UPLOAD)$(obj).closest("div[folabel="+labelName+"]").find("#beforeUpload,#afterUpload").toggleClass("DNI"),$(obj).closest("div[folabel="+labelName+"]").find("#multiuploadName").html(""),$(obj).closest('[id="afterUpload"]').parent().find("#filename").val(""),$(obj).closest('[id="afterUpload"]').parent().find("#filename").parent().find('[type="file"]').val("");else{$(obj).closest("[folabel="+labelName+"]").find('[id="error_message"]').remove(),$(obj).closest("[folabel="+labelName+"]").removeClass("ztextbox__error"),$(obj).closest(".zp-err").removeClass("zp-err"),$(obj).closest('[id="afterUpload"]').parent().find("#beforeUpload,#afterUpload").toggleClass("DNI"),$(obj).closest('[id="afterUpload"]').parent().find("p[elem=pre-info]").removeClass("DNI"),$(obj).closest("[folabel="+labelName+"]").find("[id=zp_form_fileuploadfield]").find("[isrestore=true]").removeClass("DNI");var rowNumber=rowNum;void 0==rowNumber&&(rowNumber="1");var fieldId=$(obj).closest("[folabel="+labelName+"]").attr("id"),fcId=parseInt(fieldId.substring(fieldId.lastIndexOf("_")+1));UDS_UPLOAD_IS_ACTIVE&&!ZP5Form.getFormClassObj().getFormsProperties().getIsPreviewForm()&&progressJs("div[data-progressjs='"+fcId+rowNumber+"']").kill(),$(obj).closest('[id="afterUpload"]').parent().removeClass("ztextbox__error"),$(obj).closest('[id="afterUpload"]').siblings('[id="beforeUpload"]').removeClass("ztextbox__error"),$(obj).closest('[id="afterUpload"]').parent().find("#filename").val(""),$(obj).closest('[id="afterUpload"]').parent().find("#filename").parent().find('[type="file"]').val(""),$(obj).closest('[id="afterUpload"]').empty()}$(obj).parent().find("span").text(""),ZP5Form.Field.removeFileUploadDoc(labelName,rowNum)},reUploadFile:function(obj,labelName){var rowNum;rowNum="true"==$(obj).closest("[istabular]").attr("istabular")?"true"==$(obj).closest("[isgrid]").attr("isgrid")?$(obj).closest('[id="zp_tabular_row"]').attr("row"):$(obj).closest('[isgrid="false"]').attr("row"):"1",$(obj).closest("[folabel="+labelName+"]").find('[id="error_message"]').remove(),$(obj).closest(".zp-err").removeClass("zp-err");var fieldId=$(obj).closest("[folabel="+labelName+"]").attr("id"),fcId=fieldId.substring(fieldId.lastIndexOf("_")+1),ele=$(obj).closest("[folabel="+labelName+"]").find("[type=file]")[0];ZP5Form.uploadFileByXHR(ele.files[0],ele),$(obj).closest("[folabel="+labelName+"]").removeClass("ztextbox__error"),$(obj).closest('[id="afterUpload"]').find(".zpl_flerr").removeClass(),$(obj).closest('[id="afterUpload"]').find(".zpl_prgbr").html('<div class=""><div data-progressjs="'+fcId+rowNum+'" style="width: 0%"></div></div>'),$(obj).closest('[id="afterUpload"]').find(".zpl_atchdtl p[elem='file-info']").children("[restoreOptionEnabled=true]").addClass("DNI"),$(obj).closest('[id="afterUpload"]').find(".zpl_atchdtl p[elem='file-info']").children("[isFileSize=true]").html("<span>"+FilesCommon.getFileSize(ele.files[0].size)+"</span>"),$(obj).closest('[id="afterUpload"]').find(".zpl_atchdtl p[elem='file-info']").children("[class=zpl_retry]").remove(),progressJs("div[data-progressjs='"+fcId+rowNum+"']").autoIncrease(8,10)},getCurrentDateAndTime:function(fieldType){let d=new Date,utc=d.getTime()+6e4*d.getTimezoneOffset(),timeObj=new Date(utc+parseInt(offset)),dateObj=Calendar.formatDate(timeObj);if(fieldType===FormConstants.FieldType.DATE_TIME){return dateObj+" "+Calendar.getSelectedTime("","","","",timeObj)}if(fieldType===FormConstants.FieldType.DATE)return dateObj},countryNameisExist:function(formComponentId,countryName){for(var countryNames=ZP5Form.Field.getFieldComponent(formComponentId).Options,i=0;i<countryNames.length;i++)if(countryNames[i].name.toUpperCase()==ZPeople.decodeTxt(countryName).toUpperCase())return!0;return!1},genderNameisExist:function(formComponentId,value){for(var genderOptions=ZP5Form.Field.getFieldComponent(formComponentId).Options,i=0;i<genderOptions.length;i++)if(genderOptions[i].toUpperCase()==ZPeople.decodeTxt(value).toUpperCase())return!0;return!1},getCountryCode:function(formComponentId,countryName){for(var countryNames=ZP5Form.Field.getFieldComponent(formComponentId).Options,i=0;i<countryNames.length;i++)if(countryNames[i].name.toUpperCase()==ZPeople.decodeTxt(countryName).toUpperCase())return countryNames[i].code;return" "},formatSSNValue:function(value){return ZPeople.decodeTxt(value.replace(/(\d{3})(\d{2})(\d{4})/,"$1-$2-$3"))},constructSystemAddressField:function(address,lat,lon,onlyMapHtml,isPrint){if(ZPUtil.Validation.isEmpty(address))return onlyMapHtml?"-":"<span>-</span>";if(ZPUtil.Validation.isEmpty(lat)||ZPUtil.Validation.isEmpty(lon))return onlyMapHtml?"":`<span>${address}</span>`;let addressHTML=`<i class="PI_location CP" lat=${lat} lon=${lon} ${isPrint?"":'onclick="ZP5Views.mapconstruction(event)"'} ${ComponentsCommon.getTooltipHtml(ZPI18N.getString("zp.viewmap"),{position:"bottom"})} icon="Map"></i>`;return onlyMapHtml?addressHTML:`<span class="zpl_adsfld">${addressHTML}${address}</span>`},applyMaskForField:function({key:key,target:target}){if(8==key||46==key||37==key||38==key||39==key||40==key)return;let fieldType=$(target).attr("fieldtype");if(fieldType==FormConstants.FieldType.SOCIAL_SECURITY_NUMBER||fieldType==FormConstants.FieldType.ITIN){var new_number,number=$(target).val().replace(/\D/g,"");number.length>3?(new_number=number.substring(0,3)+"-",4===number.length||5===number.length?new_number+=number.substr(3):number.length>4&&(new_number+=number.substring(3,5)+"-"),number.length>5&&(new_number+=number.substring(5))):new_number=number,$(target).val(new_number)}},getFieldIconsHTML:function(fieldDtl,rowNum,infoTooltipObj,isSingleFiledEdit,fieldObj,isAddMandatoryIcon){let{infoHtml:infoHtml,toolTip:toolTip}=ZP5Form.getToolTipHtml(fieldDtl.formComponentId,fieldDtl.description,fieldDtl.descriptionType,void 0,rowNum,!(fieldDtl.isTabular&&fieldDtl.isGridType||fieldDtl.disabled),infoTooltipObj);return isSingleFiledEdit?(fieldObj.find("[elem=viewToolTip]").html(infoHtml),fieldObj.find("[elem=viewToolTip]").before(ZP5Form.Field.getEphiHtml(fieldDtl)),isAddMandatoryIcon&&fieldObj.find("[elem=viewToolTip]").siblings("label").addClass("zpl_mtry"),toolTip):{infoHtml:infoHtml,toolTip:toolTip,ephiHTML:ZP5Form.Field.getEphiHtml(fieldDtl)}},isFieldEditAllowed:(componentType,isEditMode,isSingleEdit,isEditable,fieldCompObj,isRecordDraft,isResubmit,isBlueprintField,formClassObj)=>(void 0==formClassObj&&(formClassObj={}),!(!isEditMode&&!isSingleEdit||void 0==fieldCompObj||!(isEditable&&ZPA_BPOperation.fieldEditCriteria(formClassObj,{blueprintField:isBlueprintField})||(isRecordDraft||isResubmit)&&!fieldCompObj.isReadOnly&&null!=fieldCompObj.isPrimaryLookup&&fieldCompObj.isPrimaryLookup)||componentType==FormConstants.FieldType.AUTONUMBER||componentType==FormConstants.FieldType.SCRIPT||componentType==FormConstants.FieldType.PLAIN_TEXT))},ZP5Form.Record={PARAMS:{},isDraft:!1,isAllowEdit:function(){return ZP5Form.getSingleRecord().record.isAllowedEditFromNode||ZP5Form.getSingleRecord().record.message.isAllowedEdit&&("P_EmployeeLeave"!==ZP5Form.getCurrFormsOperation().getTableName()||!ZP5Form.getFormClassObj().getParams().isEditDisabled&&LeaveForm.isLvViewAllowEdit)},uploadFilesResponse:function(result){let params,formClassObj=ZP5Form.getFormClassObj(),container=formClassObj.FIELD_LAYOUT,formsContainer=formClassObj.LAYOUT;if(void 0!==result&&7e3===result.code){var fileuploadDiv=formsContainer.find("[name=zp_form_fileupload]"),count=0,isSingleFieldEdit=formClassObj.isSingleFiledEdit()&&!formClassObj.isSingleFieldModal;if($.each(result.message,function(){isSingleFieldEdit?(params={fcId:this.fcId})[this.labelName]="":params=ZP5Form.Record.PARAMS[ZP5Form.getFormClassObj().getFormsProperties().getFormId()];var fieldComp=ZP5Form.Field.getFieldComponent(this.fcId);if(fieldComp.fieldType==FormConstants.FieldType.MULTI_FILE_UPLOAD){if(formClassObj.isAddMode())0==count?value=[]:(val=params[this.labelName],value=JSON.parse(val));else{val=params[this.labelName];try{value=JSON.parse(val)}catch(e){value=[]}}value.push(this.filePath),value=JSON.stringify(value),params[this.labelName]=value}else if(fieldComp.isTabular){var val,sectionRowIndex,value=[];val=params[this.labelName];try{value=JSON.parse(val)}catch(e){value=[]}var fileDiv=fileuploadDiv.find("input[name="+this.labelName+"]")[0];void 0!=fileDiv?(sectionRowIndex=fileDiv.getAttribute("row"),fileDiv.remove()):sectionRowIndex=this.rowNum,value[sectionRowIndex-1]=this.filePath,value=JSON.stringify(value),params[this.labelName]=value}else isSingleFieldEdit&&(params.labelName=this.labelName),params[this.labelName]=this.filePath;formClassObj.moduleHandler.fileUploadCallback(params,this),fieldComp.fieldType==FormConstants.FieldType.MULTI_FILE_UPLOAD&&(count+=1,container.find(":input[name="+this.labelName+"]").siblings("#filename").val(value))}),count>5)return;ZP5Form.Record.IMAGE_REFRESH=!0,isSingleFieldEdit?formClassObj.submit(params):(formClassObj.isSubmitMsgAct&&(formClassObj.isSubmitMsgAct=!1),formClassObj.addUpdateRecord(formClassObj)),fileuploadDiv.empty()}else if(void 0==result||void 0==result.message||(7315!==result.code&&7313!==result.code||void 0==result.labelName)&&void 0==result.fieldName)ZPeople.Message.failure(ZPI18N.getString("zp.fileuploaderror")),ZP5Form.Validation.resetFormError(),this.revertEdit(formClassObj);else{ZP5Form.Validation.resetFormError(),this.revertEdit(formClassObj);var errors={};let labelName=void 0!=result.labelName?result.labelName:result.fieldName;errors[labelName]=result.message,errors.row=result.rowNum,ZP5Form.Field.markFieldAsError(labelName,errors)}},revertEdit:function(formClassObj){if(formClassObj.isSingleFiledEdit())formClassObj.revertSingleEdit({});else{let formsContainer=formClassObj.LAYOUT;formsContainer.find("#zp_forms_add_btn").removeClass("disabled"),formsContainer.find("#zp_forms_addnew_btn").removeClass("disabled"),formsContainer.find("#zp_forms_savedraft_btn").removeClass("disabled"),(formClassObj.isEditMode()||formClassObj.moduleHandler.submitNewBtnNotNeed())&&formsContainer.find("#zp_forms_addnew_btn").addClass("disabled")}},errorForGetLatLang:function(error){let errorObj={isPermEnabled:!0};error.code&&(errorObj.isPermEnabled=!1),ZP5Form.getFormClassObj().addUpdateRecord(errorObj)},saveasdraft:function(){ZP5Form.Record.isDraft=!0,ZP5Form.Record.validateAndSubmit()},verifiedConflictConfm:function(){setTimeout(function(){ZP5Form.getFormClassObj().validateAndSubmit(!0)},1e3)},TABULAR_PARAMS:{},putParamForTabular:function(params,labelName,value){var paramArr=new Array;return void 0===ZP5Form.Record.TABULAR_PARAMS[labelName]?(paramArr.push(value),ZP5Form.Record.TABULAR_PARAMS[labelName]=paramArr,params[labelName]=JSON.stringify(paramArr)):((paramArr=ZP5Form.Record.TABULAR_PARAMS[labelName]).push(value),params[labelName]=JSON.stringify(paramArr)),params},getAuditHistoryForRecord:function(formId,recordId,props){let headerText,formClassObj=ZP5Form.getFormClassObj();void 0===recordId&&(recordId=formClassObj.getFormsProperties().getRecordId()),void 0===formId&&(formId=formClassObj.getFormsProperties().getFormId()),props&&props.headerText?headerText=ZSEC.Encoder.encodeForHTML(props.headerText):formClassObj&&(headerText=formClassObj.FormOperations.getFormDisplayName()),new AuditHistory({formId:formId,recordId:recordId,headerText:headerText}).setContainer($("body")).setModel(ZP5Form.MODEL.SLIDER_LARGE).setScrollDivElem("#zp_audit_body").loadAuditHistory()},collap:function(ele){let cnt=$(ele).attr("count"),expand=$(ele).attr("expand"),target=$(ele).attr("target");if($(target).slideToggle(500),"true"==expand){$(ele).attr("expand","false");var cnthtml=cnt+" "+ZPI18N.getString("zp.more");$(ele).children("a").text(cnthtml)}else $(ele).attr("expand","true"),$(ele).children("a").text(ZPI18N.getString("zp.showless"))},getAuditFileValue:function(value,url){return"-"!=(value=ZP5Form.Field.getNoValueString(value))&&(url="/"+url,"null"!=contextPath&&(url="/"+contextPath+url),value='<a href="javascript:;" onclick="window.open(\''+url+"');\">"+ZSEC.Encoder.encodeForHTML(value)+"</a>"),value},deleteRecord:function(){var recIds=ZPView.Actions.getDeleteRecIds();if(Layout.UrlConf.isModuleForm()&&!ZPView.Actions.isFormActionAllowed("DELETE"))ZPComponents.SystemView.deleteRecords(recIds);else{var formId=ZPView.CURR_VIEWPARAMS.formId;ZP5Form.isFormPage()&&(formId=Layout.Page.urlparam.formId);var params={mode:"deleteRecords",recordIds:recIds,formId:formId};void 0!==recIds&&""!==recIds.trim()&&ZPeople.Request.send(ZP5Form.URL,params,ZP5Form.Record.deleteRecResponse)}},deleteRecResponse:function(response,params){if(7e3===response.code){ZPeople.Message.success(ZPI18N.getString("zp.recorddeletedsuccessfully")),ZPView.Actions.selectUnselectRec(!0),"P_Employee"!==ZP5Form.getCurrFormsOperation().getTableName()&&ZP5Form.updateLookUpRefreshOpt(params.formId);var props=ZPView.getViewPropertie();ZPView.Actions.DELETE_RECIDS.length!=props.totalRec||props.hasNext||(props.startInd>1&&props.startInd>props.limit?props.startInd=props.startInd-props.limit:props.startInd=1),ZPView.Actions.DELETE_RECIDS=new Array,ZPView.refresh(!0),Layout.Page.container.find("#zp_view_record_delete").fadeOut(200,function(){$(this).siblings("#zp_views_formrecactions").fadeIn(200)})}else void 0!==response.message?ZPeople.Message.failure(response.message):ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror"))},getApprovalHierarchy:function(){var params={mode:"getApprovalHierarchy",recordId:ZP5Form.CURRFORM_PARAM.recordId,formId:ZP5Form.CURRFORM_PARAM.formId};ZPeople.Request.send(ZP5Form.URL,params,ZP5Form.RecordApproval.showApprovalHierarchy)},approveReject:function(recordId,approvalStatus,comment,isAllLevelApprove,callback,fetchApproval,formId){if(void 0!==ZP5Form.RecordApproval.APPROVAL_CALLBACK&&"function"==typeof ZP5Form.RecordApproval.APPROVAL_CALLBACK&&void 0!=ZP5Form.CURRFORM_PARAM.tableName&&"P_TimesheetList"==ZP5Form.CURRFORM_PARAM.tableName)ZP5Form.RecordApproval.APPROVAL_CALLBACK(approvalStatus,comment,isAllLevelApprove);else{var params={mode:"approveRejectRecord",recordIds:JSON.stringify(recordId),comment:comment,approvalStatus:approvalStatus,fetchApproval:fetchApproval};"1"==approvalStatus&&(params.isAllLevelApprove=isAllLevelApprove),Attendance.Reg.apprStatus=approvalStatus,void 0===formId&&void 0!==ZP5Form.CURRFORM_PARAM.formId&&(formId=ZP5Form.CURRFORM_PARAM.formId),params.formId=formId,ZPeople.Request.send(ZP5Form.URL,params,callback,recordId)}},cancelRecord:function(comment){var params={mode:"cancelRecord",recordId:ZP5Form.CURRFORM_PARAM.recordId,formId:ZP5Form.CURRFORM_PARAM.formId},cancelCmtPopUp=$("#cnf_popup").find("#cancelCommentPopUp");if(cancelCmtPopUp.length>0){cancelCmtPopUp.find(".ERR").remove();comment=cancelCmtPopUp.find("#cancel_comment textarea").val();if(!ZP5Form.Record.validateCancelRecord(comment))return;params.comment=comment,CommonTemplates.Popup.closePopup()}ZPeople.Request.send(ZP5Form.URL,params,ZP5Form.Record.cancelRecordResponse,void 0,ZPApprovals.failureCallBack)},validateCancelRecord:function(comment){var errorMsg;return ZPUtil.Validation.isEmpty(comment)?errorMsg=ZPI18N.getString("zp.leave.cancell.error.providereason"):comment.length>250&&(errorMsg=ZPI18N.getString("zp.leave.cancell.error.reasonlength")),!errorMsg||($("#cnf_popup").find("#cancelCommentPopUp #cancel_comment").append("<div class='ERR'>"+errorMsg+"</span>"),!1)},cancelRecCBforModule:function(currentApprovalStatus,otherDetails,approvalDetails){ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]&&(ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].refresh=!0),ZPApprovals.showApprovalHeader(currentApprovalStatus,void 0,void 0,otherDetails,approvalDetails)},cancelRecordResponse:function(result,params){if(7e3===result.code){var recordDetail=ZP5Form.getSingleRecord();if(recordDetail&&recordDetail.record&&(recordDetail.record.canCancel=!1),Layout.Page.container.find("#zp_approval_followupbtn").addClass("DN"),result.approvalJson)ZPeople.Message.success(ZPI18N.getString("zp.sentapprsuccessmsg")),ZPApprovals.approveRejectDtlCallBack(result,params);else{ZP5Form.RecordApproval.APPROVER_FOOTER&&(ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_cancelapproval").addClass("DN"),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_list").hide(),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").hide(),erecno!=ZP5Form.RecordApproval.CREATE_ERECNO&&erecno!=ZP5Form.RecordApproval.OWNER_ERECNO||-1!=Layout.Page.hash.indexOf("approvals/myapproval")||-1!=Layout.Page.hash.indexOf("approvals/myrequest")||-1!=Layout.Page.hash.indexOf("dashboard/feeds")||-1!=Layout.Page.hash.indexOf("dashboard/approvals")||-1!=Layout.Page.hash.indexOf("admin/dataadministration/activityLog")||(ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_resubmitbtn").removeClass("DN"),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_resubmitbtn").click(function(){ZP5Form.RecordApproval.onRecordResubmit()}))),ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]&&delete ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID];var currentApprovalStatus=void 0!=result.currentApprovalStatus?result.currentApprovalStatus:zpconst.ApprovalStatus.Cancelled;ZPApprovals.showApprovalHeader(currentApprovalStatus)}ZP5Form.CURRFORM_PARAM.disableUrlTrack?ZP5Form.CURRFORM_PARAM.refreshView=!0:(ZPView.setViewPropertie("refreshStatus",!0),ZP5Form.refreshRecord(ZP5Form.CURRFORM_PARAM.formId,ZP5Form.CURRFORM_PARAM.recordId)),ZPA_BPOperation.getTransitions(ZP5Form.CURRFORM_PARAM.formId,ZP5Form.CURRFORM_PARAM.recordId,ZP5Form.Permission.getViewPerm())}else ZP5Form.refreshRecord(ZP5Form.CURRFORM_PARAM.formId,ZP5Form.CURRFORM_PARAM.recordId),ZPeople.Message.failure(ZPI18N.getString("zp.cancelfailed"));ZP5Form.getLayout().find("#transitionBar").addClass("DN")},removeinlineTabularRow:function(obj){var sectionObj=$(obj).parent().parent().parent(),Id=sectionObj.attr("id"),secId=sectionObj.attr("secid"),delObjparent=sectionObj.siblings().filter("[id="+Id+"]");sectionObj.remove();var row=1;if(($.each(Layout.Page.container.find("div[id='zp_section_fields_"+secId+"']"),function(){"false"!=$(this).attr("istabroweditable")&&($(this).attr("row",row),row+=1)}),0===delObjparent.length)&&0==ZP5Form.getFormClassObj().addTabularSectionRow(secId,!0)){var secObj=ZP5Form.FIELD_LAYOUT.find("h3[id='"+secId+"']");secObj.next().remove(),secObj.remove()}},updateModifiedInfo:function(container,mInfo){var singleRecDtl=ZP5Form.getSingleRecord();if(singleRecDtl.record.message.cAuditInfo.mInfo=mInfo,singleRecDtl.record.message.cAuditInfo.ModifiedTime&&(container.find('[folabel="ModifiedTime"]').html("<span>"+Calendar.convertTo12Hours(mInfo["24time"])+"</span>"),ZP5Form.Field.getFieldValueDataByLabel("ModifiedTime")&&(ZP5Form.Field.getFieldValueDataByLabel("ModifiedTime").componentValue=mInfo["24time"])),singleRecDtl.record.message.cAuditInfo.ModifiedBy){let dispName=ZSEC.Encoder.encodeForHTML(mInfo.user.id)+" - "+ZSEC.Encoder.encodeForHTML(mInfo.user.name);container.find('[folabel="ModifiedBy"]').html("<span>"+dispName+"</span>"),ZP5Form.Field.getFieldValueDataByLabel("ModifiedBy")&&(ZP5Form.Field.getFieldValueDataByLabel("ModifiedBy").componentValue=dispName,ZP5Form.Field.getFieldValueDataByLabel("ModifiedBy").componentValue_ID=erecno)}}},ZP5Form.RecordApproval={APPROVER_FOOTER:null,APPROVAL_CALLBACK:null,CREATE_ERECNO:null,OWNER_ERECNO:null,showApprovalHierarchy:function(apprDtl,footer,callback){if(!ZP5Form.getFormClassObj().isPageMode()||ZP5Form.getFormClassObj().PRINT){if(void 0!==footer){var footerHtml="<div class='col-sm-7' id='zp_appproval_container'></div>";void 0!==apprDtl&&!0===apprDtl.isfromTimesheet&&(footerHtml="<div class='col-sm-8' id='zp_appproval_container'></div>"),footer.prepend(footerHtml)}else(footer=ZP5Form.LAYOUT.find(".modal-footer")).find("#zp_appproval_container").empty();(void 0!==apprDtl.systemApproved||apprDtl.canSendApproval)&&(ZP5Form.RecordApproval.APPROVAL_CALLBACK=callback,ZP5Form.RecordApproval.APPROVER_FOOTER=footer,ZP5Form.getFormClassObj().isDraftrec||ZP5Form.RecordApproval.showApprovalDetails(apprDtl),ZP5Form.PRINT&&(ZP5Form.ISAPPROVAL=!0,ZP5Form.APPROVERHTML=apprDtl))}},showApprovalDetails:function(approvalDetails){var apprejHtmlList=$('<div id="zp_appproval_list" class="ZPAprvDts" formid ="'+approvalDetails.formId+'"></div>'),tableName=ZP5Form.getCurrFormsOperation().getTableName(),isfromAttendence=!1,isfromTimesheet=!1,hasApprvAllPerm=!1;ZPApprovals.initApprovalSettings(approvalDetails),(Layout.ISLOCALIDCSETUP||Layout.ISDEV)&&approvalDetails.currentApprovalStatus!==zpconst.ApprovalStatus.Cancelled&&approvalDetails.currentApprovalStatus!==zpconst.ApprovalStatus.Revoked&&$("#"+Layout.Page.pageId).find("#zp_appproval_comment_btn").show(),void 0!==approvalDetails.isfromAttendence&&1==approvalDetails.isfromAttendence&&(isfromAttendence=!0),void 0!==approvalDetails.isfromTimesheet&&1==approvalDetails.isfromTimesheet&&(isfromTimesheet=!0,apprejHtmlList.addClass("ZPAprval_list"));var singleRecDtl=ZP5Form.getSingleRecord();if(isfromAttendence||void 0==singleRecDtl||ZPApprovals.setApprRecordOwner(singleRecDtl.record),void 0===approvalDetails.systemApproved||approvalDetails.systemApproved)-2===approvalDetails.currentApprovalStatus||-3===approvalDetails.currentApprovalStatus?approvalDetails.canSendApproval&&(apprejHtmlList.append('<button class="btn btn-primary">'+ZPI18N.getString("zp.sendforapproval")+"</button>"),"APPROVER_CHOOSEN_BY_USER"===ZP5Form.getApproverType()&&(apprejHtmlList.append('<div class="col-sm-6" id="zp_form_approver"><select id="zp_form_chooseapprover" name="zp_approverId">'+ZPeople.User.getEmployeeListFormatByType("option")+"</select></div>"),apprejHtmlList.find("#zp_form_chooseapprover").select2())):2==approvalDetails.currentApprovalStatus?erecno!=ZP5Form.RecordApproval.CREATE_ERECNO&&erecno!=ZP5Form.RecordApproval.OWNER_ERECNO||!ZP5Form.Permission.getAddPerm()||"P_Employee"==tableName||"P_Designation"==tableName||"P_Department"==tableName||"P_Goals"==tableName||"P_EmployeeLeave"==tableName||"P_MultiRater"===tableName||"P_MultiRater_Approval"===tableName||isfromAttendence||isfromTimesheet||-1!=Layout.Page.hash.indexOf("approvals/myapproval")||-1!=Layout.Page.hash.indexOf("approvals/myrequest")||-1!=Layout.Page.hash.indexOf("dashboard/feeds")||-1!=Layout.Page.hash.indexOf("dashboard/approvals")||-1!=Layout.Page.hash.indexOf("admin/dataadministration/activityLog")||(ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_resubmitbtn").show(),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_resubmitbtn").on("click",function(){ZP5Form.RecordApproval.onRecordResubmit()})):(0==approvalDetails.currentApprovalStatus&&(erecno!=ZP5Form.RecordApproval.CREATE_ERECNO&&erecno!=ZP5Form.RecordApproval.OWNER_ERECNO||!ZP5Form.Permission.getAddPerm()||"P_Employee"==tableName||"P_Designation"==tableName||"P_Department"==tableName||"P_Goals"==tableName||"P_EmployeeLeave"==tableName||"P_MultiRater"===tableName||"P_MultiRater_Approval"===tableName||isfromAttendence||isfromTimesheet||-1!=Layout.Page.hash.indexOf("approvals/myapproval")||-1!=Layout.Page.hash.indexOf("approvals/myrequest")||-1!=Layout.Page.hash.indexOf("dashboard/feeds")||-1!=Layout.Page.hash.indexOf("dashboard/approvals")||-1!=Layout.Page.hash.indexOf("admin/dataadministration/activityLog")||(ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_close").hide(),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_resubmitbtn").show(),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_resubmitbtn").on("click",function(){ZP5Form.RecordApproval.onRecordResubmit()}))),apprejHtmlList.append($('<div class="AprvImg '+(0===approvalDetails.currentApprovalStatus?"RsltR":"RsltA")+'"><img class="Usrimg" src="/images/auto-app.jpg"></div>')),apprejHtmlList.append(ZP5Form.RecordApproval.completeApprovelHtml(approvalDetails.currentApprovalStatus)),void 0!==ZPView.VIEW_CONTAINER&&ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).length>0&&(ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.approver div").tooltip("destroy"),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.approver").html('<div class="AprvImg" title="'+(approvalDetails.currentApprovalStatus===zpconst.ApprovalStatus.Approved?ZPI18N.getString("zp.systemapproved"):ZPI18N.getString("zp.systemrejected"))+'" data-toggle="tooltip" data-container="body" data-placement="top"><img class="Usrimg"  height=44 src="/images/auto-app.jpg"></div>'),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.approvedtime").html(""),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.ZPThumb").html('<i class="'+(1===approvalDetails.currentApprovalStatus?"IC-tick-2px grn S21":"IC-cls-r red S18")+'"></i>'))),!isadmin||1!=approvalDetails.currentApprovalStatus||"P_Employee"==tableName||"P_Designation"==tableName||"P_Department"==tableName||"P_Goals"==tableName||"P_EmployeeLeave"==tableName||"P_MultiRater"===tableName||"P_MultiRater_Approval"===tableName||isfromAttendence||isfromTimesheet||-1!=Layout.Page.hash.indexOf("approvals/myapproval")||-1!=Layout.Page.hash.indexOf("approvals/myrequest")||-1!=Layout.Page.hash.indexOf("dashboard/feeds")||-1!=Layout.Page.hash.indexOf("dashboard/approvals")||ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_cancelapproval").removeClass("DN"),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_container").html(apprejHtmlList);else{var processedList=approvalDetails.processed,currentApp=approvalDetails.current?approvalDetails.current.delegatee&&1!==approvalDetails.current.delegatee.Sub_Type?approvalDetails.current.delegatee:approvalDetails.current:void 0,pendingAp=approvalDetails.pending,pointNext=!1,isCompleted=!1;if(void 0!=processedList&&processedList.length>0){for(var procInt=0;procInt<processedList.length;procInt++){var procListDtl=processedList[procInt];0!==procInt&&apprejHtmlList.append($('<div class="AprvCon RsltA"><span class="Hrline"></span><span class="Edot"></span></div>')),(eleme=$('<div showappdtl="true" id="proctitle" data-toggle="tooltip" data-container="body" data-placement="top" class="AprvImg '+(0===procListDtl.approvalStatus?"RsltR":"RsltA")+'"><img class="Usrimg" src="'+ZPeople.User.getPhoto(procListDtl.photo)+'"></div>').data("approverdtl",procListDtl)).attr("title",ZPeople.decodeTxt(procListDtl.name)),apprejHtmlList.append(eleme)}pointNext=!0}if(void 0!==approvalDetails.current&&$.each(ZPeople.SUB_USERLIST,function(index,data){approvalDetails.current.erecno===data&&(approvalDetails.isOwner=!0)}),void 0!==currentApp){if(void 0!==ZPView.VIEW_CONTAINER&&ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).length>0&&ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.ZPThumb").html('<i class="IC-pending org S18"></i>'),approvalDetails.isOwner||isadmin||approvalDetails.recOwner!==erecno&&approvalDetails.recordowner.erecno!==erecno?ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_followupbtn").addClass("DN"):ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_followupbtn").removeClass("DN").attr("dataforapprovalid",approvalDetails.dataForApprovalId),erecno!=ZP5Form.RecordApproval.CREATE_ERECNO&&erecno!=ZP5Form.RecordApproval.OWNER_ERECNO||"P_EmployeeLeave"==tableName||"P_Employee"==tableName||"P_Designation"==tableName||"P_Department"==tableName||"P_Goals"==tableName||"P_MultiRater"===tableName||"P_MultiRater_Approval"===tableName||isfromAttendence||isfromTimesheet||-1!=Layout.Page.hash.indexOf("approvals/myapproval")||-1!=Layout.Page.hash.indexOf("approvals/myrequest")||-1!=Layout.Page.hash.indexOf("dashboard/feeds")||-1!=Layout.Page.hash.indexOf("dashboard/approvals")?ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_cancelapproval").addClass("DN"):ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_cancelapproval").removeClass("DN"),pointNext&&apprejHtmlList.append($('<div class="AprvCon RsltA CP"><span class="Hrline"></span><span class="Edot"></span></div>')),apprejHtmlList.append($('<div class="AprvImg RsltC CP" id="curappname" showaprrej= "'+approvalDetails.isOwner+'" data-toggle="tooltip" data-placement="top" current="true"><img class="Usrimg" src="'+ZPeople.User.getPhoto(currentApp.photo)+'"></div>').data("approverdtl",currentApp)),apprejHtmlList.find("#curappname").attr("title",ZPeople.decodeTxt(currentApp.name)),pendingAp.length>0){apprejHtmlList.append($('<div class="AprvCon RsltP"><span class="Hrline"></span><span class="Edot"></span></div>'));for(var penInt=0;penInt<pendingAp.length;penInt++){var eleme,penAppDtl=pendingAp[penInt];(eleme=$('<div class="AprvImg RsltP" data-toggle="tooltip" data-placement="top"><img class="Usrimg" src="'+ZPeople.User.getPhoto(penAppDtl.photo)+'"></div>').data("approverdtl",penAppDtl)).attr("title",ZPeople.decodeTxt(penAppDtl.name)),apprejHtmlList.append(eleme),pendingAp.length-1!==penInt&&apprejHtmlList.append($('<div class="AprvCon RsltP"><span class="Hrline"></span><span class="Edot"></span></div>'))}hasApprvAllPerm=(isfromTimesheet||!ZPUtil.Validation.isEmpty(tableName))&&!ZPUtil.checkIsExistInArray(["P_MultiRater","P_GoalSheet","P_MultiRater_Approval"],tableName)&&isadmin}}else approvalDetails.canceledRecord||(isCompleted=!0);if(!isadmin||1!=approvalDetails.currentApprovalStatus||"P_Goals"==tableName||"P_Designation"==tableName||"P_Employee"==tableName||"P_Department"==tableName||"P_EmployeeLeave"==tableName||"P_MultiRater"===tableName||"P_MultiRater_Approval"===tableName||isfromAttendence||isfromTimesheet||-1!=Layout.Page.hash.indexOf("approvals/myapproval")||-1!=Layout.Page.hash.indexOf("approvals/myrequest")||-1!=Layout.Page.hash.indexOf("dashboard/feeds")||-1!=Layout.Page.hash.indexOf("dashboard/approvals")||ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_cancelapproval").removeClass("DN"),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_container").html(apprejHtmlList),!(0==approvalDetails.currentApprovalStatus||approvalDetails.canceledRecord&&2==approvalDetails.currentApprovalStatus)||erecno!=ZP5Form.RecordApproval.CREATE_ERECNO&&erecno!=ZP5Form.RecordApproval.OWNER_ERECNO||!ZP5Form.Permission.getAddPerm()||"P_Employee"==tableName||"P_Designation"==tableName||"P_Department"==tableName||"P_Goals"==tableName||"P_EmployeeLeave"==tableName||"P_MultiRater"===tableName||"P_MultiRater_Approval"===tableName||isfromAttendence||isfromTimesheet||-1!=Layout.Page.hash.indexOf("approvals/myapproval")||-1!=Layout.Page.hash.indexOf("approvals/myrequest")||-1!=Layout.Page.hash.indexOf("dashboard/feeds")||-1!=Layout.Page.hash.indexOf("dashboard/approvals")||-1!=Layout.Page.hash.indexOf("admin/dataadministration/activityLog")||(approvalDetails.canceledRecord||(ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_close").hide(),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_cancelapproval").hide()),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_resubmitbtn").show(),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_resubmitbtn").on("click",function(){ZP5Form.RecordApproval.onRecordResubmit()})),!isCompleted&&approvalDetails.isOwner&&2!=approvalDetails.currentApprovalStatus)ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").addClass("DN"),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").on("click",function(){ZP5Form.RecordApproval.showApproveRejectBox($(this).attr("approvaltype"),hasApprvAllPerm),Layout.Page.container.find("#zp_approvereject_box").show(),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").hide()}),ZP5Form.RecordApproval.showApproveRejectBox("1",hasApprvAllPerm,!0),void 0==ZPeople.loggedInGroups&&Groups.getMyGroups(),currentApp.erecno+""!==ZPeople.CURR_USER.usererec&&currentApp.deptId+""!==ZPeople.CURR_USER.deptId&&currentApp.roleId+""!==ZPeople.CURR_USER.roleId&&-1==ZPeople.loggedInGroups.indexOf(currentApp.groupId+"")||ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").show(),Layout.Page.container.find("[id=zp_approvereject_box]").find("i.CmtsBoxCls").trigger("click"),apprejHtmlList.find('[showaprrej="true"]').on("click",function(){ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").show()});else if(ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn, #zp_approvereject_box").remove(),isCompleted){var finalApprDtl=processedList[processedList.length-1];apprejHtmlList.append(ZP5Form.RecordApproval.completeApprovelHtml(finalApprDtl.approvalStatus)),void 0!==ZPView.VIEW_CONTAINER&&ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).length>0&&ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.ZPThumb").html('<i class="'+(1===finalApprDtl.approvalStatus?"IC-like grn S21":"IC-unlike red S21")+'"></i>')}if(void 0!==ZPView.VIEW_CONTAINER&&ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).length>0)if(void 0!==currentApp&&2!=approvalDetails.currentApprovalStatus)ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.approver div").tooltip("destroy"),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.approver").html('<div class="AprvImg" title="'+ZPeople.escapeHtml(currentApp.name)+'" data-toggle="tooltip" data-container="body" data-placement="top"><img src="'+ZPeople.User.getPhoto(currentApp.photo)+'"  height=44 class="Usrimg"></div>'),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.approvedtime").html("");else if(isCompleted){finalApprDtl=processedList[processedList.length-1];ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.approver div").tooltip("destroy"),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.approver").html('<div class="AprvImg" title="'+finalApprDtl.name+'" data-toggle="tooltip" data-container="body" data-placement="top"><img src="'+ZPeople.User.getPhoto(finalApprDtl.photo)+'"  height=44 class="Usrimg"></div>'),ZPView.VIEW_CONTAINER.find("#zp_view_record_"+ZP5Form.CURRFORM_PARAM.recordId).find("td.approvedtime").html(finalApprDtl.approvedTime)}apprejHtmlList.find('[showappdtl="true"]').on("click",function(){ZP5Form.RecordApproval.showApprovedDetails(this)})}ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_list").find("button").on("click",function(){ZP5Form.RecordApproval.triggerApprovalManually(this)})},triggerApprovalManually:function(getThis){var params={method:"triggerRecordApproval",recordId:ZP5Form.CURRFORM_PARAM.recordId?ZP5Form.CURRFORM_PARAM.recordId:ZPApprovals.RECORDID,formId:ZP5Form.CURRFORM_PARAM.formId?ZP5Form.CURRFORM_PARAM.formId:ZPApprovals.FORMID,conreqcsr:csrfToken};if(ZP5Form.RecordApproval.validateApproverChoosen(params,getThis)){var isApprHeader=!1;ZP5Form.LAYOUT.find("#headerApprovalBtn").length>0&&(isApprHeader=!ZP5Form.LAYOUT.find("#headerApprovalBtn").hasClass("zp_dyn"),ZP5Form.LAYOUT.find("#headerApprovalBtn").addClass("zp_dyn")),$.post("/triggerRecordApproval.zp",params,function(data){if(data.errorMsg)ZPeople.Message.failure(data.errorMsg),isApprHeader&&ZP5Form.LAYOUT.find("#headerApprovalBtn").removeClass("zp_dyn"),$(getThis).attr("disabled",!1),ZPApprovals.addSendApprClickEvent(getThis);else{ZPeople.Message.success(ZPI18N.getString("zp.sentapprsuccessmsg"));var tableName=ZP5Form.getCurrFormsOperation().getTableName();Layout.UrlConf.isForm()||!ZPUtil.Validation.isEmpty(tableName)&&"P_TimesheetList"!=tableName&&"P_AttendanceReg"!=tableName&&"P_GoalSheet"!=tableName?ZPApprovals.approveRejectDtlCallBack(data,params):ZP5Form.RecordApproval.handleApproveRejectResponse(data,params,[ZP5Form.CURRFORM_PARAM.recordId])}})}else $(getThis).attr("disabled",!1),ZPApprovals.addSendApprClickEvent(getThis)},getApprovalFooter:function(){return ZP5Form.RecordApproval.APPROVER_FOOTER?ZP5Form.RecordApproval.APPROVER_FOOTER:ZP5Form.LAYOUT},validateApproverChoosen:function(params,getThis){if("APPROVER_CHOOSEN_BY_USER"===ZP5Form.getApproverType()){var apprChoosenDiv;if("-Select-"===(apprChoosenDiv=getThis?$(getThis).siblings("#zp_form_approver").find("#zp_form_chooseapprover"):ZP5Form.RecordApproval.getApprovalFooter().find("#zp_form_chooseapprover")).val())return apprChoosenDiv.closest("#zp_form_approver").append('<div id="error_message" class="ERR MT1">'+ZPI18N.getString("zp.chooseapprovererrormsg")+"</div>"),!1;params.empChoosenApprErecno=apprChoosenDiv.val()}return!0},onRecordResubmit:function(){ZP5Form.IS_RESUBMIT=!0,ZP5Form.RESUBMIT_RECORDID=Layout.Page.childUrlParam.recordId,ZP5Form.RecordApproval.APPROVER_FOOTER?ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_resubmitbtn").addClass("disabled"):ZP5Form.LAYOUT.find(".modal-footer #zp_approval_resubmitbtn").addClass("disabled"),ZP5Form.showForm("add")},completeApprovelHtml:function(approvalStatus){return'<div class="AprvCon '+(1===approvalStatus?"RsltA":"RsltR")+'"><span class="Hrline"></span><span class="Edot"></span></div><div class="AprvImg '+(1===approvalStatus?"RsltA":"RsltR")+'" data-toggle="tooltip" data-placement="top" title="'+(1===approvalStatus?ZPI18N.getString("zp.approved"):2===approvalStatus?ZPI18N.getString("zp.cancelled"):ZPI18N.getString("zp.rejected"))+'"><span class="Scrcle"><i class="'+(1===approvalStatus?"IC-tick":2===approvalStatus?"IC-rejected":"IC-cls")+'"></i></span></div>'},showApproveRejectBox:function(type,hasApprvAllPerm,isInitial){var footerObj=ZP5Form.RecordApproval.APPROVER_FOOTER,currApprRejBox=footerObj.find("#zp_approvereject_box").removeClass("DN");if(currApprRejBox.length>0&&!isInitial)currApprRejBox.attr("type",type),currApprRejBox.find("#zp_form_approvalbtn_cont #zp_approval_confirm_btn").removeClass("MT12").addClass("MT53"),currApprRejBox.find("#zp_form_approvalbtn_cont .checkbox").remove(),"1"===type?(currApprRejBox.addClass("RsltA").removeClass("RsltR"),currApprRejBox.find(".IC-ar-dwn").addClass("grn").removeClass("red"),currApprRejBox.find("#zp_approval_confirm_btn").addClass("btn-success").removeClass("btn-danger"),hasApprvAllPerm&&(currApprRejBox.find("#zp_form_approvalbtn_cont").prepend('<label class="checkbox PT25"><input type="checkbox"><span></span>'+ZPI18N.getString("zp.approveall")+"</label>"),currApprRejBox.find("#zp_form_approvalbtn_cont #zp_approval_confirm_btn").removeClass("MT53").addClass("MT12"))):(currApprRejBox.addClass("RsltR").removeClass("RsltA"),currApprRejBox.find(".IC-ar-dwn").addClass("red").removeClass("grn"),currApprRejBox.find("#zp_approval_confirm_btn").addClass("btn-danger").removeClass("btn-success")),currApprRejBox.find("#zp_approval_confirm_btn").html(ZPI18N.getString("zp.confirm")),ZP5Form.RecordApproval.pointApprovalArrow(currApprRejBox,footerObj.find('#zp_appproval_list [current="true"]'));else{var appRejBox=$('<div id="zp_approvereject_box" '+(isInitial?"":'type="'+type+'"')+'class="ZPAprvCmts pad top '+(isInitial?"RsltP":"1"===type?"RsltA":"RsltR")+' Bclr"><i class="IC-cls-1px CP CmtsBoxCls"></i><div class="darrow" style="left: 0px;"></div><div class="CmtBox"><div class="row"><div class="col-sm-10"><label>'+ZPI18N.getString("zp.comment")+'&nbsp;:</label><textarea id="zp_approval_comment" class="form-control" rows="3" placeholder="'+ZPI18N.getString("zp.approvalcommentplaceholder")+'"></textarea></div>'+(isInitial?'<div class="col-sm-2" id="zp_form_approvalbtn_cont" init="true"><button id="zp_approval_confirm_btn" class="btn DB btn-success MT20">'+ZPI18N.getString("zp.approve")+'</button><button id="zp_approval_reject_btn" class="btn DB btn-danger MT5" style="margin-left: 0px;">'+ZPI18N.getString("zp.reject")+"</button></div>":"")+"</div></div></div>");appRejBox.find(".IC-cls-1px").on("click",function(){$(this).parent().addClass("DN");var approvalCont=$(this).siblings().find("#zp_form_approvalbtn_cont"),isAppInit=approvalCont.attr("init"),currentApp=Layout.Page.container.find(".RsltC").data().approverdtl;currentApp.erecno+""===ZPeople.CURR_USER.usererec||currentApp.deptId+""===ZPeople.CURR_USER.deptId||currentApp.roleId+""===ZPeople.CURR_USER.roleId||-1!=ZPeople.loggedInGroups.indexOf(currentApp.groupId+"")?ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_appproval_approve_btn, #zp_appproval_reject_btn").show():Layout.Page.container.find("#zp_approvereject_box").hide(),"true"===isAppInit&&(approvalCont.removeAttr("init"),approvalCont.find("#zp_approval_confirm_btn").removeClass("MT20").addClass("MT53"),approvalCont.find("#zp_approval_reject_btn").remove(),$(this).parent().removeClass("RsltP"),approvalCont.siblings(".IC-ar-dwn").removeClass("blu"))}),appRejBox.find("#zp_approval_confirm_btn, #zp_approval_reject_btn").on("click",function(){var type=ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approvereject_box").attr("type"),isAllLevelApprove=!1;void 0===type&&(type=$(this).hasClass("btn-success")?"1":"0"),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_form_approvalbtn_cont input").prop("checked")&&(isAllLevelApprove=!0),$(this).parent().find("button").addClass("disabled");var comment=ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_comment").val(),formid=$(this).closest("#zp_approvereject_box").siblings("#zp_appproval_container").find("#zp_appproval_list").attr("formid");if(ZP5Form.validateApprovalComment(type,comment,ZPApprovals.getApprovalSettings(formid||ZP5Form.CURRFORM_PARAM.formId),ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_comment")))if(void 0!==ZP5Form.RecordApproval.APPROVAL_CALLBACK&&"function"==typeof ZP5Form.RecordApproval.APPROVAL_CALLBACK)ZP5Form.RecordApproval.APPROVAL_CALLBACK(type,comment,isAllLevelApprove);else if(-1!==Layout.Page.hash.indexOf("#attendance/regularization/")||-1!==Layout.Page.hash.indexOf("#attendance/entry/")||-1!==Layout.Page.hash.indexOf("mode:Attendance")||-1!==Layout.Page.hash.indexOf("#home/dashboard/feeds")&&$("#"+Layout.Page.pageId+" #ZPAtt_Reg_Details").hasClass("in"))Attendance.Reg.appRejRegDetails(type,isAllLevelApprove);else{var recIds=new Array(ZP5Form.CURRFORM_PARAM.recordId);ZP5Form.Record.approveReject(recIds,type,comment,isAllLevelApprove,ZP5Form.RecordApproval.handleApproveRejectResponse,!0)}else ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_confirm_btn").removeClass("disabled")}),0===currApprRejBox.length?footerObj.prepend(appRejBox):currApprRejBox.replaceWith(appRejBox),footerObj.find('#zp_appproval_list [current="true"]').show(),ZP5Form.RecordApproval.pointApprovalArrow(appRejBox,footerObj.find('#zp_appproval_list [current="true"]'))}footerObj.find("#zp_approval_detail_cont").is(":visible")&&footerObj.find("#zp_approval_detail_cont").addClass("DN")},handleApproveRejectResponse:function(resultData,params,otherDetails){var siblingsDiv;if(resultData.error)return Layout.Page.container.find("#zp_approval_comment").length>0?(siblingsDiv=Layout.Page.container.find("#zp_approval_comment")).closest(".CmtBox").find("#zp_form_approvalbtn_cont button").removeClass("disabled"):Layout.Page.container.find("[streamid="+JSON.parse(params.recordIds).pop()+"] #zp_feeds_approvereject_comment").length>0&&(Layout.Page.container.find("[streamid="+JSON.parse(params.recordIds).pop()+"] #zp_feeds_submit_approval").attr("disabled",!1),siblingsDiv=Layout.Page.container.find("[streamid="+JSON.parse(params.recordIds).pop()+"] #zp_feeds_approvereject_comment")),void(siblingsDiv&&ZPApprovals.constructApproveRejectError(resultData,siblingsDiv));if(void 0!==resultData&&resultData.success){if(ApprovalHome.updateApprovalCount(),resultData.isPhotoTransferApproved){let userDts=ZPeople.getUserDetailsById(resultData.approvalJson.recOwner);if(void 0!==resultData.approvalJson.recordowner.photo&&""!==resultData.approvalJson.recordowner.photo)resultData.approvalJson.recordowner.photo.split("|").length>0&&void 0!==resultData.approvalJson.recOwner&&(userDts.avatarid=resultData.avatarId,ZPeople.setPhotoURL("1",void 0,userDts));$("img[empid="+userDts.usererec+"][elem=profilePhoto], img[empid="+userDts.id+"][elem=profilePhoto]").each(function(){var imgType=$(this).attr("imgtype");this.src="thumb"===imgType?userDts.thumb:"original"===imgType?userDts.originalphoto:"zpimg"===imgType?userDts.zpeoplePhoto:userDts.avatar})}if(void 0!==resultData.approvalJson){var recordObj=ZP5Form.getSingleRecord(params.formId,otherDetails[0]);void 0!==recordObj&&void 0!==recordObj.record&&(recordObj.record.approvalDetails=resultData.approvalJson,recordObj.record.message.approvalStatus=resultData.approvalJson.currentApprovalStatus),ZP5Form.CURRFORM_PARAM&&void 0!==ZP5Form.CURRFORM_PARAM.formId&&void 0!==ZP5Form.CURRFORM_PARAM.recordId&&(ZP5Form.RecordApproval.showApprovalHierarchy(resultData.approvalJson),ZP5Form.isApprovalStarted()||Layout.Page.container.find("#zp_addedit_record_"+params.formId).find("#zp_form_editin_singlerec").addClass("DN"))}if("selfservice/leave/list"===Layout.Page.currentmode&&Leave.SelfService.View.get(),-1!=Layout.Page.hash.indexOf("#leavetracker/view-recordId")||-1!=Layout.Page.hash.indexOf("#selfservice/leave/list"))Leave.View.List.refresh=!0;else if(-1!=Layout.Page.hash.indexOf("#operations/leavetracker/compensatory")&&settingsPage.container.find("#compensatory_add_edit_view").length>0)LeaveCompensatory.refresh=!0;else if(-1!=Layout.Page.hash.indexOf("#operations/leavetracker/grant")&&settingsPage.container.find("#grant_add_edit_view").length>0)LeaveGrant.refresh=!0;else if(LVUtil.urls.Grant.isHome())ZPLTGrant.refreshList();else if(void 0!==Layout.Page.urlparam.MODE&&"Attendance"===Layout.Page.urlparam.MODE){var recRow=Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId);ZPApprovals.constructApproveOrReject(recRow,resultData.approvalJson.currentApprovalStatus)}else"tabler"==Attendance.Entry.selectedView&&Attendance.Entry.getList(Attendance.Entry.selectedView,Attendance.Entry.preMonth)}},showApprovedDetails:function(userObj){var userApprData=$(userObj).data("approverdtl"),userDtl=ZPeople.getUserDetailsById(userApprData.erecno),appDtlObj=ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approval_detail_cont");ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approvereject_box").is(":visible")&&ZP5Form.RecordApproval.APPROVER_FOOTER.find("#zp_approvereject_box").addClass("DN"),0===appDtlObj.length?((appDtlObj=$('<div class="ZPAprvCmts RsltA top Bclr" id="zp_approval_detail_cont"><i class="IC-cls-1px CP CmtsBoxCls"></i><div class="darrow" style="left: 0px;"></div><div class="CmtBox"><div class="row"><div class="col-sm-4"><div class="uinfo"><div class="itms" id="zp_approver_name"></div><div class="itms" id="zp_approver_email"></div><div class="itms DN" id="zp_approver_department"></div><div class="itms DN" id="zp_approver_extension"></div></div></div><div class="col-sm-7"><div class="PT15"><label><span id="zp_apprstatus_str"></span> <span class="dgry">'+ZPI18N.getString("zp.on")+'</span> <span class="dgry AprvTym " id="zp_apprrej_time"></span></label><div class="form-control P0I ZPtxtareaDiv B0I"><span id="zp_form_apprdtl_comment"></span></div></div></div></div></div></div>')).find(".CmtsBoxCls").on("click",function(){$(this).parent().addClass("DN")}),ZP5Form.RecordApproval.APPROVER_FOOTER.prepend(appDtlObj)):appDtlObj.removeClass("DN"),appDtlObj.addClass(0===userApprData.approvalStatus?"RsltR":" RsltA").removeClass(0===userApprData.approvalStatus?"RsltA":" RsltR"),appDtlObj.find(".ZPArwDir").addClass(0===userApprData.approvalStatus?"red":" grn").removeClass(0===userApprData.approvalStatus?"grn":" red"),appDtlObj.find("#zp_approver_name").html('<i class="IC-usr-fill S16"></i><span><i class="gry">'+userDtl.empid+"</i> "+userDtl.name+"</span>"),appDtlObj.find("#zp_approver_email").html('<i class="IC-mail2 S18"></i><span>'+userDtl.email+"</span>"),void 0!==userDtl.deptName?appDtlObj.find("#zp_approver_department").html('<i class="IC-usr-grp S20"></i><span>'+userDtl.deptName+"</span>").removeClass("DN"):appDtlObj.find("#zp_approver_department").addClass("DN"),void 0!==userDtl.extension&&""!==userDtl.extension?appDtlObj.find("#zp_approver_extension").html('<i class="IC-exten S16"></i><span>'+userDtl.extension+"</span>").removeClass("DN"):appDtlObj.find("#zp_approver_extension").addClass("DN"),appDtlObj.find("#zp_apprstatus_str").html(userApprData.approvalStatusStr),appDtlObj.find("#zp_apprrej_time").html(userApprData.approvedTime),appDtlObj.find("#zp_form_apprdtl_comment").html(userApprData.comment),ZP5Form.RecordApproval.pointApprovalArrow(appDtlObj,$(userObj))},pointApprovalArrow:function(appDtlObj,userObj){appDtlObj.find(".darrow").animate({left:userObj.position().left+43+"px"},400)}},ZP5Form.Validation={IS_EMPTY:1001,IS_NOT_SELECTED:1002,IS_INVALID:1003,INVALID_NUMBER:1004,INVALID_EMAIL:1005,INVALID_DATE:1006,ROUNDOFF_DECIMAL:1007,INVALID_DECIMALPOINT:1008,FILE_SIZE_EXCEED:1009,IMAGE_FORMAT_NOTALLOWED:1010,VALUE_LENGTH_EXCEED:1011,NOT_IN_RANGE:1012,SMALLPASSWORDLENGTH:1013,PASSWORDEMPTY:1014,PWDPOLICYERR:1015,LESS_THEN_NOT_ALLOWED:1016,GREATER_THEN_NOT_ALLOWED:1017,LESS_AND_GREATER_THEN_NOT_ALLOWED:1018,REUPLOAD_FILE:1019,FILEUPLOAD_INPROGRESS:1020,VIRUS_FILE:1021,COUNTRY_EMPTY:1022,ADDRESS_CHILD_EMPTY:1023,validateForm:function(formClassObj){formClassObj.isSubmitMsgAct=!0;var result={errorList:[],params:{}},curFormComp=ZP5Form.getCurrFormsOperation().getFormComponentData();if(formClassObj.ISBLUEPRINT&&(curFormComp=ZPA_BPOperation.getFormComponents()),void 0!==curFormComp){$.each(curFormComp.message.formComponentDetails,function(){void 0!==this.column1&&ZP5Form.Validation.validate(formClassObj,this.column1,this.isTabular,result),void 0!==this.column2&&ZP5Form.Validation.validate(formClassObj,this.column2,this.isTabular,result)});var enablePwdChk=!1;if(formClassObj.isDomainPresent){var getInvite=window.location.href.split("/");"invite"!=(getInvite=getInvite[getInvite.length-1])&&(enablePwdChk=!0)}var passWord=null;"P_Employee"!==ZP5Form.getCurrFormsOperation().getTableName()||"ADD"!=formClassObj.mode||ZP5Form.autoGenPwd||enablePwdChk&&(passWord=Layout.Page.container.find("[name=temppwd]").val(),ZPSetupCommon.isEmpty(passWord)?result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.PASSWORDEMPTY,this,!1,null)):$("div.zp-err-msg").remove(),!ZPSetupCommon.isEmpty(passWord)&&passWord.length<8&&result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.SMALLPASSWORDLENGTH,this,!1,null))),formClassObj.moduleHandler.validateForm(result)}return result},validate:function(formClassObj,fields,isTabular,result){result.params.isPicklistIdEnabled=!0;var formPageCont=formClassObj.FIELD_LAYOUT,isMandatory=!0;(formClassObj.isDraft||formClassObj.isDraftrec&&formClassObj.isSingleFiledEdit())&&(isMandatory=!1);let fldCreateFun=formClassObj.getCreateFldFunctions(),tableName=formClassObj.getTableName();return $.each(fields,function(){var labelName=this.labelName,fieldType=this.fieldType,formField=this.fieldObj=formPageCont.find(":input[name="+labelName+"]");let{errMsg:errMsg,skipDefaultValidation:skipDefaultValidation}=formClassObj.moduleHandler.validateField(this);if(errMsg)result.errorList.push(errMsg);else if(!skipDefaultValidation)if(void 0!==fldCreateFun&&void 0!==fldCreateFun[labelName]&&"function"==typeof fldCreateFun[labelName]){var errorMsg=fldCreateFun[labelName](this,"VALIDATE");"VALID"!==errorMsg&&result.errorList.push(errorMsg)}else{if(fieldType==FormConstants.FieldType.ADDRESS&&ZP5Form.getFormClassObj().isPermitted(this.editperm,this.allowedRoleIdsForEdit,this.allowedRoleIdsForView)&&(formField=isTabular&&this.isGridType?formPageCont.find("[parentfcid="+this.formComponentId+"]"):formPageCont.find("[folabel="+labelName+"]")),0===formField.length||0!=formClassObj.LAYOUT.find("#zp_field_id_"+this.formComponentId).length&&("true"!==formClassObj.LAYOUT.find("#zp_field_id_"+this.formComponentId).attr("fieldSelect")||!formClassObj.LAYOUT.find("#zp_field_outer_"+this.formComponentId).parent().is(":visible")))return;var value;if(fieldType===FormConstants.FieldType.AUTONUMBER||fieldType===FormConstants.FieldType.PLAIN_TEXT)return;if(isTabular){var formComp=this;fieldType==FormConstants.FieldType.ADDRESS&&this.isGridType&&(formField=$(formField).parent()),$.each(formField,function(index){var returnObj=ZP5Form.Validation.validateField(formClassObj,result,formComp,$(this),isTabular,index+1);void 0!==returnObj&&(value=returnObj.value,result=returnObj.result,formClassObj.isSubmitMsgAct&&(formClassObj.isSubmitMsgAct=this.fieldType===FormConstants.FieldType.CHECK_BOX?!value:ZPUtil.Validation.isEmpty(value)),void 0!==value&&null!==value||(value=""),fieldType!==FormConstants.FieldType.DATE_TIME||ZPUtil.Validation.isEmpty(value)?fieldType!==FormConstants.FieldType.FILE_UPLOAD&&fieldType!==FormConstants.FieldType.IMAGE||(value="",0!==$(this).siblings("#filename").length&&(value=$(this).siblings("#filename").val())):value=Calendar.convertHourFormat(value),ZP5Form.Record.putParamForTabular(result.params,labelName,value,fieldType))})}else{var returnObj=ZP5Form.Validation.validateField(formClassObj,result,this,formField,isTabular);if(void 0!==returnObj){if(value=returnObj.value,result=returnObj.result,this.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE){if(null!==value&&value.length>0)value=this.fieldType==FormConstants.FieldType.LOOKUP?value.replace(/,/g,";"):value.join(";");else if(isMandatory){if(!(formField.parents("[isActionHidden=true]").length>0)&&ZP5Form.Field.isMandatory(tableName,this.isMandatory,labelName))return void result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.IS_NOT_SELECTED,this,isTabular))}this.fieldType==FormConstants.FieldType.PICKLIST&&void 0!=value&&0==value.length&&(value="")}else fieldType!==FormConstants.FieldType.DATE_TIME||ZPUtil.Validation.isEmpty(value)||(value=Calendar.convertHourFormat(value));if(this.fieldType!==FormConstants.FieldType.FILE_UPLOAD&&this.fieldType!==FormConstants.FieldType.IMAGE||(value="",0!==formField.siblings("#filename").length&&(value=formField.siblings("#filename").val())),this.fieldType===FormConstants.FieldType.MULTI_FILE_UPLOAD){if(formClassObj.isAddMode())return;if(value=[],0!==formField.siblings("#filename").length){var ele=formField.closest("div[folabel="+labelName+"]").find('div[id^="zp_form_fileuploadfield_"]');if($.each(ele,function(){var acls=$(this).find('a[id^="filepa_"]');if("true"==$(acls).siblings().attr("change")){var filepa=$(acls).attr("filepath");value.push(filepa)}}),0==value.length)return;value=JSON.stringify(value)}}formClassObj.isSubmitMsgAct&&(formClassObj.isSubmitMsgAct=this.fieldType===FormConstants.FieldType.CHECK_BOX?!value:ZPUtil.Validation.isEmpty(value)),result.params[labelName]=value,void 0!=returnObj.country_code&&(result.params[labelName+".country_code"]=returnObj.country_code)}}}}),result},validateField:function(formClassObj,result,formComp,formField,isTabular,rowCnt){var value=formField.val(),fieldType=formComp.fieldType;if(void 0!=formField.attr("zcomponentname")){let componentname=formField.attr("zcomponentname");if("datefield"==componentname||"datetimefield"==componentname){let fieldComp=ZPeopleComponents[componentname](formField);value=void 0==(value=fieldComp.getValue())||void 0==value.dateObject?"":fieldComp.formatDate(value.dateObject,fieldComp.getAttribute("format"))}else value="tokenfield"==componentname?fieldType===FormConstants.FieldType.LOOKUP?ZP5Form.getTokenElemValuesAsString(formField):ZP5Form.getTokenElemValues(formField):void 0==(value=ZPeopleComponents[componentname](formField).getValue())?"":value}var labelName=formComp.labelName,displayType=formComp.displayType;let tableName=formClassObj.getTableName();var isMandatory=ZP5Form.Field.isMandatory(tableName,formComp.isMandatory,labelName);formClassObj.moduleHandler.updateFieldMetaData(isMandatory,labelName,formComp);var fcid=formComp.formComponentId;(formClassObj.isDraft||formClassObj.isDraftrec&&formClassObj.isSingleFiledEdit())&&(isMandatory=!1);var isActionHidden=formField.parents("[isActionHidden=true]").length>0;if(fieldType!==FormConstants.FieldType.PICKLIST&&fieldType!==FormConstants.FieldType.LOOKUP&&fieldType!==FormConstants.FieldType.CHECK_BOX||displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE)if(fieldType==FormConstants.FieldType.ADDRESS){var dataObject={},isCountryAlreadyEvaluated=!1,childObj=formComp.childFcObj;if($.each(FormConstants.AddressField.COLUMNAMEARRAY,function(index,columnname){var elementValue="";if("COUNTRY"==columnname&&isCountryAlreadyEvaluated)return!0;if(isTabular&&formComp.isGridType){var currChildObj=childObj[columnname],currChildElementObj=$(formField).find("[parentfcid="+fcid+"]").find("[name="+currChildObj.labelName+"]");elementValue=$(currChildElementObj).val(),currChildObj.fieldType!=FormConstants.FieldType.STATES&&currChildObj.fieldType!=FormConstants.FieldType.COUNTRY||(currChildElementObj=$(formField).find("[parentfcid="+fcid+"]").find("[name="+columnname+"]"),elementValue=ZPeopleComponents.select(currChildElementObj).getValue())}else elementValue=formField.find("input[name="+columnname+"]").val(),formField.find("input[name="+columnname+"]").length>0&&("COUNTRY"==columnname||"STATE"==columnname)&&(elementValue=ZPeopleComponents.select(formField.find("input[name="+columnname+"]")).getValue());if(void 0!=elementValue&&""!=elementValue.trim()&&"-Select-"!=elementValue.trim())if("STATE"==columnname||"COUNTRY"==columnname){var countryChildObj=$(formField).find("input[name=COUNTRY]");isTabular&&formComp.isGridType&&(countryChildObj=$(formField).find("[parentfcid="+fcid+"]").find("input[name=COUNTRY]"));var countryvalue=ZPeopleComponents.select(countryChildObj).getValue();if(isCountryAlreadyEvaluated=!0,"STATE"==columnname&&""!=countryvalue.trim()&&"-Select-"!=countryvalue.trim()){let stateChildObj=$(formField).find("input[name=STATE]");isTabular&&formComp.isGridType&&(stateChildObj=$(formField).find("[parentfcid="+fcid+"]").find("input[name=STATE]")),dataObject[columnname]=ZPeopleComponents.select(stateChildObj).getOptionData()[0].text,dataObject[columnname+"_CODE"]=elementValue}dataObject.COUNTRY=ZPeopleComponents.select(countryChildObj).getOptionData()[0].text,dataObject.COUNTRY_CODE=countryvalue}else dataObject[columnname]=elementValue}),isTabular&&formComp.isGridType){var tempAddressFormField=$(formField).find("[parentfcid="+fcid+"]")[0];isActionHidden=void 0!=$(tempAddressFormField).attr("isactionhidden")&&$(tempAddressFormField).attr("isactionhidden")}else isActionHidden=void 0!=$(formField).attr("isactionhidden")&&formField.attr("isactionhidden");if(!isActionHidden||"false"==isActionHidden){let addressChildMandatory=ZP5Form.Field.getAddressChildMandatory(formComp);if(isMandatory)if(jQuery.isEmptyObject(dataObject)&&Object.values(addressChildMandatory).every(value=>!0===value))isTabular&&formComp.isGridType?result.errorList.push(ZP5Form.AddressField.getTabularErrorMessage({},formComp,labelName,rowCnt,void 0,addressChildMandatory)):result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.IS_EMPTY,formComp,isTabular,rowCnt));else if(isTabular&&formComp.isGridType){var currTabError=ZP5Form.AddressField.getTabularErrorMessage(dataObject,formComp,labelName,rowCnt,void 0,addressChildMandatory);if(void 0!=currTabError&&!jQuery.isEmptyObject(currTabError)){var fieldError=currTabError.message[labelName];void 0!=fieldError&&fieldError.length>0&&result.errorList.push(currTabError)}}else for(var addressColumnIndex=0;addressColumnIndex<FormConstants.AddressField.COLUMNAMEARRAY.length;addressColumnIndex++)1!=addressColumnIndex&&jQuery.isEmptyObject(dataObject[FormConstants.AddressField.COLUMNAMEARRAY[addressColumnIndex]])&&addressChildMandatory[FormConstants.AddressField.COLUMNAMEARRAY[addressColumnIndex]]&&result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.ADDRESS_CHILD_EMPTY,formComp,isTabular,rowCnt,addressColumnIndex));else jQuery.isEmptyObject(dataObject)||dataObject.hasOwnProperty(FormConstants.AddressField.COLUMNAMEARRAY[0])||(isTabular&&formComp.isGridType?result.errorList.push(ZP5Form.AddressField.getTabularErrorMessage(dataObject,formComp,labelName,rowCnt,0)):result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.ADDRESS_CHILD_EMPTY,formComp,isTabular,rowCnt,0)))}value=jQuery.isEmptyObject(dataObject)?"":isTabular?dataObject:JSON.stringify(dataObject)}else{let fileAfterUpload=formField.closest("#beforeUpload").siblings("#afterUpload");if(fieldType===FormConstants.FieldType.IMAGE||fieldType===FormConstants.FieldType.FILE_UPLOAD){0===formField.length&&0===formField.siblings("#filename").length||!(value=formField.val())&&value.length<=0&&(value=formField.siblings("#filename").val());let uploadedFiles=ZP5Form.getFormClassObj().getUploadedFiles();uploadedFiles=uploadedFiles.cloudUpload.concat(uploadedFiles.wdUpload),$.each(uploadedFiles,function(index,docObj){docObj.labelName!=formField.attr("name")||isTabular&&docObj.rowNum!=rowCnt||(value=docObj.docName||docObj.fileName)})}if("P_Location"==tableName&&"State"==labelName&&"Select"==value&&(value=""),!isActionHidden&&isMandatory&&(displayType!==FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&ZPUtil.Validation.isEmpty(value)||displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&(null===value||0===value.length))){var isAdditionalMobPresent=!1;if(FormsCommon.isMobileUserAdditionAllowed()&&"P_Employee"==tableName&&"EmailID"==labelName&&(formClassObj.isAddMode()&&!ZP5Form.addUserDirect||ZP5Form.Employee.isExistingMobileUser())){var mobEle=formClassObj.LAYOUT.find("input[name='Mobile']");if(void 0!=mobEle){var phoneNum=$(mobEle).val();ZPUtil.Validation.isEmpty(phoneNum)||null===phoneNum||0===phoneNum.length||(isAdditionalMobPresent=!0,ZP5Form.setMobInvite=!0)}}isAdditionalMobPresent||result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.IS_EMPTY,formComp,isTabular,rowCnt))}else fileAfterUpload.find(".zpl_flerr").length>0?fileAfterUpload.find("[elem=fileUpload_reupload]").length>0?result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.VIRUS_FILE,formComp,isTabular,rowCnt)):result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.REUPLOAD_FILE,formComp,isTabular,rowCnt)):fileAfterUpload.find("div[data-progressjs]").length>0&&result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.FILEUPLOAD_INPROGRESS,formComp,isTabular,rowCnt))}else{var checkFlag=!1;fieldType===FormConstants.FieldType.CHECK_BOX?(checkFlag=formField.is(":checked"),value=checkFlag):(value="",$.each(formField,function(){if(displayType===FormConstants.FieldType.SELECT_DISPLYTYPE)""==(value=ZPeopleComponents.select($(this)).getValue())||"-Select-"==value||fieldType!==FormConstants.FieldType.PICKLIST||ZP5Form.Field.getFieldComponent(fcid).isEmpStatus||(value=ZP5Form.getSelectOptionsAttr($(this),!1,"optid",[value])[0]);else if(!0===this.checked){if(checkFlag=!0,displayType===FormConstants.FieldType.RADIO_DISPLYTYPE)return""!=(value=$(this).val())&&"-Select-"!=value&&fieldType===FormConstants.FieldType.PICKLIST&&(value=$(this).attr("optid")),!1;var tempVal=$(this).val();""!=tempVal&&"-Select-"!=tempVal&&fieldType===FormConstants.FieldType.PICKLIST&&(tempVal=$(this).attr("optid")),value+=(""!==value.trim()?";":"")+tempVal}})),!isActionHidden&&isMandatory&&(!checkFlag&&displayType!==FormConstants.FieldType.SELECT_DISPLYTYPE||displayType===FormConstants.FieldType.SELECT_DISPLYTYPE&&ZPUtil.Validation.isEmpty(value))&&result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.IS_NOT_SELECTED,formComp,isTabular,rowCnt))}if(!isActionHidden&&displayType!==FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&fieldType!==FormConstants.FieldType.CHECK_BOX&&!ZPUtil.Validation.isEmpty(value)){if((value.length>formComp.maxLength||value.length<formComp.minLength)&&result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.VALUE_LENGTH_EXCEED,formComp,isTabular,rowCnt)),fieldType===FormConstants.FieldType.DECIMAL||fieldType===FormConstants.FieldType.CURRENCY){var decValDtl=ZPUtil.Validation.isDecimal(value,formComp.decimalLength);decValDtl.isSuccess||void 0===decValDtl.errorCode||result.errorList.push(ZP5Form.Validation.createError(decValDtl.errorCode,formComp,isTabular,rowCnt))}else fieldType!==FormConstants.FieldType.NUMBER||ZPUtil.Validation.isNumber(value)?fieldType!==FormConstants.FieldType.EMAIL_ADDRESS||ZPUtil.Validation.isEmail(value,"P_EmployeeLeave"==tableName&&"TeamEmailID"==labelName)?fieldType!==FormConstants.FieldType.DATE||ZPUtil.Validation.isDate(value)||result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.INVALID_DATE,formComp,isTabular,rowCnt)):result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.INVALID_EMAIL,formComp,isTabular,rowCnt)):result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.INVALID_NUMBER,formComp,isTabular,rowCnt));formComp.minimumValue&&formComp.maximumValue&&!ZPUtil.isInRange(parseInt(value),parseInt(formComp.minimumValue),parseInt(formComp.maximumValue))&&result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.NOT_IN_RANGE,formComp,isTabular,rowCnt))}if("Mobile"===labelName&&("P_Employee"===tableName||"P_Candidate"===tableName)&&value&&""!==value.trim()){var cntryCodeObj=ZPeopleComponents.select(formField.siblings("#phone_ctry_"+fcid)).getValue(),returnObj={value:value,result:result};return void 0!=cntryCodeObj&&""!==cntryCodeObj.trim()?returnObj.country_code=cntryCodeObj:(FormsCommon.isMobileUserAdditionAllowed()||formComp.isMandatory&&formComp.CC_MANDATORY)&&result.errorList.push(ZP5Form.Validation.createError(ZP5Form.Validation.COUNTRY_EMPTY,formComp,isTabular,rowCnt)),returnObj}if(""!=value&&"-Select-"!=value&&fieldType===FormConstants.FieldType.PICKLIST&&displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE){var tempVal=value;value=[];for(let val of tempVal){var optId=ZP5Form.getSelectOptionsAttr($(formField),!1,"optid",[val],!0)[0];value.push(optId)}}return fieldType===FormConstants.FieldType.TIME_ZONE&&"-Select-"==value&&(value=""),returnObj={value:value,result:result}},createError:function(errorCode,fieldDtl,isTabular,rowCnt,childIndex){var resultObj={},errorObj={},labelName=fieldDtl.labelName,fieldType=fieldDtl.fieldType,args=new Array(fieldDtl.displayName);if(errorCode===ZP5Form.Validation.IS_EMPTY)errorObj[labelName]=ZPI18N.getString("zp.entervalforfield",args);else if(errorCode===ZP5Form.Validation.REUPLOAD_FILE)errorObj[labelName]=ZPI18N.getString("zp.reuploadfile");else if(errorCode===ZP5Form.Validation.VIRUS_FILE)errorObj[labelName]=ZPI18N.getString("zp.virusfile");else if(errorCode===ZP5Form.Validation.FILEUPLOAD_INPROGRESS)errorObj[labelName]=ZPI18N.getString("zp.fileuploadInProgress");else if(errorCode===ZP5Form.Validation.COUNTRY_EMPTY)errorObj[labelName]=ZPI18N.getString("zp.countryemptymsg");else if(errorCode===ZP5Form.Validation.IS_NOT_SELECTED)fieldType===FormConstants.FieldType.CHECK_BOX?errorObj[labelName]=ZPI18N.getString("zp.checkvalforcheckbox",args):errorObj[labelName]=ZPI18N.getString("zp.selvalforfield",args);else if(errorCode===ZP5Form.Validation.INVALID_NUMBER)errorObj[labelName]=ZPI18N.getString("zp.entervalidnumber",args);else if(errorCode===ZP5Form.Validation.INVALID_EMAIL)errorObj[labelName]=ZPI18N.getString("zp.entervalidemail",args);else if(errorCode===ZP5Form.Validation.INVALID_DATE)errorObj[labelName]=ZPI18N.getString("zp.entervaliddate",args);else if(errorCode===ZP5Form.Validation.ROUNDOFF_DECIMAL)args[1]=fieldDtl.decimalLength,errorObj[labelName]=ZPI18N.getString("zp.rounddecimal",args);else if(errorCode===ZP5Form.Validation.INVALID_DECIMALPOINT)errorObj[labelName]=ZPI18N.getString("zp.entervaliddecimal",args);else if(errorCode===ZP5Form.Validation.FILE_SIZE_EXCEED)fieldType===FormConstants.FieldType.IMAGE?errorObj[labelName]=ZPI18N.getString("zp.imagesizeexceed",args):errorObj[labelName]=ZPI18N.getString("zp.filelimitexceeded",["5MB"]);else if(errorCode===ZP5Form.Validation.IMAGE_FORMAT_NOTALLOWED)errorObj[labelName]=ZPI18N.getString("zp.allowedimagetypes",args);else if(errorCode===ZP5Form.Validation.VALUE_LENGTH_EXCEED){var maxLength=fieldDtl.maxLength,minLength=fieldDtl.minLength;void 0!=minLength?maxLength==minLength?(args[1]=maxLength,errorObj[labelName]=ZPI18N.getString("zp.exactFieldLength",args)):(args[1]=minLength,args[2]=maxLength,errorObj[labelName]=ZPI18N.getString("zp.maxAndMinFieldLength",args)):(args[1]=maxLength,errorObj[labelName]=ZPI18N.getString("zp.maxFieldLength",args))}else if(errorCode===ZP5Form.Validation.NOT_IN_RANGE)args[0]=fieldDtl.minimumValue,args[1]=fieldDtl.maximumValue,errorObj[labelName]=ZPI18N.getString("zp.entervalinrange",args);else if(errorCode===ZP5Form.Validation.SMALLPASSWORDLENGTH)errorObj.Password=ZPI18N.getString("zp.passwordlengshort");else if(errorCode===ZP5Form.Validation.PASSWORDEMPTY)errorObj.Password=ZPI18N.getString("zp.enterpasswd");else if(errorCode===ZP5Form.Validation.PWDPOLICYERR)errorObj.Password=ZPI18N.getString("zp.passwordpolicy");else if(errorCode===ZP5Form.Validation.LESS_THEN_NOT_ALLOWED)args[0]="<",errorObj[labelName]=ZPI18N.getString("zp.charactorremove",args);else if(errorCode===ZP5Form.Validation.GREATER_THEN_NOT_ALLOWED)args[0]=">",errorObj[labelName]=ZPI18N.getString("zp.charactorremove",args);else if(errorCode===ZP5Form.Validation.LESS_AND_GREATER_THEN_NOT_ALLOWED)args[0]="<,>",errorObj[labelName]=ZPI18N.getString("zp.charactorremove",args);else if(errorCode===ZP5Form.Validation.ADDRESS_CHILD_EMPTY)if(void 0!=rowCnt){errorObj.childType=FormConstants.AddressField.COLUMNAMEARRAY[childIndex];var childDispName=fieldDtl.childFcObj[FormConstants.AddressField.COLUMNAMEARRAY[childIndex]].displayName,addressArgs=new Array(childDispName);errorObj[labelName]=ZPI18N.getString("zp.entervalforfield",addressArgs),resultObj.code=7082}else{resultObj.childType=FormConstants.AddressField.COLUMNAMEARRAY[childIndex];childDispName=fieldDtl.childFcObj[FormConstants.AddressField.COLUMNAMEARRAY[childIndex]].displayName;var childLabelName=fieldDtl.childFcObj[FormConstants.AddressField.COLUMNAMEARRAY[childIndex]].labelName;addressArgs=new Array(childDispName);errorObj[childLabelName]=ZPI18N.getString("zp.entervalforfield",addressArgs),resultObj.code=7082}return isTabular&&(errorObj.row=rowCnt),resultObj.message=errorObj,resultObj},resetFormError:function(){let container=ZP5Form.getLayout();container.find("#errorHead").fadeOut(1e3),container.find("[id=error_message]").remove(),container.find("[id=zp_tabular_row]").children().removeClass("zp-err"),container.find("[class*=zp-err]").removeClass("zp-err"),container.find("[class*=ztextbox__error]").removeClass("ztextbox__error"),1===ZP5Form.getCurrFormsOperation().getPaginationType()&&(container.find("#zp_form_section_list").find(".PI_info").parent().removeClass("err"),container.find("#zp_form_section_list").find(".PI_info, .PI_tick").remove())},markSectionAsError:function(container,fieldContainer,sectionId){1===ZP5Form.getCurrFormsOperation().getPaginationType()&&(ZP5Form.markSectionError(sectionId),$(fieldContainer.find('li[id^="zp_form_section_"][class^="zpl_act"]')[0]).removeClass("zpl_act"),$(fieldContainer.find('li[id^="zp_form_section_"][class^="err"]')[0]).trigger("click")),container.find("#error_message").length>0&&(void 0!=$(container.find("#error_message"))[0].closest("div[class^='zpl_secn']")||void 0!=$(container.find("#error_message"))[0].closest("tr[id^='zp_tabular_row']"))&&(void 0!=$(container.find("#error_message"))[0].closest("div[class^='zpl_secn']")?$(container.find("#error_message"))[0].closest("div[class^='zpl_secn']").scrollIntoView({behavior:"smooth"}):$(container.find("#error_message"))[0].closest("tr[id^='zp_tabular_row']").scrollIntoView({behavior:"smooth"}))},showFormFieldError:function(errorData,code,sectionId){let formClassObj=ZP5Form.getFormClassObj(),container=formClassObj.LAYOUT,fieldContainer=formClassObj.FIELD_LAYOUT;$.each(errorData,function(){if(void 0!==this.message)for(labelName in this.message)if("Form_Error"===labelName||"Security_Error"===labelName)ZPeople.Message.failure(this.message[labelName]);else if("Payment_Error"===labelName)Subscription.restrictWidgetPlan.includes(ZPeople.PLANID)||"false"!=ZPeople.ISTRIALUSER?ZPeople.Message.failure(this.message[labelName]):this.offlinePaymentMode?Subscription.showOfflineWidget(Subscription.userWidget):Subscription.getPaymentsWidget(Subscription.userWidget,this.totalLicenseCount);else if("AppraisalComponent_Error"===labelName)ModuleReview.compConstruction.showError(this.message[labelName]);else if("JobSpecificWorkitem_Error"===labelName)ZPeople.Message.failure("Workitems exceeding 500chars");else if(formClassObj.moduleHandler.showFieldError(labelName,this,code)&&"row"!==labelName&&"childType"!==labelName&&"fieldInputObj"!==labelName){var customvalidationtabsecerror=this.message[labelName];if(7353==code&&customvalidationtabsecerror.constructor===[].constructor)for(customvalidationtabsecerrorlab in customvalidationtabsecerror){var name=customvalidationtabsecerror[customvalidationtabsecerrorlab].name;ZP5Form.Field.markFieldAsError(name,customvalidationtabsecerror[customvalidationtabsecerrorlab])}else if(7377==code||7377==this.code)1==errorData.length&&(errorData[0].isFromTransition?OPApprovals.Forward.constructForwardPopup(errorData[0].isFromTransition,errorData[0].transitionDetails.transitionId,errorData[0].transitionDetails.transitionRelId):OPApprovals.Forward.constructForwardPopup());else if(void 0!==this.childType||7082==code||7082==this.code)if(void 0!==this.message.row){var tabularErrorList=this.message[labelName];if("object"==typeof tabularErrorList)for(var addressErrorIndex=0;addressErrorIndex<tabularErrorList.length;addressErrorIndex++){var currentTabularError=tabularErrorList[addressErrorIndex],childLabelName=currentTabularError.childType+"_"+labelName;ZP5Form.Validation.showFieldErrorForAddress(this.message.row,childLabelName,currentTabularError.message,!0,labelName,currentTabularError.childType,fieldContainer)}else{childLabelName=this.message.childType+"_"+labelName;ZP5Form.Validation.showFieldErrorForAddress(this.message.row,childLabelName,this.message[labelName],!0,labelName,this.message.childType,fieldContainer)}}else{var parentLabelName=labelName.substring(this.childType.length+1,labelName.length);ZP5Form.Validation.showFieldErrorForAddress(void 0,void 0,this.message[labelName],!1,parentLabelName,this.childType,fieldContainer)}else 7340==code||7340==this.code?NewZPOnboarding.ContactHRPopup.show():ZP5Form.Field.markFieldAsError(labelName,this.message)}}),ZP5Form.Validation.markSectionAsError(container,fieldContainer,sectionId)},showFieldErrorForAddress:function(row,childLabelName,message,isTabular,labelName,childType,fieldLayoutObj){if(isTabular){var fieldObj=fieldLayoutObj.find("[istabular=true]").find("[row="+row+"]").find("[folabel="+childLabelName+"]");if(0==fieldObj.length)fieldObj=fieldLayoutObj.find("[istabular=true][row="+row+"][isgrid=false]"),ZP5Form.Validation.showFieldErrorForAddress(void 0,void 0,message,!1,labelName,childType,fieldObj);else{$(fieldObj).find("[id^='zp_field_']").addClass("ztextbox__error"),$(fieldObj).find("[id^='zselect-']").addClass("ztextbox__error");var errorCont="<span id='error_message' class='ztextbox--error__label'>"+message+"</span>";fieldObj.append(errorCont)}}else{fieldObj=$(fieldLayoutObj).find("[folabel="+labelName+"]");let childObj=$(fieldObj).find("[name="+childType+"]");fieldObj=childObj.parent(),childObj.addClass("ztextbox__error"),$(fieldObj).find("[id^='zselect-']").addClass("ztextbox__error");errorCont="<span id='error_message' class='ztextbox--error__label'>"+message+"</span>";fieldObj.append(errorCont)}}},ZP5Form.Field.Edit={FORMCOMP_ID:null,FORMCOMP_DATA:null,MODGEOFC_ID:null,getDependFieldMappingFields:function(formComponentId,fields,formId){let fcmap=void 0!=formId?ZP5Form.getFormsOperation(formId).getFormComponentData().message.dependntFieldMappings:ZP5Form.getCurrFormsOperation().getFormComponentData().message.dependntFieldMappings;if(void 0==fcmap[formComponentId])return fields;$.each(fcmap[formComponentId],function(index){ZPUtil.checkIsExistInArray(fields,fcmap[formComponentId][index])||(fields.push(fcmap[formComponentId][index]),ZP5Form.Field.Edit.getDependFieldMappingFields(fcmap[formComponentId][index],fields))})},constructSingleFieldEditModel:function(dependFields,fieldDtl,fcid){let params=ZP5Form.getFormClassObj().getParams();params.formMode="EDIT",params.fcid=fcid,params.isBackArrowNeed=!0;let form=ZP5Form._toForm(params);void 0!=ZP5Form.getFormClassObj().getFormsProperties().getFormContainer()&&form.setFormContainer(ZP5Form.getFormClassObj().getFormsProperties().getFormContainer()),form.setSingleFieldModal(!0).setBaseFormDOMId(ZP5Form.getFormClassObj().formLayoutKey).setSingleFieldModalFields(dependFields).setFormModel(ZP5Form.MODEL.SINGLE_FIELD_EDIT).init()}},ZP5Form.PicklistQuickAdd={CONTAINER:null,options:{},ISSINGLEEDIT:!1,URL:"/fieldActions.zp",createQuickAddPopup:function(formcmp){var fcid=$(formcmp).attr("fcid"),popUp=`<div id="quickadd" class="zpl_mdl zpl_mcenter"><div class="zpl_minr">\n    \t\t\t\t<div class="zpl_mhder scrlshdw" id="quickaddHeader"><div><h4><span>${ZPI18N.getString("zp.edit")}</span> ${ZPI18N.getString("zp.quickadd")}</h4></div><a name="close" class="_cls PI_cls"></a></div>\n    \t\t\t\t<div class="zpl_mcnt zpsl_fm"><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">${ZPI18N.getString("zp.addvalue")}</label></div>\n              \t\t<div><input type="text" id="zp_form_quickadd_text" class="ztextbox"></div><span id="pkOptionError" class=""></span></div>\n            \t\t<div class="zpl_frmquickadd"><ul class="zpl_frmullist" id="optionslist"></ul></div>\n                     </div></div></div>\n                     <div class="zpl_mfoter"><button type="button" name="done" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.done")}</button><button type="button" name="close" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.cancel")}</button></div>\n    \t\t\t\t</div></div>`;popUp=$(popUp),$("body").append(popUp),popUp.addClass("zpl_mopen"),ZP5Form.PicklistQuickAdd.CONTAINER=popUp;var compDetails=ZP5Form.Field.getFieldComponent(fcid);ZP5Form.PicklistQuickAdd.options=compDetails.OptionsWithId;var optionHtml="";$.each(ZP5Form.PicklistQuickAdd.options,function(key,value){optionHtml+="<li value="+value.Id+'><div><div><i class="PI_drag"></i><span onmouseover=FrameworkCommon.mouseEnterFunction()>'+value.Value+"</span></div></div></li>"}),optionHtml+='<li id="newOption" style="display:none"><div><div><i class="PI_drag"></i><span onmouseover=FrameworkCommon.mouseEnterFunction()></span></div></div></li>',ZP5Form.PicklistQuickAdd.CONTAINER.find("#optionslist").html(optionHtml),popUp.find("button[name=done]").on("click",function(){ZP5Form.PicklistQuickAdd.addPickOption(fcid)}),popUp.find("[name=close]").on("click",function(){ZP5Form.PicklistQuickAdd.CONTAINER.removeClass("zpl_mopen"),ZP5Form.PicklistQuickAdd.CONTAINER.remove()}),popUp.find("#optionslist").sortable({axis:"y"}),popUp.find("#optionslist").disableSelection(),popUp.find("#zp_form_quickadd_text").on("keyup",function(event){ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").text(""),ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").attr("class",""),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").removeClass("ztextbox__error"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption span").text($(this).val()),ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption").attr("style","display:all"),""===ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption span").text()&&(ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption").attr("style","display:none"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption span").text("")),13===event.keyCode&&ZP5Form.PicklistQuickAdd.addPickOption(fcid)}),popUp.on("hidden.bs.modal",function(){ZP5Form.PicklistQuickAdd.CONTAINER.remove(),ZP5Form.PicklistQuickAdd.CONTAINER=null})},addPickOption:function(fcid){var newOption=ZP5Form.PicklistQuickAdd.CONTAINER.find(" #newOption span").html();if(""===newOption||ZPUtil.Validation.isEmpty(newOption))return ZP5Form.PicklistQuickAdd.CONTAINER.find(" #pkOptionError").text(ZPI18N.getString("zp.entervalue")),ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").addClass("ztextbox--error__label"),void ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").addClass("ztextbox__error");var isErr=!1;$.each(ZP5Form.PicklistQuickAdd.options,function(ind,val){if(newOption.toLowerCase()==val.Value.toLowerCase())return ZP5Form.PicklistQuickAdd.CONTAINER.find(" #pkOptionError").text(ZPI18N.getString("zp.duplicateoption")),ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").addClass("ztextbox--error__label"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").addClass("ztextbox__error"),isErr=!0,!1}),newOption.length>255&&(isErr=!0,ZP5Form.PicklistQuickAdd.CONTAINER.find(" #pkOptionError").text(ZPI18N.getString("zp.optionlength",[255])),ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").addClass("ztextbox--error__label"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").addClass("ztextbox__error")),isErr||ZP5Form.PicklistQuickAdd.updateFieldOptions(fcid)},updateFieldOptionsResponse:function(resultdata,params){var fcId=params.formCmpId.toString();let formClassObj=ZP5Form.getFormClassObj();var formId=formClassObj.getFormsProperties().getFormId();if(ZP5Form.PicklistQuickAdd.CONTAINER.find("button[name='done']").removeClass("disabled"),"object"==typeof resultdata)if(void 0!==resultdata.ERROR)ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").text(resultdata.ERROR),ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").addClass("ztextbox--error__label"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").addClass("ztextbox__error"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_quickadd_done").removeClass("disabled"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").on("keyup",function(event){ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").text(""),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").removeClass("ztextbox__error"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption span").text($(this).val()),ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption").attr("style","display:all"),""===ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption span").text()&&(ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption").attr("style","display:none"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption span").text("")),13===event.keyCode&&ZP5Form.PicklistQuickAdd.addPickOption(fcId)});else if(void 0!==resultdata.optionList){var fieldOutObj=ZP5Form.getFieldLayout().find("#zp_field_outer_"+fcId),formcp=ZP5Form.Field.getFieldComponent(fcId);formClassObj.FormOperations.updateFormComponentDataValues(fcId,"Options",resultdata.optionList),dispType=formcp.displayType;var ary=[];let resultObj={};if(ZP5Form.PicklistQuickAdd.constructOptionsForPicklist(resultdata.optionList,formcp,resultdata.newOption,resultObj,resultdata.OptionsWithId),dispType===FormConstants.FieldType.SELECT_DISPLYTYPE&&(ZPeopleComponents.select(fieldOutObj.find("[zcomponentname]")[0]).removeAllOptions(),ZPeopleComponents.select(fieldOutObj.find("[zcomponentname]")[0]).addOption(resultObj.optlist),ZPeopleComponents.select(fieldOutObj.find("[zcomponentname]")[0]).setValue(resultObj.selValue)),dispType===FormConstants.FieldType.RADIO_DISPLYTYPE&&fieldOutObj.children("[quickaddbtn!='true']").remove(),dispType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE){let multiSelectField=ZPeopleComponents.tokenfield(fieldOutObj.find("[zcomponentname]")[0]),vals=Object.assign([],multiSelectField.getAllValues());vals.push(resultObj.selValue),multiSelectField.setAttributes({data:resultObj.optlist}),multiSelectField.setAttribute("values",vals)}else if(dispType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE){let checkedOptions=fieldOutObj.find('input[id^="optid_"]:checked');$.each(checkedOptions,function(key,value){ary.push($(value).val())}),fieldOutObj.children("[quickaddbtn!='true']").remove()}if(formClassObj.FormOperations.updateFormComponentDataValues(fcId,"OptionsWithId",resultdata.OptionsWithId),formClassObj.refreshFieldData(),null!=ZP5Form.getFormClassObj().getSingleFieldEditFcid()){ZP5Form.Field.getFieldValueData(fcId).componentName;if(0==fieldOutObj.find("> span").length&&$("<span>-</span>").hide().appendTo(fieldOutObj),dispType===FormConstants.FieldType.RADIO_DISPLYTYPE||dispType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE){let formCompData=ZP5Form.Field.getFieldComponent(fcId);var htmlData=$('<div id="zp_fieldedit_comp"></div>');let quickaddhtml='<div class="zpl_hvr">'+ZP5Form.Field.isQuickAddForm(formCompData,formCompData.isTabular,!0)+'<i id="zp_formedit_submit" class="PI_tick grn"></i><i id="zp_formedit_cancel" class="PI_cls red"></i></div>';htmlData.append(ZP5Form.getFormClassObj().createField(formCompData,resultdata.newOption)),htmlData.append(quickaddhtml),fieldOutObj.append(htmlData),dispType!==FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&dispType!==FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE||fieldOutObj.find("span:first").html(ary.toString()),htmlData.find("input[id=zp_field_"+ZP5Form.getFormClassObj().getSingleFieldEditFcid()+"]").on("keyup",ZP5Form.delay(e=>{ZP5Form.formulaRevaluateOnsingleEdit(formId)},500)),htmlData.find("#zp_formedit_submit").on("click",()=>{htmlData.find("#zp_formedit_submit").off("click"),ZP5Form.getFormClassObj().callbackForSingleFieldEdit()}),htmlData.find("#zp_formedit_cancel").on("click",()=>{ZP5Form.getFormClassObj().cancel()})}}else dispType!==FormConstants.FieldType.RADIO_DISPLYTYPE&&dispType!==FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE||fieldOutObj.prepend(ZP5Form.getFormClassObj().createField(ZP5Form.Field.getFieldComponent(fcId),resultdata.newOption));if(ZP5Form.formulaRevaluateOnsingleEdit(formId,fcId),$.each(ZP5Form.FIELD_RULE_DETAILS[formId],function(i,rule){-1!=$.inArray(fcId,rule.fieldElms)&&(rule.isExecuted=!1)}),ZPFRulesNew.Evaluation.evaluateRules(ZP5Form.Field.getFieldComponent(fcId),!1),dispType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE){var abc=fieldOutObj.find("input");$.each(abc,function(key,value){-1!==$.inArray($(value).val(),ary)&&$(value).attr("checked","checked")})}ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_quickadd_done").removeClass("disabled"),ZP5Form.PicklistQuickAdd.CONTAINER.removeClass("zpl_mopen"),ZP5Form.PicklistQuickAdd.CONTAINER.remove()}},updateFieldOptions:function(formCmpId){var list=ZP5Form.PicklistQuickAdd.CONTAINER.find("li");ZP5Form.PicklistQuickAdd.CONTAINER.find("button[name='done']").addClass("disabled"),$("#zp_form_quickadd_text").off("keyup");var pickListOptions={optionsArray:[]};$.each(list,function(key,value){pickListOptions.optionsArray.push($(value).attr("value")),"newOption"===$(value).attr("id")&&(pickListOptions.optionsArray[pickListOptions.optionsArray.length-1]=$(value).find("span").text().trim(),pickListOptions.value=$(value).find("span").text().trim())});var params={formCmpId:formCmpId,pickListOptions:JSON.stringify(pickListOptions),mode:"pickquickadd",isPicklistIdEnabled:!0};ZPeople.Request.send(ZP5Form.PicklistQuickAdd.URL,params,ZP5Form.PicklistQuickAdd.updateFieldOptionsResponse,void 0,ZP5Form.PicklistQuickAdd.failureCallBack)},failureCallBack:function(data,params){ZP5Form.PicklistQuickAdd.CONTAINER.find("button[name='done']").removeClass("disabled"),ZP5Form.PicklistQuickAdd.CONTAINER.find(" #pkOptionError").text(ZPI18N.getString("zp.optionnotadded")),ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").addClass("ztextbox--error__label"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").addClass("ztextbox__error"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").on("keyup",function(event){ZP5Form.PicklistQuickAdd.CONTAINER.find("#pkOptionError").text(""),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_form_quickadd_text").removeClass("ztextbox__error"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption span").text($(this).val()),ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption").attr("style","display:all"),""===ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption span").text()&&(ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption").attr("style","display:none"),ZP5Form.PicklistQuickAdd.CONTAINER.find("#newOption span").text("")),13===event.keyCode&&ZP5Form.PicklistQuickAdd.addPickOption(params.formCmpId)}),ZP5Form.PicklistQuickAdd.CONTAINER.find("#zp_quickadd_done").removeClass("disabled")},constructOptionsForPicklist:function(options,fieldDtl,selValue,resultObj,optionsWithId){let optlist=[];optlist.push({id:"-Select-",text:ZPI18N.getString("zp.select"),optid:""}),$.each(options,function(key,value){var optId=fieldDtl.fieldType===FormConstants.FieldType.PICKLIST&&void 0!=optionsWithId?optionsWithId[key].Id:"";let selectedValue,val=ZPeople.decodeTxt(value);optlist.push({id:val,text:val,optid:optId}),ZP5Form.Field.getIsSelected(value,selValue,"select")&&(selectedValue={id:val,text:val,optid:optId},resultObj.selValue=selectedValue)}),resultObj.optlist=optlist}},ZP5Form.Permission={VIEW_NO_REC:0,VIEW_OLYHIS_REC:1,VIEW_HISANDHISSUB_REC:2,VIEW_ALL:3,isSub:function(erecId){return ZPUtil.checkIsExistInArray(ZPeople.SUB_USERLIST,erecId)},isAllowed:function(ownerIds,permission,isRecordAdmin){return!!(isRecordAdmin=void 0!=isRecordAdmin?isRecordAdmin:ZP5Form.getFormClassObj().isRecordAdmin())||this.checkisAllowedWithoutAdminPerm(ownerIds,permission)},checkisAllowedWithoutAdminPerm:function(ownerIds,permission){var isAllowed=!1;if(3===permission)isAllowed=!0;else if((2===permission||4===permission||1===permission)&&(void 0===ownerIds&&(ZP5Form.getFormClassObj().isViewMode()||ZP5Form.getFormClassObj().isEditMode())&&(ownerIds=ZP5Form.getRecordOwnerList()),void 0!==ownerIds&&ownerIds.length>0))for(var ownCnt=0;ownCnt<ownerIds.length;ownCnt++){var ownerId=ownerIds[ownCnt];(2===permission&&(erecno===ownerId||ZPUtil.checkIsExistInArray(ZPeople.getSubUsers(erecno,!0),ownerId))||4===permission&&ZPUtil.checkIsExistInArray(ZPeople.getSubUsers(erecno,!0),ownerId)||1===permission&&ownerId===erecno)&&(isAllowed=!0)}return isAllowed}},ZP5Form.addRecentlyUsed=function(){if("services"==ZPTabs.getModueCode(window.location.href.split("zp").pop(),!0)){var curUrl=window.location.href.split("zp#").pop(),activeSubTab=$("#zp_active_subtabs").find('li a[href*=":'+Layout.Page.urlparam.formId+'/"]'),setInSession=(Layout.Page.urlparam.formId,Layout.Page.urlparam.viewId,!1),formDisplayName="",subtabs=ZPTabs.getSubTabs()[0],formSubTab=subtabs.length>0?AppFlow.findSubTab(Layout.Page.urlparam.formId):{};if(0==Object.keys(formSubTab).length){if(void 0!=ZP5Form.FORM_DETAILS[Layout.Page.urlparam.formId])formDisplayName=ZP5Form.FORM_DETAILS[Layout.Page.urlparam.formId].formdisplayName;else Layout.Page.container.parent("div[id*=zp-contwrap]").find("li[form="+Layout.Page.urlparam.formId+"]").length>0&&(formDisplayName=Layout.Page.container.parent("div[id*=zp-contwrap]").find("li[form="+Layout.Page.urlparam.formId+"]").attr("name"));subtabs.push({tabName:formDisplayName,tabURL:curUrl,formId:Layout.Page.urlparam.formId}),$("#zp_active_subtabs").append('<li title="'+formDisplayName+'" formid="'+Layout.Page.urlparam.formId+'"><a href="#'+curUrl+'">'+formDisplayName+"</a></li>"),setInSession=!0}else formSubTab.tabURL!=curUrl&&(formDisplayName=activeSubTab.parent("li").attr("title"),activeSubTab.find("a").attr("href","#"+curUrl),setInSession=!0);setInSession&&ZPeople.Request.send("/setInSession.zp",{formId:Layout.Page.urlparam.formId,viewId:Layout.Page.urlparam.viewId,formDisplayName:formDisplayName,method:"setSession"})}},ZP5Form.select2={OPTIONS:{},ALL_OPTIONS:{},getKey:function(fcid,rowno){let key=fcid,formClassObj=ZP5Form.getFormClassObj(),singleFcmap=formClassObj.getSingleFieldData(fcid),fcMap=formClassObj.FormOperations.getFormComponentData();if(singleFcmap.isPrimaryLookup)if(formClassObj.isAddMode()){key+="_Add";let viewType=formClassObj.moduleHandler._viewtype();null!=viewType&&(key+=viewType)}else key+="_Edit";return singleFcmap.dependentFiledList&&singleFcmap.dependentFiledList.length>0&&(fieldValues={},$.each(fcMap.message.formComponentDetails,function(){void 0!==this.column1&&this.column1.length>0&&ZP5Form.getFieldValues(this.column1,singleFcmap.dependentFiledList,fieldValues,rowno),void 0!==this.column2&&this.column2.length>0&&ZP5Form.getFieldValues(this.column2,singleFcmap.dependentFiledList,fieldValues,rowno)}),key+=JSON.stringify(fieldValues)),key},getOptions:function(fcid,term,page,key,id,rowno,successcallback,prop){fieldValues={},prop=void 0!==prop?prop:{};let formClassObj=ZP5Form.getFormClassObj(),singleFcmap=formClassObj.getSingleFieldData(fcid),fcMap=ZP5Form.getCurrFormsOperation().getFormComponentData();singleFcmap.dependentFiledList&&singleFcmap.dependentFiledList.length>0&&$.each(fcMap.message.formComponentDetails,function(){void 0!==this.column1&&this.column1.length>0&&ZP5Form.getFieldValues(this.column1,singleFcmap.dependentFiledList,fieldValues,rowno),void 0!==this.column2&&this.column2.length>0&&ZP5Form.getFieldValues(this.column2,singleFcmap.dependentFiledList,fieldValues,rowno)}),fields=[fcid];var params={mode:"fetchFormLookupOtions",luFcIds:JSON.stringify(fields),formId:formClassObj.getFormsProperties().getFormId(),subMode:formClassObj.getMode()};Object.keys(fieldValues).length>0&&(params.fieldValues=JSON.stringify(fieldValues)),ZPUtil.Validation.isEmpty(formClassObj.getFormsProperties().getRecordId())||(params.recordId=formClassObj.getFormsProperties().getRecordId()),formClassObj.moduleHandler.updateLookupOptionParams(params),params.searchtxt=term,params.startInd=200*(page-1)+1,params.conreqcsr=csrfToken,id&&(params.id=id),url=ZP5Form.URL,ZP5Form.getFormClassObj().isEmbedForm&&!isAuthreq&&(params.digest=params.digest=Embed_digest,url="/embedFormAction.hr");var results=[];if(1!=page||parseInt(singleFcmap.displayType)!==FormConstants.FieldType.SELECT_DISPLYTYPE||""!=term||prop.skipDefaultOption||results.push({id:"-Select-",text:ZPI18N.getString("zp.select")}),"ADD"==params.subMode){let viewType=formClassObj.moduleHandler._viewtype();null!=viewType&&viewType!=FormConstants.Permission.VAL.ALL_DATA&&viewType!=FormConstants.Permission.VAL.NO_DATA&&(params.viewType=viewType)}var asyn=void 0!==successcallback&&"function"==typeof successcallback;return $.ajax({type:"POST",async:asyn,url:url,data:params,success:function(data){if(void 0==ZP5Form.PrimaryLookUpOptionAllowedRoleIds&&(ZP5Form.PrimaryLookUpOptionAllowedRoleIds={}),data.code==zpconst.ResponseCodes.API_ERR_NO_ERROR&&data.message&&data.message[fcid]&&($.each(data.message[fcid],function(ind,val){if(results.push({id:val.Id,text:ZPeople.decodeTxt(val.Value)}),ZP5Form.select2.ALL_OPTIONS[fcid+"_"+val.Id]=val.Value,void 0!=val.allowedRoleIds){var key=formClassObj.getFormsProperties().getFormId()+"_"+val.Id;ZP5Form.PrimaryLookUpOptionAllowedRoleIds[key]=val.allowedRoleIds}}),"P_Employee"===ZP5Form.getCurrFormsOperation().getTableName()&&"Division"==singleFcmap.labelName||"P_Candidate"===ZP5Form.getCurrFormsOperation().getTableName()&&"CandidateDivision"==singleFcmap.labelName)){var divisionOptions=data.message[fcid];ZP5Form.setDivisionOptions(divisionOptions)}if(asyn){ZP5Form.select2.OPTIONS[key][term]||(ZP5Form.select2.OPTIONS[key][term]=[]);var skipIds=[];("P_Employee"===ZP5Form.getCurrFormsOperation().getTableName()&&"Division"==singleFcmap.labelName||"P_Candidate"===ZP5Form.getCurrFormsOperation().getTableName()&&"CandidateDivision"==singleFcmap.labelName)&&singleFcmap.isSpecialHandling&&(skipIds=ZP5Form.changeDivisionOptions(fcid));var removeIndexArray=[];$.each(results,function(ind,value){"-Select-"!=value.id&&ZP5Form.select2.OPTIONS[key][term].push(value),skipIds.length>0&&ZPUtil.checkIsExistInArray(skipIds,value.id)&&removeIndexArray.push(ind)}),removeIndexArray.length>0&&$.each(removeIndexArray,function(index1,value1){results.splice(value1-index1,1)}),1==page&&""==term&&singleFcmap.displayType!=FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&prop&&prop.initseljson&&(index=FormsCommon.findJSONArrayIndex(results,prop.initseljson.id,"id"),-1==index&&results.push(prop.initseljson)),successcallback({results:results,more:results.length>=200})}}}),results}},ZP5Form.AddressField={getOptionsStateOptions:function(stateList,results,displayName){displayName&&results.push({id:"-Select-",text:displayName}),$.each(stateList,function(index,value){var selOption={};selOption.id=value.state_code,selOption.text=value.state_name,results.push(selOption)})},getAddressDisplayHtml:function(childValObj){var addressfieldHtml="<span>",displayaddressfield="";return void 0!=childValObj&&""!=childValObj?("-"!=ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[0]])&&(addressfieldHtml+=displayaddressfield+=ZSEC.Encoder.encodeForHTMLAttribute(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[0]])),"-"!=ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[1]])&&(""!=displayaddressfield.trim()&&(addressfieldHtml+=",<br>"),addressfieldHtml+=displayaddressfield=ZSEC.Encoder.encodeForHTMLAttribute(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[1]])),"-"==ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[2]])&&"-"==ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[4]])||(""!=displayaddressfield.trim()&&(addressfieldHtml+=",<br>"),displayaddressfield="","-"!=ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[2]])&&(addressfieldHtml+=displayaddressfield=ZSEC.Encoder.encodeForHTMLAttribute(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[2]])),"-"!=ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[4]])&&(""!=displayaddressfield.trim()&&(addressfieldHtml+=", "),addressfieldHtml+=displayaddressfield=ZSEC.Encoder.encodeForHTMLAttribute(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[4]]))),"-"==ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[3]])&&"-"==ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[5]])||(""!=displayaddressfield.trim()&&(addressfieldHtml+=",<br>"),displayaddressfield="","-"!=ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[3]])&&(addressfieldHtml+=displayaddressfield=ZSEC.Encoder.encodeForHTMLAttribute(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[3]])),"-"!=ZP5Form.Field.getNoValueString(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[5]])&&(""!=displayaddressfield.trim()&&(addressfieldHtml+=", "),addressfieldHtml+=displayaddressfield=ZSEC.Encoder.encodeForHTMLAttribute(childValObj[FormConstants.AddressField.COLUMNAMEARRAY[5]]))),addressfieldHtml+="."):addressfieldHtml+=ZP5Form.Field.getNoValueString(""),addressfieldHtml+="</span>"},getTabularErrorMessage:function(dataObject,formComp,labelName,rowCnt,checkIndex,addressChildMandatory){for(var tabularError={code:7082},message={},fieldError=[],addressColumnIndex=0;addressColumnIndex<FormConstants.AddressField.COLUMNAMEARRAY.length;addressColumnIndex++)if(1!=addressColumnIndex&&(void 0==checkIndex||checkIndex==addressColumnIndex)&&jQuery.isEmptyObject(dataObject[FormConstants.AddressField.COLUMNAMEARRAY[addressColumnIndex]])&&(void 0===addressChildMandatory||addressChildMandatory[FormConstants.AddressField.COLUMNAMEARRAY[addressColumnIndex]])){var currentTabularError={};currentTabularError.childType=FormConstants.AddressField.COLUMNAMEARRAY[addressColumnIndex],currentTabularError.code=7082;FormConstants.AddressField.COLUMNAMEARRAY[addressColumnIndex];var childDispName=formComp.childFcObj[FormConstants.AddressField.COLUMNAMEARRAY[addressColumnIndex]].displayName,addressArgs=new Array(childDispName);currentTabularError.message=ZPI18N.getString("zp.entervalforfield",addressArgs),fieldError.push(currentTabularError)}return message[labelName]=fieldError,message.row=rowCnt,tabularError.message=message,tabularError},copyAddress:function(obj){var isChecked=$(obj).is(":checked"),permanentAddressObj=$(obj).closest("[id^='zp_field_outer_']"),permanentAddressFcid=$(permanentAddressObj).attr("id").substring($(permanentAddressObj).attr("id").lastIndexOf("_")+1),sectionId=ZP5Form.Field.getFieldComponent(permanentAddressFcid).sectionId,presentAddressObj=ZP5Form.getLayout().find("[id=zp_section_fields_"+sectionId+"]").find("[folabel=Present_Address]");isChecked?($(obj).parent().siblings().each(function(){$(this).addClass("disabled")}),$.each(FormConstants.AddressField.COLUMNAMEARRAY,function(addressChildIndex){var childObj=$(presentAddressObj).find("[name="+FormConstants.AddressField.COLUMNAMEARRAY[addressChildIndex]+"]");if("STATE"==FormConstants.AddressField.COLUMNAMEARRAY[addressChildIndex]||"COUNTRY"==FormConstants.AddressField.COLUMNAMEARRAY[addressChildIndex]){var countryObj=$(presentAddressObj).find("[name=COUNTRY]");if("STATE"==FormConstants.AddressField.COLUMNAMEARRAY[addressChildIndex]){ZPeopleComponents.select($(permanentAddressObj).find("[name=COUNTRY]")).setValue(ZPeopleComponents.select(countryObj).getValue()),$(countryObj).on("change.addressEvent",function(){ZPeopleComponents.select($(permanentAddressObj).find("[name=COUNTRY]")).setValue(ZPeopleComponents.select($(this)).getValue())});var stateObj=$(presentAddressObj).find("[name=STATE]");let optionsData=ZPeopleComponents.select(stateObj).getOptionData()[0],stateOption={id:optionsData.id,text:optionsData.text};ZPeopleComponents.select($(permanentAddressObj).find("[name=STATE]")).setValue(stateOption),$(stateObj).on("change.addressEvent",function(){let optionsData=ZPeopleComponents.select($(this)).getOptionData()[0],stateOption={id:optionsData.id,text:optionsData.text};ZPeopleComponents.select($(permanentAddressObj).find("[name=STATE]")).setValue(stateOption)})}}else $(permanentAddressObj).find("[name="+FormConstants.AddressField.COLUMNAMEARRAY[addressChildIndex]+"]").val($(childObj).val()),$(childObj).on("keyup.addressEvent",function(){var childName=$(this).attr("name");$(permanentAddressObj).find("[name="+childName+"]").val($(this).val())})})):($(obj).parent().siblings().each(function(){$(this).removeClass("disabled")}),$.each(FormConstants.AddressField.COLUMNAMEARRAY,function(addressChildIndex){var childObj=$(presentAddressObj).find("[name="+FormConstants.AddressField.COLUMNAMEARRAY[addressChildIndex]+"]");$(childObj).off(".addressEvent")}))},select2:{constructSelect2Options:function(resolve,term,prop){if(void 0!=prop.countryCode&&(void 0==ZP5Form.COUNTRY_STATES[prop.countryCode]||ZP5Form.COUNTRY_STATES[prop.countryCode].length<0)){let url=ZP5Form.URL,params={mode:"getStatesList",countryCode:prop.countryCode};ZP5Form.getFormClassObj().isEmbedForm&&!isAuthreq&&(url="/embedFormAction.hr",params.digest=Embed_digest),ZPeople.Request.send(url,params,response=>{ZP5Form.COUNTRY_STATES[prop.countryCode]=response.data,ZP5Form.AddressField.select2.loadSelect2Options(resolve,term,prop)},void 0,response=>{ZP5Form.AddressField.select2.loadSelect2Options(resolve,term,prop)})}else ZP5Form.AddressField.select2.loadSelect2Options(resolve,term,prop)},loadSelect2Options:function(resolve,term,prop){let results=[];if(ZP5Form.AddressField.getOptionsStateOptions(ZP5Form.COUNTRY_STATES[prop.countryCode],results,prop.displayName),void 0!=term&&""!=term.trim()){let tempResults=results;results=[],$.each(tempResults,function(index,value){let stateName=value.text.toLowerCase(),termLowerCase=term.toLowerCase();-1!=stateName.indexOf(termLowerCase)&&results.push(value)})}resolve({results:results})}}},ZP5Form.getSingleRecordFieldValue=function(fcid){var matched,recordDetail=ZP5Form.getSingleRecord();return recordDetail&&recordDetail.record&&recordDetail.record.message.recordDetails&&$.each(recordDetail.record.message.recordDetails,function(index1,section){$.each(["column1","column2"],function(index2,col){if(void 0==matched){var recordDtl=recordDetail.record.message.recordDetails[index1];columnArr=recordDtl[col],matched=ZPServices.getObjectFormArray(columnArr,"formComponentId",fcid,!1,!0)}})}),void 0!=matched?ZPeople.decodeTxt(matched.componentValue):""},ZP5Form.FILEUPLOAD_IMAGES={ALLOWED_IMAGE_FORMAT:["jpg","png","gif","jpeg"],getExtensionFromFilename:function(fileName){let fileExtn="";return-1!=fileName.lastIndexOf(".")&&(fileExtn=(fileExtn=fileName.substr(fileName.lastIndexOf(".")+1,fileName.length)).toLowerCase()),fileExtn},isViewZBasedFile:function(fileName){return["xls","xlsx","xlsm","sxc","ods","csv","tsv","odp","sxi","doc","docx","odt","rtf","ppt","pptx"].includes(fileName)},isPreviewEngineSupported:function(fileExtn){return["docx","doc","rtf","odt","pptx","ppt"].includes(fileExtn)},isAllowedFormatForImage:function(fileName){return fileName&&""!=fileName.trim()&&ZP5Form.FILEUPLOAD_IMAGES.ALLOWED_IMAGE_FORMAT.includes(this.getExtensionFromFilename(fileName))},showPreview:function(obj,fileParams){fileParams=JSON.parse(decodeURIComponent(fileParams));let fileName=$(obj).attr("filename"),filePath=$(obj).attr("filepath"),fileExtn=this.getExtensionFromFilename(fileName);if(isPreviewAllowed&&filePath&&fileName&&"undefined"!==fileName&&fileExtn){let previewId;if(previewId=filePath.includes("_")?fileParams.formId+"z"+fileParams.recordId+"z"+fileParams.fcId:fileParams.fcId+"z"+filePath,this.isViewZBasedFile(fileExtn))if(this.isPreviewEngineSupported(fileExtn))fileParams.previewId=previewId,this.LightBox.openLightBox(previewId,fileName,!1,fileParams,this.constructPreviewUrl(filePath,fileParams,fileExtn));else{this.LightBox.openLightBox(previewId,fileName,!1,fileParams),fileParams.portalId=_LOGGEDIN_ACCZSOID,fileParams.moduleName="Forms",delete fileParams.original;let params=`mode=viewZBasedFile&fileId=${previewId}&${csrfParamName}=${csrfToken}&cli-msg=${encodeURIComponent(btoa(JSON.stringify(fileParams)))}`;ZPeople.Request.send(ZP5Form.URL,params,resultData=>{this.viewFileCallBack(resultData,previewId)},{fileName:fileName,fileParams:fileParams},this.viewFileFailureCallBack)}else{let extraProps,url="",isImage=!1;["jpg","jpeg","gif","png","txt"].includes(fileExtn)?(isImage=!0,"txt"==fileExtn&&(fileParams.isInline=!0,isImage=!1,extraProps={fileId:previewId,fileName:ZPeople.escapeHtml(fileName),filePath:filePath,fileExtn:fileExtn}),url=ZP5Form.constructDownloadLink(fileParams),delete fileParams.isInline):(fileParams.previewId=previewId,url=this.constructPreviewUrl(filePath,fileParams,fileExtn)),this.LightBox.openLightBox(previewId,fileName,isImage,fileParams,url,extraProps)}}else ZPeople.Message.failure(ZPI18N.getString("zp.fileviewerror")+`<a onclick="window.open('${ZP5Form.constructDownloadLink(fileParams)}')"> - ${ZPI18N.getString("zp.Download")}</a>`)},LightBox:{openLightBox:function(previewId,fileName,isImage,fileParams,url,extraProps){let lightBox=new LightBox(ZSEC.Encoder.encodeForHTML(fileName));lightBox.fileId=previewId,lightBox.isImage=isImage,lightBox.needDownload=!0,url&&(lightBox.viewUrl=url),extraProps&&(lightBox.extraProps=extraProps),lightBox.setDownloadCallback(()=>{window.open(ZP5Form.constructDownloadLink(fileParams))}),this.setCurrentPreviewParams(fileParams),lightBox.show()},setCurrentPreviewParams:function(previewParams){this.currentPreviewParams=previewParams},getCurrentPreviewParams:function(){if(void 0!=this.currentPreviewParams)return this.currentPreviewParams},wmsCallBack:function(obj){let fileParams={...ZP5Form.FILEUPLOAD_IMAGES.LightBox.getCurrentPreviewParams(),previewId:obj.fileId};LightBoxAddOns.setFrameUrl(obj.fileId,ZP5Form.FILEUPLOAD_IMAGES.constructPreviewUrl(obj.filePath,fileParams,obj.fileformat))}},viewFileCallBack:function(resultData,previewId){if(LightBoxAddOns.isFrameAvailable(previewId)){if(resultData.hasOwnProperty("fail"))return void ZPeople.Message.failure(resultData.fail);let url=resultData[1][0].url;if(common._empty(url)||"Error In File"==url||!url.startsWith("https:"))return void ZPeople.Message.failure(ZPI18N.getString("zp.fileviewerror"));LightBoxAddOns.setFrameUrl(previewId,url)}},viewFileFailureCallBack:function(error){void 0!=error&&(void 0!=error.code&&500==error.code||void 0!=error.status&&500==error.status)?ZPeople.Message.failure(ZPI18N.getString("zp.reservespaceerrormsg",[`<a class="blu" href="mailto:${ZPeople.peopleSupportEmail}">${ZPeople.peopleSupportEmail}</a>`])):ZPeople.Message.failure(ZPI18N.getString("zp.unabletoconnectwithserver"))},constructPreviewUrl:function(fileId,params,fileExtn){var previewId=params.previewId,url="";if("pdf"==fileExtn)url=`/pdfViewer.zp?formFileId=${previewId}&mode=Forms&fcId=${params.fcId}&formId=${params.formId}&recordId=${params.recordId}`,fileId.includes("_")||(url+=`&fileId=${fileId}`),params.hasOwnProperty("submode")&&"myratings"===params.submode&&(url+=`&submode=${params.submode}`),void 0!=contextPath&&"null"!=contextPath&&(url="/"+contextPath+url);else{url="tif"==fileExtn?"/image/"+previewServiceId+"/"+previewId+"?":"/preview/"+previewServiceId+"/"+previewId+"?";var frameOrigin=window.location.protocol+"//"+window.location.host,zohoOneOrigin=ZPUnifieduiUtil.getZOFrameOriginUrl();null!=zohoOneOrigin&&void 0!=zohoOneOrigin&&""!=zohoOneOrigin&&(frameOrigin+=","+zohoOneOrigin),url=previewServerUrl+url+"frameorigin="+frameOrigin,params.portalId=_LOGGEDIN_ACCZSOID,params.moduleName="Forms",delete params.previewId,delete params.original,url=url+"&cli-msg="+encodeURIComponent(btoa(JSON.stringify(params)))}return url},showCloudPickerModal:function(url,fcId,ele){var rowNum="1";"true"==$(ele).closest("[istabular]").attr("istabular")&&(rowNum="true"==$(ele).closest("[isgrid]").attr("isgrid")?$(ele).closest('[id="zp_tabular_row"]').attr("row"):$(ele).closest('[isgrid="false"]').attr("row")),CloudPicker.init("",ZP5Form.FILEUPLOAD_IMAGES.cloudPickerCallBack,"Forms",{rowNum:rowNum,fcId:fcId}),CloudPicker.construct(url)},cloudPickerCallBack:function(){let docObj=CloudPicker.getFileObj();try{docObj=JSON.parse(docObj)}catch(error){return void ZPeople.Message.failure(ZPI18N.getString("zp.photovalidationservererror"))}var fcId=CloudPicker.extraProps.fcId,rowNum=CloudPicker.extraProps.rowNum;let fieldObj=ZP5Form.getLayout().find("[row="+rowNum+"]").find("#zp_field_outer_"+fcId);var labelName=fieldObj.attr("folabel");if(ZP5Form.Field.getFieldComponent(fcId).fieldType!==FormConstants.FieldType.IMAGE||ZP5Form.FILEUPLOAD_IMAGES.isAllowedFormatForImage(docObj.docName)){docObj.labelName=labelName,docObj.rowNum=rowNum,ZP5Form.Field.removeFileUploadDoc(labelName,rowNum),ZP5Form.getFormClassObj().setUploadedFiles(docObj,!0);var fileName=decodeURIComponent(docObj.docName),fileExtn=ZP5Form.FILEUPLOAD_IMAGES.getExtensionFromFilename(fileName),isRestore=ZP5Form.getLayout().find("[row="+rowNum+"]").find("#zp_field_outer_"+fcId).find("[id=zp_form_fileuploadfield]").length>0;isRestore&&ZP5Form.getLayout().find("[row="+rowNum+"]").find("#zp_field_outer_"+fcId).find("[id=zp_form_fileuploadfield]").find("[isrestore=true]").addClass("DNI"),fieldObj.find('[id="error_message"]').remove(),fieldObj.find("#afterUpload").html(ZP5Form.getFormClassObj().constructFileEditHtml({originalFileName:fileName,labelName:labelName,fileExtn:fileExtn,fcId:fcId,rowNumber:rowNum,isOriginalFileName:!0},isRestore)),fieldObj.find("#afterUpload").find("[restoreoptionenabled=true]").removeClass("DNI"),fieldObj.find("[elem=pre-info]").addClass("DNI"),fieldObj.find("#beforeUpload,#afterUpload").toggleClass("DNI")}else{var errors={};errors[labelName]=ZPI18N.getString("zp.allowedimagetypes"),errors.row=rowNum,ZP5Form.Field.markFieldAsError(labelName,errors)}},showWorkDriveModal:function(workDriveOrigin,fcId,ele,isImage){WorkDriveInt.showWorkDriveModal(workDriveOrigin,fcId,ele,isImage)},workDriveCallBack:function(object){var fcId=object.fcId;delete object.fcId;let fieldObj=ZP5Form.getLayout().find("[row="+object.rowNum+"]").find("#zp_field_outer_"+fcId);var labelName=fieldObj.attr("folabel");if(ZP5Form.Field.getFieldComponent(fcId).fieldType!==FormConstants.FieldType.IMAGE||ZP5Form.FILEUPLOAD_IMAGES.isAllowedFormatForImage(object.fileName)){object.labelName=labelName,ZP5Form.Field.removeFileUploadDoc(labelName,object.rowNum),ZP5Form.getFormClassObj().setUploadedFiles(object);let fileName=object.fileName,rowNumber=object.rowNum;var fileExtn=ZP5Form.FILEUPLOAD_IMAGES.getExtensionFromFilename(fileName),isRestore=ZP5Form.getLayout().find("[row="+rowNumber+"]").find("#zp_field_outer_"+fcId).find("[id=zp_form_fileuploadfield]").length>0;isRestore&&ZP5Form.getLayout().find("[row="+object.rowNum+"]").find("#zp_field_outer_"+fcId).find("[id=zp_form_fileuploadfield]").find("[isrestore=true]").addClass("DNI"),fieldObj.find('[id="error_message"]').remove(),fieldObj.find("#afterUpload").html(ZP5Form.getFormClassObj().constructFileEditHtml({originalFileName:fileName,labelName:labelName,fileExtn:fileExtn,fcId:fcId,rowNumber:rowNumber,isOriginalFileName:!0},isRestore)),fieldObj.find("#afterUpload").find("[restoreoptionenabled=true]").removeClass("DNI"),fieldObj.find("[elem=pre-info]").addClass("DNI"),fieldObj.find("#beforeUpload,#afterUpload").toggleClass("DNI")}else{var errors={};errors[labelName]=ZPI18N.getString("zp.allowedimagetypes"),errors.row=object.rowNum,ZP5Form.Field.markFieldAsError(labelName,errors)}},constructFileFieldHtml:function(tableName,fieldData,filePath,value,downloadParams,isPrint){let isValJSON=void 0==fieldData,fileHtml="",resultValue=value,uploadSource="";if(ZPUtil.Validation.isEmpty(value))fileHtml="<span>"+ZP5Form.Field.getNoValueString(value)+"</span>";else{if(isValJSON){tableName="string"==typeof tableName?tableName:tableName[0],filePath="string"==typeof filePath?filePath:filePath[0];fieldData=JSON.parse($("<div/>").html(value).text());value=ZSEC.Encoder.encodeForHTML(fieldData.filename),void 0!=fieldData.filepath&&""!=fieldData.filepath&&(filePath=fieldData.filepath),uploadSource=fieldData.uploadSource=fieldData.uploadsource}if(value=resultValue=value.replace("Cropped",""),isPrint)fileHtml='<span><a href="javascript:;">'+ZP5Form.Field.getNoValueString(value)+"</a></span>";else{let formClassObj=ZP5Form.getFormClassObj();if(void 0!=formClassObj&&(fileHtml=formClassObj.moduleHandler.fileFieldHtml(fieldData,value,filePath,downloadParams)),null==fileHtml||""==fileHtml)if("1"==fieldData.uploadSource)fileHtml="<span><a onclick=\"window.open('"+filePath+'\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(value)+"</a></span>";else if(void 0!=filePath&&(filePath.indexOf(workDriveUrl)>-1||filePath.indexOf(writerUrl)>-1||filePath.indexOf(sheetUrl)>-1||filePath.indexOf(showUrl)>-1)){fileHtml="<span><a onclick=\"window.open('"+filePath.substr(0,filePath.lastIndexOf("/"))+'\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(value)+"</a></span>"}else{var fileExtn=ZP5Form.FILEUPLOAD_IMAGES.getExtensionFromFilename(value);fileHtml=1==isPreviewAllowed&&null!=fileExtn&&void 0!=fileExtn&&""!=fileExtn&&-1!=ZP5Form.PreviewSupportedFileTypes.indexOf(fileExtn)?'<span><a fileName="'+value+'" filePath="'+filePath+'" onclick="ZP5Form.FILEUPLOAD_IMAGES.showPreview(this,\''+encodeURIComponent(JSON.stringify(downloadParams))+"')\">"+ZP5Form.Field.getNoValueString(value)+"</a></span>":'<span><a filePath="'+filePath+'" onclick="window.open(\''+ZP5Form.constructDownloadLink(downloadParams)+'\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(value)+"</a></span>"}}}return isValJSON?{fileHtml:fileHtml,resultValue:resultValue,filePath:filePath,uploadSource:uploadSource}:fileHtml},constructImageViewUrl:function(filePath,uploadSource,downloadParams){let viewUrl,wdpath="";return"1"==uploadSource?(wdpath=filePath,viewUrl=workDriveThumbnailUrl+"/thumbnail/WD/"+wdpath.substr(wdpath.lastIndexOf("/")+1)+"?size=m"):filePath.indexOf(workDriveUrl)>-1||filePath.indexOf(writerUrl)>-1||filePath.indexOf(sheetUrl)>-1||filePath.indexOf(showUrl)>-1?(wdpath=filePath.substr(0,filePath.lastIndexOf("/")),viewUrl=workDriveThumbnailUrl+"/thumbnail/WD/"+wdpath.substr(wdpath.lastIndexOf("/")+1)+"?size=m"):viewUrl=ZP5Form.constructDownloadLink(downloadParams),ZP5Form.Record.IMAGE_REFRESH&&(ZP5Form.Record.IMAGE_REFRESH=!1,UDS_DOWNLOAD_IS_ACTIVE||(viewUrl+="&time="+(new Date).getTime())),{viewUrl:viewUrl,wdpath:wdpath}},constructImageFieldHtml:function(labelName,tableName,value,downloadParams,uploadSource,filePath,isEditMode,isValJSON,isPrint){let imgHTML=`<span>${ZP5Form.Field.getNoValueString(value)}</span>`;if(!ZPUtil.Validation.isEmpty(value)){let fileName=value;if(isValJSON){tableName="string"==typeof tableName?tableName:tableName[0],filePath="string"==typeof filePath?filePath:filePath[0];let fileDetails=JSON.parse(ZPeople.decodeTxt(value));value=fileName=ZSEC.Encoder.encodeForHTML(fileDetails.filename),uploadSource=fileDetails.uploadsource,void 0!=fileDetails.filepath&&""!=fileDetails.filepath&&(filePath=fileDetails.filepath)}if(fileName=fileName.replace("Cropped",""),"Photo"===labelName&&"P_Employee"===tableName)imgHTML="<span>-</span>";else{let{viewUrl:viewUrl,wdpath:wdpath}=ZP5Form.FILEUPLOAD_IMAGES.constructImageViewUrl(filePath,uploadSource,downloadParams);if(isPrint){let onLoad="this.previousSibling.setAttribute('class','DNI');this.classList.remove('DNI');",onError="this.previousSibling.setAttribute('class','DNI');this.classList.remove('DNI');";imgHTML='<span><div class="zpl_upld prof"><div class="zpl_fldrp"><div class="NM"><div class="ctcell" elem="thumbnailLoader"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div><img class="DNI" src="'+viewUrl+'" alt="'+ZPI18N.getString("zp.imgerror")+'" onload="'+onLoad+'" onerror="'+onError+'"></div></div></div>'}else{downloadParams.original="true";let fileExtn=ZP5Form.FILEUPLOAD_IMAGES.getExtensionFromFilename(fileName),thumbnailListenersHtml=`onload="ZP5Form.FILEUPLOAD_IMAGES.onLoadThumbnailCallBack(this, ${!isEditMode})" onerror="ZP5Form.FILEUPLOAD_IMAGES.onErrorThumbnailCallBack(this)"`,imgHtml='<span><div class="zpl_upld prof"><div class="zpl_fldrp"><div>';imgHtml+='<div class="ctcell" elem="thumbnailLoader"><div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div></div>',"1"==uploadSource?(imgHtml+='<img src="'+viewUrl+'" alt="" elem="thumImg" class="DNI" '+thumbnailListenersHtml+'><div class="zpl_imgact DNI">',isEditMode||(imgHtml+='<span class="zlabel zlabel--blue" onclick="window.open(\''+wdpath+'\');""><i class="PI_redirect"></i></span>')):void 0!=filePath&&null!=filePath&&(filePath.indexOf(workDriveUrl)>-1||filePath.indexOf(writerUrl)>-1||filePath.indexOf(sheetUrl)>-1||filePath.indexOf(showUrl)>-1)?(imgHtml+='<img src="'+viewUrl+'" alt="" elem="thumImg" class="DNI" '+thumbnailListenersHtml+'><div class="zpl_imgact DNI">',isEditMode||(imgHtml+='<span class="zlabel zlabel--blue" onclick="window.open(\''+wdpath+'\');""><i class="PI_downld"></i></span>')):1==isPreviewAllowed&&null!=fileExtn&&void 0!=fileExtn&&""!=fileExtn&&-1!=ZP5Form.PreviewSupportedFileTypes.indexOf(fileExtn)?imgHtml+='<img src="'+viewUrl+'" alt="" elem="thumImg" class="DNI" '+thumbnailListenersHtml+'><div class="zpl_imgact DNI"><span class="zlabel zlabel--blue" fileName="'+fileName+'" filePath="'+filePath+'" onclick="ZP5Form.FILEUPLOAD_IMAGES.showPreview(this,\''+encodeURIComponent(JSON.stringify(downloadParams))+'\')"><i class="PI_maxmz"></i></span>':(imgHtml+='<img src="'+viewUrl+'" alt="" elem="thumImg" class="DNI" '+thumbnailListenersHtml+'><div class="zpl_imgact DNI">',isEditMode||(imgHtml+='<span class="zlabel zlabel--blue" filePath="'+filePath+'" onclick="window.open(\''+ZP5Form.constructDownloadLink(downloadParams)+'\');"><i class="PI_downld"></i></button>')),imgHTML=imgHtml+='<span class="zlabel zlabel--red DNI" elem="errThumbnail" onclick="ZP5Form.FILEUPLOAD_IMAGES.reloadThumbnail(this)"><i class="PI_reset"></i></span></div></div></div></div></span>'}}}return isValJSON?{imgHTML:imgHTML,value:value,filePath:filePath,uploadSource:void 0!=uploadSource?uploadSource:""}:imgHTML},onLoadThumbnailCallBack:function(img,hasOption){let obj=$(img),errorObj=obj.parent().find('[elem="errThumbnail"');hasOption&&(obj.parent().addClass("zpl_profcnt"),obj.siblings().removeClass("DNI"),errorObj.siblings().removeClass("DNI")),obj.siblings('[elem="thumbnailLoader"]').addClass("DNI"),errorObj.addClass("DNI"),obj.removeClass("DNI")},onErrorThumbnailCallBack:function(img){let obj=$(img),optionObj=obj.parent().find('[elem="errThumbnail"]');obj.siblings('[elem="thumbnailLoader"]').addClass("DNI"),obj.parent().addClass("zpl_profcnt"),optionObj.removeClass("DNI"),optionObj.siblings().removeClass("DNI"),optionObj.parent().removeClass("DNI").addClass("VVI")},reloadThumbnail:function(element){let obj=$(element).parent(),imgObj=obj.siblings('[elem="thumImg"]');obj.addClass("DNI").removeClass("VVI"),imgObj.parent().removeClass("zpl_profcnt DNI"),imgObj.siblings('[elem="thumbnailLoader"]').removeClass("DNI"),imgObj.attr("src",imgObj.attr("src"))}},ZP5Form.sortTable=(()=>{let formClassObj=ZP5Form.getFormClassObj(),element=(formClassObj.LAYOUT,event.target),sectionObj=$(element).closest("[id^='zp_section_fields_']"),secId=sectionObj.attr("secId"),fcId=$(element).attr("fcid"),fieldType=$(element).attr("fctype"),fclabel=$(element).attr("fclabel"),isAsc=!0;void 0!=$(element).attr("isasc")&&(isAsc="true"!=$(element).attr("isasc")),sectionObj.find("thead i[isasc]").removeClass("asc"),sectionObj.find("thead i[isasc]").removeClass("desc"),sectionObj.find("thead i[isasc]").removeAttr("isasc"),$(element).addClass(isAsc?"asc":"desc"),$(element).attr("isasc",isAsc),formClassObj.sortTableRows({secId:secId,fcId:fcId,fieldType:fieldType,fclabel:fclabel},isAsc)}),ZP5Form.ModuleHandlers={getModuleHandler:function(formClassObj,key){let moduleKey=void 0==key?formClassObj.getTableName():key;if(1==formClassObj.FormOperations.formType())switch(moduleKey){case"P_Timesheet":return new TimeTrackerTimelogFormHandler(formClassObj);case"P_TimesheetJob":return new TimeTrackerJobsFormHandler(formClassObj);case"P_TimesheetJobsList":return new TimeTrackerProjectsFormHandler(formClassObj);case"P_ClientDetails":return new TimeTrackerClientFormHandler(formClassObj);case"P_EmployeeLeave":return new LeaveTrackerFormsHandler(formClassObj);case"P_SelfAppraisal":case"P_MultiRater":case"P_PerformanceAppraisal":case"P_Goals":case"P_EmployeeSalary":case"P_KRA_User":case"P_UserSkillMap":case"prd-pa":return new PAFormsHandler(formClassObj);case"P_Employee":return new EmployeeHandler(formClassObj);case"P_Location":return new LocationHandler(formClassObj);case"P_Task":return new TaskRecordHandler(formClassObj);case"P_Resignation":return new ResignationFormHandler(formClassObj);case"P_Termination":return new TerminationFormHandler(formClassObj);case"P_Deceased":return new DeceasedFormHandler(formClassObj);case"P_EmployeeHealthData":return new HealthData(formClassObj);case"EmployeeProfile":return new EmployeeProfile(formClassObj);case"accountsetup-designation":return new SettingDesignationModuleHandler(formClassObj);case"accountsetup-department":return new SettingDepartMentModuleHandler(formClassObj);case"P_User_Addition":return new UserAdditionHandler(formClassObj);case"accountsetup-streams":case"P_Streams":return new StreamsFormHandler(formClassObj);case"P_Candidate":case"OnboardingPortal":return new OnboardingModuleHandler(formClassObj);case"P_Workplace_Readiness":return new OfficeReadinessWFOHandler(formClassObj);case"P_Visitor":return new OfficeReadinessVisitorHandler(formClassObj);case"operations-organization-searchuser":return new OrganizationUserHandler(formClassObj)}else{if(4==formClassObj.FormOperations.formType())return new ClearanceFormsHandler(formClassObj);if(5==formClassObj.FormOperations.formType())return new InterviewFormsHandler(formClassObj);if(3==formClassObj.FormOperations.formType())return new HRProcessFormModuleHandler(formClassObj)}return new ModuleHandler(formClassObj)}},ZP5Form.loadDependencyFiles=function(dependencyFiles,callback,otherDetails){dependencyFiles.length>0?Layout.PageUtil.loadFiles(dependencyFiles,()=>{callback(otherDetails)}):callback(otherDetails)},ZP5Form.fieldChangeCalback=function(event){$(event.target).val(event.detail.value),$(event.target).trigger("change")},ZP5Form.AuditHistory={closeCallback:function(layout){layout.removeClass("zpl_mopen"),0!=layout.find("#historyFieldsSelect").length&&ZPeopleComponents.select(layout.find("#historyFieldsSelect")).destroy(),layout.remove()}},ZP5Form.RelatedForms={constructRelatedFormContent:function(elem,relformid,recid,isRefresh,isFromRelatedTabs){void 0===isRefresh&&(isRefresh=elem.attr("isrefresh"));let listName=elem[0].getAttribute("listName"),viewId=elem.attr("viewId"),formId=elem.attr("formId"),tableName=elem.attr("tableName"),relfcid=elem.attr("fcid"),linkedFcid=elem.attr("linkedFcid"),contentDOM=$(ZPeopleComponents.collapsiblepanel(elem).getAttribute("contentDOM"));if(contentDOM.find("#viewsContainer").length<=0||isRefresh){let container='<div class="zpl_tblovh"><div class="zpl_tblres"><table class="zpl_tbl zpl_fxdwdt zpl_tabularfxd" id="viewsContainer"><thead><tr id="fieldHeader"></tr></thead><tbody id="recordContainer"></tbody></table></div></div>',params={formId:formId,tableName:tableName,viewId:viewId,linkedFcid:linkedFcid,isOnload:!0,startInd:1,employeeStatus:"all",isrelatedform:!0,relfcid:relfcid,relformconfigformid:relformid,relformrecid:recid,container:contentDOM.html(container)};if(""!=listName&&"esign_doc_list"==listName)return void Zsign.getsingleRecordconst(elem);if("P_Task"==tableName&&-1==viewId)return void ZP5ViewsCommon.RelatedTask.construct(params);isFromRelatedTabs&&(params.relatedTabsRecCountCallBack=(count=>{ZPUserProfile.RelatedTab.updateRecordsCount(elem,recid,count)}),params.isfromreltabs=!0),ZP5Views.constructView(params)}},loadRelatedFormAddRecordPage:function(obj,relformId,relRecordId,isFromRelatedTabs){var ele=$(obj).closest('[name="relatedformheader"]'),formId=$(ele).attr("formid"),fcId=$(ele).attr("fcid"),linkedfcid=$(ele).attr("linkedfcid"),selValue=relRecordId;let form=ZP5Form._toForm({formId:formId,formMode:"ADD",disableUrlTrack:!0}),formClassObj=ZP5Form.getFormClassObj();void 0!=formClassObj&&(void 0!=formClassObj.getFormsProperties().getFormContainer()&&form.setFormContainer(formClassObj.getFormsProperties().getFormContainer()),form.setBaseFormDOMId(formClassObj.formLayoutKey),selValue=formClassObj.getFormsProperties().getRecordId());var formC=ZP5Form.Field.getFieldValueData(linkedfcid,relformId,relRecordId);void 0!=formC&&(selValue=formC.componentValue_ID),isFromRelatedTabs&&form.setIsfromrelTabs(!0,{relformId:relformId,relRecordId:relRecordId,container:$(obj).closest(`[id^="relatedTabList_${relRecordId}"]`)}),form.setIsfromrelfields(!0).setSelValue(selValue).setRelfcid(fcId).init()}};class ModuleHandler{constructor(formClassObj){this.FORM_CLASS_OBJ=formClassObj}loadFieldParams(params){return params}setInitialParams(params){this.INITIAL_PARAMS=params}getInitialParams(){return this.INITIAL_PARAMS}validate(){return!0}loadRecordParams(params){return params}loadParamsForSubmit(params){return params}postFormConstructionModuleHandler(){}isModuleAdmin(){return!1}successCallback(resultData,params){}failureCallback(resultData,param){}embedFormSuccessCallback(resultData,params,isModified){return!0}isEditOptionAllowed(){return!0}preprocessPostFormConstruction(){}getDefaultValue(){return null}showSuccessMessage(key,isWarning,params){let message="",{warningMsg:warningMsg}=params;switch(key){case ZP5Form.MessageKeys.Success.ADD_RECORD:message=ZPI18N.getString("zp.recordaddedsuccessfully");break;case ZP5Form.MessageKeys.Success.ADD_DRAFT:message=ZPI18N.getString("zp.draftrecordaddedsuccessfully");break;case ZP5Form.MessageKeys.Success.UPDATE_RECORD:message=ZPI18N.getString("zp.recordupdatedsuccessfully");break;case ZP5Form.MessageKeys.Success.NO_MOD_UPDATE_REC:message=ZPI18N.getString("zp.nomodification")}message+=void 0!=warningMsg?"<br>"+ZPI18N.getString("zp.note")+":"+warningMsg:"",isWarning?ZPeople.Message.warning(message):ZPeople.Message.success(message)}getFailureMessage(resultData,params){let{code:code,message:message}=resultData[0];if("permission_denied"===message)return ZPI18N.getString("zp.permissiondenied");if([7029,7031,7040,7105,7323,7400,7478].includes(code))return"object"==typeof message?message[Object.keys(message)[0]]:message;if(code===zpconst.UniqueFields.CANDIDATE_KEY_DUPLICATE_RECORD_ADD_ERROR){params.isSingleEdit||(this.FORM_CLASS_OBJ.LAYOUT.find("#errorHead").remove(),$(ZP5Form.UNIQUE_FIELDS_RECORD_ERROR).insertBefore(this.FORM_CLASS_OBJ.LAYOUT.find("#zp_form_outer_container")),this.FORM_CLASS_OBJ.LAYOUT.find("#errorHead").find("#errorTxt").html(message.errors),this.FORM_CLASS_OBJ.LAYOUT.find("#errorHead").hide().fadeIn(1e3));for(var uniqFields=this.FORM_CLASS_OBJ.FormOperations.getFormComponentData().message.UniqueFieldDetails,i=0;i<uniqFields.length;i++){var fieldObj=this.FORM_CLASS_OBJ.FIELD_LAYOUT.find("[folabel="+uniqFields[i]+"]"),errorCont="<div id='error_message' class='ztextbox--error__label'>"+ZPI18N.getString("zp.uniqueDubValPres")+"</div>";fieldObj.append(errorCont)}return!0}}getSingleEditFailureMessage(resultData,params){let{isFieldError:isFieldError}=params,{code:code,message:message}=isFieldError?resultData[0]:resultData;return code===zpconst.ResponseCodes.PERMISSION_DENIED_TO_ADD_OR_EDIT_DATA?ZPI18N.getString("zp.permdeniedtoeditfield"):[7029,7031,7040,7400].includes(code)||!isFieldError&&void 0!=message&&""!=message.trim()?message:void 0}isSingleFiledEditAllowed(fieldDtl){return!0}_viewtype(){return!this.FORM_CLASS_OBJ.FormOperations.isAdmin()||ZPUtil.isV5SettingsUrl()||isWebForm||this.FORM_CLASS_OBJ.isrelformrelfields||this.FORM_CLASS_OBJ.isEmbedForm?null:this.FORM_CLASS_OBJ.FormOperations.isOperationalRoleAdmin()?this.FORM_CLASS_OBJ.FormOperations.getAddPerm():FormConstants.Permission.VAL.TEAM_DATA}quickAddResponseCallback(){return ZP5Form.updateQuickaddResponse}validateForm(resultMap){}recordErrorHandle(recordDetail){return!1}close(){if(!this.FORM_CLASS_OBJ.isDisableUrlTrack()){if(!isWebForm)return ZP5Views.getLatestFormViewUrl(this.FORM_CLASS_OBJ.getFormsProperties().getFormId());webFormStateHandler("view",this.FORM_CLASS_OBJ.getFormsProperties().getRecordId())}}submitCallback(resultData,params){let formParams=this.FORM_CLASS_OBJ.getParams();if(formParams.recordId=resultData[0].pkId,this.FORM_CLASS_OBJ.isDisableUrlTrack()){ZP5Form.refreshRecord(formParams.formId,formParams.recordId),formParams.formMode="VIEW",this.FORM_CLASS_OBJ.closeCallback(this.FORM_CLASS_OBJ);let form=ZP5Form._toForm(formParams);void 0!=this.FORM_CLASS_OBJ.getFormsProperties().getFormContainer()&&form.setFormContainer(this.FORM_CLASS_OBJ.getFormsProperties().getFormContainer()),form.init()}else if("P_MultiRater"===params.zp_tableName)this.FORM_CLASS_OBJ.close();else if(isWebForm)webFormStateHandler("view",formParams.recordId);else{let formActUrl=urlFormConf.getUrlFromMode("view");formActUrl+="-recordId:"+formParams.recordId,window.location.href=formActUrl}}getEditCallback(){let formId=this.FORM_CLASS_OBJ.getFormsProperties().getFormId(),recordId=this.FORM_CLASS_OBJ.getFormsProperties().getRecordId(),container=this.FORM_CLASS_OBJ.LAYOUT;if(this.FORM_CLASS_OBJ.isrelfieldsingelrecview){let form=ZP5Form._toForm({formId:formId,formMode:"EDIT",recordId:recordId});void 0!=this.FORM_CLASS_OBJ.getFormsProperties().getFormContainer()&&form.setFormContainer(this.FORM_CLASS_OBJ.getFormsProperties().getFormContainer()),this.FORM_CLASS_OBJ.isfromrelTabs&&form.setIsfromrelTabs(!0,this.FORM_CLASS_OBJ.relatedTabDet),form.setBaseFormDOMId(this.FORM_CLASS_OBJ.formLayoutKey).setRelfieldedit(!0).init()}else{1==this.FORM_CLASS_OBJ.FormOperations.getPaginationType()&&(ZP5Form.lastActiveSec=container.find("#zp_form_section_list").find(".zpl_act").attr("secid"));let props={};props.isDisableUrlTrack=this.FORM_CLASS_OBJ.isDisableUrlTrack(),props.formContainer=this.FORM_CLASS_OBJ.getFormsProperties().getFormContainer(),this.FORM_CLASS_OBJ.layoutRevertChanges(this.FORM_CLASS_OBJ),ZP5Form.showForm("edit",formId,recordId,void 0,props)}}isLookupoptionUpdateAllow(){return!1}isFieldUpdated(){return!1}updateLookupOptionParams(){}constructHeader(tableName,formHeaderDiv,container){let formClassObj=this.FORM_CLASS_OBJ;if(formHeaderDiv.html(formClassObj.getCurrentFormMode()+"&nbsp;"+formClassObj.FormOperations.getFormDisplayName()),!formClassObj.PRINT&&void 0!==formClassObj.FormOperations.getFormsDetailsMap()){if(formClassObj.isAdminRedirect){let formDetailsMap=formClassObj.FormOperations.getFormsDetailsMap();formDetailsMap.addPerm=3,formClassObj.FormOperations.updateFormConf(formDetailsMap)}if(formClassObj.isSingleFieldModal){var formCompomponent=ZP5Form.Field.getFieldComponent(formClassObj.getSingleFieldEditFcid());formHeaderDiv.html(formClassObj.getCurrentFormMode()+"&nbsp;"+formCompomponent.displayName)}else if(container.find("#zp_form_header_name").addClass("zpl_DNI"),container.find("#employeeheadername").removeClass("zpl_DNI"),formClassObj.isViewMode()){let header=ZP5Form.getSingleRecord().record.message.header;if(void 0!==header&&"P_Employee"!==tableName){let id,formComponent=formClassObj.getSingleFieldRecordDetails(formClassObj.FormOperations.getPrimaryLookupId());void 0!==formComponent&&(id=formComponent.componentValue_ID),(isWebForm||void 0===id||""==id)&&(header=void 0)}if(void 0!==header){let photosrc="/viewPhoto?fs=thumb&erecno="+header.erec;header.useAccPhoto?photosrc=contactUrl+"/file?ID="+header.zuid+"&fs=thumb":"null"!=contextPath&&(photosrc="/"+contextPath+photosrc);let empFormHeader='<div class="zpl_emimg"><img src="'+photosrc+'"></div><div class="zpl_emdts"><div title="'+ZSEC.Encoder.encodeForHTMLAttribute(header.id+" - "+ZPeople.getUserDisplayName(header.fName,header.lName))+'"><em> '+ZSEC.Encoder.encodeForHTML(header.id)+" - </em><b>"+ZSEC.Encoder.encodeForHTML(ZPeople.getUserDisplayName(header.fName,header.lName))+"</b></div></div>";container.find("#employeeheadername").html(empFormHeader)}else formHeaderDiv.removeClass("zpl_DNI"),formHeaderDiv.html(formClassObj.getCurrentFormMode()+"&nbsp;"+formClassObj.FormOperations.getFormDisplayName())}else formHeaderDiv.removeClass("zpl_DNI"),formHeaderDiv.html((formClassObj.isPreviewForm()?"":formClassObj.getCurrentFormMode())+"&nbsp;"+formClassObj.FormOperations.getFormDisplayName());!this.FORM_CLASS_OBJ.isViewMode()||"P_EmployeeHealthData"!==tableName&&"P_VaccinationStatus"!==tableName||container.find("#zp_form_editin_singlerec").remove()}}updateHeaderOptions(){var container=this.FORM_CLASS_OBJ.LAYOUT;let formProps=this.FORM_CLASS_OBJ.getFormsProperties();if(this.FORM_CLASS_OBJ.isViewMode()){let recordId=formProps.getRecordId();var custActAry=this.FORM_CLASS_OBJ.FormOperations.getRecordDetails(recordId).record.message.customActions;ZP5ViewsCommon.Checklist.addChecklistIcon(container),ZPA_CusActOper.constructCBRecordView(recordId,custActAry,container),container.find("#headerApprovalBtn").removeClass("zpl_DNI"),container.find("#zp_form_header_PrintBtn").removeClass("zpl_DNI"),container.find("#zp_form_otherDetails").removeClass("zpl_DNI")}else container.find("#zp_form_header #headerApprovalBtn").addClass("zp_dyn"),container.find("#zp_form_header #headerTaskBtn").addClass("zp_dyn"),container.find("#zp_form_header").find("[name='apprRelBtn']").addClass("zp_dyn"),container.find("#zp_cbutton").addClass("hide"),container.find("#zp_form_createinfo").addClass("zpl_DNI"),container.find("#zp_form_editin_singlerec, #zp_form_audithistory").addClass("zpl_DNI"),container.find("#ZP_Form_MoreOpt").addClass("zpl_DNI"),container.find("#zp_form_header_PrintBtn").addClass("zpl_DNI"),container.find("#zp_form_otherDetails").addClass("zpl_DNI");if(this.FORM_CLASS_OBJ.isViewMode()){let props={isRecordAdmin:this.FORM_CLASS_OBJ.isRecordAdmin(),formLayoutKey:this.FORM_CLASS_OBJ.formLayoutKey,isAuditHistoryEnabled:ZP5Form.getCurrFormsOperation().isAuditHistoryEnabled(),isLetterTemplateAvailable:ZP5Form.getCurrFormsOperation().getIsLetterTemplateAvailable(),isExportAllowed:ZP5Form.getCurrFormsOperation().isExportAllowed(),hasMMTForm:ZP5Form.getCurrFormsOperation().getFormsDetailsMap().hasMMTForm,isPermAllowedForEmpId:ZP5Form.getCurrFormsOperation().isPermAllowedForEmpId()};ZP5Form.Layout.constructMoreOptionsForSingleRecordView(container,props)}}handlePrint(printWindow,params){}fieldValueChangeFunc(obj){}gridTabularHeaderAllowed(){return!0}isPrimary(){return!1}loadLookupDataParams(){}onclickFuncForFileUpload(){return null}fieldValueHandler(){}getAddUpdateRecordCallback(){return null}getModuleFormCurrentMode(){return null}draftBtnNotNeed(){let tableName=this.FORM_CLASS_OBJ.getTableName();return"P_EmployeeSalary"===tableName||"P_Department"===tableName||"P_Designation"===tableName||"P_Streams"===tableName||"P_EmployeeHealthData"===tableName||"P_VaccinationStatus"===tableName}submitNewBtnNotNeed(){return"P_EmployeeSalary"===this.FORM_CLASS_OBJ.getTableName()}fieldsSpecificHtmlLoad(){return{loaded:!1}}isfieldTreatAsPicklist(){return!1}approvalFooter(){return!1}isFieldNotAllowForConstruction(){return!1}validRecord(){return!0}isFormEditable(){return!1}isValidFields(){return!0}getFormInputHtml(){}isQuickAddAllowed(){return!0}isUserAllowedToField(){return!1}loadFileUploadParams(){}isFieldIconNeed(){return!0}fldFunctions(){return{}}updateFieldMetaData(){}fileFieldHtml(){return null}validateAddUpdateRecordParams(){return!0}isSingleCol(){return!1}singleFieldEditCallback(){}getFieldCallback(){return{}}onloadCallback(){}fileUploadCallback(){}validateField(){return{}}showSectionHeader(){return!0}needNoChangesAlert(){return!0}showFieldError(){return!0}fieldContainerOuterHtml(){return{fieldHtmlStart:"",fieldHtmlend:"",fieldHtmlInit:!1}}activeStateNotify(){}preaddUpdateCallBack(){return!0}addUpdateFailureCallback(){}newRuleCheckModuleSideManualHiden(inputObject,field){}getModuleProps(){return{}}isRefreshLookup(){return!1}getSubmitUrl(){return this.FORM_CLASS_OBJ.isEmbedForm&&!isAuthreq?"/embedFormaddUpdateRecord.hr":"/addUpdateRecord.zp"}setUploadSource(){return{}}notifyUploadSuccess(){}}const FormsUtil={getFieldValueDataByLabelList:function(labelList){var singleRecDtl=ZP5Form.getSingleRecord(),formComp={};if(void 0!==singleRecDtl&&void 0!==singleRecDtl.record){var recData=singleRecDtl.record;$.each(recData.message.recordDetails,function(){void 0!==this.column1&&this.column1.length>0&&FormsUtil.getFieldObjFromListBylabel(this.column1,labelList,formComp),void 0!==this.column2&&this.column2.length>0&&FormsUtil.getFieldObjFromListBylabel(this.column2,labelList,formComp)})}return formComp},getFieldObjFromListBylabel:function(list,labelList,formComp){$.each(list,function(){labelList.includes(this.componentName)&&(formComp[this.componentName]=this)})}};ZP5Form.getEntityLabel=function(tablename){return"P_Employee"==tablename?"Entity":"CandidateEntity"},ZP5Form.getDivisionLabel=function(tablename){return"P_Employee"==tablename?"Division":"CandidateDivision"},ZP5Form.getDepartmentLabel=function(tablename){return"P_Employee"==tablename?"Department":"CandidateDepartment"},ZP5Form.undo={URL:ZP5Form.URL,_undoParams:{},_setUndoParams(formId,recordIds,successCallBack,failureCallBack){ZP5Form.undo._undoParams={formId:formId,recordIds:recordIds,successCallBack:successCallBack,failureCallBack:failureCallBack}},_resetUndoParams(){ZP5Form.undo._undoParams={}},showAlert(message,formId,recordIds,params){let{isSuccess:isSuccess,successCallBack:successCallBack,failureCallBack:failureCallBack}=params;ZP5Form.undo.hideAlert();let type="success";void 0==isSuccess||isSuccess||(type="failure");let isMac=ZE_Init.is_mac;message+=` <a onclick="ZP5Form.undo._undoRecords(this)">${ZPI18N.getString("zp.bin.undo",[isMac?ZPI18N.getString("zp.cmdz"):ZPI18N.getString("zp.ctrlz")])}</a>`;let msgProps=ZPeople.Message.getCompProps(type,message,"");msgProps.hideDelay=7e3,msgProps.id="z_undoAlert",msgProps.beforehide=(()=>{ZP5Form.undo._resetUndoParams(),$(document).unbind("keydown")}),ZP5Form.undo._setUndoParams(formId,recordIds,successCallBack,failureCallBack),$(document).on("keydown",e=>{let ctrl=e.ctrlKey||17===e.keyCode,cmd=e.metaKey,z=90===e.keyCode;(isMac?cmd:ctrl)&&z&&ZP5Form.undo._undoRecords()}),ZAlertBanner.show(msgProps)},hideAlert(){ZAlertBanner.hide("#z_undoAlert",!0)},_isValidFunc:func=>func&&"function"==typeof func,_undoRecords(){let{formId:formId,recordIds:recordIds,successCallBack:successCallBack,failureCallBack:failureCallBack}=ZP5Form.undo._undoParams;ZP5Form.undo.hideAlert();var params={mode:"undoDeleteRecords",recordIds:JSON.stringify(recordIds),formId:formId};void 0!==recordIds&&0!=recordIds.length&&ZPeople.Request.send(ZP5Form.undo.URL,params,data=>{7e3==data.code?(ZPeople.Message.success(data.message),ZP5Form.undo._isValidFunc(successCallBack)&&successCallBack()):(void 0!==data.message?ZPeople.Message.failure(data.message):ZPeople.Message.failure(ZPI18N.getString("zp.bin.cannotundo")),ZP5Form.undo._isValidFunc(failureCallBack)&&failureCallBack())},void 0,()=>{ZPeople.Message.failure(ZPI18N.getString("zp.bin.cannotundo"))})}};const FormsCommon={APPROVALFOOTER:'<div class="zpl_mfoter zpl_btnsplt"><div id="zp_appproval_container"><button class="zlabel zlabel--outline zlabel--medium" id="zp_appproval_close" name="closeBtn" type="button">'+ZPI18N.getString("zp.close")+"</button></div></div>",EMPLOOKUP_SUB_OPT:{isLoaded:!1,list:[]},ALL_EMPLOOKUP_OPT:{isLoaded:!1,list:[]},depedencyFiles:function(tableName,formType){if(4==formType||5==formType)return["offboarding_common.min.js","offboarding_operations.min.js"];switch(tableName){case"P_Task":return["zp5taskcommon.min.js"];case"P_SelfAppraisal":case"P_MultiRater":case"P_PerformanceAppraisal":return["pms.util.min.js","pms.formHandler.min.js","pms.commonMod.min.js","pms.mod.min.js"];case"P_Goals":case"P_EmployeeSalary":case"P_KRA_User":case"P_UserSkillMap":return["pms.util.min.js","pms.formHandler.min.js"];case"P_Employee":return["framework.operations.employee.min.js"];case"P_Resignation":case"P_Termination":case"P_Deceased":return["offboarding_common.min.js","offboarding_operations.min.js","offboarding_feedback.min.js"];default:return[]}},isMobileUserAdditionAllowed:function(){return ZP5Form.isMobileUserAllowed||"undefined"!=typeof Users&&Users.config.ALLOW_MOBILEUSER_ADDITION},getPrimaryLookupValues:function(permission,mode,formId){var returnList=[],count=0;if(4!==permission&&0!==permission&&(returnList[0]={Value:ZPeople.CURR_USER.name+",&nbsp;"+ZPeople.CURR_USER.empid,Id:ZPeople.CURR_USER.usererec}),2===permission||4===permission){if(!FormsCommon.EMPLOOKUP_SUB_OPT.isLoaded){var subUsers=ZPeople.getSubUsers(),ZPTablename=ZP5Form.getFormsOperation(formId).getTableName();if(("P_TimesheetJobsList"===ZPTablename||"P_TimesheetJob"===ZPTablename||"P_Timesheet"===ZPTablename||"P_ClientDetails"===ZPTablename)&&Timetracker.isLocAdmin){for(var subLocUser=Timetracker.locUsers,tempArr=subUsers.concat(subLocUser).concat(),i=0;i<tempArr.length;++i)for(var j=i+1;j<tempArr.length;++j)tempArr[i]===tempArr[j]&&tempArr.splice(j--,1);subUsers=tempArr}$.each(subUsers,function(index){var userDtl=ZPeople.getUserDetailsByIdFromAllUsers(this);("true"===userDtl.isLogEnb&&userDtl.usererec!==erecno||"true"===userDtl.isNonUser)&&(FormsCommon.EMPLOOKUP_SUB_OPT.list[count]={Value:userDtl.name+",&nbsp;"+userDtl.empid,Id:userDtl.usererec},count++)}),FormsCommon.EMPLOOKUP_SUB_OPT.isLoaded=!0}returnList=returnList.concat(FormsCommon.EMPLOOKUP_SUB_OPT.list)}else if(3===permission){if(!FormsCommon.ALL_EMPLOOKUP_OPT.isLoaded){var userList=ZPeople.getUserListData();$.each(userList,function(index){("true"===this.isLogEnb&&this.usererec!==erecno||"true"===this.isNonUser)&&(FormsCommon.ALL_EMPLOOKUP_OPT.list[count]={Value:this.name+",&nbsp;"+this.empid,Id:this.usererec},count++)}),FormsCommon.ALL_EMPLOOKUP_OPT.isLoaded=!0}returnList=returnList.concat(FormsCommon.ALL_EMPLOOKUP_OPT.list)}if(3!==permission){var tablename=ZP5Form.getFormsOperation(formId).getTableName(),ttCustomApplicableUsersForSpecificAction=Timetracker.forms.getTTCustomAdminApplicableUsersBasedOnMode();if(-1!==Timetracker.constants.tableNames.indexOf(tablename)&&(Timetracker.isDataAdminForSpecificUsers()&&null!=Timetracker.dataAdminApplicableUsers||ttCustomApplicableUsersForSpecificAction)){var locUsers=[],includeCurrUser=4===permission||0===permission;Timetracker.dataAdminApplicableUsers&&($.each(Timetracker.dataAdminApplicableUsers,function(index){var userDtl=ZPeople.getUserDetailsByIdFromAllUsers(this);-1===returnList.indexOf(userDtl.usererec)&&("true"===userDtl.isLogEnb&&(userDtl.usererec!==erecno||includeCurrUser&&userDtl.usererec===erecno)||"true"===userDtl.isNonUser)&&locUsers.push({Value:userDtl.name+",&nbsp;"+userDtl.empid,Id:userDtl.usererec})}),returnList=returnList.concat(locUsers));if(ttCustomApplicableUsersForSpecificAction){var ttCustomAdminUsers=[];$.each(ttCustomApplicableUsersForSpecificAction,function(index){var userDtl=ZPeople.getUserDetailsByIdFromAllUsers(this);-1===returnList.indexOf(userDtl.usererec)&&("true"===userDtl.isLogEnb&&(userDtl.usererec!==erecno||includeCurrUser&&userDtl.usererec===erecno)||"true"===userDtl.isNonUser)&&ttCustomAdminUsers.push({Value:userDtl.name+",&nbsp;"+userDtl.empid,Id:userDtl.usererec})}),returnList=returnList.concat(ttCustomAdminUsers)}}}return returnList},findJSONArrayIndex:function(dataArray,keyValue,keyName){var index=-1;if(dataArray&&keyValue&&keyName)for(var i in dataArray)if(dataArray[i][keyName]===keyValue){index=i;break}return index},getPrintHeaderHtml(){let header;if("null"===logo||ZPUtil.Validation.isEmpty(logo))header='<img alt="'+page_title+'" src="'+ZPeople.getResourceURL(newUIImageUrl+"ppl_logo.svg")+'"/>';else{let src="/viewPhoto?filename="+logo;"null"!=contextPath&&(src="/"+contextPath+src),header='<img alt="'+page_title+'" src="'+src+'"/>'}return'<div class="zpl_mhder"><div><div class="zpl_printlogo">'+header+"</div></div></div>"},constructPrintForm:function(printBodyHtml,formId,recordId,{isApproval:isApproval,approvalDtl:approvalDtl,isHeaderConstruct:isHeaderConstruct,isClose:isClose}){let newWindow=window.open();$(newWindow).trigger("focus");let newContent="<!doctype html><head><title>"+page_title+'</title><script>function callprint(){var body = document.getElementsByTagName("BODY")[0];body.style.display = "block";window.print();}<\/script>',css=$("head").find("[rel=stylesheet]");for(i=0;i<css.length;i++)newContent+=css[i].outerHTML;newContent+="<meta name='viewport' content='width=1024'></head><body onload ='callprint();' class='zpl_lmin zpl_newpl zpl_themelight' >",newContent+=isHeaderConstruct?`<div class="zpl_mdl zpl_mopen zpl_mfull zpl_mprint" role="dialog" data-keyboard="false" id="zp_print_record"><div class="zpl_minr">${FormsCommon.getPrintHeaderHtml()}${printBodyHtml}</div></div>`:printBodyHtml;let{draft:draft,newContentWithApprData:newContentWithApprData}=OPApprovals.Forms.printApprovalData(isApproval,approvalDtl,newContent,recordId,formId);if(newContent=newContentWithApprData,newContent+="</body></html>",draft){let printBody=$(newContent).find(".Scrcont").find(".ZPSEdt").html();$(newContent).find(".Scrcont").html(printBody).css("top","50px")}if(newWindow.document.write(newContent),!isClose)return newWindow;newWindow.document.close()},refreshProfilePage:(resultData,params)=>("home/myspace/overview"==Layout.Page.currentmode||"home/user/profile"==Layout.Page.currentmode)&&(ZPUserProfile.Page.refresh(resultData,params,!0),!0)};class EmployeeHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj)}singleFieldEditCallback(resultData,params,isModified){isModified&&FormsCommon.refreshProfilePage(resultData,params)&&(ZPEmployeeOperations.isRefresh=!0)}successCallback(resultData,params,isModified){let currUrl=Layout.Page.currentmode;if(isModified&&(FormsCommon.refreshProfilePage(resultData,params)||"operations/organization/searchuser/profile"==currUrl)&&(ZPEmployeeOperations.isRefresh=!0),this.FORM_CLASS_OBJ.isAddMode()){let succObj=resultData[0];this.FORM_CLASS_OBJ.FormOperations.getFormComponentData().refresh=!0,succObj.isZohoUser&&(ZP5Form.addedIsZohoUser=succObj.zUserEmailID)}}getFailureMessage(resultData,params){let{message:message,code:code}=resultData[0],result=super.getFailureMessage(resultData,params);if(void 0!=result)return result;if(300==code){if("Z112"==message)return ZPI18N.getString("zp.dcinviteerror",[ZPeople.peopleSupportEmail]);if("UNKNOWN_ERROR"==message)return ZPI18N.getString("zp.userAdd.exceptionMsg",[ZPeople.peopleSupportEmail])}else if(7777==code)return void 0!=message.EmailID?message.EmailID:message.Mobile}draftBtnNotNeed(){return!0}isQuickAddAllowed(obj){return"Employeestatus"!==obj.labelName}preprocessPostFormConstruction(){let recordData=this.FORM_CLASS_OBJ.getRecordDetails(),transferFieldsStr=void 0!=recordData?recordData.record:void 0;if(void 0!=(transferFieldsStr=void 0==transferFieldsStr?void 0:transferFieldsStr.transferV2InvolvedFields)){transferFieldsStr.split(";").map((fcid,index)=>{let fieldComp=this.FORM_CLASS_OBJ.FIELD_LAYOUT.find("#zp_field_outer_"+fcid);if(void 0!=fieldComp){let fieldLabelParentComp=fieldComp.parent().find("[elem='labelName']").parent(),lockElement=fieldLabelParentComp.find("#bp_lock");0==lockElement.length?fieldLabelParentComp.append('<b id="bp_lock" title="'+ZPI18N.getString("zp.transferv2.employee.field.lock")+'" class="PI_lock" blueprintfield="false" transferv2field="true"></b>'):(lockElement.attr("title",ZPI18N.getString("zp.transferv2.employee.field.lock.general")),lockElement.attr("transferv2field",!0))}})}}}class UserAdditionHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj),this.addUserParams=formClassObj.FormsProp.getParams()}successCallback(){this.addUserParams.userSuccessCallback()}failureCallback(){this.addUserParams.userFailureCallback()}submitCallback(){}validateForm(result){result.errorList&&result.errorList.length>0&&this.addUserParams.userFailureCallback()}getModuleProps(){return{isUserAdditionFlow:!0}}}class LeaveTrackerFormsHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj)}loadParamsForSubmit(params){return LeaveForm.getInstance().getDayDetailsForParam(params),params}postFormConstructionModuleHandler(){var lvForm=LeaveForm.getInstance();lvForm.postFormConsCallback(),$(this.FORM_CLASS_OBJ.FIELD_LAYOUT.find("[name=startendhour],[name=startendtime]")).on("change",function(){LeaveForm.switchTimeinputUnit(this)}),lvForm.showHideDocument(void 0,!1)}handlePrint(layout,params){var record=layout.data("record"),leaveData=record?record.extraDetails:{},dayDetails=leaveData.dayDetails?leaveData.dayDetails:[];$(layout).find("#zp_formleave_daylist").removeAttr("style"),LeaveForm.LAYOUT=layout.find("#zp_form_outer_container"),LeaveForm.getInstance().setDayDetails(dayDetails),layout.find(".chslvtype").css({"max-height":"inherit"}),layout.find("#detailedReport").find("div").remove(),LeaveForm.LAYOUT=layout}getEditCallback(){var recId=void 0!=Layout.Page.urlparam.recordId?Layout.Page.urlparam.recordId:Layout.Page.childUrlParam.recordId;(new LeaveForm).switchToEdit(recId),this.FORM_CLASS_OBJ.layoutRevertChanges(this.FORM_CLASS_OBJ)}_viewtype(){return LVUtil.Tab.isMyPage()?FormConstants.Permission.VAL.MY_DATA:LVUtil.Tab.isTeamPage()||LVUtil.Tab.isUserPage()?FormConstants.Permission.VAL.SUB_DATA:void 0}close(){var params=this.FORM_CLASS_OBJ.getParams();return params.disableUrlTrack||-1===Layout.Page.pageId.indexOf("leavetracker-views-form")&&void 0!==params.callback&&"function"==typeof params.callback&&(this.currentTimerData?params.callback(this.FORM_CLASS_OBJ.SUCCESS_PKID,this.currentTimerData):params.callback(this.FORM_CLASS_OBJ.SUCCESS_PKID)),null}isModuleAdmin(moduleParams){return moduleParams=void 0==moduleParams?{}:moduleParams,this.isLeaveAdmin(moduleParams.forview)}isEditOptionAllowed(){return!this.FORM_CLASS_OBJ.getParams().isEditDisabled&&LeaveForm.isLvViewAllowEdit}isLeaveAdmin(){var modulePrefix=void 0!=ZPeople.Module.CURRENT_MODULEPREFIX?ZPeople.Module.CURRENT_MODULEPREFIX:"leavetracker";if("P_EmployeeLeave"===this.FORM_CLASS_OBJ.getTableName()&&("leavetracker"==modulePrefix||"leavetracker-views-applications"==modulePrefix||"leavetracker-team-applications"==modulePrefix||-1!=modulePrefix.indexOf("leavetracker")&&-1!=modulePrefix.indexOf("applications"))){modulePrefix="leavetracker";var filterprops=ZPeople.Module.MODULE_DATA[modulePrefix],recordDtl=this.FORM_CLASS_OBJ.getRecordDetails();if(void 0!==filterprops){if("leavetracker"==modulePrefix&&(filterprops=filterprops.leave_filterops),this.FORM_CLASS_OBJ.isAddMode()||this.FORM_CLASS_OBJ.isEditMode()){if(1==filterprops.isSPOCLvEditEnabled)return filterprops.isSPOCLvEditEnabled}else if(1==filterprops.isSPOCLvViewEnabled)return filterprops.isSPOCLvViewEnabled;if(recordDtl&&recordDtl.record&&7e3===recordDtl.record.code&&void 0!==recordDtl.record.message&&recordDtl.record.message.isSPOCLvViewAdmin)return!0}}}gridTabularHeaderAllowed(){return null==this.FORM_CLASS_OBJ.primLkpType&&this.isLeaveAdmin()}getModuleFormCurrentMode(){return this.FORM_CLASS_OBJ.isAddMode()?ZPI18N.getString("zp.apply"):null}draftBtnNotNeed(){return!0}submitNewBtnNotNeed(){return!0}fieldsSpecificHtmlLoad(fieldData,fieldsLst,value,isRelFieldEnabled,index){let fieldObj={loaded:!1};if("From"===fieldData.labelName){let sectionHtml="";return fieldData.isleave=!0,fieldsLst[+index+1].isleave=!0,sectionHtml+='<div class="zpl_secn DNI" id="available"><div></div><div class=""><span>'+ZPI18N.getString("zp.leave.report.available")+' <a class="Tclr" id="balancealert"></a></span> </div></div>',sectionHtml+='<div class="zpl_secn DNI"><div id="applyDateslabel"><label class="">'+ZPI18N.getString("zp.leave.view.applicabledays")+'</label></div><div id="applyDates"></div></div>',sectionHtml+='<div class="zpl_secn  Matry" style="display:none;" id="leavetimeinputby"><div> <label class="zpl_mtry">'+ZPI18N.getString("zp.leave.view.inputby",[""])+'</label></div> <div> <div class="zradiobutton" id="rd1"><input type="radio" name="startendhour" value="Hours" checked class="zradiobutton__helper" id="ltimeinput_1"><label for="ltimeinput_1" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.leave.operations.starttimehours")+'</span></label></div> <div class="zradiobutton" id="rd2"><input type="radio" name="startendtime" value="Startend"  class="zradiobutton__helper" id="ltimeinput_2"><label for="ltimeinput_2" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.leave.operations.startendtime")+"</span></label></div> </div> </div>",sectionHtml+=this.leaveFromToFields(fieldData,fieldsLst[+index+1],value,isRelFieldEnabled,this.FORM_CLASS_OBJ.getMode()),fieldObj.fieldHtml=sectionHtml,fieldObj.loaded=!0,fieldObj}return fieldObj}leaveFromToFields(fromField,toField,value,isRelFieldEnabled,mode,parentEle){var fromCompVal=void 0,toCompVal=void 0;if(void 0!=this.FORM_CLASS_OBJ.getAllFieldRecordDetails()){var fromFieldData=this.FORM_CLASS_OBJ.getSingleFieldRecordDetails(fromField.formComponentId),toFieldData=this.FORM_CLASS_OBJ.getSingleFieldRecordDetails(toField.formComponentId);fromCompVal=fromFieldData.componentValue,toCompVal=toFieldData.componentValue}else fromCompVal=toCompVal=value;var fieldHtml='<div class="zpl_secn" isAllowed="true"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.date")+"</label></div>";return fieldHtml+='<div class="zpl_ilnegap"><div folabel="'+fromField.labelName+'" fieldtype="'+fromField.fieldType+'" '+(void 0!==fromField.displayType?'displaytype="'+fromField.displayType+'"':"")+' id="zp_field_outer_'+fromField.formComponentId+'" relateddata="'+isRelFieldEnabled+'">'+("VIEW"===mode?"<span>"+ZP5Form.Field.getNoValueString(fromCompVal)+"</span>":this.FORM_CLASS_OBJ.createField(fromField,ZP5Form.Field.getNoValueString(toCompVal)))+"</div>",fieldHtml+='<div folabel="'+toField.labelName+'" fieldtype="'+toField.fieldType+'" '+(void 0!==toField.displayType?'displaytype="'+toField.displayType+'"':"")+' id="zp_field_outer_'+toField.formComponentId+'" relateddata="'+isRelFieldEnabled+'">'+("VIEW"===mode?"<span>"+ZP5Form.Field.getNoValueString(toCompVal)+"</span>":this.FORM_CLASS_OBJ.createField(toField,ZP5Form.Field.getNoValueString(fromCompVal)))+'</div></div></div><div class="zpl_secn DNI" id="leaveDays"><div></div><div id="zp_formleave_daylist" class="appld_dte"><div class="chslvtype DN"><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><tbody></tbody></table></div></div><div class="lvtypefoot DN"><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr><th colspan="2">Total</th><th id="_lform_total"></th></tr></thead></table></div></div></div></div>'}isfieldTreatAsPicklist(labelName){return"Leavetype"===labelName}approvalFooter(approvalStatus,resultData){return!(1==approvalStatus||0==approvalStatus||!resultData.extraDetails.recordImmutable)&&(LeaveForm.recordImmutableFooter(resultData.approvalDetails),!0)}isFieldNotAllowForConstruction(labelName){return"Daystaken"===labelName||"ZP_Leave_Unit"===labelName||"To"===labelName}isFieldIconNeed(){return!1}getFieldCallback(){var leaveForm=new LeaveForm;return LVUtil.urls.CompOff.isBook()?{From:leaveForm.getDetails.bind(this),To:leaveForm.getDetails.bind(this)}:{Employee_ID:leaveForm.getApplicable.bind(this),Leavetype:leaveForm.getDetails.bind(this),From:leaveForm.getDetails.bind(this),To:leaveForm.getDetails.bind(this)}}validRecord(){var isEditMode="EDIT"===this.FORM_CLASS_OBJ.FormsProp.getMode();if(isEditMode){var record=ZP5Form.getSingleRecord();if(record=record?record.record:{},isEditMode&&record.hasOwnProperty("extraDetails")&&record.extraDetails.isInactiveRecord)return ZP5Form.showFormError(ZPI18N.getString("zp.leave.record.error.disable.immutableinfo"),!0,!1),!1}return!0}fieldContainerOuterHtml(){var fieldHtmlStart="",fieldHtmlend="";return"P_EmployeeLeave"!=this.FORM_CLASS_OBJ.getTableName()||this.FORM_CLASS_OBJ.isPreviewForm()||(fieldHtmlStart='<div class="zpl_mmnurgt" id="bodyparent"><div class="zpl_rgtcnt" id="sectionsparent">',fieldHtmlend="</div></div>"),{fieldHtmlStart:fieldHtmlStart,fieldHtmlend:fieldHtmlend,fieldHtmlInit:!0}}newRuleCheckModuleSideManualHiden(inputObject,field){var mode=ZP5Form.getFormClassObj().getMode();if(void 0!=field&&"Employee_ID"==field.labelName&&("ADD"==mode||"EDIT"==mode)&&(LVUtil.Tab.isMyPage()||LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()||LVUtil.Tab.isMySpace()||LVUtil.Tab.isGlobalSearchUserPage()||-1!=Layout.Page.hash.indexOf("attendance")&&-1!=Layout.Page.hash.indexOf("summary-mode")))return inputObject}successCallback(resultData,params,isModified){LeaveApplications.refresh=isModified}embedFormSuccessCallback(resultData,params,isModified){if(void 0!=Leave&&Leave.isFromMsteam){$("#ZPLeave_Container").find(".zpl_mfoter #zp_forms_add_btn").prop("disabled",!0);var closeData={message:ZPI18N.getString("zp.recordsubmitted")};return microsoftTeams.getContext(context=>{microsoftTeams.tasks.submitTask(closeData)}),!1}return!0}}class LocationHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj)}fieldValueChangeFunc(obj){$(obj).attr("fieldtype"),$(obj).attr("fcid")}isSingleFiledEditAllowed(fieldDtl){return"Country"!==fieldDtl.componentName&&"State"!==fieldDtl.componentName}draftBtnNotNeed(){return!0}close(){return"settings/service/accountsetup/locations"}singleFieldEditCallback(data,params,isModified){Locations.NewSetting.needRefreshLocationsList=isModified}successCallback(resultData,params,isModified){ZPUtil.Location.load(!1,!1,void 0),Locations.NewSetting.needRefreshLocationsList=isModified}}class HealthData extends ModuleHandler{constructor(formClassObj){super(formClassObj)}isEditOptionAllowed(){return!1}isSingleFiledEditAllowed(fieldDtl){return!1}}class OnboardingModuleHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj)}preprocessPostFormConstruction(){let params=this.FORM_CLASS_OBJ.getParams();if(this.FORM_CLASS_OBJ.isAddMode()){let cntryInfo=params.countryInfo;void 0!==cntryInfo&&ZPeopleComponents.select(this.FORM_CLASS_OBJ.FIELD_LAYOUT.find("[phone_ctry]")).setValue(cntryInfo.c_code)}"OnboardingPortal"===params.moduleKey?this.FORM_CLASS_OBJ.LAYOUT.parents("body").addClass("zp_onb_frm_outer"):"P_Candidate"==params.moduleKey&&params.isFromAppointment&&(this.FORM_CLASS_OBJ.LAYOUT.find("#zp_forms_addnew_btn").addClass("DNI"),this.FORM_CLASS_OBJ.LAYOUT.find("#zp_forms_savedraft_btn").addClass("DNI"))}}class OfficeReadinessWFOHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj)}postFormConstructionModuleHandler(){var curLayout=ZP5Form.getLayout(),rcdDtls=ZP5Form.getFormClassObj().getRecordDetails();if(ZP5Form.getFormClassObj().isViewMode()&&rcdDtls.record.extraDetails.hasOwnProperty("availableCapacity")){var dateVsCapacity=rcdDtls.record.extraDetails.availableCapacity,appliedDatesMsg=dateVsCapacity.length>1?ZPI18N.getString("zp.applieddates",new Array(dateVsCapacity.length+"")):ZPI18N.getString("zp.applieddate",new Array(dateVsCapacity.length+"")),html='<div class="zpl_secn" id="availableCapacity"><div></div>';html+='<div id="zp_formvisitor_avlcpty" class="appld_dte collapse" aria-expanded="true" style="">',html+='<div class="chslvtype"><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr><th>'+appliedDatesMsg+"</th><th>"+ZPI18N.getString("zp.availablecapacity")+"</th></tr></thead><tbody>",$.each(dateVsCapacity,function(i,v){html+="<tr><td><div>"+v.date+'</div></td><td class="zpl_txtlft"><div class="zpl_tg"><span>'+v.capacity+"</span></div></td></tr>"}),html+="</tbody></table></div></div>",$(html).insertAfter(curLayout.find("div[folabel=to]").closest("div.zpl_secn"))}}}class OfficeReadinessVisitorHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj)}postFormConstructionModuleHandler(){var curLayout=ZP5Form.getLayout(),rcdDtls=ZP5Form.getFormClassObj().getRecordDetails();if(ZP5Form.getFormClassObj().isViewMode()&&rcdDtls.record.extraDetails.hasOwnProperty("availableCapacity")){var dateVsCapacity=rcdDtls.record.extraDetails.availableCapacity,appliedDatesMsg=dateVsCapacity.length>1?ZPI18N.getString("zp.applieddates",new Array(dateVsCapacity.length+"")):ZPI18N.getString("zp.applieddate",new Array(dateVsCapacity.length+"")),html='<div class="zpl_secn" id="availableCapacity"><div></div>';html+='<div id="zp_formvisitor_avlcpty" class="appld_dte collapse" aria-expanded="true" style="">',html+='<div class="chslvtype"><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr><th>'+appliedDatesMsg+"</th><th>"+ZPI18N.getString("zp.availablecapacity")+"</th></tr></thead><tbody>",$.each(dateVsCapacity,function(i,v){html+="<tr><td><div>"+v.date+'</div></td><td class="zpl_txtlft"><div class="zpl_tg"><span>'+v.capacity+"</span></div></td></tr>"}),html+="</tbody></table></div></div>",$(html).insertAfter(curLayout.find("div[folabel=visit_date]").closest("div.zpl_secn"))}}}ZP5Form.Layout={constructMoreOptionsForSingleRecordView:function(container,props){let isRecordAdmin=props.isRecordAdmin,formLayoutKey=props.formLayoutKey,isAuditHistoryEnabled=props.isAuditHistoryEnabled,isLetterTemplateAvailable=props.isLetterTemplateAvailable,isExportAllowed=props.isExportAllowed,hasMMTForm=props.hasMMTForm,isPermAllowedForEmpId=props.isPermAllowedForEmpId;var moreOptHtml="<div id='"+formLayoutKey+"frmMore' class='zpl_drpdwn' data-type='list'><ul>";isRecordAdmin&&isAuditHistoryEnabled&&(moreOptHtml+='<li onclick="ZP5Form.Record.getAuditHistoryForRecord()" data-icon-class="PI_audit" id="zp_form_audithistory">'+ZPI18N.getString("zp.audithistory")+"</li>"),moreOptHtml+='<li onclick="ZP5Form.openPrintForm()" data-icon-class="PI_print" id="zp_form_header_PrintBtn">'+ZPI18N.getString("zp.print")+"</li>",(isRecordAdmin||isExportAllowed)&&(isLetterTemplateAvailable&&(moreOptHtml+='<li id="mitem52279244" data-item-type="separator" class="zmenu__separator" role="separator" data-unique-key="mitem52279244"></li>',moreOptHtml+='<li onclick="RecordTemplate_Download.initPage()" data-icon-class="PI_downld"> '+ZPI18N.getString("zp.lettertemp")+" </li>"),hasMMTForm&&(moreOptHtml+='<li onclick=ZP_Mailmerge.constructMMTempList("form",null,null,this,"Download") id="mmDownSelect" data-icon-class="PI_downld" >'+ZPI18N.getString("zp.mailmerge")+"</li>")),moreOptHtml+='<li id="zp_form_mask" masked=true onclick="ZP5Form.formDataMask();"></li>',moreOptHtml+='<li id="cancel_approval" class="zpl_DNI" data-icon-class="PI_ap_cancel" onclick="ApprovalRecordHeader.cancelRecord(this)"> '+ZPI18N.getString("zp.cancelrecord")+" </li>",isPermAllowedForEmpId&&"P_Employee"==ZP5Form.getFormClassObj().getTableName()&&ZPeople.EmployeeIDGenEnabled&&(moreOptHtml+='<li id="empIdGen" elem="empIdGenButton" onmouseover="FrameworkCommon.mouseEnterFunction()" data-icon-class="PI_audit">'+ZPI18N.getString("zp.regenerateemployeeid")+"</li>"),moreOptHtml+="</ul></div>",$("body").append(moreOptHtml),container.find("#ZP_Form_MoreOpt").off("click").on("click",function(ev){var target=$(ev.target);ZPeopleComponents.menu("#"+formLayoutKey+target.data("menuId"),{contentType:"icon-text",show:()=>{target.addClass("zpl_act")},hide:()=>{target.removeClass("zpl_act")},beforeshow:()=>{let frmMore=ZPeopleComponents.menu("#"+formLayoutKey+"frmMore"),isStarExists=0!=container.find("[mask^=star]").length;frmMore.setMenuItemsAttribute(["#zp_form_mask"],"hidden",!isStarExists),isStarExists&&(frmMore.setMenuItemsAttribute(["#zp_form_mask"],"label",ZP5Form.getFormClassObj().isFormMasked()?ZPI18N.getString("zp.dataunmask"):ZPI18N.getString("zp.datamask")),frmMore.setMenuItemsAttribute(["#zp_form_mask"],"iconClassName",ZP5Form.getFormClassObj().isFormMasked()?"PI_eye":"PI_eyecls"))},itemclick:event=>{"empIdGen"==event.detail.attrs.id&&Layout.PageUtil.loadFiles(["framework.settings.organization.min.js"],()=>{let data={mode:"recordEdit",refClassObj:ZP5Form.getFormClassObj()};EmpIDGenerationSlider.init({data:data})})}}).show({forElement:target})}),container.find("#ZP_Form_MoreOpt").removeClass("zpl_DNI")},constructShowTimeInfo:function(container,formLayoutKey){if(0==container.find("#"+formLayoutKey+"recordInfo").length){let popover=`<div id="${formLayoutKey}recordInfo" class="zpl_popovr zpopover" data-display-type="box" data-type="popover" aria-haspopup="true" aria-expanded="false" tabindex="0" style="display: none; left: 987px; top: -8px;"></div>`;container.append(popover),container.find("#zp_form_createinfo").off("click").on("click",function(event){let target=$(event.target),infoTypes={cInfo:["Added",ZPI18N.getString("zp.reports.createdby")],mInfo:["Modified",ZPI18N.getString("zp.modifiedby")]},infoObject=ZP5Form.getSingleRecord().record.message.cAuditInfo,infoContainer='<div class="zpopover__content"><div class="zpl_recinfo" id = "infoContainer">';$.each(infoTypes,(key,value)=>{let obj={};if(infoObject[value[0]+"Time"]&&(obj.time=infoObject[key].time,obj.hasInfo=!0),infoObject[value[0]+"By"]&&(obj.id=ZSEC.Encoder.encodeForHTML(infoObject[key].user.id),obj.name=ZSEC.Encoder.encodeForHTML(infoObject[key].user.name),obj.image="/viewPhoto?erecno="+infoObject[key].user.ERECNO,void 0===infoObject[key].user.photopath||""==infoObject[key].user.photopath?obj.image=contactUrl+"/file?ID="+infoObject[key].user.zuid+"&fs=thumb":"null"!=contextPath&&(obj.image="/"+contextPath+obj.image),obj.hasInfo=!0,obj.dispName=obj.id+" - "+obj.name),!obj.hasInfo)return;obj.dispName=void 0!==obj.dispName?obj.dispName:"";let div=`\n\t\t                    <label class="lbldivider"><span><em>${value[1]}</em></span></label>\n\t\t                    <div class="zpl_em">\n\t\t                        <div class="zpl_emimg">\n\t\t                            ${void 0!==obj.image?"<img src='"+obj.image+"'>":"<span class='zpl_pichr'></span>"}\n                                </div>\n\t\t                        <div class="zpl_emdts zpl_ellipsis w200">\n\t\t                            <div title = "${obj.dispName}"><em>${void 0!==obj.id?obj.id+" - ":""}</em><b>${void 0!==obj.name?obj.name:""}</b></div>\n\t\t                            <div class="d-flexclmcap10">`+"<em><date>"+`${void 0!==obj.time?obj.time:""}</date></em>\n\t\t                            </div>\n\t\t                        </div>\n\t\t                    </div>\n\t\t                `;infoContainer+=div}),infoContainer+="</div></div>",container.find("#"+formLayoutKey+"recordInfo").html(infoContainer),ZPeopleComponents.popover("#"+formLayoutKey+target.data("menuId"),{open:()=>{target.addClass("zpl_act")},close:()=>{target.removeClass("zpl_act")}}).open({forElement:target})})}container.find("#zp_form_createinfo").removeClass("zpl_DNI")}};class FormsCache{toInstance(){let formsDetailsMap,form_component_details,recordDetails={};return{setFormDetailsMap:formsDet=>(formsDetailsMap=formsDet,JSON.stringify(formsDet)),getFormDetailsMap:()=>void 0==formsDetailsMap?formsDetailsMap:JSON.stringify(formsDetailsMap),setRecordDetails:(recordId,records)=>(recordDetails[recordId]=records,records),getRecordDetails:recordId=>void 0==recordDetails[recordId]?void 0:recordDetails[recordId],clearRecordCache:recordId=>void 0==recordDetails[recordId]||delete recordDetails[recordId],updateRecordDetails:(recordId,key,val)=>void 0!=recordDetails[recordId]?(recordDetails[recordId][key]=val,recordDetails[recordId]):{},setFormComponentData:values=>(form_component_details=values,JSON.stringify(values)),getFormComponentData:()=>void 0!=form_component_details?JSON.stringify(form_component_details):form_component_details,updateFormComponentDataValues:(fcid,key,val)=>{-1!=ZP5Form.ALLOWED_OPTIONS_TO_UPDATE_FIELD.indexOf(key)&&$.each(form_component_details.message.formComponentDetails,function(){void 0!==this.column1&&this.column1.length&&$.each(this.column1,function(){if(this.formComponentId==fcid)return this[key]=val,!1}),void 0!==this.column2&&this.column2.length>0&&$.each(this.column2,function(){if(this.formComponentId==fcid)return this[key]=val,!1})})},refreshFormComponentData:()=>{if(void 0!=form_component_details)return form_component_details.refresh=!0,JSON.stringify(form_component_details)},refreshRecordDetails:()=>{recordDetails={}}}}}class FormsOperations{constructor(formid){return this.formId=formid,void 0==formid&&(this.formId=ZP5Views.CURR_VIEWPARAMS.formId),this}getFormsDetailsMap(){let formDetailsMap=ZP5Form.getForm(this.formId).getFormDetailsMap();return void 0==formDetailsMap?void 0:JSON.parse(formDetailsMap)}getTableName(){return void 0!=this.getFormsDetailsMap()?this.getFormsDetailsMap().tableName:""}isAdmin(isOrgAdmOly){var isAdmin;return isOrgAdmOly?isadmin:void 0!=(isAdmin=this.getFormsDetailsMap().isadmin)&&isAdmin}isLocAdmin(){return this.getFormsDetailsMap().isLocAdmin}formType(){return this.getFormsDetailsMap().formType}getPaginationType(){var paginationType;return void 0==(paginationType=this.getFormsDetailsMap().paginationType)?0:paginationType}getFormDisplayName(){var formDispName;return void 0==(formDispName=this.getFormsDetailsMap().formdisplayName)?"":formDispName}getServiceName(){let serviceName=this.getFormsDetailsMap().serviceName;return serviceName||""}updateFormConf(formDtl){ZP5Form.getForm(this.formId).setFormDetailsMap(formDtl)}setFormComponentData(val){ZP5Form.getForm(this.formId).setFormComponentData(val)}isDraftAllowed(){return this.getFormsDetailsMap().isDraftAllowed}isEditedDraftAllowed(){return this.getFormsDetailsMap().isEditedDraft}isAuditHistoryEnabled(){return this.getFormsDetailsMap().isAuditHistoryEnabled}isPermAllowedForEmpId(){return this.getFormsDetailsMap().isPermAllowedForEmpId}isSingleFieldEditAllow(){return this.getFormsDetailsMap().isSingleFieldEditAllow}getApproverType(){return this.getFormsDetailsMap().approverType}isLocationTrackingEnabled(){return this.getFormsDetailsMap().isLocationTrackingEnabled}getAddPerm(){return this.getFormsDetailsMap().addPerm}getEditPerm(){return this.getFormsDetailsMap().editPerm}getViewPerm(){return this.getFormsDetailsMap().viewPerm}getDeletePerm(){return this.getFormsDetailsMap().deletePerm}isImportAllowed(){return this.getFormsDetailsMap().isImportAllowed}isExportAllowed(){return this.getFormsDetailsMap().isExportAllowed}isBulkImportAllowed(){return this.getFormsDetailsMap().isBulkImportAllowed}isPhotoUploadAllowed(){return this.getFormsDetailsMap().isPhotoUploadAllowed}isPhotoUploadOnlyAllowed(){return this.getFormsDetailsMap().isPhotoUploadOnlyAllowed}isAdditonalPermAdd(){return this.getFormsDetailsMap().additionalPermForAdd}isAdditonalPermView(){return this.getFormsDetailsMap().additionalPerm}isOperationalRoleAdmin(){return this.getFormsDetailsMap().isOperationalRoleAdmin}isUndoAllowed(){return this.getFormsDetailsMap().isUndoAllowed}getApprovalSettingsDetails(){return this.getFormsDetailsMap().approvalSettingsDetails}getIsLetterTemplateAvailable(){return this.getFormsDetailsMap().isLetterTemplateAvailable}getFormComponentData(){let form_component_details=ZP5Form.getForm(this.formId).getFormComponentData();return void 0!=form_component_details?JSON.parse(form_component_details):form_component_details}getLocUsers(){return this.getFormComponentData().message.locUsers}getPrimaryLookupId(isMultiAllowed){var primLkpId=null,formComp=this.getFormComponentData().message;return $.each(formComp.formComponentDetails,function(){return void 0!==this.column1&&this.column1.length>0&&$.each(this.column1,function(){if(this.fieldType===FormConstants.FieldType.LOOKUP&&this.isPrimary&&(isMultiAllowed||this.displayType==FormConstants.FieldType.SELECT_DISPLYTYPE||this.displayType==FormConstants.FieldType.RADIO_DISPLYTYPE))return primLkpId=this.formComponentId,!1}),void 0!==this.column2&&this.column2.length>0&&$.each(this.column2,function(){if(this.fieldType===FormConstants.FieldType.LOOKUP&&this.isPrimary&&(isMultiAllowed||this.displayType==FormConstants.FieldType.SELECT_DISPLYTYPE||this.displayType==FormConstants.FieldType.RADIO_DISPLYTYPE))return primLkpId=this.formComponentId,!1}),null==primLkpId}),primLkpId}setRecordDetails(recordId,records){ZP5Form.getForm(this.formId).setRecordDetails(recordId,records)}getRecordDetails(recordId){return ZP5Form.getForm(this.formId).getRecordDetails(recordId)}updateRecordDetails(recordId,key,val){return ZP5Form.getForm(this.formId).updateRecordDetails(recordId,key,val)}updateFormComponentDataValues(fcid,key,val){ZP5Form.getForm(this.formId).updateFormComponentDataValues(fcid,key,val)}}class CurrFormsOperation extends FormsOperations{constructor(formid){super(formid),this.formId=formid}setFormClassObj(formclassobj){this.FORM_CLASS_OBJ=formclassobj}getTableName(){if(void 0==this.tableName||""==this.tableName){if(void 0!==this.FORM_CLASS_OBJ.getParams().tableName)return this.tableName=this.FORM_CLASS_OBJ.getParams().tableName,this.tableName;this.tableName=super.getTableName()}return this.tableName}getPaginationType(){let params=this.FORM_CLASS_OBJ.getParams();return params.isFromSelfService||this.FORM_CLASS_OBJ.isSingleFieldModal||params.isPageMode?0:void 0!==params.paginationType?params.paginationType:super.getPaginationType()}getFormDisplayName(){return void 0!==this.FORM_CLASS_OBJ.formdisplayName?this.FORM_CLASS_OBJ.formdisplayName:super.getFormDisplayName()}setFormComponentData(val){void 0!==this.FORM_CLASS_OBJ.getFormsProperties().getTempFormComponent()?this.FORM_CLASS_OBJ.getFormsProperties().setTempFormComponent(val):super.setFormComponentData(val)}getFormComponentData(){return void 0!==this.FORM_CLASS_OBJ.getFormsProperties().getTempFormComponent()?this.FORM_CLASS_OBJ.getFormsProperties().getTempFormComponent():super.getFormComponentData()}}class FormsFramework{toInstance(){let SKIP_FOOTER,isPreviewForm,isCustomizationPreviewForm,BASE_FORM_DOM_ID,isFormForFieldLayout,IS_RESUBMIT,SKIP_HEADER_CLOSE,SKIP_FOOTER_CLOSE,formContainer,formId,recordId,mode,SINGLE_FIELD_EDIT_FORMCOMP_ID,TEMP_FORM_COMPONENT,TEMP_RECORD_DETAILS,PERMISSION_BASED_ROLE_LIST,FORM_FIELD_ALLOWED_ROLE_IDS_FOR_ADD,formParams={},formComponentsMap={},uploadedFiles={cloudUpload:[],wdUpload:[]};return{setMode:formmode=>{mode=formmode},getMode:()=>mode,getSingleFieldEditFCID:()=>SINGLE_FIELD_EDIT_FORMCOMP_ID,setSingleFieldEditFCID:fcId=>{SINGLE_FIELD_EDIT_FORMCOMP_ID=fcId},setPreviewForm:ispreview=>{isPreviewForm=ispreview},getIsPreviewForm:()=>isPreviewForm,setIsFormCustomPreview:isCustPreview=>{isCustomizationPreviewForm=isCustPreview},getIsFormCustomPreview:()=>isCustomizationPreviewForm,setFormContainer:container=>{formContainer=container},getFormContainer:()=>formContainer,setFormId:id=>{formId=id},getFormId:()=>formId,setRecordId:id=>{recordId=id},getRecordId:()=>recordId,setParams:params=>{formParams=params,formId=params.formId,recordId=params.recordId},getParams:()=>Object.assign({},formParams),setParamsVal:(key,val)=>{formParams[key]=val},setFieldData:val=>{formComponentsMap=val},getFieldData:()=>formComponentsMap,setCloudUploadedFiles:val=>{uploadedFiles.cloudUpload.push(val)},setWDUploadedFiles:val=>{uploadedFiles.wdUpload.push(val)},getUploadedFiles:()=>uploadedFiles,refreshUploadedFiles:()=>{uploadedFiles={cloudUpload:[],wdUpload:[]}},setBaseFormDOMId:val=>{BASE_FORM_DOM_ID=val},getBaseFormDOMId:()=>BASE_FORM_DOM_ID,setIsFormForFieldLayout:()=>{isFormForFieldLayout=!0},getIsFormForFieldLayout:()=>isFormForFieldLayout,setFooterSkip:val=>{SKIP_FOOTER=val},isFooterSkip:()=>SKIP_FOOTER,setTempFormComponent:val=>{TEMP_FORM_COMPONENT=val},getTempFormComponent:()=>TEMP_FORM_COMPONENT,setTempRecordDetails:val=>{TEMP_RECORD_DETAILS=val},getTempRecordDetails:()=>TEMP_RECORD_DETAILS,setResubmit:()=>{IS_RESUBMIT=!0},isResubmit:()=>IS_RESUBMIT,skipHeaderClose:()=>{SKIP_HEADER_CLOSE=!0},isHeaderCloseSkipped:()=>SKIP_HEADER_CLOSE,skipFooterClose:()=>{SKIP_FOOTER_CLOSE=!0},isFooterCloseSkipped:()=>SKIP_FOOTER_CLOSE,setPermissionBasedRoleList:val=>PERMISSION_BASED_ROLE_LIST=val,getPermissionBasedRoleList:()=>PERMISSION_BASED_ROLE_LIST,setFormFieldAllowedRoleIdsForAdd:arrVal=>FORM_FIELD_ALLOWED_ROLE_IDS_FOR_ADD=arrVal,getFormFieldAllowedRoleIdsForAdd:()=>FORM_FIELD_ALLOWED_ROLE_IDS_FOR_ADD}}setBaseFormDOMId(val){return this.getFormsProperties().setBaseFormDOMId(val),this}getBaseFormDOMId(){return this.getFormsProperties().getBaseFormDOMId()}setIsFormForFieldLayout(){return this.getFormsProperties().setIsFormForFieldLayout(),this}getIsFormForFieldLayout(){return this.getFormsProperties().getIsFormForFieldLayout()}getFormId(){return this.getFormsProperties().getFormId()}getRecordId(){return this.getFormsProperties().getRecordId()}getFormsProperties(){return this.FormsProp}isViewMode(){return"VIEW"===this.getMode()}isEditMode(){return"EDIT"===this.getMode()}isAddMode(){return"ADD"===this.getMode()}setAsViewMode(){return this.getFormsProperties().setMode("VIEW"),this}setAsEditMode(){return this.getFormsProperties().setMode("EDIT"),this}setAsAddMode(){return this.getFormsProperties().setMode("ADD"),this}getMode(){return this.getFormsProperties().getMode()}setPermissionBasedRoleList(data){return this.getFormsProperties().setPermissionBasedRoleList(data),this}getPermissionBasedRoleList(){return this.getFormsProperties().getPermissionBasedRoleList()}skipHeader(value){return this.SKIP_HEADER=value,this}skipFooter(value){return this.getFormsProperties().setFooterSkip(value),this}setOuterHeaderSkip(value){this.SKIP_OUTER_HEADER=value}isFooterSkip(){return this.getFormsProperties().isFooterSkip()||this.getIsFormForFieldLayout()}skipHeaderClose(){return this.getFormsProperties().skipHeaderClose(),this}skipFooterClose(){return this.getFormsProperties().skipFooterClose(),this}isHeaderCloseSkipped(){return this.getFormsProperties().isHeaderCloseSkipped()}isFooterCloseSkipped(){return this.getFormsProperties().isFooterCloseSkipped()}isSingleFieldEdit(){return null!=this.getFormsProperties().getSingleFieldEditFCID()}getSingleFieldEditFcid(){return this.getFormsProperties().getSingleFieldEditFCID()}setPreviewForm(isPreviewForm){return this.getFormsProperties().setPreviewForm(isPreviewForm),this}isPreviewForm(){return this.getFormsProperties().getIsPreviewForm()}setIsFormCustomPreview(isCustPreview){return this.setPreviewForm(isCustPreview),this.getFormsProperties().setIsFormCustomPreview(isCustPreview),this}isFormCustomPreview(){return this.getFormsProperties().getIsFormCustomPreview()}setFormModel(value){return this.FORM_MODEL=value,this}setHeader(ele){return this.HEADER=ele,this}setResubmit(){return this.getFormsProperties().setResubmit(),this}isResubmit(){return this.getFormsProperties().isResubmit()}setFormFieldAllowedRoleIdsForAdd(arrVal){return this.getFormsProperties().setFormFieldAllowedRoleIdsForAdd(arrVal),this}getFormFieldAllowedRoleIdsForAdd(){return isadmin?[]:this.getFormsProperties().getFormFieldAllowedRoleIdsForAdd()}setFormContainer(ele){return this.getFormsProperties().setFormContainer(ele),this}callCallbackFunction(callback){void 0!=callback&&"function"==typeof callback&&callback(this)}setOtherDetails(details){this.otherDetails=details}getOtherDetails(){return this.otherDetails}setSingleFieldModal(val){return this.isSingleFieldModal=val,this}getSingleFieldModal(){return this.isSingleFieldModal}setSingleFieldModalFields(val){return this.singleFieldModalFields=val,this}getSingleFieldModalFields(){return this.singleFieldModalFields}getParams(){return this.getFormsProperties().getParams()}setParamsVal(key,val){return this.getFormsProperties().setParamsVal(key,val),this}isDisableUrlTrack(){return this.getParams().disableUrlTrack}getSingleFieldData(fcid){return this.getFormsProperties().getFieldData()[fcid]}refreshFieldData(){return this.getFormsProperties().setFieldData(ZP5Form.populateFields(this.FormOperations.getFormComponentData().message))}setSingleFieldRecordDetails(val){return this.singleFieldRecordDetails=val,this}getSingleFieldRecordDetails(fcid){return void 0==this.singleFieldRecordDetails?{}:this.singleFieldRecordDetails[fcid]}getAllFieldRecordDetails(){return this.singleFieldRecordDetails}setRelfieldsingelrecview(val){return this.isrelfieldsingelrecview=val,this}setRelfcid(val){return this.relfcid=val,this}setFormMasked(val){this.formMasked=val}isFormMasked(){return void 0===this.formMasked||this.formMasked}setRefreshRelatedForm(val){return this.refreshRelatedForm=val,this}setRelfieldedit(val){return this.isfromrelfieldedit=val,this}setEmbedForm(val){return this.isEmbedForm=val,this}setSelValue(val){return this.selValue=val,this}setIsfromrelfields(val){return this.isrelformrelfields=val,this}setIsfromrelTabs(val,details){return this.isfromrelTabs=val,this.relatedTabDet=details,this}setReffcid(val){return this.reffcid=val,this}setDisplayFields(val){return this.displayFields=val,this}setInitialParams(val){return this.initialParams=val,this}setLookupfcid(val){return this.lookupfcid=val,this}setisQuickAdd(val){return this.isQuickAdd=val,this}setisRoleBasedPreview(val){return this.isRoleBasedPreview=val,this}setUploadedFiles(val,isCloud){return isCloud?this.getFormsProperties().setCloudUploadedFiles(val):this.getFormsProperties().setWDUploadedFiles(val),this}getUploadedFiles(){return this.getFormsProperties().getUploadedFiles()}refreshUploadedFiles(){return this.getFormsProperties().refreshUploadedFiles(),this}getInfoToolTipObj(){return void 0==this.infoToolTipObj&&(this.infoToolTipObj=new InfoToolTip),this.infoToolTipObj}setSingleFieldEditFCID(val){return this.getFormsProperties().setSingleFieldEditFCID(val),this}getTableName(){return void 0!=this.tableName&&""!=this.tableName||(this.tableName=this.FormOperations.getTableName()),this.tableName}getRecordDetails(){return(void 0===this.RECORD_DETAILS||this.RECORD_DETAILS&&this.RECORD_DETAILS.refresh)&&(void 0===this.RECORD_DETAILS&&void 0!==this.getFormsProperties().getTempRecordDetails()?this.RECORD_DETAILS=this.getFormsProperties().getTempRecordDetails():this.RECORD_DETAILS=ZP5Form.getSingleRecord()),this.RECORD_DETAILS}setTempRecordDetails(val){return this.getFormsProperties().setTempRecordDetails({record:val}),this}setTempFormComponent(val){return this.getFormsProperties().setTempFormComponent(val),this}getCreateFldFunctions(){let obj=this.getParams().createFldFunctions;return obj=void 0==obj?{}:obj,Object.assign(obj,this.moduleHandler.fldFunctions())}isRecordAdmin(isOrgAdmin){if(this.FormOperations.isOperationalRoleAdmin()&&(this.isViewMode()||this.isEditMode()||this.isSingleFieldEdit())){var recDtls=this.getRecordDetails();if(void 0!=recDtls)return recDtls.record.isRecordAdmin}return this.FormOperations.isAdmin(isOrgAdmin)}isPageMode(){return this.getParams().isPageMode}getCurrentFormMode(){var mode=this.moduleHandler.getModuleFormCurrentMode();return null==mode&&(mode="",this.isEditMode()?mode=ZPI18N.getString("zp.edit"):this.isAddMode()&&(mode=ZPI18N.getString("zp.add"))),mode}setRelatedFormNotNeeded(){return this.isRelatedFormNotNeeded=!0,this}destroyComponents(formsClassObj){$.each(formsClassObj.LAYOUT.find("[zcomponentname]"),function(){formsClassObj.destroyZComponents($(this))}),void 0!==ZPeopleComponents.menu("#"+formsClassObj.formLayoutKey+"frmMore")&&ZPeopleComponents.menu("#"+formsClassObj.formLayoutKey+"frmMore").destroy(!0),void 0!==ZPeopleComponents.popover("#"+formsClassObj.formLayoutKey+"recordInfo")&&ZPeopleComponents.popover("#"+formsClassObj.formLayoutKey+"recordInfo").destroy(!0),ZPeopleComponents.isComponent("zp_formfield_edit_opt")&&ZPeopleComponents.progresswheel("#zp_formfield_edit_opt").destroy(),formsClassObj.getInfoToolTipObj().destroyTooltips()}refreshPage(params){this.destroyComponents(this),this._loadingpage(),this.loadParams(params),this.getFormsData()}loadParams(params){params=void 0==params?this.getParams():params,this.getFormsProperties().setMode(params.formMode),this.modalPopOverNeed=void 0!==params.modalPopOverNeed&&params.modalPopOverNeed,this.FORM_VIEW_READONLY=!!params.isFormReadOnly&&params.isFormReadOnly,this.setSingleFieldEditFCID(void 0==params.fcid?null:params.fcid),this.PRINT=params.PRINT,this.formLayoutKey=ZP5Form.ACTIVE_FORM_KEY=ZP5Form.getFormObjectKey(this,params.formId,params.formMode),ZP5Form.FORMSCLASSOBJ[this.formLayoutKey]=this,void 0==this.getBaseFormDOMId()&&ZP5Form.IS_PROFILE_PAGE_LOADED&&ZP5Form.ACTIVE_FORM_KEY!="zp_profile_record_"+ZPeople.EMP_FORMID&&this.setBaseFormDOMId("zp_profile_record_"+ZPeople.EMP_FORMID),ZP5Form.ACTIVE_FORM_KEY=="zp_profile_record_"+ZPeople.EMP_FORMID&&(ZP5Form.IS_PROFILE_PAGE_LOADED=!0)}init(){this.loadParams(),this.loadOuterLayout(),this._loadingpage(),this.getFormsData()}loadForms(formDataObj,params){this.FormOperations.updateFormConf(formDataObj.formDetails),this.validateFormData(formDataObj)&&(this.isPreviewForm()&&(formDataObj.lastprev=!0),formDataObj.hasOwnProperty("ruleArray")&&ZPFRulesNew.Evaluation.constructRulesJson(formDataObj,params),this.loadModuleHandler(formDataObj,params,()=>{!formDataObj.formDetails.isLocationTrackingEnabled||this.isViewMode()||this.isPreviewForm()?this.loadRecordData(formDataObj):FrameworkCommon.Location.fetch(({formDataObj:formDataObj,formClassObj:formClassObj},locObj)=>{locObj.isPermEnabled?formClassObj.loadRecordData(formDataObj):ZP5Form.showNoData(void 0,ZP5Form.NO_DATA.LOCATION_DISABLED)},{formDataObj:formDataObj,formClassObj:this})}))}loadModuleHandler(formDataObj,params,callback){if(isCompressionMode){let files=FormsCommon.depedencyFiles(this.getTableName(),this.FormOperations.formType());return files.concat(ZP5Form.dependencyFiles()),void 0!=formDataObj.message&&formDataObj.message.widgetDetails&&files.push("sigmawidget.min.js"),void ZP5Form.loadDependencyFiles(files,()=>{this.loadModuleHandlerCallback(formDataObj,params,callback)})}this.loadModuleHandlerCallback(formDataObj,params,callback)}loadModuleHandlerCallback(formDataObj,params,callback){this.moduleHandler=ZP5Form.ModuleHandlers.getModuleHandler(this,this.getParams().moduleKey),this.moduleHandler.setInitialParams(this.initialParams),this.initialParams=null,callback(formDataObj,params)}loadRecordData(formDataObj){this.isViewMode()||this.isEditMode()?this.getRecordData(formDataObj):this.loadFormsRecordData(formDataObj)}loadFormsRecordData(formDataObj){let constructCallBack=()=>{this.processRecordData(formDataObj)&&this.buildFormStructure(formDataObj)};if(this.isAddMode()&&void 0==this.getFormFieldAllowedRoleIdsForAdd()){let formComp=formDataObj.message;if(formComp.primLookupRoleIds)this.setFormFieldAllowedRoleIdsForAdd(formComp.primLookupRoleIds),constructCallBack();else{let formClassobj=this;ZPeople.Request.send(ZP5Form.URL,{formId:formClassobj.getFormsProperties().getFormId(),mode:"getPrimaryLookupRoleIds"},response=>{formClassobj.setFormFieldAllowedRoleIdsForAdd(response.roleIds?response.roleIds:[]),constructCallBack()})}}else constructCallBack()}buildFormStructure(formDataObj){let constructCallBack=()=>{this.constructHeader(),this.constructFields(formDataObj.message),this.constructFooter(),this.processPostFormConstruction()};if(!this.isHeaderSkipped()&&this.isFormCustomPreview()&&void 0==this.getPermissionBasedRoleList()){let formClassobj=this;ZPeople.Request.send(ZP5Form.URL,{mode:"getPermissionBasedRoleList",formId:this.getFormsProperties().getFormId()},response=>{formClassobj.setPermissionBasedRoleList(response),constructCallBack()})}else constructCallBack()}loadOuterLayout(){let isFormForFieldLayout=this.getIsFormForFieldLayout(),headerTemplate=this.SKIP_OUTER_HEADER||isFormForFieldLayout?"":this.getHeader(),id=this.formLayoutKey,outerClass=ZP5Form.getFormModelClass(this.FORM_MODEL),formOuterClass=isFormForFieldLayout?"":"zpl_minr",formBodyClass=isFormForFieldLayout?"":"zpl_mcnt";if(this.LAYOUT=$('<div class="'+outerClass+'" role="dialog" data-keyboard="false"><div class="'+formOuterClass+'">'+headerTemplate+'<div class="'+formBodyClass+'" id="zp_form_outer_container"></div>'+(this.PRINT||isFormForFieldLayout?"":'<div class="zpl_DNI" id="formfooter"></div>')+"</div></div>"),this.isFormCustomPreview()&&(this.LAYOUT=$("<div></div>")),this.LAYOUT.attr("id",id),!this.PRINT){let container=settingsPage.container;if(void 0!=this.getFormsProperties().getFormContainer()?container=this.getFormsProperties().getFormContainer():(this.isDisableUrlTrack()||this.isQuickAdd||this.isrelformrelfields||this.isrelfieldsingelrecview||this.isfromrelfieldedit||this.isSingleFieldModal)&&!this.getFormsProperties().getIsPreviewForm()?(container=$("body #modal_Container"),this.LAYOUT.data("closeCallback",ZP5Form.closeCallback)):this.isFormCustomPreview()&&(container=FormCustomNew.container.find("#cardPreviewForm")),this.isPreviewForm()){if(container.find("#"+id).length>0){let zcomponentNameObj=container.find("#"+id).find("[zcomponentname]"),formsClassObj=this;$.each(zcomponentNameObj,function(){formsClassObj.destroyZComponents($(this))})}$("#rolemenu").remove(),container.html(this.LAYOUT)}else container.append(this.LAYOUT)}if(!this.SKIP_HEADER&&!this.isHeaderCloseSkipped()){let closeBtnEle=this.LAYOUT.find('[name="closeBtn"]');closeBtnEle.removeClass("zpl_DNI"),closeBtnEle.off("click").on("click",ele=>{this.close(!0)})}}getHeader(){return this.isEmbedForm?"":null==this.HEADER?ZP5Form.FORM_HEADER_TEMPLATE:this.HEADER}getFormsData(){var formCompData=this.FormOperations.getFormComponentData();let formId=this.getFormsProperties().getFormId();void 0!==formCompData&&(formCompData.refresh||formCompData.lastprev||this.isRefreshNeed)&&(formCompData=void 0,this.FormOperations.setFormComponentData());var params={formId:formId,mode:"getFormComponents"};isWebForm&&(params.isWebForm=isWebForm),params.isFromRecords=!this.isPreviewForm(),ZP5Form.constructFieldDataParams(params),void 0!=this.getParams().moduleParamsHandler&&this.getParams().moduleParamsHandler(params),void 0===formCompData||this.isRoleBasedPreview?ZP5Form.getFormComponents(params,data=>{this.loadForms(data,params)},FormConstants.InitialError.show):this.getFormsDataCallback(formCompData,params)}getFormsDataCallback(formCompData,params){if(!this.isViewMode()&&7e3===formCompData.code&&formCompData.message.hasLookUp){var lookUpIds=this.refreshLookupOptions(formCompData);if(lookUpIds.length>0)return void this.loadModuleHandler(formCompData,params,()=>{this.fetchLookUpData(lookUpIds,formCompData)})}this.loadForms(formCompData,params)}validateFormData(formDataObj){return formDataObj.code===ZPeople.ResponeCodes.SUCCESS||(this.getParams().isProfileView?this.LAYOUT.html(""):ZP5Form.showFormError(formDataObj.message,!0,!1,void 0,formDataObj.code),!1)}getRecordData(formDataObj,iszuidLoaded){var singleRec=this.getRecordDetails(),params=this.getRecordParams();void 0===singleRec||singleRec.refresh||("undefined"==typeof transfer||!transfers.isTransfer)&&!this.ISBLUEPRINT&&this.isEditMode()?ZPeople.Request.send(ZP5Form.URL,params,data=>{ZP5Form.setSingleRecordDetail(data,this.getFormsProperties().getFormId(),this.getFormsProperties().getRecordId()),this.RECORD_DETAILS=void 0,this.loadFormsRecordData(formDataObj)},void 0,FormConstants.InitialError.show):this.loadFormsRecordData(formDataObj)}getRecordParams(){var params={mode:"fetchSingleRecord",formId:this.getParams().formId,recordId:this.getParams().recordId,subMode:this.getMode()};return isWebForm&&(params.isWebForm=isWebForm),params.isApprovalEnabled=ZP5Form.isApprovalEnabled(this.getParams().formId),this.moduleHandler.loadRecordParams(params),params}processRecordData(formCompObj){let tableName=this.getTableName();var formComp=formCompObj.message;if(this.FormAllowedRoleIds=formComp.allowedRoleIds,!this.moduleHandler.validRecord())return!1;if(this.isEditMode()||this.isViewMode()){var singledet=this.getRecordDetails();if(singledet.record.code!=zpconst.ResponseCodes.API_ERR_NO_ERROR||this.isEditMode()&&singledet.record.skipEdit)return this.moduleHandler.recordErrorHandle(singledet)||ZP5Form.showFormError(singledet.record.message,!singledet.record.skipEdit,!1,this.getMode(),singledet.record.code),!1;var editedFieldList=singledet.record.editedFcids;if(this.EDITED_FIELDS=[],void 0!=editedFieldList&&Object.keys(editedFieldList).length>0)for(var fcids=Object.keys(editedFieldList),fcidIndex=0;fcidIndex<fcids.length;fcidIndex++)this.EDITED_FIELDS.push(fcids[fcidIndex]);void 0!=singledet&&4==singledet.record.message.approvalStatus&&(this.isDraftrec=!0),void 0!=singledet&&singledet.record.message.approvalStatus==ZP5Form.editdraftstatus&&(this.isEditDraftrec=!0),this.allowedRoleIdsForRecordEdit=singledet.record.allowedRoleIdsForEdit,this.allowedRoleIdsForRecordView=singledet.record.allowedRoleIds,ZP5Form.constructSingleFieldRecordDetails(this.getRecordDetails()),this.isFormFieldEditable=(this.isDraftrec||ZP5Form.isApprover()||this.isPermitted(this.FormOperations.getEditPerm())||this.getRecordDetails().record.isAllowedEditFromNode)&&this.FormOperations.isSingleFieldEditAllow()&&!this.FORM_VIEW_READONLY&&!this.getParams().disableSingleEdit&&ZP5Form.isApprovalStarted(this.getFormsProperties().getFormId(),this.getFormsProperties().getRecordId())&&!this.getRecordDetails().record.skipEdit}if(this.isAddMode()&&!ZPUtil.checkIsExistInArray(ZP5Form.primLkpChangeRestrictedForms,tableName)&&null==this.primLkpType&&null==this.primLkpVal&&(this.FormOperations.isOperationalRoleAdmin()&&ZPUtil.checkIsExistInArray(formComp.locUsers,erecno)?this.primLkpVal=erecno:this.FormOperations.getAddPerm()>FormConstants.Permission.VAL.NO_DATA?(this.primLkpVal=this.FormOperations.getAddPerm()==FormConstants.Permission.VAL.SUB_DATA?null:erecno,this.primLkpType=this.FormOperations.getAddPerm()==FormConstants.Permission.VAL.SUB_DATA?FormConstants.Permission.VAL.SUB_DATA:FormConstants.Permission.VAL.MY_DATA):this.getFormFieldAllowedRoleIdsForAdd().length>0&&(this.primLkpType=FormConstants.Permission.VAL.ALL_DATA)),!(this.PRINT||void 0==this.FormOperations.getFormsDetailsMap()||this.FormOperations.isOperationalRoleAdmin()||this.isDraftrec||this.moduleHandler.isModuleAdmin())){if(this.isAddMode()&&(formCompObj.code===ZPeople.ResponeCodes.PERMISSION_ERR||0===this.FormOperations.getAddPerm()&&!this.FormOperations.isAdditonalPermAdd()))return ZP5Form.showErrMsg(ZPI18N.getString("zp.permdeniedtoadd")),!1;if(this.isEditMode()&&(formCompObj.code===ZPeople.ResponeCodes.PERMISSION_ERR||0===this.FormOperations.getEditPerm()&&(void 0==singledet||!singledet.record.isAllowedEditFromNode))&&!this.ISBLUEPRINT)return ZP5Form.showErrMsg(ZPI18N.getString("zp.permdeniedtoedit")),!1}if(!this.PRINT){if(!this.isDraftrec&&!this.isRecordAdmin()&&!this.moduleHandler.isModuleAdmin()&&(this.isAddMode()&&0===this.FormOperations.getAddPerm()&&!this.FormOperations.isAdditonalPermAdd()||this.isEditMode()&&!ZP5Form.Record.isAllowEdit())){if(this.isEditMode())return ZP5Form.showFormError("",!1,void 0,this.getMode()),!1;formComp.isFieldEditable=!1}if((void 0===this.FormOperations.getFormComponentData(this.getFormsProperties().getFormId())&&!1!==formComp.isFieldEditable||this.isSingleFieldModal||this.ISBLUEPRINT||this.isRoleBasedPreview||this.isEmbedForm||"undefined"!=typeof SelfService&&SelfService.Info.ISFORM_COMPLOADED)&&(ZP5Form.formatFields(formComp,tableName,this.isSingleFieldModal,this.getSingleFieldModalFields()),this.FormOperations.setFormComponentData(formCompObj),"undefined"!=typeof SelfService&&this.getFormsProperties().getFormId()==ZPeople.EMP_FORMID&&(SelfService.Info.ISFORM_COMPLOADED=!1)),this.getFormsProperties().setFieldData(ZP5Form.populateFields(formComp)),(formComp.noField||!this.isViewMode()&&(!formComp.hasEditableField||!this.isRecordAdmin()&&!formComp.isFieldEditable))&&!this.moduleHandler.isFormEditable(formCompObj))return this.LAYOUT.find("#zp_form_createinfo").parent().addClass("zpl_DNI"),ZP5Form.showFormError(formCompObj.message,formComp.isFieldEditable,formComp.noField,this.getMode()),!1}if(this.isEditMode()){let recDtl=this.getRecordDetails().record,isDraft=recDtl.message.isDraft;if(!(ZPeople.onBoardingStatus||isDraft||(this.isPermitted(this.FormOperations.getEditPerm())||recDtl.isAllowedEditFromNode)&&ZP5Form.isApprovalStarted(this.getFormsProperties().getFormId(),this.getFormsProperties().getRecordId())||this.ISBLUEPRINT||ZP5Form.isApprover()||ZP5Form.isTaskOwnerCanEdit(this.getFormsProperties().getFormId())||this.isResubmit()||this.moduleHandler.isModuleAdmin()))return ZP5Form.isApprovalEnabled(this.getParams().formId)&&recDtl.message&&recDtl.message.approvalStatus==zpconst.ApprovalStatus.Cancelled?ZP5Form.showErrMsg(ZPI18N.getString("zp.cancelledRecordedit")):ZP5Form.isApprovalEnabled(this.getParams().formId)&&recDtl.message&&recDtl.message.approvalStatus==zpconst.ApprovalStatus.Revoked?ZP5Form.showErrMsg(ZPI18N.getString("zp.revokedRecordedit")):ZP5Form.isApprovalStarted(this.getFormsProperties().getFormId(),this.getFormsProperties().getRecordId())?ZP5Form.showErrMsg(ZPI18N.getString("zp.permissiondenied")):ZP5Form.showErrMsg(ZPI18N.getString("zp.approvedRecordedit")),!1;let isFieldEditable=!1;if(void 0!=recDtl.message.recordDetails&&(isFieldEditable=recDtl.message.recordDetails.some(sectionObj=>sectionObj.isGridType?ZP5Form.checkGridSectionFieldEditable(sectionObj):ZP5Form.checkSectionFieldEditable(sectionObj))),!isFieldEditable)return ZP5Form.showFormError("",isFieldEditable,void 0,this.getMode()),!1}let relField=this.getSingleFieldData(this.relfcid);return(this.isrelformrelfields||this.getParams().isFromSelfService)&&this.isAddMode()&&!this.isPrimLkpChange&&relField&&relField.isPrimary&&(this.primLkpVal=this.selValue,this.primLkpType=this.getPrimaryLookupType(this.primLkpVal)),!0}isHeaderSkipped(){return this.SKIP_HEADER||this.getIsFormForFieldLayout()}constructHeader(){if(this.isHeaderSkipped())return;var tableName=this.getTableName(),container=this.LAYOUT;let formHeaderDiv=container.find("#zp_form_header_name");if(this.moduleHandler.constructHeader(tableName,formHeaderDiv,container),this.moduleHandler.updateHeaderOptions(),this.isFormCustomPreview()){let roleHtml='<li onclick="ZP5Form.rolechange(this)" value="'+"-1"+'"><a><span>'+ZPI18N.getString("zp.admin")+"</span></a></li>";void 0!=this.getPermissionBasedRoleList()&&void 0!=this.getPermissionBasedRoleList().roleDetails&&$.each(this.getPermissionBasedRoleList().roleDetails,function(key,value){roleHtml+='<li onclick="ZP5Form.rolechange(this)" value="'+key+'"><a><span>'+value+"</span></a></li>"});let rolemenuHtml='<div id="rolemenu"><ul>'+roleHtml+"</ul></div>";if($("body").find("#rolemenu").length<=0)if($("body").append(rolemenuHtml),FormCustomNew.container.find("#rolepreviewbtn").off("click").on("click",function(ev){var target=$(ev.target);ZPeopleComponents.menu("#rolemenu").show({forElement:target})}),this.FormOperations.isAdmin()||this.isAdminRedirect)FormCustomNew.container.find("#rolepreviewbtn").text(ZPI18N.getString("zp.showingas")+" "+ZPI18N.getString("zp.admin"));else{var roleName=this.getPermissionBasedRoleList().roleDetails[ZPeople.CURR_USER.roleId];FormCustomNew.container.find("#rolepreviewbtn").text(ZPI18N.getString("zp.showingas")+" "+roleName)}FrameworkCommon.show(FormCustomNew.container.find("#previewformheader"))}if(this.isViewMode()||this.isEditMode()){let addDelRecHeaderBadge=(isAllowed,id)=>{(isAllowed=!this.getSingleFieldModal()&&isAllowed)?container.find("#"+id).removeClass("zpl_DNI"):container.find("#"+id).remove()},recDtl=this.getRecordDetails().record.message;addDelRecHeaderBadge(recDtl.isDraft||5==recDtl.approvalStatus,"edit_draft_class"),addDelRecHeaderBadge(this.getRecordDetails().record.message.isSampleData,"sample_data_badge")}}constructFooter(){if(this.isFooterSkip())return void(this.FOOTER=$("<div></div>"));this.LAYOUT,this.getTableName();let footer,formDetailsMap=this.FormOperations.getFormsDetailsMap();if(!this.getParams().modalPopupView){footer=this.isViewMode()&&ZP5Form.isApprovalEnabled(this.getParams().formId)&&!this.isDraftrec?FormsCommon.APPROVALFOOTER:ZP5Form.getFormClassObj().isEmbedForm?ZP5Form.EMBED_FOOTER:this.isFormCustomPreview()?ZP5Form.PREVIEW_FOOTER:ZP5Form.FOOTER,footer=$(footer),(this.isRoleBasedPreview||this.isPreviewForm())&&(footer.find("#zp_forms_addnew_btn").remove(),footer.find("#zp_forms_add_btn").remove(),footer.find("#zp_forms_savedraft_btn").remove());var isDraftAllowed=this.FormOperations.isDraftAllowed();(this.isAddMode()&&!isDraftAllowed||this.isEditMode()&&!this.FormOperations.isEditedDraftAllowed()&&!this.getRecordDetails().record.message.isDraft)&&footer.find("#zp_forms_savedraft_btn").remove()}if(footer.find("#zp_forms_add_btn").text(formDetailsMap.submitName),footer.find("#zp_forms_addnew_btn").text(formDetailsMap.submitNewName),this.isFooterCloseSkipped()&&footer.find('[name="closeBtn"]').remove(),this.moduleHandler.draftBtnNotNeed()&&footer.find("#zp_forms_savedraft_btn").addClass("zpl_DNI"),this.isViewMode())footer.find("#zp_forms_add_btn").addClass("zpl_DNI"),footer.find("#zp_forms_addnew_btn").addClass("zpl_DNI"),footer.find("#zp_forms_savedraft_btn").addClass("zpl_DNI"),footer.find("#zp_form_cancel_close_btn").html(ZPI18N.getString("zp.close"));else{if(footer.find("#zp_form_cancel_close_btn").text(formDetailsMap.cancelName),footer.find("#zp_forms_add_btn").removeClass("zpl_DNI"),footer.find("#zp_forms_addnew_btn").removeClass("zpl_DNI"),this.isAddMode())isWebForm&&(footer.find("#zp_forms_addnew_btn").remove(),footer.find("#zp_forms_savedraft_btn").remove()),!this.isQuickAdd&&this.FormOperations.isDraftAllowed()&&footer.find("#zp_forms_savedraft_btn").removeClass("zpl_DNI");else if(this.isEditMode()){footer.find("#zp_forms_addnew_btn").addClass("zpl_DNI");var recordDtl=this.getRecordDetails(),currentStatus=recordDtl.record.message.approvalStatus;this.getSingleFieldModal()&&recordDtl.record.message.isDraft?(footer.find("#zp_forms_savedraft_btn").removeClass("zpl_DNI"),footer.find("#zp_forms_add_btn").remove()):footer.find("#zp_forms_savedraft_btn").addClass("zpl_DNI"),(this.FormOperations.isEditedDraftAllowed()&&(-2==currentStatus||-3==currentStatus||5==currentStatus)||this.FormOperations.isDraftAllowed()&&recordDtl.record.message.isDraft)&&(footer.find("#zp_forms_savedraft_btn").removeClass("zpl_DNI"),footer.find("#edit_draft_class").removeClass("zpl_DNI"))}formDetailsMap.showSubmitNew&&!this.moduleHandler.submitNewBtnNotNeed()||footer.find("#zp_forms_addnew_btn").addClass("zpl_DNI"),(this.isQuickAdd||this.isrelformrelfields)&&(footer.find("#zp_forms_addnew_btn").remove(),this.isfromrelTabs||footer.find("#zp_forms_savedraft_btn").addClass("zpl_DNI"))}this.isFormCustomPreview()?(this.FOOTER=FormCustomNew.container.find("#fullModFooter").html(footer),0!=this.FormOperations.getPaginationType()&&FrameworkCommon.show(this.FOOTER)):(this.FOOTER=this.LAYOUT.find("#formfooter").html(footer),this.FOOTER.removeClass("zpl_DNI")),this.isViewMode()||(this.LAYOUT.find("#zp_forms_add_btn").on("click",()=>{this.submitBtn()}),this.LAYOUT.find("#zp_forms_addnew_btn").on("click",()=>{this.submitAndNewBtn()}),this.LAYOUT.find("#zp_forms_savedraft_btn").on("click",()=>{this.submitAsDraftBtn()})),this.FOOTER.find('[name="closeBtn"]').off("click").on("click",ele=>{this.closeBtn(!0)})}submitBtn(){this.IS_SUBMITNEW=!1,this.isDraft=!1,this.validateAndSubmit()}submitAndNewBtn(){this.IS_SUBMITNEW=!0,this.isDraft=!1,this.validateAndSubmit()}submitAsDraftBtn(){this.IS_SUBMITNEW=!1,this.isDraft=!0,this.validateAndSubmit()}closeBtn(isValidationNeeded){this.close(isValidationNeeded)}processPostFormConstruction(){0!=this.FormOperations.getPaginationType()&&ZP5Form.showSection(this.LAYOUT),OPApprovals.Forms.isAllowEmployeeToChooseApprover(this)&&OPApprovals.Forms.constructChooseApproverCard(this.LAYOUT),this.callCallbackFunction(this.getParams().onloadCallback),this.callCallbackFunction(this.moduleHandler.onloadCallback()),this.toggleCommonActions(),this.moduleHandler.preprocessPostFormConstruction(),this.isAddMode()&&(ZPFRulesNew.Evaluation.LAYOUT=this.LAYOUT,ZPFRulesNew.Evaluation.isViewMode=!1,ZPFRulesNew.Evaluation.evaluateRulesForAllFields(this.isQuickAdd)),ZP5Form.isFromSubmit,ZP5Form.formulaConstruction(this.getFormsProperties().getFormId());let tableName=this.getTableName();if(this.isEditMode()||this.isAddMode()){let mode=this.getMode();this.FIELD_LAYOUT.find('[id^="zp_field_outer_"]').off("change.fieldvalue").on("change.fieldvalue",e=>{this.fieldValueChangeFunc(e)}),this.isAddMode()&&(this.primLkpVal=null,this.FormOperations.isAdmin()&&!this.FormOperations.isOperationalRoleAdmin()||ZPUtil.checkIsExistInArray(ZP5Form.primLkpChangeRestrictedForms,tableName)||(this.primLkpId=this.FormOperations.getPrimaryLookupId(),null!=this.primLkpId&&this.FIELD_LAYOUT.find(":input").on("change",event=>{if(ZP5Form.Field.getFieldComponent(this.primLkpId).labelName!=$(event.target).attr("name"))this.fieldValueChanged=!0;else if(!this.fieldValueChanged){let self=this;new Promise(resolve=>{resolve()}).then(()=>{self.handlePrimaryLookupChange($(event.target).val(),mode)})}})),this.getLookupOptionsBasedOnDependentFields()),this.LAYOUT.find("form").on("keyup keypress",function(event){13===event.keyCode&&"TEXTAREA"!==event.target.nodeName&&event.preventDefault()}),this.LAYOUT.find('[istabular="true"]').find("table.Vlis").addClass("edit"),this.FIELD_LAYOUT.find('[name="fileuploadelem"]').on("click",function(event){ZP5Form.onDesktopUpload(event)}),this.FIELD_LAYOUT.find('[istabadd="true"]').on("click",event=>{this.addTabularSectionRow($(event.target).attr("sectionid"))}),this.registerFieldChangeFun();let needFocusEle=this.FIELD_LAYOUT.find("#bodyparent").find("select:not(.zpl_DNI),input:not(.zpl_DNI),textarea:not(.zpl_DNI)").first();if(needFocusEle.length)if(ZPeopleComponents.isComponent(needFocusEle)){if(needFocusEle.attr("zcomponentname")){let zComponent=ZPeopleComponents[needFocusEle.attr("zcomponentname")](needFocusEle);zComponent.setFocus&&zComponent.setFocus(),zComponent.focus&&zComponent.focus()}}else needFocusEle.is(":visible")?needFocusEle.focus():needFocusEle.closest("div[id^='zp_field_outer_']").is("[fieldtype=37]")&&needFocusEle.siblings().first().focus()}else if(this.isViewMode()){var editOpt=this.LAYOUT.find("#zp_form_editin_singlerec");ZPeopleComponents.collapsiblepanels("#relatedformcolp",{beforepanelexpand:event=>{ZP5Form.RelatedForms.constructRelatedFormContent(event.target,this.getFormsProperties().getFormId(),this.getFormsProperties().getRecordId())},className:"custom-theme-class",collapseIconLabel:ZPI18N.getString("zp.show"),expandIconLabel:ZPI18N.getString("zp.hide")});let widgetDetails=this.FormOperations.getFormComponentData().message.widgetDetails;if(!isWebForm&&widgetDetails&&ZPWidget.renderFormsWidget(widgetDetails),this.isEditIconAllowedInHeader()&&!this.getRecordDetails().record.skipEdit){if(editOpt.removeClass("zpl_DNI"),editOpt.show(),null!=this.FormOperations.getFormsDetailsMap()&&void 0!=this.FormOperations.getFormsDetailsMap().dataChangeForms&&this.FormOperations.getFormsDetailsMap().dataChangeForms.length>0&&this.LAYOUT.find("#zp_form_header .ssp-profrht .zp-recdrop").length>0&&transfers.addToRecordSelectionActions(this.LAYOUT.find("#zp_form_header .ssp-profrht .zp-recdrop"),"btn btn-primary ML5 MT3",this.FormOperations.getFormsDetailsMap().dataChangeForms,!0,!1),!this.getParams().skipEditCallback){editOpt.off("click");let formObj=this;editOpt.on("click",function(){formObj.moduleHandler.getEditCallback()})}}else editOpt.addClass("zpl_DNI").off("click");"P_Employee"==tableName&&void 0!==ZP5Form.addedIsZohoUser&&null!==ZP5Form.addedIsZohoUser&&(ZPeople.confirm(null,"","zp.existingzohouser","",!0,!1),$("#textConfirmationPopupBody").addClass("dvExecutescript"),$("#textConfirmationPopupBody").append('<div class=dvinfo id="emailInfo">'),$("#emailInfo").append('<p class="text-left">'+ZP5Form.addedIsZohoUser+"</p>"),$("#textConfirmationPopupBody").append("</div>"),$("#confirmationPopup").modal()),ZP5Form.addedIsZohoUser=null,this.getParams().isProfile&&"function"==typeof this.getParams().onloadProfileCallback&&this.getParams().onloadProfileCallback();let cAuditInfo=this.getRecordDetails().record.message.cAuditInfo;!this.PRINT&&void 0!=cAuditInfo&&Object.keys(cAuditInfo).length>0&&(cAuditInfo.AddedBy||cAuditInfo.AddedTime||cAuditInfo.ModifiedBy||cAuditInfo.ModifiedTime)?ZP5Form.Layout.constructShowTimeInfo(this.LAYOUT,this.formLayoutKey,cAuditInfo):this.LAYOUT.find("#zp_form_createinfo").addClass("zpl_DNI")}if(this.isViewMode()||this.isEditMode()){this.processViewEditRecordDetails();var container_check=this.FIELD_LAYOUT;let formsClassObj=this;container_check.find("[isallowed=false]").each(function(){for(var nexts=$(this).next();0!=nexts.length&&void 0!=nexts.attr("id")&&nexts.attr("id").startsWith("zp_form_relfield_");){let temp=nexts.next();nexts.remove(),nexts=temp}let zcomponentNameObj=$(this).find("[zcomponentname]");void 0!=zcomponentNameObj&&$(zcomponentNameObj).length>0&&formsClassObj.destroyZComponents($(zcomponentNameObj)),$(this).remove()});var secs=container_check.find("[id^='zp_section_fields']");$.each(secs,function(){var isgrid="true"==$(this).attr("isgrid");if(isgrid&&0==$(this).find("td").length||!isgrid&&0==$(this).find("[isallowed=true]").length){let sectionLayoutId="#zp_form_section_list #zp_form_section_"+$(this).attr("id").match(/[\d]+$/).toString(),isActiveSection=container_check.find(sectionLayoutId).hasClass("zpl_act");container_check.find(sectionLayoutId).remove(),isActiveSection&&formsClassObj.selectDefaultSection(),$(this).parent().remove()}});secs=this.FIELD_LAYOUT.find("[issec=true]");$.each(secs,function(){var eles=$(this).next();(0==eles.length||"true"==eles.attr("issec")||eles.is("input")||"true"==eles.attr("relformhead"))&&$(this).remove()})}this.FOOTER.find("button").is(":visible")||this.FOOTER.empty(),this.getInfoToolTipObj().constructTooltips(),this.callCallbackFunction(this.getParams().postFormConstructionCallback),this.moduleHandler.postFormConstructionModuleHandler(),this.PRINT||(this.isViewMode()&&ZP5Form.getFieldLayout().find("[mask^=hdr_]").each(function(){"true"==$(this).attr("masked")?$(this).parent().siblings("[elem=sorticn]").addClass("zpl_DNI"):$(this).parent().siblings("[elem=sorticn]").removeClass("zpl_DNI")}),this.isFormMasked()||(this.setFormMasked(!0),ZP5Form.formDataMask()))}isEditIconAllowedInHeader(){return this.getRecordDetails().record.message.isDraft||this.moduleHandler.isEditOptionAllowed()&&((this.isPermitted(this.FormOperations.getEditPerm())||ZP5Form.isApprover()||this.moduleHandler.isModuleAdmin({forview:!0,type:"edit"})||this.getRecordDetails().record.isAllowedEditFromNode)&&ZP5Form.isApprovalStarted(this.getFormsProperties().getFormId(),this.getFormsProperties().getRecordId())||ZP5Form.isTaskOwnerCanEdit(this.getFormsProperties().getFormId()))}selectDefaultSection(){this.LAYOUT.find("#zp_form_section_list").find("li:first").click()}toggleCommonActions(){var formPageType=this.FormOperations.getPaginationType();this.getTableName();if(this.ISBLUEPRINT)return;let container=this.LAYOUT;1===formPageType?(container.find("#zp_form_section_list").children().length>1&&this.FOOTER.find("#zp_forms_prev_btn, #zp_forms_next_btn").removeClass("zpl_DNI"),container.find("#zp_form_section_list").find("li").off("click").on("click",function(){ZP5Form.toggleSection(this)}),void 0!=ZP5Form.lastActiveSec&&""!=ZP5Form.lastActiveSec&&0!==container.find("#zp_form_section_"+ZP5Form.lastActiveSec).length?$("#zp_form_section_"+ZP5Form.lastActiveSec).trigger("click"):(container.find("#zp_form_section_list").find("li:first").addClass("zpl_act"),this.FOOTER.find("#zp_forms_prev_btn").addClass("zpl_DNI")),ZP5Form.lastActiveSec=void 0,this.FOOTER.find("#zp_forms_prev_btn, #zp_forms_next_btn").off("click").on("click",function(){ZP5Form.prevNextSection(this)})):this.FOOTER.find("#zp_forms_prev_btn, #zp_forms_next_btn").addClass("zpl_DNI")}registerFieldChangeFun(fieldHtml,isTabular){void 0===fieldHtml&&(fieldHtml=this.FIELD_LAYOUT);var callBackObj=this.getParams().fieldCallback;if(callBackObj=void 0==callBackObj?{}:callBackObj,void 0!==(callBackObj=Object.assign(callBackObj,this.moduleHandler.getFieldCallback())))for(var labelName in callBackObj)void 0!==callBackObj[labelName]&&"function"==typeof callBackObj[labelName]&&fieldHtml.find(":input[name='"+labelName+"']").on("change",function(){callBackObj[$(this).attr("name")]($(this).val(),$(this).attr("name"),this)});this.getTableName();if(this.isAddMode()||this.isEditMode()||this.isViewMode()){fieldHtml.find(":input[type=file]").length>0&&(0===this.LAYOUT.find("[name=zp_form_fileupload]").length&&(this.LAYOUT.append($('<form enctype="multipart/form-data" method="post" style="display: none;" name="zp_form_fileupload"></form>')),this.LAYOUT.find("[name=zp_form_fileupload]").on("submit",event=>{event.preventDefault();var data=new FormData(event.target);$.ajax({type:"POST",enctype:"multipart/form-data",url:this.isEmbedForm&&!isAuthreq?"embedfileUploadAction.hr":"/fileUploadAction.zp",data:data,processData:!1,contentType:!1,cache:!1,success:function(json){ZP5Form.Record.uploadFilesResponse(json)},error:function(error){let formClassObj=ZP5Form.getFormClassObj(),isSingleEdit=formClassObj.isSingleFiledEdit(),revertEdit=()=>{isSingleEdit?formClassObj.revertSingleEdit({}):formClassObj.resetAddUpdateRecordProcess()};if(void 0!=error&&void 0!=error.responseJSON&&void 0!=error.responseJSON.code){let showError=message=>{void 0!=error.responseJSON.paramName&&isSingleEdit?ZP5Form.Record.uploadFilesResponse({fieldName:error.responseJSON.paramName,message:message}):(ZPeople.Message.failure(message),revertEdit())};switch(error.responseJSON.code){case"PATTERN_NOT_MATCHED":showError(ZPI18N.getString("zp.projectattachmentnameerror"));break;case"MORE_THAN_MAX_LENGTH":showError(ZPI18N.getString("zp.files.invalidfilename"));break;default:showError(ZPI18N.getString("zp.fileuploaderror"))}}else ZPeople.Message.failure(ZPI18N.getString("zp.fileuploaderror")),revertEdit()}})})),isTabular?fieldHtml.find('[name="fileuploadelem"]').on("click",function(event){ZP5Form.onDesktopUpload(event)}):this.LAYOUT.find("[name=zp_form_fileupload]").empty());let container=this.LAYOUT,fieldContainer=this.FIELD_LAYOUT;fieldHtml.find(":input[type=file]").on("change",function(){var{fileName:fileName,originalFileName:originalFileName}=ZPUtil.newUifileFieldChange(this);if(null==fileName)$(this).siblings("#filename").val("");else{var file=this.files[0],labelName=$(this).attr("name"),fieldId=$(this).attr("id"),fcId=fieldId.substring(fieldId.lastIndexOf("_")+1),formC=ZP5Form.Field.getFieldComponent(fcId),fieldType=parseInt($(this).attr("fieldtype")),rowNum=$(this).closest('[id="zp_tabular_row"]').attr("row"),isRestore=$(this).closest("[folabel="+labelName+"]").find("[id=zp_form_fileuploadfield]").length>0,isPreviewForm=ZP5Form.getFormClassObj().isPreviewForm();if(fieldContainer.find("[folabel="+labelName+"]").find(".zpl_fldrp.ztextbox__error").removeClass("ztextbox__error"),$(this).closest("[folabel="+labelName+"]").find('[id="error_message"]').remove(),$(this).closest(".zp-err").removeClass("zp-err"),void 0==rowNum&&(!1,rowNum=$(this).closest('[istabular="true"][isgrid="false"]').attr("row")),file.size>formC.maxSizeBytes||file.size<=0){var errors={};file.size>formC.maxSizeBytes?errors[labelName]=ZPI18N.getString("zp.maxuploadfilesize",[formC.maxSize]):file.size<=0&&(errors[labelName]=ZPI18N.getString("zp.zerofilesize")),errors.row=rowNum,fieldContainer.find("[elem=fileuploadinput").val(""),ZP5Form.Field.markFieldAsError(labelName,errors,fieldContainer)}else if(fieldType!==FormConstants.FieldType.IMAGE||ZP5Form.FILEUPLOAD_IMAGES.isAllowedFormatForImage(file.name)){if($(this).after($(this).clone(!0)),$(this).hide(),0===$(this).siblings("#filename").length){var inpEle=$('<input type="hidden" value="" id="filename"/>');$(this).after(inpEle)}var fileExtn;$(this).siblings("#filename").val(originalFileName),this.iscancelmsgact=!0;var rowNumber,fileConsHtml="";rowNumber=void 0==rowNum?1:rowNum;var i=0,isProgress=!1;for(i=0;i<fileName.length;i++){if(fileExtn="",-1!=originalFileName[i].lastIndexOf(".")&&(fileExtn=(fileExtn=originalFileName[i].substr(originalFileName[i].lastIndexOf(".")+1,originalFileName[i].length)).toLowerCase()),isRestore)$(this).closest("[folabel="+labelName+"]").find("[id=zp_form_fileuploadfield]").find("[isrestore=true]").addClass("DNI");UDS_UPLOAD_IS_ACTIVE&&!isPreviewForm&&($(this).closest("[folabel="+labelName+"]").find("#afterUpload").removeClass("zpmulti-fl"),isProgress=!0),fileConsHtml+=ZP5Form.getFormClassObj().constructFileEditHtml({originalFileName:originalFileName[i],fileName:ZSEC.Encoder.encodeForHTML(fileName[i]),labelName:labelName,fileExtn:fileExtn,fcId:fcId,rowNumber:rowNumber,isProgress:isProgress},isRestore,file.size)}$(this).closest("[folabel="+labelName+"]").find("#afterUpload").html(fileConsHtml),$(this).closest("[folabel="+labelName+"]").find("#beforeUpload,#afterUpload").toggleClass("DNI"),$(this).closest("[folabel="+labelName+"]").find("p[elem=pre-info]").addClass("DNI"),this.setAttribute("row",rowNumber),ZP5Form.Field.removeFileUploadDoc(labelName,rowNum);var formObj=container.find("[name=zp_form_fileupload]");$(this).appendTo(formObj),UDS_UPLOAD_IS_ACTIVE&&!isPreviewForm&&progressJs("div[data-progressjs='"+fcId+rowNumber+"']").autoIncrease(8,10)}else{(errors={})[labelName]=ZPI18N.getString("zp.allowedimagetypes"),errors.row=rowNum,fieldContainer.find("[elem=fileuploadinput").val(""),ZP5Form.Field.markFieldAsError(labelName,errors,fieldContainer)}}}),$.each(fieldHtml.find(":input[type=file]"),function(idx,fileUploadField){FrameworkCommon.initDragDropFiles(fileUploadField.closest("#beforeUpload"),fileUploadField.closest("[id^='zp_field_outer_']"),droppedFile=>{let fileField=ZP5Form.getFieldLayout().find("#"+$(fileUploadField).attr("id"));var dataTransfer=new DataTransfer;dataTransfer.items.add(droppedFile[0]),fileField[0].files=dataTransfer.files,fileField.trigger("change")},1)})}$.each(fieldHtml.find("textarea[autoresize]"),function(){var resizeTextarea=function(el){var height=fieldHtml.find(el).css("height");height=parseInt(height.substring(0,height.length-2)),el.scrollHeight>height&&fieldHtml.find(el).css("height",el.scrollHeight)};fieldHtml.find(this).on("keyup input",function(){resizeTextarea(this)}).removeAttr("autoresize"),fieldHtml.find(this).on("focus input",function(){resizeTextarea(this)})}),fieldHtml.find(":input[isTimeField='true']").on("click",function(){var fcid=$(this).attr("fcid"),props=ZP5Form.time_Field_Prop[fcid];props.callback="ZP5Form.setTime(this)",TimePicker.init(this,props)}),fieldHtml.find(":input[isTimeField='true']").on("blur",function(){var fcid=$(this).attr("fcid"),props=ZP5Form.time_Field_Prop[fcid];TimePicker.setTime(this,props)}),fieldHtml.find(".select2-container").each(function(){var title=$(this).siblings("select").attr("title");inputele=$(this).siblings("input[fieldtype='26']"),1==inputele.length&&(title=$(inputele).attr("title")),ZPUtil.Validation.isEmpty(title)||$(this).parent().attr("title",title)}),fieldHtml.on("mouseenter","[istabular=true]",function(){$(this).find("#zp_form_deletetabular_row").removeClass("DNI")}),fieldHtml.on("mouseleave","[istabular=true]",function(){$(this).find("#zp_form_deletetabular_row").addClass("DNI")}),fieldHtml.on("mouseenter","[id=zp_tabular_row]",function(){$(this).find("#zp_form_deletetabular_row").removeClass("DNI")}),fieldHtml.on("mouseleave","[id=zp_tabular_row]",function(){$(this).find("#zp_form_deletetabular_row").addClass("DNI")}),fieldHtml.find("[id='zp_form_deletetabular_row']").on("click",event=>{this.removeTabularRow(event.currentTarget)}),fieldHtml.find('[addopt="enabled"]').on("click",function(){var fcId=$(this).attr("fcid");ZP5Form.QuickAdd.showQuickAddOption(fcId)}),fieldHtml.find('input[fieldtype="'+FormConstants.FieldType.MYNUMBER+'"]').on("input",function(){let formattedValue=$(this).val().replace(/\D/g,"").substring(0,12).replace(/(\d{4})(?=\d)/g,"$1-");$(this).val(formattedValue)}),this.registerLookupFieldFunc()}fieldValueChangeFunc(event){this.iscancelmsgact=!0;let targetElem=event.target;if((this.isEditMode()||this.isAddMode())&&void 0!=targetElem){var fieldType=parseInt(targetElem.getAttribute("fieldtype"));if(FormConstants.FORMULA_SUPPORTED_FIELDS.includes(parseInt(fieldType))){var fcId=targetElem.getAttribute("id"),rowNum="1";void 0!=targetElem.closest("[istabular]")&&"true"==targetElem.closest("[istabular]").getAttribute("istabular")&&(rowNum="true"==targetElem.closest("div[isgrid]").getAttribute("isgrid")?targetElem.closest('[id="zp_tabular_row"]').getAttribute("row"):targetElem.closest('[isgrid="false"]').getAttribute("row")),fcId=fcId.substr(fcId.lastIndexOf("_")+1),ZP5Form.formulaRevaluateOnsingleEdit(void 0,fcId,rowNum)}}else this.isSingleFiledEdit()&&void 0!=targetElem&&parseInt(targetElem.getAttribute("fieldtype"))==FormConstants.FieldType.PICKLIST&&ZP5Form.formulaRevaluateOnsingleEdit();this.moduleHandler.fieldValueChangeFunc(targetElem)}close(isValidationNeeded){if(isValidationNeeded&&!this.isPreviewForm()&&this.iscancelmsgact&&!this.isViewMode()&&"P_EmployeeLeave"!=this.getTableName()){let alertMessageObj=new InfoAlertMessage(ZPI18N.getString("zp.confirm"),ZPI18N.getString("zp.cancelconfmsg"));return alertMessageObj.cancelButtonText=ZPI18N.getString("zp.no"),alertMessageObj.setCallback(()=>{this.closeCallback(this)}),void alertMessageObj.show()}this.closeCallback(this)}closeCallback(formsClassObj){formsClassObj.LAYOUT.removeClass("zpl_mopen");let lastPageMode=formsClassObj.getMode(),isDisableUrlTrack=formsClassObj.isDisableUrlTrack(),isRecordRefreshNeed=!formsClassObj.isAddMode()&&(formsClassObj.IS_SUBMIT||formsClassObj.RECORD_DETAILS&&formsClassObj.RECORD_DETAILS.refresh),isRelatedFormRefreshNeed=formsClassObj.refreshRelatedForm&&(formsClassObj.isrelfieldsingelrecview||formsClassObj.isrelformrelfields),relfcid="",refreshRelatedForm="";isRelatedFormRefreshNeed&&(relfcid=formsClassObj.relfcid,refreshRelatedForm=formsClassObj.refreshRelatedForm);let isQuickAdd=formsClassObj.isQuickAdd,isrelformrelfields=formsClassObj.isrelformrelfields,isFromrelTabs=formsClassObj.isfromrelTabs,isrelfieldsingelrecview=formsClassObj.isrelfieldsingelrecview,isfromrelfieldedit=formsClassObj.isfromrelfieldedit,isSingleFieldEdit=formsClassObj.getSingleFieldEditFcid();if(isQuickAdd||isrelformrelfields||isrelfieldsingelrecview||isfromrelfieldedit||formsClassObj.isSingleFieldModal||formsClassObj.isEmbedForm)formsClassObj.layoutRevertChanges(formsClassObj);else{let params=formsClassObj.getParams();void 0!==params.modalCloseCallback&&"function"==typeof params.modalCloseCallback&&("closePopCallback"===params.modalCloseCallback.name?params.modalCloseCallback(ZPApprovals.SUCCESS_PKID):params.modalCloseCallback());let niceUrl=void 0==this.moduleHandler?null:this.moduleHandler.close();formsClassObj.layoutRevertChanges(formsClassObj),isDisableUrlTrack||null!=niceUrl&&(window.location.href="#"+niceUrl),Layout.Page.container.find("#tt_hours_summary").length>0&&Layout.Page.container.find("#tt_hours_summary").removeClass("DN")}let parentFormObj=ZP5Form.getFormClassObj();isFromrelTabs?(isRelatedFormRefreshNeed&&ZP5Form.RelatedForms.constructRelatedFormContent(formsClassObj.relatedTabDet.container.find("#zp_dash_rfdata_"+relfcid),formsClassObj.relatedTabDet.relformId,formsClassObj.relatedTabDet.relRecordId,refreshRelatedForm,!0),parentFormObj&&(isRecordRefreshNeed&&(parentFormObj.RECORD_DETAILS.refresh=!0),parentFormObj.moduleHandler.activeStateNotify(lastPageMode))):(isDisableUrlTrack||isQuickAdd||isrelformrelfields||isrelfieldsingelrecview||isfromrelfieldedit||isSingleFieldEdit)&&parentFormObj&&(isRecordRefreshNeed&&(parentFormObj.RECORD_DETAILS.refresh=!0),isRelatedFormRefreshNeed&&ZP5Form.RelatedForms.constructRelatedFormContent(parentFormObj.FIELD_LAYOUT.find("#zp_dash_rfdata_"+relfcid),parentFormObj.getFormsProperties().getFormId(),parentFormObj.getFormsProperties().getRecordId(),refreshRelatedForm),parentFormObj.moduleHandler.activeStateNotify(lastPageMode))}layoutRevertChanges(formsClassObj){formsClassObj.destroyComponents(formsClassObj),ZP5Form.removeFormClassObj(formsClassObj),void 0!=formsClassObj.getBaseFormDOMId()&&(ZP5Form.ACTIVE_FORM_KEY=formsClassObj.getBaseFormDOMId(),ZP5Form.ACTIVE_FORM_KEY=="zp_profile_record_"+ZPeople.EMP_FORMID&&(ZP5Form.IS_PROFILE_PAGE_LOADED=!0)),formsClassObj.LAYOUT.remove(),void 0==ZP5Form.getFormClassObj()?(ZP5Form.CURR_FORM_OPERATION=null,ZP5Form.ACTIVE_FORM_KEY=void 0,ZPFRulesNew.Evaluation.LAYOUT=null,ZP5Form.IS_PROFILE_PAGE_LOADED=!1):(ZP5Form.CURR_FORM_OPERATION=ZP5Form.getFormClassObj().FormOperations,ZP5Form.CURR_FORM_OPERATION.setFormClassObj(ZP5Form.getFormClassObj()),ZPFRulesNew.Evaluation.LAYOUT=ZP5Form.getLayout()),void 0!=ZP5Form.getFormClassObj()&&formsClassObj.getFormsProperties().getFormId()!=ZP5Form.getFormClassObj().getFormsProperties().getFormId()&&delete ZP5Form.CURR_FORM_OPERATIONS[formsClassObj.getFormsProperties().getFormId()],formsClassObj=null}_loadingpage(){this.isFormCustomPreview()?this.LAYOUT.html(ZPeople.LOADING_HTML):this.LAYOUT.find("#zp_form_outer_container").html(ZPeople.LOADING_HTML)}constructFields(formComp){(this.isViewMode()||this.isEditMode())&&this.getRecordDetails().record.message.recordDetails;let formPageType=this.PRINT?0:this.FormOperations.getPaginationType(),tableName=this.getTableName(),fieldHtml="<div class='zpl_mmnu'><div class='zpl_mmnurgt' id='bodyparent'><div class='zpl_act'><div class='zpl_iwrpr' id='mulpageseparator'><div class='zpl_iwrprrgt zpl_crdwthful' id='zp_form_body'>";if(0==formPageType&&(fieldHtml+='<div class="zpl_act"><div class="zpl_rgtcnt" id="sectionsparent">'),this.PRINT)fieldHtml='<div class="zpl_mprintcont" id="bodyparent"><div class="zpl_rgtcnt" id="sectionsparent">';else{var{fieldHtmlStart:fieldHtmlStart,fieldHtmlend:fieldHtmlend,fieldHtmlInit:fieldHtmlInit}=this.moduleHandler.fieldContainerOuterHtml();fieldHtmlInit?fieldHtml=fieldHtmlStart:fieldHtml+=fieldHtmlStart}let multipagelayoutsechtml="<div class='zpl_iwrprlft'><ul id='zp_form_section_list'>",formComponentDetails=formComp.formComponentDetails;for(let index in formComponentDetails){let sectionObj=formComponentDetails[index];if(this.isTabularsecForQuicAdd=!1,!this.isSectionFieldAllowForConstruction("Section",sectionObj))continue;sectionObj.isTabular&&(this.isTabularsecForQuicAdd=!0);let isTabFldAddable=!1;if(!this.isViewMode()&&sectionObj.isTabular&&this.isPermitted(sectionObj.addPermVal,sectionObj.addPermObj,sectionObj.addPermObj)){let formClassObj=this;$.each(sectionObj.column1,function(index){if(formClassObj.isPermitted(this.editperm,this.allowedRoleIdsForEdit,this.allowedRoleIdsForView))return isTabFldAddable=!0,!1}),isTabFldAddable||sectionObj.isGridType||$.each(sectionObj.column2,function(index){if(formClassObj.isPermitted(this.editperm,this.allowedRoleIdsForEdit,this.allowedRoleIdsForView))return isTabFldAddable=!0,!1})}var sectionsHtml='<div class="zpl_crd '+(this.PRINT&&sectionObj.isTabular&&sectionObj.isGridType?"zpl_frmprinttbl ":"")+("P_EmployeeLeave"==tableName?"wd100_per":"")+'">';let secHeaderHtml="",secBodyHtml="";if(0!=formPageType){sectionsHtml="<div class='' id='zp_section_field_top_"+sectionObj.sectionId+"'><div class='zpl_rgtcnt'>";var sectionName=sectionObj.sectionName;multipagelayoutsechtml+='<li id="zp_form_section_'+sectionObj.sectionId+'" secid="'+sectionObj.sectionId+'" class="" '+ComponentsCommon.getTooltipHtml(sectionObj.sectionName,{position:"auto"},!0)+"><a>"+sectionName+"</a></li>",sectionsHtml+='<div class="zpl_crd">',!this.isViewMode()&&isTabFldAddable&&sectionObj.isTabular&&(sectionsHtml+='<div class="zpl_crdhdr"><div></div><span class="zpl_idiv"><a class="zpl_lnkbg MLauto" istabadd="true" sectionId='+sectionObj.sectionId+'><i class="IC-add"></i>'+ZPI18N.getString("zp.addrow")+"</a></span></div>")}else this.moduleHandler.showSectionHeader(sectionObj,sectionsHtml)&&(secHeaderHtml+='<div class="zpl_crdhdr"><div><h4 elem="secTitle"><span>'+sectionObj.sectionName+"</span></h4></div>",!this.isViewMode()&&isTabFldAddable&&sectionObj.isTabular&&(secHeaderHtml+='<span class="zpl_idiv"><a class="zpl_lnkbg MLauto" istabadd="true"  sectionId='+sectionObj.sectionId+'><i class="IC-add"></i>'+ZPI18N.getString("zp.addrow")+"</a></span>"),secHeaderHtml+="</div>");sectionObj.isTabular&&!sectionObj.isGridType?secBodyHtml+='<div class="zpl_crdcnt" id="zp_section_fields_parent_'+sectionObj.sectionId+'">':secBodyHtml+='<div class="zpl_crdcnt" id="zp_section_fields_'+sectionObj.sectionId+'" secid="'+sectionObj.sectionId+'" '+(sectionObj.isGridType?"":'row="1"')+' isTabular="'+sectionObj.isTabular+'" isgrid="'+sectionObj.isGridType+'">';let recordviewcls="zpl_frmclm zpl_frmclmview";if(this.isViewMode()||(recordviewcls=this.ISHRPROCESS?"zpl_frmclm":"zpl_frmclm zpl_frmclmlst",sectionObj.isTabular&&!sectionObj.isGridType&&(recordviewcls+=" zpl_frmtblinln")),sectionObj.isGridType){if(this.isAddMode()){let tabularsecAddHtmlObj='<div class="zpl_secn"><div class="zpl_tblovh"><div class="zpl_tblres"><table class="zpl_tbl zpl_tabularfxd zpl_tblvtop zpl_nocrsor">';tabularsecAddHtmlObj+=this.getTabularGridHeaders(sectionObj.column1),tabularsecAddHtmlObj+='<tbody id="zp_forms_tabluar_'+sectionObj.sectionId+'" >'+this.getFieldFormat(sectionObj.column1,sectionObj.isGridType,sectionObj.sectionId)+"</tbody>",secBodyHtml+=tabularsecAddHtmlObj+="</table></div></div></div>"}}else{if(sectionObj.isTabular?secBodyHtml+='<div name="sections_obj" class="'+recordviewcls+'" id="zp_section_fields_'+sectionObj.sectionId+'" secid="'+sectionObj.sectionId+'" row="1" isTabular="true" isgrid="false">':secBodyHtml+='<div name="sections_obj" class="'+recordviewcls+'">',!sectionObj.isTabular||this.isAddMode()){let children1=this.getFieldFormat(sectionObj.column1),children2=this.getFieldFormat(sectionObj.column2),fieldColHtml=this.appendColumns(children1,children2);sectionObj.isTabular&&(fieldColHtml+='<span class="zpl_hvr"><i class="PI_delete DNI" id="zp_form_deletetabular_row" secid="'+sectionObj.sectionId+'"></i></span>'),secBodyHtml+=fieldColHtml}secBodyHtml+="</div>"}sectionsHtml+=secHeaderHtml+(secBodyHtml+="</div>"),sectionsHtml+="</div>",0!=formPageType&&(sectionsHtml+="</div></div>"),fieldHtml+=sectionsHtml}this.PRINT?fieldHtml+="</div></div>":(fieldHtml+=fieldHtmlend,fieldHtmlInit||(0==formPageType&&(fieldHtml+="</div></div>"),fieldHtml+="</div></div></div></div><div>")),this.FIELD_LAYOUT=$(fieldHtml),void 0!==this.getFormsProperties().getTempFormComponent()&&this.setTempFormComponent(void 0),this.isTabularsecForQuicAdd=!1,this.multipagelayoutsechtml=multipagelayoutsechtml,this.multipagelayoutsechtml+="</ul></div>",0!=formPageType&&this.FIELD_LAYOUT.find("#mulpageseparator").prepend(this.multipagelayoutsechtml),this.isRelatedFormNotNeeded||this.constructRelatedForm(formComp),this.isViewMode()&&!isWebForm&&formComp.widgetDetails&&ZPWidget.constructFormsWidgetDiv(formComp.widgetDetails);let formId=this.getFormsProperties().getFormId(),recordId=this.getFormsProperties().getRecordId();if(this.isAddMode()||this.isEditMode()){let inputfieldHtml='<input type="hidden" value="'+tableName+'" name="zp_tableName"/>';isAuthreq&&(inputfieldHtml+='<input type="hidden" value="'+_LOGGEDIN_ZUID+'" name="loginUserZUID"/>',inputfieldHtml+='<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),inputfieldHtml+='<input type="hidden" value="'+formId+'" name="zp_formId"/>',this.isEditMode()&&!this.isResubmit()?(inputfieldHtml+='<input type="hidden" value="'+FormConstants.RECORD.MODE.UPDATE+'" name="zp_mode"/>',inputfieldHtml+='<input type="hidden" value="'+recordId+'" name="zp_recordId"/>'):inputfieldHtml+='<input type="hidden" value="'+FormConstants.RECORD.MODE.ADD+'" name="zp_mode"/>',this.moduleHandler.getFormInputHtml(inputfieldHtml),this.FIELD_LAYOUT.append(inputfieldHtml)}this.LAYOUT.find("#zp_form_outer_container").html(this.FIELD_LAYOUT),this.getParams().isProfileView&&(this.FIELD_LAYOUT.find("div.zpl_crdhdr").addClass("zpl_ctrbrd"),this.getParams().isHome&&this.FIELD_LAYOUT.find("div.zpl_frmclmview").removeClass("zpl_frmclmview")),this.isFormCustomPreview()&&this.LAYOUT.html(this.FIELD_LAYOUT),this.initZComponents(this.FIELD_LAYOUT),this.setFieldValues(),isWebForm&&$("#zpinitloading").remove(),this.isPageMode()||this.ISBLUEPRINT||this.isAddMode()||!this.isViewMode()&&!this.isEditMode()||this.isSingleFieldEdit()||ZPA_BPOperation.getTransitions(formId,recordId,this.FormOperations.getViewPerm(),this.LAYOUT)}setFieldValues(){if(this.isAddMode())return;let recDtl=this.getRecordDetails(),formClassobj=this;$.each(recDtl.record.message.recordDetails,function(index){this.isTabular?formClassobj.setValuesForTabularSection(this,recDtl.record.message.ownerID,index):(formClassobj.setValuesForSingleFields(this.column1,!1),formClassobj.setValuesForSingleFields(this.column2,!1))})}initZComponents(container,sectionId,rowNo,isFromTabRowAdd){if(this.isViewMode()&&!this.isSingleFieldEdit())return;let fieldData=this.getFormsProperties().getFieldData(),phoneCntryElem=container.find("[phone_ctry]"),moduleParams=this.moduleHandler.getModuleProps();if(void 0!=phoneCntryElem&&phoneCntryElem.length>0){let fcId=phoneCntryElem.attr("fcid"),selectOptions=this.getSelect2FieldOptions(fcId,phoneCntryElem,fieldData[fcId]),countryCode=fieldData[fcId].userCountryCode;ZPeopleComponents.select(phoneCntryElem,selectOptions),(this.isAddMode()||moduleParams.hasOwnProperty("isUserAdditionFlow"))&&ZPeopleComponents.select(phoneCntryElem).setValue(countryCode)}let fieldElements=container.find("input[zcomponentname='select'],select[zcomponentname='tokenfield'],input[zcomponentname='datetimefield'],input[zcomponentname='datefield']").not("[phone_ctry]");for(let fieldElement of fieldElements){let value=(fieldElement=$(fieldElement)).val(),fcId=fieldElement.attr("fcid"),zcomponentName=fieldElement.attr("zcomponentname"),selectOptions="select"===zcomponentName||"tokenfield"===zcomponentName?this.getSelect2FieldOptions(fcId,fieldElement,fieldData[fcId],value):"";if(jQuery.isEmptyObject(selectOptions.value)&&fieldElement.val("-Select-"),"select"===zcomponentName){ZPeopleComponents.select(fieldElement,selectOptions).setValue(selectOptions.value);let fcDetails=this.getSingleFieldData(fcId),layout=this.FIELD_LAYOUT,isEmbedForm=this.isEmbedForm,formClassObj=(this.PRINT,this);fcDetails.relatedFieldDetails&&fcDetails.relatedFieldDetails.length>0&&(void 0!==fcDetails.relatedFieldValues&&fcDetails.relatedFieldValues.message[selectOptions.value]?$.each(fcDetails.relatedFieldDetails,function(index){var value;void 0!=fcDetails.relatedFieldValues.message[selectOptions.value][this.formComponentId]&&(value=fcDetails.relatedFieldValues.message[selectOptions.value][this.formComponentId]);var optHtml=value;if("-"!=ZP5Form.Field.getNoValueString(value)){let fieldType=layout.find("#zp_form_relfield_"+fcid+"_"+this.formComponentId).attr("fieldtype");FormConstants.FieldType.IMAGE==fieldType?optHtml='<img class="rlflds-img" src="'+(isEmbedForm&&!isAuthreq?"embed"+value+"&digest="+Embed_digest:value)+'"></img>':FormConstants.FieldType.FILE_UPLOAD==fieldType?optHtml=ZWAF.Encoder.encodeForHTML(value):fieldType==FormConstants.FieldType.ADDRESS&&(value=JSON.parse(decodeHTML(value)),optHtml=ZP5Form.AddressField.getAddressDisplayHtml(value))}layout.find("#zp_form_relfield_"+fcid+"_"+this.formComponentId).find("#zp_form_relfield_value").html(ZP5Form.Field.getNoValueString(optHtml))}):formClassObj.getRelatedFieldsValue(fieldElement,fcDetails.displayType))}else if("tokenfield"===zcomponentName)ZPeopleComponents.tokenfield(fieldElement,selectOptions);else if("datetimefield"===zcomponentName||"datefield"===zcomponentName){let format=dateFmt;if("datetimefield"===zcomponentName){let temptimeFormat=timeFormat.replace("a","tt");Calendar.is12HrFormat()||(temptimeFormat=timeFormat+":ss"),format+=" "+temptimeFormat}else"datefield"===zcomponentName&&(value=ZPeople.decodeTxt(value));let dateOptions={calendarIcon:!0,format:format,picker:!0,spinButtons:"none",clearButton:"none",value:value,pickerclose:ZP5Form.formulaRevaluateOnsingleEditFromCal,pickerdateselect:ZP5Form.dateFieldChangeCallback,pickerOptions:{labels:FormConstants.ZCOMPONENT.LOCALE_OPTIONS}},isGridTabular="true"==fieldElement.closest("[id^='zp_section_fields_']").attr("isgrid");"datetimefield"===zcomponentName?(dateOptions.secondStep=1,isGridTabular&&(dateOptions.className="zpl_mw220"),ZPeopleComponents.datetimefield(fieldElement,dateOptions)):(isGridTabular&&(dateOptions.className="zpl_mw160"),ZPeopleComponents.datefield(fieldElement,dateOptions))}}this.setUpAllAddressFieldComponents(container,sectionId,rowNo,isFromTabRowAdd)}setUpAllAddressFieldComponents(container,sectionId,rowNo,isFromTabRowAdd){let formClassObj=this,formFields=this.FormOperations.getFormComponentData().message.formComponentDetails;$.each(formFields,function(index1,section){void 0!=sectionId&&section.sectionId!=sectionId||$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){void 0!=field&&field.fieldType==FormConstants.FieldType.ADDRESS&&formClassObj.setUpAddressFieldComponents(field,container,rowNo,isFromTabRowAdd)})})})}setUpAddressFieldComponents(field,container,rowNo,isFromTabRowAdd){let formClassObj=this;var addressObj="";if(this.isAddMode()||isFromTabRowAdd)return field.isTabular?field.isGridType?(addressObj=isFromTabRowAdd?container:container.find("#zp_forms_tabluar_"+field.sectionId),void 0!=rowNo&&(addressObj=$(addressObj).find("[row="+rowNo+"]"))):(addressObj=isFromTabRowAdd?container:container.find("[id=zp_section_fields_"+field.sectionId+"]"),void 0!=rowNo&&(addressObj=isFromTabRowAdd?container:container.find("[id=zp_section_fields_"+field.sectionId+"][row="+rowNo+"]"))):addressObj=container.find("[id=zp_field_outer_"+field.formComponentId+"]"),void formClassObj.setUpAddressFieldValue("",addressObj,field);if(this.isEditMode()||this.isSingleFiledEdit()){var recordDetails=void 0!=this.getRecordDetails()?this.getRecordDetails().record.message.recordDetails:[];void 0!=rowNo?field.isTabular&&(addressObj=field.isGridType?isFromTabRowAdd?container:container.find("#zp_forms_tabluar_"+field.sectionId).find("[row="+rowNo+"]"):isFromTabRowAdd?container:container.find("[id=zp_section_fields_"+field.sectionId+"][row="+rowNo+"]"),formClassObj.setUpAddressFieldValue("",addressObj,field)):$.each(recordDetails,function(recordIndex,sectionRecord){if(field.isTabular&&field.sectionId==sectionRecord.sectionId){var rows=sectionRecord.noOfRows,recordIdArray=sectionRecord.recordIdArray;if(recordIdArray.length>0)if(field.isGridType){var fieldIndex=sectionRecord.labelnameheaders.indexOf(field.labelName);for(let index=0;index<rows;index++){var recIdIndex=sectionRecord.recordIdArray.indexOf(recordIdArray[index]),addressFieldRecord=sectionRecord.datarows[recIdIndex][fieldIndex];(addressObj=isFromTabRowAdd?container:container.find("#zp_forms_tabluar_"+sectionRecord.sectionId).find("[rowid="+recordIdArray[index]+"]")).length&&("object"!=typeof addressFieldRecord||jQuery.isEmptyObject(addressFieldRecord)?formClassObj.setUpAddressFieldValue("",addressObj,field):formClassObj.setUpAddressFieldValue(addressFieldRecord,addressObj,field))}}else for(let index=0;index<rows;index++)for(let columnIndex=0;columnIndex<["column1","column2"].length;columnIndex++){var displayColumn=["column1","column2"][columnIndex];if(void 0!=sectionRecord[displayColumn])for(let fieldRecordIdex=0;fieldRecordIdex<sectionRecord[displayColumn].length;fieldRecordIdex++){recIdIndex=sectionRecord.recordIdArray.indexOf(recordIdArray[index]);var fieldRecord=sectionRecord[displayColumn][fieldRecordIdex];fieldRecord.formComponentId==field.formComponentId&&(addressFieldRecord=fieldRecord.componentValue[recIdIndex],(addressObj=isFromTabRowAdd?container:container.find("[id=zp_section_fields_"+field.sectionId+"][rowid="+recordIdArray[index]+"]")).length&&("object"!=typeof addressFieldRecord||jQuery.isEmptyObject(addressFieldRecord)?formClassObj.setUpAddressFieldValue("",addressObj,field):formClassObj.setUpAddressFieldValue(addressFieldRecord,addressObj,field)))}}else field.isGridType?(addressObj=isFromTabRowAdd?container:container.find("#zp_forms_tabluar_"+field.sectionId),void 0!=rowNo&&(addressObj=$(addressObj).find("[row="+rowNo+"]"))):(addressObj=isFromTabRowAdd?container:container.find("[id=zp_section_fields_"+field.sectionId+"]"),void 0!=rowNo&&(addressObj=isFromTabRowAdd?container:container.find("[id=zp_section_fields_"+field.sectionId+"][row="+rowNo+"]"))),formClassObj.setUpAddressFieldValue("",addressObj,field)}})}}appendColumns(children1,children2){return this.FormOperations.getFormComponentData().message.singleColumn||this.isSingleFieldModal||this.getParams().isSingleCol||this.moduleHandler.isSingleCol()?"<div>"+children1+children2+"</div>":(children1=children1.length>0?"<div>"+children1+"</div>":"")+(children2=children2.length>0?"<div>"+children2+"</div>":"")}constructRelatedForm(formComp){let formPageType=this.FormOperations.getPaginationType();this.PRINT&&(formPageType=0);let formId=this.getFormsProperties().getFormId();!this.isViewMode()||this.PRINT||this.isrelfieldsingelrecview||0===formComp.relatedFields.length||this.getParams().isProfile&&!ZP5Form.isDashcal||(ZP5Form.isDashcal=!1,0!==formPageType?1==formComp.relatedFields.length&&"P_Task"==formComp.relatedFields[0].tableName||($(this.FIELD_LAYOUT).find("#zp_form_section_list").append('<li class="" id="zp_form_section_'+formId+'" secid="'+formId+'" onclick="ZP5Form.constructmultipagerelfields(\''+formId+'\')" data-title-display-type="callout" data-title-position="auto" title="'+ZPI18N.getString("zp.relatedforms")+'"><a>'+ZPI18N.getString("zp.relatedforms")+"</a></li>"),$(this.FIELD_LAYOUT).find("#zp_form_body").append('<div id="zp_section_field_top_'+formId+'"><div class="zpl_rgtcnt"></div></div>'),ZP5Form.relformComp=formComp):ZP5Form.getRelatedFieldInnerHtml(formId,formComp,this.FIELD_LAYOUT,!1))}getFieldFormat(fieldsLst,isGrid,sectionId,fieldValObj,rowNo,isTabRowAdd,rowId,tabEditPerm){let sectionHtml="";var tableName=this.getTableName();let sectionObj="";if(isGrid)sectionObj='<tr id="zp_tabular_row" row="'+(void 0===rowNo?1:rowNo)+'">',sectionObj+=this.getTabularColumn(fieldsLst,sectionId,void 0,void 0,void 0,void 0===rowNo?1:rowNo,isTabRowAdd),sectionObj+="</tr>";else{sectionHtml="<div>";var padef=!1;("P_PerformanceAppraisal"==tableName&&!this.isAddMode()&&void 0!=this.getRecordDetails().record.extraDetails&&"0"==this.getRecordDetails().record.extraDetails.status||"P_MultiRater"==tableName&&!this.isAddMode()&&void 0!=this.getRecordDetails().record.extraDetails&&"1"==this.getRecordDetails().record.extraDetails.status)&&(padef=!0);let fieldIndex=0;for(let index in fieldsLst){let fieldData=fieldsLst[index];if(fieldData.fieldType===FormConstants.FieldType.SCRIPT&&(fieldData.editperm=fieldData.viewperm,fieldData.allowedRoleIdsForEdit=fieldData.allowedRoleIdsForView),this.isSingleFieldModal&&fieldData.isNonDependentField)fieldIndex++;else if(this.isSectionFieldAllowForConstruction("Fields",fieldData,isTabRowAdd)){if(fieldData.fieldType!==FormConstants.FieldType.AUTONUMBER||!this.isAddMode()){if(this.isAddMode()&&("P_EmployeeLeave"!=tableName&&fieldData.editperm==FormConstants.Permission.VAL.NO_DATA&&!this.FormOperations.isOperationalRoleAdmin()&&(null==this.primLkpType||!this.isPermAllowed(this.primLkpType,fieldData.editperm,fieldData.allowedRoleIdsForEdit))||fieldData.isSystemHiddenField))continue;var value="";if(!ZPUtil.Validation.isEmpty(fieldData.autofillvalue)&&(this.isAddMode()||padef||isTabRowAdd||fieldData.fieldType===FormConstants.FieldType.PLAIN_TEXT))if(1==fieldData.autofillBy)value=ZP5Form.Field.getCurrentDateAndTime(fieldData.fieldType);else if(fieldData.fieldType===FormConstants.FieldType.DATE_TIME)value=Calendar.convertTo12Hours(fieldData.autofillvalue);else if(value=fieldData.autofillvalue,fieldData.fieldType===FormConstants.FieldType.PLAIN_TEXT){try{value=decodeURI(value)}catch(e){}value=(value=value.replace(/<ul>/,'<ul class="uleditorsty">')).replace(/<ol>/,'<ol class="oleditorsty">')}var isDraftEditedField=!1;this.isEditMode()&&void 0!=ZP5Form.EDITED_FIELDS&&-1!=ZP5Form.EDITED_FIELDS.indexOf(fieldData.formComponentId)&&(isDraftEditedField=!0);var cmpVal="";fieldData.isModeChange=!1;var isEditable=!1;if(fieldData.isTabular&&void 0!==fieldValObj){if(fieldData.isTabFieldViewable=!1,void 0==fieldValObj[fieldIndex]||fieldValObj[fieldIndex].formComponentId!=fieldData.formComponentId)continue;isEditable=fieldValObj[fieldIndex].isEditable&&tabEditPerm,!this.isEditMode()||fieldData.fieldType!=FormConstants.FieldType.SCRIPT&&isEditable||(fieldData.isModeChange=!0),fieldData.fieldType!==FormConstants.FieldType.SCRIPT&&(fieldData.isTabFieldViewable=!0);var tempVal=fieldValObj[fieldIndex].componentValue[rowNo];if(fieldData.fieldType!=FormConstants.FieldType.FILE_UPLOAD&&fieldData.fieldType!=FormConstants.FieldType.IMAGE||(fieldData.filePath=fieldValObj[fieldIndex].componentValue_filePath[rowNo],fieldData.fileId=void 0==fieldValObj[fieldIndex].componentValue_fileId?fieldData.filePath:fieldValObj[fieldIndex].componentValue_fileId[rowNo],fieldData.uploadSource=fieldValObj[fieldIndex].componentValue_uploadSource[rowNo]),this.isEditMode()&&fieldData.fieldType==FormConstants.FieldType.LOOKUP&&void 0!=fieldValObj[fieldIndex].componentValue_ID&!fieldData.isModeChange&&(cmpVal=tempVal,tempVal=fieldValObj[fieldIndex].componentValue_ID[rowNo],ZP5Form.select2.ALL_OPTIONS[fieldData.formComponentId+"_"+tempVal]=cmpVal),!this.isEditMode()||fieldData.fieldType!=FormConstants.FieldType.NEW_BLOODGROUP&&fieldData.fieldType!==FormConstants.FieldType.NEW_GENDER&&fieldData.fieldType!==FormConstants.FieldType.NEW_COUNTRY||void 0==fieldValObj[fieldIndex].componentValue_ID||(tempVal=fieldValObj[fieldIndex].componentValue_ID[rowNo]),tempVal&&("object"==typeof tempVal?!jQuery.isEmptyObject(tempVal):tempVal.trim())&&(value=tempVal),this.isViewMode()&&void 0!=fieldValObj&&(fieldData.fieldType===FormConstants.FieldType.NUMBER||fieldData.fieldType===FormConstants.FieldType.CURRENCY||fieldData.fieldType===FormConstants.FieldType.DECIMAL)){var curfieldValObj=fieldValObj[fieldIndex];void 0!=curfieldValObj.dispVal&&void 0!=curfieldValObj.dispVal[rowNo]&&null!=curfieldValObj.dispVal[rowNo]&&(value=curfieldValObj.dispVal[rowNo])}fieldIndex++}else isEditable=this.isPermitted(fieldData.editperm,fieldData.allowedRoleIdsForEdit,fieldData.allowedRoleIdsForView)||this.FormOperations.isLocAdmin()||isAdminProfile,!this.isEditMode()||fieldData.fieldType!=FormConstants.FieldType.SCRIPT&&isEditable||(fieldData.isModeChange=!0);var isRelFieldEnabled=!1,isFieldDependent=!1;if(fieldData.isFieldDependent&&(isFieldDependent=fieldData.isFieldDependent),void 0!==fieldData.relatedFieldDetails&&fieldData.relatedFieldDetails.length>0&&(isRelFieldEnabled=!0),fieldData.fieldType===FormConstants.FieldType.PLAIN_TEXT)sectionObj+='<div class="zpl_secn zpl_notes" fieldouter="true"><div><div id="zp_field_outer_'+fieldData.formComponentId+'" '+("P_PerformanceAppraisal"==tableName?'isallowed="true"':"")+">"+value+"</div></div></div>";else{var manClass="";(!this.isViewMode()&&ZP5Form.Field.isMandatory(tableName,fieldData.isMandatory,fieldData.labelName,this.getMode())||"P_EmployeeLeave"===tableName&&"ZP_Leave_File_Upload"===fieldData.labelName)&&(manClass="zpl_mtry");let fieldHtmlObj=this.moduleHandler.fieldsSpecificHtmlLoad(fieldData,fieldsLst,value,isRelFieldEnabled,index);if(fieldHtmlObj.loaded)sectionObj+=fieldHtmlObj.fieldHtml;else if("P_Compensatory"===tableName&&"IsHalfday"===fieldData.labelName)sectionHtml+='<div id="zp_formcompoff_extrainfo"></div>';else if("P_Employee"!==tableName||"Photo"!==fieldData.labelName){fieldData.isModeChange&&this.setAsViewMode(),fieldData.fieldType==FormConstants.FieldType.ADDRESS&&this.isViewMode()&&!jQuery.isEmptyObject(value)&&(value=ZP5Form.AddressField.getAddressDisplayHtml(value)),this.isEditMode()&&fieldData.fieldType===FormConstants.FieldType.TEXT_AREA&&void 0!=value&&null!=value&&(value=ZPeople.decodeTxt(value.replace(/<br[^>]*>/gi,"\n"))),fieldData.fieldType==FormConstants.FieldType.URL&&fieldData.isTabular&&this.isViewMode()&&(value='<a rel="noreferrer" href="'+value+'" target="_blank">'+value+"</a>"),!this.isEditMode()||fieldData.fieldType!==FormConstants.FieldType.FILE_UPLOAD&&fieldData.fieldType!==FormConstants.FieldType.IMAGE||(void 0==value||""==value||ZPUtil.Validation.isEmpty(value)?fieldData.tabularfileupload=!1:(fieldData.tabularfileupload=!0,value=value.replace("Cropped",""),fieldData.recordId=rowId)),sectionObj+=this.getSingleFieldFormat(value,manClass,fieldData,isRelFieldEnabled,isFieldDependent,fieldData.isModeChange||fieldData.fieldType==FormConstants.FieldType.SCRIPT,isDraftEditedField,rowNo,rowId),fieldData.isModeChange&&this.setAsEditMode()}}}if(isRelFieldEnabled){var relFieldVal,relFieldsHtml="",optionslen=1,isFillRelFields=!1;fieldData.hasOwnProperty("AddOptions")&&(optionslen=fieldData.AddOptions,$.each(fieldData.AddOptions,function(key,value){value.Id==erecno&&(isFillRelFields=!0)})),void 0!==fieldData.relatedFieldValues&&7e3===fieldData.relatedFieldValues.code&&0!=optionslen&&isFillRelFields&&(relFieldVal=fieldData.relatedFieldValues.message[erecno]);this.getMode();let tempisembedForm=this.isEmbedForm,formClassObj=this;$.each(fieldData.relatedFieldDetails,function(index){var value;if(void 0!==relFieldVal&&void 0!=relFieldVal[this.formComponentId]&&(value=relFieldVal[this.formComponentId]),void 0!=rowId){var id=fieldValObj[fieldIndex-1].componentValue_ID[rowNo];value=void 0!=fieldValObj[fieldIndex-1].tabularrelatedFieldValues[id]&&fieldValObj[fieldIndex-1].tabularrelatedFieldValues[id][this.formComponentId]?fieldValObj[fieldIndex-1].tabularrelatedFieldValues[id][this.formComponentId].Value:""}void 0!=value&&value.length>0&&""!=value&&this.compType==FormConstants.FieldType.ADDRESS&&(value=JSON.parse(ZPeople.decodeTxt(value)),value=ZP5Form.AddressField.getAddressDisplayHtml(value)),relFieldsHtml+='<div class="zpl_secn zpl_rlds" fieldtype="'+this.compType+'" labelname="'+this.labelName+'" id="zp_form_relfield_'+fieldData.formComponentId+"_"+this.formComponentId+'"><div><label class="">'+this.displayName+"</label></div>";let valHtml="-";(4!==formClassObj.FormOperations.getAddPerm()&&"ADD"==formClassObj.getMode()||void 0!=rowId)&&"-"!=ZP5Form.Field.getNoValueString(value)&&(this.compType==FormConstants.FieldType.IMAGE?valHtml='<div class="zpl_upld prof"><div class="zpl_fldrp"><img src="'+(tempisembedForm&&!isAuthreq?"embed"+value+"&digest="+Embed_digest:value)+'" alt="'+ZPI18N.getString("zp.imgerror")+'"></div></div>':this.compType==FormConstants.FieldType.FILE_UPLOAD&&(valHtml=ZWAF.Encoder.encodeForHTML(value))),relFieldsHtml+=`<div id="zp_form_relfield_value"><span>${valHtml}</span></div></div>`}),sectionObj+=relFieldsHtml}}}}return sectionObj}getTabularColumn(fieldList,sectionId,tabularObj,ownerIds,recIdIndex,rowNo,isTabRowAdd){var valueArr=void 0!=tabularObj?tabularObj.datarows[recIdIndex]:void 0,recId=void 0!=tabularObj?tabularObj.recordIdArray[recIdIndex]:void 0,visibleIndex=0,tabularComponent=ZP5Form.getSectionComponent(this.FormOperations.getFormComponentData().message.formComponentDetails,sectionId),tabularEditPerm=this.isPermitted(tabularComponent.editPermVal,tabularComponent.editPermObj,tabularComponent.editPermObj)||void 0==recId&&this.isPermitted(tabularComponent.addPermVal,tabularComponent.addPermObj,tabularComponent.addPermObj),editedFieldList=void 0!=this.getRecordDetails()?this.getRecordDetails().record.editedFcids:{};let tableName=this.getTableName();void 0==editedFieldList&&(editedFieldList={});var tdObj="";for(let index in fieldList){let value,fieldData=fieldList[index];if(fieldData.fieldType===FormConstants.FieldType.SCRIPT&&(fieldData.editperm=fieldData.viewperm,fieldData.allowedRoleIdsForEdit=fieldData.allowedRoleIdsForView),this.isSingleFieldModal&&fieldData.isNonDependentField){visibleIndex++;continue}if(void 0!=tabularObj&&(void 0==tabularObj.labelnameheaders[visibleIndex]||tabularObj.labelnameheaders[visibleIndex]!=fieldData.labelName))continue;if(this.isAddMode()&&null!=this.primLkpType&&fieldData.componentType!==FormConstants.FieldType.PLAIN_TEXT&&!this.isPermAllowed(this.primLkpType,fieldData.editperm,fieldData.allowedRoleIdsForEdit))continue;void 0!==valueArr&&(value=valueArr[visibleIndex]),!this.isViewMode()||void 0==tabularObj||fieldData.fieldType!==FormConstants.FieldType.NUMBER&&fieldData.fieldType!==FormConstants.FieldType.CURRENCY&&fieldData.fieldType!==FormConstants.FieldType.DECIMAL||(value=tabularObj.displayFormatValues[fieldData.labelName][recIdIndex]);var isEditable=this.isAddMode()&&(fieldData.editperm>FormConstants.Permission.VAL.NO_DATA||fieldData.allowedRoleIdsForEdit.length>0||null==this.primLkpType&&this.FormOperations.isOperationalRoleAdmin())||this.isEditMode()&&tabularEditPerm&&this.isPermitted(fieldData.editperm,fieldData.allowedRoleIdsForEdit,fieldData.allowedRoleIdsForView);let lookupSelectedOption;fieldData.fieldType!==FormConstants.FieldType.LOOKUP&&fieldData.fieldType!==FormConstants.FieldType.NEW_GENDER&&fieldData.fieldType!==FormConstants.FieldType.NEW_BLOODGROUP&&fieldData.fieldType!==FormConstants.FieldType.NEW_COUNTRY||(void 0!=valueArr&&void 0!==value&&void 0!=value.Id?(this.isViewMode()||!isEditable?value=valueArr[visibleIndex].Value:(""!=value.Id&&(lookupSelectedOption=value),value=valueArr[visibleIndex].Id),ZP5Form.select2.ALL_OPTIONS[fieldData.formComponentId+"_"+valueArr[visibleIndex].Id]=valueArr[visibleIndex].Value):value=""),visibleIndex++;let isFieldClickable=!1;if(value=this.getValueForField(fieldData,value),fieldData.fieldType===FormConstants.FieldType.URL&&this.isViewMode()&&"-"!=ZP5Form.Field.getNoValueString(value)&&(value='<a rel="noreferrer" href="'+value+'" target="_blank">'+ZP5Form.Field.getNoValueString(value)+"</a>",isFieldClickable=!0),(this.isViewMode()||!isEditable)&&(fieldData.fieldType===FormConstants.FieldType.FILE_UPLOAD||fieldData.fieldType===FormConstants.FieldType.IMAGE)&&void 0!=value&&null!=value){fieldData.uploadSource=value.componentValue_uploadSource;var downloadParams={fcId:fieldData.formComponentId,recordId:recId,formId:this.getFormsProperties().getFormId(),original:"true"};ZPUtil.Validation.isEmpty(value.componentValue)||(isFieldClickable=!0),value=ZP5Form.FILEUPLOAD_IMAGES.constructFileFieldHtml(tableName,fieldData,value.componentValue_filePath,value.componentValue,downloadParams,this.PRINT)}if(fieldData.fieldType!==FormConstants.FieldType.SCRIPT&&isEditable){!this.isAddMode()&&!isTabRowAdd||ZPUtil.Validation.isEmpty(fieldData.autofillvalue)||(value=1==fieldData.autofillBy?ZP5Form.Field.getCurrentDateAndTime(fieldData.fieldType):fieldData.fieldType===FormConstants.FieldType.DATE_TIME?Calendar.convertTo12Hours(fieldData.autofillvalue):fieldData.autofillvalue),fieldData.isTabular=!0,this.isEditMode()&&fieldData.fieldType===FormConstants.FieldType.TEXT_AREA&&void 0!=value&&null!=value&&(value=ZPeople.decodeTxt(value.replace(/<br[^>]*>/gi,"\n"))),!this.isEditMode()||fieldData.fieldType!==FormConstants.FieldType.FILE_UPLOAD&&fieldData.fieldType!==FormConstants.FieldType.IMAGE||(void 0==value||""==value||ZPUtil.Validation.isEmpty(value.componentValue)?fieldData.tabularfileupload=!1:(fieldData.tabularfileupload=!0,fieldData.filePath=value.componentValue_filePath,fieldData.fileId=void 0!=value.componentValue_fileID?value.componentValue_fileID:fieldData.filePath,fieldData.uploadSource=void 0!=value.componentValue_uploadSource?value.componentValue_uploadSource:"",value=value.componentValue.replace("Cropped",""),fieldData.recordId=recId));var editedFieldsCls="";if(this.isEditMode()&&void 0!=ZP5Form.EDITED_FIELDS&&-1!=ZP5Form.EDITED_FIELDS.indexOf(fieldData.formComponentId)&&void 0!=editedFieldList[fieldData.formComponentId][recId]&&(editedFieldsCls="dr-label"),fieldData.fieldType===FormConstants.FieldType.ADDRESS){var childObject=fieldData.childFcObj,parentObj=fieldData;let formClassObj=this;$.each(FormConstants.AddressField.COLUMNAMEARRAY,function(index,value1){var currChildObj=childObject[value1],temp=(currChildObj.displayName,parentObj.displayName,"");currChildObj.fieldType==FormConstants.FieldType.STATES?temp='<td folabel="'+currChildObj.labelName+'" id="zp_field_outer_'+currChildObj.formComponentId+'" parentfcid = "'+parentObj.formComponentId+'" class="PR"><input name="STATE"></input></td>':(temp='<td folabel="'+currChildObj.labelName+'" id="zp_field_outer_'+currChildObj.formComponentId+'" parentfcid = "'+parentObj.formComponentId+'" '+(currChildObj.fieldType===FormConstants.FieldType.COUNTRY?'class="PR"':currChildObj.fieldType===FormConstants.FieldType.TEXT_AREA?'class="txtarea-wid"':"")+" >"+(currChildObj.fieldType===FormConstants.FieldType.COUNTRY?'<input name="COUNTRY"></input>':""),currChildObj.fieldType!=FormConstants.FieldType.COUNTRY&&(temp+=formClassObj.createField(currChildObj,"",editedFieldsCls,rowNo)),temp+="</td>"),tdObj+=temp})}else{let fieldclass="";fieldData.fieldType===FormConstants.FieldType.PICKLIST||fieldData.fieldType===FormConstants.FieldType.LOOKUP||fieldData.fieldType===FormConstants.FieldType.BLOODGROUP||fieldData.fieldType===FormConstants.FieldType.GENDER||fieldData.fieldType===FormConstants.FieldType.COUNTRY||this.fieldType===FormConstants.FieldType.NEW_BLOODGROUP||this.fieldType===FormConstants.FieldType.NEW_GENDER||this.fieldType===FormConstants.FieldType.NEW_COUNTRY?fieldclass="PR":fieldData.fieldType===FormConstants.FieldType.TEXT_AREA&&(fieldclass="txtarea-wid");var temp='<td folabel="'+fieldData.labelName+'" isFieldDependent="'+fieldData.isFieldDependent+'" id="zp_field_outer_'+fieldData.formComponentId+'" class="'+fieldclass+'">';if(temp+=this.createField(fieldData,value,editedFieldsCls,rowNo),temp+="</td>",fieldData.fieldType===FormConstants.FieldType.LOOKUP&&void 0!=value&&""!=value&&$(temp).find("option[value='"+ZPeople.decodeTxt(value)+"']").length<=0){var temp1=jQuery("<div />").append(temp);temp1.find(":input[name="+fieldData.labelName+"]").append("<option selected value='"+lookupSelectedOption.Id+"'>"+lookupSelectedOption.Value+"</option"),temp=temp1.html()}tdObj+=temp}}else if(fieldData.fieldType==FormConstants.FieldType.SCRIPT||!this.isAddMode()){var temMode=this.getMode();if(this.isEditMode()&&this.setAsViewMode(),this.isPermitted(fieldData.viewperm,fieldData.allowedRoleIdsForEdit,fieldData.allowedRoleIdsForView))if(this.getFormsProperties().setMode(temMode),fieldData.fieldType===FormConstants.FieldType.ADDRESS){parentObj=fieldData,childObject=fieldData.childFcObj;$.each(FormConstants.AddressField.COLUMNAMEARRAY,function(index,value1){var currChildObj=childObject[value1],currChildValue=void 0!=value?value[value1]:"",temp='<td folabel="'+currChildObj.labelName+'" '+(currChildObj.fieldType===FormConstants.FieldType.TEXT?"class='ZPExpd'":"")+">"+(ZPUtil.Validation.isEmpty(currChildValue)||this.fieldType!==FormConstants.FieldType.TEXT?ZP5Form.Field.getNoValueString(currChildValue):"<div class='txttrim' "+ComponentsCommon.getTooltipHtml(currChildValue.replaceAll("<br>","\n"),{position:"bottom"},!0)+">"+ZP5Form.Field.getNoValueString(currChildValue)+"</div>")+"</td>";tdObj+=temp})}else{let columnvalue=ZP5Form.Field.getNoValueString(value),tooltipFunc="";if(ZPUtil.Validation.isEmpty(value)||fieldData.fieldType!==FormConstants.FieldType.TEXT_AREA&&fieldData.fieldType!==FormConstants.FieldType.TEXT)!this.isViewMode()||this.PRINT||ZPUtil.Validation.isEmpty(value)||(tooltipFunc='onmouseover="FrameworkCommon.mouseEnterFunction()"');else{let onMouseOverEvent=this.PRINT?"":'onmouseover="ZP5Form.addMultiLineTooltip()"';columnvalue=`<div class="${this.PRINT?"":"zpl_lineClmp2 zpl_ws-nor"}" id="${ZP5Form.getMultiLineTooltipId(fieldData.formComponentId,rowNo,this,this.PRINT)}" ${onMouseOverEvent}>${ZP5Form.Field.getNoValueString(value)}</div>`}!this.PRINT&&fieldData.isMask&&this.isViewMode()?tdObj+=`<td folabel="${fieldData.labelName}"><span mask="star_${index}">${FormConstants.MASK.PLACEHOLDER}</span><span class="zpl_DNI" mask="value_${index}" ${tooltipFunc}>${columnvalue}</span></td>`:tdObj+=`<td class="${isFieldClickable?"blu":""}" id="zp_field_outer_${fieldData.formComponentId}" folabel="${fieldData.labelName}" ${tooltipFunc}>${columnvalue}</td>`}this.getFormsProperties().setMode(temMode)}}return this.isViewMode()||!(this.isPermitted(tabularComponent.deletePermVal,tabularComponent.deletePermObj,tabularComponent.deletePermObj)||void 0==recId&&this.isPermitted(tabularComponent.addPermVal,tabularComponent.addPermObj,tabularComponent.addPermObj))&&tabularObj||(tdObj+='<td class="mw80 w80"><div id="zp_form_deletetabular_row" secId="'+sectionId+'" class="zpl_hvr"><i class="PI_delete"></i></div></td>'),tdObj}getValueForField(fieldData,value){return fieldData.fieldType!==FormConstants.FieldType.DATE_TIME||ZPUtil.Validation.isEmpty(value)||(value=Calendar.convertTo12Hours(ZPeople.decodeTxt(value))),value}setValuesForSingleFields(fieldsLst,isSingleEdit){var tableName=this.getTableName();let readOnlyFields=this.getParams().readOnlyFields;for(let index in fieldsLst){let fieldData=fieldsLst[index];if(void 0==fieldData)continue;let fcId=fieldData.formComponentId,value=fieldData.componentValue+"";var labelName=fieldData.componentName,formC=ZP5Form.Field.getFieldComponent(fcId);if(void 0!=formC&&formC.fieldType==FormConstants.FieldType.MULTI_FILE_UPLOAD&&(value=fieldData.componentValue),!this.moduleHandler.isValidFields(labelName,tableName))continue;if(void 0==formC||this.isSingleFieldModal&&formC.isNonDependentField)continue;let fieldElem=this.FIELD_LAYOUT.find("#zp_field_outer_"+fcId).parent(),isReadOnlyField=void 0!==readOnlyFields&&-1!==readOnlyFields.indexOf(labelName);if(ZP5Form.Field.isFieldEditAllowed(fieldData.componentType,this.isEditMode(),isSingleEdit,fieldData.isEditable,formC,this.isDraftrec,this.isResubmit(),fieldData.blueprintField,this)){let isFieldExists=!0;if((void 0==(fieldObj=this.FIELD_LAYOUT.find(":input[name="+labelName+"]"))||fieldObj.length<=0)&&(isFieldExists=!1),void 0!=fieldData.componentValue_country_code&&-1!=value.indexOf("-")&&(value=value.substr(value.indexOf("-")+1)),fieldObj.closest("div[isallowed=false]").attr("isallowed",!0),void 0===fieldData.componentValue_ID||fieldData.componentType===FormConstants.FieldType.PICKLIST&&fieldData.componentType!=FormConstants.FieldType.NEW_GENDER&&fieldData.componentType!=FormConstants.FieldType.NEW_BLOODGROUP&&fieldData.componentType!=FormConstants.FieldType.NEW_COUNTRY||("object"==typeof(value=fieldData.componentValue_ID)&&0===value.length||"string"==typeof value&&""===value.trim())&&(value=void 0),fieldData.componentType===FormConstants.FieldType.PLAIN_TEXT&&fieldObj.attr("isallowed",!0),void 0!==value)if(void 0!==(fldCreateFun=this.getCreateFldFunctions())&&void 0!==fldCreateFun[labelName]&&"function"==typeof fldCreateFun[labelName])fieldData.fieldObj=fieldObj,fieldData.fieldElem=fieldElem,fldCreateFun[labelName](fieldData,"EDIT","",this);else if(isFieldExists){switch(fieldData.componentType){case FormConstants.FieldType.PICKLIST:case FormConstants.FieldType.LOOKUP:case FormConstants.FieldType.GENDER:case FormConstants.FieldType.BLOODGROUP:case FormConstants.FieldType.COUNTRY:case FormConstants.FieldType.STATES:case FormConstants.FieldType.TIME_ZONE:case FormConstants.FieldType.NEW_GENDER:case FormConstants.FieldType.NEW_BLOODGROUP:case FormConstants.FieldType.NEW_COUNTRY:if(fieldData.displayType=formC.displayType,!isOrgStructureEnabled||"P_Employee"!=tableName&&"P_Candidate"!=tableName&&0!==tableName.indexOf("dc_")||fieldData.componentName!=ZP5Form.getDivisionLabel(tableName)||fieldData.displayType!==FormConstants.FieldType.SELECT_DISPLYTYPE||(value=value[0]),fieldData.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE||fieldData.displayType===FormConstants.FieldType.SELECT_DISPLYTYPE&&""!==value.trim())if(fieldData.componentType===FormConstants.FieldType.PICKLIST&&fieldData.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&(value=fieldData.componentValue),fieldData.displayType===FormConstants.FieldType.SELECT_DISPLYTYPE&&""!==value.trim())"P_Employee"==tableName&&"Employeestatus"==labelName&&(value=ZSEC.Encoder.encodeForHTML(value)),fieldData.componentType===FormConstants.FieldType.LOOKUP?ZPeopleComponents.select(fieldObj).setValue({text:ZPeople.decodeTxt(fieldData.componentValue),id:fieldData.componentValue_ID}):ZPeopleComponents.select(fieldObj).setValue(ZPeople.decodeTxt(value)),ZP5Form.select2.ALL_OPTIONS[fcId+"_"+fieldData.componentValue_ID]=fieldData.componentValue;else{if(fieldData.componentType===FormConstants.FieldType.LOOKUP){var cmp_values_Id=fieldData.componentValue_ID,cmp_values=fieldData.componentValue,lkfcid=fcId,op=[];$.each(fieldData.componentValue,function(key,value){op.push({id:cmp_values_Id[key],text:ZPeople.decodeTxt(cmp_values[key])}),ZP5Form.select2.ALL_OPTIONS[lkfcid+"_"+cmp_values_Id[key]]=cmp_values[key]}),ZPeopleComponents.tokenfield(fieldObj,{values:op})}else{let val;op=[];for(var i=0;i<value.length;i++)val=ZPeople.decodeTxt(value[i]),value[i].length>0&&op.push({id:val,text:val})}ZPeopleComponents.tokenfield(fieldObj).setAttributes({values:op})}else if(fieldData.displayType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE&&value.length>0){fieldData.componentType===FormConstants.FieldType.PICKLIST&&(value=fieldData.componentValue.constructor==[].constructor?fieldData.componentValue:value.split(","));var cmpType=fieldData.componentType;cmp_values_Id=fieldData.componentValue_ID,cmp_values=fieldData.componentValue;let range,formClassObj=this,values=[],isPrimaryEditOption=!1;formC.isPrimary&&(formClassObj.isEditMode()||formClassObj.isSingleFiledEdit())&&(isPrimaryEditOption=!0,range=formC.EditOptions.length),$.each(value,function(index){if(values.push(ZPeople.decodeTxt(this)),cmpType===FormConstants.FieldType.LOOKUP&&fieldObj.filter("[value='"+this+"']").length<=0){let newOptions=[{Id:cmp_values_Id[index],Value:cmp_values[index]}];fieldObj=ZP5Form.constructNonDropdownOptions(formClassObj,formC,newOptions,values)}else fieldObj=ZP5Form.constructNonDropdownOptions(formClassObj,formC,void 0,values,!0)}),isPrimaryEditOption&&formC.EditOptions.splice(range)}else if(fieldData.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE&&""!==value.trim())if(fieldData.componentType===FormConstants.FieldType.LOOKUP&&fieldObj.filter("[value='"+value+"']").length<=0){let newOptions=[{Id:fieldData.componentValue_ID,Value:fieldData.componentValue}];fieldObj=ZP5Form.constructNonDropdownOptions(this,formC,newOptions,[value],!1),formC.isPrimary&&(this.isEditMode()||this.isSingleFiledEdit())&&formC.EditOptions.pop()}else fieldObj=ZP5Form.constructNonDropdownOptions(this,formC,void 0,[ZPeople.decodeTxt(value)],!0);else""!==value.trim()&&((fieldData.componentType==FormConstants.FieldType.GENDER&&!ZP5Form.Field.genderNameisExist(fcId,value)||fieldData.componentType==FormConstants.FieldType.COUNTRY&&!ZP5Form.Field.countryNameisExist(fcId,value))&&ZPeopleComponents.select(fieldObj).addOption([{text:ZPeople.decodeTxt(fieldData.componentValue),id:ZPeople.decodeTxt(fieldData.componentValue)}]),ZPeopleComponents.select(fieldObj).setValue(ZPeople.decodeTxt(value)));break;case FormConstants.FieldType.CHECK_BOX:fieldObj[0].checked="true"===value;break;case FormConstants.FieldType.FILE_UPLOAD:case FormConstants.FieldType.IMAGE:if(!ZPUtil.Validation.isEmpty(value)&&("P_PerformanceAppraisal"!=tableName||null==this.getParams().copyRecordId)){value=value.replace("Cropped","");var inputEle=$('<input type="hidden" value="" id="filename"/>'),onclick=this.moduleHandler.onclickFuncForFileUpload(fieldData,inputEle);if(null==onclick){var downloadParams={fcId:fcId,recordId:this.getFormsProperties().getRecordId(),formId:this.getFormsProperties().getFormId(),original:"true"},fileExtn="";-1!=value.lastIndexOf(".")&&(fileExtn=(fileExtn=value.substr(value.lastIndexOf(".")+1,value.length)).toLowerCase()),onclick="1"==fieldData.componentValue_uploadSource?"window.open('"+fieldData.componentValue_filePath+"');":void 0!=fieldData.componentValue_filePath&&(fieldData.componentValue_filePath.indexOf(workDriveUrl)>-1||fieldData.componentValue_filePath.indexOf(writerUrl)>-1||fieldData.componentValue_filePath.indexOf(sheetUrl)>-1||fieldData.componentValue_filePath.indexOf(showUrl)>-1)?"window.open('"+fieldData.componentValue_filePath.substr(0,fieldData.componentValue_filePath.lastIndexOf("/"))+"');":1==isPreviewAllowed&&null!=fileExtn&&void 0!=fileExtn&&""!=fileExtn&&-1!=ZP5Form.PreviewSupportedFileTypes.indexOf(fileExtn)?"ZP5Form.FILEUPLOAD_IMAGES.showPreview(this,'"+encodeURIComponent(JSON.stringify(downloadParams))+"')":"window.open('"+ZP5Form.constructDownloadLink(downloadParams)+"');",1==fieldData.componentValue_uploadSource?inputEle.val(fieldData.componentValue_fileID):inputEle.val(fieldData.componentValue_filePath)}let fieldDataObj={originalFileName:value,fileExtn:fileExtn,onclickfunc:onclick,filepath:fieldData.componentValue_filePath,isViewFile:!0};fieldObj.parent().parent().parent().parent().addClass("DNI").after('<div id="zp_form_fileuploadfield" class="zpl_atchd atsml">'+this.constructFileEditHtml(fieldDataObj)+"</div>"),fieldObj.after(inputEle)}break;case FormConstants.FieldType.MULTI_FILE_UPLOAD:var compva=[];for(i=0;i<value.length;i++){var val1=value[i],compval=val1.componentValue+"";ZPUtil.Validation.isEmpty(compval)||(compval=compval.replace("Cropped",""),void 0!==val1.componentValue_fileId&&fieldObj.parent().parent().parent().parent().addClass("DNI").after('<div id="zp_form_fileuploadfield_'+i+'"><a class="pdf-text MR10" id="filepa_'+i+'" filepath="'+val1.componentValue_filePath+'"onclick="window.open(\'/'+contextPath+val1.componentValue_downloadUrl+'\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(compval)+'</a><a href="javascript:;" change="true" onclick="ZP5Form.Field.toggleFileUpload(this);" class="text-ovr">'+ZPI18N.getString("zp.remove")+"</a></div>"),1==val1.componentValue_uploadSource?compva.val(val1.componentValue_fileID):compva.push(val1.componentValue_filePath))}value.length<5&&(fieldObj.closest("div[folabel="+labelName+"]").find(".ZPUFile").removeClass("DNI"),fieldObj.closest("div[folabel="+labelName+"]").find("#beforeUpload").removeClass("DNI")),(inputEle=$('<input type="hidden" value="" id="filename"/>')).val(JSON.stringify(compva)),fieldObj.after(inputEle);break;case FormConstants.FieldType.EMAIL_ADDRESS:if("EmailID"==labelName&&"P_Employee"==tableName&&!ZP5Form.Employee.isAllowedToEditEmailId()&&!ZP5Form.Employee.isAllowedToeditPendingUserMail()||"Email_ID"==labelName&&"P_Candidate"==tableName&&!ZP5Form.Employee.isNonUser())this.FIELD_LAYOUT.find(":input[name="+labelName+"]").hide().val(ZPeople.decodeTxt(value)),fieldObj.after("<span>"+value+"</span>");else if("EmailID"==labelName&&"P_Employee"==tableName&&ZP5Form.Employee.isAllowedToEditEmailId()&&!ZP5Form.Employee.isAllowedToeditPendingUserMail()){if(!ZP5Form.Employee.isNonUser()){var fieldElm='<input fieldtype="1" class="form-control zptxt-edit" type="text" name="domainEmail" value="'+ZPeople.decodeTxt(value).split("@")[0]+'" onkeyup="ZP5Form.showPreview(this)">';fieldElm+='<select class="selectBox" id="domainListing" onchange="ZP5Form.showPreviewdom(this)">';var currentMailDomain=ZPeople.decodeTxt(value).split("@")[1],formCompObj=this.FormOperations.getFormComponentData();void 0!=currentMailDomain&&(fieldElm+='<option value="'+currentMailDomain+'" default="--Select--"> '+currentMailDomain+" </option>"),$.each(formCompObj.domainsList,function(key,value){value!=currentMailDomain&&(fieldElm+='<option value="'+value+'" default="--Select--"> '+value+" </option>")}),fieldElm+="</select>",fieldElm+='<div class="zp-msg" id="prevMsg"></div>',fieldObj.after(fieldElm),fieldObj.siblings("#prevMsg").append(fieldObj),fieldObj.removeClass("zptxt-edit"),fieldObj.closest(".zp-label").addClass("zpdomain")}fieldObj.attr("value",ZPeople.decodeTxt(value))}else fieldObj.val(ZPeople.decodeTxt(value));break;case FormConstants.FieldType.DATE_TIME:ZPUtil.Validation.isEmpty(value)||ZPeopleComponents.datetimefield(fieldObj).setValue(Calendar.convertTo12Hours(ZPeople.decodeTxt(value)));break;case FormConstants.FieldType.DATE:ZPUtil.Validation.isEmpty(value)||ZPeopleComponents.datefield(fieldObj).setValue(ZPeople.decodeTxt(value));break;case FormConstants.FieldType.TEXT_AREA:fieldObj.val(ZPeople.decodeTxt(value.replace(/<br[^>]*>/gi,"\n")));break;case FormConstants.FieldType.SOCIAL_SECURITY_NUMBER:fieldObj.val(ZP5Form.Field.formatSSNValue(value));break;case FormConstants.FieldType.ADDRESS:this.setUpAddressFieldValue(fieldData.childValues,fieldElem,formC);break;default:fieldObj.val(ZPeople.decodeTxt(value))}let elem=fieldObj.parent().find("[phone_ctry]");if("Mobile"==fieldData.componentName&&("P_Employee"==tableName||"P_Candidate"==tableName)&&void 0!=elem&&elem.length>0)if(ZP5Form.Employee.isExistingMobileUser()&&void 0==fieldData.componentValue_country_code){var splittedDialCode=ZPeople.decodeTxt(value).split("-");if("1"!=splittedDialCode&&"7"!=splittedDialCode){var cCode=ZPComponents.dialCode.isValidDialCode(splittedDialCode[0]);fieldObj.parent().find("[phone_ctry]").appendDialCode(cCode),fieldObj.val(splittedDialCode[1])}}else ZPeopleComponents.select(fieldObj.parent().find("[phone_ctry]")).setValue(fieldData.componentValue_country_code)}if(isReadOnlyField){let fieldObjparent=fieldObj.parent();fieldObjparent.parent().children().addClass("zpl_DNI"),fieldObjparent.after("<span>"+ZP5Form.Field.getNoValueString(fieldData.componentValue)+"</span>")}-1!==labelName.indexOf("EmployeeSalary")&&"P_PerformanceAppraisal"==tableName&&this.FIELD_LAYOUT.find("[folabel=EmployeeSalary]").parent("div.form-group").addClass("DN"),fieldData.componentType===FormConstants.FieldType.ADDRESS&&fieldObj.remove()}else{if(this.isEditMode()&&fieldElem.find("[zcomponentname]").length>0&&this.destroyZComponents($(fieldElem.find("[zcomponentname]"))),"P_Employee"===tableName&&ZP5Form.isFromSubmit){var userDtl=ZPeople.getUserDetailsById(this.getFormsProperties().getRecordId(),!0);void 0==userDtl||userDtl.notFound||ZP5Form.updateUserDetails(userDtl,fieldData.componentName,value,fieldData.componentValue_ID)}var fldCreateFun;if(void 0!==(fldCreateFun=this.getCreateFldFunctions())&&void 0!==fldCreateFun[labelName]&&"function"==typeof fldCreateFun[labelName])fieldData.fieldObj=fieldElem.find("#zp_field_outer_"+fcId),fieldData.fieldElem=fieldElem,fldCreateFun[labelName](fieldData,"VIEW","",this);else{var fieldObj;if(0===(fieldObj=fieldElem.find("#zp_field_outer_"+fcId)).length)continue;if(fieldObj.closest("div[isallowed=false]").attr("isallowed",!0),fieldData.componentType===FormConstants.FieldType.PLAIN_TEXT){try{value=decodeURI(value)}catch(e){}fieldObj.attr("isallowed",!0)}switch(fieldData.componentType===FormConstants.FieldType.CHECK_BOX&&(value=fieldData.componentValueDisp),"P_Employee"==tableName&&"Employeestatus"==labelName&&(value=ZSEC.Encoder.encodeForHTML(value)),fieldData.componentType){case FormConstants.FieldType.ADDRESS:let childValObj=fieldData.childValues,addressfieldHtml=ZP5Form.AddressField.getAddressDisplayHtml(childValObj);fieldObj.html(addressfieldHtml);break;case FormConstants.FieldType.CURRENCY:case FormConstants.FieldType.NUMBER:case FormConstants.FieldType.DECIMAL:value=fieldData.dispVal,fieldObj.html("<span>"+ZP5Form.Field.getNoValueString(value)+"</span>");break;case FormConstants.FieldType.TIME_ZONE:value=fieldData.dispname,fieldObj.html("<span>"+ZP5Form.Field.getNoValueString(value)+"</span>");break;case FormConstants.FieldType.URL:fieldObj.html('<span><a rel="noreferrer" href="'+value+'" target="_blank">'+ZP5Form.Field.getNoValueString(value)+"</span>");break;case FormConstants.FieldType.DATE_TIME:var val=ZPeople.decodeTxt(value);val=ZPUtil.Validation.isEmpty(val)?ZP5Form.Field.getNoValueString(val):Calendar.convertTo12Hours(val),fieldObj.html("<span>"+val+"</span>");break;case FormConstants.FieldType.EMAIL_ADDRESS:this.PRINT?fieldObj.addClass("ZPMail"):fieldObj.find("span").addClass("ellipsis ZPMail"),fieldObj.html("<span "+ComponentsCommon.getTooltipHtml(value,{position:"bottom"},!0)+">"+ZP5Form.Field.getNoValueString(value)+"</span>");break;case FormConstants.FieldType.FILE_UPLOAD:downloadParams={fcId:fcId,recordId:this.getFormsProperties().getRecordId(),formId:this.getFormsProperties().getFormId(),original:"true"};fieldData.uploadSource=void 0!=fieldData.componentValue_uploadSource?fieldData.componentValue_uploadSource:"",fieldObj.html(ZP5Form.FILEUPLOAD_IMAGES.constructFileFieldHtml(tableName,fieldData,fieldData.componentValue_filePath,value,downloadParams,this.PRINT));break;case FormConstants.FieldType.MULTI_FILE_UPLOAD:for(i=0;i<value.length;i++){compval=(val=value[i]).componentValue+"";if(ZPUtil.Validation.isEmpty(compval))fieldObj.html(ZP5Form.Field.getNoValueString(compval));else if(compval=compval.replace("Cropped",""),"#performance/myreview/selfappraisal-mode:revhistory"==Layout.Page.hash){let submode="myratings";fieldObj.html("<span><a onclick=\"window.open('"+val.componentValue_downloadUrl+"&submode="+submode+'\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(compval)+"</span>")}else 0==i?fieldObj.html("<span><a onclick=\"window.open('"+val.componentValue_downloadUrl+'\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(compval)+"</span><br>"):fieldObj.append("<span><a onclick=\"window.open('"+val.componentValue_downloadUrl+'\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(compval)+"</span><br>")}break;case FormConstants.FieldType.IMAGE:downloadParams={fcId:fcId,recordId:this.getFormsProperties().getRecordId(),formId:this.getFormsProperties().getFormId(),original:"false"};fieldObj.html(ZP5Form.FILEUPLOAD_IMAGES.constructImageFieldHtml(labelName,tableName,value,downloadParams,fieldData.componentValue_uploadSource,fieldData.componentValue_filePath,this.isEditMode(),!1,this.PRINT));break;case FormConstants.FieldType.SOCIAL_SECURITY_NUMBER:fieldObj.html("<span>"+ZP5Form.Field.formatSSNValue(value)+"</span>");break;default:if("P_HR_Case"==this.getTableName()){var content=ZPFeeds.Activity.validateContent(value,!1,null);fieldObj.html("<span>"+content+"</span>")}else if("AddedLOC"==labelName){var infoDetails=this.getRecordDetails().record.message.cAuditInfo;fieldObj.html(ZP5Form.Field.constructSystemAddressField(value,infoDetails.cgeoInfo.lat,infoDetails.cgeoInfo.lon,!1,this.PRINT))}else if("ModifiedLOC"==labelName){infoDetails=this.getRecordDetails().record.message.cAuditInfo;fieldObj.html(ZP5Form.Field.constructSystemAddressField(value,infoDetails.mgeoInfo.lat,infoDetails.mgeoInfo.lon,!1,this.PRINT))}else{let val="<span>"+ZP5Form.Field.getNoValueString(value)+"</span>";fieldObj.html(val),this.moduleHandler.fieldValueHandler(tableName,fieldData)}}let isEditHoverAllowed=!1,isMaskHoverAllowed=!1;if(this.isFormFieldEditable&&fieldData.isEditable&&fieldData.componentType!==FormConstants.FieldType.PLAIN_TEXT&&fieldData.componentType!==FormConstants.FieldType.AUTONUMBER&&fieldData.componentType!==FormConstants.FieldType.SCRIPT&&fieldData.componentType!==FormConstants.FieldType.MULTI_FILE_UPLOAD&&ZPA_BPOperation.fieldEditCriteria(this,fieldData)&&!isReadOnlyField&&("P_Employee"!==tableName&&"P_Candidate"!==tableName||"P_Employee"===tableName&&(("EmailID"!=labelName||"P_Employee"!=tableName||ZP5Form.Employee.isAllowedToEditEmailId()||ZP5Form.Employee.isAllowedToeditPendingUserMail())&&"EmailID"===labelName||"Role"===labelName&&this.isRecordAdmin()||"EmailID"!==labelName&&"Role"!==labelName)||"P_Candidate"==tableName&&("Email_ID"!==labelName||ZP5Form.Employee.isNonUser()))&&(isEditHoverAllowed=!0),!this.PRINT&&formC.isMask&&this.isViewMode()&&($(fieldObj).find(":first").addClass("zpl_DNI").attr("mask","value"),fieldObj.append("<span mask='star'>"+FormConstants.MASK.PLACEHOLDER+"</span>"),isMaskHoverAllowed=!0),isEditHoverAllowed||isMaskHoverAllowed){let fieldClassObj=this;fieldObj.parent().off("mouseenter").on("mouseenter",function(){fieldClassObj.showOption(this,isEditHoverAllowed)}).off("mouseleave").on("mouseleave",function(){fieldClassObj.hideOption(this)})}fieldObj.parent().data(fieldData)}}void 0!==fieldData.componentValue_RelatedFields&&this.setRelatedFieldsData(fieldData.componentValue_RelatedFields,fcId)}}getSingleFieldFormat(value,manClass,fieldObj,isRelFieldEnabled,isFieldDependent,isModeChange,isDraftEditedField,rowNo,rowId){let readonlyclas="",inputDivClass="";isModeChange&&(readonlyclas=" disabled"),(ZP5Form.DROPDOWN_DISPLAY_FIELDS.includes(fieldObj.displayType)||ZP5Form.DROPDOWN_TYPE_FIELDS.includes(fieldObj.fieldType))&&(inputDivClass="ovh");var editedCls="";isDraftEditedField&&(editedCls="dr-label"),fieldObj.fieldType==FormConstants.FieldType.ADDRESS&&(editedCls="zpl_addlds");let{infoHtml:infoHtml,toolTip:toolTip,ephiHTML:ephiHTML}=this.isViewMode()?{infoHtml:"",toolTip:"",ephiHTML:""}:ZP5Form.Field.getFieldIconsHTML(fieldObj,rowNo,this.getInfoToolTipObj(),!1),singlefieldObj='<div fieldouter="true" class="zpl_secn '+readonlyclas+" "+editedCls+'" isAllowed="false"><div><label elem="labelName" class="'+manClass+'">'+fieldObj.displayName+"</label>"+ZP5Form.Field.getPrimaryLookupHtml(fieldObj)+ephiHTML+'<span elem="viewToolTip">'+infoHtml+'</span></div> <div folabel="'+fieldObj.labelName+'" '+(inputDivClass?'class="'+inputDivClass+'"':"")+' fieldtype="'+fieldObj.fieldType+'" '+(void 0!==fieldObj.displayType?'displaytype="'+fieldObj.displayType+'"':"")+' id="zp_field_outer_'+fieldObj.formComponentId+'"  '+(void 0!==fieldObj.isSpecialHandling?'isspecialhandling="'+fieldObj.isSpecialHandling+'"':"")+' relateddata="'+isRelFieldEnabled+'" isFieldDependent="'+isFieldDependent+'">';if("-1"!=Layout.Page.hash.indexOf("compensatory")&&(singlefieldObj='<div fieldouter="true" class="zpl_secn '+readonlyclas+'" isAllowed="false"><div><label class="'+manClass+'">'+fieldObj.displayName+"</label>"+ZP5Form.Field.getPrimaryLookupHtml(fieldObj)+'<span elem="viewToolTip">'+infoHtml+'</span></div> <div class="zpl_ilnegap '+inputDivClass+'" folabel="'+fieldObj.labelName+'" fieldtype="'+fieldObj.fieldType+'" '+(void 0!==fieldObj.displayType?'displaytype="'+fieldObj.displayType+'"':"")+' id="zp_field_outer_'+fieldObj.formComponentId+'"  '+(void 0!==fieldObj.isSpecialHandling?'isspecialhandling="'+fieldObj.isSpecialHandling+'"':"")+' relateddata="'+isRelFieldEnabled+'" isFieldDependent="'+isFieldDependent+'">'),fieldObj.fieldType!=FormConstants.FieldType.FILE_UPLOAD&&fieldObj.fieldType!=FormConstants.FieldType.IMAGE||void 0!=fieldObj.fileId||void 0==fieldObj.filePath&&""==fieldObj.filePath||(fieldObj.fileId=fieldObj.filePath),this.isViewMode()){let fieldHtml="<span>"+ZP5Form.Field.getNoValueString(value)+"</span>",downloadParams={fcId:fieldObj.formComponentId,recordId:rowId,formId:this.getFormsProperties().getFormId(),original:"true"},tableName=this.getTableName();!this.PRINT&&fieldObj.isMask&&(fieldHtml='<span mask="value" class="zpl_DNI">'+ZP5Form.Field.getNoValueString(value)+'</span><span mask="star">'+FormConstants.MASK.PLACEHOLDER+"</span>"),fieldObj.fieldType==FormConstants.FieldType.FILE_UPLOAD&&fieldObj.isTabular?fieldHtml=ZP5Form.FILEUPLOAD_IMAGES.constructFileFieldHtml(tableName,fieldObj,fieldObj.filePath,value,downloadParams,this.PRINT):fieldObj.fieldType==FormConstants.FieldType.IMAGE&&fieldObj.isTabular&&(downloadParams.original=!1,fieldHtml=ZP5Form.FILEUPLOAD_IMAGES.constructImageFieldHtml(fieldObj.labelName,tableName,value,downloadParams,fieldObj.uploadSource,fieldObj.filePath,!1,!1,this.PRINT)),singlefieldObj+=fieldHtml}else singlefieldObj+=this.createField(fieldObj,value,"",rowNo,singlefieldObj,toolTip),singlefieldObj+=ZP5Form.Field.isQuickAddForm(fieldObj,fieldObj.isTabular);return singlefieldObj+="</div></div>"}createField(fieldDtl,value,editedFieldsCls,rowNo,singlefieldObj,toolTip){if(void 0===fieldDtl)return;let tableName=this.getTableName();editedFieldsCls=void 0==editedFieldsCls?"":editedFieldsCls,value=void 0===value?"":value;let fieldId="zp_field_";fieldDtl.isTabular&&(fieldId+=this.getRandomNumber()+"_"),fieldId+=fieldDtl.formComponentId;let fieldHtml="";toolTip=void 0!=toolTip?toolTip:"";let fldCreateFun=this.getCreateFldFunctions();if(void 0!==fldCreateFun&&void 0!==fldCreateFun[fieldDtl.labelName]&&"function"==typeof fldCreateFun[fieldDtl.labelName])return fieldObj=fieldHtml=fldCreateFun[fieldDtl.labelName](fieldDtl,"ADD",void 0!==fieldDtl.description&&""!==fieldDtl.description.trim()?'title="'+fieldDtl.description+'"':"",this,singlefieldObj);switch(fieldDtl.fieldType){case FormConstants.FieldType.LOOKUP:case FormConstants.FieldType.PICKLIST:case FormConstants.FieldType.BLOODGROUP:case FormConstants.FieldType.GENDER:case FormConstants.FieldType.STATES:case FormConstants.FieldType.TIME_ZONE:case FormConstants.FieldType.COUNTRY:case FormConstants.FieldType.NEW_COUNTRY:case FormConstants.FieldType.NEW_BLOODGROUP:case FormConstants.FieldType.NEW_GENDER:if(fieldDtl.fieldType!=FormConstants.FieldType.LOOKUP||fieldDtl.displayType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE||fieldDtl.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE||this.moduleHandler.isfieldTreatAsPicklist(fieldDtl.labelName)){if(fieldDtl.displayType===FormConstants.FieldType.SELECT_DISPLYTYPE||fieldDtl.fieldType===FormConstants.FieldType.BLOODGROUP||fieldDtl.fieldType===FormConstants.FieldType.GENDER||fieldDtl.fieldType===FormConstants.FieldType.COUNTRY||fieldDtl.fieldType===FormConstants.FieldType.STATES||fieldDtl.fieldType===FormConstants.FieldType.TIME_ZONE||fieldDtl.fieldType===FormConstants.FieldType.NEW_COUNTRY||fieldDtl.fieldType===FormConstants.FieldType.NEW_BLOODGROUP||fieldDtl.fieldType===FormConstants.FieldType.NEW_GENDER)return'<div><input zcomponentname="select" class="select-js" id="'+fieldId+'" fcid="'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" name="'+fieldDtl.labelName+'" '+(fieldDtl.fieldType===FormConstants.FieldType.STATES?'refCountryId="'+fieldDtl.RefCountryId+'"':"")+' value="'+value+'"></input></div>';if(fieldDtl.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE)return'<div fieldtype="'+fieldDtl.fieldType+'">'+this.getOptionsByType(fieldDtl,value)+"</div>";if(fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE)return'<div ><select zcomponentname="tokenfield" fcid="'+fieldDtl.formComponentId+'" class="select-js" id="'+fieldId+'" fieldtype="'+fieldDtl.fieldType+'" name="'+fieldDtl.labelName+'" multiple="multiple">'+this.getOptionsByType(fieldDtl,value,void 0,void 0,!0)+"</select></div>";if(fieldDtl.displayType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE)return'<div fieldtype="'+fieldDtl.fieldType+'">'+this.getOptionsByType(fieldDtl,value)+"</div>"}else if(fieldDtl.fieldType==FormConstants.FieldType.LOOKUP){let componentType=fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE?"tokenfield":"select";value=this.getDefaultLookupValue(fieldDtl,value);var fieldObj='<div><input zcomponentname="'+componentType+'"multi="'+(fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE)+'" fcid="'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" id="'+fieldId+'" value="'+value+'" name="'+fieldDtl.labelName+'" class="select-js" '+(fieldDtl.disabled?"disabled=disabled":"")+"></input></div>";return fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&(fieldObj='<div><select zcomponentname="'+componentType+'"multi="'+(fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE)+'" fcid="'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" id="'+fieldId+'" value="'+value+'" name="'+fieldDtl.labelName+'" class="select-js" '+(fieldDtl.disabled?"disabled=disabled":"")+">"+this.getOptionsByType(fieldDtl,value,void 0,void 0,!0)+"</select></div>"),fieldObj}break;case FormConstants.FieldType.TEXT_AREA:return"<div><textarea "+toolTip+' fieldtype="'+fieldDtl.fieldType+'" id="'+fieldId+'" class="ztextbox '+editedFieldsCls+'" autoresize="true" name="'+fieldDtl.labelName+'" rows="5" style="height: 75px;">'+value+"</textarea></div>";case FormConstants.FieldType.DATE:case FormConstants.FieldType.DATE_TIME:return fieldObj='<div><input zcomponentname="'+(fieldDtl.fieldType==FormConstants.FieldType.DATE?"datefield":"datetimefield")+'" fieldtype="'+fieldDtl.fieldType+'"  autofillby="'+fieldDtl.autofillBy+'" id="'+fieldId+'" type="text"  name="'+fieldDtl.labelName+(fieldDtl.hasOwnProperty("isleave")?'" autocomplete="off" placeholder="'+fieldDtl.displayName:"")+'" class="datepicker-js" data-picker="true" data-calendar-icon="true" data-clear-button="none" data-spin-buttons="none" value="'+value+'"/></div>';case FormConstants.FieldType.CHECK_BOX:return'<div class="zcheckbox"><input class="zcheckbox__helper" type="checkbox"  id="'+fieldId+'"  name="'+fieldDtl.labelName+'" '+("true"===value?"checked=checked":"")+'/><label class="zcheckbox__label" for="'+fieldId+'"><span class="zcheckbox__text">&nbsp;</span></label></div>';case FormConstants.FieldType.CURRENCY:return'<div class="ztextbox--group ztextbox--zicon"><i class="ztextbox__icon">'+fieldDtl.currencyType+"</i><input "+toolTip+'fieldtype="'+fieldDtl.fieldType+'" id="'+fieldId+'" type="text" name="'+fieldDtl.labelName+'" class="ztextbox" value="'+value+'"/></div>';case FormConstants.FieldType.ADDRESS:var childJsonObj=fieldDtl.childFcObj,address1Obj=childJsonObj.ADDRESS1,address2Obj=childJsonObj.ADDRESS2,cityObj=childJsonObj.CITY,pincodeObj=childJsonObj.PINCODE;childJsonObj.STATE,childJsonObj.COUNTRY,fieldObj="<div class='d-flexclmcap'>";if(!this.isSingleFiledEdit()&&("P_Employee"==tableName||"P_Candidate"==tableName)&&"Permanent_Address"==fieldDtl.labelName){var presentObj=ZP5Form.Field.getFieldComponentByLabel("Present_Address",this.getFormsProperties().getFormId());void 0!=presentObj&&0!==presentObj.editperm&&(fieldObj+='<div class="zcheckbox"><input type="checkbox" id="copyAddrChk" class="zcheckbox__helper" name="chk1" onclick="ZP5Form.AddressField.copyAddress(this)"/><label class="zcheckbox__label" for="copyAddrChk"><span class="zcheckbox__text">'+ZPI18N.getString("zp.address.copypresenttopermanent",[presentObj.displayName])+"</span></label></div>")}let addrfieldHtml='<div><input name="'+fieldDtl.labelName+'" style="display:none"></input><input placeholder="'+address1Obj.displayName+'" class="ztextbox" name="'+FormConstants.AddressField.COLUMNAMEARRAY[0]+'"></input></div><div><input placeholder="'+address2Obj.displayName+'" class="ztextbox" name="'+FormConstants.AddressField.COLUMNAMEARRAY[1]+'"></input></div>';return addrfieldHtml=(addrfieldHtml=addrfieldHtml+'<div class="zpl_ilnegap"><div><input placeholder="'+cityObj.displayName+'" class="ztextbox" name="'+FormConstants.AddressField.COLUMNAMEARRAY[2]+'"></input></div></div>')+'<div class="zpl_ilnegap"><div><input class="select-js" name="'+FormConstants.AddressField.COLUMNAMEARRAY[3]+'"></input></div><div><input class="select-js" name="'+FormConstants.AddressField.COLUMNAMEARRAY[4]+'"></input></div></div>',fieldObj+=(addrfieldHtml+='<div><input name="'+FormConstants.AddressField.COLUMNAMEARRAY[5]+'" placeholder="'+pincodeObj.displayName+'" class="ztextbox"></input></div>')+"</div>";case FormConstants.FieldType.FILE_UPLOAD:case FormConstants.FieldType.IMAGE:let{isWDAllowedForModules:isWDAllowedForModules=!0,isCloudAllowedForModules:isCloudAllowedForModules=!0}=this.moduleHandler.setUploadSource(fieldDtl);var reqUrl=ZPeople.cloudPickerGadgetsUrl+encodeURIComponent("?fcId="+fieldDtl.formComponentId);if(fieldHtml=fieldDtl.isTabular&&fieldDtl.isGridType?"-"==value||""==value?'<div class="zpl_upld zpl_upldmin"><div class="zpl_atchd atsml DNI" id="afterUpload"></div><div  id="beforeUpload" class="zpl_fldrp"><h5><a class="zpl_lnk" name="fileuploadelem"><i class="PI_desktop"></i>'+ZPI18N.getString("zp.files.desktop")+'<input type="file" elem="fileuploadinput" style="display:none" onchange="'+(UDS_UPLOAD_IS_ACTIVE&&!this.isPreviewForm()?"ZP5Form.uploadViaXHRs(this)":"")+'" class="" fieldtype="'+fieldDtl.fieldType+'" id="'+fieldId+'" isTabular="'+fieldDtl.isTabular+'" value="'+value+'" type="file" name="'+fieldDtl.labelName+'"/><input type="hidden" value="'+value+'" id="filename"/></a>':'<div class="zpl_upld zpl_upldmin DNI"><div class="zpl_atchd atsml DNI" id="afterUpload"></div><div id="beforeUpload" class="zpl_fldrp"><h5><a class="zpl_lnk" name="fileuploadelem"><i class="PI_desktop"></i>'+ZPI18N.getString("zp.files.desktop")+'<input type="file" elem="fileuploadinput" style="display:none" onchange="'+(UDS_UPLOAD_IS_ACTIVE&&!this.isPreviewForm()?"ZP5Form.uploadViaXHRs(this)":"")+'" class="" fieldtype="'+fieldDtl.fieldType+'" id="'+fieldId+'" isTabular="'+fieldDtl.isTabular+'" value="'+fieldDtl.fileId+'" type="file" name="'+fieldDtl.labelName+'"/><input type="hidden" value="'+fieldDtl.fileId+'" id="filename"/></a>':'<div class="zpl_upld fldupld '+("-"==value||""==value?"":"DNI")+'"><div class="zpl_atchd atsml DNI" id="afterUpload"></div><div id="beforeUpload" class="zpl_fldrp"><h5><div class="zpl_flupld_img"></div>'+ZPI18N.getString("zp.files.attach")+" "+ZPI18N.getString("zp.files.from")+'<a class="zpl_lnk" name="fileuploadelem"><i class="PI_desktop"></i>'+ZPI18N.getString("zp.files.desktop")+'<input type="file" elem="fileuploadinput" style="display:none" onchange="'+(UDS_UPLOAD_IS_ACTIVE&&!this.isPreviewForm()?"ZP5Form.uploadViaXHRs(this)":"")+'" class="" fieldtype="'+fieldDtl.fieldType+'" id="'+fieldId+'" isTabular="'+fieldDtl.isTabular+'" value="'+fieldDtl.fileId+'" type="file" name="'+fieldDtl.labelName+'" /><input type="hidden" value="'+(void 0!=fieldDtl.fileId?fieldDtl.fileId:"")+'" id="filename"/></a>',isWDAllowedForModules&&isWorkdriveAllowed&&isAuthreq&&("undefined"==typeof ZPPreboarding||!ZPPreboarding.isPreBoarding)&&(fieldHtml+="/<a class=\"zpl_lnk\" onclick=\"ZP5Form.FILEUPLOAD_IMAGES.showWorkDriveModal('Forms', '"+fieldDtl.formComponentId+"',this,'"+(fieldDtl.fieldType===FormConstants.FieldType.IMAGE)+'\')"><i class="PI_workdrive zpl_icnobg"></i>'+ZPI18N.getString("zp.workdrive")+"</a>"),!isCloudAllowedForModules||ZPeople.isChinaSetup||"undefined"!=typeof ZPPreboarding&&ZPPreboarding.isPreBoarding||!isAuthreq||(fieldHtml+='/<a class="zpl_lnk" onclick="ZP5Form.FILEUPLOAD_IMAGES.showCloudPickerModal(\''+reqUrl+"','"+fieldDtl.formComponentId+'\',this)"><i class="PI_cloud"></i>'+ZPI18N.getString("zp.others")+"</a>"),fieldHtml+="</h5></div>"+(fieldDtl.isTabular?"":'<p elem="pre-info">'+(fieldDtl.fieldType===FormConstants.FieldType.IMAGE?"<span>"+ZPI18N.getString("zp.filessuported")+": "+ZP5Form.FILEUPLOAD_IMAGES.ALLOWED_IMAGE_FORMAT.toString().toUpperCase().replaceAll(",",", ")+"</span>":"")+"<span>"+ZPI18N.getString("zp.maxfileuploadsize",[fieldDtl.maxSize])+"</span></p>")+"</div>",fieldDtl.tabularfileupload&&"-"!=value&&""!=value){var downloadParams={fcId:fieldDtl.formComponentId,recordId:fieldDtl.recordId,formId:this.getFormsProperties().getFormId(),original:"true"},fileExtn="";-1!=value.lastIndexOf(".")&&(fileExtn=(fileExtn=value.substr(value.lastIndexOf(".")+1,value.length)).toLowerCase());let fieldObj={originalFileName:value,fileExtn:fileExtn,onclickfunc:"window.open('"+ZP5Form.constructDownloadLink(downloadParams)+"');",isViewFile:!0,filepath:fieldDtl.fileId};"1"==fieldDtl.uploadSource?fieldObj.onclickfunc="window.open('"+fieldDtl.filePath+"');":void 0!=fieldDtl.filePath&&(fieldDtl.filePath.indexOf(workDriveUrl)>-1||fieldDtl.filePath.indexOf(writerUrl)>-1||fieldDtl.filePath.indexOf(sheetUrl)>-1||fieldDtl.filePath.indexOf(showUrl)>-1)?fieldObj.onclickfunc="window.open('"+fieldDtl.filePath+"');":1==isPreviewAllowed&&null!=fileExtn&&void 0!=fileExtn&&""!=fileExtn&&-1!=ZP5Form.PreviewSupportedFileTypes.indexOf(fileExtn)&&(fieldObj.onclickfunc="ZP5Form.FILEUPLOAD_IMAGES.showPreview(this,'"+encodeURIComponent(JSON.stringify(downloadParams))+"')"),fieldHtml+='<div id="zp_form_fileuploadfield" class="zpl_atchd atsml">'+this.constructFileEditHtml(fieldObj)+"</div>"}return"<div>"+fieldHtml+"</div>";case FormConstants.FieldType.MULTI_FILE_UPLOAD:reqUrl=ZPeople.cloudPickerGadgetsUrl+encodeURIComponent("?fcId="+fieldDtl.formComponentId);return fieldHtml='<div><div class="ZPUFile"><div class="" id="beforeUpload"><span>'+ZPI18N.getString("zp.files.attach")+" "+ZPI18N.getString("zp.files.from")+' </span><div class="ZPCfile"><span>'+ZPI18N.getString("zp.files.desktop")+'</span><div class="ZPFfile OH"><input type="file" multiple class=" form-control '+editedFieldsCls+'" fieldtype="'+fieldDtl.fieldType+'" id="'+fieldId+'" value="'+value+'" type="file" name="'+fieldDtl.labelName+'"/></div></div>'+(void 0!=ZPPreboarding&&ZPPreboarding.isPreBoarding||this.isEmbedForm&&!isAuthreq?"":'<span class="dgry ML2 MR2">'+ZPI18N.getString("zp.files.smallor")+"</span><a onclick=\"ZP5Form.FILEUPLOAD_IMAGES.showCloudPickerModal('"+reqUrl+"','"+fieldDtl.formComponentId+"',this)\">"+ZPI18N.getString("zp.files.cloud")+"</a>")+'<div class="zpmulti-fl" id="multiuploadName"></div></div><div class="zpmulti-fl DNI" id="afterUpload"></div></div></div>';case FormConstants.FieldType.TIME_FIELD:return fieldHtml='<div><div class="zptime"><input name="'+fieldDtl.labelName+'" isTimeField="true" fcid="'+fieldDtl.formComponentId+'" id="timePicker_'+fieldDtl.formComponentId+'" class="form-control zptxt-edit dropdown '+editedFieldsCls+'" data-toggle="dropdown" aria-expanded="false" type="text"/></div></div>',ZP5Form.time_Field_Prop[fieldDtl.formComponentId]=fieldDtl,fieldHtml;case FormConstants.FieldType.SOCIAL_SECURITY_NUMBER:case FormConstants.FieldType.ITIN:return fieldHtml=`<div><input multi="${fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE}" fcid="${fieldDtl.formComponentId}" fieldtype="${fieldDtl.fieldType}" onkeyup="ZP5Form.Field.applyMaskForField(event,this,'+fieldDtl.fieldType+')" id="${fieldId}" value="${value}" type="text" name="${fieldDtl.labelName}" class="ztextbox" ${fieldDtl.disabled?"disabled=disabled":""} maxlength="${FormConstants.MAX_LENGTH.SOCIAL_SECURITY_NUMBER}" ${""==toolTip?`placeholder="${FormConstants.PLACEHOLDER.SOCIAL_SECURITY_NUMBER}"`:toolTip} /></div>`;case FormConstants.FieldType.SCRIPT:return"<span>-</span>";default:let lookupclass="ztextbox",phoneNoclass="",countryCodeDiv="",isDialCodeEnabled="Mobile"===fieldDtl.labelName&&("P_Employee"==tableName||"P_Candidate"==tableName);return fieldDtl.fieldType===FormConstants.FieldType.LOOKUP&&(value=this.getDefaultLookupValue(fieldDtl,value),lookupclass="select-js"),isDialCodeEnabled&&(phoneNoclass="zpl_flglst",countryCodeDiv='<input zcomponentname="select" class="select-js" id="phone_ctry_'+fieldDtl.formComponentId+'" fcid="'+fieldDtl.formComponentId+'" phone_ctry="true"></input>'),fieldObj='<div class="'+phoneNoclass+'">'+countryCodeDiv+"<input "+toolTip+' multi="'+(fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE)+'" fcid="'+fieldDtl.formComponentId+'" fieldtype="'+fieldDtl.fieldType+'" id="'+fieldId+'" value="'+value+'" type="text" name="'+fieldDtl.labelName+'" class="'+lookupclass+'" '+(fieldDtl.disabled?"disabled=disabled":"")+"/></div>"}}getDefaultLookupValue(fieldDtl,selValue){var isPrimary=fieldDtl.isPrimary||this.moduleHandler.isPrimary(fieldDtl);if(isPrimary){var addOpt=fieldDtl.AddOptions,permission=this.FormOperations.getAddPerm();this.isEditMode()&&(permission=this.FormOperations.getEditPerm()),4!==permission&&0!==permission&&this.isAddMode()&&(selValue=ZPeople.CURR_USER.usererec),this.isAddMode()&&null!=this.primLkpVal&&(selValue=this.primLkpVal),this.getParams().lookupValue&&"Employee_ID"===fieldDtl.labelName&&(selValue=-1!=Layout.Page.hash.indexOf("selfservice/leave/list")||-1!=Layout.Page.hash.indexOf("selfservice/user/calendar")?this.getParams().lookupValue:"attendance-entry-summary"===Layout.Page.pageId||Layout.Page.pageId.indexOf("selfservice")?Attendance.Entry.erecno?Attendance.Entry.erecno:ZPeople.CURR_USER.usererec:ZPDashboard.getUserId()),!selValue&&this.isAddMode()&&$.each(addOpt,function(){if(this.Id==ZPeople.CURR_USER.usererec)return selValue=this.Id,!1})}!this.isrelformrelfields&&!this.getParams().isFromSelfService||!this.isAddMode()||this.relfcid!=fieldDtl.formComponentId||isPrimary&&this.isPrimLkpChange||(selValue=this.selValue);let moduleDefaultVal=this.moduleHandler.getDefaultValue(fieldDtl);return null!=moduleDefaultVal&&(selValue=moduleDefaultVal),parseInt(fieldDtl.displayType)!==FormConstants.FieldType.SELECT_DISPLYTYPE||void 0!=selValue&&""!=selValue.trim()||(selValue="-Select-"),selValue}processViewEditRecordDetails(){var singleRec=this.getRecordDetails(),params=("null"!=singleRec.record.agreeid&&singleRec.record.agreeid,this.getRecordParams());this.processViewEditLayout(singleRec.record,params)}processViewEditLayout(resultData,params){if(7040===resultData.code)return this.LAYOUT.find("#footer").remove(),this.LAYOUT.find("#ZP_Form_MoreOpt").addClass("zpl_DNI"),void ZP5Form.showErrMsg(resultData.message);let recDtl=resultData,formCompData=this.FormOperations.getFormComponentData(),formId=this.getFormsProperties().getFormId(),recordId=this.getFormsProperties().getRecordId();formCompData.message.relatedFields;var isDraft=resultData.message.isDraft;if(7e3===recDtl.code){if(this.isEditMode()){if(!(isDraft||(this.isPermitted(this.FormOperations.getEditPerm())||resultData.isAllowedEditFromNode)&&ZP5Form.isApprovalStarted(formId,recordId)||this.ISBLUEPRINT||ZP5Form.isApprover()||ZP5Form.isTaskOwnerCanEdit(formId)||this.isResubmit()||this.moduleHandler.isModuleAdmin()))return void ZPOnboarding.getViewMode();-1!==Layout.Page.hash.indexOf("hrcase/")&&HRCases.viewNotesComments(resultData)}var ul=Layout.Page.container.find("#zp_cbutton_list");if(ul.html(""),void 0!==recDtl.message.customActions&&0!==recDtl.message.customActions.length?(Layout.Page.container.find("#zp_cbutton").removeClass("hide"),recDtl.message.customActions.length>1?Layout.Page.container.find("#zp_cbutton").addClass("more"):Layout.Page.container.find("#zp_cbutton").removeClass("more"),$.each(recDtl.message.customActions,function(i,cusbtnObj){var onClkMtd="CustomAction.triggerCB('"+cusbtnObj.customActionId+"','"+params.recordId+"','"+cusbtnObj.type+"')";if(0===i){var cbName=ZPeople.decodeTxt(cusbtnObj.name);Layout.Page.container.find("#zpcbnbtn").attr("onClick",onClkMtd).attr("title",cbName).text(cbName)}else ul.append('<li><a title="'+cusbtnObj.name+'" href="javascript:;" onClick="'+onClkMtd+'">'+cusbtnObj.name+"</a></li>")}),recDtl.message.customActions.length>1?Layout.Page.container.find("#zpcbnbtn_vmore").removeClass("DN"):Layout.Page.container.find("#zpcbnbtn_vmore").addClass("DN")):Layout.Page.container.find("#zp_cbutton").addClass("hide"),ZP5Form.isOrgValuePresent.entityPresent||ZP5Form.isOrgValuePresent.unitPresent||ZP5Form.isOrgValuePresent.divisionPresent||ZP5Form.isOrgValuePresent.deptPresent?(ZP5Form.isOrgValuePresent.entityFieldPresent||(this.LAYOUT.find("#headerParent").find("#orgstructuremodel").find("#orgentity").addClass("DN"),this.LAYOUT.find("#headerParent").find("#orgstructuremodel").find("#orgentity").next().addClass("DN")),ZP5Form.isOrgValuePresent.unitFieldPresent||(this.LAYOUT.find("#headerParent").find("#orgstructuremodel").find("#orgunit").addClass("DN"),this.LAYOUT.find("#headerParent").find("#orgstructuremodel").find("#orgunit").next().addClass("DN")),ZP5Form.isOrgValuePresent.divFieldPresent||(this.LAYOUT.find("#headerParent").find("#orgstructuremodel").find("#orgdivi").addClass("DN"),this.LAYOUT.find("#headerParent").find("#orgstructuremodel").find("#orgdivi").next().addClass("DN"))):this.LAYOUT.find("#headerParent").find("#orgstructuremodel").remove(),this.LAYOUT.data("record",resultData),this.isViewMode()&&!this.isDraftrec&&(params.isApprovalEnabled||void 0!=resultData.approvalDetails||"P_EmployeeLeave"===this.getTableName())&&(this.LAYOUT.find("#headerApprovalBtn").addClass("zpl_DNI"),("P_EmployeeLeave"!==this.getTableName()||!resultData.extraDetails.isabsentRecord&&(params.isApprovalEnabled||2==recDtl.message.approvalStatus))&&!this.moduleHandler.approvalFooter(recDtl.message.approvalStatus,resultData))){recDtl&&recDtl.message&&(OPApprovals.Common.RecordOwner.setOwner(recordId,recDtl.message.ownerID),recDtl.message.cAuditInfo&&recDtl.message.cAuditInfo.cInfo&&recDtl.message.cAuditInfo.cInfo.user&&recDtl.message.cAuditInfo.cInfo.user.ERECNO&&OPApprovals.Common.RecordOwner.setAddedBy(recordId,recDtl.message.cAuditInfo.cInfo.user.ERECNO));let apprParam=new ApprovalParam(formId,recordId,this.getTableName(),recDtl.message.approvalStatus,this.isRecordAdmin());apprParam.setApprovalSettings(ZP5Form.getFormsOperation(formId).getApprovalSettingsDetails());let layoutParam=new LayoutParam(this.LAYOUT,this.LAYOUT.find("#zp_form_header"),this.FOOTER,"Forms");new ApprovalRecordHeader(apprParam,layoutParam,{isRecordApprover:recDtl.isRecordApprover,isPrimaryApprover:recDtl.isPrimaryAppr}).show()}void 0!=resultData.extraDetails&&"P_HR_Case"==resultData.extraDetails.tablename&&HRCaseForm.fillDetailViewPage(resultData.extraDetails),"P_Employee"==this.getTableName()&&Layout.Page.childUrlParam&&"true"==Layout.Page.childUrlParam.showApprovalPopUp&&ZPReview.bulkForwardFormPopUp()}else isDraft||"P_Employee"===this.getTableName()&&ZP5Form.Permission.isSub(recordId)||(ZP5Form.showErrMsg(resultData.message),Layout.Page.container.find("#ZP_Form_MoreOpt").addClass("zpl_DNI"));"P_Employee"===this.getTableName()&&this.isViewMode()&&void 0!==recDtl&&!0===recDtl.pendingEmployee&&(ZPeople.ISUNCONFIRMEDACC?ZPeople.Message.warning(ZPI18N.getString("zp.inviteuncnfrmdforms")):ZPeople.Message.warning(ZPI18N.getString("zp.pendinginvite"))),ZP5Form.IS_SUBMIT=!1,void 0!==resultData.treeObj&&null!=resultData.treeObj&&Profile.loadTree(resultData.treeObj),!this.isViewMode()&&!this.isEditMode()||this.PRINT||(this.isViewMode()&&isOrgStructureEnabled&&("P_Employee"===this.getTableName()||0===this.getTableName().indexOf("dc_"))&&ZP5Form.handleOrgStructureFieldInViewMode(),ZPFRulesNew.Evaluation.LAYOUT=this.LAYOUT,ZPFRulesNew.Evaluation.isViewMode=!!this.isViewMode(),ZPFRulesNew.Evaluation.readOnlyFields=this.getParams().readOnlyFields,ZPFRulesNew.Evaluation.evaluateRulesForAllFields())}getTabularGridHeaders(fieldsLst){var headerHtml="<thead><tr>";let tabularSortHtml,isViewMode=!!this.isViewMode(),isSortAllowed=isViewMode&&!this.PRINT,mouseOverHtml=this.PRINT?"":'onmouseover="FrameworkCommon.mouseEnterFunction()"';for(let[fieldIndex,fieldObj]of fieldsLst.entries())if(tabularSortHtml="",fieldObj.fieldType===FormConstants.FieldType.SCRIPT&&(fieldObj.editperm=fieldObj.viewperm,fieldObj.allowedRoleIdsForEdit=fieldObj.allowedRoleIdsForView),(!this.isSingleFieldModal||!fieldObj.isNonDependentField)&&(!this.isAddMode()||null==this.primLkpType||fieldObj.componentType===FormConstants.FieldType.PLAIN_TEXT||this.isPermAllowed(this.primLkpType,fieldObj.editperm,fieldObj.allowedRoleIdsForEdit))){var temMode=this.getMode();if(this.isEditMode()&&this.setAsViewMode(),this.isAddMode()&&(fieldObj.editperm>FormConstants.Permission.VAL.NO_DATA||fieldObj.allowedRoleIdsForEdit.length>0||null==this.primLkpType&&this.FormOperations.isOperationalRoleAdmin()||this.moduleHandler.gridTabularHeaderAllowed())||!this.isAddMode()&&this.isPermitted(fieldObj.viewperm,fieldObj.allowedRoleIdsForEdit,fieldObj.allowedRoleIdsForView)){ZP5Form.MODE=temMode;this.fieldType;this.fieldType==FormConstants.FieldType.SCRIPT&&this.formulaFieldType;let{infoHtml:infoHtml}=isViewMode?{infoHtml:""}:ZP5Form.getToolTipHtml(fieldObj.formComponentId,fieldObj.description,fieldObj.descriptionType,"TABULAR-GRID",void 0,!0,this.getInfoToolTipObj());if(fieldObj.fieldType!=FormConstants.FieldType.ADDRESS){isSortAllowed&&fieldObj.fieldType!=FormConstants.FieldType.IMAGE&&fieldObj.fieldType!=FormConstants.FieldType.FILE_UPLOAD&&(tabularSortHtml=`<div class="zpl_icncnt" elem="sorticn"><i class="PI_sort" fcId="${fieldObj.formComponentId}" fcType="${fieldObj.fieldType}" onclick="ZP5Form.sortTable()"></i></div>`);let maskHtml="";!this.PRINT&&isViewMode&&fieldObj.isMask&&(maskHtml=`<i class="PI_eye CP" masked="true" mask="hdr_${fieldIndex}"></i>`),headerHtml+=`<th fcid="${fieldObj.formComponentId}" folabel="${fieldObj.labelName}"><div><span ${mouseOverHtml} ${!isViewMode&&fieldObj.isMandatory?'class="zpl_mtry"':""}>${fieldObj.displayName}</span><div class="zpl_tblinfo">${infoHtml}${maskHtml}</div>${tabularSortHtml}</div></th>`}else{var childObject=fieldObj.childFcObj,parentObj=fieldObj;let containsChildMandatory=!1;parentObj.isMandatory&&$.each(FormConstants.AddressField.COLUMNAMEARRAY,function(index,value){return!(containsChildMandatory=childObject[value].ismandatory)}),$.each(FormConstants.AddressField.COLUMNAMEARRAY,function(index,value){isSortAllowed&&(tabularSortHtml=`<div class="zpl_icncnt" elem="sorticn"><i class="PI_sort" fcid="${fieldObj.formComponentId}" fctype="${fieldObj.fieldType}" fclabel="${value}" onclick="ZP5Form.sortTable()"></i></div>`);var currChildObj=childObject[value],childDisplayName=currChildObj.displayName+"("+parentObj.displayName+")";let showMandatoryClass=!isViewMode&&parentObj.isMandatory&&(!containsChildMandatory||currChildObj.ismandatory)&&"ADDRESS2"!=value;headerHtml+=`<th fcid="${currChildObj.formComponentId}" folabel="${currChildObj.labelName}"><div><span ${mouseOverHtml} ${showMandatoryClass?'class="zpl_mtry"':""}>${childDisplayName}</span>${0==index?infoHtml:""}${tabularSortHtml}</div></th>`})}}this.getFormsProperties().setMode(temMode)}return this.isViewMode()||(headerHtml+='<th class="mw80 w80"></th>'),headerHtml+="</tr></thead>"}constructTabularGridRows(tabularRowHtml,tabularObj,tabularComponent,rows,hasRow,ownerIds,secTableObj,sortParams){var tableBody=tabularRowHtml.find("tbody");let paginationType=this.FormOperations.getPaginationType();var index=0,isSort=void 0!=sortParams&&sortParams.isSort;if(this.isViewMode()&&0===tabularObj.noOfRows)tableBody.append("<tr><td colspan='"+tabularRowHtml.find("thead th").length+"'><div class='zpl_Emptydata'><div><p>"+ZPI18N.getString("zp.norowsfound")+"</p></div></div></td></tr>"),tabularRowHtml.find("thead th [elem=sorticn]").remove(),this.PRINT||tabularRowHtml.find("[mask^=hdr_]").remove();else{let trObj="";var tabularEditPerm=this.isPermitted(tabularComponent.editPermVal,tabularComponent.editPermObj,tabularComponent.editPermObj),recordIdArray=tabularObj.recordIdArray;for(index=0;index<rows;index++){var style="";this.isViewMode()&&index>3&&0==paginationType&&!this.PRINT&&(style+=" DN");var recIdIndex=tabularObj.recordIdArray.indexOf(isSort?sortParams.sortedValueList[index]:recordIdArray[index]);tabularObj.datarows[recIdIndex];hasRow||(tabularEditPerm=!0),trObj="<tr id = 'zp_tabular_row' class='"+style+"' istabroweditable='"+tabularEditPerm+"' row='"+(tabularEditPerm?index+1:0)+"' "+(hasRow?"rowid='"+tabularObj.recordIdArray[recIdIndex]+"' secid='"+tabularObj.sectionId+"'":"")+">",trObj+=this.getTabularColumn(tabularComponent.column1,tabularObj.sectionId,tabularObj,ownerIds,recIdIndex,index),trObj+="</tr>",tableBody.append(trObj)}if((this.isSingleFieldModal||!hasRow)&&this.isEditMode()&&0==$(trObj).find(":input").length)return}if(this.isViewMode()&&void 0!==tabularObj.summationRowValues&&tabularObj.summationRowValues.length>0){style="",this.isViewMode()&&index>4&&0==this.FormOperations.getPaginationType()&&!this.PRINT&&(style+=" DN",index++);let sumObj='<tr id="zp_forms_summationrow" class="'+style+'">',self=this;$.each(tabularObj.summationRowValues,function(ind,value){let colspan="";tabularObj.componentTypes[ind]==FormConstants.FieldType.ADDRESS&&(colspan="colspan="+FormConstants.AddressField.COLUMNAMEARRAY.length),self.PRINT||!ZP5Form.Field.getFieldComponent(tabularObj.formComponentIds[ind]).isMask||ZPUtil.Validation.isEmpty(value)?sumObj+="<td "+colspan+' folabel="'+tabularObj.labelnameheaders[ind]+'">'+(ZPUtil.Validation.isEmpty(value)?"":"<b>"+value+"</b>")+"</td>":sumObj+=`<td ${colspan} folabel="${tabularObj.labelnameheaders[ind]}"><b mask="star_${ind}">${FormConstants.MASK.PLACEHOLDER}</b><b class="zpl_DNI" mask="value_${ind}">${value}</b></td>`}),sumObj+="</tr>",tableBody.append(sumObj)}secTableObj.append(tabularRowHtml),this.isViewMode()&&index>4&&0==paginationType&&!this.PRINT&&(secTableObj.append('<div class="zpl_secn"><a id="tabShowMorebtn" secid="'+tabularObj.sectionId+'" onclick="ZP5Form.expandTabluarSection(this,true)">'+ZPI18N.getString("zp.showmore")+"</a></div>"),secTableObj.find("table").addClass("hidetbl-lst"))}checkTabularSectionHasRow(rows,tabularComponent){let hasRow=!0;if(0===rows){if(!this.isViewMode()&&!this.isPermitted(tabularComponent.addPermVal,tabularComponent.addPermObj,tabularComponent.addPermObj))return{isRestricted:!0};rows=1,hasRow=!1}return{rows:rows,hasRow:hasRow}}setValuesForTabularSection(tabularObj,ownerIds,index){let tabularComponent=ZP5Form.getSectionComponent(this.FormOperations.getFormComponentData().message.formComponentDetails,tabularObj.sectionId);if(tabularComponent){var secTableObj,{rows:rows,hasRow:hasRow,isRestricted:isRestricted}=this.checkTabularSectionHasRow(tabularObj.noOfRows,tabularComponent);if(!isRestricted){if(tabularObj.isGridType){secTableObj=this.FIELD_LAYOUT.find("#zp_section_fields_"+tabularObj.sectionId);var tabularRowHtml=$('<div class="zpl_secn"><div class="zpl_tblovh"><div class="zpl_tblres"><table class="zpl_tbl zpl_tabularfxd zpl_tblvtop zpl_nocrsor">'+this.getTabularGridHeaders(tabularComponent.column1)+'<tbody id="zp_forms_tabluar_'+tabularObj.sectionId+'"></tbody></table></div></div></div>');this.PRINT||ZP5Form.gridDataMask(tabularRowHtml,!1),this.constructTabularGridRows(tabularRowHtml,tabularObj,tabularComponent,rows,hasRow,ownerIds,secTableObj)}else{secTableObj=this.FIELD_LAYOUT.find("#zp_section_fields_parent_"+tabularObj.sectionId);var secComp=tabularComponent,tabEditPerm=this.isPermitted(secComp.editPermVal,secComp.editPermObj,secComp.editPermObj);hasRow||(tabEditPerm=!0),secTableObj.html("");for(let rowNo=0;rowNo<rows;rowNo++){let recordviewcls="zpl_frmclm zpl_frmclmview";this.isViewMode()||(recordviewcls="zpl_frmclm zpl_frmclmlst zpl_frmtblinln");let childSecObj=$('<div id="zp_section_fields_'+secComp.sectionId+'" istabroweditable="'+tabEditPerm+'" secid="'+tabularObj.sectionId+'" class="'+recordviewcls+'" '+(hasRow?"rowid='"+tabularObj.recordIdArray[rowNo]+"'":"")+' row="'+(tabEditPerm?rowNo+1:0)+'" istabular="true" isgrid="'+tabularObj.isGridType+'" name="sections_obj"></div>');var rowId=tabularObj.recordIdArray[rowNo];let children1=void 0!==tabularObj.column1?this.getFieldFormat(secComp.column1,secComp.isGridType,tabularObj.sectionId,tabularObj.column1,rowNo,void 0,rowId,tabEditPerm):"",children2=void 0!==tabularObj.column2?this.getFieldFormat(secComp.column2,secComp.isGridType,tabularObj.sectionId,tabularObj.column2,rowNo,void 0,rowId,tabEditPerm):"";childSecObj.append(this.appendColumns(children1,children2)),childSecObj.append('<span class="zpl_hvr">'+(this.isPermitted(secComp.deletePermVal,secComp.deletePermObj,secComp.deletePermObj)||this.isAddMode()?'<i class="PI_delete DNI" id="zp_form_deletetabular_row" secId="'+secComp.sectionId+'"></i>':"")+"</span>"),secTableObj.append(childSecObj);let self=this;secTableObj.find("[fieldouter]").off("mouseenter").on("mouseenter",function(){self.showOption(this,!1)}).off("mouseleave").on("mouseleave",function(){self.hideOption(this)})}if((this.isSingleFieldModal||!hasRow)&&this.isEditMode()&&0==$(secTableObj).find(":input").length)return void secTableObj.html("")}secTableObj.find("[isallowed=false]").attr("isallowed",!0),this.initZComponents(secTableObj,tabularObj.sectionId,void 0,!1)}}}sortTableRows({secId:secId,fcId:fcId,fieldType:fieldType,fclabel:fclabel},isAsc){fieldType=parseInt(fieldType);var tabularComponent=ZP5Form.getSectionComponent(this.FormOperations.getFormComponentData().message.formComponentDetails,secId),secDataObj=this.getSingleFieldRecordDetails(secId),valueIndex=secDataObj.formComponentIds.indexOf(fcId),rowValueArr=[],rowIdValueArr=[],rowIdNext=0;$.each(secDataObj.datarows,function(){var curDataVal="";if(fieldType===FormConstants.FieldType.NUMBER&&""==this[valueIndex]){var dupIndex=0;return isAsc||(dupIndex=rowValueArr.length),rowValueArr.splice(dupIndex,0,curDataVal),rowIdValueArr.splice(dupIndex,0,secDataObj.recordIdArray[rowIdNext]),void rowIdNext++}fieldType===FormConstants.FieldType.NUMBER||fieldType===FormConstants.FieldType.CURRENCY||fieldType===FormConstants.FieldType.DECIMAL?curDataVal=parseInt(this[valueIndex]):fieldType===FormConstants.FieldType.DATE||fieldType===FormConstants.FieldType.DATE_TIME?""!=this[valueIndex]&&(curDataVal=Calendar.parseDate(ZPeople.decodeTxt(this[valueIndex]),uidateFormat,fieldType===FormConstants.FieldType.DATE_TIME)):curDataVal=fieldType===FormConstants.FieldType.LOOKUP||fieldType===FormConstants.FieldType.NEW_GENDER||fieldType===FormConstants.FieldType.NEW_BLOODGROUP||fieldType===FormConstants.FieldType.NEW_COUNTRY?ZPeople.decodeTxt(this[valueIndex].Value).toLowerCase():fieldType===FormConstants.FieldType.ADDRESS?ZPeople.decodeTxt(this[valueIndex][fclabel]).toLowerCase():ZPeople.decodeTxt(this[valueIndex]).toLowerCase();var lastIndex=0;$.each(rowValueArr,function(){fieldType===FormConstants.FieldType.NUMBER&&""==this||(isAsc?curDataVal>=this&&lastIndex++:curDataVal<=this&&lastIndex++)}),rowValueArr.splice(lastIndex,0,curDataVal),rowIdValueArr.splice(lastIndex,0,secDataObj.recordIdArray[rowIdNext]),rowIdNext++});var ownerIds=ZP5Form.getSingleRecord().record.message.ownerID;let secTableObj=this.LAYOUT.find("#zp_section_fields_"+secId),toolTipObj=this.getInfoToolTipObj();$.each(secTableObj.find('[id^="multiLinepopover_"]'),function(){toolTipObj.destroyTooltips({id:$(this).attr("id"),isSpecific:!0})}),secTableObj.find("tbody").html(""),secTableObj.find("#tabShowMorebtn").parent().remove();let{rows:rows,hasRow:hasRow,isRestricted:isRestricted}=this.checkTabularSectionHasRow(rowIdValueArr.length,tabularComponent);isRestricted||(this.constructTabularGridRows(secTableObj,secDataObj,tabularComponent,rows,hasRow,ownerIds,secTableObj,{isSort:!0,sortedValueList:rowIdValueArr}),this.PRINT||(secTableObj.find("[mask^=hdr_]").each(function(){"true"==$(this).attr("masked")?$(this).attr("masked",!1):$(this).attr("masked",!0)}),secTableObj.find("[mask^=hdr_]").trigger("click")),toolTipObj.constructTooltips(),ZPFRulesNew.Evaluation.evaluateRulesForAllFields())}addTabularSectionRow(sectionId,isFirst){var secComp=ZP5Form.getSectionComponent(this.FormOperations.getFormComponentData().message.formComponentDetails,sectionId);if(!this.isPermitted(secComp.addPermVal,secComp.addPermObj,secComp.addPermObj))return!1;var secHtmlObj,prevSecObj=this.FIELD_LAYOUT.find("[id=zp_section_fields_"+sectionId+"]:last"),rowCnt=parseInt(prevSecObj.attr("row"))+1;if(secComp.isGridType)rowCnt=parseInt(prevSecObj.find("#zp_forms_tabluar_"+sectionId).children("tr:last").attr("row"))+1,isNaN(rowCnt)&&(rowCnt=1),secHtmlObj=$(this.getFieldFormat(secComp.column1,secComp.isGridType,sectionId,void 0,rowCnt,!0)).attr("row",rowCnt),secHtmlObj=ZPFRulesNew.hideFields(secHtmlObj,prevSecObj),prevSecObj.find("#zp_forms_tabluar_"+sectionId).append(secHtmlObj);else{prevSecObj=this.FIELD_LAYOUT.find("[id=zp_section_fields_parent_"+sectionId+"]"),isFirst&&(rowCnt=1);let recordviewcls="zpl_frmclm zpl_frmclmview";this.isViewMode()||(recordviewcls="zpl_frmclm zpl_frmclmlst zpl_frmtblinln"),secHtmlObj=$('<div id="zp_section_fields_'+sectionId+'" secid="'+sectionId+'" class="'+recordviewcls+'" isgrid="false" istabular="true" row = "'+rowCnt+'" name="sections_obj" class="'+recordviewcls+'"></div>');let children1=this.getFieldFormat(secComp.column1,secComp.isGridType,sectionId,void 0,rowCnt,!0),children2=this.getFieldFormat(secComp.column2,secComp.isGridType,sectionId,void 0,rowCnt,!0);secHtmlObj.append(this.appendColumns(children1,children2)),secHtmlObj.append('<span class="zpl_hvr"><i class="PI_delete DNI" id="zp_form_deletetabular_row" secid="'+sectionId+'"></i></span>'),secHtmlObj=ZPFRulesNew.hideFields(secHtmlObj,prevSecObj),isFirst?prevSecObj.html(secHtmlObj):prevSecObj.append(secHtmlObj)}this.initZComponents(secHtmlObj,sectionId,void 0,!0),secHtmlObj.find('[id^="zp_field_"]').on("change",e=>{this.fieldValueChangeFunc(e)}),this.registerFieldChangeFun(secHtmlObj,!0),this.getInfoToolTipObj().constructTooltips()}removeTabularRow(delObj){this.iscancelmsgact=!0;var secId=$(delObj).attr("secId");let delObjparent,secObj=this.LAYOUT.find("#zp_section_fields_"+secId),isGrid=secObj.attr("isgrid"),formsClassObj=this,targetObj="true"==isGrid?$(delObj).closest("tr"):$(delObj).closest("[id^='zp_section_fields_']"),rowNum=targetObj.attr("row");if($.each(targetObj.find("[zcomponentname]"),function(){formsClassObj.destroyZComponents($(this))}),$.each(targetObj.find(`input[fieldtype=${FormConstants.FieldType.FILE_UPLOAD}],input[fieldtype=${FormConstants.FieldType.IMAGE}]`),function(){ZP5Form.Field.removeFileUploadDoc($(this).closest("[id^='zp_field_outer_']").attr("folabel"),rowNum)}),"true"==isGrid)targetObj.remove(),delObjparent=secObj.find("tbody").children("tr");else{delObjparent=secObj.parent();let tooltipObj=this.getInfoToolTipObj();$.each(targetObj.find('[id^="infoTooltip_"]'),function(){tooltipObj.destroyTooltips({id:$(this).attr("id"),isSpecific:!0})}),targetObj.remove(),delObjparent=delObjparent.children()}var row=1;($.each(delObjparent,function(){"false"!=$(this).attr("istabroweditable")&&($(this).attr("row",row),row+=1)}),0===delObjparent.length)&&(0==this.addTabularSectionRow(secId,!0)&&this.FIELD_LAYOUT.find("#zp_section_fields_"+secId).closest(".zpl_crd").remove())}isSectionFieldAllowForConstruction(mode,dataObject,isTabRowAdd){let isAllow=!0,tableName=this.getTableName();switch(mode){case"Fields":let isviewforquickAdd=!1,isviewforquickAddreffcid=!1,isDisplayField=!1;if(this.isQuickAdd&&(isDisplayField=!0,(!dataObject.isMandatory||"P_TimesheetJob"==tableName&&"Assignees"==dataObject.labelName)&&(isviewforquickAdd=!0),(dataObject.formComponentId!=this.reffcid||"P_TimesheetJob"==tableName&&"Assignees"==dataObject.labelName)&&(isviewforquickAddreffcid=!0),this.displayFields)){let displayFields=this.displayFields;for(var i=0;i<displayFields.length;i++)displayFields[i]==dataObject.formComponentId&&(isDisplayField=!1)}!this.isEditMode()&&!this.isViewMode()||dataObject.isTabular||void 0!=this.getSingleFieldRecordDetails(dataObject.formComponentId)||"P_PerformanceAppraisal"==tableName&&dataObject.fieldType==FormConstants.FieldType.PLAIN_TEXT?isTabRowAdd&&this.isEditMode()&&!this.isPermitted(dataObject.editperm,dataObject.allowedRoleIdsForEdit,dataObject.allowedRoleIdsForView)?isAllow=!1:this.isAddMode()&&(null!=this.primLkpType&&!dataObject.isPrimary&&!this.isPermAllowed(this.primLkpType,dataObject.editperm,dataObject.allowedRoleIdsForEdit)||null==this.primLkpType&&!this.FormOperations.isOperationalRoleAdmin()&&!this.moduleHandler.isModuleAdmin({isTTCustAdminOnlyNeed:!0})&&0==dataObject.editperm&&dataObject.allowedRoleIdsForEdit.length<=0)?isAllow=!1:dataObject.isReadOnly&&this.isAddMode()?isAllow=!1:void 0===dataObject||isviewforquickAdd&&isviewforquickAddreffcid&&isDisplayField?isAllow=!1:this.moduleHandler.isFieldNotAllowForConstruction(dataObject.labelName)&&(isAllow=!1):isAllow=!1;break;case"Section":!dataObject.hasField||!dataObject.isFieldEditable&&this.isAddMode()||dataObject.isTabular&&this.isQuickAdd?isAllow=!1:null!=this.primLkpType&&this.isAddMode()&&!this.checkSectionEditableWithPerm(dataObject)?isAllow=!1:this.isAddMode()&&dataObject.isTabular&&null!=this.primLkpType&&!this.isPermitted(dataObject.addPermVal,dataObject.addPermObj,dataObject.addPermObj)&&(isAllow=!1);break;default:return!0}return isAllow}checkSectionEditableWithPerm(secObj){var isAllowed=!1;let formsClassObj=this;return void 0!==secObj.column1&&secObj.column1.length>0&&$.each(secObj.column1,function(index,fieldData){if(isAllowed=(!formsClassObj.isQuickAdd||fieldData.isMandatory||formsClassObj.reffcid==fieldData.formComponentId)&&(fieldData.isPrimary||formsClassObj.isPermAllowed(formsClassObj.primLkpType,fieldData.editperm,fieldData.allowedRoleIdsForEdit)))return!isAllowed}),!isAllowed&&void 0!==secObj.column2&&secObj.column2.length>0&&$.each(secObj.column2,function(index,fieldData){if(isAllowed=(!formsClassObj.isQuickAdd||fieldData.isMandatory||formsClassObj.reffcid==fieldData.formComponentId)&&(fieldData.isPrimary||formsClassObj.isPermAllowed(formsClassObj.primLkpType,fieldData.editperm,fieldData.allowedRoleIdsForEdit)))return!isAllowed}),isAllowed}validateAndSubmit(isconfictvalidated){if(!this.moduleHandler.validate())return;this.getTableName();if(this.IS_SUBMIT=!0,this.IS_CONFLICT_CHANGES_VALIDATED=isconfictvalidated,(void 0==this.IS_CONFLICT_CHANGES_VALIDATED||!this.IS_CONFLICT_CHANGES_VALIDATED)&&this.isEditMode()&&!this.isDraft&&!ZP5Form.isAllowedToEdit(this.getMode(),this.getFormsProperties().getFormId())&&void 0!=this.EDITED_FIELDS&&this.EDITED_FIELDS.length>0){let alertMessageObj=new InfoAlertMessage(ZPI18N.getString("zp.confirm"),ZPI18N.getString("zp.confverifiedmsg"));return alertMessageObj.yesButtonText=ZPI18N.getString("zp.yes"),alertMessageObj.cancelButtonText=ZPI18N.getString("zp.no"),alertMessageObj.setCallback(()=>{ZP5Form.Record.verifiedConflictConfm()}),void alertMessageObj.show()}var formObj=this.LAYOUT,result=ZP5Form.Validation.validateForm(this);if(ZP5Form.Record.TABULAR_PARAMS={},result.errorList.length>0)return ZP5Form.Validation.resetFormError(this.FIELD_LAYOUT),void ZP5Form.Validation.showFormFieldError(result.errorList);ZP5Form.Validation.resetFormError(this.FIELD_LAYOUT);var params=result.params;if(this.isQuickAdd&&(params.isQuickAdd=!0,params.lookupID=this.lookupfcid),formObj.find(":input[type=hidden][id!=filename]").each(function(){var paramName=$(this).attr("name");void 0!==paramName&&(params[paramName]=$(this).val())}),void 0===params.zp_tableName&&void 0!=this.getTableName()&&(params.zp_tableName=this.getTableName()),this.moduleHandler.loadParamsForSubmit(params),"P_Employee"===params.zp_tableName&&this.getParams().forwardErecno&&(params.forwardErecno=this.getParams().forwardErecno),OPApprovals.Forms.validateAndGetChosenApprover(this,formObj,params))if(this.LAYOUT.find("[istabular=true]").each(function(){var isGrid=$(this).attr("isgrid"),secId=$(this).attr("secid"),rowArray=new Array;if(params[secId+"_rowid"]&&(rowArray=JSON.parse(params[secId+"_rowid"])),"true"===isGrid)$.each($(this).find("tr[rowid]"),function(){var rowid=$(this).attr("rowid");if(secId=$(this).attr("secid"),void 0!==rowid)if("false"==$(this).attr("istabroweditable")){var row1Array=new Array;params[secId+"_res_rowid"]&&(row1Array=JSON.parse(params[secId+"_res_rowid"])),row1Array.push(rowid),params[secId+"_res_rowid"]=JSON.stringify(row1Array)}else rowArray.push(rowid)});else{var rowid=$(this).attr("rowid");if(void 0!==rowid)if("false"==$(this).attr("istabroweditable")){var row1Array=new Array;params[secId+"_res_rowid"]&&(row1Array=JSON.parse(params[secId+"_res_rowid"])),row1Array.push(rowid),params[secId+"_res_rowid"]=JSON.stringify(row1Array)}else rowArray.push(rowid)}rowArray.length>0&&(params[secId+"_rowid"]=JSON.stringify(rowArray))}),this.isEmbedForm||-1===Layout.Page.hash.indexOf("#performance/myteam/review")||void 0===params.islocallysaved||"true"!==params.islocallysaved&&!0!==params.islocallysaved?(this.LAYOUT.find("#zp_forms_add_btn").addClass("disabled"),this.LAYOUT.find("#zp_forms_addnew_btn").addClass("disabled"),this.LAYOUT.find("#zp_forms_savedraft_btn").addClass("disabled")):this.LAYOUT.find("#zp_forms_draft_btn").addClass("disabled"),isWebForm&&(result.params=applyWebFormParams(result.params)),ZP5Form.Record.PARAMS[this.getFormsProperties().getFormId()]=params,this.isDraft||!ZP5Form.isAllowedToEdit(this.getMode(),this.getFormsProperties().getFormId())||this.ISBLUEPRINT)this.FIELD_LAYOUT.find("input[type=file]").length>0?this.uploadFiles():this.addUpdateRecord();else{var key="zp.editapprovalconfirmmsg";if(this.FormOperations.getApprovalSettingsDetails().isVerifySend&&(key="zp.editapprsendconfirmmsg"),this.isEditMode()&&void 0!=this.EDITED_FIELDS&&this.EDITED_FIELDS.length>0){key="zp.confverifiedapprovalmsg";this.FormOperations.getApprovalSettingsDetails().isVerifySend&&(key="zp.confverifiedapprovalsendmsg")}let alertMessageObj=new InfoAlertMessage(ZPI18N.getString("zp.confirm"),ZPI18N.getString(key));alertMessageObj.yesButtonText=ZPI18N.getString("zp.confirm"),alertMessageObj.setCallback(()=>{this.FIELD_LAYOUT.find("input[type=file]").length>0?this.uploadFiles():this.addUpdateRecord()}),alertMessageObj.setCloseCallback(()=>{this.LAYOUT.find("#zp_forms_add_btn").removeClass("disabled")}),alertMessageObj.show()}}uploadFiles(isSingleEdit){let container=this.LAYOUT;if(!UDS_UPLOAD_IS_ACTIVE&&container.find("[name=zp_form_fileupload]").find("input[type=file]").length>0||this.getUploadedFiles().cloudUpload.length>0||this.getUploadedFiles().wdUpload.length>0){var fUpForm=container.find("[name=zp_form_fileupload]");if(fUpForm.find('input[name="formId"]').length<=0&&(this.isEmbedForm&&!isAuthreq?(fUpForm.append('<input type="hidden" value="'+Embed_ZUIDENRYPT+'" name="loginUserZUID"/>'),fUpForm.append('<input type="hidden" value="'+Embed_digest+'" name="digest"/>')):(fUpForm.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),fUpForm.append('<input type="hidden" value="'+_ZUIDENRYPT+'" name="loginUserZUID"/>')),fUpForm.append('<input type="hidden" value="'+this.getFormsProperties().getFormId()+'" name="formId"/>'),fUpForm.append('<input type="hidden" value="true" name="needJSONresponse"/>')),fUpForm.find('input[name="uploadFromCloud"]').length>0&&fUpForm.find('input[name="uploadFromCloud"]').remove(),fUpForm.find('input[name="uploadFromWD"]').length>0&&fUpForm.find('input[name="uploadFromWD"]').remove(),this.getUploadedFiles().cloudUpload.length>0&&fUpForm.append('<input type="hidden" value=\''+ZWAF.Encoder.encodeForHTMLAttribute(JSON.stringify(this.getUploadedFiles().cloudUpload))+'\' name="uploadFromCloud"/>'),this.getUploadedFiles().wdUpload.length>0&&fUpForm.append('<input type="hidden" value=\''+ZWAF.Encoder.encodeForHTMLAttribute(JSON.stringify(this.getUploadedFiles().wdUpload))+'\' name="uploadFromWD"/>'),isSingleEdit){let fcId=this.getSingleFieldEditFcid(),result={errorList:[],params:{isSingleEdit:!0,fcId:fcId}};if(ZP5Form.Validation.validate(this,[ZP5Form.Field.getFieldComponent(fcId)],!1,result),result.errorList.length>0)return void this.revertSingleEdit(result.errorList)}fUpForm.trigger("submit")}else isSingleEdit?this.submit():this.addUpdateRecord()}addUpdateRecord(latLanObj){var params=ZP5Form.Record.PARAMS[this.getFormsProperties().getFormId()];if(void 0!==params){if(!this.moduleHandler.preaddUpdateCallBack(params,()=>{this.addUpdateRecord()},()=>{this.resetAddUpdateRecordProcess()}))return;var isLocationTrackingEnabled=!1;if(this.FormOperations.getFormsDetailsMap()&&(isLocationTrackingEnabled=this.FormOperations.getFormsDetailsMap().isLocationTrackingEnabled),isLocationTrackingEnabled){if(void 0===latLanObj)return void FrameworkCommon.Location.fetch((data,latLanObj)=>{data.formClassObj.addUpdateRecord(latLanObj)},{formClassObj:this});if(!latLanObj.isPermEnabled)return ZPeople.Message.failure(ZPI18N.getString("zp.enableaccesstolocation")),void this.LAYOUT.find("#zp_forms_add_btn").removeClass("disabled");params.latitude=latLanObj.locData.latitude,params.longitude=latLanObj.locData.longitude,params.accuracy=latLanObj.locData.accuracy}if(!this.moduleHandler.validateAddUpdateRecordParams(params))return;let url=this.moduleHandler.getSubmitUrl();if(this.isSingleFieldModal){var fieldsStr="";let fieldcontainer=this.FIELD_LAYOUT,singleFields=this.singleFieldModalFields;for(let currSingleModelFcid of singleFields){var currSingleModelFcDetails=this.getSingleFieldData(currSingleModelFcid);if(void 0!=currSingleModelFcDetails){var currSingleModelFcLabelName=currSingleModelFcDetails.labelName,formField=fieldcontainer.find(":input[name="+currSingleModelFcLabelName+"]");if(currSingleModelFcDetails.fieldType==FormConstants.FieldType.ADDRESS&&(formField=currSingleModelFcDetails.isTabular&&currSingleModelFcDetails.isGridType?fieldcontainer.find("[parentfcid="+currSingleModelFcDetails.formComponentId+"]"):fieldcontainer.find("[folabel="+currSingleModelFcDetails.labelName+"]")),0===formField.length||!(0==this.LAYOUT.find("#zp_field_id_"+currSingleModelFcid).length||"true"===this.LAYOUT.find("#zp_field_id_"+currSingleModelFcid).attr("fieldSelect")&&this.LAYOUT.find("#zp_field_outer_"+currSingleModelFcid).parent().is(":visible")))continue;if(currSingleModelFcDetails.fieldType===FormConstants.FieldType.AUTONUMBER||currSingleModelFcDetails.fieldType===FormConstants.FieldType.PLAIN_TEXT)continue;fieldsStr+=currSingleModelFcid+","}}fieldsStr=fieldsStr.substr(0,fieldsStr.length-1),params.fcId=fieldsStr,params.isSingleEdit=!0}if(isOnboarding&&(params.isOnboarding=isOnboarding),this.isSubmitMsgAct&&(this.isAddMode()||this.isDraftrec&&this.isEditMode())&&this.moduleHandler.needNoChangesAlert())return ZPeople.Message.failure(ZPI18N.getString("zp.nochangesmade")),this.LAYOUT.find("#zp_forms_add_btn").removeClass("disabled"),this.LAYOUT.find("#zp_forms_addnew_btn").removeClass("disabled"),void this.LAYOUT.find("#zp_forms_savedraft_btn").removeClass("disabled");if(this.isEmbedForm&&!isAuthreq&&(params.digest=Embed_digest,params.loginUserZUID=Embed_LOGGEDIN_ZUID),this.isEmbedForm)ZPeople.Request.send(url,params,(resultData,params)=>{this.addUpdateRecordResponse(resultData,params)},void 0,()=>{this.addUpdateFailureCallback()});else{params.isDraft=this.isDraft,params.isResubmit=this.isResubmit(),this.isResubmit()&&(params.zp_prevRecordId=this.getFormsProperties().getRecordId());let callbackobj=this.moduleHandler.getAddUpdateRecordCallback(params);if(null!=callbackobj){let{successCallback:successCallback,failureCallback:failureCallback,otherDetails:otherDetails,method:method}=callbackobj;void 0!=method?ZPeople.Request.sendRequest(url,params,method,successCallback,otherDetails,failureCallback):ZPeople.Request.send(url,params,successCallback,otherDetails,failureCallback)}else this.ISBLUEPRINT&&(params.transitionRelId=ZPA_BPOperation.TransitionRelId,params.modBpTime=ZPA_BPOperation.BLUEPRINT_RECORD_DTL[this.getFormsProperties().getFormId()+"_"+this.getFormsProperties().getRecordId()].TransitionDetails.ClientModifiedTime,params.isBlueprint=!0),ZPeople.Request.send(url,params,(resultData,params)=>{this.addUpdateRecordResponse(resultData,params)},void 0,()=>{this.addUpdateFailureCallback()})}}}addUpdateRecordResponse(resultData,params){this.resetAddUpdateRecordProcess();let formParams=this.getParams();var succObj=resultData[0];if(void 0!=succObj.code&&succObj.code===FormConstants.RECORD.SUCCESS_CODE){let warningMsg,msgKey=ZP5Form.MessageKeys.Success.ADD_RECORD,isWarning=!1,isModified=void 0==succObj.isModified||succObj.isModified;if(this.iscancelmsgact=!1,this.isEmbedForm)return this.isEmbedForm=!1,isAuthreq=!0,void(this.moduleHandler.embedFormSuccessCallback(resultData,params,isModified)&&$("body").html(ZP5Form.EMBED_FORM_SUCCESS_PAGE));if(isWebForm&&void 0!==this.getParams().webFormSubmitCallback&&("people"==this.getParams().webFormServiceName?(succObj.isDraft=params.isDraft,this.getParams().webFormSubmitCallback(resultData)):this.getParams().webFormSubmitCallback({pkId:resultData[0].pkId,code:resultData[0].code,message:resultData[0].message})),ZP5Form.isFromSubmit=!0,isModified&&!isWebForm&&ZP5Views.refreshAllViews(params.zp_formId),params.isDraft?(msgKey=ZP5Form.MessageKeys.Success.ADD_DRAFT,1==this.FormOperations.getPaginationType()&&(ZP5Form.lastActiveSec=this.LAYOUT.find("#zp_form_section_list").find(".zpl_act").attr("secid")),params.zp_mode===FormConstants.RECORD.MODE.UPDATE&&ZP5Form.refreshRecord(params.zp_formId,params.zp_recordId)):params.zp_mode===FormConstants.RECORD.MODE.UPDATE?(1==this.FormOperations.getPaginationType()&&(ZP5Form.lastActiveSec=this.LAYOUT.find("#zp_form_section_list").find(".zpl_act").attr("secid")),msgKey=ZP5Form.MessageKeys.Success.UPDATE_RECORD,isModified?(ZP5Form.isApprovalEnabled(this.getParams().formId)&&this.FormOperations.getApprovalSettingsDetails()&&(this.FormOperations.getApprovalSettingsDetails().isEditAllow||this.FormOperations.getApprovalSettingsDetails().isVerifySend)&&OPApprovals.refreshApprovalData(this.getParams().recordId),ZP5Form.refreshRecord(params.zp_formId,succObj.pkId)):(msgKey=ZP5Form.MessageKeys.Success.NO_MOD_UPDATE_REC,isWarning=!0)):"attendance-entry-summary"===Layout.Page.pageId&&$(Attendance.Entry.LayoutId+" #ZPAtt_allEntries_popup").find(".close").trigger("click"),params.isDraft||void 0==succObj.warningMsg||""==succObj.warningMsg||(warningMsg=succObj.warningMsg,isWarning=!0),this.moduleHandler.showSuccessMessage(msgKey,isWarning,{warningMsg:warningMsg,result:resultData,params:params}),this.moduleHandler.successCallback(resultData,params,isModified),formParams.successCallback&&formParams.successCallback(this),formParams.afterSuccessResponseCallback&&"function"==typeof formParams.afterSuccessResponseCallback)formParams.afterSuccessResponseCallback(this,succObj,params);else if(this.addUpdateAfterSuccessResponse(resultData,params,formParams,isModified))return}else{this.ISBLUEPRINT&&void 0!==formParams.failureCallback&&"function"==typeof formParams.failureCallback?formParams.failureCallback(this,resultData,params):this.moduleHandler.failureCallback(resultData,params);let failureMsg=this.moduleHandler.getFailureMessage(resultData,params);void 0!=failureMsg&&"string"==typeof failureMsg&&""!=failureMsg.trim()?ZPeople.Message.failure(failureMsg):void 0!=failureMsg&&"function"==typeof failureMsg?failureMsg(resultData,params):(void 0==failureMsg||"boolean"==typeof failureMsg&&!failureMsg)&&ZP5Form.Validation.showFormFieldError(resultData,succObj.code)}}addUpdateFailureCallback(){this.moduleHandler.addUpdateFailureCallback(),this.resetAddUpdateRecordProcess(),ZPeople.Message.failure(ZPI18N.getString("zp.internalservererror"))}addUpdateAfterSuccessResponse(resultData,params,formParams,isModified){let succObj=resultData[0];if(this.isQuickAdd){let quickAddResponseCallback=this.moduleHandler.quickAddResponseCallback();return this.closeCallback(this),quickAddResponseCallback(this,resultData,params),!0}if(this.isrelformrelfields)return this.setRefreshRelatedForm(!0),this.closeCallback(this),!0;if(this.isfromrelfieldedit)return this.closeCallback(this),isModified&&(ZP5Form.getFormClassObj().setRefreshRelatedForm(!0),ZP5Form.getFormClassObj().refreshPage(ZP5Form.getFormClassObj().getParams())),!0;if(this.isSingleFieldModal)return this.closeCallback(this),isModified&&ZP5Form.getFormClassObj().refreshPage(ZP5Form.getFormClassObj().getParams()),!0;if(isModified&&"P_Employee"!==params.zp_tableName&&ZP5Form.updateLookUpRefreshOpt(),void 0!==formParams.notifycallback&&"function"==typeof formParams.notifycallback&&formParams.notifycallback(),void 0!=formParams.isPageMode&&formParams.isPageMode){if(params.zp_formId!=this.getFormsProperties().getFormId())return!0;void 0!==formParams.callback&&"function"==typeof formParams.callback&&(succObj.hasOwnProperty("onBoardingTabStatus")?formParams.callback(succObj.pkId,succObj.onBoardingTabStatus):$("#onBoardingRightPane").is(":visible")?formParams.callback(succObj.pkId,void 0,params.isDraft):formParams.callback(succObj.pkId)),this.ISBLUEPRINT&&void 0!==formParams.submitCallback&&"function"==typeof formParams.submitCallback?formParams.submitCallback(this,resultData,params):this.moduleHandler.submitCallback(resultData,params)}else{if(params.zp_formId!=this.getFormsProperties().getFormId())return!0;if(formParams.recordId=succObj.pkId,this.SUCCESS_PKID=succObj.pkId,this.isDisableUrlTrack())if(this.IS_SUBMITNEW){let formsClassObj=this;$.each(formsClassObj.LAYOUT.find("[zcomponentname]"),function(){formsClassObj.destroyZComponents($(this))}),this.refreshPage(formParams)}else this.ISBLUEPRINT&&void 0!==formParams.submitCallback&&"function"==typeof formParams.submitCallback?formParams.submitCallback(this,resultData,params):this.moduleHandler.submitCallback(resultData,params);else if(void 0!==formParams.callback&&"function"==typeof formParams.callback){if(this.IS_SUBMITNEW){let formsClassObj=this;$.each(formsClassObj.LAYOUT.find("[zcomponentname]"),function(){formsClassObj.destroyZComponents($(this))}),this.refreshPage(formParams)}else succObj.currentTimerData?(this.currentTimerData=succObj.currentTimerData,this.close()):this.close();ZPCal.Calendar&&(ZPCal.Calendar.refresh=-1!=Layout.Page.hash.indexOf("home/dashboard/calendar")||ZPCal.Calendar.refresh)}else if(this.IS_SUBMITNEW){let formsClassObj=this;$.each(formsClassObj.LAYOUT.find("[zcomponentname]"),function(){formsClassObj.destroyZComponents($(this))}),this.refreshPage(formParams)}else this.ISBLUEPRINT&&void 0!==formParams.submitCallback&&"function"==typeof formParams.submitCallback?formParams.submitCallback(this,resultData,params):this.moduleHandler.submitCallback(resultData,params)}void 0!==ZP5Form.Record.PARAMS[params.zp_formId]&&delete ZP5Form.Record.PARAMS[params.zp_formId]}resetAddUpdateRecordProcess(){ZP5Form.Record.TABULAR_PARAMS={},ZP5Form.Validation.resetFormError(this.FIELD_LAYOUT),this.LAYOUT.find("#zp_forms_add_btn").removeClass("disabled"),this.LAYOUT.find("#zp_forms_addnew_btn").removeClass("disabled"),this.LAYOUT.find("#zp_forms_savedraft_btn").removeClass("disabled"),this.LAYOUT.find("#bpContentDiv #zp_quickadd_done").attr("disabled",!1)}getOptionsByType(fieldDtl,selValue,skipDefOp,optns,selValueOnly){var opHtml="",options=fieldDtl.Options,optionsWithId=fieldDtl.OptionsWithId;let isPrimary=!1;if(optns)options=optns;else if(isPrimary=fieldDtl.isPrimary||"P_TimesheetJobsList"===this.getTableName()&&"ProjectManager"===fieldDtl.labelName){var permission=this.FormOperations.getAddPerm();if(this.isEditMode()&&(permission=this.FormOperations.getEditPerm()),4!==permission&&this.isAddMode()&&(selValue=ZPeople.CURR_USER.usererec,null!=this.primLkpVal&&(selValue=this.primLkpVal)),this.getParams().lookupValue&&"Employee_ID"===fieldDtl.labelName)if(-1!=Layout.Page.hash.indexOf("selfservice/leave/list")||-1!=Layout.Page.hash.indexOf("selfservice/user/calendar")){var user_detail=ZPeople.getUserDetailsById(ZPDashboard.getUserId(this.getParams().lookupValue));options=[{Id:this.getParams().lookupValue,Value:user_detail.name+",&nbsp;"+user_detail.empid}],selValue=this.getParams().lookupValue}else"attendance-entry-summary"!==Layout.Page.pageId&&"selfservice-user-attendance"!==Layout.Page.container[0].id||null===Attendance.Entry.erecno?(options=[{Id:ZPDashboard.getUserId(),Value:ZPeople.getUserDetailsById(ZPDashboard.getUserId()).name+",&nbsp;"+ZPeople.getUserDetailsById(ZPDashboard.getUserId()).empid}],selValue=ZPDashboard.getUserId()):(options=[{Id:ZPDashboard.getUserId(Attendance.Entry.erecno),Value:ZPeople.getUserDetailsById(ZPDashboard.getUserId(Attendance.Entry.erecno)).name+",&nbsp;"+ZPeople.getUserDetailsById(ZPDashboard.getUserId(Attendance.Entry.erecno)).empid}],selValue=ZPDashboard.getUserId(Attendance.Entry.erecno));else this.isEditMode()||this.isSingleFiledEdit()&&!this.isQuickAdd?options=fieldDtl.EditOptions:this.isAddMode()&&(options=fieldDtl.AddOptions)}if(!this.isrelformrelfields&&!this.getParams().isFromSelfService||!this.isAddMode()||this.relfcid!=fieldDtl.formComponentId||isPrimary&&this.isPrimLkpChange||(selValue=this.selValue),fieldDtl.displayType!==FormConstants.FieldType.RADIO_DISPLYTYPE&&fieldDtl.displayType!==FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE&&fieldDtl.displayType!==FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&!skipDefOp)if(void 0!==selValue&&""!==selValue.trim())opHtml='<option value="-Select-">'+ZPI18N.getString("zp.select")+"</option>";else if(opHtml='<option value="-Select-" selected="selected">'+ZPI18N.getString("zp.select")+"</option>",selValueOnly)return opHtml;if(this.isrelformrelfields&&this.relfcid==fieldDtl.formComponentId&&(opHtml=""),fieldDtl.fieldType===FormConstants.FieldType.TIME_ZONE){var timeZoneListElms="<option value=''>select</option>";return $.each(options,function(index,timeMap){for(timeZoneListElms+="<optgroup label='"+timeMap.disp+"'>",i=0;i<timeMap.list.length;i++)if(fieldDtl.componentValue==timeMap.list[i].code){if(selValueOnly)return"<option value='"+timeMap.list[i].code+"' selected='selected'>"+timeMap.list[i].name+"&nbsp("+timeMap.list[i].code+")</option>";timeZoneListElms+="<option value='"+timeMap.list[i].code+"' selected='selected'>"+timeMap.list[i].name+"&nbsp("+timeMap.list[i].code+")</option>"}else timeZoneListElms+="<option value='"+timeMap.list[i].code+"'>"+timeMap.list[i].name+"&nbsp("+timeMap.list[i].code+")</option>";timeZoneListElms+="</optgroup>"}),opHtml=timeZoneListElms}var selectedoptionHtml="";return $.each(options,function(key,value){let isSelected=!1,optionHtml="";var optId=fieldDtl.fieldType===FormConstants.FieldType.PICKLIST&&void 0!=optionsWithId?optionsWithId[key].Id:"";if(fieldDtl.fieldType===FormConstants.FieldType.BLOODGROUP&&fieldDtl.displayType!==FormConstants.FieldType.RADIO_DISPLYTYPE){isSelected=ZP5Form.Field.getIsSelected(value,selValue,"select");let optionHtml='<option value="'+ZPeople.decodeTxt(value)+'" '+isSelected+">"+ZPeople.decodeTxt(value)+"</option>";isSelected&&(selectedoptionHtml=optionHtml),opHtml+=optionHtml}else{var inputType=fieldDtl.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE?"radio":fieldDtl.displayType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE?"checkbox":"",divparentClass=fieldDtl.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE?"zradiobutton":fieldDtl.displayType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE?"zcheckbox":"";if(fieldDtl.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE||fieldDtl.displayType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE)fieldDtl.fieldType===FormConstants.FieldType.LOOKUP?opHtml+='<div class="'+divparentClass+'"><input id="optid_'+fieldDtl.formComponentId+"_"+value.Id+'" class="'+divparentClass+'__helper" type="'+inputType+'" name="'+fieldDtl.labelName+'" value="'+value.Id+'" '+ZP5Form.Field.getIsSelected(value.Id,selValue)+'></input><label for="optid_'+fieldDtl.formComponentId+"_"+value.Id+'" class="'+divparentClass+'__label"><span cclass="'+divparentClass+'__text">'+value.Value+"</span></label></div>":opHtml+='<div class="'+divparentClass+'"><input id="optid_'+fieldDtl.formComponentId+"_"+optId+'" class="'+divparentClass+'__helper" onchange="ZP5Form.formulaRevaluateOnsingleEdit(undefined,this)" optid="'+optId+'"  type="'+inputType+'" name="'+fieldDtl.labelName+'" value="'+value+'" '+ZP5Form.Field.getIsSelected(value,selValue)+'></input><label for="optid_'+fieldDtl.formComponentId+"_"+optId+'" class="'+divparentClass+'__label"><span class="'+divparentClass+'__text">'+value+"</span></label></div>";else if(fieldDtl.fieldType===FormConstants.FieldType.LOOKUP)isSelected=ZP5Form.Field.getIsSelected(value.Id,selValue,"select"),optionHtml='<option value="'+value.Id+'" '+isSelected+">"+value.Value+"</option>",isSelected&&(selectedoptionHtml=optionHtml),opHtml+=optionHtml;else if(fieldDtl.fieldType===FormConstants.FieldType.COUNTRY){var name=value.name.toUpperCase();isSelected=ZP5Form.Field.getIsSelected(name,ZPeople.decodeTxt(selValue),"select"),optionHtml='<option code="'+value.code+'" value="'+name+'" '+isSelected+">"+name+"</option>",isSelected&&(selectedoptionHtml=optionHtml),opHtml+=optionHtml}else if(fieldDtl.fieldType===FormConstants.FieldType.STATES){name=value.state_name.toUpperCase();isSelected=ZP5Form.Field.getIsSelected(name,selValue,"select"),optionHtml='<option code="'+value.state_code+'" value="'+name+'" '+isSelected+">"+name+"</option>",isSelected&&(selectedoptionHtml=optionHtml),opHtml+=optionHtml}else optionHtml='<option optid="'+optId+'" value="'+value+'" '+(isSelected=ZP5Form.Field.getIsSelected(value,selValue,"select"))+">"+value+"</option>",isSelected&&(selectedoptionHtml=optionHtml),opHtml+=optionHtml}if(isSelected.length>0&&selValueOnly)return!1;0}),selValueOnly?selectedoptionHtml:opHtml}getZComponentsConfig(ismulti){let fieldChangeCalback=ZP5Form.fieldChangeCalback,options={messages:{noResults:ZPI18N.getString("zp.nomatchesfound"),remove:ZPI18N.getString("zp.remove")},lazyLoading:!0,change:fieldChangeCalback,viewPerPage:199,cacheData:!1,serverSearch:!0,showSearchField:!0,dropdownList:{fitForElement:!0,acceptNewValues:!0,height:"250px",className:"zpl_ddoptnrml"},randomDropdownListId:!0,dataMapping:{label:"text",value:"id",id:"id",text:"text"},beforedropdownlistopen:ZP5Form.componentsSearch(),dataSource:{paginated:!0}};ismulti&&(options.search={showNoResultsMessage:!0},options.sort=!1)}getSelect2FieldOptions(fcid,elem,fieldDtl,selValue,prop){prop=prop||{};let fieldChangeCalback=ZP5Form.fieldChangeCalback;"P_Location"!=this.getTableName()||fieldDtl.fieldType!==FormConstants.FieldType.COUNTRY||prop.isAddressField||(fieldChangeCalback=function(){var stateELe=settingsPage.container.find('[name="State"]');stateELe.length>0&&(ZPeopleComponents.select(stateELe[0]).setValue({text:ZPI18N.getString("zp.select"),id:"-Select-"}),ZPeopleComponents.select(stateELe[0]).removeAllOptions())});let options={messages:{noResults:ZPI18N.getString("zp.nomatchesfound"),remove:ZPI18N.getString("zp.remove")},lazyLoading:!0,change:fieldChangeCalback};var staticOptions;if("Mobile"===fieldDtl.labelName&&("P_Employee"==this.getTableName()||"P_Candidate"==this.getTableName()))return{...options,...ZPComponents.v2.dialCodeOptions(),dropdownList:{width:"fit-content",height:"250px"}};if(options={...options,viewPerPage:199,cacheData:!1,serverSearch:!0,showSearchField:!0,dropdownList:{fitForElement:!0,moveOnScroll:!0,acceptNewValues:!0,height:"250px",className:"zpl_ddoptnrml"},randomDropdownListId:!0},staticOptions=this.constructStaticSelect2Option(fieldDtl,selValue,void 0,void 0,prop),options.dataMapping=staticOptions.dataMapping,fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE){options.search={showNoResultsMessage:!0},options.data=staticOptions.dataoptions,options.sort=!1;let opar=[];void 0!=staticOptions.selValue&&(Array.isArray(staticOptions.selValue)?opar=staticOptions.selValue:opar.push(staticOptions.selValue)),options.values=opar}else options.options=staticOptions.dataoptions,options.value=staticOptions.selValue;let tableName=this.getTableName();return fieldDtl.fieldType!=FormConstants.FieldType.LOOKUP&&fieldDtl.fieldType!=FormConstants.FieldType.STATES||(options.dataSource={search:ZP5Form.componentsSearch(fieldDtl.fieldType,fcid,elem,tableName,prop),paginated:!0},fieldDtl.fieldType==FormConstants.FieldType.STATES&&(prop.isAddressField||"-Select-"!=staticOptions.selValue||(options.value={id:"-Select-",text:ZPI18N.getString("zp.select")}),options.optionclick=((event,data)=>{data.container.parent().find("[name=STATE]").empty()}))),options}constructStaticSelect2Option(fieldDtl,selValue,skipDefOp,optns,prop){var options=fieldDtl.Options,optionsWithId=fieldDtl.OptionsWithId;let isPrimary,optionIds=[];if(fieldDtl.fieldType!==FormConstants.FieldType.NEW_BLOODGROUP&&fieldDtl.fieldType!==FormConstants.FieldType.NEW_GENDER||(optionIds=fieldDtl.oIds),optns)options=optns;else if(isPrimary=fieldDtl.isPrimary||this.moduleHandler.isPrimary(fieldDtl)){var permission=this.FormOperations.getAddPerm();if(this.isEditMode()&&(permission=this.FormOperations.getEditPerm()),4!==permission&&this.isAddMode()&&(selValue=ZPeople.CURR_USER.usererec,null!=this.primLkpVal&&(selValue=this.primLkpVal)),this.getParams().lookupValue&&"Employee_ID"===fieldDtl.labelName)if(-1!=Layout.Page.hash.indexOf("selfservice/leave/list")||-1!=Layout.Page.hash.indexOf("selfservice/user/calendar")){var user_detail=ZPeople.getUserDetailsById(ZPDashboard.getUserId(this.getParams().lookupValue));options=[{Id:this.getParams().lookupValue,Value:user_detail.name+",&nbsp;"+user_detail.empid}],selValue=this.getParams().lookupValue}else"attendance-entry-summary"!==Layout.Page.pageId&&"selfservice-user-attendance"!==Layout.Page.container[0].id||null===Attendance.Entry.erecno?(options=[{Id:ZPDashboard.getUserId(),Value:ZPeople.getUserDetailsById(ZPDashboard.getUserId()).name+",&nbsp;"+ZPeople.getUserDetailsById(ZPDashboard.getUserId()).empid}],selValue=ZPDashboard.getUserId()):(options=[{Id:ZPDashboard.getUserId(Attendance.Entry.erecno),Value:ZPeople.getUserDetailsById(ZPDashboard.getUserId(Attendance.Entry.erecno)).name+",&nbsp;"+ZPeople.getUserDetailsById(ZPDashboard.getUserId(Attendance.Entry.erecno)).empid}],selValue=ZPDashboard.getUserId(Attendance.Entry.erecno));else!this.isEditMode()&&!this.isSingleFiledEdit()||this.isQuickAdd?this.isAddMode()&&(options=fieldDtl.AddOptions):options=fieldDtl.EditOptions}!this.isrelformrelfields&&!this.getParams().isFromSelfService||!this.isAddMode()||this.relfcid!==fieldDtl.formComponentId||isPrimary&&this.isPrimLkpChange||(selValue=this.selValue);let resultObj={dataMapping:{label:"text",value:"id",id:"id",text:"text"}},dataoptions=[];if(fieldDtl.displayType!==FormConstants.FieldType.RADIO_DISPLYTYPE&&fieldDtl.displayType!==FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE&&fieldDtl.displayType!==FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&!skipDefOp){let dispText=void 0!=prop&&prop.displayName?prop.displayName:ZPI18N.getString("zp.select");dataoptions.push({id:"-Select-",text:dispText}),void 0!=selValue&&""!=selValue.trim()&&"-Select-"!=selValue||(resultObj.selValue="-Select-")}if("P_Location"==this.getTableName()&&fieldDtl.fieldType===FormConstants.FieldType.TIME_ZONE?(CompanySetup.NewSetting.setTimeZoneGroups(options,dataoptions,"text","id","timeZoneGroup"),resultObj.dataMapping={label:"text",value:"id",optgroupLabel:"timeZoneGroup"}):"P_Location"!=this.getTableName()||fieldDtl.fieldType!==FormConstants.FieldType.COUNTRY||prop.isAddressField?"P_Location"!=this.getTableName()||fieldDtl.fieldType!==FormConstants.FieldType.STATES||prop.isAddressField?$.each(options,function(key,value){var optId=fieldDtl.fieldType===FormConstants.FieldType.PICKLIST&&void 0!=optionsWithId?optionsWithId[key].Id:"",val="";if(fieldDtl.fieldType!==FormConstants.FieldType.BLOODGROUP&&fieldDtl.fieldType!==FormConstants.FieldType.NEW_BLOODGROUP||fieldDtl.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE)if(fieldDtl.fieldType===FormConstants.FieldType.LOOKUP)dataoptions.push({id:value.Id,text:ZPeople.decodeTxt(value.Value)}),value.Id==selValue&&(resultObj.selValue={id:value.Id,text:ZPeople.decodeTxt(value.Value)});else if(fieldDtl.fieldType===FormConstants.FieldType.COUNTRY||fieldDtl.fieldType===FormConstants.FieldType.NEW_COUNTRY){var name=value.name.toUpperCase();val=name,(fieldDtl.fieldType===FormConstants.FieldType.NEW_COUNTRY||prop.isAddressField)&&(val=value.code),dataoptions.push({id:val,text:name,code:value.code})}else if(fieldDtl.fieldType===FormConstants.FieldType.STATES)val=value.state_name.toUpperCase(),dataoptions.push({id:val,text:val});else{let displayTxt=ZPeople.decodeTxt(value);val=ZPeople.decodeTxt(value),fieldDtl.fieldType===FormConstants.FieldType.NEW_GENDER&&(val=optionIds[key]),dataoptions.push({id:val,text:displayTxt,optid:optId})}else{let vId=value;fieldDtl.fieldType===FormConstants.FieldType.NEW_BLOODGROUP&&(vId=optionIds[key]),dataoptions.push({id:vId,text:ZPeople.decodeTxt(value)}),vId==selValue&&(resultObj.selValue={id:vId,text:ZPeople.decodeTxt(value)})}fieldDtl.fieldType!=FormConstants.FieldType.LOOKUP&&val==selValue&&(fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE?resultObj.selValue={id:val,text:val}:resultObj.selValue=val)}):resultObj.dataMapping={label:"text",value:"text",id:"id"}:(CompanySetup.NewSetting.getCountryValues(options,dataoptions,"countriesForLocation"),resultObj.dataMapping={label:"label",value:"value",id:"id"}),selValue&&!resultObj.selValue)if(isPrimary||(this.isrelformrelfields||this.getParams().isFromSelfService)&&this.isAddMode()&&this.relfcid===fieldDtl.formComponentId&&(!isPrimary||!this.isPrimLkpChange)){let selectedValue=ZP5Form.select2.getOptions(fieldDtl.formComponentId,"",1,void 0,selValue,void 0,void 0,{skipDefaultOption:!0});dataoptions.push(selectedValue),resultObj.selValue=selectedValue}else if(fieldDtl.fieldType==FormConstants.FieldType.LOOKUP&&fieldDtl.isTabular&&fieldDtl.displayType==FormConstants.FieldType.SELECT_DISPLYTYPE){let key=fieldDtl.formComponentId+"_"+selValue;void 0!=ZP5Form.select2.ALL_OPTIONS[key]&&(resultObj.selValue={id:selValue,text:ZPeople.decodeTxt(ZP5Form.select2.ALL_OPTIONS[key])})}return fieldDtl.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&(resultObj.dataMapping.titleText="text"),resultObj.dataoptions=dataoptions,resultObj}destroyZComponents(obj){ZPeopleComponents[obj.attr("zcomponentname")](obj).destroy()}}class Fields extends FormsFramework{constructor(){super(),this.MODGEOFC_ID=null}isSingleFiledEdit(){return null!=this.getSingleFieldEditFcid()}showEditOption(Obj,hoverEle){var currentStatus=this.getRecordDetails().record.message.approvalStatus;if(ZP5Form.isApprovalStarted(this.getFormsProperties().getFormId(),this.getFormsProperties().getRecordId())&&currentStatus!==zpconst.ApprovalStatus.Cancelled){var fieldDtl=$(Obj).data(),fieldObj=$(Obj).find("#zp_field_outer_"+fieldDtl.formComponentId),isdependField=$(Obj).find("#zp_field_outer_"+fieldDtl.formComponentId).attr("isfielddependent"),isconditionfield=$(Obj).find("#zp_field_outer_"+fieldDtl.formComponentId).attr("isconditionfield");if(null!==this.getSingleFieldEditFcid())return;this.getTableName();this.moduleHandler.isSingleFiledEditAllowed(fieldDtl)&&0==fieldObj.parent().find("#zp_formfield_edit_opt").length&&(hoverEle.append('<i id="zp_formfield_edit_opt" class="PI_edt"></i>'),hoverEle.find("#zp_formfield_edit_opt").on("click",event=>{let editBtn=$(event.target);if(!editBtn.hasClass("disabled")){editBtn.removeClass("PI_edt").addClass("disabled"),ZPeopleComponents.isComponent("zp_formfield_edit_opt")&&ZPeopleComponents.progresswheel("#zp_formfield_edit_opt").destroy(),ZPeopleComponents.progresswheel("#zp_formfield_edit_opt",{mode:"indeterminate",size:"mini"}),this.setSingleFieldEditFCID(fieldDtl.formComponentId);var fields=[];if("true"==isdependField&&ZP5Form.Field.Edit.getDependFieldMappingFields(this.getSingleFieldEditFcid(),fields),"true"==isconditionfield)ZPFRulesNew.Evaluation.getDependentFields(this.getSingleFieldEditFcid(),fields,!1);else if(fields.length>0)for(var dupFields=fields.slice(),ruleFieldIndex=0;ruleFieldIndex<dupFields.length;ruleFieldIndex++)ZPFRulesNew.Evaluation.getDependentFields(dupFields[ruleFieldIndex],fields,!1);fields.length>0?(-1==$.inArray(this.getSingleFieldEditFcid(),fields)&&fields.push(this.getSingleFieldEditFcid()),ZP5Form.Field.Edit.constructSingleFieldEditModel(fields,fieldDtl,this.getSingleFieldEditFcid()),this.setSingleFieldEditFCID(null)):(this.showEdit(),$(Obj).addClass("active")),this.getInfoToolTipObj().constructTooltips()}}),void 0!=$(Obj).parent().parent().find("[folabel=ModifiedLOC]").parent().data()&&(ZP5Form.Field.Edit.MODGEOFC_ID=$(Obj).parent().parent().find("[folabel=ModifiedLOC]").parent().data().formComponentId))}else this.hideOption(Obj,!0)}showOption(Obj,isEditHoverAllowed){let fieldObj=$(Obj).find("[folabel]"),isStarVisible=$(Obj).find("[mask^=star]").is(":visible"),isSingleFieldEdit=null!==this.getSingleFieldEditFcid(),options=$('<div class="zpl_hvr"></div>');isSingleFieldEdit&&0!=fieldObj.find("#zp_fieldedit_comp").length||(0!==$(fieldObj).find("[mask^=star]").length?(()=>{let className=isStarVisible?"PI_eye":"PI_eyecls";options.append('<i id="zp_formfield_mask_opt" class='+className+"></i>");let toggleIcon=options.find("#zp_formfield_mask_opt");toggleIcon.on("click",function(){let isStarVisible=$(Obj).find("[mask^=star]").is(":visible");$(Obj).find("[mask^=star]").toggleClass("zpl_DNI",isStarVisible),$(fieldObj).find(":first").toggleClass("zpl_DNI",!isStarVisible),toggleIcon.toggleClass("PI_eye",!isStarVisible).toggleClass("PI_eyecls",isStarVisible)}),fieldObj.append(options)})():fieldObj.append(options),isEditHoverAllowed&&this.showEditOption(Obj,options))}hideOption(Obj,removeEditIconAlone){removeEditIconAlone||$(Obj).parent().find("#zp_formfield_mask_opt").parent().remove(),null===this.getSingleFieldEditFcid()&&$(Obj).parent().find("#zp_formfield_edit_opt").parent().remove()}showEdit(){if(null!==this.getSingleFieldEditFcid()){var formComp=ZP5Form.Field.getFieldComponent(this.getSingleFieldEditFcid()),fieldVal={};if(this.SINGLE_FIELD_EDIT_FORM_LOOKUP_RELDATA=null,void 0!==formComp)if(formComp.fieldType===FormConstants.FieldType.LOOKUP&&(ZP5Form.getLookupRefreshStatus(formComp.formComponentId,formComp.referredFormId)||formComp.isPrimary&&void 0==formComp.EditOptions)||void 0!=formComp.dependentFiledList&&0!=formComp.dependentFiledList.length){if(void 0!=formComp.dependentFiledList&&0!=formComp.dependentFiledList.length)for(var i=0;i<formComp.dependentFiledList.length;i++){var lufcid=formComp.dependentFiledList[i],value=ZP5Form.Field.getFieldValueData(lufcid).componentValue_ID;if("P_Employee"!=this.getTableName()&&"P_Candidate"!=this.getTableName()||this.getSingleFieldData(lufcid).labelName!=ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName()))Array.isArray(value)?fieldVal[lufcid]=value.join(";"):fieldVal[lufcid]=value;else{var valueString="";if(value.length>0){for(var j=0;j<value.length;j++){var value1=value[j];valueString=""==valueString.trim()?value1:valueString+","+value1}""!=valueString.trim()&&(value=valueString)}fieldVal[lufcid]=value}}this.fetchLookUpData([this.getSingleFieldEditFcid()],this.FormOperations.getFormComponentData(),fieldVal)}else this.showFieldEditable()}}showFieldEditable(){var formComp=ZP5Form.Field.getFieldComponent(this.getSingleFieldEditFcid()),fieldObj=this.FIELD_LAYOUT.find("#zp_field_outer_"+this.getSingleFieldEditFcid()),fieldValueData=ZP5Form.Field.getFieldValueData(this.getSingleFieldEditFcid()),value=fieldValueData.componentValue+"",fieldType=formComp.fieldType,labelName=fieldValueData.componentName;fieldObj.parent().find("#zp_formfield_edit_opt").parent().remove();var htmlData=$('<div id="zp_fieldedit_comp"></div>');let quickaddhtml='<div class="zpl_hvr">'+ZP5Form.Field.isQuickAddForm(formComp,formComp.isTabular,!0)+'<i id="zp_formedit_submit" class="PI_tick grn"></i><i id="zp_formedit_cancel" class="PI_cls red"></i></div>',toolTip=ZP5Form.Field.getFieldIconsHTML(formComp,void 0,this.getInfoToolTipObj(),!0,fieldObj.parent(),ZP5Form.Field.isMandatory(this.getTableName(),formComp.isMandatory,formComp.labelName,this.getMode()));htmlData.append(this.createField(formComp,value,void 0,void 0,fieldObj.parent(),toolTip)),htmlData.append(quickaddhtml),fieldObj.append(htmlData),FormConstants.FORMULA_SUPPORTED_FIELDS.includes(parseInt(fieldType))&&$("input[id=zp_field_"+this.getSingleFieldEditFcid()+"]").on("keyup",ZP5Form.delay(e=>{ZP5Form.formulaRevaluateOnsingleEdit()},500)),fieldType!=FormConstants.FieldType.FILE_UPLOAD&&fieldType!=FormConstants.FieldType.IMAGE||this.FIELD_LAYOUT.find('[name="fileuploadelem"]').on("click",function(event){ZP5Form.onDesktopUpload(event)}),"true"==fieldObj.attr("isconditionfield")&&(fieldObj.find("select").length>0?fieldObj.find("select").on("change",function(event){ZPFRulesNew.Evaluation.setEmptyFcs.length>0&&(ZPFRulesNew.Evaluation.setEmptyFcs=[]),ZPFRulesNew.Evaluation.makeExecutefalse(),ZPFRulesNew.Evaluation.evaluateRulesForField(this)}):fieldObj.find("input").length>0?fieldObj.attr("displaytype")==FormConstants.FieldType.RADIO_DISPLYTYPE?fieldObj.find("input").on("click",function(event){ZPFRulesNew.Evaluation.setEmptyFcs.length>0&&(ZPFRulesNew.Evaluation.setEmptyFcs=[]),ZPFRulesNew.Evaluation.evaluateRulesForField(this)}):fieldObj.find("input").on("change",function(event){ZPFRulesNew.Evaluation.setEmptyFcs.length>0&&(ZPFRulesNew.Evaluation.setEmptyFcs=[]),ZPFRulesNew.Evaluation.evaluateRulesForField(this)}):fieldObj.find("textarea").length>0&&fieldObj.find("textarea").on("change",function(event){ZPFRulesNew.Evaluation.setEmptyFcs.length>0&&(ZPFRulesNew.Evaluation.setEmptyFcs=[]),ZPFRulesNew.Evaluation.makeExecutefalse(),ZPFRulesNew.Evaluation.evaluateRulesForField(this)})),htmlData.find("#zp_formedit_submit").on("click",()=>{htmlData.find("#zp_formedit_submit").off("click"),this.callbackForSingleFieldEdit()}),htmlData.find("#zp_formedit_cancel").on("click",()=>{this.cancel()}),fieldObj.find(":input[name='"+labelName+"'][type=text]").on("keyup",event=>{13===event.keyCode&&this.submit()}),this.initZComponents(htmlData),this.registerFieldChangeFun(htmlData),fieldObj.find("> span").hide(),fieldObj.find(":input[name='"+labelName+"']").trigger("focus"),this.setValuesForSingleFields([fieldValueData],!0),this.FIELD_LAYOUT.find(":input[name="+fieldValueData.componentName+"]").off("change.fieldvalue").on("change.fieldvalue",e=>{this.fieldValueChangeFunc(e)})}callbackForSingleFieldEdit(){let singleFieldEditCallback=()=>{this.FIELD_LAYOUT.find("[elem='quickAdd']").addClass("zpl_disbld_icn");let fcData=ZP5Form.Field.getFieldComponent(this.getSingleFieldEditFcid());fcData.fieldType==FormConstants.FieldType.FILE_UPLOAD||fcData.fieldType==FormConstants.FieldType.IMAGE?this.uploadFiles(!0):this.submit()};if(ZP5Form.isAllowedToEdit(this.getMode(),this.getFormsProperties().getFormId(),[this.getSingleFieldEditFcid()])){var key="zp.editapprovalconfirmmsg";this.FormOperations.getApprovalSettingsDetails().isVerifySend&&(key="zp.editapprsendconfirmmsg");let alertMessageObj=new InfoAlertMessage(ZPI18N.getString("zp.confirm"),ZPI18N.getString(key));alertMessageObj.yesButtonText=ZPI18N.getString("zp.confirm"),alertMessageObj.setCallback(singleFieldEditCallback),alertMessageObj.setCloseCallback(()=>{this.FIELD_LAYOUT.find("#zp_formedit_submit").on("click",()=>{this.FIELD_LAYOUT.find("#zp_formedit_submit").off("click"),this.callbackForSingleFieldEdit()})}),alertMessageObj.show()}else singleFieldEditCallback()}submit(params){if(!this.moduleHandler.preaddUpdateCallBack(params,()=>{this.submit(params)},()=>{this.revertSingleEdit()}))return;var isLocationTrackingEnabled=!1;this.FormOperations.getFormsDetailsMap()&&(isLocationTrackingEnabled=this.FormOperations.getFormsDetailsMap().isLocationTrackingEnabled);let data={params:params,isLocationTrackingEnabled:isLocationTrackingEnabled};isLocationTrackingEnabled?(data.fieldClassObj=this,FrameworkCommon.Location.fetch((data,locObj)=>{data.fieldClassObj.submitGeo(data,locObj)},data)):this.submitGeo(data)}submitGeo(data,latLanObj){let{params:params,isLocationTrackingEnabled:isLocationTrackingEnabled}=data;this.IS_SUBMIT=!0,null==this.getSingleFieldEditFcid()&&null!=this.isFromQuickAddEditFormComID&&this.setSingleFieldEditFCID(ZP5Form.isFromQuickAddEditFormComID);let fcid=this.getSingleFieldEditFcid();var tableName=this.getTableName(),result={errorList:[],params:{loginUserZUID:_LOGGEDIN_ZUID,zp_tableName:tableName,zp_formId:this.getFormsProperties().getFormId(),zp_mode:"updateRecord",zp_recordId:this.getFormsProperties().getRecordId(),isSingleEdit:!0,fcId:fcid}};if(isLocationTrackingEnabled){if(!latLanObj.isPermEnabled)return ZPeople.Message.failure(ZPI18N.getString("zp.enableaccesstolocation")),void this.revertSingleEdit({});result.params.latitude=latLanObj.locData.latitude,result.params.longitude=latLanObj.locData.longitude,result.params.accuracy=latLanObj.locData.accuracy}isWebForm&&(result.params=applyWebFormParams(result.params));let fieldData=[ZP5Form.Field.getFieldComponent(this.getSingleFieldEditFcid())];void 0==params||fieldData[0].fieldType!=FormConstants.FieldType.FILE_UPLOAD&&fieldData[0].fieldType!=FormConstants.FieldType.IMAGE?ZP5Form.Validation.validate(this,fieldData,!1,result):result.params[params.labelName]=params[params.labelName],result.errorList.length>0?this.revertSingleEdit(result.errorList):(ZPUtil.Validation.isEmpty(this.getParams().forwardErecno)||(result.params.forwardErecno=this.getParams().forwardErecno),result.params.isDraft=this.isDraftrec||this.isEditDraftrec,ZPeople.Request.send(this.moduleHandler.getSubmitUrl(),result.params,(data,params)=>{this.successResponse(data,params)}))}revertSingleEdit(errorList){ZP5Form.Validation.resetFormError(this.FIELD_LAYOUT),ZP5Form.Validation.showFormFieldError(errorList,void 0,ZP5Form.Field.getFieldComponent(this.getSingleFieldEditFcid()).sectionId),Layout.Page.container.find("#zp_forms_add_btn").removeClass("disabled"),this.FIELD_LAYOUT.find('[elem="quickAdd"]').removeClass("zpl_disbld_icn"),this.FIELD_LAYOUT.find("#zp_formedit_submit").on("click",()=>{this.FIELD_LAYOUT.find("#zp_formedit_submit").off("click"),this.callbackForSingleFieldEdit()})}cancel(isSave,isModified){if(void 0==this.getSingleFieldEditFcid()||null===this.getSingleFieldEditFcid())return;var fcId=this.getSingleFieldEditFcid(),fieldObj=this.FIELD_LAYOUT.find("#zp_field_outer_"+fcId);let zcomponentNameObj=$(fieldObj).find("[zcomponentname]");if(void 0!=zcomponentNameObj&&$(zcomponentNameObj).length>0&&this.destroyZComponents($(zcomponentNameObj)),this.getInfoToolTipObj().destroyTooltips({isSingleEdit:!0}),fieldObj.parent().find("[elem=viewToolTip]").html(""),fieldObj.parent().find("[elem=viewToolTip]").siblings('[elem="fieldIcon"]').remove(),fieldObj.parent().find("[elem=viewToolTip]").siblings("label").removeClass("zpl_mtry"),fieldObj.find("#zp_fieldedit_comp").remove(),fieldObj.find("> span").show(),fieldObj.parent().removeClass("active"),!isSave){var fieldValueData=ZP5Form.Field.getFieldValueData(fcId);void 0!=fieldValueData&&void 0!==fieldValueData.componentValue_RelatedFields&&this.setRelatedFieldsData(fieldValueData.componentValue_RelatedFields,fcId)}this.setSingleFieldEditFCID(null),this.SINGLE_FIELD_EDIT_FORM_LOOKUP_RELDATA=null,ZP5Form.Validation.resetFormError(this.FIELD_LAYOUT),isSave||ZPFRulesNew.Evaluation.evaluateRulesForField(fieldObj);var fieldType=this.getSingleFieldData(fcId).fieldType;(isModified||void 0===isModified)&&FormConstants.FORMULA_SUPPORTED_FIELDS.includes(parseInt(fieldType))&&ZP5Form.formulaRevaluateOnsingleEdit(void 0,fcId,"1",!0),this.refreshUploadedFiles()}successResponse(data,params){let isError=!1,isFieldError=!1;if(data.length>0)if(7e3===data[0].code){var isModified=void 0==data[0].isModified||data[0].isModified;let fcid=this.getSingleFieldEditFcid(),fcdata=ZP5Form.Field.getFieldComponent(this.getSingleFieldEditFcid());var value=data[0][fcdata.labelName],isLocationTrackingEnabled=!1;if(this.FormOperations.getFormsDetailsMap()&&(isLocationTrackingEnabled=this.FormOperations.getFormsDetailsMap().isLocationTrackingEnabled),""!=value&&fcdata.isPrimary&&!this.isRecordAdmin()&&"P_Task"!==params.zp_tableName)ZP5Form.Field.getFieldValueData(fcid).isEditable=!1,(fieldObj=this.FIELD_LAYOUT.find("#zp_field_outer_"+fcid)).parent().off("mouseenter");if(fcdata.fieldType===FormConstants.FieldType.TEXT_AREA&&(value=value.replace(/\n/g,"<br />")),value=this.setValue(fcdata,value,data[0]),isLocationTrackingEnabled&&void 0!=ZP5Form.Field.Edit.MODGEOFC_ID){var fieldObj;value=data[0].mgeoInfo.geo.replace(/\n/g,"<br />"),(fieldObj=this.FIELD_LAYOUT.find("#zp_field_outer_"+ZP5Form.Field.Edit.MODGEOFC_ID)).find("span i[icon='Map']").length>0&&fieldObj.find("span i[icon='Map']").remove(),this.setSingleFieldEditFCID(ZP5Form.Field.Edit.MODGEOFC_ID),this.setValue(ZP5Form.Field.getFieldComponent(ZP5Form.Field.Edit.MODGEOFC_ID),value),this.setSingleFieldEditFCID(fcid);let lat=data[0].mgeoInfo.lat,lon=data[0].mgeoInfo.lon;ZPUtil.Validation.isEmpty(lat)&&ZPUtil.Validation.isEmpty(lon)?(fieldObj.find("span").removeClass("zpl_adsfld"),fieldObj.addClass("d-flexclmcap")):fieldObj.find("span").prepend(ZP5Form.Field.constructSystemAddressField(value,lat,lon,!0,!1))}if(this.cancel(!0,isModified),("P_Employee"===params.zp_tableName||"P_Candidate"===params.zp_tableName)&&this.isViewMode()){if(isOrgStructureEnabled&&(params.hasOwnProperty(ZP5Form.getEntityLabel(ZP5Form.getCurrFormsOperation().getTableName()))||params.hasOwnProperty("Business_unit")||params.hasOwnProperty(ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName()))||params.hasOwnProperty(ZP5Form.getDepartmentLabel(ZP5Form.getCurrFormsOperation().getTableName())))){var orgStructureValue=ZP5Form.Field.getFieldValueData(params.fcId).componentValue;params.hasOwnProperty(ZP5Form.getEntityLabel(ZP5Form.getCurrFormsOperation().getTableName()))?this.LAYOUT.find("#orgstructuremodel").find("#orgentity").find("b").html(orgStructureValue):params.hasOwnProperty("Business_unit")?this.LAYOUT.find("#orgstructuremodel").find("#orgunit").find("b").html(orgStructureValue):params.hasOwnProperty(ZP5Form.getDivisionLabel(ZP5Form.getCurrFormsOperation().getTableName()))?this.LAYOUT.find("#orgstructuremodel").find("#orgdivi").find("b").html(orgStructureValue):this.LAYOUT.find("#orgstructuremodel").find("#orgdept").find("b").html(orgStructureValue)}isModified&&"selfservice"===Layout.Page.pageId&&SelfService.Info.refreshUserDetails()}let labelObj=this.FIELD_LAYOUT.find("#zp_field_outer_"+fcid).parent();if(labelObj.find("[elem=viewToolTip").siblings("label").removeClass("zpl_mtry"),labelObj.find("[elem=viewToolTip").html(""),labelObj.find("[elem=fieldIcon").remove(),isModified&&(ZP5Form.Record.updateModifiedInfo(this.LAYOUT,data[0].mInfo),isWebForm||(ZP5Views.refreshAllViews(params.zp_formId),this.setRefreshRelatedForm(!0)),("P_Employee"===params.zp_tableName&&["EmployeeID","FirstName","LastName"].includes(fcdata.labelName)||fcdata.isPrimaryLookup&&fcdata.displayType==FormConstants.FieldType.SELECT_DISPLYTYPE)&&(this.getRecordDetails().refresh=!0)),data[0].hasOwnProperty("deleteRows")&&ZPFRulesNew.Evaluation.removeDeletedRows(data[0].deleteRows),"P_Task"==params.zp_tableName&&ZPTasks.fillDetailViewPage(),ZP5Form.isApprovalEnabled(this.getParams().formId)&&!this.isDraftrec&&(this.FormOperations.getApprovalSettingsDetails().isEditAllow||this.FormOperations.getApprovalSettingsDetails().isVerifySend)){OPApprovals.setApprovalData(data[0].pkId,data[0].approvalDetails);let apprParam=new ApprovalParam(this.getParams().formId,this.getParams().recordId,data[0].approvalDetails.tableName,data[0].approvalDetails.currentApprovalStatus,this.isRecordAdmin());apprParam.setApprovalSettings(this.FormOperations.getApprovalSettingsDetails());let layoutParam=new LayoutParam(this.LAYOUT,this.LAYOUT.find(".zpl_mhder"),this.LAYOUT.find(".zpl_mfoter"),"Forms");new ApprovalRecordHeader(apprParam,layoutParam,{isRecordApprover:data[0].approvalDetails.isOwner,isPrimaryApprover:data[0].approvalDetails.isPrimaryAppr,previousStatus:ZP5Form.getSingleRecord(params.zp_formId,params.zp_recordId).record.message.approvalStatus}).show(),OPApprovals.Forms.listCallBack(data[0].pkId,data[0].approvalDetails.currentApprovalStatus,data[0].approvalDetails),this.FormOperations.getApprovalSettingsDetails().isVerifySend&&delete ZPApprovals.APPROVAL_DETAILS[data[0].pkId]}let warningMsg,msgKey=ZP5Form.MessageKeys.Success.UPDATE_RECORD,isWarning=!1;if(void 0!=data[0].warningMsg&&""!=data[0].warningMsg?(warningMsg=data[0].warningMsg,isWarning=!0):isModified||(msgKey=ZP5Form.MessageKeys.Success.NO_MOD_UPDATE_REC,isWarning=!0),this.moduleHandler.showSuccessMessage(msgKey,isWarning,{warningMsg:warningMsg}),this.moduleHandler.singleFieldEditCallback(data,params,isModified),isWebForm&&void 0!==this.getParams().webFormSubmitCallback){let additionalParams={isSingleEdit:!0};"people"==this.getParams().webFormServiceName?this.getParams().webFormSubmitCallback(data,additionalParams):this.getParams().webFormSubmitCallback({pkId:data[0].pkId,code:data[0].code,message:data[0].message},additionalParams)}}else isError=isFieldError=!0;else"object"==typeof data&&7e3!==data.code&&(isError=!0);if(isError){let failureMsg=this.moduleHandler.getSingleEditFailureMessage(data,{...params,isFieldError:isFieldError});void 0!=failureMsg&&"string"==typeof failureMsg&&""!=failureMsg.trim()?ZPeople.Message.failure(failureMsg):(void 0==failureMsg||"boolean"==typeof failureMsg&&!failureMsg)&&(ZP5Form.Validation.resetFormError(this.FIELD_LAYOUT),ZP5Form.Validation.showFormFieldError(data,void 0,ZP5Form.Field.getFieldComponent(this.getSingleFieldEditFcid()).sectionId))}this.FIELD_LAYOUT.find("#zp_formedit_submit").on("click",()=>{this.FIELD_LAYOUT.find("#zp_formedit_submit").off("click"),this.callbackForSingleFieldEdit()}),this.refreshUploadedFiles()}setValue(compData,value,responseData){var fcid=this.getSingleFieldEditFcid(),returnVal=value,labelName=compData.labelName,fieldType=compData.fieldType,displayType=compData.displayType,fieldValData=ZP5Form.Field.getFieldValueData(fcid),fieldObj=this.FIELD_LAYOUT.find("#zp_field_outer_"+fcid),compVal=value;if(0!==fieldObj.length){if(fieldType===FormConstants.FieldType.PICKLIST||fieldType===FormConstants.FieldType.LOOKUP){var options=compData.Options;compData.isPrimary&&(options=compData.EditOptions);var isMulti=!1,optvals=[];if(displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE||displayType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE||displayType===FormConstants.FieldType.RADIO_DISPLYTYPE||displayType===FormConstants.FieldType.SELECT_DISPLYTYPE)if(displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE||displayType===FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE||isOrgStructureEnabled&&("P_Employee"===this.getTableName()&&"Division"===labelName||"P_Candidate"===this.getTableName()&&"CandidateDivision"===labelName)?(fieldType==FormConstants.FieldType.LOOKUP?(returnVal=ZPeople.decodeTxt(value),value=returnVal.split(";"),""==(compVal=(optvals=ZP5Form.Field.getMultiSelectLookupValue(options,value,fieldValData.componentValue_ID,fieldValData.componentValue,this.getSingleFieldEditFcid())).toString())&&0==value.length&&(compVal="-",value=[],optvals=[])):(optvals=value,compVal=ZP5Form.Field.getMultiSelectValue(options,value)),isMulti=!0):compVal=void 0!=value&&null!=value&&fieldType===FormConstants.FieldType.LOOKUP&&fieldValData.componentValue_ID==value?fieldValData.componentValue:ZP5Form.Field.getLookUpOptValue(options,value,this.getSingleFieldEditFcid()),fieldType!==FormConstants.FieldType.LOOKUP||displayType!==FormConstants.FieldType.RADIO_DISPLYTYPE&&displayType!==FormConstants.FieldType.SELECT_DISPLYTYPE||isNaN(value))isNaN(value)&&delete fieldValData.componentValue_RelatedFields;else if(void 0!==fieldValData.componentValue_RelatedFields&&null!==this.SINGLE_FIELD_EDIT_FORM_LOOKUP_RELDATA){let formClassObj=this;$.each(fieldValData.componentValue_RelatedFields,function(){this.Value=formClassObj.SINGLE_FIELD_EDIT_FORM_LOOKUP_RELDATA[this.formComponentId]?formClassObj.SINGLE_FIELD_EDIT_FORM_LOOKUP_RELDATA[this.formComponentId]:""})}else if(void 0!==compData.relatedFieldDetails&&null!==this.SINGLE_FIELD_EDIT_FORM_LOOKUP_RELDATA){let formClassObj=this;var relatedFieldsList=[];$.each(compData.relatedFieldDetails,function(){let value=formClassObj.SINGLE_FIELD_EDIT_FORM_LOOKUP_RELDATA[this.formComponentId]?formClassObj.SINGLE_FIELD_EDIT_FORM_LOOKUP_RELDATA[this.formComponentId]:"";relatedFieldsList.push({formComponentId:this.formComponentId,Value:value,componentName:this.labelName,displayName:this.displayName})}),fieldValData.componentValue_RelatedFields=relatedFieldsList}"-Select-"===value?fieldValData.componentValue_ID="":fieldType===FormConstants.FieldType.LOOKUP?fieldValData.componentValue_ID=value:fieldType!==FormConstants.FieldType.PICKLIST||displayType!==FormConstants.FieldType.RADIO_DISPLYTYPE&&displayType!==FormConstants.FieldType.SELECT_DISPLYTYPE||compData.OptionsWithId.some(element=>{if(element.Value==value)return fieldValData.componentValue_ID=element.Id,!0}),fieldObj.find("span:first").html(compVal),isMulti&&(compVal=optvals)}else if(fieldType===FormConstants.FieldType.FILE_UPLOAD){let downloadParams={fcId:fcid,recordId:this.getFormsProperties().getRecordId(),formId:this.getFormsProperties().getFormId(),original:"true"},{fileHtml:fileHtml,resultValue:resultValue,filePath:filePath,uploadSource:uploadSource}=ZP5Form.FILEUPLOAD_IMAGES.constructFileFieldHtml(responseData.tableName,void 0,responseData.fileid,value,downloadParams,this.PRINT);fieldObj.html(fileHtml),compVal=value=resultValue,fieldValData.componentValue_fileID=responseData.fileid,fieldValData.componentValue_filePath=filePath,fieldValData.componentValue_uploadSource=uploadSource}else if(fieldType===FormConstants.FieldType.MULTI_FILE_UPLOAD){var fileDetails=JSON.parse(ZPeople.decodeTxt(value));value=fileDetails.filename;for(var i=0;i<value.length;i++){var val=value[i],compval=val.componentValue+"";if(ZPUtil.Validation.isEmpty(compval))fieldObj.html(ZP5Form.Field.getNoValueString(compval));else if(compval=compval.replace("Cropped",""),"#performance/myreview/selfappraisal-mode:revhistory"==Layout.Page.hash){fieldObj.html("<span><a onclick=\"window.open('"+val.componentValue_downloadUrl+'&submode=myratings\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(compval)+"</span>")}else 0==i?fieldObj.html("<span><a onclick=\"window.open('"+val.componentValue_downloadUrl+'\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(compval)+"</span><br>"):fieldObj.append("<span><a onclick=\"window.open('"+val.componentValue_downloadUrl+'\');" href="javascript:;">'+ZP5Form.Field.getNoValueString(compval)+"</span><br>")}}else if(fieldType===FormConstants.FieldType.IMAGE){var downloadParams={fcId:fcid,recordId:this.getFormsProperties().getRecordId(),formId:this.getFormsProperties().getFormId(),original:"false"};let resultObj=ZP5Form.FILEUPLOAD_IMAGES.constructImageFieldHtml(labelName,responseData.tableName,value,downloadParams,void 0,responseData.fileid,this.isEditMode(),!0,this.PRINT);fieldObj.html(resultObj.imgHTML),compVal=resultObj.value,fieldValData.componentValue_fileID=responseData.fileid,fieldValData.componentValue_filePath=resultObj.filePath,fieldValData.componentValue_uploadSource=resultObj.uploadSource}else if(fieldType===FormConstants.FieldType.URL)fieldObj.html('<span><a rel="noreferrer" href="'+value+'" target="_blank">'+value+"</span>");else if(fieldType===FormConstants.FieldType.DATE_TIME)fieldObj.find("span:first").html(""!=value.trim()?Calendar.convertTo12Hours(ZPeople.decodeTxt(value)):"-");else if(fieldType===FormConstants.FieldType.ADDRESS){fieldValData.childValues=responseData[labelName+"_childValues"];var addressfieldHtml=ZP5Form.AddressField.getAddressDisplayHtml(fieldValData.childValues);fieldObj.html(addressfieldHtml)}else if(fieldType===FormConstants.FieldType.SOCIAL_SECURITY_NUMBER)fieldObj.find("span:first").html(ZP5Form.Field.formatSSNValue(value));else{$.inArray(parseInt(fieldType),[FormConstants.FieldType.BLOODGROUP,FormConstants.FieldType.COUNTRY,FormConstants.FieldType.GENDER])>-1&&"-Select-"===value&&(compVal="");var textval=compVal;parseInt(fieldType)==FormConstants.FieldType.CHECK_BOX?textval=compVal+""=="true"?ZPI18N.getString("zp.yes"):ZPI18N.getString("zp.no"):$.inArray(parseInt(fieldType),[FormConstants.FieldType.NUMBER,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.DECIMAL])>-1&&void 0!=responseData&&void 0!=responseData.dispVal&&(fieldValData.dispVal=responseData.dispVal,textval=responseData.dispVal),""==compVal&&(textval="-"),fieldObj.find("span:first").html(textval)}fieldValData.componentValue=compVal,"Mobile"!==labelName||"P_Employee"!==this.getTableName()&&"P_Candidate"!==this.getTableName()||void 0==responseData||(fieldValData.componentValue_country_code=responseData[labelName+".country_code"])}if("P_Employee"===this.getTableName()){var userDtl=ZPeople.getUserDetailsById(this.getFormsProperties().getRecordId(),!0);ZP5Form.updateUserDetails(userDtl,compData.labelName,compVal,value)}return value}setUpAddressFieldValue(addressFieldRecord,addressObj,field){var childFcObj=field.childFcObj,countryObj=childFcObj.COUNTRY;let countryRecordValue={};var stateRecordValue={};let tableName=this.getTableName(),moduleParams=this.moduleHandler.getModuleProps();"P_Employee"!=tableName&&"P_Candidate"!=tableName||"Permanent_Address"!=field.labelName&&"Present_Address"!=field.labelName||!moduleParams.hasOwnProperty("isUserAdditionFlow")&&!this.isAddMode()||!countryObj.userCountry?countryRecordValue.id="-Select-":$(addressObj).on("input",e=>{"copyAddrChk"!=e.target.id&&"COUNTRY"!=e.target.name&&"STATE"!=e.target.name&&this.autoSetCountryFunc(e,countryObj),$(e.currentTarget).off("input")}),!this.isEditMode()&&!this.isSingleFieldEdit()||moduleParams.hasOwnProperty("isUserAdditionFlow")||(countryRecordValue.id="-Select-"),jQuery.isEmptyObject(addressFieldRecord)||$.each(FormConstants.AddressField.COLUMNAMEARRAY,function(columnNameIndex,columnName){addressFieldRecord.hasOwnProperty(columnName)&&("COUNTRY"==columnName?(countryRecordValue.id=addressFieldRecord.COUNTRY_CODE,countryRecordValue.text=addressFieldRecord.COUNTRY):"STATE"==columnName?(stateRecordValue.text=addressFieldRecord[columnName],stateRecordValue.id=addressFieldRecord.STATE_CODE):field.isTabular&&field.isGridType?$(addressObj).find("[name="+columnName+"_"+field.labelName+"]").val(addressFieldRecord[columnName]):$(addressObj).find("[name="+columnName+"]").val(addressFieldRecord[columnName]))});var countryElementObj="";if(countryElementObj=field.isTabular?field.isGridType?$(addressObj).find("[folabel=COUNTRY_"+field.labelName+"]").find("input[name=COUNTRY]"):$(addressObj).find("#zp_field_outer_"+field.formComponentId).find("input[name=COUNTRY]"):$(addressObj).find("input[name=COUNTRY]"),$(countryElementObj).off("change").on("change",function(){var countryValue=$(this).val(),stateFcObj=childFcObj.STATE,stateObj="";stateObj=field.isTabular&&field.isGridType?$(this).parent().parent().find("[folabel="+stateFcObj.labelName+"]").find("input[name=STATE]"):$(this).parent().parent().parent().find("input[name=STATE]");var inisel={};void 0!=stateRecordValue&&stateRecordValue.hasOwnProperty("id")?(inisel.id=stateRecordValue.id,inisel.text=stateRecordValue.text,stateRecordValue=void 0):(inisel.id="-Select-",inisel.text=ZPI18N.getString("zp.orgselectlabel",[stateFcObj.displayName]));let selectOptions=ZP5Form.getFormClassObj().getSelect2FieldOptions(stateFcObj.formComponentId,stateObj,stateFcObj,void 0,{displayName:ZPI18N.getString("zp.orgselectlabel",[stateFcObj.displayName]),countryCode:countryValue,isAddressField:!0});ZPeopleComponents.select(stateObj).destroy(),ZPeopleComponents.select(stateObj,selectOptions).setValue(inisel),$(stateObj).val(inisel.id)}),0!=countryElementObj.length){let selectOptions=this.getSelect2FieldOptions(countryObj.formComponentId,countryElementObj,countryObj,void 0,{displayName:ZPI18N.getString("zp.orgselectlabel",[countryObj.displayName]),isAddressField:!0});selectOptions.optionclick=((event,data)=>{data.container.parent().find("[name=COUNTRY]").empty()}),countryRecordValue.text?(selectOptions.value=countryRecordValue,ZPeopleComponents.select(countryElementObj).setAttribute("acceptNewValues",!0),ZPeopleComponents.select(countryElementObj).setAttributes(selectOptions)):ZPeopleComponents.select(countryElementObj,selectOptions),void 0!==countryRecordValue.id&&"-Select-"!=countryRecordValue.id||$(countryElementObj).val(countryRecordValue).trigger("change")}}autoSetCountryFunc(event,countryObj){const address=event.target.closest("[id^='zp_field_outer_']");let country=$(address).find("input[name=COUNTRY]"),curCon={};"-Select-"===ZPeopleComponents.select(country).getValue()&&(curCon.id=countryObj.userCountryCode,curCon.text=countryObj.userCountry,ZPeopleComponents.select(country).setValue(curCon))}constructFileEditHtml(fieldObj,isRestore,fileSize){let{originalFileName:originalFileName,fileName:fileName,fileExtn:fileExtn,isViewFile:isViewFile,isOriginalFileName:isOriginalFileName}=fieldObj;if(void 0==fileName){let fName=originalFileName;isOriginalFileName?originalFileName=ZSEC.Encoder.encodeForHTML(originalFileName):fName=ZPeople.decodeTxt(originalFileName),fileName=ZSEC.Encoder.encodeForHTML(fName.length>35?fName.slice(0,35)+"...":fName)}else originalFileName=ZSEC.Encoder.encodeForHTMLAttribute(originalFileName);let fileSizeHtml=fileSize?`<span isFileSize="true">${FilesCommon.getFileSize(fileSize)}</span>`:"",viewRestoreHtml="",restoreHtml="",deleteHtml="",progressHtml="";if(isViewFile){let{filepath:filepath,onclickfunc:onclickfunc}=fieldObj;viewRestoreHtml=`<a class="zpl_lnk" href="javascript:;" filename="${originalFileName}" filepath="${filepath}" onclick="${onclickfunc}" class="text-ovr">${isPreviewAllowed&&-1!=ZP5Form.PreviewSupportedFileTypes.indexOf(fileExtn)?ZPI18N.getString("zp.view"):ZPI18N.getString("zp.Download")}</a>`,restoreHtml=`<a href="javascript:;" isrestore="true" onclick="ZP5Form.Field.toggleFileUpload(this);" class="text-ovr DNI">${ZPI18N.getString("zp.restore")}</a>`,deleteHtml='<i class="PI_delete" change="true" onclick="ZP5Form.Field.toggleFileUpload(this);"></i>'}else{let{labelName:labelName,fcId:fcId,rowNumber:rowNumber,isProgress:isProgress}=fieldObj;isRestore&&(viewRestoreHtml=`<span restoreOptionEnabled="true" class="DNI"><a class="zpl_lnk" href="javascript:;" change="false" onclick="ZP5Form.Field.toggleFileUpload(this,true,'${labelName}');" class="text-ovr">${ZPI18N.getString("zp.restore")}</a></span>`),isProgress&&(progressHtml=`<div class="zpl_prgbr"><div><div data-progressjs="${fcId}${rowNumber}" style="width: 0%"></div></div></div></div>`),deleteHtml=`<i class="PI_delete" onclick="ZP5Form.Field.toggleFileFieldDisplay(this, '${labelName}')"></i>`}return`<div><div class="zpl_atchimg"><i class="${FilesCommon.getFileIcon(fileExtn)}"></i></div>\n        \t<div class="zpl_atchdtl"> <h4 ${ComponentsCommon.getTooltipHtml(originalFileName,{position:"top"},!0)}>${fileName}</h4>\n        \t<p elem="file-info">${fileSizeHtml} ${viewRestoreHtml}</p></div><div class="zpl_atchicn">${deleteHtml}</div>${progressHtml}</div>${restoreHtml}`}}class LookupField extends Fields{constructor(){super()}handlePrimaryLookupChange(primLkpVal,mode){if(this.fieldValueChanged)return;let ischanged=!1;var temproleIds=this.getFormFieldAllowedRoleIdsForAdd();let temproleIdsLen=temproleIds.length;if("ADD"==mode&&null!=primLkpVal){var key=this.getFormsProperties().getFormId()+"_"+primLkpVal;this.setFormFieldAllowedRoleIdsForAdd(ZP5Form.PrimaryLookUpOptionAllowedRoleIds[key]?ZP5Form.PrimaryLookUpOptionAllowedRoleIds[key]:[]),temproleIdsLen!=this.getFormFieldAllowedRoleIdsForAdd().length&&(ischanged=!0)}!ischanged&&temproleIdsLen>0&&(ischanged=temproleIds.some(temproleId=>!this.getFormFieldAllowedRoleIdsForAdd().includes(temproleId)));let primLkpType=this.getPrimaryLookupType(primLkpVal);(this.primLkpType!=primLkpType||ischanged)&&(this.primLkpType=primLkpType,this.primLkpVal=primLkpVal,this.isPrimLkpChange=!0,"P_Task"!==this.getTableName()&&this.refreshPage(this.getParams()))}getPrimaryLookupType(primLkpVal){let primLkpType=FormConstants.Permission.VAL.ALL_DATA;return"-Select-"==primLkpVal||primLkpVal==erecno?primLkpType=FormConstants.Permission.VAL.MY_DATA:ZPUtil.checkIsExistInArray(ZPeople.getSubUsers(),primLkpVal)&&(primLkpType=FormConstants.Permission.VAL.SUB_DATA),this.FormOperations.isOperationalRoleAdmin()&&ZPUtil.checkIsExistInArray(this.FormOperations.getLocUsers(),primLkpVal)&&(primLkpType=null),primLkpType}refreshLookupOptions(formCompData){var luArr=new Array;let formClassObj=this;return 7e3===formCompData.code&&$.each(formCompData.message.formComponentDetails,function(){void 0!==this.column1&&this.column1.length>0&&$.each(this.column1,function(){this.fieldType===FormConstants.FieldType.LOOKUP&&(this.isFilterEnabled||this.isPrimary&&((formClassObj.isEditMode()||formClassObj.isSingleFiledEdit())&&void 0==this.EditOptions||formClassObj.isAddMode()&&void 0==this.AddOptions)||ZP5Form.getLookupRefreshStatus(this.formComponentId,this.referredFormId))&&luArr.push(this.formComponentId)}),void 0!==this.column2&&this.column2.length>0&&$.each(this.column2,function(){this.fieldType===FormConstants.FieldType.LOOKUP&&(this.isFilterEnabled||this.isPrimary&&((formClassObj.isEditMode()||formClassObj.isSingleFiledEdit())&&void 0==this.EditOptions||formClassObj.isAddMode()&&void 0==this.AddOptions)||ZP5Form.getLookupRefreshStatus(this.formComponentId,this.referredFormId))&&luArr.push(this.formComponentId)})}),luArr}fetchLookUpData(luFcIds,formData,fieldVal){var params={mode:"fetchFormLookupOtions",luFcIds:JSON.stringify(luFcIds),formId:this.getFormsProperties().getFormId(),subMode:this.getMode()};void 0!=fieldVal&&(params.fieldValues=JSON.stringify(fieldVal)),ZPUtil.Validation.isEmpty(this.getFormsProperties().getRecordId())||(params.recordId=this.getFormsProperties().getRecordId()),this.moduleHandler.loadLookupDataParams(params),this.isEmbedForm&&!isAuthreq?(params.digest=params.digest=Embed_digest,ZPeople.Request.send("/embedFormAction.hr",params,(data,params)=>{this.dependentFieldData(data,params,formData)})):ZPeople.Request.send(ZP5Form.URL,params,(data,params)=>{this.updateLookUpData(data,params,formData)})}updateLookUpData(response,params,formData){if(7e3===response.code){let formClassObj=this;$.each(response.message,function(key,value){formClassObj.updateLookupOptions(formData,key,value)})}!this.isSingleFieldEdit()||this.isSingleFieldModal?this.loadForms(this.FormOperations.getFormComponentData(),params):this.showFieldEditable()}updateLookupOptions(formData,key,value){var allowUpdate=this.moduleHandler.isLookupoptionUpdateAllow(key);let formClassObj=this;$.each(formData.message.formComponentDetails,function(){formClassObj.updateOptions(this.column1,key,value,allowUpdate)||formClassObj.updateOptions(this.column2,key,value,allowUpdate)})}updateOptions(fields,fcId,options,allowUpdate){let self=this;var isFieldUpdated=!1;if(void 0!==fields&&fields.length>0){var tableName=this.getTableName();let formClassObj=this;$.each(fields,function(){var isUpdate=allowUpdate;if(this.formComponentId===fcId||isUpdate){self.FormOperations.updateFormComponentDataValues(this.formComponentId,"Options",options),self.refreshFieldData(),isFieldUpdated=!0;var lookUpData=ZP5Form.LOOKUP_DATA[this.referredFormId],isPrimary=this.isPrimary||isUpdate;if(this.isFilterEnabled&&!isPrimary||(isPrimary?(formClassObj.isEditMode()||formClassObj.isSingleFiledEdit()?formClassObj.FormOperations.updateFormComponentDataValues(this.formComponentId,"EditOptions",options):formClassObj.FormOperations.updateFormComponentDataValues(this.formComponentId,"AddOptions",options),formClassObj.refreshFieldData()):this.displayType!==FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE&&this.displayType!==FormConstants.FieldType.RADIO_DISPLYTYPE||(void 0!==lookUpData.updatedFcIds&&-1===lookUpData.updatedFcIds.indexOf(this.formComponentId)?lookUpData.updatedFcIds.push(this.formComponentId):lookUpData.updatedFcIds=[this.formComponentId])),!formClassObj.moduleHandler.isFieldUpdated(tableName))return!1;isFieldUpdated=!1}})}return isFieldUpdated}registerLookupFieldFunc(){let lkupobj=this;this.FIELD_LAYOUT.find("[relateddata=true]").each((index,obj)=>{var displaytype=$(obj).attr("displaytype");if(parseInt(displaytype)===FormConstants.FieldType.SELECT_DISPLYTYPE||parseInt(displaytype)===FormConstants.FieldType.RADIO_DISPLYTYPE){var findvar=":input";parseInt(displaytype)===FormConstants.FieldType.SELECT_DISPLYTYPE&&(findvar="[fieldtype='26']"),void 0===$(obj).find(findvar).attr("reg")&&($(obj).find(findvar).attr("reg","true"),$(obj).find(findvar).on("change",details=>{this.getRelatedFieldsValue(details.target,displaytype)}))}}),this.FIELD_LAYOUT.find("[isFieldDependent=true]").each((index,obj)=>{var findvar=":input",displaytype=$(obj).attr("displaytype");parseInt(displaytype)!==FormConstants.FieldType.SELECT_DISPLYTYPE&&parseInt(displaytype)!==FormConstants.FieldType.MULTISELECT_DISPLYTYPE||(findvar="[fieldtype='26']"),void 0===$(obj).find(findvar).attr("depreg")&&($(obj).find(findvar).attr("depreg","true"),$(obj).find(findvar).on("change",function(){var displaytype=$(obj).attr("displaytype");lkupobj.getLookupOptionsBasedOnDependentFields(obj,displaytype)}))})}getRelatedFieldsValue(clickedObj,displaytype){if("true"!==$(clickedObj).closest("div[id^='zp_field_outer_']").attr("relateddata"))return;let rowCount=parseInt($(clickedObj).closest("div[id^='zp_section_fields_']").attr("row"));var recId=$(clickedObj).val(),fcId="";if(parseInt(displaytype)===FormConstants.FieldType.SELECT_DISPLYTYPE?fcId=$(clickedObj).attr("id").split("_").pop():parseInt(displaytype)===FormConstants.FieldType.RADIO_DISPLYTYPE&&(fcId=$(clickedObj).closest('div[id^="zp_field_outer_"]').attr("id").split("_").pop()),void 0!==fcId&&""!==fcId.trim()||!this.getSingleFieldEditFcid()||(fcId=this.getSingleFieldEditFcid()),ZPUtil.Validation.isNumber(recId)&&ZPUtil.Validation.isNumber(fcId)){var params={mode:"fetchRelatedFieldsData",recordId:recId,fcId:fcId};this.isEmbedForm&&!isAuthreq?(params.digest=Embed_digest,ZPeople.Request.send("/embedFormAction.hr",params,(resultData,params)=>{this.relatedFieldsResponse(resultData,params,clickedObj)})):ZPeople.Request.send(ZP5Form.URL,params,(resultData,params)=>{this.relatedFieldsResponse(resultData,params,clickedObj)})}else{var formComp=ZP5Form.Field.getFieldComponent(fcId);void 0!==formComp.relatedFieldDetails&&this.setRelatedFieldsData(formComp.relatedFieldDetails,fcId,!0,rowCount)}}relatedFieldsResponse(resultData,params,obj){let relaData={};if(void 0!==resultData&&7e3===resultData.code)relaData=resultData.message?resultData.message[params.recordId]:resultData[params.recordId];else{let fieldData=this.getSingleFieldRecordDetails(params.fcId);for(let key in fieldData.componentValue_RelatedFields)relaData[key]=fieldData.componentValue_RelatedFields[key].Value}let ele=$(obj).closest("div[id^='zp_section_fields_']");$.isEmptyObject(relaData)||(null!==this.getSingleFieldEditFcid()&&(this.SINGLE_FIELD_EDIT_FORM_LOOKUP_RELDATA=relaData),$(ele).find("div[id^='zp_form_relfield_"+params.fcId+"']").find("#zp_form_relfield_value").find("span").html("-"),$.each(relaData,function(key,value){var optHtml=value,fieldType=$(ele).find("#zp_form_relfield_"+params.fcId+"_"+key).attr("fieldtype");fieldType==FormConstants.FieldType.IMAGE?optHtml='<div class="zpl_upld prof"><div class="zpl_fldrp"><img  src="'+(this.isEmbedForm&&!isAuthreq?"embed"+value+"&digest="+Embed_digest:ZPeople.applyPortalName(value))+'" alt="'+ZPI18N.getString("zp.imgerror")+'"></div></div>':fieldType==FormConstants.FieldType.FILE_UPLOAD?optHtml=ZWAF.Encoder.encodeForHTML(value):fieldType==FormConstants.FieldType.ADDRESS&&value.length>0&&""!=value&&(value=JSON.parse(ZPeople.decodeTxt(value)),optHtml=ZP5Form.AddressField.getAddressDisplayHtml(value)),0!=value.length&&""!=value||(optHtml="-"),$(ele).find("#zp_form_relfield_"+params.fcId+"_"+key).find("#zp_form_relfield_value").find("span").html(optHtml)}))}setRelatedFieldsData(relCompVal,fcId,setNodata,row,layout){layout=void 0==layout?$(this.FIELD_LAYOUT):layout,$.each(relCompVal,function(){var value=void 0!=this.Value&&""!=this.Value?this.Value:"-";setNodata&&(value="-");var optHtml="<span>"+value+"</span>",obj=$(layout.find("[id=zp_form_relfield_"+fcId+"_"+this.formComponentId+"]"));if(void 0==row)$.each(obj,function(){if("-"!=ZP5Form.Field.getNoValueString(value)){let fcType=$(this).attr("fieldtype");fcType==FormConstants.FieldType.IMAGE?optHtml='<span><div class="zpl_upld prof"><div class="zpl_fldrp"><img src="'+(this.isEmbedForm&&!isAuthreq?"embed"+value+"&digest="+Embed_digest:ZPeople.applyPortalName(value))+'" alt="'+ZPI18N.getString("zp.imgerror")+'"></div></div></span>':fcType==FormConstants.FieldType.FILE_UPLOAD?optHtml=`<span>${ZWAF.Encoder.encodeForHTML(value)}</span>`:fcType==FormConstants.FieldType.ADDRESS&&(value=JSON.parse(ZPeople.decodeTxt(value)),optHtml=ZP5Form.AddressField.getAddressDisplayHtml(value))}$(this).find("#zp_form_relfield_value").html(optHtml)});else{if(obj=$(layout.find("[id=zp_form_relfield_"+fcId+"_"+this.formComponentId+"]"))[row-1],"-"!=ZP5Form.Field.getNoValueString(value)){let fcType=$(obj).attr("fieldtype");fcType==FormConstants.FieldType.IMAGE?optHtml='<span><div class="zpl_upld prof"><div class="zpl_fldrp"><img src="'+(this.isEmbedForm&&!isAuthreq?"embed"+value+"&digest="+Embed_digest:value)+'" alt="'+ZPI18N.getString("zp.imgerror")+'"></div></div></span>':fcType==FormConstants.FieldType.FILE_UPLOAD?optHtml=`<span>${ZWAF.Encoder.encodeForHTML(value)}</span>`:fcType==FormConstants.FieldType.ADDRESS&&(value=JSON.parse(ZPeople.decodeTxt(value)),optHtml=ZP5Form.AddressField.getAddressDisplayHtml(value))}$(obj).find("#zp_form_relfield_value").html(optHtml)}})}getLookupOptionsBasedOnDependentFields(clickedObj,displaytype){let formsObj=this;var row,formDtl=this.FormOperations.getFormComponentData(),depedentFlds=[],others={};if(clickedObj){var fcId="";fcId=parseInt(displaytype)===FormConstants.FieldType.SELECT_DISPLYTYPE||parseInt(displaytype)===FormConstants.FieldType.MULTISELECT_DISPLYTYPE?clickedObj.id.split("_").pop():$(clickedObj).closest('[id^="zp_field_outer_"]').attr("id").split("_").pop(),depedentFlds=formDtl.message.dependntFieldMappings[fcId];var tabularelement="",fcmap=this.getSingleFieldData(fcId);if(fcmap.isTabular&&!fcmap.isGridType?tabularelement=$(clickedObj).closest('[istabular=true][name="sections_obj"]'):fcmap.isTabular&&fcmap.isGridType&&(tabularelement=$(clickedObj).closest('tr[id="zp_tabular_row"]')),void 0!=tabularelement&&tabularelement.length>0&&(row=parseInt($(tabularelement).attr("row"))-1,others.row=row),!("P_Employee"!==this.getTableName()&&0!==this.getTableName().indexOf("dc_")||"Entity"!=fcmap.labelName&&"Business_unit"!=fcmap.labelName&&"Division"!=fcmap.labelName))return void ZP5Form.handleOrgStructureFieldChange(clickedObj);if(!("P_Candidate"!==this.getTableName()&&0!==this.getTableName().indexOf("dc_")||"CandidateEntity"!=fcmap.labelName&&"Business_unit"!=fcmap.labelName&&"CandidateDivision"!=fcmap.labelName))return void ZP5Form.handleOrgStructureFieldChange(clickedObj)}var fields=[],fieldValues={};$.each(formDtl.message.formComponentDetails,function(){this.isTabular&&!clickedObj||(void 0!==this.column1&&this.column1.length&&$.each(this.column1,function(){this.fieldType===FormConstants.FieldType.LOOKUP&&(clickedObj&&ZPUtil.checkIsExistInArray(depedentFlds,this.formComponentId)||void 0!=this.dependentFiledList&&0!=this.dependentFiledList.length)&&(clickedObj||depedentFlds.push(this.formComponentId),fields=$.merge(fields,this.dependentFiledList))}),void 0!==this.column2&&this.column2.length>0&&$.each(this.column2,function(){this.fieldType===FormConstants.FieldType.LOOKUP&&(clickedObj&&ZPUtil.checkIsExistInArray(depedentFlds,this.formComponentId)||void 0!=this.dependentFiledList&&0!=this.dependentFiledList.length)&&(clickedObj||depedentFlds.push(this.formComponentId),fields=$.merge(fields,this.dependentFiledList))}))});var finalfields=[];let fieldData=this.getFormsProperties().getFieldData();if(0!=depedentFlds.length&&($.each(depedentFlds,function(ind,value){let formcomp=fieldData[value];if(formcomp.displayType===FormConstants.FieldType.SELECT_DISPLYTYPE){if(clickedObj)if(void 0!=row)ZPeopleComponents.select($(formsObj.FIELD_LAYOUT.find("input[fieldtype='26'][name='"+formcomp.labelName+"']")[row])).setValue("-Select-");else{let fieldElems=$(formsObj.FIELD_LAYOUT.find("input[fieldtype='26'][name='"+formcomp.labelName+"']"));for(let fieldElem of fieldElems)ZPeopleComponents.select(fieldElem).setValue("-Select-")}}else formcomp.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE?clickedObj&&(void 0!=row?ZPeopleComponents.tokenfield($(formsObj.FIELD_LAYOUT.find("select[fieldtype='26'][name='"+formcomp.labelName+"']")[row])).removeAllTokens():ZPeopleComponents.tokenfield($(formsObj.FIELD_LAYOUT.find("select[fieldtype='26'][name='"+formcomp.labelName+"']"))).removeAllTokens()):finalfields.push(value)}),0!=finalfields.length)){$.each(formDtl.message.formComponentDetails,function(){void 0!==this.column1&&this.column1.length>0&&ZP5Form.getFieldValues(this.column1,fields,fieldValues,row),void 0!==this.column2&&this.column2.length>0&&ZP5Form.getFieldValues(this.column2,fields,fieldValues,row)});var params={mode:"fetchFormLookupOtions",luFcIds:JSON.stringify(finalfields),formId:this.getFormsProperties().getFormId(),subMode:formsObj.mode};Object.keys(fieldValues).length>0?(params.fieldValues=JSON.stringify(fieldValues),ZPUtil.Validation.isEmpty(this.getFormsProperties().getRecordId())||(params.recordId=this.getFormsProperties().getRecordId()),this.moduleHandler.updateLookupOptionParams(params),this.isEmbedForm&&!isAuthreq?(params.digest=params.digest=Embed_digest,ZPeople.Request.send("/embedFormAction.hr",params,(data,params)=>{this.dependentFieldData(data,params,others)})):ZPeople.Request.send(ZP5Form.URL,params,(data,params)=>{this.dependentFieldData(data,params,others)})):this.dependentFieldData({},params,others)}}dependentFieldData(data,params,others){var fcids=JSON.parse(params.luFcIds),options={};data.code==ZPeople.ResponeCodes.SUCCESS&&(options=data.message);var formDtl=this.FormOperations.getFormComponentData();let formClassObj=this;$.each(formDtl.message.formComponentDetails,function(){void 0!==this.column1&&this.column1.length&&$.each(this.column1,function(){this.fieldType===FormConstants.FieldType.LOOKUP&&ZPUtil.checkIsExistInArray(fcids,this.formComponentId)&&formClassObj.updateDependentFieldOptions(this,options[this.formComponentId],others)}),void 0!==this.column2&&this.column2.length>0&&$.each(this.column2,function(){this.fieldType===FormConstants.FieldType.LOOKUP&&ZPUtil.checkIsExistInArray(fcids,this.formComponentId)&&formClassObj.updateDependentFieldOptions(this,options[this.formComponentId],others)})}),this.registerLookupFieldFunc()}updateDependentFieldOptions(formcomp,options,others){void 0==options&&(options=[]);var fieldObj=this.FIELD_LAYOUT.find(":input[name="+formcomp.labelName+"]");void 0!=others&&void 0!=others.row&&$(fieldObj).length>0&&(fieldObj=$(fieldObj)[others.row]),formcomp.displayType===FormConstants.FieldType.SELECT_DISPLYTYPE||formcomp.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE?$(fieldObj).empty():fieldObj.length>0?(fieldObj=fieldObj.closest("div[fieldtype="+FormConstants.FieldType.LOOKUP+"]")).empty():fieldObj=this.FIELD_LAYOUT.find("#zp_field_outer_"+formcomp.formComponentId).find("div[fieldtype="+FormConstants.FieldType.LOOKUP+"]"),$(fieldObj).append(this.getOptionsByType(formcomp,void 0,void 0,options)),formcomp.displayType===FormConstants.FieldType.SELECT_DISPLYTYPE?$(fieldObj).val("-Select-").select2(ZP5Form.select2.getSelect2Properties({})).trigger("change"):formcomp.displayType===FormConstants.FieldType.MULTISELECT_DISPLYTYPE&&$(fieldObj).val([]).select2(ZP5Form.select2.getSelect2Properties({multiple:!0})).trigger("change"),(this.isEditMode()||this.isAddMode())&&(void 0!=formcomp.relatedFieldDetails&&formcomp.relatedFieldDetails.length>0&&this.setRelatedFieldsData(formcomp.relatedFieldDetails,formcomp.formComponentId,!0,others.row),void 0!=others&&void 0!=others.row||this.setValuesForSingleFields([ZP5Form.Field.getFieldValueData(formcomp.formComponentId)],!0))}}class Permission extends LookupField{constructor(){super()}isPermitted(perm,allowedRoleIdsForEdit,allowedRoleIdsForView){if(!this.isAddMode()&&this.isRecordAdmin()||this.moduleHandler.isModuleAdmin()||null==this.primLkpType&&this.FormOperations.isOperationalRoleAdmin())return!0;var allowedRoleIds=this.isViewMode()?allowedRoleIdsForView:allowedRoleIdsForEdit;return this.isPermAllowed(this.isAddMode()?null!=this.primLkpType?this.primLkpType:FormConstants.Permission.VAL.MY_DATA:ZP5Form.getRecordType(),perm,allowedRoleIds)}isPermAllowed(asked_perm,perm,allowedRoleIds){if(!this.isAddMode()&&(this.isRecordAdmin()||this.moduleHandler.isModuleAdmin()))return!0;var allowedRoleIdsForRecord=[];if(allowedRoleIdsForRecord=this.isAddMode()?JSON.parse(JSON.stringify(this.getFormFieldAllowedRoleIdsForAdd())):this.isEditMode()?this.allowedRoleIdsForRecordEdit:this.allowedRoleIdsForRecordView,void 0!=allowedRoleIds&&allowedRoleIds.length>0)for(var i=0;i<allowedRoleIds.length;i++){var allowedRoleId=allowedRoleIds[i];if(-1!=allowedRoleIdsForRecord.indexOf(this.FormAllowedRoleIds[allowedRoleId]))return!0}return void 0==allowedRoleIds||this.isPermAllowedForDefaultRole()||!this.isAddMode()&&(ZP5Form.isApprover()||ZP5Form.isRecordApprover(this.getFormsProperties().getFormId())||ZP5Form.isTaskOwnerCanEdit(this.getFormsProperties().getFormId()))||(perm=FormConstants.Permission.VAL.NO_DATA),perm!=FormConstants.Permission.VAL.NO_DATA&&asked_perm!=FormConstants.Permission.VAL.NO_DATA&&(asked_perm==FormConstants.Permission.VAL.MY_DATA&&perm!=FormConstants.Permission.VAL.SUB_DATA||asked_perm==FormConstants.Permission.VAL.SUB_DATA&&perm!=FormConstants.Permission.VAL.MY_DATA||asked_perm==FormConstants.Permission.VAL.TEAM_DATA&&(perm==FormConstants.Permission.VAL.TEAM_DATA||perm==FormConstants.Permission.VAL.ALL_DATA)||asked_perm==FormConstants.Permission.VAL.ALL_DATA&&perm==FormConstants.Permission.VAL.ALL_DATA)}isPermAllowedForDefaultRole(){var asked_perm=this.isAddMode()?null!=this.primLkpType?this.primLkpType:FormConstants.Permission.VAL.MY_DATA:ZP5Form.getRecordType(),perm=this.isEditMode()?this.isDraftrec?this.FormOperations.getAddPerm():this.FormOperations.getEditPerm():this.isAddMode()?this.FormOperations.getAddPerm():this.FormOperations.getViewPerm();return perm!=FormConstants.Permission.VAL.NO_DATA&&asked_perm!=FormConstants.Permission.VAL.NO_DATA&&(asked_perm==FormConstants.Permission.VAL.MY_DATA&&perm!=FormConstants.Permission.VAL.SUB_DATA||asked_perm==FormConstants.Permission.VAL.SUB_DATA&&perm!=FormConstants.Permission.VAL.MY_DATA||asked_perm==FormConstants.Permission.VAL.TEAM_DATA&&(perm==FormConstants.Permission.VAL.TEAM_DATA||perm==FormConstants.Permission.VAL.ALL_DATA)||asked_perm==FormConstants.Permission.VAL.ALL_DATA&&perm==FormConstants.Permission.VAL.ALL_DATA)}}class Forms extends Permission{constructor(params,isRefreshNeed){super(),this.FormsProp=this.toInstance(),this.FormOperations=new CurrFormsOperation(params.formId),this.FormOperations.setFormClassObj(this),ZP5Form.CURR_FORM_OPERATION=this.FormOperations,ZP5Form.CURR_FORM_OPERATIONS[params.formId]=this.FormOperations,this.isRefreshNeed=isRefreshNeed,this.getFormsProperties().setParams(this.initParams(params)),this.randomNum=0}initParams(params){return void 0==params.formMode&&(params.formMode="ADD"),void 0===params.recordId&&"ADD"!=params.formMode&&(void 0!==Layout.Page.childUrlParam.zuid?params.zuid=Layout.Page.childUrlParam.zuid:void 0!==Layout.Page.childUrlParam.recordId&&(params.recordId=Layout.Page.childUrlParam.recordId)),params}getRandomNumber(){return this.randomNum++}}class AuditHistory{constructor(props){this.formId=props.formId,this.recordId=props.recordId,this.headerText=(props.headerText?props.headerText+" - ":"")+ZPI18N.getString("zp.audithistory"),this.HistoryFields={}}setContainer(ele){return this.container=ele,this}setModel(modelClass){return this.model=modelClass,this}skipHeader(){return this.SKIP_HEADER=!0,this}skiprgtTL(){return this.SKIP_RGT_TL=!0,this}setOuterHtml(ele){return this.OUTER_HTML=ele,this}setRgtTLStyleNotNeed(){return this.rgtTLStyleNotNeed=!0,this}setScrollDivElem(elem){return this.SCROLL_DIV_ELEM=elem,this}loadAuditHistory(){var params={mode:"getAuditHistoryForRecord",recordId:this.recordId,formId:this.formId};if(void 0==this.HistoryFields[this.formId]&&(params.isHistoryFieldsNeed=!0),void 0!=this.singleFieldFcid)params.singleFieldFcid=this.singleFieldFcid,this.LAYOUT.find("#zp_audit_body").children().addClass("zpl_DNI"),this.LAYOUT.find("#zp_audit_body").append(ZPeople.LOADING_HTML);else{let outerHtml="";if(void 0==this.OUTER_HTML){outerHtml='<div class="" id="zp_audit_history"><div class="zpl_minr">';let headerHtml='<div class="zpl_mhder scrlshdw"><div><h4>'+this.headerText+'</h4></div><a id="zp_history_close" class="_cls PI_cls"></a></div>';outerHtml+=(this.SKIP_HEADER?"":headerHtml)+'<div class="zpl_mcnt zpsl_fm" id="zp_audit_body"></div></div></div>'}else outerHtml=this.OUTER_HTML,this.OUTER_HTML=void 0;this.container.append(outerHtml),this.LAYOUT=this.container.find("#zp_audit_history"),this.LAYOUT.find("#zp_audit_body").html(ZPeople.LOADING_HTML),this.LAYOUT.addClass(ZP5Form.getFormModelClass(this.model)),this.LAYOUT.find("#zp_history_close").on("click",()=>{ZP5Form.AuditHistory.closeCallback(this.LAYOUT)})}ZPeople.Request.send(ZP5Form.URL,params,resultData=>{this.construct(resultData,params)})}registerHistoryPageEvents(){ZPeopleComponents.select(this.LAYOUT.find("#historyFieldsSelect"),{showSearchField:!0,selectedValue:this.singleFieldFcid,dropdownList:{width:"250px",height:"400px",className:"zpl_ddoptnrml"},messages:{noResults:ZPI18N.getString("zp.noresults")},change:()=>{this.getSingleFieldHistory()}}),this.LAYOUT.find("[isHisRow]").on("mouseenter",function(e){$(e.currentTarget).find('[elem="onHoverElem"]').removeClass("DNI")}),this.LAYOUT.find("[isHisRow]").on("mouseleave",function(e){$(e.currentTarget).find('[elem="onHoverElem"]').addClass("DNI")}),this.LAYOUT.find('[elem="journyear"]').on("click",e=>{this.scrollToYear(e)}),this.LAYOUT.find(this.SCROLL_DIV_ELEM).off("scroll").on("scroll",e=>{this.scrollListener(e)})}construct(resultData,params){if(void 0!=this.LAYOUT){let auditHistoryData=this.constructAuditHistoryBody(resultData,params);this.singleFieldFcid="-1",params.singleFieldFcid?(ZPeopleComponents.select(this.LAYOUT.find("#historyFieldsSelect")).destroy(),this.singleFieldFcid=params.singleFieldFcid,this.LAYOUT.find("#zp_audit_body").html(auditHistoryData.bodyHtml),auditHistoryData.isHistoryAvailable||(new EmptyPages("zp_nd_template","",auditHistoryData.message,this.LAYOUT.find(".zpl_minr").find("#zp_history_row_body_nodata")).show(),this.LAYOUT.find("#zp_history_row_body_nodata").find("#emptPage").addClass("zpl_tmlnhd"))):(this.LAYOUT.find("#zp_audit_body").html(auditHistoryData.bodyHtml),auditHistoryData.isHistoryAvailable||(new EmptyPages("zp_nd_template","",auditHistoryData.message,$("body").find("#zp_history_row_body_nodata")).show(),$("body").find("[id=zp_history_row_body_nodata]").find("#emptPage").addClass("zpl_tmlnhd"))),this.registerHistoryPageEvents()}}constructAuditHistoryBody(resultData,params){let leftBodyHtml='<div class="zpl_tmln zpl_adhstry" id="zp_history_row_body">',rightBodyHtml='<div class="zpl_tmlnnav" style="'+(this.rgtTLStyleNotNeed?"":"top: 85px; right: 0; bottom: 0;")+'"><div>'+ZPI18N.getString("zp.history")+"</div>",historyData=resultData.message,latestHistYear="";void 0!=historyData&&"object"==typeof historyData&&void 0!=historyData[0].date&&(latestHistYear=(latestHistYear=Calendar.parseDate(historyData[0].date,uidateFormat).getFullYear()+"").slice(-4));var history_Fields_html='<div><select id="historyFieldsSelect"><option value="-1">'+ZPI18N.getString("zp.all")+"</option>";void 0==ZP5Form.HistoryFields[params.formId]&&(ZP5Form.HistoryFields[params.formId]=resultData.HistoryFields),void 0!=ZP5Form.HistoryFields[params.formId]&&$.each(ZP5Form.HistoryFields[params.formId],function(k){$.each(ZP5Form.HistoryFields[params.formId][k],function(key,value){history_Fields_html+='<option value="'+key+'">'+ZWAF.Encoder.encodeForHTML(value)+"</option>"})});let isSingleFieldHistory=void 0!=params.singleFieldFcid&&"-1"!=params.singleFieldFcid,result={isHistoryAvailable:!0,message:""};history_Fields_html+="</select></div>",leftBodyHtml+='<div class="zpl_tmlnhd"><div class="zpl_tmlnlft"><h3>'+(void 0!=latestHistYear&&"NaN"!=latestHistYear?latestHistYear:"")+'</h3></div><div class="zpl_tmlnrgt">'+history_Fields_html+"</div></div>";let auditHisContHtml="";if(7e3==resultData.code){rightBodyHtml+='<div elem="journyear" class="selctd" yearval='+latestHistYear+">"+latestHistYear+"</div>";var count=0;let createdDetails=resultData.isCreates;if($.each(historyData,function(key,value){let histdata=value.data;$.each(histdata,function(i,data){let modifiedTime=this.modifiedTime,isCreated=this.isCreated,transitionName=this.transitionName,clientTypeId=this.clientType,clientType=ZPI18N.getString(FormConstants.AUDIT_HISTORY.CLIENT_NAME[clientTypeId]),clientSrc=this.clientSrc;clientType=null!=clientSrc&&void 0!=clientSrc&&""!==clientSrc?`<span class="d-flexclmcap5"><span class="mxw100 zpl_ellipsis" ${ComponentsCommon.getTooltipHtml(clientSrc,{position:"top"})}>${ZSEC.Encoder.encodeForHTML(clientSrc)}</span><span>(${clientType})</span></span>`:`<span><span class="w100 zpl_ellipsis">${clientType}</span></span>`;let createdOrEditedMsg=isCreated?ZPI18N.getString("zp.casecreatedby"):ZPI18N.getString("zp.prjctsync.modified");latestHistYear!=modifiedTime.year&&(latestHistYear=modifiedTime.year,rightBodyHtml+='<div elem="journyear" yearval='+latestHistYear+">"+latestHistYear+"</div>",auditHisContHtml+='<div class="zpl_tmlnhd"><div class="zpl_tmlnlft"><h3>'+latestHistYear+'</h3></div><div class="zpl_tmlnrgt"></div></div>'),auditHisContHtml+='<div class="zpl_tmlnrow" elem="histYear'+latestHistYear+'" yearval="'+latestHistYear+'">',auditHisContHtml+='<div class="zpl_tmlnlft"><div><b>'+modifiedTime.day+"</b><span>"+ZPI18N.getString(ZP5Form.months[modifiedTime.month])+"</span></div></div>",auditHisContHtml+='<div class="zpl_tmlnrgt">',isSingleFieldHistory&&0!=count&&(auditHisContHtml+='<div class="d-flexM"><label class="zpl_tmlblgrp">'+data.diff+"</label></div>"),auditHisContHtml+='<div class="zpl_crd" isHisRow="true">';let ownerHtml=(void 0!=data.ownerId&&""!=data.ownerId?"<em>"+data.ownerId+" - </em>":"")+"<b>"+data.ownerDisplayName+"</b>",transitionHtml=void 0!=transitionName?"<em>"+ZPI18N.getString("zp.transitionname")+" : <span>"+transitionName+"</span></em>&emsp;":"",srcHtml=clientType.length>0?"<em>"+ZPI18N.getString("zp.client_src")+" :</em>"+clientType+"</span>":"",photoSrc=ZPeople.applyPortalName(data.ownerPhoto);auditHisContHtml+=`<div><div class="zpl_em"><div class="zpl_emimg"><img src="${photoSrc}"></div><div class="zpl_emdts zpl_ellipsis"><div ${ComponentsCommon.getTooltipHtml(data.ownerDisplayName,{position:"top"},!0)}>${ownerHtml}</div></div></div><div class="zpl_edtdst DNI" elem="onHoverElem"><div>${transitionHtml}${srcHtml}</div><div><em>${createdOrEditedMsg} : <span>${modifiedTime.time}</span></em></div></div></div>`,auditHisContHtml+='<div><div class="zpl_tblres wd100_per"><table class="zpl_tbl zpl_tblhgtmin zpl_tblvtop"><tbody>';var cnt=0,enableShowMore=!1;if($.each(this.formComponentIdsArray,function(index,value){var fieldDtl=data[value];if(cnt>2&&cnt<=3&&(enableShowMore=!0,auditHisContHtml+='</tbody></table><div class="DN" id="historyTrack'+count+'"><table class="zpl_tbl zpl_tblhgtmin zpl_tblvtop"><tbody>'),fieldDtl.fieldType===FormConstants.FieldType.FILE_UPLOAD||fieldDtl.fieldType===FormConstants.FieldType.IMAGE)if(isSingleFieldHistory)auditHisContHtml+='<tr><td width="200"> <span>'+fieldDtl.fieldDisplayName+" </span></td><td><span>"+ZP5Form.Record.getAuditFileValue(fieldDtl.newFileName,fieldDtl.newFilePath)+'</span></td><td width="350"></td></tr>';else{let val=ZP5Form.Record.getAuditFileValue(fieldDtl.oldFileName,fieldDtl.oldFilePath),newVal=ZP5Form.Record.getAuditFileValue(fieldDtl.newFileName,fieldDtl.newFilePath);auditHisContHtml+='<tr><td width="200"> <span>'+fieldDtl.fieldDisplayName+"</span></td><td><span> "+val+' </span></td><td width="350"><span class="zpl_flexaligngap2 zpl_items-start"><i class="PI_frwd"></i> '+newVal+"</span></td></tr>"}else if(isSingleFieldHistory)auditHisContHtml+='<tr><td width="200"> <span>'+fieldDtl.fieldDisplayName+" </span></td><td><span>"+ZP5Form.Field.getStringForNewLine(ZP5Form.Field.getNoValueString(fieldDtl.newvalue))+' </span></td><td width="350"></td></tr>';else{let val=ZP5Form.Field.getStringForNewLine(ZP5Form.Field.getNoValueString(fieldDtl.oldvalue)),newVal=ZP5Form.Field.getStringForNewLine(ZP5Form.Field.getNoValueString(fieldDtl.newvalue));auditHisContHtml+='<tr><td width="200"> <span>'+fieldDtl.fieldDisplayName+"</span></td><td><span> "+val+'</span></td><td width="350"><span class="zpl_flexaligngap2 zpl_items-start"><i class="PI_frwd"></i> '+newVal+"</span></td></tr>"}cnt+=1}),auditHisContHtml+="</tbody></table>",enableShowMore){var dif=cnt-3;auditHisContHtml+='</div><table class="zpl_tbl zpl_tblhgtmin"><tbody><tr><td class="text-right"><div class="zpl_showmore" data-parent="#zp_history_row_body" target="#historyTrack'+count+'" onclick="ZP5Form.Record.collap(this)" expand="false" count="'+dif+'"><a>'+dif+" "+ZPI18N.getString("zp.more")+" </a></div></td></tr></tbody></table>",enableShowMore=!1}auditHisContHtml+="</div></div></div></div>",auditHisContHtml+="</div>",count+=1})}),void 0!=createdDetails&&!isSingleFieldHistory){void 0!=ZP5Form.getSingleRecord(this.formId,this.recordId)&&(auditHisContHtml+='<div class="zpl_tmlnrow" elem="histYear"'+createdDetails.year+'  yearval="'+createdDetails.year+'"><div class="zpl_tmlnlft"><div><b>'+createdDetails.day+"</b><span>"+ZPI18N.getString(ZP5Form.months[createdDetails.month])+'</span></div></div><div class="zpl_tmlnrgt"><div class="zpl_crd" ishisrow="true"><div><div class="zpl_em"><div class="zpl_emimg"><img src="'+ZPeople.applyPortalName(createdDetails.empPhoto)+'"></div><div class="zpl_emdts zpl_ellipsis"><div '+ComponentsCommon.getTooltipHtml(createdDetails.empName,{position:"top"},!0)+"><em>"+createdDetails.empId+" - </em><b>"+createdDetails.empName+'</b></div></div></div><div class="zpl_edtdst"><em>'+ZPI18N.getString("zp.casecreatedby")+" : <span>"+createdDetails.time+"</span></em></div></div></div></div></div>")}}else void 0!==resultData.message&&(result.isHistoryAvailable=!1,result.message=resultData.message,auditHisContHtml+='<div id="zp_history_row_body_nodata" class="grybg"></div>');return leftBodyHtml+=auditHisContHtml+"</div>",rightBodyHtml+="</div>",result.bodyHtml=leftBodyHtml,this.SKIP_RGT_TL||(result.bodyHtml+=rightBodyHtml),result}getSingleFieldHistory(){this.singleFieldFcid=ZPeopleComponents.select("#historyFieldsSelect").getValue(),this.loadAuditHistory()}scrollListener(e){if(this.lastAnimatedScroll=this.animatedScroll,this.animatedScroll=this.LAYOUT.find(this.SCROLL_DIV_ELEM).is(":animated"),!this.lastAnimatedScroll&&!this.animatedScroll){var activeYear=this.LAYOUT.find('[elem="journyear"].selctd').attr("yearval"),activeYearLiElem=this.LAYOUT.find('[elem="histYear'+activeYear+'"]:last');if(void 0!=activeYearLiElem&&activeYearLiElem.length>0){var container=this.LAYOUT.find(this.SCROLL_DIV_ELEM),elemOutOfViewObj=this.isElemOutOfView(activeYearLiElem,container);if(elemOutOfViewObj.isOutOfView){var yearElems=container.find('[elem^="histYear"]'),visibleYearElems=this.getVisibleElems(yearElems,container);if(visibleYearElems.length>0){var curActiveYear=("top"==elemOutOfViewObj.whichWayOut?$(visibleYearElems[0]):$(visibleYearElems[visibleYearElems.length-1])).attr("yearval");this.LAYOUT.find('[elem="journyear"].selctd').removeClass("selctd"),this.LAYOUT.find('[elem="journyear"][yearval="'+curActiveYear+'"]').addClass("selctd")}}}}}isElemOutOfView(ele,container){var returnObj={},elemOutOfView=!1,containerTop=container[0].scrollTop+this.LAYOUT.find(this.LAYOUT.find(".zpl_tmlnnav").children()[0]).outerHeight(),containerBottom=containerTop+container[0].clientHeight,eleTop=ele[0].offsetTop,eleBottom=eleTop+ele[0].clientHeight;return eleTop>containerBottom?(elemOutOfView=!0,returnObj.whichWayOut="bottom"):eleBottom<containerTop&&(elemOutOfView=!0,returnObj.whichWayOut="top"),returnObj.isOutOfView=elemOutOfView,returnObj}getVisibleElems(elems,container){var visibleElems=[],scrollheightdiv=this.LAYOUT.find(".zpl_tmlnnav").children()[0],containerTop=container[0].scrollTop+this.LAYOUT.find(scrollheightdiv).outerHeight(),containerBottom=containerTop+container[0].clientHeight;return $.each(elems,function(elemIndex,ele){var eleTop=ele.offsetTop,eleBottom=eleTop+ele.clientHeight;(eleTop>=containerTop&&eleBottom<=containerBottom||eleTop<containerTop&&containerTop<eleBottom||eleTop<containerBottom&&containerBottom<eleBottom)&&visibleElems.push(ele)}),visibleElems}scrollToYear(e){var curTarget=$(e.currentTarget),curTargetYear=curTarget.attr("yearval"),activeYear=this.LAYOUT.find('[elem="journyear"].selctd').attr("yearval"),scrollheightdiv=this.LAYOUT.find(".zpl_tmlnnav").children()[0];if(curTargetYear!=activeYear){var scrollDiv=this.LAYOUT.find(this.SCROLL_DIV_ELEM),targetElem=this.LAYOUT.find('[elem="histYear'+curTargetYear+'"]:first');scrollDiv.animate({scrollTop:targetElem[0].offsetTop-this.LAYOUT.find(scrollheightdiv).outerHeight()},{duration:600}),this.LAYOUT.find('[elem="journyear"].selctd').removeClass("selctd"),curTarget.addClass("selctd")}}}class InfoToolTip{constructor(){return this._tooltipIds=[],this._popoverIds=[],this._tooltipIndex=-1,this._popoverIndex=-1,this._container=$("body"),ComponentsCommon.popover.destroy(),this}getContainer(){return this._container}addToolTipId(id){this._tooltipIds.push(id)}addPopoverId(id){this._popoverIds.push(id)}construct(index,ids,position){let idx=-1==index?0:index;for(;idx<=ids.length;idx++)ComponentsCommon.popover.init(this._container.find("#"+ids[idx]+"_content"),{forElement:this._container.find("#"+ids[idx]),position:position,animation:{open:{name:"fadeIn"},close:{name:"fadeOut"}}},"mouseover","mouseout");return idx-1}constructTooltips(isAuto){this._tooltipIds.length>0&&(this._tooltipIndex=this.construct(this._tooltipIndex,this._tooltipIds,isAuto?"auto":"right")),this._popoverIds.length>0&&(this._popoverIndex=this.construct(this._popoverIndex,this._popoverIds,"bottom"))}destroyTooltips(obj){this._tooltipIds.length>0&&(this._tooltipIndex=this.destroy(obj,this._tooltipIds,this._tooltipIndex)),this._popoverIds.length>0&&(void 0==obj||!obj.isSingleEdit)&&(this._popoverIndex=this.destroy(obj,this._popoverIds,this._popoverIndex))}destroy(obj,ids,idIndex){if(void 0==obj||!obj.isSpecific){for(let idx in ids)ComponentsCommon.popover.destroy(this._container.find("#"+ids[idx]+"_content"));return ids.length=0,-1}if(void 0!=obj.id){let idx=ids.indexOf(obj.id);if(-1!=idx)return ComponentsCommon.popover.destroy(this._container.find("#"+ids[idx]+"_content")),ids.splice(idx,1),idIndex-1}}}var ZPFRulesNew={OPERATOR:{SHOW:0,HIDE:1,ALL:0,ANY:1},leaveTypes:[],setLeaveTypes:data=>{if(data.hasOwnProperty("leaveTypes")&&data.leaveTypes.length>0){let options=[];$.each(data.leaveTypes,function(i,lType){options.push({Id:lType.id,DISPVALUE:lType.name})}),ZPFRulesNew.leaveTypes=options}},getFormattedRulesArray:data=>{let rulesArray=[];return void 0!=data.ruleArray&&(rulesArray=data.ruleArray,delete data.ruleArray,$.each(rulesArray,function(index,val){let fieldElms=[],actionElms=[];$.each(val.conditionArray,function(i1,v1){fieldElms.push(v1.fcid.toString())}),val.fieldElms=fieldElms,$.each(val.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2])})}),val.actionElms=actionElms})),rulesArray},constructActionElms:function(rulesArray){var responseRuleObj={},actionElms=[],ruleElms=[];return $.each(rulesArray,function(index){var currRule=rulesArray[index];$.each(currRule.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2]),ruleElms.push(currRule)})})}),responseRuleObj.actionElms=actionElms,responseRuleObj.rules=ruleElms,responseRuleObj},hideFields:function(currentRow,prevRow){let secId=prevRow.attr("secid");secId=secId||prevRow.attr("id").substring(prevRow.attr("id").lastIndexOf("_")+1);let secdtl=this.getSectionDetailBasedOnSecId(secId),sectionHidenFields=ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secId];return void 0!=sectionHidenFields&&(secdtl.isGridType?this.hideFieldSTabinGridSec(sectionHidenFields,currentRow):this.handleFildTabNormalSec(sectionHidenFields,currentRow)),currentRow},hideFieldSTabinGridSec(sectionHidenFields,currentRow){for(let fcid of sectionHidenFields){let formComp=ZP5Form.Field.getFieldComponent(fcid);if(formComp.fieldType!=FormConstants.FieldType.ADDRESS)currentRow.find("td#zp_field_outer_"+fcid).addClass("DNI"),currentRow.find("td#zp_field_outer_"+fcid).attr("isActionHidden",!0);else for(let currColumnName of FormConstants.AddressField.COLUMNAMEARRAY){let $_elem=$(currentRow).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]");$_elem.addClass("DNI"),$_elem.attr("isActionHidden",!0)}}},handleFildTabNormalSec(sectionHidenFields,currentRow){for(let fcid of sectionHidenFields)currentRow.find("#zp_field_outer_"+fcid).parent("div").addClass("DNI"),currentRow.find("#zp_field_outer_"+fcid).attr("isActionHidden",!0)},getSectionDetailBasedOnSecId(secid){for(let section of ZP5Form.getCurrFormsOperation().getFormComponentData().message.formComponentDetails)if(section.sectionId==secid)return section},Components:{compList:["select","tokenfield","numberfield","datefield","datetimefield"],destroy:container=>{container.find("[zfctype]").each(function(i,elem){let zfctype=$(elem).attr("zfctype");ZPFRulesNew.Components.compList.includes(zfctype)&&ComponentsCommon.safeDestroyZComponent(zfctype,elem)})}}};ZPFRulesNew.Configurations={count:1,formActionUsedFields:[],addRuleDiv:'<div class="zpl_mhderrgt"><button type="button" elem="addRuleButton" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.addrule")+"</button></div>",showHideFieldsDiv:'<div class="zpl_idiv"><input type="text" class="ztextbox is-disabled" readonly disabled value="$VALUE$"><select zfctype="tokenfield" data-width="400" multiple="" elem="$ELEMNAME$" class="ztokenfield w400"></select></div>',FORM_COMPONENT_DATA:[],FIELD_RULE_DETAILS:[],refresh:formId=>{ZPFRulesNew.Configurations.FORM_COMPONENT_DATA[formId]=void 0},setFormDetails:(formId,data)=>{ZPFRulesNew.Configurations.FORM_COMPONENT_DATA[formId]=void 0!=data?JSON.stringify(data):void 0},getFormDetails:formId=>{let formDetails=ZPFRulesNew.Configurations.FORM_COMPONENT_DATA[formId||ZPFRulesNew.Configurations.formId];return void 0!=formDetails?JSON.parse(formDetails):void 0},getTableName:formId=>ZPFRulesNew.Configurations.getFormDetails(formId).formDetails.tableName,getUniqueFields:formId=>ZPFRulesNew.Configurations.getFormDetails(formId).message.UniqueFieldDetails,getFormComponentDetails:formId=>ZPFRulesNew.Configurations.getFormDetails(formId).message.formComponentDetails,getFieldComponent:function(formCompId,formId){let fieldDetails,formDtl=ZPFRulesNew.Configurations.getFormComponentDetails(formId);if(void 0!==formDtl){let findFieldObj=(listObj,fieldId)=>{let field;return $.each(listObj,function(){if(this.formComponentId==fieldId)return field=this,!1}),field};$.each(formDtl,function(){return!(this.column1.length>0&&void 0!==(fieldDetails=findFieldObj(this.column1,formCompId)))&&(!(void 0===fieldDetails&&this.column2.length>0&&void 0!==(fieldDetails=findFieldObj(this.column2,formCompId)))&&void 0)})}return fieldDetails},setFieldRuleDetails:(formId,data)=>{ZPFRulesNew.Configurations.FIELD_RULE_DETAILS[formId]=void 0!=data?JSON.stringify(data):void 0},getFieldRuleDetails:formId=>{let fieldRuleDetails=ZPFRulesNew.Configurations.FIELD_RULE_DETAILS[formId||ZPFRulesNew.Configurations.formId];return void 0!=fieldRuleDetails?JSON.parse(fieldRuleDetails):void 0},addRule:function(ruleDetails){let ruleId=(ruleDetails=void 0==ruleDetails?{}:ruleDetails).hasOwnProperty("ruleId")?"ruleid="+ruleDetails.ruleId:"",anySelected="",allSelected="selected";ruleDetails.hasOwnProperty("operator")&&ruleDetails.operator==ZPFRulesNew.OPERATOR.ANY&&(anySelected="selected",allSelected="");let ruleDiv='<div class="zpl_collapsepanel DNI" elem="ruleDiv" '+ruleId+' rowno="'+ZPFRulesNew.Configurations.count+'" isCollapsed="true">';ruleDiv+='<div class="zpl_collapseheader" elem="ruleHeader">',ruleDiv+='<div class="zpl_tgsprt"><h5 elem="ruleTitle">'+ZPI18N.getString("zp.rule")+" "+ZPFRulesNew.Configurations.count+"</h5></div>",ruleDiv+='<div class="zpl_collaspeactions"><i class="PI_delete" elem="ruleDeleteIcon"></i></div>',ruleDiv+="</div>",ruleDiv+='<div class="zpl_collapsecontent">',ruleDiv+='<div class="zpl_secn" >',ruleDiv+='<div class="d-flexC d-flexclmcap12"><span>'+ZPI18N.getString("zp.if")+"</span>",ruleDiv+='<select zfctype="select" class="zselectbox w100" elem="ruleOperator">',ruleDiv+='<option value="0" '+allSelected+">"+ZPI18N.getString("zp.all")+"</option>",ruleDiv+='<option value="1" '+anySelected+">"+ZPI18N.getString("zp.any")+"</option>",ruleDiv+="</select>",ruleDiv+="<span>"+ZPI18N.getString("zp.followingconditionsmet")+"</span></div>",ruleDiv+='<div><div class="zpl_cndor wd100_per"><div class="zpl_gbox"  elem="ruleCondidtionContainer"></div></div></div>',ruleDiv+="</div>",ruleDiv+='<div class="zpl_secn">',ruleDiv+="<div><h4><span>"+ZPI18N.getString("zp.performactions")+"</span></h4></div>",ruleDiv+='<div><div class="zpl_cndor wd100_per"><div class="zpl_gbox" elem="condShowHideContainer"></div></div></div>',ruleDiv+="</div>",ruleDiv+="</div></div>",ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer]").append(ruleDiv),ZPFRulesNew.Configurations.showHideFirstDeleteIcon();let addedRuleDiv=ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer] [elem=ruleDiv]:last");ZPeopleComponents.collapsiblepanel(addedRuleDiv,{toggleButtonPosition:"right",beforepanelcollapse:ZPFRulesNew.Configurations.isPanelCollapsible,beforepanelexpand:ZPFRulesNew.Configurations.collapseOtherPanels,panelexpand:event=>{$(event.target).attr("isCollapsed",!1)},panelcollapse:event=>{$(event.target).attr("isCollapsed",!0)},isActive:!1}),ZPeopleComponents.select($(addedRuleDiv).find("[elem=ruleOperator]"),{width:"100",change:event=>{FrameworkCommon.madeChanges.setOnEvent(event,ZPFRulesNew.Configurations.Modal)}});let fields=ZPFRulesNew.Configurations.getFormComponentDetails(),fcId=ZPFRulesNew.Configurations.findFirstFcId(fields,ZPFRulesNew.Configurations.formId,ZPFRulesNew.Configurations.getTableName()),conditionArray=ruleDetails.hasOwnProperty("conditionArray")?ruleDetails.conditionArray:[{fcid:fcId}];ZPFRulesNew.Conditions.init($(addedRuleDiv).find("[elem=ruleCondidtionContainer]"),ZPFRulesNew.Configurations.formId,conditionArray,fields);let showHideFieldsCont=$(addedRuleDiv).find("[elem=condShowHideContainer]"),showFieldsDiv=ZPFRulesNew.Configurations.showHideFieldsDiv;showFieldsDiv=(showFieldsDiv=showFieldsDiv.replace(/\$VALUE\$/g,ZPI18N.getString("zp.show"))).replace(/\$ELEMNAME\$/g,"showFieldsSelect"),$(showHideFieldsCont).append(showFieldsDiv);let hideFieldsDiv=ZPFRulesNew.Configurations.showHideFieldsDiv;hideFieldsDiv=(hideFieldsDiv=hideFieldsDiv.replace(/\$VALUE\$/g,ZPI18N.getString("zp.hide"))).replace(/\$ELEMNAME\$/g,"hideFieldsSelect"),$(showHideFieldsCont).append(hideFieldsDiv),$(showHideFieldsCont).append('<span elem="showHideFieldsErrMsg" class="ztextbox--error__label DNI">'+ZPI18N.getString("zp.showhidefield")+"</span>");let uniqueFields=ZPFRulesNew.Configurations.getUniqueFields(),actionArray=ruleDetails.hasOwnProperty("actionArray")?ruleDetails.actionArray:[],showArray=[],hideArray=[];$.each(actionArray,function(index,action){action.operator==ZPFRulesNew.OPERATOR.SHOW?showArray=action.fieldArray:hideArray=action.fieldArray});let compProps=ComponentsCommon.token.getProps({lazyLoading:!1,dataMapping:{groupLabel:"groupLabel",value:"value",text:"label",id:"value",informativeText:"label",titleText:"label"},tokenadd:ZPFRulesNew.Configurations.updateActionArray,tokenremove:ZPFRulesNew.Configurations.updateActionArray,dropdownlistbeforeopen:ZPFRulesNew.Configurations.updateShowHideFieldOptions}),showFieldOptions=ZPFRulesNew.Configurations.getFieldOptions(!1,fields,showArray,uniqueFields),hideFieldOptions=ZPFRulesNew.Configurations.getFieldOptions(!1,fields,hideArray,uniqueFields);return compProps.data=showFieldOptions[0],compProps.values=showFieldOptions[1],ZPeopleComponents.tokenfield($(showHideFieldsCont).find("[elem=showFieldsSelect]"),compProps),compProps.data=hideFieldOptions[0],compProps.values=hideFieldOptions[1],ZPeopleComponents.tokenfield($(showHideFieldsCont).find("[elem=hideFieldsSelect]"),compProps),ZPFRulesNew.Configurations.rulePopupDefaultActions(),addedRuleDiv},isPanelCollapsible:function(event){return"false"!=$(event.target).attr("isCollapsed")||!event||!event.detail||!0!==event.detail.isTrusted||!ZPFRulesNew.Configurations.validateRule(event.target)},collapseOtherPanels:function(event){let isValid=!0;return"true"==$(event.target).attr("isCollapsed")&&event&&event.detail&&!0===event.detail.isTrusted&&$.each(ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer] [elem=ruleDiv]"),function(ind,ruleDiv){if(ZPFRulesNew.Configurations.validateRule($(ruleDiv)))return ZPeopleComponents.collapsiblepanel($(ruleDiv)).expandPanel(),$(ruleDiv).last()[0].scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),isValid=!1,!1;ZPeopleComponents.collapsiblepanel($(ruleDiv)).collapsePanel()}),isValid},addNewRule:function(event){let ruleCount=ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer] [elem=ruleDiv]").length,hasError=!1;if($.each(ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer] [elem=ruleDiv]"),function(ind,ruleDiv){ZPFRulesNew.Configurations.validateRule($(ruleDiv))?(hasError||(ZPeopleComponents.collapsiblepanel($(ruleDiv)).expandPanel(),$(ruleDiv).last()[0].scrollIntoView({behavior:"smooth",block:"end",inline:"end"})),hasError=!0):ZPeopleComponents.collapsiblepanel($(ruleDiv)).collapsePanel()}),!hasError){ZPFRulesNew.Configurations.count=++ruleCount;let newRuleDiv=ZPFRulesNew.Configurations.addRule();$(newRuleDiv).removeClass("DNI"),ZPeopleComponents.collapsiblepanel($(newRuleDiv)).expandPanel(),$(newRuleDiv).last()[0].scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),event&&FrameworkCommon.madeChanges.set(ZPFRulesNew.Configurations.Modal,!0)}},updateShowHideFieldOptions:function(event){if("true"==$(event.target).attr("isChange")){let fields=ZPFRulesNew.Configurations.getFormComponentDetails(),selectedTokens=ZPeopleComponents.tokenfield($(event.target)).getAllValues(),valArray=[];$.each(selectedTokens,function(index,data){valArray.push(data.value)});let uniqueFields=ZPFRulesNew.Configurations.getUniqueFields();ZPeopleComponents.tokenfield($(event.target)).setAttribute("data",ZPFRulesNew.Configurations.getFieldOptions(!1,fields,valArray,uniqueFields)[0]),ZPeopleComponents.tokenfield($(event.target)).setAttribute("values",selectedTokens),$(event.target).attr("isChange",!1),ZPeopleComponents.tokenfield($(event.target)).openDropdownList()}},updateActionArray:function(event){let formActionArray=ZPFRulesNew.Configurations.formActionUsedFields[ZPFRulesNew.Configurations.formId];if("ztokenfieldtokenadd"==event.type){FrameworkCommon.madeChanges.set(ZPFRulesNew.Configurations.Modal,!0),$.inArray(event.detail.tokenData.actualData.value,formActionArray)<=-1&&(formActionArray.push(event.detail.tokenData.actualData.value),ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer]").find("[elem=showFieldsSelect],[elem=hideFieldsSelect]").attr("isChange","true"))}else if("ztokenfieldtokenremove"==event.type){FrameworkCommon.madeChanges.set(ZPFRulesNew.Configurations.Modal,!0);let ind=$.inArray(event.detail.tokenData.actualData.value,formActionArray);ind>-1&&(formActionArray.splice(ind,1),ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer]").find("[elem=showFieldsSelect],[elem=hideFieldsSelect]").attr("isChange","true"))}ZPFRulesNew.Configurations.formActionUsedFields[ZPFRulesNew.Configurations.formId]=formActionArray},getFieldOptions:function(isCondField,fields,fieldArray,uniqueFields,isBlueprint){let actionArray=[];isCondField||void 0!=(actionArray=ZPFRulesNew.Configurations.formActionUsedFields[ZPFRulesNew.Configurations.formId])&&0!=actionArray.length||(actionArray=ZPFRulesNew.Configurations.getAllActions(ZPFRulesNew.Configurations.getFieldRuleDetails()),ZPFRulesNew.Configurations.formActionUsedFields[ZPFRulesNew.Configurations.formId]=actionArray);let formTableName=ZPFRulesNew.Configurations.getTableName(),noOptions=!0,optGroup=[],options=[],selectedOptions=[];return $.each(fields,function(ind1,section){isCondField&&(options=[]),$.each(["column1","column2"],function(ind2,col){$.each(section[col],function(ind3,field){if(void 0!=field&&(isCondField||!ZPUtil.checkIsExistInArray(uniqueFields,field.labelName))&&(!isCondField||!section.isTabular)&&ZPFRulesNew.Configurations.isFieldAllowed(isCondField,field,fieldArray,formTableName,actionArray,isBlueprint)){noOptions=!1;let option={label:ZPeople.decodeTxt(field.displayName),value:field.formComponentId};isCondField||(option.groupLabel=ZPeople.decodeTxt(section.sectionName),$.inArray(field.formComponentId,fieldArray)>-1&&selectedOptions.push(option)),options.push(option)}})}),isCondField&&options.length>0&&optGroup.push({label:ZPeople.decodeTxt(section.sectionName),value:section.sectionId,optgroupLabel:ZPeople.decodeTxt(section.sectionName),id:section.sectionId,options:options})}),isCondField&&noOptions?optGroup=[]:noOptions&&0==actionArray.length?(optGroup.push([]),optGroup.push([])):(optGroup.push(options),optGroup.push(selectedOptions)),optGroup},getAllActions:function(rules){let actionArray=[],cnt=0;return $.each(rules,function(index,rule){$.each(rule.actionArray,function(index1,action){$.each(action.fieldArray,function(index2,field){actionArray[cnt++]=field})})}),actionArray},findFirstFcId:function(fields,formId,tableName,isBlueprint){let fcId=null,returnFlag=!0,fieldArray=ZPFRulesNew.Configurations.formActionUsedFields[formId];return $.each(fields,function(index1,section){return $.each(["column1","column2"],function(index2,col){return $.each(section[col],function(index3,field){return void 0!=field&&ZPFRulesNew.Configurations.isFieldAllowed(!0,field,[],tableName,fieldArray,isBlueprint)&&(fcId=field.formComponentId,returnFlag=!1),returnFlag}),returnFlag}),returnFlag}),fcId},isFieldAllowed:function(isCondField,field,fieldArray,formTableName,actionArray,isBlueprint){if(isCondField){if(field.isReadOnly)return!1;if(field.hasOwnProperty("displayType")&&$.inArray(field.displayType,[FormConstants.FieldType.MULTISELECT_DISPLYTYPE,FormConstants.FieldType.CHECK_BOXES_DISPLYTYPE])>-1)return!1;if((!isBlueprint||field.fieldType!=FormConstants.FieldType.FILE_UPLOAD)&&$.inArray(field.fieldType,[FormConstants.FieldType.FILE_UPLOAD,FormConstants.FieldType.SCRIPT,FormConstants.FieldType.PLAIN_TEXT,FormConstants.FieldType.IMAGE,FormConstants.FieldType.AUTONUMBER,FormConstants.FieldType.ADDRESS,FormConstants.FieldType.SOCIAL_SECURITY_NUMBER])>-1)return!1;if("P_TimesheetJob"==formTableName&&$.inArray(field.labelName,["BillableStatus","Hours"])>-1)return!1;if("P_ClientDetails"==formTableName&&$.inArray(field.labelName,["Billing_Method"])>-1)return!1;if("P_PerformanceAppraisal"==formTableName&&$.inArray(field.labelName,["Rating","CurrentCTC"])>-1||"P_SelfAppraisal"==formTableName&&$.inArray(field.labelName,["AppriasalConfiguration","Rating"])>-1)return!1;if("P_EmployeeLeave"==formTableName&&$.inArray(field.labelName,["DateOfRequest","Daystaken","ZP_Leave_Unit"])>-1)return!1;if("P_Employee"==formTableName&&field.isSystem&&$.inArray(field.labelName,["OrganizationTag"])>-1)return!1;if(("P_Resignation"==formTableName||"P_Termination"==formTableName||"P_Deceased"==formTableName)&&"Replacement_required"==field.labelName)return!1}else{if(field.isReadOnly||field.isSystemMandatory)return!1;if($.inArray(formTableName,Timetracker.constants.tableNames)>-1&&(field.isSystem||"P_TimesheetJob"==formTableName&&$.inArray(field.labelName,["Reminder","ReminderTime"])>-1))return!1;if("P_Employee"==formTableName&&field.isSystem&&$.inArray(field.labelName,["Second_Reporting_To","Reporting_To","Role"])>-1)return!1;if("P_EmployeeLeave"==formTableName&&field.isSystem&&$.inArray(field.labelName,["TeamEmailID","Reasonforleave"])<0)return!1;if("P_Goals"==formTableName&&field.isSystem&&$.inArray(field.labelName,["UserRating","ManagerRating"])>-1)return!1;if("P_Candidate"==formTableName&&field.isSystem&&$.inArray(field.labelName,["Last_Name"])>-1)return!1;if("P_Employee"==formTableName&&field.isSystem&&$.inArray(field.labelName,["Entity","Business_unit","Division","OrganizationTag"])>-1)return!1;if(("P_Resignation"==formTableName||"P_Termination"==formTableName||"P_Deceased"==formTableName)&&field.isSystem)return!1;if($.inArray(field.fieldType,[FormConstants.FieldType.AUTONUMBER])>-1)return!1;if($.inArray(field.formComponentId,fieldArray)<0&&$.inArray(field.formComponentId,actionArray)>-1)return!1}return!0},deleteRule:function(event){event.stopPropagation();let ruleDiv=$(event.target).closest("[elem=ruleDiv]"),ruleId=$(ruleDiv).attr("ruleid");if(void 0==ruleId||""==ruleId.trim())$(ruleDiv).siblings("[elem=ruleDiv]").length>0&&(ZPFRulesNew.Configurations.updateUsedFieldsList(ruleDiv),ZPFRulesNew.Components.destroy($(ruleDiv)),$(ruleDiv).remove(),ZPFRulesNew.Configurations.sortRules());else{let params={ruleId:ruleId,formId:ZPFRulesNew.Configurations.formId,method:"deleteRule"};FrameworkCommon.showDeleteAlert("",ZPI18N.getString("zp.valdelconf"),{callback:()=>{ZPeople.Request.send("/fieldRules.zp",params,ZPFRulesNew.Configurations.deleteRuleResp,{obj:ruleDiv},FrameworkCommon.failureCallback)}})}},updateUsedFieldsList:function(delRuleDiv){let selectedValues=[];(selectedValues=[...selectedValues=[...selectedValues,...ZPeopleComponents.tokenfield(delRuleDiv.find("[elem=showFieldsSelect]")).getAllValues()],...ZPeopleComponents.tokenfield(delRuleDiv.find("[elem=hideFieldsSelect]")).getAllValues()]).length>0&&(ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=showFieldsSelect],[elem=hideFieldsSelect]").attr("isChange",!0),selectedValues.forEach(function(item){if(item&&item.value&&ZPFRulesNew.Configurations.formActionUsedFields[ZPFRulesNew.Configurations.formId].includes(item.value)){let index=ZPFRulesNew.Configurations.formActionUsedFields[ZPFRulesNew.Configurations.formId].indexOf(item.value);ZPFRulesNew.Configurations.formActionUsedFields[ZPFRulesNew.Configurations.formId].splice(index,1)}}))},sortRules:function(){if($.each(ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer] [elem=ruleDiv]"),function(index,ruleDiv){$(ruleDiv).attr("rowno",index+1),$(ruleDiv).find("[elem=ruleTitle]").text(ZPI18N.getString("zp.rule")+" "+(index+1))}),0!=ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer] [elem=ruleDiv]").length&&0==ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer] [elem=ruleDiv][isCollapsed=false]").length){let ruleDiv=ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer] [elem=ruleDiv]:first");ZPeopleComponents.collapsiblepanel($(ruleDiv)).expandPanel(),$(ruleDiv).last()[0].scrollIntoView({behavior:"smooth",block:"end",inline:"end"})}ZPFRulesNew.Configurations.showHideFirstDeleteIcon()},deleteRuleResp:function(data,params,others){if("success"==data.msg.trim()){ZPFRulesNew.Configurations.updateUsedFieldsList(others.obj),ZPFRulesNew.Components.destroy(others.obj),$(others.obj).remove(),ZPFRulesNew.Configurations.sortRules();let formRuleArray=ZPFRulesNew.Configurations.getFieldRuleDetails(params.formId),index=ZPFRulesNew.Configurations.findObjectByKey(formRuleArray,"ruleId",params.ruleId,"index").index;formRuleArray.splice(index,1),formRuleArray.formComponent=[],ZPFRulesNew.Configurations.setFieldRuleDetails(params.formId,formRuleArray),ZPeople.Message.success(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.deletedmsg")])),0==ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleBodyContainer] [elem=ruleDiv]").length&&ZPFRulesNew.Configurations.addNewRule()}else""!=data.msg.trim?FrameworkCommon.showInfoAlert("",data.msg.trim()):ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror"))},validateRule:function(ruleDiv){let hasError=!1;return $(ruleDiv).find('[elem="conditionField"],[elem="conditionValue"]').closest(".zpl_idiv").removeClass("zpl_erorbx"),FrameworkCommon.removeError($(ruleDiv).find('[elem="conditionField"],[elem="conditionValue"]')),FrameworkCommon.hide($(ruleDiv).find("[elem=condShowHideContainer]").find('[elem="showHideFieldsErrMsg"]')),hasError=ZPFRulesNew.Conditions.validateConditions($(ruleDiv)),0==ZPeopleComponents.tokenfield($(ruleDiv).find("[elem=showFieldsSelect]")).getAllValues().length&&0==ZPeopleComponents.tokenfield($(ruleDiv).find("[elem=hideFieldsSelect]")).getAllValues().length&&(FrameworkCommon.show($(ruleDiv).find("[elem=condShowHideContainer]").find('[elem="showHideFieldsErrMsg"]')),hasError=!0),hasError},loadConfigRulePopup:function(){if(FormCustomNew.isSliderOpen(ZPFRulesNew.Configurations.formId)){let callback=function(){ZPFRulesNew.Configurations.Modal.sliderDiv.find("#sliderSbt").addClass("disabled").prop("disabled",!0),0==ZPFRulesNew.Configurations.Modal.sliderDiv.find("#cardConfigRulePopup").children().length&&(ZPFRulesNew.Configurations.Modal.sliderDiv.find("#cardConfigRulePopup").append('<form><div elem="ruleBodyContainer" class="zpl_colpanls">'+ZPeople.LOADING_HTML+"</div></form>"),$(ZPFRulesNew.Configurations.addRuleDiv).insertBefore(ZPFRulesNew.Configurations.Modal.sliderDiv.find("#sliderCls"))),ZPFRulesNew.Configurations.rulePopupContainer=ZPFRulesNew.Configurations.Modal.sliderDiv};ZPFRulesNew.Configurations.Modal=new sliderModal(ZPI18N.getString("zp.configure")+" "+ZPI18N.getString("zp.rule"),new Tab("ConfigRulePopup",callback,ZPFRulesNew.Configurations.saveRules)),ZPFRulesNew.Configurations.Modal.save=ZPI18N.getString("zp.save"),ZPFRulesNew.Configurations.Modal.cancel=ZPI18N.getString("zp.close"),ZPFRulesNew.Configurations.Modal.construct(),FrameworkCommon.madeChanges.init("ConfigRulePopup",ZPFRulesNew.Configurations.Modal),ZPFRulesNew.Configurations.Modal.setCloseCallback(function(){ZPFRulesNew.Components.destroy(ZPFRulesNew.Configurations.Modal.sliderDiv),ZPFRulesNew.Configurations.Modal.remove(),ZPFRulesNew.Configurations.madeChanges=!1,delete ZPFRulesNew.Configurations.Modal,delete ZPFRulesNew.Configurations.rulePopupContainer}),ZPFRulesNew.Configurations.loadSavedRules(),ZPFRulesNew.Configurations.rulePopupDefaultActions()}},loadSavedRules:function(){ZPFRulesNew.Configurations.count=1;let ruleDets=ZPFRulesNew.Configurations.getFieldRuleDetails();if(ruleDets&&ruleDets.length>0)$.each(ruleDets,function(ind,rule){ZPFRulesNew.Configurations.count=parseInt(ind)+1,ZPFRulesNew.Configurations.addRule(rule)});else ZPFRulesNew.Configurations.addRule();ZPFRulesNew.Configurations.rulePopupContainer.find("#zp_page_loading").remove(),ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleDiv]").removeClass("DNI"),ZPeopleComponents.collapsiblepanel(ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleDiv]:first")).expandPanel(),ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleDiv]:first").last()[0].scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),ZPFRulesNew.Configurations.rulePopupContainer.find("#sliderSbt").removeClass("disabled").prop("disabled",!1),FrameworkCommon.madeChanges.set(ZPFRulesNew.Configurations.Modal)},findObjectByKey:function(jsonArray,searchKey,searchValue,returnValue){let resultObject={};return $.each(jsonArray,function(index,json){if(json[searchKey]==searchValue)return void 0==returnValue?resultObject=json:"index"==returnValue&&(resultObject.index=index),!1}),resultObject},containsAllElements:function(array1,array2){let isContains=!0;return array1.length==array2.length?$.each(array1,function(index){if(array2.indexOf(array1[index])<0)return isContains=!1,!1}):isContains=!1,isContains},saveRules:function(){if(!FrameworkCommon.madeChanges.get(ZPFRulesNew.Configurations.Modal))return void ZPeople.Message.warning(ZPI18N.getString("zp.nochangesmade"));ZPFRulesNew.Configurations.rulePopupContainer.find("#sliderSbt").addClass("disabled").prop("disabled",!0);let rulesArray=[],hasError=!1;$.each(ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleDiv]"),function(index,ruleDiv){if(ZPFRulesNew.Configurations.validateRule(ruleDiv))return hasError=!0,ZPeopleComponents.collapsiblepanel($(ruleDiv)).expandPanel(),$(ruleDiv).last()[0].scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),!1;{let isUpdate=!0,ruleObj={},checkRuleObj={},condActArray=[];ruleObj.ruleId=$(ruleDiv).attr("ruleid"),ruleObj.operator=ZPeopleComponents.select($(ruleDiv).find("[elem=ruleOperator]")).getValue(),void 0!=ruleObj.ruleId&&""!=ruleObj.ruleId&&""!=(checkRuleObj=ZPFRulesNew.Configurations.findObjectByKey(ZPFRulesNew.Configurations.getFieldRuleDetails(),"ruleId",ruleObj.ruleId))&&void 0!=checkRuleObj&&checkRuleObj.operator==ruleObj.operator&&(isUpdate=!1),$.each($(ruleDiv).find("[elem=conditionDiv]"),function(ind,condDiv){let checkCondObj={},condObj={},condId=$(condDiv).attr("condid");void 0!=condId&&null!=condId.match(/[\d]+$/)&&(condObj.conditionId=condId.match(/[\d]+$/).toString(),checkCondObj=ZPFRulesNew.Configurations.findObjectByKey(checkRuleObj.conditionArray,"conditionId",condObj.conditionId)),condObj.fcid=ZPeopleComponents.select($(condDiv).find('[elem="conditionField"]')).getValue(),isUpdate||checkCondObj.fcid==condObj.fcid||(isUpdate=!0),condObj.operator=ZPeopleComponents.select($(condDiv).find("[elem=conditionOperator]")).getValue(),condObj.value=ZPFRulesNew.Conditions.getConditionFieldValue($(condDiv).find('[elem="conditionValue"]'),condObj.operator),void 0!=checkCondObj.operator?isUpdate||checkCondObj.operator==condObj.operator&&checkCondObj.value==condObj.value||(isUpdate=!0):isUpdate||(isUpdate=!0),condActArray.push(condObj)}),isUpdate||checkRuleObj.conditionArray.length==condActArray.length||(isUpdate=!0),ruleObj.conditionArray=condActArray;let actionArray=[];for(let actOper in[ZPFRulesNew.OPERATOR.SHOW,ZPFRulesNew.OPERATOR.HIDE]){let condActObj={},checkCondActObj={},showHideArray=[],fieldElemDiv=actOper==ZPFRulesNew.OPERATOR.SHOW?"[elem=showFieldsSelect]":"[elem=hideFieldsSelect]";$.each(ZPeopleComponents.tokenfield($(ruleDiv).find(fieldElemDiv)).getAllValues(),function(indAct,data){showHideArray.push(data.value)}),0!=showHideArray.length&&(condActObj.operator=actOper,void 0!=ruleObj.ruleId&&(void 0==(checkCondActObj=ZPFRulesNew.Configurations.findObjectByKey(checkRuleObj.actionArray,"operator",condActObj.operator)).operator?isUpdate=!0:isUpdate||ZPFRulesNew.Configurations.containsAllElements(checkCondActObj.fieldArray,showHideArray)||(isUpdate=!0)),condActObj.fieldArray=showHideArray,actionArray.push(condActObj))}isUpdate||checkRuleObj.actionArray.length==actionArray.length||(isUpdate=!0),ruleObj.actionArray=actionArray,isUpdate&&rulesArray.push(ruleObj)}}),!hasError&&rulesArray.length>0?ZPeople.Request.send("/fieldRules.zp",{rulesArray:JSON.stringify(rulesArray),formId:ZPFRulesNew.Configurations.formId,method:"addUpdate"},ZPFRulesNew.Configurations.saveRuleResp,{},ZPFRulesNew.Configurations.failureCallback):ZPFRulesNew.Configurations.rulePopupContainer.find("#sliderSbt").removeClass("disabled").prop("disabled",!1)},failureCallback:(data,params,others)=>{FrameworkCommon.failureCallback(data),ZPFRulesNew.Configurations.rulePopupContainer.find("#sliderSbt").removeClass("disabled").prop("disabled",!1)},saveRuleResp:function(data,params,others){if(data.hasOwnProperty("msg")){let msg=data.msg.trim();if("success"==msg){let formRuleArray=ZPFRulesNew.Configurations.getFieldRuleDetails(params.formId),ruleArray=JSON.parse(params.rulesArray),isUpdate=!1;for(let ind in ruleArray){let ruleObj=ruleArray[ind],ruleDiv="",ruleInd=0,respRuleObj="",fieldElms=[],actionElms=[];if(respRuleObj=data.ruleArray[ind],ruleObj.hasOwnProperty("ruleId")){ruleInd=ZPFRulesNew.Configurations.findObjectByKey(formRuleArray,"ruleId",ruleObj.ruleId,"index").index,ruleDiv=ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleDiv][rowno='"+(parseInt(ruleInd)+1)+"']"),isUpdate=!0}else ruleInd=formRuleArray.length,ruleDiv=ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleDiv][rowno='"+(parseInt(ruleInd)+1)+"']"),$(ruleDiv).attr("ruleid",respRuleObj.ruleId);$.each(respRuleObj.conditionArray,function(i1,v1){fieldElms.push(v1.fcid.toString())}),respRuleObj.fieldElms=fieldElms,$.each(respRuleObj.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2])})}),respRuleObj.actionElms=actionElms,formRuleArray[ruleInd]=respRuleObj,ZPFRulesNew.Configurations.setFieldRuleDetails(params.formId,formRuleArray),$.each(data.ruleArray[ind].conditionArray,function(i1,condition){let condDiv=$(ruleDiv).find("[elem=conditionDiv]")[i1];$(condDiv).attr("conditionId",condition.conditionId)})}isUpdate?ZPeople.Message.success(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.updatedmsg")])):ZPeople.Message.success(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.addedmsg")])),FrameworkCommon.madeChanges.set(ZPFRulesNew.Configurations.Modal),ZPFRulesNew.Configurations.getFieldRuleDetails(params.formId).formComponent=[],ZPFRulesNew.Configurations.showHideFirstDeleteIcon()}else"failure"==msg||""==msg?ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")):FrameworkCommon.showInfoAlert("",msg)}else data.hasOwnProperty("failure")&&FrameworkCommon.showInfoAlert("",data.failure);ZPFRulesNew.Configurations.rulePopupContainer.find("#sliderSbt").removeClass("disabled").prop("disabled",!1)},loadConfigRule:function(){ZPFRulesNew.Configurations.formId=FormCustomNew.formId;let formCompData=ZPFRulesNew.Configurations.getFormDetails();if(void 0==formCompData||formCompData.lastprev||void 0==formCompData.refresh)ZPFRulesNew.Configurations.getFormComponents(ZPFRulesNew.Configurations.formId);else{let fc=ZPFRulesNew.Configurations.getFormComponentDetails();1==fc.length&&0==fc[0].column1.length&&0==fc[0].column2.length?FrameworkCommon.showInfoAlert("",ZPI18N.getString("zp.emptyform")):void 0!=ZPFRulesNew.Configurations.getFieldRuleDetails()&&(ZPFRulesNew.Configurations.formActionUsedFields[ZPFRulesNew.Configurations.formId]=[],ZPFRulesNew.Configurations.loadConfigRulePopup())}},getFormComponents:function(formId,isRoleBased,others){let params={formId:formId,mode:"getFormComponents",isFormRule:!0};isRoleBased&&(params.roleId="-1",params.isRoleBased=!0),ZPeople.Request.send("/formAction.zp",params,ZPFRulesNew.Configurations.getFormCompResp,others)},getFormCompResp:function(data,params,others){if(ZPFRulesNew.Configurations.setFormDetails(params.formId,data),data.code!==ZPeople.ResponeCodes.SUCCESS)7040==data.code&&ZPFRulesNew.Configurations.getFormComponents(params.formId,!0);else{if(data.code==zpconst.ResponseCodes.API_ERR_NO_ERROR){let rulesArray=ZPFRulesNew.getFormattedRulesArray(data);ZPFRulesNew.setLeaveTypes(data),rulesArray.formComponent=[],ZPFRulesNew.Configurations.setFieldRuleDetails(params.formId,rulesArray)}else if(data.hasOwnProperty("message"))return void FrameworkCommon.showInfoAlert("",data.message.trim());void 0!=others&&others.hasOwnProperty("isBlueprint")&&others.isBlueprint?ZPUtil.Validation.isFunction(others.callback)&&others.callback():ZPFRulesNew.Configurations.loadConfigRule()}},rulePopupDefaultActions:function(){ZPFRulesNew.Configurations.rulePopupContainer.find('[elem="addRuleButton"]').off().on("click",ZPFRulesNew.Configurations.addNewRule),ZPFRulesNew.Configurations.rulePopupContainer.find('[elem="ruleDeleteIcon"]').off().on("click",ZPFRulesNew.Configurations.deleteRule),ZPFRulesNew.Conditions.conditionDefActions(ZPFRulesNew.Configurations.rulePopupContainer)},showHideFirstDeleteIcon:function(){let divs=ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleDiv]");FrameworkCommon.show(ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleDiv]").find("[elem=ruleDeleteIcon]")),divs.length<=1&&(void 0==divs.first().attr("ruleId")||""==divs.first().attr("ruleId").trim())&&FrameworkCommon.hide(ZPFRulesNew.Configurations.rulePopupContainer.find("[elem=ruleDiv]").first().find("[elem=ruleDeleteIcon]"))}},ZPFRulesNew.Conditions={condSelectDiv:'<select zfctype="select" width="250" class="zselectbox" elem="conditionValue"><select>',condInputDiv:'<input class="ztextbox" elem="conditionValue" style="width:250px" data-width="250">',condConjDiv:'<select zfctype="select" elem="conditionConj" class="zselectbox"><option value="AND">'+ZPI18N.getString("zp.captialand")+'</option><option value="OR">'+ZPI18N.getString("zp.captialor")+"</option></select>",conditionDiv:'<div class="zpl_idiv DNI" $ID$ elem="conditionDiv"><div><select zfctype="select" class="zselectbox" elem="conditionField"><select></div><div><select zfctype="select" width="150" class="zselectbox" elem="conditionOperator"><select></div><div elem="conditionValueCont"></div><div><i class="PI_delete" elem="ruleCondDelIcon"></i></div></div>',bpCondDiv:'<div class="zpl_idiv DNI" $ID$ elem="conditionDiv">\n\t\t\t\t\t\t\t\t\t<div class="zpl_rwfld zpl_rwnum"><span elem="row_num"></span></div>\n\t\t\t\t\t\t\t\t\t<div elem="conditionConjDiv" class="DNI"></div>\n\t\t\t\t\t\t\t\t\t<div><select class="zselectbox" elem="conditionField"><select></div>\n\t\t\t\t\t\t\t\t\t<div><select width="150" class="zselectbox" elem="conditionOperator"><select></div>\n\t\t\t\t\t\t\t\t\t<div elem="conditionValueCont"></div>\n\t\t\t\t\t\t\t\t\t<div><i class="PI_delete" elem="ruleCondDelIcon"></i></div>\n\t\t\t\t\t\t\t\t</div>',addNewCondDiv:'<div class="zpl_idiv" elem="addCondDiv"><a class="zpl_lnkbg" elem="addConditionIcon">'+ZPI18N.getString("zp.addnew")+"</a></div>",isBlueprint:!1,COND_KEYS:{fcId:"fcid",conditionId:"conditionId",operator:"operator",criteriaValue:"value"},BP_COND_KEYS:{fcId:"formComponentID",conjCond:"conjunctiveCondn",operator:"Operator",criteriaValue:"CrtVal",isBaseForm:"isBaseForm",lookupFcId:"lookupFcId"},init:(container,formId,conditionArray,fields,isBluePrint)=>{ZPFRulesNew.Conditions.isBlueprint=!0===isBluePrint,ZPFRulesNew.Conditions.formId=formId,void 0==fields&&(fields=ZPFRulesNew.Configurations.getFormComponentDetails()),container.append(ZPFRulesNew.Conditions.addNewCondDiv);let addNewCondDiv=container.find("[elem=addCondDiv]");$.each(conditionArray,function(index,condition){return ZPFRulesNew.Conditions.addCondition({},addNewCondDiv,condition,fields,container)})},conditionDefActions:function(container){container.find('[elem="ruleCondDelIcon"]').off().on("click",null,{container:container},ZPFRulesNew.Conditions.deleteCondition),container.find('[elem="addConditionIcon"]').off().on("click",null,{container:container},ZPFRulesNew.Conditions.addCondition)},showHideConditionDiv:function(divs){divs.length<=1?FrameworkCommon.hide($(divs).find("[elem=ruleCondDelIcon]")):FrameworkCommon.show($(divs).find("[elem=ruleCondDelIcon]"))},deleteCondition:function(event){let condDiv=$(event.target).closest("[elem=conditionDiv]"),conditionDivs=$(condDiv).siblings("[elem=conditionDiv]");if(conditionDivs.length>0){var remRowNum=$(condDiv).find("[elem=row_num]").text();ZPFRulesNew.Components.destroy($(condDiv)),$(condDiv).remove(),ZPFRulesNew.Conditions.isBlueprint?($(event.data.container).find("[elem=conditionDiv]:visible:first").find("[elem=conditionConjDiv]").html(""),FrameworkCommon.hide($(event.data.container).find("[elem=conditionDiv]:visible:first").find("[elem=conditionConjDiv]")),DuringFieldValidation.Criteria.removeConditionCB(event.data.container,remRowNum)):FrameworkCommon.madeChanges.set(ZPFRulesNew.Configurations.Modal,!0)}ZPFRulesNew.Conditions.showHideConditionDiv(conditionDivs),event.stopPropagation()},getKeyName:function(keyname){return ZPFRulesNew.Conditions.isBlueprint?void 0!=keyname&&ZPFRulesNew.Conditions.BP_COND_KEYS.hasOwnProperty(keyname)?ZPFRulesNew.Conditions.BP_COND_KEYS[keyname]:keyname:void 0!=keyname&&ZPFRulesNew.Conditions.COND_KEYS.hasOwnProperty(keyname)?ZPFRulesNew.Conditions.COND_KEYS[keyname]:keyname},addCondition:function(event,addNewCondDiv,condition,fields,container){if(event.target)if(addNewCondDiv=$(event.target).closest("[elem=addCondDiv]"),condition={},fields=ZPFRulesNew.Configurations.getFormComponentDetails(),condition[ZPFRulesNew.Conditions.getKeyName("fcId")]=ZPFRulesNew.Conditions.isBlueprint?ZPFRulesNew.Conditions.bluePrintFcid:ZPFRulesNew.Configurations.findFirstFcId(fields,ZPFRulesNew.Conditions.formId,ZPFRulesNew.Configurations.getTableName()),container=event.data.container,ZPFRulesNew.Conditions.isBlueprint){if((critCnt=container.find("[elem=conditionDiv]").length)==DuringFieldValidation.CRITERIA_LIMIT)return void ZPeople.Message.warning("Criteria has reached maximum limit.");critCnt==DuringFieldValidation.CRITERIA_LIMIT-1&&(container.find("[elem=addCondDiv]").addClass("DNI"),ZPeople.Message.warning("Criteria has reached maximum limit.")),DuringFieldValidation.Criteria.constructPatternAdd(container.closest("#fldVal_card"),critCnt+1,"and")}else FrameworkCommon.madeChanges.set(ZPFRulesNew.Configurations.Modal,!0);let fieldComponentId=condition[ZPFRulesNew.Conditions.getKeyName("fcId")],operator=condition.hasOwnProperty(ZPFRulesNew.Conditions.getKeyName("operator"))?condition[ZPFRulesNew.Conditions.getKeyName("operator")]:"",crtValue=condition.hasOwnProperty(ZPFRulesNew.Conditions.getKeyName("criteriaValue"))?condition[ZPFRulesNew.Conditions.getKeyName("criteriaValue")]:"",fieldDtl=ZPFRulesNew.Configurations.getFieldComponent(fieldComponentId,ZPFRulesNew.Conditions.formId);fieldDtl=void 0==fieldDtl?{}:fieldDtl;let condDiv=ZPFRulesNew.Conditions.isBlueprint?ZPFRulesNew.Conditions.bpCondDiv:ZPFRulesNew.Conditions.conditionDiv,condIdAttr=condition.hasOwnProperty(ZPFRulesNew.Conditions.getKeyName("conditionId"))?"condid='"+condition[ZPFRulesNew.Conditions.getKeyName("conditionId")]+"'":"";if(condDiv=condDiv.replace(/\$ID\$/g,condIdAttr),$(condDiv).insertBefore(addNewCondDiv),condDiv=$(addNewCondDiv).prev(),ZPFRulesNew.Conditions.isBlueprint){let conjCond=condition.hasOwnProperty(ZPFRulesNew.Conditions.getKeyName("conjCond"))?condition[ZPFRulesNew.Conditions.getKeyName("conjCond")]:"AND";var critCnt=container.find("[elem=conditionDiv]").length;$(condDiv).find("[elem=row_num]").append(critCnt),critCnt>=2&&(FrameworkCommon.show($(condDiv).find("[elem=conditionConjDiv]").html(ZPFRulesNew.Conditions.condConjDiv)),ZPeopleComponents.select($(condDiv).find("[elem=conditionConj]"),{value:conjCond,change:event=>{DuringFieldValidation.Criteria.changeOperatorCB(event)}}))}ZPeopleComponents.select($(condDiv).find("[elem=conditionField]"),ComponentsCommon.select.getProps({showSearchField:!0,change:ZPFRulesNew.Conditions.changeConditionOperators,disabled:ZPFRulesNew.Conditions.isBlueprint,dropdownList:{height:250,width:150},width:150}));let condFieldOptions=ZPFRulesNew.Configurations.getFieldOptions(!0,fields,[fieldComponentId],[],ZPFRulesNew.Conditions.isBlueprint);return 0==condFieldOptions.length?(FrameworkCommon.showInfoAlert("",ZPI18N.getString("zp.emptyform")),ZPFRulesNew.Configurations.Modal.close(),!1):(ZPeopleComponents.select($(condDiv).find("[elem=conditionField]")).addOptGroup(condFieldOptions),ZPeopleComponents.select($(condDiv).find("[elem=conditionField]")).setValue(fieldComponentId),ZPeopleComponents.select($(condDiv).find("[elem=conditionOperator]"),ComponentsCommon.select.getProps({showSearchField:!0,width:150,change:ZPFRulesNew.Conditions.attachCondValDiv,dropdownList:{height:250,width:150}})),ZPFRulesNew.Conditions.changeConditionOperators({},$(condDiv).find("[elem=conditionOperator]"),fieldDtl,operator,crtValue),ZPFRulesNew.Conditions.showHideConditionDiv($(condDiv).parent().find("[elem=conditionDiv]")),FrameworkCommon.show($(condDiv)),ZPFRulesNew.Conditions.conditionDefActions(container),!0)},changeConditionOperators:function(event,condOprDiv,fieldDtl,selOper,selVal){if(event.target){if(!ComponentsCommon.isUIEvent(event))return;ZPFRulesNew.Conditions.isBlueprint||FrameworkCommon.madeChanges.set(ZPFRulesNew.Configurations.Modal,!0),condOprDiv=$(event.target).parents("[elem=conditionDiv]").find("[elem=conditionOperator");let fcid=ZPeopleComponents.select($(event.target).parents("[elem=conditionDiv]").find("[elem=conditionField]")).getValue();fieldDtl=ZPFRulesNew.Configurations.getFieldComponent(fcid,ZPFRulesNew.Conditions.formId),selOper="",selVal=""}let fcType=void 0==fieldDtl?"":fieldDtl.fieldType,options=[];options.push({label:ZPI18N.getString("zp.is"),value:FormConstants.Criteria.OPERATORS.EQUAL}),options.push({label:ZPI18N.getString("zp.isnot"),value:FormConstants.Criteria.OPERATORS.NOT_EQUAL}),options.push({label:ZPI18N.getString("zp.isempty"),value:FormConstants.Criteria.OPERATORS.EMPTY}),options.push({label:ZPI18N.getString("zp.isnotempty"),value:FormConstants.Criteria.OPERATORS.NOT_EMPTY}),fcType==FormConstants.FieldType.CHECK_BOX?((options=[]).push({label:ZPI18N.getString("zp.yes"),value:FormConstants.Criteria.OPERATORS.TRUE}),options.push({label:ZPI18N.getString("zp.no"),value:FormConstants.Criteria.OPERATORS.FALSE})):fcType==FormConstants.FieldType.FILE_UPLOAD?((options=[]).push({label:ZPI18N.getString("zp.isempty"),value:FormConstants.Criteria.OPERATORS.EMPTY}),options.push({label:ZPI18N.getString("zp.isnotempty"),value:FormConstants.Criteria.OPERATORS.NOT_EMPTY})):($.inArray(parseInt(fcType),[FormConstants.FieldType.DATE,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.NUMBER,FormConstants.FieldType.CURRENCY,FormConstants.FieldType.DECIMAL])>-1&&(options.push({label:ZPI18N.getString("zp.greaterthan"),value:FormConstants.Criteria.OPERATORS.GREATER_THAN}),options.push({label:ZPI18N.getString("zp.lesserthan"),value:FormConstants.Criteria.OPERATORS.LESS_THAN}),options.push({label:ZPI18N.getString("zp.greaterorequalto"),value:FormConstants.Criteria.OPERATORS.GREATER_EQUAL}),options.push({label:ZPI18N.getString("zp.lesserorequalto"),value:FormConstants.Criteria.OPERATORS.LESS_EQUAL})),-1==$.inArray(parseInt(fcType),[FormConstants.FieldType.DATE,FormConstants.FieldType.DATE_TIME,FormConstants.FieldType.BLOODGROUP,FormConstants.FieldType.GENDER,FormConstants.FieldType.COUNTRY,FormConstants.FieldType.NEW_BLOODGROUP,FormConstants.FieldType.NEW_GENDER,FormConstants.FieldType.NEW_COUNTRY])&&(options.push({label:ZPI18N.getString("zp.contains"),value:FormConstants.Criteria.OPERATORS.CONTAINS}),options.push({label:ZPI18N.getString("zp.notcontains"),value:FormConstants.Criteria.OPERATORS.NOT_CONTAINS}),options.push({label:ZPI18N.getString("zp.startswith"),value:FormConstants.Criteria.OPERATORS.STARTS_WITH}),options.push({label:ZPI18N.getString("zp.endswith"),value:FormConstants.Criteria.OPERATORS.ENDS_WITH}))),ZPeopleComponents.select($(condOprDiv)).removeAllOptions(),""==selOper||fcType!=FormConstants.FieldType.COUNTRY&&fcType!=FormConstants.FieldType.GENDER&&fcType!=FormConstants.FieldType.BLOODGROUP||(options=ZPFRulesNew.Conditions.addSelectedCriteriaOperator(options,selOper)),ZPeopleComponents.select($(condOprDiv)).addOption(options),selOper=""==selOper?options[0].value:selOper,ZPeopleComponents.select($(condOprDiv)).setValue(selOper),ZPFRulesNew.Conditions.attachCondValDiv({},$(condOprDiv).parents("[elem=conditionDiv]").find("[elem=conditionValueCont]"),fieldDtl,selOper,selVal)},addSelectedCriteriaOperator:(options,criOper)=>{let isAddOption=!0;return $.each(options,function(ind,val){if(val.value==criOper)return isAddOption=!1,!1}),isAddOption&&options.push({label:FormConstants.Criteria.OPERATORSNAME[criOper],value:criOper}),options},attachCondValDiv:function(event,container,fieldDtl,operator,value){if(event.target){if(!ComponentsCommon.isUIEvent(event))return;ZPFRulesNew.Conditions.isBlueprint||FrameworkCommon.madeChanges.set(ZPFRulesNew.Configurations.Modal,!0),container=$(event.target).parents("[elem=conditionDiv]").find("[elem=conditionValueCont]");let fcid=ZPeopleComponents.select($(event.target).parents("[elem=conditionDiv]").find("[elem=conditionField]")).getValue();fieldDtl=ZPFRulesNew.Configurations.getFieldComponent(fcid,ZPFRulesNew.Conditions.formId),operator=ZPeopleComponents.select($(event.target)).getValue(),value=""}ZPFRulesNew.Components.destroy(container);let condValDiv="",fcType=void 0==fieldDtl?"":parseInt(fieldDtl.fieldType);if($(container).html(ZPFRulesNew.Conditions.condInputDiv),(condValDiv=$(container).find("[elem=conditionValue]")).attr("fctype",fcType),condValDiv.attr("zfctype",""),$.inArray(parseInt(operator),[FormConstants.Criteria.OPERATORS.EMPTY,FormConstants.Criteria.OPERATORS.NOT_EMPTY])>-1)$(condValDiv).addClass("is-disabled").prop({disabled:!0});else if($.inArray(fcType,[FormConstants.FieldType.LOOKUP,FormConstants.FieldType.PICKLIST,FormConstants.FieldType.NEW_COUNTRY,FormConstants.FieldType.NEW_BLOODGROUP,FormConstants.FieldType.NEW_GENDER])>-1)operator=void 0==operator?FormConstants.Criteria.OPERATORS.EQUAL:operator,$.inArray(parseInt(operator),[FormConstants.Criteria.OPERATORS.EQUAL,FormConstants.Criteria.OPERATORS.NOT_EQUAL,FormConstants.Criteria.OPERATORS.IN,FormConstants.Criteria.OPERATORS.NOT_IN])>-1?($(container).html(ZPFRulesNew.Conditions.condSelectDiv),condValDiv=$(container).find("[elem=conditionValue]"),ZPFRulesNew.Conditions.isBlueprint&&(value=value.replace(/\[|\]|"/g,"")),ZPFRulesNew.Conditions.initCondValSelect(condValDiv,fieldDtl,value)):($(condValDiv).val(ZPeople.decodeTxt(ZPeople.escapeHtml(value))),ZPFRulesNew.Conditions.isBlueprint||$(condValDiv).off().on("change",event=>{FrameworkCommon.madeChanges.setOnEvent(event,ZPFRulesNew.Configurations.Modal)}));else if(fcType==FormConstants.FieldType.CHECK_BOX)$(condValDiv).addClass("is-disabled").prop({disabled:!0});else if(fcType==FormConstants.FieldType.DATE||fcType==FormConstants.FieldType.DATE_TIME){let props=ComponentsCommon.getDateProps();if(ZPFRulesNew.Conditions.isBlueprint||(props.change=(event=>{FrameworkCommon.madeChanges.setOnEvent(event,ZPFRulesNew.Configurations.Modal)})),fcType==FormConstants.FieldType.DATE)props.value=value,ZPeopleComponents.datefield(condValDiv,props),condValDiv.attr("zfctype","datefield");else{if(props.format=components._timeformat(),!ZPUtil.Validation.isEmpty(value))if(Calendar.is12HrFormat())value=Calendar.convertTo12Hours(value);else{let date=value.split(" ")[0],time=value.split(" ")[1];value=date+" "+(time=time.split(":")[0]+":"+time.split(":")[1])}props.value=value,ZPeopleComponents.datetimefield(condValDiv,props),condValDiv.attr("zfctype","datetimefield")}}else ZPFRulesNew.Conditions.isBlueprint||$(condValDiv).off().on("change",event=>{FrameworkCommon.madeChanges.setOnEvent(event,ZPFRulesNew.Configurations.Modal)}),$(condValDiv).val(ZPeople.decodeTxt(ZPeople.escapeHtml(value)))},initCondValSelect:function(condValDiv,field,value){let options=[],selectProps={showSearchField:!0,placeholder:ZPI18N.getString("zp.select"),contentType:"text",width:250,multiple:!0,dropdownList:{contentType:"text",height:250,width:150}};if(ZPFRulesNew.Conditions.isBlueprint||(selectProps.change=(event=>{FrameworkCommon.madeChanges.setOnEvent(event,ZPFRulesNew.Configurations.Modal)})),field.fieldType===FormConstants.FieldType.LOOKUP)options=ZPFRulesNew.Conditions.getLookupOptionData("",field.formComponentId,!0,{value:value}),selectProps.serverSearch=!0,selectProps.cacheData=!0,selectProps.dataSource={search:function(params){return new Promise(function(search,reject){search({delay:20,results:ZPFRulesNew.Conditions.getLookupOptionData(params.query,field.formComponentId,!0),more:!1})})},paginated:!0};else if(field.fieldType===FormConstants.FieldType.NEW_GENDER||field.fieldType===FormConstants.FieldType.NEW_BLOODGROUP)field.hasOwnProperty("OptionsWithId")?$.each(field.OptionsWithId,function(ind,option){options.push({value:option.Id,label:option.Value})}):$.each(field.Options,function(ind,option){options.push({value:field.oIds[ind],label:option})});else{let tempOptions=field.isPrimaryLookup?field.hasOwnProperty("AddOptions")?field.AddOptions:field.EditOptions:field.hasOwnProperty("OptionsWithId")?field.OptionsWithId:field.Options;$.each(tempOptions,function(ind,option){let labelKeyName=void 0!=option.name?"name":void 0!=option.DISPVALUE?"DISPVALUE":"Value",idKeyName=void 0!=option.code?"code":"Id";options.push({value:option[idKeyName]+"",label:decodeHTML(option[labelKeyName])})})}0==Object.keys(options).length&&"P_EmployeeLeave"==ZPFRulesNew.Configurations.getTableName(ZPFRulesNew.Conditions.formId)&&"Leavetype"==field.labelName&&(options=ZPFRulesNew.leaveTypes),ZPeopleComponents.select(condValDiv,selectProps);let selOptions=$.grep(options,ele=>$.inArray(ele.value,value.split(","))>-1);options.length>0&&(ZPeopleComponents.select(condValDiv).addOption(options),ZPeopleComponents.select(condValDiv).setValues(selOptions))},OPTIONS_LIST:{},getLookupOptionData:function(query,fcId,isFromRule,extraParam){let options=[],queryStr=(query=void 0==query?"":query.toLowerCase()).length?query.toLowerCase():fcId+"_all";void 0==ZPFRulesNew.Conditions.OPTIONS_LIST[fcId]&&(ZPFRulesNew.Conditions.OPTIONS_LIST[fcId]={});let optionList=ZPFRulesNew.Conditions.OPTIONS_LIST[fcId];function fetchOptions(key,defValues){let paramData={key:query,mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:fcId,fcType:FormConstants.FieldType.LOOKUP,isFromRule:isFromRule};defValues&&(paramData.defValues=JSON.stringify(defValues)),$.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:paramData,success:function(data){optionList[key]={options:function(dataOptions){let tempOptions=[];return $.each(dataOptions,function(i,optVal){let valKeyName=void 0!=optVal.DISPVALUE?"DISPVALUE":"Value";tempOptions.push({value:optVal.Id,label:ZPeople.decodeTxt(optVal[valKeyName])})}),tempOptions}(data.lookupDetailsList),noData:data.lookupDetailsList.length<=0}}})}function mergeOptions(queryOptionList){if(queryOptionList&&queryOptionList.options){let existingValues=new Set(options.map(opt=>opt.value));options=[...options,...queryOptionList.options.filter(newOpt=>!existingValues.has(newOpt.value))]}}if(query.length>0&&"*"!=query)return void 0==optionList[queryStr]&&fetchOptions(queryStr),optionList[queryStr]&&optionList[queryStr].options&&(options=optionList[queryStr].options.filter(option=>option.label.toLowerCase().indexOf(query.toLowerCase())>-1)),options;if(!ZPUtil.Validation.isEmpty(extraParam)&&!ZPUtil.Validation.isEmpty(extraParam.value)){let selectedQueryStr=fcId+"_sel",currentSelectedValues=extraParam.value.split(",");if(optionList[selectedQueryStr]){let previousValues=optionList.selectedValues||[],newValues=currentSelectedValues.filter(value=>!previousValues.includes(value));if(newValues.length>0){let existingOptions=optionList[selectedQueryStr].options||[];fetchOptions(selectedQueryStr,newValues),$.merge(optionList[selectedQueryStr].options,existingOptions),optionList[selectedQueryStr].noData=optionList[selectedQueryStr].options.length<=0}currentSelectedValues=$.merge(previousValues,newValues)}else fetchOptions(selectedQueryStr,currentSelectedValues);optionList.selectedValues=currentSelectedValues,mergeOptions(optionList[selectedQueryStr])}if(0==query.trim().length){let allQueryStr=fcId+"_all";void 0==optionList[allQueryStr]&&fetchOptions(allQueryStr),mergeOptions(optionList[allQueryStr])}return options},getConditionFieldValue:function(condValDiv,operator){let value="";if($(condValDiv).is("input")){let fcType=parseInt($(condValDiv).attr("fctype"));if(fcType==FormConstants.FieldType.DATE||fcType==FormConstants.FieldType.DATE_TIME){let compType=fcType==FormConstants.FieldType.DATE?"datefield":"datetimefield";operator==FormConstants.Criteria.OPERATORS.EMPTY||operator==FormConstants.Criteria.OPERATORS.NOT_EMPTY?value="":ZPeopleComponents.isComponent(condValDiv)&&(value=ZPeopleComponents[compType](condValDiv).getValue().dateString,ZPUtil.Validation.isEmpty(value)?value="":fcType==FormConstants.FieldType.DATE_TIME&&(Calendar.is12HrFormat()?value=Calendar.convertHourFormat(value):value+=":00"))}else value=$(condValDiv).val()}else $(condValDiv).is("select")&&(value=ZPeopleComponents.select(condValDiv).getValues().toString());return value.trim()},validateValueFormat:function(condValDiv){let ret={},fcType=parseInt($(condValDiv).attr("fctype"));return fcType!=FormConstants.FieldType.NUMBER&&fcType!=FormConstants.FieldType.CURRENCY||(value=$(condValDiv).val(),isNaN(value)&&(ret.hasError=!0,ret.errMsg=ZPI18N.getString("zp.enteravalidnumber"))),ret},validateConditions:function(container){let hasError=!1;return $.each(container.find("[elem=conditionDiv]"),function(ind,condition){let condField=$(condition).find('[elem="conditionField"]'),condOper=ZPeopleComponents.select($(condition).find('[elem="conditionOperator"]')).getValue(),condValue=$(condition).find('[elem="conditionValue"]');if(""==ZPeopleComponents.select(condField).getValue()&&($(condField).closest(".zpl_idiv").addClass("zpl_erorbx"),FrameworkCommon.showError("Please select a field for condition",condField),hasError=!0),$.inArray(parseInt(condOper),[FormConstants.Criteria.OPERATORS.TRUE,FormConstants.Criteria.OPERATORS.FALSE,FormConstants.Criteria.OPERATORS.EMPTY,FormConstants.Criteria.OPERATORS.NOT_EMPTY])<0){let val=ZPFRulesNew.Conditions.getConditionFieldValue(condValue,condOper);0==val.length&&($(condValue).closest(".zpl_idiv").addClass("zpl_erorbx"),FrameworkCommon.showError(ZPI18N.getString("zp.entervalueforcondn"),condValue),hasError=!0);let err=ZPFRulesNew.Conditions.validateValueFormat(condValue);val.length>0&&err.hasOwnProperty("hasError")&&($(condValue).closest(".zpl_idiv").addClass("zpl_erorbx"),FrameworkCommon.showError(err.errMsg,condValue),hasError=!0)}}),hasError},getCriteriaJson:function(container){let condArr=[];return $.each(container.find("[elem=conditionDiv]"),function(ind,condDiv){let condObj={},fcId=ZPeopleComponents.select($(condDiv).find('[elem="conditionField"]')).getValue(),oper=parseInt(ZPeopleComponents.select($(condDiv).find("[elem=conditionOperator]")).getValue()),crtVals=ZPFRulesNew.Conditions.getConditionFieldValue($(condDiv).find('[elem="conditionValue"]'),oper),fcDetails=ZPFRulesNew.Configurations.getFieldComponent(fcId,ZPFRulesNew.Conditions.formId);if(ZPFRulesNew.Conditions.isBlueprint&&(oper!=FormConstants.Criteria.OPERATORS.EQUAL&&oper!=FormConstants.Criteria.OPERATORS.NOT_EQUAL||fcDetails.fieldType!=FormConstants.FieldType.LOOKUP&&fcDetails.fieldType!=FormConstants.FieldType.PICKLIST||(oper=DuringFieldValidation.Criteria.getSelectOperator(oper),crtVals=JSON.stringify(crtVals.split(","))),fcDetails.fieldType==FormConstants.FieldType.LOOKUP&&(condObj[ZPFRulesNew.Conditions.getKeyName("lookupFcId")]=fcDetails.referredfcId,condObj[ZPFRulesNew.Conditions.getKeyName("isBaseForm")]=!0),$(condDiv).find('[elem="conditionConj"]').length>0)){let operVal=ZPeopleComponents.select($(condDiv).find('[elem="conditionConj"]')).getValue();condObj[ZPFRulesNew.Conditions.getKeyName("conjCond")]="AND"==operVal?"and":"or"}condObj[ZPFRulesNew.Conditions.getKeyName("fcId")]=fcId,condObj[ZPFRulesNew.Conditions.getKeyName("operator")]=oper,condObj[ZPFRulesNew.Conditions.getKeyName("criteriaValue")]=crtVals,condArr.push(condObj)}),condArr}},ZPFRulesNew.Evaluation={rulesArray:[],setEmptyFcs:[],isViewMode:!1,hidenFieldSBasedonsection:{},readOnlyFields:void 0,evaluateRulesForAllFields:function(isQuickAdd){if(0!=ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].length){$.each(ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId],function(i,rule){rule.isExecuted=!1});var formFields=ZP5Form.getCurrFormsOperation().getFormComponentData().message.formComponentDetails;$.each(formFields,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){void 0!=field&&ZPFRulesNew.Evaluation.evaluateRules(field,isQuickAdd)})})}),$.each(ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId],function(i,rule){!rule.isExecuted&&rule.hasNotes&&ZPFRulesNew.Evaluation.evaluateSingleRule(rule,isQuickAdd)})}},evaluateRules:function(field,isQuickAdd){var fcId=field.formComponentId,type=field.fieldType,obj=ZPFRulesNew.Evaluation.LAYOUT.find("#zp_field_outer_"+fcId);void 0==ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[fcId]&&(ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[fcId]=[]),0!=ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].length&&($.each(ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId],function(i,rule){1==isQuickAdd?-1!=$.inArray(fcId,rule.actionElms)&&(rule.isExecuted||ZPFRulesNew.Evaluation.evaluateSingleRule(rule,isQuickAdd),$.each(rule.conditionArray,function(j,condition){var condObj=ZPFRulesNew.Evaluation.LAYOUT.find("[id=zp_field_outer_"+condition.fcid+"]");condObj.length>0&&($(condObj).attr("isconditionfield",!0),void 0==ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[condition.fcid]&&(ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[condition.fcid]=[]),ZPFRulesNew.Evaluation.checkRuleAlreadyAdded(ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[condition.fcid],rule)||ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[condition.fcid].push(rule))})):-1!=$.inArray(fcId,rule.fieldElms)?(rule.isExecuted||ZPFRulesNew.Evaluation.evaluateSingleRule(rule,isQuickAdd),ZPFRulesNew.Evaluation.checkRuleAlreadyAdded(ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[fcId],rule)||ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[fcId].push(rule),$(obj).length>0&&$(obj).attr("isconditionfield",!0)):-1!=$.inArray(fcId,rule.actionElms)&&(type==FormConstants.FieldType.PLAIN_TEXT?void 0==rule.hasNotes&&(rule.hasNotes=!0):rule.hasNotes=!1)}),$(obj).length>0&&($(obj).off("change",ZPFRulesNew.Evaluation.makeExecutefalse),$(obj).off("change",ZPFRulesNew.Evaluation.evaluateRulesForField),$(obj).on("change",function(event){ZPFRulesNew.Evaluation.setEmptyFcs.length>0&&(ZPFRulesNew.Evaluation.setEmptyFcs=[]),ZPFRulesNew.Evaluation.makeExecutefalse(),ZPFRulesNew.Evaluation.evaluateRulesForField(this)})))},checkRuleAlreadyAdded:function(rulesArr,rule){for(elem of rulesArr)if(elem.ruleId==rule.ruleId)return!0;return!1},evaluateRuleForField:function(rule,record,actionFcId){rule.operator;var conditionArray=rule.conditionArray,actionArray=rule.actionArray,str=0,noOfConditions=0;$.each(conditionArray,function(i){var condition=conditionArray[i],fcid=condition.fcid;condition.value;$.each(record,function(index1,section){$.each(["column1","column2"],function(index2,col){void 0!=section[col]&&$.each(section[col],function(index3,field){if(void 0!=field&&fcid==field.formComponentId){var fieldValue=field.componentValue,result=ZPFRulesNew.Evaluation.evaluateCondition(condition,fcid,field,!1,fieldValue);str+=result,noOfConditions++}})})})});var result=!1;str>0&&(result=rule.operator==ZPFRulesNew.OPERATOR.ALL?str==noOfConditions:str>0);var isAllowed=!1;return $.each(actionArray,function(index,action){var actionoper=action.operator,actionFieldArray=action.fieldArray;$.inArray(actionFcId,actionFieldArray)>-1&&(0==actionoper?result&&(isAllowed=!0):result||(isAllowed=!0))}),isAllowed},evaluateRulesForField:function(obj,isFcid){var fcid=obj;if(isFcid||(void 0==obj?obj=ZPFRulesNew.Evaluation.LAYOUT.find("[id^=zp_field_outer_]:active"):obj instanceof Date?obj=$(Calendar.currentObj).parents("[id*=zp_field_outer_]"):$(obj).is(":radio")&&(obj=$(obj).parents("[displaytype]")),fcid=$(obj).attr("id").split("_").pop(),ZPFRulesNew.Evaluation.makeExecutefalse([fcid])),isFcid||$(obj).find("#zp_formedit_cancel").on("click",function(event){ZPFRulesNew.Evaluation.evaluateRulesForField(fcid,!0)}),void 0!=ZP5Form.getFormClassObj().getParams().formId&&void 0!=ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId]){var isRulePresent=!1;if(ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent.hasOwnProperty(fcid)?isRulePresent=!0:void 0!=(fcid=$(isFcid).attr("id"))&&(fcid=fcid.substring(9),ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent.hasOwnProperty(fcid)&&(isRulePresent=!0)),isRulePresent){var rulesArray=ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[fcid];rulesArray.length>0&&$.each(rulesArray,function(i,rule){ZPFRulesNew.Evaluation.evaluateSingleRule(rule)})}}},evaluateSingleRule:function(rule,isQuickAdd){var str=0,noOfConditions=0;$.each(rule.conditionArray,function(j,condition){var result="",field=ZP5Form.Field.getFieldComponent(condition.fcid,ZP5Form.getFormClassObj().getParams().formId);if(void 0!=field){var type=field.fieldType;result=type==FormConstants.FieldType.DATE?ZPFRulesNew.Evaluation.evaluateDateConditions(condition,condition.fcid,field,isQuickAdd):type==FormConstants.FieldType.DATE_TIME?ZPFRulesNew.Evaluation.evaluateDateConditions(condition,condition.fcid,field,isQuickAdd):ZPFRulesNew.Evaluation.evaluateCondition(condition,condition.fcid,field,isQuickAdd),condition.result=result,str+=result,noOfConditions++}});var result=!1;str>0&&(result=rule.operator==ZPFRulesNew.OPERATOR.ALL?str==noOfConditions:str>0),rule.result=result;var executeRulesFor=[];for(i=0;i<rule.actionArray.length;i++){var actionObj=rule.actionArray[i].fieldArray;if(actionObj.length>0)for(j=0;j<actionObj.length;j++){void 0!=ZP5Form.Field.getFieldComponent(actionObj[j],ZP5Form.getFormClassObj().getParams().formId)&&(ZPFRulesNew.Evaluation.evaluateAction(rule.actionArray[i].operator,actionObj[j],rule.result),executeRulesFor.push(actionObj[j]))}if(i+1==rule.actionArray.length){var fcsArray=executeRulesFor.slice();for(ZPFRulesNew.Evaluation.makeExecutefalse(fcsArray);executeRulesFor.length>0;)ZPFRulesNew.Evaluation.evaluateRulesForField(executeRulesFor.pop(),!0);rule.isExecuted=!0}}},evaluateCondition:function(condition,fcid,field,isQuickAdd,fieldValue){var fcType=field.fieldType;void 0!=fieldValue&&(fcType=field.componentType);var operator=parseInt(condition.operator),inputObject=ZPFRulesNew.Evaluation.LAYOUT;void 0!=inputObject&&(inputObject=ZPFRulesNew.Evaluation.LAYOUT.find("#zp_field_outer_"+fcid));var value="";if(1!=isQuickAdd||void 0!=inputObject&&0!=inputObject.length)if(value=void 0!=fieldValue?fieldValue:ZPFRulesNew.Evaluation.getInputValue(inputObject,fcType,fcid),fcType!=FormConstants.FieldType.DECIMAL&&fcType!=FormConstants.FieldType.CURRENCY||ZPFRulesNew.Evaluation.checkEmptyValue(value,fcType)){var dispType=field.hasOwnProperty("displayType")?field.displayType:0;"Select"!=value&&"-Select-"!=value||!($.inArray(fcType,[FormConstants.FieldType.PICKLIST,FormConstants.FieldType.LOOKUP])>-1&&$.inArray(parseInt(dispType),[FormConstants.FieldType.SELECT_DISPLYTYPE,FormConstants.FieldType.MULTISELECT_DISPLYTYPE])>-1||$.inArray(fcType,[FormConstants.FieldType.COUNTRY,FormConstants.FieldType.BLOODGROUP,FormConstants.FieldType.GENDER])>-1)||(value="")}else{for(value=Number(value).toString();value.length>1&&0==value.indexOf("0");)value=value.substring(1);var decPointIndex=value.indexOf(".");if(decPointIndex>=0){for(var decStr=value.substring(decPointIndex+1,value.length);decStr.length>0&&"0"==decStr.substring(decStr.length-1,decStr.length);)decStr=decStr.substring(0,decStr.length-1);value=""==decStr.trim()?value.substring(0,decPointIndex):value.replace(value.substring(decPointIndex+1,value.length),decStr)}}else value=fcType==FormConstants.FieldType.CHECK_BOX?"false":"";var conditionResult=!1,conditionValue=condition.value;if(fcType!=FormConstants.FieldType.DECIMAL&&fcType!=FormConstants.FieldType.CURRENCY||ZPFRulesNew.Evaluation.checkEmptyValue(conditionValue,fcType)||(conditionValue=Number(conditionValue).toString()),null!=value&&"null"!=value&&""!=value&&(fcType==FormConstants.FieldType.LOOKUP||fcType==FormConstants.FieldType.PICKLIST)){let formClassObj=ZP5Form.getFormClassObj();if($.inArray(operator,[FormConstants.Criteria.OPERATORS.EQUAL,FormConstants.Criteria.OPERATORS.NOT_EQUAL])>-1&&((void 0!=inputObject&&0!=inputObject.length?formClassObj.isViewMode()||ZPFRulesNew.Evaluation.checkValueConvertion(field.labelName)||!ZPFRulesNew.Evaluation.checkEditFieldOrNot(fcid,field):fcType==FormConstants.FieldType.LOOKUP)||fcType==FormConstants.FieldType.PICKLIST))if(fcType==FormConstants.FieldType.LOOKUP)if(void 0!=fieldValue&&void 0!=field&&void 0!=field.componentValue_ID)value=field.componentValue_ID;else{var fieldData=ZP5Form.Field.getFieldValueData(fcid);value=void 0!=fieldData?fieldData.componentValue_ID:ZPFRulesNew.Evaluation.findOptions(value,fcid,ZP5Form.getFormClassObj().getParams().formId,!0)}else value=ZPFRulesNew.Evaluation.findOptions(value,fcid,ZP5Form.getFormClassObj().getParams().formId,!0);else $.inArray(operator,[FormConstants.Criteria.OPERATORS.EQUAL,FormConstants.Criteria.OPERATORS.NOT_EQUAL])<0&&void 0!=inputObject&&0!=inputObject.length&&!formClassObj.isViewMode()&&!ZPFRulesNew.Evaluation.checkValueConvertion(field.labelName)&&ZPFRulesNew.Evaluation.checkEditFieldOrNot(fcid,field)&&fcType==FormConstants.FieldType.LOOKUP&&(value=ZPFRulesNew.Evaluation.findOptions(value,fcid,ZP5Form.getFormClassObj().getParams().formId).trim())}switch(operator){case FormConstants.Criteria.OPERATORS.EQUAL:conditionResult=ZPFRulesNew.Evaluation.checkEqual(value,conditionValue,fcType);break;case FormConstants.Criteria.OPERATORS.NOT_EQUAL:conditionResult=!ZPFRulesNew.Evaluation.checkEqual(value,conditionValue,fcType);break;case FormConstants.Criteria.OPERATORS.EMPTY:conditionResult=ZPFRulesNew.Evaluation.checkEmptyValue(value,fcType,$(inputObject).attr("displaytype"));break;case FormConstants.Criteria.OPERATORS.NOT_EMPTY:conditionResult=!ZPFRulesNew.Evaluation.checkEmptyValue(value,fcType,$(inputObject).attr("displaytype"));break;default:if(operator==FormConstants.Criteria.OPERATORS.NOT_CONTAINS)conditionResult=!ZPFRulesNew.Evaluation.checkIfContains(value,conditionValue,fcType);else if(null!=value&&"null"!=value)switch(operator){case FormConstants.Criteria.OPERATORS.CONTAINS:conditionResult=ZPFRulesNew.Evaluation.checkIfContains(value,conditionValue,fcType);break;case FormConstants.Criteria.OPERATORS.STARTS_WITH:conditionResult=0==value.indexOf(conditionValue);break;case FormConstants.Criteria.OPERATORS.ENDS_WITH:var startWith=value.length-conditionValue.length;conditionResult=conditionValue==value.substring(startWith,value.length);break;case FormConstants.Criteria.OPERATORS.LESS_THAN:conditionResult=!!IsNumeric(value)&&ZPFRulesNew.Evaluation.checkLessThan(value,conditionValue);break;case FormConstants.Criteria.OPERATORS.GREATER_THAN:conditionResult=!!IsNumeric(value)&&ZPFRulesNew.Evaluation.checkGreaterThan(value,conditionValue);break;case FormConstants.Criteria.OPERATORS.LESS_EQUAL:conditionResult=!!IsNumeric(value)&&(ZPFRulesNew.Evaluation.checkLessThan(value,conditionValue)||ZPFRulesNew.Evaluation.checkEqual(value,conditionValue));break;case FormConstants.Criteria.OPERATORS.GREATER_EQUAL:conditionResult=!!IsNumeric(value)&&(ZPFRulesNew.Evaluation.checkGreaterThan(value,conditionValue)||ZPFRulesNew.Evaluation.checkEqual(value,conditionValue));break;case FormConstants.Criteria.OPERATORS.TRUE:conditionResult=1==value||"true"==value.trim()||value.trim()==ZPI18N.getString("zp.yes");break;case FormConstants.Criteria.OPERATORS.FALSE:conditionResult=0==value||"false"==value.toString().trim()||value.trim()==ZPI18N.getString("zp.no")}}return conditionResult},evaluateDateConditions:function(condition,fcid,field,isQuickAdd){var fcType=field.fieldType,conditionDate=condition.value,inputObject=ZPFRulesNew.Evaluation.LAYOUT.find("#zp_field_outer_"+fcid),value="";1==isQuickAdd&&void 0==inputObject||(value=ZPFRulesNew.Evaluation.getInputValue(inputObject,fcType,fcid)),fcType==FormConstants.FieldType.DATE?(conditionDate=Calendar.parseDate(conditionDate,uidateFormat),ZPeopleComponents.isComponent($(inputObject).find("input[name]"))&&ZPFRulesNew.Evaluation.getQuickAddandInputObjectCondition(isQuickAdd,inputObject)&&(value=ZPeopleComponents.datefield($(inputObject).find("input[name]")).getValue().dateString),ZPFRulesNew.Evaluation.checkEmptyValue(value)||(value=Calendar.parseDate(value,uidateFormat))):(conditionDate=Calendar.parseDate(conditionDate,uidateFormat,!0,!0),ZPeopleComponents.isComponent($(inputObject).find("input[name]"))&&ZPFRulesNew.Evaluation.getQuickAddandInputObjectCondition(isQuickAdd,inputObject)&&(value=ZPeopleComponents.datetimefield($(inputObject).find("input[name]")).getValue().dateString),ZPFRulesNew.Evaluation.checkEmptyValue(value)||(value=Calendar.parseDate(Calendar.convertHourFormat(value),uidateFormat,!0,!0)));var conditionResult=!1;switch(condition.operator){case FormConstants.Criteria.OPERATORS.EQUAL:ZPFRulesNew.Evaluation.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate));break;case FormConstants.Criteria.OPERATORS.NOT_EQUAL:ZPFRulesNew.Evaluation.checkEmptyValue(value)||(conditionResult=!Calendar.equalsTo(value,conditionDate));break;case FormConstants.Criteria.OPERATORS.EMPTY:conditionResult=ZPFRulesNew.Evaluation.checkEmptyValue(value);break;case FormConstants.Criteria.OPERATORS.NOT_EMPTY:conditionResult=!ZPFRulesNew.Evaluation.checkEmptyValue(value);break;case FormConstants.Criteria.OPERATORS.LESS_THAN:ZPFRulesNew.Evaluation.checkEmptyValue(value)||(conditionResult=ZPFRulesNew.Evaluation.checkDateLessThan(value,conditionDate));break;case FormConstants.Criteria.OPERATORS.GREATER_THAN:ZPFRulesNew.Evaluation.checkEmptyValue(value)||(conditionResult=ZPFRulesNew.Evaluation.checkDateGreaterThan(value,conditionDate));break;case FormConstants.Criteria.OPERATORS.LESS_EQUAL:ZPFRulesNew.Evaluation.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate)||ZPFRulesNew.Evaluation.checkDateLessThan(value,conditionDate));break;case FormConstants.Criteria.OPERATORS.GREATER_EQUAL:ZPFRulesNew.Evaluation.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate)||ZPFRulesNew.Evaluation.checkDateGreaterThan(value,conditionDate))}return conditionResult},getQuickAddandInputObjectCondition:(isQuickAdd,inputObject)=>!isQuickAdd&&inputObject&&!$(inputObject).hasClass("DNI")&&!$(inputObject).parent("div").hasClass("DNI"),checkValueConvertion:labelName=>{let redOnlyfileds=ZPFRulesNew.Evaluation.readOnlyFields;return void 0!=redOnlyfileds&&redOnlyfileds.indexOf(labelName)>-1},checkEditFieldOrNot(fcid,field){let isEditable,isBlueprintField,fieldData=ZP5Form.Field.getFieldValueData(fcid),formClassObj=ZP5Form.getFormClassObj();return void 0!=fieldData&&(isEditable=fieldData.isEditable,isBlueprintField=fieldData.blueprintField),formClassObj.isAddMode()||ZP5Form.Field.isFieldEditAllowed(field.fieldType,formClassObj.isEditMode(),ZP5Form.getFormClassObj().isSingleFieldEdit(),isEditable,field,formClassObj.isDraftrec,formClassObj.isResubmit(),isBlueprintField,formClassObj)},getInputValue:function(inputObject,fcType,fcid){if($(inputObject).hasClass("DNI")||$(inputObject).parent("div").hasClass("DNI"))return"";var inputDiv=$(inputObject).find("[id*=zp_field_]:visible");if($(inputObject).parents("#zp_form_body").siblings("div").length>0&&(0==$(inputObject).find("#zp_fieldedit_comp").length||$(inputObject).find("#zp_fieldedit_comp").not(".DNI").length>0)&&(inputDiv=$(inputObject).find("[id*=zp_field_]")),0!=inputDiv.length||ZP5Form.getFormClassObj().isViewMode()||(inputDiv=ZP5Form.getFormClassObj().moduleHandler.newRuleCheckModuleSideManualHiden(inputObject,ZP5Form.Field.getFieldComponent(fcid))),$(inputDiv).length>0){if($(inputObject).find("select").length>0)return $(inputObject).find("select option:selected").val();if($(inputObject).find("input").length>0)return fcType==FormConstants.FieldType.CHECK_BOX?$(inputObject).find("input").is(":checked")+"":$(inputObject).find("input").length>1?$(inputObject).find("input[name]").val():$(inputObject).find("input").val();if($(inputObject).find("textarea").length>0)return $(inputObject).find("textarea").val()}else{if(void 0==$(inputObject).attr("displaytype")||$(inputObject).attr("displaytype")!=FormConstants.FieldType.RADIO_DISPLYTYPE){if(ZP5Form.getFormClassObj().ISBLUEPRINT&&fcid)return ZP5Form.getSingleRecordFieldValue(fcid);val="";if("-"==(val=$(inputObject).find("span:visible").length>0||1===ZP5Form.getCurrFormsOperation().getPaginationType()&&$(inputObject).find("span").length>0?$(inputObject).find("span:first").text():$(inputObject).text()).trim()){if(!ZP5Form.getFormClassObj().isAddMode())if("-"==ZP5Form.getSingleRecordFieldValue(fcid).trim())return val;val=""}return val}return $(inputObject).find("input[type=radio]:visible").length>0?$(inputObject).find("input[type=radio]:checked").val():("-"==(val=$(inputObject).find("span:first").text()).trim()&&(val=""),val);var val}},checkEmptyValue:function(value,fcType,dispType){return $.inArray(fcType,[FormConstants.FieldType.PICKLIST,FormConstants.FieldType.LOOKUP])>-1&&$.inArray(parseInt(dispType),[FormConstants.FieldType.SELECT_DISPLYTYPE,FormConstants.FieldType.MULTISELECT_DISPLYTYPE])>-1||$.inArray(fcType,[FormConstants.FieldType.COUNTRY,FormConstants.FieldType.BLOODGROUP,FormConstants.FieldType.GENDER])>-1?"Select"==value||""==value||"-Select-"==value:null==value||""==value||"null"==value},checkEqual:function(value1,value2,fcType){if(fcType==FormConstants.FieldType.LOOKUP||fcType==FormConstants.FieldType.PICKLIST)return value2.split(",").indexOf(value1+"")>-1;if(fcType==FormConstants.FieldType.URL){if(value1.indexOf("://")>-1&&value2.indexOf("://")<0)return value1.split("://")[1].trim()==value2.trim();if(value2.indexOf("://")>-1&&value1.indexOf("://")<0)return value2.split("://")[1].trim()==value1.trim()}return value1==value2},checkLessThan:function(value1,value2){return Number(value1)<Number(value2)},checkGreaterThan:function(value1,value2){return Number(value1)>Number(value2)},checkOptionsEmpty:function(value1,value2){return"-Select-"==value},checkIfContains:function(value1,value2,fcType){return value1.indexOf(value2)>-1},checkDateLessThan:function(date1,date2,isTime){if(date1.getFullYear()<date2.getFullYear())return!0;if(date1.getFullYear()===date2.getFullYear()){if(date1.getMonth()<date2.getMonth())return!0;if(date1.getMonth()===date2.getMonth()){if(date1.getDate()<date2.getDate())return!0;if(date1.getDate()===date2.getDate()){if(date1.getHours()<date2.getHours())return!0;if(date1.getHours()===date2.getHours()&&date1.getMinutes()<date2.getMinutes())return!0}}}return!1},checkDateGreaterThan:function(date1,date2,isTime){if(date1.getFullYear()>date2.getFullYear())return!0;if(date1.getFullYear()===date2.getFullYear()){if(date1.getMonth()>date2.getMonth())return!0;if(date1.getMonth()===date2.getMonth()){if(date1.getDate()>date2.getDate())return!0;if(date1.getDate()===date2.getDate()){if(date1.getHours()>date2.getHours())return!0;if(date1.getHours()===date2.getHours()&&date1.getMinutes()>date2.getMinutes())return!0}}}return!1},evaluateAction:function(operator,field,result){var actionFieldObject=ZPFRulesNew.Evaluation.LAYOUT.find("#zp_field_outer_"+field),relatedFieldsObject=ZPFRulesNew.Evaluation.LAYOUT.find("[id*=zp_form_relfield_"+field+"]"),parentSectionDiv=null,hideSection=null,isFieldShow=null,secDtls=ZPFRulesNew.Evaluation.findSec(field);if(operator==ZPFRulesNew.OPERATOR.SHOW&&result||operator==ZPFRulesNew.OPERATOR.HIDE&&!result?(isFieldShow=!0,actionFieldObject.length>0&&($(relatedFieldsObject).removeClass("DNI"),$(relatedFieldsObject).attr("isActionHidden",!1))):actionFieldObject.length>0&&($(relatedFieldsObject).addClass("DNI"),$(relatedFieldsObject).attr("isActionHidden",!0)),$(actionFieldObject).parent("div").length>0||!secDtls.isTabular){if(parentSectionDiv=$(actionFieldObject).parents("[id^=zp_section_fields_]"),1==isFieldShow){if(void 0==$(actionFieldObject).attr("fieldtype")||$(actionFieldObject).attr("fieldtype")==FormConstants.FieldType.PLAIN_TEXT)$(actionFieldObject).parent("div").parent("div").removeClass("DNI"),$(actionFieldObject).removeClass("DNI");else if($(actionFieldObject).parent("div").removeClass("DNI"),secDtls.isTabular){if(ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId]){let arr=ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId],ind=arr.indexOf(field);ind>-1&&arr.splice(ind,1)}ZPFRulesNew.Evaluation.LAYOUT.find("[id=zp_field_outer_"+field+"]").each(function(){$(this).parent("div").removeClass("DNI"),$(this).attr("isActionHidden",!1)})}if($(actionFieldObject).attr("isActionHidden",!1),$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DNI").length>0)1==$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DNI").length&&(hideSection=!1);else{var notPlainTextFieldsLength=$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").length;$(parentSectionDiv).find("[id*=zp_field_outer_]").not(".DNI").length>notPlainTextFieldsLength&&(hideSection=!1)}}else if(void 0==$(actionFieldObject).attr("fieldtype")||$(actionFieldObject).attr("fieldtype")==FormConstants.FieldType.PLAIN_TEXT?($(actionFieldObject).parent("div").parent("div").addClass("DNI"),$(actionFieldObject).addClass("DNI")):($(actionFieldObject).parent("div").addClass("DNI"),secDtls.isTabular&&(ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId]||(ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId]=[]),ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId].indexOf(field)<0&&ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId].push(field),ZPFRulesNew.Evaluation.LAYOUT.find("[id=zp_field_outer_"+field+"]").each(function(){$(this).parent("div").addClass("DNI"),$(this).attr("isActionHidden",!0)}))),$(actionFieldObject).attr("isActionHidden",!0),ZPFRulesNew.Evaluation.setEmptyFcs.push(field),0==$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DNI").length){notPlainTextFieldsLength=$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").length;$(parentSectionDiv).find("[id*=zp_field_outer_]").not(".DNI").length==notPlainTextFieldsLength&&(hideSection=!0)}}else if(secDtls.isTabular){var sectionDiv=ZPFRulesNew.Evaluation.LAYOUT.find("#zp_section_fields_"+secDtls.sectionId);parentSectionDiv=sectionDiv;var headerObject=$(sectionDiv).find("th[fcid="+field+"]"),formComp=ZP5Form.Field.getFieldComponent(field);if(1==isFieldShow){sectionDiv.find("tbody tr").each(function(){if(formComp.fieldType==FormConstants.FieldType.ADDRESS)if("zp_forms_summationrow"!=$(this).attr("id"))for(var childIndex=0;childIndex<FormConstants.AddressField.COLUMNAMEARRAY.length;childIndex++){var currColumnName=FormConstants.AddressField.COLUMNAMEARRAY[childIndex];let $_elem=$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]");$_elem.removeClass("DNI"),$_elem.attr("isActionHidden",!1)}else $(this).find("td[folabel="+formComp.labelName+"]").removeClass("DNI");else{let $element=$(this).find("td[folabel="+formComp.labelName+"]");$element.removeClass("DNI"),$element.attr("isActionHidden",!1)}});var tdLen=ZPFRulesNew.Evaluation.isViewMode?1:2;if(formComp.fieldType==FormConstants.FieldType.ADDRESS){for(var childIndex=0;childIndex<FormConstants.AddressField.COLUMNAMEARRAY.length;childIndex++){var currColumnName=FormConstants.AddressField.COLUMNAMEARRAY[childIndex];$(sectionDiv).find("th[folabel="+currColumnName+"_"+formComp.labelName+"]").removeClass("DNI")}tdLen=ZPFRulesNew.Evaluation.isViewMode?6:7}else $(headerObject).removeClass("DNI");if(sectionDiv.find("tr th").not(".DNI").length==tdLen&&(hideSection=!1),$(actionFieldObject).attr("isActionHidden",!1),ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId]){let arr=ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId],ind=arr.indexOf(field);ind>-1&&arr.splice(ind,1)}}else{if(0==sectionDiv.find('tbody tr td:contains("No rows found.")').length){formComp=ZP5Form.Field.getFieldComponent(field);sectionDiv.find("tbody tr").each(function(){if(formComp.fieldType==FormConstants.FieldType.ADDRESS)if("zp_forms_summationrow"!=$(this).attr("id"))for(var childIndex=0;childIndex<FormConstants.AddressField.COLUMNAMEARRAY.length;childIndex++){var currColumnName=FormConstants.AddressField.COLUMNAMEARRAY[childIndex];let $_elem=$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]");$_elem.addClass("DNI"),$_elem.attr("isActionHidden",!0)}else $(this).find("td[folabel="+formComp.labelName+"]").addClass("DNI");else{let $element=$(this).find("td[folabel="+formComp.labelName+"]");$element.addClass("DNI"),$element.attr("isActionHidden",!0)}})}tdLen=ZPFRulesNew.Evaluation.isViewMode?0:1;if(formComp.fieldType==FormConstants.FieldType.ADDRESS)for(childIndex=0;childIndex<FormConstants.AddressField.COLUMNAMEARRAY.length;childIndex++){currColumnName=FormConstants.AddressField.COLUMNAMEARRAY[childIndex];$(sectionDiv).find("th[folabel="+currColumnName+"_"+formComp.labelName+"]").addClass("DNI")}else $(headerObject).addClass("DNI");sectionDiv.find("th").not(".DNI").length==tdLen&&(hideSection=!0),ZPFRulesNew.Evaluation.setEmptyFcs.push(field),$(actionFieldObject).attr("isActionHidden",!0),ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId]||(ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId]=[]),ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId].indexOf(field)<0&&ZPFRulesNew.Evaluation.hidenFieldSBasedonsection[secDtls.sectionId].push(field)}}if($(parentSectionDiv).length>0){var secId=$(parentSectionDiv).attr("id").split("_").pop();hideSection?hideSection&&($("#onBoardingRightPane").is(":visible")||1!=ZP5Form.getCurrFormsOperation().getPaginationType()?($(parentSectionDiv).addClass("DNI"),ZP5Form.PRINT||ZPeople.isZPNewUI()||ZP5Form.getFormClassObj().isEmbedForm||ZPPreboarding.isPreBoarding?ZP5Form.PRINT?$(parentSectionDiv).parent().parent().prev("h4").addClass("DNI"):$(parentSectionDiv).parent().addClass("DNI"):$(parentSectionDiv).prev("h6").addClass("DNI")):($(parentSectionDiv).parents("#bodyparent").find("li[secid="+secId+"]").hide(),$(parentSectionDiv).parents("#bodyparent").find('li[id^="zp_form_section_"]:visible:first').trigger("click"))):$("#onBoardingRightPane").is(":visible")||1!=ZP5Form.getCurrFormsOperation().getPaginationType()?($(parentSectionDiv).removeClass("DNI"),ZP5Form.PRINT||ZPeople.isZPNewUI()||ZP5Form.getFormClassObj().isEmbedForm||ZPPreboarding.isPreBoarding?ZP5Form.PRINT?$(parentSectionDiv).parent().parent().prev("h3").removeClass("DNI"):$(parentSectionDiv).parent().removeClass("DNI"):$(parentSectionDiv).prev("h6").removeClass("DNI")):($(parentSectionDiv).parents("#bodyparent").find("li[secid="+secId+"]").show(),$(parentSectionDiv).parents("#bodyparent").find('li[id^="zp_form_section_"].sel').trigger("click"))}else{secId=ZPFRulesNew.Evaluation.findSecId(ZP5Form.getFormClassObj().getParams().formId,field);var secObj=$(actionFieldObject).prevAll("#"+secId);0==secObj.length&&(secObj=$(actionFieldObject).parents("[isallowed]").prevAll("#"+secId)),1==isFieldShow?1==secObj.nextAll("[isallowed]").not(".DNI").length&&secObj.removeClass("DNI"):0==secObj.nextAll("[isallowed]").not(".DNI").length&&secObj.addClass("DNI")}},findObject:function(jsonArray,searchKey,searchValue,returnValue,checkAddressIndex){var resultObject={},addOnIndex=0;return $.each(jsonArray,function(index,json){if(json[searchKey]==searchValue)return void 0==returnValue?resultObject=json:"index"==returnValue&&(resultObject.index=0==addOnIndex?index:index+addOnIndex),!1;checkAddressIndex&&"formComponentId"==searchKey&&json.fieldType==FormConstants.FieldType.ADDRESS&&"index"==returnValue&&(addOnIndex+=5)}),resultObject},findSec:function(fcId){var sectionDtls={},fields=ZP5Form.getCurrFormsOperation().getFormComponentData().message.formComponentDetails,returnFlag=!0;return $.each(fields,function(index1,section){return $.each(["column1","column2"],function(index2,col){return $.each(section[col],function(index3,field){if(void 0!=field&&field.formComponentId==fcId)return sectionDtls=section,returnFlag=!1}),returnFlag}),returnFlag}),sectionDtls},findSecId:function(formId,fcId){var secId=0;return $.each(ZP5Form.getCurrFormsOperation().getFormComponentData().message.formComponentDetails,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(void 0!=field&&field.formComponentId==fcId)return secId=section.sectionId,!1})})}),secId},makeExecutefalse:function(fcs){if(void 0!=fcs&&fcs.length>0)for(;fcs.length>0;){var fcid=fcs.pop();if(void 0!=ZP5Form.getFormClassObj().getParams().formId&&void 0!=ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId]&&ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent.hasOwnProperty(fcid)){var rulesArray=ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent[fcid];if(rulesArray.length>0)for(ruleIn=0;ruleIn<rulesArray.length;ruleIn++){rulesArray[ruleIn].isExecuted=!1}}}else void 0!=ZP5Form.getFormClassObj().getParams().formId&&void 0!=ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId]&&$.each(ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId].formComponent,function(key,rulesArray){if(rulesArray.length>0)for(ruleIn=0;ruleIn<rulesArray.length;ruleIn++){rulesArray[ruleIn].isExecuted=!1}})},findOptions:function(value,formComponentID,formId,isId){var formFields=ZP5Form.getCurrFormsOperation().getFormComponentData().message.formComponentDetails,fieldOption=null;return $.each(formFields,function(){if(null==(fieldOption=ZPFRulesNew.Evaluation.findOptionValue(this.column1,formComponentID,value,isId,formId))&&(fieldOption=ZPFRulesNew.Evaluation.findOptionValue(this.column2,formComponentID,value,isId,formId)),null!=fieldOption)return!1}),fieldOption},findOptionValue:function(col,fcID,value,isId,formId){var optionVal=null;return $.each(col,function(){if(void 0!=this&&this.formComponentId==fcID&&(options=ZPFRulesNew.Evaluation.getAllOptions(this),0==Object.keys(options).length&&"P_ApplyLeave"==ZP5Form.getCurrFormsOperation().getFormComponentData().formDetails.formName&&"Leavetype"==this.labelName&&(options=ZPFRulesNew.leaveTypes),null!=(optionVal=ZPFRulesNew.Evaluation.findSelectedOptionValue(isId,value,options,fcID))))return!1}),optionVal},getAllOptions:function(field){return field.fieldType===FormConstants.FieldType.LOOKUP&&ZPeople.isZPNewUI()&&Layout.Page.container.find("#rule:visible,#validationrule:visible").length>0?(field.AllOptions||$.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:{mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:field.formComponentId,fcType:FormConstants.FieldType.LOOKUP,isFromRule:!0},success:function(data){field.AllOptions=data.lookupDetailsList}}),field.AllOptions):field.isPrimaryLookup?field.hasOwnProperty("AddOptions")?field.AddOptions:field.EditOptions:field.hasOwnProperty("OptionsWithId")?field.OptionsWithId:field.Options},findSelectedOptionValue:function(isId,value,options,fcid){var optionVal=null;return void 0!=(optionVal=ZP5Form.select2.ALL_OPTIONS[fcid+"_"+value])&&""!=optionVal.trim()||$.each(options,function(){var valVariable=void 0!=this.DISPVALUE?"DISPVALUE":"Value";if((isId?ZPeople.decodeTxt(this[valVariable]).trim():this.Id)==value.trim())return optionVal=isId?this.Id:this[valVariable],!1}),optionVal},getDependentFields:function(critFcid,fields,isFromSelfService){var rules=ZP5Form.FIELD_RULE_DETAILS[ZP5Form.getFormClassObj().getParams().formId];isFromSelfService&&(rules=ZP5Form.FIELD_RULE_DETAILS[ZPeople.EMP_FORMID]),void 0!=rules&&rules.length>0&&$.each(rules,function(index,rule){var fieldElms=rule.fieldElms,actionElms=rule.actionElms;(void 0!=fieldElms&&$.inArray(critFcid,fieldElms)>-1||void 0!=actionElms&&$.inArray(critFcid,actionElms)>-1)&&(void 0!=fieldElms&&fieldElms.length>0&&$.each(fieldElms,function(index2,fieldElm){-1==$.inArray(fieldElm,fields)&&(fields.push(fieldElm),ZPFRulesNew.Evaluation.getDependentFields(fieldElm,fields,isFromSelfService))}),void 0!=actionElms&&actionElms.length>0&&$.each(actionElms,function(index1,actionElm){-1==$.inArray(actionElm,fields)&&(fields.push(actionElm),ZPFRulesNew.Evaluation.getDependentFields(actionElm,fields,isFromSelfService))}))})},constructRulesJson:function(data,params,others){if(data.code==zpconst.ResponseCodes.API_ERR_NO_ERROR)ZPFRulesNew.Evaluation.rulesArray=ZPFRulesNew.getFormattedRulesArray(data),ZPFRulesNew.setLeaveTypes(data),ZP5Form.FIELD_RULE_DETAILS[params.formId]=ZPFRulesNew.Evaluation.rulesArray,ZP5Form.FIELD_RULE_DETAILS[params.formId].formComponent=[],ZPFRulesNew.Configurations.setFieldRuleDetails(params.formId,ZPFRulesNew.Evaluation.rulesArray);else if(data.hasOwnProperty("message"))return void FrameworkCommon.showInfoAlert("",data.message.trim())}};